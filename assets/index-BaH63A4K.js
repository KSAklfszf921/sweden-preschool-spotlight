(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const h of c)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function r(c){const h={};return c.integrity&&(h.integrity=c.integrity),c.referrerPolicy&&(h.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?h.credentials="include":c.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function n(c){if(c.ep)return;c.ep=!0;const h=r(c);fetch(c.href,h)}})();(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=t(n);fetch(n.href,c)}})();var aoe=Object.defineProperty,i7=e=>{throw TypeError(e)},loe=(e,t,r)=>t in e?aoe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ob=(e,t,r)=>loe(e,typeof t!="symbol"?t+"":t,r),FD=(e,t,r)=>t.has(e)||i7("Cannot "+r),Xt=(e,t,r)=>(FD(e,t,"read from private field"),r?r.call(e):t.get(e)),Ai=(e,t,r)=>t.has(e)?i7("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Bn=(e,t,r,n)=>(FD(e,t,"write to private field"),t.set(e,r),r),pa=(e,t,r)=>(FD(e,t,"access private method"),r),iO=(e,t,r,n)=>({set _(c){Bn(e,t,c)},get _(){return Xt(e,t,n)}});function coe(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const c in n)if(c!=="default"&&!(c in e)){const h=Object.getOwnPropertyDescriptor(n,c);h&&Object.defineProperty(e,c,h.get?h:{enumerable:!0,get:()=>n[c]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=t(n);fetch(n.href,c)}})();var zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ki(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function uoe(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var c=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,c.get?c:{enumerable:!0,get:function(){return e[n]}})}),r}var s7={exports:{}},AA={},o7={exports:{}},ai={};/**
* @license React
* react.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var Vw=Symbol.for("react.element"),hoe=Symbol.for("react.portal"),doe=Symbol.for("react.fragment"),foe=Symbol.for("react.strict_mode"),poe=Symbol.for("react.profiler"),moe=Symbol.for("react.provider"),goe=Symbol.for("react.context"),yoe=Symbol.for("react.forward_ref"),_oe=Symbol.for("react.suspense"),voe=Symbol.for("react.memo"),xoe=Symbol.for("react.lazy"),r4=Symbol.iterator;function boe(e){return e===null||typeof e!="object"?null:(e=r4&&e[r4]||e["@@iterator"],typeof e=="function"?e:null)}var a7={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},l7=Object.assign,c7={};function Z_(e,t,r){this.props=e,this.context=t,this.refs=c7,this.updater=r||a7}Z_.prototype.isReactComponent={};Z_.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Z_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function u7(){}u7.prototype=Z_.prototype;function BD(e,t,r){this.props=e,this.context=t,this.refs=c7,this.updater=r||a7}var VD=BD.prototype=new u7;VD.constructor=BD;l7(VD,Z_.prototype);VD.isPureReactComponent=!0;var n4=Array.isArray,h7=Object.prototype.hasOwnProperty,UD={current:null},d7={key:!0,ref:!0,__self:!0,__source:!0};function f7(e,t,r){var n,c={},h=null,p=null;if(t!=null)for(n in t.ref!==void 0&&(p=t.ref),t.key!==void 0&&(h=""+t.key),t)h7.call(t,n)&&!d7.hasOwnProperty(n)&&(c[n]=t[n]);var s=arguments.length-2;if(s===1)c.children=r;else if(1<s){for(var v=Array(s),w=0;w<s;w++)v[w]=arguments[w+2];c.children=v}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)c[n]===void 0&&(c[n]=s[n]);return{$$typeof:Vw,type:e,key:h,ref:p,props:c,_owner:UD.current}}function woe(e,t){return{$$typeof:Vw,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function $D(e){return typeof e=="object"&&e!==null&&e.$$typeof===Vw}function Soe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var i4=/\/+/g;function _I(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Soe(""+e.key):t.toString(36)}function u2(e,t,r,n,c){var h=typeof e;(h==="undefined"||h==="boolean")&&(e=null);var p=!1;if(e===null)p=!0;else switch(h){case"string":case"number":p=!0;break;case"object":switch(e.$$typeof){case Vw:case hoe:p=!0}}if(p)return p=e,c=c(p),e=n===""?"."+_I(p,0):n,n4(c)?(r="",e!=null&&(r=e.replace(i4,"$&/")+"/"),u2(c,t,r,"",function(w){return w})):c!=null&&($D(c)&&(c=woe(c,r+(!c.key||p&&p.key===c.key?"":(""+c.key).replace(i4,"$&/")+"/")+e)),t.push(c)),1;if(p=0,n=n===""?".":n+":",n4(e))for(var s=0;s<e.length;s++){h=e[s];var v=n+_I(h,s);p+=u2(h,t,r,v,c)}else if(v=boe(e),typeof v=="function")for(e=v.call(e),s=0;!(h=e.next()).done;)h=h.value,v=n+_I(h,s++),p+=u2(h,t,r,v,c);else if(h==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return p}function dT(e,t,r){if(e==null)return e;var n=[],c=0;return u2(e,n,"","",function(h){return t.call(r,h,c++)}),n}function Toe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var wa={current:null},h2={transition:null},Eoe={ReactCurrentDispatcher:wa,ReactCurrentBatchConfig:h2,ReactCurrentOwner:UD};function p7(){throw Error("act(...) is not supported in production builds of React.")}ai.Children={map:dT,forEach:function(e,t,r){dT(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return dT(e,function(){t++}),t},toArray:function(e){return dT(e,function(t){return t})||[]},only:function(e){if(!$D(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ai.Component=Z_;ai.Fragment=doe;ai.Profiler=poe;ai.PureComponent=BD;ai.StrictMode=foe;ai.Suspense=_oe;ai.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Eoe;ai.act=p7;ai.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=l7({},e.props),c=e.key,h=e.ref,p=e._owner;if(t!=null){if(t.ref!==void 0&&(h=t.ref,p=UD.current),t.key!==void 0&&(c=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(v in t)h7.call(t,v)&&!d7.hasOwnProperty(v)&&(n[v]=t[v]===void 0&&s!==void 0?s[v]:t[v])}var v=arguments.length-2;if(v===1)n.children=r;else if(1<v){s=Array(v);for(var w=0;w<v;w++)s[w]=arguments[w+2];n.children=s}return{$$typeof:Vw,type:e.type,key:c,ref:h,props:n,_owner:p}};ai.createContext=function(e){return e={$$typeof:goe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:moe,_context:e},e.Consumer=e};ai.createElement=f7;ai.createFactory=function(e){var t=f7.bind(null,e);return t.type=e,t};ai.createRef=function(){return{current:null}};ai.forwardRef=function(e){return{$$typeof:yoe,render:e}};ai.isValidElement=$D;ai.lazy=function(e){return{$$typeof:xoe,_payload:{_status:-1,_result:e},_init:Toe}};ai.memo=function(e,t){return{$$typeof:voe,type:e,compare:t===void 0?null:t}};ai.startTransition=function(e){var t=h2.transition;h2.transition={};try{e()}finally{h2.transition=t}};ai.unstable_act=p7;ai.useCallback=function(e,t){return wa.current.useCallback(e,t)};ai.useContext=function(e){return wa.current.useContext(e)};ai.useDebugValue=function(){};ai.useDeferredValue=function(e){return wa.current.useDeferredValue(e)};ai.useEffect=function(e,t){return wa.current.useEffect(e,t)};ai.useId=function(){return wa.current.useId()};ai.useImperativeHandle=function(e,t,r){return wa.current.useImperativeHandle(e,t,r)};ai.useInsertionEffect=function(e,t){return wa.current.useInsertionEffect(e,t)};ai.useLayoutEffect=function(e,t){return wa.current.useLayoutEffect(e,t)};ai.useMemo=function(e,t){return wa.current.useMemo(e,t)};ai.useReducer=function(e,t,r){return wa.current.useReducer(e,t,r)};ai.useRef=function(e){return wa.current.useRef(e)};ai.useState=function(e){return wa.current.useState(e)};ai.useSyncExternalStore=function(e,t,r){return wa.current.useSyncExternalStore(e,t,r)};ai.useTransition=function(){return wa.current.useTransition()};ai.version="18.3.1";o7.exports=ai;var Z=o7.exports;const Ne=ki(Z),GD=coe({__proto__:null,default:Ne},[Z]);/**
* @license React
* react-jsx-runtime.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var Aoe=Z,koe=Symbol.for("react.element"),Poe=Symbol.for("react.fragment"),Coe=Object.prototype.hasOwnProperty,Ioe=Aoe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Moe={key:!0,ref:!0,__self:!0,__source:!0};function m7(e,t,r){var n,c={},h=null,p=null;r!==void 0&&(h=""+r),t.key!==void 0&&(h=""+t.key),t.ref!==void 0&&(p=t.ref);for(n in t)Coe.call(t,n)&&!Moe.hasOwnProperty(n)&&(c[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)c[n]===void 0&&(c[n]=t[n]);return{$$typeof:koe,type:e,key:h,ref:p,props:c,_owner:Ioe.current}}AA.Fragment=Poe;AA.jsx=m7;AA.jsxs=m7;s7.exports=AA;var P=s7.exports,g7={exports:{}},ml={},y7={exports:{}},_7={};/**
* @license React
* scheduler.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/(function(e){function t(rt,ht){var vt=rt.length;rt.push(ht);e:for(;0<vt;){var mt=vt-1>>>1,ct=rt[mt];if(0<c(ct,ht))rt[mt]=ht,rt[vt]=ct,vt=mt;else break e}}function r(rt){return rt.length===0?null:rt[0]}function n(rt){if(rt.length===0)return null;var ht=rt[0],vt=rt.pop();if(vt!==ht){rt[0]=vt;e:for(var mt=0,ct=rt.length,Ut=ct>>>1;mt<Ut;){var xr=2*(mt+1)-1,tn=rt[xr],Er=xr+1,Ft=rt[Er];if(0>c(tn,vt))Er<ct&&0>c(Ft,tn)?(rt[mt]=Ft,rt[Er]=vt,mt=Er):(rt[mt]=tn,rt[xr]=vt,mt=xr);else if(Er<ct&&0>c(Ft,vt))rt[mt]=Ft,rt[Er]=vt,mt=Er;else break e}}return ht}function c(rt,ht){var vt=rt.sortIndex-ht.sortIndex;return vt!==0?vt:rt.id-ht.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;e.unstable_now=function(){return h.now()}}else{var p=Date,s=p.now();e.unstable_now=function(){return p.now()-s}}var v=[],w=[],T=1,I=null,O=3,D=!1,B=!1,N=!1,G=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(rt){for(var ht=r(w);ht!==null;){if(ht.callback===null)n(w);else if(ht.startTime<=rt)n(w),ht.sortIndex=ht.expirationTime,t(v,ht);else break;ht=r(w)}}function Y(rt){if(N=!1,X(rt),!B)if(r(v)!==null)B=!0,We(ne);else{var ht=r(w);ht!==null&&lt(Y,ht.startTime-rt)}}function ne(rt,ht){B=!1,N&&(N=!1,U(ge),ge=-1),D=!0;var vt=O;try{for(X(ht),I=r(v);I!==null&&(!(I.expirationTime>ht)||rt&&!Pe());){var mt=I.callback;if(typeof mt=="function"){I.callback=null,O=I.priorityLevel;var ct=mt(I.expirationTime<=ht);ht=e.unstable_now(),typeof ct=="function"?I.callback=ct:I===r(v)&&n(v),X(ht)}else n(v);I=r(v)}if(I!==null)var Ut=!0;else{var xr=r(w);xr!==null&&lt(Y,xr.startTime-ht),Ut=!1}return Ut}finally{I=null,O=vt,D=!1}}var ae=!1,le=null,ge=-1,je=5,ze=-1;function Pe(){return!(e.unstable_now()-ze<je)}function Ke(){if(le!==null){var rt=e.unstable_now();ze=rt;var ht=!0;try{ht=le(!0,rt)}finally{ht?Ye():(ae=!1,le=null)}}else ae=!1}var Ye;if(typeof V=="function")Ye=function(){V(Ke)};else if(typeof MessageChannel<"u"){var Oe=new MessageChannel,tt=Oe.port2;Oe.port1.onmessage=Ke,Ye=function(){tt.postMessage(null)}}else Ye=function(){G(Ke,0)};function We(rt){le=rt,ae||(ae=!0,Ye())}function lt(rt,ht){ge=G(function(){rt(e.unstable_now())},ht)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(rt){rt.callback=null},e.unstable_continueExecution=function(){B||D||(B=!0,We(ne))},e.unstable_forceFrameRate=function(rt){0>rt||125<rt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):je=0<rt?Math.floor(1e3/rt):5},e.unstable_getCurrentPriorityLevel=function(){return O},e.unstable_getFirstCallbackNode=function(){return r(v)},e.unstable_next=function(rt){switch(O){case 1:case 2:case 3:var ht=3;break;default:ht=O}var vt=O;O=ht;try{return rt()}finally{O=vt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(rt,ht){switch(rt){case 1:case 2:case 3:case 4:case 5:break;default:rt=3}var vt=O;O=rt;try{return ht()}finally{O=vt}},e.unstable_scheduleCallback=function(rt,ht,vt){var mt=e.unstable_now();switch(typeof vt=="object"&&vt!==null?(vt=vt.delay,vt=typeof vt=="number"&&0<vt?mt+vt:mt):vt=mt,rt){case 1:var ct=-1;break;case 2:ct=250;break;case 5:ct=1073741823;break;case 4:ct=1e4;break;default:ct=5e3}return ct=vt+ct,rt={id:T++,callback:ht,priorityLevel:rt,startTime:vt,expirationTime:ct,sortIndex:-1},vt>mt?(rt.sortIndex=vt,t(w,rt),r(v)===null&&rt===r(w)&&(N?(U(ge),ge=-1):N=!0,lt(Y,vt-mt))):(rt.sortIndex=ct,t(v,rt),B||D||(B=!0,We(ne))),rt},e.unstable_shouldYield=Pe,e.unstable_wrapCallback=function(rt){var ht=O;return function(){var vt=O;O=ht;try{return rt.apply(this,arguments)}finally{O=vt}}}})(_7);y7.exports=_7;var Ooe=y7.exports;/**
* @license React
* react-dom.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var joe=Z,pl=Ooe;function cr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var v7=new Set,Ob={};function Im(e,t){c_(e,t),c_(e+"Capture",t)}function c_(e,t){for(Ob[e]=t,e=0;e<t.length;e++)v7.add(t[e])}var wh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),sO=Object.prototype.hasOwnProperty,Roe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,s4={},o4={};function Doe(e){return sO.call(o4,e)?!0:sO.call(s4,e)?!1:Roe.test(e)?o4[e]=!0:(s4[e]=!0,!1)}function Loe(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function zoe(e,t,r,n){if(t===null||typeof t>"u"||Loe(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Sa(e,t,r,n,c,h,p){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=c,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=h,this.removeEmptyString=p}var Fo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Fo[e]=new Sa(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Fo[t]=new Sa(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Fo[e]=new Sa(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Fo[e]=new Sa(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Fo[e]=new Sa(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Fo[e]=new Sa(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Fo[e]=new Sa(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Fo[e]=new Sa(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Fo[e]=new Sa(e,5,!1,e.toLowerCase(),null,!1,!1)});var HD=/[\-:]([a-z])/g;function WD(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(HD,WD);Fo[t]=new Sa(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(HD,WD);Fo[t]=new Sa(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(HD,WD);Fo[t]=new Sa(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Fo[e]=new Sa(e,1,!1,e.toLowerCase(),null,!1,!1)});Fo.xlinkHref=new Sa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Fo[e]=new Sa(e,1,!1,e.toLowerCase(),null,!0,!0)});function qD(e,t,r,n){var c=Fo.hasOwnProperty(t)?Fo[t]:null;(c!==null?c.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(zoe(t,r,c,n)&&(r=null),n||c===null?Doe(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):c.mustUseProperty?e[c.propertyName]=r===null?c.type===3?!1:"":r:(t=c.attributeName,n=c.attributeNamespace,r===null?e.removeAttribute(t):(c=c.type,r=c===3||c===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Nh=joe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,fT=Symbol.for("react.element"),Ty=Symbol.for("react.portal"),Ey=Symbol.for("react.fragment"),ZD=Symbol.for("react.strict_mode"),oO=Symbol.for("react.profiler"),x7=Symbol.for("react.provider"),b7=Symbol.for("react.context"),KD=Symbol.for("react.forward_ref"),aO=Symbol.for("react.suspense"),lO=Symbol.for("react.suspense_list"),XD=Symbol.for("react.memo"),$d=Symbol.for("react.lazy"),w7=Symbol.for("react.offscreen"),a4=Symbol.iterator;function _x(e){return e===null||typeof e!="object"?null:(e=a4&&e[a4]||e["@@iterator"],typeof e=="function"?e:null)}var ys=Object.assign,vI;function Yx(e){if(vI===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);vI=t&&t[1]||""}return`
`+vI+e}var xI=!1;function bI(e,t){if(!e||xI)return"";xI=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(w){var n=w}Reflect.construct(e,[],t)}else{try{t.call()}catch(w){n=w}e.call(t.prototype)}else{try{throw Error()}catch(w){n=w}e()}}catch(w){if(w&&n&&typeof w.stack=="string"){for(var c=w.stack.split(`
`),h=n.stack.split(`
`),p=c.length-1,s=h.length-1;1<=p&&0<=s&&c[p]!==h[s];)s--;for(;1<=p&&0<=s;p--,s--)if(c[p]!==h[s]){if(p!==1||s!==1)do if(p--,s--,0>s||c[p]!==h[s]){var v=`
`+c[p].replace(" at new "," at ");return e.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",e.displayName)),v}while(1<=p&&0<=s);break}}}finally{xI=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Yx(e):""}function Noe(e){switch(e.tag){case 5:return Yx(e.type);case 16:return Yx("Lazy");case 13:return Yx("Suspense");case 19:return Yx("SuspenseList");case 0:case 2:case 15:return e=bI(e.type,!1),e;case 11:return e=bI(e.type.render,!1),e;case 1:return e=bI(e.type,!0),e;default:return""}}function cO(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Ey:return"Fragment";case Ty:return"Portal";case oO:return"Profiler";case ZD:return"StrictMode";case aO:return"Suspense";case lO:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case b7:return(e.displayName||"Context")+".Consumer";case x7:return(e._context.displayName||"Context")+".Provider";case KD:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case XD:return t=e.displayName||null,t!==null?t:cO(e.type)||"Memo";case $d:t=e._payload,e=e._init;try{return cO(e(t))}catch{}}return null}function Foe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cO(t);case 8:return t===ZD?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function pf(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function S7(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Boe(e){var t=S7(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,h=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(p){n=""+p,h.call(this,p)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(p){n=""+p},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function pT(e){e._valueTracker||(e._valueTracker=Boe(e))}function T7(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=S7(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function R2(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function uO(e,t){var r=t.checked;return ys({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function l4(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=pf(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function E7(e,t){t=t.checked,t!=null&&qD(e,"checked",t,!1)}function hO(e,t){E7(e,t);var r=pf(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?dO(e,t.type,r):t.hasOwnProperty("defaultValue")&&dO(e,t.type,pf(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function c4(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function dO(e,t,r){(t!=="number"||R2(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Jx=Array.isArray;function Wy(e,t,r,n){if(e=e.options,t){t={};for(var c=0;c<r.length;c++)t["$"+r[c]]=!0;for(r=0;r<e.length;r++)c=t.hasOwnProperty("$"+e[r].value),e[r].selected!==c&&(e[r].selected=c),c&&n&&(e[r].defaultSelected=!0)}else{for(r=""+pf(r),t=null,c=0;c<e.length;c++){if(e[c].value===r){e[c].selected=!0,n&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function fO(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(cr(91));return ys({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function u4(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(cr(92));if(Jx(r)){if(1<r.length)throw Error(cr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:pf(r)}}function A7(e,t){var r=pf(t.value),n=pf(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function h4(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function k7(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pO(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?k7(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mT,P7=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,c){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,c)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(mT=mT||document.createElement("div"),mT.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=mT.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function jb(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var ab={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Voe=["Webkit","ms","Moz","O"];Object.keys(ab).forEach(function(e){Voe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ab[t]=ab[e]})});function C7(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||ab.hasOwnProperty(e)&&ab[e]?(""+t).trim():t+"px"}function I7(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,c=C7(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,c):e[r]=c}}var Uoe=ys({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mO(e,t){if(t){if(Uoe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(cr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(cr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(cr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(cr(62))}}function gO(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yO=null;function YD(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var _O=null,qy=null,Zy=null;function d4(e){if(e=Gw(e)){if(typeof _O!="function")throw Error(cr(280));var t=e.stateNode;t&&(t=MA(t),_O(e.stateNode,e.type,t))}}function M7(e){qy?Zy?Zy.push(e):Zy=[e]:qy=e}function O7(){if(qy){var e=qy,t=Zy;if(Zy=qy=null,d4(e),t)for(e=0;e<t.length;e++)d4(t[e])}}function j7(e,t){return e(t)}function R7(){}var wI=!1;function D7(e,t,r){if(wI)return e(t,r);wI=!0;try{return j7(e,t,r)}finally{wI=!1,(qy!==null||Zy!==null)&&(R7(),O7())}}function Rb(e,t){var r=e.stateNode;if(r===null)return null;var n=MA(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(cr(231,t,typeof r));return r}var vO=!1;if(wh)try{var vx={};Object.defineProperty(vx,"passive",{get:function(){vO=!0}}),window.addEventListener("test",vx,vx),window.removeEventListener("test",vx,vx)}catch{vO=!1}function $oe(e,t,r,n,c,h,p,s,v){var w=Array.prototype.slice.call(arguments,3);try{t.apply(r,w)}catch(T){this.onError(T)}}var lb=!1,D2=null,L2=!1,xO=null,Goe={onError:function(e){lb=!0,D2=e}};function Hoe(e,t,r,n,c,h,p,s,v){lb=!1,D2=null,$oe.apply(Goe,arguments)}function Woe(e,t,r,n,c,h,p,s,v){if(Hoe.apply(this,arguments),lb){if(lb){var w=D2;lb=!1,D2=null}else throw Error(cr(198));L2||(L2=!0,xO=w)}}function Mm(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function L7(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function f4(e){if(Mm(e)!==e)throw Error(cr(188))}function qoe(e){var t=e.alternate;if(!t){if(t=Mm(e),t===null)throw Error(cr(188));return t!==e?null:e}for(var r=e,n=t;;){var c=r.return;if(c===null)break;var h=c.alternate;if(h===null){if(n=c.return,n!==null){r=n;continue}break}if(c.child===h.child){for(h=c.child;h;){if(h===r)return f4(c),e;if(h===n)return f4(c),t;h=h.sibling}throw Error(cr(188))}if(r.return!==n.return)r=c,n=h;else{for(var p=!1,s=c.child;s;){if(s===r){p=!0,r=c,n=h;break}if(s===n){p=!0,n=c,r=h;break}s=s.sibling}if(!p){for(s=h.child;s;){if(s===r){p=!0,r=h,n=c;break}if(s===n){p=!0,n=h,r=c;break}s=s.sibling}if(!p)throw Error(cr(189))}}if(r.alternate!==n)throw Error(cr(190))}if(r.tag!==3)throw Error(cr(188));return r.stateNode.current===r?e:t}function z7(e){return e=qoe(e),e!==null?N7(e):null}function N7(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=N7(e);if(t!==null)return t;e=e.sibling}return null}var F7=pl.unstable_scheduleCallback,p4=pl.unstable_cancelCallback,Zoe=pl.unstable_shouldYield,Koe=pl.unstable_requestPaint,js=pl.unstable_now,Xoe=pl.unstable_getCurrentPriorityLevel,JD=pl.unstable_ImmediatePriority,B7=pl.unstable_UserBlockingPriority,z2=pl.unstable_NormalPriority,Yoe=pl.unstable_LowPriority,V7=pl.unstable_IdlePriority,kA=null,yu=null;function Joe(e){if(yu&&typeof yu.onCommitFiberRoot=="function")try{yu.onCommitFiberRoot(kA,e,void 0,(e.current.flags&128)===128)}catch{}}var gc=Math.clz32?Math.clz32:tae,Qoe=Math.log,eae=Math.LN2;function tae(e){return e>>>=0,e===0?32:31-(Qoe(e)/eae|0)|0}var gT=64,yT=4194304;function Qx(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function N2(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,c=e.suspendedLanes,h=e.pingedLanes,p=r&268435455;if(p!==0){var s=p&~c;s!==0?n=Qx(s):(h&=p,h!==0&&(n=Qx(h)))}else p=r&~c,p!==0?n=Qx(p):h!==0&&(n=Qx(h));if(n===0)return 0;if(t!==0&&t!==n&&!(t&c)&&(c=n&-n,h=t&-t,c>=h||c===16&&(h&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-gc(t),c=1<<r,n|=e[r],t&=~c;return n}function rae(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nae(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,c=e.expirationTimes,h=e.pendingLanes;0<h;){var p=31-gc(h),s=1<<p,v=c[p];v===-1?(!(s&r)||s&n)&&(c[p]=rae(s,t)):v<=t&&(e.expiredLanes|=s),h&=~s}}function bO(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function U7(){var e=gT;return gT<<=1,!(gT&4194240)&&(gT=64),e}function SI(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Uw(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-gc(t),e[t]=r}function iae(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var c=31-gc(r),h=1<<c;t[c]=0,n[c]=-1,e[c]=-1,r&=~h}}function QD(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-gc(r),c=1<<n;c&t|e[n]&t&&(e[n]|=t),r&=~c}}var zi=0;function $7(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var G7,eL,H7,W7,q7,wO=!1,_T=[],rf=null,nf=null,sf=null,Db=new Map,Lb=new Map,Zd=[],sae="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function m4(e,t){switch(e){case"focusin":case"focusout":rf=null;break;case"dragenter":case"dragleave":nf=null;break;case"mouseover":case"mouseout":sf=null;break;case"pointerover":case"pointerout":Db.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lb.delete(t.pointerId)}}function xx(e,t,r,n,c,h){return e===null||e.nativeEvent!==h?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:h,targetContainers:[c]},t!==null&&(t=Gw(t),t!==null&&eL(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function oae(e,t,r,n,c){switch(t){case"focusin":return rf=xx(rf,e,t,r,n,c),!0;case"dragenter":return nf=xx(nf,e,t,r,n,c),!0;case"mouseover":return sf=xx(sf,e,t,r,n,c),!0;case"pointerover":var h=c.pointerId;return Db.set(h,xx(Db.get(h)||null,e,t,r,n,c)),!0;case"gotpointercapture":return h=c.pointerId,Lb.set(h,xx(Lb.get(h)||null,e,t,r,n,c)),!0}return!1}function Z7(e){var t=Xp(e.target);if(t!==null){var r=Mm(t);if(r!==null){if(t=r.tag,t===13){if(t=L7(r),t!==null){e.blockedOn=t,q7(e.priority,function(){H7(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function d2(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=SO(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);yO=n,r.target.dispatchEvent(n),yO=null}else return t=Gw(r),t!==null&&eL(t),e.blockedOn=r,!1;t.shift()}return!0}function g4(e,t,r){d2(e)&&r.delete(t)}function aae(){wO=!1,rf!==null&&d2(rf)&&(rf=null),nf!==null&&d2(nf)&&(nf=null),sf!==null&&d2(sf)&&(sf=null),Db.forEach(g4),Lb.forEach(g4)}function bx(e,t){e.blockedOn===t&&(e.blockedOn=null,wO||(wO=!0,pl.unstable_scheduleCallback(pl.unstable_NormalPriority,aae)))}function zb(e){function t(c){return bx(c,e)}if(0<_T.length){bx(_T[0],e);for(var r=1;r<_T.length;r++){var n=_T[r];n.blockedOn===e&&(n.blockedOn=null)}}for(rf!==null&&bx(rf,e),nf!==null&&bx(nf,e),sf!==null&&bx(sf,e),Db.forEach(t),Lb.forEach(t),r=0;r<Zd.length;r++)n=Zd[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Zd.length&&(r=Zd[0],r.blockedOn===null);)Z7(r),r.blockedOn===null&&Zd.shift()}var Ky=Nh.ReactCurrentBatchConfig,F2=!0;function lae(e,t,r,n){var c=zi,h=Ky.transition;Ky.transition=null;try{zi=1,tL(e,t,r,n)}finally{zi=c,Ky.transition=h}}function cae(e,t,r,n){var c=zi,h=Ky.transition;Ky.transition=null;try{zi=4,tL(e,t,r,n)}finally{zi=c,Ky.transition=h}}function tL(e,t,r,n){if(F2){var c=SO(e,t,r,n);if(c===null)jI(e,t,n,B2,r),m4(e,n);else if(oae(c,e,t,r,n))n.stopPropagation();else if(m4(e,n),t&4&&-1<sae.indexOf(e)){for(;c!==null;){var h=Gw(c);if(h!==null&&G7(h),h=SO(e,t,r,n),h===null&&jI(e,t,n,B2,r),h===c)break;c=h}c!==null&&n.stopPropagation()}else jI(e,t,n,null,r)}}var B2=null;function SO(e,t,r,n){if(B2=null,e=YD(n),e=Xp(e),e!==null)if(t=Mm(e),t===null)e=null;else if(r=t.tag,r===13){if(e=L7(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return B2=e,null}function K7(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xoe()){case JD:return 1;case B7:return 4;case z2:case Yoe:return 16;case V7:return 536870912;default:return 16}default:return 16}}var Jd=null,rL=null,f2=null;function X7(){if(f2)return f2;var e,t=rL,r=t.length,n,c="value"in Jd?Jd.value:Jd.textContent,h=c.length;for(e=0;e<r&&t[e]===c[e];e++);var p=r-e;for(n=1;n<=p&&t[r-n]===c[h-n];n++);return f2=c.slice(e,1<n?1-n:void 0)}function p2(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function vT(){return!0}function y4(){return!1}function gl(e){function t(r,n,c,h,p){this._reactName=r,this._targetInst=c,this.type=n,this.nativeEvent=h,this.target=p,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(h):h[s]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?vT:y4,this.isPropagationStopped=y4,this}return ys(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=vT)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=vT)},persist:function(){},isPersistent:vT}),t}var K_={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nL=gl(K_),$w=ys({},K_,{view:0,detail:0}),uae=gl($w),TI,EI,wx,PA=ys({},$w,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:iL,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==wx&&(wx&&e.type==="mousemove"?(TI=e.screenX-wx.screenX,EI=e.screenY-wx.screenY):EI=TI=0,wx=e),TI)},movementY:function(e){return"movementY"in e?e.movementY:EI}}),_4=gl(PA),hae=ys({},PA,{dataTransfer:0}),dae=gl(hae),fae=ys({},$w,{relatedTarget:0}),AI=gl(fae),pae=ys({},K_,{animationName:0,elapsedTime:0,pseudoElement:0}),mae=gl(pae),gae=ys({},K_,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yae=gl(gae),_ae=ys({},K_,{data:0}),v4=gl(_ae),vae={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xae={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bae={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wae(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=bae[e])?!!t[e]:!1}function iL(){return wae}var Sae=ys({},$w,{key:function(e){if(e.key){var t=vae[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=p2(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?xae[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:iL,charCode:function(e){return e.type==="keypress"?p2(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?p2(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Tae=gl(Sae),Eae=ys({},PA,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),x4=gl(Eae),Aae=ys({},$w,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:iL}),kae=gl(Aae),Pae=ys({},K_,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cae=gl(Pae),Iae=ys({},PA,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Mae=gl(Iae),Oae=[9,13,27,32],sL=wh&&"CompositionEvent"in window,cb=null;wh&&"documentMode"in document&&(cb=document.documentMode);var jae=wh&&"TextEvent"in window&&!cb,Y7=wh&&(!sL||cb&&8<cb&&11>=cb),b4=" ",w4=!1;function J7(e,t){switch(e){case"keyup":return Oae.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Q7(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ay=!1;function Rae(e,t){switch(e){case"compositionend":return Q7(t);case"keypress":return t.which!==32?null:(w4=!0,b4);case"textInput":return e=t.data,e===b4&&w4?null:e;default:return null}}function Dae(e,t){if(Ay)return e==="compositionend"||!sL&&J7(e,t)?(e=X7(),f2=rL=Jd=null,Ay=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Y7&&t.locale!=="ko"?null:t.data;default:return null}}var Lae={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function S4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Lae[e.type]:t==="textarea"}function eW(e,t,r,n){M7(n),t=V2(t,"onChange"),0<t.length&&(r=new nL("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var ub=null,Nb=null;function zae(e){hW(e,0)}function CA(e){var t=Cy(e);if(T7(t))return e}function Nae(e,t){if(e==="change")return t}var tW=!1;if(wh){var kI;if(wh){var PI="oninput"in document;if(!PI){var T4=document.createElement("div");T4.setAttribute("oninput","return;"),PI=typeof T4.oninput=="function"}kI=PI}else kI=!1;tW=kI&&(!document.documentMode||9<document.documentMode)}function E4(){ub&&(ub.detachEvent("onpropertychange",rW),Nb=ub=null)}function rW(e){if(e.propertyName==="value"&&CA(Nb)){var t=[];eW(t,Nb,e,YD(e)),D7(zae,t)}}function Fae(e,t,r){e==="focusin"?(E4(),ub=t,Nb=r,ub.attachEvent("onpropertychange",rW)):e==="focusout"&&E4()}function Bae(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return CA(Nb)}function Vae(e,t){if(e==="click")return CA(t)}function Uae(e,t){if(e==="input"||e==="change")return CA(t)}function $ae(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var vc=typeof Object.is=="function"?Object.is:$ae;function Fb(e,t){if(vc(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var c=r[n];if(!sO.call(t,c)||!vc(e[c],t[c]))return!1}return!0}function A4(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function k4(e,t){var r=A4(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=A4(r)}}function nW(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?nW(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function iW(){for(var e=window,t=R2();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=R2(e.document)}return t}function oL(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Gae(e){var t=iW(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&nW(r.ownerDocument.documentElement,r)){if(n!==null&&oL(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var c=r.textContent.length,h=Math.min(n.start,c);n=n.end===void 0?h:Math.min(n.end,c),!e.extend&&h>n&&(c=n,n=h,h=c),c=k4(r,h);var p=k4(r,n);c&&p&&(e.rangeCount!==1||e.anchorNode!==c.node||e.anchorOffset!==c.offset||e.focusNode!==p.node||e.focusOffset!==p.offset)&&(t=t.createRange(),t.setStart(c.node,c.offset),e.removeAllRanges(),h>n?(e.addRange(t),e.extend(p.node,p.offset)):(t.setEnd(p.node,p.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Hae=wh&&"documentMode"in document&&11>=document.documentMode,ky=null,TO=null,hb=null,EO=!1;function P4(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;EO||ky==null||ky!==R2(n)||(n=ky,"selectionStart"in n&&oL(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),hb&&Fb(hb,n)||(hb=n,n=V2(TO,"onSelect"),0<n.length&&(t=new nL("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=ky)))}function xT(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Py={animationend:xT("Animation","AnimationEnd"),animationiteration:xT("Animation","AnimationIteration"),animationstart:xT("Animation","AnimationStart"),transitionend:xT("Transition","TransitionEnd")},CI={},sW={};wh&&(sW=document.createElement("div").style,"AnimationEvent"in window||(delete Py.animationend.animation,delete Py.animationiteration.animation,delete Py.animationstart.animation),"TransitionEvent"in window||delete Py.transitionend.transition);function IA(e){if(CI[e])return CI[e];if(!Py[e])return e;var t=Py[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in sW)return CI[e]=t[r];return e}var oW=IA("animationend"),aW=IA("animationiteration"),lW=IA("animationstart"),cW=IA("transitionend"),uW=new Map,C4="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vf(e,t){uW.set(e,t),Im(t,[e])}for(var II=0;II<C4.length;II++){var MI=C4[II],Wae=MI.toLowerCase(),qae=MI[0].toUpperCase()+MI.slice(1);vf(Wae,"on"+qae)}vf(oW,"onAnimationEnd");vf(aW,"onAnimationIteration");vf(lW,"onAnimationStart");vf("dblclick","onDoubleClick");vf("focusin","onFocus");vf("focusout","onBlur");vf(cW,"onTransitionEnd");c_("onMouseEnter",["mouseout","mouseover"]);c_("onMouseLeave",["mouseout","mouseover"]);c_("onPointerEnter",["pointerout","pointerover"]);c_("onPointerLeave",["pointerout","pointerover"]);Im("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Im("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Im("onBeforeInput",["compositionend","keypress","textInput","paste"]);Im("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Im("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Im("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var eb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zae=new Set("cancel close invalid load scroll toggle".split(" ").concat(eb));function I4(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Woe(n,t,void 0,e),e.currentTarget=null}function hW(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],c=n.event;n=n.listeners;e:{var h=void 0;if(t)for(var p=n.length-1;0<=p;p--){var s=n[p],v=s.instance,w=s.currentTarget;if(s=s.listener,v!==h&&c.isPropagationStopped())break e;I4(c,s,w),h=v}else for(p=0;p<n.length;p++){if(s=n[p],v=s.instance,w=s.currentTarget,s=s.listener,v!==h&&c.isPropagationStopped())break e;I4(c,s,w),h=v}}}if(L2)throw e=xO,L2=!1,xO=null,e}function is(e,t){var r=t[IO];r===void 0&&(r=t[IO]=new Set);var n=e+"__bubble";r.has(n)||(dW(t,e,2,!1),r.add(n))}function OI(e,t,r){var n=0;t&&(n|=4),dW(r,e,n,t)}var bT="_reactListening"+Math.random().toString(36).slice(2);function Bb(e){if(!e[bT]){e[bT]=!0,v7.forEach(function(r){r!=="selectionchange"&&(Zae.has(r)||OI(r,!1,e),OI(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[bT]||(t[bT]=!0,OI("selectionchange",!1,t))}}function dW(e,t,r,n){switch(K7(t)){case 1:var c=lae;break;case 4:c=cae;break;default:c=tL}r=c.bind(null,t,r,e),c=void 0,!vO||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),n?c!==void 0?e.addEventListener(t,r,{capture:!0,passive:c}):e.addEventListener(t,r,!0):c!==void 0?e.addEventListener(t,r,{passive:c}):e.addEventListener(t,r,!1)}function jI(e,t,r,n,c){var h=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var p=n.tag;if(p===3||p===4){var s=n.stateNode.containerInfo;if(s===c||s.nodeType===8&&s.parentNode===c)break;if(p===4)for(p=n.return;p!==null;){var v=p.tag;if((v===3||v===4)&&(v=p.stateNode.containerInfo,v===c||v.nodeType===8&&v.parentNode===c))return;p=p.return}for(;s!==null;){if(p=Xp(s),p===null)return;if(v=p.tag,v===5||v===6){n=h=p;continue e}s=s.parentNode}}n=n.return}D7(function(){var w=h,T=YD(r),I=[];e:{var O=uW.get(e);if(O!==void 0){var D=nL,B=e;switch(e){case"keypress":if(p2(r)===0)break e;case"keydown":case"keyup":D=Tae;break;case"focusin":B="focus",D=AI;break;case"focusout":B="blur",D=AI;break;case"beforeblur":case"afterblur":D=AI;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":D=_4;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":D=dae;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":D=kae;break;case oW:case aW:case lW:D=mae;break;case cW:D=Cae;break;case"scroll":D=uae;break;case"wheel":D=Mae;break;case"copy":case"cut":case"paste":D=yae;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":D=x4}var N=(t&4)!==0,G=!N&&e==="scroll",U=N?O!==null?O+"Capture":null:O;N=[];for(var V=w,X;V!==null;){X=V;var Y=X.stateNode;if(X.tag===5&&Y!==null&&(X=Y,U!==null&&(Y=Rb(V,U),Y!=null&&N.push(Vb(V,Y,X)))),G)break;V=V.return}0<N.length&&(O=new D(O,B,null,r,T),I.push({event:O,listeners:N}))}}if(!(t&7)){e:{if(O=e==="mouseover"||e==="pointerover",D=e==="mouseout"||e==="pointerout",O&&r!==yO&&(B=r.relatedTarget||r.fromElement)&&(Xp(B)||B[Sh]))break e;if((D||O)&&(O=T.window===T?T:(O=T.ownerDocument)?O.defaultView||O.parentWindow:window,D?(B=r.relatedTarget||r.toElement,D=w,B=B?Xp(B):null,B!==null&&(G=Mm(B),B!==G||B.tag!==5&&B.tag!==6)&&(B=null)):(D=null,B=w),D!==B)){if(N=_4,Y="onMouseLeave",U="onMouseEnter",V="mouse",(e==="pointerout"||e==="pointerover")&&(N=x4,Y="onPointerLeave",U="onPointerEnter",V="pointer"),G=D==null?O:Cy(D),X=B==null?O:Cy(B),O=new N(Y,V+"leave",D,r,T),O.target=G,O.relatedTarget=X,Y=null,Xp(T)===w&&(N=new N(U,V+"enter",B,r,T),N.target=X,N.relatedTarget=G,Y=N),G=Y,D&&B)t:{for(N=D,U=B,V=0,X=N;X;X=sy(X))V++;for(X=0,Y=U;Y;Y=sy(Y))X++;for(;0<V-X;)N=sy(N),V--;for(;0<X-V;)U=sy(U),X--;for(;V--;){if(N===U||U!==null&&N===U.alternate)break t;N=sy(N),U=sy(U)}N=null}else N=null;D!==null&&M4(I,O,D,N,!1),B!==null&&G!==null&&M4(I,G,B,N,!0)}}e:{if(O=w?Cy(w):window,D=O.nodeName&&O.nodeName.toLowerCase(),D==="select"||D==="input"&&O.type==="file")var ne=Nae;else if(S4(O))if(tW)ne=Uae;else{ne=Bae;var ae=Fae}else(D=O.nodeName)&&D.toLowerCase()==="input"&&(O.type==="checkbox"||O.type==="radio")&&(ne=Vae);if(ne&&(ne=ne(e,w))){eW(I,ne,r,T);break e}ae&&ae(e,O,w),e==="focusout"&&(ae=O._wrapperState)&&ae.controlled&&O.type==="number"&&dO(O,"number",O.value)}switch(ae=w?Cy(w):window,e){case"focusin":(S4(ae)||ae.contentEditable==="true")&&(ky=ae,TO=w,hb=null);break;case"focusout":hb=TO=ky=null;break;case"mousedown":EO=!0;break;case"contextmenu":case"mouseup":case"dragend":EO=!1,P4(I,r,T);break;case"selectionchange":if(Hae)break;case"keydown":case"keyup":P4(I,r,T)}var le;if(sL)e:{switch(e){case"compositionstart":var ge="onCompositionStart";break e;case"compositionend":ge="onCompositionEnd";break e;case"compositionupdate":ge="onCompositionUpdate";break e}ge=void 0}else Ay?J7(e,r)&&(ge="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(ge="onCompositionStart");ge&&(Y7&&r.locale!=="ko"&&(Ay||ge!=="onCompositionStart"?ge==="onCompositionEnd"&&Ay&&(le=X7()):(Jd=T,rL="value"in Jd?Jd.value:Jd.textContent,Ay=!0)),ae=V2(w,ge),0<ae.length&&(ge=new v4(ge,e,null,r,T),I.push({event:ge,listeners:ae}),le?ge.data=le:(le=Q7(r),le!==null&&(ge.data=le)))),(le=jae?Rae(e,r):Dae(e,r))&&(w=V2(w,"onBeforeInput"),0<w.length&&(T=new v4("onBeforeInput","beforeinput",null,r,T),I.push({event:T,listeners:w}),T.data=le))}hW(I,t)})}function Vb(e,t,r){return{instance:e,listener:t,currentTarget:r}}function V2(e,t){for(var r=t+"Capture",n=[];e!==null;){var c=e,h=c.stateNode;c.tag===5&&h!==null&&(c=h,h=Rb(e,r),h!=null&&n.unshift(Vb(e,h,c)),h=Rb(e,t),h!=null&&n.push(Vb(e,h,c))),e=e.return}return n}function sy(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function M4(e,t,r,n,c){for(var h=t._reactName,p=[];r!==null&&r!==n;){var s=r,v=s.alternate,w=s.stateNode;if(v!==null&&v===n)break;s.tag===5&&w!==null&&(s=w,c?(v=Rb(r,h),v!=null&&p.unshift(Vb(r,v,s))):c||(v=Rb(r,h),v!=null&&p.push(Vb(r,v,s)))),r=r.return}p.length!==0&&e.push({event:t,listeners:p})}var Kae=/\r\n?/g,Xae=/\u0000|\uFFFD/g;function O4(e){return(typeof e=="string"?e:""+e).replace(Kae,`
`).replace(Xae,"")}function wT(e,t,r){if(t=O4(t),O4(e)!==t&&r)throw Error(cr(425))}function U2(){}var AO=null,kO=null;function PO(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var CO=typeof setTimeout=="function"?setTimeout:void 0,Yae=typeof clearTimeout=="function"?clearTimeout:void 0,j4=typeof Promise=="function"?Promise:void 0,Jae=typeof queueMicrotask=="function"?queueMicrotask:typeof j4<"u"?function(e){return j4.resolve(null).then(e).catch(Qae)}:CO;function Qae(e){setTimeout(function(){throw e})}function RI(e,t){var r=t,n=0;do{var c=r.nextSibling;if(e.removeChild(r),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(n===0){e.removeChild(c),zb(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=c}while(r);zb(t)}function of(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function R4(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var X_=Math.random().toString(36).slice(2),hu="__reactFiber$"+X_,Ub="__reactProps$"+X_,Sh="__reactContainer$"+X_,IO="__reactEvents$"+X_,ele="__reactListeners$"+X_,tle="__reactHandles$"+X_;function Xp(e){var t=e[hu];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Sh]||r[hu]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=R4(e);e!==null;){if(r=e[hu])return r;e=R4(e)}return t}e=r,r=e.parentNode}return null}function Gw(e){return e=e[hu]||e[Sh],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Cy(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(cr(33))}function MA(e){return e[Ub]||null}var MO=[],Iy=-1;function xf(e){return{current:e}}function ls(e){0>Iy||(e.current=MO[Iy],MO[Iy]=null,Iy--)}function Qi(e,t){Iy++,MO[Iy]=e.current,e.current=t}var mf={},ta=xf(mf),Ga=xf(!1),dm=mf;function u_(e,t){var r=e.type.contextTypes;if(!r)return mf;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var c={},h;for(h in r)c[h]=t[h];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=c),c}function Ha(e){return e=e.childContextTypes,e!=null}function $2(){ls(Ga),ls(ta)}function D4(e,t,r){if(ta.current!==mf)throw Error(cr(168));Qi(ta,t),Qi(Ga,r)}function fW(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var c in n)if(!(c in t))throw Error(cr(108,Foe(e)||"Unknown",c));return ys({},r,n)}function G2(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||mf,dm=ta.current,Qi(ta,e),Qi(Ga,Ga.current),!0}function L4(e,t,r){var n=e.stateNode;if(!n)throw Error(cr(169));r?(e=fW(e,t,dm),n.__reactInternalMemoizedMergedChildContext=e,ls(Ga),ls(ta),Qi(ta,e)):ls(Ga),Qi(Ga,r)}var dh=null,OA=!1,DI=!1;function pW(e){dh===null?dh=[e]:dh.push(e)}function rle(e){OA=!0,pW(e)}function bf(){if(!DI&&dh!==null){DI=!0;var e=0,t=zi;try{var r=dh;for(zi=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}dh=null,OA=!1}catch(c){throw dh!==null&&(dh=dh.slice(e+1)),F7(JD,bf),c}finally{zi=t,DI=!1}}return null}var My=[],Oy=0,H2=null,W2=0,Cl=[],Il=0,fm=null,ph=1,mh="";function Fp(e,t){My[Oy++]=W2,My[Oy++]=H2,H2=e,W2=t}function mW(e,t,r){Cl[Il++]=ph,Cl[Il++]=mh,Cl[Il++]=fm,fm=e;var n=ph;e=mh;var c=32-gc(n)-1;n&=~(1<<c),r+=1;var h=32-gc(t)+c;if(30<h){var p=c-c%5;h=(n&(1<<p)-1).toString(32),n>>=p,c-=p,ph=1<<32-gc(t)+c|r<<c|n,mh=h+e}else ph=1<<h|r<<c|n,mh=e}function aL(e){e.return!==null&&(Fp(e,1),mW(e,1,0))}function lL(e){for(;e===H2;)H2=My[--Oy],My[Oy]=null,W2=My[--Oy],My[Oy]=null;for(;e===fm;)fm=Cl[--Il],Cl[Il]=null,mh=Cl[--Il],Cl[Il]=null,ph=Cl[--Il],Cl[Il]=null}var hl=null,ul=null,hs=!1,pc=null;function gW(e,t){var r=Ol(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function z4(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,hl=e,ul=of(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,hl=e,ul=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=fm!==null?{id:ph,overflow:mh}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Ol(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,hl=e,ul=null,!0):!1;default:return!1}}function OO(e){return(e.mode&1)!==0&&(e.flags&128)===0}function jO(e){if(hs){var t=ul;if(t){var r=t;if(!z4(e,t)){if(OO(e))throw Error(cr(418));t=of(r.nextSibling);var n=hl;t&&z4(e,t)?gW(n,r):(e.flags=e.flags&-4097|2,hs=!1,hl=e)}}else{if(OO(e))throw Error(cr(418));e.flags=e.flags&-4097|2,hs=!1,hl=e}}}function N4(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;hl=e}function ST(e){if(e!==hl)return!1;if(!hs)return N4(e),hs=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!PO(e.type,e.memoizedProps)),t&&(t=ul)){if(OO(e))throw yW(),Error(cr(418));for(;t;)gW(e,t),t=of(t.nextSibling)}if(N4(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(cr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){ul=of(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}ul=null}}else ul=hl?of(e.stateNode.nextSibling):null;return!0}function yW(){for(var e=ul;e;)e=of(e.nextSibling)}function h_(){ul=hl=null,hs=!1}function cL(e){pc===null?pc=[e]:pc.push(e)}var nle=Nh.ReactCurrentBatchConfig;function Sx(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(cr(309));var n=r.stateNode}if(!n)throw Error(cr(147,e));var c=n,h=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===h?t.ref:(t=function(p){var s=c.refs;p===null?delete s[h]:s[h]=p},t._stringRef=h,t)}if(typeof e!="string")throw Error(cr(284));if(!r._owner)throw Error(cr(290,e))}return e}function TT(e,t){throw e=Object.prototype.toString.call(t),Error(cr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function F4(e){var t=e._init;return t(e._payload)}function _W(e){function t(U,V){if(e){var X=U.deletions;X===null?(U.deletions=[V],U.flags|=16):X.push(V)}}function r(U,V){if(!e)return null;for(;V!==null;)t(U,V),V=V.sibling;return null}function n(U,V){for(U=new Map;V!==null;)V.key!==null?U.set(V.key,V):U.set(V.index,V),V=V.sibling;return U}function c(U,V){return U=uf(U,V),U.index=0,U.sibling=null,U}function h(U,V,X){return U.index=X,e?(X=U.alternate,X!==null?(X=X.index,X<V?(U.flags|=2,V):X):(U.flags|=2,V)):(U.flags|=1048576,V)}function p(U){return e&&U.alternate===null&&(U.flags|=2),U}function s(U,V,X,Y){return V===null||V.tag!==6?(V=UI(X,U.mode,Y),V.return=U,V):(V=c(V,X),V.return=U,V)}function v(U,V,X,Y){var ne=X.type;return ne===Ey?T(U,V,X.props.children,Y,X.key):V!==null&&(V.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===$d&&F4(ne)===V.type)?(Y=c(V,X.props),Y.ref=Sx(U,V,X),Y.return=U,Y):(Y=b2(X.type,X.key,X.props,null,U.mode,Y),Y.ref=Sx(U,V,X),Y.return=U,Y)}function w(U,V,X,Y){return V===null||V.tag!==4||V.stateNode.containerInfo!==X.containerInfo||V.stateNode.implementation!==X.implementation?(V=$I(X,U.mode,Y),V.return=U,V):(V=c(V,X.children||[]),V.return=U,V)}function T(U,V,X,Y,ne){return V===null||V.tag!==7?(V=om(X,U.mode,Y,ne),V.return=U,V):(V=c(V,X),V.return=U,V)}function I(U,V,X){if(typeof V=="string"&&V!==""||typeof V=="number")return V=UI(""+V,U.mode,X),V.return=U,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case fT:return X=b2(V.type,V.key,V.props,null,U.mode,X),X.ref=Sx(U,null,V),X.return=U,X;case Ty:return V=$I(V,U.mode,X),V.return=U,V;case $d:var Y=V._init;return I(U,Y(V._payload),X)}if(Jx(V)||_x(V))return V=om(V,U.mode,X,null),V.return=U,V;TT(U,V)}return null}function O(U,V,X,Y){var ne=V!==null?V.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return ne!==null?null:s(U,V,""+X,Y);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case fT:return X.key===ne?v(U,V,X,Y):null;case Ty:return X.key===ne?w(U,V,X,Y):null;case $d:return ne=X._init,O(U,V,ne(X._payload),Y)}if(Jx(X)||_x(X))return ne!==null?null:T(U,V,X,Y,null);TT(U,X)}return null}function D(U,V,X,Y,ne){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return U=U.get(X)||null,s(V,U,""+Y,ne);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case fT:return U=U.get(Y.key===null?X:Y.key)||null,v(V,U,Y,ne);case Ty:return U=U.get(Y.key===null?X:Y.key)||null,w(V,U,Y,ne);case $d:var ae=Y._init;return D(U,V,X,ae(Y._payload),ne)}if(Jx(Y)||_x(Y))return U=U.get(X)||null,T(V,U,Y,ne,null);TT(V,Y)}return null}function B(U,V,X,Y){for(var ne=null,ae=null,le=V,ge=V=0,je=null;le!==null&&ge<X.length;ge++){le.index>ge?(je=le,le=null):je=le.sibling;var ze=O(U,le,X[ge],Y);if(ze===null){le===null&&(le=je);break}e&&le&&ze.alternate===null&&t(U,le),V=h(ze,V,ge),ae===null?ne=ze:ae.sibling=ze,ae=ze,le=je}if(ge===X.length)return r(U,le),hs&&Fp(U,ge),ne;if(le===null){for(;ge<X.length;ge++)le=I(U,X[ge],Y),le!==null&&(V=h(le,V,ge),ae===null?ne=le:ae.sibling=le,ae=le);return hs&&Fp(U,ge),ne}for(le=n(U,le);ge<X.length;ge++)je=D(le,U,ge,X[ge],Y),je!==null&&(e&&je.alternate!==null&&le.delete(je.key===null?ge:je.key),V=h(je,V,ge),ae===null?ne=je:ae.sibling=je,ae=je);return e&&le.forEach(function(Pe){return t(U,Pe)}),hs&&Fp(U,ge),ne}function N(U,V,X,Y){var ne=_x(X);if(typeof ne!="function")throw Error(cr(150));if(X=ne.call(X),X==null)throw Error(cr(151));for(var ae=ne=null,le=V,ge=V=0,je=null,ze=X.next();le!==null&&!ze.done;ge++,ze=X.next()){le.index>ge?(je=le,le=null):je=le.sibling;var Pe=O(U,le,ze.value,Y);if(Pe===null){le===null&&(le=je);break}e&&le&&Pe.alternate===null&&t(U,le),V=h(Pe,V,ge),ae===null?ne=Pe:ae.sibling=Pe,ae=Pe,le=je}if(ze.done)return r(U,le),hs&&Fp(U,ge),ne;if(le===null){for(;!ze.done;ge++,ze=X.next())ze=I(U,ze.value,Y),ze!==null&&(V=h(ze,V,ge),ae===null?ne=ze:ae.sibling=ze,ae=ze);return hs&&Fp(U,ge),ne}for(le=n(U,le);!ze.done;ge++,ze=X.next())ze=D(le,U,ge,ze.value,Y),ze!==null&&(e&&ze.alternate!==null&&le.delete(ze.key===null?ge:ze.key),V=h(ze,V,ge),ae===null?ne=ze:ae.sibling=ze,ae=ze);return e&&le.forEach(function(Ke){return t(U,Ke)}),hs&&Fp(U,ge),ne}function G(U,V,X,Y){if(typeof X=="object"&&X!==null&&X.type===Ey&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case fT:e:{for(var ne=X.key,ae=V;ae!==null;){if(ae.key===ne){if(ne=X.type,ne===Ey){if(ae.tag===7){r(U,ae.sibling),V=c(ae,X.props.children),V.return=U,U=V;break e}}else if(ae.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===$d&&F4(ne)===ae.type){r(U,ae.sibling),V=c(ae,X.props),V.ref=Sx(U,ae,X),V.return=U,U=V;break e}r(U,ae);break}else t(U,ae);ae=ae.sibling}X.type===Ey?(V=om(X.props.children,U.mode,Y,X.key),V.return=U,U=V):(Y=b2(X.type,X.key,X.props,null,U.mode,Y),Y.ref=Sx(U,V,X),Y.return=U,U=Y)}return p(U);case Ty:e:{for(ae=X.key;V!==null;){if(V.key===ae)if(V.tag===4&&V.stateNode.containerInfo===X.containerInfo&&V.stateNode.implementation===X.implementation){r(U,V.sibling),V=c(V,X.children||[]),V.return=U,U=V;break e}else{r(U,V);break}else t(U,V);V=V.sibling}V=$I(X,U.mode,Y),V.return=U,U=V}return p(U);case $d:return ae=X._init,G(U,V,ae(X._payload),Y)}if(Jx(X))return B(U,V,X,Y);if(_x(X))return N(U,V,X,Y);TT(U,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,V!==null&&V.tag===6?(r(U,V.sibling),V=c(V,X),V.return=U,U=V):(r(U,V),V=UI(X,U.mode,Y),V.return=U,U=V),p(U)):r(U,V)}return G}var d_=_W(!0),vW=_W(!1),q2=xf(null),Z2=null,jy=null,uL=null;function hL(){uL=jy=Z2=null}function dL(e){var t=q2.current;ls(q2),e._currentValue=t}function RO(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Xy(e,t){Z2=e,uL=jy=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Va=!0),e.firstContext=null)}function zl(e){var t=e._currentValue;if(uL!==e)if(e={context:e,memoizedValue:t,next:null},jy===null){if(Z2===null)throw Error(cr(308));jy=e,Z2.dependencies={lanes:0,firstContext:e}}else jy=jy.next=e;return t}var Yp=null;function fL(e){Yp===null?Yp=[e]:Yp.push(e)}function xW(e,t,r,n){var c=t.interleaved;return c===null?(r.next=r,fL(t)):(r.next=c.next,c.next=r),t.interleaved=r,Th(e,n)}function Th(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Gd=!1;function pL(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bW(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function vh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function af(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,xi&2){var c=n.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),n.pending=t,Th(e,r)}return c=n.interleaved,c===null?(t.next=t,fL(n)):(t.next=c.next,c.next=t),n.interleaved=t,Th(e,r)}function m2(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,QD(e,r)}}function B4(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var c=null,h=null;if(r=r.firstBaseUpdate,r!==null){do{var p={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};h===null?c=h=p:h=h.next=p,r=r.next}while(r!==null);h===null?c=h=t:h=h.next=t}else c=h=t;r={baseState:n.baseState,firstBaseUpdate:c,lastBaseUpdate:h,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function K2(e,t,r,n){var c=e.updateQueue;Gd=!1;var h=c.firstBaseUpdate,p=c.lastBaseUpdate,s=c.shared.pending;if(s!==null){c.shared.pending=null;var v=s,w=v.next;v.next=null,p===null?h=w:p.next=w,p=v;var T=e.alternate;T!==null&&(T=T.updateQueue,s=T.lastBaseUpdate,s!==p&&(s===null?T.firstBaseUpdate=w:s.next=w,T.lastBaseUpdate=v))}if(h!==null){var I=c.baseState;p=0,T=w=v=null,s=h;do{var O=s.lane,D=s.eventTime;if((n&O)===O){T!==null&&(T=T.next={eventTime:D,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var B=e,N=s;switch(O=t,D=r,N.tag){case 1:if(B=N.payload,typeof B=="function"){I=B.call(D,I,O);break e}I=B;break e;case 3:B.flags=B.flags&-65537|128;case 0:if(B=N.payload,O=typeof B=="function"?B.call(D,I,O):B,O==null)break e;I=ys({},I,O);break e;case 2:Gd=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,O=c.effects,O===null?c.effects=[s]:O.push(s))}else D={eventTime:D,lane:O,tag:s.tag,payload:s.payload,callback:s.callback,next:null},T===null?(w=T=D,v=I):T=T.next=D,p|=O;if(s=s.next,s===null){if(s=c.shared.pending,s===null)break;O=s,s=O.next,O.next=null,c.lastBaseUpdate=O,c.shared.pending=null}}while(!0);if(T===null&&(v=I),c.baseState=v,c.firstBaseUpdate=w,c.lastBaseUpdate=T,t=c.shared.interleaved,t!==null){c=t;do p|=c.lane,c=c.next;while(c!==t)}else h===null&&(c.shared.lanes=0);mm|=p,e.lanes=p,e.memoizedState=I}}function V4(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],c=n.callback;if(c!==null){if(n.callback=null,n=r,typeof c!="function")throw Error(cr(191,c));c.call(n)}}}var Hw={},_u=xf(Hw),$b=xf(Hw),Gb=xf(Hw);function Jp(e){if(e===Hw)throw Error(cr(174));return e}function mL(e,t){switch(Qi(Gb,t),Qi($b,e),Qi(_u,Hw),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:pO(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=pO(t,e)}ls(_u),Qi(_u,t)}function f_(){ls(_u),ls($b),ls(Gb)}function wW(e){Jp(Gb.current);var t=Jp(_u.current),r=pO(t,e.type);t!==r&&(Qi($b,e),Qi(_u,r))}function gL(e){$b.current===e&&(ls(_u),ls($b))}var ps=xf(0);function X2(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var LI=[];function yL(){for(var e=0;e<LI.length;e++)LI[e]._workInProgressVersionPrimary=null;LI.length=0}var g2=Nh.ReactCurrentDispatcher,zI=Nh.ReactCurrentBatchConfig,pm=0,gs=null,to=null,yo=null,Y2=!1,db=!1,Hb=0,ile=0;function qo(){throw Error(cr(321))}function _L(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!vc(e[r],t[r]))return!1;return!0}function vL(e,t,r,n,c,h){if(pm=h,gs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,g2.current=e===null||e.memoizedState===null?lle:cle,e=r(n,c),db){h=0;do{if(db=!1,Hb=0,25<=h)throw Error(cr(301));h+=1,yo=to=null,t.updateQueue=null,g2.current=ule,e=r(n,c)}while(db)}if(g2.current=J2,t=to!==null&&to.next!==null,pm=0,yo=to=gs=null,Y2=!1,t)throw Error(cr(300));return e}function xL(){var e=Hb!==0;return Hb=0,e}function cu(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yo===null?gs.memoizedState=yo=e:yo=yo.next=e,yo}function Nl(){if(to===null){var e=gs.alternate;e=e!==null?e.memoizedState:null}else e=to.next;var t=yo===null?gs.memoizedState:yo.next;if(t!==null)yo=t,to=e;else{if(e===null)throw Error(cr(310));to=e,e={memoizedState:to.memoizedState,baseState:to.baseState,baseQueue:to.baseQueue,queue:to.queue,next:null},yo===null?gs.memoizedState=yo=e:yo=yo.next=e}return yo}function Wb(e,t){return typeof t=="function"?t(e):t}function NI(e){var t=Nl(),r=t.queue;if(r===null)throw Error(cr(311));r.lastRenderedReducer=e;var n=to,c=n.baseQueue,h=r.pending;if(h!==null){if(c!==null){var p=c.next;c.next=h.next,h.next=p}n.baseQueue=c=h,r.pending=null}if(c!==null){h=c.next,n=n.baseState;var s=p=null,v=null,w=h;do{var T=w.lane;if((pm&T)===T)v!==null&&(v=v.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),n=w.hasEagerState?w.eagerState:e(n,w.action);else{var I={lane:T,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};v===null?(s=v=I,p=n):v=v.next=I,gs.lanes|=T,mm|=T}w=w.next}while(w!==null&&w!==h);v===null?p=n:v.next=s,vc(n,t.memoizedState)||(Va=!0),t.memoizedState=n,t.baseState=p,t.baseQueue=v,r.lastRenderedState=n}if(e=r.interleaved,e!==null){c=e;do h=c.lane,gs.lanes|=h,mm|=h,c=c.next;while(c!==e)}else c===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function FI(e){var t=Nl(),r=t.queue;if(r===null)throw Error(cr(311));r.lastRenderedReducer=e;var n=r.dispatch,c=r.pending,h=t.memoizedState;if(c!==null){r.pending=null;var p=c=c.next;do h=e(h,p.action),p=p.next;while(p!==c);vc(h,t.memoizedState)||(Va=!0),t.memoizedState=h,t.baseQueue===null&&(t.baseState=h),r.lastRenderedState=h}return[h,n]}function SW(){}function TW(e,t){var r=gs,n=Nl(),c=t(),h=!vc(n.memoizedState,c);if(h&&(n.memoizedState=c,Va=!0),n=n.queue,bL(kW.bind(null,r,n,e),[e]),n.getSnapshot!==t||h||yo!==null&&yo.memoizedState.tag&1){if(r.flags|=2048,qb(9,AW.bind(null,r,n,c,t),void 0,null),vo===null)throw Error(cr(349));pm&30||EW(r,t,c)}return c}function EW(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=gs.updateQueue,t===null?(t={lastEffect:null,stores:null},gs.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function AW(e,t,r,n){t.value=r,t.getSnapshot=n,PW(t)&&CW(e)}function kW(e,t,r){return r(function(){PW(t)&&CW(e)})}function PW(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!vc(e,r)}catch{return!0}}function CW(e){var t=Th(e,1);t!==null&&yc(t,e,1,-1)}function U4(e){var t=cu();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wb,lastRenderedState:e},t.queue=e,e=e.dispatch=ale.bind(null,gs,e),[t.memoizedState,e]}function qb(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=gs.updateQueue,t===null?(t={lastEffect:null,stores:null},gs.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function IW(){return Nl().memoizedState}function y2(e,t,r,n){var c=cu();gs.flags|=e,c.memoizedState=qb(1|t,r,void 0,n===void 0?null:n)}function jA(e,t,r,n){var c=Nl();n=n===void 0?null:n;var h=void 0;if(to!==null){var p=to.memoizedState;if(h=p.destroy,n!==null&&_L(n,p.deps)){c.memoizedState=qb(t,r,h,n);return}}gs.flags|=e,c.memoizedState=qb(1|t,r,h,n)}function $4(e,t){return y2(8390656,8,e,t)}function bL(e,t){return jA(2048,8,e,t)}function MW(e,t){return jA(4,2,e,t)}function OW(e,t){return jA(4,4,e,t)}function jW(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function RW(e,t,r){return r=r!=null?r.concat([e]):null,jA(4,4,jW.bind(null,t,e),r)}function wL(){}function DW(e,t){var r=Nl();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&_L(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function LW(e,t){var r=Nl();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&_L(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function zW(e,t,r){return pm&21?(vc(r,t)||(r=U7(),gs.lanes|=r,mm|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Va=!0),e.memoizedState=r)}function sle(e,t){var r=zi;zi=r!==0&&4>r?r:4,e(!0);var n=zI.transition;zI.transition={};try{e(!1),t()}finally{zi=r,zI.transition=n}}function NW(){return Nl().memoizedState}function ole(e,t,r){var n=cf(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},FW(e))BW(t,r);else if(r=xW(e,t,r,n),r!==null){var c=xa();yc(r,e,n,c),VW(r,t,n)}}function ale(e,t,r){var n=cf(e),c={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(FW(e))BW(t,c);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=t.lastRenderedReducer,h!==null))try{var p=t.lastRenderedState,s=h(p,r);if(c.hasEagerState=!0,c.eagerState=s,vc(s,p)){var v=t.interleaved;v===null?(c.next=c,fL(t)):(c.next=v.next,v.next=c),t.interleaved=c;return}}catch{}finally{}r=xW(e,t,c,n),r!==null&&(c=xa(),yc(r,e,n,c),VW(r,t,n))}}function FW(e){var t=e.alternate;return e===gs||t!==null&&t===gs}function BW(e,t){db=Y2=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function VW(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,QD(e,r)}}var J2={readContext:zl,useCallback:qo,useContext:qo,useEffect:qo,useImperativeHandle:qo,useInsertionEffect:qo,useLayoutEffect:qo,useMemo:qo,useReducer:qo,useRef:qo,useState:qo,useDebugValue:qo,useDeferredValue:qo,useTransition:qo,useMutableSource:qo,useSyncExternalStore:qo,useId:qo,unstable_isNewReconciler:!1},lle={readContext:zl,useCallback:function(e,t){return cu().memoizedState=[e,t===void 0?null:t],e},useContext:zl,useEffect:$4,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,y2(4194308,4,jW.bind(null,t,e),r)},useLayoutEffect:function(e,t){return y2(4194308,4,e,t)},useInsertionEffect:function(e,t){return y2(4,2,e,t)},useMemo:function(e,t){var r=cu();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=cu();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=ole.bind(null,gs,e),[n.memoizedState,e]},useRef:function(e){var t=cu();return e={current:e},t.memoizedState=e},useState:U4,useDebugValue:wL,useDeferredValue:function(e){return cu().memoizedState=e},useTransition:function(){var e=U4(!1),t=e[0];return e=sle.bind(null,e[1]),cu().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=gs,c=cu();if(hs){if(r===void 0)throw Error(cr(407));r=r()}else{if(r=t(),vo===null)throw Error(cr(349));pm&30||EW(n,t,r)}c.memoizedState=r;var h={value:r,getSnapshot:t};return c.queue=h,$4(kW.bind(null,n,h,e),[e]),n.flags|=2048,qb(9,AW.bind(null,n,h,r,t),void 0,null),r},useId:function(){var e=cu(),t=vo.identifierPrefix;if(hs){var r=mh,n=ph;r=(n&~(1<<32-gc(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=Hb++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=ile++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},cle={readContext:zl,useCallback:DW,useContext:zl,useEffect:bL,useImperativeHandle:RW,useInsertionEffect:MW,useLayoutEffect:OW,useMemo:LW,useReducer:NI,useRef:IW,useState:function(){return NI(Wb)},useDebugValue:wL,useDeferredValue:function(e){var t=Nl();return zW(t,to.memoizedState,e)},useTransition:function(){var e=NI(Wb)[0],t=Nl().memoizedState;return[e,t]},useMutableSource:SW,useSyncExternalStore:TW,useId:NW,unstable_isNewReconciler:!1},ule={readContext:zl,useCallback:DW,useContext:zl,useEffect:bL,useImperativeHandle:RW,useInsertionEffect:MW,useLayoutEffect:OW,useMemo:LW,useReducer:FI,useRef:IW,useState:function(){return FI(Wb)},useDebugValue:wL,useDeferredValue:function(e){var t=Nl();return to===null?t.memoizedState=e:zW(t,to.memoizedState,e)},useTransition:function(){var e=FI(Wb)[0],t=Nl().memoizedState;return[e,t]},useMutableSource:SW,useSyncExternalStore:TW,useId:NW,unstable_isNewReconciler:!1};function cc(e,t){if(e&&e.defaultProps){t=ys({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function DO(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:ys({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var RA={isMounted:function(e){return(e=e._reactInternals)?Mm(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=xa(),c=cf(e),h=vh(n,c);h.payload=t,r!=null&&(h.callback=r),t=af(e,h,c),t!==null&&(yc(t,e,c,n),m2(t,e,c))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=xa(),c=cf(e),h=vh(n,c);h.tag=1,h.payload=t,r!=null&&(h.callback=r),t=af(e,h,c),t!==null&&(yc(t,e,c,n),m2(t,e,c))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=xa(),n=cf(e),c=vh(r,n);c.tag=2,t!=null&&(c.callback=t),t=af(e,c,n),t!==null&&(yc(t,e,n,r),m2(t,e,n))}};function G4(e,t,r,n,c,h,p){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,h,p):t.prototype&&t.prototype.isPureReactComponent?!Fb(r,n)||!Fb(c,h):!0}function UW(e,t,r){var n=!1,c=mf,h=t.contextType;return typeof h=="object"&&h!==null?h=zl(h):(c=Ha(t)?dm:ta.current,n=t.contextTypes,h=(n=n!=null)?u_(e,c):mf),t=new t(r,h),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=RA,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=c,e.__reactInternalMemoizedMaskedChildContext=h),t}function H4(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&RA.enqueueReplaceState(t,t.state,null)}function LO(e,t,r,n){var c=e.stateNode;c.props=r,c.state=e.memoizedState,c.refs={},pL(e);var h=t.contextType;typeof h=="object"&&h!==null?c.context=zl(h):(h=Ha(t)?dm:ta.current,c.context=u_(e,h)),c.state=e.memoizedState,h=t.getDerivedStateFromProps,typeof h=="function"&&(DO(e,t,h,r),c.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(t=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),t!==c.state&&RA.enqueueReplaceState(c,c.state,null),K2(e,r,c,n),c.state=e.memoizedState),typeof c.componentDidMount=="function"&&(e.flags|=4194308)}function p_(e,t){try{var r="",n=t;do r+=Noe(n),n=n.return;while(n);var c=r}catch(h){c=`
Error generating stack: `+h.message+`
`+h.stack}return{value:e,source:t,stack:c,digest:null}}function BI(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function zO(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var hle=typeof WeakMap=="function"?WeakMap:Map;function $W(e,t,r){r=vh(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){eE||(eE=!0,WO=n),zO(e,t)},r}function GW(e,t,r){r=vh(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var c=t.value;r.payload=function(){return n(c)},r.callback=function(){zO(e,t)}}var h=e.stateNode;return h!==null&&typeof h.componentDidCatch=="function"&&(r.callback=function(){zO(e,t),typeof n!="function"&&(lf===null?lf=new Set([this]):lf.add(this));var p=t.stack;this.componentDidCatch(t.value,{componentStack:p!==null?p:""})}),r}function W4(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new hle;var c=new Set;n.set(t,c)}else c=n.get(t),c===void 0&&(c=new Set,n.set(t,c));c.has(r)||(c.add(r),e=Ele.bind(null,e,t,r),t.then(e,e))}function q4(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Z4(e,t,r,n,c){return e.mode&1?(e.flags|=65536,e.lanes=c,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=vh(-1,1),t.tag=2,af(r,t,1))),r.lanes|=1),e)}var dle=Nh.ReactCurrentOwner,Va=!1;function fa(e,t,r,n){t.child=e===null?vW(t,null,r,n):d_(t,e.child,r,n)}function K4(e,t,r,n,c){r=r.render;var h=t.ref;return Xy(t,c),n=vL(e,t,r,n,h,c),r=xL(),e!==null&&!Va?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Eh(e,t,c)):(hs&&r&&aL(t),t.flags|=1,fa(e,t,n,c),t.child)}function X4(e,t,r,n,c){if(e===null){var h=r.type;return typeof h=="function"&&!IL(h)&&h.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=h,HW(e,t,h,n,c)):(e=b2(r.type,null,n,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(h=e.child,!(e.lanes&c)){var p=h.memoizedProps;if(r=r.compare,r=r!==null?r:Fb,r(p,n)&&e.ref===t.ref)return Eh(e,t,c)}return t.flags|=1,e=uf(h,n),e.ref=t.ref,e.return=t,t.child=e}function HW(e,t,r,n,c){if(e!==null){var h=e.memoizedProps;if(Fb(h,n)&&e.ref===t.ref)if(Va=!1,t.pendingProps=n=h,(e.lanes&c)!==0)e.flags&131072&&(Va=!0);else return t.lanes=e.lanes,Eh(e,t,c)}return NO(e,t,r,n,c)}function WW(e,t,r){var n=t.pendingProps,c=n.children,h=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qi(Dy,sl),sl|=r;else{if(!(r&1073741824))return e=h!==null?h.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Qi(Dy,sl),sl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=h!==null?h.baseLanes:r,Qi(Dy,sl),sl|=n}else h!==null?(n=h.baseLanes|r,t.memoizedState=null):n=r,Qi(Dy,sl),sl|=n;return fa(e,t,c,r),t.child}function qW(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function NO(e,t,r,n,c){var h=Ha(r)?dm:ta.current;return h=u_(t,h),Xy(t,c),r=vL(e,t,r,n,h,c),n=xL(),e!==null&&!Va?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Eh(e,t,c)):(hs&&n&&aL(t),t.flags|=1,fa(e,t,r,c),t.child)}function Y4(e,t,r,n,c){if(Ha(r)){var h=!0;G2(t)}else h=!1;if(Xy(t,c),t.stateNode===null)_2(e,t),UW(t,r,n),LO(t,r,n,c),n=!0;else if(e===null){var p=t.stateNode,s=t.memoizedProps;p.props=s;var v=p.context,w=r.contextType;typeof w=="object"&&w!==null?w=zl(w):(w=Ha(r)?dm:ta.current,w=u_(t,w));var T=r.getDerivedStateFromProps,I=typeof T=="function"||typeof p.getSnapshotBeforeUpdate=="function";I||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(s!==n||v!==w)&&H4(t,p,n,w),Gd=!1;var O=t.memoizedState;p.state=O,K2(t,n,p,c),v=t.memoizedState,s!==n||O!==v||Ga.current||Gd?(typeof T=="function"&&(DO(t,r,T,n),v=t.memoizedState),(s=Gd||G4(t,r,s,n,O,v,w))?(I||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(t.flags|=4194308)):(typeof p.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=v),p.props=n,p.state=v,p.context=w,n=s):(typeof p.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{p=t.stateNode,bW(e,t),s=t.memoizedProps,w=t.type===t.elementType?s:cc(t.type,s),p.props=w,I=t.pendingProps,O=p.context,v=r.contextType,typeof v=="object"&&v!==null?v=zl(v):(v=Ha(r)?dm:ta.current,v=u_(t,v));var D=r.getDerivedStateFromProps;(T=typeof D=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(s!==I||O!==v)&&H4(t,p,n,v),Gd=!1,O=t.memoizedState,p.state=O,K2(t,n,p,c);var B=t.memoizedState;s!==I||O!==B||Ga.current||Gd?(typeof D=="function"&&(DO(t,r,D,n),B=t.memoizedState),(w=Gd||G4(t,r,w,n,O,B,v)||!1)?(T||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(n,B,v),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(n,B,v)),typeof p.componentDidUpdate=="function"&&(t.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof p.componentDidUpdate!="function"||s===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=B),p.props=n,p.state=B,p.context=v,n=w):(typeof p.componentDidUpdate!="function"||s===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),n=!1)}return FO(e,t,r,n,h,c)}function FO(e,t,r,n,c,h){qW(e,t);var p=(t.flags&128)!==0;if(!n&&!p)return c&&L4(t,r,!1),Eh(e,t,h);n=t.stateNode,dle.current=t;var s=p&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&p?(t.child=d_(t,e.child,null,h),t.child=d_(t,null,s,h)):fa(e,t,s,h),t.memoizedState=n.state,c&&L4(t,r,!0),t.child}function ZW(e){var t=e.stateNode;t.pendingContext?D4(e,t.pendingContext,t.pendingContext!==t.context):t.context&&D4(e,t.context,!1),mL(e,t.containerInfo)}function J4(e,t,r,n,c){return h_(),cL(c),t.flags|=256,fa(e,t,r,n),t.child}var BO={dehydrated:null,treeContext:null,retryLane:0};function VO(e){return{baseLanes:e,cachePool:null,transitions:null}}function KW(e,t,r){var n=t.pendingProps,c=ps.current,h=!1,p=(t.flags&128)!==0,s;if((s=p)||(s=e!==null&&e.memoizedState===null?!1:(c&2)!==0),s?(h=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(c|=1),Qi(ps,c&1),e===null)return jO(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(p=n.children,e=n.fallback,h?(n=t.mode,h=t.child,p={mode:"hidden",children:p},!(n&1)&&h!==null?(h.childLanes=0,h.pendingProps=p):h=zA(p,n,0,null),e=om(e,n,r,null),h.return=t,e.return=t,h.sibling=e,t.child=h,t.child.memoizedState=VO(r),t.memoizedState=BO,e):SL(t,p));if(c=e.memoizedState,c!==null&&(s=c.dehydrated,s!==null))return fle(e,t,p,n,s,c,r);if(h){h=n.fallback,p=t.mode,c=e.child,s=c.sibling;var v={mode:"hidden",children:n.children};return!(p&1)&&t.child!==c?(n=t.child,n.childLanes=0,n.pendingProps=v,t.deletions=null):(n=uf(c,v),n.subtreeFlags=c.subtreeFlags&14680064),s!==null?h=uf(s,h):(h=om(h,p,r,null),h.flags|=2),h.return=t,n.return=t,n.sibling=h,t.child=n,n=h,h=t.child,p=e.child.memoizedState,p=p===null?VO(r):{baseLanes:p.baseLanes|r,cachePool:null,transitions:p.transitions},h.memoizedState=p,h.childLanes=e.childLanes&~r,t.memoizedState=BO,n}return h=e.child,e=h.sibling,n=uf(h,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function SL(e,t){return t=zA({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function ET(e,t,r,n){return n!==null&&cL(n),d_(t,e.child,null,r),e=SL(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function fle(e,t,r,n,c,h,p){if(r)return t.flags&256?(t.flags&=-257,n=BI(Error(cr(422))),ET(e,t,p,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(h=n.fallback,c=t.mode,n=zA({mode:"visible",children:n.children},c,0,null),h=om(h,c,p,null),h.flags|=2,n.return=t,h.return=t,n.sibling=h,t.child=n,t.mode&1&&d_(t,e.child,null,p),t.child.memoizedState=VO(p),t.memoizedState=BO,h);if(!(t.mode&1))return ET(e,t,p,null);if(c.data==="$!"){if(n=c.nextSibling&&c.nextSibling.dataset,n)var s=n.dgst;return n=s,h=Error(cr(419)),n=BI(h,n,void 0),ET(e,t,p,n)}if(s=(p&e.childLanes)!==0,Va||s){if(n=vo,n!==null){switch(p&-p){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(n.suspendedLanes|p)?0:c,c!==0&&c!==h.retryLane&&(h.retryLane=c,Th(e,c),yc(n,e,c,-1))}return CL(),n=BI(Error(cr(421))),ET(e,t,p,n)}return c.data==="$?"?(t.flags|=128,t.child=e.child,t=Ale.bind(null,e),c._reactRetry=t,null):(e=h.treeContext,ul=of(c.nextSibling),hl=t,hs=!0,pc=null,e!==null&&(Cl[Il++]=ph,Cl[Il++]=mh,Cl[Il++]=fm,ph=e.id,mh=e.overflow,fm=t),t=SL(t,n.children),t.flags|=4096,t)}function Q4(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),RO(e.return,t,r)}function VI(e,t,r,n,c){var h=e.memoizedState;h===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:c}:(h.isBackwards=t,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=r,h.tailMode=c)}function XW(e,t,r){var n=t.pendingProps,c=n.revealOrder,h=n.tail;if(fa(e,t,n.children,r),n=ps.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Q4(e,r,t);else if(e.tag===19)Q4(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Qi(ps,n),!(t.mode&1))t.memoizedState=null;else switch(c){case"forwards":for(r=t.child,c=null;r!==null;)e=r.alternate,e!==null&&X2(e)===null&&(c=r),r=r.sibling;r=c,r===null?(c=t.child,t.child=null):(c=r.sibling,r.sibling=null),VI(t,!1,c,r,h);break;case"backwards":for(r=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&X2(e)===null){t.child=c;break}e=c.sibling,c.sibling=r,r=c,c=e}VI(t,!0,r,null,h);break;case"together":VI(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function _2(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Eh(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),mm|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(cr(153));if(t.child!==null){for(e=t.child,r=uf(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=uf(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function ple(e,t,r){switch(t.tag){case 3:ZW(t),h_();break;case 5:wW(t);break;case 1:Ha(t.type)&&G2(t);break;case 4:mL(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,c=t.memoizedProps.value;Qi(q2,n._currentValue),n._currentValue=c;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Qi(ps,ps.current&1),t.flags|=128,null):r&t.child.childLanes?KW(e,t,r):(Qi(ps,ps.current&1),e=Eh(e,t,r),e!==null?e.sibling:null);Qi(ps,ps.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return XW(e,t,r);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Qi(ps,ps.current),n)break;return null;case 22:case 23:return t.lanes=0,WW(e,t,r)}return Eh(e,t,r)}var YW,UO,JW,QW;YW=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};UO=function(){};JW=function(e,t,r,n){var c=e.memoizedProps;if(c!==n){e=t.stateNode,Jp(_u.current);var h=null;switch(r){case"input":c=uO(e,c),n=uO(e,n),h=[];break;case"select":c=ys({},c,{value:void 0}),n=ys({},n,{value:void 0}),h=[];break;case"textarea":c=fO(e,c),n=fO(e,n),h=[];break;default:typeof c.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=U2)}mO(r,n);var p;r=null;for(w in c)if(!n.hasOwnProperty(w)&&c.hasOwnProperty(w)&&c[w]!=null)if(w==="style"){var s=c[w];for(p in s)s.hasOwnProperty(p)&&(r||(r={}),r[p]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Ob.hasOwnProperty(w)?h||(h=[]):(h=h||[]).push(w,null));for(w in n){var v=n[w];if(s=c?.[w],n.hasOwnProperty(w)&&v!==s&&(v!=null||s!=null))if(w==="style")if(s){for(p in s)!s.hasOwnProperty(p)||v&&v.hasOwnProperty(p)||(r||(r={}),r[p]="");for(p in v)v.hasOwnProperty(p)&&s[p]!==v[p]&&(r||(r={}),r[p]=v[p])}else r||(h||(h=[]),h.push(w,r)),r=v;else w==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,s=s?s.__html:void 0,v!=null&&s!==v&&(h=h||[]).push(w,v)):w==="children"?typeof v!="string"&&typeof v!="number"||(h=h||[]).push(w,""+v):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(Ob.hasOwnProperty(w)?(v!=null&&w==="onScroll"&&is("scroll",e),h||s===v||(h=[])):(h=h||[]).push(w,v))}r&&(h=h||[]).push("style",r);var w=h;(t.updateQueue=w)&&(t.flags|=4)}};QW=function(e,t,r,n){r!==n&&(t.flags|=4)};function Tx(e,t){if(!hs)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Zo(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var c=e.child;c!==null;)r|=c.lanes|c.childLanes,n|=c.subtreeFlags&14680064,n|=c.flags&14680064,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)r|=c.lanes|c.childLanes,n|=c.subtreeFlags,n|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function mle(e,t,r){var n=t.pendingProps;switch(lL(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zo(t),null;case 1:return Ha(t.type)&&$2(),Zo(t),null;case 3:return n=t.stateNode,f_(),ls(Ga),ls(ta),yL(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(ST(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,pc!==null&&(KO(pc),pc=null))),UO(e,t),Zo(t),null;case 5:gL(t);var c=Jp(Gb.current);if(r=t.type,e!==null&&t.stateNode!=null)JW(e,t,r,n,c),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(cr(166));return Zo(t),null}if(e=Jp(_u.current),ST(t)){n=t.stateNode,r=t.type;var h=t.memoizedProps;switch(n[hu]=t,n[Ub]=h,e=(t.mode&1)!==0,r){case"dialog":is("cancel",n),is("close",n);break;case"iframe":case"object":case"embed":is("load",n);break;case"video":case"audio":for(c=0;c<eb.length;c++)is(eb[c],n);break;case"source":is("error",n);break;case"img":case"image":case"link":is("error",n),is("load",n);break;case"details":is("toggle",n);break;case"input":l4(n,h),is("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!h.multiple},is("invalid",n);break;case"textarea":u4(n,h),is("invalid",n)}mO(r,h),c=null;for(var p in h)if(h.hasOwnProperty(p)){var s=h[p];p==="children"?typeof s=="string"?n.textContent!==s&&(h.suppressHydrationWarning!==!0&&wT(n.textContent,s,e),c=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(h.suppressHydrationWarning!==!0&&wT(n.textContent,s,e),c=["children",""+s]):Ob.hasOwnProperty(p)&&s!=null&&p==="onScroll"&&is("scroll",n)}switch(r){case"input":pT(n),c4(n,h,!0);break;case"textarea":pT(n),h4(n);break;case"select":case"option":break;default:typeof h.onClick=="function"&&(n.onclick=U2)}n=c,t.updateQueue=n,n!==null&&(t.flags|=4)}else{p=c.nodeType===9?c:c.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=k7(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=p.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=p.createElement(r,{is:n.is}):(e=p.createElement(r),r==="select"&&(p=e,n.multiple?p.multiple=!0:n.size&&(p.size=n.size))):e=p.createElementNS(e,r),e[hu]=t,e[Ub]=n,YW(e,t,!1,!1),t.stateNode=e;e:{switch(p=gO(r,n),r){case"dialog":is("cancel",e),is("close",e),c=n;break;case"iframe":case"object":case"embed":is("load",e),c=n;break;case"video":case"audio":for(c=0;c<eb.length;c++)is(eb[c],e);c=n;break;case"source":is("error",e),c=n;break;case"img":case"image":case"link":is("error",e),is("load",e),c=n;break;case"details":is("toggle",e),c=n;break;case"input":l4(e,n),c=uO(e,n),is("invalid",e);break;case"option":c=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},c=ys({},n,{value:void 0}),is("invalid",e);break;case"textarea":u4(e,n),c=fO(e,n),is("invalid",e);break;default:c=n}mO(r,c),s=c;for(h in s)if(s.hasOwnProperty(h)){var v=s[h];h==="style"?I7(e,v):h==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&P7(e,v)):h==="children"?typeof v=="string"?(r!=="textarea"||v!=="")&&jb(e,v):typeof v=="number"&&jb(e,""+v):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(Ob.hasOwnProperty(h)?v!=null&&h==="onScroll"&&is("scroll",e):v!=null&&qD(e,h,v,p))}switch(r){case"input":pT(e),c4(e,n,!1);break;case"textarea":pT(e),h4(e);break;case"option":n.value!=null&&e.setAttribute("value",""+pf(n.value));break;case"select":e.multiple=!!n.multiple,h=n.value,h!=null?Wy(e,!!n.multiple,h,!1):n.defaultValue!=null&&Wy(e,!!n.multiple,n.defaultValue,!0);break;default:typeof c.onClick=="function"&&(e.onclick=U2)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Zo(t),null;case 6:if(e&&t.stateNode!=null)QW(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(cr(166));if(r=Jp(Gb.current),Jp(_u.current),ST(t)){if(n=t.stateNode,r=t.memoizedProps,n[hu]=t,(h=n.nodeValue!==r)&&(e=hl,e!==null))switch(e.tag){case 3:wT(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&wT(n.nodeValue,r,(e.mode&1)!==0)}h&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[hu]=t,t.stateNode=n}return Zo(t),null;case 13:if(ls(ps),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(hs&&ul!==null&&t.mode&1&&!(t.flags&128))yW(),h_(),t.flags|=98560,h=!1;else if(h=ST(t),n!==null&&n.dehydrated!==null){if(e===null){if(!h)throw Error(cr(318));if(h=t.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(cr(317));h[hu]=t}else h_(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Zo(t),h=!1}else pc!==null&&(KO(pc),pc=null),h=!0;if(!h)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||ps.current&1?no===0&&(no=3):CL())),t.updateQueue!==null&&(t.flags|=4),Zo(t),null);case 4:return f_(),UO(e,t),e===null&&Bb(t.stateNode.containerInfo),Zo(t),null;case 10:return dL(t.type._context),Zo(t),null;case 17:return Ha(t.type)&&$2(),Zo(t),null;case 19:if(ls(ps),h=t.memoizedState,h===null)return Zo(t),null;if(n=(t.flags&128)!==0,p=h.rendering,p===null)if(n)Tx(h,!1);else{if(no!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(p=X2(e),p!==null){for(t.flags|=128,Tx(h,!1),n=p.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)h=r,e=n,h.flags&=14680066,p=h.alternate,p===null?(h.childLanes=0,h.lanes=e,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=p.childLanes,h.lanes=p.lanes,h.child=p.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=p.memoizedProps,h.memoizedState=p.memoizedState,h.updateQueue=p.updateQueue,h.type=p.type,e=p.dependencies,h.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Qi(ps,ps.current&1|2),t.child}e=e.sibling}h.tail!==null&&js()>m_&&(t.flags|=128,n=!0,Tx(h,!1),t.lanes=4194304)}else{if(!n)if(e=X2(p),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Tx(h,!0),h.tail===null&&h.tailMode==="hidden"&&!p.alternate&&!hs)return Zo(t),null}else 2*js()-h.renderingStartTime>m_&&r!==1073741824&&(t.flags|=128,n=!0,Tx(h,!1),t.lanes=4194304);h.isBackwards?(p.sibling=t.child,t.child=p):(r=h.last,r!==null?r.sibling=p:t.child=p,h.last=p)}return h.tail!==null?(t=h.tail,h.rendering=t,h.tail=t.sibling,h.renderingStartTime=js(),t.sibling=null,r=ps.current,Qi(ps,n?r&1|2:r&1),t):(Zo(t),null);case 22:case 23:return PL(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?sl&1073741824&&(Zo(t),t.subtreeFlags&6&&(t.flags|=8192)):Zo(t),null;case 24:return null;case 25:return null}throw Error(cr(156,t.tag))}function gle(e,t){switch(lL(t),t.tag){case 1:return Ha(t.type)&&$2(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return f_(),ls(Ga),ls(ta),yL(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return gL(t),null;case 13:if(ls(ps),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(cr(340));h_()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ls(ps),null;case 4:return f_(),null;case 10:return dL(t.type._context),null;case 22:case 23:return PL(),null;case 24:return null;default:return null}}var AT=!1,Xo=!1,yle=typeof WeakSet=="function"?WeakSet:Set,Dr=null;function Ry(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Es(e,t,n)}else r.current=null}function eq(e,t,r){try{r()}catch(n){Es(e,t,n)}}var e6=!1;function _le(e,t){if(AO=F2,e=iW(),oL(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var c=n.anchorOffset,h=n.focusNode;n=n.focusOffset;try{r.nodeType,h.nodeType}catch{r=null;break e}var p=0,s=-1,v=-1,w=0,T=0,I=e,O=null;t:for(;;){for(var D;I!==r||c!==0&&I.nodeType!==3||(s=p+c),I!==h||n!==0&&I.nodeType!==3||(v=p+n),I.nodeType===3&&(p+=I.nodeValue.length),(D=I.firstChild)!==null;)O=I,I=D;for(;;){if(I===e)break t;if(O===r&&++w===c&&(s=p),O===h&&++T===n&&(v=p),(D=I.nextSibling)!==null)break;I=O,O=I.parentNode}I=D}r=s===-1||v===-1?null:{start:s,end:v}}else r=null}r=r||{start:0,end:0}}else r=null;for(kO={focusedElem:e,selectionRange:r},F2=!1,Dr=t;Dr!==null;)if(t=Dr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Dr=e;else for(;Dr!==null;){t=Dr;try{var B=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var N=B.memoizedProps,G=B.memoizedState,U=t.stateNode,V=U.getSnapshotBeforeUpdate(t.elementType===t.type?N:cc(t.type,N),G);U.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var X=t.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(cr(163))}}catch(Y){Es(t,t.return,Y)}if(e=t.sibling,e!==null){e.return=t.return,Dr=e;break}Dr=t.return}return B=e6,e6=!1,B}function fb(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var c=n=n.next;do{if((c.tag&e)===e){var h=c.destroy;c.destroy=void 0,h!==void 0&&eq(t,r,h)}c=c.next}while(c!==n)}}function DA(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function $O(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function tq(e){var t=e.alternate;t!==null&&(e.alternate=null,tq(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[hu],delete t[Ub],delete t[IO],delete t[ele],delete t[tle])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function rq(e){return e.tag===5||e.tag===3||e.tag===4}function t6(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||rq(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function GO(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=U2));else if(n!==4&&(e=e.child,e!==null))for(GO(e,t,r),e=e.sibling;e!==null;)GO(e,t,r),e=e.sibling}function HO(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(HO(e,t,r),e=e.sibling;e!==null;)HO(e,t,r),e=e.sibling}var Do=null,hc=!1;function Rd(e,t,r){for(r=r.child;r!==null;)nq(e,t,r),r=r.sibling}function nq(e,t,r){if(yu&&typeof yu.onCommitFiberUnmount=="function")try{yu.onCommitFiberUnmount(kA,r)}catch{}switch(r.tag){case 5:Xo||Ry(r,t);case 6:var n=Do,c=hc;Do=null,Rd(e,t,r),Do=n,hc=c,Do!==null&&(hc?(e=Do,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Do.removeChild(r.stateNode));break;case 18:Do!==null&&(hc?(e=Do,r=r.stateNode,e.nodeType===8?RI(e.parentNode,r):e.nodeType===1&&RI(e,r),zb(e)):RI(Do,r.stateNode));break;case 4:n=Do,c=hc,Do=r.stateNode.containerInfo,hc=!0,Rd(e,t,r),Do=n,hc=c;break;case 0:case 11:case 14:case 15:if(!Xo&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){c=n=n.next;do{var h=c,p=h.destroy;h=h.tag,p!==void 0&&(h&2||h&4)&&eq(r,t,p),c=c.next}while(c!==n)}Rd(e,t,r);break;case 1:if(!Xo&&(Ry(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){Es(r,t,s)}Rd(e,t,r);break;case 21:Rd(e,t,r);break;case 22:r.mode&1?(Xo=(n=Xo)||r.memoizedState!==null,Rd(e,t,r),Xo=n):Rd(e,t,r);break;default:Rd(e,t,r)}}function r6(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new yle),t.forEach(function(n){var c=kle.bind(null,e,n);r.has(n)||(r.add(n),n.then(c,c))})}}function rc(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var c=r[n];try{var h=e,p=t,s=p;e:for(;s!==null;){switch(s.tag){case 5:Do=s.stateNode,hc=!1;break e;case 3:Do=s.stateNode.containerInfo,hc=!0;break e;case 4:Do=s.stateNode.containerInfo,hc=!0;break e}s=s.return}if(Do===null)throw Error(cr(160));nq(h,p,c),Do=null,hc=!1;var v=c.alternate;v!==null&&(v.return=null),c.return=null}catch(w){Es(c,t,w)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)iq(t,e),t=t.sibling}function iq(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(rc(t,e),ou(e),n&4){try{fb(3,e,e.return),DA(3,e)}catch(N){Es(e,e.return,N)}try{fb(5,e,e.return)}catch(N){Es(e,e.return,N)}}break;case 1:rc(t,e),ou(e),n&512&&r!==null&&Ry(r,r.return);break;case 5:if(rc(t,e),ou(e),n&512&&r!==null&&Ry(r,r.return),e.flags&32){var c=e.stateNode;try{jb(c,"")}catch(N){Es(e,e.return,N)}}if(n&4&&(c=e.stateNode,c!=null)){var h=e.memoizedProps,p=r!==null?r.memoizedProps:h,s=e.type,v=e.updateQueue;if(e.updateQueue=null,v!==null)try{s==="input"&&h.type==="radio"&&h.name!=null&&E7(c,h),gO(s,p);var w=gO(s,h);for(p=0;p<v.length;p+=2){var T=v[p],I=v[p+1];T==="style"?I7(c,I):T==="dangerouslySetInnerHTML"?P7(c,I):T==="children"?jb(c,I):qD(c,T,I,w)}switch(s){case"input":hO(c,h);break;case"textarea":A7(c,h);break;case"select":var O=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!h.multiple;var D=h.value;D!=null?Wy(c,!!h.multiple,D,!1):O!==!!h.multiple&&(h.defaultValue!=null?Wy(c,!!h.multiple,h.defaultValue,!0):Wy(c,!!h.multiple,h.multiple?[]:"",!1))}c[Ub]=h}catch(N){Es(e,e.return,N)}}break;case 6:if(rc(t,e),ou(e),n&4){if(e.stateNode===null)throw Error(cr(162));c=e.stateNode,h=e.memoizedProps;try{c.nodeValue=h}catch(N){Es(e,e.return,N)}}break;case 3:if(rc(t,e),ou(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{zb(t.containerInfo)}catch(N){Es(e,e.return,N)}break;case 4:rc(t,e),ou(e);break;case 13:rc(t,e),ou(e),c=e.child,c.flags&8192&&(h=c.memoizedState!==null,c.stateNode.isHidden=h,!h||c.alternate!==null&&c.alternate.memoizedState!==null||(AL=js())),n&4&&r6(e);break;case 22:if(T=r!==null&&r.memoizedState!==null,e.mode&1?(Xo=(w=Xo)||T,rc(t,e),Xo=w):rc(t,e),ou(e),n&8192){if(w=e.memoizedState!==null,(e.stateNode.isHidden=w)&&!T&&e.mode&1)for(Dr=e,T=e.child;T!==null;){for(I=Dr=T;Dr!==null;){switch(O=Dr,D=O.child,O.tag){case 0:case 11:case 14:case 15:fb(4,O,O.return);break;case 1:Ry(O,O.return);var B=O.stateNode;if(typeof B.componentWillUnmount=="function"){n=O,r=O.return;try{t=n,B.props=t.memoizedProps,B.state=t.memoizedState,B.componentWillUnmount()}catch(N){Es(n,r,N)}}break;case 5:Ry(O,O.return);break;case 22:if(O.memoizedState!==null){i6(I);continue}}D!==null?(D.return=O,Dr=D):i6(I)}T=T.sibling}e:for(T=null,I=e;;){if(I.tag===5){if(T===null){T=I;try{c=I.stateNode,w?(h=c.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none"):(s=I.stateNode,v=I.memoizedProps.style,p=v!=null&&v.hasOwnProperty("display")?v.display:null,s.style.display=C7("display",p))}catch(N){Es(e,e.return,N)}}}else if(I.tag===6){if(T===null)try{I.stateNode.nodeValue=w?"":I.memoizedProps}catch(N){Es(e,e.return,N)}}else if((I.tag!==22&&I.tag!==23||I.memoizedState===null||I===e)&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===e)break e;for(;I.sibling===null;){if(I.return===null||I.return===e)break e;T===I&&(T=null),I=I.return}T===I&&(T=null),I.sibling.return=I.return,I=I.sibling}}break;case 19:rc(t,e),ou(e),n&4&&r6(e);break;case 21:break;default:rc(t,e),ou(e)}}function ou(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(rq(r)){var n=r;break e}r=r.return}throw Error(cr(160))}switch(n.tag){case 5:var c=n.stateNode;n.flags&32&&(jb(c,""),n.flags&=-33);var h=t6(e);HO(e,h,c);break;case 3:case 4:var p=n.stateNode.containerInfo,s=t6(e);GO(e,s,p);break;default:throw Error(cr(161))}}catch(v){Es(e,e.return,v)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function vle(e,t,r){Dr=e,sq(e)}function sq(e,t,r){for(var n=(e.mode&1)!==0;Dr!==null;){var c=Dr,h=c.child;if(c.tag===22&&n){var p=c.memoizedState!==null||AT;if(!p){var s=c.alternate,v=s!==null&&s.memoizedState!==null||Xo;s=AT;var w=Xo;if(AT=p,(Xo=v)&&!w)for(Dr=c;Dr!==null;)p=Dr,v=p.child,p.tag===22&&p.memoizedState!==null?s6(c):v!==null?(v.return=p,Dr=v):s6(c);for(;h!==null;)Dr=h,sq(h),h=h.sibling;Dr=c,AT=s,Xo=w}n6(e)}else c.subtreeFlags&8772&&h!==null?(h.return=c,Dr=h):n6(e)}}function n6(e){for(;Dr!==null;){var t=Dr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Xo||DA(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Xo)if(r===null)n.componentDidMount();else{var c=t.elementType===t.type?r.memoizedProps:cc(t.type,r.memoizedProps);n.componentDidUpdate(c,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var h=t.updateQueue;h!==null&&V4(t,h,n);break;case 3:var p=t.updateQueue;if(p!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}V4(t,p,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var v=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&r.focus();break;case"img":v.src&&(r.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var w=t.alternate;if(w!==null){var T=w.memoizedState;if(T!==null){var I=T.dehydrated;I!==null&&zb(I)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(cr(163))}Xo||t.flags&512&&$O(t)}catch(O){Es(t,t.return,O)}}if(t===e){Dr=null;break}if(r=t.sibling,r!==null){r.return=t.return,Dr=r;break}Dr=t.return}}function i6(e){for(;Dr!==null;){var t=Dr;if(t===e){Dr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Dr=r;break}Dr=t.return}}function s6(e){for(;Dr!==null;){var t=Dr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{DA(4,t)}catch(v){Es(t,r,v)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var c=t.return;try{n.componentDidMount()}catch(v){Es(t,c,v)}}var h=t.return;try{$O(t)}catch(v){Es(t,h,v)}break;case 5:var p=t.return;try{$O(t)}catch(v){Es(t,p,v)}}}catch(v){Es(t,t.return,v)}if(t===e){Dr=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Dr=s;break}Dr=t.return}}var xle=Math.ceil,Q2=Nh.ReactCurrentDispatcher,TL=Nh.ReactCurrentOwner,Rl=Nh.ReactCurrentBatchConfig,xi=0,vo=null,Bs=null,No=0,sl=0,Dy=xf(0),no=0,Zb=null,mm=0,LA=0,EL=0,pb=null,Fa=null,AL=0,m_=1/0,ch=null,eE=!1,WO=null,lf=null,kT=!1,Qd=null,tE=0,mb=0,qO=null,v2=-1,x2=0;function xa(){return xi&6?js():v2!==-1?v2:v2=js()}function cf(e){return e.mode&1?xi&2&&No!==0?No&-No:nle.transition!==null?(x2===0&&(x2=U7()),x2):(e=zi,e!==0||(e=window.event,e=e===void 0?16:K7(e.type)),e):1}function yc(e,t,r,n){if(50<mb)throw mb=0,qO=null,Error(cr(185));Uw(e,r,n),(!(xi&2)||e!==vo)&&(e===vo&&(!(xi&2)&&(LA|=r),no===4&&Kd(e,No)),Wa(e,n),r===1&&xi===0&&!(t.mode&1)&&(m_=js()+500,OA&&bf()))}function Wa(e,t){var r=e.callbackNode;nae(e,t);var n=N2(e,e===vo?No:0);if(n===0)r!==null&&p4(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&p4(r),t===1)e.tag===0?rle(o6.bind(null,e)):pW(o6.bind(null,e)),Jae(function(){!(xi&6)&&bf()}),r=null;else{switch($7(n)){case 1:r=JD;break;case 4:r=B7;break;case 16:r=z2;break;case 536870912:r=V7;break;default:r=z2}r=fq(r,oq.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function oq(e,t){if(v2=-1,x2=0,xi&6)throw Error(cr(327));var r=e.callbackNode;if(Yy()&&e.callbackNode!==r)return null;var n=N2(e,e===vo?No:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=rE(e,n);else{t=n;var c=xi;xi|=2;var h=lq();(vo!==e||No!==t)&&(ch=null,m_=js()+500,sm(e,t));do try{Sle();break}catch(s){aq(e,s)}while(!0);hL(),Q2.current=h,xi=c,Bs!==null?t=0:(vo=null,No=0,t=no)}if(t!==0){if(t===2&&(c=bO(e),c!==0&&(n=c,t=ZO(e,c))),t===1)throw r=Zb,sm(e,0),Kd(e,n),Wa(e,js()),r;if(t===6)Kd(e,n);else{if(c=e.current.alternate,!(n&30)&&!ble(c)&&(t=rE(e,n),t===2&&(h=bO(e),h!==0&&(n=h,t=ZO(e,h))),t===1))throw r=Zb,sm(e,0),Kd(e,n),Wa(e,js()),r;switch(e.finishedWork=c,e.finishedLanes=n,t){case 0:case 1:throw Error(cr(345));case 2:Bp(e,Fa,ch);break;case 3:if(Kd(e,n),(n&130023424)===n&&(t=AL+500-js(),10<t)){if(N2(e,0)!==0)break;if(c=e.suspendedLanes,(c&n)!==n){xa(),e.pingedLanes|=e.suspendedLanes&c;break}e.timeoutHandle=CO(Bp.bind(null,e,Fa,ch),t);break}Bp(e,Fa,ch);break;case 4:if(Kd(e,n),(n&4194240)===n)break;for(t=e.eventTimes,c=-1;0<n;){var p=31-gc(n);h=1<<p,p=t[p],p>c&&(c=p),n&=~h}if(n=c,n=js()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*xle(n/1960))-n,10<n){e.timeoutHandle=CO(Bp.bind(null,e,Fa,ch),n);break}Bp(e,Fa,ch);break;case 5:Bp(e,Fa,ch);break;default:throw Error(cr(329))}}}return Wa(e,js()),e.callbackNode===r?oq.bind(null,e):null}function ZO(e,t){var r=pb;return e.current.memoizedState.isDehydrated&&(sm(e,t).flags|=256),e=rE(e,t),e!==2&&(t=Fa,Fa=r,t!==null&&KO(t)),e}function KO(e){Fa===null?Fa=e:Fa.push.apply(Fa,e)}function ble(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var c=r[n],h=c.getSnapshot;c=c.value;try{if(!vc(h(),c))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Kd(e,t){for(t&=~EL,t&=~LA,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-gc(t),n=1<<r;e[r]=-1,t&=~n}}function o6(e){if(xi&6)throw Error(cr(327));Yy();var t=N2(e,0);if(!(t&1))return Wa(e,js()),null;var r=rE(e,t);if(e.tag!==0&&r===2){var n=bO(e);n!==0&&(t=n,r=ZO(e,n))}if(r===1)throw r=Zb,sm(e,0),Kd(e,t),Wa(e,js()),r;if(r===6)throw Error(cr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Bp(e,Fa,ch),Wa(e,js()),null}function kL(e,t){var r=xi;xi|=1;try{return e(t)}finally{xi=r,xi===0&&(m_=js()+500,OA&&bf())}}function gm(e){Qd!==null&&Qd.tag===0&&!(xi&6)&&Yy();var t=xi;xi|=1;var r=Rl.transition,n=zi;try{if(Rl.transition=null,zi=1,e)return e()}finally{zi=n,Rl.transition=r,xi=t,!(xi&6)&&bf()}}function PL(){sl=Dy.current,ls(Dy)}function sm(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Yae(r)),Bs!==null)for(r=Bs.return;r!==null;){var n=r;switch(lL(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&$2();break;case 3:f_(),ls(Ga),ls(ta),yL();break;case 5:gL(n);break;case 4:f_();break;case 13:ls(ps);break;case 19:ls(ps);break;case 10:dL(n.type._context);break;case 22:case 23:PL()}r=r.return}if(vo=e,Bs=e=uf(e.current,null),No=sl=t,no=0,Zb=null,EL=LA=mm=0,Fa=pb=null,Yp!==null){for(t=0;t<Yp.length;t++)if(r=Yp[t],n=r.interleaved,n!==null){r.interleaved=null;var c=n.next,h=r.pending;if(h!==null){var p=h.next;h.next=c,n.next=p}r.pending=n}Yp=null}return e}function aq(e,t){do{var r=Bs;try{if(hL(),g2.current=J2,Y2){for(var n=gs.memoizedState;n!==null;){var c=n.queue;c!==null&&(c.pending=null),n=n.next}Y2=!1}if(pm=0,yo=to=gs=null,db=!1,Hb=0,TL.current=null,r===null||r.return===null){no=1,Zb=t,Bs=null;break}e:{var h=e,p=r.return,s=r,v=t;if(t=No,s.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var w=v,T=s,I=T.tag;if(!(T.mode&1)&&(I===0||I===11||I===15)){var O=T.alternate;O?(T.updateQueue=O.updateQueue,T.memoizedState=O.memoizedState,T.lanes=O.lanes):(T.updateQueue=null,T.memoizedState=null)}var D=q4(p);if(D!==null){D.flags&=-257,Z4(D,p,s,h,t),D.mode&1&&W4(h,w,t),t=D,v=w;var B=t.updateQueue;if(B===null){var N=new Set;N.add(v),t.updateQueue=N}else B.add(v);break e}else{if(!(t&1)){W4(h,w,t),CL();break e}v=Error(cr(426))}}else if(hs&&s.mode&1){var G=q4(p);if(G!==null){!(G.flags&65536)&&(G.flags|=256),Z4(G,p,s,h,t),cL(p_(v,s));break e}}h=v=p_(v,s),no!==4&&(no=2),pb===null?pb=[h]:pb.push(h),h=p;do{switch(h.tag){case 3:h.flags|=65536,t&=-t,h.lanes|=t;var U=$W(h,v,t);B4(h,U);break e;case 1:s=v;var V=h.type,X=h.stateNode;if(!(h.flags&128)&&(typeof V.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(lf===null||!lf.has(X)))){h.flags|=65536,t&=-t,h.lanes|=t;var Y=GW(h,s,t);B4(h,Y);break e}}h=h.return}while(h!==null)}uq(r)}catch(ne){t=ne,Bs===r&&r!==null&&(Bs=r=r.return);continue}break}while(!0)}function lq(){var e=Q2.current;return Q2.current=J2,e===null?J2:e}function CL(){(no===0||no===3||no===2)&&(no=4),vo===null||!(mm&268435455)&&!(LA&268435455)||Kd(vo,No)}function rE(e,t){var r=xi;xi|=2;var n=lq();(vo!==e||No!==t)&&(ch=null,sm(e,t));do try{wle();break}catch(c){aq(e,c)}while(!0);if(hL(),xi=r,Q2.current=n,Bs!==null)throw Error(cr(261));return vo=null,No=0,no}function wle(){for(;Bs!==null;)cq(Bs)}function Sle(){for(;Bs!==null&&!Zoe();)cq(Bs)}function cq(e){var t=dq(e.alternate,e,sl);e.memoizedProps=e.pendingProps,t===null?uq(e):Bs=t,TL.current=null}function uq(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=gle(r,t),r!==null){r.flags&=32767,Bs=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{no=6,Bs=null;return}}else if(r=mle(r,t,sl),r!==null){Bs=r;return}if(t=t.sibling,t!==null){Bs=t;return}Bs=t=e}while(t!==null);no===0&&(no=5)}function Bp(e,t,r){var n=zi,c=Rl.transition;try{Rl.transition=null,zi=1,Tle(e,t,r,n)}finally{Rl.transition=c,zi=n}return null}function Tle(e,t,r,n){do Yy();while(Qd!==null);if(xi&6)throw Error(cr(327));r=e.finishedWork;var c=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(cr(177));e.callbackNode=null,e.callbackPriority=0;var h=r.lanes|r.childLanes;if(iae(e,h),e===vo&&(Bs=vo=null,No=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||kT||(kT=!0,fq(z2,function(){return Yy(),null})),h=(r.flags&15990)!==0,r.subtreeFlags&15990||h){h=Rl.transition,Rl.transition=null;var p=zi;zi=1;var s=xi;xi|=4,TL.current=null,_le(e,r),iq(r,e),Gae(kO),F2=!!AO,kO=AO=null,e.current=r,vle(r),Koe(),xi=s,zi=p,Rl.transition=h}else e.current=r;if(kT&&(kT=!1,Qd=e,tE=c),h=e.pendingLanes,h===0&&(lf=null),Joe(r.stateNode),Wa(e,js()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)c=t[r],n(c.value,{componentStack:c.stack,digest:c.digest});if(eE)throw eE=!1,e=WO,WO=null,e;return tE&1&&e.tag!==0&&Yy(),h=e.pendingLanes,h&1?e===qO?mb++:(mb=0,qO=e):mb=0,bf(),null}function Yy(){if(Qd!==null){var e=$7(tE),t=Rl.transition,r=zi;try{if(Rl.transition=null,zi=16>e?16:e,Qd===null)var n=!1;else{if(e=Qd,Qd=null,tE=0,xi&6)throw Error(cr(331));var c=xi;for(xi|=4,Dr=e.current;Dr!==null;){var h=Dr,p=h.child;if(Dr.flags&16){var s=h.deletions;if(s!==null){for(var v=0;v<s.length;v++){var w=s[v];for(Dr=w;Dr!==null;){var T=Dr;switch(T.tag){case 0:case 11:case 15:fb(8,T,h)}var I=T.child;if(I!==null)I.return=T,Dr=I;else for(;Dr!==null;){T=Dr;var O=T.sibling,D=T.return;if(tq(T),T===w){Dr=null;break}if(O!==null){O.return=D,Dr=O;break}Dr=D}}}var B=h.alternate;if(B!==null){var N=B.child;if(N!==null){B.child=null;do{var G=N.sibling;N.sibling=null,N=G}while(N!==null)}}Dr=h}}if(h.subtreeFlags&2064&&p!==null)p.return=h,Dr=p;else e:for(;Dr!==null;){if(h=Dr,h.flags&2048)switch(h.tag){case 0:case 11:case 15:fb(9,h,h.return)}var U=h.sibling;if(U!==null){U.return=h.return,Dr=U;break e}Dr=h.return}}var V=e.current;for(Dr=V;Dr!==null;){p=Dr;var X=p.child;if(p.subtreeFlags&2064&&X!==null)X.return=p,Dr=X;else e:for(p=V;Dr!==null;){if(s=Dr,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:DA(9,s)}}catch(ne){Es(s,s.return,ne)}if(s===p){Dr=null;break e}var Y=s.sibling;if(Y!==null){Y.return=s.return,Dr=Y;break e}Dr=s.return}}if(xi=c,bf(),yu&&typeof yu.onPostCommitFiberRoot=="function")try{yu.onPostCommitFiberRoot(kA,e)}catch{}n=!0}return n}finally{zi=r,Rl.transition=t}}return!1}function a6(e,t,r){t=p_(r,t),t=$W(e,t,1),e=af(e,t,1),t=xa(),e!==null&&(Uw(e,1,t),Wa(e,t))}function Es(e,t,r){if(e.tag===3)a6(e,e,r);else for(;t!==null;){if(t.tag===3){a6(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(lf===null||!lf.has(n))){e=p_(r,e),e=GW(t,e,1),t=af(t,e,1),e=xa(),t!==null&&(Uw(t,1,e),Wa(t,e));break}}t=t.return}}function Ele(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=xa(),e.pingedLanes|=e.suspendedLanes&r,vo===e&&(No&r)===r&&(no===4||no===3&&(No&130023424)===No&&500>js()-AL?sm(e,0):EL|=r),Wa(e,t)}function hq(e,t){t===0&&(e.mode&1?(t=yT,yT<<=1,!(yT&130023424)&&(yT=4194304)):t=1);var r=xa();e=Th(e,t),e!==null&&(Uw(e,t,r),Wa(e,r))}function Ale(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),hq(e,r)}function kle(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,c=e.memoizedState;c!==null&&(r=c.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(cr(314))}n!==null&&n.delete(t),hq(e,r)}var dq;dq=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ga.current)Va=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Va=!1,ple(e,t,r);Va=!!(e.flags&131072)}else Va=!1,hs&&t.flags&1048576&&mW(t,W2,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;_2(e,t),e=t.pendingProps;var c=u_(t,ta.current);Xy(t,r),c=vL(null,t,n,e,c,r);var h=xL();return t.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ha(n)?(h=!0,G2(t)):h=!1,t.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,pL(t),c.updater=RA,t.stateNode=c,c._reactInternals=t,LO(t,n,e,r),t=FO(null,t,n,!0,h,r)):(t.tag=0,hs&&h&&aL(t),fa(null,t,c,r),t=t.child),t;case 16:n=t.elementType;e:{switch(_2(e,t),e=t.pendingProps,c=n._init,n=c(n._payload),t.type=n,c=t.tag=Cle(n),e=cc(n,e),c){case 0:t=NO(null,t,n,e,r);break e;case 1:t=Y4(null,t,n,e,r);break e;case 11:t=K4(null,t,n,e,r);break e;case 14:t=X4(null,t,n,cc(n.type,e),r);break e}throw Error(cr(306,n,""))}return t;case 0:return n=t.type,c=t.pendingProps,c=t.elementType===n?c:cc(n,c),NO(e,t,n,c,r);case 1:return n=t.type,c=t.pendingProps,c=t.elementType===n?c:cc(n,c),Y4(e,t,n,c,r);case 3:e:{if(ZW(t),e===null)throw Error(cr(387));n=t.pendingProps,h=t.memoizedState,c=h.element,bW(e,t),K2(t,n,null,r);var p=t.memoizedState;if(n=p.element,h.isDehydrated)if(h={element:n,isDehydrated:!1,cache:p.cache,pendingSuspenseBoundaries:p.pendingSuspenseBoundaries,transitions:p.transitions},t.updateQueue.baseState=h,t.memoizedState=h,t.flags&256){c=p_(Error(cr(423)),t),t=J4(e,t,n,r,c);break e}else if(n!==c){c=p_(Error(cr(424)),t),t=J4(e,t,n,r,c);break e}else for(ul=of(t.stateNode.containerInfo.firstChild),hl=t,hs=!0,pc=null,r=vW(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(h_(),n===c){t=Eh(e,t,r);break e}fa(e,t,n,r)}t=t.child}return t;case 5:return wW(t),e===null&&jO(t),n=t.type,c=t.pendingProps,h=e!==null?e.memoizedProps:null,p=c.children,PO(n,c)?p=null:h!==null&&PO(n,h)&&(t.flags|=32),qW(e,t),fa(e,t,p,r),t.child;case 6:return e===null&&jO(t),null;case 13:return KW(e,t,r);case 4:return mL(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=d_(t,null,n,r):fa(e,t,n,r),t.child;case 11:return n=t.type,c=t.pendingProps,c=t.elementType===n?c:cc(n,c),K4(e,t,n,c,r);case 7:return fa(e,t,t.pendingProps,r),t.child;case 8:return fa(e,t,t.pendingProps.children,r),t.child;case 12:return fa(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,c=t.pendingProps,h=t.memoizedProps,p=c.value,Qi(q2,n._currentValue),n._currentValue=p,h!==null)if(vc(h.value,p)){if(h.children===c.children&&!Ga.current){t=Eh(e,t,r);break e}}else for(h=t.child,h!==null&&(h.return=t);h!==null;){var s=h.dependencies;if(s!==null){p=h.child;for(var v=s.firstContext;v!==null;){if(v.context===n){if(h.tag===1){v=vh(-1,r&-r),v.tag=2;var w=h.updateQueue;if(w!==null){w=w.shared;var T=w.pending;T===null?v.next=v:(v.next=T.next,T.next=v),w.pending=v}}h.lanes|=r,v=h.alternate,v!==null&&(v.lanes|=r),RO(h.return,r,t),s.lanes|=r;break}v=v.next}}else if(h.tag===10)p=h.type===t.type?null:h.child;else if(h.tag===18){if(p=h.return,p===null)throw Error(cr(341));p.lanes|=r,s=p.alternate,s!==null&&(s.lanes|=r),RO(p,r,t),p=h.sibling}else p=h.child;if(p!==null)p.return=h;else for(p=h;p!==null;){if(p===t){p=null;break}if(h=p.sibling,h!==null){h.return=p.return,p=h;break}p=p.return}h=p}fa(e,t,c.children,r),t=t.child}return t;case 9:return c=t.type,n=t.pendingProps.children,Xy(t,r),c=zl(c),n=n(c),t.flags|=1,fa(e,t,n,r),t.child;case 14:return n=t.type,c=cc(n,t.pendingProps),c=cc(n.type,c),X4(e,t,n,c,r);case 15:return HW(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,c=t.pendingProps,c=t.elementType===n?c:cc(n,c),_2(e,t),t.tag=1,Ha(n)?(e=!0,G2(t)):e=!1,Xy(t,r),UW(t,n,c),LO(t,n,c,r),FO(null,t,n,!0,e,r);case 19:return XW(e,t,r);case 22:return WW(e,t,r)}throw Error(cr(156,t.tag))};function fq(e,t){return F7(e,t)}function Ple(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ol(e,t,r,n){return new Ple(e,t,r,n)}function IL(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Cle(e){if(typeof e=="function")return IL(e)?1:0;if(e!=null){if(e=e.$$typeof,e===KD)return 11;if(e===XD)return 14}return 2}function uf(e,t){var r=e.alternate;return r===null?(r=Ol(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function b2(e,t,r,n,c,h){var p=2;if(n=e,typeof e=="function")IL(e)&&(p=1);else if(typeof e=="string")p=5;else e:switch(e){case Ey:return om(r.children,c,h,t);case ZD:p=8,c|=8;break;case oO:return e=Ol(12,r,t,c|2),e.elementType=oO,e.lanes=h,e;case aO:return e=Ol(13,r,t,c),e.elementType=aO,e.lanes=h,e;case lO:return e=Ol(19,r,t,c),e.elementType=lO,e.lanes=h,e;case w7:return zA(r,c,h,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case x7:p=10;break e;case b7:p=9;break e;case KD:p=11;break e;case XD:p=14;break e;case $d:p=16,n=null;break e}throw Error(cr(130,e==null?e:typeof e,""))}return t=Ol(p,r,t,c),t.elementType=e,t.type=n,t.lanes=h,t}function om(e,t,r,n){return e=Ol(7,e,n,t),e.lanes=r,e}function zA(e,t,r,n){return e=Ol(22,e,n,t),e.elementType=w7,e.lanes=r,e.stateNode={isHidden:!1},e}function UI(e,t,r){return e=Ol(6,e,null,t),e.lanes=r,e}function $I(e,t,r){return t=Ol(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ile(e,t,r,n,c){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=SI(0),this.expirationTimes=SI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=SI(0),this.identifierPrefix=n,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function ML(e,t,r,n,c,h,p,s,v){return e=new Ile(e,t,r,s,v),t===1?(t=1,h===!0&&(t|=8)):t=0,h=Ol(3,null,null,t),e.current=h,h.stateNode=e,h.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},pL(h),e}function Mle(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ty,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function pq(e){if(!e)return mf;e=e._reactInternals;e:{if(Mm(e)!==e||e.tag!==1)throw Error(cr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ha(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(cr(171))}if(e.tag===1){var r=e.type;if(Ha(r))return fW(e,r,t)}return t}function mq(e,t,r,n,c,h,p,s,v){return e=ML(r,n,!0,e,c,h,p,s,v),e.context=pq(null),r=e.current,n=xa(),c=cf(r),h=vh(n,c),h.callback=t??null,af(r,h,c),e.current.lanes=c,Uw(e,c,n),Wa(e,n),e}function NA(e,t,r,n){var c=t.current,h=xa(),p=cf(c);return r=pq(r),t.context===null?t.context=r:t.pendingContext=r,t=vh(h,p),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=af(c,t,p),e!==null&&(yc(e,c,p,h),m2(e,c,p)),p}function nE(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function l6(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function OL(e,t){l6(e,t),(e=e.alternate)&&l6(e,t)}function Ole(){return null}var gq=typeof reportError=="function"?reportError:function(e){console.error(e)};function jL(e){this._internalRoot=e}FA.prototype.render=jL.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(cr(409));NA(e,t,null,null)};FA.prototype.unmount=jL.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;gm(function(){NA(null,e,null,null)}),t[Sh]=null}};function FA(e){this._internalRoot=e}FA.prototype.unstable_scheduleHydration=function(e){if(e){var t=W7();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Zd.length&&t!==0&&t<Zd[r].priority;r++);Zd.splice(r,0,e),r===0&&Z7(e)}};function RL(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function BA(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function c6(){}function jle(e,t,r,n,c){if(c){if(typeof n=="function"){var h=n;n=function(){var w=nE(p);h.call(w)}}var p=mq(t,n,e,0,null,!1,!1,"",c6);return e._reactRootContainer=p,e[Sh]=p.current,Bb(e.nodeType===8?e.parentNode:e),gm(),p}for(;c=e.lastChild;)e.removeChild(c);if(typeof n=="function"){var s=n;n=function(){var w=nE(v);s.call(w)}}var v=ML(e,0,!1,null,null,!1,!1,"",c6);return e._reactRootContainer=v,e[Sh]=v.current,Bb(e.nodeType===8?e.parentNode:e),gm(function(){NA(t,v,r,n)}),v}function VA(e,t,r,n,c){var h=r._reactRootContainer;if(h){var p=h;if(typeof c=="function"){var s=c;c=function(){var v=nE(p);s.call(v)}}NA(t,p,e,c)}else p=jle(r,t,e,c,n);return nE(p)}G7=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Qx(t.pendingLanes);r!==0&&(QD(t,r|1),Wa(t,js()),!(xi&6)&&(m_=js()+500,bf()))}break;case 13:gm(function(){var n=Th(e,1);if(n!==null){var c=xa();yc(n,e,1,c)}}),OL(e,1)}};eL=function(e){if(e.tag===13){var t=Th(e,134217728);if(t!==null){var r=xa();yc(t,e,134217728,r)}OL(e,134217728)}};H7=function(e){if(e.tag===13){var t=cf(e),r=Th(e,t);if(r!==null){var n=xa();yc(r,e,t,n)}OL(e,t)}};W7=function(){return zi};q7=function(e,t){var r=zi;try{return zi=e,t()}finally{zi=r}};_O=function(e,t,r){switch(t){case"input":if(hO(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var c=MA(n);if(!c)throw Error(cr(90));T7(n),hO(n,c)}}}break;case"textarea":A7(e,r);break;case"select":t=r.value,t!=null&&Wy(e,!!r.multiple,t,!1)}};j7=kL;R7=gm;var Rle={usingClientEntryPoint:!1,Events:[Gw,Cy,MA,M7,O7,kL]},Ex={findFiberByHostInstance:Xp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Dle={bundleType:Ex.bundleType,version:Ex.version,rendererPackageName:Ex.rendererPackageName,rendererConfig:Ex.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Nh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=z7(e),e===null?null:e.stateNode},findFiberByHostInstance:Ex.findFiberByHostInstance||Ole,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var PT=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!PT.isDisabled&&PT.supportsFiber)try{kA=PT.inject(Dle),yu=PT}catch{}}ml.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rle;ml.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!RL(t))throw Error(cr(200));return Mle(e,t,null,r)};ml.createRoot=function(e,t){if(!RL(e))throw Error(cr(299));var r=!1,n="",c=gq;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=ML(e,1,!1,null,null,r,!1,n,c),e[Sh]=t.current,Bb(e.nodeType===8?e.parentNode:e),new jL(t)};ml.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(cr(188)):(e=Object.keys(e).join(","),Error(cr(268,e)));return e=z7(t),e=e===null?null:e.stateNode,e};ml.flushSync=function(e){return gm(e)};ml.hydrate=function(e,t,r){if(!BA(t))throw Error(cr(200));return VA(null,e,t,!0,r)};ml.hydrateRoot=function(e,t,r){if(!RL(e))throw Error(cr(405));var n=r!=null&&r.hydratedSources||null,c=!1,h="",p=gq;if(r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),t=mq(t,null,e,1,r??null,c,!1,h,p),e[Sh]=t.current,Bb(e),n)for(e=0;e<n.length;e++)r=n[e],c=r._getVersion,c=c(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,c]:t.mutableSourceEagerHydrationData.push(r,c);return new FA(t)};ml.render=function(e,t,r){if(!BA(t))throw Error(cr(200));return VA(null,e,t,!1,r)};ml.unmountComponentAtNode=function(e){if(!BA(e))throw Error(cr(40));return e._reactRootContainer?(gm(function(){VA(null,null,e,!1,function(){e._reactRootContainer=null,e[Sh]=null})}),!0):!1};ml.unstable_batchedUpdates=kL;ml.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!BA(r))throw Error(cr(200));if(e==null||e._reactInternals===void 0)throw Error(cr(38));return VA(e,t,r,!1,n)};ml.version="18.3.1-next-f1338f8080-20240426";function yq(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(yq)}catch(e){console.error(e)}}yq(),g7.exports=ml;var Om=g7.exports;const _q=ki(Om);var vq,u6=Om;vq=u6.createRoot,u6.hydrateRoot;const Lle=1,zle=1e6;let GI=0;function Nle(){return GI=(GI+1)%Number.MAX_SAFE_INTEGER,GI.toString()}const HI=new Map,h6=e=>{if(HI.has(e))return;const t=setTimeout(()=>{HI.delete(e),gb({type:"REMOVE_TOAST",toastId:e})},zle);HI.set(e,t)},Fle=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,Lle)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?h6(r):e.toasts.forEach(n=>{h6(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},w2=[];let S2={toasts:[]};function gb(e){S2=Fle(S2,e),w2.forEach(t=>{t(S2)})}function XO({...e}){const t=Nle(),r=c=>gb({type:"UPDATE_TOAST",toast:{...c,id:t}}),n=()=>gb({type:"DISMISS_TOAST",toastId:t});return gb({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:c=>{c||n()}}}),{id:t,dismiss:n,update:r}}function DL(){const[e,t]=Z.useState(S2);return Z.useEffect(()=>(w2.push(t),()=>{const r=w2.indexOf(t);r>-1&&w2.splice(r,1)}),[e]),{...e,toast:XO,dismiss:r=>gb({type:"DISMISS_TOAST",toastId:r})}}function Zr(e,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(e?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}function d6(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function xq(...e){return t=>{let r=!1;const n=e.map(c=>{const h=d6(c,t);return!r&&typeof h=="function"&&(r=!0),h});if(r)return()=>{for(let c=0;c<n.length;c++){const h=n[c];typeof h=="function"?h():d6(e[c],null)}}}}function yi(...e){return Z.useCallback(xq(...e),e)}function Ble(e,t){const r=Z.createContext(t),n=h=>{const{children:p,...s}=h,v=Z.useMemo(()=>s,Object.values(s));return P.jsx(r.Provider,{value:v,children:p})};n.displayName=e+"Provider";function c(h){const p=Z.useContext(r);if(p)return p;if(t!==void 0)return t;throw new Error(`\`${h}\` must be used within \`${e}\``)}return[n,c]}function wc(e,t=[]){let r=[];function n(h,p){const s=Z.createContext(p),v=r.length;r=[...r,p];const w=I=>{const{scope:O,children:D,...B}=I,N=O?.[e]?.[v]||s,G=Z.useMemo(()=>B,Object.values(B));return P.jsx(N.Provider,{value:G,children:D})};w.displayName=h+"Provider";function T(I,O){const D=O?.[e]?.[v]||s,B=Z.useContext(D);if(B)return B;if(p!==void 0)return p;throw new Error(`\`${I}\` must be used within \`${h}\``)}return[w,T]}const c=()=>{const h=r.map(p=>Z.createContext(p));return function(p){const s=p?.[e]||h;return Z.useMemo(()=>({[`__scope${e}`]:{...p,[e]:s}}),[p,s])}};return c.scopeName=e,[n,Vle(c,...t)]}function Vle(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(c){const h=n.reduce((p,{useScope:s,scopeName:v})=>{const w=s(c)[`__scope${v}`];return{...p,...w}},{});return Z.useMemo(()=>({[`__scope${t.scopeName}`]:h}),[h])}};return r.scopeName=t.scopeName,r}function g_(e){const t=$le(e),r=Z.forwardRef((n,c)=>{const{children:h,...p}=n,s=Z.Children.toArray(h),v=s.find(Hle);if(v){const w=v.props.children,T=s.map(I=>I===v?Z.Children.count(w)>1?Z.Children.only(null):Z.isValidElement(w)?w.props.children:null:I);return P.jsx(t,{...p,ref:c,children:Z.isValidElement(w)?Z.cloneElement(w,void 0,T):null})}return P.jsx(t,{...p,ref:c,children:h})});return r.displayName=`${e}.Slot`,r}var Ule=g_("Slot");function $le(e){const t=Z.forwardRef((r,n)=>{const{children:c,...h}=r;if(Z.isValidElement(c)){const p=qle(c),s=Wle(h,c.props);return c.type!==Z.Fragment&&(s.ref=n?xq(n,p):p),Z.cloneElement(c,s)}return Z.Children.count(c)>1?Z.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var bq=Symbol("radix.slottable");function Gle(e){const t=({children:r})=>P.jsx(P.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=bq,t}function Hle(e){return Z.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===bq}function Wle(e,t){const r={...t};for(const n in t){const c=e[n],h=t[n];/^on[A-Z]/.test(n)?c&&h?r[n]=(...p)=>{const s=h(...p);return c(...p),s}:c&&(r[n]=c):n==="style"?r[n]={...c,...h}:n==="className"&&(r[n]=[c,h].filter(Boolean).join(" "))}return{...e,...r}}function qle(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function LL(e){const t=e+"CollectionProvider",[r,n]=wc(t),[c,h]=r(t,{collectionRef:{current:null},itemMap:new Map}),p=N=>{const{scope:G,children:U}=N,V=Ne.useRef(null),X=Ne.useRef(new Map).current;return P.jsx(c,{scope:G,itemMap:X,collectionRef:V,children:U})};p.displayName=t;const s=e+"CollectionSlot",v=g_(s),w=Ne.forwardRef((N,G)=>{const{scope:U,children:V}=N,X=h(s,U),Y=yi(G,X.collectionRef);return P.jsx(v,{ref:Y,children:V})});w.displayName=s;const T=e+"CollectionItemSlot",I="data-radix-collection-item",O=g_(T),D=Ne.forwardRef((N,G)=>{const{scope:U,children:V,...X}=N,Y=Ne.useRef(null),ne=yi(G,Y),ae=h(T,U);return Ne.useEffect(()=>(ae.itemMap.set(Y,{ref:Y,...X}),()=>void ae.itemMap.delete(Y))),P.jsx(O,{[I]:"",ref:ne,children:V})});D.displayName=T;function B(N){const G=h(e+"CollectionConsumer",N);return Ne.useCallback(()=>{const U=G.collectionRef.current;if(!U)return[];const V=Array.from(U.querySelectorAll(`[${I}]`));return Array.from(G.itemMap.values()).sort((X,Y)=>V.indexOf(X.ref.current)-V.indexOf(Y.ref.current))},[G.collectionRef,G.itemMap])}return[{Provider:p,Slot:w,ItemSlot:D},B,n]}var Zle=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],fn=Zle.reduce((e,t)=>{const r=g_(`Primitive.${t}`),n=Z.forwardRef((c,h)=>{const{asChild:p,...s}=c,v=p?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),P.jsx(v,{...s,ref:h})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function wq(e,t){e&&Om.flushSync(()=>e.dispatchEvent(t))}function ro(e){const t=Z.useRef(e);return Z.useEffect(()=>{t.current=e}),Z.useMemo(()=>(...r)=>t.current?.(...r),[])}function Kle(e,t=globalThis?.document){const r=ro(e);Z.useEffect(()=>{const n=c=>{c.key==="Escape"&&r(c)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var Xle="DismissableLayer",YO="dismissableLayer.update",Yle="dismissableLayer.pointerDownOutside",Jle="dismissableLayer.focusOutside",f6,Sq=Z.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ww=Z.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:c,onFocusOutside:h,onInteractOutside:p,onDismiss:s,...v}=e,w=Z.useContext(Sq),[T,I]=Z.useState(null),O=T?.ownerDocument??globalThis?.document,[,D]=Z.useState({}),B=yi(t,le=>I(le)),N=Array.from(w.layers),[G]=[...w.layersWithOutsidePointerEventsDisabled].slice(-1),U=N.indexOf(G),V=T?N.indexOf(T):-1,X=w.layersWithOutsidePointerEventsDisabled.size>0,Y=V>=U,ne=ece(le=>{const ge=le.target,je=[...w.branches].some(ze=>ze.contains(ge));!Y||je||(c?.(le),p?.(le),le.defaultPrevented||s?.())},O),ae=tce(le=>{const ge=le.target;[...w.branches].some(je=>je.contains(ge))||(h?.(le),p?.(le),le.defaultPrevented||s?.())},O);return Kle(le=>{V===w.layers.size-1&&(n?.(le),!le.defaultPrevented&&s&&(le.preventDefault(),s()))},O),Z.useEffect(()=>{if(T)return r&&(w.layersWithOutsidePointerEventsDisabled.size===0&&(f6=O.body.style.pointerEvents,O.body.style.pointerEvents="none"),w.layersWithOutsidePointerEventsDisabled.add(T)),w.layers.add(T),p6(),()=>{r&&w.layersWithOutsidePointerEventsDisabled.size===1&&(O.body.style.pointerEvents=f6)}},[T,O,r,w]),Z.useEffect(()=>()=>{T&&(w.layers.delete(T),w.layersWithOutsidePointerEventsDisabled.delete(T),p6())},[T,w]),Z.useEffect(()=>{const le=()=>D({});return document.addEventListener(YO,le),()=>document.removeEventListener(YO,le)},[]),P.jsx(fn.div,{...v,ref:B,style:{pointerEvents:X?Y?"auto":"none":void 0,...e.style},onFocusCapture:Zr(e.onFocusCapture,ae.onFocusCapture),onBlurCapture:Zr(e.onBlurCapture,ae.onBlurCapture),onPointerDownCapture:Zr(e.onPointerDownCapture,ne.onPointerDownCapture)})});Ww.displayName=Xle;var Qle="DismissableLayerBranch",Tq=Z.forwardRef((e,t)=>{const r=Z.useContext(Sq),n=Z.useRef(null),c=yi(t,n);return Z.useEffect(()=>{const h=n.current;if(h)return r.branches.add(h),()=>{r.branches.delete(h)}},[r.branches]),P.jsx(fn.div,{...e,ref:c})});Tq.displayName=Qle;function ece(e,t=globalThis?.document){const r=ro(e),n=Z.useRef(!1),c=Z.useRef(()=>{});return Z.useEffect(()=>{const h=s=>{if(s.target&&!n.current){let v=function(){Eq(Yle,r,w,{discrete:!0})};const w={originalEvent:s};s.pointerType==="touch"?(t.removeEventListener("click",c.current),c.current=v,t.addEventListener("click",c.current,{once:!0})):v()}else t.removeEventListener("click",c.current);n.current=!1},p=window.setTimeout(()=>{t.addEventListener("pointerdown",h)},0);return()=>{window.clearTimeout(p),t.removeEventListener("pointerdown",h),t.removeEventListener("click",c.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function tce(e,t=globalThis?.document){const r=ro(e),n=Z.useRef(!1);return Z.useEffect(()=>{const c=h=>{h.target&&!n.current&&Eq(Jle,r,{originalEvent:h},{discrete:!1})};return t.addEventListener("focusin",c),()=>t.removeEventListener("focusin",c)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function p6(){const e=new CustomEvent(YO);document.dispatchEvent(e)}function Eq(e,t,r,{discrete:n}){const c=r.originalEvent.target,h=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&c.addEventListener(e,t,{once:!0}),n?wq(c,h):c.dispatchEvent(h)}var rce=Ww,nce=Tq,xo=globalThis?.document?Z.useLayoutEffect:()=>{},ice="Portal",UA=Z.forwardRef((e,t)=>{const{container:r,...n}=e,[c,h]=Z.useState(!1);xo(()=>h(!0),[]);const p=r||c&&globalThis?.document?.body;return p?_q.createPortal(P.jsx(fn.div,{...n,ref:t}),p):null});UA.displayName=ice;function sce(e,t){return Z.useReducer((r,n)=>t[r][n]??r,e)}var Sc=e=>{const{present:t,children:r}=e,n=oce(t),c=typeof r=="function"?r({present:n.isPresent}):Z.Children.only(r),h=yi(n.ref,ace(c));return typeof r=="function"||n.isPresent?Z.cloneElement(c,{ref:h}):null};Sc.displayName="Presence";function oce(e){const[t,r]=Z.useState(),n=Z.useRef(null),c=Z.useRef(e),h=Z.useRef("none"),p=e?"mounted":"unmounted",[s,v]=sce(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Z.useEffect(()=>{const w=CT(n.current);h.current=s==="mounted"?w:"none"},[s]),xo(()=>{const w=n.current,T=c.current;if(T!==e){const I=h.current,O=CT(w);e?v("MOUNT"):O==="none"||w?.display==="none"?v("UNMOUNT"):v(T&&I!==O?"ANIMATION_OUT":"UNMOUNT"),c.current=e}},[e,v]),xo(()=>{if(t){let w;const T=t.ownerDocument.defaultView??window,I=D=>{const B=CT(n.current).includes(CSS.escape(D.animationName));if(D.target===t&&B&&(v("ANIMATION_END"),!c.current)){const N=t.style.animationFillMode;t.style.animationFillMode="forwards",w=T.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=N)})}},O=D=>{D.target===t&&(h.current=CT(n.current))};return t.addEventListener("animationstart",O),t.addEventListener("animationcancel",I),t.addEventListener("animationend",I),()=>{T.clearTimeout(w),t.removeEventListener("animationstart",O),t.removeEventListener("animationcancel",I),t.removeEventListener("animationend",I)}}else v("ANIMATION_END")},[t,v]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:Z.useCallback(w=>{n.current=w?getComputedStyle(w):null,r(w)},[])}}function CT(e){return e?.animationName||"none"}function ace(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var lce=GD[" useInsertionEffect ".trim().toString()]||xo;function ym({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[c,h,p]=cce({defaultProp:t,onChange:r}),s=e!==void 0,v=s?e:c;{const T=Z.useRef(e!==void 0);Z.useEffect(()=>{const I=T.current;I!==s&&console.warn(`${n} is changing from ${I?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),T.current=s},[s,n])}const w=Z.useCallback(T=>{if(s){const I=uce(T)?T(e):T;I!==e&&p.current?.(I)}else h(T)},[s,e,h,p]);return[v,w]}function cce({defaultProp:e,onChange:t}){const[r,n]=Z.useState(e),c=Z.useRef(r),h=Z.useRef(t);return lce(()=>{h.current=t},[t]),Z.useEffect(()=>{c.current!==r&&(h.current?.(r),c.current=r)},[r,c]),[r,n,h]}function uce(e){return typeof e=="function"}var Aq=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),hce="VisuallyHidden",$A=Z.forwardRef((e,t)=>P.jsx(fn.span,{...e,ref:t,style:{...Aq,...e.style}}));$A.displayName=hce;var dce=$A,zL="ToastProvider",[NL,fce,pce]=LL("Toast"),[kq,JHe]=wc("Toast",[pce]),[mce,GA]=kq(zL),Pq=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:c="right",swipeThreshold:h=50,children:p}=e,[s,v]=Z.useState(null),[w,T]=Z.useState(0),I=Z.useRef(!1),O=Z.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${zL}\`. Expected non-empty \`string\`.`),P.jsx(NL.Provider,{scope:t,children:P.jsx(mce,{scope:t,label:r,duration:n,swipeDirection:c,swipeThreshold:h,toastCount:w,viewport:s,onViewportChange:v,onToastAdd:Z.useCallback(()=>T(D=>D+1),[]),onToastRemove:Z.useCallback(()=>T(D=>D-1),[]),isFocusedToastEscapeKeyDownRef:I,isClosePausedRef:O,children:p})})};Pq.displayName=zL;var Cq="ToastViewport",gce=["F8"],JO="toast.viewportPause",QO="toast.viewportResume",Iq=Z.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=gce,label:c="Notifications ({hotkey})",...h}=e,p=GA(Cq,r),s=fce(r),v=Z.useRef(null),w=Z.useRef(null),T=Z.useRef(null),I=Z.useRef(null),O=yi(t,I,p.onViewportChange),D=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),B=p.toastCount>0;Z.useEffect(()=>{const G=U=>{n.length!==0&&n.every(V=>U[V]||U.code===V)&&I.current?.focus()};return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[n]),Z.useEffect(()=>{const G=v.current,U=I.current;if(B&&G&&U){const V=()=>{if(!p.isClosePausedRef.current){const ae=new CustomEvent(JO);U.dispatchEvent(ae),p.isClosePausedRef.current=!0}},X=()=>{if(p.isClosePausedRef.current){const ae=new CustomEvent(QO);U.dispatchEvent(ae),p.isClosePausedRef.current=!1}},Y=ae=>{!G.contains(ae.relatedTarget)&&X()},ne=()=>{G.contains(document.activeElement)||X()};return G.addEventListener("focusin",V),G.addEventListener("focusout",Y),G.addEventListener("pointermove",V),G.addEventListener("pointerleave",ne),window.addEventListener("blur",V),window.addEventListener("focus",X),()=>{G.removeEventListener("focusin",V),G.removeEventListener("focusout",Y),G.removeEventListener("pointermove",V),G.removeEventListener("pointerleave",ne),window.removeEventListener("blur",V),window.removeEventListener("focus",X)}}},[B,p.isClosePausedRef]);const N=Z.useCallback(({tabbingDirection:G})=>{const U=s().map(V=>{const X=V.ref.current,Y=[X,...Cce(X)];return G==="forwards"?Y:Y.reverse()});return(G==="forwards"?U.reverse():U).flat()},[s]);return Z.useEffect(()=>{const G=I.current;if(G){const U=V=>{const X=V.altKey||V.ctrlKey||V.metaKey;if(V.key==="Tab"&&!X){const Y=document.activeElement,ne=V.shiftKey;if(V.target===G&&ne){w.current?.focus();return}const ae=N({tabbingDirection:ne?"backwards":"forwards"}),le=ae.findIndex(ge=>ge===Y);WI(ae.slice(le+1))?V.preventDefault():ne?w.current?.focus():T.current?.focus()}};return G.addEventListener("keydown",U),()=>G.removeEventListener("keydown",U)}},[s,N]),P.jsxs(nce,{ref:v,role:"region","aria-label":c.replace("{hotkey}",D),tabIndex:-1,style:{pointerEvents:B?void 0:"none"},children:[B&&P.jsx(ej,{ref:w,onFocusFromOutsideViewport:()=>{const G=N({tabbingDirection:"forwards"});WI(G)}}),P.jsx(NL.Slot,{scope:r,children:P.jsx(fn.ol,{tabIndex:-1,...h,ref:O})}),B&&P.jsx(ej,{ref:T,onFocusFromOutsideViewport:()=>{const G=N({tabbingDirection:"backwards"});WI(G)}})]})});Iq.displayName=Cq;var Mq="ToastFocusProxy",ej=Z.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...c}=e,h=GA(Mq,r);return P.jsx($A,{tabIndex:0,...c,ref:t,style:{position:"fixed"},onFocus:p=>{const s=p.relatedTarget;!h.viewport?.contains(s)&&n()}})});ej.displayName=Mq;var qw="Toast",yce="toast.swipeStart",_ce="toast.swipeMove",vce="toast.swipeCancel",xce="toast.swipeEnd",Oq=Z.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:c,onOpenChange:h,...p}=e,[s,v]=ym({prop:n,defaultProp:c??!0,onChange:h,caller:qw});return P.jsx(Sc,{present:r||s,children:P.jsx(Sce,{open:s,...p,ref:t,onClose:()=>v(!1),onPause:ro(e.onPause),onResume:ro(e.onResume),onSwipeStart:Zr(e.onSwipeStart,w=>{w.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Zr(e.onSwipeMove,w=>{const{x:T,y:I}=w.detail.delta;w.currentTarget.setAttribute("data-swipe","move"),w.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${T}px`),w.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${I}px`)}),onSwipeCancel:Zr(e.onSwipeCancel,w=>{w.currentTarget.setAttribute("data-swipe","cancel"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),w.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Zr(e.onSwipeEnd,w=>{const{x:T,y:I}=w.detail.delta;w.currentTarget.setAttribute("data-swipe","end"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),w.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${T}px`),w.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${I}px`),v(!1)})})})});Oq.displayName=qw;var[bce,wce]=kq(qw,{onClose(){}}),Sce=Z.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:c,open:h,onClose:p,onEscapeKeyDown:s,onPause:v,onResume:w,onSwipeStart:T,onSwipeMove:I,onSwipeCancel:O,onSwipeEnd:D,...B}=e,N=GA(qw,r),[G,U]=Z.useState(null),V=yi(t,Oe=>U(Oe)),X=Z.useRef(null),Y=Z.useRef(null),ne=c||N.duration,ae=Z.useRef(0),le=Z.useRef(ne),ge=Z.useRef(0),{onToastAdd:je,onToastRemove:ze}=N,Pe=ro(()=>{G?.contains(document.activeElement)&&N.viewport?.focus(),p()}),Ke=Z.useCallback(Oe=>{!Oe||Oe===1/0||(window.clearTimeout(ge.current),ae.current=new Date().getTime(),ge.current=window.setTimeout(Pe,Oe))},[Pe]);Z.useEffect(()=>{const Oe=N.viewport;if(Oe){const tt=()=>{Ke(le.current),w?.()},We=()=>{const lt=new Date().getTime()-ae.current;le.current=le.current-lt,window.clearTimeout(ge.current),v?.()};return Oe.addEventListener(JO,We),Oe.addEventListener(QO,tt),()=>{Oe.removeEventListener(JO,We),Oe.removeEventListener(QO,tt)}}},[N.viewport,ne,v,w,Ke]),Z.useEffect(()=>{h&&!N.isClosePausedRef.current&&Ke(ne)},[h,ne,N.isClosePausedRef,Ke]),Z.useEffect(()=>(je(),()=>ze()),[je,ze]);const Ye=Z.useMemo(()=>G?Fq(G):null,[G]);return N.viewport?P.jsxs(P.Fragment,{children:[Ye&&P.jsx(Tce,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite",children:Ye}),P.jsx(bce,{scope:r,onClose:Pe,children:Om.createPortal(P.jsx(NL.ItemSlot,{scope:r,children:P.jsx(rce,{asChild:!0,onEscapeKeyDown:Zr(s,()=>{N.isFocusedToastEscapeKeyDownRef.current||Pe(),N.isFocusedToastEscapeKeyDownRef.current=!1}),children:P.jsx(fn.li,{tabIndex:0,"data-state":h?"open":"closed","data-swipe-direction":N.swipeDirection,...B,ref:V,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Zr(e.onKeyDown,Oe=>{Oe.key==="Escape"&&(s?.(Oe.nativeEvent),Oe.nativeEvent.defaultPrevented||(N.isFocusedToastEscapeKeyDownRef.current=!0,Pe()))}),onPointerDown:Zr(e.onPointerDown,Oe=>{Oe.button===0&&(X.current={x:Oe.clientX,y:Oe.clientY})}),onPointerMove:Zr(e.onPointerMove,Oe=>{if(!X.current)return;const tt=Oe.clientX-X.current.x,We=Oe.clientY-X.current.y,lt=!!Y.current,rt=["left","right"].includes(N.swipeDirection),ht=["left","up"].includes(N.swipeDirection)?Math.min:Math.max,vt=rt?ht(0,tt):0,mt=rt?0:ht(0,We),ct=Oe.pointerType==="touch"?10:2,Ut={x:vt,y:mt},xr={originalEvent:Oe,delta:Ut};lt?(Y.current=Ut,IT(_ce,I,xr,{discrete:!1})):m6(Ut,N.swipeDirection,ct)?(Y.current=Ut,IT(yce,T,xr,{discrete:!1}),Oe.target.setPointerCapture(Oe.pointerId)):(Math.abs(tt)>ct||Math.abs(We)>ct)&&(X.current=null)}),onPointerUp:Zr(e.onPointerUp,Oe=>{const tt=Y.current,We=Oe.target;if(We.hasPointerCapture(Oe.pointerId)&&We.releasePointerCapture(Oe.pointerId),Y.current=null,X.current=null,tt){const lt=Oe.currentTarget,rt={originalEvent:Oe,delta:tt};m6(tt,N.swipeDirection,N.swipeThreshold)?IT(xce,D,rt,{discrete:!0}):IT(vce,O,rt,{discrete:!0}),lt.addEventListener("click",ht=>ht.preventDefault(),{once:!0})}})})})}),N.viewport)})]}):null}),Tce=e=>{const{__scopeToast:t,children:r,...n}=e,c=GA(qw,t),[h,p]=Z.useState(!1),[s,v]=Z.useState(!1);return kce(()=>p(!0)),Z.useEffect(()=>{const w=window.setTimeout(()=>v(!0),1e3);return()=>window.clearTimeout(w)},[]),s?null:P.jsx(UA,{asChild:!0,children:P.jsx($A,{...n,children:h&&P.jsxs(P.Fragment,{children:[c.label," ",r]})})})},Ece="ToastTitle",jq=Z.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return P.jsx(fn.div,{...n,ref:t})});jq.displayName=Ece;var Ace="ToastDescription",Rq=Z.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return P.jsx(fn.div,{...n,ref:t})});Rq.displayName=Ace;var Dq="ToastAction",Lq=Z.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?P.jsx(Nq,{altText:r,asChild:!0,children:P.jsx(FL,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${Dq}\`. Expected non-empty \`string\`.`),null)});Lq.displayName=Dq;var zq="ToastClose",FL=Z.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,c=wce(zq,r);return P.jsx(Nq,{asChild:!0,children:P.jsx(fn.button,{type:"button",...n,ref:t,onClick:Zr(e.onClick,c.onClose)})})});FL.displayName=zq;var Nq=Z.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...c}=e;return P.jsx(fn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...c,ref:t})});function Fq(e){const t=[];return Array.from(e.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&t.push(r.textContent),Pce(r)){const n=r.ariaHidden||r.hidden||r.style.display==="none",c=r.dataset.radixToastAnnounceExclude==="";if(!n)if(c){const h=r.dataset.radixToastAnnounceAlt;h&&t.push(h)}else t.push(...Fq(r))}}),t}function IT(e,t,r,{discrete:n}){const c=r.originalEvent.currentTarget,h=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&c.addEventListener(e,t,{once:!0}),n?wq(c,h):c.dispatchEvent(h)}var m6=(e,t,r=0)=>{const n=Math.abs(e.x),c=Math.abs(e.y),h=n>c;return t==="left"||t==="right"?h&&n>r:!h&&c>r};function kce(e=()=>{}){const t=ro(e);xo(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function Pce(e){return e.nodeType===e.ELEMENT_NODE}function Cce(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const c=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||c?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function WI(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var Ice=Pq,Bq=Iq,Vq=Oq,Uq=jq,$q=Rq,Gq=Lq,Hq=FL;function Wq(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var c=e.length;for(t=0;t<c;t++)e[t]&&(r=Wq(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Wn(){for(var e,t,r=0,n="",c=arguments.length;r<c;r++)(e=arguments[r])&&(t=Wq(e))&&(n&&(n+=" "),n+=t);return n}const g6=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,y6=Wn,Y_=(e,t)=>r=>{var n;if(t?.variants==null)return y6(e,r?.class,r?.className);const{variants:c,defaultVariants:h}=t,p=Object.keys(c).map(w=>{const T=r?.[w],I=h?.[w];if(T===null)return null;const O=g6(T)||g6(I);return c[w][O]}),s=r&&Object.entries(r).reduce((w,T)=>{let[I,O]=T;return O===void 0||(w[I]=O),w},{}),v=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((w,T)=>{let{class:I,className:O,...D}=T;return Object.entries(D).every(B=>{let[N,G]=B;return Array.isArray(G)?G.includes({...h,...s}[N]):{...h,...s}[N]===G})?[...w,I,O]:w},[]);return y6(e,p,v,r?.class,r?.className)};/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Mce=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),qq=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/var Oce={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const jce=Z.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:c="",children:h,iconNode:p,...s},v)=>Z.createElement("svg",{ref:v,...Oce,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:qq("lucide",c),...s},[...p.map(([w,T])=>Z.createElement(w,T)),...Array.isArray(h)?h:[h]]));/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const en=(e,t)=>{const r=Z.forwardRef(({className:n,...c},h)=>Z.createElement(jce,{ref:h,iconNode:t,className:qq(`lucide-${Mce(e)}`,n),...c}));return r.displayName=`${e}`,r};/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const iE=en("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Rce=en("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Dce=en("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Lce=en("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const zce=en("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const BL=en("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const am=en("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Nce=en("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ah=en("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Fce=en("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Zw=en("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const tj=en("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const rj=en("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const HA=en("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Bce=en("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Vce=en("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Uce=en("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const VL=en("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const UL=en("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const $ce=en("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const $L=en("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Gce=en("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Hce=en("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Zq=en("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Kq=en("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Wce=en("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Xq=en("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const qce=en("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Zce=en("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const qa=en("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Kce=en("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Xce=en("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const _6=en("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Yq=en("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const nj=en("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Yce=en("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Jq=en("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Hd=en("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Jce=en("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const tb=en("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const v6=en("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const GL=en("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Qq=en("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const ba=en("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Qce=en("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const eue=en("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const tue=en("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const jm=en("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const rue=en("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const e9=en("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Rm=en("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const nue=en("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const iue=en("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Qo=en("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const sue=en("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),HL="-",oue=e=>{const t=lue(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:c=>{const h=c.split(HL);return h[0]===""&&h.length!==1&&h.shift(),t9(h,t)||aue(c)},getConflictingClassGroupIds:(c,h)=>{const p=r[c]||[];return h&&n[c]?[...p,...n[c]]:p}}},t9=(e,t)=>{if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),c=n?t9(e.slice(1),n):void 0;if(c)return c;if(t.validators.length===0)return;const h=e.join(HL);return t.validators.find(({validator:p})=>p(h))?.classGroupId},x6=/^\[(.+)\]$/,aue=e=>{if(x6.test(e)){const t=x6.exec(e)[1],r=t?.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},lue=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return uue(Object.entries(e.classGroups),r).forEach(([c,h])=>{ij(h,n,c,t)}),n},ij=(e,t,r,n)=>{e.forEach(c=>{if(typeof c=="string"){const h=c===""?t:b6(t,c);h.classGroupId=r;return}if(typeof c=="function"){if(cue(c)){ij(c(n),t,r,n);return}t.validators.push({validator:c,classGroupId:r});return}Object.entries(c).forEach(([h,p])=>{ij(p,b6(t,h),r,n)})})},b6=(e,t)=>{let r=e;return t.split(HL).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},cue=e=>e.isThemeGetter,uue=(e,t)=>t?e.map(([r,n])=>{const c=n.map(h=>typeof h=="string"?t+h:typeof h=="object"?Object.fromEntries(Object.entries(h).map(([p,s])=>[t+p,s])):h);return[r,c]}):e,hue=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const c=(h,p)=>{r.set(h,p),t++,t>e&&(t=0,n=r,r=new Map)};return{get(h){let p=r.get(h);if(p!==void 0)return p;if((p=n.get(h))!==void 0)return c(h,p),p},set(h,p){r.has(h)?r.set(h,p):c(h,p)}}},r9="!",due=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,c=t[0],h=t.length,p=s=>{const v=[];let w=0,T=0,I;for(let G=0;G<s.length;G++){let U=s[G];if(w===0){if(U===c&&(n||s.slice(G,G+h)===t)){v.push(s.slice(T,G)),T=G+h;continue}if(U==="/"){I=G;continue}}U==="["?w++:U==="]"&&w--}const O=v.length===0?s:s.substring(T),D=O.startsWith(r9),B=D?O.substring(1):O,N=I&&I>T?I-T:void 0;return{modifiers:v,hasImportantModifier:D,baseClassName:B,maybePostfixModifierPosition:N}};return r?s=>r({className:s,parseClassName:p}):p},fue=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},pue=e=>({cache:hue(e.cacheSize),parseClassName:due(e),...oue(e)}),mue=/\s+/,gue=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:c}=t,h=[],p=e.trim().split(mue);let s="";for(let v=p.length-1;v>=0;v-=1){const w=p[v],{modifiers:T,hasImportantModifier:I,baseClassName:O,maybePostfixModifierPosition:D}=r(w);let B=!!D,N=n(B?O.substring(0,D):O);if(!N){if(!B){s=w+(s.length>0?" "+s:s);continue}if(N=n(O),!N){s=w+(s.length>0?" "+s:s);continue}B=!1}const G=fue(T).join(":"),U=I?G+r9:G,V=U+N;if(h.includes(V))continue;h.push(V);const X=c(N,B);for(let Y=0;Y<X.length;++Y){const ne=X[Y];h.push(U+ne)}s=w+(s.length>0?" "+s:s)}return s};function yue(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=n9(t))&&(n&&(n+=" "),n+=r);return n}const n9=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=n9(e[n]))&&(r&&(r+=" "),r+=t);return r};function _ue(e,...t){let r,n,c,h=p;function p(v){const w=t.reduce((T,I)=>I(T),e());return r=pue(w),n=r.cache.get,c=r.cache.set,h=s,s(v)}function s(v){const w=n(v);if(w)return w;const T=gue(v,r);return c(v,T),T}return function(){return h(yue.apply(null,arguments))}}const ns=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},i9=/^\[(?:([a-z-]+):)?(.+)\]$/i,vue=/^\d+\/\d+$/,xue=new Set(["px","full","screen"]),bue=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,wue=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Sue=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Tue=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Eue=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,rh=e=>Jy(e)||xue.has(e)||vue.test(e),Dd=e=>J_(e,"length",jue),Jy=e=>!!e&&!Number.isNaN(Number(e)),qI=e=>J_(e,"number",Jy),Ax=e=>!!e&&Number.isInteger(Number(e)),Aue=e=>e.endsWith("%")&&Jy(e.slice(0,-1)),Hn=e=>i9.test(e),Ld=e=>bue.test(e),kue=new Set(["length","size","percentage"]),Pue=e=>J_(e,kue,s9),Cue=e=>J_(e,"position",s9),Iue=new Set(["image","url"]),Mue=e=>J_(e,Iue,Due),Oue=e=>J_(e,"",Rue),kx=()=>!0,J_=(e,t,r)=>{const n=i9.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},jue=e=>wue.test(e)&&!Sue.test(e),s9=()=>!1,Rue=e=>Tue.test(e),Due=e=>Eue.test(e),Lue=()=>{const e=ns("colors"),t=ns("spacing"),r=ns("blur"),n=ns("brightness"),c=ns("borderColor"),h=ns("borderRadius"),p=ns("borderSpacing"),s=ns("borderWidth"),v=ns("contrast"),w=ns("grayscale"),T=ns("hueRotate"),I=ns("invert"),O=ns("gap"),D=ns("gradientColorStops"),B=ns("gradientColorStopPositions"),N=ns("inset"),G=ns("margin"),U=ns("opacity"),V=ns("padding"),X=ns("saturate"),Y=ns("scale"),ne=ns("sepia"),ae=ns("skew"),le=ns("space"),ge=ns("translate"),je=()=>["auto","contain","none"],ze=()=>["auto","hidden","clip","visible","scroll"],Pe=()=>["auto",Hn,t],Ke=()=>[Hn,t],Ye=()=>["",rh,Dd],Oe=()=>["auto",Jy,Hn],tt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],We=()=>["solid","dashed","dotted","double","none"],lt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],rt=()=>["start","end","center","between","around","evenly","stretch"],ht=()=>["","0",Hn],vt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],mt=()=>[Jy,Hn];return{cacheSize:500,separator:":",theme:{colors:[kx],spacing:[rh,Dd],blur:["none","",Ld,Hn],brightness:mt(),borderColor:[e],borderRadius:["none","","full",Ld,Hn],borderSpacing:Ke(),borderWidth:Ye(),contrast:mt(),grayscale:ht(),hueRotate:mt(),invert:ht(),gap:Ke(),gradientColorStops:[e],gradientColorStopPositions:[Aue,Dd],inset:Pe(),margin:Pe(),opacity:mt(),padding:Ke(),saturate:mt(),scale:mt(),sepia:ht(),skew:mt(),space:Ke(),translate:Ke()},classGroups:{aspect:[{aspect:["auto","square","video",Hn]}],container:["container"],columns:[{columns:[Ld]}],"break-after":[{"break-after":vt()}],"break-before":[{"break-before":vt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...tt(),Hn]}],overflow:[{overflow:ze()}],"overflow-x":[{"overflow-x":ze()}],"overflow-y":[{"overflow-y":ze()}],overscroll:[{overscroll:je()}],"overscroll-x":[{"overscroll-x":je()}],"overscroll-y":[{"overscroll-y":je()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[N]}],"inset-x":[{"inset-x":[N]}],"inset-y":[{"inset-y":[N]}],start:[{start:[N]}],end:[{end:[N]}],top:[{top:[N]}],right:[{right:[N]}],bottom:[{bottom:[N]}],left:[{left:[N]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ax,Hn]}],basis:[{basis:Pe()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Hn]}],grow:[{grow:ht()}],shrink:[{shrink:ht()}],order:[{order:["first","last","none",Ax,Hn]}],"grid-cols":[{"grid-cols":[kx]}],"col-start-end":[{col:["auto",{span:["full",Ax,Hn]},Hn]}],"col-start":[{"col-start":Oe()}],"col-end":[{"col-end":Oe()}],"grid-rows":[{"grid-rows":[kx]}],"row-start-end":[{row:["auto",{span:[Ax,Hn]},Hn]}],"row-start":[{"row-start":Oe()}],"row-end":[{"row-end":Oe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Hn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Hn]}],gap:[{gap:[O]}],"gap-x":[{"gap-x":[O]}],"gap-y":[{"gap-y":[O]}],"justify-content":[{justify:["normal",...rt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...rt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...rt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[V]}],px:[{px:[V]}],py:[{py:[V]}],ps:[{ps:[V]}],pe:[{pe:[V]}],pt:[{pt:[V]}],pr:[{pr:[V]}],pb:[{pb:[V]}],pl:[{pl:[V]}],m:[{m:[G]}],mx:[{mx:[G]}],my:[{my:[G]}],ms:[{ms:[G]}],me:[{me:[G]}],mt:[{mt:[G]}],mr:[{mr:[G]}],mb:[{mb:[G]}],ml:[{ml:[G]}],"space-x":[{"space-x":[le]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[le]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Hn,t]}],"min-w":[{"min-w":[Hn,t,"min","max","fit"]}],"max-w":[{"max-w":[Hn,t,"none","full","min","max","fit","prose",{screen:[Ld]},Ld]}],h:[{h:[Hn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Hn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Hn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Hn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Ld,Dd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",qI]}],"font-family":[{font:[kx]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Hn]}],"line-clamp":[{"line-clamp":["none",Jy,qI]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",rh,Hn]}],"list-image":[{"list-image":["none",Hn]}],"list-style-type":[{list:["none","disc","decimal",Hn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[U]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[U]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...We(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",rh,Dd]}],"underline-offset":[{"underline-offset":["auto",rh,Hn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ke()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Hn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Hn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[U]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...tt(),Cue]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Pue]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Mue]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[B]}],"gradient-via-pos":[{via:[B]}],"gradient-to-pos":[{to:[B]}],"gradient-from":[{from:[D]}],"gradient-via":[{via:[D]}],"gradient-to":[{to:[D]}],rounded:[{rounded:[h]}],"rounded-s":[{"rounded-s":[h]}],"rounded-e":[{"rounded-e":[h]}],"rounded-t":[{"rounded-t":[h]}],"rounded-r":[{"rounded-r":[h]}],"rounded-b":[{"rounded-b":[h]}],"rounded-l":[{"rounded-l":[h]}],"rounded-ss":[{"rounded-ss":[h]}],"rounded-se":[{"rounded-se":[h]}],"rounded-ee":[{"rounded-ee":[h]}],"rounded-es":[{"rounded-es":[h]}],"rounded-tl":[{"rounded-tl":[h]}],"rounded-tr":[{"rounded-tr":[h]}],"rounded-br":[{"rounded-br":[h]}],"rounded-bl":[{"rounded-bl":[h]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[U]}],"border-style":[{border:[...We(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[U]}],"divide-style":[{divide:We()}],"border-color":[{border:[c]}],"border-color-x":[{"border-x":[c]}],"border-color-y":[{"border-y":[c]}],"border-color-s":[{"border-s":[c]}],"border-color-e":[{"border-e":[c]}],"border-color-t":[{"border-t":[c]}],"border-color-r":[{"border-r":[c]}],"border-color-b":[{"border-b":[c]}],"border-color-l":[{"border-l":[c]}],"divide-color":[{divide:[c]}],"outline-style":[{outline:["",...We()]}],"outline-offset":[{"outline-offset":[rh,Hn]}],"outline-w":[{outline:[rh,Dd]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Ye()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[U]}],"ring-offset-w":[{"ring-offset":[rh,Dd]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Ld,Oue]}],"shadow-color":[{shadow:[kx]}],opacity:[{opacity:[U]}],"mix-blend":[{"mix-blend":[...lt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":lt()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[v]}],"drop-shadow":[{"drop-shadow":["","none",Ld,Hn]}],grayscale:[{grayscale:[w]}],"hue-rotate":[{"hue-rotate":[T]}],invert:[{invert:[I]}],saturate:[{saturate:[X]}],sepia:[{sepia:[ne]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[v]}],"backdrop-grayscale":[{"backdrop-grayscale":[w]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[T]}],"backdrop-invert":[{"backdrop-invert":[I]}],"backdrop-opacity":[{"backdrop-opacity":[U]}],"backdrop-saturate":[{"backdrop-saturate":[X]}],"backdrop-sepia":[{"backdrop-sepia":[ne]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[p]}],"border-spacing-x":[{"border-spacing-x":[p]}],"border-spacing-y":[{"border-spacing-y":[p]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Hn]}],duration:[{duration:mt()}],ease:[{ease:["linear","in","out","in-out",Hn]}],delay:[{delay:mt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Hn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Y]}],"scale-x":[{"scale-x":[Y]}],"scale-y":[{"scale-y":[Y]}],rotate:[{rotate:[Ax,Hn]}],"translate-x":[{"translate-x":[ge]}],"translate-y":[{"translate-y":[ge]}],"skew-x":[{"skew-x":[ae]}],"skew-y":[{"skew-y":[ae]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Hn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Hn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ke()}],"scroll-mx":[{"scroll-mx":Ke()}],"scroll-my":[{"scroll-my":Ke()}],"scroll-ms":[{"scroll-ms":Ke()}],"scroll-me":[{"scroll-me":Ke()}],"scroll-mt":[{"scroll-mt":Ke()}],"scroll-mr":[{"scroll-mr":Ke()}],"scroll-mb":[{"scroll-mb":Ke()}],"scroll-ml":[{"scroll-ml":Ke()}],"scroll-p":[{"scroll-p":Ke()}],"scroll-px":[{"scroll-px":Ke()}],"scroll-py":[{"scroll-py":Ke()}],"scroll-ps":[{"scroll-ps":Ke()}],"scroll-pe":[{"scroll-pe":Ke()}],"scroll-pt":[{"scroll-pt":Ke()}],"scroll-pr":[{"scroll-pr":Ke()}],"scroll-pb":[{"scroll-pb":Ke()}],"scroll-pl":[{"scroll-pl":Ke()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Hn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[rh,Dd,qI]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},zue=_ue(Lue);function ln(...e){return zue(Wn(e))}const Nue=Ice,o9=Z.forwardRef(({className:e,...t},r)=>P.jsx(Bq,{ref:r,className:ln("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));o9.displayName=Bq.displayName;const Fue=Y_("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),a9=Z.forwardRef(({className:e,variant:t,...r},n)=>P.jsx(Vq,{ref:n,className:ln(Fue({variant:t}),e),...r}));a9.displayName=Vq.displayName;const Bue=Z.forwardRef(({className:e,...t},r)=>P.jsx(Gq,{ref:r,className:ln("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));Bue.displayName=Gq.displayName;const l9=Z.forwardRef(({className:e,...t},r)=>P.jsx(Hq,{ref:r,className:ln("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:P.jsx(Qo,{className:"h-4 w-4"})}));l9.displayName=Hq.displayName;const c9=Z.forwardRef(({className:e,...t},r)=>P.jsx(Uq,{ref:r,className:ln("text-sm font-semibold",e),...t}));c9.displayName=Uq.displayName;const u9=Z.forwardRef(({className:e,...t},r)=>P.jsx($q,{ref:r,className:ln("text-sm opacity-90",e),...t}));u9.displayName=$q.displayName;function Vue(){const{toasts:e}=DL();return P.jsxs(Nue,{children:[e.map(function({id:t,title:r,description:n,action:c,...h}){return P.jsxs(a9,{...h,children:[P.jsxs("div",{className:"grid gap-1",children:[r&&P.jsx(c9,{children:r}),n&&P.jsx(u9,{children:n})]}),c,P.jsx(l9,{})]},t)}),P.jsx(o9,{})]})}var Uue=e=>{switch(e){case"success":return Hue;case"info":return que;case"warning":return Wue;case"error":return Zue;default:return null}},$ue=Array(12).fill(0),Gue=({visible:e,className:t})=>Ne.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Ne.createElement("div",{className:"sonner-spinner"},$ue.map((r,n)=>Ne.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),Hue=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Wue=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),que=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Zue=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Kue=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ne.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ne.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Xue=()=>{let[e,t]=Ne.useState(document.hidden);return Ne.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},sj=1,Yue=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...n}=e,c=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:sj++,h=this.toasts.find(s=>s.id===c),p=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(c)&&this.dismissedToasts.delete(c),h?this.toasts=this.toasts.map(s=>s.id===c?(this.publish({...s,...e,id:c,title:r}),{...s,...e,id:c,dismissible:p,title:r}):s):this.addToast({title:r,...n,dismissible:p,id:c}),c},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let n=e instanceof Promise?e:e(),c=r!==void 0,h,p=n.then(async v=>{if(h=["resolve",v],Ne.isValidElement(v))c=!1,this.create({id:r,type:"default",message:v});else if(Que(v)&&!v.ok){c=!1;let w=typeof t.error=="function"?await t.error(`HTTP error! status: ${v.status}`):t.error,T=typeof t.description=="function"?await t.description(`HTTP error! status: ${v.status}`):t.description;this.create({id:r,type:"error",message:w,description:T})}else if(t.success!==void 0){c=!1;let w=typeof t.success=="function"?await t.success(v):t.success,T=typeof t.description=="function"?await t.description(v):t.description;this.create({id:r,type:"success",message:w,description:T})}}).catch(async v=>{if(h=["reject",v],t.error!==void 0){c=!1;let w=typeof t.error=="function"?await t.error(v):t.error,T=typeof t.description=="function"?await t.description(v):t.description;this.create({id:r,type:"error",message:w,description:T})}}).finally(()=>{var v;c&&(this.dismiss(r),r=void 0),(v=t.finally)==null||v.call(t)}),s=()=>new Promise((v,w)=>p.then(()=>h[0]==="reject"?w(h[1]):v(h[1])).catch(w));return typeof r!="string"&&typeof r!="number"?{unwrap:s}:Object.assign(r,{unwrap:s})},this.custom=(e,t)=>{let r=t?.id||sj++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},za=new Yue,Jue=(e,t)=>{let r=t?.id||sj++;return za.addToast({title:e,...t,id:r}),r},Que=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",ehe=Jue,the=()=>za.toasts,rhe=()=>za.getActiveToasts(),fh=Object.assign(ehe,{success:za.success,info:za.info,warning:za.warning,error:za.error,custom:za.custom,message:za.message,promise:za.promise,dismiss:za.dismiss,loading:za.loading},{getHistory:the,getToasts:rhe});function nhe(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}nhe(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function MT(e){return e.label!==void 0}var ihe=3,she="32px",ohe="16px",w6=4e3,ahe=356,lhe=14,che=20,uhe=200;function nc(...e){return e.filter(Boolean).join(" ")}function hhe(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var dhe=e=>{var t,r,n,c,h,p,s,v,w,T,I;let{invert:O,toast:D,unstyled:B,interacting:N,setHeights:G,visibleToasts:U,heights:V,index:X,toasts:Y,expanded:ne,removeToast:ae,defaultRichColors:le,closeButton:ge,style:je,cancelButtonStyle:ze,actionButtonStyle:Pe,className:Ke="",descriptionClassName:Ye="",duration:Oe,position:tt,gap:We,loadingIcon:lt,expandByDefault:rt,classNames:ht,icons:vt,closeButtonAriaLabel:mt="Close toast",pauseWhenPageIsHidden:ct}=e,[Ut,xr]=Ne.useState(null),[tn,Er]=Ne.useState(null),[Ft,br]=Ne.useState(!1),[Yt,Qt]=Ne.useState(!1),[Sr,Vt]=Ne.useState(!1),[Nn,Jr]=Ne.useState(!1),[Kr,Mn]=Ne.useState(!1),[Fi,Us]=Ne.useState(0),[ks,Wi]=Ne.useState(0),Bi=Ne.useRef(D.duration||Oe||w6),wo=Ne.useRef(null),vs=Ne.useRef(null),$l=X===0,kc=X+1<=U,Pi=D.type,xs=D.dismissible!==!1,ju=D.className||"",Xa=D.descriptionClassName||"",Ya=Ne.useMemo(()=>V.findIndex(ut=>ut.toastId===D.id)||0,[V,D.id]),Ps=Ne.useMemo(()=>{var ut;return(ut=D.closeButton)!=null?ut:ge},[D.closeButton,ge]),oo=Ne.useMemo(()=>D.duration||Oe||w6,[D.duration,Oe]),Ta=Ne.useRef(0),ao=Ne.useRef(0),Ja=Ne.useRef(0),So=Ne.useRef(null),[Pc,Yn]=tt.split("-"),Cc=Ne.useMemo(()=>V.reduce((ut,qn,Ci)=>Ci>=Ya?ut:ut+qn.height,0),[V,Ya]),Ic=Xue(),To=D.invert||O,Gl=Pi==="loading";ao.current=Ne.useMemo(()=>Ya*We+Cc,[Ya,Cc]),Ne.useEffect(()=>{Bi.current=oo},[oo]),Ne.useEffect(()=>{br(!0)},[]),Ne.useEffect(()=>{let ut=vs.current;if(ut){let qn=ut.getBoundingClientRect().height;return Wi(qn),G(Ci=>[{toastId:D.id,height:qn,position:D.position},...Ci]),()=>G(Ci=>Ci.filter($s=>$s.toastId!==D.id))}},[G,D.id]),Ne.useLayoutEffect(()=>{if(!Ft)return;let ut=vs.current,qn=ut.style.height;ut.style.height="auto";let Ci=ut.getBoundingClientRect().height;ut.style.height=qn,Wi(Ci),G($s=>$s.find(Br=>Br.toastId===D.id)?$s.map(Br=>Br.toastId===D.id?{...Br,height:Ci}:Br):[{toastId:D.id,height:Ci,position:D.position},...$s])},[Ft,D.title,D.description,G,D.id]);let Ea=Ne.useCallback(()=>{Qt(!0),Us(ao.current),G(ut=>ut.filter(qn=>qn.toastId!==D.id)),setTimeout(()=>{ae(D)},uhe)},[D,ae,G,ao]);Ne.useEffect(()=>{if(D.promise&&Pi==="loading"||D.duration===1/0||D.type==="loading")return;let ut;return ne||N||ct&&Ic?(()=>{if(Ja.current<Ta.current){let qn=new Date().getTime()-Ta.current;Bi.current=Bi.current-qn}Ja.current=new Date().getTime()})():Bi.current!==1/0&&(Ta.current=new Date().getTime(),ut=setTimeout(()=>{var qn;(qn=D.onAutoClose)==null||qn.call(D,D),Ea()},Bi.current)),()=>clearTimeout(ut)},[ne,N,D,Pi,ct,Ic,Ea]),Ne.useEffect(()=>{D.delete&&Ea()},[Ea,D.delete]);function Mc(){var ut,qn,Ci;return vt!=null&&vt.loading?Ne.createElement("div",{className:nc(ht?.loader,(ut=D?.classNames)==null?void 0:ut.loader,"sonner-loader"),"data-visible":Pi==="loading"},vt.loading):lt?Ne.createElement("div",{className:nc(ht?.loader,(qn=D?.classNames)==null?void 0:qn.loader,"sonner-loader"),"data-visible":Pi==="loading"},lt):Ne.createElement(Gue,{className:nc(ht?.loader,(Ci=D?.classNames)==null?void 0:Ci.loader),visible:Pi==="loading"})}return Ne.createElement("li",{tabIndex:0,ref:vs,className:nc(Ke,ju,ht?.toast,(t=D?.classNames)==null?void 0:t.toast,ht?.default,ht?.[Pi],(r=D?.classNames)==null?void 0:r[Pi]),"data-sonner-toast":"","data-rich-colors":(n=D.richColors)!=null?n:le,"data-styled":!(D.jsx||D.unstyled||B),"data-mounted":Ft,"data-promise":!!D.promise,"data-swiped":Kr,"data-removed":Yt,"data-visible":kc,"data-y-position":Pc,"data-x-position":Yn,"data-index":X,"data-front":$l,"data-swiping":Sr,"data-dismissible":xs,"data-type":Pi,"data-invert":To,"data-swipe-out":Nn,"data-swipe-direction":tn,"data-expanded":!!(ne||rt&&Ft),style:{"--index":X,"--toasts-before":X,"--z-index":Y.length-X,"--offset":`${Yt?Fi:ao.current}px`,"--initial-height":rt?"auto":`${ks}px`,...je,...D.style},onDragEnd:()=>{Vt(!1),xr(null),So.current=null},onPointerDown:ut=>{Gl||!xs||(wo.current=new Date,Us(ao.current),ut.target.setPointerCapture(ut.pointerId),ut.target.tagName!=="BUTTON"&&(Vt(!0),So.current={x:ut.clientX,y:ut.clientY}))},onPointerUp:()=>{var ut,qn,Ci,$s;if(Nn||!xs)return;So.current=null;let Br=Number(((ut=vs.current)==null?void 0:ut.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),He=Number(((qn=vs.current)==null?void 0:qn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),se=new Date().getTime()-((Ci=wo.current)==null?void 0:Ci.getTime()),ce=Ut==="x"?Br:He,ye=Math.abs(ce)/se;if(Math.abs(ce)>=che||ye>.11){Us(ao.current),($s=D.onDismiss)==null||$s.call(D,D),Er(Ut==="x"?Br>0?"right":"left":He>0?"down":"up"),Ea(),Jr(!0),Mn(!1);return}Vt(!1),xr(null)},onPointerMove:ut=>{var qn,Ci,$s,Br;if(!So.current||!xs||((qn=window.getSelection())==null?void 0:qn.toString().length)>0)return;let He=ut.clientY-So.current.y,se=ut.clientX-So.current.x,ce=(Ci=e.swipeDirections)!=null?Ci:hhe(tt);!Ut&&(Math.abs(se)>1||Math.abs(He)>1)&&xr(Math.abs(se)>Math.abs(He)?"x":"y");let ye={x:0,y:0};Ut==="y"?(ce.includes("top")||ce.includes("bottom"))&&(ce.includes("top")&&He<0||ce.includes("bottom")&&He>0)&&(ye.y=He):Ut==="x"&&(ce.includes("left")||ce.includes("right"))&&(ce.includes("left")&&se<0||ce.includes("right")&&se>0)&&(ye.x=se),(Math.abs(ye.x)>0||Math.abs(ye.y)>0)&&Mn(!0),($s=vs.current)==null||$s.style.setProperty("--swipe-amount-x",`${ye.x}px`),(Br=vs.current)==null||Br.style.setProperty("--swipe-amount-y",`${ye.y}px`)}},Ps&&!D.jsx?Ne.createElement("button",{"aria-label":mt,"data-disabled":Gl,"data-close-button":!0,onClick:Gl||!xs?()=>{}:()=>{var ut;Ea(),(ut=D.onDismiss)==null||ut.call(D,D)},className:nc(ht?.closeButton,(c=D?.classNames)==null?void 0:c.closeButton)},(h=vt?.close)!=null?h:Kue):null,D.jsx||Z.isValidElement(D.title)?D.jsx?D.jsx:typeof D.title=="function"?D.title():D.title:Ne.createElement(Ne.Fragment,null,Pi||D.icon||D.promise?Ne.createElement("div",{"data-icon":"",className:nc(ht?.icon,(p=D?.classNames)==null?void 0:p.icon)},D.promise||D.type==="loading"&&!D.icon?D.icon||Mc():null,D.type!=="loading"?D.icon||vt?.[Pi]||Uue(Pi):null):null,Ne.createElement("div",{"data-content":"",className:nc(ht?.content,(s=D?.classNames)==null?void 0:s.content)},Ne.createElement("div",{"data-title":"",className:nc(ht?.title,(v=D?.classNames)==null?void 0:v.title)},typeof D.title=="function"?D.title():D.title),D.description?Ne.createElement("div",{"data-description":"",className:nc(Ye,Xa,ht?.description,(w=D?.classNames)==null?void 0:w.description)},typeof D.description=="function"?D.description():D.description):null),Z.isValidElement(D.cancel)?D.cancel:D.cancel&&MT(D.cancel)?Ne.createElement("button",{"data-button":!0,"data-cancel":!0,style:D.cancelButtonStyle||ze,onClick:ut=>{var qn,Ci;MT(D.cancel)&&xs&&((Ci=(qn=D.cancel).onClick)==null||Ci.call(qn,ut),Ea())},className:nc(ht?.cancelButton,(T=D?.classNames)==null?void 0:T.cancelButton)},D.cancel.label):null,Z.isValidElement(D.action)?D.action:D.action&&MT(D.action)?Ne.createElement("button",{"data-button":!0,"data-action":!0,style:D.actionButtonStyle||Pe,onClick:ut=>{var qn,Ci;MT(D.action)&&((Ci=(qn=D.action).onClick)==null||Ci.call(qn,ut),!ut.defaultPrevented&&Ea())},className:nc(ht?.actionButton,(I=D?.classNames)==null?void 0:I.actionButton)},D.action.label):null))};function S6(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function fhe(e,t){let r={};return[e,t].forEach((n,c)=>{let h=c===1,p=h?"--mobile-offset":"--offset",s=h?ohe:she;function v(w){["top","right","bottom","left"].forEach(T=>{r[`${p}-${T}`]=typeof w=="number"?`${w}px`:w})}typeof n=="number"||typeof n=="string"?v(n):typeof n=="object"?["top","right","bottom","left"].forEach(w=>{n[w]===void 0?r[`${p}-${w}`]=s:r[`${p}-${w}`]=typeof n[w]=="number"?`${n[w]}px`:n[w]}):v(s)}),r}var phe=Z.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:c=["altKey","KeyT"],expand:h,closeButton:p,className:s,offset:v,mobileOffset:w,theme:T="light",richColors:I,duration:O,style:D,visibleToasts:B=ihe,toastOptions:N,dir:G=S6(),gap:U=lhe,loadingIcon:V,icons:X,containerAriaLabel:Y="Notifications",pauseWhenPageIsHidden:ne}=e,[ae,le]=Ne.useState([]),ge=Ne.useMemo(()=>Array.from(new Set([n].concat(ae.filter(ct=>ct.position).map(ct=>ct.position)))),[ae,n]),[je,ze]=Ne.useState([]),[Pe,Ke]=Ne.useState(!1),[Ye,Oe]=Ne.useState(!1),[tt,We]=Ne.useState(T!=="system"?T:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),lt=Ne.useRef(null),rt=c.join("+").replace(/Key/g,"").replace(/Digit/g,""),ht=Ne.useRef(null),vt=Ne.useRef(!1),mt=Ne.useCallback(ct=>{le(Ut=>{var xr;return(xr=Ut.find(tn=>tn.id===ct.id))!=null&&xr.delete||za.dismiss(ct.id),Ut.filter(({id:tn})=>tn!==ct.id)})},[]);return Ne.useEffect(()=>za.subscribe(ct=>{if(ct.dismiss){le(Ut=>Ut.map(xr=>xr.id===ct.id?{...xr,delete:!0}:xr));return}setTimeout(()=>{_q.flushSync(()=>{le(Ut=>{let xr=Ut.findIndex(tn=>tn.id===ct.id);return xr!==-1?[...Ut.slice(0,xr),{...Ut[xr],...ct},...Ut.slice(xr+1)]:[ct,...Ut]})})})}),[]),Ne.useEffect(()=>{if(T!=="system"){We(T);return}if(T==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?We("dark"):We("light")),typeof window>"u")return;let ct=window.matchMedia("(prefers-color-scheme: dark)");try{ct.addEventListener("change",({matches:Ut})=>{We(Ut?"dark":"light")})}catch{ct.addListener(({matches:Ut})=>{try{We(Ut?"dark":"light")}catch(xr){console.error(xr)}})}},[T]),Ne.useEffect(()=>{ae.length<=1&&Ke(!1)},[ae]),Ne.useEffect(()=>{let ct=Ut=>{var xr,tn;c.every(Er=>Ut[Er]||Ut.code===Er)&&(Ke(!0),(xr=lt.current)==null||xr.focus()),Ut.code==="Escape"&&(document.activeElement===lt.current||(tn=lt.current)!=null&&tn.contains(document.activeElement))&&Ke(!1)};return document.addEventListener("keydown",ct),()=>document.removeEventListener("keydown",ct)},[c]),Ne.useEffect(()=>{if(lt.current)return()=>{ht.current&&(ht.current.focus({preventScroll:!0}),ht.current=null,vt.current=!1)}},[lt.current]),Ne.createElement("section",{ref:t,"aria-label":`${Y} ${rt}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},ge.map((ct,Ut)=>{var xr;let[tn,Er]=ct.split("-");return ae.length?Ne.createElement("ol",{key:ct,dir:G==="auto"?S6():G,tabIndex:-1,ref:lt,className:s,"data-sonner-toaster":!0,"data-theme":tt,"data-y-position":tn,"data-lifted":Pe&&ae.length>1&&!h,"data-x-position":Er,style:{"--front-toast-height":`${((xr=je[0])==null?void 0:xr.height)||0}px`,"--width":`${ahe}px`,"--gap":`${U}px`,...D,...fhe(v,w)},onBlur:Ft=>{vt.current&&!Ft.currentTarget.contains(Ft.relatedTarget)&&(vt.current=!1,ht.current&&(ht.current.focus({preventScroll:!0}),ht.current=null))},onFocus:Ft=>{Ft.target instanceof HTMLElement&&Ft.target.dataset.dismissible==="false"||vt.current||(vt.current=!0,ht.current=Ft.relatedTarget)},onMouseEnter:()=>Ke(!0),onMouseMove:()=>Ke(!0),onMouseLeave:()=>{Ye||Ke(!1)},onDragEnd:()=>Ke(!1),onPointerDown:Ft=>{Ft.target instanceof HTMLElement&&Ft.target.dataset.dismissible==="false"||Oe(!0)},onPointerUp:()=>Oe(!1)},ae.filter(Ft=>!Ft.position&&Ut===0||Ft.position===ct).map((Ft,br)=>{var Yt,Qt;return Ne.createElement(dhe,{key:Ft.id,icons:X,index:br,toast:Ft,defaultRichColors:I,duration:(Yt=N?.duration)!=null?Yt:O,className:N?.className,descriptionClassName:N?.descriptionClassName,invert:r,visibleToasts:B,closeButton:(Qt=N?.closeButton)!=null?Qt:p,interacting:Ye,position:ct,style:N?.style,unstyled:N?.unstyled,classNames:N?.classNames,cancelButtonStyle:N?.cancelButtonStyle,actionButtonStyle:N?.actionButtonStyle,removeToast:mt,toasts:ae.filter(Sr=>Sr.position==Ft.position),heights:je.filter(Sr=>Sr.position==Ft.position),setHeights:ze,expandByDefault:h,gap:U,loadingIcon:V,expanded:Pe,pauseWhenPageIsHidden:ne,swipeDirections:e.swipeDirections})})):null}))});const mhe=({...e})=>P.jsx(phe,{theme:"light",className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e});var ghe=GD[" useId ".trim().toString()]||(()=>{}),yhe=0;function hf(e){const[t,r]=Z.useState(ghe());return xo(()=>{r(n=>n??String(yhe++))},[e]),t?`radix-${t}`:""}const _he=["top","right","bottom","left"],gf=Math.min,al=Math.max,sE=Math.round,OT=Math.floor,vu=e=>({x:e,y:e}),vhe={left:"right",right:"left",bottom:"top",top:"bottom"},xhe={start:"end",end:"start"};function oj(e,t,r){return al(e,gf(t,r))}function kh(e,t){return typeof e=="function"?e(t):e}function Ph(e){return e.split("-")[0]}function Q_(e){return e.split("-")[1]}function WL(e){return e==="x"?"y":"x"}function qL(e){return e==="y"?"height":"width"}const bhe=new Set(["top","bottom"]);function pu(e){return bhe.has(Ph(e))?"y":"x"}function ZL(e){return WL(pu(e))}function whe(e,t,r){r===void 0&&(r=!1);const n=Q_(e),c=ZL(e),h=qL(c);let p=c==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[h]>t.floating[h]&&(p=oE(p)),[p,oE(p)]}function She(e){const t=oE(e);return[aj(e),t,aj(t)]}function aj(e){return e.replace(/start|end/g,t=>xhe[t])}const T6=["left","right"],E6=["right","left"],The=["top","bottom"],Ehe=["bottom","top"];function Ahe(e,t,r){switch(e){case"top":case"bottom":return r?t?E6:T6:t?T6:E6;case"left":case"right":return t?The:Ehe;default:return[]}}function khe(e,t,r,n){const c=Q_(e);let h=Ahe(Ph(e),r==="start",n);return c&&(h=h.map(p=>p+"-"+c),t&&(h=h.concat(h.map(aj)))),h}function oE(e){return e.replace(/left|right|bottom|top/g,t=>vhe[t])}function Phe(e){return{top:0,right:0,bottom:0,left:0,...e}}function h9(e){return typeof e!="number"?Phe(e):{top:e,right:e,bottom:e,left:e}}function aE(e){const{x:t,y:r,width:n,height:c}=e;return{width:n,height:c,top:r,left:t,right:t+n,bottom:r+c,x:t,y:r}}function A6(e,t,r){let{reference:n,floating:c}=e;const h=pu(t),p=ZL(t),s=qL(p),v=Ph(t),w=h==="y",T=n.x+n.width/2-c.width/2,I=n.y+n.height/2-c.height/2,O=n[s]/2-c[s]/2;let D;switch(v){case"top":D={x:T,y:n.y-c.height};break;case"bottom":D={x:T,y:n.y+n.height};break;case"right":D={x:n.x+n.width,y:I};break;case"left":D={x:n.x-c.width,y:I};break;default:D={x:n.x,y:n.y}}switch(Q_(t)){case"start":D[p]-=O*(r&&w?-1:1);break;case"end":D[p]+=O*(r&&w?-1:1);break}return D}const Che=async(e,t,r)=>{const{placement:n="bottom",strategy:c="absolute",middleware:h=[],platform:p}=r,s=h.filter(Boolean),v=await(p.isRTL==null?void 0:p.isRTL(t));let w=await p.getElementRects({reference:e,floating:t,strategy:c}),{x:T,y:I}=A6(w,n,v),O=n,D={},B=0;for(let N=0;N<s.length;N++){const{name:G,fn:U}=s[N],{x:V,y:X,data:Y,reset:ne}=await U({x:T,y:I,initialPlacement:n,placement:O,strategy:c,middlewareData:D,rects:w,platform:p,elements:{reference:e,floating:t}});T=V??T,I=X??I,D={...D,[G]:{...D[G],...Y}},ne&&B<=50&&(B++,typeof ne=="object"&&(ne.placement&&(O=ne.placement),ne.rects&&(w=ne.rects===!0?await p.getElementRects({reference:e,floating:t,strategy:c}):ne.rects),{x:T,y:I}=A6(w,O,v)),N=-1)}return{x:T,y:I,placement:O,strategy:c,middlewareData:D}};async function Kb(e,t){var r;t===void 0&&(t={});const{x:n,y:c,platform:h,rects:p,elements:s,strategy:v}=e,{boundary:w="clippingAncestors",rootBoundary:T="viewport",elementContext:I="floating",altBoundary:O=!1,padding:D=0}=kh(t,e),B=h9(D),N=s[O?I==="floating"?"reference":"floating":I],G=aE(await h.getClippingRect({element:(r=await(h.isElement==null?void 0:h.isElement(N)))==null||r?N:N.contextElement||await(h.getDocumentElement==null?void 0:h.getDocumentElement(s.floating)),boundary:w,rootBoundary:T,strategy:v})),U=I==="floating"?{x:n,y:c,width:p.floating.width,height:p.floating.height}:p.reference,V=await(h.getOffsetParent==null?void 0:h.getOffsetParent(s.floating)),X=await(h.isElement==null?void 0:h.isElement(V))?await(h.getScale==null?void 0:h.getScale(V))||{x:1,y:1}:{x:1,y:1},Y=aE(h.convertOffsetParentRelativeRectToViewportRelativeRect?await h.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:U,offsetParent:V,strategy:v}):U);return{top:(G.top-Y.top+B.top)/X.y,bottom:(Y.bottom-G.bottom+B.bottom)/X.y,left:(G.left-Y.left+B.left)/X.x,right:(Y.right-G.right+B.right)/X.x}}const Ihe=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:c,rects:h,platform:p,elements:s,middlewareData:v}=t,{element:w,padding:T=0}=kh(e,t)||{};if(w==null)return{};const I=h9(T),O={x:r,y:n},D=ZL(c),B=qL(D),N=await p.getDimensions(w),G=D==="y",U=G?"top":"left",V=G?"bottom":"right",X=G?"clientHeight":"clientWidth",Y=h.reference[B]+h.reference[D]-O[D]-h.floating[B],ne=O[D]-h.reference[D],ae=await(p.getOffsetParent==null?void 0:p.getOffsetParent(w));let le=ae?ae[X]:0;(!le||!await(p.isElement==null?void 0:p.isElement(ae)))&&(le=s.floating[X]||h.floating[B]);const ge=Y/2-ne/2,je=le/2-N[B]/2-1,ze=gf(I[U],je),Pe=gf(I[V],je),Ke=ze,Ye=le-N[B]-Pe,Oe=le/2-N[B]/2+ge,tt=oj(Ke,Oe,Ye),We=!v.arrow&&Q_(c)!=null&&Oe!==tt&&h.reference[B]/2-(Oe<Ke?ze:Pe)-N[B]/2<0,lt=We?Oe<Ke?Oe-Ke:Oe-Ye:0;return{[D]:O[D]+lt,data:{[D]:tt,centerOffset:Oe-tt-lt,...We&&{alignmentOffset:lt}},reset:We}}}),Mhe=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:c,middlewareData:h,rects:p,initialPlacement:s,platform:v,elements:w}=t,{mainAxis:T=!0,crossAxis:I=!0,fallbackPlacements:O,fallbackStrategy:D="bestFit",fallbackAxisSideDirection:B="none",flipAlignment:N=!0,...G}=kh(e,t);if((r=h.arrow)!=null&&r.alignmentOffset)return{};const U=Ph(c),V=pu(s),X=Ph(s)===s,Y=await(v.isRTL==null?void 0:v.isRTL(w.floating)),ne=O||(X||!N?[oE(s)]:She(s)),ae=B!=="none";!O&&ae&&ne.push(...khe(s,N,B,Y));const le=[s,...ne],ge=await Kb(t,G),je=[];let ze=((n=h.flip)==null?void 0:n.overflows)||[];if(T&&je.push(ge[U]),I){const Oe=whe(c,p,Y);je.push(ge[Oe[0]],ge[Oe[1]])}if(ze=[...ze,{placement:c,overflows:je}],!je.every(Oe=>Oe<=0)){var Pe,Ke;const Oe=(((Pe=h.flip)==null?void 0:Pe.index)||0)+1,tt=le[Oe];if(tt&&(!(I==="alignment"&&V!==pu(tt))||ze.every(lt=>pu(lt.placement)===V?lt.overflows[0]>0:!0)))return{data:{index:Oe,overflows:ze},reset:{placement:tt}};let We=(Ke=ze.filter(lt=>lt.overflows[0]<=0).sort((lt,rt)=>lt.overflows[1]-rt.overflows[1])[0])==null?void 0:Ke.placement;if(!We)switch(D){case"bestFit":{var Ye;const lt=(Ye=ze.filter(rt=>{if(ae){const ht=pu(rt.placement);return ht===V||ht==="y"}return!0}).map(rt=>[rt.placement,rt.overflows.filter(ht=>ht>0).reduce((ht,vt)=>ht+vt,0)]).sort((rt,ht)=>rt[1]-ht[1])[0])==null?void 0:Ye[0];lt&&(We=lt);break}case"initialPlacement":We=s;break}if(c!==We)return{reset:{placement:We}}}return{}}}};function k6(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function P6(e){return _he.some(t=>e[t]>=0)}const Ohe=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...c}=kh(e,t);switch(n){case"referenceHidden":{const h=await Kb(t,{...c,elementContext:"reference"}),p=k6(h,r.reference);return{data:{referenceHiddenOffsets:p,referenceHidden:P6(p)}}}case"escaped":{const h=await Kb(t,{...c,altBoundary:!0}),p=k6(h,r.floating);return{data:{escapedOffsets:p,escaped:P6(p)}}}default:return{}}}}},d9=new Set(["left","top"]);async function jhe(e,t){const{placement:r,platform:n,elements:c}=e,h=await(n.isRTL==null?void 0:n.isRTL(c.floating)),p=Ph(r),s=Q_(r),v=pu(r)==="y",w=d9.has(p)?-1:1,T=h&&v?-1:1,I=kh(t,e);let{mainAxis:O,crossAxis:D,alignmentAxis:B}=typeof I=="number"?{mainAxis:I,crossAxis:0,alignmentAxis:null}:{mainAxis:I.mainAxis||0,crossAxis:I.crossAxis||0,alignmentAxis:I.alignmentAxis};return s&&typeof B=="number"&&(D=s==="end"?B*-1:B),v?{x:D*T,y:O*w}:{x:O*w,y:D*T}}const Rhe=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:c,y:h,placement:p,middlewareData:s}=t,v=await jhe(t,e);return p===((r=s.offset)==null?void 0:r.placement)&&(n=s.arrow)!=null&&n.alignmentOffset?{}:{x:c+v.x,y:h+v.y,data:{...v,placement:p}}}}},Dhe=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:c}=t,{mainAxis:h=!0,crossAxis:p=!1,limiter:s={fn:G=>{let{x:U,y:V}=G;return{x:U,y:V}}},...v}=kh(e,t),w={x:r,y:n},T=await Kb(t,v),I=pu(Ph(c)),O=WL(I);let D=w[O],B=w[I];if(h){const G=O==="y"?"top":"left",U=O==="y"?"bottom":"right",V=D+T[G],X=D-T[U];D=oj(V,D,X)}if(p){const G=I==="y"?"top":"left",U=I==="y"?"bottom":"right",V=B+T[G],X=B-T[U];B=oj(V,B,X)}const N=s.fn({...t,[O]:D,[I]:B});return{...N,data:{x:N.x-r,y:N.y-n,enabled:{[O]:h,[I]:p}}}}}},Lhe=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:c,rects:h,middlewareData:p}=t,{offset:s=0,mainAxis:v=!0,crossAxis:w=!0}=kh(e,t),T={x:r,y:n},I=pu(c),O=WL(I);let D=T[O],B=T[I];const N=kh(s,t),G=typeof N=="number"?{mainAxis:N,crossAxis:0}:{mainAxis:0,crossAxis:0,...N};if(v){const X=O==="y"?"height":"width",Y=h.reference[O]-h.floating[X]+G.mainAxis,ne=h.reference[O]+h.reference[X]-G.mainAxis;D<Y?D=Y:D>ne&&(D=ne)}if(w){var U,V;const X=O==="y"?"width":"height",Y=d9.has(Ph(c)),ne=h.reference[I]-h.floating[X]+(Y&&((U=p.offset)==null?void 0:U[I])||0)+(Y?0:G.crossAxis),ae=h.reference[I]+h.reference[X]+(Y?0:((V=p.offset)==null?void 0:V[I])||0)-(Y?G.crossAxis:0);B<ne?B=ne:B>ae&&(B=ae)}return{[O]:D,[I]:B}}}},zhe=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:c,rects:h,platform:p,elements:s}=t,{apply:v=()=>{},...w}=kh(e,t),T=await Kb(t,w),I=Ph(c),O=Q_(c),D=pu(c)==="y",{width:B,height:N}=h.floating;let G,U;I==="top"||I==="bottom"?(G=I,U=O===(await(p.isRTL==null?void 0:p.isRTL(s.floating))?"start":"end")?"left":"right"):(U=I,G=O==="end"?"top":"bottom");const V=N-T.top-T.bottom,X=B-T.left-T.right,Y=gf(N-T[G],V),ne=gf(B-T[U],X),ae=!t.middlewareData.shift;let le=Y,ge=ne;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(ge=X),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(le=V),ae&&!O){const ze=al(T.left,0),Pe=al(T.right,0),Ke=al(T.top,0),Ye=al(T.bottom,0);D?ge=B-2*(ze!==0||Pe!==0?ze+Pe:al(T.left,T.right)):le=N-2*(Ke!==0||Ye!==0?Ke+Ye:al(T.top,T.bottom))}await v({...t,availableWidth:ge,availableHeight:le});const je=await p.getDimensions(s.floating);return B!==je.width||N!==je.height?{reset:{rects:!0}}:{}}}};function WA(){return typeof window<"u"}function ev(e){return f9(e)?(e.nodeName||"").toLowerCase():"#document"}function dl(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Cu(e){var t;return(t=(f9(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function f9(e){return WA()?e instanceof Node||e instanceof dl(e).Node:!1}function xc(e){return WA()?e instanceof Element||e instanceof dl(e).Element:!1}function ku(e){return WA()?e instanceof HTMLElement||e instanceof dl(e).HTMLElement:!1}function C6(e){return!WA()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof dl(e).ShadowRoot}const Nhe=new Set(["inline","contents"]);function Kw(e){const{overflow:t,overflowX:r,overflowY:n,display:c}=bc(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!Nhe.has(c)}const Fhe=new Set(["table","td","th"]);function Bhe(e){return Fhe.has(ev(e))}const Vhe=[":popover-open",":modal"];function qA(e){return Vhe.some(t=>{try{return e.matches(t)}catch{return!1}})}const Uhe=["transform","translate","scale","rotate","perspective"],$he=["transform","translate","scale","rotate","perspective","filter"],Ghe=["paint","layout","strict","content"];function KL(e){const t=XL(),r=xc(e)?bc(e):e;return Uhe.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||$he.some(n=>(r.willChange||"").includes(n))||Ghe.some(n=>(r.contain||"").includes(n))}function Hhe(e){let t=yf(e);for(;ku(t)&&!y_(t);){if(KL(t))return t;if(qA(t))return null;t=yf(t)}return null}function XL(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Whe=new Set(["html","body","#document"]);function y_(e){return Whe.has(ev(e))}function bc(e){return dl(e).getComputedStyle(e)}function ZA(e){return xc(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function yf(e){if(ev(e)==="html")return e;const t=e.assignedSlot||e.parentNode||C6(e)&&e.host||Cu(e);return C6(t)?t.host:t}function p9(e){const t=yf(e);return y_(t)?e.ownerDocument?e.ownerDocument.body:e.body:ku(t)&&Kw(t)?t:p9(t)}function Xb(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const c=p9(e),h=c===((n=e.ownerDocument)==null?void 0:n.body),p=dl(c);if(h){const s=lj(p);return t.concat(p,p.visualViewport||[],Kw(c)?c:[],s&&r?Xb(s):[])}return t.concat(c,Xb(c,[],r))}function lj(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function m9(e){const t=bc(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const c=ku(e),h=c?e.offsetWidth:r,p=c?e.offsetHeight:n,s=sE(r)!==h||sE(n)!==p;return s&&(r=h,n=p),{width:r,height:n,$:s}}function YL(e){return xc(e)?e:e.contextElement}function Qy(e){const t=YL(e);if(!ku(t))return vu(1);const r=t.getBoundingClientRect(),{width:n,height:c,$:h}=m9(t);let p=(h?sE(r.width):r.width)/n,s=(h?sE(r.height):r.height)/c;return(!p||!Number.isFinite(p))&&(p=1),(!s||!Number.isFinite(s))&&(s=1),{x:p,y:s}}const qhe=vu(0);function g9(e){const t=dl(e);return!XL()||!t.visualViewport?qhe:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Zhe(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==dl(e)?!1:t}function _m(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const c=e.getBoundingClientRect(),h=YL(e);let p=vu(1);t&&(n?xc(n)&&(p=Qy(n)):p=Qy(e));const s=Zhe(h,r,n)?g9(h):vu(0);let v=(c.left+s.x)/p.x,w=(c.top+s.y)/p.y,T=c.width/p.x,I=c.height/p.y;if(h){const O=dl(h),D=n&&xc(n)?dl(n):n;let B=O,N=lj(B);for(;N&&n&&D!==B;){const G=Qy(N),U=N.getBoundingClientRect(),V=bc(N),X=U.left+(N.clientLeft+parseFloat(V.paddingLeft))*G.x,Y=U.top+(N.clientTop+parseFloat(V.paddingTop))*G.y;v*=G.x,w*=G.y,T*=G.x,I*=G.y,v+=X,w+=Y,B=dl(N),N=lj(B)}}return aE({width:T,height:I,x:v,y:w})}function KA(e,t){const r=ZA(e).scrollLeft;return t?t.left+r:_m(Cu(e)).left+r}function y9(e,t){const r=e.getBoundingClientRect(),n=r.left+t.scrollLeft-KA(e,r),c=r.top+t.scrollTop;return{x:n,y:c}}function Khe(e){let{elements:t,rect:r,offsetParent:n,strategy:c}=e;const h=c==="fixed",p=Cu(n),s=t?qA(t.floating):!1;if(n===p||s&&h)return r;let v={scrollLeft:0,scrollTop:0},w=vu(1);const T=vu(0),I=ku(n);if((I||!I&&!h)&&((ev(n)!=="body"||Kw(p))&&(v=ZA(n)),ku(n))){const D=_m(n);w=Qy(n),T.x=D.x+n.clientLeft,T.y=D.y+n.clientTop}const O=p&&!I&&!h?y9(p,v):vu(0);return{width:r.width*w.x,height:r.height*w.y,x:r.x*w.x-v.scrollLeft*w.x+T.x+O.x,y:r.y*w.y-v.scrollTop*w.y+T.y+O.y}}function Xhe(e){return Array.from(e.getClientRects())}function Yhe(e){const t=Cu(e),r=ZA(e),n=e.ownerDocument.body,c=al(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),h=al(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let p=-r.scrollLeft+KA(e);const s=-r.scrollTop;return bc(n).direction==="rtl"&&(p+=al(t.clientWidth,n.clientWidth)-c),{width:c,height:h,x:p,y:s}}const I6=25;function Jhe(e,t){const r=dl(e),n=Cu(e),c=r.visualViewport;let h=n.clientWidth,p=n.clientHeight,s=0,v=0;if(c){h=c.width,p=c.height;const T=XL();(!T||T&&t==="fixed")&&(s=c.offsetLeft,v=c.offsetTop)}const w=KA(n);if(w<=0){const T=n.ownerDocument,I=T.body,O=getComputedStyle(I),D=T.compatMode==="CSS1Compat"&&parseFloat(O.marginLeft)+parseFloat(O.marginRight)||0,B=Math.abs(n.clientWidth-I.clientWidth-D);B<=I6&&(h-=B)}else w<=I6&&(h+=w);return{width:h,height:p,x:s,y:v}}const Qhe=new Set(["absolute","fixed"]);function ede(e,t){const r=_m(e,!0,t==="fixed"),n=r.top+e.clientTop,c=r.left+e.clientLeft,h=ku(e)?Qy(e):vu(1),p=e.clientWidth*h.x,s=e.clientHeight*h.y,v=c*h.x,w=n*h.y;return{width:p,height:s,x:v,y:w}}function M6(e,t,r){let n;if(t==="viewport")n=Jhe(e,r);else if(t==="document")n=Yhe(Cu(e));else if(xc(t))n=ede(t,r);else{const c=g9(e);n={x:t.x-c.x,y:t.y-c.y,width:t.width,height:t.height}}return aE(n)}function _9(e,t){const r=yf(e);return r===t||!xc(r)||y_(r)?!1:bc(r).position==="fixed"||_9(r,t)}function tde(e,t){const r=t.get(e);if(r)return r;let n=Xb(e,[],!1).filter(s=>xc(s)&&ev(s)!=="body"),c=null;const h=bc(e).position==="fixed";let p=h?yf(e):e;for(;xc(p)&&!y_(p);){const s=bc(p),v=KL(p);!v&&s.position==="fixed"&&(c=null),(h?!v&&!c:!v&&s.position==="static"&&c&&Qhe.has(c.position)||Kw(p)&&!v&&_9(e,p))?n=n.filter(w=>w!==p):c=s,p=yf(p)}return t.set(e,n),n}function rde(e){let{element:t,boundary:r,rootBoundary:n,strategy:c}=e;const h=[...r==="clippingAncestors"?qA(t)?[]:tde(t,this._c):[].concat(r),n],p=h[0],s=h.reduce((v,w)=>{const T=M6(t,w,c);return v.top=al(T.top,v.top),v.right=gf(T.right,v.right),v.bottom=gf(T.bottom,v.bottom),v.left=al(T.left,v.left),v},M6(t,p,c));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function nde(e){const{width:t,height:r}=m9(e);return{width:t,height:r}}function ide(e,t,r){const n=ku(t),c=Cu(t),h=r==="fixed",p=_m(e,!0,h,t);let s={scrollLeft:0,scrollTop:0};const v=vu(0);function w(){v.x=KA(c)}if(n||!n&&!h)if((ev(t)!=="body"||Kw(c))&&(s=ZA(t)),n){const D=_m(t,!0,h,t);v.x=D.x+t.clientLeft,v.y=D.y+t.clientTop}else c&&w();h&&!n&&c&&w();const T=c&&!n&&!h?y9(c,s):vu(0),I=p.left+s.scrollLeft-v.x-T.x,O=p.top+s.scrollTop-v.y-T.y;return{x:I,y:O,width:p.width,height:p.height}}function ZI(e){return bc(e).position==="static"}function O6(e,t){if(!ku(e)||bc(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Cu(e)===r&&(r=r.ownerDocument.body),r}function v9(e,t){const r=dl(e);if(qA(e))return r;if(!ku(e)){let c=yf(e);for(;c&&!y_(c);){if(xc(c)&&!ZI(c))return c;c=yf(c)}return r}let n=O6(e,t);for(;n&&Bhe(n)&&ZI(n);)n=O6(n,t);return n&&y_(n)&&ZI(n)&&!KL(n)?r:n||Hhe(e)||r}const sde=async function(e){const t=this.getOffsetParent||v9,r=this.getDimensions,n=await r(e.floating);return{reference:ide(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function ode(e){return bc(e).direction==="rtl"}const ade={convertOffsetParentRelativeRectToViewportRelativeRect:Khe,getDocumentElement:Cu,getClippingRect:rde,getOffsetParent:v9,getElementRects:sde,getClientRects:Xhe,getDimensions:nde,getScale:Qy,isElement:xc,isRTL:ode};function x9(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function lde(e,t){let r=null,n;const c=Cu(e);function h(){var s;clearTimeout(n),(s=r)==null||s.disconnect(),r=null}function p(s,v){s===void 0&&(s=!1),v===void 0&&(v=1),h();const w=e.getBoundingClientRect(),{left:T,top:I,width:O,height:D}=w;if(s||t(),!O||!D)return;const B=OT(I),N=OT(c.clientWidth-(T+O)),G=OT(c.clientHeight-(I+D)),U=OT(T),V={rootMargin:-B+"px "+-N+"px "+-G+"px "+-U+"px",threshold:al(0,gf(1,v))||1};let X=!0;function Y(ne){const ae=ne[0].intersectionRatio;if(ae!==v){if(!X)return p();ae?p(!1,ae):n=setTimeout(()=>{p(!1,1e-7)},1e3)}ae===1&&!x9(w,e.getBoundingClientRect())&&p(),X=!1}try{r=new IntersectionObserver(Y,{...V,root:c.ownerDocument})}catch{r=new IntersectionObserver(Y,V)}r.observe(e)}return p(!0),h}function cde(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:c=!0,ancestorResize:h=!0,elementResize:p=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:v=!1}=n,w=YL(e),T=c||h?[...w?Xb(w):[],...Xb(t)]:[];T.forEach(U=>{c&&U.addEventListener("scroll",r,{passive:!0}),h&&U.addEventListener("resize",r)});const I=w&&s?lde(w,r):null;let O=-1,D=null;p&&(D=new ResizeObserver(U=>{let[V]=U;V&&V.target===w&&D&&(D.unobserve(t),cancelAnimationFrame(O),O=requestAnimationFrame(()=>{var X;(X=D)==null||X.observe(t)})),r()}),w&&!v&&D.observe(w),D.observe(t));let B,N=v?_m(e):null;v&&G();function G(){const U=_m(e);N&&!x9(N,U)&&r(),N=U,B=requestAnimationFrame(G)}return r(),()=>{var U;T.forEach(V=>{c&&V.removeEventListener("scroll",r),h&&V.removeEventListener("resize",r)}),I?.(),(U=D)==null||U.disconnect(),D=null,v&&cancelAnimationFrame(B)}}const ude=Rhe,hde=Dhe,dde=Mhe,fde=zhe,pde=Ohe,j6=Ihe,mde=Lhe,gde=(e,t,r)=>{const n=new Map,c={platform:ade,...r},h={...c.platform,_c:n};return Che(e,t,{...c,platform:h})};var yde=typeof document<"u",_de=function(){},T2=yde?Z.useLayoutEffect:_de;function lE(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,c;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!lE(e[n],t[n]))return!1;return!0}if(c=Object.keys(e),r=c.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,c[n]))return!1;for(n=r;n--!==0;){const h=c[n];if(!(h==="_owner"&&e.$$typeof)&&!lE(e[h],t[h]))return!1}return!0}return e!==e&&t!==t}function b9(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function R6(e,t){const r=b9(e);return Math.round(t*r)/r}function KI(e){const t=Z.useRef(e);return T2(()=>{t.current=e}),t}function vde(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:c,elements:{reference:h,floating:p}={},transform:s=!0,whileElementsMounted:v,open:w}=e,[T,I]=Z.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[O,D]=Z.useState(n);lE(O,n)||D(n);const[B,N]=Z.useState(null),[G,U]=Z.useState(null),V=Z.useCallback(rt=>{rt!==ae.current&&(ae.current=rt,N(rt))},[]),X=Z.useCallback(rt=>{rt!==le.current&&(le.current=rt,U(rt))},[]),Y=h||B,ne=p||G,ae=Z.useRef(null),le=Z.useRef(null),ge=Z.useRef(T),je=v!=null,ze=KI(v),Pe=KI(c),Ke=KI(w),Ye=Z.useCallback(()=>{if(!ae.current||!le.current)return;const rt={placement:t,strategy:r,middleware:O};Pe.current&&(rt.platform=Pe.current),gde(ae.current,le.current,rt).then(ht=>{const vt={...ht,isPositioned:Ke.current!==!1};Oe.current&&!lE(ge.current,vt)&&(ge.current=vt,Om.flushSync(()=>{I(vt)}))})},[O,t,r,Pe,Ke]);T2(()=>{w===!1&&ge.current.isPositioned&&(ge.current.isPositioned=!1,I(rt=>({...rt,isPositioned:!1})))},[w]);const Oe=Z.useRef(!1);T2(()=>(Oe.current=!0,()=>{Oe.current=!1}),[]),T2(()=>{if(Y&&(ae.current=Y),ne&&(le.current=ne),Y&&ne){if(ze.current)return ze.current(Y,ne,Ye);Ye()}},[Y,ne,Ye,ze,je]);const tt=Z.useMemo(()=>({reference:ae,floating:le,setReference:V,setFloating:X}),[V,X]),We=Z.useMemo(()=>({reference:Y,floating:ne}),[Y,ne]),lt=Z.useMemo(()=>{const rt={position:r,left:0,top:0};if(!We.floating)return rt;const ht=R6(We.floating,T.x),vt=R6(We.floating,T.y);return s?{...rt,transform:"translate("+ht+"px, "+vt+"px)",...b9(We.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:ht,top:vt}},[r,s,We.floating,T.x,T.y]);return Z.useMemo(()=>({...T,update:Ye,refs:tt,elements:We,floatingStyles:lt}),[T,Ye,tt,We,lt])}const xde=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:c}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?j6({element:n.current,padding:c}).fn(r):{}:n?j6({element:n,padding:c}).fn(r):{}}}},bde=(e,t)=>({...ude(e),options:[e,t]}),wde=(e,t)=>({...hde(e),options:[e,t]}),Sde=(e,t)=>({...mde(e),options:[e,t]}),Tde=(e,t)=>({...dde(e),options:[e,t]}),Ede=(e,t)=>({...fde(e),options:[e,t]}),Ade=(e,t)=>({...pde(e),options:[e,t]}),kde=(e,t)=>({...xde(e),options:[e,t]});var Pde="Arrow",w9=Z.forwardRef((e,t)=>{const{children:r,width:n=10,height:c=5,...h}=e;return P.jsx(fn.svg,{...h,ref:t,width:n,height:c,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:P.jsx("polygon",{points:"0,0 30,0 15,10"})})});w9.displayName=Pde;var Cde=w9;function S9(e){const[t,r]=Z.useState(void 0);return xo(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(c=>{if(!Array.isArray(c)||!c.length)return;const h=c[0];let p,s;if("borderBoxSize"in h){const v=h.borderBoxSize,w=Array.isArray(v)?v[0]:v;p=w.inlineSize,s=w.blockSize}else p=e.offsetWidth,s=e.offsetHeight;r({width:p,height:s})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var JL="Popper",[T9,XA]=wc(JL),[Ide,E9]=T9(JL),A9=e=>{const{__scopePopper:t,children:r}=e,[n,c]=Z.useState(null);return P.jsx(Ide,{scope:t,anchor:n,onAnchorChange:c,children:r})};A9.displayName=JL;var k9="PopperAnchor",P9=Z.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...c}=e,h=E9(k9,r),p=Z.useRef(null),s=yi(t,p),v=Z.useRef(null);return Z.useEffect(()=>{const w=v.current;v.current=n?.current||p.current,w!==v.current&&h.onAnchorChange(v.current)}),n?null:P.jsx(fn.div,{...c,ref:s})});P9.displayName=k9;var QL="PopperContent",[Mde,Ode]=T9(QL),C9=Z.forwardRef((e,t)=>{const{__scopePopper:r,side:n="bottom",sideOffset:c=0,align:h="center",alignOffset:p=0,arrowPadding:s=0,avoidCollisions:v=!0,collisionBoundary:w=[],collisionPadding:T=0,sticky:I="partial",hideWhenDetached:O=!1,updatePositionStrategy:D="optimized",onPlaced:B,...N}=e,G=E9(QL,r),[U,V]=Z.useState(null),X=yi(t,Ft=>V(Ft)),[Y,ne]=Z.useState(null),ae=S9(Y),le=ae?.width??0,ge=ae?.height??0,je=n+(h!=="center"?"-"+h:""),ze=typeof T=="number"?T:{top:0,right:0,bottom:0,left:0,...T},Pe=Array.isArray(w)?w:[w],Ke=Pe.length>0,Ye={padding:ze,boundary:Pe.filter(Rde),altBoundary:Ke},{refs:Oe,floatingStyles:tt,placement:We,isPositioned:lt,middlewareData:rt}=vde({strategy:"fixed",placement:je,whileElementsMounted:(...Ft)=>cde(...Ft,{animationFrame:D==="always"}),elements:{reference:G.anchor},middleware:[bde({mainAxis:c+ge,alignmentAxis:p}),v&&wde({mainAxis:!0,crossAxis:!1,limiter:I==="partial"?Sde():void 0,...Ye}),v&&Tde({...Ye}),Ede({...Ye,apply:({elements:Ft,rects:br,availableWidth:Yt,availableHeight:Qt})=>{const{width:Sr,height:Vt}=br.reference,Nn=Ft.floating.style;Nn.setProperty("--radix-popper-available-width",`${Yt}px`),Nn.setProperty("--radix-popper-available-height",`${Qt}px`),Nn.setProperty("--radix-popper-anchor-width",`${Sr}px`),Nn.setProperty("--radix-popper-anchor-height",`${Vt}px`)}}),Y&&kde({element:Y,padding:s}),Dde({arrowWidth:le,arrowHeight:ge}),O&&Ade({strategy:"referenceHidden",...Ye})]}),[ht,vt]=O9(We),mt=ro(B);xo(()=>{lt&&mt?.()},[lt,mt]);const ct=rt.arrow?.x,Ut=rt.arrow?.y,xr=rt.arrow?.centerOffset!==0,[tn,Er]=Z.useState();return xo(()=>{U&&Er(window.getComputedStyle(U).zIndex)},[U]),P.jsx("div",{ref:Oe.setFloating,"data-radix-popper-content-wrapper":"",style:{...tt,transform:lt?tt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:tn,"--radix-popper-transform-origin":[rt.transformOrigin?.x,rt.transformOrigin?.y].join(" "),...rt.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:P.jsx(Mde,{scope:r,placedSide:ht,onArrowChange:ne,arrowX:ct,arrowY:Ut,shouldHideArrow:xr,children:P.jsx(fn.div,{"data-side":ht,"data-align":vt,...N,ref:X,style:{...N.style,animation:lt?void 0:"none"}})})})});C9.displayName=QL;var I9="PopperArrow",jde={top:"bottom",right:"left",bottom:"top",left:"right"},M9=Z.forwardRef(function(e,t){const{__scopePopper:r,...n}=e,c=Ode(I9,r),h=jde[c.placedSide];return P.jsx("span",{ref:c.onArrowChange,style:{position:"absolute",left:c.arrowX,top:c.arrowY,[h]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[c.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[c.placedSide],visibility:c.shouldHideArrow?"hidden":void 0},children:P.jsx(Cde,{...n,ref:t,style:{...n.style,display:"block"}})})});M9.displayName=I9;function Rde(e){return e!==null}var Dde=e=>({name:"transformOrigin",options:e,fn(t){const{placement:r,rects:n,middlewareData:c}=t,h=c.arrow?.centerOffset!==0,p=h?0:e.arrowWidth,s=h?0:e.arrowHeight,[v,w]=O9(r),T={start:"0%",center:"50%",end:"100%"}[w],I=(c.arrow?.x??0)+p/2,O=(c.arrow?.y??0)+s/2;let D="",B="";return v==="bottom"?(D=h?T:`${I}px`,B=`${-s}px`):v==="top"?(D=h?T:`${I}px`,B=`${n.floating.height+s}px`):v==="right"?(D=`${-s}px`,B=h?T:`${O}px`):v==="left"&&(D=`${n.floating.width+s}px`,B=h?T:`${O}px`),{data:{x:D,y:B}}}});function O9(e){const[t,r="center"]=e.split("-");return[t,r]}var Lde=A9,j9=P9,R9=C9,D9=M9,[YA,QHe]=wc("Tooltip",[XA]),e3=XA(),L9="TooltipProvider",zde=700,D6="tooltip.open",[Nde,z9]=YA(L9),N9=e=>{const{__scopeTooltip:t,delayDuration:r=zde,skipDelayDuration:n=300,disableHoverableContent:c=!1,children:h}=e,p=Z.useRef(!0),s=Z.useRef(!1),v=Z.useRef(0);return Z.useEffect(()=>{const w=v.current;return()=>window.clearTimeout(w)},[]),P.jsx(Nde,{scope:t,isOpenDelayedRef:p,delayDuration:r,onOpen:Z.useCallback(()=>{window.clearTimeout(v.current),p.current=!1},[]),onClose:Z.useCallback(()=>{window.clearTimeout(v.current),v.current=window.setTimeout(()=>p.current=!0,n)},[n]),isPointerInTransitRef:s,onPointerInTransitChange:Z.useCallback(w=>{s.current=w},[]),disableHoverableContent:c,children:h})};N9.displayName=L9;var F9="Tooltip",[e7e,JA]=YA(F9),cj="TooltipTrigger",Fde=Z.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,c=JA(cj,r),h=z9(cj,r),p=e3(r),s=Z.useRef(null),v=yi(t,s,c.onTriggerChange),w=Z.useRef(!1),T=Z.useRef(!1),I=Z.useCallback(()=>w.current=!1,[]);return Z.useEffect(()=>()=>document.removeEventListener("pointerup",I),[I]),P.jsx(j9,{asChild:!0,...p,children:P.jsx(fn.button,{"aria-describedby":c.open?c.contentId:void 0,"data-state":c.stateAttribute,...n,ref:v,onPointerMove:Zr(e.onPointerMove,O=>{O.pointerType!=="touch"&&!T.current&&!h.isPointerInTransitRef.current&&(c.onTriggerEnter(),T.current=!0)}),onPointerLeave:Zr(e.onPointerLeave,()=>{c.onTriggerLeave(),T.current=!1}),onPointerDown:Zr(e.onPointerDown,()=>{c.open&&c.onClose(),w.current=!0,document.addEventListener("pointerup",I,{once:!0})}),onFocus:Zr(e.onFocus,()=>{w.current||c.onOpen()}),onBlur:Zr(e.onBlur,c.onClose),onClick:Zr(e.onClick,c.onClose)})})});Fde.displayName=cj;var Bde="TooltipPortal",[t7e,Vde]=YA(Bde,{forceMount:void 0}),__="TooltipContent",B9=Z.forwardRef((e,t)=>{const r=Vde(__,e.__scopeTooltip),{forceMount:n=r.forceMount,side:c="top",...h}=e,p=JA(__,e.__scopeTooltip);return P.jsx(Sc,{present:n||p.open,children:p.disableHoverableContent?P.jsx(V9,{side:c,...h,ref:t}):P.jsx(Ude,{side:c,...h,ref:t})})}),Ude=Z.forwardRef((e,t)=>{const r=JA(__,e.__scopeTooltip),n=z9(__,e.__scopeTooltip),c=Z.useRef(null),h=yi(t,c),[p,s]=Z.useState(null),{trigger:v,onClose:w}=r,T=c.current,{onPointerInTransitChange:I}=n,O=Z.useCallback(()=>{s(null),I(!1)},[I]),D=Z.useCallback((B,N)=>{const G=B.currentTarget,U={x:B.clientX,y:B.clientY},V=qde(U,G.getBoundingClientRect()),X=Zde(U,V),Y=Kde(N.getBoundingClientRect()),ne=Yde([...X,...Y]);s(ne),I(!0)},[I]);return Z.useEffect(()=>()=>O(),[O]),Z.useEffect(()=>{if(v&&T){const B=G=>D(G,T),N=G=>D(G,v);return v.addEventListener("pointerleave",B),T.addEventListener("pointerleave",N),()=>{v.removeEventListener("pointerleave",B),T.removeEventListener("pointerleave",N)}}},[v,T,D,O]),Z.useEffect(()=>{if(p){const B=N=>{const G=N.target,U={x:N.clientX,y:N.clientY},V=v?.contains(G)||T?.contains(G),X=!Xde(U,p);V?O():X&&(O(),w())};return document.addEventListener("pointermove",B),()=>document.removeEventListener("pointermove",B)}},[v,T,p,w,O]),P.jsx(V9,{...e,ref:h})}),[$de,Gde]=YA(F9,{isInside:!1}),Hde=Gle("TooltipContent"),V9=Z.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":c,onEscapeKeyDown:h,onPointerDownOutside:p,...s}=e,v=JA(__,r),w=e3(r),{onClose:T}=v;return Z.useEffect(()=>(document.addEventListener(D6,T),()=>document.removeEventListener(D6,T)),[T]),Z.useEffect(()=>{if(v.trigger){const I=O=>{O.target?.contains(v.trigger)&&T()};return window.addEventListener("scroll",I,{capture:!0}),()=>window.removeEventListener("scroll",I,{capture:!0})}},[v.trigger,T]),P.jsx(Ww,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:h,onPointerDownOutside:p,onFocusOutside:I=>I.preventDefault(),onDismiss:T,children:P.jsxs(R9,{"data-state":v.stateAttribute,...w,...s,ref:t,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[P.jsx(Hde,{children:n}),P.jsx($de,{scope:r,isInside:!0,children:P.jsx(dce,{id:v.contentId,role:"tooltip",children:c||n})})]})})});B9.displayName=__;var U9="TooltipArrow",Wde=Z.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,c=e3(r);return Gde(U9,r).isInside?null:P.jsx(D9,{...c,...n,ref:t})});Wde.displayName=U9;function qde(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),c=Math.abs(t.right-e.x),h=Math.abs(t.left-e.x);switch(Math.min(r,n,c,h)){case h:return"left";case c:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function Zde(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function Kde(e){const{top:t,right:r,bottom:n,left:c}=e;return[{x:c,y:t},{x:r,y:t},{x:r,y:n},{x:c,y:n}]}function Xde(e,t){const{x:r,y:n}=e;let c=!1;for(let h=0,p=t.length-1;h<t.length;p=h++){const s=t[h],v=t[p],w=s.x,T=s.y,I=v.x,O=v.y;T>n!=O>n&&r<(I-w)*(n-T)/(O-T)+w&&(c=!c)}return c}function Yde(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),Jde(t)}function Jde(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const c=e[n];for(;t.length>=2;){const h=t[t.length-1],p=t[t.length-2];if((h.x-p.x)*(c.y-p.y)>=(h.y-p.y)*(c.x-p.x))t.pop();else break}t.push(c)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const c=e[n];for(;r.length>=2;){const h=r[r.length-1],p=r[r.length-2];if((h.x-p.x)*(c.y-p.y)>=(h.y-p.y)*(c.x-p.x))r.pop();else break}r.push(c)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var Qde=N9,$9=B9;const efe=Qde,tfe=Z.forwardRef(({className:e,sideOffset:t=4,...r},n)=>P.jsx($9,{ref:n,sideOffset:t,className:ln("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));tfe.displayName=$9.displayName;var QA=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ek=typeof window>"u"||"Deno"in globalThis;function uc(){}function rfe(e,t){return typeof e=="function"?e(t):e}function nfe(e){return typeof e=="number"&&e>=0&&e!==1/0}function ife(e,t){return Math.max(e+(t||0)-Date.now(),0)}function uj(e,t){return typeof e=="function"?e(t):e}function sfe(e,t){return typeof e=="function"?e(t):e}function L6(e,t){const{type:r="all",exact:n,fetchStatus:c,predicate:h,queryKey:p,stale:s}=e;if(p){if(n){if(t.queryHash!==t3(p,t.options))return!1}else if(!Jb(t.queryKey,p))return!1}if(r!=="all"){const v=t.isActive();if(r==="active"&&!v||r==="inactive"&&v)return!1}return!(typeof s=="boolean"&&t.isStale()!==s||c&&c!==t.state.fetchStatus||h&&!h(t))}function z6(e,t){const{exact:r,status:n,predicate:c,mutationKey:h}=e;if(h){if(!t.options.mutationKey)return!1;if(r){if(Yb(t.options.mutationKey)!==Yb(h))return!1}else if(!Jb(t.options.mutationKey,h))return!1}return!(n&&t.state.status!==n||c&&!c(t))}function t3(e,t){return(t?.queryKeyHashFn||Yb)(e)}function Yb(e){return JSON.stringify(e,(t,r)=>hj(r)?Object.keys(r).sort().reduce((n,c)=>(n[c]=r[c],n),{}):r)}function Jb(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>Jb(e[r],t[r])):!1}function G9(e,t){if(e===t)return e;const r=N6(e)&&N6(t);if(r||hj(e)&&hj(t)){const n=r?e:Object.keys(e),c=n.length,h=r?t:Object.keys(t),p=h.length,s=r?[]:{},v=new Set(n);let w=0;for(let T=0;T<p;T++){const I=r?T:h[T];(!r&&v.has(I)||r)&&e[I]===void 0&&t[I]===void 0?(s[I]=void 0,w++):(s[I]=G9(e[I],t[I]),s[I]===e[I]&&e[I]!==void 0&&w++)}return c===p&&w===c?e:s}return t}function N6(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function hj(e){if(!F6(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!F6(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function F6(e){return Object.prototype.toString.call(e)==="[object Object]"}function ofe(e){return new Promise(t=>{setTimeout(t,e)})}function afe(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?G9(e,t):t}function lfe(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function cfe(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var r3=Symbol();function H9(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===r3?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var oy,Pp,Px,B6,ufe=(B6=class extends QA{constructor(){super(),Ai(this,oy),Ai(this,Pp),Ai(this,Px),Bn(this,Px,e=>{if(!ek&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){Xt(this,Pp)||this.setEventListener(Xt(this,Px))}onUnsubscribe(){var e;this.hasListeners()||((e=Xt(this,Pp))==null||e.call(this),Bn(this,Pp,void 0))}setEventListener(e){var t;Bn(this,Px,e),(t=Xt(this,Pp))==null||t.call(this),Bn(this,Pp,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){Xt(this,oy)!==e&&(Bn(this,oy,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof Xt(this,oy)=="boolean"?Xt(this,oy):globalThis.document?.visibilityState!=="hidden"}},oy=new WeakMap,Pp=new WeakMap,Px=new WeakMap,B6),W9=new ufe,Cx,Cp,Ix,V6,hfe=(V6=class extends QA{constructor(){super(),Ai(this,Cx,!0),Ai(this,Cp),Ai(this,Ix),Bn(this,Ix,e=>{if(!ek&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){Xt(this,Cp)||this.setEventListener(Xt(this,Ix))}onUnsubscribe(){var e;this.hasListeners()||((e=Xt(this,Cp))==null||e.call(this),Bn(this,Cp,void 0))}setEventListener(e){var t;Bn(this,Ix,e),(t=Xt(this,Cp))==null||t.call(this),Bn(this,Cp,e(this.setOnline.bind(this)))}setOnline(e){Xt(this,Cx)!==e&&(Bn(this,Cx,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return Xt(this,Cx)}},Cx=new WeakMap,Cp=new WeakMap,Ix=new WeakMap,V6),cE=new hfe;function dfe(){let e,t;const r=new Promise((c,h)=>{e=c,t=h});r.status="pending",r.catch(()=>{});function n(c){Object.assign(r,c),delete r.resolve,delete r.reject}return r.resolve=c=>{n({status:"fulfilled",value:c}),e(c)},r.reject=c=>{n({status:"rejected",reason:c}),t(c)},r}function ffe(e){return Math.min(1e3*2**e,3e4)}function q9(e){return(e??"online")==="online"?cE.isOnline():!0}var Z9=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function K9(e){let t=!1,r=0,n;const c=dfe(),h=()=>c.status!=="pending",p=N=>{h()||(O(new Z9(N)),e.abort?.())},s=()=>{t=!0},v=()=>{t=!1},w=()=>W9.isFocused()&&(e.networkMode==="always"||cE.isOnline())&&e.canRun(),T=()=>q9(e.networkMode)&&e.canRun(),I=N=>{h()||(n?.(),c.resolve(N))},O=N=>{h()||(n?.(),c.reject(N))},D=()=>new Promise(N=>{n=G=>{(h()||w())&&N(G)},e.onPause?.()}).then(()=>{n=void 0,h()||e.onContinue?.()}),B=()=>{if(h())return;let N;const G=r===0?e.initialPromise:void 0;try{N=G??e.fn()}catch(U){N=Promise.reject(U)}Promise.resolve(N).then(I).catch(U=>{if(h())return;const V=e.retry??(ek?0:3),X=e.retryDelay??ffe,Y=typeof X=="function"?X(r,U):X,ne=V===!0||typeof V=="number"&&r<V||typeof V=="function"&&V(r,U);if(t||!ne){O(U);return}r++,e.onFail?.(r,U),ofe(Y).then(()=>w()?void 0:D()).then(()=>{t?O(U):B()})})};return{promise:c,status:()=>c.status,cancel:p,continue:()=>(n?.(),c),cancelRetry:s,continueRetry:v,canStart:T,start:()=>(T()?B():D().then(B),c)}}var pfe=e=>setTimeout(e,0);function mfe(){let e=[],t=0,r=s=>{s()},n=s=>{s()},c=pfe;const h=s=>{t?e.push(s):c(()=>{r(s)})},p=()=>{const s=e;e=[],s.length&&c(()=>{n(()=>{s.forEach(v=>{r(v)})})})};return{batch:s=>{let v;t++;try{v=s()}finally{t--,t||p()}return v},batchCalls:s=>(...v)=>{h(()=>{s(...v)})},schedule:h,setNotifyFunction:s=>{r=s},setBatchNotifyFunction:s=>{n=s},setScheduler:s=>{c=s}}}var ma=mfe(),ay,U6,X9=(U6=class{constructor(){Ai(this,ay)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),nfe(this.gcTime)&&Bn(this,ay,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(ek?1/0:5*60*1e3))}clearGcTimeout(){Xt(this,ay)&&(clearTimeout(Xt(this,ay)),Bn(this,ay,void 0))}},ay=new WeakMap,U6),Mx,Ox,ic,ly,jo,jT,cy,au,nh,$6,gfe=($6=class extends X9{constructor(e){super(),Ai(this,au),Ai(this,Mx),Ai(this,Ox),Ai(this,ic),Ai(this,ly),Ai(this,jo),Ai(this,jT),Ai(this,cy),Bn(this,cy,!1),Bn(this,jT,e.defaultOptions),this.setOptions(e.options),this.observers=[],Bn(this,ly,e.client),Bn(this,ic,Xt(this,ly).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Bn(this,Mx,_fe(this.options)),this.state=e.state??Xt(this,Mx),this.scheduleGc()}get meta(){return this.options.meta}get promise(){return Xt(this,jo)?.promise}setOptions(e){this.options={...Xt(this,jT),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Xt(this,ic).remove(this)}setData(e,t){const r=afe(this.state.data,e,this.options);return pa(this,au,nh).call(this,{data:r,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),r}setState(e,t){pa(this,au,nh).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){const t=Xt(this,jo)?.promise;return Xt(this,jo)?.cancel(e),t?t.then(uc).catch(uc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Xt(this,Mx))}isActive(){return this.observers.some(e=>sfe(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===r3||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>uj(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!ife(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),Xt(this,jo)?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),Xt(this,jo)?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),Xt(this,ic).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(Xt(this,jo)&&(Xt(this,cy)?Xt(this,jo).cancel({revert:!0}):Xt(this,jo).cancelRetry()),this.scheduleGc()),Xt(this,ic).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||pa(this,au,nh).call(this,{type:"invalidate"})}async fetch(e,t){if(this.state.fetchStatus!=="idle"&&Xt(this,jo)?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(Xt(this,jo))return Xt(this,jo).continueRetry(),Xt(this,jo).promise}if(e&&this.setOptions(e),!this.options.queryFn){const p=this.observers.find(s=>s.options.queryFn);p&&this.setOptions(p.options)}const r=new AbortController,n=p=>{Object.defineProperty(p,"signal",{enumerable:!0,get:()=>(Bn(this,cy,!0),r.signal)})},c=()=>{const p=H9(this.options,t),s=(()=>{const v={client:Xt(this,ly),queryKey:this.queryKey,meta:this.meta};return n(v),v})();return Bn(this,cy,!1),this.options.persister?this.options.persister(p,s,this):p(s)},h=(()=>{const p={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:Xt(this,ly),state:this.state,fetchFn:c};return n(p),p})();this.options.behavior?.onFetch(h,this),Bn(this,Ox,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==h.fetchOptions?.meta)&&pa(this,au,nh).call(this,{type:"fetch",meta:h.fetchOptions?.meta}),Bn(this,jo,K9({initialPromise:t?.initialPromise,fn:h.fetchFn,abort:r.abort.bind(r),onFail:(p,s)=>{pa(this,au,nh).call(this,{type:"failed",failureCount:p,error:s})},onPause:()=>{pa(this,au,nh).call(this,{type:"pause"})},onContinue:()=>{pa(this,au,nh).call(this,{type:"continue"})},retry:h.options.retry,retryDelay:h.options.retryDelay,networkMode:h.options.networkMode,canRun:()=>!0}));try{const p=await Xt(this,jo).start();if(p===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(p),Xt(this,ic).config.onSuccess?.(p,this),Xt(this,ic).config.onSettled?.(p,this.state.error,this),p}catch(p){if(p instanceof Z9){if(p.silent)return Xt(this,jo).promise;if(p.revert){if(this.setState({...Xt(this,Ox),fetchStatus:"idle"}),this.state.data===void 0)throw p;return this.state.data}}throw pa(this,au,nh).call(this,{type:"error",error:p}),Xt(this,ic).config.onError?.(p,this),Xt(this,ic).config.onSettled?.(this.state.data,p,this),p}finally{this.scheduleGc()}}},Mx=new WeakMap,Ox=new WeakMap,ic=new WeakMap,ly=new WeakMap,jo=new WeakMap,jT=new WeakMap,cy=new WeakMap,au=new WeakSet,nh=function(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...yfe(r.data,this.options),fetchMeta:e.meta??null};case"success":const n={...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Bn(this,Ox,e.manual?n:void 0),n;case"error":const c=e.error;return{...r,error:c,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:c,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),ma.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),Xt(this,ic).notify({query:this,type:"updated",action:e})})},$6);function yfe(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:q9(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function _fe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var ih,G6,vfe=(G6=class extends QA{constructor(e={}){super(),Ai(this,ih),this.config=e,Bn(this,ih,new Map)}build(e,t,r){const n=t.queryKey,c=t.queryHash??t3(n,t);let h=this.get(c);return h||(h=new gfe({client:e,queryKey:n,queryHash:c,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(n)}),this.add(h)),h}add(e){Xt(this,ih).has(e.queryHash)||(Xt(this,ih).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=Xt(this,ih).get(e.queryHash);t&&(e.destroy(),t===e&&Xt(this,ih).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){ma.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return Xt(this,ih).get(e)}getAll(){return[...Xt(this,ih).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(r=>L6(t,r))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(r=>L6(e,r)):t}notify(e){ma.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){ma.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){ma.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ih=new WeakMap,G6),sh,La,uy,oh,zd,H6,xfe=(H6=class extends X9{constructor(e){super(),Ai(this,oh),Ai(this,sh),Ai(this,La),Ai(this,uy),this.mutationId=e.mutationId,Bn(this,La,e.mutationCache),Bn(this,sh,[]),this.state=e.state||bfe(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){Xt(this,sh).includes(e)||(Xt(this,sh).push(e),this.clearGcTimeout(),Xt(this,La).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Bn(this,sh,Xt(this,sh).filter(t=>t!==e)),this.scheduleGc(),Xt(this,La).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){Xt(this,sh).length||(this.state.status==="pending"?this.scheduleGc():Xt(this,La).remove(this))}continue(){return Xt(this,uy)?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{pa(this,oh,zd).call(this,{type:"continue"})};Bn(this,uy,K9({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(c,h)=>{pa(this,oh,zd).call(this,{type:"failed",failureCount:c,error:h})},onPause:()=>{pa(this,oh,zd).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Xt(this,La).canRun(this)}));const r=this.state.status==="pending",n=!Xt(this,uy).canStart();try{if(r)t();else{pa(this,oh,zd).call(this,{type:"pending",variables:e,isPaused:n}),await Xt(this,La).config.onMutate?.(e,this);const h=await this.options.onMutate?.(e);h!==this.state.context&&pa(this,oh,zd).call(this,{type:"pending",context:h,variables:e,isPaused:n})}const c=await Xt(this,uy).start();return await Xt(this,La).config.onSuccess?.(c,e,this.state.context,this),await this.options.onSuccess?.(c,e,this.state.context),await Xt(this,La).config.onSettled?.(c,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(c,null,e,this.state.context),pa(this,oh,zd).call(this,{type:"success",data:c}),c}catch(c){try{throw await Xt(this,La).config.onError?.(c,e,this.state.context,this),await this.options.onError?.(c,e,this.state.context),await Xt(this,La).config.onSettled?.(void 0,c,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,c,e,this.state.context),c}finally{pa(this,oh,zd).call(this,{type:"error",error:c})}}finally{Xt(this,La).runNext(this)}}},sh=new WeakMap,La=new WeakMap,uy=new WeakMap,oh=new WeakSet,zd=function(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),ma.batch(()=>{Xt(this,sh).forEach(r=>{r.onMutationUpdate(e)}),Xt(this,La).notify({mutation:this,type:"updated",action:e})})},H6);function bfe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Nd,lu,RT,W6,wfe=(W6=class extends QA{constructor(e={}){super(),Ai(this,Nd),Ai(this,lu),Ai(this,RT),this.config=e,Bn(this,Nd,new Set),Bn(this,lu,new Map),Bn(this,RT,0)}build(e,t,r){const n=new xfe({mutationCache:this,mutationId:++iO(this,RT)._,options:e.defaultMutationOptions(t),state:r});return this.add(n),n}add(e){Xt(this,Nd).add(e);const t=DT(e);if(typeof t=="string"){const r=Xt(this,lu).get(t);r?r.push(e):Xt(this,lu).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(Xt(this,Nd).delete(e)){const t=DT(e);if(typeof t=="string"){const r=Xt(this,lu).get(t);if(r)if(r.length>1){const n=r.indexOf(e);n!==-1&&r.splice(n,1)}else r[0]===e&&Xt(this,lu).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=DT(e);if(typeof t=="string"){const r=Xt(this,lu).get(t)?.find(n=>n.state.status==="pending");return!r||r===e}else return!0}runNext(e){const t=DT(e);return typeof t=="string"?Xt(this,lu).get(t)?.find(r=>r!==e&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ma.batch(()=>{Xt(this,Nd).forEach(e=>{this.notify({type:"removed",mutation:e})}),Xt(this,Nd).clear(),Xt(this,lu).clear()})}getAll(){return Array.from(Xt(this,Nd))}find(e){const t={exact:!0,...e};return this.getAll().find(r=>z6(t,r))}findAll(e={}){return this.getAll().filter(t=>z6(e,t))}notify(e){ma.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return ma.batch(()=>Promise.all(e.map(t=>t.continue().catch(uc))))}},Nd=new WeakMap,lu=new WeakMap,RT=new WeakMap,W6);function DT(e){return e.options.scope?.id}function q6(e){return{onFetch:(t,r)=>{const n=t.options,c=t.fetchOptions?.meta?.fetchMore?.direction,h=t.state.data?.pages||[],p=t.state.data?.pageParams||[];let s={pages:[],pageParams:[]},v=0;const w=async()=>{let T=!1;const I=B=>{Object.defineProperty(B,"signal",{enumerable:!0,get:()=>(t.signal.aborted?T=!0:t.signal.addEventListener("abort",()=>{T=!0}),t.signal)})},O=H9(t.options,t.fetchOptions),D=async(B,N,G)=>{if(T)return Promise.reject();if(N==null&&B.pages.length)return Promise.resolve(B);const U=(()=>{const ne={client:t.client,queryKey:t.queryKey,pageParam:N,direction:G?"backward":"forward",meta:t.options.meta};return I(ne),ne})(),V=await O(U),{maxPages:X}=t.options,Y=G?cfe:lfe;return{pages:Y(B.pages,V,X),pageParams:Y(B.pageParams,N,X)}};if(c&&h.length){const B=c==="backward",N=B?Sfe:Z6,G={pages:h,pageParams:p},U=N(n,G);s=await D(G,U,B)}else{const B=e??h.length;do{const N=v===0?p[0]??n.initialPageParam:Z6(n,s);if(v>0&&N==null)break;s=await D(s,N),v++}while(v<B)}return s};t.options.persister?t.fetchFn=()=>t.options.persister?.(w,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r):t.fetchFn=w}}}function Z6(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function Sfe(e,{pages:t,pageParams:r}){return t.length>0?e.getPreviousPageParam?.(t[0],t,r[0],r):void 0}var Ms,Ip,Mp,jx,Rx,Op,Dx,Lx,K6,Tfe=(K6=class{constructor(e={}){Ai(this,Ms),Ai(this,Ip),Ai(this,Mp),Ai(this,jx),Ai(this,Rx),Ai(this,Op),Ai(this,Dx),Ai(this,Lx),Bn(this,Ms,e.queryCache||new vfe),Bn(this,Ip,e.mutationCache||new wfe),Bn(this,Mp,e.defaultOptions||{}),Bn(this,jx,new Map),Bn(this,Rx,new Map),Bn(this,Op,0)}mount(){iO(this,Op)._++,Xt(this,Op)===1&&(Bn(this,Dx,W9.subscribe(async e=>{e&&(await this.resumePausedMutations(),Xt(this,Ms).onFocus())})),Bn(this,Lx,cE.subscribe(async e=>{e&&(await this.resumePausedMutations(),Xt(this,Ms).onOnline())})))}unmount(){var e,t;iO(this,Op)._--,Xt(this,Op)===0&&((e=Xt(this,Dx))==null||e.call(this),Bn(this,Dx,void 0),(t=Xt(this,Lx))==null||t.call(this),Bn(this,Lx,void 0))}isFetching(e){return Xt(this,Ms).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Xt(this,Ip).findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return Xt(this,Ms).get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=Xt(this,Ms).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(uj(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return Xt(this,Ms).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),c=Xt(this,Ms).get(n.queryHash)?.state.data,h=rfe(t,c);if(h!==void 0)return Xt(this,Ms).build(this,n).setData(h,{...r,manual:!0})}setQueriesData(e,t,r){return ma.batch(()=>Xt(this,Ms).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return Xt(this,Ms).get(t.queryHash)?.state}removeQueries(e){const t=Xt(this,Ms);ma.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=Xt(this,Ms);return ma.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=ma.batch(()=>Xt(this,Ms).findAll(e).map(c=>c.cancel(r)));return Promise.all(n).then(uc).catch(uc)}invalidateQueries(e,t={}){return ma.batch(()=>(Xt(this,Ms).findAll(e).forEach(r=>{r.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=ma.batch(()=>Xt(this,Ms).findAll(e).filter(c=>!c.isDisabled()&&!c.isStatic()).map(c=>{let h=c.fetch(void 0,r);return r.throwOnError||(h=h.catch(uc)),c.state.fetchStatus==="paused"?Promise.resolve():h}));return Promise.all(n).then(uc)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=Xt(this,Ms).build(this,t);return r.isStaleByTime(uj(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(uc).catch(uc)}fetchInfiniteQuery(e){return e.behavior=q6(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(uc).catch(uc)}ensureInfiniteQueryData(e){return e.behavior=q6(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return cE.isOnline()?Xt(this,Ip).resumePausedMutations():Promise.resolve()}getQueryCache(){return Xt(this,Ms)}getMutationCache(){return Xt(this,Ip)}getDefaultOptions(){return Xt(this,Mp)}setDefaultOptions(e){Bn(this,Mp,e)}setQueryDefaults(e,t){Xt(this,jx).set(Yb(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Xt(this,jx).values()],r={};return t.forEach(n=>{Jb(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){Xt(this,Rx).set(Yb(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Xt(this,Rx).values()],r={};return t.forEach(n=>{Jb(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Xt(this,Mp).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=t3(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===r3&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...Xt(this,Mp).mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Xt(this,Ms).clear(),Xt(this,Ip).clear()}},Ms=new WeakMap,Ip=new WeakMap,Mp=new WeakMap,jx=new WeakMap,Rx=new WeakMap,Op=new WeakMap,Dx=new WeakMap,Lx=new WeakMap,K6),Efe=Z.createContext(void 0),Afe=({client:e,children:t})=>(Z.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),P.jsx(Efe.Provider,{value:e,children:t}));/**
* @remix-run/router v1.23.0
*
* Copyright (c) Remix Software Inc.
*
* This source code is licensed under the MIT license found in the
* LICENSE.md file in the root directory of this source tree.
*
* @license MIT
*/function uE(){return uE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uE.apply(this,arguments)}var ef;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(ef||(ef={}));const X6="popstate";function kfe(e){e===void 0&&(e={});function t(n,c){let{pathname:h,search:p,hash:s}=n.location;return dj("",{pathname:h,search:p,hash:s},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function r(n,c){return typeof c=="string"?c:J9(c)}return Cfe(t,r,null,e)}function Za(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Y9(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Pfe(){return Math.random().toString(36).substr(2,8)}function Y6(e,t){return{usr:e.state,key:e.key,idx:t}}function dj(e,t,r,n){return r===void 0&&(r=null),uE({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?tk(t):t,{state:r,key:t&&t.key||n||Pfe()})}function J9(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function tk(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Cfe(e,t,r,n){n===void 0&&(n={});let{window:c=document.defaultView,v5Compat:h=!1}=n,p=c.history,s=ef.Pop,v=null,w=T();w==null&&(w=0,p.replaceState(uE({},p.state,{idx:w}),""));function T(){return(p.state||{idx:null}).idx}function I(){s=ef.Pop;let G=T(),U=G==null?null:G-w;w=G,v&&v({action:s,location:N.location,delta:U})}function O(G,U){s=ef.Push;let V=dj(N.location,G,U);w=T()+1;let X=Y6(V,w),Y=N.createHref(V);try{p.pushState(X,"",Y)}catch(ne){if(ne instanceof DOMException&&ne.name==="DataCloneError")throw ne;c.location.assign(Y)}h&&v&&v({action:s,location:N.location,delta:1})}function D(G,U){s=ef.Replace;let V=dj(N.location,G,U);w=T();let X=Y6(V,w),Y=N.createHref(V);p.replaceState(X,"",Y),h&&v&&v({action:s,location:N.location,delta:0})}function B(G){let U=c.location.origin!=="null"?c.location.origin:c.location.href,V=typeof G=="string"?G:J9(G);return V=V.replace(/ $/,"%20"),Za(U,"No window.location.(origin|href) available to create URL for href: "+V),new URL(V,U)}let N={get action(){return s},get location(){return e(c,p)},listen(G){if(v)throw new Error("A history only accepts one active listener");return c.addEventListener(X6,I),v=G,()=>{c.removeEventListener(X6,I),v=null}},createHref(G){return t(c,G)},createURL:B,encodeLocation(G){let U=B(G);return{pathname:U.pathname,search:U.search,hash:U.hash}},push:O,replace:D,go(G){return p.go(G)}};return N}var J6;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(J6||(J6={}));function Ife(e,t,r){return r===void 0&&(r="/"),Mfe(e,t,r)}function Mfe(e,t,r,n){let c=typeof t=="string"?tk(t):t,h=tZ(c.pathname||"/",r);if(h==null)return null;let p=Q9(e);Ofe(p);let s=null;for(let v=0;s==null&&v<p.length;++v){let w=Gfe(h);s=Vfe(p[v],w)}return s}function Q9(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let c=(h,p,s)=>{let v={relativePath:s===void 0?h.path||"":s,caseSensitive:h.caseSensitive===!0,childrenIndex:p,route:h};v.relativePath.startsWith("/")&&(Za(v.relativePath.startsWith(n),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(n.length));let w=e_([n,v.relativePath]),T=r.concat(v);h.children&&h.children.length>0&&(Za(h.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+w+'".')),Q9(h.children,t,T,w)),!(h.path==null&&!h.index)&&t.push({path:w,score:Ffe(w,h.index),routesMeta:T})};return e.forEach((h,p)=>{var s;if(h.path===""||!((s=h.path)!=null&&s.includes("?")))c(h,p);else for(let v of eZ(h.path))c(h,p,v)}),t}function eZ(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,c=r.endsWith("?"),h=r.replace(/\?$/,"");if(n.length===0)return c?[h,""]:[h];let p=eZ(n.join("/")),s=[];return s.push(...p.map(v=>v===""?h:[h,v].join("/"))),c&&s.push(...p),s.map(v=>e.startsWith("/")&&v===""?"/":v)}function Ofe(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Bfe(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const jfe=/^:[\w-]+$/,Rfe=3,Dfe=2,Lfe=1,zfe=10,Nfe=-2,Q6=e=>e==="*";function Ffe(e,t){let r=e.split("/"),n=r.length;return r.some(Q6)&&(n+=Nfe),t&&(n+=Dfe),r.filter(c=>!Q6(c)).reduce((c,h)=>c+(jfe.test(h)?Rfe:h===""?Lfe:zfe),n)}function Bfe(e,t){return e.length===t.length&&e.slice(0,-1).every((r,n)=>r===t[n])?e[e.length-1]-t[t.length-1]:0}function Vfe(e,t,r){let{routesMeta:n}=e,c={},h="/",p=[];for(let s=0;s<n.length;++s){let v=n[s],w=s===n.length-1,T=h==="/"?t:t.slice(h.length)||"/",I=Ufe({path:v.relativePath,caseSensitive:v.caseSensitive,end:w},T),O=v.route;if(!I)return null;Object.assign(c,I.params),p.push({params:c,pathname:e_([h,I.pathname]),pathnameBase:Hfe(e_([h,I.pathnameBase])),route:O}),I.pathnameBase!=="/"&&(h=e_([h,I.pathnameBase]))}return p}function Ufe(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=$fe(e.path,e.caseSensitive,e.end),c=t.match(r);if(!c)return null;let h=c[0],p=h.replace(/(.)\/+$/,"$1"),s=c.slice(1);return{params:n.reduce((v,w,T)=>{let{paramName:I,isOptional:O}=w;if(I==="*"){let B=s[T]||"";p=h.slice(0,h.length-B.length).replace(/(.)\/+$/,"$1")}const D=s[T];return O&&!D?v[I]=void 0:v[I]=(D||"").replace(/%2F/g,"/"),v},{}),pathname:h,pathnameBase:p,pattern:e}}function $fe(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),Y9(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],c="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(h,p,s)=>(n.push({paramName:p,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),c+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":e!==""&&e!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,t?void 0:"i"),n]}function Gfe(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Y9(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function tZ(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}const e_=e=>e.join("/").replace(/\/\/+/g,"/"),Hfe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/");function Wfe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const rZ=["post","put","patch","delete"];new Set(rZ);const qfe=["get",...rZ];new Set(qfe);/**
* React Router v6.30.1
*
* Copyright (c) Remix Software Inc.
*
* This source code is licensed under the MIT license found in the
* LICENSE.md file in the root directory of this source tree.
*
* @license MIT
*/function hE(){return hE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hE.apply(this,arguments)}const Zfe=Z.createContext(null),Kfe=Z.createContext(null),nZ=Z.createContext(null),rk=Z.createContext(null),nk=Z.createContext({outlet:null,matches:[],isDataRoute:!1}),iZ=Z.createContext(null);function n3(){return Z.useContext(rk)!=null}function sZ(){return n3()||Za(!1),Z.useContext(rk).location}function Xfe(e,t){return Yfe(e,t)}function Yfe(e,t,r,n){n3()||Za(!1);let{navigator:c}=Z.useContext(nZ),{matches:h}=Z.useContext(nk),p=h[h.length-1],s=p?p.params:{};p&&p.pathname;let v=p?p.pathnameBase:"/";p&&p.route;let w=sZ(),T;if(t){var I;let G=typeof t=="string"?tk(t):t;v==="/"||(I=G.pathname)!=null&&I.startsWith(v)||Za(!1),T=G}else T=w;let O=T.pathname||"/",D=O;if(v!=="/"){let G=v.replace(/^\//,"").split("/");D="/"+O.replace(/^\//,"").split("/").slice(G.length).join("/")}let B=Ife(e,{pathname:D}),N=rpe(B&&B.map(G=>Object.assign({},G,{params:Object.assign({},s,G.params),pathname:e_([v,c.encodeLocation?c.encodeLocation(G.pathname).pathname:G.pathname]),pathnameBase:G.pathnameBase==="/"?v:e_([v,c.encodeLocation?c.encodeLocation(G.pathnameBase).pathname:G.pathnameBase])})),h,r,n);return t&&N?Z.createElement(rk.Provider,{value:{location:hE({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:ef.Pop}},N):N}function Jfe(){let e=ope(),t=Wfe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Z.createElement(Z.Fragment,null,Z.createElement("h2",null,"Unexpected Application Error!"),Z.createElement("h3",{style:{fontStyle:"italic"}},t),r?Z.createElement("pre",{style:n},r):null,null)}const Qfe=Z.createElement(Jfe,null);class epe extends Z.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?Z.createElement(nk.Provider,{value:this.props.routeContext},Z.createElement(iZ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function tpe(e){let{routeContext:t,match:r,children:n}=e,c=Z.useContext(Zfe);return c&&c.static&&c.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=r.route.id),Z.createElement(nk.Provider,{value:t},n)}function rpe(e,t,r,n){var c;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var h;if(!r)return null;if(r.errors)e=r.matches;else if((h=n)!=null&&h.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let p=e,s=(c=r)==null?void 0:c.errors;if(s!=null){let T=p.findIndex(I=>I.route.id&&s?.[I.route.id]!==void 0);T>=0||Za(!1),p=p.slice(0,Math.min(p.length,T+1))}let v=!1,w=-1;if(r&&n&&n.v7_partialHydration)for(let T=0;T<p.length;T++){let I=p[T];if((I.route.HydrateFallback||I.route.hydrateFallbackElement)&&(w=T),I.route.id){let{loaderData:O,errors:D}=r,B=I.route.loader&&O[I.route.id]===void 0&&(!D||D[I.route.id]===void 0);if(I.route.lazy||B){v=!0,w>=0?p=p.slice(0,w+1):p=[p[0]];break}}}return p.reduceRight((T,I,O)=>{let D,B=!1,N=null,G=null;r&&(D=s&&I.route.id?s[I.route.id]:void 0,N=I.route.errorElement||Qfe,v&&(w<0&&O===0?(ape("route-fallback"),B=!0,G=null):w===O&&(B=!0,G=I.route.hydrateFallbackElement||null)));let U=t.concat(p.slice(0,O+1)),V=()=>{let X;return D?X=N:B?X=G:I.route.Component?X=Z.createElement(I.route.Component,null):I.route.element?X=I.route.element:X=T,Z.createElement(tpe,{match:I,routeContext:{outlet:T,matches:U,isDataRoute:r!=null},children:X})};return r&&(I.route.ErrorBoundary||I.route.errorElement||O===0)?Z.createElement(epe,{location:r.location,revalidation:r.revalidation,component:N,error:D,children:V(),routeContext:{outlet:null,matches:U,isDataRoute:!0}}):V()},null)}var oZ=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(oZ||{});function npe(e){let t=Z.useContext(Kfe);return t||Za(!1),t}function ipe(e){let t=Z.useContext(nk);return t||Za(!1),t}function spe(e){let t=ipe(),r=t.matches[t.matches.length-1];return r.route.id||Za(!1),r.route.id}function ope(){var e;let t=Z.useContext(iZ),r=npe(oZ.UseRouteError),n=spe();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}const eV={};function ape(e,t,r){eV[e]||(eV[e]=!0)}function lpe(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function fj(e){Za(!1)}function cpe(e){let{basename:t="/",children:r=null,location:n,navigationType:c=ef.Pop,navigator:h,static:p=!1,future:s}=e;n3()&&Za(!1);let v=t.replace(/^\/*/,"/"),w=Z.useMemo(()=>({basename:v,navigator:h,static:p,future:hE({v7_relativeSplatPath:!1},s)}),[v,s,h,p]);typeof n=="string"&&(n=tk(n));let{pathname:T="/",search:I="",hash:O="",state:D=null,key:B="default"}=n,N=Z.useMemo(()=>{let G=tZ(T,v);return G==null?null:{location:{pathname:G,search:I,hash:O,state:D,key:B},navigationType:c}},[v,T,I,O,D,B,c]);return N==null?null:Z.createElement(nZ.Provider,{value:w},Z.createElement(rk.Provider,{children:r,value:N}))}function upe(e){let{children:t,location:r}=e;return Xfe(pj(t),r)}new Promise(()=>{});function pj(e,t){t===void 0&&(t=[]);let r=[];return Z.Children.forEach(e,(n,c)=>{if(!Z.isValidElement(n))return;let h=[...t,c];if(n.type===Z.Fragment){r.push.apply(r,pj(n.props.children,h));return}n.type!==fj&&Za(!1),!n.props.index||!n.props.children||Za(!1);let p={id:n.props.id||h.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(p.children=pj(n.props.children,h)),r.push(p)}),r}/**
* React Router DOM v6.30.1
*
* Copyright (c) Remix Software Inc.
*
* This source code is licensed under the MIT license found in the
* LICENSE.md file in the root directory of this source tree.
*
* @license MIT
*/const hpe="6";try{window.__reactRouterVersion=hpe}catch{}const dpe="startTransition",tV=GD[dpe];function fpe(e){let{basename:t,children:r,future:n,window:c}=e,h=Z.useRef();h.current==null&&(h.current=kfe({window:c,v5Compat:!0}));let p=h.current,[s,v]=Z.useState({action:p.action,location:p.location}),{v7_startTransition:w}=n||{},T=Z.useCallback(I=>{w&&tV?tV(()=>v(I)):v(I)},[v,w]);return Z.useLayoutEffect(()=>p.listen(T),[p,T]),Z.useEffect(()=>lpe(n),[n]),Z.createElement(cpe,{basename:t,children:r,location:s.location,navigationType:s.action,navigator:p,future:n})}var rV;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(rV||(rV={}));var nV;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(nV||(nV={}));const tv=function(e,t,r){let n=Promise.resolve();function c(h){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=h,window.dispatchEvent(p),!p.defaultPrevented)throw h}return n.then(h=>{for(const p of h||[])p.status==="rejected"&&c(p.reason);return e().catch(c)})};var aZ={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(zo,function(){var r,n,c;function h(s,v){if(!r)r=v;else if(!n)n=v;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",T={};r(T),c=v(T),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}h(["exports"],function(s){var v=1e-6,w=typeof Float32Array<"u"?Float32Array:Array;function T(l,i){var a=i[0],d=i[1],f=i[2],y=i[3],_=a*y-f*d;return _?(l[0]=y*(_=1/_),l[1]=-d*_,l[2]=-f*_,l[3]=a*_,l):null}function I(){var l=new w(9);return w!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function O(l,i){var a=i[0],d=i[1],f=i[2],y=i[3],_=i[4],S=i[5],A=i[6],k=i[7],j=i[8];return l[0]=_*j-S*k,l[1]=f*k-d*j,l[2]=d*S-f*_,l[3]=S*A-y*j,l[4]=a*j-f*A,l[5]=f*y-a*S,l[6]=y*k-_*A,l[7]=d*A-a*k,l[8]=a*_-d*y,l}function D(l,i,a){var d=i[0],f=i[1],y=i[2],_=i[3],S=i[4],A=i[5],k=i[6],j=i[7],R=i[8],L=a[0],W=a[1],q=a[2],J=a[3],Q=a[4],oe=a[5],de=a[6],he=a[7],fe=a[8];return l[0]=L*d+W*_+q*k,l[1]=L*f+W*S+q*j,l[2]=L*y+W*A+q*R,l[3]=J*d+Q*_+oe*k,l[4]=J*f+Q*S+oe*j,l[5]=J*y+Q*A+oe*R,l[6]=de*d+he*_+fe*k,l[7]=de*f+he*S+fe*j,l[8]=de*y+he*A+fe*R,l}function B(){var l=new w(16);return w!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function N(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function G(l,i){var a=i[0],d=i[1],f=i[2],y=i[3],_=i[4],S=i[5],A=i[6],k=i[7],j=i[8],R=i[9],L=i[10],W=i[11],q=i[12],J=i[13],Q=i[14],oe=i[15],de=a*S-d*_,he=a*A-f*_,fe=a*k-y*_,Ie=d*A-f*S,Ae=d*k-y*S,ke=f*k-y*A,Le=j*J-R*q,Be=j*Q-L*q,at=j*oe-W*q,Ge=R*Q-L*J,ft=R*oe-W*J,wt=L*oe-W*Q,xt=de*wt-he*ft+fe*Ge+Ie*at-Ae*Be+ke*Le;return xt?(l[0]=(S*wt-A*ft+k*Ge)*(xt=1/xt),l[1]=(f*ft-d*wt-y*Ge)*xt,l[2]=(J*ke-Q*Ae+oe*Ie)*xt,l[3]=(L*Ae-R*ke-W*Ie)*xt,l[4]=(A*at-_*wt-k*Be)*xt,l[5]=(a*wt-f*at+y*Be)*xt,l[6]=(Q*fe-q*ke-oe*he)*xt,l[7]=(j*ke-L*fe+W*he)*xt,l[8]=(_*ft-S*at+k*Le)*xt,l[9]=(d*at-a*ft-y*Le)*xt,l[10]=(q*Ae-J*fe+oe*de)*xt,l[11]=(R*fe-j*Ae-W*de)*xt,l[12]=(S*Be-_*Ge-A*Le)*xt,l[13]=(a*Ge-d*Be+f*Le)*xt,l[14]=(J*he-q*Ie-Q*de)*xt,l[15]=(j*Ie-R*he+L*de)*xt,l):null}function U(l,i,a){var d=i[0],f=i[1],y=i[2],_=i[3],S=i[4],A=i[5],k=i[6],j=i[7],R=i[8],L=i[9],W=i[10],q=i[11],J=i[12],Q=i[13],oe=i[14],de=i[15],he=a[0],fe=a[1],Ie=a[2],Ae=a[3];return l[0]=he*d+fe*S+Ie*R+Ae*J,l[1]=he*f+fe*A+Ie*L+Ae*Q,l[2]=he*y+fe*k+Ie*W+Ae*oe,l[3]=he*_+fe*j+Ie*q+Ae*de,l[4]=(he=a[4])*d+(fe=a[5])*S+(Ie=a[6])*R+(Ae=a[7])*J,l[5]=he*f+fe*A+Ie*L+Ae*Q,l[6]=he*y+fe*k+Ie*W+Ae*oe,l[7]=he*_+fe*j+Ie*q+Ae*de,l[8]=(he=a[8])*d+(fe=a[9])*S+(Ie=a[10])*R+(Ae=a[11])*J,l[9]=he*f+fe*A+Ie*L+Ae*Q,l[10]=he*y+fe*k+Ie*W+Ae*oe,l[11]=he*_+fe*j+Ie*q+Ae*de,l[12]=(he=a[12])*d+(fe=a[13])*S+(Ie=a[14])*R+(Ae=a[15])*J,l[13]=he*f+fe*A+Ie*L+Ae*Q,l[14]=he*y+fe*k+Ie*W+Ae*oe,l[15]=he*_+fe*j+Ie*q+Ae*de,l}function V(l,i,a){var d,f,y,_,S,A,k,j,R,L,W,q,J=a[0],Q=a[1],oe=a[2];return i===l?(l[12]=i[0]*J+i[4]*Q+i[8]*oe+i[12],l[13]=i[1]*J+i[5]*Q+i[9]*oe+i[13],l[14]=i[2]*J+i[6]*Q+i[10]*oe+i[14],l[15]=i[3]*J+i[7]*Q+i[11]*oe+i[15]):(f=i[1],y=i[2],_=i[3],S=i[4],A=i[5],k=i[6],j=i[7],R=i[8],L=i[9],W=i[10],q=i[11],l[0]=d=i[0],l[1]=f,l[2]=y,l[3]=_,l[4]=S,l[5]=A,l[6]=k,l[7]=j,l[8]=R,l[9]=L,l[10]=W,l[11]=q,l[12]=d*J+S*Q+R*oe+i[12],l[13]=f*J+A*Q+L*oe+i[13],l[14]=y*J+k*Q+W*oe+i[14],l[15]=_*J+j*Q+q*oe+i[15]),l}function X(l,i,a){var d=a[0],f=a[1],y=a[2];return l[0]=i[0]*d,l[1]=i[1]*d,l[2]=i[2]*d,l[3]=i[3]*d,l[4]=i[4]*f,l[5]=i[5]*f,l[6]=i[6]*f,l[7]=i[7]*f,l[8]=i[8]*y,l[9]=i[9]*y,l[10]=i[10]*y,l[11]=i[11]*y,l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l}function Y(l,i,a){var d=Math.sin(a),f=Math.cos(a),y=i[4],_=i[5],S=i[6],A=i[7],k=i[8],j=i[9],R=i[10],L=i[11];return i!==l&&(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[4]=y*f+k*d,l[5]=_*f+j*d,l[6]=S*f+R*d,l[7]=A*f+L*d,l[8]=k*f-y*d,l[9]=j*f-_*d,l[10]=R*f-S*d,l[11]=L*f-A*d,l}function ne(l,i,a){var d=Math.sin(a),f=Math.cos(a),y=i[0],_=i[1],S=i[2],A=i[3],k=i[8],j=i[9],R=i[10],L=i[11];return i!==l&&(l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=y*f-k*d,l[1]=_*f-j*d,l[2]=S*f-R*d,l[3]=A*f-L*d,l[8]=y*d+k*f,l[9]=_*d+j*f,l[10]=S*d+R*f,l[11]=A*d+L*f,l}function ae(l,i,a){var d=Math.sin(a),f=Math.cos(a),y=i[0],_=i[1],S=i[2],A=i[3],k=i[4],j=i[5],R=i[6],L=i[7];return i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=y*f+k*d,l[1]=_*f+j*d,l[2]=S*f+R*d,l[3]=A*f+L*d,l[4]=k*f-y*d,l[5]=j*f-_*d,l[6]=R*f-S*d,l[7]=L*f-A*d,l}function le(l,i){return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ge(l,i,a){var d,f,y,_=a[0],S=a[1],A=a[2],k=Math.hypot(_,S,A);return k<v?null:(_*=k=1/k,S*=k,A*=k,d=Math.sin(i),f=Math.cos(i),l[0]=_*_*(y=1-f)+f,l[1]=S*_*y+A*d,l[2]=A*_*y-S*d,l[3]=0,l[4]=_*S*y-A*d,l[5]=S*S*y+f,l[6]=A*S*y+_*d,l[7]=0,l[8]=_*A*y+S*d,l[9]=S*A*y-_*d,l[10]=A*A*y+f,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function je(l,i){var a=i[0],d=i[1],f=i[2],y=i[3],_=a+a,S=d+d,A=f+f,k=a*_,j=d*_,R=d*S,L=f*_,W=f*S,q=f*A,J=y*_,Q=y*S,oe=y*A;return l[0]=1-R-q,l[1]=j+oe,l[2]=L-Q,l[3]=0,l[4]=j-oe,l[5]=1-k-q,l[6]=W+J,l[7]=0,l[8]=L+Q,l[9]=W-J,l[10]=1-k-R,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}Math.hypot||(Math.hypot=function(){for(var l=0,i=arguments.length;i--;)l+=arguments[i]*arguments[i];return Math.sqrt(l)});var ze=U;function Pe(){var l=new w(3);return w!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Ke(l){var i=new w(3);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i}function Ye(l){return Math.hypot(l[0],l[1],l[2])}function Oe(l,i,a){var d=new w(3);return d[0]=l,d[1]=i,d[2]=a,d}function tt(l,i,a,d){return l[0]=i,l[1]=a,l[2]=d,l}function We(l,i,a){return l[0]=i[0]+a[0],l[1]=i[1]+a[1],l[2]=i[2]+a[2],l}function lt(l,i,a){return l[0]=i[0]-a[0],l[1]=i[1]-a[1],l[2]=i[2]-a[2],l}function rt(l,i,a){return l[0]=i[0]*a[0],l[1]=i[1]*a[1],l[2]=i[2]*a[2],l}function ht(l,i,a){return l[0]=Math.min(i[0],a[0]),l[1]=Math.min(i[1],a[1]),l[2]=Math.min(i[2],a[2]),l}function vt(l,i,a){return l[0]=Math.max(i[0],a[0]),l[1]=Math.max(i[1],a[1]),l[2]=Math.max(i[2],a[2]),l}function mt(l,i,a){return l[0]=i[0]*a,l[1]=i[1]*a,l[2]=i[2]*a,l}function ct(l,i,a,d){return l[0]=i[0]+a[0]*d,l[1]=i[1]+a[1]*d,l[2]=i[2]+a[2]*d,l}function Ut(l,i){var a=i[0]-l[0],d=i[1]-l[1],f=i[2]-l[2];return a*a+d*d+f*f}function xr(l){var i=l[0],a=l[1],d=l[2];return i*i+a*a+d*d}function tn(l,i){return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l}function Er(l,i){var a=i[0],d=i[1],f=i[2],y=a*a+d*d+f*f;return y>0&&(y=1/Math.sqrt(y)),l[0]=i[0]*y,l[1]=i[1]*y,l[2]=i[2]*y,l}function Ft(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]}function br(l,i,a){var d=i[0],f=i[1],y=i[2],_=a[0],S=a[1],A=a[2];return l[0]=f*A-y*S,l[1]=y*_-d*A,l[2]=d*S-f*_,l}function Yt(l,i,a,d){var f=i[0],y=i[1],_=i[2];return l[0]=f+d*(a[0]-f),l[1]=y+d*(a[1]-y),l[2]=_+d*(a[2]-_),l}function Qt(l,i,a){var d=i[0],f=i[1],y=i[2],_=a[3]*d+a[7]*f+a[11]*y+a[15];return l[0]=(a[0]*d+a[4]*f+a[8]*y+a[12])/(_=_||1),l[1]=(a[1]*d+a[5]*f+a[9]*y+a[13])/_,l[2]=(a[2]*d+a[6]*f+a[10]*y+a[14])/_,l}function Sr(l,i,a){var d=i[0],f=i[1],y=i[2];return l[0]=d*a[0]+f*a[3]+y*a[6],l[1]=d*a[1]+f*a[4]+y*a[7],l[2]=d*a[2]+f*a[5]+y*a[8],l}function Vt(l,i,a){var d=a[0],f=a[1],y=a[2],_=i[0],S=i[1],A=i[2],k=f*A-y*S,j=y*_-d*A,R=d*S-f*_,L=f*R-y*j,W=y*k-d*R,q=d*j-f*k,J=2*a[3];return j*=J,R*=J,W*=2,q*=2,l[0]=_+(k*=J)+(L*=2),l[1]=S+j+W,l[2]=A+R+q,l}function Nn(l){return l[0]=0,l[1]=0,l[2]=0,l}function Jr(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]}var Kr=lt,Mn=rt,Fi=Ye;function Us(){var l=new w(4);return w!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function ks(l,i,a){return l[0]=i[0]*a,l[1]=i[1]*a,l[2]=i[2]*a,l[3]=i[3]*a,l}function Wi(l,i){var a=i[0],d=i[1],f=i[2],y=i[3],_=a*a+d*d+f*f+y*y;return _>0&&(_=1/Math.sqrt(_)),l[0]=a*_,l[1]=d*_,l[2]=f*_,l[3]=y*_,l}function Bi(l,i,a){var d=i[0],f=i[1],y=i[2],_=i[3];return l[0]=a[0]*d+a[4]*f+a[8]*y+a[12]*_,l[1]=a[1]*d+a[5]*f+a[9]*y+a[13]*_,l[2]=a[2]*d+a[6]*f+a[10]*y+a[14]*_,l[3]=a[3]*d+a[7]*f+a[11]*y+a[15]*_,l}function wo(){var l=new w(4);return w!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function vs(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function $l(l,i,a){a*=.5;var d=i[0],f=i[1],y=i[2],_=i[3],S=Math.sin(a),A=Math.cos(a);return l[0]=d*A+_*S,l[1]=f*A+y*S,l[2]=y*A-f*S,l[3]=_*A-d*S,l}function kc(l,i,a){a*=.5;var d=i[0],f=i[1],y=i[2],_=i[3],S=Math.sin(a),A=Math.cos(a);return l[0]=d*A-y*S,l[1]=f*A+_*S,l[2]=y*A+d*S,l[3]=_*A-f*S,l}Pe(),Us();var Pi,xs,ju,Xa=Wi,Ya=(Pi=Pe(),xs=Oe(1,0,0),ju=Oe(0,1,0),function(l,i,a){var d=Ft(i,a);return d<-.999999?(br(Pi,xs,i),Fi(Pi)<1e-6&&br(Pi,ju,i),Er(Pi,Pi),function(f,y,_){_*=.5;var S=Math.sin(_);f[0]=S*y[0],f[1]=S*y[1],f[2]=S*y[2],f[3]=Math.cos(_)}(l,Pi,Math.PI),l):d>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(br(Pi,i,a),l[0]=Pi[0],l[1]=Pi[1],l[2]=Pi[2],l[3]=1+d,Xa(l,l))});function Ps(){var l=new w(2);return w!=Float32Array&&(l[0]=0,l[1]=0),l}function oo(l,i){var a=new w(2);return a[0]=l,a[1]=i,a}function Ta(l,i,a){return l[0]=i[0]+a[0],l[1]=i[1]+a[1],l}function ao(l,i,a){return l[0]=i[0]-a[0],l[1]=i[1]-a[1],l}function Ja(l,i,a){return l[0]=i[0]*a,l[1]=i[1]*a,l}function So(l){return Math.hypot(l[0],l[1])}function Pc(l,i){var a=i[0],d=i[1],f=a*a+d*d;return f>0&&(f=1/Math.sqrt(f)),l[0]=i[0]*f,l[1]=i[1]*f,l}function Yn(l,i){return l[0]*i[0]+l[1]*i[1]}wo(),wo(),I();var Cc,Ic,To=ao;function Gl(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}Ps();var Ea=function(){if(Ic)return Cc;function l(i,a,d,f){this.cx=3*i,this.bx=3*(d-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(f-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=d,this.p2y=f}return Ic=1,Cc=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,a){if(a===void 0&&(a=1e-6),i<0)return 0;if(i>1)return 1;for(var d=i,f=0;f<8;f++){var y=this.sampleCurveX(d)-i;if(Math.abs(y)<a)return d;var _=this.sampleCurveDerivativeX(d);if(Math.abs(_)<1e-6)break;d-=y/_}var S=0,A=1;for(d=i,f=0;f<20&&(y=this.sampleCurveX(d),!(Math.abs(y-i)<a));f++)i>y?S=d:A=d,d=.5*(A-S)+S;return d},solve:function(i,a){return this.sampleCurveY(this.solveCurveX(i,a))}},Cc}(),Mc=Gl(Ea);function ut(l,i){this.x=l,this.y=i}function qn(l,i){if(Array.isArray(l)){if(!Array.isArray(i)||l.length!==i.length)return!1;for(let a=0;a<l.length;a++)if(!qn(l[a],i[a]))return!1;return!0}if(typeof l=="object"&&l!==null&&i!==null){if(typeof i!="object"||Object.keys(l).length!==Object.keys(i).length)return!1;for(const a in l)if(!qn(l[a],i[a]))return!1;return!0}return l===i}ut.prototype={clone(){return new ut(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,i){return this.clone()._rotateAround(l,i)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const i=l.x-this.x,a=l.y-this.y;return i*i+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,i){return Math.atan2(this.x*i-this.y*l,this.x*l+this.y*i)},_matMult(l){const i=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=i,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const i=Math.cos(l),a=Math.sin(l),d=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=d,this},_rotateAround(l,i){const a=Math.cos(l),d=Math.sin(l),f=i.y+d*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-d*(this.y-i.y),this.y=f,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ut},ut.convert=function(l){if(l instanceof ut)return l;if(Array.isArray(l))return new ut(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new ut(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ci=Math.PI/180,$s=180/Math.PI;function Br(l){return l*Ci}function He(l){return l*$s}const se=[[0,0],[1,0],[1,1],[0,1]];function ce(l){if(l<=0)return 0;if(l>=1)return 1;const i=l*l,a=i*l;return 4*(l<.5?a:3*(l-i)+a-.75)}function ye(l,i,a,d){const f=new Mc(l,i,a,d);return function(y){return f.solve(y)}}const Me=ye(.25,.1,.25,1);function xe(l,i,a){return Math.min(a,Math.max(i,l))}function Fe(l,i,a){return(a=xe((a-l)/(i-l),0,1))*a*(3-2*a)}function et(l,i,a){const d=a-i,f=((l-i)%d+d)%d+i;return f===i?a:f}function Ve(l,i,a){if(!l.length)return a(null,[]);let d=l.length;const f=new Array(l.length);let y=null;l.forEach((_,S)=>{i(_,(A,k)=>{A&&(y=A),f[S]=k,--d==0&&a(y,f)})})}function Qe(l,...i){for(const a of i)for(const d in a)l[d]=a[d];return l}let Ot=1;function gt(){return Ot++}function ar(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function _r(l,i){l.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function Tr(l,i,a){const d={};for(const f in l)d[f]=i.call(this,l[f],f,l);return d}function Gr(l,i,a){const d={};for(const f in l)i.call(this,l[f],f,l)&&(d[f]=l[f]);return d}function zr(l){return Array.isArray(l)?l.map(zr):typeof l=="object"&&l?Tr(l,zr):l}function Wr(l,i){for(let a=0;a<l.length;a++)if(i.indexOf(l[a])>=0)return!0;return!1}const Vn={};function qr(l){Vn[l]||(typeof console<"u"&&console.warn(l),Vn[l]=!0)}function Ti(l,i,a){return(a.y-l.y)*(i.x-l.x)>(i.y-l.y)*(a.x-l.x)}function ts(l){let i=0;for(let a,d,f=0,y=l.length,_=y-1;f<y;_=f++)a=l[f],d=l[_],i+=(d.x-a.x)*(a.y+d.y);return i}function qi([l,i,a]){const d=Br(i+90),f=Br(a);return{x:l*Math.cos(d)*Math.sin(f),y:l*Math.sin(d)*Math.sin(f),z:l*Math.cos(f),azimuthal:i,polar:a}}function Dn(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function pn(l){const i={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,d,f,y)=>{const _=f||y;return i[d]=!_||_.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let bi=null;function pi(l,i){return[l[4*i],l[4*i+1],l[4*i+2],l[4*i+3]]}function ci(l,i,a,d){for(;i<a;){const f=i+a>>1;l[f]<d?i=f+1:a=f}return i}function bs(l,i,a,d){for(;i<a;){const f=i+a>>1;l[f]<=d?i=f+1:a=f}return i}function Eo(l){return l>0?1/(1.001-l):1+l}function Gs(l){return l>0?1-1/(1.001-l):-l}function Mf(l,i,a){return(l-i.min)*(a.max-a.min)/(i.max-i.min)+a.min}const Cs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Cs.API_URL)return null;try{const l=new URL(Cs.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Oc(l){return Cs.API_URL_REGEX.test(l)}function Bm(l){return Cs.API_SPRITE_REGEX.test(l)}let Of,jf,Vm,Um,Ru,Rf;function $m(){return Of==null&&(Of=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Of}const Qa={now:()=>Um!==void 0?Um:performance.now(),setNow(l){Um=l},restoreNow(){Um=void 0},frame(l){const i=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(l,i=0){const{width:a,height:d}=l;Ru||(Ru=document.createElement("canvas"));const f=Ru.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(a>Ru.width||d>Ru.height)&&(Ru.width=a,Ru.height=d),f.clearRect(-i,-i,a+2*i,d+2*i),f.drawImage(l,0,0,a,d),f.getImageData(-i,-i,a+2*i,d+2*i)},resolveURL:l=>(jf||(jf=document.createElement("a")),jf.href=l,jf.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Vm==null&&(Vm=window.matchMedia("(prefers-reduced-motion: reduce)")),Vm.matches)},hasCanvasFingerprintNoise(){if(Rf!==void 0)return Rf;if(!$m())return Rf=!1,!1;const l=new OffscreenCanvas(85,1),i=l.getContext("2d",{willReadFrequently:!0});let a=0;for(let f=0;f<l.width;++f)i.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,i.fillRect(f,0,1,1);const d=i.getImageData(0,0,l.width,l.height);a=0;for(let f=0;f<d.data.length;++f)if(f%4!=3&&a++!==d.data[f])return Rf=!0,!0;return Rf=!1,!1}};function ra(l,i){const a=l.indexOf("?");if(a<0)return`${l}?${new URLSearchParams(i).toString()}`;const d=new URLSearchParams(l.slice(a));for(const f in i)d.set(f,i[f]);return`${l.slice(0,a)}?${d.toString()}`}function Aa(l,i={persistentParams:[]}){const a=l.indexOf("?");if(a<0)return l;const d=new URLSearchParams,f=new URLSearchParams(l.slice(a));for(const _ of i.persistentParams){const S=f.get(_);S&&d.set(_,S)}const y=d.toString();return`${l.slice(0,a)}${y.length>0?`?${y}`:""}`}const Hl="mapbox-tiles";let el=500,Wl=50;const Df=["language","worldview","jobid"];let jc,Lf;function Du(){try{return caches}catch{}}function $h(){const l=Du();l&&jc==null&&(jc=l.open(Hl))}let bv=1/0;const wv={supported:!1,testSupport:function(l){!zf&&Lu&&(Gh?p1(l):Ao=l)}};let Ao,Lu,zf=!1,Gh=!1;const f1=typeof self<"u"?self:{};function p1(l){const i=l.createTexture();l.bindTexture(l.TEXTURE_2D,i);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Lu),l.isContextLost())return;wv.supported=!0}catch{}l.deleteTexture(i),zf=!0}f1.document&&(Lu=f1.document.createElement("img"),Lu.onload=function(){Ao&&p1(Ao),Ao=null,Gh=!0},Lu.onerror=function(){zf=!0,Ao=null},Lu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Nf={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Nf);class sn extends Error{constructor(i,a,d){a===401&&Oc(d)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Gm=Dn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Hh=function(l,i){if(!(/^file:/.test(a=l.url)||/^file:/.test(Gm())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,f){const y=new AbortController,_=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Gm(),referrerPolicy:d.referrerPolicy,signal:y.signal});let S=!1,A=!1;const k=(j=_.url).indexOf("sku=")>0&&Oc(j);var j;d.type==="json"&&_.headers.set("Accept","application/json");const R=(W,q,J)=>{if(A)return;if(W&&W.message!=="SecurityError"&&qr(W.toString()),q&&J)return L(q);const Q=Date.now();fetch(_).then(oe=>{if(oe.ok){const de=k?oe.clone():null;return L(oe,de,Q)}return f(new sn(oe.statusText,oe.status,d.url))}).catch(oe=>{oe.name!=="AbortError"&&f(new Error(`${oe.message} ${d.url}`))})},L=(W,q,J)=>{(d.type==="arrayBuffer"?W.arrayBuffer():d.type==="json"?W.json():W.text()).then(Q=>{A||(q&&J&&function(oe,de,he){if($h(),jc==null)return;const fe=pn(de.headers.get("Cache-Control")||"");if(fe["no-store"])return;const Ie={status:de.status,statusText:de.statusText,headers:new Headers};de.headers.forEach((Le,Be)=>Ie.headers.set(Be,Le)),fe["max-age"]&&Ie.headers.set("Expires",new Date(he+1e3*fe["max-age"]).toUTCString());const Ae=Ie.headers.get("Expires");if(!Ae||new Date(Ae).getTime()-he<42e4)return;let ke=Aa(oe.url,{persistentParams:Df});if(de.status===206){const Le=oe.headers.get("Range");if(!Le)return;Ie.status=200,ke=ra(ke,{range:Le})}(function(Le,Be){if(Lf===void 0)try{new Response(new ReadableStream),Lf=!0}catch{Lf=!1}Lf?Be(Le.body):Le.blob().then(Be).catch(at=>qr(at.message))})(de,Le=>{const Be=new Response((at=de.status)!==200&&at!==404&&[101,103,204,205,304].includes(at)?null:Le,Ie);var at;$h(),jc?.then(Ge=>Ge.put(ke,Be)).catch(Ge=>qr(Ge.message))})}(_,q,J),S=!0,f(null,Q,W.headers.get("Cache-Control"),W.headers.get("Expires")))}).catch(Q=>{A||f(new Error(Q.message))})};return k?function(W,q){if($h(),jc==null)return q(null);jc.then(J=>{let Q=Aa(W.url,{persistentParams:Df});const oe=W.headers.get("Range");oe&&(Q=ra(Q,{range:oe})),J.match(Q).then(de=>{const he=function(fe){if(!fe)return!1;const Ie=new Date(fe.headers.get("Expires")||0),Ae=pn(fe.headers.get("Cache-Control")||"");return Number(Ie)>Date.now()&&!Ae["no-cache"]}(de);J.delete(Q).catch(q),he&&J.put(Q,de.clone()).catch(q),q(null,de,he)}).catch(q)}).catch(q)}(_,R):R(null,null),{cancel:()=>{A=!0,S||y.abort()}}}(l,i);if(Dn(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,i,void 0,!0)}var a;return function(d,f){const y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const _ in d.headers)y.setRequestHeader(_,d.headers[_]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{f(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let _=y.response;if(d.type==="json")try{_=JSON.parse(y.response)}catch(S){return f(S)}f(null,_,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else f(new sn(y.statusText,y.status,d.url))},y.send(d.body),{cancel:()=>y.abort()}}(l,i)},Ff=function(l,i){return Hh(Qe(l,{type:"arrayBuffer"}),i)};function SP(l){const i=document.createElement("a");return i.href=l,i.protocol===location.protocol&&i.host===location.host}const Bf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let zu,Rc;zu=[],Rc=0;const Vf=function(l,i){if(wv.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),Rc>=Cs.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:l,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return zu.push(y),y}Rc++;let a=!1;const d=()=>{if(!a)for(a=!0,Rc--;zu.length&&Rc<Cs.MAX_PARALLEL_IMAGE_REQUESTS;){const y=zu.shift(),{requestParameters:_,callback:S,cancelled:A}=y;A||(y.cancel=Vf(_,S).cancel)}},f=Ff(l,(y,_,S,A)=>{d(),y?i(y):_&&(self.createImageBitmap?function(k,j){const R=new Blob([new Uint8Array(k)],{type:"image/png"});createImageBitmap(R).then(L=>{j(null,L)}).catch(L=>{j(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(k,j)=>i(k,j,S,A)):function(k,j){const R=new Image;R.onload=()=>{j(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=Bf})},R.onerror=()=>j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(k)],{type:"image/png"});R.src=k.byteLength?URL.createObjectURL(L):Bf}(_,(k,j)=>i(k,j,S,A)))});return{cancel:()=>{f.cancel(),d()}}};var m1,Hm,g1,Wh={exports:{}},Nu={exports:{}},y1={exports:{}},Uf=function(){if(g1)return Wh.exports;g1=1;var l=(m1||(m1=1,Nu.exports=function(a,d){var f,y,_,S,A,k,j,R;for(y=a.length-(f=3&a.length),_=d,A=3432918353,k=461845907,R=0;R<y;)j=255&a.charCodeAt(R)|(255&a.charCodeAt(++R))<<8|(255&a.charCodeAt(++R))<<16|(255&a.charCodeAt(++R))<<24,++R,_=27492+(65535&(S=5*(65535&(_=(_^=j=(65535&(j=(j=(65535&j)*A+(((j>>>16)*A&65535)<<16)&4294967295)<<15|j>>>17))*k+(((j>>>16)*k&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(j=0,f){case 3:j^=(255&a.charCodeAt(R+2))<<16;case 2:j^=(255&a.charCodeAt(R+1))<<8;case 1:_^=j=(65535&(j=(j=(65535&(j^=255&a.charCodeAt(R)))*A+(((j>>>16)*A&65535)<<16)&4294967295)<<15|j>>>17))*k+(((j>>>16)*k&65535)<<16)&4294967295}return _^=a.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Nu.exports),i=(Hm||(Hm=1,y1.exports=function(a,d){for(var f,y=a.length,_=d^y,S=0;y>=4;)f=1540483477*(65535&(f=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(f>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:_^=(255&a.charCodeAt(S+2))<<16;case 2:_^=(255&a.charCodeAt(S+1))<<8;case 1:_=1540483477*(65535&(_^=255&a.charCodeAt(S)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),y1.exports);return Wh.exports=l,Wh.exports.murmur3=l,Wh.exports.murmur2=i,Wh.exports}(),qh=Gl(Uf);class ql{constructor(i,...a){Qe(this,a[0]||{}),this.type=i}}class na extends ql{constructor(i,a={}){super("error",Qe({error:i},a))}}function Sv(l,i,a){a[l]&&a[l].indexOf(i)!==-1||(a[l]=a[l]||[],a[l].push(i))}function Tv(l,i,a){if(a&&a[l]){const d=a[l].indexOf(i);d!==-1&&a[l].splice(d,1)}}class Fu{on(i,a){return this._listeners=this._listeners||{},Sv(i,a,this._listeners),this}off(i,a){return Tv(i,a,this._listeners),Tv(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Sv(i,a,this._oneTimeListeners),this):new Promise(d=>{this.once(i,d)})}fire(i,a){const d=typeof i=="string"?new ql(i,a):i,f=d.type;if(this.listens(f)){d.target=this;const y=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const A of y)A.call(this,d);const _=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const A of _)Tv(f,A,this._oneTimeListeners),A.call(this,d);const S=this._eventedParent;S&&(Qe(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(d))}else d instanceof na&&console.error(d.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}class Bo{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new Bo(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[a,d]=i.split("");return new Bo({name:a,iconsetId:d})}static isEqual(i,a){return i.name===a.name&&i.iconsetId===a.iconsetId}toString(){return Bo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ev,Wm={},Av=function(){if(Ev)return Wm;Ev=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(y){return(y=Math.round(y))<0?0:y>255?255:y}function a(y){return i(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function d(y){return(_=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:_>1?1:_;var _}function f(y,_,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?y+(_-y)*S*6:2*S<1?_:3*S<2?y+(_-y)*(2/3-S)*6:y}try{Wm.parseCSSColor=function(y){var _,S=y.replace(/ /g,"").toLowerCase();if(S in l)return l[S].slice();if(S[0]==="#")return S.length===4?(_=parseInt(S.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:S.length===7&&(_=parseInt(S.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var A=S.indexOf("("),k=S.indexOf(")");if(A!==-1&&k+1===S.length){var j=S.substr(0,A),R=S.substr(A+1,k-(A+1)).split(","),L=1;switch(j){case"rgba":if(R.length!==4)return null;L=d(R.pop());case"rgb":return R.length!==3?null:[a(R[0]),a(R[1]),a(R[2]),L];case"hsla":if(R.length!==4)return null;L=d(R.pop());case"hsl":if(R.length!==3)return null;var W=(parseFloat(R[0])%360+360)%360/360,q=d(R[1]),J=d(R[2]),Q=J<=.5?J*(q+1):J+q-J*q,oe=2*J-Q;return[i(255*f(oe,Q,W+1/3)),i(255*f(oe,Q,W)),i(255*f(oe,Q,W-1/3)),L];default:return null}}return null}}catch{}return Wm}();class Tn{constructor(i,a,d,f=1){this.r=i,this.g=a,this.b=d,this.a=f}static parse(i){if(!i)return;if(i instanceof Tn)return i;if(typeof i!="string")return;const a=Av.parseCSSColor(i);return a?new Tn(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[i,a,d,f]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*a)},${Math.round(255*d)},${f})`}toNonPremultipliedRenderColor(i){const{r:a,g:d,b:f,a:y}=this;return new Zh(i,a,d,f,y)}toPremultipliedRenderColor(i){const{r:a,g:d,b:f,a:y}=this;return new _1(i,a*y,d*y,f*y,y)}clone(){return new Tn(this.r,this.g,this.b,this.a)}}class $f{constructor(i,a,d,f,y,_=!1){if(this.premultiplied=!1,this.premultiplied=_,i){const S=i.image.height,A=S*S;this.premultiplied?(a=y===0?0:a/y*(S-1),d=y===0?0:d/y*(S-1),f=y===0?0:f/y*(S-1)):(a*=S-1,d*=S-1,f*=S-1);const k=Math.floor(a),j=Math.floor(d),R=Math.floor(f),L=Math.ceil(a),W=Math.ceil(d),q=Math.ceil(f),J=a-k,Q=d-j,oe=f-R,de=i.image.data,he=4*(k+j*A+R*S),fe=4*(k+j*A+q*S),Ie=4*(k+W*A+R*S),Ae=4*(k+W*A+q*S),ke=4*(L+j*A+R*S),Le=4*(L+j*A+q*S),Be=4*(L+W*A+R*S),at=4*(L+W*A+q*S);if(he<0||at>=de.length)throw new Error("out of range");this.r=lr(lr(lr(de[he],de[fe],oe),lr(de[Ie],de[Ae],oe),Q),lr(lr(de[ke],de[Le],oe),lr(de[Be],de[at],oe),Q),J)/255*(this.premultiplied?y:1),this.g=lr(lr(lr(de[he+1],de[fe+1],oe),lr(de[Ie+1],de[Ae+1],oe),Q),lr(lr(de[ke+1],de[Le+1],oe),lr(de[Be+1],de[at+1],oe),Q),J)/255*(this.premultiplied?y:1),this.b=lr(lr(lr(de[he+2],de[fe+2],oe),lr(de[Ie+2],de[Ae+2],oe),Q),lr(lr(de[ke+2],de[Le+2],oe),lr(de[Be+2],de[at+2],oe),Q),J)/255*(this.premultiplied?y:1),this.a=y}else this.r=a,this.g=d,this.b=f,this.a=y}toArray(){const{r:i,g:a,b:d,a:f}=this;return[255*i,255*a,255*d,f]}toHslaArray(){let{r:i,g:a,b:d,a:f}=this;if(this.premultiplied){if(f===0)return[0,0,0,0];i/=f,a/=f,d/=f}const y=Math.min(Math.max(i,0),1),_=Math.min(Math.max(a,0),1),S=Math.min(Math.max(d,0),1),A=Math.min(y,_,S),k=Math.max(y,_,S),j=(A+k)/2;if(A===k)return[0,0,100*j,f];const R=k-A,L=j>.5?R/(2-k-A):R/(k+A);let W=0;return k===y?W=(_-S)/R+(_<S?6:0):k===_?W=(S-y)/R+2:k===S&&(W=(y-_)/R+4),W*=60,[Math.min(Math.max(W,0),360),Math.min(Math.max(100*L,0),100),Math.min(Math.max(100*j,0),100),f]}toArray01(){const{r:i,g:a,b:d,a:f}=this;return[i,a,d,f]}toArray01Scaled(i){const{r:a,g:d,b:f}=this;return[a*i,d*i,f*i]}toArray01Linear(){const{r:i,g:a,b:d,a:f}=this;return[Math.pow(i,2.2),Math.pow(a,2.2),Math.pow(d,2.2),f]}}class Zh extends $f{constructor(i,a,d,f,y){super(i,a,d,f,y,!1)}}class _1 extends $f{constructor(i,a,d,f,y){super(i,a,d,f,y,!0)}}function lr(l,i,a){return l*(1-a)+i*a}function v1(l,i,a){return l.map((d,f)=>lr(d,i[f],a))}Tn.black=new Tn(0,0,0,1),Tn.white=new Tn(1,1,1,1),Tn.transparent=new Tn(0,0,0,0),Tn.red=new Tn(1,0,0,1),Tn.blue=new Tn(0,0,1,1);var Gf=Object.freeze({__proto__:null,array:v1,color:function(l,i,a){return new Tn(lr(l.r,i.r,a),lr(l.g,i.g,a),lr(l.b,i.b,a),lr(l.a,i.a,a))},number:lr});function Bu(l,...i){for(const a of i)for(const d in a)l[d]=a[d];return l}class ia extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class kv{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[d,f]of a)this.bindings[d]=f}concat(i){return new kv(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Kh={kind:"null"},sr={kind:"number"},yn={kind:"string"},_n={kind:"boolean"},Vo={kind:"color"},Zl={kind:"object"},En={kind:"value"},qm={kind:"collator"},Hf={kind:"formatted"},Wf={kind:"resolvedImage"};function Hs(l,i){return{kind:"array",itemType:l,N:i}}function Zi(l){if(l.kind==="array"){const i=Zi(l.itemType);return typeof l.N=="number"?`array<${i}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${i}>`}return l.kind}const TP=[Kh,sr,yn,_n,Vo,Hf,Zl,Hs(En),Wf];function Xh(l,i){if(i.kind==="error")return null;if(l.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Xh(l.itemType,i.itemType))&&(typeof l.N!="number"||l.N===i.N))return null}else{if(l.kind===i.kind)return null;if(l.kind==="value"){for(const a of TP)if(!Xh(a,i))return null}}return`Expected ${Zi(l)} but found ${Zi(i)} instead.`}function Dc(l,i){return i.some(a=>a.kind===l.kind)}function qf(l,i){return i.some(a=>a==="null"?l===null:a==="array"?Array.isArray(l):a==="object"?l&&!Array.isArray(l)&&typeof l=="object":a===typeof l)}function Zm(l,i){return l.kind==="array"&&i.kind==="array"?l.N===i.N&&Zm(l.itemType,i.itemType):l.kind===i.kind}class Zf{constructor(i,a,d){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Km{constructor(i,a,d,f,y){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=d,this.fontStack=f,this.textColor=y}}class lo{constructor(i){this.sections=i}static fromString(i){return new lo([new Km(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof lo?i:lo.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){const f=a.image.getPrimary().id.toString();i.push(["image",f]);continue}i.push(a.text);const d={};a.fontStack&&(d["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(d["font-scale"]=a.scale),a.textColor&&(d["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(d)}return i}}class Kl{constructor(i,a={}){if(this.id=Bo.from(i),this.options=Object.assign({},a),a.transform){const{a:d,b:f,c:y,d:_,e:S,f:A}=a.transform;this.options.transform=new DOMMatrix([d,f,y,_,S,A])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:i,b:a,c:d,d:f,e:y,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:i,b:a,c:d,d:f,e:y,f:_}})}static parse(i){let a,d,f,y;try{({name:a,iconsetId:d,params:f,transform:y}=JSON.parse(i)||{})}catch{return null}if(!a)return null;const{a:_,b:S,c:A,d:k,e:j,f:R}=y||{};return new Kl({name:a,iconsetId:d},{params:f,transform:new DOMMatrix([_,S,A,k,j,R])})}scaleSelf(i,a){return this.options.transform.scaleSelf(i,a),this}}class ko{constructor(i,a,d,f,y=!1){this.primaryId=Bo.from(i),this.primaryOptions=a,d&&(this.secondaryId=Bo.from(d)),this.secondaryOptions=f,this.available=y}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Kl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Kl(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?ko.build({name:i}):i}static build(i,a,d,f){return!i||typeof i=="object"&&!("name"in i)?null:new ko(i,d,a,f)}}function Vu(l,i,a,d){return typeof l=="number"&&l>=0&&l<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[l,i,a,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[l,i,a,d]:[l,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Or(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Tn||l instanceof Zf||l instanceof lo||l instanceof ko)return!0;if(Array.isArray(l)){for(const i of l)if(!Or(i))return!1;return!0}if(typeof l=="object"){for(const i in l)if(!Or(l[i]))return!1;return!0}return!1}function Wt(l){if(l===null)return Kh;if(typeof l=="string")return yn;if(typeof l=="boolean")return _n;if(typeof l=="number")return sr;if(l instanceof Tn)return Vo;if(l instanceof Zf)return qm;if(l instanceof lo)return Hf;if(l instanceof ko)return Wf;if(Array.isArray(l)){const i=l.length;let a;for(const d of l){const f=Wt(d);if(a){if(a===f)continue;a=En;break}a=f}return Hs(a||En,i)}return Zl}function ka(l){const i=typeof l;return l===null?"":i==="string"||i==="number"||i==="boolean"?String(l):l instanceof lo||l instanceof ko||l instanceof Tn?l.toString():JSON.stringify(l)}class mr{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(i.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Or(i[1]))return a.error("invalid value");const d=i[1];let f=Wt(d);const y=a.expectedType;return f.kind!=="array"||f.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(f=y),new mr(f,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Tn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof lo?this.value.serialize():this.value}}class Ui{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Kf={string:yn,number:sr,boolean:_n,object:Zl};class ur{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let d,f=1;const y=i[0];if(y==="array"){let S,A;if(i.length>2){const k=i[1];if(typeof k!="string"||!(k in Kf)||k==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);S=Kf[k],f++}else S=En;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);A=i[2],f++}d=Hs(S,A)}else d=Kf[y];const _=[];for(;f<i.length;f++){const S=a.parse(i[f],f,En);if(!S)return null;_.push(S)}return new ur(d,_)}evaluate(i){for(let a=0;a<this.args.length;a++){const d=this.args[a].evaluate(i);if(!Xh(this.type,Wt(d)))return d;if(a===this.args.length-1)throw new Ui(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Zi(Wt(d))} but was expected to be of type ${Zi(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if(i.kind==="array"){const d=i.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){a.push(d.kind);const f=i.N;(typeof f=="number"||this.args.length>1)&&a.push(f)}}return a.concat(this.args.map(d=>d.serialize()))}}class Yh{constructor(i){this.type=Hf,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return a.error("First argument must be an image or text section.");const f=[];let y=!1;for(let _=1;_<=i.length-1;++_){const S=i[_];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;let A=null;if(S["font-scale"]&&(A=a.parseObjectValue(S["font-scale"],_,"font-scale",sr),!A))return null;let k=null;if(S["text-font"]&&(k=a.parseObjectValue(S["text-font"],_,"text-font",Hs(yn)),!k))return null;let j=null;if(S["text-color"]&&(j=a.parseObjectValue(S["text-color"],_,"text-color",Vo),!j))return null;const R=f[f.length-1];R.scale=A,R.font=k,R.textColor=j}else{const A=a.parse(i[_],_,En);if(!A)return null;const k=A.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,f.push({content:A,scale:null,font:null,textColor:null})}}return new Yh(f)}evaluate(i){return new lo(this.sections.map(a=>{const d=a.content.evaluate(i);return Zm(Wt(d),Wf)?new Km("",d,null,null,null):new Km(ka(d),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const d={};a.scale&&(d["font-scale"]=a.scale.serialize()),a.font&&(d["text-font"]=a.font.serialize()),a.textColor&&(d["text-color"]=a.textColor.serialize()),i.push(d)}return i}}class Jh{constructor(i,a,d,f){this._imageWarnHistory={},this.type=Wf,this.namePrimary=i,this.nameSecondary=a,d&&(this.paramsPrimary=d.params,this.iconsetIdPrimary=d.iconset?d.iconset.id:void 0),f&&(this.paramsSecondary=f.params,this.iconsetIdSecondary=f.iconset?f.iconset.id:void 0)}static parse(i,a){if(i.length<2)return a.error("Expected two or more arguments.");let d=1;const f=[];function y(){if(d<i.length){const S=a.parse(i[d],d++,yn);return S?(f.push({image:S,options:{}}),!0):(a.error(f.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(d<i.length){const A=i[d];if((S=A)===null||typeof S!="object"||Array.isArray(S))return!0;const k=A.params,j=A.iconset,R=a.concat(d);if(!k&&!j)return d++,!0;if(k){if(typeof k!="object"||k.constructor!==Object)return R.error('Image options "params" should be an object'),!1;const L={},W=R.concat(void 0,"params");for(const q in k){if(!q)return W.error("Image parameter name should be non-empty"),!1;const J=W.concat(void 0,q).parse(k[q],void 0,Vo,void 0,{typeAnnotation:"coerce"});if(!J)return!1;L[q]=J}f[f.length-1].options.params=L}if(j){if(typeof j!="object"||j.constructor!==Object)return R.error('Image options "iconset" should be an object'),!1;if(!j.id)return R.error('Image options "iconset" should have an "id" property'),!1;f[f.length-1].options.iconset=j}return d++,!0}var S;return!0}for(let S=0;S<2;S++)if(!y()||!_())return;return new Jh(f[0].image,f[1]?f[1].image:void 0,f[0].options,f[1]?f[1].options:void 0)}evaluateParams(i,a){const d={};if(a){for(const f in a)if(a[f])try{d[f]=a[f].evaluate(i)}catch{continue}if(Object.keys(d).length!==0)return{params:d}}}evaluate(i){const a={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},d=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,f=ko.build(a,d,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(f&&i.availableImages){const y=f.getPrimary().id;if(f.available=i.availableImages.some(_=>Bo.isEqual(_,y)),f.available){const _=f.getSecondary()?f.getSecondary().id:null;_&&(f.available=i.availableImages.some(S=>Bo.isEqual(S,_)))}}return f}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&i(this.paramsPrimary[a]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&i(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(i,a){const d={};if(a&&(d.iconset={id:a}),i){d.params={};for(const f in i)i[f]&&(d.params[f]=i[f].serialize())}return Object.keys(d).length>0?d:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&i.push(a)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&i.push(a)}return i}}function Lc(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}const x1={"to-boolean":_n,"to-color":Vo,"to-number":sr,"to-string":yn};class Pa{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const d=i[0],f=[];let y=Kh;if(d==="to-array"){if(!Array.isArray(i[1]))return null;const _=i[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);y=Hs(a.expectedType.itemType,_)}else{if(!(_>0&&Or(i[1][0])))return null;y=Hs(Wt(i[1][0]),_)}for(let S=0;S<_;S++){const A=i[1][S];let k;if(Lc(A)==="array")k=a.parse(A,void 0,y.itemType);else{const j=Lc(A);if(j!==y.itemType.kind)return a.error(`Expected ${y.itemType.kind} but found ${j}.`);k=a.registry.literal.parse(["literal",A===void 0?null:A],a)}if(!k)return null;f.push(k)}}else{if((d==="to-boolean"||d==="to-string")&&i.length!==2)return a.error("Expected one argument.");y=x1[d];for(let _=1;_<i.length;_++){const S=a.parse(i[_],_,En);if(!S)return null;f.push(S)}}return new Pa(y,f)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let a,d;for(const f of this.args){if(a=f.evaluate(i),d=null,a instanceof Tn)return a;if(typeof a=="string"){const y=i.parseColor(a);if(y)return y}else if(Array.isArray(a)&&(d=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Vu(a[0],a[1],a[2],a[3]),!d))return new Tn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ui(d||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const d of this.args){if(a=d.evaluate(i),a===null)return 0;const f=Number(a);if(!isNaN(f))return f}throw new Ui(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?lo.fromString(ka(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?ko.build(ka(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(a=>a.evaluate(i)):ka(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Yh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Jh(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}const co=["Unknown","Point","LineString","Polygon"];class Xf{constructor(i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?co[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:d,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*a-i[0])+this.featureDistanceData.bearing[1]*(f*a-i[1])}return 0}parseColor(i){let a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=Tn.parse(i)),a}getConfig(i){return this.options?this.options.get(i):null}}class ws{constructor(i,a,d,f,y){this.name=i,this.type=a,this._evaluate=d,this.args=f,this._overloadIndex=y}evaluate(i){if(!this._evaluate){const a=ws.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const d=i[0],f=ws.definitions[d];if(!f)return a.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(f)?f[0]:f.type,_=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,S=[];let A=null,k=-1;for(const[j,R]of _){if(Array.isArray(j)&&j.length!==i.length-1)continue;S.push(j),k++,A=new lg(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const L=[];let W=!1;for(let q=1;q<i.length;q++){const J=i[q],Q=Array.isArray(j)?j[q-1]:j.type,oe=A.parse(J,1+L.length,Q);if(!oe){W=!0;break}L.push(oe)}if(!W)if(Array.isArray(j)&&j.length!==L.length)A.error(`Expected ${j.length} arguments, but found ${L.length} instead.`);else{for(let q=0;q<L.length;q++){const J=Array.isArray(j)?j[q]:j.type,Q=L[q];A.concat(q+1).checkSubtype(J,Q.type)}if(A.errors.length===0)return new ws(d,y,R,L,k)}}if(S.length===1)a.errors.push(...A.errors);else{const j=(S.length?S:_.map(([L])=>L)).map(Pv).join(" | "),R=[];for(let L=1;L<i.length;L++){const W=a.parse(i[L],1+R.length);if(!W)return null;R.push(Zi(W.type))}a.error(`Expected arguments of type ${j}, but found (${R.join(", ")}) instead.`)}return null}static register(i,a){ws.definitions=a;for(const d in a)i[d]=ws}}function Pv(l){return Array.isArray(l)?`(${l.map(Zi).join(", ")})`:`(${Zi(l.type)}...)`}class yl{constructor(i,a,d){this.type=qm,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(i.length!==2)return a.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return a.error("Collator options argument must be an object.");const f=d["case-sensitive"]===void 0?a.parse(!1,1,_n):a.parseObjectValue(d["case-sensitive"],1,"case-sensitive",_n);if(!f)return null;const y=d["diacritic-sensitive"]===void 0?a.parse(!1,1,_n):a.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",_n);if(!y)return null;let _=null;return d.locale&&(_=a.parseObjectValue(d.locale,1,"locale",yn),!_)?null:new yl(f,y,_)}evaluate(i){return new Zf(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function Ws(l,i,a=0,d=l.length-1,f=EP){for(;d>a;){if(d-a>600){const A=d-a+1,k=i-a+1,j=Math.log(A),R=.5*Math.exp(2*j/3),L=.5*Math.sqrt(j*R*(A-R)/A)*(k-A/2<0?-1:1);Ws(l,i,Math.max(a,Math.floor(i-k*R/A+L)),Math.min(d,Math.floor(i+(A-k)*R/A+L)),f)}const y=l[i];let _=a,S=d;for(Yf(l,a,i),f(l[d],y)>0&&Yf(l,a,d);_<S;){for(Yf(l,_,S),_++,S--;f(l[_],y)<0;)_++;for(;f(l[S],y)>0;)S--}f(l[a],y)===0?Yf(l,a,S):(S++,Yf(l,S,d)),S<=i&&(a=S+1),i<=S&&(d=S-1)}}function Yf(l,i,a){const d=l[i];l[i]=l[a],l[a]=d}function EP(l,i){return l<i?-1:l>i?1:0}function AP(l){let i=0;for(let a,d,f=0,y=l.length,_=y-1;f<y;_=f++)a=l[f],d=l[_],i+=(d.x-a.x)*(a.y+d.y);return i}function zc(l,i){l[0]=Math.min(l[0],i[0]),l[1]=Math.min(l[1],i[1]),l[2]=Math.max(l[2],i[0]),l[3]=Math.max(l[3],i[1])}function Qh(l,i){return!(l[0]<=i[0]||l[2]>=i[2]||l[1]<=i[1]||l[3]>=i[3])}function Uu(l,i,a){const d=l[0]-i[0],f=l[1]-i[1],y=l[0]-a[0],_=l[1]-a[1];return d*_-y*f==0&&d*y<=0&&f*_<=0}function ed(l,i,a=!1){let d=!1;for(let S=0,A=i.length;S<A;S++){const k=i[S];for(let j=0,R=k.length,L=R-1;j<R;L=j++){const W=k[L],q=k[j];if(Uu(l,W,q))return a;(y=W)[1]>(f=l)[1]!=(_=q)[1]>f[1]&&f[0]<(_[0]-y[0])*(f[1]-y[1])/(_[1]-y[1])+y[0]&&(d=!d)}}var f,y,_;return d}function b1(l,i,a,d){const f=d[0]-a[0],y=d[1]-a[1],_=(l[0]-a[0])*y-f*(l[1]-a[1]),S=(i[0]-a[0])*y-f*(i[1]-a[1]);return _>0&&S<0||_<0&&S>0}function Xm(l,i,a,d){return(f=[d[0]-a[0],d[1]-a[1]])[0]*(y=[i[0]-l[0],i[1]-l[1]])[1]-f[1]*y[0]!=0&&!(!b1(l,i,a,d)||!b1(a,d,l,i));var f,y}function Cv(l){const i=new ut(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new ut(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const d of l[0])i.x>d.x&&(i.x=d.x),i.y>d.y&&(i.y=d.y),a.x<d.x&&(a.x=d.x),a.y<d.y&&(a.y=d.y);return{min:i,max:a}}const Nc=8192;function kP(l,i){const a=(180+l[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,f=Math.pow(2,i.z);return[Math.round(a*f*Nc),Math.round(d*f*Nc)]}function w1(l,i){for(let a=0;a<i.length;a++)if(ed(l,i[a]))return!0;return!1}function PP(l,i,a){for(const d of a)for(let f=0,y=d.length,_=y-1;f<y;_=f++)if(Xm(l,i,d[_],d[f]))return!0;return!1}function S1(l,i){for(let a=0;a<l.length;++a)if(!ed(l[a],i))return!1;for(let a=0;a<l.length-1;++a)if(PP(l[a],l[a+1],i))return!1;return!0}function T1(l,i){for(let a=0;a<i.length;a++)if(S1(l,i[a]))return!0;return!1}function Iv(l,i,a){const d=[];for(let f=0;f<l.length;f++){const y=[];for(let _=0;_<l[f].length;_++){const S=kP(l[f][_],a);zc(i,S),y.push(S)}d.push(y)}return d}function Fc(l,i,a){const d=[];for(let f=0;f<l.length;f++){const y=Iv(l[f],i,a);d.push(y)}return d}function E1(l,i,a,d){if(l[0]<a[0]||l[0]>a[2]){const f=.5*d;let y=l[0]-a[0]>f?-d:a[0]-l[0]>f?d:0;y===0&&(y=l[0]-a[2]>f?-d:a[2]-l[0]>f?d:0),l[0]+=y}zc(i,l)}function A1(l,i,a,d){const f=Math.pow(2,d.z)*Nc,y=[d.x*Nc,d.y*Nc],_=[];if(!l)return _;for(const S of l)for(const A of S){const k=[A.x+y[0],A.y+y[1]];E1(k,i,a,f),_.push(k)}return _}function Ym(l,i,a,d){const f=Math.pow(2,d.z)*Nc,y=[d.x*Nc,d.y*Nc],_=[];if(!l)return _;for(const A of l){const k=[];for(const j of A){const R=[j.x+y[0],j.y+y[1]];zc(i,R),k.push(R)}_.push(k)}if(i[2]-i[0]<=f/2){(S=i)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const A of _)for(const k of A)E1(k,i,a,f)}var S;return _}class Bc{constructor(i,a){this.type=_n,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Or(i[1])){const d=i[1];if(d.type==="FeatureCollection")for(let f=0;f<d.features.length;++f){const y=d.features[f].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Bc(d,d.features[f].geometry)}else if(d.type==="Feature"){const f=d.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Bc(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Bc(d,d)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(a,d){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const S=Iv(d.coordinates,y,_),A=A1(a.geometry(),f,y,_);if(!Qh(f,y))return!1;for(const k of A)if(!ed(k,S))return!1}if(d.type==="MultiPolygon"){const S=Fc(d.coordinates,y,_),A=A1(a.geometry(),f,y,_);if(!Qh(f,y))return!1;for(const k of A)if(!w1(k,S))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(a,d){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const S=Iv(d.coordinates,y,_),A=Ym(a.geometry(),f,y,_);if(!Qh(f,y))return!1;for(const k of A)if(!S1(k,S))return!1}if(d.type==="MultiPolygon"){const S=Fc(d.coordinates,y,_),A=Ym(a.geometry(),f,y,_);if(!Qh(f,y))return!1;for(const k of A)if(!T1(k,S))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Jf={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ca=1/298.257223563,Mv=Ca*(2-Ca),td=Math.PI/180;class rd{static fromTile(i,a,d){const f=Math.PI*(1-2*(i+.5)/Math.pow(2,a)),y=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/td;return new rd(y,d)}static get units(){return Jf}constructor(i,a){if(i===void 0)throw new Error("No latitude given.");if(a&&!Jf[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Jf).join(", ")}`);const d=6378.137*td*(a?Jf[a]:1),f=Math.cos(i*td),y=1/(1-Mv*(1-f*f)),_=Math.sqrt(y);this.kx=d*_*f,this.ky=d*_*y*(1-Mv)}distance(i,a){const d=sa(i[0]-a[0])*this.kx,f=(i[1]-a[1])*this.ky;return Math.sqrt(d*d+f*f)}bearing(i,a){const d=sa(a[0]-i[0])*this.kx;return Math.atan2(d,(a[1]-i[1])*this.ky)/td}destination(i,a,d){const f=d*td;return this.offset(i,Math.sin(f)*a,Math.cos(f)*a)}offset(i,a,d){return[i[0]+a/this.kx,i[1]+d/this.ky]}lineDistance(i){let a=0;for(let d=0;d<i.length-1;d++)a+=this.distance(i[d],i[d+1]);return a}area(i){let a=0;for(let d=0;d<i.length;d++){const f=i[d];for(let y=0,_=f.length,S=_-1;y<_;S=y++)a+=sa(f[y][0]-f[S][0])*(f[y][1]+f[S][1])*(d?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(i,a){let d=0;if(a<=0)return i[0];for(let f=0;f<i.length-1;f++){const y=i[f],_=i[f+1],S=this.distance(y,_);if(d+=S,d>a)return Jm(y,_,(a-(d-S))/S)}return i[i.length-1]}pointToSegmentDistance(i,a,d){let[f,y]=a,_=sa(d[0]-f)*this.kx,S=(d[1]-y)*this.ky;if(_!==0||S!==0){const A=(sa(i[0]-f)*this.kx*_+(i[1]-y)*this.ky*S)/(_*_+S*S);A>1?(f=d[0],y=d[1]):A>0&&(f+=_/this.kx*A,y+=S/this.ky*A)}return _=sa(i[0]-f)*this.kx,S=(i[1]-y)*this.ky,Math.sqrt(_*_+S*S)}pointOnLine(i,a){let d=1/0,f=i[0][0],y=i[0][1],_=0,S=0;for(let A=0;A<i.length-1;A++){let k=i[A][0],j=i[A][1],R=sa(i[A+1][0]-k)*this.kx,L=(i[A+1][1]-j)*this.ky,W=0;R===0&&L===0||(W=(sa(a[0]-k)*this.kx*R+(a[1]-j)*this.ky*L)/(R*R+L*L),W>1?(k=i[A+1][0],j=i[A+1][1]):W>0&&(k+=R/this.kx*W,j+=L/this.ky*W)),R=sa(a[0]-k)*this.kx,L=(a[1]-j)*this.ky;const q=R*R+L*L;q<d&&(d=q,f=k,y=j,_=A,S=W)}return{point:[f,y],index:_,t:Math.max(0,Math.min(1,S))}}lineSlice(i,a,d){let f=this.pointOnLine(d,i),y=this.pointOnLine(d,a);if(f.index>y.index||f.index===y.index&&f.t>y.t){const k=f;f=y,y=k}const _=[f.point],S=f.index+1,A=y.index;!Ov(d[S],_[0])&&S<=A&&_.push(d[S]);for(let k=S+1;k<=A;k++)_.push(d[k]);return Ov(d[A],y.point)||_.push(y.point),_}lineSliceAlong(i,a,d){let f=0;const y=[];for(let _=0;_<d.length-1;_++){const S=d[_],A=d[_+1],k=this.distance(S,A);if(f+=k,f>i&&y.length===0&&y.push(Jm(S,A,(i-(f-k))/k)),f>=a)return y.push(Jm(S,A,(a-(f-k))/k)),y;f>i&&y.push(A)}return y}bufferPoint(i,a){const d=a/this.ky,f=a/this.kx;return[i[0]-f,i[1]-d,i[0]+f,i[1]+d]}bufferBBox(i,a){const d=a/this.ky,f=a/this.kx;return[i[0]-f,i[1]-d,i[2]+f,i[3]+d]}insideBBox(i,a){return sa(i[0]-a[0])>=0&&sa(i[0]-a[2])<=0&&i[1]>=a[1]&&i[1]<=a[3]}}function Ov(l,i){return l[0]===i[0]&&l[1]===i[1]}function Jm(l,i,a){const d=sa(i[0]-l[0]);return[l[0]+d*a,l[1]+(i[1]-l[1])*a]}function sa(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class Qm{constructor(i=[],a=(d,f)=>d<f?-1:d>f?1:0){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:d}=this,f=a[i];for(;i>0;){const y=i-1>>1,_=a[y];if(d(f,_)>=0)break;a[i]=_,i=y}a[i]=f}_down(i){const{data:a,compare:d}=this,f=this.length>>1,y=a[i];for(;i<f;){let _=1+(i<<1);const S=_+1;if(S<this.length&&d(a[S],a[_])<0&&(_=S),d(a[_],y)>=0)break;a[i]=a[_],i=_}a[i]=y}}var Dt=8192;function jv(l,i){return i.dist-l.dist}const eg=100,tg=50;function Qf(l){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==l.length)return!1;for(let a=0;a<i.length;a++)if(i[a]!==l[a])return!1;return!0}function $u(l){return l[1]-l[0]+1}function Ia(l,i){const a=l[1]>=l[0]&&l[1]<i;return a||console.warn("Distance Expression: Index is out of range"),a}function rg(l,i){if(l[0]>l[1])return[null,null];const a=$u(l);if(i){if(a===2)return[l,null];const d=Math.floor(a/2);return[[l[0],l[0]+d],[l[0]+d,l[1]]]}{if(a===1)return[l,null];const d=Math.floor(a/2)-1;return[[l[0],l[0]+d],[l[0]+d+1,l[1]]]}}function Vc(l,i){const a=[1/0,1/0,-1/0,-1/0];if(!Ia(i,l.length))return a;for(let d=i[0];d<=i[1];++d)zc(a,l[d]);return a}function ep(l){const i=[1/0,1/0,-1/0,-1/0];for(let a=0;a<l.length;++a)for(let d=0;d<l[a].length;++d)zc(i,l[a][d]);return i}function tl(l,i,a){if(Qf(l)||Qf(i))return NaN;let d=0,f=0;return l[2]<i[0]&&(d=i[0]-l[2]),l[0]>i[2]&&(d=l[0]-i[2]),l[1]>i[3]&&(f=l[1]-i[3]),l[3]<i[1]&&(f=i[1]-l[3]),a.distance([0,0],[d,f])}function Xr(l){return 360*l-180}function CP(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Rv(l,i){const a=Math.pow(2,i.z),d=(l.y/Dt+i.y)/a;return[Xr((l.x/Dt+i.x)/a),CP(d)]}function IP(l,i){const a=[];for(let d=0;d<l.length;++d)a.push(Rv(l[d],i));return a}function Dv(l,i,a){const d=a.pointOnLine(i,l).point;return a.distance(l,d)}function k1(l,i,a,d,f){const y=a.slice(d[0],d[1]+1);let _=1/0;for(let S=i[0];S<=i[1];++S)if((_=Math.min(_,Dv(l[S],y,f)))===0)return 0;return _}function li(l,i,a,d,f){const y=Math.min(f.pointToSegmentDistance(l,a,d),f.pointToSegmentDistance(i,a,d)),_=Math.min(f.pointToSegmentDistance(a,l,i),f.pointToSegmentDistance(d,l,i));return Math.min(y,_)}function MP(l,i,a,d,f){if(!Ia(i,l.length)||!Ia(d,a.length))return NaN;let y=1/0;for(let _=i[0];_<i[1];++_)for(let S=d[0];S<d[1];++S){if(Xm(l[_],l[_+1],a[S],a[S+1]))return 0;y=Math.min(y,li(l[_],l[_+1],a[S],a[S+1],f))}return y}function OP(l,i,a,d,f){if(!Ia(i,l.length)||!Ia(d,a.length))return NaN;let y=1/0;for(let _=i[0];_<=i[1];++_)for(let S=d[0];S<=d[1];++S)if((y=Math.min(y,f.distance(l[_],a[S])))===0)return y;return y}function jP(l,i,a){if(ed(l,i,!0))return 0;let d=1/0;for(const f of i){const y=f.length;if(y<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[y-1]&&(d=Math.min(d,a.pointToSegmentDistance(l,f[y-1],f[0])))===0||(d=Math.min(d,Dv(l,f,a)))===0)return d}return d}function RP(l,i,a,d){if(!Ia(i,l.length))return NaN;for(let y=i[0];y<=i[1];++y)if(ed(l[y],a,!0))return 0;let f=1/0;for(let y=i[0];y<i[1];++y)for(const _ of a)for(let S=0,A=_.length,k=A-1;S<A;k=S++){if(Xm(l[y],l[y+1],_[k],_[S]))return 0;f=Math.min(f,li(l[y],l[y+1],_[k],_[S],d))}return f}function P1(l,i){for(const a of l)for(let d=0;d<=a.length-1;++d)if(ed(a[d],i,!0))return!0;return!1}function DP(l,i,a,d=1/0){const f=ep(l),y=ep(i);if(d!==1/0&&tl(f,y,a)>=d)return d;if(Qh(f,y)){if(P1(l,i))return 0}else if(P1(i,l))return 0;let _=d;for(const S of l)for(let A=0,k=S.length,j=k-1;A<k;j=A++)for(const R of i)for(let L=0,W=R.length,q=W-1;L<W;q=L++){if(Xm(S[j],S[A],R[q],R[L]))return 0;_=Math.min(_,li(S[j],S[A],R[q],R[L],a))}return _}function ng(l,i,a,d,f,y,_){if(y===null||_===null)return;const S=tl(Vc(d,y),Vc(f,_),a);S<i&&l.push({dist:S,range1:y,range2:_})}function LP(l,i,a,d,f=1/0){let y=Math.min(d.distance(l[0],a[0][0]),f);if(y===0)return y;const _=new Qm([{dist:0,range1:[0,l.length-1],range2:[0,0]}],jv),S=i?tg:eg,A=ep(a);for(;_.length;){const k=_.pop();if(k.dist>=y)continue;const j=k.range1;if($u(j)<=S){if(!Ia(j,l.length))return NaN;if(i){const R=RP(l,j,a,d);if((y=Math.min(y,R))===0)return y}else for(let R=j[0];R<=j[1];++R){const L=jP(l[R],a,d);if((y=Math.min(y,L))===0)return y}}else{const R=rg(j,i);if(R[0]!==null){const L=tl(Vc(l,R[0]),A,d);L<y&&_.push({dist:L,range1:R[0],range2:[0,0]})}if(R[1]!==null){const L=tl(Vc(l,R[1]),A,d);L<y&&_.push({dist:L,range1:R[1],range2:[0,0]})}}}return y}function C1(l,i,a,d,f,y=1/0){let _=Math.min(y,f.distance(l[0],a[0]));if(_===0)return _;const S=new Qm([{dist:0,range1:[0,l.length-1],range2:[0,a.length-1]}],jv),A=i?tg:eg,k=d?tg:eg;for(;S.length;){const j=S.pop();if(j.dist>=_)continue;const R=j.range1,L=j.range2;if($u(R)<=A&&$u(L)<=k){if(!Ia(R,l.length)||!Ia(L,a.length))return NaN;if(i&&d?_=Math.min(_,MP(l,R,a,L,f)):i||d?i&&!d?_=Math.min(_,k1(a,L,l,R,f)):!i&&d&&(_=Math.min(_,k1(l,R,a,L,f))):_=Math.min(_,OP(l,R,a,L,f)),_===0)return _}else{const W=rg(R,i),q=rg(L,d);ng(S,_,f,l,a,W[0],q[0]),ng(S,_,f,l,a,W[0],q[1]),ng(S,_,f,l,a,W[1],q[0]),ng(S,_,f,l,a,W[1],q[1])}}return _}function Lv(l,i,a,d,f=1/0){let y=f;const _=Vc(l,[0,l.length-1]);for(const S of a)if(!(y!==1/0&&tl(_,Vc(S,[0,S.length-1]),d)>=y)&&(y=Math.min(y,C1(l,i,S,!0,d,y)),y===0))return y;return y}function ig(l,i,a,d,f=1/0){let y=f;const _=Vc(l,[0,l.length-1]);for(const S of a){if(y!==1/0&&tl(_,ep(S),d)>=y)continue;const A=LP(l,i,S,d,y);if(isNaN(A))return A;if((y=Math.min(y,A))===0)return y}return y}function zv(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Gu{constructor(i,a){this.type=sr,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(Or(i[1])){const d=i[1];if(d.type==="FeatureCollection"){for(let f=0;f<d.features.length;++f)if(zv(d.features[f].geometry.type))return new Gu(d,d.features[f].geometry)}else if(d.type==="Feature"){if(zv(d.geometry.type))return new Gu(d,d.geometry)}else if(zv(d.type))return new Gu(d,d)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const a=i.geometry(),d=i.canonicalID();if(a!=null&&d!=null){if(i.geometryType()==="Point")return function(f,y,_){const S=[];for(const k of f)for(const j of k)S.push(Rv(j,y));const A=new rd(S[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?C1(S,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",A):_.type==="MultiLineString"?Lv(S,!1,_.coordinates,A):_.type==="Polygon"||_.type==="MultiPolygon"?ig(S,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,A):null}(a,d,this.geometries);if(i.geometryType()==="LineString")return function(f,y,_){const S=[];for(const k of f){const j=[];for(const R of k)j.push(Rv(R,y));S.push(j)}const A=new rd(S[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Lv(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,A);if(_.type==="MultiLineString"){let k=1/0;for(let j=0;j<_.coordinates.length;j++){const R=Lv(_.coordinates[j],!0,S,A,k);if(isNaN(R))return R;if((k=Math.min(k,R))===0)return k}return k}if(_.type==="Polygon"||_.type==="MultiPolygon"){let k=1/0;for(let j=0;j<S.length;j++){const R=ig(S[j],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,A,k);if(isNaN(R))return R;if((k=Math.min(k,R))===0)return k}return k}return null}(a,d,this.geometries);if(i.geometryType()==="Polygon")return function(f,y,_){const S=[];for(const k of function(j,R){const L=j.length;if(L<=1)return[j];const W=[];let q,J;for(let Q=0;Q<L;Q++){const oe=AP(j[Q]);oe!==0&&(j[Q].area=Math.abs(oe),J===void 0&&(J=oe<0),J===oe<0?(q&&W.push(q),q=[j[Q]]):q.push(j[Q]))}return q&&W.push(q),W}(f)){const j=[];for(let R=0;R<k.length;++R)j.push(IP(k[R],y));S.push(j)}const A=new rd(S[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return ig(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,A);if(_.type==="MultiLineString"){let k=1/0;for(let j=0;j<_.coordinates.length;j++){const R=ig(_.coordinates[j],!0,S,A,k);if(isNaN(R))return R;if((k=Math.min(k,R))===0)return k}return k}return _.type==="Polygon"||_.type==="MultiPolygon"?function(k,j,R){let L=1/0;for(const W of k)for(const q of j){const J=DP(W,q,R,L);if(isNaN(J))return J;if((L=Math.min(L,J))===0)return L}return L}(_.type==="Polygon"?[_.coordinates]:_.coordinates,S,A):null}(a,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function nd(l){if(l instanceof ws&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Bc||l instanceof Gu)return!1;if(l instanceof sd)return l.featureConstant;let i=!0;return l.eachChild(a=>{i&&!nd(a)&&(i=!1)}),i}function sg(l){if(l instanceof ws&&l.name==="feature-state")return!1;let i=!0;return l.eachChild(a=>{i&&!sg(a)&&(i=!1)}),i}function og(l){if(l instanceof sd)return new Set([l.key]);let i=new Set;return l.eachChild(a=>{i=new Set([...i,...og(a)])}),i}function id(l,i){if(l instanceof ws&&i.indexOf(l.name)>=0)return!1;let a=!0;return l.eachChild(d=>{a&&!id(d,i)&&(a=!1)}),a}function I1(l,i,a){return[l,i,a].filter(Boolean).join("")}function Nv(l,i){switch(l){case"string":return ka(i);case"number":return+i;case"boolean":return!!i;case"color":return Tn.parse(i);case"formatted":return lo.fromString(ka(i));case"resolvedImage":return ko.build(ka(i))}return i}function M1(l,i,a,d){return d!==void 0&&(l=d*Math.round(l/d)),i!==void 0&&l<i&&(l=i),a!==void 0&&l>a&&(l=a),l}class sd{constructor(i,a,d,f=!1){this.type=i,this.key=a,this.scope=d,this.featureConstant=f}static parse(i,a){let d=a.expectedType;if(d==null&&(d=En),i.length<2||i.length>3)return a.error("Invalid number of arguments for 'config' expression.");const f=a.parse(i[1],1);if(!(f instanceof mr))return a.error("Key name of 'config' expression must be a string literal.");let y,_=!0;const S=ka(f.value);if(i.length>=3){const A=a.parse(i[2],2);if(!(A instanceof mr))return a.error("Scope of 'config' expression must be a string literal.");y=ka(A.value)}if(a.options){const A=I1(S,y,a._scope),k=a.options.get(A);k&&(_=nd(k.value||k.default))}return new sd(d,S,y,_)}evaluate(i){const a=I1(this.key,this.scope,i.scope),d=i.getConfig(a);if(!d)return null;const{type:f,value:y,values:_,minValue:S,maxValue:A,stepValue:k}=d,j=d.default.evaluate(i);let R=j;if(y){const L=i.scope;i.scope=(L||"").split("").slice(1).join(""),R=y.evaluate(i),i.scope=L}return f&&(R=Nv(f,R)),R===void 0||S===void 0&&A===void 0&&k===void 0||(typeof R=="number"?R=M1(R,S,A,k):Array.isArray(R)&&(R=R.map(L=>typeof L=="number"?M1(L,S,A,k):L))),y!==void 0&&R!==void 0&&_&&!_.includes(R)&&(R=j,f&&(R=Nv(f,R))),(f&&f!==this.type||R!==void 0&&!Zm(Wt(R),this.type))&&(R=Nv(this.type.kind,R)),R}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class ag{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const d=i[1];return a.scope.has(d)?new ag(d,a.scope.get(d)):a.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class lg{constructor(i,a=[],d,f=new kv,y=[],_,S){this.registry=i,this.path=a,this.key=a.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=f,this.errors=y,this.expectedType=d,this._scope=_,this.options=S}parse(i,a,d,f,y={}){return a||d?this.concat(a,null,d,f)._parse(i,y):this._parse(i,y)}parseObjectValue(i,a,d,f,y,_={}){return this.concat(a,d,f,y)._parse(i,_)}_parse(i,a){function d(f,y,_){return _==="assert"?new ur(y,[f]):_==="coerce"?new Pa(y,[f]):f}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(f){let y=f.parse(i,this);if(!y)return null;if(this.expectedType){const _=this.expectedType,S=y.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||S.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(_,S))return null}else y=d(y,_,a.typeAnnotation||"coerce");else y=d(y,_,a.typeAnnotation||"assert")}if(!(y instanceof mr)&&y.type.kind!=="resolvedImage"&&Fv(y)){const _=new Xf(this._scope,this.options);try{y=new mr(y.type,y.evaluate(_))}catch(S){return this.error(S.message),null}}return y}return Pa.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,d,f){let y=typeof i=="number"?this.path.concat(i):this.path;y=typeof a=="string"?y.concat(a):y;const _=f?this.scope.concat(f):this.scope;return new lg(this.registry,y,d||null,_,this.errors,this._scope,this.options)}error(i,...a){const d=`${this.key}${a.map(f=>`[${f}]`).join("")}`;this.errors.push(new ia(d,i))}checkSubtype(i,a){const d=Xh(i,a);return d&&this.error(d),d}}function Fv(l){if(l instanceof ag)return Fv(l.boundExpression);if(l instanceof ws&&l.name==="error"||l instanceof yl||l instanceof Bc||l instanceof Gu||l instanceof sd)return!1;const i=l instanceof Pa||l instanceof ur;let a=!0;return l.eachChild(d=>{a=i?a&&Fv(d):a&&d instanceof mr}),!!a&&nd(l)&&id(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function cg(l,i){const a=l.length-1;let d,f,y=0,_=a,S=0;for(;y<=_;)if(S=Math.floor((y+_)/2),d=l[S],f=l[S+1],d<=i){if(S===a||i<f)return S;y=S+1}else{if(!(d>i))throw new Ui("Input is not a number.");_=S-1}return 0}class tp{constructor(i,a,d){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[f,y]of d)this.labels.push(f),this.outputs.push(y)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const d=a.parse(i[1],1,sr);if(!d)return null;const f=[];let y=null;a.expectedType&&a.expectedType.kind!=="value"&&(y=a.expectedType);for(let _=1;_<i.length;_+=2){const S=_===1?-1/0:i[_],A=i[_+1],k=_,j=_+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(f.length&&f[f.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const R=a.parse(A,j,y);if(!R)return null;y=y||R.type,f.push([S,R])}return new tp(y,d,f)}evaluate(i){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(i);const f=this.input.evaluate(i);if(f<=a[0])return d[0].evaluate(i);const y=a.length;return f>=a[y-1]?d[y-1].evaluate(i):d[cg(a,f)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}const O1=.95047,j1=1.08883,R1=4/29,od=6/29,D1=3*od*od,Bv=od*od*od,zP=Math.PI/180,L1=180/Math.PI;function Vv(l){return l>Bv?Math.pow(l,1/3):l/D1+R1}function Uv(l){return l>od?l*l*l:D1*(l-R1)}function $v(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function ug(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Gv(l){const i=ug(l.r),a=ug(l.g),d=ug(l.b),f=Vv((.4124564*i+.3575761*a+.1804375*d)/O1),y=Vv((.2126729*i+.7151522*a+.072175*d)/1);return{l:116*y-16,a:500*(f-y),b:200*(y-Vv((.0193339*i+.119192*a+.9503041*d)/j1)),alpha:l.a}}function Hu(l){let i=(l.l+16)/116,a=isNaN(l.a)?i:i+l.a/500,d=isNaN(l.b)?i:i-l.b/200;return i=1*Uv(i),a=O1*Uv(a),d=j1*Uv(d),new Tn($v(3.2404542*a-1.5371385*i-.4985314*d),$v(-.969266*a+1.8760108*i+.041556*d),$v(.0556434*a-.2040259*i+1.0572252*d),l.alpha)}function z1(l,i,a){const d=i-l;return l+a*(d>180||d<-180?d-360*Math.round(d/360):d)}const ad={forward:Gv,reverse:Hu,interpolate:function(l,i,a){return{l:lr(l.l,i.l,a),a:lr(l.a,i.a,a),b:lr(l.b,i.b,a),alpha:lr(l.alpha,i.alpha,a)}}},rp={forward:function(l){const{l:i,a,b:d}=Gv(l),f=Math.atan2(d,a)*L1;return{h:f<0?f+360:f,c:Math.sqrt(a*a+d*d),l:i,alpha:l.a}},reverse:function(l){const i=l.h*zP,a=l.c;return Hu({l:l.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:l.alpha})},interpolate:function(l,i,a){return{h:z1(l.h,i.h,a),c:lr(l.c,i.c,a),l:lr(l.l,i.l,a),alpha:lr(l.alpha,i.alpha,a)}}};var hg=Object.freeze({__proto__:null,hcl:rp,lab:ad});class Po{constructor(i,a,d,f,y){this.type=i,this.operator=a,this.interpolation=d,this.input=f,this.labels=[],this.outputs=[];for(const[_,S]of y)this.labels.push(_),this.outputs.push(S)}static interpolationFactor(i,a,d,f){let y=0;if(i.name==="exponential")y=Hv(a,i.base,d,f);else if(i.name==="linear")y=Hv(a,1,d,f);else if(i.name==="cubic-bezier"){const _=i.controlPoints;y=new Mc(_[0],_[1],_[2],_[3]).solve(Hv(a,1,d,f))}return y}static parse(i,a){let[d,f,y,..._]=i;if(!Array.isArray(f)||f.length===0)return a.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const k=f[1];if(typeof k!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:k}}else{if(f[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const k=f.slice(1);if(k.length!==4||k.some(j=>typeof j!="number"||j<0||j>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:k}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(y=a.parse(y,2,sr),!y)return null;const S=[];let A=null;d==="interpolate-hcl"||d==="interpolate-lab"?A=Vo:a.expectedType&&a.expectedType.kind!=="value"&&(A=a.expectedType);for(let k=0;k<_.length;k+=2){const j=_[k],R=_[k+1],L=k+3,W=k+4;if(typeof j!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(S.length&&S[S.length-1][0]>=j)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const q=a.parse(R,W,A);if(!q)return null;A=A||q.type,S.push([j,q])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new Po(A,d,f,y,S):a.error(`Type ${Zi(A)} is not interpolatable.`)}evaluate(i){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(i);const f=this.input.evaluate(i);if(f<=a[0])return d[0].evaluate(i);const y=a.length;if(f>=a[y-1])return d[y-1].evaluate(i);const _=cg(a,f),S=Po.interpolationFactor(this.interpolation,f,a[_],a[_+1]),A=d[_].evaluate(i),k=d[_+1].evaluate(i);return this.operator==="interpolate"?Gf[this.type.kind.toLowerCase()](A,k,S):this.operator==="interpolate-hcl"?rp.reverse(rp.interpolate(rp.forward(A),rp.forward(k),S)):ad.reverse(ad.interpolate(ad.forward(A),ad.forward(k),S))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,i,this.input.serialize()];for(let d=0;d<this.labels.length;d++)a.push(this.labels[d],this.outputs[d].serialize());return a}}function Hv(l,i,a,d){const f=d-a,y=l-a;return f===0?0:i===1?y/f:(Math.pow(i,y)-1)/(Math.pow(i,f)-1)}class dg{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let d=null;const f=a.expectedType;f&&f.kind!=="value"&&(d=f);const y=[];for(const S of i.slice(1)){const A=a.parse(S,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!A)return null;d=d||A.type,y.push(A)}const _=f&&y.some(S=>Xh(f,S.type));return new dg(_?En:d,y)}evaluate(i){let a,d=null,f=0;for(const y of this.args){if(f++,d=y.evaluate(i),d&&d instanceof ko&&!d.available&&(a||(a=d),d=null,f===this.args.length))return a;if(d!==null)break}return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class np{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let y=1;y<i.length-1;y+=2){const _=i[y];if(typeof _!="string")return a.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",y);const S=a.parse(i[y+1],y+1);if(!S)return null;d.push([_,S])}const f=a.parse(i[i.length-1],i.length-1,a.expectedType,d);return f?new np(d,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,d]of this.bindings)i.push(a,d.serialize());return i.push(this.result.serialize()),i}}class fg{constructor(i,a,d){this.type=i,this.index=a,this.input=d}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,sr),f=a.parse(i[2],2,Hs(a.expectedType||En));return d&&f?new fg(f.type.itemType,d,f):null}evaluate(i){const a=this.index.evaluate(i),d=this.input.evaluate(i);if(a<0)throw new Ui(`Array index out of bounds: ${a} < 0.`);if(a>=d.length)throw new Ui(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a!==Math.floor(a))throw new Ui(`Array index must be an integer, but found ${a} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return d[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Wv{constructor(i,a,d){this.type=i,this.index=a,this.input=d}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,sr),f=a.parse(i[2],2,Hs(a.expectedType||En));return d&&f?new Wv(f.type.itemType,d,f):null}evaluate(i){const a=this.index.evaluate(i),d=this.input.evaluate(i);if(a<0)throw new Ui(`Array index out of bounds: ${a} < 0.`);if(a>d.length-1)throw new Ui(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a===Math.floor(a))return d[a];const f=Math.floor(a),y=Math.ceil(a),_=d[f],S=d[y];if(typeof _!="number"||typeof S!="number")throw new Ui(`Cannot interpolate between non-number values at index ${a}.`);const A=a-f;return _*(1-A)+S*A}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class qv{constructor(i,a){this.type=_n,this.needle=i,this.haystack=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,En),f=a.parse(i[2],2,En);return d&&f?Dc(d.type,[_n,yn,sr,Kh,En])?new qv(d,f):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(d.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(d==null)return!1;if(!qf(a,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(Wt(a))} instead.`);if(!qf(d,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${Zi(Wt(d))} instead.`);return d.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class pg{constructor(i,a,d){this.type=sr,this.needle=i,this.haystack=a,this.fromIndex=d}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,En),f=a.parse(i[2],2,En);if(!d||!f)return null;if(!Dc(d.type,[_n,yn,sr,Kh,En]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(d.type)} instead`);if(i.length===4){const y=a.parse(i[3],3,sr);return y?new pg(d,f,y):null}return new pg(d,f)}evaluate(i){const a=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!qf(a,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(Wt(a))} instead.`);if(!qf(d,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${Zi(Wt(d))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(i);return d.indexOf(a,f)}return d.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class mg{constructor(i,a,d,f,y,_){this.inputType=i,this.type=a,this.input=d,this.cases=f,this.outputs=y,this.otherwise=_}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let d,f;a.expectedType&&a.expectedType.kind!=="value"&&(f=a.expectedType);const y={},_=[];for(let k=2;k<i.length-1;k+=2){let j=i[k];const R=i[k+1];Array.isArray(j)||(j=[j]);const L=a.concat(k);if(j.length===0)return L.error("Expected at least one branch label.");for(const q of j){if(typeof q!="number"&&typeof q!="string")return L.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return L.error("Numeric branch labels must be integer values.");if(d){if(L.checkSubtype(d,Wt(q)))return null}else d=Wt(q);if(y[String(q)]!==void 0)return L.error("Branch labels must be unique.");y[String(q)]=_.length}const W=a.parse(R,k,f);if(!W)return null;f=f||W.type,_.push(W)}const S=a.parse(i[1],1,En);if(!S)return null;const A=a.parse(i[i.length-1],i.length-1,f);return A?S.type.kind!=="value"&&a.concat(1).checkSubtype(d,S.type)?null:new mg(d,f,S,y,_,A):null}evaluate(i){const a=this.input.evaluate(i);return(Zm(Wt(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),d=[],f={};for(const _ of a){const S=f[this.cases[_]];S===void 0?(f[this.cases[_]]=d.length,d.push([this.cases[_],[_]])):d[S][1].push(_)}const y=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,S]of d)i.push(S.length===1?y(S[0]):S.map(y)),i.push(this.outputs[_].serialize());return i.push(this.otherwise.serialize()),i}}class gg{constructor(i,a,d){this.type=i,this.branches=a,this.otherwise=d}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const f=[];for(let _=1;_<i.length-1;_+=2){const S=a.parse(i[_],_,_n);if(!S)return null;const A=a.parse(i[_+1],_+1,d);if(!A)return null;f.push([S,A]),d=d||A.type}const y=a.parse(i[i.length-1],i.length-1,d);return y?new gg(d,f,y):null}evaluate(i){for(const[a,d]of this.branches)if(a.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,d]of this.branches)i(a),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class Wu{constructor(i,a,d,f){this.type=i,this.input=a,this.beginIndex=d,this.endIndex=f}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,En),f=a.parse(i[2],2,sr);if(!d||!f)return null;if(!Dc(d.type,[Hs(En),yn,En]))return a.error(`Expected first argument to be of type array or string, but found ${Zi(d.type)} instead`);if(i.length===4){const y=a.parse(i[3],3,sr);return y?new Wu(d.type,d,f,y):null}return new Wu(d.type,d,f)}evaluate(i){const a=this.input.evaluate(i),d=this.beginIndex.evaluate(i);if(!qf(a,["string","array"]))throw new Ui(`Expected first argument to be of type array or string, but found ${Zi(Wt(a))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(i);return a.slice(d,f)}return a.slice(d)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Zv{constructor(i,a){this.type=Hs(yn),this.str=i,this.delimiter=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,yn),f=a.parse(i[2],2,yn);return d&&f?new Zv(d,f):void 0}evaluate(i){const a=this.str.evaluate(i),d=this.delimiter.evaluate(i);return a.split(d)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Kv(l,i){return l==="=="||l==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function N1(l,i,a,d){return d.compare(i,a)===0}function ld(l,i,a){const d=l!=="=="&&l!=="!=";return class lZ{constructor(y,_,S){this.type=_n,this.lhs=y,this.rhs=_,this.collator=S,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");const S=y[0];let A=_.parse(y[1],1,En);if(!A)return null;if(!Kv(S,A.type))return _.concat(1).error(`"${S}" comparisons are not supported for type '${Zi(A.type)}'.`);let k=_.parse(y[2],2,En);if(!k)return null;if(!Kv(S,k.type))return _.concat(2).error(`"${S}" comparisons are not supported for type '${Zi(k.type)}'.`);if(A.type.kind!==k.type.kind&&A.type.kind!=="value"&&k.type.kind!=="value")return _.error(`Cannot compare types '${Zi(A.type)}' and '${Zi(k.type)}'.`);d&&(A.type.kind==="value"&&k.type.kind!=="value"?A=new ur(k.type,[A]):A.type.kind!=="value"&&k.type.kind==="value"&&(k=new ur(A.type,[k])));let j=null;if(y.length===4){if(A.type.kind!=="string"&&k.type.kind!=="string"&&A.type.kind!=="value"&&k.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(j=_.parse(y[3],3,qm),!j)return null}return new lZ(A,k,j)}evaluate(y){const _=this.lhs.evaluate(y),S=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const A=Wt(_),k=Wt(S);if(A.kind!==k.kind||A.kind!=="string"&&A.kind!=="number")throw new Ui(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${A.kind}, ${k.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const A=Wt(_),k=Wt(S);if(A.kind!=="string"||k.kind!=="string")return i(y,_,S)}return this.collator?a(y,_,S,this.collator.evaluate(y)):i(y,_,S)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[l];return this.eachChild(_=>{y.push(_.serialize())}),y}}}const F1=ld("==",function(l,i,a){return i===a},N1),B1=ld("!=",function(l,i,a){return i!==a},function(l,i,a,d){return!N1(0,i,a,d)}),NP=ld("<",function(l,i,a){return i<a},function(l,i,a,d){return d.compare(i,a)<0}),FP=ld(">",function(l,i,a){return i>a},function(l,i,a,d){return d.compare(i,a)>0}),BP=ld("<=",function(l,i,a){return i<=a},function(l,i,a,d){return d.compare(i,a)<=0}),yg=ld(">=",function(l,i,a){return i>=a},function(l,i,a,d){return d.compare(i,a)>=0});class Xv{constructor(i,a,d,f,y,_){this.type=yn,this.number=i,this.locale=a,this.currency=d,this.unit=f,this.minFractionDigits=y,this.maxFractionDigits=_}static parse(i,a){if(i.length!==3)return a.error("Expected two arguments.");const d=a.parse(i[1],1,sr);if(!d)return null;const f=i[2];if(typeof f!="object"||Array.isArray(f))return a.error("NumberFormat options argument must be an object.");let y=null;if(f.locale&&(y=a.parseObjectValue(f.locale,2,"locale",yn),!y))return null;let _=null;if(f.currency&&(_=a.parseObjectValue(f.currency,2,"currency",yn),!_))return null;let S=null;if(f.unit&&(S=a.parseObjectValue(f.unit,2,"unit",yn),!S))return null;let A=null;if(f["min-fraction-digits"]&&(A=a.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",sr),!A))return null;let k=null;return f["max-fraction-digits"]&&(k=a.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",sr),!k)?null:new Xv(d,y,_,S,A,k)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Yv{constructor(i){this.type=sr,this.input=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=a.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Zi(d.type)} instead.`):new Yv(d):null}evaluate(i){const a=this.input.evaluate(i);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Ui(`Expected value to be of type string or array, but found ${Zi(Wt(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}function V1(l){return function(){l=1831565813+(l|=0)|0;let i=Math.imul(l^l>>>15,1|l);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const cd={"==":F1,"!=":B1,">":FP,"<":NP,">=":yg,"<=":BP,array:ur,at:fg,"at-interpolated":Wv,boolean:ur,case:gg,coalesce:dg,collator:yl,format:Yh,image:Jh,in:qv,"index-of":pg,interpolate:Po,"interpolate-hcl":Po,"interpolate-lab":Po,length:Yv,let:np,literal:mr,match:mg,number:ur,"number-format":Xv,object:ur,slice:Wu,step:tp,string:ur,"to-boolean":Pa,"to-color":Pa,"to-number":Pa,"to-string":Pa,var:ag,within:Bc,distance:Gu,config:sd,split:Zv};function Jv(l,[i,a,d,f]){i=i.evaluate(l),a=a.evaluate(l),d=d.evaluate(l);const y=f?f.evaluate(l):1,_=Vu(i,a,d,y);if(_)throw new Ui(_);return new Tn(i/255,a/255,d/255,y)}function U1(l,[i,a,d,f]){i=i.evaluate(l),a=a.evaluate(l),d=d.evaluate(l);const y=f?f.evaluate(l):1,_=function(k,j,R,L){return typeof k=="number"&&k>=0&&k<=360?typeof j=="number"&&j>=0&&j<=100&&typeof R=="number"&&R>=0&&R<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[k,j,R,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[k,j,R,L]:[k,j,R]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[k,j,R,L]:[k,j,R]).join(", ")}]: 'h' must be between 0 and 360.`}(i,a,d,y);if(_)throw new Ui(_);const S=`hsla(${i}, ${a}%, ${d}%, ${y})`,A=Tn.parse(S);if(!A)throw new Ui(`Failed to parse HSLA color: ${S}`);return A}function $1(l,i){return l in i}function _g(l,i){const a=i[l];return a===void 0?null:a}function Uc(l){return{type:l}}function Qv(l){return{result:"success",value:l}}function $c(l){return{result:"error",value:l}}function Gc(l,i){return!!l&&!!l.parameters&&l.parameters.indexOf(i)>-1}function vg(l){return l["property-type"]==="data-driven"}function G1(l){return Gc(l.expression,"measure-light")}function H1(l){return Gc(l.expression,"zoom")}function xg(l){return!!l.expression&&l.expression.interpolated}function bg(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function W1(l){return l}function e0(l,i){const a=i.type==="color",d=l.stops&&typeof l.stops[0][0]=="object",f=d||!(d||l.property!==void 0),y=l.type||(xg(i)?"exponential":"interval");if(a&&((l=Bu({},l)).stops&&(l.stops=l.stops.map(k=>[k[0],Tn.parse(k[1])])),l.default=Tn.parse(l.default?l.default:i.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!hg[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let _,S,A;if(y==="exponential")_=Z1;else if(y==="interval")_=q1;else if(y==="categorical"){_=t0,S=Object.create(null);for(const k of l.stops)S[k[0]]=k[1];A=typeof l.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);_=Hc}if(d){const k={},j=[];for(let W=0;W<l.stops.length;W++){const q=l.stops[W],J=q[0].zoom;k[J]===void 0&&(k[J]={zoom:J,type:l.type,property:l.property,default:l.default,stops:[]},j.push(J)),k[J].stops.push([q[0].value,q[1]])}const R=[];for(const W of j)R.push([k[W].zoom,e0(k[W],i)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Po.interpolationFactor.bind(void 0,L),zoomStops:R.map(W=>W[0]),evaluate:({zoom:W},q)=>Z1({stops:R,base:l.base},i,W).evaluate(W,q)}}if(f){const k=y==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:Po.interpolationFactor.bind(void 0,k),zoomStops:l.stops.map(j=>j[0]),evaluate:({zoom:j})=>_(l,i,j,S,A)}}return{kind:"source",evaluate(k,j){const R=j&&j.properties?j.properties[l.property]:void 0;return R===void 0?qu(l.default,i.default):_(l,i,R,S,A)}}}function qu(l,i,a){return l!==void 0?l:i!==void 0?i:a!==void 0?a:void 0}function t0(l,i,a,d,f){return qu(typeof a===f?d[a]:void 0,l.default,i.default)}function q1(l,i,a){if(Lc(a)!=="number")return qu(l.default,i.default);const d=l.stops.length;if(d===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[d-1][0])return l.stops[d-1][1];const f=cg(l.stops.map(y=>y[0]),a);return l.stops[f][1]}function Z1(l,i,a){const d=l.base!==void 0?l.base:1;if(Lc(a)!=="number")return qu(l.default,i.default);const f=l.stops.length;if(f===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[f-1][0])return l.stops[f-1][1];const y=cg(l.stops.map(j=>j[0]),a),_=function(j,R,L,W){const q=W-L,J=j-L;return q===0?0:R===1?J/q:(Math.pow(R,J)-1)/(Math.pow(R,q)-1)}(a,d,l.stops[y][0],l.stops[y+1][0]),S=l.stops[y][1],A=l.stops[y+1][1];let k=Gf[i.type]||W1;if(l.colorSpace&&l.colorSpace!=="rgb"){const j=hg[l.colorSpace];k=(R,L)=>j.reverse(j.interpolate(j.forward(R),j.forward(L),_))}return typeof S.evaluate=="function"?{evaluate(...j){const R=S.evaluate.apply(void 0,j),L=A.evaluate.apply(void 0,j);if(R!==void 0&&L!==void 0)return k(R,L,_)}}:k(S,A,_)}function Hc(l,i,a){return i.type==="color"?a=Tn.parse(a):i.type==="formatted"?a=lo.fromString(a.toString()):i.type==="resolvedImage"?a=ko.build(a.toString()):Lc(a)===i.type||i.type==="enum"&&i.values[a]||(a=void 0),qu(a,l.default,i.default)}ws.register(cd,{error:[{kind:"error"},[yn],(l,[i])=>{throw new Ui(i.evaluate(l))}],typeof:[yn,[En],(l,[i])=>Zi(Wt(i.evaluate(l)))],"to-rgba":[Hs(sr,4),[Vo],(l,[i])=>i.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Hs(sr,4),[Vo],(l,[i])=>i.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Vo,[sr,sr,sr],Jv],rgba:[Vo,[sr,sr,sr,sr],Jv],hsl:[Vo,[sr,sr,sr],U1],hsla:[Vo,[sr,sr,sr,sr],U1],has:{type:_n,overloads:[[[yn],(l,[i])=>$1(i.evaluate(l),l.properties())],[[yn,Zl],(l,[i,a])=>$1(i.evaluate(l),a.evaluate(l))]]},get:{type:En,overloads:[[[yn],(l,[i])=>_g(i.evaluate(l),l.properties())],[[yn,Zl],(l,[i,a])=>_g(i.evaluate(l),a.evaluate(l))]]},"feature-state":[En,[yn],(l,[i])=>_g(i.evaluate(l),l.featureState||{})],properties:[Zl,[],l=>l.properties()],"geometry-type":[yn,[],l=>l.geometryType()],worldview:[yn,[],l=>l.globals.worldview||""],id:[En,[],l=>l.id()],zoom:[sr,[],l=>l.globals.zoom],pitch:[sr,[],l=>l.globals.pitch||0],"distance-from-center":[sr,[],l=>l.distanceFromCenter()],"measure-light":[sr,[yn],(l,[i])=>l.measureLight(i.evaluate(l))],"heatmap-density":[sr,[],l=>l.globals.heatmapDensity||0],"line-progress":[sr,[],l=>l.globals.lineProgress||0],"raster-value":[sr,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[sr,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[sr,[],l=>l.globals.skyRadialProgress||0],accumulated:[En,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[sr,Uc(sr),(l,i)=>{let a=0;for(const d of i)a+=d.evaluate(l);return a}],"*":[sr,Uc(sr),(l,i)=>{let a=1;for(const d of i)a*=d.evaluate(l);return a}],"-":{type:sr,overloads:[[[sr,sr],(l,[i,a])=>i.evaluate(l)-a.evaluate(l)],[[sr],(l,[i])=>-i.evaluate(l)]]},"/":[sr,[sr,sr],(l,[i,a])=>i.evaluate(l)/a.evaluate(l)],"%":[sr,[sr,sr],(l,[i,a])=>i.evaluate(l)%a.evaluate(l)],ln2:[sr,[],()=>Math.LN2],pi:[sr,[],()=>Math.PI],e:[sr,[],()=>Math.E],"^":[sr,[sr,sr],(l,[i,a])=>Math.pow(i.evaluate(l),a.evaluate(l))],sqrt:[sr,[sr],(l,[i])=>Math.sqrt(i.evaluate(l))],log10:[sr,[sr],(l,[i])=>Math.log(i.evaluate(l))/Math.LN10],ln:[sr,[sr],(l,[i])=>Math.log(i.evaluate(l))],log2:[sr,[sr],(l,[i])=>Math.log(i.evaluate(l))/Math.LN2],sin:[sr,[sr],(l,[i])=>Math.sin(i.evaluate(l))],cos:[sr,[sr],(l,[i])=>Math.cos(i.evaluate(l))],tan:[sr,[sr],(l,[i])=>Math.tan(i.evaluate(l))],asin:[sr,[sr],(l,[i])=>Math.asin(i.evaluate(l))],acos:[sr,[sr],(l,[i])=>Math.acos(i.evaluate(l))],atan:[sr,[sr],(l,[i])=>Math.atan(i.evaluate(l))],min:[sr,Uc(sr),(l,i)=>Math.min(...i.map(a=>a.evaluate(l)))],max:[sr,Uc(sr),(l,i)=>Math.max(...i.map(a=>a.evaluate(l)))],abs:[sr,[sr],(l,[i])=>Math.abs(i.evaluate(l))],round:[sr,[sr],(l,[i])=>{const a=i.evaluate(l);return a<0?-Math.round(-a):Math.round(a)}],floor:[sr,[sr],(l,[i])=>Math.floor(i.evaluate(l))],ceil:[sr,[sr],(l,[i])=>Math.ceil(i.evaluate(l))],"filter-==":[_n,[yn,En],(l,[i,a])=>l.properties()[i.value]===a.value],"filter-id-==":[_n,[En],(l,[i])=>l.id()===i.value],"filter-type-==":[_n,[yn],(l,[i])=>l.geometryType()===i.value],"filter-<":[_n,[yn,En],(l,[i,a])=>{const d=l.properties()[i.value],f=a.value;return typeof d==typeof f&&d<f}],"filter-id-<":[_n,[En],(l,[i])=>{const a=l.id(),d=i.value;return typeof a==typeof d&&a<d}],"filter->":[_n,[yn,En],(l,[i,a])=>{const d=l.properties()[i.value],f=a.value;return typeof d==typeof f&&d>f}],"filter-id->":[_n,[En],(l,[i])=>{const a=l.id(),d=i.value;return typeof a==typeof d&&a>d}],"filter-<=":[_n,[yn,En],(l,[i,a])=>{const d=l.properties()[i.value],f=a.value;return typeof d==typeof f&&d<=f}],"filter-id-<=":[_n,[En],(l,[i])=>{const a=l.id(),d=i.value;return typeof a==typeof d&&a<=d}],"filter->=":[_n,[yn,En],(l,[i,a])=>{const d=l.properties()[i.value],f=a.value;return typeof d==typeof f&&d>=f}],"filter-id->=":[_n,[En],(l,[i])=>{const a=l.id(),d=i.value;return typeof a==typeof d&&a>=d}],"filter-has":[_n,[En],(l,[i])=>i.value in l.properties()],"filter-has-id":[_n,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[_n,[Hs(yn)],(l,[i])=>i.value.indexOf(l.geometryType())>=0],"filter-id-in":[_n,[Hs(En)],(l,[i])=>i.value.indexOf(l.id())>=0],"filter-in-small":[_n,[yn,Hs(En)],(l,[i,a])=>a.value.indexOf(l.properties()[i.value])>=0],"filter-in-large":[_n,[yn,Hs(En)],(l,[i,a])=>function(d,f,y,_){for(;y<=_;){const S=y+_>>1;if(f[S]===d)return!0;f[S]>d?_=S-1:y=S+1}return!1}(l.properties()[i.value],a.value,0,a.value.length-1)],all:{type:_n,overloads:[[[_n,_n],(l,[i,a])=>i.evaluate(l)&&a.evaluate(l)],[Uc(_n),(l,i)=>{for(const a of i)if(!a.evaluate(l))return!1;return!0}]]},any:{type:_n,overloads:[[[_n,_n],(l,[i,a])=>i.evaluate(l)||a.evaluate(l)],[Uc(_n),(l,i)=>{for(const a of i)if(a.evaluate(l))return!0;return!1}]]},"!":[_n,[_n],(l,[i])=>!i.evaluate(l)],"is-supported-script":[_n,[yn],(l,[i])=>{const a=l.globals&&l.globals.isSupportedScript;return!a||a(i.evaluate(l))}],upcase:[yn,[yn],(l,[i])=>i.evaluate(l).toUpperCase()],downcase:[yn,[yn],(l,[i])=>i.evaluate(l).toLowerCase()],concat:[yn,Uc(En),(l,i)=>i.map(a=>ka(a.evaluate(l))).join("")],"resolved-locale":[yn,[qm],(l,[i])=>i.evaluate(l).resolvedLocale()],random:[sr,[sr,sr,En],(l,i)=>{const[a,d,f]=i.map(_=>_.evaluate(l));if(a>d||a===d)return a;let y;if(typeof f=="string")y=function(_){let S=0;if(_.length===0)return S;for(let A=0;A<_.length;A++)S=(S<<5)-S+_.charCodeAt(A),S|=0;return S}(f);else{if(typeof f!="number")throw new Ui(`Invalid seed input: ${f}`);y=f}return a+V1(y)()*(d-a)}]});class r0{constructor(i,a,d,f){this.expression=i,this._warningHistory={},this._evaluator=new Xf(d,f),this._defaultValue=a?function(y){return y.type==="color"&&(bg(y.default)||Array.isArray(y.default))?new Tn(0,0,0,0):y.type==="color"?Tn.parse(y.default)||null:y.default===void 0?null:y.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=og(i)}evaluateWithoutErrorHandling(i,a,d,f,y,_,S,A){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=d,this._evaluator.canonical=f||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,d,f,y,_,S,A){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=d||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new Ui(`Expected value to be one of ${Object.keys(this._enumValues).map(j=>JSON.stringify(j)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${k.message}`)),this._defaultValue}}}function n0(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in cd}function Zu(l,i,a,d){const f=new lg(cd,[],i?function(_){const S={color:Vo,string:yn,number:sr,enum:yn,boolean:_n,formatted:Hf,resolvedImage:Wf};return _.type==="array"?Hs(S[_.value]||En,_.length):S[_.type]}(i):void 0,void 0,void 0,a,d),y=f.parse(l,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?Qv(new r0(y,i,a,d)):$c(f.errors)}class wg{constructor(i,a,d,f){this.kind=i,this._styleExpression=a,this.isLightConstant=d,this.isLineProgressConstant=f,this.isStateDependent=i!=="constant"&&!sg(a.expression),this.configDependencies=og(a.expression)}evaluateWithoutErrorHandling(i,a,d,f,y,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,d,f,y,_)}evaluate(i,a,d,f,y,_){return this._styleExpression.evaluate(i,a,d,f,y,_)}}class Wc{constructor(i,a,d,f,y,_){this.kind=i,this.zoomStops=d,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!sg(a.expression),this.isLightConstant=y,this.isLineProgressConstant=_,this.configDependencies=og(a.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,a,d,f,y,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,d,f,y,_)}evaluate(i,a,d,f,y,_){return this._styleExpression.evaluate(i,a,d,f,y,_)}interpolationFactor(i,a,d){return this.interpolationType?Po.interpolationFactor(this.interpolationType,i,a,d):0}}function i0(l,i,a,d){if((l=Zu(l,i,a,d)).result==="error")return l;const f=l.value.expression,y=nd(f);if(!y&&!vg(i))return $c([new ia("","data expressions not supported")]);const _=id(f,["zoom","pitch","distance-from-center"]);if(!_&&!H1(i))return $c([new ia("","zoom expressions not supported")]);const S=id(f,["measure-light"]);if(!S&&!G1(i))return $c([new ia("","measure-light expression not supported")]);const A=id(f,["line-progress"]);if(!A&&!function(R){return Gc(R.expression,"line-progress")}(i))return $c([new ia("","line-progress expression not supported")]);const k=i.expression&&i.expression.relaxZoomRestriction,j=ip(f);return j||_||k?j instanceof ia?$c([j]):j instanceof Po&&!xg(i)?$c([new ia("",'"interpolate" expressions cannot be used with this property')]):Qv(j?new Wc(y&&A?"camera":"composite",l.value,j.labels,j instanceof Po?j.interpolation:void 0,S,A):new wg(y&&A?"constant":"source",l.value,S,A)):$c([new ia("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ku{constructor(i,a){this._parameters=i,this._specification=a,Bu(this,e0(this._parameters,this._specification))}static deserialize(i){return new Ku(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ip(l){let i=null;if(l instanceof np)i=ip(l.result);else if(l instanceof dg){for(const a of l.args)if(i=ip(a),i)break}else(l instanceof tp||l instanceof Po)&&l.input instanceof ws&&l.input.name==="zoom"&&(i=l);return i instanceof ia||l.eachChild(a=>{const d=ip(a);d instanceof ia?i=d:i&&d&&i!==d&&(i=new ia("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var s0,K1,o0=function(){if(K1)return s0;K1=1,s0=i;var l=3;function i(a,d,f){var y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(d=_[1])+2*(f=_[2]);for(var S=0;S<this.d*this.d;S++){var A=_[l+S],k=_[l+S+1];y.push(A===k?null:_.subarray(A,k))}var j=_[l+y.length+1];this.keys=_.subarray(_[l+y.length],j),this.bboxes=_.subarray(j),this.insert=this._insertReadonly}else{this.d=d+2*f;for(var R=0;R<this.d*this.d;R++)y.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=a,this.padding=f,this.scale=d/a,this.uid=0;var L=f/d*a;this.min=-L,this.max=a+L}return i.prototype.insert=function(a,d,f,y,_){this._forEachCell(d,f,y,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(d),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(_)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(a,d,f,y,_,S){this.cells[_].push(S)},i.prototype.query=function(a,d,f,y,_){var S=this.min,A=this.max;if(a<=S&&d<=S&&A<=f&&A<=y&&!_)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(a,d,f,y,this._queryCell,k,{},_),k},i.prototype._queryCell=function(a,d,f,y,_,S,A,k){var j=this.cells[_];if(j!==null)for(var R=this.keys,L=this.bboxes,W=0;W<j.length;W++){var q=j[W];if(A[q]===void 0){var J=4*q;(k?k(L[J+0],L[J+1],L[J+2],L[J+3]):a<=L[J+2]&&d<=L[J+3]&&f>=L[J+0]&&y>=L[J+1])?(A[q]=!0,S.push(R[q])):A[q]=!1}}},i.prototype._forEachCell=function(a,d,f,y,_,S,A,k){for(var j=this._convertToCellCoord(a),R=this._convertToCellCoord(d),L=this._convertToCellCoord(f),W=this._convertToCellCoord(y),q=j;q<=L;q++)for(var J=R;J<=W;J++){var Q=this.d*J+q;if((!k||k(this._convertFromCellCoord(q),this._convertFromCellCoord(J),this._convertFromCellCoord(q+1),this._convertFromCellCoord(J+1)))&&_.call(this,a,d,f,y,Q,S,A,k))return}},i.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},i.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,d=l+this.cells.length+1+1,f=0,y=0;y<this.cells.length;y++)f+=this.cells[y].length;var _=new Int32Array(d+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var S=d,A=0;A<a.length;A++){var k=a[A];_[l+A]=S,_.set(k,S),S+=k.length}return _[l+a.length]=S,_.set(this.keys,S),_[l+a.length+1]=S+=this.keys.length,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer},s0}(),qc=Gl(o0);const sp={};function qt(l,i,a={}){Object.defineProperty(l,"_classRegistryKey",{value:i,writable:!1}),sp[i]={klass:l,omit:a.omit||[]}}qt(Object,"Object"),qc.serialize=function(l,i){const a=l.toArrayBuffer();return i&&i.add(a),{buffer:a}},qc.deserialize=function(l){return new qc(l.buffer)},Object.defineProperty(qc,"name",{value:"Grid"}),qt(qc,"Grid"),delete ut.prototype.constructor,typeof DOMMatrix<"u"&&qt(DOMMatrix,"DOMMatrix"),qt(Tn,"Color"),qt(Error,"Error"),qt(lo,"Formatted"),qt(Km,"FormattedSection"),qt(sn,"AJAXError"),qt(ko,"ResolvedImage"),qt(Ku,"StylePropertyFunction"),qt(r0,"StyleExpression",{omit:["_evaluator"]}),qt(Bo,"ImageId"),qt(Kl,"ImageVariant"),qt(Wc,"ZoomDependentExpression"),qt(wg,"ZoomConstantExpression"),qt(ws,"CompoundExpression",{omit:["_evaluate"]});for(const l in cd)sp[cd[l]._classRegistryKey]||qt(cd[l],`Expression${l}`);function Sg(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function op(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Xl(l,i){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Sg(l)||op(l))return i&&i.add(l),l;if(ArrayBuffer.isView(l))return i&&i.add(l.buffer),l;if(l instanceof ImageData)return i&&i.add(l.data.buffer),l;if(Array.isArray(l)){const a=[];for(const d of l)a.push(Xl(d,i));return a}if(l instanceof Map){const a={$name:"Map",entries:[]};for(const[d,f]of l.entries())a.entries.push(Xl(d),Xl(f,i));return a}if(l instanceof Set){const a={$name:"Set"};let d=0;for(const f of l.values())a[++d]=Xl(f);return a}if(l instanceof DOMMatrix){const a={$name:"DOMMatrix"},d=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const f of d)a[f]=l[f];return a}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const a=l.constructor,d=a._classRegistryKey;if(!d)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const f=a.serialize?a.serialize(l,i):{};if(!a.serialize){for(const y in l)l.hasOwnProperty(y)&&(sp[d].omit.indexOf(y)>=0||(f[y]=Xl(l[y],i)));l instanceof Error&&(f.message=l.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(f.$name=d),f}throw new Error("can't serialize object of type "+typeof l)}function Co(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Sg(l)||op(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Co);if(typeof l=="object"){const i=l.$name||"Object";if(i==="Map"){const f=l.entries||[],y=new Map;for(let _=0;_<f.length;_+=2)y.set(Co(f[_]),Co(f[_+1]));return y}if(i==="Set"){const f=new Set;for(const y of Object.keys(l))y!=="$name"&&f.add(Co(l[y]));return f}if(i==="DOMMatrix"){let f;return f=l.is2D?[l.a,l.b,l.c,l.d,l.e,l.f]:[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44],new DOMMatrix(f)}if(i==="BigInt")return BigInt(l.value);const{klass:a}=sp[i];if(!a)throw new Error(`Can't deserialize unregistered class "${i}".`);if(a.deserialize)return a.deserialize(l);const d=Object.create(a.prototype);for(const f of Object.keys(l))f!=="$name"&&(d[f]=Co(l[f]));return d}throw new Error("can't deserialize object of type "+typeof l)}const hr={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function a0(l){for(const i of l)if(Tg(i.charCodeAt(0)))return!0;return!1}function VP(l){for(const i of l)if(!UP(i.charCodeAt(0)))return!1;return!0}function UP(l){return!(hr.Arabic(l)||hr["Arabic Supplement"](l)||hr["Arabic Extended-A"](l)||hr["Arabic Presentation Forms-A"](l)||hr["Arabic Presentation Forms-B"](l))}function Tg(l){return!(l!==746&&l!==747&&(l<4352||!(hr["Bopomofo Extended"](l)||hr.Bopomofo(l)||hr["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||hr["CJK Compatibility Ideographs"](l)||hr["CJK Compatibility"](l)||hr["CJK Radicals Supplement"](l)||hr["CJK Strokes"](l)||!(!hr["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||hr["CJK Unified Ideographs Extension A"](l)||hr["CJK Unified Ideographs"](l)||hr["Enclosed CJK Letters and Months"](l)||hr["Hangul Compatibility Jamo"](l)||hr["Hangul Jamo Extended-A"](l)||hr["Hangul Jamo Extended-B"](l)||hr["Hangul Jamo"](l)||hr["Hangul Syllables"](l)||hr.Hiragana(l)||hr["Ideographic Description Characters"](l)||hr.Kanbun(l)||hr["Kangxi Radicals"](l)||hr["Katakana Phonetic Extensions"](l)||hr.Katakana(l)&&l!==12540||!(!hr["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!hr["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||hr["Unified Canadian Aboriginal Syllabics"](l)||hr["Unified Canadian Aboriginal Syllabics Extended"](l)||hr["Vertical Forms"](l)||hr["Yijing Hexagram Symbols"](l)||hr["Yi Syllables"](l)||hr["Yi Radicals"](l))))}function Eg(l){return!(Tg(l)||function(i){return!!(hr["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||hr["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||hr["Letterlike Symbols"](i)||hr["Number Forms"](i)||hr["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||hr["Control Pictures"](i)&&i!==9251||hr["Optical Character Recognition"](i)||hr["Enclosed Alphanumerics"](i)||hr["Geometric Shapes"](i)||hr["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||hr["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||hr["CJK Symbols and Punctuation"](i)||hr.Katakana(i)||hr["Private Use Area"](i)||hr["CJK Compatibility Forms"](i)||hr["Small Form Variants"](i)||hr["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(l))}function X1(l){return hr.Arabic(l)||hr["Arabic Supplement"](l)||hr["Arabic Extended-A"](l)||hr["Arabic Presentation Forms-A"](l)||hr["Arabic Presentation Forms-B"](l)}function Ag(l){return l>=1424&&l<=2303||hr["Arabic Presentation Forms-A"](l)||hr["Arabic Presentation Forms-B"](l)}function $P(l,i){return!(!i&&Ag(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||hr.Khmer(l))}function GP(l){for(const i of l)if(Ag(i.charCodeAt(0)))return!0;return!1}const Uo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let l0=null,uo=Uo.unavailable,Zc=null;const Y1=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(uo=Uo.error),l0&&l0(l)};function c0(){u0.fire(new ql("pluginStateChange",{pluginStatus:uo,pluginURL:Zc}))}const u0=new Fu,h0=function(){return uo},J1=function(){if(uo!==Uo.deferred||!Zc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");uo=Uo.loading,c0(),Zc&&Ff({url:Zc},l=>{l?Y1(l):(uo=Uo.loaded,c0())})},_l={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>uo===Uo.loaded||_l.applyArabicShaping!=null,isLoading:()=>uo===Uo.loading,setState(l){uo=l.pluginStatus,Zc=l.pluginURL},isParsing:()=>uo===Uo.parsing,isParsed:()=>uo===Uo.parsed,getPluginURL:()=>Zc};class On{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(a,d){for(const f of a)if(!$P(f.charCodeAt(0),d))return!1;return!0}(i,_l.isLoaded())}}class ap{constructor(i,a,d,f){this.property=i,this.value=a,this.expression=function(y,_,S,A){if(bg(y))return new Ku(y,_);if(n0(y)||Array.isArray(y)&&y.length>0){const k=i0(y,_,S,A);if(k.result==="error")throw new Error(k.value.map(j=>`${j.key}: ${j.message}`).join(", "));return k.value}{let k=y;return typeof y=="string"&&_.type==="color"&&(k=Tn.parse(y)),{kind:"constant",configDependencies:new Set,evaluate:()=>k}}}(a===void 0?i.specification.default:a,i.specification,d,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,a,d){return this.property.possiblyEvaluate(this,i,a,d)}}class kg{constructor(i,a,d){this.property=i,this.value=new ap(i,void 0,a,d)}transitioned(i,a){return new Q1(this.property,this.value,a,Qe({},i.transition,this.transition),i.now)}untransitioned(){return new Q1(this.property,this.value,null,{},0)}}class lp{constructor(i,a,d){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(i){return zr(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new kg(this._values[i].property,this._scope,this._options)),this._values[i].value=new ap(this._values[i].property,a===null?void 0:zr(a),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,a){a&&(this._options=a);const d=this._properties.properties;if(i)for(const f in i){const y=i[f];if(f.endsWith("-transition")){const _=f.slice(0,-11);d[_]&&this.setTransition(_,y)}else d.hasOwnProperty(f)&&this.setValue(f,y)}}getTransition(i){return zr(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new kg(this._values[i].property)),this._values[i].transition=zr(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(i[a]=d);const f=this.getTransition(a);f!==void 0&&(i[`${a}-transition`]=f)}return i}transitioned(i,a){const d=new eS(this._properties);for(const f of Object.keys(this._values))d._values[f]=this._values[f].transitioned(i,a._values[f]);return d}untransitioned(){const i=new eS(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class Q1{constructor(i,a,d,f,y){const _=f.delay||0,S=f.duration||0;y=y||0,this.property=i,this.value=a,this.begin=y+_,this.end=this.begin+S,i.specification.transition&&(f.delay||f.duration)&&(this.prior=d)}possiblyEvaluate(i,a,d){const f=i.now||0,y=this.value.possiblyEvaluate(i,a,d),_=this.prior;if(_){if(f>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(f<this.begin)return _.possiblyEvaluate(i,a,d);{const S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(i,a,d),y,ce(S))}}return y}}class eS{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,d){const f=new rl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(i,a,d);return f}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Kc{constructor(i,a,d){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(i){return zr(this._values[i].value)}setValue(i,a){this._values[i]=new ap(this._values[i].property,a===null?void 0:zr(a),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(i[a]=d)}return i}possiblyEvaluate(i,a,d){const f=new rl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(i,a,d);return f}}class Xu{constructor(i,a,d){this.property=i,this.value=a,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,a,d,f){return this.property.evaluate(this.value,this.parameters,i,a,d,f)}}class rl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Mt{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,d){const f=Gf[this.specification.type];return f?f(i,a,d):i}}class $t{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,d,f){return new Xu(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(a,null,{},d,f)}:i.expression,a)}interpolate(i,a,d){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new Xu(this,{kind:"constant",value:void 0},i.parameters);const f=Gf[this.specification.type];return f?new Xu(this,{kind:"constant",value:f(i.value.value,a.value.value,d)},i.parameters):i}evaluate(i,a,d,f,y,_){return i.kind==="constant"?i.value:i.evaluate(a,d,f,y,_)}}class ud{constructor(i){this.specification=i}possiblyEvaluate(i,a,d,f){return!!i.expression.evaluate(a,null,{},d,f)}interpolate(){return!1}}class wi{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new On(0,{});for(const d in i){const f=i[d];f.specification.overridable&&this.overridableProperties.push(d);const y=this.defaultPropertyValues[d]=new ap(f,void 0),_=this.defaultTransitionablePropertyValues[d]=new kg(f);this.defaultTransitioningPropertyValues[d]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=y.possiblyEvaluate(a)}}}qt($t,"DataDrivenProperty"),qt(Mt,"DataConstantProperty"),qt(ud,"ColorRampProperty");var $e=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function tS(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function cp(l){if(Array.isArray(l))return l.map(cp);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const i={};for(const a in l)i[a]=cp(l[a]);return i}return tS(l)}function up(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const i of l.slice(1))if(!up(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function hd(l,i="",a=null,d="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};up(l)||(l=Cg(l));const f=l;let y=!0;try{y=function(j){if(!dd(j))return j;let R=cp(j);return Pg(R),R=d0(R),R}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let _=null,S=null;if(d!=="background"&&d!=="sky"&&d!=="slot"){S=$e[`filter_${d}`];const j=Zu(y,S,i,a);if(j.result==="error")throw new Error(j.value.map(R=>`${R.key}: ${R.message}`).join(", "));_=(R,L,W)=>j.value.evaluate(R,L,{},W)}let A=null,k=null;if(y!==f){const j=Zu(f,S,i,a);if(j.result==="error")throw new Error(j.value.map(R=>`${R.key}: ${R.message}`).join(", "));A=(R,L,W,q,J)=>j.value.evaluate(R,L,{},W,void 0,void 0,q,J),k=!nd(j.value.expression)}return{filter:_,dynamicFilter:A||void 0,needGeometry:f0(y),needFeature:!!k}}function d0(l){if(!Array.isArray(l))return l;const i=function(a){if(vl.has(a[0])){for(let d=1;d<a.length;d++)if(dd(a[d]))return!0}return a}(l);return i===!0?i:i.map(a=>d0(a))}function Pg(l){let i=!1;const a=[];if(l[0]==="case"){for(let d=1;d<l.length-1;d+=2)i=i||dd(l[d]),a.push(l[d+1]);a.push(l[l.length-1])}else if(l[0]==="match"){i=i||dd(l[1]);for(let d=2;d<l.length-1;d+=2)a.push(l[d+1]);a.push(l[l.length-1])}else if(l[0]==="step"){i=i||dd(l[1]);for(let d=1;d<l.length-1;d+=2)a.push(l[d+1])}i&&(l.length=0,l.push("any",...a));for(let d=1;d<l.length;d++)Pg(l[d])}function dd(l){if(!Array.isArray(l))return!1;if((i=l[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let a=1;a<l.length;a++)if(dd(l[a]))return!0;return!1}const vl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function HP(l,i){return l<i?-1:l>i?1:0}function f0(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let i=1;i<l.length;i++)if(f0(l[i]))return!0;return!1}function Cg(l){if(!l)return!0;const i=l[0];return l.length<=1?i!=="any":i==="=="?p0(l[1],l[2],"=="):i==="!="?Ig(p0(l[1],l[2],"==")):i==="<"||i===">"||i==="<="||i===">="?p0(l[1],l[2],i):i==="any"?(a=l.slice(1),["any"].concat(a.map(Cg))):i==="all"?["all"].concat(l.slice(1).map(Cg)):i==="none"?["all"].concat(l.slice(1).map(Cg).map(Ig)):i==="in"?rS(l[1],l.slice(2)):i==="!in"?Ig(rS(l[1],l.slice(2))):i==="has"?nS(l[1]):i!=="!has"||Ig(nS(l[1]));var a}function p0(l,i,a){switch(l){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,l,i]}}function rS(l,i){if(i.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",l,["literal",i.sort(HP)]]:["filter-in-small",l,["literal",i]]}}function nS(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Ig(l){return["!",l]}const hp="";function fd(l,i){return i?`${l}${hp}${i}`:l}const iS="-transition",WP=new Set(["fill","line","background","hillshade","raster"]);class qs extends Fu{constructor(i,a,d,f,y){if(super(),this.id=i.id,this.fqid=fd(this.id,d),this.type=i.type,this.scope=d,this.lut=f,this.options=y,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const _=Zu(this.filter,$e[`filter_${i.type}`]);_.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,..._.value.configDependencies]))}if(i.slot&&(this.slot=i.slot),a.layout&&(this._unevaluatedLayout=new Kc(a.layout,this.scope,y),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new lp(a.paint,this.scope,y);for(const _ in i.paint)this.setPaintProperty(_,i.paint[_]);for(const _ in i.layout)this.setLayoutProperty(_,i.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rl(a.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&WP.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a){if(this.type==="custom"&&i==="visibility")return void(this.visibility=a);const d=this._unevaluatedLayout;d._properties.properties[i]&&(d.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),i==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(iS)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a){const d=this._transitionablePaint,f=d._properties.properties;if(i.endsWith(iS)){const R=i.slice(0,-11);return f[R]&&d.setTransition(R,a||void 0),!1}if(!f[i])return!1;const y=d._values[i],_=y.value.isDataDriven(),S=y.value;d.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const A=d._values[i].value,k=A.isDataDriven(),j=i.endsWith("pattern")||i==="line-dasharray";return k||_||j||this._handleOverridablePaintPropertyUpdate(i,S,A)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,a,d){return null}_handleOverridablePaintPropertyUpdate(i,a,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){return Gr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof Xu&&vg(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=hd(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,a,d,f,y,_,S,A,k){}}const qP={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dp{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ei{constructor(){this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&a.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yr(l,i=1){let a=0,d=0;return{members:l.map(f=>{const y=qP[f.type].BYTES_PER_ELEMENT,_=a=m0(a,Math.max(i,y)),S=f.components||1;return d=Math.max(d,y),a+=y*S,{name:f.name,type:f.type,components:S,offset:_}}),size:m0(a,Math.max(d,i)),alignment:i}}function m0(l,i){return Math.ceil(l/i)*i}class Io extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const d=this.length;return this.resize(d+1),this.emplace(d,i,a)}emplace(i,a,d){const f=2*i;return this.int16[f+0]=a,this.int16[f+1]=d,i}}Io.prototype.bytesPerElement=4,qt(Io,"StructArrayLayout2i4");class pd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,a,d)}emplace(i,a,d,f){const y=3*i;return this.int16[y+0]=a,this.int16[y+1]=d,this.int16[y+2]=f,i}}pd.prototype.bytesPerElement=6,qt(pd,"StructArrayLayout3i6");class md extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,f)}emplace(i,a,d,f,y){const _=4*i;return this.int16[_+0]=a,this.int16[_+1]=d,this.int16[_+2]=f,this.int16[_+3]=y,i}}md.prototype.bytesPerElement=8,qt(md,"StructArrayLayout4i8");class Yu extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}Yu.prototype.bytesPerElement=4,qt(Yu,"StructArrayLayout1f4");class g0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,a,d)}emplace(i,a,d,f){const y=4*i,_=2*i;return this.int16[y+0]=a,this.int16[y+1]=d,this.float32[_+1]=f,i}}g0.prototype.bytesPerElement=8,qt(g0,"StructArrayLayout2i1f8");class y0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,a,d)}emplace(i,a,d,f){const y=4*i;return this.int16[y+0]=a,this.int16[y+1]=d,this.int16[y+2]=f,i}}y0.prototype.bytesPerElement=8,qt(y0,"StructArrayLayout3i8");class Mg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,f,y)}emplace(i,a,d,f,y,_){const S=5*i;return this.int16[S+0]=a,this.int16[S+1]=d,this.int16[S+2]=f,this.int16[S+3]=y,this.int16[S+4]=_,i}}Mg.prototype.bytesPerElement=10,qt(Mg,"StructArrayLayout5i10");class Og extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,d,f,y,_,S)}emplace(i,a,d,f,y,_,S,A){const k=6*i,j=12*i,R=3*i;return this.int16[k+0]=a,this.int16[k+1]=d,this.uint8[j+4]=f,this.uint8[j+5]=y,this.uint8[j+6]=_,this.uint8[j+7]=S,this.float32[R+2]=A,i}}Og.prototype.bytesPerElement=12,qt(Og,"StructArrayLayout2i4ub1f12");class oa extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,a,d)}emplace(i,a,d,f){const y=3*i;return this.float32[y+0]=a,this.float32[y+1]=d,this.float32[y+2]=f,i}}oa.prototype.bytesPerElement=12,qt(oa,"StructArrayLayout3f12");class Xc extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,f,y)}emplace(i,a,d,f,y,_){const S=6*i,A=3*i;return this.uint16[S+0]=a,this.uint16[S+1]=d,this.uint16[S+2]=f,this.uint16[S+3]=y,this.float32[A+2]=_,i}}Xc.prototype.bytesPerElement=12,qt(Xc,"StructArrayLayout4ui1f12");class gd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,f)}emplace(i,a,d,f,y){const _=4*i;return this.uint16[_+0]=a,this.uint16[_+1]=d,this.uint16[_+2]=f,this.uint16[_+3]=y,i}}gd.prototype.bytesPerElement=8,qt(gd,"StructArrayLayout4ui8");class jg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,d,f,y,_)}emplace(i,a,d,f,y,_,S){const A=6*i;return this.int16[A+0]=a,this.int16[A+1]=d,this.int16[A+2]=f,this.int16[A+3]=y,this.int16[A+4]=_,this.int16[A+5]=S,i}}jg.prototype.bytesPerElement=12,qt(jg,"StructArrayLayout6i12");class Rg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S,A,k,j,R,L){const W=this.length;return this.resize(W+1),this.emplace(W,i,a,d,f,y,_,S,A,k,j,R,L)}emplace(i,a,d,f,y,_,S,A,k,j,R,L,W){const q=12*i;return this.int16[q+0]=a,this.int16[q+1]=d,this.int16[q+2]=f,this.int16[q+3]=y,this.uint16[q+4]=_,this.uint16[q+5]=S,this.uint16[q+6]=A,this.uint16[q+7]=k,this.int16[q+8]=j,this.int16[q+9]=R,this.int16[q+10]=L,this.int16[q+11]=W,i}}Rg.prototype.bytesPerElement=24,qt(Rg,"StructArrayLayout4i4ui4i24");class yd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,d,f,y,_)}emplace(i,a,d,f,y,_,S){const A=10*i,k=5*i;return this.int16[A+0]=a,this.int16[A+1]=d,this.int16[A+2]=f,this.float32[k+2]=y,this.float32[k+3]=_,this.float32[k+4]=S,i}}yd.prototype.bytesPerElement=20,qt(yd,"StructArrayLayout3i3f20");class Yc extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,f)}emplace(i,a,d,f,y){const _=4*i;return this.float32[_+0]=a,this.float32[_+1]=d,this.float32[_+2]=f,this.float32[_+3]=y,i}}Yc.prototype.bytesPerElement=16,qt(Yc,"StructArrayLayout4f16");class _0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}_0.prototype.bytesPerElement=4,qt(_0,"StructArrayLayout1ul4");class xl extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const d=this.length;return this.resize(d+1),this.emplace(d,i,a)}emplace(i,a,d){const f=2*i;return this.uint16[f+0]=a,this.uint16[f+1]=d,i}}xl.prototype.bytesPerElement=4,qt(xl,"StructArrayLayout2ui4");class v0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S,A,k,j,R,L,W){const q=this.length;return this.resize(q+1),this.emplace(q,i,a,d,f,y,_,S,A,k,j,R,L,W)}emplace(i,a,d,f,y,_,S,A,k,j,R,L,W,q){const J=20*i,Q=10*i;return this.int16[J+0]=a,this.int16[J+1]=d,this.int16[J+2]=f,this.int16[J+3]=y,this.int16[J+4]=_,this.float32[Q+3]=S,this.float32[Q+4]=A,this.float32[Q+5]=k,this.float32[Q+6]=j,this.int16[J+14]=R,this.uint32[Q+8]=L,this.uint16[J+18]=W,this.uint16[J+19]=q,i}}v0.prototype.bytesPerElement=40,qt(v0,"StructArrayLayout5i4f1i1ul2ui40");class Dg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,d,f,y,_,S)}emplace(i,a,d,f,y,_,S,A){const k=8*i;return this.int16[k+0]=a,this.int16[k+1]=d,this.int16[k+2]=f,this.int16[k+4]=y,this.int16[k+5]=_,this.int16[k+6]=S,this.int16[k+7]=A,i}}Dg.prototype.bytesPerElement=16,qt(Dg,"StructArrayLayout3i2i2i16");class _d extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,f,y)}emplace(i,a,d,f,y,_){const S=4*i,A=8*i;return this.float32[S+0]=a,this.float32[S+1]=d,this.float32[S+2]=f,this.int16[A+6]=y,this.int16[A+7]=_,i}}_d.prototype.bytesPerElement=16,qt(_d,"StructArrayLayout2f1f2i16");class vd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,d,f,y,_)}emplace(i,a,d,f,y,_,S){const A=20*i,k=5*i;return this.uint8[A+0]=a,this.uint8[A+1]=d,this.float32[k+1]=f,this.float32[k+2]=y,this.float32[k+3]=_,this.float32[k+4]=S,i}}vd.prototype.bytesPerElement=20,qt(vd,"StructArrayLayout2ub4f20");class ii extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,a,d)}emplace(i,a,d,f){const y=3*i;return this.uint16[y+0]=a,this.uint16[y+1]=d,this.uint16[y+2]=f,i}}ii.prototype.bytesPerElement=6,qt(ii,"StructArrayLayout3ui6");class xd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q,oe,de,he,fe,Ie){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q,oe,de,he,fe,Ie)}emplace(i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q,oe,de,he,fe,Ie,Ae){const ke=30*i,Le=15*i,Be=60*i;return this.int16[ke+0]=a,this.int16[ke+1]=d,this.int16[ke+2]=f,this.float32[Le+2]=y,this.float32[Le+3]=_,this.uint16[ke+8]=S,this.uint16[ke+9]=A,this.uint32[Le+5]=k,this.uint32[Le+6]=j,this.uint32[Le+7]=R,this.uint16[ke+16]=L,this.uint16[ke+17]=W,this.uint16[ke+18]=q,this.float32[Le+10]=J,this.float32[Le+11]=Q,this.uint8[Be+48]=oe,this.uint8[Be+49]=de,this.uint8[Be+50]=he,this.uint32[Le+13]=fe,this.int16[ke+28]=Ie,this.uint8[Be+58]=Ae,i}}xd.prototype.bytesPerElement=60,qt(xd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class x0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q,oe,de,he,fe,Ie,Ae,ke,Le,Be,at,Ge,ft,wt,xt,At,kt,it){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q,oe,de,he,fe,Ie,Ae,ke,Le,Be,at,Ge,ft,wt,xt,At,kt,it)}emplace(i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q,oe,de,he,fe,Ie,Ae,ke,Le,Be,at,Ge,ft,wt,xt,At,kt,it,Tt){const Xe=20*i,ot=40*i,It=80*i;return this.float32[Xe+0]=a,this.float32[Xe+1]=d,this.int16[ot+4]=f,this.int16[ot+5]=y,this.int16[ot+6]=_,this.int16[ot+7]=S,this.int16[ot+8]=A,this.int16[ot+9]=k,this.int16[ot+10]=j,this.int16[ot+11]=R,this.int16[ot+12]=L,this.uint16[ot+13]=W,this.uint16[ot+14]=q,this.uint16[ot+15]=J,this.uint16[ot+16]=Q,this.uint16[ot+17]=oe,this.uint16[ot+18]=de,this.uint16[ot+19]=he,this.uint16[ot+20]=fe,this.uint16[ot+21]=Ie,this.uint16[ot+22]=Ae,this.uint16[ot+23]=ke,this.uint16[ot+24]=Le,this.uint16[ot+25]=Be,this.uint16[ot+26]=at,this.uint16[ot+27]=Ge,this.uint32[Xe+14]=ft,this.float32[Xe+15]=wt,this.float32[Xe+16]=xt,this.float32[Xe+17]=At,this.float32[Xe+18]=kt,this.uint8[It+76]=it,this.uint16[ot+39]=Tt,i}}x0.prototype.bytesPerElement=80,qt(x0,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class b0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,d,f,y,_)}emplace(i,a,d,f,y,_,S){const A=6*i;return this.float32[A+0]=a,this.float32[A+1]=d,this.float32[A+2]=f,this.float32[A+3]=y,this.float32[A+4]=_,this.float32[A+5]=S,i}}b0.prototype.bytesPerElement=24,qt(b0,"StructArrayLayout6f24");class Ju extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,f,y)}emplace(i,a,d,f,y,_){const S=5*i;return this.float32[S+0]=a,this.float32[S+1]=d,this.float32[S+2]=f,this.float32[S+3]=y,this.float32[S+4]=_,i}}Ju.prototype.bytesPerElement=20,qt(Ju,"StructArrayLayout5f20");class w0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,d,f,y,_,S)}emplace(i,a,d,f,y,_,S,A){const k=7*i;return this.float32[k+0]=a,this.float32[k+1]=d,this.float32[k+2]=f,this.float32[k+3]=y,this.float32[k+4]=_,this.float32[k+5]=S,this.float32[k+6]=A,i}}w0.prototype.bytesPerElement=28,qt(w0,"StructArrayLayout7f28");class fp extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S,A,k,j,R){const L=this.length;return this.resize(L+1),this.emplace(L,i,a,d,f,y,_,S,A,k,j,R)}emplace(i,a,d,f,y,_,S,A,k,j,R,L){const W=11*i;return this.float32[W+0]=a,this.float32[W+1]=d,this.float32[W+2]=f,this.float32[W+3]=y,this.float32[W+4]=_,this.float32[W+5]=S,this.float32[W+6]=A,this.float32[W+7]=k,this.float32[W+8]=j,this.float32[W+9]=R,this.float32[W+10]=L,i}}fp.prototype.bytesPerElement=44,qt(fp,"StructArrayLayout11f44");class S0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S,A,k){const j=this.length;return this.resize(j+1),this.emplace(j,i,a,d,f,y,_,S,A,k)}emplace(i,a,d,f,y,_,S,A,k,j){const R=9*i;return this.float32[R+0]=a,this.float32[R+1]=d,this.float32[R+2]=f,this.float32[R+3]=y,this.float32[R+4]=_,this.float32[R+5]=S,this.float32[R+6]=A,this.float32[R+7]=k,this.float32[R+8]=j,i}}S0.prototype.bytesPerElement=36,qt(S0,"StructArrayLayout9f36");class Jc extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const d=this.length;return this.resize(d+1),this.emplace(d,i,a)}emplace(i,a,d){const f=2*i;return this.float32[f+0]=a,this.float32[f+1]=d,i}}Jc.prototype.bytesPerElement=8,qt(Jc,"StructArrayLayout2f8");class T0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,f)}emplace(i,a,d,f,y){const _=6*i;return this.uint32[3*i+0]=a,this.uint16[_+2]=d,this.uint16[_+3]=f,this.uint16[_+4]=y,i}}T0.prototype.bytesPerElement=12,qt(T0,"StructArrayLayout1ul3ui12");class E0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}E0.prototype.bytesPerElement=2,qt(E0,"StructArrayLayout1ui2");class Lg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q){const oe=this.length;return this.resize(oe+1),this.emplace(oe,i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q)}emplace(i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q,oe){const de=16*i;return this.float32[de+0]=a,this.float32[de+1]=d,this.float32[de+2]=f,this.float32[de+3]=y,this.float32[de+4]=_,this.float32[de+5]=S,this.float32[de+6]=A,this.float32[de+7]=k,this.float32[de+8]=j,this.float32[de+9]=R,this.float32[de+10]=L,this.float32[de+11]=W,this.float32[de+12]=q,this.float32[de+13]=J,this.float32[de+14]=Q,this.float32[de+15]=oe,i}}Lg.prototype.bytesPerElement=64,qt(Lg,"StructArrayLayout16f64");class bd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,f,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,d,f,y,_,S)}emplace(i,a,d,f,y,_,S,A){const k=10*i,j=5*i;return this.uint16[k+0]=a,this.uint16[k+1]=d,this.uint16[k+2]=f,this.uint16[k+3]=y,this.float32[j+2]=_,this.float32[j+3]=S,this.float32[j+4]=A,i}}bd.prototype.bytesPerElement=20,qt(bd,"StructArrayLayout4ui3f20");class A0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.int16[1*i+0]=a,i}}A0.prototype.bytesPerElement=2,qt(A0,"StructArrayLayout1i2");class zg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint8[1*i+0]=a,i}}zg.prototype.bytesPerElement=1,qt(zg,"StructArrayLayout1ub1");class k0 extends dp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}k0.prototype.size=40;class sS extends v0{get(i){return new k0(this,i)}}qt(sS,"CollisionBoxArray");class Ng extends dp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Ng.prototype.size=60;class pp extends xd{get(i){return new Ng(this,i)}}qt(pp,"PlacedSymbolArray");class P0 extends dp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}P0.prototype.size=80;class oS extends x0{get(i){return new P0(this,i)}}qt(oS,"SymbolInstanceArray");class C0 extends Yu{getoffsetX(i){return this.float32[1*i+0]}}qt(C0,"GlyphOffsetArray");class aS extends Io{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}qt(aS,"SymbolLineVertexArray");class Fg extends dp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Fg.prototype.size=12;class lS extends T0{get(i){return new Fg(this,i)}}qt(lS,"FeatureIndexArray");class cS extends xl{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}qt(cS,"FillExtrusionCentroidArray");class uS extends dp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}uS.prototype.size=6;class hS extends pd{get(i){return new uS(this,i)}}qt(hS,"FillExtrusionWallArray");const dS=Yr([{name:"a_pos",components:2,type:"Int16"}],4),ZP=Yr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),KP=Yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ui{constructor(i=[]){this.segments=i}_prepareSegment(i,a,d,f){let y=this.segments[this.segments.length-1];return i>ui.MAX_VERTEX_ARRAY_LENGTH&&qr(`Max vertices per segment is ${ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!y||y.vertexLength+i>ui.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==f)&&(y={vertexOffset:a,primitiveOffset:d,vertexLength:0,primitiveLength:0},f!==void 0&&(y.sortKey=f),this.segments.push(y)),y}prepareSegment(i,a,d,f){return this._prepareSegment(i,a.length,d.length,f)}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,d,f){return new ui([{vertexOffset:i,primitiveOffset:a,vertexLength:d,primitiveLength:f,vaos:{},sortKey:0}])}}function fS(l,i){return 256*(l=xe(Math.floor(l),0,255))+xe(Math.floor(i),0,255)}ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt(ui,"SegmentVector");const XP=Yr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),I0=Yr([{name:"a_pattern_b",components:4,type:"Uint16"}]),YP=Yr([{name:"a_dash",components:4,type:"Uint16"}]);class mp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,a,d,f){this.ids.push(gp(i)),this.positions.push(a,d,f)}eachPosition(i,a){const d=gp(i);let f=0,y=this.ids.length-1;for(;f<y;){const _=f+y>>1;this.ids[_]>=d?y=_:f=_+1}for(;this.ids[f]===d;)a(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(i,a){const d=new Float64Array(i.ids),f=new Uint32Array(i.positions);return M0(d,f,0,d.length-1),a&&(a.add(d.buffer),a.add(f.buffer)),{ids:d,positions:f}}static deserialize(i){const a=new mp;let d;a.ids=i.ids,a.positions=i.positions;for(const f of a.ids)f!==d&&a.uniqueIds.push(f),d=f;return a.indexed=!0,a}}function gp(l){const i=+l;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:qh(String(l))}function M0(l,i,a,d){for(;a<d;){const f=l[a+d>>1];let y=a-1,_=d+1;for(;;){do y++;while(l[y]<f);do _--;while(l[_]>f);if(y>=_)break;Bg(l,y,_),Bg(i,3*y,3*_),Bg(i,3*y+1,3*_+1),Bg(i,3*y+2,3*_+2)}_-a<d-_?(M0(l,i,a,_),a=_+1):(M0(l,i,_+1,d),d=_)}}function Bg(l,i,a){const d=l[i];l[i]=l[a],l[a]=d}qt(mp,"FeaturePositionMap");class Ma{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}set(i,a,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Vg extends Ma{constructor(i){super(i),this.current=0}set(i,a,d){this.fetchUniformLocation(i,a)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class Mi extends Ma{constructor(i){super(i),this.current=0}set(i,a,d){this.fetchUniformLocation(i,a)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class bl extends Ma{constructor(i){super(i),this.current=[0,0]}set(i,a,d){this.fetchUniformLocation(i,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class wd extends Ma{constructor(i){super(i),this.current=[0,0,0]}set(i,a,d){this.fetchUniformLocation(i,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class yp extends Ma{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,d){this.fetchUniformLocation(i,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class O0 extends Ma{constructor(i){super(i),this.current=Tn.transparent.toPremultipliedRenderColor(null)}set(i,a,d){this.fetchUniformLocation(i,a)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const pS=new Float32Array(16);class _p extends Ma{constructor(i){super(i),this.current=pS}set(i,a,d){if(this.fetchUniformLocation(i,a)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let f=1;f<16;f++)if(d[f]!==this.current[f]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const JP=new Float32Array(9),mS=new Float32Array(4);class j0 extends Ma{constructor(i){super(i),this.current=mS}set(i,a,d){if(this.fetchUniformLocation(i,a)){for(let f=0;f<4;f++)if(d[f]!==this.current[f]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function R0(l){return[fS(255*l.r,255*l.g),fS(255*l.b,255*l.a)]}class vp{constructor(i,a,d,f){this.value=i,this.uniformNames=a.map(y=>`u_${y}`),this.type=d,this.context=f}setUniform(i,a,d,f,y){const _=f.constantOr(this.value);a.set(i,y,_ instanceof Tn?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(i,a){return this.type==="color"?new O0(i):new Mi(i)}}class Sd{constructor(i,a){this.uniformNames=a.map(d=>`u_${d}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,a){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(i,a,d,f,y){let _=null;y!=="u_pattern"&&y!=="u_dash"||(_=this.pattern),y==="u_pattern_b"&&(_=this.patternTransition),y==="u_pixel_ratio"&&(_=this.pixelRatio),_&&a.set(i,y,_)}getBinding(i,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new yp(i):new Mi(i)}}class Yl{constructor(i,a,d,f){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=a.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(i,a,d,f,y,_,S,A){const k=this.paintVertexArray.length,j=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new On(0,{brightness:_,worldview:A}),a,{},y,f,S):this.expression.kind==="constant"&&this.expression.value,R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new On(0,{brightness:_,worldview:A}),a,{},y,f,S):this.lutExpression.value)==="none";this.paintVertexArray.resize(i),this._setPaintValue(k,i,j,R?null:this.context.lut)}updatePaintArray(i,a,d,f,y,_,S,A){const k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:S,worldview:A},d,f,void 0,y):this.expression.kind==="constant"&&this.expression.value,j=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new On(0,{brightness:S,worldview:A}),d,f,void 0,y):this.lutExpression.value)==="none";this._setPaintValue(i,a,k,j?null:this.context.lut)}_setPaintValue(i,a,d,f){if(this.type==="color"){const y=R0(d.toPremultipliedRenderColor(f));for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,y[0],y[1])}else{for(let y=i;y<a;y++)this.paintVertexArray.emplace(y,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oa{constructor(i,a,d,f,y,_){this.expression=i,this.uniformNames=a.map(S=>`u_${S}_t`),this.type=d,this.useIntegerZoom=f,this.context=y,this.maxValue=0,this.paintVertexAttributes=a.map(S=>({name:`a_${S}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(i,a,d,f,y,_,S,A){const k=this.expression.evaluate(new On(this.context.zoom,{brightness:_,worldview:A}),a,{},y,f,S),j=this.expression.evaluate(new On(this.context.zoom+1,{brightness:_,worldview:A}),a,{},y,f,S),R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new On(0,{brightness:_,worldview:A}),a,{},y,f,S):this.lutExpression.value)==="none",L=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(L,i,k,j,R?null:this.context.lut)}updatePaintArray(i,a,d,f,y,_,S,A){const k=this.expression.evaluate({zoom:this.context.zoom,brightness:S,worldview:A},d,f,void 0,y),j=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S,worldview:A},d,f,void 0,y),R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new On(0,{brightness:S,worldview:A}),d,f,void 0,y):this.lutExpression.value)==="none";this._setPaintValue(i,a,k,j,R?null:this.context.lut)}_setPaintValue(i,a,d,f,y){if(this.type==="color"){const _=R0(d.toPremultipliedRenderColor(y)),S=R0(d.toPremultipliedRenderColor(y));for(let A=i;A<a;A++)this.paintVertexArray.emplace(A,_[0],_[1],S[0],S[1])}else{for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,d,f);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,d,f,y){const _=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,S=xe(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);a.set(i,y,S)}getBinding(i,a){return new Mi(i)}}class aa{constructor(i,a,d,f,y){this.expression=i,this.layerId=y,this.paintVertexAttributes=(d==="array"?YP:XP).members;for(let _=0;_<a.length;++_);this.paintVertexArray=new f,this.paintTransitionVertexArray=new gd}populatePaintArray(i,a,d,f){const y=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(y,i,a.patterns&&a.patterns[this.layerId],d)}updatePaintArray(i,a,d,f,y,_,S){this._setPaintValues(i,a,d.patterns&&d.patterns[this.layerId],_)}_setPaintValues(i,a,d,f){if(!f||!d)return;const y=f[d[0]],_=f[d[1]];if(y){if(y){const{tl:S,br:A,pixelRatio:k}=y;for(let j=i;j<a;j++)this.paintVertexArray.emplace(j,S[0],S[1],A[0],A[1],k)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:S,br:A}=_;for(let k=i;k<a;k++)this.paintTransitionVertexArray.emplace(k,S[0],S[1],A[0],A[1])}}}upload(i){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,I0.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class ho{constructor(i,a,d=()=>!0){this.binders={},this._buffers=[],this.context=a;const f=[];for(const y in i.paint._values){const _=i.paint.get(y);if(y.endsWith("-use-theme")||!d(y)||!(_ instanceof Xu&&vg(_.property.specification)))continue;const S=eC(y,i.type),A=_.value,k=_.property.specification.type,j=!!_.property.useIntegerZoom,R=y==="line-dasharray"||y.endsWith("pattern"),L=i.paint.get(`${y}-use-theme`),W=y==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||L&&L.value.kind!=="constant";if(A.kind!=="constant"||W)if(A.kind==="source"||W||R){const q=gS(y,k,"source");this.binders[y]=R?new aa(A,S,k,q,i.id):new Yl(A,S,k,q),f.push(`/a_${y}`)}else{const q=gS(y,k,"composite");this.binders[y]=new Oa(A,S,k,j,a,q),f.push(`/z_${y}`)}else this.binders[y]=R?new Sd(A.value,S):new vp(A.value,S,k,a),f.push(`/u_${y}`);L&&(this.binders[y].lutExpression=L.value)}this.cacheKey=f.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof Yl||a instanceof Oa?a.maxValue:0}populatePaintArrays(i,a,d,f,y,_,S,A){for(const k in this.binders){const j=this.binders[k];j.context=this.context,(j instanceof Yl||j instanceof Oa||j instanceof aa)&&j.populatePaintArray(i,a,d,f,y,_,S,A)}}setConstantPatternPositions(i,a){for(const d in this.binders){const f=this.binders[d];f instanceof Sd&&f.setConstantPatternPositions(i,a)}}getPatternTransitionVertexBuffer(i){const a=this.binders[i];return a instanceof aa?a.paintTransitionVertexBuffer:null}updatePaintArrays(i,a,d,f,y,_,S,A,k,j){let R=!1;const L=Object.keys(i),W=L.length!==0&&!A,q=W?L:a.uniqueIds;this.context.lut=y.lut;for(const J in this.binders){const Q=this.binders[J];if(Q.context=this.context,(Q instanceof Yl||Q instanceof Oa||Q instanceof aa)&&Q.expression&&Q.expression.kind&&Q.expression.kind!=="constant"&&(Q.expression.isStateDependent===!0||Q.expression.isLightConstant===!1)){const oe=y.paint.get(J);Q.expression=oe.value;for(const de of q){const he=i[de.toString()];a.eachPosition(de,(fe,Ie,Ae)=>{const ke=f.feature(fe);Q.updatePaintArray(Ie,Ae,ke,he,_,S,k,j)})}if(!W)for(const de of d.uniqueIds){const he=i[de.toString()];d.eachPosition(de,(fe,Ie,Ae)=>{const ke=f.feature(fe);Q.updatePaintArray(Ie,Ae,ke,he,_,S,k,j)})}R=!0}}return R}defines(){const i=[];for(const a in this.binders){const d=this.binders[a];(d instanceof vp||d instanceof Sd)&&i.push(...d.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return i}getBinderAttributes(){const i=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof Yl||d instanceof Oa||d instanceof aa)for(let f=0;f<d.paintVertexAttributes.length;f++)i.push(d.paintVertexAttributes[f].name);if(d instanceof aa)for(let f=0;f<I0.members.length;f++)i.push(I0.members[f].name)}return i}getBinderUniforms(){const i=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof vp||d instanceof Sd||d instanceof Oa)for(const f of d.uniformNames)i.push(f)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const d in this.binders){const f=this.binders[d];if(f instanceof vp||f instanceof Sd||f instanceof Oa)for(const y of f.uniformNames)a.push({name:y,property:d,binding:f.getBinding(i,y)})}return a}setUniforms(i,a,d,f,y){for(const{name:_,property:S,binding:A}of d)this.binders[S].setUniform(i,A,y,f.get(S),_)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Yl||a instanceof Oa||a instanceof aa)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof aa&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(i){for(const a in this.binders){const d=this.binders[a];(d instanceof Yl||d instanceof Oa||d instanceof aa)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof Yl||a instanceof Oa||a instanceof aa)&&a.destroy()}}}class la{constructor(i,a,d=()=>!0){this.programConfigurations={};for(const f of i)this.programConfigurations[f.id]=new ho(f,a,d);this.needsUpload=!1,this._featureMap=new mp,this._featureMapWithoutIds=new mp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,a,d,f,y,_,S,A,k){for(const j in this.programConfigurations)this.programConfigurations[j].populatePaintArrays(i,a,f,y,_,S,A,k);a.id!==void 0?this._featureMap.add(a.id,d,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,d,f,y,_,S,A){for(const k of d)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,a,k,f,y,_,S||0,A)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const QP={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function eC(l,i){return QP[l]||[l.replace(`${i}-`,"").replace(/-/g,"_")]}const tC={"line-pattern":{source:Xc,composite:Xc},"fill-pattern":{source:Xc,composite:Xc},"fill-extrusion-pattern":{source:Xc,composite:Xc},"line-dasharray":{source:gd,composite:gd}},rC={color:{source:Jc,composite:Yc},number:{source:Yu,composite:Jc}};function gS(l,i,a){const d=tC[l];return d&&d[a]||rC[i][a]}qt(vp,"ConstantBinder"),qt(Sd,"PatternConstantBinder"),qt(Yl,"SourceExpressionBinder"),qt(aa,"PatternCompositeBinder"),qt(Oa,"CompositeExpressionBinder"),qt(ho,"ProgramConfiguration",{omit:["_buffers"]}),qt(la,"ProgramConfigurationSet");const Zs=Dt/Math.PI/2,m=5,o=6,u=16383,g=64,x=[g,32,16],b=-Zs,E=Zs;function C(l,i,a,d=Zs){return a=Br(a),[l*Math.sin(a)*d,-i*d,l*Math.cos(a)*d]}function M(l,i,a){return C(Math.cos(Br(l)),Math.sin(Br(l)),i,a)}const z=63710088e-1,F=2*Math.PI*z;class H{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new H(et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,d=this.lat*a,f=i.lat*a,y=Math.sin(d)*Math.sin(f)+Math.cos(d)*Math.cos(f)*Math.cos((i.lng-this.lng)*a);return z*Math.acos(Math.min(y,1))}toBounds(i=0){const a=360*i/40075017,d=a/Math.cos(Math.PI/180*this.lat);return new $({lng:this.lng-d,lat:this.lat-a},{lng:this.lng+d,lat:this.lat+a})}toEcef(i){return M(this.lat,this.lng,Zs+i*Zs/z)}static convert(i){if(i instanceof H)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new H(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new H(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ${constructor(i,a){if(i)if(a)this.setSouthWest(i).setNorthEast(a);else if(i.length===4){const d=i;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{const d=i;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(i){return this._ne=i instanceof H?new H(i.lng,i.lat):H.convert(i),this}setSouthWest(i){return this._sw=i instanceof H?new H(i.lng,i.lat):H.convert(i),this}extend(i){const a=this._sw,d=this._ne;let f,y;if(i instanceof H)f=i,y=i;else{if(!(i instanceof $))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend($.convert(i)):this.extend(H.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(H.convert(i)):this;if(f=i._sw,y=i._ne,!f||!y)return this}return a||d?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new H(f.lng,f.lat),this._ne=new H(y.lng,y.lat)),this}getCenter(){return new H((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new H(this.getWest(),this.getNorth())}getSouthEast(){return new H(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:d}=H.convert(i);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&f}static convert(i){if(i)return i instanceof $?i:new $(i)}}const K=0,te=25.5;function ee(l){return F*Math.cos(l*Math.PI/180)}function re(l){return(180+l)/360}function ie(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function ue(l,i){return l/ee(i)}function pe(l){return 360*l-180}function me(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Te(l,i){return l*ee(me(i))}const we=85.051129;function Ce(l){return Math.cos(Br(xe(l,-we,we)))}function be(l,i){const a=xe(i,K,te),d=Math.pow(2,a);return Ce(l)*F/(512*d)}function Se(l){return 1/Math.cos(l*Math.PI/180)}function Ee(l,i=0){const a=Math.exp(Math.PI*(1-(l.y+i/Dt)/(1<<l.z)*2));return 80150034*a/(a*a+1)/Dt/(1<<l.z)}class Ue{constructor(i,a,d=0){this.x=+i,this.y=+a,this.z=+d}static fromLngLat(i,a=0){const d=H.convert(i);return new Ue(re(d.lng),ie(d.lat),ue(a,d.lat))}toLngLat(){return new H(pe(this.x),me(this.y))}toAltitude(){return Te(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/F*Se(me(this.y))}}function De(l,i,a,d,f,y,_,S,A){const k=(i+d)/2,j=(a+f)/2,R=new ut(k,j);S(R),function(L,W,q,J,Q,oe){const de=q-Q,he=J-oe;return Math.abs((J-W)*de-(q-L)*he)/Math.hypot(de,he)}(R.x,R.y,y.x,y.y,_.x,_.y)>=A?(De(l,i,a,k,j,y,R,S,A),De(l,k,j,d,f,R,_,S,A)):l.push(_)}function dt(l,i,a){let d=l[0],f=d.x,y=d.y;i(d);const _=[d];for(let S=1;S<l.length;S++){const A=l[S],{x:k,y:j}=A;i(A),De(_,f,y,k,j,d,A,i,a),f=k,y=j,d=A}return _}function Je(l,i,a,d){if(d(i,a)){const f=i.add(a)._mult(.5);Je(l,i,f,d),Je(l,f,a,d)}else l.push(a)}function pt(l,i){let a=l[0];const d=[a];for(let f=1;f<l.length;f++){const y=l[f];Je(d,a,y,i),a=y}return d}const Pt=Math.pow(2,14)-1,qe=-Pt-1;function Re(l,i){const a=Math.round(l.x*i),d=Math.round(l.y*i);return l.x=xe(a,qe,Pt),l.y=xe(d,qe,Pt),(a<l.x||a>l.x+1||d<l.y||d>l.y+1)&&qr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function nt(l,i,a){const d=l.loadGeometry(),f=l.extent,y=Dt/f;if(i&&a&&a.projection.isReprojectedInTileSpace){const _=1<<i.z,{scale:S,x:A,y:k,projection:j}=a,R=L=>{const W=pe((i.x+L.x/f)/_),q=me((i.y+L.y/f)/_),J=j.project(W,q);L.x=(J.x*S-A)*f,L.y=(J.y*S-k)*f};for(let L=0;L<d.length;L++)if(l.type!==1)d[L]=dt(d[L],R,1);else{const W=[];for(const q of d[L])q.x<0||q.x>=f||q.y<0||q.y>=f||(R(q),W.push(q));d[L]=W}}for(const _ of d)for(const S of _)Re(S,y);return d}function Ze(l,i){return{type:l.type,id:l.id,properties:l.properties,geometry:i?nt(l):[]}}class yt{constructor(i,a,d,f,y){this.properties={},this.extent=d,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=f,this._values=y,i.readFields(bt,this,a)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos,d=[];let f,y=1,_=0,S=0,A=0;for(;i.pos<a;){if(_<=0){const k=i.readVarint();y=7&k,_=k>>3}if(_--,y===1||y===2)S+=i.readSVarint(),A+=i.readSVarint(),y===1&&(f&&d.push(f),f=[]),f&&f.push(new ut(S,A));else{if(y!==7)throw new Error(`unknown command ${y}`);f&&f.push(f[0].clone())}}return f&&d.push(f),d}bbox(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos;let d=1,f=0,y=0,_=0,S=1/0,A=-1/0,k=1/0,j=-1/0;for(;i.pos<a;){if(f<=0){const R=i.readVarint();d=7&R,f=R>>3}if(f--,d===1||d===2)y+=i.readSVarint(),_+=i.readSVarint(),y<S&&(S=y),y>A&&(A=y),_<k&&(k=_),_>j&&(j=_);else if(d!==7)throw new Error(`unknown command ${d}`)}return[S,k,A,j]}toGeoJSON(i,a,d){const f=this.extent*Math.pow(2,d),y=this.extent*i,_=this.extent*a,S=this.loadGeometry();function A(L){return[360*(L.x+y)/f-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+_)/f)*Math.PI))-90]}function k(L){return L.map(A)}let j;if(this.type===1){const L=[];for(const q of S)L.push(q[0]);const W=k(L);j=L.length===1?{type:"Point",coordinates:W[0]}:{type:"MultiPoint",coordinates:W}}else if(this.type===2){const L=S.map(k);j=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=function(q){const J=q.length;if(J<=1)return[q];const Q=[];let oe,de;for(let he=0;he<J;he++){const fe=Et(q[he]);fe!==0&&(de===void 0&&(de=fe<0),de===fe<0?(oe&&Q.push(oe),oe=[q[he]]):oe&&oe.push(q[he]))}return oe&&Q.push(oe),Q}(S),W=[];for(const q of L)W.push(q.map(k));j=W.length===1?{type:"Polygon",coordinates:W[0]}:{type:"MultiPolygon",coordinates:W}}}const R={type:"Feature",geometry:j,properties:this.properties};return this.id!=null&&(R.id=this.id),R}}function bt(l,i,a){l===1?i.id=a.readVarint():l===2?function(d,f){const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=f._keys[d.readVarint()],S=f._values[d.readVarint()];f.properties[_]=S}}(a,i):l===3?i.type=a.readVarint():l===4&&(i._geometry=a.pos)}function Et(l){let i=0;for(let a,d,f=0,y=l.length,_=y-1;f<y;_=f++)a=l[f],d=l[_],i+=(d.x-a.x)*(a.y+d.y);return i}yt.types=["Unknown","Point","LineString","Polygon"];class jt{constructor(i,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(tr,this,a),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const a=this._pbf.readVarint()+this._pbf.pos;return new yt(this._pbf,a,this.extent,this._keys,this._values)}}function tr(l,i,a){l===15?i.version=a.readVarint():l===1?i.name=a.readString():l===5?i.extent=a.readVarint():l===2?i._features.push(a.pos):l===3?i._keys.push(a.readString()):l===4&&i._values.push(function(d){let f=null;const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=d.readVarint()>>3;f=_===1?d.readString():_===2?d.readFloat():_===3?d.readDouble():_===4?d.readVarint64():_===5?d.readVarint():_===6?d.readSVarint():_===7?d.readBoolean():null}if(f==null)throw new Error("unknown feature value");return f}(a))}class ir{constructor(i,a){this.layers=i.readFields(Zt,{},a)}}function Zt(l,i,a){if(l===3){const d=new jt(a,a.readVarint()+a.pos);d.length&&(i[d.name]=d)}}const er="3d_elevation_id",nr="level";class wr{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,a){return this._valid&&i(a(this._geometry)),this}require(i,a,d){return this.get(i,!0,a,d)}optional(i,a,d){return this.get(i,!1,a,d)}success(){return this._valid}get(i,a,d,f){const y=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&y!==void 0&&!Number.isNaN(y)?d(f?f(y):y):a&&(this._valid=!1),this}}class Pr{constructor(i,a){this.featureFunc=i,this.vertexFunc=a}parseFeature(i,a,d){return this.featureFunc(i,a,d)}parseVertex(i,a,d){return this.vertexFunc(i,a,d)}}const Nr=new Pr((l,i,a)=>l.reset(i).require(er,d=>{a.id=d}).optional("fixed_height_relative",d=>{a.constantHeight=d},vr.decodeRelativeHeight).geometry(d=>{a.bounds=d},Cv).success(),(l,i,a)=>l.reset(i).require(er,d=>{a.id=d}).require("elevation_idx",d=>{a.idx=d}).require("extent",d=>{a.extent=d}).require("height_relative",d=>{a.height=d},vr.decodeRelativeHeight).geometry(d=>{a.position=d},vr.getPoint).success()),Pn=new Pr((l,i,a)=>l.reset(i).require(er,d=>{a.id=d}).optional("fixed_height",d=>{a.constantHeight=d},vr.decodeMetricHeight).geometry(d=>{a.bounds=d},Cv).success(),(l,i,a)=>l.reset(i).require(er,d=>{a.id=d}).require("elevation_idx",d=>{a.idx=d}).require("extent",d=>{a.extent=d}).require("height",d=>{a.height=d},vr.decodeMetricHeight).geometry(d=>{a.position=d},vr.getPoint).success());class vr{static getPoint(i){return oo(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static parse(i){const a=[],d=[],f=i.length,y=new wr;for(let S=0;S<f;S++){const A=i.feature(S),k=A.properties.version,j=(_=k)?_==="1.0.1"?Pn:void 0:Nr;if(j===void 0){qr(`Unknown elevation feature version number ${k||"(unknown)"}`);continue}const R=A.properties.hasOwnProperty("type")?A.properties.type:void 0;if(R){if(yt.types[A.type]==="Point"&&R==="curve_point"){const L={};j.parseVertex(y,A,L)&&a.push(L)}else if(yt.types[A.type]==="Polygon"&&R==="curve_meta"){const L={};j.parseFeature(y,A,L)&&d.push(L)}}}var _;return{vertices:a,features:d}}}class un{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,d){const f=Yn(a,this.dir);if(Math.abs(f)<1e-6)return!1;const y=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1])/f;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,!0}}class hn{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,d){const f=Ft(a,this.dir);if(Math.abs(f)<1e-6)return!1;const y=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/f;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,d[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(i,a,d){if(function(W,q){var J=W[0],Q=W[1],oe=W[2],de=q[0],he=q[1],fe=q[2];return Math.abs(J-de)<=v*Math.max(1,Math.abs(J),Math.abs(de))&&Math.abs(Q-he)<=v*Math.max(1,Math.abs(Q),Math.abs(he))&&Math.abs(oe-fe)<=v*Math.max(1,Math.abs(oe),Math.abs(fe))}(this.pos,i)||a===0)return d[0]=d[1]=d[2]=0,!1;const[f,y,_]=this.dir,S=this.pos[0]-i[0],A=this.pos[1]-i[1],k=this.pos[2]-i[2],j=f*f+y*y+_*_,R=2*(S*f+A*y+k*_),L=R*R-4*j*(S*S+A*A+k*k-a*a);if(L<0){const W=Math.max(-R/2,0),q=S+f*W,J=A+y*W,Q=k+_*W,oe=Math.hypot(q,J,Q);return d[0]=q*a/oe,d[1]=J*a/oe,d[2]=Q*a/oe,!1}{const W=(-R-Math.sqrt(L))/(2*j);if(W<0){const q=Math.hypot(S,A,k);return d[0]=S*a/q,d[1]=A*a/q,d[2]=k*a/q,!1}return d[0]=S+f*W,d[1]=A+y*W,d[2]=k+_*W,!0}}}class Zn{constructor(i,a,d,f,y){this.TL=i,this.TR=a,this.BR=d,this.BL=f,this.horizon=y}static fromInvProjectionMatrix(i,a,d){const f=[-1,1,1],y=[1,1,1],_=[1,-1,1],S=[-1,-1,1],A=Qt(f,f,i),k=Qt(y,y,i),j=Qt(_,_,i),R=Qt(S,S,i);return new Zn(A,k,j,R,a/d)}}function Ir(l,i,a){let d=1/0,f=-1/0;const y=[];for(const _ of l){Kr(y,_,i);const S=Ft(y,a);d=Math.min(d,S),f=Math.max(f,S)}return[d,f]}function on(l,i){let a=!0;for(let d=0;d<l.planes.length;d++){const f=l.planes[d];let y=0;for(let _=0;_<i.length;_++)y+=Ft(f,i[_])+f[3]>=0;if(y===0)return 0;y!==i.length&&(a=!1)}return a?2:1}function cn(l,i){for(const a of l.projections){const d=Ir(i,l.points[0],a.axis);if(a.projection[1]<d[0]||a.projection[0]>d[1])return 0}return 1}function vn(l,i){let a=0;const d=[0,0,0,0];for(let _=0;_<l.length;_++)d[0]=l[_][0],d[1]=l[_][1],d[2]=l[_][2],d[3]=1,(f=d)[0]*(y=i)[0]+f[1]*y[1]+f[2]*y[2]+f[3]*y[3]>=0&&a++;var f,y;return a}class hi{constructor(i,a){this.points=i||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=kr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Kr([],this.points[2],this.points[3]),Kr([],this.points[0],this.points[3]),Kr([],this.points[4],this.points[0]),Kr([],this.points[5],this.points[1]),Kr([],this.points[6],this.points[2]),Kr([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const f=[0,-d[2],d[1]],y=[d[2],0,-d[0]];this.projections.push({axis:f,projection:Ir(this.points,this.points[0],f)}),this.projections.push({axis:y,projection:Ir(this.points,this.points[0],y)})}}static fromInvProjectionMatrix(i,a,d,f){const y=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const j=Bi([],k,i),R=1/j[3]/a*y;return(L=j)[0]=(W=j)[0]*(q=[R,R,f?1/j[3]:R,R])[0],L[1]=W[1]*q[1],L[2]=W[2]*q[2],L[3]=W[3]*q[3],L;var L,W,q}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const j=Er([],br([],Kr([],_[k[0]],_[k[1]]),Kr([],_[k[2]],_[k[1]]))),R=-Ft(j,_[k[1]]);return j.concat(R)}),A=[];for(let k=0;k<_.length;k++)A.push([_[k][0],_[k][1],_[k][2]]);return new hi(A,S)}intersectsPrecise(i,a,d){for(let f=0;f<a.length;f++)if(!vn(i,a[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!vn(i,this.planes[f]))return 0;for(const f of d)for(const y of this.frustumEdges){const _=br([],f,y),S=Ye(_);if(S===0)continue;mt(_,_,1/S);const A=Ir(this.points,this.points[0],_),k=Ir(i,this.points[0],_);if(A[0]>k[1]||k[0]>A[1])return 0}return 1}containsPoint(i){for(const a of this.planes){const d=a[3];if(Ft([a[0],a[1],a[2]],i)+d<0)return!1}return!0}}class kr{static fromPoints(i){const a=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const f of i)ht(a,a,f),vt(d,d,f);return new kr(a,d)}static fromTileIdAndHeight(i,a,d){const f=1<<i.canonical.z,y=i.canonical.x,_=i.canonical.y;return new kr([y/f,_/f,a],[(y+1)/f,(_+1)/f,d])}static applyTransform(i,a){const d=i.getCorners();for(let f=0;f<d.length;++f)Qt(d[f],d[f],a);return kr.fromPoints(d)}static applyTransformFast(i,a){const d=[a[12],a[13],a[14]],f=[...d];for(let y=0;y<3;y++)for(let _=0;_<3;_++){const S=a[4*_+y],A=S*i.min[_],k=S*i.max[_];d[y]+=Math.min(A,k),f[y]+=Math.max(A,k)}return new kr(d,f)}static projectAabbCorners(i,a){const d=i.getCorners();for(let f=0;f<d.length;++f)Qt(d[f],d[f],a);return d}constructor(i,a){this.min=i,this.max=a,this.center=mt([],We([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],d=Ke(this.min),f=Ke(this.max);for(let y=0;y<a.length;y++)d[y]=a[y]?this.min[y]:this.center[y],f[y]=a[y]?this.center[y]:this.max[y];return f[2]=this.max[2],new kr(d,f)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?on(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?on(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,a){return a||this.intersects(i)?cn(i,this.getCorners()):0}intersectsPreciseFlat(i,a){return a||this.intersectsFlat(i)?cn(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let a=0;a<3;++a)if(this.min[a]>i.max[a]||i.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i.min[a]),this.max[a]=Math.max(this.max[a],i.max[a])}encapsulatePoint(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i[a]),this.max[a]=Math.max(this.max[a],i[a])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}qt(kr,"Aabb");class mn{constructor(i,a){this.feature=i,this.metersToTile=a,this.index=0}get(){const i=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,d=a[1],f=-a[0],y=(i.extent+1)*this.metersToTile;return[new ut(Math.trunc(i.position[0]+d*y),Math.trunc(i.position[1]+f*y)),new ut(Math.trunc(i.position[0]-d*y),Math.trunc(i.position[1]-f*y))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class mi{constructor(i,a,d,f,y,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=i,this.heightRange={min:d,max:d},this.safeArea=a,this.constantHeight=d,this.constantHeight==null&&(this.constantHeight!=null||f.length!==0)){this.vertices=f,this.edges=y,this.edges=this.edges.filter(S=>{return S.a<this.vertices.length&&S.b<this.vertices.length&&!((A=this.vertices[S.a].position)[0]===(k=this.vertices[S.b].position)[0]&&A[1]===k[1]);var A,k}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const S of this.vertices)this.vertexProps.push({dir:oo(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,S.height),this.heightRange.max=Math.max(this.heightRange.max,S.height);for(const S of this.edges){const A=this.vertices[S.a].position,k=this.vertices[S.b].position,j=ao(Ps(),k,A),R=So(j),L=Ja(Ps(),j,1/R);this.edgeProps.push({vec:j,dir:L,len:R});const W=this.vertexProps[S.a].dir,q=this.vertexProps[S.b].dir;Ta(W,W,L),Ta(q,q,L)}for(const S of this.vertexProps)S.dir[0]===0&&S.dir[1]===0||Pc(S.dir,S.dir);this.tessellate(_)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(i);if(a==null)return 0;const[d,f]=a;return lr(this.vertices[this.edges[d].a].height,this.vertices[this.edges[d].b].height,f)}computeSlopeNormal(i,a){const d=this.getClosestEdge(i);if(!d)return Oe(0,0,1);const f=d[0],y=this.edges[f],_=this.edgeProps[f].vec,S=Oe(_[0],_[1],(this.vertices[y.b].height-this.vertices[y.a].height)*a),A=Oe(S[1],-S[0],0);br(A,A,S);const k=Ye(A);return k>0?mt(A,A,1/k):Oe(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let a=0,d=Number.POSITIVE_INFINITY,f=0;const y=oo(i.x,i.y);for(let _=0;_<this.edges.length;_++){const S=this.edges[_],A=this.edgeProps[_].dir,k=new un(y,this.edgeProps[_].dir),j=this.vertices[S.a].position,R=this.vertices[S.b].position,L=Ps(),W=Ps(),q=k.intersectsPlane(j,this.vertexProps[S.a].dir,L),J=k.intersectsPlane(R,this.vertexProps[S.b].dir,W);if(!q||!J)continue;const Q=ao(Ps(),W,L),oe=ao(Ps(),y,L),de=Yn(Q,Q),he=de>0?Yn(oe,Q)/de:0,fe=xe(he,0,1),Ie=Math.abs((he-fe)*this.edgeProps[_].len),Ae=ao(Ps(),y,j),ke=Ie+Math.abs(Yn(Ae,oo(A[1],-A[0])));ke<d&&(a=_,d=ke,f=fe)}return[a,f]}tessellate(i){for(let a=this.edges.length-1;a>=0;--a){const d=this.edges[a].a,f=this.edges[a].b,{position:y,height:_,extent:S}=this.vertices[d],{position:A,height:k,extent:j}=this.vertices[f],R=this.vertexProps[d].dir,L=this.vertexProps[f].dir,W=Oe(y[0]/i,y[1]/i,_),q=Oe(A[0]/i,A[1]/i,k),J=Oe(R[1],-R[0],0);mt(J,J,S);const Q=Oe(L[1],-L[0],0);if(mt(Q,Q,j),this.distSqLines(Oe(W[0]+.5*J[0],W[1]+.5*J[1],W[2]+.5*J[2]),Oe(q[0]-.5*Q[0],q[1]-.5*Q[1],q[2]-.5*Q[2]),Oe(W[0]-.5*J[0],W[1]-.5*J[1],W[2]-.5*J[2]),Oe(q[0]+.5*Q[0],q[1]+.5*Q[1],q[2]+.5*Q[2]))<=.0025000000000000005)continue;const oe=this.vertices.length,de=Ta(Ps(),y,A);this.vertices.push({position:Ja(de,de,.5),height:.5*(_+k),extent:.5*(S+j)});const he=Ta(Ps(),R,L);this.vertexProps.push({dir:Pc(he,he)}),this.edges.splice(a,1),this.edgeProps.splice(a,1),this.edges.push({a:d,b:oe}),this.edges.push({a:oe,b:f});const fe=ao(Ps(),this.vertices[oe].position,y),Ie=So(fe),Ae={vec:fe,dir:Ja(Ps(),fe,1/Ie),len:Ie};this.edgeProps.push(Ae),this.edgeProps.push(Ae)}}distSqLines(i,a,d,f){const y=lt(Pe(),a,i),_=lt(Pe(),f,d),S=lt(Pe(),i,d),A=Ft(y,y),k=Ft(y,_),j=Ft(y,S),R=Ft(_,_),L=Ft(_,S),W=A*R-k*k;if(W===0){const Q=Ft(S,_)/Ft(_,_);return Ut(Yt(Pe(),d,f,Q),i)}const q=(k*L-j*R)/W,J=(A*L-k*j)/W;return Ut(Yt(Pe(),i,a,q),Yt(Pe(),d,f,J))}}class rn{static parseFrom(i,a){const d=vr.parse(i);if(!d)return[];let{vertices:f,features:y}=d;const _=1/Ee(a);y.sort((j,R)=>j.id-R.id),f.sort((j,R)=>j.id-R.id||j.idx-R.idx),f=f.filter((j,R,L)=>R===L.findIndex(W=>W.id===j.id&&W.idx===j.idx));const S=new Array;let A=0;const k=f.length;for(const j of y){if(j.constantHeight){S.push(new mi(j.id,j.bounds,j.constantHeight));continue}for(;A!==k&&f[A].id<j.id;)A++;if(A===k||f[A].id!==j.id)continue;const R=new Array,L=new Array,W=A;for(;A!==k&&f[A].id===j.id;){const q=f[A];if(R.push({position:q.position,height:q.height,extent:q.extent}),A!==W&&f[A-1].idx===q.idx-1){const J=A-W;L.push({a:J-1,b:J})}A++}S.push(new mi(j.id,j.bounds,void 0,R,L,_))}return S}static getElevationFeature(i,a){if(!a)return;const d=+i.properties[er];return Number.isNaN(d)?void 0:a.find(f=>f.id===d)}}class xn{constructor(i,a){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(a)||(this.zScale=Math.pow(2,a.z-i.z),this.xOffset=(i.x*this.zScale-a.x)*Dt,this.yOffset=(i.y*this.zScale-a.y)*Dt)}constantElevation(i,a){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,a)}pointElevation(i,a,d){return this.constantElevation(a,d)??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(i),d))}computeBiasedHeight(i,a){return a<=0?i:i+a*Fe(0,a,i>=0?i:Math.abs(.5*i))}}qt(mi,"ElevationFeature");class Ln{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Io,this.indexArray=new ii,this.segments=new ui,this.programConfigurations=new la(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Yu),this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,d,f){const y=this.layers[0],_=[];let S=null;y.type==="circle"&&(S=y.layout.get("circle-sort-key"));for(const{feature:k,id:j,index:R,sourceLayerIndex:L}of i){const W=this.layers[0]._featureFilter.needGeometry,q=Ze(k,W);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),q,d))continue;const J=S?S.evaluate(q,{},d):void 0,Q={id:j,properties:k.properties,type:k.type,sourceLayerIndex:L,index:R,geometry:W?q.geometry:nt(k,d,f),patterns:{},sortKey:J};_.push(Q)}S&&_.sort((k,j)=>k.sortKey-j.sortKey);let A=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new jg,A=f.projection);for(const k of _){const{geometry:j,index:R,sourceLayerIndex:L}=k,W=i[R].feature;this.addFeature(k,j,R,a.availableImages,d,A,a.brightness,a.elevationFeatures),a.featureIndex.insert(W,j,R,L,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,a,d,f,y,_,S){this.programConfigurations.updatePaintArrays(i,a,y,d,f,_,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,dS.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,KP.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,ZP.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,a,d,f,y,_,S,A){let k;this.elevationMode!=="none"&&(k=rn.getElevationFeature(i,A));for(const j of a)for(const R of j){const L=R.x,W=R.y;if(L<0||L>=Dt||W<0||W>=Dt)continue;if(_){const Q=_.projectTilePoint(L,W,y),oe=_.upVector(y,L,W);this.addGlobeExtVertex(Q,oe),this.addGlobeExtVertex(Q,oe),this.addGlobeExtVertex(Q,oe),this.addGlobeExtVertex(Q,oe)}const q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),J=q.vertexLength;if(this.addCircleVertex(L,W,-1,-1),this.addCircleVertex(L,W,1,-1),this.addCircleVertex(L,W,1,1),this.addCircleVertex(L,W,-1,1),this.elevationMode!=="none"){const Q=k?k.pointElevation(new ut(L,W)):0;this.hasElevation=this.hasElevation||Q!==0;for(let oe=0;oe<4;oe++)this.elevatedLayoutVertexArray.emplaceBack(Q)}this.indexArray.emplaceBack(J,J+1,J+2),this.indexArray.emplaceBack(J,J+2,J+3),q.vertexLength+=4,q.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{},f,y,S,void 0,this.worldview)}addCircleVertex(i,a,d,f){this.layoutVertexArray.emplaceBack(2*i+(d+1)/2,2*a+(f+1)/2)}addGlobeExtVertex(i,a){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function Ei(l,i){for(let a=0;a<l.length;a++)if(si(i,l[a]))return!0;for(let a=0;a<i.length;a++)if(si(l,i[a]))return!0;return!!ca(l,i)}function Oi(l,i,a){return!!si(l,i)||!!Go(i,l,a)}function ji(l,i){if(l.length===1)return Ra(i,l[0]);for(let a=0;a<i.length;a++){const d=i[a];for(let f=0;f<d.length;f++)if(si(l,d[f]))return!0}for(let a=0;a<l.length;a++)if(Ra(i,l[a]))return!0;for(let a=0;a<i.length;a++)if(ca(l,i[a]))return!0;return!1}function Rs(l,i,a){if(l.length>1){if(ca(l,i))return!0;for(let d=0;d<i.length;d++)if(Go(i[d],l,a))return!0}for(let d=0;d<l.length;d++)if(Go(l[d],i,a))return!0;return!1}function ca(l,i){if(l.length===0||i.length===0)return!1;for(let a=0;a<l.length-1;a++){const d=l[a],f=l[a+1];for(let y=0;y<i.length-1;y++)if($o(d,f,i[y],i[y+1]))return!0}return!1}function $o(l,i,a,d){return Ti(l,a,d)!==Ti(i,a,d)&&Ti(l,i,a)!==Ti(l,i,d)}function fo(l,i,a){return(l.x-a.x)*(i.y-a.y)-(l.y-a.y)*(i.x-a.x)}function po(l,i,a,d){const f=fo(l,i,d),y=fo(l,i,a);if(Math.sign(f)===Math.sign(y))return;const _=fo(a,d,l),S=_+y-f;return Math.sign(_)!==Math.sign(S)?[_/(_-S),y/(y-f)]:void 0}function Go(l,i,a){const d=a*a;if(i.length===1)return l.distSqr(i[0])<d;for(let f=1;f<i.length;f++)if(ja(l,i[f-1],i[f])<d)return!0;return!1}function ja(l,i,a){const d=i.distSqr(a);if(d===0)return l.distSqr(i);const f=((l.x-i.x)*(a.x-i.x)+(l.y-i.y)*(a.y-i.y))/d;return l.distSqr(f<0?i:f>1?a:a.sub(i)._mult(f)._add(i))}function Ra(l,i){let a,d,f,y=!1;for(let _=0;_<l.length;_++){a=l[_];for(let S=0,A=a.length-1;S<a.length;A=S++)d=a[S],f=a[A],d.y>i.y!=f.y>i.y&&i.x<(f.x-d.x)*(i.y-d.y)/(f.y-d.y)+d.x&&(y=!y)}return y}function si(l,i){let a=!1;for(let d=0,f=l.length-1;d<l.length;f=d++){const y=l[d],_=l[f];y.y>i.y!=_.y>i.y&&i.x<(_.x-y.x)*(i.y-y.y)/(_.y-y.y)+y.x&&(a=!a)}return a}function Ri(l,i,a,d,f){for(const _ of l)if(i<=_.x&&a<=_.y&&d>=_.x&&f>=_.y)return!0;const y=[new ut(i,a),new ut(i,f),new ut(d,f),new ut(d,a)];if(l.length>2){for(const _ of y)if(si(l,_))return!0}for(let _=0;_<l.length-1;_++)if(Un(l[_],l[_+1],y))return!0;return!1}function Un(l,i,a){const d=a[0],f=a[2];if(l.x<d.x&&i.x<d.x||l.x>f.x&&i.x>f.x||l.y<d.y&&i.y<d.y||l.y>f.y&&i.y>f.y)return!1;const y=Ti(l,i,a[0]);return y!==Ti(l,i,a[1])||y!==Ti(l,i,a[2])||y!==Ti(l,i,a[3])}function Di(l,i,a,d,f,y){let _=i.y-l.y,S=l.x-i.x;if(y=y||0){const A=_*_+S*S;if(A===0)return!0;const k=Math.sqrt(A);_/=k,S/=k}return!((a.x-l.x)*_+(a.y-l.y)*S-y<0||(d.x-l.x)*_+(d.y-l.y)*S-y<0||(f.x-l.x)*_+(f.y-l.y)*S-y<0)}function Ks(l,i,a,d,f,y,_){return!(Di(l,i,d,f,y,_)||Di(i,a,d,f,y,_)||Di(a,l,d,f,y,_)||Di(d,f,l,i,a,_)||Di(f,y,l,i,a,_)||Di(y,d,l,i,a,_))}function _i(l,i,a){const d=i.paint.get(l).value;return d.kind==="constant"?d.value:a.programConfigurations.get(i.id).getMaxValue(l)}function Mo(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Qu(l,i,a,d,f){if(!i[0]&&!i[1])return l;const y=ut.convert(i)._mult(f);a==="viewport"&&y._rotate(-d);const _=[];for(let S=0;S<l.length;S++)_.push(l[S].sub(y));return _}function Qc(l,i,a,d){const f=ut.convert(l)._mult(d);return i==="viewport"&&f._rotate(-a),f}let Td,Ed;function eu(l,i,a){var d=2*Math.PI*6378137/256/Math.pow(2,a);return[l*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}qt(Ln,"CircleBucket",{omit:["layers"]});class Oo{constructor(i,a,d){this.z=i,this.x=a,this.y=d,this.key=Da(0,i,i,a,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const a=this.z-i.z;return i.z===0||i.z<this.z&&i.x===this.x>>a&&i.y===this.y>>a}url(i,a){const d=function(y,_,S){var A=eu(256*y,256*(_=Math.pow(2,S)-_-1),S),k=eu(256*(y+1),256*(_+1),S);return A[0]+","+A[1]+","+k[0]+","+k[1]}(this.x,this.y,this.z),f=function(y,_,S){let A,k="";for(let j=y;j>0;j--)A=1<<j-1,k+=(_&A?1:0)+(S&A?2:0);return k}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tu{constructor(i,a){this.wrap=i,this.canonical=a,this.key=Da(i,a.z,a.z,a.x,a.y)}}class $i{constructor(i,a,d,f,y){this.overscaledZ=i,this.wrap=a,this.canonical=new Oo(d,+f,+y),this.key=a===0&&i===d?this.canonical.key:Da(a,i,d,f,y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new $i(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $i(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return Da(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-i;return Da(this.wrap*+a,i,i,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new $i(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,d=2*this.canonical.x,f=2*this.canonical.y;return[new $i(a,this.wrap,a,d,f),new $i(a,this.wrap,a,d+1,f),new $i(a,this.wrap,a,d,f+1),new $i(a,this.wrap,a,d+1,f+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new $i(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new $i(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Da(l,i,a,d,f){const y=1<<Math.min(a,22);let _=y*(f%y)+d%y;return l&&a<22&&(_+=y*y*((l<0?-2*l-1:2*l)%(1<<2*(22-a)))),16*(32*_+a)+(i-a)}const Ore=[l=>{let i=l.canonical.x-1,a=l.wrap;return i<0&&(i=(1<<l.canonical.z)-1,a--),new $i(l.overscaledZ,a,l.canonical.z,i,l.canonical.y)},l=>{let i=l.canonical.x+1,a=l.wrap;return i===1<<l.canonical.z&&(i=0,a++),new $i(l.overscaledZ,a,l.canonical.z,i,l.canonical.y)},l=>new $i(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new $i(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];qt(Oo,"CanonicalTileID"),qt($i,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const jre=Yr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yS}=jre,Rre=Yr([{name:"a_pos_3",components:3,type:"Int16"}]);var fN=Yr([{name:"a_pos",type:"Int16",components:2}]);function _S(l){return l*Zs/z}const Dre=[new kr([b,b,b],[E,E,E]),new kr([b,b,b],[0,0,E]),new kr([0,b,b],[E,0,E]),new kr([b,0,b],[0,E,E]),new kr([0,0,b],[E,E,E])];function pN(l,i,a,d=!0){const f=mt([],l._camera.position,l.worldSize),y=[i,a,1,1];Bi(y,y,l.pixelMatrixInverse),ks(y,y,1/y[3]);const _=Er([],Kr([],y,f)),S=l.globeMatrix,A=[S[12],S[13],S[14]],k=Kr([],A,f),j=Ye(k),R=Er([],k),L=l.worldSize/(2*Math.PI),W=Ft(R,_),q=Math.asin(L/j);if(q<Math.acos(W)){if(!d)return null;const at=[],Ge=[];mt(at,_,j/W),Er(Ge,Kr(Ge,at,k)),Er(_,We(_,k,mt(_,Ge,Math.tan(q)*j)))}const J=[];new hn(f,_).closestPointOnSphere(A,L,J);const Q=Er([],pi(S,0)),oe=Er([],pi(S,1)),de=Er([],pi(S,2)),he=Ft(Q,J),fe=Ft(oe,J),Ie=Ft(de,J),Ae=He(Math.asin(-fe/L));let ke=He(Math.atan2(he,Ie));ke=l.center.lng+function(at,Ge){const ft=(Ge-at+180)%360-180;return ft<-180?ft+360:ft}(l.center.lng,ke);const Le=re(ke),Be=xe(ie(Ae),0,1);return new Ue(Le,Be)}class Lre{constructor(i,a,d){this.a=Kr([],i,d),this.b=Kr([],a,d),this.center=d;const f=Er([],this.a),y=Er([],this.b);this.angle=Math.acos(Ft(f,y))}}function nC(l,i){if(l.angle===0)return null;let a;return a=l.a[i]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[i]/l.a[i]/Math.sin(l.angle)-1/Math.tan(l.angle)),a<0||a>1?null:function(d,f,y,_){const S=Math.sin(y);return d*(Math.sin((1-_)*y)/S)+f*(Math.sin(_*y)/S)}(l.a[i],l.b[i],l.angle,xe(a,0,1))+l.center[i]}function ru(l){if(l.z<=1)return Dre[l.z+2*l.y+l.x];const i=iC(vS(l));return kr.fromPoints(i)}function eh(l,i,a){return mt(l,l,1-a),ct(l,l,i,a)}function mN(l,i,a){for(const d of l)Qt(d,d,i),mt(d,d,a)}function gN(l,i,a,d){const f=i/l.worldSize,y=l.globeMatrix;if(a.z<=1){const Be=ru(a).getCorners();return mN(Be,y,f),kr.fromPoints(Be)}const _=vS(a,d),S=iC(_,Zs+_S(l._tileCoverLift));mN(S,y,f);const A=Number.MAX_VALUE,k=[-A,-A,-A],j=[A,A,A];if(_.contains(l.center)){for(const Ge of S)ht(j,j,Ge),vt(k,k,Ge);k[2]=0;const Be=l.point,at=[Be.x*f,Be.y*f,0];return ht(j,j,at),vt(k,k,at),new kr(j,k)}if(l._tileCoverLift>0){for(const Be of S)ht(j,j,Be),vt(k,k,Be);return new kr(j,k)}const R=[y[12]*f,y[13]*f,y[14]*f],L=_.getCenter(),W=xe(l.center.lat,-we,we),q=xe(L.lat,-we,we),J=re(l.center.lng),Q=ie(W);let oe=J-re(L.lng);const de=Q-ie(q);oe>.5?oe-=1:oe<-.5&&(oe+=1);let he=0;Math.abs(oe)>Math.abs(de)?he=oe>=0?1:3:(he=de>=0?0:2,ct(R,R,[y[4]*f,y[5]*f,y[6]*f],-Math.sin(Br(de>=0?_.getSouth():_.getNorth()))*Zs));const fe=S[he],Ie=S[(he+1)%4],Ae=new Lre(fe,Ie,R),ke=[nC(Ae,0)||fe[0],nC(Ae,1)||fe[1],nC(Ae,2)||fe[2]],Le=Ad(l.zoom);if(Le>0){const Be=function({x:Ge,y:ft,z:wt},xt,At,kt,it){const Tt=1/(1<<wt);let Xe=Ge*Tt,ot=Xe+Tt,It=ft*Tt,St=It+Tt,or=0;const Kt=(Xe+ot)/2-kt;return Kt>.5?or=-1:Kt<-.5&&(or=1),Xe=((Xe+or)*xt-(kt*=xt))*At+kt,ot=((ot+or)*xt-kt)*At+kt,It=(It*xt-(it*=xt))*At+it,St=(St*xt-it)*At+it,[[Xe,St,0],[ot,St,0],[ot,It,0],[Xe,It,0]]}(a,i,l._pixelsPerMercatorPixel,J,Q);for(let Ge=0;Ge<S.length;Ge++)eh(S[Ge],Be[Ge],Le);const at=We([],Be[he],Be[(he+1)%4]);mt(at,at,.5),eh(ke,at,Le)}for(const Be of S)ht(j,j,Be),vt(k,k,Be);return j[2]=Math.min(fe[2],Ie[2]),ht(j,j,ke),vt(k,k,ke),new kr(j,k)}function vS({x:l,y:i,z:a},d=!1){const f=1/(1<<a),y=new H(pe(l*f),i===(1<<a)-1&&d?-90:me((i+1)*f)),_=new H(pe((l+1)*f),i===0&&d?90:me(i*f));return new $(y,_)}function iC(l,i=Zs){const a=Br(l.getNorth()),d=Br(l.getSouth()),f=Math.cos(a),y=Math.cos(d),_=Math.sin(a),S=Math.sin(d),A=l.getWest(),k=l.getEast();return[C(y,S,A,i),C(y,S,k,i),C(f,_,k,i),C(f,_,A,i)]}function D0(l,i,a,d){const f=1<<a.z,y=(l/Dt+a.x)/f;return M(me((i/Dt+a.y)/f),pe(y),d)}function xS({min:l,max:i}){return u/Math.max(i[0]-l[0],i[1]-l[1],i[2]-l[2])}const yN=new Float64Array(16);function bS(l){const i=xS(l),a=le(yN,[i,i,i]);return V(a,a,tn([],l.min))}function sC(l){const i=(d=l.min,(a=yN)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=d[0],a[13]=d[1],a[14]=d[2],a[15]=1,a);var a,d;const f=1/xS(l);return X(i,i,[f,f,f])}function oC(l){const i=Dt/(2*Math.PI);return l/(2*Math.PI)/i}function _N(l,i){return Dt/(512*Math.pow(2,l))*xS(ru(i))}function vN(l,i,a,d,f){const y=oC(a),_=[l,i,-a/(2*Math.PI)],S=N(new Float64Array(16));return V(S,S,_),X(S,S,[y,y,y]),Y(S,S,Br(-f)),ne(S,S,Br(-d)),S}function Ad(l){return Fe(m,o,l)}function xN(l,i){const a=M(i.lat,i.lng),d=function(q){const J=M(q._center.lat,q._center.lng);let Q=br([],Oe(0,1,0),J);const oe=ge([],-q.angle,J);Q=Qt(Q,Q,oe),ge(oe,-q._pitch,Q);const de=Er([],J);return mt(de,de,_S(q.cameraToCenterDistance/q.pixelsPerMeter)),Qt(de,de,oe),We([],J,de)}(l);return _=(f=lt([],d,a))[0],S=f[1],A=f[2],k=(y=a)[0],j=y[1],R=y[2],W=(L=Math.sqrt(_*_+S*S+A*A)*Math.sqrt(k*k+j*j+R*R))&&Ft(f,y)/L,Math.acos(Math.min(Math.max(W,-1),1));var f,y,_,S,A,k,j,R,L,W}function aC(l,i){return xN(l,i)>Math.PI/2*1.01}const bN=Br(85),zre=Math.cos(bN),Nre=Math.sin(bN),Fre=B(),wN=l=>{const i=[];return l.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function SN(l,i,a,d,f,y,_,S,A){if(y&&l.queryGeometry.isAboveHorizon)return!1;y&&(A*=l.pixelToTileUnitsFactor);const k=l.tileID.canonical,j=a.projection.upVectorScale(k,a.center.lat,a.worldSize).metersToTile;for(const R of i)for(const L of R){const W=L.add(S),q=f&&a.elevation?a.elevation.exaggeration()*f.getElevationAt(W.x,W.y,!0):0,J=a.projection.projectTilePoint(W.x,W.y,k);if(q>0){const he=a.projection.upVector(k,W.x,W.y);J.x+=he[0]*j*q,J.y+=he[1]*j*q,J.z+=he[2]*j*q}const Q=y?W:Bre(J.x,J.y,J.z,d),oe=y?l.tilespaceRays.map(he=>Ure(he,q)):l.queryGeometry.screenGeometry,de=Bi([],[J.x,J.y,J.z,1],d);if(!_&&y?A*=de[3]/a.cameraToCenterDistance:_&&!y&&(A*=a.cameraToCenterDistance/de[3]),y){const he=me((L.y/Dt+k.y)/(1<<k.z));A/=a.projection.pixelsPerMeter(he,1)/ue(1,he)}if(Oi(oe,Q,A))return!0}return!1}function Bre(l,i,a,d){const f=Bi([],[l,i,a,1],d);return new ut(f[0]/f[3],f[1]/f[3])}const TN=Oe(0,0,0),Vre=Oe(0,0,1);function Ure(l,i){const a=Pe();return TN[2]=i,l.intersectsPlane(TN,Vre,a),new ut(a[0],a[1])}class EN extends Ln{}let AN,kN,PN,CN;function IN(l,{width:i,height:a},d,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==i*a*d)throw new RangeError("mismatched image size")}else f=new Uint8Array(i*a*d);return l.width=i,l.height=a,l.data=f,l}function MN(l,i,a){const{width:d,height:f}=i;d===l.width&&f===l.height||(lC(l,i,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,d),height:Math.min(l.height,f)},a,null),l.width=d,l.height=f,l.data=i.data)}function lC(l,i,a,d,f,y,_,S){if(f.width===0||f.height===0)return i;if(f.width>l.width||f.height>l.height||a.x>l.width-f.width||a.y>l.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>i.width||f.height>i.height||d.x>i.width-f.width||d.y>i.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const A=l.data,k=i.data,j=y===4&&S;for(let R=0;R<f.height;R++){const L=((a.y+R)*l.width+a.x)*y,W=((d.y+R)*i.width+d.x)*y;if(j)for(let q=0;q<f.width;q++){const J=L+q*y+3,Q=W+q*y;k[Q+0]=255,k[Q+1]=255,k[Q+2]=255,k[Q+3]=A[J]}else if(_)for(let q=0;q<f.width;q++){const J=L+q*y,Q=W+q*y,oe=new Tn(A[J+0]/255,A[J+1]/255,A[J+2]/255,A[J+3]).toNonPremultipliedRenderColor(_).toArray();k[Q+0]=oe[0],k[Q+1]=oe[1],k[Q+2]=oe[2],k[Q+3]=oe[3]}else for(let q=0;q<f.width*y;q++)k[W+q]=A[L+q]}return i}qt(EN,"HeatmapBucket",{omit:["layers"]});class kd{constructor(i,a){IN(this,i,1,a)}resize(i){MN(this,new kd(i),1)}clone(){return new kd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,d,f,y){lC(i,a,d,f,y,1,null)}}class Ds{constructor(i,a){IN(this,i,4,a)}resize(i){MN(this,new Ds(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,d,f,y,_,S){lC(i,a,d,f,y,4,_,S)}}class ON{constructor(i,a){this.width=i.width,this.height=i.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function L0(l){const i={},a=l.resolution||256,d=l.clips?l.clips.length:1,f=l.image||new Ds({width:a,height:d}),y=(_,S,A)=>{i[l.evaluationKey]=A;const k=l.expression.evaluate(i),j=k?k.toNonPremultipliedRenderColor(null):null;j&&(f.data[_+S+0]=Math.floor(255*j.r),f.data[_+S+1]=Math.floor(255*j.g),f.data[_+S+2]=Math.floor(255*j.b),f.data[_+S+3]=Math.floor(255*j.a))};if(l.clips)for(let _=0,S=0;_<d;++_,S+=4*a)for(let A=0,k=0;A<a;A++,k+=4){const j=A/(a-1),{start:R,end:L}=l.clips[_];y(S,k,R*(1-j)+L*j)}else for(let _=0,S=0;_<a;_++,S+=4)y(0,S,_/(a-1));return f}qt(kd,"AlphaImage"),qt(Ds,"RGBAImage");const $re=Yr([{name:"a_pos",components:2,type:"Int16"}],4),Gre=Yr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Hre=Yr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Wre=Yr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ug(l,i,a=2){const d=i&&i.length,f=d?i[0]*a:l.length;let y=jN(l,0,f,a,!0);const _=[];if(!y||y.next===y.prev)return _;let S,A,k;if(d&&(y=function(j,R,L,W){const q=[];for(let J=0,Q=R.length;J<Q;J++){const oe=jN(j,R[J]*W,J<Q-1?R[J+1]*W:j.length,W,!1);oe===oe.next&&(oe.steiner=!0),q.push(ene(oe))}q.sort(Yre);for(let J=0;J<q.length;J++)L=Jre(q[J],L);return L}(l,i,y,a)),l.length>80*a){S=l[0],A=l[1];let j=S,R=A;for(let L=a;L<f;L+=a){const W=l[L],q=l[L+1];W<S&&(S=W),q<A&&(A=q),W>j&&(j=W),q>R&&(R=q)}k=Math.max(j-S,R-A),k=k!==0?32767/k:0}return z0(y,_,a,S,A,k,0),_}function jN(l,i,a,d,f){let y;if(f===function(_,S,A,k){let j=0;for(let R=S,L=A-k;R<A;R+=k)j+=(_[L]-_[R])*(_[R+1]+_[L+1]),L=R;return j}(l,i,a,d)>0)for(let _=i;_<a;_+=d)y=zN(_/d|0,l[_],l[_+1],y);else for(let _=a-d;_>=i;_-=d)y=zN(_/d|0,l[_],l[_+1],y);return y&&$g(y,y.next)&&(B0(y),y=y.next),y}function xp(l,i){if(!l)return l;i||(i=l);let a,d=l;do if(a=!1,d.steiner||!$g(d,d.next)&&fs(d.prev,d,d.next)!==0)d=d.next;else{if(B0(d),d=i=d.prev,d===d.next)break;a=!0}while(a||d!==i);return i}function z0(l,i,a,d,f,y,_){if(!l)return;!_&&y&&function(A,k,j,R){let L=A;do L.z===0&&(L.z=cC(L.x,L.y,k,j,R)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==A);L.prevZ.nextZ=null,L.prevZ=null,function(W){let q,J=1;do{let Q,oe=W;W=null;let de=null;for(q=0;oe;){q++;let he=oe,fe=0;for(let Ae=0;Ae<J&&(fe++,he=he.nextZ,he);Ae++);let Ie=J;for(;fe>0||Ie>0&&he;)fe!==0&&(Ie===0||!he||oe.z<=he.z)?(Q=oe,oe=oe.nextZ,fe--):(Q=he,he=he.nextZ,Ie--),de?de.nextZ=Q:W=Q,Q.prevZ=de,de=Q;oe=he}de.nextZ=null,J*=2}while(q>1)}(L)}(l,d,f,y);let S=l;for(;l.prev!==l.next;){const A=l.prev,k=l.next;if(y?Zre(l,d,f,y):qre(l))i.push(A.i,l.i,k.i),B0(l),l=k.next,S=k.next;else if((l=k)===S){_?_===1?z0(l=Kre(xp(l),i),i,a,d,f,y,2):_===2&&Xre(l,i,a,d,f,y):z0(xp(l),i,a,d,f,y,1);break}}}function qre(l){const i=l.prev,a=l,d=l.next;if(fs(i,a,d)>=0)return!1;const f=i.x,y=a.x,_=d.x,S=i.y,A=a.y,k=d.y,j=Math.min(f,y,_),R=Math.min(S,A,k),L=Math.max(f,y,_),W=Math.max(S,A,k);let q=d.next;for(;q!==i;){if(q.x>=j&&q.x<=L&&q.y>=R&&q.y<=W&&N0(f,S,y,A,_,k,q.x,q.y)&&fs(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function Zre(l,i,a,d){const f=l.prev,y=l,_=l.next;if(fs(f,y,_)>=0)return!1;const S=f.x,A=y.x,k=_.x,j=f.y,R=y.y,L=_.y,W=Math.min(S,A,k),q=Math.min(j,R,L),J=Math.max(S,A,k),Q=Math.max(j,R,L),oe=cC(W,q,i,a,d),de=cC(J,Q,i,a,d);let he=l.prevZ,fe=l.nextZ;for(;he&&he.z>=oe&&fe&&fe.z<=de;){if(he.x>=W&&he.x<=J&&he.y>=q&&he.y<=Q&&he!==f&&he!==_&&N0(S,j,A,R,k,L,he.x,he.y)&&fs(he.prev,he,he.next)>=0||(he=he.prevZ,fe.x>=W&&fe.x<=J&&fe.y>=q&&fe.y<=Q&&fe!==f&&fe!==_&&N0(S,j,A,R,k,L,fe.x,fe.y)&&fs(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;he&&he.z>=oe;){if(he.x>=W&&he.x<=J&&he.y>=q&&he.y<=Q&&he!==f&&he!==_&&N0(S,j,A,R,k,L,he.x,he.y)&&fs(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;fe&&fe.z<=de;){if(fe.x>=W&&fe.x<=J&&fe.y>=q&&fe.y<=Q&&fe!==f&&fe!==_&&N0(S,j,A,R,k,L,fe.x,fe.y)&&fs(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function Kre(l,i){let a=l;do{const d=a.prev,f=a.next.next;!$g(d,f)&&DN(d,a,a.next,f)&&F0(d,f)&&F0(f,d)&&(i.push(d.i,a.i,f.i),B0(a),B0(a.next),a=l=f),a=a.next}while(a!==l);return xp(a)}function Xre(l,i,a,d,f,y){let _=l;do{let S=_.next.next;for(;S!==_.prev;){if(_.i!==S.i&&tne(_,S)){let A=LN(_,S);return _=xp(_,_.next),A=xp(A,A.next),z0(_,i,a,d,f,y,0),void z0(A,i,a,d,f,y,0)}S=S.next}_=_.next}while(_!==l)}function Yre(l,i){let a=l.x-i.x;return a===0&&(a=l.y-i.y,a===0)&&(a=(l.next.y-l.y)/(l.next.x-l.x)-(i.next.y-i.y)/(i.next.x-i.x)),a}function Jre(l,i){const a=function(f,y){let _=y;const S=f.x,A=f.y;let k,j=-1/0;if($g(f,_))return _;do{if($g(f,_.next))return _.next;if(A<=_.y&&A>=_.next.y&&_.next.y!==_.y){const J=_.x+(A-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(J<=S&&J>j&&(j=J,k=_.x<_.next.x?_:_.next,J===S))return k}_=_.next}while(_!==y);if(!k)return null;const R=k,L=k.x,W=k.y;let q=1/0;_=k;do{if(S>=_.x&&_.x>=L&&S!==_.x&&RN(A<W?S:j,A,L,W,A<W?j:S,A,_.x,_.y)){const J=Math.abs(A-_.y)/(S-_.x);F0(_,f)&&(J<q||J===q&&(_.x>k.x||_.x===k.x&&Qre(k,_)))&&(k=_,q=J)}_=_.next}while(_!==R);return k}(l,i);if(!a)return i;const d=LN(a,l);return xp(d,d.next),xp(a,a.next)}function Qre(l,i){return fs(l.prev,l,i.prev)<0&&fs(i.next,l,l.next)<0}function cC(l,i,a,d,f){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-a)*f|0)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-d)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function ene(l){let i=l,a=l;do(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next;while(i!==l);return a}function RN(l,i,a,d,f,y,_,S){return(f-_)*(i-S)>=(l-_)*(y-S)&&(l-_)*(d-S)>=(a-_)*(i-S)&&(a-_)*(y-S)>=(f-_)*(d-S)}function N0(l,i,a,d,f,y,_,S){return!(l===_&&i===S)&&RN(l,i,a,d,f,y,_,S)}function tne(l,i){return l.next.i!==i.i&&l.prev.i!==i.i&&!function(a,d){let f=a;do{if(f.i!==a.i&&f.next.i!==a.i&&f.i!==d.i&&f.next.i!==d.i&&DN(f,f.next,a,d))return!0;f=f.next}while(f!==a);return!1}(l,i)&&(F0(l,i)&&F0(i,l)&&function(a,d){let f=a,y=!1;const _=(a.x+d.x)/2,S=(a.y+d.y)/2;do f.y>S!=f.next.y>S&&f.next.y!==f.y&&_<(f.next.x-f.x)*(S-f.y)/(f.next.y-f.y)+f.x&&(y=!y),f=f.next;while(f!==a);return y}(l,i)&&(fs(l.prev,l,i.prev)||fs(l,i.prev,i))||$g(l,i)&&fs(l.prev,l,l.next)>0&&fs(i.prev,i,i.next)>0)}function fs(l,i,a){return(i.y-l.y)*(a.x-i.x)-(i.x-l.x)*(a.y-i.y)}function $g(l,i){return l.x===i.x&&l.y===i.y}function DN(l,i,a,d){const f=SS(fs(l,i,a)),y=SS(fs(l,i,d)),_=SS(fs(a,d,l)),S=SS(fs(a,d,i));return f!==y&&_!==S||!(f!==0||!wS(l,a,i))||!(y!==0||!wS(l,d,i))||!(_!==0||!wS(a,l,d))||!(S!==0||!wS(a,i,d))}function wS(l,i,a){return i.x<=Math.max(l.x,a.x)&&i.x>=Math.min(l.x,a.x)&&i.y<=Math.max(l.y,a.y)&&i.y>=Math.min(l.y,a.y)}function SS(l){return l>0?1:l<0?-1:0}function F0(l,i){return fs(l.prev,l,l.next)<0?fs(l,i,l.next)>=0&&fs(l,l.prev,i)>=0:fs(l,i,l.prev)<0||fs(l,l.next,i)<0}function LN(l,i){const a=uC(l.i,l.x,l.y),d=uC(i.i,i.x,i.y),f=l.next,y=i.prev;return l.next=i,i.prev=l,a.next=f,f.prev=a,d.next=a,a.prev=d,y.next=d,d.prev=y,d}function zN(l,i,a,d){const f=uC(l,i,a);return d?(f.next=d.next,f.prev=d,d.next.prev=f,d.next=f):(f.prev=f,f.next=f),f}function B0(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function uC(l,i,a){return{i:l,x:i,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function V0(l,i){const a=l.length;if(a<=1)return[l];const d=[];let f,y;for(let _=0;_<a;_++){const S=ts(l[_]);S!==0&&(l[_].area=Math.abs(S),y===void 0&&(y=S<0),y===S<0?(f&&d.push(f),f=[l[_]]):f.push(l[_]))}if(f&&d.push(f),i>1)for(let _=0;_<d.length;_++)d[_].length<=i||(Ws(d[_],i,1,d[_].length-1,rne),d[_]=d[_].slice(0,i));return d}function rne(l,i){return i.area-l.area}function NN(l,i,a=1){if(!l)return null;const d=typeof l=="string"?ko.from(l).getPrimary():l.getPrimary(),f=typeof l=="string"?null:l.getSecondary();for(const y of[d,f]){if(!y)continue;const _=y.id.toString();i.has(_)||i.set(_,[]),y.scaleSelf(a),i.get(_).push(y)}return{primary:d.toString(),secondary:f?f.toString():null}}function hC(l,i,a,d){const f=d.patternDependencies;let y=!1;for(const _ of i){const S=_.paint.get(`${l}-pattern`);S.isConstant()||(y=!0),NN(S.constantOr(null),f,a)&&(y=!0)}return y}function dC(l,i,a,d,f,y){const _=y.patternDependencies;for(const S of i){const A=S.paint.get(`${l}-pattern`).value;if(A.kind!=="constant"){let k=A.evaluate({zoom:d},a,{},y.availableImages);k=k&&k.name?k.name:k;const j=NN(k,_,f);if(!j)continue;const{primary:R,secondary:L}=j;R&&(a.patterns[S.id]=[R,L].filter(Boolean))}}return a}class FN{constructor(){this.polygons=new Map}add(i,...a){this.polygons.has(i)?this.polygons.get(i).push(...a):this.polygons.set(i,a)}merge(i){for(const[a,d]of i.polygons)this.add(a,...d)}}class bp{constructor(){this.portals=[]}static evaluate(i){if(i.length===0)return new bp;let a=[];for(const k of i)a.push(...k.portals);if(a.length===0)return new bp;const d=(k,j)=>k<=0&&j<=0||k>=Dt&&j>=Dt;for(const k of a){const j=k.va,R=k.vb;(d(j.x,R.x)||d(j.y,R.y))&&(k.type="border")}const f=a.filter(k=>k.type!=="unevaluated"),y=a.filter(k=>k.type==="unevaluated");if(y.length===0)return new bp;y.sort((k,j)=>k.hash===j.hash?k.isTunnel===j.isTunnel?0:k.isTunnel?-1:1:k.hash<j.hash?1:-1),a=f.concat(y);let _=f.length,S=_,A=_;do if(S++,S===a.length||a[_].hash!==a[S].hash){if(S-_==2){A<_&&(a[A]=a[_],a[_]=null);const k=a[A],j=a[S-1];k.type=k.isTunnel!==j.isTunnel?"tunnel":"polygon",k.connection={a:k.connection.a,b:j.connection.a},A++}_=S}while(_!==a.length);return a.splice(A),a.sort((k,j)=>k.hash<j.hash?1:-1),{portals:a}}}qt(bp,"ElevationPortalGraph"),qt(FN,"ElevationPolygons");class nne{constructor(i,a,d){this.outPositions=i,this.outNormals=a,this.outIndices=d,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(i,a,d){let f=i[2];d!=null&&(f*=d);const y=this.getVec3Bits(i)<<96n|this.getVec3Bits(a),_=this.vertexLookup.get(y);if(_!=null)return _;const S=this.outPositions.length;this.vertexLookup.set(y,S);const A=Math.trunc(16384*a[0]),k=Math.trunc(16384*a[1]),j=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(i[0],i[1],f),this.outNormals.emplaceBack(A,k,j),S}addTriangle(i,a,d){this.outIndices.emplaceBack(i,a,d)}addTriangles(i,a,d){if(i.length===0)return;const f=d.length===1,y=Pe(),_=Pe();for(let S=0;S<i.length;S+=3){const A=a[i[S+0]],k=a[i[S+1]],j=a[i[S+2]],R=f?d[0]:d[i[S+1]],L=f?d[0]:d[i[S+2]];tt(y,A.x,A.y,f?d[0]:d[i[S+0]]);const W=this.addVertex(y,_);tt(y,k.x,k.y,R);const q=this.addVertex(y,_);tt(y,j.x,j.y,L);const J=this.addVertex(y,_);this.outIndices.emplaceBack(W,q,J)}}addQuad(i,a,d,f,y,_){const S=this.addVertex(i,y,_),A=this.addVertex(a,y,_),k=this.addVertex(d,y,_),j=this.addVertex(f,y,_);this.addTriangle(S,A,k),this.addTriangle(k,j,S)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(i){return this.view.setFloat32(0,i),BigInt(this.view.getUint32(0))}getVec3Bits(i){return this.getBits(i[0])<<64n|this.getBits(i[1])<<32n|this.getBits(i[2])}}class ua{constructor(i,a,d,f){this.unevaluatedPortals=new bp,this.portalPolygons=new FN,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new g0,this.vertexNormals=new y0,this.indexArray=new ii,this.tileToMeters=Ee(i),this.bridgeProgramConfigurations=new la(a,{zoom:d,lut:f},y=>y!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new la(a,{zoom:d,lut:f},y=>y!=="fill-bridge-guard-rail-color")}addVertices(i,a){const d=this.unevalVertices.length;for(let f=0;f<i.length;f++)this.unevalVertices.push(i[f]),this.unevalHeights.push(a[f]);return d}addTriangles(i,a,d){const f=d?this.unevalTunnelTriangles:this.unevalTriangles;for(const y of i)f.push(y+a)}addRenderableRing(i,a,d,f,y,_){const S=[new ut(y.min.x,y.min.y),new ut(y.max.x,y.min.y),new ut(y.max.x,y.max.y),new ut(y.min.x,y.max.y)];for(let A=0;A<d-1;A++){const k=a+A,j=k+1,R=this.unevalVertices[k],L=this.unevalVertices[j];if(!(R.x>=y.min.x&&R.x<=y.max.x&&R.y>=y.min.y&&R.y<=y.max.y||L.x>=y.min.x&&L.x<=y.max.x&&L.y>=y.min.y&&L.y<=y.max.y||Un(R,L,S))||this.isOnBorder(R.x,L.x)||this.isOnBorder(R.y,L.y))continue;const W=ua.computeEdgeHash(this.unevalVertices[k],this.unevalVertices[j]);let q,J=this.vertexHashLookup.get(ua.computePosHash(R));J!=null?q=J.next:(J=this.vertexHashLookup.get(ua.computePosHash(L)),q=J!=null?J.prev:W),this.unevalEdges.push({polygonIdx:i,a:k,b:j,hash:W,portalHash:q,isTunnel:f,type:"unevaluated",featureInfo:_})}}addPortalCandidates(i,a,d,f,y){if(a.length===0)return;this.portalPolygons.add(i,{geometry:a,zLevel:y});const _=a[0];this.vertexHashLookup.clear();let S=ua.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let A=0;A<_.length-1;A++){const k=_[A+0],j=_[A+1],R=oo(j.x-k.x,j.y-k.y),L=So(R);if(L===0)continue;let W="unevaluated";const q=f.pointElevation(k),J=f.pointElevation(j);Math.abs(q)<.01&&Math.abs(J)<.01?W="entrance":(this.isOnBorder(k.x,j.x)||this.isOnBorder(k.y,j.y))&&(W="border");const Q=ua.computeEdgeHash(k,j);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:k,vb:j,vab:R,length:L,hash:Q,isTunnel:d,type:W});const oe=ua.computePosHash(k);this.vertexHashLookup.set(oe,{prev:S,next:Q}),S=Q}}construct(i){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),d=L=>{L.primitiveLength=this.indexArray.length-L.primitiveOffset},f=new nne(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const y=a(),_=a(),S=a(),A=(L,W)=>{L.sort((J,Q)=>J.type===W&&Q.type!==W?-1:J.type!==W&&Q.type===W?1:0);const q=L.findIndex(J=>J.type!==W);return q>=0?q:L.length};let k=0;this.unevalEdges.length>0&&(k=A(this.unevalEdges,"none"),this.constructBridgeStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},this.tileToMeters)),d(S);const j=a(),R=a();if(this.unevalEdges.length>0){const L=this.unevalEdges.splice(k),W=A(L,"tunnel")+k;this.unevalEdges.push(...L),this.constructTunnelStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},{min:k,max:W})}d(j),f.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),d(R),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),d(_),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),d(y),this.maskSegments=ui.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.depthSegments=ui.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=ui.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.renderableTunnelSegments=ui.simpleSegment(0,j.primitiveOffset,0,j.primitiveLength),this.shadowCasterSegments=ui.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength)}update(i,a,d,f,y,_,S,A){this.bridgeProgramConfigurations.updatePaintArrays(i,a,y,d,f,_,S,A),this.tunnelProgramConfigurations.updatePaintArrays(i,a,y,d,f,_,S,A)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,Hre.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,Wre.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,a,d,f,y){const _=(S,A)=>{for(let k=0;k<A.length-1;k++){const j=A[k].featureIndex,R=A[k+1].vertexStart,L=i.feature(j);S.populatePaintArrays(R,L,j,{},d,a,f,void 0,y)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,a,d,f,y){const _=new Map;for(let S=f;S<y;S++){const A=d[S],k=A.a,j=A.b,R=ua.computePosHash(i[k]),L=ua.computePosHash(i[j]);let W=_.get(R);W||(W={},_.set(R,W));let q=_.get(L);q||(q={},_.set(L,q)),a[k]<=0&&a[j]<=0||(W.to=j,q.from=k)}return _}isTerminalVertex(i,a){const d=ua.computePosHash(this.unevalVertices[i]),f=a.get(d);return!f||!f.from||!f.to}constructBridgeStructures(i,a,d,f,y,_){i.clearVertexLookup();const S=this.computeVertexConnections(a,d,f,y.min,y.max),A=1/_,k=.5*A,j=(At,kt)=>tt(At,a[kt].x,a[kt].y,d[kt]*A),R=Pe(),L=Pe(),W=Pe(),q=Pe(),J=Pe(),Q=(At,kt)=>{const it=S.get(ua.computePosHash(a[kt])),Tt=it.from,Xe=it.to;if(!Tt||!Xe)return;j(R,Tt),j(L,kt),j(W,Xe),Nn(q),Jr(R,L)||(Kr(J,L,R),Er(q,J)),Jr(W,L)||(Kr(J,W,L),We(q,q,Er(J,J)));const ot=Fi(q);return ot>0?mt(At,q,1/ot):void 0};let oe=Number.POSITIVE_INFINITY;this.sortSubarray(f,y.min,y.max,(At,kt)=>At.featureInfo.featureIndex-kt.featureInfo.featureIndex);const de=Pe(),he=Pe(),fe=Pe(),Ie=Pe(),Ae=Pe(),ke=Pe(),Le=Pe(),Be=Pe(),at=Pe(),Ge=[Pe(),Pe(),Pe(),Pe()],ft=[Pe(),Pe(),Pe(),Pe()],wt=[{coord:new ut(0,0),height:0},{coord:new ut(0,0),height:0}],xt=(At,kt)=>At>kt;for(let At=y.min;At<y.max;At++){const kt=f[At];if(!kt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(wt,a,d,kt,xt))continue;const[it,Tt]=wt;if(tt(de,it.coord.x,it.coord.y,A*it.height),tt(he,Tt.coord.x,Tt.coord.y,A*Tt.height),Jr(de,he))continue;Kr(fe,he,de),Er(fe,fe);const Xe=Q(Be,kt.a)||fe,ot=Q(at,kt.b)||fe;tt(Ie,Xe[1],-Xe[0],0),Er(Ie,Ie),tt(Ae,ot[1],-ot[0],0),Er(Ae,Ae),br(Be,Ie,Xe),Er(ke,Be),br(Be,Ae,ot),Er(Le,Be),We(Ge[0],de,mt(Be,Kr(Be,Ie,ke),k)),We(Ge[1],de,mt(Be,We(Be,Ie,ke),k)),We(Ge[2],de,mt(Be,ke,k)),Ge[3]=de,We(ft[0],he,mt(Be,Kr(Be,Ae,Le),k)),We(ft[1],he,mt(Be,We(Be,Ae,Le),k)),We(ft[2],he,mt(Be,Le,k)),ft[3]=he,oe=this.addFeatureSection(kt.featureInfo.featureIndex,oe,this.bridgeFeatureSections,i);const It=i.addVertex(Ge[0],Ie,_),St=i.addVertex(Ge[1],Ie,_),or=i.addVertex(ft[0],Ae,_),Kt=i.addVertex(ft[1],Ae,_);i.addTriangle(It,St,or),i.addTriangle(St,Kt,or);const _t=i.addVertex(Ge[1],ke,_),Ct=i.addVertex(Ge[2],ke,_),rr=i.addVertex(ft[1],Le,_),Bt=i.addVertex(ft[2],Le,_);i.addTriangle(_t,Ct,rr),i.addTriangle(Ct,Bt,rr),tn(Ie,Ie),tn(Ae,Ae);const Nt=i.addVertex(Ge[2],Ie,_),Ht=i.addVertex(Ge[3],Ie,_),pr=i.addVertex(ft[2],Ae,_),gr=i.addVertex(ft[3],Ae,_);i.addTriangle(Nt,Ht,pr),i.addTriangle(Ht,gr,pr);const Cr=this.isTerminalVertex(kt.a,S),Ar=this.isTerminalVertex(kt.b,S);it.height<.01&&Cr&&i.addQuad(Ge[3],Ge[2],Ge[1],Ge[0],tn(Xe,Xe),_),Tt.height<.01&&Ar&&i.addQuad(ft[0],ft[1],ft[2],ft[3],ot,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,a,d,f,y,_){i.clearVertexLookup();let S=Number.POSITIVE_INFINITY;const A=(oe,de)=>oe.featureInfo.featureIndex-de.featureInfo.featureIndex;this.sortSubarray(f,y.min,y.max,A),this.sortSubarray(f,_.min,_.max,A);const k=oe=>Er(oe,oe),j=[{coord:new ut(0,0),height:0},{coord:new ut(0,0),height:0}],R=(oe,de)=>oe<de,L=Pe(),W=Pe(),q=Pe(),J=Pe(),Q=Pe();for(let oe=y.min;oe<y.max;oe++){if(!this.prepareEdgePoints(j,a,d,f[oe],R))continue;const[de,he]=j,fe=k(tt(Q,-(he.coord.y-de.coord.y),he.coord.x-de.coord.x,0));S=this.addFeatureSection(f[oe].featureInfo.featureIndex,S,this.tunnelFeatureSections,i),i.addQuad(tt(L,de.coord.x,de.coord.y,de.height),tt(W,he.coord.x,he.coord.y,he.height),tt(q,he.coord.x,he.coord.y,f[oe].isTunnel?-.1:0),tt(J,de.coord.x,de.coord.y,f[oe].isTunnel?-.1:0),fe)}for(let oe=_.min;oe<_.max;oe++){const de=f[oe];de.isTunnel&&([de.a,de.b]=[de.b,de.a]);const he=a[de.a],fe=a[de.b],Ie=k(tt(Q,-(fe.y-he.y),fe.x-he.x,0));S=this.addFeatureSection(de.featureInfo.featureIndex,S,this.tunnelFeatureSections,i),i.addQuad(tt(L,fe.x,fe.y,0),tt(W,he.x,he.y,0),tt(q,he.x,he.y,d[de.a]+4),tt(J,fe.x,fe.y,d[de.b]+4),Ie),i.addQuad(tt(L,he.x,he.y,0),tt(W,fe.x,fe.y,0),tt(q,fe.x,fe.y,d[de.b]+4),tt(J,he.x,he.y,d[de.a]+4),Ie)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,a,d,f){i.coord.x=a,i.coord.y=d,i.height=f}prepareEdgePoints(i,a,d,f,y){let _=a[f.a].x,S=a[f.a].y,A=a[f.b].x,k=a[f.b].y,j=d[f.a],R=d[f.b];const L=y(j,0),W=y(R,0);if(L&&W)return this.setElevatedPoint(i[0],_,S,j),this.setElevatedPoint(i[1],A,k,R),!0;if(!L&&!W)return!1;if(L){if(!W){const q=R/(R-j);A=lr(A,_,q),k=lr(k,S,q),R=lr(R,j,q)}}else{const q=j/(j-R);_=lr(_,A,q),S=lr(S,k,q),j=lr(j,R,q)}return this.setElevatedPoint(i[0],_,S,j),this.setElevatedPoint(i[1],A,k,R),!0}prepareEdges(i,a){if(a.length===0)return;a.sort((S,A)=>S.hash===A.hash?A.polygonIdx-S.polygonIdx:A.hash>S.hash?1:-1);let d=0,f=0,y=0,_=a[d].polygonIdx;do f++,(f===a.length||a[d].hash!==a[f].hash)&&((f-d==1||a[f-1].polygonIdx!==_)&&(y<d&&(a[y]=a[d],a[d]=null),a[y].type="none",y++),d=f,d!==a.length&&(_=a[d].polygonIdx));while(d!==a.length);if(a.splice(y),a.length!==0&&i.length!==0){a.sort((k,j)=>k.portalHash<j.portalHash?1:-1);let S=0,A=0;for(;S!==a.length&&A!==i.length;){const k=a[S],j=i[A];k.portalHash>j.hash?S++:j.hash>k.portalHash?A++:(k.type=j.type,S++)}}}isOnBorder(i,a){return i<=0&&a<=0||i>=Dt&&a>=Dt}addFeatureSection(i,a,d,f){return i!==a&&(a=i,d.push({featureIndex:i,vertexStart:f.getVertexCount()}),f.clearVertexLookup()),a}sortSubarray(i,a,d,f){const y=i.slice(a,d);y.sort(f),i.splice(a,y.length,...y)}static computeEdgeHash(i,a){return(i.y===a.y&&i.x>a.x||i.y>a.y)&&([i,a]=[a,i]),BigInt(ua.computePosHash(i))<<32n|BigInt(ua.computePosHash(a))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}var BN,VN={exports:{}},UN=(BN||(BN=1,function(l,i){(function(a){function d(_e,ve){return _e>ve?1:_e<ve?-1:0}var f=function(_e,ve){_e===void 0&&(_e=d),ve===void 0&&(ve=!1),this._compare=_e,this._root=null,this._size=0,this._noDuplicates=!!ve},y={size:{configurable:!0}};function _(_e,ve,st,Rt,zt){var Lt=zt-Rt;if(Lt>0){var Jt=Rt+Math.floor(Lt/2),yr={key:ve[Jt],data:st[Jt],parent:_e};return yr.left=_(yr,ve,st,Rt,Jt),yr.right=_(yr,ve,st,Jt+1,zt),yr}return null}function S(_e,ve,st,Rt,zt){if(!(st>=Rt)){for(var Lt=_e[st+Rt>>1],Jt=st-1,yr=Rt+1;;){do Jt++;while(zt(_e[Jt],Lt)<0);do yr--;while(zt(_e[yr],Lt)>0);if(Jt>=yr)break;var Ur=_e[Jt];_e[Jt]=_e[yr],_e[yr]=Ur,Ur=ve[Jt],ve[Jt]=ve[yr],ve[yr]=Ur}S(_e,ve,st,yr,zt),S(_e,ve,yr+1,Rt,zt)}}f.prototype.rotateLeft=function(_e){var ve=_e.right;ve&&(_e.right=ve.left,ve.left&&(ve.left.parent=_e),ve.parent=_e.parent),_e.parent?_e===_e.parent.left?_e.parent.left=ve:_e.parent.right=ve:this._root=ve,ve&&(ve.left=_e),_e.parent=ve},f.prototype.rotateRight=function(_e){var ve=_e.left;ve&&(_e.left=ve.right,ve.right&&(ve.right.parent=_e),ve.parent=_e.parent),_e.parent?_e===_e.parent.left?_e.parent.left=ve:_e.parent.right=ve:this._root=ve,ve&&(ve.right=_e),_e.parent=ve},f.prototype._splay=function(_e){for(;_e.parent;){var ve=_e.parent;ve.parent?ve.left===_e&&ve.parent.left===ve?(this.rotateRight(ve.parent),this.rotateRight(ve)):ve.right===_e&&ve.parent.right===ve?(this.rotateLeft(ve.parent),this.rotateLeft(ve)):ve.left===_e&&ve.parent.right===ve?(this.rotateRight(ve),this.rotateLeft(ve)):(this.rotateLeft(ve),this.rotateRight(ve)):ve.left===_e?this.rotateRight(ve):this.rotateLeft(ve)}},f.prototype.splay=function(_e){for(var ve,st,Rt,zt,Lt;_e.parent;)(st=(ve=_e.parent).parent)&&st.parent?((Rt=st.parent).left===st?Rt.left=_e:Rt.right=_e,_e.parent=Rt):(_e.parent=null,this._root=_e),zt=_e.left,Lt=_e.right,_e===ve.left?(st&&(st.left===ve?(ve.right?(st.left=ve.right,st.left.parent=st):st.left=null,ve.right=st,st.parent=ve):(zt?(st.right=zt,zt.parent=st):st.right=null,_e.left=st,st.parent=_e)),Lt?(ve.left=Lt,Lt.parent=ve):ve.left=null,_e.right=ve,ve.parent=_e):(st&&(st.right===ve?(ve.left?(st.right=ve.left,st.right.parent=st):st.right=null,ve.left=st,st.parent=ve):(Lt?(st.left=Lt,Lt.parent=st):st.left=null,_e.right=st,st.parent=_e)),zt?(ve.right=zt,zt.parent=ve):ve.right=null,_e.left=ve,ve.parent=_e)},f.prototype.replace=function(_e,ve){_e.parent?_e===_e.parent.left?_e.parent.left=ve:_e.parent.right=ve:this._root=ve,ve&&(ve.parent=_e.parent)},f.prototype.minNode=function(_e){if(_e===void 0&&(_e=this._root),_e)for(;_e.left;)_e=_e.left;return _e},f.prototype.maxNode=function(_e){if(_e===void 0&&(_e=this._root),_e)for(;_e.right;)_e=_e.right;return _e},f.prototype.insert=function(_e,ve){var st=this._root,Rt=null,zt=this._compare;if(this._noDuplicates)for(;st;){if(Rt=st,zt(st.key,_e)===0)return;st=zt(st.key,_e)<0?st.right:st.left}else for(;st;)Rt=st,st=zt(st.key,_e)<0?st.right:st.left;return st={key:_e,data:ve,left:null,right:null,parent:Rt},Rt?zt(Rt.key,st.key)<0?Rt.right=st:Rt.left=st:this._root=st,this.splay(st),this._size++,st},f.prototype.find=function(_e){for(var ve=this._root,st=this._compare;ve;){var Rt=st(ve.key,_e);if(Rt<0)ve=ve.right;else{if(!(Rt>0))return ve;ve=ve.left}}return null},f.prototype.contains=function(_e){for(var ve=this._root,st=this._compare;ve;){var Rt=st(_e,ve.key);if(Rt===0)return!0;ve=Rt<0?ve.left:ve.right}return!1},f.prototype.remove=function(_e){var ve=this.find(_e);if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var st=this.minNode(ve.right);st.parent!==ve&&(this.replace(st,st.right),st.right=ve.right,st.right.parent=st),this.replace(ve,st),st.left=ve.left,st.left.parent=st}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},f.prototype.removeNode=function(_e){if(!_e)return!1;if(this.splay(_e),_e.left)if(_e.right){var ve=this.minNode(_e.right);ve.parent!==_e&&(this.replace(ve,ve.right),ve.right=_e.right,ve.right.parent=ve),this.replace(_e,ve),ve.left=_e.left,ve.left.parent=ve}else this.replace(_e,_e.left);else this.replace(_e,_e.right);return this._size--,!0},f.prototype.erase=function(_e){var ve=this.find(_e);if(ve){this.splay(ve);var st=ve.left,Rt=ve.right,zt=null;st&&(st.parent=null,zt=this.maxNode(st),this.splay(zt),this._root=zt),Rt&&(st?zt.right=Rt:this._root=Rt,Rt.parent=zt),this._size--}},f.prototype.pop=function(){var _e=this._root,ve=null;if(_e){for(;_e.left;)_e=_e.left;ve={key:_e.key,data:_e.data},this.remove(_e.key)}return ve},f.prototype.next=function(_e){var ve=_e;if(ve)if(ve.right)for(ve=ve.right;ve&&ve.left;)ve=ve.left;else for(ve=_e.parent;ve&&ve.right===_e;)_e=ve,ve=ve.parent;return ve},f.prototype.prev=function(_e){var ve=_e;if(ve)if(ve.left)for(ve=ve.left;ve&&ve.right;)ve=ve.right;else for(ve=_e.parent;ve&&ve.left===_e;)_e=ve,ve=ve.parent;return ve},f.prototype.forEach=function(_e){for(var ve=this._root,st=[],Rt=!1,zt=0;!Rt;)ve?(st.push(ve),ve=ve.left):st.length>0?(_e(ve=st.pop(),zt++),ve=ve.right):Rt=!0;return this},f.prototype.range=function(_e,ve,st,Rt){for(var zt=[],Lt=this._compare,Jt=this._root;zt.length!==0||Jt;)if(Jt)zt.push(Jt),Jt=Jt.left;else{if(Lt((Jt=zt.pop()).key,ve)>0)break;if(Lt(Jt.key,_e)>=0&&st.call(Rt,Jt))return this;Jt=Jt.right}return this},f.prototype.keys=function(){for(var _e=this._root,ve=[],st=[],Rt=!1;!Rt;)_e?(ve.push(_e),_e=_e.left):ve.length>0?(_e=ve.pop(),st.push(_e.key),_e=_e.right):Rt=!0;return st},f.prototype.values=function(){for(var _e=this._root,ve=[],st=[],Rt=!1;!Rt;)_e?(ve.push(_e),_e=_e.left):ve.length>0?(_e=ve.pop(),st.push(_e.data),_e=_e.right):Rt=!0;return st},f.prototype.at=function(_e){for(var ve=this._root,st=[],Rt=!1,zt=0;!Rt;)if(ve)st.push(ve),ve=ve.left;else if(st.length>0){if(ve=st.pop(),zt===_e)return ve;zt++,ve=ve.right}else Rt=!0;return null},f.prototype.load=function(_e,ve,st){if(_e===void 0&&(_e=[]),ve===void 0&&(ve=[]),st===void 0&&(st=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Rt=_e.length;return st&&S(_e,ve,0,Rt-1,this._compare),this._root=_(null,_e,ve,0,Rt),this._size=Rt,this},f.prototype.min=function(){var _e=this.minNode(this._root);return _e?_e.key:null},f.prototype.max=function(){var _e=this.maxNode(this._root);return _e?_e.key:null},f.prototype.isEmpty=function(){return this._root===null},y.size.get=function(){return this._size},f.createTree=function(_e,ve,st,Rt,zt){return new f(st,zt).load(_e,ve,Rt)},Object.defineProperties(f.prototype,y);var A=0,k=1,j=2,R=3,L=0,W=1,q=2,J=3;function Q(_e,ve,st){ve===null?(_e.inOut=!1,_e.otherInOut=!0):(_e.isSubject===ve.isSubject?(_e.inOut=!ve.inOut,_e.otherInOut=ve.otherInOut):(_e.inOut=!ve.otherInOut,_e.otherInOut=ve.isVertical()?!ve.inOut:ve.inOut),ve&&(_e.prevInResult=!oe(ve,st)||ve.isVertical()?ve.prevInResult:ve));var Rt=oe(_e,st);_e.resultTransition=Rt?function(zt,Lt){var Jt,yr=!zt.inOut,Ur=!zt.otherInOut;switch(Lt){case L:Jt=yr&&Ur;break;case W:Jt=yr||Ur;break;case J:Jt=yr^Ur;break;case q:Jt=zt.isSubject?yr&&!Ur:Ur&&!yr}return Jt?1:-1}(_e,st):0}function oe(_e,ve){switch(_e.type){case A:switch(ve){case L:return!_e.otherInOut;case W:return _e.otherInOut;case q:return _e.isSubject&&_e.otherInOut||!_e.isSubject&&!_e.otherInOut;case J:return!0}break;case j:return ve===L||ve===W;case R:return ve===q;case k:return!1}return!1}var de=function(_e,ve,st,Rt,zt){this.left=ve,this.point=_e,this.otherEvent=st,this.isSubject=Rt,this.type=zt||A,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},he={inResult:{configurable:!0}};function fe(_e,ve){return _e[0]===ve[0]&&_e[1]===ve[1]}de.prototype.isBelow=function(_e){var ve=this.point,st=this.otherEvent.point;return this.left?(ve[0]-_e[0])*(st[1]-_e[1])-(st[0]-_e[0])*(ve[1]-_e[1])>0:(st[0]-_e[0])*(ve[1]-_e[1])-(ve[0]-_e[0])*(st[1]-_e[1])>0},de.prototype.isAbove=function(_e){return!this.isBelow(_e)},de.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},he.inResult.get=function(){return this.resultTransition!==0},de.prototype.clone=function(){var _e=new de(this.point,this.left,this.otherEvent,this.isSubject,this.type);return _e.contourId=this.contourId,_e.resultTransition=this.resultTransition,_e.prevInResult=this.prevInResult,_e.isExteriorRing=this.isExteriorRing,_e.inOut=this.inOut,_e.otherInOut=this.otherInOut,_e},Object.defineProperties(de.prototype,he);var Ie=11102230246251565e-32,Ae=134217729,ke=(3+8*Ie)*Ie;function Le(_e,ve,st,Rt,zt){var Lt,Jt,yr,Ur,$r=ve[0],jr=Rt[0],jn=0,gi=0;jr>$r==jr>-$r?(Lt=$r,$r=ve[++jn]):(Lt=jr,jr=Rt[++gi]);var Mr=0;if(jn<_e&&gi<st)for(jr>$r==jr>-$r?(yr=Lt-((Jt=$r+Lt)-$r),$r=ve[++jn]):(yr=Lt-((Jt=jr+Lt)-jr),jr=Rt[++gi]),Lt=Jt,yr!==0&&(zt[Mr++]=yr);jn<_e&&gi<st;)jr>$r==jr>-$r?(yr=Lt-((Jt=Lt+$r)-(Ur=Jt-Lt))+($r-Ur),$r=ve[++jn]):(yr=Lt-((Jt=Lt+jr)-(Ur=Jt-Lt))+(jr-Ur),jr=Rt[++gi]),Lt=Jt,yr!==0&&(zt[Mr++]=yr);for(;jn<_e;)yr=Lt-((Jt=Lt+$r)-(Ur=Jt-Lt))+($r-Ur),$r=ve[++jn],Lt=Jt,yr!==0&&(zt[Mr++]=yr);for(;gi<st;)yr=Lt-((Jt=Lt+jr)-(Ur=Jt-Lt))+(jr-Ur),jr=Rt[++gi],Lt=Jt,yr!==0&&(zt[Mr++]=yr);return Lt===0&&Mr!==0||(zt[Mr++]=Lt),Mr}function Be(_e){return new Float64Array(_e)}var at=33306690738754716e-32,Ge=22204460492503146e-32,ft=11093356479670487e-47,wt=Be(4),xt=Be(8),At=Be(12),kt=Be(16),it=Be(4);function Tt(_e,ve,st){var Rt=function(zt,Lt,Jt,yr,Ur,$r){var jr=(Lt-$r)*(Jt-Ur),jn=(zt-Ur)*(yr-$r),gi=jr-jn;if(jr===0||jn===0||jr>0!=jn>0)return gi;var Mr=Math.abs(jr+jn);return Math.abs(gi)>=at*Mr?gi:-function(ti,$n,An,di,Jn,Gn,Xn){var In,Rr,Rn,fi,dr,nn,Qn,vi,ri,Ki,zn,Gi,Ho,Ls,Is,Wo,su,Xi,us=ti-Jn,zs=An-Jn,mo=$n-Gn,Xs=di-Gn;wt[0]=(Is=(vi=us-(Qn=(nn=Ae*us)-(nn-us)))*(Ki=Xs-(ri=(nn=Ae*Xs)-(nn-Xs)))-((Ls=us*Xs)-Qn*ri-vi*ri-Qn*Ki))-((zn=Is-(su=(vi=mo-(Qn=(nn=Ae*mo)-(nn-mo)))*(Ki=zs-(ri=(nn=Ae*zs)-(nn-zs)))-((Wo=mo*zs)-Qn*ri-vi*ri-Qn*Ki)))+(dr=Is-zn))+(dr-su),wt[1]=(Ho=Ls-((Gi=Ls+zn)-(dr=Gi-Ls))+(zn-dr))-((zn=Ho-Wo)+(dr=Ho-zn))+(dr-Wo),wt[2]=Gi-((Xi=Gi+zn)-(dr=Xi-Gi))+(zn-dr),wt[3]=Xi;var iy=function(YHe,e4){for(var t4=e4[0],yI=1;yI<4;yI++)t4+=e4[yI];return t4}(0,wt),yx=Ge*Xn;if(iy>=yx||-iy>=yx||(In=ti-(us+(dr=ti-us))+(dr-Jn),Rn=An-(zs+(dr=An-zs))+(dr-Jn),Rr=$n-(mo+(dr=$n-mo))+(dr-Gn),fi=di-(Xs+(dr=di-Xs))+(dr-Gn),In===0&&Rr===0&&Rn===0&&fi===0)||(yx=ft*Xn+ke*Math.abs(iy),(iy+=us*fi+Xs*In-(mo*Rn+zs*Rr))>=yx||-iy>=yx))return iy;it[0]=(Is=(vi=In-(Qn=(nn=Ae*In)-(nn-In)))*(Ki=Xs-(ri=(nn=Ae*Xs)-(nn-Xs)))-((Ls=In*Xs)-Qn*ri-vi*ri-Qn*Ki))-((zn=Is-(su=(vi=Rr-(Qn=(nn=Ae*Rr)-(nn-Rr)))*(Ki=zs-(ri=(nn=Ae*zs)-(nn-zs)))-((Wo=Rr*zs)-Qn*ri-vi*ri-Qn*Ki)))+(dr=Is-zn))+(dr-su),it[1]=(Ho=Ls-((Gi=Ls+zn)-(dr=Gi-Ls))+(zn-dr))-((zn=Ho-Wo)+(dr=Ho-zn))+(dr-Wo),it[2]=Gi-((Xi=Gi+zn)-(dr=Xi-Gi))+(zn-dr),it[3]=Xi;var ioe=Le(4,wt,4,it,xt);it[0]=(Is=(vi=us-(Qn=(nn=Ae*us)-(nn-us)))*(Ki=fi-(ri=(nn=Ae*fi)-(nn-fi)))-((Ls=us*fi)-Qn*ri-vi*ri-Qn*Ki))-((zn=Is-(su=(vi=mo-(Qn=(nn=Ae*mo)-(nn-mo)))*(Ki=Rn-(ri=(nn=Ae*Rn)-(nn-Rn)))-((Wo=mo*Rn)-Qn*ri-vi*ri-Qn*Ki)))+(dr=Is-zn))+(dr-su),it[1]=(Ho=Ls-((Gi=Ls+zn)-(dr=Gi-Ls))+(zn-dr))-((zn=Ho-Wo)+(dr=Ho-zn))+(dr-Wo),it[2]=Gi-((Xi=Gi+zn)-(dr=Xi-Gi))+(zn-dr),it[3]=Xi;var soe=Le(ioe,xt,4,it,At);it[0]=(Is=(vi=In-(Qn=(nn=Ae*In)-(nn-In)))*(Ki=fi-(ri=(nn=Ae*fi)-(nn-fi)))-((Ls=In*fi)-Qn*ri-vi*ri-Qn*Ki))-((zn=Is-(su=(vi=Rr-(Qn=(nn=Ae*Rr)-(nn-Rr)))*(Ki=Rn-(ri=(nn=Ae*Rn)-(nn-Rn)))-((Wo=Rr*Rn)-Qn*ri-vi*ri-Qn*Ki)))+(dr=Is-zn))+(dr-su),it[1]=(Ho=Ls-((Gi=Ls+zn)-(dr=Gi-Ls))+(zn-dr))-((zn=Ho-Wo)+(dr=Ho-zn))+(dr-Wo),it[2]=Gi-((Xi=Gi+zn)-(dr=Xi-Gi))+(zn-dr),it[3]=Xi;var ooe=Le(soe,At,4,it,kt);return kt[ooe-1]}(zt,Lt,Jt,yr,Ur,$r,Mr)}(_e[0],_e[1],ve[0],ve[1],st[0],st[1]);return Rt>0?-1:Rt<0?1:0}function Xe(_e,ve){var st=_e.point,Rt=ve.point;return st[0]>Rt[0]?1:st[0]<Rt[0]?-1:st[1]!==Rt[1]?st[1]>Rt[1]?1:-1:function(zt,Lt,Jt,yr){return zt.left!==Lt.left?zt.left?1:-1:Tt(Jt,zt.otherEvent.point,Lt.otherEvent.point)!==0?zt.isBelow(Lt.otherEvent.point)?-1:1:!zt.isSubject&&Lt.isSubject?1:-1}(_e,ve,st)}function ot(_e,ve,st){var Rt=new de(ve,!1,_e,_e.isSubject),zt=new de(ve,!0,_e.otherEvent,_e.isSubject);return fe(_e.point,_e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",_e),Rt.contourId=zt.contourId=_e.contourId,Xe(zt,_e.otherEvent)>0&&(_e.otherEvent.left=!0,zt.left=!1),_e.otherEvent.otherEvent=zt,_e.otherEvent=Rt,st.push(zt),st.push(Rt),st}function It(_e,ve){return _e[0]*ve[1]-_e[1]*ve[0]}function St(_e,ve){return _e[0]*ve[0]+_e[1]*ve[1]}function or(_e,ve,st){var Rt=function(Ur,$r,jr,jn,gi){var Mr=[$r[0]-Ur[0],$r[1]-Ur[1]],ti=[jn[0]-jr[0],jn[1]-jr[1]];function $n(nn,Qn,vi){return[nn[0]+Qn*vi[0],nn[1]+Qn*vi[1]]}var An=[jr[0]-Ur[0],jr[1]-Ur[1]],di=It(Mr,ti),Jn=di*di,Gn=St(Mr,Mr);if(Jn>0){var Xn=It(An,ti)/di;if(Xn<0||Xn>1)return null;var In=It(An,Mr)/di;return In<0||In>1?null:Xn===0||Xn===1?[$n(Ur,Xn,Mr)]:In===0||In===1?[$n(jr,In,ti)]:[$n(Ur,Xn,Mr)]}if((Jn=(di=It(An,Mr))*di)>0)return null;var Rr=St(Mr,An)/Gn,Rn=Rr+St(Mr,ti)/Gn,fi=Math.min(Rr,Rn),dr=Math.max(Rr,Rn);return fi<=1&&dr>=0?fi===1?[$n(Ur,fi>0?fi:0,Mr)]:dr===0?[$n(Ur,dr<1?dr:1,Mr)]:[$n(Ur,fi>0?fi:0,Mr),$n(Ur,dr<1?dr:1,Mr)]:null}(_e.point,_e.otherEvent.point,ve.point,ve.otherEvent.point),zt=Rt?Rt.length:0;if(zt===0||zt===1&&(fe(_e.point,ve.point)||fe(_e.otherEvent.point,ve.otherEvent.point))||zt===2&&_e.isSubject===ve.isSubject)return 0;if(zt===1)return fe(_e.point,Rt[0])||fe(_e.otherEvent.point,Rt[0])||ot(_e,Rt[0],st),fe(ve.point,Rt[0])||fe(ve.otherEvent.point,Rt[0])||ot(ve,Rt[0],st),1;var Lt=[],Jt=!1,yr=!1;return fe(_e.point,ve.point)?Jt=!0:Xe(_e,ve)===1?Lt.push(ve,_e):Lt.push(_e,ve),fe(_e.otherEvent.point,ve.otherEvent.point)?yr=!0:Xe(_e.otherEvent,ve.otherEvent)===1?Lt.push(ve.otherEvent,_e.otherEvent):Lt.push(_e.otherEvent,ve.otherEvent),Jt&&yr||Jt?(ve.type=k,_e.type=ve.inOut===_e.inOut?j:R,Jt&&!yr&&ot(Lt[1].otherEvent,Lt[0].point,st),2):yr?(ot(Lt[0],Lt[1].point,st),3):Lt[0]!==Lt[3].otherEvent?(ot(Lt[0],Lt[1].point,st),ot(Lt[1],Lt[2].point,st),3):(ot(Lt[0],Lt[1].point,st),ot(Lt[3].otherEvent,Lt[2].point,st),3)}function Kt(_e,ve){if(_e===ve)return 0;if(Tt(_e.point,_e.otherEvent.point,ve.point)!==0||Tt(_e.point,_e.otherEvent.point,ve.otherEvent.point)!==0)return fe(_e.point,ve.point)?_e.isBelow(ve.otherEvent.point)?-1:1:_e.point[0]===ve.point[0]?_e.point[1]<ve.point[1]?-1:1:Xe(_e,ve)===1?ve.isAbove(_e.point)?-1:1:_e.isBelow(ve.point)?-1:1;if(_e.isSubject!==ve.isSubject)return _e.isSubject?-1:1;var st=_e.point,Rt=ve.point;return st[0]===Rt[0]&&st[1]===Rt[1]?(st=_e.otherEvent.point)[0]===(Rt=ve.otherEvent.point)[0]&&st[1]===Rt[1]?0:_e.contourId>ve.contourId?1:-1:Xe(_e,ve)===1?1:-1}var _t=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Ct(_e,ve,st,Rt){var zt,Lt=_e+1,Jt=ve[_e].point,yr=ve.length;for(Lt<yr&&(zt=ve[Lt].point);Lt<yr&&zt[0]===Jt[0]&&zt[1]===Jt[1];){if(!st[Lt])return Lt;++Lt<yr&&(zt=ve[Lt].point)}for(Lt=_e-1;st[Lt]&&Lt>Rt;)Lt--;return Lt}_t.prototype.isExterior=function(){return this.holeOf==null};var rr=Nt,Bt=Nt;function Nt(_e,ve){if(!(this instanceof Nt))return new Nt(_e,ve);if(this.data=_e||[],this.length=this.data.length,this.compare=ve||Ht,this.length>0)for(var st=(this.length>>1)-1;st>=0;st--)this._down(st)}function Ht(_e,ve){return _e<ve?-1:_e>ve?1:0}Nt.prototype={push:function(_e){this.data.push(_e),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var _e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),_e}},peek:function(){return this.data[0]},_up:function(_e){for(var ve=this.data,st=this.compare,Rt=ve[_e];_e>0;){var zt=_e-1>>1,Lt=ve[zt];if(st(Rt,Lt)>=0)break;ve[_e]=Lt,_e=zt}ve[_e]=Rt},_down:function(_e){for(var ve=this.data,st=this.compare,Rt=this.length>>1,zt=ve[_e];_e<Rt;){var Lt=1+(_e<<1),Jt=Lt+1,yr=ve[Lt];if(Jt<this.length&&st(ve[Jt],yr)<0&&(Lt=Jt,yr=ve[Jt]),st(yr,zt)>=0)break;ve[_e]=yr,_e=Lt}ve[_e]=zt}},rr.default=Bt;var pr=Math.max,gr=Math.min,Cr=0;function Ar(_e,ve,st,Rt,zt,Lt){var Jt,yr,Ur,$r,jr,jn;for(Jt=0,yr=_e.length-1;Jt<yr;Jt++)if($r=_e[Jt+1],jr=new de(Ur=_e[Jt],!1,void 0,ve),jn=new de($r,!1,jr,ve),jr.otherEvent=jn,Ur[0]!==$r[0]||Ur[1]!==$r[1]){jr.contourId=jn.contourId=st,Lt||(jr.isExteriorRing=!1,jn.isExteriorRing=!1),Xe(jr,jn)>0?jn.left=!0:jr.left=!0;var gi=Ur[0],Mr=Ur[1];zt[0]=gr(zt[0],gi),zt[1]=gr(zt[1],Mr),zt[2]=pr(zt[2],gi),zt[3]=pr(zt[3],Mr),Rt.push(jr),Rt.push(jn)}}var Qr=[];function Vr(_e,ve,st){typeof _e[0][0][0]=="number"&&(_e=[_e]),typeof ve[0][0][0]=="number"&&(ve=[ve]);var Rt=function(Mr,ti,$n){var An=null;return Mr.length*ti.length==0&&($n===L?An=Qr:$n===q?An=Mr:$n!==W&&$n!==J||(An=Mr.length===0?ti:Mr)),An}(_e,ve,st);if(Rt)return Rt===Qr?null:Rt;var zt=[1/0,1/0,-1/0,-1/0],Lt=[1/0,1/0,-1/0,-1/0],Jt=function(Mr,ti,$n,An,di){var Jn,Gn,Xn,In,Rr,Rn,fi=new rr(null,Xe);for(Xn=0,In=Mr.length;Xn<In;Xn++)for(Rr=0,Rn=(Jn=Mr[Xn]).length;Rr<Rn;Rr++)(Gn=Rr===0)&&Cr++,Ar(Jn[Rr],!0,Cr,fi,$n,Gn);for(Xn=0,In=ti.length;Xn<In;Xn++)for(Rr=0,Rn=(Jn=ti[Xn]).length;Rr<Rn;Rr++)Gn=Rr===0,di===q&&(Gn=!1),Gn&&Cr++,Ar(Jn[Rr],!1,Cr,fi,An,Gn);return fi}(_e,ve,zt,Lt,st);if(Rt=function(Mr,ti,$n,An,di){var Jn=null;return($n[0]>An[2]||An[0]>$n[2]||$n[1]>An[3]||An[1]>$n[3])&&(di===L?Jn=Qr:di===q?Jn=Mr:di!==W&&di!==J||(Jn=Mr.concat(ti))),Jn}(_e,ve,zt,Lt,st))return Rt===Qr?null:Rt;for(var yr=function(Mr){var ti,$n,An=function(Xn){var In,Rr,Rn,fi,dr=[];for(Rr=0,Rn=Xn.length;Rr<Rn;Rr++)((In=Xn[Rr]).left&&In.inResult||!In.left&&In.otherEvent.inResult)&&dr.push(In);for(var nn=!1;!nn;)for(nn=!0,Rr=0,Rn=dr.length;Rr<Rn;Rr++)Rr+1<Rn&&Xe(dr[Rr],dr[Rr+1])===1&&(fi=dr[Rr],dr[Rr]=dr[Rr+1],dr[Rr+1]=fi,nn=!1);for(Rr=0,Rn=dr.length;Rr<Rn;Rr++)(In=dr[Rr]).otherPos=Rr;for(Rr=0,Rn=dr.length;Rr<Rn;Rr++)(In=dr[Rr]).left||(fi=In.otherPos,In.otherPos=In.otherEvent.otherPos,In.otherEvent.otherPos=fi);return dr}(Mr),di={},Jn=[],Gn=function(){if(!di[ti]){var Xn=Jn.length,In=function(dr,nn,Qn){var vi=new _t;if(dr.prevInResult!=null){var ri=dr.prevInResult,Ki=ri.outputContourId;if(ri.resultTransition>0){var zn=nn[Ki];if(zn.holeOf!=null){var Gi=zn.holeOf;nn[Gi].holeIds.push(Qn),vi.holeOf=Gi,vi.depth=nn[Ki].depth}else nn[Ki].holeIds.push(Qn),vi.holeOf=Ki,vi.depth=nn[Ki].depth+1}else vi.holeOf=null,vi.depth=nn[Ki].depth}else vi.holeOf=null,vi.depth=0;return vi}(An[ti],Jn,Xn),Rr=function(dr){di[dr]=!0,dr<An.length&&An[dr]&&(An[dr].outputContourId=Xn)},Rn=ti,fi=ti;for(In.points.push(An[ti].point);Rr(Rn),Rr(Rn=An[Rn].otherPos),In.points.push(An[Rn].point),!((Rn=Ct(Rn,An,di,fi))==fi||Rn>=An.length)&&An[Rn];);Jn.push(In)}};for(ti=0,$n=An.length;ti<$n;ti++)Gn();return Jn}(function(Mr,ti,$n,An,di,Jn){for(var Gn,Xn,In,Rr=new f(Kt),Rn=[],fi=Math.min(An[2],di[2]);Mr.length!==0;){var dr=Mr.pop();if(Rn.push(dr),Jn===L&&dr.point[0]>fi||Jn===q&&dr.point[0]>An[2])break;if(dr.left){Xn=Gn=Rr.insert(dr),Gn=Gn!==(In=Rr.minNode())?Rr.prev(Gn):null,Xn=Rr.next(Xn);var nn=Gn?Gn.key:null;if(Q(dr,nn,Jn),Xn&&or(dr,Xn.key,Mr)===2&&(Q(dr,nn,Jn),Q(Xn.key,dr,Jn)),Gn&&or(Gn.key,dr,Mr)===2){var Qn=Gn;Q(nn,(Qn=Qn!==In?Rr.prev(Qn):null)?Qn.key:null,Jn),Q(dr,nn,Jn)}}else Xn=Gn=Rr.find(dr=dr.otherEvent),Gn&&Xn&&(Gn=Gn!==In?Rr.prev(Gn):null,Xn=Rr.next(Xn),Rr.remove(dr),Xn&&Gn&&or(Gn.key,Xn.key,Mr))}return Rn}(Jt,0,0,zt,Lt,st)),Ur=[],$r=0;$r<yr.length;$r++){var jr=yr[$r];if(jr.isExterior()){for(var jn=[jr.points],gi=0;gi<jr.holeIds.length;gi++)jn.push(yr[jr.holeIds[gi]].points);Ur.push(jn)}}return Ur}var Kn={UNION:W,DIFFERENCE:q,INTERSECTION:L,XOR:J};a.diff=function(_e,ve){return Vr(_e,ve,q)},a.intersection=function(_e,ve){return Vr(_e,ve,L)},a.operations=Kn,a.union=function(_e,ve){return Vr(_e,ve,W)},a.xor=function(_e,ve){return Vr(_e,ve,J)},Object.defineProperty(a,"__esModule",{value:!0})})(i)}(0,VN.exports)),VN.exports);/**
* martinez v0.7.4
* Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
*
* @author Alex Milevski <info@w8r.name>
* @license MIT
* @preserve
*/function TS(l,i,a,d){const f=[],y=d===0?(_,S,A,k,j,R)=>{_.push(new ut(R,A+(R-S)/(k-S)*(j-A)))}:(_,S,A,k,j,R)=>{_.push(new ut(S+(R-A)/(j-A)*(k-S),R))};for(const _ of l){const S=[];for(const A of _){if(A.length<=2)continue;const k=[];for(let L=0;L<A.length-1;L++){const W=A[L].x,q=A[L].y,J=A[L+1].x,Q=A[L+1].y,oe=d===0?W:q,de=d===0?J:Q;oe<i?de>i&&y(k,W,q,J,Q,i):oe>a?de<a&&y(k,W,q,J,Q,a):k.push(A[L]),de<i&&oe>=i&&y(k,W,q,J,Q,i),de>a&&oe<=a&&y(k,W,q,J,Q,a)}let j=A[A.length-1];const R=d===0?j.x:j.y;R>=i&&R<=a&&k.push(j),k.length&&(j=k[k.length-1],k[0].x===j.x&&k[0].y===j.y||k.push(k[0]),S.push(k))}S.length&&f.push(S)}return f}function ine(l,i){const a=fC(l),d=fC([i]),f=UN.intersection(a,d);return f==null?[]:$N(f)}function sne(l,i){let a=fC(l,65536);for(;i.valid();i.next()){const[d,f]=i.get(),y=d.x*65536,_=d.y*65536,S=f.x*65536,A=f.y*65536,k=S-y,j=A-_,R=Math.hypot(k,j),L=Math.trunc(j/R*3),W=-Math.trunc(k/R*3);a=UN.diff(a,[[[y,_],[S,A],[S+L,A+W],[y+L,_+W],[y,_]]])}return $N(a,1/65536)}function fC(l,i=1){return[l.map(a=>a.map(d=>[d.x*i,d.y*i]))]}function $N(l,i=1){return l.map(a=>a.map((d,f)=>{const y=d.map(_=>new ut(_[0]*i,_[1]*i).round());return f>0&&y.reverse(),y}))}class pC{constructor(i,a){this.layoutVertexArray=new Io,this.indexArray=new ii,this.lineIndexArray=new xl,this.triangleSegments=new ui,this.lineSegments=new ui,this.programConfigurations=new la(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new Yu)}update(i,a,d,f,y,_,S,A){this.programConfigurations.updatePaintArrays(i,a,y,d,f,_,S,A)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,$re.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,Gre.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,a,d,f,y,_,S){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,a,d,f,y,_,void 0,S)}}class mC{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new pC(i,!1),this.elevationBufferData=new pC(i,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,d,f){this.hasPattern=hC("fill",this.layers,this.pixelRatio,a);const y=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:S,id:A,index:k,sourceLayerIndex:j}of i){const R=this.layers[0]._featureFilter.needGeometry,L=Ze(S,R);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),L,d))continue;const W=y?y.evaluate(L,{},d,a.availableImages):void 0,q={id:A,properties:S.properties,type:S.type,sourceLayerIndex:j,index:k,geometry:R?L.geometry:nt(S,d,f),patterns:{},sortKey:W};_.push(q)}y&&_.sort((S,A)=>S.sortKey-A.sortKey);for(const S of _){const{geometry:A,index:k,sourceLayerIndex:j}=S;if(this.hasPattern){const R=dC("fill",this.layers,S,this.zoom,this.pixelRatio,a);this.patternFeatures.push(R)}else this.addFeature(S,A,k,d,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(i[k].feature,A,k,j,this.index)}}update(i,a,d,f,y,_,S){this.bufferData.update(i,a,d,f,y,_,S,this.worldview),this.elevationBufferData.update(i,a,d,f,y,_,S,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,a,d,f,y,_,S,this.worldview)}addFeatures(i,a,d,f,y,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,d,f,_,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,a,d,f,y,_=[],S,A){const k=V0(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,k,f,d,A):this.addGeometry(k,this.bufferData),this.bufferData.populatePaintArrays(i,d,y,_,f,S,this.worldview),this.elevationBufferData.populatePaintArrays(i,d,y,_,f,S,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(i,a,d,f,y){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(a,d,f,y,this.worldview))}addElevatedRoadFeature(i,a,d,f,y){const _=new Array,S=rn.getElevationFeature(i,y);if(!S)return void this.addGeometry(a,this.bufferData);{const k=this.clipPolygonsToTile(a,1);k.length>0&&_.push({polygons:k,elevationFeature:S,elevationTileID:d})}const A={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},d),featureIndex:f};for(const k of _)if(k.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ua(k.elevationTileID,this.layers,this.zoom,this.lut));const R=k.elevationFeature.isTunnel();let L=0;i.properties.hasOwnProperty(nr)&&(L=+i.properties[nr]);for(const W of k.polygons)this.elevatedStructures.addPortalCandidates(k.elevationFeature.id,W,R,k.elevationFeature,L)}k.elevationFeature.constantHeight==null&&(k.polygons=this.prepareElevatedPolygons(k.polygons,k.elevationFeature,k.elevationTileID));const j=new xn(d,k.elevationTileID);this.addElevatedGeometry(k.polygons,j,k.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,f,A)}}addElevatedGeometry(i,a,d,f,y,_){const S={elevation:d,elevationSampler:a,bias:f,index:y,featureInfo:_},[A,k]=this.addGeometry(i,this.elevationBufferData,S);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:A,max:k}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,A),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,k))}addGeometry(i,a,d){let f=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,_=null;d&&(_=d.elevationSampler.constantElevation(d.elevation,d.bias),_!=null&&(f=_,y=_));const S=(A,k,j)=>{if(d!=null)if(k.push(A),_!=null)a.elevatedLayoutVertexArray.emplaceBack(_),j.push(_);else{const R=d.elevationSampler.pointElevation(A,d.elevation,d.bias);a.elevatedLayoutVertexArray.emplaceBack(R),j.push(R),f=Math.min(f,R),y=Math.max(y,R)}};for(const A of i){let k=0;for(const he of A)k+=he.length;const j=a.triangleSegments.prepareSegment(k,a.layoutVertexArray,a.indexArray),R=j.vertexLength,L=[],W=[],q=[],J=[],Q=[],oe=a.layoutVertexArray.length;for(const he of A){if(he.length===0)continue;he!==A[0]&&W.push(L.length/2);const fe=a.lineSegments.prepareSegment(he.length,a.layoutVertexArray,a.lineIndexArray),Ie=fe.vertexLength;d&&Q.push(a.layoutVertexArray.length-oe),S(he[0],q,J),a.layoutVertexArray.emplaceBack(he[0].x,he[0].y),a.lineIndexArray.emplaceBack(Ie+he.length-1,Ie),L.push(he[0].x),L.push(he[0].y);for(let Ae=1;Ae<he.length;Ae++)S(he[Ae],q,J),a.layoutVertexArray.emplaceBack(he[Ae].x,he[Ae].y),a.lineIndexArray.emplaceBack(Ie+Ae-1,Ie+Ae),L.push(he[Ae].x),L.push(he[Ae].y);fe.vertexLength+=he.length,fe.primitiveLength+=he.length}const de=Ug(L,W);for(let he=0;he<de.length;he+=3)a.indexArray.emplaceBack(R+de[he],R+de[he+1],R+de[he+2]);if(de.length>0&&d&&this.elevationMode==="hd-road-base"){const he=d.elevation.isTunnel(),fe=d.elevation.safeArea,Ie=this.elevatedStructures.addVertices(q,J);this.elevatedStructures.addTriangles(de,Ie,he);const Ae=Q.length;if(Ae>0){for(let ke=0;ke<Ae-1;ke++)this.elevatedStructures.addRenderableRing(d.index,Q[ke]+Ie,Q[ke+1]-Q[ke],he,fe,d.featureInfo);this.elevatedStructures.addRenderableRing(d.index,Q[Ae-1]+Ie,q.length-Q[Ae-1],he,fe,d.featureInfo)}}j.vertexLength+=k,j.primitiveLength+=de.length/3}return[f,y]}prepareElevatedPolygons(i,a,d){const f=1/Ee(d),y=[];for(const _ of i){const S=sne(_,new mn(a,f));y.push(...S)}return y}clipPolygonsToTile(i,a){const d=-a,f=-a,y=Dt+a,_=Dt+a;let S=0;const A=[],k=[];for(;S<i.length;S++){const L=i[S],W=Cv(L);(W.min.x>=d&&W.max.x<=y&&W.min.y>=f&&W.max.y<=_?A:k).push(L)}if(A.length===i.length)return i;const j=[new ut(d,f),new ut(y,f),new ut(y,_),new ut(d,_),new ut(d,f)],R=A;for(const L of k)R.push(...ine(L,j));return R}}let GN,HN,WN,qN;qt(mC,"FillBucket",{omit:["layers","patternFeatures"]}),qt(pC,"FillBufferData"),qt(ua,"ElevatedStructures");class ES{constructor(i,a,d,f){if(this.triangleCount=a.length/3,this.min=new ut(0,0),this.max=new ut(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[y,_]=[i[0].clone(),i[0].clone()];for(let R=1;R<i.length;++R){const L=i[R];y.x=Math.min(y.x,L.x),y.y=Math.min(y.y,L.y),_.x=Math.max(_.x,L.x),_.y=Math.max(_.y,L.y)}if(f){const R=Math.ceil(Math.max(_.x-y.x,_.y-y.y)/f);d=Math.max(d,R)}if(d===0)return;this.min=y,this.max=_;const S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);const A=Math.max(S.x,S.y)/d;this.cellsX=Math.max(1,Math.ceil(S.x/A)),this.cellsY=Math.max(1,Math.ceil(S.y/A)),this.xScale=1/A,this.yScale=1/A;const k=[];for(let R=0;R<this.triangleCount;R++){const L=i[a[3*R+0]].sub(this.min),W=i[a[3*R+1]].sub(this.min),q=i[a[3*R+2]].sub(this.min),J=nu(Math.floor(Math.min(L.x,W.x,q.x)),this.xScale,this.cellsX),Q=nu(Math.floor(Math.max(L.x,W.x,q.x)),this.xScale,this.cellsX),oe=nu(Math.floor(Math.min(L.y,W.y,q.y)),this.yScale,this.cellsY),de=nu(Math.floor(Math.max(L.y,W.y,q.y)),this.yScale,this.cellsY),he=new ut(0,0),fe=new ut(0,0),Ie=new ut(0,0),Ae=new ut(0,0);for(let ke=oe;ke<=de;++ke){he.y=fe.y=ke*A,Ie.y=Ae.y=(ke+1)*A;for(let Le=J;Le<=Q;++Le)he.x=Ie.x=Le*A,fe.x=Ae.x=(Le+1)*A,(Ks(L,W,q,he,fe,Ae)||Ks(L,W,q,he,Ae,Ie))&&k.push({cellIdx:ke*this.cellsX+Le,triIdx:R})}}if(k.length===0)return;k.sort((R,L)=>R.cellIdx-L.cellIdx||R.triIdx-L.triIdx);let j=0;for(;j<k.length;){const R=k[j].cellIdx,L={start:this.payload.length,len:0};for(;j<k.length&&k[j].cellIdx===R;)++L.len,this.payload.push(k[j++].triIdx);this.cells[R]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,a){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const d=nu(i.x-this.min.x,this.xScale,this.cellsX),f=nu(i.y-this.min.y,this.yScale,this.cellsY),y=this.cells[f*this.cellsX+d];if(y){this._lazyInitLookup();for(let _=0;_<y.len;_++){const S=this.payload[y.start+_],A=Math.floor(S/8),k=1<<S%8;if(!(this.lookup[A]&k)&&(this.lookup[A]|=k,a.push(S),a.length===this.triangleCount))return}}}query(i,a,d){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>a.x||i.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const f=nu(i.x-this.min.x,this.xScale,this.cellsX),y=nu(a.x-this.min.x,this.xScale,this.cellsX),_=nu(i.y-this.min.y,this.yScale,this.cellsY),S=nu(a.y-this.min.y,this.yScale,this.cellsY);for(let A=_;A<=S;A++)for(let k=f;k<=y;k++){const j=this.cells[A*this.cellsX+k];if(j)for(let R=0;R<j.len;R++){const L=this.payload[j.start+R],W=Math.floor(L/8),q=1<<L%8;if(!(this.lookup[W]&q)&&(this.lookup[W]|=q,d.push(L),d.length===this.triangleCount))return}}}}function nu(l,i,a){return Math.max(0,Math.min(a-1,Math.floor(l*i)))}qt(ES,"TriangleGridIndex");class ZN{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=i.worldview}updateFootprints(i,a){for(const d of this.footprints)a.push({footprint:d,id:i})}populate(i,a,d,f){const y=[];for(const{feature:_,id:S,index:A,sourceLayerIndex:k}of i){const j=this.layers[0]._featureFilter.needGeometry,R=Ze(_,j);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),R,d))continue;const L={id:S,properties:_.properties,type:_.type,sourceLayerIndex:k,index:A,geometry:j?R.geometry:nt(_,d,f),patterns:{}};y.push(L)}for(const _ of y){const{geometry:S,index:A,sourceLayerIndex:k}=_;this.addFeature(_,S,A,d,{},a.availableImages,a.brightness),a.featureIndex.insert(i[A].feature,S,A,k,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,a,d,f,y,_,S){}destroy(){}addFeature(i,a,d,f,y,_=[],S){for(const A of V0(a,2)){const k=[],j=[],R=[],L=new ut(1/0,1/0),W=new ut(-1/0,-1/0);for(const Q of A)if(Q.length!==0){Q!==A[0]&&R.push(j.length/2);for(let oe=0;oe<Q.length;oe++)j.push(Q[oe].x),j.push(Q[oe].y),k.push(Q[oe]),L.x=Math.min(L.x,Q[oe].x),L.y=Math.min(L.y,Q[oe].y),W.x=Math.max(W.x,Q[oe].x),W.y=Math.max(W.y,Q[oe].y)}const q=Ug(j,R),J=new ES(k,q,8,256);this.footprints.push({vertices:k,indices:q,grid:J,min:L,max:W})}}}qt(ZN,"ClipBucket",{omit:["layers"]});const one=Yr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ane=Yr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),lne=Yr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),cne=Yr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),une=Yr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),hne=Yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:dne}=one,U0=Number.MAX_SAFE_INTEGER,KN=U0-1;function XN(l,i,a,d){return l.order<i||l.order===U0||!(l.clipMask&a)||function(f,y){return y.length!==0&&y.find(_=>_===f)===void 0}(d,l.clipScope)}function AS(l,i){return l.x-i.x||l.y-i.y}function YN(l,i){return AS(l.min,i.min)===0&&AS(l.max,i.max)===0}function gC(l,i){return!(l.min.x>i.max.x||l.max.x<i.min.x||l.min.y>i.max.y||l.max.y<i.min.y)}function kS(l,i){if(l.length!==i.length)return!1;for(let a=0;a<l.length;a++)if(l[a].sourceId!==i[a].sourceId||!YN(l[a],i[a])||l[a].order!==i[a].order||l[a].clipMask!==i[a].clipMask||!qn(l[a].clipScope,i[a].clipScope))return!1;return!0}function JN(l,i,a){const d=1/Dt,f=1/(1<<a.canonical.z),y=(i.x*d+a.canonical.x)*f+a.wrap,_=(i.y*d+a.canonical.y)*f;return{min:new ut((l.x*d+a.canonical.x)*f+a.wrap,(l.y*d+a.canonical.y)*f),max:new ut(y,_)}}function fne(l,i,a){const d=1<<a.canonical.z,f=((i.x-a.wrap)*d-a.canonical.x)*Dt,y=(i.y*d-a.canonical.y)*Dt;return{min:new ut(((l.x-a.wrap)*d-a.canonical.x)*Dt,(l.y*d-a.canonical.y)*Dt),max:new ut(f,y)}}function yC(l,i,a,d,f,y,_){const S=l.indices,A=l.vertices,k=[];for(let j=d;j<d+f;j+=3){const R=i[a[j+0]+y],L=i[a[j+1]+y],W=i[a[j+2]+y],q=Math.min(R.x,L.x,W.x),J=Math.max(R.x,L.x,W.x),Q=Math.min(R.y,L.y,W.y),oe=Math.max(R.y,L.y,W.y);k.length=0,l.grid.query(new ut(q,Q),new ut(J,oe),k);for(let de=0;de<k.length;de++){const he=k[de];if(Ks(A[S[3*he+0]],A[S[3*he+1]],A[S[3*he+2]],R,L,W,_))return!0}}return!1}function QN(l,i,a,d){if(!l||!a)return!1;let f=l.vertices;if(!i.canonical.equals(d.canonical)||i.wrap!==d.wrap){if(a.vertices.length<l.vertices.length)return QN(a,d,l,i);const y=i.canonical,_=d.canonical,S=Math.pow(2,_.z-y.z);f=l.vertices.map(A=>new ut((A.x+y.x*Dt)*S-_.x*Dt,(A.y+y.y*Dt)*S-_.y*Dt))}return yC(a,f,l.indices,0,l.indices.length,0,0)}function eF(l,i,a,d){const f=Math.pow(2,d.z-a.z);return new ut((l+a.x*Dt)*f-d.x*Dt,(i+a.y*Dt)*f-d.y*Dt)}function _C(l,i){const a=[];i.grid.queryPoint(l,a);const d=i.indices,f=i.vertices;for(let y=0;y<a.length;y++){const _=a[y];if(si([f[d[3*_+0]],f[d[3*_+1]],f[d[3*_+2]]],l))return!0}return!1}const vC=[new ut(0,0),new ut(Dt,0),new ut(Dt,Dt),new ut(0,Dt)];function tF(l,i){const a=[];let d=[];if(!i||l.length<2)return[l];if(l.length===2)return Un(l[0],l[1],vC)?[l]:[];for(let f=0;f<l.length+2;f++){const y=l[f%l.length],_=l[(f+1)%l.length],S=Un(f===0?l[l.length-1]:l[(f-1)%l.length],y,vC),A=Un(y,_,vC),k=S||A;k&&d.push(y),k&&A||d.length>0&&(d.length>1&&a.push(d),d=[])}return d.length>1&&a.push(d),a}const xC=yt.types,pne=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],mne=["fill-extrusion-flood-light-ground-radius"],gne=Math.pow(2,13),yne=Math.pow(2,15)-1,rF=new ut(0,1),Pd=2147483648;function $0(l,i,a,d,f,y,_,S){l.emplaceBack((i<<1)+_,(a<<1)+y,(Math.floor(d*gne)<<1)+f,Math.round(S))}function G0(l,i,a){l.emplaceBack(i.x*Dt,i.y*Dt,a?1:0)}function PS(l,i,a,d,f,y){l.emplaceBack(i.x,i.y,(a.x<<1)+d,(a.y<<1)+f,y)}function H0(l,i,a){l.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class nF{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class iF{constructor(){this.centroidXY=new ut(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ut(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ut(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new ut(this.max.x-this.min.x,this.max.y-this.min.y)}}class sF{constructor(){this.acc=new ut(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,a){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=a.x,i.min.y=i.max.y=a.y)}appendEdge(i,a,d){this.accCount++,this.acc._add(a);let f=!!this.borders;a.x<i.min.x?(i.min.x=a.x,f=!0):a.x>i.max.x&&(i.max.x=a.x,f=!0),a.y<i.min.y?(i.min.y=a.y,f=!0):a.y>i.max.y&&(i.max.y=a.y,f=!0),((a.x===0||a.x===Dt)&&a.x===d.x)!=((a.y===0||a.y===Dt)&&a.y===d.y)&&this.processBorderOverlap(a,d),f&&this.checkBorderIntersection(a,d)}checkBorderIntersection(i,a){a.x<0!=i.x<0&&this.addBorderIntersection(0,lr(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>Dt!=i.x>Dt&&this.addBorderIntersection(1,lr(a.y,i.y,(Dt-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,lr(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>Dt!=i.y>Dt&&this.addBorderIntersection(3,lr(a.x,i.x,(Dt-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[i];a<d[0]&&(d[0]=a),a>d[1]&&(d[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const d=i.x===0?0:1;this.addBorderIntersection(d,a.y),this.addBorderIntersection(d,i.y)}else{const d=i.y===0?2:3;this.addBorderIntersection(d,a.x),this.addBorderIntersection(d,i.x)}}centroid(){return this.accCount===0?new ut(0,0):new ut(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0):0}}function oF(l,i){const a=l.add(i)._unit(),d=xe(l.x*a.x+l.y*a.y,-1,1);var f,y,_;return f=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(f)))/4*yne*((y=l).x*(_=i).y-y.y*_.x<0?-1:1)}const _ne=[l=>l.x<0,l=>l.x>Dt,l=>l.y<0,l=>l.y>Dt];function vne(l,i,a,d){const f=[4];if(d===0)return f;a._mult(d);const y=l.sub(a),_=i.sub(a),S=[l,i,y,_];for(let A=0;A<4;A++)for(const k of S)if(_ne[A](k)){f.push(A);break}return f}class bC{constructor(i){this.vertexArray=new Mg,this.indexArray=new ii,this.programConfigurations=new la(i.layers,{zoom:i.zoom,lut:i.lut},a=>mne.includes(a)),this._segments=new ui,this.hiddenByLandmarkVertexArray=new zg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ui}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,a,d,f=!1){const y=i.length;if(y>2){let _=Math.max(0,this._segments.get().length-1);const S=this._segments._prepareSegment(4*y,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let A;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const k=i[0],j=i[1];A=oF(k.sub(i[y-1])._perp()._unit(),j.sub(k)._perp()._unit())}for(let k=0;k<y;k++){const j=k===y-1?0:k+1,R=i[k],L=i[j],W=i[j===y-1?0:j+1],q=L.sub(R)._perp()._unit(),J=oF(q,W.sub(L)._perp()._unit()),Q=A,oe=J;if(wC(R,L,a)||f&&cF(R,a)&&cF(L,a)){A=J;continue}const de=S.vertexLength;PS(this.vertexArray,R,L,1,1,Q),PS(this.vertexArray,R,L,1,0,Q),PS(this.vertexArray,R,L,0,1,oe),PS(this.vertexArray,R,L,0,0,oe),S.vertexLength+=4;const he=vne(R,L,q,d);for(const fe of he)this._segmentToGroundQuads[_].push({id:de,region:fe}),this._segmentToRegionTriCounts[_][fe]+=2,S.primitiveLength+=2;A=J}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),a=i.length;for(let d=0;d<a;d++)this._segmentToGroundQuads[d].sort((f,y)=>f.region-y.region);for(let d=0;d<a;d++){const f=this._segmentToGroundQuads[d],y=i[d],_=this._segmentToRegionTriCounts[d];_.reduce((A,k)=>A+k,0);let S=0;for(let A=0;A<=4;A++){const k=_[A];if(k!==0){let j=this.regionSegments[A];j||(j=this.regionSegments[A]=new ui);const R={vertexOffset:y.vertexOffset,primitiveOffset:y.primitiveOffset+S,vertexLength:y.vertexLength,primitiveLength:k};j.get().push(R)}S+=k}for(let A=0;A<f.length;A++){const k=f[A].id;this.indexArray.emplaceBack(k,k+1,k+3),this.indexArray.emplaceBack(k,k+3,k+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,a,d,f,y,_,S){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,a,d,f,y,_,void 0,S)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,ane.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,a,d,f,y,_,S,A){this.hasData()&&this.programConfigurations.updatePaintArrays(i,a,d,f,y,_,S,A)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&Pd))}updateHiddenByLandmarkRange(i,a,d){if(!this.hasData())return;const f=a+i;if(a!==0){for(let y=i;y<f;++y)this.hiddenByLandmarkVertexArray.emplace(y,d?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,une.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const a=this.regionSegments[i];a&&a.destroy()}}}}class CS{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ii,this.footprintVertices=new Io,this.footprintSegments=[],this.layoutVertexArray=new md,this.centroidVertexArray=new cS,this.wallVertexArray=new hS,this.indexArray=new ii,this.programConfigurations=new la(i.layers,{zoom:i.zoom,lut:i.lut},a=>pne.includes(a)),this.segments=new ui,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new bC(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,d,f){this.features=[],this.hasPattern=hC("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ee(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:y,id:_,index:S,sourceLayerIndex:A}of i){const k=this.layers[0]._featureFilter.needGeometry,j=Ze(y,k);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),j,d))continue;const R={id:_,sourceLayerIndex:A,index:S,geometry:k?j.geometry:nt(y,d,f),properties:y.properties,type:y.type,patterns:{}},L=this.layoutVertexArray.length,W=xC[R.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:y.id,feature:dC("fill-extrusion",this.layers,R,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const q of R.geometry)for(const J of tF(q,W))this.addFeature(y.id,R,[J],S,d,{},a.availableImages,f,a.brightness);else this.addFeature(y.id,R,R.geometry,S,d,{},a.availableImages,f,a.brightness);a.featureIndex.insert(y,R.geometry,S,A,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,a,d,f,y,_){for(const{featureId:S,feature:A}of this.features){const k=xC[A.type]==="Polygon",{geometry:j}=A;if(this.wallMode)for(const R of j)for(const L of tF(R,k))this.addFeature(S,A,[L],A.index,a,d,f,y,_);else this.addFeature(S,A,j,A.index,a,d,f,y,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,a,d,f,y,_,S){this.programConfigurations.updatePaintArrays(i,a,y,d,f,_,S,this.worldview),this.groundEffect.update(i,a,y,d,f,_,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,dne),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,cne.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,hne.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,lne.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,d,f,y,_,S,A,k){const j=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,R=[new ut(0,0),new ut(Dt,Dt)],L=A.projection,W=L.name==="globe",q=this.wallMode||xC[a.type]==="Polygon",J=new sF;J.centroidDataIndex=this.centroidData.length;const Q=new iF;Q.buildingId=i,a.properties&&a.properties.hasOwnProperty("building_id")&&(Q.buildingId=a.properties.building_id);const oe=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},y)<=0,de=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},y);let he;if(Q.height=de,Q.vertexArrayOffset=this.layoutVertexArray.length,Q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,W&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new jg),this.wallMode){if(W)return void qr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(d.length!==1)return;he=function(Ge){const ft=Ge[0].x===Ge[Ge.length-1].x&&Ge[0].y===Ge[Ge.length-1].y;(function(_t){let Ct=0;const rr=_t.length;for(let Bt=0;Bt<rr;Bt++)Ct+=(_t[(Bt+1)%rr].x-_t[Bt].x)*(_t[(Bt+1)%rr].y+_t[Bt].y);return Ct>=0})(Ge)||(Ge=Ge.reverse());const wt={geometry:[],joinNormals:[],indices:[]},xt=[],At=[],kt=[];let it=Ge.length;for(;it>=2&&Ge[it-1].equals(Ge[it-2]);)it--;if(it<(ft?3:2))return wt;let Tt,Xe,ot,It,St,or=0;for(;or<it-1&&Ge[or].equals(Ge[or+1]);)or++;ft&&(Tt=Ge[it-2],St=Ge[or].sub(Tt)._unit()._perp());for(let _t=or;_t<it;_t++){if(ot=_t===it-1?ft?Ge[or+1]:void 0:Ge[_t+1],ot&&Ge[_t].equals(ot))continue;St&&(It=St),Tt&&(Xe=Tt),Tt=Ge[_t],St=ot?ot.sub(Tt)._unit()._perp():It,It=It||St;let Ct=It.add(St);Ct.x===0&&Ct.y===0||Ct._unit();const rr=Ct.x*St.x+Ct.y*St.y,Bt=rr!==0?1/rr:1/0,Nt=It.x*St.y-It.y*St.x>0;let Ht="miter";const pr=2;Ht==="miter"&&Bt>pr&&(Ht="bevel"),Ht==="bevel"&&(Bt>100&&(Ht="flipbevel"),Bt<pr&&(Ht="miter"));const gr=(Cr,Ar,Qr,Vr)=>{const Kn=new ut(Cr.x,Cr.y),_e=new ut(Cr.x,Cr.y);Kn.x+=Ar.x*Vr,Kn.y+=Ar.y*Vr,_e.x-=Ar.x*Math.max(Qr,1),_e.y-=Ar.y*Math.max(Qr,1),kt.push(Ar),xt.push(Kn),At.push(_e)};if(Ht==="miter")Ct._mult(Bt),gr(Tt,Ct,0,0);else if(Ht==="flipbevel")Ct=St.mult(-1),gr(Tt,Ct,0,0),gr(Tt,Ct.mult(-1),0,0);else{const Cr=-Math.sqrt(Bt*Bt-1),Ar=Nt?Cr:0,Qr=Nt?0:Cr;Xe&&gr(Tt,It,Ar,Qr),ot&&gr(Tt,St,Ar,Qr)}}wt.geometry=[...xt,...At.reverse(),xt[0]],wt.joinNormals=[...kt,...kt.reverse(),kt[kt.length-1]];const Kt=wt.geometry.length-1;for(let _t=0;_t<Kt/2;_t++)if(_t+1<Kt/2){let Ct=_t,rr=_t+1,Bt=Kt-1-_t,Nt=Kt-2-_t;Ct=Ct===0?Kt-1:Ct-1,rr=rr===0?Kt-1:rr-1,Bt=Bt===0?Kt-1:Bt-1,Nt=Nt===0?Kt-1:Nt-1,wt.indices.push(Bt),wt.indices.push(rr),wt.indices.push(Ct),wt.indices.push(Bt),wt.indices.push(Nt),wt.indices.push(rr)}return wt}(d[0]),d=[he.geometry]}const fe=(Ge,ft)=>Ge<(ft.length-1)/2||Ge===ft.length-1,Ie=this.wallMode?[d]:V0(d,500);for(let Ge=Ie.length-1;Ge>=0;Ge--){const ft=Ie[Ge];(ft.length===0||(Ae=ft[0]).every(wt=>wt.x<=0)||Ae.every(wt=>wt.x>=Dt)||Ae.every(wt=>wt.y<=0)||Ae.every(wt=>wt.y>=Dt))&&Ie.splice(Ge,1)}var Ae;let ke;if(W)ke=fF(Ie,R,y);else{ke=[];for(const Ge of Ie)ke.push({polygon:Ge,bounds:R})}const Le=q?this.edgeRadius:0,Be=Le>0&&this.zoom<17,at=(Ge,ft)=>{if(Ge.length===0)return!1;const wt=Ge[Ge.length-1];return ft.x===wt.x&&ft.y===wt.y};for(const{polygon:Ge,bounds:ft}of ke){let wt=0,xt=0;for(const Tt of Ge)q&&!Tt[0].equals(Tt[Tt.length-1])&&Tt.push(Tt[0]),xt+=q?Tt.length-1:Tt.length;const At=this.segments.prepareSegment((q?5:4)*xt,this.layoutVertexArray,this.indexArray);Q.footprintSegIdx<0&&(Q.footprintSegIdx=this.footprintSegments.length),Q.polygonSegIdx<0&&(Q.polygonSegIdx=this.polygonSegments.length);const kt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},it=new nF;if(it.vertexOffset=this.footprintVertices.length,it.indexOffset=3*this.footprintIndices.length,it.ringIndices=[],q){const Tt=[],Xe=[];wt=At.vertexLength;for(let It=0;It<Ge.length;It++){const St=Ge[It];St.length&&It!==0&&Xe.push(Tt.length/2);const or=[];let Kt,_t;Kt=St[1].sub(St[0])._perp()._unit(),it.ringIndices.push(St.length-1);for(let Ct=1;Ct<St.length;Ct++){const rr=St[Ct],Bt=St[Ct===St.length-1?1:Ct+1],Nt=rr.clone();if(Le){_t=Bt.sub(rr)._perp()._unit();const Ht=Kt.add(_t)._unit(),pr=Le*Math.min(4,1/(Kt.x*Ht.x+Kt.y*Ht.y));Nt.x+=pr*Ht.x,Nt.y+=pr*Ht.y,Nt.x=Math.round(Nt.x),Nt.y=Math.round(Nt.y),Kt=_t}if(!oe||Le!==0&&!Be||at(or,Nt)||or.push(Nt),$0(this.layoutVertexArray,Nt.x,Nt.y,0,0,1,1,0),this.wallMode){const Ht=fe(Ct,St);G0(this.wallVertexArray,he.joinNormals[Ct],!Ht)}At.vertexLength++,this.footprintVertices.emplaceBack(rr.x,rr.y),Tt.push(rr.x,rr.y),W&&H0(this.layoutVertexExtArray,L.projectTilePoint(Nt.x,Nt.y,y),L.upVector(y,Nt.x,Nt.y))}oe&&(Le===0||Be)&&(or.length!==0&&at(or,or[0])&&or.pop(),this.groundEffect.addData(or,ft,j))}const ot=this.wallMode?he.indices:Ug(Tt,Xe);for(let It=0;It<ot.length;It+=3)this.footprintIndices.emplaceBack(it.vertexOffset+ot[It+0],it.vertexOffset+ot[It+1],it.vertexOffset+ot[It+2]),this.indexArray.emplaceBack(wt+ot[It],wt+ot[It+2],wt+ot[It+1]),At.primitiveLength++;it.indexCount+=ot.length,it.vertexCount+=this.footprintVertices.length-it.vertexOffset}for(let Tt=0;Tt<Ge.length;Tt++){const Xe=Ge[Tt];J.startRing(Q,Xe[0]);let ot=Xe.length>4&&uF(Xe[Xe.length-2],Xe[0],Xe[1]),It=Le?xne(Xe[Xe.length-2],Xe[0],Xe[1],Le):0;const St=[];let or,Kt,_t;Kt=Xe[1].sub(Xe[0])._perp()._unit();let Ct=!0;for(let rr=1,Bt=0;rr<Xe.length;rr++){let Nt=Xe[rr-1],Ht=Xe[rr];const pr=Xe[rr===Xe.length-1?1:rr+1];if(J.appendEdge(Q,Ht,Nt),wC(Ht,Nt,ft)){Le&&(Kt=pr.sub(Ht)._perp()._unit(),Ct=!Ct);continue}const gr=Ht.sub(Nt)._perp(),Cr=gr.x/(Math.abs(gr.x)+Math.abs(gr.y)),Ar=gr.y>0?1:0,Qr=Nt.dist(Ht);if(Bt+Qr>32768&&(Bt=0),Le){_t=pr.sub(Ht)._perp()._unit();let ve=lF(Nt,Ht,pr,aF(Kt,_t),Le);isNaN(ve)&&(ve=0);const st=Ht.sub(Nt)._unit();Nt=Nt.add(st.mult(It))._round(),Ht=Ht.add(st.mult(-ve))._round(),It=ve,Kt=_t,oe&&this.zoom>=17&&(at(St,Nt)||St.push(Nt),at(St,Ht)||St.push(Ht))}const Vr=At.vertexLength,Kn=Xe.length>4&&uF(Nt,Ht,pr);let _e=hF(Bt,ot,Ct);if($0(this.layoutVertexArray,Nt.x,Nt.y,Cr,Ar,0,0,_e),$0(this.layoutVertexArray,Nt.x,Nt.y,Cr,Ar,0,1,_e),this.wallMode){const ve=fe(rr-1,Xe),st=he.joinNormals[rr-1];G0(this.wallVertexArray,st,ve),G0(this.wallVertexArray,st,ve)}if(Bt+=Qr,_e=hF(Bt,Kn,!Ct),ot=Kn,$0(this.layoutVertexArray,Ht.x,Ht.y,Cr,Ar,0,0,_e),$0(this.layoutVertexArray,Ht.x,Ht.y,Cr,Ar,0,1,_e),this.wallMode){const ve=fe(rr,Xe),st=he.joinNormals[rr];G0(this.wallVertexArray,st,ve),G0(this.wallVertexArray,st,ve)}if(At.vertexLength+=4,this.indexArray.emplaceBack(Vr+0,Vr+1,Vr+2),this.indexArray.emplaceBack(Vr+1,Vr+3,Vr+2),At.primitiveLength+=2,Le){const ve=wt+(rr===1?Xe.length-2:rr-2),st=rr===1?wt:ve+1;if(this.indexArray.emplaceBack(Vr+1,ve,Vr+3),this.indexArray.emplaceBack(ve,st,Vr+3),At.primitiveLength+=2,or===void 0&&(or=Vr),!wC(pr,Xe[rr],ft)){const Rt=rr===Xe.length-1?or:At.vertexLength;this.indexArray.emplaceBack(Vr+2,Vr+3,Rt),this.indexArray.emplaceBack(Vr+3,Rt+1,Rt),this.indexArray.emplaceBack(Vr+3,st,Rt+1),At.primitiveLength+=3}Ct=!Ct}if(W){const ve=this.layoutVertexExtArray,st=L.projectTilePoint(Nt.x,Nt.y,y),Rt=L.projectTilePoint(Ht.x,Ht.y,y),zt=L.upVector(y,Nt.x,Nt.y),Lt=L.upVector(y,Ht.x,Ht.y);H0(ve,st,zt),H0(ve,st,zt),H0(ve,Rt,Lt),H0(ve,Rt,Lt)}}q&&(wt+=Xe.length-1),oe&&Le&&this.zoom>=17&&(St.length!==0&&at(St,St[0])&&St.pop(),this.groundEffect.addData(St,ft,j,Le>0))}this.footprintSegments.push(it),kt.triangleCount=this.indexArray.length-kt.triangleArrayOffset,this.polygonSegments.push(kt),++Q.footprintSegLen,++Q.polygonSegLen}if(Q.vertexCount=this.layoutVertexArray.length-Q.vertexArrayOffset,Q.groundVertexCount=this.groundEffect.vertexArray.length-Q.groundVertexArrayOffset,Q.vertexCount!==0){if(Q.centroidXY=J.borders?rF:this.encodeCentroid(J,Q),this.centroidData.push(Q),J.borders){this.featuresOnBorder.push(J);const Ge=this.featuresOnBorder.length-1;for(let ft=0;ft<J.borders.length;ft++)J.borders[ft][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ft].push(Ge)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,_,S,y,k,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,f,_,S,y,k,this.worldview),this.maxHeight=Math.max(this.maxHeight,de)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((a,d)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[d].borders[i][0])}splitToSubtiles(){const i=[];for(let S=0;S<this.centroidData.length;S++){const A=this.centroidData[S],k=+(A.min.y+A.max.y>Dt),j=2*k+(+(A.min.x+A.max.x>Dt)^k);for(let R=0;R<A.polygonSegLen;R++){const L=A.polygonSegIdx+R;i.push({centroidIdx:S,subtile:j,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const a=new ii;i.sort((S,A)=>S.triangleSegmentIdx===A.triangleSegmentIdx?S.subtile-A.subtile:S.triangleSegmentIdx-A.triangleSegmentIdx);let d=0,f=0,y=0;for(const S of i){if(S.triangleSegmentIdx!==d)break;y++}const _=i.length;for(;f!==i.length;){d=i[f].triangleSegmentIdx;let S=0,A=f,k=f;for(let j=A;j<y&&i[j].subtile===S;j++)k++;for(;A!==y;){const j=i[A];S=j.subtile;const R=this.centroidData[j.centroidIdx].min.clone(),L=this.centroidData[j.centroidIdx].max.clone(),W={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let q=A;q<k;q++){const J=i[q],Q=this.polygonSegments[J.polygonSegmentIdx],oe=this.centroidData[J.centroidIdx].min,de=this.centroidData[J.centroidIdx].max,he=this.indexArray.uint16;for(let fe=Q.triangleArrayOffset;fe<Q.triangleArrayOffset+Q.triangleCount;fe++)a.emplaceBack(he[3*fe],he[3*fe+1],he[3*fe+2]);W.primitiveLength+=Q.triangleCount,R.x=Math.min(R.x,oe.x),R.y=Math.min(R.y,oe.y),L.x=Math.max(L.x,de.x),L.y=Math.max(L.y,de.y)}W.primitiveLength>0&&this.triangleSubSegments.push({segment:W,min:R,max:L}),A=k;for(let q=A;q<y&&i[q].subtile===i[A].subtile;q++)k++}f=y;for(let j=f;j<_&&i[j].triangleSegmentIdx===i[f].triangleSegmentIdx;j++)y++}a._trim(),this.indexArray=a}getVisibleSegments(i,a,d){const f=new ui;if(this.wallMode){for(const J of this.triangleSubSegments)f.segments.push(J.segment);return f}let y=0,_=0;const S=1<<i.canonical.z;if(a){const J=a.getMinMaxForTile(i);J&&(y=J.min,_=J.max)}_+=this.maxHeight;const A=i.toUnwrapped();let k;const j=[A.canonical.x/S+A.wrap,A.canonical.y/S],R=[(A.canonical.x+1)/S+A.wrap,(A.canonical.y+1)/S],L=(J,Q,oe)=>[J[0]*(1-oe[0])+Q[0]*oe[0],J[1]*(1-oe[1])+Q[1]*oe[1]],W=[],q=[];for(const J of this.triangleSubSegments){W[0]=J.min.x/Dt,W[1]=J.min.y/Dt,q[0]=J.max.x/Dt,q[1]=J.max.y/Dt;const Q=L(j,R,W),oe=L(j,R,q);if(new kr([Q[0],Q[1],y],[oe[0],oe[1],_]).intersectsPrecise(d)===0){k&&(f.segments.push(k),k=void 0);continue}const de=J.segment;k&&k.vertexOffset!==de.vertexOffset&&(f.segments.push(k),k=void 0),k?(k.vertexLength+=de.vertexLength,k.primitiveLength+=de.primitiveLength):k={vertexOffset:de.vertexOffset,primitiveLength:de.primitiveLength,vertexLength:de.vertexLength,primitiveOffset:de.primitiveOffset,sortKey:void 0,vaos:{}}}return k&&f.segments.push(k),f}encodeCentroid(i,a){const d=i.centroid(),f=a.span(),y=Math.min(7,Math.round(f.x*this.tileToMeter/10)),_=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new ut(xe(d.x,1,Dt-1)<<3|y,xe(d.y,1,Dt-1)<<3|_)}encodeBorderCentroid(i){if(!i.borders)return new ut(0,0);const a=i.borders,d=Number.MAX_VALUE;if(a[0][0]!==d||a[1][0]!==d){const f=a[0][0]!==d?0:1;return new ut(6|(a[0][0]!==d?0:65528),(a[f][0]+a[f][1])/2<<3|6)}{const f=a[2][0]!==d?2:3;return new ut((a[f][0]+a[f][1])/2<<3|6,6|(a[2][0]!==d?0:65528))}}showCentroid(i){const a=this.centroidData[i.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const a=i.vertexArrayOffset,d=i.vertexCount+i.vertexArrayOffset,f=i.flags&Pd?rF:i.centroidXY,y=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==f.y||y!==f.x){for(let _=a;_<d;++_)this.centroidVertexArray.emplace(_,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,a,d){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const f=a.getReplacementRegionsForTile(i.toUnwrapped());if(kS(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const y=[];for(const _ of this.activeReplacements){if(_.order<d)continue;const S=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));if(_.footprint.buildingId){const A=_.footprint.buildingId;for(const k of this.centroidData)k.buildingId===A&&(k.flags|=Pd)}else for(const A of this.centroidData)if(!(A.flags&Pd||_.min.x>A.max.x||A.min.x>_.max.x||_.min.y>A.max.y||A.min.y>_.max.y))for(let k=0;k<A.footprintSegLen;k++){const j=this.footprintSegments[A.footprintSegIdx+k];if(y.length=0,bne(this.footprintVertices,j.vertexOffset,j.vertexCount,_.footprintTileId.canonical,i.canonical,y),yC(_.footprint,y,this.footprintIndices.uint16,j.indexOffset,j.indexCount,-j.vertexOffset,-S)){A.flags|=Pd;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,a,d){let f=!1;for(let y=0;y<d.footprintSegLen;y++){const _=this.footprintSegments[d.footprintSegIdx+y];let S=0;for(const A of _.ringIndices){for(let k=S,j=A+S-1;k<A+S;j=k++){const R=this.footprintVertices.int16[2*(k+_.vertexOffset)+0],L=this.footprintVertices.int16[2*(k+_.vertexOffset)+1],W=this.footprintVertices.int16[2*(j+_.vertexOffset)+1];L>a!=W>a&&i<(this.footprintVertices.int16[2*(j+_.vertexOffset)+0]-R)*(a-L)/(W-L)+R&&(f=!f)}S=A}}return f}getHeightAtTileCoord(i,a){let d=Number.NEGATIVE_INFINITY,f=!0;const y=4*(i+Dt)*Dt+(a+Dt);if(this.partLookup.hasOwnProperty(y)){const _=this.partLookup[y];return _?{height:_.height,hidden:!!(_.flags&Pd)}:void 0}for(const _ of this.centroidData)i>_.max.x||_.min.x>i||a>_.max.y||_.min.y>a||_.height<=d||this.footprintContainsPoint(i,a,_)&&(d=_.height,this.partLookup[y]=_,f=!!(_.flags&Pd));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:f};this.partLookup[y]=void 0}}function aF(l,i){const a=l.add(i)._unit();return l.x*a.x+l.y*a.y}function xne(l,i,a,d){const f=i.sub(l)._perp()._unit(),y=a.sub(i)._perp()._unit();return lF(l,i,a,aF(f,y),d)}function lF(l,i,a,d,f){const y=Math.sqrt(1-d*d);return Math.min(l.dist(i)/3,i.dist(a)/3,f*y/d)}function wC(l,i,a){return l.x<a[0].x&&i.x<a[0].x||l.x>a[1].x&&i.x>a[1].x||l.y<a[0].y&&i.y<a[0].y||l.y>a[1].y&&i.y>a[1].y}function cF(l,i){return l.x<i[0].x||l.x>i[1].x||l.y<i[0].y||l.y>i[1].y}function uF(l,i,a){if(l.x<0||l.x>=Dt||i.x<0||i.x>=Dt||a.x<0||a.x>=Dt)return!1;const d=a.sub(i),f=d.perp(),y=l.sub(i);return(d.x*y.x+d.y*y.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(y.x*y.x+y.y*y.y))>-.866&&f.x*y.x+f.y*y.y<0}function hF(l,i,a){const d=i?2|l:-3&l;return a?1|d:-2&d}function dF(){const l=Math.PI/32,i=Math.tan(l),a=z;return a*Math.sqrt(1+2*i*i)-a}function fF(l,i,a){const d=1<<a.z,f=pe(a.x/d),y=pe((a.x+1)/d),_=me(a.y/d),S=me((a.y+1)/d);return function(A,k,j,R,L=0,W){const q=[];if(!A.length||!j||!R)return q;const J=(Ae,ke)=>{for(const Le of Ae)q.push({polygon:Le,bounds:ke})},Q=Math.ceil(Math.log2(j)),oe=Math.ceil(Math.log2(R)),de=Q-oe,he=[];for(let Ae=0;Ae<Math.abs(de);Ae++)he.push(de>0?0:1);for(let Ae=0;Ae<Math.min(Q,oe);Ae++)he.push(0),he.push(1);let fe=A;if(fe=TS(fe,k[0].y-L,k[1].y+L,1),fe=TS(fe,k[0].x-L,k[1].x+L,0),!fe.length)return q;const Ie=[];for(he.length?Ie.push({polygons:fe,bounds:k,depth:0}):J(fe,k);Ie.length;){const Ae=Ie.pop(),ke=Ae.depth,Le=he[ke],Be=Ae.bounds[0],at=Ae.bounds[1],Ge=Le===0?Be.x:Be.y,ft=Le===0?at.x:at.y,wt=W?W(Le,Ge,ft):.5*(Ge+ft),xt=TS(Ae.polygons,Ge-L,wt+L,Le),At=TS(Ae.polygons,wt-L,ft+L,Le);if(xt.length){const kt=[Be,new ut(Le===0?wt:at.x,Le===1?wt:at.y)];he.length>ke+1?Ie.push({polygons:xt,bounds:kt,depth:ke+1}):J(xt,kt)}if(At.length){const kt=[new ut(Le===0?wt:Be.x,Le===1?wt:Be.y),at];he.length>ke+1?Ie.push({polygons:At,bounds:kt,depth:ke+1}):J(At,kt)}}return q}(l,i,Math.ceil((y-f)/11.25),Math.ceil((_-S)/11.25),1,(A,k,j)=>{if(A===0)return .5*(k+j);{const R=me((a.y+k/Dt)/d);return(ie(.5*(me((a.y+j/Dt)/d)+R))*d-a.y)*Dt}})}function bne(l,i,a,d,f,y){const _=Math.pow(2,d.z-f.z);for(let S=0;S<a;S++){let A=l.int16[2*(S+i)+0],k=l.int16[2*(S+i)+1];A=(A+f.x*Dt)*_-d.x*Dt,k=(k+f.y*Dt)*_-d.y*Dt,y.push(new ut(A,k))}}let pF,mF;qt(CS,"FillExtrusionBucket",{omit:["layers","features"]}),qt(iF,"PartData"),qt(nF,"FootprintSegment"),qt(sF,"BorderCentroidData"),qt(bC,"GroundEffect");class wp extends ut{constructor(i,a,d){super(i,a),this.z=d}}class gF extends wp{constructor(i,a,d,f){super(i,a,d),this.w=f}}function yF(l,i,a,d){const f=a==="x"?"y":"x",y=(d-l[a])/(i[a]-l[a]);l[f]=Math.round(l[f]+(i[f]-l[f])*y),l[a]=d,l.hasOwnProperty("z")&&(l.z=lr(l.z,i.z,y)),l.hasOwnProperty("w")&&(l.w=lr(l.w,i.w,y))}function _F(l,i,a,d){const f=a,y=d;for(const _ of["x","y"]){let S=l,A=i;S[_]>=A[_]&&(S=i,A=l),S[_]<f&&A[_]>f&&yF(S,A,_,f),S[_]<y&&A[_]>y&&yF(A,S,_,y)}}function IS(l,i,a,d,f,y){const _=[];for(let S=0;S<l.length;S++){const A=l[S];let k;const j=_.length;let R=0;for(let L=0;L<A.length-1;L++){let W=A[L],q=A[L+1],J=0;const Q=R;let oe,de;y&&(J=Math.hypot(q.x-W.x,q.y-W.y),R+=J,oe=W,de=q),W.x<i&&q.x<i||(W.x<i?W=new ut(i,W.y+(i-W.x)/(q.x-W.x)*(q.y-W.y))._round():q.x<i&&(q=new ut(i,W.y+(i-W.x)/(q.x-W.x)*(q.y-W.y))._round()),W.y<a&&q.y<a||(W.y<a?W=new ut(W.x+(a-W.y)/(q.y-W.y)*(q.x-W.x),a)._round():q.y<a&&(q=new ut(W.x+(a-W.y)/(q.y-W.y)*(q.x-W.x),a)._round()),W.x>=d&&q.x>=d||(W.x>=d?W=new ut(d,W.y+(d-W.x)/(q.x-W.x)*(q.y-W.y))._round():q.x>=d&&(q=new ut(d,W.y+(d-W.x)/(q.x-W.x)*(q.y-W.y))._round()),W.y>=f&&q.y>=f||(W.y>=f?W=new ut(W.x+(f-W.y)/(q.y-W.y)*(q.x-W.x),f)._round():q.y>=f&&(q=new ut(W.x+(f-W.y)/(q.y-W.y)*(q.x-W.x),f)._round()),k&&W.equals(k[k.length-1])||(k=[W],_.push(k),y&&y.push({progress:{min:Q+vF(oe,de,W)*J,max:1},parentIndex:S,prevPoint:oe,nextPoint:de})),k.push(q),y&&(y[y.length-1].progress.max=Q+vF(oe,de,q)*J,y[y.length-1].nextPoint=de)))))}if(y&&R>0)for(let L=j;L<_.length;L++)y[L].progress.min/=R,y[L].progress.max/=R}return _}function wne(l,i,a,d,f){if(l.length<2)return void d.push(l);const y=[];for(;i.valid();){const[k,j]=i.get();for(let R=0;R<l.length-1;R++){const L=l[R],W=l[R+1],q=po(L,W,k,j);if(q){const[J]=q,Q=new ut(lr(L.x,W.x,J),lr(L.y,W.y,J));y.push({t:R+J,distance:0,point:Q})}}i.next()}if(y.length===0)return void d.push(l);y.sort((k,j)=>k.t-j.t);let _=0,S=0,A=[];for(d.push(A);_!==l.length;){if(S===y.length){for(;_!==l.length;)A.length!==0&&A[A.length-1].equals(l[_])||A.push(l[_]),_++;break}y[S].t<=_?(A.length!==0&&A[A.length-1].equals(y[S].point)||A.push(y[S].point),Math.trunc(y[S].t),S++):(A.length!==0&&A[A.length-1].equals(l[_])||A.push(l[_]),_++)}}function vF(l,i,a){return l.x!==i.x?(a.x-l.x)/(i.x-l.x):l.y!==i.y?(a.y-l.y)/(i.y-l.y):0}function W0(l,i){return l.x*i.x+l.y*i.y}function xF(l,i){if(l.length===1){let a=0;const d=i[a++];let f;for(;!f||d.equals(f);)if(f=i[a++],!f)return 1/0;for(;a<i.length;a++){const y=i[a],_=l[0],S=f.sub(d),A=y.sub(d),k=_.sub(d),j=W0(S,S),R=W0(S,A),L=W0(A,A),W=W0(k,S),q=W0(k,A),J=j*L-R*R,Q=(L*W-R*q)/J,oe=(j*q-R*W)/J,de=d.z*(1-Q-oe)+f.z*Q+y.z*oe;if(isFinite(de))return de}return 1/0}{let a=1/0;for(const d of i)a=Math.min(a,d.z);return a}}function bF(l,i,a,d,f,y,_,S){const A=_*f.getElevationAt(l,i,!0,!0),k=y[0]!==0,j=k?y[1]===0?_*(y[0]/7-450):_*function(R,L,W){const q=Math.floor(L[0]/8),J=Math.floor(L[1]/8),Q=10*(L[0]-8*q),oe=10*(L[1]-8*J),de=R.getElevationAt(q,J,!0,!0),he=R.getMeterToDEM(W),fe=Math.floor(.5*(Q*he-1)),Ie=Math.floor(.5*(oe*he-1)),Ae=R.tileCoordToPixel(q,J),ke=2*fe+1,Le=2*Ie+1,Be=function(At,kt,it,Tt,Xe){return[At.getElevationAtPixel(kt,it,!0),At.getElevationAtPixel(kt+Xe,it,!0),At.getElevationAtPixel(kt,it+Xe,!0),At.getElevationAtPixel(kt+Tt,it+Xe,!0)]}(R,Ae.x-fe,Ae.y-Ie,ke,Le),at=Math.abs(Be[0]-Be[1]),Ge=Math.abs(Be[2]-Be[3]),ft=Math.abs(Be[0]-Be[2])+Math.abs(Be[1]-Be[3]),wt=Math.min(.25,.5*he*(at+Ge)/ke),xt=Math.min(.25,.5*he*ft/Le);return de+Math.max(wt*Q,xt*oe)}(f,y,S):A;return{base:A+(a===0?-1:a),top:k?Math.max(j+d,A+a+2):A+d}}class Sne{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Tne{constructor(){this.tasks={},this.taskQueue=[],_r(["process"],this),this.invoker=new Sne(this.process),this.nextId=0}add(i,a){const d=this.nextId++,f=function({type:y,isSymbolTile:_,zoom:S}){return S=S||0,y==="message"?0:y!=="maybePrepare"||_?y!=="parseTile"||_?y==="parseTile"&&_?300-S:y==="maybePrepare"&&_?400-S:500:200-S:100-S}(a);if(f===0){try{i()}finally{}return null}return this.tasks[d]={fn:i,metadata:a,priority:f,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let f=0;f<this.taskQueue.length;f++){const y=this.tasks[this.taskQueue[f]];y.priority<a&&(a=y.priority,i=f)}if(i===null)return null;const d=this.taskQueue[i];return this.taskQueue.splice(i,1),d}remove(){this.invoker.remove()}}class wF{constructor(i,a,d){this.target=i,this.parent=a,this.mapId=d,this.callbacks={},this.cancelCallbacks={},_r(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Tne}send(i,a,d,f,y=!1,_){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=_,this.callbacks[S]=d);const A=new Set;return this.target.postMessage({id:S,type:i,hasCallback:!!d,targetMapId:f,mustQueue:y,sourceMapId:this.mapId,data:Xl(a,A)},A),{cancel:()=>{d&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(i){const a=i.data;if(!a)return;const d=a.id;if(d&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const f=this.cancelCallbacks[d];delete this.cancelCallbacks[d],f&&f.cancel()}else if(a.mustQueue||Dn(self)){const f=this.callbacks[d],y=this.scheduler.add(()=>this.processTask(d,a),f&&f.metadata||{type:"message"});y&&(this.cancelCallbacks[d]=y)}else this.processTask(d,a)}processTask(i,a){if(delete this.cancelCallbacks[i],a.type==="<response>"){const d=this.callbacks[i];delete this.callbacks[i],d&&(a.error?d(Co(a.error)):d(null,Co(a.data)))}else{const d=new Set,f=a.hasCallback?(_,S)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?Xl(_):null,data:Xl(S,d)},d)}:()=>{},y=Co(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,y,f);else if(this.parent.getWorkerSource){const _=a.type.split("."),{source:S,scope:A}=y;this.parent.getWorkerSource(a.sourceMapId,_[0],S,A)[_[1]](y,f)}else f(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var q0={workerUrl:"",workerClass:null,workerParams:void 0};const SC="mapboxgl_preloaded_worker_pool";class Sp{constructor(){this.active={}}acquire(i,a=Sp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(q0.workerClass!=null?new q0.workerClass:new self.Worker(q0.workerUrl,q0.workerParams));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[SC]}numActive(){return Object.keys(this.active).length}}Sp.workerCount=2;class Gg{constructor(i,a,d="Worker",f=Sp.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=gt();const y=this.workerPool.acquire(this.id,f);for(let _=0;_<y.length;_++){const S=new Gg.Actor(y[_],a,this.id);S.name=`${d} ${_}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,d){Ve(this.actors,(f,y)=>{f.send(i,a,y)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Z0,TC;function MS(){return Z0||(Z0=new Sp),Z0}Gg.Actor=wF;class Ene{constructor(i){this.module=i}createIntArray(i){const a=new Int32Array(i),d=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heap32.set(a,d/a.BYTES_PER_ELEMENT),d}createFloatArray(i){const a=new Float32Array(i),d=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heapF32.set(a,d/a.BYTES_PER_ELEMENT),d}createStringBuffer(i){const a=this.module.malloc(i.length+1);for(let d=0;d<i.length;++d)this.module.heapU8[a+d]=i.charCodeAt(d);return this.module.heapU8[a+i.length]=0,a}readStringBuffer(i){let a="";for(;this.module.heapU8[i]!==0;)a+=String.fromCharCode(this.module.heapU8[i]),++i;return a}setStyle(i){const a=i.entranceColorRgb,d=i.facadeGlazingColorRgb,f=i.roofColorRgb,y=i.wallColorRgb,_=i.normalScale;this.module.setStyle(a[0],a[1],a[2],d[0],d[1],d[2],f[0],f[1],f[2],y[0],y[1],y[2],_[0],_[1],_[2],i.tileToMeters)}setAOOptions(i,a){this.module.setAOOptions(i?1:0,a)}setMetricOptions(i,a){this.module.setMetricOptions(i?1:0,a)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,a){this.module.setFacadeOptions(i,a?1:0)}setFauxFacadeOptions(i,a,d){this.module.setFauxFacadeOptions(i?1:0,a?1:0,d)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,a){for(const S of i){const A=this.createStringBuffer(S.roofType),k=[0],j=[];for(const W of S.coordinates)if(Array.isArray(W)){for(const q of W)j.push(q.x),j.push(q.y);k.push(j.length)}const R=this.createIntArray(k),L=this.createFloatArray(j);this.module.addFeature(S.id,S.sourceId,S.minHeight,S.height,A,S.roofType.length,L,R,k.length-1),this.module.free(A),this.module.free(R),this.module.free(L)}for(const S of a){let A;A=S.entrances?JSON.parse(S.entrances):[];const k=this.createFloatArray(A),j=[];for(const L of S.coordinates)j.push(L.x),j.push(L.y);const R=this.createFloatArray(j);this.module.addFacade(S.sourceId,S.crossPerc,S.distanceToRoad,k,A.length,R,j.length),this.module.free(k),this.module.free(R)}if(!this.module.generateMesh()){const S=this.module.getLastError();return this.readStringBuffer(S)}const d=this.module.getMeshCount(),f=new Array(d);for(let S=0;S<d;S++){const A=this.module.getPositionsPtr(S),k=this.module.getPositionsLength(S),j=new Float32Array(this.module.heapF32.buffer,A,k),R=this.module.getNormalsPtr(S),L=this.module.getNormalsLength(S),W=new Float32Array(this.module.heapF32.buffer,R,L),q=this.module.getColorsPtr(S),J=this.module.getColorsLength(S),Q=new Uint8Array(this.module.heapU8.buffer,q,J),oe=this.module.getAOPtr(S),de=this.module.getAOLength(S),he=new Float32Array(this.module.heapF32.buffer,oe,de),fe=this.module.getUVPtr(S),Ie=this.module.getUVLength(S),Ae=new Float32Array(this.module.heapF32.buffer,fe,Ie),ke=this.module.getFauxFacadePtr(S),Le=this.module.getFauxFacadeLength(S),Be=new Uint8Array(this.module.heapU8.buffer,ke,Le),at=this.module.getIndicesPtr(S),Ge=this.module.getIndicesLength(S),ft=new Int32Array(this.module.heap32.buffer,at,Ge),wt=this.module.getBuildingPart(S),xt=this.readStringBuffer(wt);f[S]={positions:j,normals:W,colors:Q,ao:he,uv:Ae,isFauxFacade:Be,indices:ft,buildingPart:xt}}const y=this.module.getRingCount(),_=[];for(let S=0;S<y;S++){const A=this.module.getRingPtr(S),k=this.module.getRingLength(S),j=new Float32Array(this.module.heapF32.buffer,A,k);_.push(j)}return{meshes:f,modifiedPolygonRings:_}}}let OS,EC,Jl,Hg,AC,Wg=null,qg=null,SF=null,jS=null;function TF(){return Dn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:EC||Cs.DRACO_URL}function EF(){if(Dn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Hg)return Hg;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Hg=WebAssembly.validate(l)?Cs.MESHOPT_SIMD_URL:Cs.MESHOPT_URL,Hg}function Ane(){return jS}const RS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},kne={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},K0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function AF(l,i,a){const d=a.json.bufferViews.length,f=a.buffers.length;i.bufferView=d,a.json.bufferViews[d]={buffer:f,byteLength:l.byteLength},a.buffers[f]=l}const kC="KHR_draco_mesh_compression";function Pne(l,i){const a=l.extensions&&l.extensions[kC];if(!a)return;const d=new Jl.Decoder,f=IF(i,a.bufferView),y=new Jl.Mesh;if(!d.DecodeArrayToMesh(f,f.byteLength,y))throw new Error("Failed to decode Draco mesh");const _=i.json.accessors[l.indices],S=RS[_.componentType],A=_.count*S.BYTES_PER_ELEMENT,k=Jl._malloc(A);S===Uint16Array?d.GetTrianglesUInt16Array(y,A,k):d.GetTrianglesUInt32Array(y,A,k),AF(Jl.memory.buffer.slice(k,k+A),_,i),Jl._free(k);for(const j of Object.keys(a.attributes)){const R=d.GetAttributeByUniqueId(y,a.attributes[j]),L=i.json.accessors[l.attributes[j]],W=kne[L.componentType],q=L.count*K0[L.type]*RS[L.componentType].BYTES_PER_ELEMENT,J=Jl._malloc(q);d.GetAttributeDataArrayForAllPoints(y,R,Jl[W],q,J),AF(Jl.memory.buffer.slice(J,J+q),L,i),Jl._free(J)}d.destroy(),y.destroy(),delete l.extensions[kC]}const DS="EXT_meshopt_compression";function Cne(l,i){if(!l.extensions||!l.extensions[DS])return;const a=l.extensions[DS],d=new Uint8Array(i.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),f=new Uint8Array(a.count*a.byteStride);AC.decodeGltfBuffer(f,a.count,a.byteStride,d,a.mode,a.filter),l.buffer=i.buffers.length,l.byteOffset=0,i.buffers[l.buffer]=f.buffer,delete l.extensions[DS]}const kF=1179937895,PF=new TextDecoder("utf8");function CF(l,i){return new URL(l,i).href}function Ine(l,i,a,d){return fetch(CF(l.uri,d)).then(f=>f.arrayBuffer()).then(f=>{i.buffers[a]=f})}function IF(l,i){const a=l.json.bufferViews[i];return new Uint8Array(l.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function Mne(l,i,a,d){if(l.uri){const f=CF(l.uri,d);return fetch(f).then(y=>y.blob()).then(y=>createImageBitmap(y)).then(y=>{i.images[a]=y})}if(l.bufferView!==void 0){const f=IF(i,l.bufferView),y=new Blob([f],{type:l.mimeType});return createImageBitmap(y).then(_=>{i.images[a]=_})}}function MF(l,i=0,a){const d={json:null,images:[],buffers:[]};if(new Uint32Array(l,i,1)[0]===kF){const j=new Uint32Array(l,i);let R=2;const L=(j[R++]>>2)-3,W=j[R++]>>2;if(R++,d.json=JSON.parse(PF.decode(j.subarray(R,R+W))),R+=W,R<L){const q=j[R++];R++;const J=i+(R<<2);d.buffers[0]=l.slice(J,J+q)}}else d.json=JSON.parse(PF.decode(new Uint8Array(l,i)));const{buffers:f,images:y,meshes:_,extensionsUsed:S,bufferViews:A}=d.json;let k=Promise.resolve();if(f){const j=[];for(let R=0;R<f.length;R++){const L=f[R];L.uri?j.push(Ine(L,d,R,a)):d.buffers[R]||(d.buffers[R]=null)}k=Promise.all(j)}return k.then(()=>{const j=[],R=S&&S.includes(kC),L=S&&S.includes(DS);if(R&&j.push(function(){if(!Jl)return OS??(OS=function(W){let q,J=null;function Q(){q=new Uint8Array(J.buffer)}function oe(){throw new Error("Unexpected Draco error.")}const de={a:{a:oe,d:function(he,fe,Ie){return q.copyWithin(he,fe,fe+Ie)},c:function(he){const fe=q.length,Ie=Math.max(he>>>0,Math.ceil(1.2*fe)),Ae=Math.ceil((Ie-fe)/65536);try{return J.grow(Ae),Q(),!0}catch{return!1}},b:oe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(W,de):W.then(he=>he.arrayBuffer()).then(he=>WebAssembly.instantiate(he,de))).then(he=>{const{Rb:fe,Qb:Ie,P:Ae,T:ke,X:Le,Ja:Be,La:at,Qa:Ge,Va:ft,Wa:wt,eb:xt,jb:At,f:kt,e:it,yb:Tt,zb:Xe,Ab:ot,Bb:It,Db:St,Gb:or}=he.instance.exports;J=it;const Kt=(()=>{let _t=0,Ct=0,rr=0,Bt=0;return Nt=>{rr&&(fe(Bt),fe(_t),Ct+=rr,rr=_t=0),_t||(Ct+=128,_t=Ie(Ct));const Ht=Nt.length+7&-8;let pr=_t;Ht>=Ct&&(rr=Ht,pr=Bt=Ie(Ht));for(let gr=0;gr<Nt.length;gr++)q[pr+gr]=Nt[gr];return pr}})();return Q(),kt(),{memory:it,_free:fe,_malloc:Ie,Mesh:class{constructor(){this.ptr=Ae()}destroy(){ke(this.ptr)}},Decoder:class{constructor(){this.ptr=Be()}destroy(){At(this.ptr)}DecodeArrayToMesh(_t,Ct,rr){const Bt=Kt(_t),Nt=at(this.ptr,Bt,Ct,rr.ptr);return!!Le(Nt)}GetAttributeByUniqueId(_t,Ct){return{ptr:Ge(this.ptr,_t.ptr,Ct)}}GetTrianglesUInt16Array(_t,Ct,rr){ft(this.ptr,_t.ptr,Ct,rr)}GetTrianglesUInt32Array(_t,Ct,rr){wt(this.ptr,_t.ptr,Ct,rr)}GetAttributeDataArrayForAllPoints(_t,Ct,rr,Bt,Nt){xt(this.ptr,_t.ptr,Ct.ptr,rr,Bt,Nt)}},DT_INT8:Tt(),DT_UINT8:Xe(),DT_INT16:ot(),DT_UINT16:It(),DT_UINT32:St(),DT_FLOAT32:or()}})}(fetch(TF())),OS.then(W=>{Jl=W,OS=void 0}))}()),L&&j.push(function(){if(AC)return;const W=function(q){let J;const Q=WebAssembly.instantiateStreaming(q,{}).then(he=>{J=he.instance,J.exports.__wasm_call_ctors()}),oe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},de={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Q,supported:!0,decodeGltfBuffer(he,fe,Ie,Ae,ke,Le){(function(Be,at,Ge,ft,wt,xt,At){const kt=Be.exports.sbrk,it=ft+3&-4,Tt=kt(it*wt),Xe=kt(xt.length),ot=new Uint8Array(Be.exports.memory.buffer);ot.set(xt,Xe);const It=at(Tt,ft,wt,Xe,xt.length);if(It===0&&At&&At(Tt,it,wt),Ge.set(ot.subarray(Tt,Tt+ft*wt)),kt(Tt-kt(0)),It!==0)throw new Error(`Malformed buffer data: ${It}`)})(J,J.exports[de[ke]],he,fe,Ie,Ae,J.exports[oe[Le]])}}}(fetch(EF()));return W.ready.then(()=>{AC=W})}()),y)for(let W=0;W<y.length;W++)j.push(Mne(y[W],d,W,a));return(j.length?Promise.all(j):Promise.resolve()).then(()=>{if(R&&_)for(const{primitives:W}of _)for(const q of W)Pne(q,d);if(L&&_&&A)for(const W of A)Cne(W,d);return d})})}function PC(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function CC(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class IC{constructor(i,a,d,f){this.context=i,this.format=d,this.useMipmap=f&&f.useMipmap,this.texture=i.gl.createTexture(),this.update(a,{premultiply:f&&f.premultiply})}update(i,a){const d=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,f=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:y}=this,{gl:_}=y,{x:S,y:A}=a&&a.position?a.position:{x:0,y:0},k=S+d,j=A+f;!this.size||this.size[0]===k&&this.size[1]===j||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!a||a.premultiply!==!1));const R=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&k>0&&j>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(k,j)))+1:1;_.texStorage2D(_.TEXTURE_2D,L,this.format,k,j),this.size=[k,j]}if(this.size)if(R)_.texSubImage2D(_.TEXTURE_2D,0,S,A,PC(this.format),CC(this.format),i);else{const L=i.data;L&&_.texSubImage2D(_.TEXTURE_2D,0,S,A,d,f,PC(this.format),CC(this.format),L)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(i,a,d=!1){const{context:f}=this,{gl:y}=f;y.bindTexture(y.TEXTURE_2D,this.texture),i!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap&&!d?i===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),a!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,a),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(i,a,d,f,y){const{context:_}=this,{gl:S}=_;S.bindTexture(S.TEXTURE_2D,this.texture),a!==this.magFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,a),this.magFilter=a),i!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,this.useMipmap?i===S.NEAREST?S.NEAREST_MIPMAP_NEAREST:S.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),d!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,d),this.wrapS=d),f!==this.wrapT&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,f),this.wrapT=f),y!==this.compareMode&&(y?(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_FUNC,y)):S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.NONE),this.compareMode=y)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class X0{constructor(i,a){this.context=i,this.texture=a}bind(i,a){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,i),this.minFilter=i),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrapS=a)}}const One=Yr([{name:"a_pos_3f",components:3,type:"Float32"}]),jne=Yr([{name:"a_color_3f",components:3,type:"Float32"}]),Rne=Yr([{name:"a_color_4f",components:4,type:"Float32"}]),Dne=Yr([{name:"a_uv_2f",components:2,type:"Float32"}]),Lne=Yr([{name:"a_normal_3f",components:3,type:"Float32"}]),zne=Yr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Nne=Yr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function OF(l,i){const a=LS(l.projection,l.zoom,l.width,l.height),d=function(y,_,S,A,k){const j=new H(S.lng-180*Cd,S.lat),R=new H(S.lng+180*Cd,S.lat),L=y.project(j.lng,j.lat),W=y.project(R.lng,R.lat),q=-Math.atan2(W.y-L.y,W.x-L.x),J=Ue.fromLngLat(S);J.y=xe(J.y,-1+Cd,1-Cd);const Q=J.toLngLat(),oe=y.project(Q.lng,Q.lat),de=Ue.fromLngLat(Q);de.x+=Cd;const he=de.toLngLat(),fe=y.project(he.lng,he.lat),Ie=RF(fe.x-oe.x,fe.y-oe.y,q),Ae=Ue.fromLngLat(Q);Ae.y+=Cd;const ke=Ae.toLngLat(),Le=y.project(ke.lng,ke.lat),Be=RF(Le.x-oe.x,Le.y-oe.y,q),at=Math.abs(Ie.x)/Math.abs(Be.y),Ge=N([]);ae(Ge,Ge,-q*(1-(k?0:A)));const ft=N([]);return X(ft,ft,[1,1-(1-at)*A,1]),ft[4]=-Be.x/Be.y*A,ae(ft,ft,q),U(ft,Ge,ft),ft}(l.projection,0,l.center,a,i),f=jF(l);return X(d,d,[f,f,1]),d}function jF(l){const i=l.projection,a=LS(l.projection,l.zoom,l.width,l.height),d=MC(i,l.center),f=MC(i,H.convert(i.center));return Math.pow(2,d*a+(1-a)*f)}function LS(l,i,a,d,f=1/0){const y=l.range;if(!y)return 0;const _=Math.min(f,Math.max(a,d)),S=Math.log(_/1024)/Math.LN2;return Fe(y[0]+S,y[1]+S,i)}const Cd=1/4e4;function MC(l,i){const a=xe(i.lat,-we,we),d=new H(i.lng-180*Cd,a),f=new H(i.lng+180*Cd,a),y=l.project(d.lng,a),_=l.project(f.lng,a),S=Ue.fromLngLat(d),A=Ue.fromLngLat(f),k=_.x-y.x,j=_.y-y.y,R=A.x-S.x,L=A.y-S.y,W=Math.sqrt((R*R+L*L)/(k*k+j*j));return Math.log(W)/Math.LN2}function RF(l,i,a){const d=Math.cos(a),f=Math.sin(a);return{x:l*d-i*f,y:l*f+i*d}}function DF(l,i,a){N(l),ae(l,l,Br(i[2])),Y(l,l,Br(i[0])),ne(l,l,Br(i[1])),X(l,l,a),U(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function zS(l,i,a,d,f,y,_,S){const A=[a[0]-i[0],a[1]-i[1],0],k=[d[0]-i[0],d[1]-i[1],0];if(Ye(A)<1e-12||Ye(k)<1e-12)return vs(l);const j=br([],A,k);Er(j,j),lt(k,d,i),A[2]=(y-f)*S,k[2]=(_-f)*S;const R=A;return br(R,A,k),Er(R,R),Ya(l,j,R)}function OC(l,i,a=!1){const d=Ad(i.zoom),f=function(y,_,S){const A=_.worldSize,k=[y[12],y[13],y[14]],j=me(k[1]/A),R=pe(k[0]/A),L=N([]),W=ue(1,j)*A,q=ue(1,0)*A*be(j,_.zoom),J=1/oC(A);let Q=q*J;if(S){const fe=LS(_.projection,_.zoom,_.width,_.height,1024);Q=J*_.projection.pixelSpaceConversion(_.center.lat,A,fe)}const oe=M(j,R);We(oe,oe,mt([],Er([],oe),W*Q*k[2]));const de=function(fe){const Ie=[fe[0],fe[1],fe[2]];let Ae=[0,1,0];const ke=br([],Ae,Ie);return br(Ae,Ie,ke),xr(Ae)===0&&(Ae=[0,1,0],br(ke,Ie,Ae)),Er(ke,ke),Er(Ae,Ae),Er(Ie,Ie),[ke[0],ke[1],ke[2],0,Ae[0],Ae[1],Ae[2],0,Ie[0],Ie[1],Ie[2],0,fe[0],fe[1],fe[2],1]}(oe);X(L,L,[Q,Q,Q*W]),V(L,L,[-k[0],-k[1],-k[2]]);const he=U([],_.globeMatrix,de);return U(he,he,L),U(he,he,y),he}(l,i,a);if(d>0){const y=function(_,S){const A=S.worldSize,k=ue(1,0)*A*be(S.center.lat,S.zoom)/oC(A),j=ue(1,S.center.lat)*A,R=N([]);return ne(R,R,Br(S.center.lng)),Y(R,R,Br(S.center.lat)),V(R,R,[0,0,Zs]),X(R,R,[k,k,k*j]),V(R,R,[S.point.x-.5*A,S.point.y-.5*A,0]),U(R,R,_),U(R,S.globeMatrix,R)}(l,i);return function(_,S,A){const k=(q,J,Q)=>{const oe=Ye(q),de=Ye(J),he=eh(q,J,Q);return mt(he,he,1/Ye(he)*lr(oe,de,Q))},j=k([_[0],_[1],_[2]],[S[0],S[1],S[2]],A),R=k([_[4],_[5],_[6]],[S[4],S[5],S[6]],A),L=k([_[8],_[9],_[10]],[S[8],S[9],S[10]],A),W=eh([_[12],_[13],_[14]],[S[12],S[13],S[14]],A);return[j[0],j[1],j[2],0,R[0],R[1],R[2],0,L[0],L[1],L[2],0,W[0],W[1],W[2],1]}(f,y,d)}return f}function LF(l,i,a,d){const f=kr.projectAabbCorners(d,a);let y=Number.MAX_VALUE,_=-1;for(let k=0;k<f.length;++k){const j=f[k];j[0]=(.5*j[0]+.5)*i.width,j[1]=(.5-.5*j[1])*i.height,j[2]<y&&(_=k,y=j[2])}const S=k=>new ut(f[k][0],f[k][1]);let A;switch(_){case 0:case 6:A=[S(1),S(5),S(4),S(7),S(3),S(2),S(1)];break;case 1:case 7:A=[S(0),S(4),S(5),S(6),S(2),S(3),S(0)];break;case 3:case 5:A=[S(1),S(0),S(4),S(7),S(6),S(2),S(1)];break;default:A=[S(1),S(5),S(6),S(7),S(3),S(0),S(1)]}if(Ei(l,A))return y}const Tp=64,Zg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function zF(l,i,a,d,f,y,_,S,A,k=!1){const j=a.zoom,R=a.project(d),L=be(d.lat,j),W=1/L;N(l),V(l,l,[R.x+_[0]*W,R.y+_[1]*W,_[2]]);let q=1,J=1;const Q=a.worldSize;if(k){if(a.projection.name==="mercator"){let fe=0;a.elevation&&(fe=a.elevation.getAtPointOrZero(new Ue(R.x/Q,R.y/Q),0));const Ie=Bi([],[R.x,R.y,fe,1],a.projMatrix)[3]/a.cameraToCenterDistance;q=Ie,J=Ie*be(a.center.lat,j)}else if(a.projection.name==="globe"){const fe=OC(l,a),Ie=[0,0,0,1];Bi(Ie,Ie,U([],a.projMatrix,fe));const Ae=Ie[3]/a.cameraToCenterDistance,ke=Ad(j),Le=a.projection.pixelsPerMeter(d.lat,Q)*be(d.lat,j),Be=a.projection.pixelsPerMeter(a.center.lat,Q)*be(a.center.lat,j);q=Ae/lr(Le,Ce(a.center.lat),ke),J=Ae*L/Le,q*=Be,J*=Be}}else q=W;X(l,l,[q,q,J]);const oe=[...l],de=i.orientation,he=[];if(DF(he,[de[0]+f[0],de[1]+f[1],de[2]+f[2]],y),U(l,oe,he),S&&a.elevation){let fe=0;const Ie=[];if(A&&a.elevation){fe=function(ke,Le,Be,at,Ge){const ft=Le.elevation;if(!ft)return 0;const wt=kr.projectAabbCorners(Be,at),xt=ue(1,Ge.lat)*Le.worldSize,At=function(Ct,rr){const Bt=[0,0,1],Nt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ht of Nt){const pr=Ct[Ht.corners[0]],gr=Ct[Ht.corners[1]],Cr=Ct[Ht.corners[2]],Ar=[gr[0]-pr[0],gr[1]-pr[1],rr*(gr[2]-pr[2])],Qr=br(Ar,Ar,[Cr[0]-pr[0],Cr[1]-pr[1],rr*(Cr[2]-pr[2])]);Er(Qr,Qr),Ht.dotProductWithUp=Ft(Qr,Bt)}return Nt.sort((Ht,pr)=>Ht.dotProductWithUp-pr.dotProductWithUp),Nt[0].corners}(wt,xt),kt=wt[At[0]],it=wt[At[1]],Tt=wt[At[2]],Xe=wt[At[3]],ot=ft.getAtPointOrZero(new Ue(kt[0]/Le.worldSize,kt[1]/Le.worldSize),0),It=ft.getAtPointOrZero(new Ue(it[0]/Le.worldSize,it[1]/Le.worldSize),0),St=ft.getAtPointOrZero(new Ue(Tt[0]/Le.worldSize,Tt[1]/Le.worldSize),0),or=ft.getAtPointOrZero(new Ue(Xe[0]/Le.worldSize,Xe[1]/Le.worldSize),0),Kt=(ot+or)/2,_t=(It+St)/2;return Kt>_t?It<St?zS(ke,it,Xe,kt,It,or,ot,xt):zS(ke,Tt,kt,Xe,St,ot,or,xt):ot<or?zS(ke,kt,it,Tt,ot,It,St,xt):zS(ke,Xe,Tt,it,or,St,It,xt),Math.max(Kt,_t)}(Ie,a,i.aabb,l,d);const Ae=U([],je([],Ie),he);U(l,oe,Ae)}else fe=a.elevation.getAtPointOrZero(new Ue(R.x/Q,R.y/Q),0);fe!==0&&(l[14]+=fe)}}function Y0(l,i,a=!1){l.uploaded||(l.gfxTexture=new IC(i,l.image,a?i.gl.R8:i.gl.RGBA8,{useMipmap:l.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function Fne(l,i,a){l.indexBuffer=i.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=i.createVertexBuffer(l.vertexArray,One.members,!1,!0),l.normalArray&&(l.normalBuffer=i.createVertexBuffer(l.normalArray,Lne.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=i.createVertexBuffer(l.texcoordArray,Dne.members,!1,!0)),l.colorArray&&(l.colorBuffer=i.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?jne:Rne).members,!1,!0)),l.featureArray&&(l.pbrBuffer=i.createVertexBuffer(l.featureArray,Nne.members,!0)),l.segments=ui.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const d=l.material;d.pbrMetallicRoughness.baseColorTexture&&Y0(d.pbrMetallicRoughness.baseColorTexture,i),d.pbrMetallicRoughness.metallicRoughnessTexture&&Y0(d.pbrMetallicRoughness.metallicRoughnessTexture,i),d.normalTexture&&Y0(d.normalTexture,i),d.occlusionTexture&&Y0(d.occlusionTexture,i,a),d.emissionTexture&&Y0(d.emissionTexture,i)}function jC(l,i,a){if(l.meshes)for(const d of l.meshes)Fne(d,i,a);if(l.children)for(const d of l.children)jC(d,i,a)}function NS(l){if(l.meshes)for(const i of l.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(l.children)for(const i of l.children)NS(i)}function RC(l){if(l.meshes)for(const a of l.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((i=a.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(l.children)for(const a of l.children)RC(a)}function Ep(l,i){const a=l.json.bufferViews[i.bufferView],d=RS[i.componentType];return new d(l.buffers[a.buffer],(i.byteOffset||0)+(a.byteOffset||0),i.count*(a.byteStride&&a.byteStride!==K0[i.type]*d.BYTES_PER_ELEMENT?a.byteStride/d.BYTES_PER_ELEMENT:K0[i.type]))}function DC(l,i,a,d){const f=RS[i.componentType],y=function(j){switch(j){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),_=l.json.bufferViews[i.bufferView],S=_.byteStride?_.byteStride/f.BYTES_PER_ELEMENT:K0[i.type],A=a.float32,k=A.length/a.capacity;for(let j=0,R=0;j<i.count*S;j+=S,R+=k)for(let L=0;L<k;L++)A[R+L]=d[j+L]*y;a._trim()}function Bne(l,i,a){const d=l.indices,f=l.attributes,y={};y.indexArray=new ii;const _=i.json.accessors[d],S=_.count/3;y.indexArray.reserve(S);const A=Ep(i,_);for(let L=0;L<S;L++)y.indexArray.emplaceBack(A[3*L],A[3*L+1],A[3*L+2]);y.indexArray._trim(),y.vertexArray=new oa;const k=i.json.accessors[f.POSITION];y.vertexArray.reserve(k.count);const j=Ep(i,k);for(let L=0;L<k.count;L++)y.vertexArray.emplaceBack(j[3*L],j[3*L+1],j[3*L+2]);if(y.vertexArray._trim(),y.aabb=new kr(k.min,k.max),y.centroid=function(L,W){const q=[0,0,0],J=L.length;if(J>0){for(let Q=0;Q<J;Q++){const oe=3*L[Q];q[0]+=W[oe],q[1]+=W[oe+1],q[2]+=W[oe+2]}q[0]/=J,q[1]/=J,q[2]/=J}return q}(A,j),f.COLOR_0!==void 0){const L=i.json.accessors[f.COLOR_0],W=K0[L.type],q=Ep(i,L);y.colorArray=W===3?new oa:new Yc,y.colorArray.resize(L.count),DC(i,L,y.colorArray,q)}if(f.NORMAL!==void 0){y.normalArray=new oa;const L=i.json.accessors[f.NORMAL];y.normalArray.resize(L.count);const W=Ep(i,L);DC(i,L,y.normalArray,W)}if(f.TEXCOORD_0!==void 0&&a.length>0){y.texcoordArray=new Jc;const L=i.json.accessors[f.TEXCOORD_0];y.texcoordArray.resize(L.count);const W=Ep(i,L);DC(i,L,y.texcoordArray,W)}if(f._FEATURE_ID_RGBA4444!==void 0){const L=i.json.accessors[f._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(y.featureData=Ep(i,L))}f._FEATURE_RGBA4444!==void 0&&(y.featureData=new Uint32Array(Ep(i,i.json.accessors[f._FEATURE_RGBA4444]).buffer));const R=l.material;return y.material=function(L,W){const{emissiveFactor:q=[0,0,0],alphaMode:J="OPAQUE",alphaCutoff:Q=.5,normalTexture:oe,occlusionTexture:de,emissiveTexture:he,doubleSided:fe}=L,{baseColorFactor:Ie=[1,1,1,1],metallicFactor:Ae=1,roughnessFactor:ke=1,baseColorTexture:Le,metallicRoughnessTexture:Be}=L.pbrMetallicRoughness||{},at=de?W[de.index]:void 0;if(de&&de.extensions&&de.extensions.KHR_texture_transform&&at){const Ge=de.extensions.KHR_texture_transform;at.offsetScale=[Ge.offset[0],Ge.offset[1],Ge.scale[0],Ge.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Tn(...Ie),metallicFactor:Ae,roughnessFactor:ke,baseColorTexture:Le?W[Le.index]:void 0,metallicRoughnessTexture:Be?W[Be.index]:void 0},doubleSided:fe,emissiveFactor:new Tn(...q),alphaMode:J,alphaCutoff:Q,normalTexture:oe?W[oe.index]:void 0,occlusionTexture:at,emissionTexture:he?W[he.index]:void 0,defined:L.defined===void 0}}(R!==void 0?i.json.materials[R]:{defined:!1},a),y}function NF(l,i,a){const{matrix:d,rotation:f,translation:y,scale:_,mesh:S,extras:A,children:k}=l,j={};if(j.matrix=d||function(R,L,W,q){var J=L[0],Q=L[1],oe=L[2],de=L[3],he=J+J,fe=Q+Q,Ie=oe+oe,Ae=J*he,ke=J*fe,Le=J*Ie,Be=Q*fe,at=Q*Ie,Ge=oe*Ie,ft=de*he,wt=de*fe,xt=de*Ie,At=q[0],kt=q[1],it=q[2];return R[0]=(1-(Be+Ge))*At,R[1]=(ke+xt)*At,R[2]=(Le-wt)*At,R[3]=0,R[4]=(ke-xt)*kt,R[5]=(1-(Ae+Ge))*kt,R[6]=(at+ft)*kt,R[7]=0,R[8]=(Le+wt)*it,R[9]=(at-ft)*it,R[10]=(1-(Ae+Be))*it,R[11]=0,R[12]=W[0],R[13]=W[1],R[14]=W[2],R[15]=1,R}([],f||[0,0,0,1],y||[0,0,0],_||[1,1,1]),S!==void 0){j.meshes=a[S];const R=j.anchor=[0,0];for(const L of j.meshes){const{min:W,max:q}=L.aabb;R[0]+=W[0]+q[0],R[1]+=W[1]+q[1]}R[0]=Math.floor(R[0]/j.meshes.length/2),R[1]=Math.floor(R[1]/j.meshes.length/2)}if(A&&(A.id&&(j.id=A.id),A.lights&&(j.lights=function(R){if(!R.length)return[];const L=function(oe){const de=atob(oe),he=new Uint8Array(de.length);for(let fe=0;fe<de.length;fe++)he[fe]=de.codePointAt(fe);return he}(R),W=[],q=L.length/24,J=new Uint16Array(L.buffer),Q=new Float32Array(L.buffer);for(let oe=0;oe<q;oe++){const de=J[2*oe*6]/30,he=J[2*oe*6+1]/30,fe=J[2*oe*6+10]/100,Ie=Q[6*oe+1],Ae=Q[6*oe+2],ke=Q[6*oe+3],Le=Q[6*oe+4],Be=ke-Ie,at=Le-Ae,Ge=Math.hypot(Be,at);W.push({pos:[Ie+.5*Be,Ae+.5*at,he],normal:[at/Ge,-Be/Ge,0],width:Ge,height:de,depth:fe,points:[Ie,Ae,ke,Le]})}return W}(A.lights))),k){const R=[];for(const L of k)R.push(NF(i.json.nodes[L],i,a));j.children=R}return j}function Vne(l){if(l.vertices.length===0||l.indices.length===0)return null;const i=new ES(l.vertices,l.indices,8,256),[a,d]=[i.min.clone(),i.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:i,min:a,max:d}}function Une(l){if(!l.extras||!l.extras.ground)return null;const i=l.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const a=i[0];if(!a||!Array.isArray(a)||a.length===0)return null;const d=[];for(const _ of a){if(!Array.isArray(_)||_.length!==2)continue;const S=_[0],A=_[1];typeof S=="number"&&typeof A=="number"&&d.push(new ut(S,A))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let f=0;for(let _=0;_<d.length;_++){const S=d[_],A=d[(_+1)%d.length],k=d[(_+2)%d.length];f+=(S.x-A.x)*(k.y-A.y)-(k.x-A.x)*(S.y-A.y)}f>0&&d.reverse();const y=Ug(d.flatMap(_=>[_.x,_.y]),[]);return y.length===0?null:{vertices:d,indices:y}}function $ne(l,i){const a=[],d=[];let f=0;const y=[];for(const _ of l){f=a.length;const S=_.vertexArray.float32,A=_.indexArray.uint16;for(let k=0;k<_.vertexArray.length;k++)y[0]=S[3*k+0],y[1]=S[3*k+1],y[2]=S[3*k+2],Qt(y,y,i),a.push(new ut(y[0],y[1]));for(let k=0;k<3*_.indexArray.length;k++)d.push(A[k]+f)}if(d.length%3!=0)return null;for(let _=0;_<d.length;_+=3){const S=a[d[_+0]],A=a[d[_+1]],k=a[d[_+2]];(S.x-A.x)*(k.y-A.y)-(k.x-A.x)*(S.y-A.y)>0&&([d[_+1],d[_+2]]=[d[_+2],d[_+1]])}return{vertices:a,indices:d}}function FF(l){const i=function(A,k){const j=[],R=WebGL2RenderingContext;if(A.json.textures)for(const L of A.json.textures){const W={magFilter:R.LINEAR,minFilter:R.NEAREST,wrapS:R.REPEAT,wrapT:R.REPEAT};L.sampler!==void 0&&Object.assign(W,A.json.samplers[L.sampler]),j.push({image:k[L.source],sampler:W,uploaded:!1})}return j}(l,l.images),a=function(A,k){const j=[];for(const R of A.json.meshes){const L=[];for(const W of R.primitives)L.push(Bne(W,A,k));j.push(L)}return j}(l,i),{scenes:d,scene:f,nodes:y}=l.json,_=d?d[f||0].nodes:y,S=[];for(const A of _)S.push(NF(y[A],l,a));return function(A,k,j){const R={},L=new Set;for(let W=0;W<A.length;W++){const q=j[k[W]];if(!q.extras)continue;const J=q.extras["mapbox:footprint:version"],Q=q.extras["mapbox:footprint:id"];(J||Q)&&L.add(W),J==="1.0.0"&&Q&&(R[Q]=W)}for(let W=0;W<A.length;W++){if(L.has(W))continue;const q=A[W],J=j[k[W]];if(!J.extras)continue;let Q=null;q.id in R&&(Q=$ne(A[R[q.id]].meshes,q.matrix)),Q||(Q=Une(J)),Q&&(q.footprint=Vne(Q))}if(L.size>0){const W=Array.from(L.values()).sort((q,J)=>q-J);for(let q=W.length-1;q>=0;q--)A.splice(W[q],1)}}(S,_,l.json.nodes),S}function Gne(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const i=l.vertexArray.float32,a=l.aabb.min[0]-1,d=l.aabb.min[1]-1,f=Tp/(l.aabb.max[0]-a+2),y=Tp/(l.aabb.max[1]-d+2);for(let _=0;_<i.length;_+=3){const S=i[_+2],A=(i[_+0]-a)*f|0,k=(i[_+1]-d)*y|0;S>l.heightmap[k*Tp+A]&&(l.heightmap[k*Tp+A]=S)}}function BF(l,i,a,d,f){a.reserve(a.length+4*l.length),d.reserve(d.length+10*l.length),f.reserve(f.length+10*l.length);let y=d.length;for(const _ of l){const S=Math.min(10,Math.max(4,1.3*_.height))*i,A=[-_.normal[1],_.normal[0],0],k=Math.min(.29,.1*_.width/_.depth),j=_.width-2*_.depth*i*(k+.01),R=ct([],_.pos,A,j/2),L=ct([],_.pos,A,-j/2),W=[R[0],R[1],R[2]+_.height],q=[L[0],L[1],L[2]+_.height],J=ct([],_.normal,A,k);mt(J,J,S);const Q=ct([],_.normal,A,-k);mt(Q,Q,S),We(J,R,J),We(Q,L,Q),R[2]+=.1,L[2]+=.1,d.emplaceBack(J[0],J[1],J[2]),d.emplaceBack(Q[0],Q[1],Q[2]),d.emplaceBack(R[0],R[1],R[2]),d.emplaceBack(L[0],L[1],L[2]),d.emplaceBack(W[0],W[1],W[2]),d.emplaceBack(q[0],q[1],q[2]),d.emplaceBack(R[0],R[1],R[2]),d.emplaceBack(L[0],L[1],L[2]),d.emplaceBack(J[0],J[1],J[2]),d.emplaceBack(Q[0],Q[1],Q[2]);const oe=j/S/2;f.emplaceBack(-oe-k,-1,oe,.8),f.emplaceBack(oe+k,-1,oe,.8),f.emplaceBack(-oe,0,oe,1.3),f.emplaceBack(oe,0,oe,1.3),f.emplaceBack(oe+k,-.8,oe,.7),f.emplaceBack(oe+k,-.8,oe,.7),f.emplaceBack(0,0,oe,1.3),f.emplaceBack(0,0,oe,1.3),f.emplaceBack(oe+k,-1.2,oe,.8),f.emplaceBack(oe+k,-1.2,oe,.8),a.emplaceBack(6+y,4+y,8+y),a.emplaceBack(7+y,9+y,5+y),a.emplaceBack(0+y,1+y,2+y),a.emplaceBack(1+y,3+y,2+y),y+=10}}function Hne(l,i){const a={};a.indexArray=new ii,a.vertexArray=new oa,a.colorArray=new Yc,BF(l,i,a.indexArray,a.vertexArray,a.colorArray);const d={defined:!0};d.emissiveFactor=Tn.black;const f={};return f.baseColorFactor=Tn.white,d.pbrMetallicRoughness=f,a.material=d,a.aabb=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const VF=Yr([{name:"a_pos_3f",components:3,type:"Float32"}]),Wne=Yr([{name:"a_normal_3",components:3,type:"Int16"}]),UF=Yr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),qne=Yr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),$F=yt.types,LC=32767;function Zne(l,i){const a=Dt+i;for(const d of l)for(const f of d)if(f.x<-i||f.x>a||f.y<-i||f.y>a)return!1;return!0}class GF{constructor(i){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.layoutVertexArray=new oa,this.layoutNormalArray=new pd,this.layoutColorArray=new xl,this.indexArray=new ii,this.indexArrayForConflation=new ii,this.entranceBloom={layoutVertexArray:new oa,layoutVertexBuffer:null,layoutAttenuationArray:new Yc,layoutAttenuationBuffer:null,layoutColorArray:new xl,layoutColorBuffer:null,indexArray:new ii,indexArrayForConflation:new ii,indexBuffer:null,segmentsBucket:new ui},this.programConfigurations=new la(i.layers,{zoom:i.zoom,lut:i.lut}),this.segmentsBucket=new ui,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection,this.groundEffect=new bC(i)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(i,a){for(const d of this.footprints)a.push({footprint:d,id:i})}prepare(){return function(){if(jS!=null||SF!=null)return null;if(qg!=null)return qg;const i=fetch(Cs.BUILDING_GEN_URL);return qg=function(a){let d,f,y,_;function S(){d=new Uint8Array(_.buffer),f=new Int32Array(_.buffer),y=new Float32Array(_.buffer)}function A(){throw new Error("Unexpected BuildingGen error.")}const k=()=>{},j={a:{a:A,f:function(R){const L=d.length,W=Math.max(R>>>0,Math.ceil(1.2*L)),q=Math.ceil((W-L)/65536);try{return _.grow(q),S(),!0}catch{return!1}},g:A,b:k,c:k,d:k,e:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,j):a.then(R=>R.arrayBuffer()).then(R=>WebAssembly.instantiate(R,j))).then(R=>{const L=R.instance.exports;return(0,L.g)(),_=L.f,S(),new Ene({setStyle:L.h,setAOOptions:L.i,setMetricOptions:L.j,setStructuralOptions:L.k,setFacadeOptions:L.l,setFauxFacadeOptions:L.m,setFacadeClassifierOptions:L.n,addFeature:L.o,addFacade:L.p,generateMesh:L.q,getLastError:L.r,getMeshCount:L.s,getPositionsPtr:L.t,getPositionsLength:L.u,getNormalsPtr:L.v,getNormalsLength:L.w,getColorsPtr:L.x,getColorsLength:L.y,getAOPtr:L.z,getAOLength:L.A,getUVPtr:L.B,getUVLength:L.C,getFauxFacadePtr:L.D,getFauxFacadeLength:L.E,getIndicesPtr:L.F,getIndicesLength:L.G,getBuildingPart:L.H,getRingCount:L.I,getRingPtr:L.J,getRingLength:L.K,free:L.L,malloc:L.M,heapU8:d,heap32:f,heapF32:y})})}(i).then(a=>(qg=null,jS=a,jS)).catch(a=>{qr("Could not load building-gen"),qg=null,SF=a}),qg}()}populate(i,a,d,f){const y=Ane();if(!y)return;const _=Ee(d);this.tileToMeter=_,this.brightness=a.brightness,y.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,_],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:_,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),y.setAOOptions(!1,.3),y.setMetricOptions(!1,16),y.setStructuralOptions(!0),y.setFacadeOptions(4,!0),y.setFauxFacadeOptions(!1,!1,1),y.setFacadeClassifierOptions(3);const S=new Map;for(const{feature:A}of i){if($F[A.type]!=="LineString")continue;const k=this.layers[0]._featureFilter.needGeometry,j=Ze(A,k);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),j,d))continue;const R=k?j.geometry:nt(A,d,f),L=[];for(const Q of R)for(const oe of Q)L.push({x:oe.x,y:oe.y});const W={coordinates:L,crossPerc:A.properties.cross_perc,distanceToRoad:A.properties.distance_to_road,entrances:A.properties.entrances,sourceId:0},q=A.properties.source_id;let J=S.get(q);J||(J=[],S.set(q,J)),J.push(W)}this.maxHeight=0;for(const{feature:A,index:k}of i){if($F[A.type]==="LineString")continue;const j=this.layers[0]._featureFilter.needGeometry,R=Ze(A,j);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),R,d))continue;const L=j?R.geometry:nt(A,d,f),W=V0(L,500);if(!Zne(L,163))continue;const q=this.layers[0],J=q.layout.get("building-base").evaluate(A,{},d),Q=q.layout.get("building-height").evaluate(A,{},d),oe=q.layout.get("building-roof-shape").evaluate(A,{},d),de=q.paint.get("building-ambient-occlusion-intensity"),he=q.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(oe==="flat")continue;const fe=A.properties.source_id;let Ie;Ie=S.has(fe)?S.get(fe):[];const Ae=[],ke=new ut(1/0,1/0),Le=new ut(-1/0,-1/0);for(const _t of W)if(_t.length>0){const Ct=[];for(const rr of _t){const Bt=[];for(let Nt=rr.length-1;Nt>=0;Nt--){const Ht=rr[Nt];Bt.push({x:Ht.x,y:Ht.y}),ke.x=Math.min(ke.x,Ht.x),ke.y=Math.min(ke.y,Ht.y),Le.x=Math.max(Le.x,Ht.x),Le.y=Math.max(Le.y,Ht.y)}Ct.push(Bt)}Ae.push({id:A.id,height:Q,minHeight:J,sourceId:0,roofType:oe,coordinates:Ct})}const Be=y.generateMesh(Ae,Ie);if(typeof Be=="string"||Be.meshes.length===0||Be.modifiedPolygonRings.length===0)continue;let at=0;for(const _t of Be.meshes)at+=_t.positions.length/3;const Ge=this.segmentsBucket.prepareSegment(at,this.layoutVertexArray,this.indexArray),ft=[];let wt=null,xt=0,At=-1;const kt=this.indexArray.length;let it=0;for(const _t of Be.meshes){const Ct=this.layoutVertexArray.length;if(_t.buildingPart==="entrance"){const Bt=new Array;for(let gr=0;gr<_t.indices.length;gr+=12){const Cr=_t.positions[gr+0],Ar=_t.positions[gr+1],Qr=_t.positions[gr+3],Vr=_t.positions[gr+4],Kn=_t.positions[gr+2],_e=_t.positions[gr+8]-Kn,ve=1,st=Qr-Cr,Rt=Vr-Ar,zt=Math.hypot(st,Rt);Bt.push({pos:[Cr+.5*st,Ar+.5*Rt,Kn],normal:[Rt/zt,-st/zt,0],width:zt,height:_e,depth:ve,points:[Cr,Ar,Qr,Vr]})}const Nt=this.entranceBloom.segmentsBucket.prepareSegment(10*Bt.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),Ht=this.entranceBloom.layoutVertexArray.length;xt=this.entranceBloom.indexArray.length,BF(Bt,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const pr=this.entranceBloom.layoutVertexArray.length-Ht;At=this.entranceBloom.indexArray.length-xt;for(let gr=0;gr<pr;gr++)this.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Nt.vertexLength+=pr,Nt.primitiveLength+=At,wt={part:_t.buildingPart,vertexOffset:Ht,vertexLength:pr}}for(let Bt=0;Bt<_t.positions.length;Bt+=3)it=Math.max(it,_t.positions[Bt+2]),this.layoutVertexArray.emplaceBack(_t.positions[Bt],_t.positions[Bt+1],_t.positions[Bt+2]);for(let Bt=0;Bt<_t.normals.length;Bt+=3)this.layoutNormalArray.emplaceBack(_t.normals[Bt+0]*LC,_t.normals[Bt+1]*LC,_t.normals[Bt+2]*LC);for(let Bt=0;Bt<_t.ao.length;Bt++)this.layoutAOArray.push(_t.ao[Bt]);for(let Bt=0;Bt<_t.colors.length;Bt+=3){const Nt=1+(_t.ao[Bt/3]-1)*de;this.layoutColorArray.emplaceBack(_t.colors[Bt]*Nt<<8|_t.colors[Bt+1]*Nt,_t.colors[Bt+2]*Nt<<8)}const rr=Ge.vertexLength;for(let Bt=0;Bt<_t.indices.length;Bt+=3)this.indexArray.emplaceBack(rr+_t.indices[Bt],rr+_t.indices[Bt+1],rr+_t.indices[Bt+2]);Ge.vertexLength+=_t.positions.length/3,Ge.primitiveLength+=_t.indices.length/3,(_t.buildingPart==="roof"||_t.buildingPart==="wall"||_t.buildingPart==="facade_glazing"||_t.buildingPart==="entrance")&&ft.push({part:_t.buildingPart,vertexOffset:Ct,vertexLength:_t.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,it),this.buildingFeatures.push({feature:R,segment:Ge,parts:ft,buildingBloom:wt});const Tt=this.indexArray.length-kt,Xe=[],ot=[],It=new ut(1/0,1/0),St=new ut(-1/0,-1/0),or=this.groundEffect.vertexArray.length;for(const _t of Be.modifiedPolygonRings){const Ct=[],rr=new ut(1/0,1/0),Bt=new ut(-1/0,-1/0);for(let Nt=0;Nt<_t.length;Nt+=2){const Ht=_t.length-Nt-2;rr.x=Math.min(rr.x,_t[Ht]),rr.y=Math.min(rr.y,_t[Ht+1]),Bt.x=Math.max(Bt.x,_t[Ht]),Bt.y=Math.max(Bt.y,_t[Ht+1]);const pr=new ut(_t[Ht],_t[Ht+1]);Ct.push(pr),Xe.push(pr.x,pr.y),ot.push(pr.clone())}It.x=Math.min(It.x,rr.x),It.y=Math.min(It.y,rr.y),St.x=Math.max(St.x,Bt.x),St.y=Math.max(St.y,Bt.y),this.groundEffect.addData(Ct,[rr,Bt],he)}const Kt=this.groundEffect.vertexArray.length-or;(ke.x<0||Le.x>Dt||ke.y<0||Le.y>Dt)&&this.featuresOnBorder.push({featureId:A.id,footprintIndex:this.footprints.length});{const _t=Ug(Xe,null,2),Ct=new ES(ot,_t,8,256);let rr=A.id;A.properties&&A.properties.hasOwnProperty("building_id")&&(rr=A.properties.building_id),this.footprints.push({vertices:ot,indices:_t,grid:Ct,min:It,max:St,buildingId:rr,hiddenFlags:0,indicesOffset:kt,indicesLength:Tt,bloomIndicesOffset:xt,bloomIndicesLength:At,groundEffectVertexOffset:or,groundEffectVertexLength:Kt,segment:Ge,height:it})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,k,{},a.availableImages,d,a.brightness),this.groundEffect.addPaintPropertiesData(A,k,{},a.availableImages,d,a.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(i,a,d,f,y,_,S){this.programConfigurations.updatePaintArrays(i,a,y,d,f,_,S),this.groundEffect.update(i,a,y,d,f,_,S)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,VF.members),this.layoutNormalBuffer=i.createVertexBuffer(this.layoutNormalArray,Wne.members),this.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(this.entranceBloom.layoutVertexArray,VF.members),this.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,qne.members),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(i,a,d=!0){let f=!1;const y=d?a:0,_=0|(d?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const S of i){const A=this.footprints[S],k=A.hiddenFlags&_|y;A.hiddenFlags!==k&&(A.hiddenFlags=k,f=!0,this.groundEffect.updateHiddenByLandmarkRange(A.groundEffectVertexOffset,A.groundEffectVertexLength,A.hiddenFlags!==0))}return f&&(this.indexArrayForConflationUploaded=!1),f}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),!this.indexArrayForConflationUploaded&&this.indexArray.length!==0){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const a of this.footprints){const d=a.indicesOffset+a.indicesLength;if(a.hiddenFlags!==0){for(let y=a.indicesOffset;y<d;y++)this.indexArrayForConflation.uint16[3*y+0]=0,this.indexArrayForConflation.uint16[3*y+1]=0,this.indexArrayForConflation.uint16[3*y+2]=0;const f=a.bloomIndicesOffset+a.bloomIndicesLength;for(let y=a.bloomIndicesOffset;y<f;y++)this.entranceBloom.indexArrayForConflation.uint16[3*y+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*y+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*y+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=i.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=i.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(i){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=i.createVertexBuffer(this.layoutColorArray,UF.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=i.createVertexBuffer(this.entranceBloom.layoutColorArray,UF.members,!0)}evaluate(i){const a=i.paint.get("building-ambient-occlusion-intensity");for(const d of this.buildingFeatures){const f=d.feature;f.properties["building-part"]="roof";const y=i.paint.get("building-color").evaluate(f,{},this.canonical),_=i.paint.get("building-emissive-strength").evaluate(f,{},this.canonical);f.properties["building-part"]="wall";const S=i.paint.get("building-color").evaluate(f,{},this.canonical),A=i.paint.get("building-emissive-strength").evaluate(f,{},this.canonical);f.properties["building-part"]="window";const k=i.paint.get("building-color").evaluate(f,{},this.canonical),j=i.paint.get("building-emissive-strength").evaluate(f,{},this.canonical);f.properties["building-part"]="door";const R=i.paint.get("building-color").evaluate(f,{},this.canonical),L=i.paint.get("building-emissive-strength").evaluate(f,{},this.canonical);for(const q of d.parts){let J,Q=y;q.part==="roof"?(Q=y,J=_):q.part==="wall"?(Q=S,J=A):q.part==="facade_glazing"?(Q=k,J=j):q.part==="entrance"&&(Q=R,J=L),J=xe(J,0,1);for(let oe=0;oe<q.vertexLength;oe++){const de=q.vertexOffset+oe,he=1+(this.layoutAOArray[de]-1)*a;this.layoutColorArray.emplace(de,Q.r*he*255<<8|Q.g*he*255,Q.b*he*255<<8|255*J)}}const W=d.buildingBloom;if(W)for(let q=0;q<W.vertexLength;q++)this.bloomGeometry.layoutColorArray.emplace(W.vertexOffset+q,255*R.r<<8|255*R.g,255*R.b<<8|51*L)}}needsEvaluation(i,a){const d=i.transform.projectionOptions,f=i.style.getBrightness();return!(this.uploaded&&d.name===this.projection.name&&this.brightness===f||(this.projection=d,this.brightness=f,0))}updateReplacement(i,a,d){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const f=a.getReplacementRegionsForTile(i.toUnwrapped());if(kS(this.activeReplacements,f))return;this.activeReplacements=f;for(const _ of this.footprints)_.hiddenFlags&=-2;const y=[];for(const _ of this.activeReplacements){if(_.order<=KN)continue;const S=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));for(const A of this.footprints)A.min.x>_.max.x||A.max.x<_.min.x||A.min.y>_.max.y||A.max.y<_.min.y||(y.length=0,Kne(A.vertices,0,A.vertices.length,_.footprintTileId.canonical,i.canonical,y),yC(_.footprint,y,A.indices,0,A.indices.length,0,-S)&&(A.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(i,a){let d=Number.NEGATIVE_INFINITY,f=!0;const y=4*(i+Dt)*Dt+(a+Dt);if(this.footprintLookup.hasOwnProperty(y)){const S=this.footprintLookup[y];return S?{height:S.height,hidden:S.hiddenFlags!==0}:void 0}const _=new ut(i,a);for(const S of this.footprints)i>S.max.x||S.min.x>i||a>S.max.y||S.min.y>a||S.height<=d||_C(_,S)&&(d=S.height,this.footprintLookup[y]=S,f=S.hiddenFlags!==0);if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:f};this.footprintLookup[y]=void 0}}function Kne(l,i,a,d,f,y){const _=Math.pow(2,d.z-f.z);for(let S=0;S<a;S++){let A=l[S+i].x,k=l[S+i].y;A=(A+f.x*Dt)*_-d.x*Dt,k=(k+f.y*Dt)*_-d.y*Dt,y.push(new ut(A,k))}}let HF,WF;qt(GF,"BuildingBucket",{omit:["layers"]});const Xne=Yr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Yne=Yr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Jne}=Xne,Qne=Yr([{name:"a_packed",components:3,type:"Float32"}]),{members:eie}=Qne,tie=Yr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:rie}=tie;class qF{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new kd({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const d=this.getKey(i,a);return this.positions[d]}trim(){const i=this.width,a=this.height=ar(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,d){const f=[];let y=i.length%2==1?-i[i.length-1]*d:0,_=i[0]*d,S=!0;f.push({left:y,right:_,isDash:S,zeroLength:i[0]===0});let A=i[0];for(let k=1;k<i.length;k++){S=!S;const j=i[k];y=A*d,A+=j,_=A*d,f.push({left:y,right:_,isDash:S,zeroLength:j===0})}return f}addRoundDash(i,a,d){const f=a/2;for(let y=-d;y<=d;y++){const _=this.width*(this.nextRow+d+y);let S=0,A=i[S];for(let k=0;k<this.width;k++){k/A.right>1&&(A=i[++S]);const j=Math.abs(k-A.left),R=Math.abs(k-A.right),L=Math.min(j,R);let W;const q=y/d*(f+1);if(A.isDash){const J=f-Math.abs(q);W=Math.sqrt(L*L+J*J)}else W=f-Math.sqrt(L*L+q*q);this.image.data[_+k]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(i,a){for(let A=i.length-1;A>=0;--A){const k=i[A],j=i[A+1];k.zeroLength?i.splice(A,1):j&&j.isDash===k.isDash&&(j.left=k.left,i.splice(A,1))}const d=i[0],f=i[i.length-1];d.isDash===f.isDash&&(d.left=f.left-this.width,f.right=d.right+this.width);const y=this.width*this.nextRow;let _=0,S=i[_];for(let A=0;A<this.width;A++){A/S.right>1&&(S=i[++_]);const k=Math.abs(A-S.left),j=Math.abs(A-S.right),R=Math.min(k,j);this.image.data[y+A]=Math.max(0,Math.min(255,(S.isDash?R:-R)+a+128))}}addDash(i,a){const d=this.getKey(i,a);if(this.positions[d])return this.positions[d];const f=a==="round",y=f?7:0,_=2*y+1;if(this.nextRow+_>this.height)return qr("LineAtlas out of space"),null;i.length===0&&i.push(1);let S=0;for(let j=0;j<i.length;j++)i[j]<0&&(qr("Negative value is found in line dasharray, replacing values with 0"),i[j]=0),S+=i[j];if(S!==0){const j=this.width/S,R=this.getDashRanges(i,this.width,j);f?this.addRoundDash(R,j,y):this.addRegularDash(R,a==="square"?.5*j:0)}const A=this.nextRow+y;this.nextRow+=_;const k={tl:[A,y],br:[S,0]};return this.positions[d]=k,k}}qt(qF,"LineAtlas");const nie=yt.types,iie=Math.cos(Math.PI/180*37.5),sie=Math.cos(Math.PI/180*5);class zC{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Og,this.layoutVertexArray2=new oa,this.patternVertexArray=new oa,this.indexArray=new ii,this.programConfigurations=new la(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new ui,this.maxLineLength=0,this.zOffsetVertexArray=new oa,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:Dt/64,this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,d,f){this.hasPattern=hC("line",this.layers,this.pixelRatio,a);const y=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ee(d);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const L=this.layers[0].layout.get("line-z-offset"),W=L.isConstant()&&!L.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&W?"none":"offset",this.elevationType==="offset"&&_==="none"&&qr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&S!==void 0;const A=[];for(const{feature:L,id:W,index:q,sourceLayerIndex:J}of i){const Q=this.layers[0]._featureFilter.needGeometry,oe=Ze(L,Q);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),oe,d))continue;const de=y?y.evaluate(oe,{},d):void 0,he={id:W,properties:L.properties,type:L.type,sourceLayerIndex:J,index:q,geometry:Q?oe.geometry:nt(L,d,f),patterns:{},sortKey:de};A.push(he)}y&&A.sort((L,W)=>L.sortKey-W.sortKey);const{lineAtlas:k,featureIndex:j}=a,R=this.addConstantDashes(k);for(const L of A){const{geometry:W,index:q,sourceLayerIndex:J}=L;if(R&&this.addFeatureDashes(L,k),this.hasPattern){const Q=dC("line",this.layers,L,this.zoom,this.pixelRatio,a);this.patternFeatures.push(Q)}else this.addFeature(L,W,q,d,k.positions,a.availableImages,a.brightness,a.elevationFeatures);j.insert(i[q].feature,W,q,J,this.index)}}addConstantDashes(i){let a=!1;for(const d of this.layers){const f=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(f.kind!=="constant"||y.kind!=="constant")a=!0;else{const _=y.value,S=f.value;if(!S)continue;i.addDash(S,_)}}return a}addFeatureDashes(i,a){const d=this.zoom;for(const f of this.layers){const y=f.paint.get("line-dasharray").value,_=f.layout.get("line-cap").value;if(y.kind==="constant"&&_.kind==="constant")continue;let S,A;if(y.kind==="constant"){if(S=y.value,!S)continue}else S=y.evaluate({zoom:d},i);A=_.kind==="constant"?_.value:_.evaluate({zoom:d},i),a.addDash(S,A),i.patterns[f.id]=[a.getKey(S,A)]}}update(i,a,d,f,y,_,S,A){this.programConfigurations.updatePaintArrays(i,a,y,d,f,_,S,A)}addFeatures(i,a,d,f,y,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,d,f,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,eie)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,rie)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,Yne.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Jne),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,a,d,f,y,_,S,A){const k=this.layers[0].layout,j=k.get("line-join").evaluate(i,{}),R=k.get("line-cap").evaluate(i,{}),L=k.get("line-miter-limit"),W=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i,this.zOffsetValue=k.get("line-z-offset").value;const q=this.layers[0].paint.get("line-width").value;if(q.kind!=="constant"&&q.isLineProgressConstant===!1&&(this.variableWidthValue=q),this.elevationType==="road"){const J=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,a,f,A,j,R,L,W)){const[Q,oe]=this.clipRuntimeLinesToTile(a,1);for(let de=0;de<Q.length;de++){const he=Q[de],fe=oe[de],Ie={progress:{min:fe.progress.min,max:fe.progress.max},nextDir:this.computeSegNextDir(fe,he),prevDir:this.computeSegPrevDir(fe,he)};this.addLine(he,i,f,j,R,L,W,Ie)}this.fillNonElevatedRoadSegment(J)}}else for(const J of a)this.addLine(J,i,f,j,R,L,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,y,_,f,S,void 0,this.worldview)}computeSegNextDir(i,a){return i.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(i,a){return a[1].sub(i.prevPoint).unit()}clipLinesToTile(i,a){return IS(i,-a,-a,Dt+a,Dt+a)}clipRuntimeLinesToTile(i,a){const d=[];return[IS(i,-a,-a,Dt+a,Dt+a,d),d]}addElevatedRoadFeature(i,a,d,f,y,_,S,A){const k=[],j=rn.getElevationFeature(i,f);if(j){const R=this.clipLinesToTile(a,1),L=this.prepareElevatedLines(R,j,d);for(const W of L)k.push({geometry:W,elevation:j,elevationTileID:d,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(k.length===0)return!1;for(const R of k){const L=this.layoutVertexArray.length;this.addLine(R.geometry,i,d,y,_,S,A);const W=new xn(d,R.elevationTileID);if(R.elevation)for(let q=L;q<this.layoutVertexArray.length;q++){const J=new ut(this.layoutVertexArray.int16[6*q]>>1,this.layoutVertexArray.int16[6*q+1]>>1),Q=W.pointElevation(J,R.elevation,.05);this.updateHeightRange(Q),this.zOffsetVertexArray.emplaceBack(Q,0,0)}else this.fillNonElevatedRoadSegment(L)}return!0}prepareElevatedLines(i,a,d){if(a.constantHeight!=null)return i;const f=[],y=1/Ee(d);for(const _ of i)wne(_,new mn(a,y),0,f);return f}fillNonElevatedRoadSegment(i){for(let a=i;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,a,d,f,y,_,S,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const k=f==="none";this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const j=A&&A.progress.min>0,R=A&&A.progress.max<1;if(this.lineClips){let Le={min:this.lineClips.start,max:this.lineClips.end},Be=1;if(A){const ft=this.lineClips.end-this.lineClips.start;Le=function(wt,xt,At){return{min:Mf(wt.min,xt,At),max:Mf(wt.max,xt,At)}}(A.progress,{min:0,max:1},Le),ft>0&&(Be=(Le.max-Le.min)/ft)}const at=+a.properties.mapbox_clip_feature_len,Ge=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(at)||Number.isNaN(Ge)){for(let wt=0;wt<i.length-1;wt++)this.totalDistance+=i[wt].dist(i[wt+1]);const ft=this.totalDistance/(Le.max-Le.min);this.totalFeatureLength=Number.isFinite(ft)?ft:0,this.lineClips.start=Le.min,this.lineClips.end=Le.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=at,this.distance=Ge*Be,this.lineClips.start=Le.min,this.lineClips.end=Le.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const L=nie[a.type]==="Polygon";let W=i.length;for(;W>=2&&i[W-1].equals(i[W-2]);)W--;let q=0;for(;q<W-1&&i[q].equals(i[q+1]);)q++;if(W<(L?3:2))return;f==="bevel"&&(_=1.05);const J=this.segments.prepareSegment(10*W,this.layoutVertexArray,this.indexArray);let Q,oe,de,he,fe,Ie,Ae,ke;A&&A.prevDir&&(Ie=A.prevDir.perp()),A&&A.nextDir&&(Ae=A.nextDir.perp()),this.e1=this.e2=-1,L&&(Q=i[W-2],fe=i[q].sub(Q)._unit()._perp());for(let Le=q;Le<W;Le++){if(de=Le===W-1?L?i[q+1]:void 0:i[Le+1],de&&i[Le].equals(de))continue;fe&&(he=fe),Q&&(oe=Q),Q=i[Le],ke=this.evaluateLineProgressFeatures(oe?oe.dist(Q):0),fe=de?de.sub(Q)._unit()._perp():he,he=he||fe;const Be=oe&&de;let at=Be?f:L||k?"butt":y;const Ge=he.x*fe.x+he.y*fe.y;if(k){const Xe=function(ot){if(ot.patternJoinNone){const It=ot.segmentPoints.length/2,St=ot.lineSoFar-ot.segmentStart;for(let or=0;or<It;++or){const Kt=ot.segmentPoints[2*or+1],_t=Math.round(ot.segmentPoints[2*or])+.5+.25*Kt;ot.patternVertexArray.emplaceBack(_t,St,ot.segmentStart),ot.patternVertexArray.emplaceBack(_t,St,ot.segmentStart)}ot.segmentPoints.length=0}ot.e1=ot.e2=-1};if(Be&&Ge<sie){this.updateDistance(oe,Q),this.addCurrentVertex(Q,he,1,1,J,ke),Xe(this),this.addCurrentVertex(Q,fe,-1,-1,J,ke);continue}if(oe){if(!de){this.updateDistance(oe,Q),this.addCurrentVertex(Q,he,1,1,J,ke),Xe(this);continue}at="miter"}}let ft=he.add(fe);ft.x===0&&ft.y===0||ft._unit();const wt=ft.x*fe.x+ft.y*fe.y,xt=wt!==0?1/wt:1/0,At=2*Math.sqrt(2-2*wt),kt=wt<iie&&oe&&de,it=he.x*fe.y-he.y*fe.x>0,Tt=this.overscaling<=16?15*Dt/(512*this.overscaling):0;if(Be&&at==="round"){if(xt<S)at="miter";else if(xt<=2){const Xe=NC(Q,-10,Dt+10);at=this.elevationType==="offset"&&(Xe||this.hasCrossSlope)?"miter":"fakeround"}}if(at==="miter"&&xt>_&&(at="bevel"),at==="bevel"&&(xt>2&&(at="flipbevel"),xt<_&&(at="miter")),oe&&!(at==="miter"&&kt)&&this.updateDistance(oe,Q),at==="miter")if(kt){const Xe=Q.dist(oe);if(Xe>2*Tt){const It=Q.sub(Q.sub(oe)._mult(Tt/Xe)._round());this.updateDistance(oe,It),this.addCurrentVertex(It,he,0,0,J,ke),oe=It}this.updateDistance(oe,Q),ft._mult(xt),this.addCurrentVertex(Q,ft,0,0,J,ke);const ot=Q.dist(de);if(ot>2*Tt){const It=Q.add(de.sub(Q)._mult(Tt/ot)._round());this.updateDistance(Q,It),this.addCurrentVertex(It,fe,0,0,J,ke),Q=It}}else ft._mult(xt),this.addCurrentVertex(Q,ft,0,0,J,ke);else if(at==="flipbevel"){if(xt>100)ft=fe.mult(-1);else{const Xe=xt*he.add(fe).mag()/he.sub(fe).mag();ft._perp()._mult(Xe*(it?-1:1))}this.addCurrentVertex(Q,ft,0,0,J,ke),this.addCurrentVertex(Q,ft.mult(-1),0,0,J,ke)}else if(at==="bevel"||at==="fakeround"){ke!=null&&oe&&this.addCurrentVertex(Q,Ae||he,-1,-1,J,ke);const Xe=Q.dist(oe)<=2*Tt&&at!=="bevel",ot=ft.mult(it?1:-1);ot._mult(xt);const It=fe.mult(it?-1:1),St=he.mult(it?-1:1),or=this.evaluateLineProgressFeatures(this.distance);if(ke==null&&(this.addHalfVertex(Q,ot.x,ot.y,!1,!it,0,J,or),Xe||this.addHalfVertex(Q,ot.x+2*St.x,ot.y+2*St.y,!1,it,0,J,or)),at==="fakeround"){const Kt=Math.round(180*At/Math.PI/20);this.addHalfVertex(Q,St.x,St.y,!1,it,0,J,or);for(let _t=0;_t<Kt;_t++){let Ct=_t/Kt;if(Ct!==.5){const Bt=Ct-.5;Ct+=Ct*Bt*(Ct-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*Bt*Bt+(.848013+Ge*(.215638*Ge-1.06021)))}const rr=It.sub(St)._mult(Ct)._add(St)._unit();this.addHalfVertex(Q,rr.x,rr.y,!1,it,0,J,or)}this.addHalfVertex(Q,It.x,It.y,!1,it,0,J,or)}Xe||ke!=null||this.addHalfVertex(Q,ot.x+2*It.x,ot.y+2*It.y,!1,it,0,J,or),ke!=null&&de&&this.addCurrentVertex(Q,Ie||fe,1,1,J,ke)}else if(at==="butt")this.addCurrentVertex(Q,ft,0,0,J,ke);else if(at==="square"){if(!oe){const Xe=j?0:-1;this.addCurrentVertex(Q,ft,Xe,Xe,J,ke)}if(this.addCurrentVertex(Q,ft,0,0,J,ke),oe){const Xe=R?0:1;this.addCurrentVertex(Q,ft,Xe,Xe,J,ke)}}else if(at==="round"){if(oe){const Xe=!Be&&Ae?Ae:he;this.addCurrentVertex(Q,Xe,0,0,J,ke),!Be&&R||this.addCurrentVertex(Q,Xe,1,1,J,ke,!0)}if(de){const Xe=!Be&&Ie?Ie:fe;!Be&&j||this.addCurrentVertex(Q,Xe,-1,-1,J,ke,!0),this.addCurrentVertex(Q,Xe,0,0,J,ke)}}}}addVerticesTo(i,a,d,f,y,_,S,A,k,j){const R=(a.w-i.w)/this.tessellationStep|0;let L=0;const W=this.scaledDistance;if(R>1){this.lineSoFar=i.w;const J=(a.x-i.x)/R,Q=(a.y-i.y)/R,oe=(a.z-i.z)/R,de=(a.w-i.w)/R;for(let he=1;he<R;++he){i.x+=J,i.y+=Q,i.z+=oe,this.lineSoFar+=de,L+=de;const fe=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(i,d,f,j,!1,S,k,fe),this.addHalfVertex(i,y,_,j,!0,-A,k,fe)}}this.lineSoFar=a.w,this.scaledDistance=W;const q=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,d,f,j,!1,S,k,q),this.addHalfVertex(a,y,_,j,!0,-A,k,q)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):qr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(i,a,d,f,y,_,S=!1){const A=a.x+a.y*d,k=a.y-a.x*d,j=a.y*f-a.x,R=-a.y-a.x*f;if(_!=null){const L=this.elevationType==="offset",W=-10,q=Dt+10,J=_.zOffset,Q=new gF(i.x,i.y,J,this.lineSoFar),oe=!!L&&NC(i,W,q),de=this.lineSoFar,he=this.distance;if(this.currentVertex)if(oe){const fe=this.currentVertexIsOutside,Ie=this.currentVertex,Ae=new gF(i.x,i.y,J,this.lineSoFar);if(_F(Ie,Ae,W,q),!NC(Ae,W,q)){if(fe){this.e1=this.e2=-1,this.distance-=Ie.dist(Q),this.lineSoFar=Ie.w;const ke=this.evaluateLineProgressFeatures(Ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ie,A,k,S,!1,d,y,ke),this.addHalfVertex(Ie,j,R,S,!0,-f,y,ke),this.prevDistance=this.distance}this.distance=this.prevDistance+Ie.dist(Ae),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ie,Ae,A,k,j,R,d,f,y,S),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const fe=this.currentVertex;if(this.currentVertexIsOutside){_F(fe,Q,W,q),this.e1=this.e2=-1,this.distance-=fe.dist(Q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=fe.w;const Ie=this.evaluateLineProgressFeatures(fe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(fe,A,k,S,!1,d,y,Ie),this.addHalfVertex(fe,j,R,S,!0,-f,y,Ie),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(fe,Q,A,k,j,R,d,f,y,S)}else oe||(this.addHalfVertex(i,A,k,S,!1,d,y,_),this.addHalfVertex(i,j,R,S,!0,-f,y,_));this.currentVertex=Q,this.currentVertexIsOutside=oe,this.lineSoFar=de}else this.addHalfVertex(i,A,k,S,!1,d,y,_),this.addHalfVertex(i,j,R,S,!0,-f,y,_)}addHalfVertex({x:i,y:a},d,f,y,_,S,A,k){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((i<<1)+(y?1:0),(a<<1)+(_?1:0),Math.round(63*d)+128,Math.round(63*f)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const R=lr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,R)}const j=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),A.primitiveLength++),_?this.e2=j:this.e1=j,k!=null&&this.zOffsetVertexArray.emplaceBack(k.zOffset,k.variableWidth,k.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,a){this.prevDistance=this.distance,this.distance+=i.dist(a),this.updateScaledDistance()}}function NC(l,i,a){return l.x<i||l.x>a||l.y<i||l.y>a}let ZF,KF;function XF(l,i,a){return i*(Dt/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}qt(zC,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const YF=(l,i,a)=>(1-a)*l+a*i;function JF(l,i){return 1/XF(l,1,i.tileZoom)}function QF(l,i,a,d){return l.translatePosMatrix(d||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const e5=l=>{const i=[];t5(l)&&i.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const a=l.paint.get("line-trim-offset");a[0]===0&&a[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const d=l.layout.get("line-join").constantOr("miter")==="none",f=!!l.paint.get("line-pattern").constantOr(1);return d&&f&&i.push("LINE_JOIN_NONE"),i};function t5(l){const i=l.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}let FC;const r5=()=>FC||(FC={layout:ZF||(ZF=new wi({"line-cap":new $t($e.layout_line["line-cap"]),"line-join":new $t($e.layout_line["line-join"]),"line-miter-limit":new Mt($e.layout_line["line-miter-limit"]),"line-round-limit":new Mt($e.layout_line["line-round-limit"]),"line-sort-key":new $t($e.layout_line["line-sort-key"]),"line-z-offset":new $t($e.layout_line["line-z-offset"]),"line-elevation-reference":new Mt($e.layout_line["line-elevation-reference"]),"line-cross-slope":new Mt($e.layout_line["line-cross-slope"]),visibility:new Mt($e.layout_line.visibility),"line-width-unit":new Mt($e.layout_line["line-width-unit"])})),paint:KF||(KF=new wi({"line-opacity":new $t($e.paint_line["line-opacity"]),"line-color":new $t($e.paint_line["line-color"]),"line-translate":new Mt($e.paint_line["line-translate"]),"line-translate-anchor":new Mt($e.paint_line["line-translate-anchor"]),"line-width":new $t($e.paint_line["line-width"]),"line-gap-width":new $t($e.paint_line["line-gap-width"]),"line-offset":new $t($e.paint_line["line-offset"]),"line-blur":new $t($e.paint_line["line-blur"]),"line-dasharray":new $t($e.paint_line["line-dasharray"]),"line-pattern":new $t($e.paint_line["line-pattern"]),"line-pattern-cross-fade":new Mt($e.paint_line["line-pattern-cross-fade"]),"line-gradient":new ud($e.paint_line["line-gradient"]),"line-trim-offset":new Mt($e.paint_line["line-trim-offset"]),"line-trim-fade-range":new Mt($e.paint_line["line-trim-fade-range"]),"line-trim-color":new Mt($e.paint_line["line-trim-color"]),"line-emissive-strength":new Mt($e.paint_line["line-emissive-strength"]),"line-border-width":new $t($e.paint_line["line-border-width"]),"line-border-color":new $t($e.paint_line["line-border-color"]),"line-occlusion-opacity":new Mt($e.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},FC);class oie extends $t{possiblyEvaluate(i,a){return a=new On(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(i,a)}evaluate(i,a,d,f){return a=Qe({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(i,a,d,f)}}let J0;function n5(l,i){return i>0?i+2*l:l}const aie=Yr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lie=Yr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),cie=Yr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const uie=Yr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),hie=Yr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),die=Yr([{name:"a_texb",components:2,type:"Uint16"}]),fie=Yr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pie=Yr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const i5=Yr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mie=Yr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yr([{name:"triangle",components:3,type:"Uint16"}]),Yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Yr([{type:"Float32",name:"offsetX"}]),Yr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ss=24;function gie(l,i,a){return l.sections.forEach(d=>{d.text=function(f,y,_){const S=y.layout.get("text-transform").evaluate(_,{});return S==="uppercase"?f=f.toLocaleUpperCase():S==="lowercase"&&(f=f.toLocaleLowerCase()),_l.applyArabicShaping&&(f=_l.applyArabicShaping(f)),f}(d.text,i,a)}),l}const Q0={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function yie(l){return l==="︶"||l==="﹈"||l==="︸"||l==="﹄"||l==="﹂"||l==="︾"||l==="︼"||l==="︺"||l==="︘"||l==="﹀"||l==="︐"||l==="︓"||l==="︔"||l==="｀"||l==="￣"||l==="︑"||l==="︒"}function _ie(l){return l==="︵"||l==="﹇"||l==="︷"||l==="﹃"||l==="﹁"||l==="︽"||l==="︻"||l==="︹"||l==="︗"||l==="︿"}const BC=4294967296,s5=1/BC,o5=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let FS=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,i,a=this.length){for(;this.pos<a;){const d=this.readVarint(),f=d>>3,y=this.pos;this.type=7&d,l(f,i,this),this.pos===y&&this.skip(d)}return i}readMessage(l,i){return this.readFields(l,i,this.readVarint()+this.pos)}readFixed32(){const l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){const l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*BC;return this.pos+=8,l}readSFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*BC;return this.pos+=8,l}readFloat(){const l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){const l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){const i=this.buf;let a,d;return d=i[this.pos++],a=127&d,d<128?a:(d=i[this.pos++],a|=(127&d)<<7,d<128?a:(d=i[this.pos++],a|=(127&d)<<14,d<128?a:(d=i[this.pos++],a|=(127&d)<<21,d<128?a:(d=i[this.pos],a|=(15&d)<<28,function(f,y,_){const S=_.buf;let A,k;if(k=S[_.pos++],A=(112&k)>>4,k<128||(k=S[_.pos++],A|=(127&k)<<3,k<128)||(k=S[_.pos++],A|=(127&k)<<10,k<128)||(k=S[_.pos++],A|=(127&k)<<17,k<128)||(k=S[_.pos++],A|=(127&k)<<24,k<128)||(k=S[_.pos++],A|=(1&k)<<31,k<128))return vie(f,A,y);throw new Error("Expected varint not more than 10 bytes")}(a,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){const l=this.readVarint()+this.pos,i=this.pos;return this.pos=l,l-i>=12&&o5?o5.decode(this.buf.subarray(i,l)):function(a,d,f){let y="",_=d;for(;_<f;){const S=a[_];let A,k,j,R=null,L=S>239?4:S>223?3:S>191?2:1;if(_+L>f)break;L===1?S<128&&(R=S):L===2?(A=a[_+1],(192&A)==128&&(R=(31&S)<<6|63&A,R<=127&&(R=null))):L===3?(A=a[_+1],k=a[_+2],(192&A)==128&&(192&k)==128&&(R=(15&S)<<12|(63&A)<<6|63&k,(R<=2047||R>=55296&&R<=57343)&&(R=null))):L===4&&(A=a[_+1],k=a[_+2],j=a[_+3],(192&A)==128&&(192&k)==128&&(192&j)==128&&(R=(15&S)<<18|(63&A)<<12|(63&k)<<6|63&j,(R<=65535||R>=1114112)&&(R=null))),R===null?(R=65533,L=1):R>65535&&(R-=65536,y+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),y+=String.fromCharCode(R),_+=L}return y}(this.buf,i,l)}readBytes(){const l=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,l);return this.pos=l,i}readPackedVarint(l=[],i){const a=this.readPackedEnd();for(;this.pos<a;)l.push(this.readVarint(i));return l}readPackedSVarint(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFloat());return l}readPackedDouble(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){const i=7&l;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(l,i){this.writeVarint(l<<3|i)}realloc(l){let i=this.length||16;for(;i<this.pos+l;)i*=2;if(i!==this.length){const a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*s5),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*s5),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?function(i,a){let d,f;if(i>=0?(d=i%4294967296|0,f=i/4294967296|0):(d=~(-i%4294967296),f=~(-i/4294967296),4294967295^d?d=d+1|0:(d=0,f=f+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(y,_,S){S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,S.buf[S.pos]=127&(y>>>=7)}(d,0,a),function(y,_){const S=(7&y)<<4;_.buf[_.pos++]|=S|((y>>>=3)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y)))))}(f,a)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;const i=this.pos;this.pos=function(d,f,y){for(let _,S,A=0;A<f.length;A++){if(_=f.charCodeAt(A),_>55295&&_<57344){if(!S){_>56319||A+1===f.length?(d[y++]=239,d[y++]=191,d[y++]=189):S=_;continue}if(_<56320){d[y++]=239,d[y++]=191,d[y++]=189,S=_;continue}_=S-55296<<10|_-56320|65536,S=null}else S&&(d[y++]=239,d[y++]=191,d[y++]=189,S=null);_<128?d[y++]=_:(_<2048?d[y++]=_>>6|192:(_<65536?d[y++]=_>>12|224:(d[y++]=_>>18|240,d[y++]=_>>12&63|128),d[y++]=_>>6&63|128),d[y++]=63&_|128)}return y}(this.buf,l,this.pos);const a=this.pos-i;a>=128&&a5(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){const i=l.length;this.writeVarint(i),this.realloc(i);for(let a=0;a<i;a++)this.buf[this.pos++]=l[a]}writeRawMessage(l,i){this.pos++;const a=this.pos;l(i,this);const d=this.pos-a;d>=128&&a5(a,d,this),this.pos=a-1,this.writeVarint(d),this.pos+=d}writeMessage(l,i,a){this.writeTag(l,2),this.writeRawMessage(i,a)}writePackedVarint(l,i){i.length&&this.writeMessage(l,xie,i)}writePackedSVarint(l,i){i.length&&this.writeMessage(l,bie,i)}writePackedBoolean(l,i){i.length&&this.writeMessage(l,Tie,i)}writePackedFloat(l,i){i.length&&this.writeMessage(l,wie,i)}writePackedDouble(l,i){i.length&&this.writeMessage(l,Sie,i)}writePackedFixed32(l,i){i.length&&this.writeMessage(l,Eie,i)}writePackedSFixed32(l,i){i.length&&this.writeMessage(l,Aie,i)}writePackedFixed64(l,i){i.length&&this.writeMessage(l,kie,i)}writePackedSFixed64(l,i){i.length&&this.writeMessage(l,Pie,i)}writeBytesField(l,i){this.writeTag(l,2),this.writeBytes(i)}writeFixed32Field(l,i){this.writeTag(l,5),this.writeFixed32(i)}writeSFixed32Field(l,i){this.writeTag(l,5),this.writeSFixed32(i)}writeFixed64Field(l,i){this.writeTag(l,1),this.writeFixed64(i)}writeSFixed64Field(l,i){this.writeTag(l,1),this.writeSFixed64(i)}writeVarintField(l,i){this.writeTag(l,0),this.writeVarint(i)}writeSVarintField(l,i){this.writeTag(l,0),this.writeSVarint(i)}writeStringField(l,i){this.writeTag(l,2),this.writeString(i)}writeFloatField(l,i){this.writeTag(l,5),this.writeFloat(i)}writeDoubleField(l,i){this.writeTag(l,1),this.writeDouble(i)}writeBooleanField(l,i){this.writeVarintField(l,+i)}};function vie(l,i,a){return a?4294967296*i+(l>>>0):4294967296*(i>>>0)+(l>>>0)}function a5(l,i,a){const d=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(d);for(let f=a.pos-1;f>=l;f--)a.buf[f+d]=a.buf[f]}function xie(l,i){for(let a=0;a<l.length;a++)i.writeVarint(l[a])}function bie(l,i){for(let a=0;a<l.length;a++)i.writeSVarint(l[a])}function wie(l,i){for(let a=0;a<l.length;a++)i.writeFloat(l[a])}function Sie(l,i){for(let a=0;a<l.length;a++)i.writeDouble(l[a])}function Tie(l,i){for(let a=0;a<l.length;a++)i.writeBoolean(l[a])}function Eie(l,i){for(let a=0;a<l.length;a++)i.writeFixed32(l[a])}function Aie(l,i){for(let a=0;a<l.length;a++)i.writeSFixed32(l[a])}function kie(l,i){for(let a=0;a<l.length;a++)i.writeFixed64(l[a])}function Pie(l,i){for(let a=0;a<l.length;a++)i.writeSFixed64(l[a])}const VC=3;function Cie(l,i,a){i.glyphs=[],l===1&&a.readMessage(Iie,i)}function Iie(l,i,a){if(l===3){const{id:d,bitmap:f,width:y,height:_,left:S,top:A,advance:k}=a.readMessage(Mie,{});i.glyphs.push({id:d,bitmap:new kd({width:y+2*VC,height:_+2*VC},f),metrics:{width:y,height:_,left:S,top:A,advance:k}})}else l===4?i.ascender=a.readSVarint():l===5&&(i.descender=a.readSVarint())}function Mie(l,i,a){l===1?i.id=a.readVarint():l===2?i.bitmap=a.readBytes():l===3?i.width=a.readVarint():l===4?i.height=a.readVarint():l===5?i.left=a.readSVarint():l===6?i.top=a.readSVarint():l===7&&(i.advance=a.readVarint())}const l5=VC,ha={horizontal:1,vertical:2,horizontalOnly:3};class ex{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,a){const d=new ex;return d.scale=i||1,d.fontStack=a,d}static forImage(i){const a=new ex;return a.image=i,a}}class Kg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a,d){const f=new Kg;for(let y=0;y<i.sections.length;y++){const _=i.sections[y];_.image?f.addImageSection(_,d):f.addTextSection(_,a)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(a,d){let f="";for(let y=0;y<a.length;y++){const _=a.charCodeAt(y+1)||null,S=a.charCodeAt(y-1)||null;f+=!d&&(_&&Eg(_)&&!Q0[a[y+1]]||S&&Eg(S)&&!Q0[a[y-1]])||!Q0[a[y]]?a[y]:Q0[a[y]]}return f}(this.text,i)}trim(){let i=0;for(let d=0;d<this.text.length&&BS[this.text.charCodeAt(d)];d++)i++;let a=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&BS[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const d=new Kg;return d.text=this.text.substring(i,a),d.sectionIndex=this.sectionIndex.slice(i,a),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(ex.forText(i.scale,i.fontStack||a));const d=this.sections.length-1;for(let f=0;f<i.text.length;++f)this.sectionIndex.push(d)}addImageSection(i,a){const d=i.image?i.image.getPrimary():null;if(!d)return void qr("Can't add FormattedSection with an empty image.");d.scaleSelf(a);const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCodePoint(f),this.sections.push(ex.forImage(d)),this.sectionIndex.push(this.sections.length-1)):qr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function UC(l,i,a,d,f,y,_,S,A,k,j,R,L,W,q,J=1){const Q=Kg.fromFeature(l,f,J);R===ha.vertical&&Q.verticalizePunctuation(L);let oe=[];const de=function(ke,Le,Be,at,Ge,ft){if(!ke)return[];const wt=[],xt=function(Tt,Xe,ot,It,St,or){let Kt=0;for(let _t=0;_t<Tt.length();_t++){const Ct=Tt.getSection(_t);Kt+=c5(Tt.getCodePoint(_t),Ct,It,St,Xe,or)}return Kt/Math.max(1,Math.ceil(Kt/ot))}(ke,Le,Be,at,Ge,ft),At=ke.text.indexOf("​")>=0;let kt=0;for(let Tt=0;Tt<ke.length();Tt++){const Xe=ke.getSection(Tt),ot=ke.getCodePoint(Tt);if(BS[ot]||(kt+=c5(ot,Xe,at,Ge,Le,ft)),Tt<ke.length()-1){const It=!((it=ot)<11904||!(hr["Bopomofo Extended"](it)||hr.Bopomofo(it)||hr["CJK Compatibility Forms"](it)||hr["CJK Compatibility Ideographs"](it)||hr["CJK Compatibility"](it)||hr["CJK Radicals Supplement"](it)||hr["CJK Strokes"](it)||hr["CJK Symbols and Punctuation"](it)||hr["CJK Unified Ideographs Extension A"](it)||hr["CJK Unified Ideographs"](it)||hr["Enclosed CJK Letters and Months"](it)||hr["Halfwidth and Fullwidth Forms"](it)||hr.Hiragana(it)||hr["Ideographic Description Characters"](it)||hr["Kangxi Radicals"](it)||hr["Katakana Phonetic Extensions"](it)||hr.Katakana(it)||hr["Vertical Forms"](it)||hr["Yi Radicals"](it)||hr["Yi Syllables"](it)));(Oie[ot]||It||Xe.image)&&wt.push(h5(Tt+1,kt,xt,wt,jie(ot,ke.getCodePoint(Tt+1),It&&At),!1))}}var it;return d5(h5(ke.length(),kt,xt,wt,0,!0))}(Q,k,y,i,d,W),{processBidirectionalText:he,processStyledBidirectionalText:fe}=_l;if(he&&Q.sections.length===1){const ke=he(Q.toString(),de);for(const Le of ke){const Be=new Kg;Be.text=Le,Be.sections=Q.sections;for(let at=0;at<Le.length;at++)Be.sectionIndex.push(0);oe.push(Be)}}else if(fe){const ke=fe(Q.text,Q.sectionIndex,de);for(const Le of ke){const Be=new Kg;Be.text=Le[0],Be.sectionIndex=Le[1],Be.sections=Q.sections,oe.push(Be)}}else oe=function(ke,Le){const Be=[],at=ke.text;let Ge=0;for(const ft of Le)Be.push(ke.substring(Ge,ft)),Ge=ft;return Ge<at.length&&Be.push(ke.substring(Ge,at.length)),Be}(Q,de);const Ie=[],Ae={positionedLines:Ie,text:Q.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ke,Le,Be,at,Ge,ft,wt,xt,At,kt,it,Tt){let Xe=0,ot=0,It=0;const St=xt==="right"?1:xt==="left"?0:.5;let or=!1;for(const Nt of Ge){const Ht=Nt.getSections();for(const pr of Ht){if(pr.image)continue;const gr=Le[pr.fontStack];if(gr&&(or=gr.ascender!==void 0&&gr.descender!==void 0,!or))break}if(!or)break}let Kt=0;for(const Nt of Ge){Nt.trim();const Ht=Nt.getMaxScale(),pr=(Ht-1)*Ss,gr={positionedGlyphs:[],lineOffset:0};ke.positionedLines[Kt]=gr;const Cr=gr.positionedGlyphs;let Ar=0;if(!Nt.length()){ot+=ft,++Kt;continue}let Qr=0,Vr=0;for(let _e=0;_e<Nt.length();_e++){const ve=Nt.getSection(_e),st=Nt.getSectionIndex(_e),Rt=Nt.getCodePoint(_e);let zt=ve.scale,Lt=null,Jt=null,yr=null,Ur=Ss,$r=0,jr=At;jr===ha.vertical&&((_t=Rt)===12312||_t===12313||_t===12316||_t===12540||_t===12448)&&(jr=ha.horizontal);const jn=!(jr===ha.horizontal||!it&&!Tg(Rt)||it&&(BS[Rt]||X1(Rt)));if(ve.image){const gi=at.get(ve.image.toString());if(!gi)continue;yr=ve.image,ke.iconsInText=ke.iconsInText||!0,Jt=gi.paddedRect;const Mr=gi.displaySize;zt=zt*Ss/Tt,Lt={width:Mr[0],height:Mr[1],left:0,top:-l5,advance:jn?Mr[1]:Mr[0],localGlyph:!1},$r=or?-Lt.height*zt:Ht*Ss-17-Mr[1]*zt,Ur=Lt.advance;const ti=(jn?Mr[0]:Mr[1])*zt-Ss*Ht;ti>0&&ti>Ar&&(Ar=ti)}else{const gi=Be[ve.fontStack];if(!gi)continue;gi[Rt]&&(Jt=gi[Rt]);const Mr=Le[ve.fontStack];if(!Mr)continue;const ti=Mr.glyphs[Rt];if(!ti)continue;if(Lt=ti.metrics,Ur=Rt!==8203?Ss:0,or){const $n=Mr.ascender!==void 0?Math.abs(Mr.ascender):0,An=Mr.descender!==void 0?Math.abs(Mr.descender):0,di=($n+An)*zt;Qr<di&&(Qr=di,Vr=($n-An)/2*zt),$r=-$n*zt}else $r=(Ht-zt)*Ss-17}jn?(ke.verticalizable=!0,Cr.push({glyph:Rt,image:yr,x:Xe,y:ot+$r,vertical:jn,scale:zt,localGlyph:Lt.localGlyph,fontStack:ve.fontStack,sectionIndex:st,metrics:Lt,rect:Jt}),Xe+=Ur*zt+kt):(Cr.push({glyph:Rt,image:yr,x:Xe,y:ot+$r,vertical:jn,scale:zt,localGlyph:Lt.localGlyph,fontStack:ve.fontStack,sectionIndex:st,metrics:Lt,rect:Jt}),Xe+=Lt.advance*zt+kt)}Cr.length!==0&&(It=Math.max(Xe-kt,It),or?f5(Cr,St,Ar,Vr,ft*Ht/2):f5(Cr,St,Ar,0,ft/2)),Xe=0;const Kn=ft*Ht+Ar;gr.lineOffset=Math.max(Ar,pr),ot+=Kn,++Kt}var _t;const Ct=ot,{horizontalAlign:rr,verticalAlign:Bt}=$C(wt);(function(Nt,Ht,pr,gr,Cr,Ar){const Qr=(Ht-pr)*Cr,Vr=-Ar*gr;for(const Kn of Nt)for(const _e of Kn.positionedGlyphs)_e.x+=Qr,_e.y+=Vr})(ke.positionedLines,St,rr,Bt,It,Ct),ke.top+=-Bt*Ct,ke.bottom=ke.top+Ct,ke.left+=-rr*It,ke.right=ke.left+It,ke.hasBaseline=or}(Ae,i,a,d,oe,_,S,A,R,k,L,q),!function(ke){for(const Le of ke)if(Le.positionedGlyphs.length!==0)return!1;return!0}(Ie))return Ae}const BS={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Oie={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function c5(l,i,a,d,f,y){if(i.image){const _=d.get(i.image.toString());return _?_.displaySize[0]*i.scale*Ss/y+f:0}{const _=a[i.fontStack],S=_&&_.glyphs[l];return S?S.metrics.advance*i.scale+f:0}}function u5(l,i,a,d){const f=Math.pow(l-i,2);return d?l<i?f/2:2*f:f+Math.abs(a)*a}function jie(l,i,a){let d=0;return l===10&&(d-=1e4),a&&(d+=150),l!==40&&l!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function h5(l,i,a,d,f,y){let _=null,S=u5(i,a,f,y);for(const A of d){const k=u5(i-A.x,a,f,y)+A.badness;k<=S&&(_=A,S=k)}return{index:l,x:i,priorBreak:_,badness:S}}function d5(l){return l?d5(l.priorBreak).concat(l.index):[]}function $C(l){let i=.5,a=.5;switch(l){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function f5(l,i,a,d,f){if(!(i||a||d||f))return;const y=l.length-1,_=l[y],S=(_.x+_.metrics.advance*_.scale)*i;for(let A=0;A<=y;A++)l[A].x-=S,l[A].y+=a+d+f}function p5(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function Rie(l,i,a,d){const{horizontalAlign:f,verticalAlign:y}=$C(d),_=a[0]-l.displaySize[0]*f,S=a[1]-l.displaySize[1]*y;return{imagePrimary:l,imageSecondary:i,top:S,bottom:S+l.displaySize[1],left:_,right:_+l.displaySize[0]}}function m5(l,i,a,d,f,y){const _=l.imagePrimary;let S;if(_.content){const Q=_.content,oe=_.pixelRatio||1;S=[Q[0]/oe,Q[1]/oe,_.displaySize[0]-Q[2]/oe,_.displaySize[1]-Q[3]/oe]}const A=i.left*y,k=i.right*y;let j,R,L,W;a==="width"||a==="both"?(W=f[0]+A-d[3],R=f[0]+k+d[1]):(W=f[0]+(A+k-_.displaySize[0])/2,R=W+_.displaySize[0]);const q=i.top*y,J=i.bottom*y;return a==="height"||a==="both"?(j=f[1]+q-d[0],L=f[1]+J+d[2]):(j=f[1]+(q+J-_.displaySize[1])/2,L=j+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:j,right:R,bottom:L,left:W,collisionPadding:S}}function g5(l){return!l.imagePrimary.stretchX}function y5(l){return!l.imagePrimary.stretchY}function _5(l){return{width:l.right-l.left,height:l.bottom-l.top}}const iu=128;function v5(l,i,a){const{expression:d}=i;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new On(l+1,{worldview:a}))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:y}=d;let _=0;for(;_<f.length&&f[_]<=l;)_++;_=Math.max(0,_-1);let S=_;for(;S<f.length&&f[S]<l+1;)S++;S=Math.min(f.length-1,S);const A=f[_],k=f[S];return d.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:k,interpolationType:y}:{kind:"camera",minZoom:A,maxZoom:k,minSize:d.evaluate(new On(A,{worldview:a})),maxSize:d.evaluate(new On(k,{worldview:a})),interpolationType:y}}}function GC(l,{uSize:i,uSizeT:a},{lowerSize:d,upperSize:f}){return l.kind==="source"?d/iu:l.kind==="composite"?lr(d/iu,f/iu,a):i}function tx(l,i,a=1){let d=0,f=0;if(l.kind==="constant")f=l.layoutSize*a;else if(l.kind!=="source"){const{interpolationType:y,minZoom:_,maxZoom:S}=l,A=y?xe(Po.interpolationFactor(y,i,_,S),0,1):0;l.kind==="camera"?f=lr(l.minSize,l.maxSize,A)*a:d=A*a}return{uSizeT:d,uSize:f}}class th extends ut{constructor(i,a,d,f,y){super(i,a),this.angle=f,this.z=d,y!==void 0&&(this.segment=y)}clone(){return new th(this.x,this.y,this.z,this.angle,this.segment)}}function x5(l,i,a,d,f){if(i.segment===void 0)return!0;let y=i,_=i.segment+1,S=0;for(;S>-a/2;){if(_--,_<0)return!1;S-=l[_].dist(y),y=l[_]}S+=l[_].dist(l[_+1]),_++;const A=[];let k=0;for(;S<a/2;){const j=l[_],R=l[_+1];if(!R)return!1;let L=l[_-1].angleTo(j)-j.angleTo(R);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:S,angleDelta:L}),k+=L;S-A[0].distance>d;)k-=A.shift().angleDelta;if(k>f)return!1;_++,S+=j.dist(R)}return!0}function b5(l){let i=0;for(let a=0;a<l.length-1;a++)i+=l[a].dist(l[a+1]);return i}function w5(l,i,a){return l?.6*i*a:0}function S5(l,i){return Math.max(l?l.right-l.left:0,i?i.right-i.left:0)}function Die(l,i,a,d,f,y){const _=w5(a,f,y),S=S5(a,d)*y;let A=0;const k=b5(l)/2;for(let j=0;j<l.length-1;j++){const R=l[j],L=l[j+1],W=R.dist(L);if(A+W>k){const q=(k-A)/W,J=lr(R.x,L.x,q),Q=lr(R.y,L.y,q),oe=new th(J,Q,0,L.angleTo(R),j);return!_||x5(l,oe,S,_,i)?oe:void 0}A+=W}}function Lie(l,i,a,d,f,y,_,S,A){const k=w5(d,y,_),j=S5(d,f),R=j*_,L=l[0].x===0||l[0].x===A||l[0].y===0||l[0].y===A;return i-R<i/4&&(i=R+i/4),T5(l,L?i/2*S%i:(j/2+2*y)*_*S%i,i,k,a,R,L,!1,A)}function T5(l,i,a,d,f,y,_,S,A){const k=y/2,j=b5(l);let R=0,L=i-a,W=[];for(let q=0;q<l.length-1;q++){const J=l[q],Q=l[q+1],oe=J.dist(Q),de=Q.angleTo(J);for(;L+a<R+oe;){L+=a;const he=(L-R)/oe,fe=lr(J.x,Q.x,he),Ie=lr(J.y,Q.y,he);if(fe>=0&&fe<A&&Ie>=0&&Ie<A&&L-k>=0&&L+k<=j){const Ae=new th(fe,Ie,0,de,q);d&&!x5(l,Ae,y,d,f)||W.push(Ae)}}R+=oe}return S||W.length||_||(W=T5(l,R/2,a,d,f,y,_,!0,A)),W}function E5(l){let i=0,a=0;for(const _ of l)i+=_.w*_.h,a=Math.max(a,_.w);l.sort((_,S)=>S.h-_.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let f=0,y=0;for(const _ of l)for(let S=d.length-1;S>=0;S--){const A=d[S];if(!(_.w>A.w||_.h>A.h)){if(_.x=A.x,_.y=A.y,y=Math.max(y,_.y+_.h),f=Math.max(f,_.x+_.w),_.w===A.w&&_.h===A.h){const k=d.pop();k&&S<d.length&&(d[S]=k)}else _.h===A.h?(A.x+=_.w,A.w-=_.w):_.w===A.w?(A.y+=_.h,A.h-=_.h):(d.push({x:A.x+_.w,y:A.y,w:A.w-_.w,h:_.h}),A.y+=_.h,A.h-=_.h);break}}return{w:f,h:y,fill:i/(f*y)||0}}qt(th,"Anchor");const Ap=1;class rx{static getImagePositionScale(i,a,d){if(a&&i&&i.options&&i.options.transform){const f=i.options.transform;return{x:f.a,y:f.d}}return{x:d,y:d}}constructor(i,a,d,f){this.paddedRect=i;const{pixelRatio:y,version:_,stretchX:S,stretchY:A,content:k,sdf:j,usvg:R}=a;this.pixelRatio=y,this.stretchX=S,this.stretchY=A,this.content=k,this.version=_,this.padding=d,this.sdf=j,this.usvg=R,this.scale=rx.getImagePositionScale(f,R,y)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function HC(l,i,a){const d=Kl.parse(l),f=function(y,_,S=[1,1]){return{x:0,y:0,w:(y.data?y.data.width:y.width*S[0])+2*_,h:(y.data?y.data.height:y.height*S[1])+2*_}}(i,a,[d.options.transform.a,d.options.transform.d]);return{bin:f,imagePosition:new rx(f,i,a,d),imageVariant:d}}class A5{constructor(i,a,d){const f=new Map,y=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(i,f,Ap,_),this.addImages(a,y,2,_);const{w:S,h:A}=E5(_),k=new Ds({width:S||1,height:A||1});for(const[j,R]of i.entries()){const L=f.get(j).paddedRect;Ds.copy(R.data,k,{x:0,y:0},{x:L.x+Ap,y:L.y+Ap},R.data,d,R.sdf)}for(const[j,R]of a.entries()){const L=y.get(j),W=L.paddedRect;let q=L.padding;const J=W.x+q,Q=W.y+q,oe=R.data.width,de=R.data.height;q=q>1?q-1:q,Ds.copy(R.data,k,{x:0,y:0},{x:J,y:Q},R.data,d),Ds.copy(R.data,k,{x:0,y:de-q},{x:J,y:Q-q},{width:oe,height:q},d),Ds.copy(R.data,k,{x:0,y:0},{x:J,y:Q+de},{width:oe,height:q},d),Ds.copy(R.data,k,{x:oe-q,y:0},{x:J-q,y:Q},{width:q,height:de},d),Ds.copy(R.data,k,{x:0,y:0},{x:J+oe,y:Q},{width:q,height:de},d),Ds.copy(R.data,k,{x:oe-q,y:de-q},{x:J-q,y:Q-q},{width:q,height:q},d),Ds.copy(R.data,k,{x:0,y:de-q},{x:J+oe,y:Q-q},{width:q,height:q},d),Ds.copy(R.data,k,{x:0,y:0},{x:J+oe,y:Q+de},{width:q,height:q},d),Ds.copy(R.data,k,{x:oe-q,y:0},{x:J-q,y:Q+de},{width:q,height:q},d)}this.lut=d,this.image=k,this.iconPositions=f,this.patternPositions=y}addImages(i,a,d,f){for(const[y,_]of i.entries()){const{bin:S,imagePosition:A,imageVariant:k}=HC(y,_,d);a.set(y,A),f.push(S),_.hasRenderCallback&&this.haveRenderCallbacks.push(k.id)}}patchUpdatedImages(i,a,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>i.hasImage(f,d)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const f of i.getUpdatedImages(d)){for(const y of this.iconPositions.keys()){const _=Kl.parse(y);if(Bo.isEqual(_.id,f)){const S=i.getImage(f,d);this.patchUpdatedImage(this.iconPositions.get(y),S,a)}}for(const y of this.patternPositions.keys()){const _=Kl.parse(y);if(Bo.isEqual(_.id,f)){const S=i.getImage(f,d);this.patchUpdatedImage(this.patternPositions.get(y),S,a)}}}}patchUpdatedImage(i,a,d){if(!i||!a||i.version===a.version)return;i.version=a.version;const[f,y]=i.tl,_=i.sdf;if(this.lut||_){const S={width:a.data.width,height:a.data.height},A=new Ds(S);Ds.copy(a.data,A,{x:0,y:0},{x:0,y:0},S,this.lut,_),d.update(A,{position:{x:f,y}})}else d.update(a.data,{position:{x:f,y}})}}qt(rx,"ImagePosition"),qt(A5,"ImageAtlas");const nx=1e20;function k5(l,i,a,d,f,y,_,S,A){for(let k=i;k<i+d;k++)P5(l,a*y+k,y,f,_,S,A);for(let k=a;k<a+f;k++)P5(l,k*y+i,1,d,_,S,A)}function P5(l,i,a,d,f,y,_){y[0]=0,_[0]=-nx,_[1]=nx,f[0]=l[i];for(let S=1,A=0,k=0;S<d;S++){f[S]=l[i+S*a];const j=S*S;do{const R=y[A];k=(f[S]-f[R]+j-R*R)/(S-R)/2}while(k<=_[A]&&--A>-1);A++,y[A]=S,_[A]=k,_[A+1]=nx}for(let S=0,A=0;S<d;S++){for(;_[A+1]<S;)A++;const k=y[A],j=S-k;l[i+S*a]=f[k]+j*j}}const Ql=2,WC={none:0,ideographs:1,all:2};class Xg{constructor(i,a,d){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=d,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,a){const d=[],f=this.url||Cs.GLYPHS_URL;for(const y in i)for(const _ of i[y])d.push({stack:y,id:_});Ve(d,({stack:y,id:_},S)=>{let A=this.entries[y];A||(A=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=A.glyphs[_];if(k!==void 0)return void S(null,{stack:y,id:_,glyph:k});if(k=this._tinySDF(A,y,_),k)return A.glyphs[_]=k,void S(null,{stack:y,id:_,glyph:k});const j=Math.floor(_/256);if(256*j>65535)return qr("glyphs > 65535 not supported"),void S(null,{stack:y,id:_,glyph:k});if(A.ranges[j])return void S(null,{stack:y,id:_,glyph:k});let R=A.requests[j];R||(R=A.requests[j]=[],Xg.loadGlyphRange(y,j,f,this.requestManager,(L,W)=>{if(W){A.ascender=W.ascender,A.descender=W.descender;for(const q in W.glyphs)this._doesCharSupportLocalGlyph(+q)||(A.glyphs[+q]=W.glyphs[+q]);A.ranges[j]=!0}for(const q of R)q(L,W);delete A.requests[j]})),R.push((L,W)=>{L?S(L):W&&S(null,{stack:y,id:_,glyph:W.glyphs[_]||null})})},(y,_)=>{if(y)a(y);else if(_){const S={};for(const{stack:A,id:k,glyph:j}of _)S[A]===void 0&&(S[A]={}),S[A].glyphs===void 0&&(S[A].glyphs={}),S[A].glyphs[k]=j&&{id:j.id,bitmap:j.bitmap.clone(),metrics:j.metrics},S[A].ascender=this.entries[A].ascender,S[A].descender=this.entries[A].descender;a(null,S)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==WC.none&&(this.localGlyphMode===WC.all?!!this.localFontFamily:!!this.localFontFamily&&(hr["CJK Unified Ideographs"](i)||hr["Hangul Syllables"](i)||hr.Hiragana(i)||hr.Katakana(i)||hr["CJK Symbols and Punctuation"](i)||hr["CJK Unified Ideographs Extension A"](i)||hr["CJK Unified Ideographs Extension B"](i)||hr.Osage(i)))}_tinySDF(i,a,d){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(d))return;let y=i.tinySDF;if(!y){let J="400";/bold/i.test(a)?J="900":/medium/i.test(a)?J="500":/light/i.test(a)&&(J="200"),y=i.tinySDF=new Xg.TinySDF({fontFamily:f,fontWeight:J,fontSize:24*Ql,buffer:3*Ql,radius:8*Ql}),y.fontWeight=J}if(this.localGlyphs[y.fontWeight][d])return this.localGlyphs[y.fontWeight][d];const _=String.fromCodePoint(d),{data:S,width:A,height:k,glyphWidth:j,glyphHeight:R,glyphLeft:L,glyphTop:W,glyphAdvance:q}=y.draw(_);return this.localGlyphs[y.fontWeight][d]={id:d,bitmap:new kd({width:A,height:k},S),metrics:{width:j/Ql,height:R/Ql,left:L/Ql,top:W/Ql-27,advance:q/Ql,localGlyph:!0}}}}Xg.loadGlyphRange=function(l,i,a,d,f){const y=256*i,_=y+255,S=d.transformRequest(d.normalizeGlyphsURL(a).replace("{fontstack}",l).replace("{range}",`${y}-${_}`),Nf.Glyphs);Ff(S,(A,k)=>{if(A)f(A);else if(k){const j={},R=function(L){return new FS(L).readFields(Cie,{})}(k);for(const L of R.glyphs)j[L.id]=L;f(null,{glyphs:j,ascender:R.ascender,descender:R.descender})}})},Xg.TinySDF=class{constructor({fontSize:l=24,buffer:i=3,radius:a=8,cutoff:d=.25,fontFamily:f="sans-serif",fontWeight:y="normal",fontStyle:_="normal"}={}){this.buffer=i,this.cutoff=d,this.radius=a;const S=this.size=l+4*i,A=this._createCanvas(S),k=this.ctx=A.getContext("2d",{willReadFrequently:!0});k.font=`${_} ${y} ${l}px ${f}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(l){const i=document.createElement("canvas");return i.width=i.height=l,i}draw(l){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:d,actualBoundingBoxLeft:f,actualBoundingBoxRight:y}=this.ctx.measureText(l),_=Math.ceil(a),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-f))),A=Math.min(this.size-this.buffer,_+Math.ceil(d)),k=S+2*this.buffer,j=A+2*this.buffer,R=Math.max(k*j,0),L=new Uint8ClampedArray(R),W={data:L,width:k,height:j,glyphWidth:S,glyphHeight:A,glyphTop:_,glyphLeft:0,glyphAdvance:i};if(S===0||A===0)return W;const{ctx:q,buffer:J,gridInner:Q,gridOuter:oe}=this;q.clearRect(J,J,S,A),q.fillText(l,J,J+_);const de=q.getImageData(J,J,S,A);oe.fill(nx,0,R),Q.fill(0,0,R);for(let he=0;he<A;he++)for(let fe=0;fe<S;fe++){const Ie=de.data[4*(he*S+fe)+3]/255;if(Ie===0)continue;const Ae=(he+J)*k+fe+J;if(Ie===1)oe[Ae]=0,Q[Ae]=nx;else{const ke=.5-Ie;oe[Ae]=ke>0?ke*ke:0,Q[Ae]=ke<0?ke*ke:0}}k5(oe,0,0,k,j,k,this.f,this.v,this.z),k5(Q,J,J,S,A,k,this.f,this.v,this.z);for(let he=0;he<R;he++){const fe=Math.sqrt(oe[he])-Math.sqrt(Q[he]);L[he]=Math.round(255-255*(fe/this.radius+this.cutoff))}return W}};const Id=Ap;function C5(l,i){return l+i[1]-i[0]}function I5(l,i,a,d,f=1){const y=[],_=l.imagePrimary,S=_.pixelRatio,A=_.paddedRect.w-2*Id,k=_.paddedRect.h-2*Id,j=(l.right-l.left)*f,R=(l.bottom-l.top)*f,L=_.stretchX||[[0,A]],W=_.stretchY||[[0,k]],q=L.reduce(C5,0),J=W.reduce(C5,0),Q=A-q,oe=k-J;let de=0,he=q,fe=0,Ie=J,Ae=0,ke=Q,Le=0,Be=oe;if(_.content&&d){const Ge=_.content;de=VS(L,0,Ge[0]),fe=VS(W,0,Ge[1]),he=VS(L,Ge[0],Ge[2]),Ie=VS(W,Ge[1],Ge[3]),Ae=Ge[0]-de,Le=Ge[1]-fe,ke=Ge[2]-Ge[0]-he,Be=Ge[3]-Ge[1]-Ie}const at=(Ge,ft,wt,xt)=>{const At=US(Ge.stretch-de,he,j,l.left*f),kt=$S(Ge.fixed-Ae,ke,Ge.stretch,q),it=US(ft.stretch-fe,Ie,R,l.top*f),Tt=$S(ft.fixed-Le,Be,ft.stretch,J),Xe=US(wt.stretch-de,he,j,l.left*f),ot=$S(wt.fixed-Ae,ke,wt.stretch,q),It=US(xt.stretch-fe,Ie,R,l.top*f),St=$S(xt.fixed-Le,Be,xt.stretch,J),or=new ut(At,it),Kt=new ut(Xe,it),_t=new ut(Xe,It),Ct=new ut(At,It),rr=new ut(kt/S,Tt/S),Bt=new ut(ot/S,St/S),Nt=i*Math.PI/180;if(Nt){const Qr=Math.sin(Nt),Vr=Math.cos(Nt),Kn=[Vr,-Qr,Qr,Vr];or._matMult(Kn),Kt._matMult(Kn),Ct._matMult(Kn),_t._matMult(Kn)}const Ht=Ge.stretch+Ge.fixed,pr=wt.stretch+wt.fixed,gr=ft.stretch+ft.fixed,Cr=xt.stretch+xt.fixed,Ar=l.imageSecondary;return{tl:or,tr:Kt,bl:Ct,br:_t,texPrimary:{x:_.paddedRect.x+Id+Ht,y:_.paddedRect.y+Id+gr,w:pr-Ht,h:Cr-gr},texSecondary:Ar?{x:Ar.paddedRect.x+Id+Ht,y:Ar.paddedRect.y+Id+gr,w:pr-Ht,h:Cr-gr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:rr,pixelOffsetBR:Bt,minFontScaleX:ke/S/j,minFontScaleY:Be/S/R,isSDF:a}};if(d&&(_.stretchX||_.stretchY)){const Ge=M5(L,Q,q),ft=M5(W,oe,J);for(let wt=0;wt<Ge.length-1;wt++){const xt=Ge[wt],At=Ge[wt+1];for(let kt=0;kt<ft.length-1;kt++)y.push(at(xt,ft[kt],At,ft[kt+1]))}}else y.push(at({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:k+1}));return y}function VS(l,i,a){let d=0;for(const f of l)d+=Math.max(i,Math.min(a,f[1]))-Math.max(i,Math.min(a,f[0]));return d}function M5(l,i,a){const d=[{fixed:-Id,stretch:0}];for(const[f,y]of l){const _=d[d.length-1];d.push({fixed:f-_.stretch,stretch:_.stretch}),d.push({fixed:f-_.stretch,stretch:_.stretch+(y-f)})}return d.push({fixed:i+Id,stretch:a}),d}function US(l,i,a,d){return l/i*a+d}function $S(l,i,a,d){return l-i*a/d}function zie(l,i,a,d){const f=i+l.positionedLines[d].lineOffset;return d===0?a+f/2:a+(f+(i+l.positionedLines[d-1].lineOffset))/2}function Nie(l,i=1,a=!1){let d=1/0,f=1/0,y=-1/0,_=-1/0;const S=l[0];for(let W=0;W<S.length;W++){const q=S[W];(!W||q.x<d)&&(d=q.x),(!W||q.y<f)&&(f=q.y),(!W||q.x>y)&&(y=q.x),(!W||q.y>_)&&(_=q.y)}const A=Math.min(y-d,_-f);let k=A/2;const j=new Qm([],Fie);if(A===0)return new ut(d,f);for(let W=d;W<y;W+=A)for(let q=f;q<_;q+=A)j.push(new Yg(W+k,q+k,k,l));let R=function(W){let q=0,J=0,Q=0;const oe=W[0];for(let de=0,he=oe.length,fe=he-1;de<he;fe=de++){const Ie=oe[de],Ae=oe[fe],ke=Ie.x*Ae.y-Ae.x*Ie.y;J+=(Ie.x+Ae.x)*ke,Q+=(Ie.y+Ae.y)*ke,q+=3*ke}return new Yg(J/q,Q/q,0,W)}(l),L=j.length;for(;j.length;){const W=j.pop();(W.d>R.d||!R.d)&&(R=W,a&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,L)),W.max-R.d<=i||(k=W.h/2,j.push(new Yg(W.p.x-k,W.p.y-k,k,l)),j.push(new Yg(W.p.x+k,W.p.y-k,k,l)),j.push(new Yg(W.p.x-k,W.p.y+k,k,l)),j.push(new Yg(W.p.x+k,W.p.y+k,k,l)),L+=4)}return a&&(console.log(`num probes: ${L}`),console.log(`best distance: ${R.d}`)),R.p}function Fie(l,i){return i.max-l.max}class Yg{constructor(i,a,d,f){this.p=new ut(i,a),this.h=d,this.d=function(y,_){let S=!1,A=1/0;for(let k=0;k<_.length;k++){const j=_[k];for(let R=0,L=j.length,W=L-1;R<L;W=R++){const q=j[R],J=j[W];q.y>y.y!=J.y>y.y&&y.x<(J.x-q.x)*(y.y-q.y)/(J.y-q.y)+q.x&&(S=!S),A=Math.min(A,ja(y,q,J))}}return(S?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const Bie=Object.keys,qC=Number.POSITIVE_INFINITY,Vie=Math.sqrt(2);function O5(l,[i,a]){let d=0,f=0;if(a===qC){i<0&&(i=0);const y=i/Vie;switch(l){case"top-right":case"top-left":f=y-7;break;case"bottom-right":case"bottom-left":f=7-y;break;case"bottom":f=7-i;break;case"top":f=i-7}switch(l){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=i;break;case"right":d=-i}}else{switch(i=Math.abs(i),a=Math.abs(a),l){case"top-right":case"top-left":case"top":f=a-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-a}switch(l){case"top-right":case"bottom-right":case"right":d=-i;break;case"top-left":case"bottom-left":case"left":d=i}}return[d,f]}function GS(l,i,a,d,f,y,_,S,A){if(!i||!i.usvg)return;const k=_5(d),j=_5(f),R=y!=="both"&&y!=="width"||!g5(d)?1:j.width/k.width,L=y!=="both"&&y!=="height"||!y5(d)?1:j.height/k.height;a.scaleSelf(R,L);const W=a.toString();_.set(W,a),S.set(W,i);const{imagePosition:q}=HC(W,i,Ap);A.set(W,q)}function j5(l,i,a,d,f,y,_,S,A){if(!l)return;const k=function(j,R,L,W,q,J){if(j.kind==="camera")return j.maxSize;if(j.kind==="composite"){const Q=R.possiblyEvaluate(new On(j.maxZoom,{worldview:J}),L).evaluate(q,{},L),oe=R.possiblyEvaluate(new On(j.minZoom,{worldview:J}),L).evaluate(q,{},L);return Math.max(Q,oe)}return R.possiblyEvaluate(new On(W,{worldview:J})).evaluate(q,{},L)}(i,a,d,f,y,A);return l.scaleSelf(k*S*_)}function R5(l,i,a,d,f,y,_,S,A){return{iconPrimary:j5(l.getPrimary(),i,a,d,f,y,_,S,A),iconSecondary:j5(l.getSecondary(),i,a,d,f,y,_,S,A)}}function Uie(l,i,a){if(!i)return;const d=a.get(l.toString()),f=a.get(i.toString());f&&(d.paddedRect.w===f.paddedRect.w&&d.paddedRect.h===f.paddedRect.h||qr(`Mismatch in icon variant sizes: ${l.toString()} and ${i.toString()}`),d.usvg!==f.usvg&&qr(`Mismatch in icon variant image types: ${l.id} and ${i.id}`))}function D5(l,i,a,d){if(!l)return;const f=i.get(a.toString());if(l.imagePrimary=f,d){const y=i.get(d.toString());l.imageSecondary=y}}function $ie(l,i){for(const a in l.horizontal)L5(l.horizontal[a],i);L5(l.vertical,i)}function L5(l,i){if(l){for(const a of l.positionedLines)for(const d of a.positionedGlyphs)if(d.image!==null){const f=d.image.toString();d.rect=i.get(f).paddedRect}}}function ZC(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gie(l,i,a,d,f,y,_,S,A){const k=KC(y.horizontal)||y.vertical,j=a.get("icon-text-fit-padding").evaluate(d,{},f);let R,L=i;return i&&A!=="none"&&(l.allowVerticalPlacement&&y.vertical&&(R=m5(i,y.vertical,A,j,S,_)),k&&(L=m5(i,k,A,j,S,_))),{defaultShapedIcon:L,verticallyShapedIcon:R}}function Hie(l,i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q,oe,de,he){let fe=_.textMaxSize.evaluate(i,{},L);fe===void 0?fe=S*_.textScaleFactor:fe*=_.textScaleFactor;const Ie=l.layers[0].layout,Ae=KC(a.horizontal)||a.vertical,ke=W.name==="globe",Le=Ss,Be=l.tilePixelRatio*fe/Le,at=(kt=l.overscaling,l.zoom>18&&kt>2&&(kt>>=1),Math.max(Dt/(512*kt),1)*Ie.get("symbol-spacing")),Ge=Ie.get("text-padding")*l.tilePixelRatio,ft=Ie.get("icon-padding")*l.tilePixelRatio,wt=Br(Ie.get("text-max-angle")),xt=Ie.get("icon-rotation-alignment")==="map"&&he!=="point",At=at/2;var kt;l.hasAnyIconTextFit===!1&&Q!=="none"&&(l.hasAnyIconTextFit=!0);const it=i.properties?+i.properties[er]:null,Tt=it&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(it):65535,Xe=(ot,It,St)=>{if(It.x<0||It.x>=Dt||It.y<0||It.y>=Dt)return;let or=null;if(ke){const{x:Kt,y:_t,z:Ct}=W.projectTilePoint(It.x,It.y,St);or={anchor:new th(Kt,_t,Ct,0,void 0),up:W.upVector(St,It.x,It.y)}}(function(Kt,_t,Ct,rr,Bt,Nt,Ht,pr,gr,Cr,Ar,Qr,Vr,Kn,_e,ve,st,Rt,zt,Lt,Jt,yr,Ur,$r,jr,jn,gi,Mr,ti){const $n=Kt.addToLineVertexArray(_t,rr);let An,di,Jn,Gn,Xn,In,Rr,Rn=0,fi=0,dr=0,nn=0,Qn=-1,vi=-1;const ri={};let Ki=qh("");const zn=Ct?Ct.anchor:_t,Gi=Mr!=="none";let Ho=0,Ls=0;if(gr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Xi=gr.layout.get("text-offset").evaluate(Jt,{},jr);Ho=Xi[0]*Ss,Ls=Xi[1]*Ss}else Ho=gr.layout.get("text-radial-offset").evaluate(Jt,{},jr)*Ss,Ls=qC;if(Kt.allowVerticalPlacement&&Bt.vertical){const Xi=Bt.vertical;if(_e)In=XC(Xi),pr&&(Rr=XC(pr));else{const us=gr.layout.get("text-rotate").evaluate(Jt,{},jr)+90;Jn=HS(Cr,zn,_t,Ar,Qr,Vr,Xi,Kn,us,ve),pr&&(Gn=HS(Cr,zn,_t,Ar,Qr,Vr,pr,Rt,us))}}if(Nt){const Xi=Kt.iconSizeData,us=gr.layout.get("icon-rotate").evaluate(Jt,{},jr),zs=I5(Nt,us,Ur,Gi,yr.iconScaleFactor),mo=pr?I5(pr,us,Ur,Gi,yr.iconScaleFactor):void 0;di=HS(Cr,zn,_t,Ar,Qr,Vr,Nt,Rt,us,null),Rn=4*zs.length;let Xs=null;Xi.kind==="source"?(Xs=[iu*gr.layout.get("icon-size").evaluate(Jt,{},jr)*yr.iconScaleFactor],Xs[0]>Md&&qr(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${ix}. Reduce your "icon-size".`)):Xi.kind==="composite"&&(Xs=[iu*yr.compositeIconSizes[0].evaluate(Jt,{},jr)*yr.iconScaleFactor,iu*yr.compositeIconSizes[1].evaluate(Jt,{},jr)*yr.iconScaleFactor],(Xs[0]>Md||Xs[1]>Md)&&qr(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${ix}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,zs,Xs,Lt,zt,Jt,void 0,Ct,_t,$n.lineStartIndex,$n.lineLength,-1,$r,jr,jn,gi),Qn=Kt.icon.placedSymbolArray.length-1,mo&&(fi=4*mo.length,Kt.addSymbols(Kt.icon,mo,Xs,Lt,zt,Jt,ha.vertical,Ct,_t,$n.lineStartIndex,$n.lineLength,-1,$r,jr,jn,gi),vi=Kt.icon.placedSymbolArray.length-1)}for(const Xi in Bt.horizontal){const us=Xi,zs=Bt.horizontal[us];An||(Ki=qh(zs.text),_e?Xn=XC(zs):An=HS(Cr,zn,_t,Ar,Qr,Vr,zs,Kn,gr.layout.get("text-rotate").evaluate(Jt,{},jr),ve));const mo=zs.positionedLines.length===1;if(dr+=z5(Kt,Ct,_t,zs,Ht,gr,_e,Jt,ve,$n,Bt.vertical?ha.horizontal:ha.horizontalOnly,mo?Bie(Bt.horizontal):[us],ri,Qn,yr,$r,jr,jn),mo)break}Bt.vertical&&(nn+=z5(Kt,Ct,_t,Bt.vertical,Ht,gr,_e,Jt,ve,$n,ha.vertical,["vertical"],ri,vi,yr,$r,jr,jn));let Is=-1;const Wo=(Xi,us)=>Xi?Math.max(Xi,us):us;Is=Wo(Xn,Is),Is=Wo(In,Is),Is=Wo(Rr,Is);const su=Is>-1?1:0;Kt.glyphOffsetArray.length>=65535&&qr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Jt.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,Jt.sortKey),Kt.symbolInstances.emplaceBack(_t.x,_t.y,zn.x,zn.y,zn.z,ri.right>=0?ri.right:-1,ri.center>=0?ri.center:-1,ri.left>=0?ri.left:-1,ri.vertical>=0?ri.vertical:-1,Qn,vi,Ki,An!==void 0?An:Kt.collisionBoxArray.length,An!==void 0?An+1:Kt.collisionBoxArray.length,Jn!==void 0?Jn:Kt.collisionBoxArray.length,Jn!==void 0?Jn+1:Kt.collisionBoxArray.length,di!==void 0?di:Kt.collisionBoxArray.length,di!==void 0?di+1:Kt.collisionBoxArray.length,Gn||Kt.collisionBoxArray.length,Gn?Gn+1:Kt.collisionBoxArray.length,Ar,dr,nn,Rn,fi,su,0,Ho,Ls,Is,0,Gi?1:0,ti)})(l,It,or,ot,a,d,y,f,l.layers[0],l.collisionBoxArray,i.index,i.sourceLayerIndex,l.index,Ge,de,k,0,ft,xt,oe,i,_,j,R,L,q,J,Q,Tt)};if(he==="line")for(const ot of IS(i.geometry,0,0,Dt,Dt)){const It=Lie(ot,at,wt,a.vertical||Ae,d,Le,Be,l.overscaling,Dt);for(const St of It)Ae&&Wie(l,Ae.text,At,St)||Xe(ot,St,L)}else if(he==="line-center"){for(const ot of i.geometry)if(ot.length>1){const It=Die(ot,wt,a.vertical||Ae,d,Le,Be);It&&Xe(ot,It,L)}}else if(i.type==="Polygon")for(const ot of V0(i.geometry,0)){const It=Nie(ot,16);Xe(ot[0],new th(It.x,It.y,0,0,void 0),L)}else if(i.type==="LineString")for(const ot of i.geometry)Xe(ot,new th(ot[0].x,ot[0].y,0,0,void 0),L);else if(i.type==="Point")for(const ot of i.geometry)for(const It of ot)Xe([It],new th(It.x,It.y,0,0,void 0),L)}const ix=255,Md=ix*iu;function z5(l,i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q,oe){const de=function(Ie,Ae,ke,Le,Be,at,Ge,ft){const wt=[];if(Ae.positionedLines.length===0)return wt;const xt=Le.layout.get("text-rotate").evaluate(at,{})*Math.PI/180,At=function(ot){const It=ot[0],St=ot[1],or=It*St;return or>0?[It,-St]:or<0?[-It,St]:It===0?[St,It]:[St,-It]}(ke);let kt=Math.abs(Ae.top-Ae.bottom);for(const ot of Ae.positionedLines)kt-=ot.lineOffset;const it=Ae.positionedLines.length,Tt=kt/it;let Xe=Ae.top-ke[1];for(let ot=0;ot<it;++ot){const It=Ae.positionedLines[ot];Xe=zie(Ae,Tt,Xe,ot);for(const St of It.positionedGlyphs){if(!St.rect)continue;const or=St.rect||{};let Kt=l5+1,_t=!0,Ct=1,rr=0;if(St.image){const Jt=Ge.get(St.image.toString());if(!Jt)continue;if(Jt.sdf){qr("SDF images are not supported in formatted text and will be ignored.");continue}_t=!1,Ct=Jt.pixelRatio,Kt=Ap/Ct}const Bt=(Be||ft)&&St.vertical,Nt=St.metrics.advance*St.scale/2,Ht=St.metrics,pr=St.rect;if(pr===null)continue;ft&&Ae.verticalizable&&(rr=St.image?Nt-St.metrics.width*St.scale/2:0);const gr=Be?[St.x+Nt,St.y]:[0,0];let Cr=[0,0],Ar=[0,0],Qr=!1;Be||(Bt?(Ar=[St.x+Nt+At[0],St.y+At[1]-rr],Qr=!0):Cr=[St.x+Nt+ke[0],St.y+ke[1]-rr]);const Vr=pr.w*St.scale/(Ct*(St.localGlyph?Ql:1)),Kn=pr.h*St.scale/(Ct*(St.localGlyph?Ql:1));let _e,ve,st,Rt;if(Bt){const Jt=St.y-Xe,yr=new ut(-Nt,Nt-Jt),Ur=-Math.PI/2,$r=new ut(...Ar);_e=new ut(-Nt+Cr[0],Cr[1]),_e._rotateAround(Ur,yr)._add($r),_e.x+=-Jt+Nt,_e.y-=(Ht.left-Kt)*St.scale;const jr=St.image?Ht.advance*St.scale:Ss*St.scale,jn=String.fromCodePoint(St.glyph);yie(jn)?_e.x+=(1-Kt)*St.scale:_ie(jn)?_e.x+=jr-Ht.height*St.scale+(-Kt-1)*St.scale:_e.x+=St.image||Ht.width+2*Kt===pr.w&&Ht.height+2*Kt===pr.h?(jr-Kn)/2:(jr-(Ht.height+2*Kt)*St.scale)/2,ve=new ut(_e.x,_e.y-Vr),st=new ut(_e.x+Kn,_e.y),Rt=new ut(_e.x+Kn,_e.y-Vr)}else{const Jt=(Ht.left-Kt)*St.scale-Nt+Cr[0],yr=(-Ht.top-Kt)*St.scale+Cr[1],Ur=Jt+Vr,$r=yr+Kn;_e=new ut(Jt,yr),ve=new ut(Ur,yr),st=new ut(Jt,$r),Rt=new ut(Ur,$r)}if(xt){let Jt;Jt=Be?new ut(0,0):Qr?new ut(At[0],At[1]):new ut(ke[0],ke[1]),_e._rotateAround(xt,Jt),ve._rotateAround(xt,Jt),st._rotateAround(xt,Jt),Rt._rotateAround(xt,Jt)}const zt=new ut(0,0),Lt=new ut(0,0);wt.push({tl:_e,tr:ve,bl:st,br:Rt,texPrimary:or,texSecondary:void 0,writingMode:Ae.writingMode,glyphOffset:gr,sectionIndex:St.sectionIndex,isSDF:_t,pixelOffsetTL:zt,pixelOffsetBR:Lt,minFontScaleX:0,minFontScaleY:0})}}return wt}(0,d,A,y,_,S,f,l.allowVerticalPlacement),he=l.textSizeData;let fe=null;he.kind==="source"?(fe=[iu*y.layout.get("text-size").evaluate(S,{},Q)*q.textScaleFactor],fe[0]>Md&&qr(`${l.layerIds[0]}: Value for "text-size" is >= ${ix}. Reduce your "text-size".`)):he.kind==="composite"&&(fe=[iu*q.compositeTextSizes[0].evaluate(S,{},Q)*q.textScaleFactor,iu*q.compositeTextSizes[1].evaluate(S,{},Q)*q.textScaleFactor],(fe[0]>Md||fe[1]>Md)&&qr(`${l.layerIds[0]}: Value for "text-size" is >= ${ix}. Reduce your "text-size".`)),l.addSymbols(l.text,de,fe,A,_,S,j,i,a,k.lineStartIndex,k.lineLength,W,J,Q,oe,!1);for(const Ie of R)L[Ie]=l.text.placedSymbolArray.length-1;return 4*de.length}function KC(l){for(const i in l)return l[i];return null}function HS(l,i,a,d,f,y,_,S,A,k){let j=_.top,R=_.bottom,L=_.left,W=_.right;if(p5(_)&&_.collisionPadding){const q=_.collisionPadding;L-=q[0],j-=q[1],W+=q[2],R+=q[3]}if(A){const q=new ut(L,j),J=new ut(W,j),Q=new ut(L,R),oe=new ut(W,R),de=Br(A);let he=new ut(0,0);k&&(he=new ut(k[0],k[1])),q._rotateAround(de,he),J._rotateAround(de,he),Q._rotateAround(de,he),oe._rotateAround(de,he),L=Math.min(q.x,J.x,Q.x,oe.x),W=Math.max(q.x,J.x,Q.x,oe.x),j=Math.min(q.y,J.y,Q.y,oe.y),R=Math.max(q.y,J.y,Q.y,oe.y)}return l.emplaceBack(i.x,i.y,i.z,a.x,a.y,L,j,W,R,S,d,f,y),l.length-1}function XC(l){p5(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const i=l.bottom-l.top;return i>0?Math.max(10,i):null}function Wie(l,i,a,d){const f=l.compareText;if(i in f){const y=f[i];for(let _=y.length-1;_>=0;_--)if(d.dist(y[_])<a)return!0}else f[i]=[];return f[i].push(d),!1}function N5(l,i){const a=l.fovAboveCenter,d=l.elevation?l.elevation.getMinElevationBelowMSL()*i:0,f=(l._camera.position[2]*l.worldSize-d)/Math.cos(l._pitch),y=Math.sin(a)*f/Math.sin(Math.max(Math.PI/2-l._pitch-a,.01));let _=Math.sin(l._pitch)*y+f;const S=f*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let A=Math.max(l.zoom-17,0);l.isOrthographic&&(A/=10),_*=1+A}return Math.min(1.01*_,S)}function sx(l,i){if(!i.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:i};const a=Math.pow(2,-l.z),d=l.x*a,f=(l.x+1)*a,y=l.y*a,_=(l.y+1)*a,S=pe(d),A=pe(f),k=me(y),j=me(_),R=i.project(S,k),L=i.project(A,k),W=i.project(A,j),q=i.project(S,j);let J=Math.min(R.x,L.x,W.x,q.x),Q=Math.min(R.y,L.y,W.y,q.y),oe=Math.max(R.x,L.x,W.x,q.x),de=Math.max(R.y,L.y,W.y,q.y);const he=a/16;function fe(Ae,ke,Le,Be,at,Ge){const ft=(Le+at)/2,wt=(Be+Ge)/2,xt=i.project(pe(ft),me(wt)),At=Math.max(0,J-xt.x,Q-xt.y,xt.x-oe,xt.y-de);J=Math.min(J,xt.x),oe=Math.max(oe,xt.x),Q=Math.min(Q,xt.y),de=Math.max(de,xt.y),At>he&&(fe(Ae,xt,Le,Be,ft,wt),fe(xt,ke,ft,wt,at,Ge))}fe(R,L,d,y,f,y),fe(L,W,f,y,f,_),fe(W,q,f,_,d,_),fe(q,R,d,_,d,y),J-=he,Q-=he,oe+=he,de+=he;const Ie=1/Math.max(oe-J,de-Q);return{scale:Ie,x:J*Ie,y:Q*Ie,x2:oe*Ie,y2:de*Ie,projection:i}}function F5(l,{x:i,y:a},d=0){return new ut(((i-d)*l.scale-l.x)*Dt,(a*l.scale-l.y)*Dt)}const qie=N(new Float32Array(16));class Od{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new H(0,0)}projectTilePoint(i,a,d){return{x:i,y:a,z:0}}locationPoint(i,a,d,f=!0){return i._coordinatePoint(i.locationCoordinate(a,d),f)}pixelsPerMeter(i,a){return ue(1,i)*a}pixelSpaceConversion(i,a,d){return 1}farthestPixelDistance(i){return N5(i,i.pixelsPerMeter)}pointCoordinate(i,a,d,f){const y=i.horizonLineFromTop(!1),_=new ut(a,Math.max(y,d));return i.rayIntersectionCoordinate(i.pointRayIntersection(_,f))}pointCoordinate3D(i,a,d){const f=new ut(a,d);if(i.elevation)return i.elevation.pointCoordinate(f);{const y=this.pointCoordinate(i,f.x,f.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(i,a){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,a.x,a.y);const d=i.horizonLineFromTop();return a.y<d}createInversionMatrix(i,a){return qie}createTileMatrix(i,a,d){let f,y,_;const S=d.canonical,A=N(new Float64Array(16));if(this.isReprojectedInTileSpace){const k=sx(S,this);f=1,y=k.x+d.wrap*k.scale,_=k.y,X(A,A,[f/k.scale,f/k.scale,i.pixelsPerMeter/a])}else f=a/i.zoomScale(S.z),y=(S.x+Math.pow(2,S.z)*d.wrap)*f,_=S.y*f;return V(A,A,[y,_,0]),X(A,A,[f/Dt,f/Dt,1]),A}upVector(i,a,d){return[0,0,1]}upVectorScale(i,a,d){return{metersToTile:1}}}class Zie extends Od{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,d]=this.parallels=i.parallels||[29.5,45.5],f=Math.sin(Br(a));this.n=(f+Math.sin(Br(d)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:d,c:f,r0:y}=this,_=Br(i-this.center[0]),S=Br(a),A=Math.sqrt(f-2*d*Math.sin(S))/d;return{x:A*Math.sin(_*d),y:A*Math.cos(_*d)-y,z:0}}unproject(i,a){const{n:d,c:f,r0:y}=this,_=y+a;let S=Math.atan2(i,Math.abs(_))*Math.sign(_);_*d<0&&(S-=Math.PI*Math.sign(i)*Math.sign(_));const A=Br(this.center[0])*d;S=et(S,-Math.PI-A,Math.PI-A);const k=xe(He(S/d)+this.center[0],-180,180),j=Math.asin(xe((f-(i*i+_*_)*d*d)/(2*d),-1,1)),R=xe(He(j),-we,we);return new H(k,R)}}const ox=1.340264,ax=-.081106,lx=893e-6,cx=.003796,WS=Math.sqrt(3)/2;class Kie extends Od{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const d=Math.asin(WS*Math.sin(a)),f=d*d,y=f*f*f;return{x:.5*(i*Math.cos(d)/(WS*(ox+3*ax*f+y*(7*lx+9*cx*f)))/Math.PI+.5),y:1-.5*(d*(ox+ax*f+y*(lx+cx*f))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,f=d*d,y=f*f*f;for(let j,R,L,W=0;W<12&&(R=d*(ox+ax*f+y*(lx+cx*f))-a,L=ox+3*ax*f+y*(7*lx+9*cx*f),j=R/L,d=xe(d-j,-Math.PI/3,Math.PI/3),f=d*d,y=f*f*f,!(Math.abs(j)<1e-12));++W);const _=WS*i*(ox+3*ax*f+y*(7*lx+9*cx*f))/Math.cos(d),S=Math.asin(Math.sin(d)/WS),A=xe(180*_/Math.PI,-180,180),k=xe(180*S/Math.PI,-we,we);return new H(A,k)}}class Xie extends Od{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const d=360*(i-.5),f=xe(360*(.5-a),-we,we);return new H(d,f)}}const Jg=Math.PI/2;function qS(l){return Math.tan((Jg+l)/2)}class Yie extends Od{constructor(i){super(i),this.center=i.center||[0,30];const[a,d]=this.parallels=i.parallels||[30,30];let f=Br(a),y=Br(d);this.southernCenter=f+y<0,this.southernCenter&&(f=-f,y=-y);const _=Math.cos(f),S=qS(f);this.n=f===y?Math.sin(f):Math.log(_/Math.cos(y))/Math.log(qS(y)/S),this.f=_*Math.pow(qS(f),this.n)/this.n}project(i,a){a=Br(a),this.southernCenter&&(a=-a),i=Br(i-this.center[0]);const d=1e-6,{n:f,f:y}=this;y>0?a<-Jg+d&&(a=-Jg+d):a>Jg-d&&(a=Jg-d);const _=y/Math.pow(qS(a),f);let S=_*Math.sin(f*i),A=y-_*Math.cos(f*i);return S=.5*(S/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:S,y:this.southernCenter?A:1-A,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:d,f}=this,y=f-a,_=Math.sign(y),S=Math.sign(d)*Math.sqrt(i*i+y*y);let A=Math.atan2(i,Math.abs(y))*_;y*d<0&&(A-=Math.PI*Math.sign(i)*_);const k=xe(He(A/d)+this.center[0],-180,180),j=xe(He(2*Math.atan(Math.pow(f/S,1/d))-Jg),-we,we);return new H(k,this.southernCenter?-j:j)}}class B5 extends Od{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:re(i),y:ie(a),z:0}}unproject(i,a){const d=pe(i),f=me(a);return new H(d,f)}}const V5=Br(we);class Jie extends Od{project(i,a){const d=(a=Br(a))*a,f=d*d;return{x:.5*((i=Br(i))*(.8707-.131979*d+f*(f*(.003971*d-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+d*(.015085+f*(.028874*d-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,f=25,y=0,_=d*d;do{_=d*d;const k=_*_;y=(d*(1.007226+_*(.015085+k*(.028874*_-.044475-.005916*k)))-a)/(1.007226+_*(.045255+k*(.259866*_-.311325-.005916*11*k))),d=xe(d-y,-V5,V5)}while(Math.abs(y)>1e-6&&--f>0);_=d*d;const S=xe(He(i/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),A=He(d);return new H(S,A)}}const U5=Br(we);class Qie extends Od{project(i,a){a=Br(a),i=Br(i);const d=Math.cos(a),f=2/Math.PI,y=Math.acos(d*Math.cos(i/2)),_=Math.sin(y)/y,S=.5*(i*f+2*d*Math.sin(i/2)/_)||0,A=.5*(a+Math.sin(a)/_)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(i,a){let d=i=(2*i-.5)*Math.PI,f=a=(2*(1-a)-1)*Math.PI,y=25;const _=1e-6;let S=0,A=0;do{const k=Math.cos(f),j=Math.sin(f),R=2*j*k,L=j*j,W=k*k,q=Math.cos(d/2),J=Math.sin(d/2),Q=2*q*J,oe=J*J,de=1-W*q*q,he=de?1/de:0,fe=de?Math.acos(k*q)*Math.sqrt(1/de):0,Ie=.5*(2*fe*k*J+2*d/Math.PI)-i,Ae=.5*(fe*j+f)-a,ke=.5*he*(W*oe+fe*k*q*L)+1/Math.PI,Le=he*(Q*R/4-fe*j*J),Be=.125*he*(R*J-fe*j*W*Q),at=.5*he*(L*q+fe*oe*k)+.5,Ge=Le*Be-at*ke;S=(Ae*Le-Ie*at)/Ge,A=(Ie*Be-Ae*ke)/Ge,d=xe(d-S,-Math.PI,Math.PI),f=xe(f-A,-U5,U5)}while((Math.abs(S)>_||Math.abs(A)>_)&&--y>0);return new H(He(d),He(f))}}class $5 extends Od{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Br(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:d,cosPhi:f}=this;return{x:Br(i)*f*d+.5,y:-Math.sin(Br(a))/f*d+.5,z:0}}unproject(i,a){const{scale:d,cosPhi:f}=this,y=-(a-.5)/d,_=xe(He((i-.5)/d)/f,-180,180),S=Math.asin(xe(y*f,-1,1)),A=xe(He(S),-we,we);return new H(_,A)}}class ese extends B5{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,a,d){const f=D0(i,a,d);return Qt(f,f,bS(ru(d))),{x:f[0],y:f[1],z:f[2]}}locationPoint(i,a,d){const f=M(a.lat,a.lng),y=Er([],f),_=d?i._centerAltitude+d:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude;ct(f,f,y,ue(1,0)*Dt*_);const S=N(new Float64Array(16));return U(S,i.pixelMatrix,i.globeMatrix),Qt(f,f,S),new ut(f[0],f[1])}pixelsPerMeter(i,a){return ue(1,0)*a}pixelSpaceConversion(i,a,d){const f=ue(1,i)*a,y=lr(ue(1,45)*a,f,d);return this.pixelsPerMeter(i,a)/y}createTileMatrix(i,a,d){const f=sC(ru(d.canonical));return U(new Float64Array(16),i.globeMatrix,f)}createInversionMatrix(i,a){const{center:d}=i,f=bS(ru(a));return ne(f,f,Br(d.lng)),Y(f,f,Br(d.lat)),X(f,f,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(i,a,d,f){return pN(i,a,d,!0)||new Ue(0,0)}pointCoordinate3D(i,a,d){const f=this.pointCoordinate(i,a,d,0);return[f.x,f.y,f.z]}isPointAboveHorizon(i,a){return!pN(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=function(f,y){const _=f.cameraToCenterDistance,S=f._centerAltitude*y,A=f._camera,k=f._camera.forward(),j=We([],mt([],k,-_),[0,0,S]),R=f.worldSize/(2*Math.PI),L=[0,0,-R],W=f.width/f.height,q=Math.tan(f.fovAboveCenter),J=mt([],A.up(),q),Q=mt([],A.right(),q*W),oe=Er([],We([],We([],k,J),Q)),de=[];let he;if(new hn(j,oe).closestPointOnSphere(L,R,de)){const fe=We([],de,L),Ie=Kr([],fe,j);he=Math.cos(f.fovAboveCenter)*Ye(Ie)}else{const fe=Kr([],j,L),Ie=Kr([],L,j);Er(Ie,Ie);const Ae=Ye(fe)-R;he=Math.sqrt(Ae*(Ae+2*R));const ke=Math.acos(he/(R+Ae))-Math.acos(Ft(k,Ie));he*=Math.cos(ke)}return 1.01*he}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),d=Ad(i.zoom);if(d>0){const f=N5(i,ue(1,i.center.lat)*i.worldSize),y=i.worldSize/(2*Math.PI),_=Math.max(i.width,i.height)/i.worldSize*Math.PI;return lr(a,f+y*(1-Math.cos(_)),Math.pow(d,10))}return a}upVector(i,a,d){return D0(a,d,i,1)}upVectorScale(i){return{metersToTile:_S(xS(ru(i)))}}}function G5(l){const i=l.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(l.name){case"mercator":return new B5(l);case"equirectangular":return new Xie(l);case"naturalEarth":return new Jie(l);case"equalEarth":return new Kie(l);case"winkelTripel":return new Qie(l);case"albers":return a?new $5(l):new Zie(l);case"lambertConformalConic":return a?new $5(l):new Yie(l);case"globe":return new ese(l)}throw new Error(`Invalid projection name: ${l.name}`)}const tse=yt.types,rse=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ZS(l,i,a,d,f,y,_,S,A,k,j,R,L){const W=S?Math.min(Md,Math.round(S[0])):0,q=S?Math.min(Md,Math.round(S[1])):0;l.emplaceBack(i,a,Math.round(32*d),Math.round(32*f),y,_,(W<<1)+(A?1:0),q,16*k,16*j,256*R,256*L)}function KS(l,i,a){l.emplaceBack(i,a)}function XS(l,i,a,d,f,y,_){l.emplaceBack(i,a,d,f,y,_)}const YS=(l,i,a,d)=>{for(let f=0;f<i;f++)l.emplaceBack(a[0],a[1],a[2],d[0],d[1],d[2])};function JS(l,i,a,d,f){l.emplaceBack(i,a,d,f),l.emplaceBack(i,a,d,f),l.emplaceBack(i,a,d,f),l.emplaceBack(i,a,d,f)}function nse(l){for(const i of l.sections)if(GP(i.text))return!0;return!1}class YC{constructor(i){this.layoutVertexArray=new Rg,this.indexArray=new ii,this.programConfigurations=i,this.segments=new ui,this.dynamicLayoutVertexArray=new Yc,this.opacityVertexArray=new _0,this.placedSymbolArray=new pp,this.iconTransitioningVertexArray=new xl,this.globeExtVertexArray=new yd,this.zOffsetVertexArray=new Yu,this.orientationVertexArray=new b0}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(i,a,d,f,y){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,aie.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,cie.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,rse,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,die.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,lie.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||y)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,uie.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,hie.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||f)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}qt(YC,"SymbolBuffers");class JC{constructor(i,a,d){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new d,this.segments=new ui,this.collisionVertexArray=new vd,this.collisionVertexArrayExt=new Yc}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,fie.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,pie.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qt(JC,"CollisionBuffers");class QS{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=N([]),this.placementViewportMatrix=N([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.textSizeData=v5(this.zoom,a["text-size"],this.worldview),this.iconSizeData=v5(this.zoom,a["icon-size"],this.worldview);const d=this.layers[0].layout,f=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(_=>ha[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new YC(new la(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new YC(new la(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new C0,this.lineVertexArray=new aS,this.symbolInstances=new oS}calculateGlyphDependencies(i,a,d,f,y){for(const _ of i){const S=_.codePointAt(0);if(S===void 0)break;if(a[S]=!0,f&&y&&S<=65535){const A=Q0[_];A&&(a[A.charCodeAt(0)]=!0)}}}updateFootprints(i,a){}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!kS(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(i,a,d,f){const y=this.layers[0],_=y.layout,S=this.projection.name==="globe",A=_.get("text-font"),k=_.get("text-field"),j=_.get("icon-image"),[R,L]=_.get("icon-size-scale-range"),W=xe(a.scaleFactor||1,R,L),q=(k.value.kind!=="constant"||k.value.value instanceof lo&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),J=j.value.kind!=="constant"||!!j.value.value||Object.keys(j.parameters).length>0,Q=_.get("symbol-sort-key");if(this.features=[],!q&&!J)return;const oe=a.iconDependencies,de=a.glyphDependencies,he=a.availableImages,fe=new On(this.zoom,{worldview:this.worldview});for(const{feature:Ie,id:Ae,index:ke,sourceLayerIndex:Le}of i){const Be=y._featureFilter.needGeometry,at=Ze(Ie,Be);if(!y._featureFilter.filter(fe,at,d))continue;if(Be||(at.geometry=nt(Ie,d,f)),S&&Ie.type!==1&&d.z<=5){const At=at.geometry,kt=.98078528056,it=(Tt,Xe)=>Ft(D0(Tt.x,Tt.y,d,1),D0(Xe.x,Xe.y,d,1))<kt;for(let Tt=0;Tt<At.length;Tt++)At[Tt]=pt(At[Tt],it)}let Ge,ft;if(q){const At=y.getValueAndResolveTokens("text-field",at,d,he),kt=lo.factory(At);nse(kt)&&(this.hasRTLText=!0),(!this.hasRTLText||h0()==="unavailable"||this.hasRTLText&&_l.isParsed())&&(Ge=gie(kt,y,at))}if(J){const At=y.getValueAndResolveTokens("icon-image",at,d,he);ft=typeof At=="string"?ko.build(At):At}if(!Ge&&!ft)continue;const wt=this.sortFeaturesByKey?Q.evaluate(at,{},d):void 0,xt={id:Ae,text:Ge,icon:ft,index:ke,sourceLayerIndex:Le,geometry:at.geometry,properties:Ie.properties,type:tse[Ie.type],sortKey:wt};if(this.features.push(xt),ft){const At=this.layers[0]._unevaluatedLayout._values,{iconPrimary:kt,iconSecondary:it}=R5(ft,this.iconSizeData,At["icon-size"],d,this.zoom,xt,this.pixelRatio,W,this.worldview),Tt=kt.id.toString();if(oe.has(Tt)?oe.get(Tt).push(kt):oe.set(Tt,[kt]),it){this.hasAnySecondaryIcon=!0;const Xe=it.id.toString();oe.has(Xe)?oe.get(Xe).push(it):oe.set(Xe,[it])}}if(Ge){const At=A.evaluate(at,{},d).join(","),kt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ha.vertical)>=0;for(const it of Ge.sections)if(it.image){const Tt=it.image.getPrimary().scaleSelf(this.pixelRatio),Xe=Tt.id.toString(),ot=oe.get(Xe)||[];ot.push(Tt),oe.set(Xe,ot)}else{const Tt=a0(Ge.toString()),Xe=it.fontStack||At,ot=de[Xe]=de[Xe]||{};this.calculateGlyphDependencies(it.text,ot,kt,this.allowVerticalPlacement,Tt)}}}if(_.get("symbol-placement")==="line"&&(this.features=function(Ie){const Ae={},ke={},Le=[];let Be=0;function at(xt){Le.push(Ie[xt]),Be++}function Ge(xt,At,kt){const it=ke[xt];return delete ke[xt],ke[At]=it,Le[it].geometry[0].pop(),Le[it].geometry[0]=Le[it].geometry[0].concat(kt[0]),it}function ft(xt,At,kt){const it=Ae[At];return delete Ae[At],Ae[xt]=it,Le[it].geometry[0].shift(),Le[it].geometry[0]=kt[0].concat(Le[it].geometry[0]),it}function wt(xt,At,kt){const it=kt?At[0][At[0].length-1]:At[0][0];return`${xt}:${it.x}:${it.y}`}for(let xt=0;xt<Ie.length;xt++){const At=Ie[xt],kt=At.geometry,it=At.text?At.text.toString():null;if(!it){at(xt);continue}const Tt=wt(it,kt),Xe=wt(it,kt,!0);if(Tt in ke&&Xe in Ae&&ke[Tt]!==Ae[Xe]){const ot=ft(Tt,Xe,kt),It=Ge(Tt,Xe,Le[ot].geometry);delete Ae[Tt],delete ke[Xe],ke[wt(it,Le[It].geometry,!0)]=It,Le[ot].geometry=null}else Tt in ke?Ge(Tt,Xe,kt):Xe in Ae?ft(Tt,Xe,kt):(at(xt),Ae[Tt]=Be-1,ke[Xe]=Be-1)}return Le.filter(xt=>xt.geometry)}(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ie of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Ie.id,this.elevationFeatures.length),this.elevationFeatures.push(Ie)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ie,Ae)=>Ie.sortKey-Ae.sortKey)}update(i,a,d,f,y,_,S){this.text.programConfigurations.updatePaintArrays(i,a,y,d,f,_,S,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,a,y,d,f,_,S,this.worldview)}updateRoadElevation(i){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const d=Ee(i),f=1/d;let y=!1,_=!1;for(let S=0;S<this.symbolInstances.length;S++){const A=this.symbolInstances.get(S),k=Oe(1,0,0),j=Oe(0,1,0),{numHorizontalGlyphVertices:R,numVerticalGlyphVertices:L,numIconVertices:W,numVerticalIconVertices:q}=A,J=R>0||L>0,Q=W>0,oe=this.elevationFeatures[A.elevationFeatureIndex];if(oe){const de=new ut(A.tileAnchorX,A.tileAnchorY),he=.075+oe.pointElevation(de);A.zOffset!==he&&(a=!0,A.zOffset=he);const fe=oe.computeSlopeNormal(de,f),Ie=Ya(wo(),Oe(0,0,1),fe);Vt(k,k,Ie),Vt(j,j,Ie),k[2]*=d,j[2]*=d,k[0]===1&&k[1]===0&&k[2]===0&&j[0]===0&&j[1]===1&&j[2]===0||(y=y||J,_=_||Q)}if(J&&(YS(this.text.orientationVertexArray,R,k,j),YS(this.text.orientationVertexArray,L,k,j)),Q){const{placedIconSymbolIndex:de,verticalPlacedIconSymbolIndex:he}=A;de>=0&&YS(this.icon.orientationVertexArray,W,k,j),he>=0&&YS(this.icon.orientationVertexArray,q,k,j)}}y||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(y,_,S)=>{d+=_,d>y.length&&y.resize(d);for(let A=-_;A<0;A++)y.emplace(A+d,S)},a=(y,_,S)=>{f+=_,f>y.length&&y.resize(f);for(let A=-_;A<0;A++)y.emplace(A+f,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,f=0;for(let y=0;y<this.symbolInstances.length;y++){const _=this.symbolInstances.get(y),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:A,numIconVertices:k}=_,j=_.zOffset,R=k>0;if((S>0||A>0)&&(i(this.text.zOffsetVertexArray,S,j),i(this.text.zOffsetVertexArray,A,j)),R){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:W}=_;L>=0&&a(this.icon.zOffsetVertexArray,k,j),W>=0&&a(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,j)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=G5(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const d=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:f,y}of a)this.lineVertexArray.emplaceBack(f,y);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,a,d,f,y,_,S,A,k,j,R,L,W,q,J,Q){const oe=i.indexArray,de=i.layoutVertexArray,he=i.globeExtVertexArray,fe=i.segments.prepareSegment(4*a.length,de,oe,this.canOverlap?_.sortKey:void 0),Ie=this.glyphOffsetArray.length,Ae=fe.vertexLength,ke=this.allowVerticalPlacement&&S===ha.vertical?Math.PI/2:0,Le=_.text&&_.text.sections;for(let at=0;at<a.length;at++){const{tl:Ge,tr:ft,bl:wt,br:xt,texPrimary:At,texSecondary:kt,pixelOffsetTL:it,pixelOffsetBR:Tt,minFontScaleX:Xe,minFontScaleY:ot,glyphOffset:It,isSDF:St,sectionIndex:or}=a[at],Kt=fe.vertexLength,_t=It[1];if(ZS(de,k.x,k.y,Ge.x,_t+Ge.y,At.x,At.y,d,St,it.x,it.y,Xe,ot),ZS(de,k.x,k.y,ft.x,_t+ft.y,At.x+At.w,At.y,d,St,Tt.x,it.y,Xe,ot),ZS(de,k.x,k.y,wt.x,_t+wt.y,At.x,At.y+At.h,d,St,it.x,Tt.y,Xe,ot),ZS(de,k.x,k.y,xt.x,_t+xt.y,At.x+At.w,At.y+At.h,d,St,Tt.x,Tt.y,Xe,ot),A){const{x:Ct,y:rr,z:Bt}=A.anchor,[Nt,Ht,pr]=A.up;XS(he,Ct,rr,Bt,Nt,Ht,pr),XS(he,Ct,rr,Bt,Nt,Ht,pr),XS(he,Ct,rr,Bt,Nt,Ht,pr),XS(he,Ct,rr,Bt,Nt,Ht,pr),JS(i.dynamicLayoutVertexArray,Ct,rr,Bt,ke)}else JS(i.dynamicLayoutVertexArray,k.x,k.y,k.z,ke);if(Q){const Ct=kt||At;KS(i.iconTransitioningVertexArray,Ct.x,Ct.y),KS(i.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y),KS(i.iconTransitioningVertexArray,Ct.x,Ct.y+Ct.h),KS(i.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y+Ct.h)}oe.emplaceBack(Kt,Kt+1,Kt+2),oe.emplaceBack(Kt+1,Kt+2,Kt+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(It[0]),at!==a.length-1&&or===a[at+1].sectionIndex||i.programConfigurations.populatePaintArrays(de.length,_,_.index,{},W,q,J,Le&&Le[or],this.worldview)}const Be=A?A.anchor:k;i.placedSymbolArray.emplaceBack(Be.x,Be.y,Be.z,k.x,k.y,Ie,this.glyphOffsetArray.length-Ie,Ae,j,R,k.segment,d?d[0]:0,d?d[1]:0,f[0],f[1],S,0,0,0,L,0)}_commitLayoutVertex(i,a,d,f,y,_,S){i.emplaceBack(a,d,f,y,_,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(i,a,d,f,y,_,S){const A=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),k=A.vertexLength,j=S.tileAnchorX,R=S.tileAnchorY;for(let W=0;W<4;W++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,a,i.padding,S.zOffset),this._commitLayoutVertex(d.layoutVertexArray,f,y,_,j,R,new ut(i.x1,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,f,y,_,j,R,new ut(i.x2,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,f,y,_,j,R,new ut(i.x2,i.y2)),this._commitLayoutVertex(d.layoutVertexArray,f,y,_,j,R,new ut(i.x1,i.y2)),A.vertexLength+=4;const L=d.indexArray;L.emplaceBack(k,k+1),L.emplaceBack(k+1,k+2),L.emplaceBack(k+2,k+3),L.emplaceBack(k+3,k),A.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,d,f,y,_){for(let S=f;S<y;S++){const A=d.get(S),k=this.getSymbolInstanceTextSize(i,_,a,S);this._addCollisionDebugVertices(A,k,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(i,a,d,f,y,_){for(let S=f;S<y;S++){const A=d.get(S),k=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._addCollisionDebugVertices(A,k,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}generateCollisionDebugBuffers(i,a,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new JC(Dg,i5.members,xl),this.iconCollisionBox=new JC(Dg,i5.members,xl);const f=tx(this.iconSizeData,i),y=tx(this.textSizeData,i,d);for(let _=0;_<this.symbolInstances.length;_++){const S=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(y,i,a,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(y,i,a,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,a,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,a,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(i,a,d,f){const y=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:f),_=GC(this.textSizeData,i,y)/Ss;return this.tilePixelRatio*_}getSymbolInstanceIconSize(i,a,d){const f=this.icon.placedSymbolArray.get(d),y=GC(this.iconSizeData,i,f);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(i,a,d,f){i.emplaceBack(a,-d,-d,f),i.emplaceBack(a,d,-d,f),i.emplaceBack(a,d,d,f),i.emplaceBack(a,-d,d,f)}_updateTextDebugCollisionBoxes(i,a,d,f,y,_,S){for(let A=f;A<y;A++){const k=d.get(A),j=this.getSymbolInstanceTextSize(i,_,a,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,j,k.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(i,a,d,f,y,_,S){for(let A=f;A<y;A++){const k=d.get(A),j=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,j,k.padding,_.zOffset)}}updateCollisionDebugBuffers(i,a,d,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=tx(this.iconSizeData,i,f),_=tx(this.textSizeData,i,d);for(let S=0;S<this.symbolInstances.length;S++){const A=this.symbolInstances.get(S);this._updateTextDebugCollisionBoxes(_,i,a,A.textBoxStartIndex,A.textBoxEndIndex,A,d),this._updateTextDebugCollisionBoxes(_,i,a,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,d),this._updateIconDebugCollisionBoxes(y,i,a,A.iconBoxStartIndex,A.iconBoxEndIndex,A,f),this._updateIconDebugCollisionBoxes(y,i,a,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,d,f,y,_,S,A,k){const j={};if(a<d){const{x1:R,y1:L,x2:W,y2:q,padding:J,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe,featureIndex:Ie}=i.get(a);j.textBox={x1:R,y1:L,x2:W,y2:q,padding:J,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe},j.textFeatureIndex=Ie}if(f<y){const{x1:R,y1:L,x2:W,y2:q,padding:J,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe,featureIndex:Ie}=i.get(f);j.verticalTextBox={x1:R,y1:L,x2:W,y2:q,padding:J,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe},j.verticalTextFeatureIndex=Ie}if(_<S){const{x1:R,y1:L,x2:W,y2:q,padding:J,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe,featureIndex:Ie}=i.get(_);j.iconBox={x1:R,y1:L,x2:W,y2:q,padding:J,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe},j.iconFeatureIndex=Ie}if(A<k){const{x1:R,y1:L,x2:W,y2:q,padding:J,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe,featureIndex:Ie}=i.get(A);j.verticalIconBox={x1:R,y1:L,x2:W,y2:q,padding:J,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe},j.verticalIconFeatureIndex=Ie}return j}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const d=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,a){const d=i.placedSymbolArray.get(a),f=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<f;y+=4)i.indexArray.emplaceBack(y,y+1,y+2),i.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(i),d=Math.cos(i),f=[],y=[],_=[];for(let S=0;S<this.symbolInstances.length;++S){_.push(S);const A=this.symbolInstances.get(S);f.push(0|Math.round(a*A.tileAnchorX+d*A.tileAnchorY)),y.push(A.featureIndex)}return _.sort((S,A)=>f[S]-f[A]||y[A]-y[S]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,a){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===a?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const d=this.symbolInstances.get(a);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:k}=d;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&y!==f&&this.addIndicesForPlacedSymbol(this.text,y),_>=0&&_!==y&&_!==f&&this.addIndicesForPlacedSymbol(this.text,_),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let H5,W5,QC;qt(QS,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),QS.addDynamicAttributes=JS;class q5{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Kh,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt(q5,"FormatSectionOverride",{omit:["defaultValue"]});const eI=()=>QC||(QC={layout:H5||(H5=new wi({"symbol-placement":new Mt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Mt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mt($e.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Mt($e.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Mt($e.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Mt($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t($e.layout_symbol["icon-size"]),"icon-size-scale-range":new Mt($e.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new $t($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t($e.layout_symbol["icon-image"]),"icon-rotate":new $t($e.layout_symbol["icon-rotate"]),"icon-padding":new Mt($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Mt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new $t($e.layout_symbol["icon-offset"]),"icon-anchor":new $t($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mt($e.layout_symbol["text-rotation-alignment"]),"text-field":new $t($e.layout_symbol["text-field"]),"text-font":new $t($e.layout_symbol["text-font"]),"text-size":new $t($e.layout_symbol["text-size"]),"text-size-scale-range":new Mt($e.layout_symbol["text-size-scale-range"]),"text-max-width":new $t($e.layout_symbol["text-max-width"]),"text-line-height":new $t($e.layout_symbol["text-line-height"]),"text-letter-spacing":new $t($e.layout_symbol["text-letter-spacing"]),"text-justify":new $t($e.layout_symbol["text-justify"]),"text-radial-offset":new $t($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mt($e.layout_symbol["text-variable-anchor"]),"text-anchor":new $t($e.layout_symbol["text-anchor"]),"text-max-angle":new Mt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Mt($e.layout_symbol["text-writing-mode"]),"text-rotate":new $t($e.layout_symbol["text-rotate"]),"text-padding":new Mt($e.layout_symbol["text-padding"]),"text-keep-upright":new Mt($e.layout_symbol["text-keep-upright"]),"text-transform":new $t($e.layout_symbol["text-transform"]),"text-offset":new $t($e.layout_symbol["text-offset"]),"text-allow-overlap":new Mt($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Mt($e.layout_symbol["text-optional"]),visibility:new Mt($e.layout_symbol.visibility)})),paint:W5||(W5=new wi({"icon-opacity":new $t($e.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new $t($e.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new $t($e.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new $t($e.paint_symbol["text-emissive-strength"]),"icon-color":new $t($e.paint_symbol["icon-color"]),"icon-halo-color":new $t($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Mt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mt($e.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Mt($e.paint_symbol["icon-image-cross-fade"]),"text-opacity":new $t($e.paint_symbol["text-opacity"]),"text-occlusion-opacity":new $t($e.paint_symbol["text-occlusion-opacity"]),"text-color":new $t($e.paint_symbol["text-color"],{runtimeType:Vo,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new $t($e.paint_symbol["text-halo-color"]),"text-halo-width":new $t($e.paint_symbol["text-halo-width"]),"text-halo-blur":new $t($e.paint_symbol["text-halo-blur"]),"text-translate":new Mt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Mt($e.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Mt($e.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Mt($e.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Mt($e.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Mt($e.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new $t($e.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},QC);class eT extends qs{constructor(i,a,d,f){super(i,eI(),a,d,f),this._colorAdjustmentMatrix=N([]),this.hasInitialOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,a){super.recalculate(i,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const f=[];for(const y of d)f.indexOf(y)<0&&f.push(y);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,a,d,f){return this._saturation===i&&this._contrast===a&&this._brightnessMin===d&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(y,_,S,A){y=Gs(y),_=Eo(_);const k=B(),j=y/3,R=1-2*j,L=[R,j,j,0,j,R,j,0,j,j,R,0,0,0,0,1],W=.5-.5*_,q=A-S;return U(k,[q,0,0,0,0,q,0,0,0,0,q,0,S,S,S,1],[_,0,0,0,0,_,0,0,0,0,_,0,W,W,W,1]),U(k,k,L),k}(i,a,d,f),this._saturation=i,this._contrast=a,this._brightnessMin=d,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,a,d,f){const y=this.layout.get(i).evaluate(a,{},d,f),_=this._unevaluatedLayout._values[i];return _.isDataDriven()||n0(_.value)||!y?y:function(S,A){return A.replace(/{([^{}]+)}/g,(k,j)=>j in S?String(S[j]):"")}(a.properties,y)}createBucket(i){return new QS(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of eI().paint.overridableProperties){if(!eT.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),d=new q5(a),f=new r0(d,a.property.specification,this.scope,this.options);let y=null;y=a.value.kind==="constant"||a.value.kind==="source"?new wg("source",f):new Wc("composite",f,a.value.zoomStops,a.value.interpolationType),this.paint._values[i]=new Xu(a.property,y,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,d){return!(!this.layout||a.isDataDriven()||d.isDataDriven())&&eT.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const d=i.get("text-field"),f=eI().paint.properties[a];let y=!1;const _=S=>{for(const A of S)if(f.overrides&&f.overrides.hasOverride(A))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof lo)_(d.value.value.sections);else if(d.value.kind==="source"){const S=k=>{y||(k instanceof mr&&Wt(k.value)===Hf?_(k.value.sections):k instanceof Yh?_(k.sections):k.eachChild(S))},A=d.value;A._styleExpression&&S(A._styleExpression.expression)}return y}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,a,d){return{config:new ho(this,{zoom:a,lut:d}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Z5,K5,X5,Y5;var tI=Yr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function tT(l,i,a,d,f,y,_,S){const A=[l,i,1,a,d,1,f,y,1],k=[_,S,1],j=O([],A),[R,L,W]=Sr(k,k,j);return D(A,A,[R,0,0,0,L,0,0,0,W])}function J5(l,i,a,d,f,y,_,S){const A=function(k,j,R,L,W,q,J,Q){const oe=tT(0,0,1,0,1,1,0,1),de=tT(k,j,R,L,W,q,J,Q);return D(de,de,O([],oe))}(l,i,a,d,f,y,_,S);return[A[2]/A[8]/Dt,A[5]/A[8]/Dt]}function rT(l){return[l[0],Math.min(Math.max(l[1],-we),we)]}class Q5 extends Fu{constructor(i,a,d,f){super(),this.id=i,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=a,this._dirty=!1}load(i,a){if(this._loaded=a||!1,this.fire(new ql("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=Vf(this.map._requestManager.transformRequest(this.url,Nf.Image),(d,f)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new na(d)):f&&(this.image=f instanceof HTMLImageElement?Qa.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new X0(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ql("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof X0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=i[0][1],d=i[0][1];for(const y of i)y[1]>d&&(d=y[1]),y[1]<a&&(a=y[1]);const f=(d+a)/2;if(f>we?this.onNorthPole=!0:f<-we&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const y=i.map(Ue.fromLngLat);this.tileID=function(_){let S=1/0,A=1/0,k=-1/0,j=-1/0;for(const J of _)S=Math.min(S,J.x),A=Math.min(A,J.y),k=Math.max(k,J.x),j=Math.max(j,J.y);const R=Math.max(k-S,j-A),L=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),W=Math.pow(2,L);let q=Math.floor((S+k)/2*W);return q>1&&(q-=1),new Oo(L,q,Math.floor((A+j)/2*W))}(y),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ql("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof X0||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const oe in this.tiles){const de=this.tiles[oe];de.state!=="loaded"&&(de.state="loaded",de.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=sx(new Oo(0,0,0),this.map.transform.projection),d=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(oe){const de=oe[1].x-oe[0].x,he=oe[1].y-oe[0].y,fe=oe[2].x-oe[1].x,Ie=oe[2].y-oe[1].y,Ae=oe[3].x-oe[2].x,ke=oe[3].y-oe[2].y,Le=oe[0].x-oe[3].x,Be=oe[0].y-oe[3].y,at=de*Ie-fe*he,Ge=fe*ke-Ae*Ie,ft=Ae*Be-Le*ke,wt=Le*he-de*Be;return at>0&&Ge>0&&ft>0&&wt>0||at<0&&Ge<0&&ft<0&&wt<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=sx(this.tileID,this.map.transform.projection),[y,_,S,A]=this.coordinates.map(oe=>{const de=f.projection.project(oe[0],oe[1]);return F5(f,de)._round()});this.perspectiveTransform=J5(y.x,y.y,_.x,_.y,S.x,S.y,A.x,A.y);const k=this._boundsArray=new md;k.emplaceBack(y.x,y.y,0,0),k.emplaceBack(_.x,_.y,Dt,0),k.emplaceBack(A.x,A.y,0,Dt),k.emplaceBack(S.x,S.y,Dt,Dt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(k,tI.members),this.boundsSegments=ui.simpleSegment(0,0,4,2);const j=[],R=[rT((L=this.coordinates)[0]),rT(L[1]),rT(L[2]),rT(L[3])];var L;const[W,q,J,Q]=function(oe){let de=oe[0][0],he=de,fe=oe[0][1],Ie=fe;for(let Ae=1;Ae<oe.length;Ae++)oe[Ae][0]<de?de=oe[Ae][0]:oe[Ae][0]>he&&(he=oe[Ae][0]),oe[Ae][1]<fe?fe=oe[Ae][1]:oe[Ae][1]>Ie&&(Ie=oe[Ae][1]);return[de,fe,he-de,Ie-fe]}(R);{const oe=new md,[de,he,fe,Ie]=function(it){let Tt=it[0].x,Xe=Tt,ot=it[0].y,It=ot;for(let St=1;St<it.length;St++)it[St].x<Tt?Tt=it[St].x:it[St].x>Xe&&(Xe=it[St].x),it[St].y<ot?ot=it[St].y:it[St].y>It&&(It=it[St].y);return[Tt,ot,Xe-Tt,It-ot]}(d),Ae=it=>[(it.x-de)/fe,(it.y-he)/Ie],[ke,Le,Be,at]=d.map(Ae),Ge=function(it,Tt,Xe,ot,It,St,or,Kt){const _t=tT(0,0,1,0,1,1,0,1);return D(_t,_t,O([],tT(it,Tt,Xe,ot,It,St,or,Kt)))}(ke[0],ke[1],Le[0],Le[1],Be[0],Be[1],at[0],at[1]);this.elevatedGlobePerspectiveTransform=J5(ke[0],ke[1],Le[0],Le[1],Be[0],Be[1],at[0],at[1]);const ft=(it,Tt)=>{j.push(it.lng);const Xe=Math.round((it.lng-W)/J*Dt),ot=Math.round((it.lat-q)/Q*Dt),It=Ae(Tt),St=Sr([],[It[0],It[1],1],Ge),or=Math.round(St[0]/St[2]*Dt),Kt=Math.round(St[1]/St[2]*Dt);oe.emplaceBack(Xe,ot,or,Kt)},wt=d[3].x-d[0].x,xt=d[3].y-d[0].y,At=d[2].x-d[1].x,kt=d[2].y-d[1].y;for(let it=0;it<65;it++){const Tt=it/64,Xe=[d[0].x+Tt*wt,d[0].y+Tt*xt],ot=[d[1].x+Tt*At,d[1].y+Tt*kt],It=ot[0]-Xe[0],St=ot[1]-Xe[1];for(let or=0;or<65;or++){const Kt=or/64,_t={x:Xe[0]+It*Kt,y:Xe[1]+St*Kt};ft(a.projection.unproject(_t.x,_t.y),_t)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(oe,tI.members)}{this.maxLongitudeTriangleSize=0;let oe=[],de=new ii;const he=(fe,Ie,Ae)=>{de.emplaceBack(fe,Ie,Ae);const ke=j[fe],Le=j[Ie],Be=j[Ae],at=Math.min(Math.min(ke,Le),Be),Ge=Math.max(Math.max(ke,Le),Be)-at;Ge>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ge),oe.push(at+Ge/2)};for(let fe=0;fe<64;fe++)for(let Ie=0;Ie<64;Ie++){const Ae=65*fe+Ie,ke=Ae+1,Le=Ae+65,Be=Le+1;he(Ae,Le,ke),he(ke,Le,Be)}[oe,de]=function(fe,Ie){const Ae=Array.from({length:fe.length},(Be,at)=>at);Ae.sort((Be,at)=>fe[Be]-fe[at]);const ke=[],Le=new ii;for(let Be=0;Be<Ae.length;Be++){const at=Ae[Be];ke.push(fe[at]);const Ge=3*at,ft=Ge+1;Le.emplaceBack(Ie.uint16[Ge],Ie.uint16[ft],Ie.uint16[ft+1])}return[ke,Le]}(oe,de),this.elevatedGlobeTrianglesCenterLongitudes=oe,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(de)}this.elevatedGlobeSegments=ui.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,J/Dt,0,Q/Dt,0,0,q,W,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const a=this.map.painter.context,d=a.gl;!this._dirty||this.texture instanceof X0||(this.texture?this.texture.update(this.image):(this.texture=new IC(a,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(a)}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let f=(y=i+180)+360*Math.round((d[0]-y)/360);var y;const _=new ui,S=(R,L)=>{_.segments.push({vertexOffset:0,primitiveOffset:R,vertexLength:a.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-f)<=A){const R=bs(d,0,d.length,f+A);return R===d.length||S(R,ci(d,R+1,d.length,f+360-A)-R),_}f<d[0]&&(f+=360);const k=ci(d,0,d.length,f-A);if(k===d.length)return S(0,d.length),_;S(0,k-0);const j=bs(d,k+1,d.length,f+A);return j!==d.length&&S(j,d.length-j),_}}const ise=(Math.pow(256,2)-1)/16907520;class eB extends qs{constructor(i,a,d,f){super(i,{layout:X5||(X5=new wi({visibility:new Mt($e.layout_raster.visibility)})),paint:Y5||(Y5=new wi({"raster-opacity":new Mt($e.paint_raster["raster-opacity"]),"raster-color":new ud($e.paint_raster["raster-color"]),"raster-color-mix":new Mt($e.paint_raster["raster-color-mix"]),"raster-color-range":new Mt($e.paint_raster["raster-color-range"]),"raster-hue-rotate":new Mt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Mt($e.paint_raster["raster-saturation"]),"raster-contrast":new Mt($e.paint_raster["raster-contrast"]),"raster-resampling":new Mt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Mt($e.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Mt($e.paint_raster["raster-emissive-strength"]),"raster-array-band":new Mt($e.paint_raster["raster-array-band"]),"raster-elevation":new Mt($e.paint_raster["raster-elevation"]),"raster-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},a,d,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof Q5&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[d,f]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(f)||d===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=L0({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,f])}}let tB,rB,nB,iB,sB;class oB extends qs{constructor(i,a,d,f){super(i,{layout:tB||(tB=new wi({visibility:new Mt($e["layout_raster-particle"].visibility)})),paint:rB||(rB=new wi({"raster-particle-array-band":new Mt($e["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Mt($e["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ud($e["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Mt($e["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Mt($e["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Mt($e["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Mt($e["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Mt($e["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},a,d,f),this._updateColorRamp(),this.lastInvalidatedAt=Qa.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=L0({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Qa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class sse extends qs{constructor(i,a){super(i,{},a,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function rI(l,i,a){const d=[0,0,1],f=vs([]);return kc(f,f,a?-Br(l)+Math.PI:Br(l)),$l(f,f,-Br(i)),Vt(d,d,f),Er(d,d)}const aB={None:0,Model:1,Symbol:2,FillExtrusion:4};class nT{constructor(i,a,d,f){this.message=(i?`${i}: `:"")+d,f&&(this.identifier=f),a!=null&&a.__line__&&(this.line=a.__line__)}}function nI(l,i){const a=l.indexOf("://")===-1;try{return new URL(l,a&&i?"http://example.com":void 0),!0}catch{return!1}}class lB{constructor(i,a){this.feature=i,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class cB{constructor(){this.instancedDataArray=new Lg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class iI{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs}updateFootprints(i,a){}populate(i,a,d,f){this.tileToMeter=Ee(d);const y=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:S,index:A,sourceLayerIndex:k}of i){const j=S??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),R=Ze(_,y);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),R,d))continue;const L={id:j,sourceLayerIndex:k,index:A,geometry:y?R.geometry:nt(_,d,f),properties:_.properties,type:_.type,patterns:{}},W=this.addFeature(L,L.geometry,R);W&&a.featureIndex.insert(_,L.geometry,A,k,this.index,this.instancesPerModel[W].instancedDataArray.length,Dt/32)}this.lookup=null}update(i,a,d,f){for(const y in this.instancesPerModel){const _=this.instancesPerModel[y];for(const S in i)_.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(_.features[_.idToFeaturesIndex[S]],i[S],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];for(const f of d.features){const y=this.layers[0],_=f.feature,S=this.canonical,A=y.paint.get("model-rotation").evaluate(_,{},S),k=y.paint.get("model-scale").evaluate(_,{},S),j=y.paint.get("model-translation").evaluate(_,{},S);Jr(f.rotation,A)&&Jr(f.scale,k)&&Jr(f.translation,j)||(this.evaluate(f,f.featureStates,d,!0),i=!0)}}return i}updateReplacement(i,a,d,f){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const y=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(kS(this.activeReplacements,y))return!1;this.activeReplacements=y;let _=!1;for(const S in this.instancesPerModel){const A=this.instancesPerModel[S],k=A.instancedDataArray;for(const j of A.features){const R=j.instancedDataOffset,L=j.instancedDataCount;for(let W=0;W<L;W++){const q=16*(W+R);let J=k.float32[q+0];const Q=J>Dt;J=Q?J-Dt:J;const oe=Math.floor(J),de=k.float32[q+1];let he=!1;for(const fe of this.activeReplacements)if(!XN(fe,d,aB.Model,f)&&!(fe.min.x>oe||oe>fe.max.x||fe.min.y>de||de>fe.max.y)&&(he=_C(eF(oe,de,i.canonical,fe.footprintTileId.canonical),fe.footprint),he))break;k.float32[q]=he?J+Dt:J,_=_||he!==Q}}}return _}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=i.createVertexBuffer(d.instancedDataArray,zne.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)i.removeModel(a,"",!0)}addFeature(i,a,d){const f=this.layers[0],y=f.layout.get("model-id").evaluate(d,{},this.canonical);if(!y)return qr(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),y;(nI(y,!1)||this.styleDefinedModelURLs[y]!==void 0)&&(this.modelUris.includes(y)||this.modelUris.push(y)),this.instancesPerModel[y]||(this.instancesPerModel[y]=new cB);const _=this.instancesPerModel[y],S=_.instancedDataArray,A=new lB(d,S.length);for(const k of a)for(const j of k){if(j.x<0||j.x>=Dt||j.y<0||j.y>=Dt)continue;const R=(this.lookupDim-1)/Dt,L=this.lookupDim*(j.y*R|0)+j.x*R|0;if(this.lookup){if(this.lookup[L]!==0)continue;this.lookup[L]=1}this.instanceCount++;const W=S.length;S.resize(W+1),_.instancesEvaluatedElevation.push(0),S.float32[16*W]=j.x,S.float32[16*W+1]=j.y}return A.instancedDataCount=_.instancedDataArray.length-A.instancedDataOffset,A.instancedDataCount>0&&(i.id&&(_.idToFeaturesIndex[i.id]=_.features.length),_.features.push(A),this.evaluate(A,{},_,!1)),y}getModelUris(){return this.modelUris}evaluate(i,a,d,f){const y=this.layers[0],_=i.feature,S=this.canonical,A=i.rotation=y.paint.get("model-rotation").evaluate(_,a,S),k=i.scale=y.paint.get("model-scale").evaluate(_,a,S),j=i.translation=y.paint.get("model-translation").evaluate(_,a,S),R=y.paint.get("model-color").evaluate(_,a,S);R.a=y.paint.get("model-color-mix-intensity").evaluate(_,a,S);const L=[];this.maxVerticalOffset<j[2]&&(this.maxVerticalOffset=j[2]),this.maxScale=Math.max(Math.max(this.maxScale,k[0]),Math.max(k[1],k[2])),DF(L,A,k);const W=Math.round(100*R.a)+R.b/1.05;for(let q=0;q<i.instancedDataCount;++q){const J=i.instancedDataOffset+q,Q=16*J,oe=d.instancedDataArray.float32;let de=0;f&&(de=oe[Q+6]-d.instancesEvaluatedElevation[J]);const he=0|oe[Q+1];oe[Q]=(0|oe[Q])+R.r/1.05,oe[Q+1]=he+R.g/1.05,oe[Q+2]=W,oe[Q+3]=1/(S.z>10?this.tileToMeter:Ee(S,he)),oe[Q+4]=j[0],oe[Q+5]=j[1],oe[Q+6]=j[2]+de,oe[Q+7]=L[0],oe[Q+8]=L[1],oe[Q+9]=L[2],oe[Q+10]=L[4],oe[Q+11]=L[5],oe[Q+12]=L[6],oe[Q+13]=L[8],oe[Q+14]=L[9],oe[Q+15]=L[10],d.instancesEvaluatedElevation[J]=j[2]}}}let uB,hB;qt(iI,"ModelBucket",{omit:["layers"]}),qt(cB,"PerModelAttributes"),qt(lB,"ModelFeature");class Qg{constructor(i,a,d){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=d}static create(i,a,d){const f=d||i.findDEMTileFor(a);if(!f||!f.dem)return;const y=f.dem,_=f.tileID,S=1<<a.canonical.z-_.canonical.z;return new Qg(f,y.dim/Dt/S,[(a.canonical.x/S-_.canonical.x)*y.dim,(a.canonical.y/S-_.canonical.y)*y.dim])}tileCoordToPixel(i,a){const d=a*this._scale+this._offset[1];return new ut(Math.floor(i*this._scale+this._offset[0]),Math.floor(d))}getElevationAt(i,a,d,f){const y=i*this._scale+this._offset[0],_=a*this._scale+this._offset[1],S=Math.floor(y),A=Math.floor(_),k=this._dem;return f=!!f,d?lr(lr(k.get(S,A,f),k.get(S,A+1,f),_-A),lr(k.get(S+1,A,f),k.get(S+1,A+1,f),_-A),y-S):k.get(S,A,f)}getElevationAtPixel(i,a,d){return this._dem.get(i,a,!!d)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*ue(1,i)*this._dem.stride}}const sI=new Float32Array(262144),kp=new Uint8Array(262144);function dB(l){let i=0;if(l.meshes)for(const a of l.meshes)i=Math.max(i,a.aabb.max[2]);if(l.children)for(const a of l.children)i=Math.max(i,dB(a));return i}function fB(l,i,a){if(l.meshes)for(const d of l.meshes){if(d.aabb.min[0]===1/0)continue;const f=kr.applyTransform(d.aabb,l.matrix);a.insert(i,f.min[0],f.min[1],f.max[0],f.max[1])}if(l.children)for(const d of l.children)fB(d,i,a)}const pB=["","wall","door","roof","window","lamp","logo"];class mB{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:dB(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const a=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==i&&(d.transformedAabb=kr.applyTransformFast(d.aabb,this.node.matrix),a.encapsulate(d.transformedAabb)),i++;this.aabb=a}return this.aabb}}class iT{constructor(i,a,d,f,y,_,S,A){this.id=d,this.layers=i,this.layerIds=this.layers.map(k=>k.fqid),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.modelTraits|=Zg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=Zg.HasMapboxMeshFeatures),y&&(this.modelTraits|=Zg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=A,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const k of a)this.nodesInfo.push(new mB(k)),fB(k,S.featureIndexArray.length,S.grid),S.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,S.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(i,a){for(const d of this.getNodesInfo()){const f=d.node;f.footprint&&a.push({footprint:f.footprint,id:i})}}update(i){const a=Object.keys(i).length!==0;if(a&&!this.stateDependentLayers.length)return;const d=a?this.stateDependentLayers:this.layers;if(!qn(i,this.states))for(const f of d)this.evaluate(f,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const d of a){const f=d.node;this.uploaded?this.updatePbrBuffer(f):jC(f,i,!0)}for(const d of a)NS(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let a=!1;if(!i.meshes)return a;for(const d of i.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),a=!0);return a}needsReEvaluation(i,a,d){const f=i.transform.projectionOptions,y=i.style.getBrightness(),_=this.brightness!==y;if(!this.uploaded||this.dirty||f.name!==this.projection.name||ux(d.paint.get("model-color").value,_)||ux(d.paint.get("model-color-mix-intensity").value,_)||ux(d.paint.get("model-roughness").value,_)||ux(d.paint.get("model-emissive-strength").value,_)||ux(d.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=f,this.brightness=y;const S=this.getNodesInfo();for(const A of S)A.state=null;return!0}return!1}evaluateTransform(i,a){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const d=this.getNodesInfo(),f=this.id.canonical;for(const y of d){const _=y.feature;y.evaluatedTranslation=a.paint.get("model-translation").evaluate(_,{},f),y.evaluatedScale=a.paint.get("model-scale").evaluate(_,{},f)}}evaluate(i,a){const d=this.getNodesInfo();for(const f of d){if(!f.node.meshes)continue;const y=f.feature,_=a&&a[y.id];if(qn(_,f.state))continue;f.state=structuredClone(_);const S=f.node.meshes&&f.node.meshes[0].featureData,A=f.evaluatedColor[2],k=f.evaluatedRMEA[2],j=this.id.canonical;if(f.hasTranslucentParts=!1,S){for(let R=0;R<pB.length;R++){const L=pB[R];L.length&&(y.properties.part=L);const W=i.paint.get("model-color").evaluate(y,_,j).toPremultipliedRenderColor(null),q=i.paint.get("model-color-mix-intensity").evaluate(y,_,j);f.evaluatedColor[R]=[W.r,W.g,W.b,q],f.evaluatedRMEA[R][0]=i.paint.get("model-roughness").evaluate(y,_,j),f.evaluatedRMEA[R][2]=i.paint.get("model-emissive-strength").evaluate(y,_,j),f.evaluatedRMEA[R][3]=W.a,f.emissionHeightBasedParams[R]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(y,_,j),!f.hasTranslucentParts&&W.a<1&&(f.hasTranslucentParts=!0)}delete y.properties.part,ase(f,A!==f.evaluatedColor[2]||k!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(y,_,j);f.evaluatedTranslation=i.paint.get("model-translation").evaluate(y,_,j),f.evaluatedScale=i.paint.get("model-scale").evaluate(y,_,j),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,a,d,f){const y=i.findDEMTileFor(d);if(y&&(y.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(y.dem&&y.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=y.tileID.overscaledZ;const _=Qg.create(i,d,y);if(!_)return;this.modelTraits&Zg.HasMapboxMeshFeatures&&this.updateDEM(i,_,d,f);for(const S of this.getNodesInfo()){const A=S.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const k=A.footprint.vertices;let j=_.getElevationAt(k[0].x,k[0].y,!0,!0);for(let R=1;R<k.length;R++)j=Math.min(j,_.getElevationAt(k[R].x,k[R].y,!0,!0));A.elevation=j}}this.terrainTile=y.tileID.canonical,this.terrainExaggeration=a}}updateDEM(i,a,d,f){let y=a._dem._modifiedForSources[f];if(y===void 0&&(a._dem._modifiedForSources[f]=[],y=a._dem._modifiedForSources[f]),y.includes(d.canonical))return;const _=a._dem.dim;y.push(d.canonical);let S=!1;for(const A of this.getNodesInfo()){const k=A.node;if(!k.footprint||!k.footprint.grid)continue;const j=k.footprint.grid,R=a.tileCoordToPixel(j.min.x,j.min.y),L=a.tileCoordToPixel(j.max.x,j.max.y),W=Math.min(Math.min(_-L.y,R.x),Math.min(R.y,_-L.x));if(W<0)continue;const q=xe(W,2,5);let J=Math.max(0,R.x-q),Q=Math.max(0,R.y-q),oe=Math.min(L.x+q,_-1),de=Math.min(L.y+q,_-1);for(let Ae=Q;Ae<=de;++Ae)for(let ke=J;ke<=oe;++ke)kp[Ae*_+ke]=255;let he=0,fe=0;for(let Ae=0;Ae<j.cellsY;++Ae)for(let ke=0;ke<j.cellsX;++ke){if(!j.cells[Ae*j.cellsX+ke])continue;const Le=a.tileCoordToPixel(j.min.x+ke/j.xScale,j.min.y+Ae/j.yScale),Be=a.tileCoordToPixel(j.min.x+(ke+1)/j.xScale,j.min.y+(Ae+1)/j.yScale);for(let at=Le.y;at<=Math.min(Be.y+1,_-1);++at)for(let Ge=Le.x;Ge<=Math.min(Be.x+1,_-1);++Ge)kp[at*_+Ge]===255&&(kp[at*_+Ge]=0,he+=a.getElevationAtPixel(Ge,at),fe++)}const Ie=he/fe;J=Math.max(1,R.x-q),Q=Math.max(1,R.y-q),oe=Math.min(L.x+q,_-2),de=Math.min(L.y+q,_-2),S=!0;for(let Ae=Q;Ae<=de;++Ae)for(let ke=J;ke<=oe;++ke)kp[Ae*_+ke]===0&&(sI[Ae*_+ke]=a._dem.set(ke,Ae,Ie));for(let Ae=1;Ae<q;++Ae){J=Math.max(1,R.x-Ae),Q=Math.max(1,R.y-Ae),oe=Math.min(L.x+Ae,_-2),de=Math.min(L.y+Ae,_-2);for(let ke=Q;ke<=de;++ke)for(let Le=J;Le<=oe;++Le){const Be=ke*_+Le;if(kp[Be]===255){let at=0,Ge=0,ft=-1,wt=-1;for(let xt=-1;xt<=1;++xt)for(let At=-1;At<=1;++At){const kt=(ke+xt)*_+Le+At;if(kp[kt]>=Ae)continue;const it=sI[kt],Tt=Math.abs(it);Tt>Ge&&(at=it,Ge=Tt,ft=At,wt=xt)}if(Ge>.1){const xt=1-(Ae+.5*Math.abs(ft*wt))/q;let At=a._dem.get(Le,ke)+at*xt;const kt=a._dem.get(Le+ft,ke+wt),it=a._dem.get(Le-ft,ke-wt,!0);(At-kt)*(At-it)>0&&(At=(kt+it)/2),sI[Be]=a._dem.set(Le,ke,At),kp[Be]=Ae}}}}}S&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=Qa.now())}setFilter(i){this.filter=i?hd(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new On(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const a of i)NS(a.node),RC(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(i.toUnwrapped());for(const f of this.getNodesInfo()){const y=f.node.footprint;f.hiddenByReplacement=!!y&&!d.find(_=>_.footprint===y)}}getHeightAtTileCoord(i,a){const d=[],f=[0,0,0],y=N([]);for(const _ of this.getNodesInfo()){const S=_.node.meshes[0],A=S.transformedAabb;if(i<A.min[0]||a<A.min[1]||i>A.max[0]||a>A.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};G(y,_.node.matrix),f[0]=i,f[1]=a,Qt(f,f,y);const k=(f[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*Tp|0,j=Math.min(63,(f[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*Tp|0)*Tp+Math.min(63,k),R=S.heightmap[j];if(!(R<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:R,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new ut(i,a),new ut(i,a),d),d.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function ux(l,i){return l instanceof wg&&!l.isLightConstant&&i}function ose(l,i,a,d,f,y,_,S){let A=(61440&i|(61440&i)>>4)>>8,k=(3840&i|(3840&i)>>4)>>4,j=240&i|(240&i)>>4;a[3]>0&&(A=lr(A,255*a[0],a[3]),k=lr(k,255*a[1],a[3]),j=lr(j,255*a[2],a[3]));const R=A<<8|k,L=j<<8|Math.floor(255*d[3]),W=function(Ae){const ke=xe(Ae,0,2);return Math.min(Math.round(.5*ke*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],q=xe(f[0],0,1),J=xe(f[1],0,1),Q=xe(f[2],0,1),oe=xe(f[3],0,1);let de,he,fe,Ie;if(q!==J&&_!==y&&J!==q){const Ae=_-y;he=1/(Ae*(J-q)),fe=-(y+Ae*q)/(Ae*(J-q));const ke=xe(f[4],-1,1);Ie=Math.pow(10,ke),de=255*Q<<8|255*oe}else de=65535,he=0,fe=1,Ie=1;if(l.emplaceBack(R,L,W,de,he,fe,Ie),S){const Ae=S.length;S.clear();for(let ke=0;ke<Ae;ke++)S.emplaceBack(R,L,W,de,he,fe,Ie)}}function ase(l,i,a){const d=l.node;let f=0;const y=a&Zg.HasMeshoptCompression;for(const _ of d.meshes){if(d.lights&&d.lightMeshIndex===f||!_.featureData)continue;_.featureArray=new bd,_.featureArray.reserve(_.featureData.length);let S=i;for(const A of _.featureData){const k=y?65535&A:A>>16&65535,j=y?A>>16&65535:65535&A,R=(15&j)<8?15&j:0,L=l.evaluatedRMEA[R],W=l.evaluatedColor[R],q=l.emissionHeightBasedParams[R];let J;if(S&&R===2&&d.lights&&(J=new bd,J.resize(10*d.lights.length)),ose(_.featureArray,k,W,L,q,_.aabb.min[2],_.aabb.max[2],J),J&&S){S=!1;const Q=d.meshes[d.lightMeshIndex];Q.featureArray=J,Q.featureArray._trim()}}_.featureArray._trim(),f++}}function gB(l,i,a,d){const f=1<<l.z;i.lat=me((d/Dt+l.y)/f),i.lng=pe((a/Dt+l.x)/f)}function lse(l,i,a,d){const f=l.getNodesInfo()[i];if(!f||f.hiddenByReplacement||!f.node.meshes)return;let y=Number.MAX_VALUE;const _=f.node,S=a.tile,A=d.calculatePosMatrix(S.tileID.toUnwrapped(),d.worldSize),k=f.evaluatedScale;let j=0;d.elevation&&_.elevation&&(j=_.elevation*d.elevation.exaggeration()),V(A,A,[(_.anchor?_.anchor[0]:0)*(k[0]-1),(_.anchor?_.anchor[1]:0)*(k[1]-1),j]),X(A,A,k);const R=a.queryGeometry,L=R.isPointQuery()?R.screenBounds:R.screenGeometry,W=function(J){const Q=U([],A,J.matrix);U(Q,d.expandedFarZProjMatrix,Q);for(let oe=0;oe<J.meshes.length;++oe){const de=J.meshes[oe];if(oe===J.lightMeshIndex)continue;const he=LF(L,d,Q,de.aabb);he!=null&&(y=Math.min(he,y))}if(J.children)for(const oe of J.children)W(oe)};if(W(_),y===Number.MAX_VALUE)return;const q=new H(0,0);return gB(S.tileID.canonical,q,f.node.anchor[0],f.node.anchor[1]),{intersectionZ:y,position:q,feature:f.feature}}qt(iT,"Tiled3dModelBucket",{omit:["layers"]}),qt(mB,"Tiled3dModelFeature");const cse={circle:class extends qs{constructor(l,i,a,d){super(l,{layout:Td||(Td=new wi({"circle-sort-key":new $t($e.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Mt($e.layout_circle["circle-elevation-reference"]),visibility:new Mt($e.layout_circle.visibility)})),paint:Ed||(Ed=new wi({"circle-radius":new $t($e.paint_circle["circle-radius"]),"circle-color":new $t($e.paint_circle["circle-color"]),"circle-blur":new $t($e.paint_circle["circle-blur"]),"circle-opacity":new $t($e.paint_circle["circle-opacity"]),"circle-translate":new Mt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Mt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t($e.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Mt($e.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}createBucket(l){return new Ln(l)}queryRadius(l){const i=l;return _i("circle-radius",this,i)+_i("circle-stroke-width",this,i)+Mo(this.paint.get("circle-translate"))}queryIntersectsFeature(l,i,a,d,f,y,_,S){const A=Qc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,l.pixelToTileUnitsFactor),k=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return SN(l,d,y,_,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,k)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,i,a){const d=wN(this);return{config:new ho(this,{zoom:i,lut:a}),defines:d,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends qs{createBucket(l){return new EN(l)}constructor(l,i,a,d){super(l,{layout:AN||(AN=new wi({visibility:new Mt($e.layout_heatmap.visibility)})),paint:kN||(kN=new wi({"heatmap-radius":new $t($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ud($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mt($e.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=L0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return _i("heatmap-radius",this,l)}queryIntersectsFeature(l,i,a,d,f,y,_,S){const A=this.paint.get("heatmap-radius").evaluate(i,a);return SN(l,d,y,_,S,!0,!0,new ut(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,i,a){return l==="heatmap"?{config:new ho(this,{zoom:i,lut:a}),overrideFog:!1}:{}}},hillshade:class extends qs{constructor(l,i,a,d){super(l,{layout:PN||(PN=new wi({visibility:new Mt($e.layout_hillshade.visibility)})),paint:CN||(CN=new wi({"hillshade-illumination-direction":new Mt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mt($e.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Mt($e.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,i,a){return{overrideFog:!1}}},fill:class extends qs{constructor(l,i,a,d){super(l,{layout:GN||(GN=new wi({"fill-sort-key":new $t($e.layout_fill["fill-sort-key"]),visibility:new Mt($e.layout_fill.visibility),"fill-elevation-reference":new Mt($e.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new $t($e.layout_fill["fill-construct-bridge-guard-rail"])})),paint:HN||(HN=new wi({"fill-antialias":new Mt($e.paint_fill["fill-antialias"]),"fill-opacity":new $t($e.paint_fill["fill-opacity"]),"fill-color":new $t($e.paint_fill["fill-color"]),"fill-outline-color":new $t($e.paint_fill["fill-outline-color"]),"fill-translate":new Mt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Mt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new $t($e.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Mt($e.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Mt($e.paint_fill["fill-emissive-strength"]),"fill-z-offset":new $t($e.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new $t($e.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new $t($e.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}getProgramIds(){const l=this.paint.get("fill-pattern"),i=l&&l.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(l,i,a){return{config:new ho(this,{zoom:i,lut:a}),overrideFog:!1}}recalculate(l,i){super.recalculate(l,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new mC(l)}queryRadius(){return Mo(this.paint.get("fill-translate"))}queryIntersectsFeature(l,i,a,d,f,y){return!l.queryGeometry.isAboveHorizon&&ji(Qu(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,l.pixelToTileUnitsFactor),d)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?i&&!l:i}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends qs{constructor(l,i,a,d){super(l,{layout:pF||(pF=new wi({visibility:new Mt($e["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Mt($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:mF||(mF=new wi({"fill-extrusion-opacity":new Mt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $t($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Mt($e["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new $t($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Mt($e["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Mt($e["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Mt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Mt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Mt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Mt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Mt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Mt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Mt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Mt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new $t($e["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new $t($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Mt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Mt($e["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Mt($e["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Mt($e["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new $t($e["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new $t($e["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Mt($e["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new CS(l)}queryRadius(){return Mo(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,i,a,d,f,y,_,S,A){const k=Qc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,l.pixelToTileUnitsFactor),j=this.paint.get("fill-extrusion-height").evaluate(i,a),R=this.paint.get("fill-extrusion-base").evaluate(i,a),L=[0,0],W=S&&y.elevation,q=y.elevation?y.elevation.exaggeration():1,J=l.tile.getBucket(this);if(W&&J instanceof CS){const fe=J.centroidVertexArray,Ie=A+1;Ie<fe.length&&(L[0]=fe.geta_centroid_pos0(Ie),L[1]=fe.geta_centroid_pos1(Ie))}if(L[0]===0&&L[1]===1)return!1;y.projection.name==="globe"&&(d=fF([d],[new ut(0,0),new ut(Dt,Dt)],l.tileID.canonical).map(fe=>fe.polygon).flat());const Q=W?S:null,[oe,de]=function(fe,Ie,Ae,ke,Le,Be,at,Ge,ft,wt,xt){return fe.projection.name==="globe"?function(At,kt,it,Tt,Xe,ot,It,St,or,Kt,_t){const Ct=[],rr=[],Bt=At.projection.upVectorScale(_t,At.center.lat,At.worldSize).metersToTile,Nt=[0,0,0,1],Ht=[0,0,0,1],pr=(Cr,Ar,Qr,Vr)=>{Cr[0]=Ar,Cr[1]=Qr,Cr[2]=Vr,Cr[3]=1},gr=dF();it>0&&(it+=gr),Tt+=gr;for(const Cr of kt){const Ar=[],Qr=[];for(const Vr of Cr){const Kn=Vr.x+Xe.x,_e=Vr.y+Xe.y,ve=At.projection.projectTilePoint(Kn,_e,_t),st=At.projection.upVector(_t,Vr.x,Vr.y);let Rt=it,zt=Tt;if(It){const Lt=bF(Kn,_e,it,Tt,It,St,or,Kt);Rt+=Lt.base,zt+=Lt.top}it!==0?pr(Nt,ve.x+st[0]*Bt*Rt,ve.y+st[1]*Bt*Rt,ve.z+st[2]*Bt*Rt):pr(Nt,ve.x,ve.y,ve.z),pr(Ht,ve.x+st[0]*Bt*zt,ve.y+st[1]*Bt*zt,ve.z+st[2]*Bt*zt),Qt(Nt,Nt,ot),Qt(Ht,Ht,ot),Ar.push(new wp(Nt[0],Nt[1],Nt[2])),Qr.push(new wp(Ht[0],Ht[1],Ht[2]))}Ct.push(Ar),rr.push(Qr)}return[Ct,rr]}(fe,Ie,Ae,ke,Le,Be,at,Ge,ft,wt,xt):at?function(At,kt,it,Tt,Xe,ot,It,St,or){const Kt=[],_t=[],Ct=[0,0,0,1];for(const rr of At){const Bt=[],Nt=[];for(const Ht of rr){const pr=Ht.x+Tt.x,gr=Ht.y+Tt.y,Cr=bF(pr,gr,kt,it,ot,It,St,or);Ct[0]=pr,Ct[1]=gr,Ct[2]=Cr.base,Ct[3]=1,Bi(Ct,Ct,Xe),Ct[3]=Math.max(Ct[3],1e-5);const Ar=new wp(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Ct[0]=pr,Ct[1]=gr,Ct[2]=Cr.top,Ct[3]=1,Bi(Ct,Ct,Xe),Ct[3]=Math.max(Ct[3],1e-5);const Qr=new wp(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Bt.push(Ar),Nt.push(Qr)}Kt.push(Bt),_t.push(Nt)}return[Kt,_t]}(Ie,Ae,ke,Le,Be,at,Ge,ft,wt):function(At,kt,it,Tt,Xe){const ot=[],It=[],St=Xe[8]*kt,or=Xe[9]*kt,Kt=Xe[10]*kt,_t=Xe[11]*kt,Ct=Xe[8]*it,rr=Xe[9]*it,Bt=Xe[10]*it,Nt=Xe[11]*it;for(const Ht of At){const pr=[],gr=[];for(const Cr of Ht){const Ar=Cr.x+Tt.x,Qr=Cr.y+Tt.y,Vr=Xe[0]*Ar+Xe[4]*Qr+Xe[12],Kn=Xe[1]*Ar+Xe[5]*Qr+Xe[13],_e=Xe[2]*Ar+Xe[6]*Qr+Xe[14],ve=Xe[3]*Ar+Xe[7]*Qr+Xe[15],st=Vr+St,Rt=Kn+or,zt=_e+Kt,Lt=Math.max(ve+_t,1e-5),Jt=Vr+Ct,yr=Kn+rr,Ur=_e+Bt,$r=Math.max(ve+Nt,1e-5);pr.push(new wp(st/Lt,Rt/Lt,zt/Lt)),gr.push(new wp(Jt/$r,yr/$r,Ur/$r))}ot.push(pr),It.push(gr)}return[ot,It]}(Ie,Ae,ke,Le,Be)}(y,d,R,j,k,_,Q,L,q,y.center.lat,l.tileID.canonical),he=l.queryGeometry;return function(fe,Ie,Ae){let ke=1/0;ji(Ae,Ie)&&(ke=xF(Ae,Ie[0]));for(let Le=0;Le<Ie.length;Le++){const Be=Ie[Le],at=fe[Le];for(let Ge=0;Ge<Be.length-1;Ge++){const ft=Be[Ge],wt=[ft,Be[Ge+1],at[Ge+1],at[Ge],ft];Ei(Ae,wt)&&(ke=Math.min(ke,xF(Ae,wt)))}}return ke!==1/0&&ke}(oe,de,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends qs{constructor(l,i,a,d){super(l,{layout:HF||(HF=new wi({visibility:new Mt($e.layout_building.visibility),"building-facade":new $t($e.layout_building["building-facade"]),"building-facade-floors":new $t($e.layout_building["building-facade-floors"]),"building-facade-window":new $t($e.layout_building["building-facade-window"]),"building-roof-shape":new $t($e.layout_building["building-roof-shape"]),"building-height":new $t($e.layout_building["building-height"]),"building-base":new $t($e.layout_building["building-base"])})),paint:WF||(WF=new wi({"building-opacity":new Mt($e.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Mt($e.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Mt($e.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Mt($e.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Mt($e.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Mt($e.paint_building["building-vertical-scale"]),"building-cast-shadows":new Mt($e.paint_building["building-cast-shadows"]),"building-color":new $t($e.paint_building["building-color"]),"building-emissive-strength":new $t($e.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Mt($e.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Mt($e.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new GF(l)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}},line:class extends qs{constructor(l,i,a,d){const f=r5();super(l,f,i,a,d),f.layout&&(this.layout=new rl(f.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof tp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,i){super.recalculate(l,i),this.paint._values["line-floorwidth"]=(()=>{if(J0)return J0;const a=r5();return J0=new oie(a.paint.properties["line-width"].specification),J0.useIntegerZoom=!0,J0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new zC(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,i,a){const d=e5(this);return{config:new ho(this,{zoom:i,lut:a}),defines:d,overrideFog:!1}}queryRadius(l){const i=l,a=n5(_i("line-width",this,i),_i("line-gap-width",this,i)),d=_i("line-offset",this,i);return a/2+Math.abs(d)+Mo(this.paint.get("line-translate"))}queryIntersectsFeature(l,i,a,d,f,y){if(l.queryGeometry.isAboveHorizon)return!1;const _=Qu(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,l.pixelToTileUnitsFactor),S=l.pixelToTileUnitsFactor/2*n5(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),A=this.paint.get("line-offset").evaluate(i,a);return A&&(d=function(k,j){const R=[],L=new ut(0,0);for(let W=0;W<k.length;W++){const q=k[W],J=[];for(let Q=0;Q<q.length;Q++){const oe=q[Q],de=q[Q+1],he=Q===0?L:oe.sub(q[Q-1])._unit()._perp(),fe=Q===q.length-1?L:de.sub(oe)._unit()._perp(),Ie=he._add(fe)._unit();Ie._mult(1/(Ie.x*fe.x+Ie.y*fe.y)),J.push(Ie._mult(j)._add(oe))}R.push(J)}return R}(d,A*l.pixelToTileUnitsFactor)),function(k,j,R){for(let L=0;L<j.length;L++){const W=j[L];if(k.length>=3){for(let q=0;q<W.length;q++)if(si(k,W[q]))return!0}if(Rs(k,W,R))return!0}return!1}(_,d,S)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:eT,background:class extends qs{constructor(l,i,a,d){super(l,{layout:Z5||(Z5=new wi({visibility:new Mt($e.layout_background.visibility)})),paint:K5||(K5=new wi({"background-pitch-alignment":new Mt($e.paint_background["background-pitch-alignment"]),"background-color":new Mt($e.paint_background["background-color"]),"background-pattern":new Mt($e.paint_background["background-pattern"]),"background-opacity":new Mt($e.paint_background["background-opacity"]),"background-emissive-strength":new Mt($e.paint_background["background-emissive-strength"]),"background-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,i,a){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:eB,"raster-particle":oB,sky:class extends qs{constructor(l,i,a,d){super(l,{layout:nB||(nB=new wi({visibility:new Mt($e.layout_sky.visibility)})),paint:iB||(iB=new wi({"sky-type":new Mt($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new Mt($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Mt($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Mt($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Mt($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new ud($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Mt($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Mt($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Mt($e.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=L0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(l,i){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),f=!d,y=l.style.light,_=y.properties.get("position");return f&&y.properties.get("anchor")==="viewport"&&qr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?rI(_.azimuthal,90-_.polar,i):rI(d[0],90-d[1],i)}const a=this.paint.get("sky-gradient-center");return rI(a[0],90-a[1],i)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends qs{constructor(l,i,a,d){super(l,{paint:sB||(sB=new wi({}))},i,null)}},model:class extends qs{constructor(l,i,a,d){super(l,{layout:uB||(uB=new wi({visibility:new Mt($e.layout_model.visibility),"model-id":new $t($e.layout_model["model-id"])})),paint:hB||(hB=new wi({"model-opacity":new $t($e.paint_model["model-opacity"]),"model-rotation":new $t($e.paint_model["model-rotation"]),"model-scale":new $t($e.paint_model["model-scale"]),"model-translation":new $t($e.paint_model["model-translation"]),"model-color":new $t($e.paint_model["model-color"]),"model-color-mix-intensity":new $t($e.paint_model["model-color-mix-intensity"]),"model-type":new Mt($e.paint_model["model-type"]),"model-cast-shadows":new Mt($e.paint_model["model-cast-shadows"]),"model-receive-shadows":new Mt($e.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Mt($e.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new $t($e.paint_model["model-emissive-strength"]),"model-roughness":new $t($e.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new $t($e.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Mt($e.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Mt($e.paint_model["model-front-cutoff"]),"model-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new iI(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof iT?Dt-1:0}queryIntersectsFeature(l,i,a,d,f,y){if(!this.modelManager)return!1;const _=this.modelManager,S=l.tile.getBucket(this);if(!(S&&S instanceof iI))return!1;for(const A in S.instancesPerModel){const k=S.instancesPerModel[A],j=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(k.idToFeaturesIndex.hasOwnProperty(j)){const R=k.features[k.idToFeaturesIndex[j]],L=_.getModel(A,this.scope);if(!L)return!1;let W=B();const q=new H(0,0),J=S.canonical;let Q=Number.MAX_VALUE;for(let oe=0;oe<R.instancedDataCount;++oe){const de=16*(R.instancedDataOffset+oe),he=k.instancedDataArray.float32,fe=[he[de+4],he[de+5],he[de+6]];gB(J,q,he[de],0|he[de+1]),zF(W,L,y,q,R.rotation,R.scale,fe,!1,!1,!1),y.projection.name==="globe"&&(W=OC(W,y));const Ie=U([],y.projMatrix,W),Ae=l.queryGeometry,ke=LF(Ae.isPointQuery()?Ae.screenBounds:Ae.screenGeometry,y,Ie,L.aabb);ke!=null&&(Q=Math.min(ke,Q))}return Q!==Number.MAX_VALUE&&Q}}return!1}_handleOverridablePaintPropertyUpdate(l,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const i=this._transitionablePaint._values[l];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof Wc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends qs{constructor(l,i,a,d){super(l,{layout:WN||(WN=new wi({"clip-layer-types":new Mt($e.layout_clip["clip-layer-types"]),"clip-layer-scope":new Mt($e.layout_clip["clip-layer-scope"])})),paint:qN||(qN=new wi({}))},i,a,d)}recalculate(l,i){super.recalculate(l,i)}createBucket(l){return new ZN(l)}is3D(l){return!0}}},oI=new Tn(0,0,0),aI={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},lI={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},sT={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},use={PAINT_ORDER_FILL_AND_STROKE:1},hx={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},yB={MASK_TYPE_LUMINANCE:1};function hse(l,i,a){l===1&&i.icons.push(function(d,f){return function(y){if(y.usvg_tree.height||(y.usvg_tree.height=y.usvg_tree.width),!y.metadata)return y;const{metadata:_}=y;if(_.content_area){const{content_area:S}=_;S.top==null&&(S.top=S.left),S.width==null&&(S.width=y.usvg_tree.width),S.height==null&&(S.height=S.width)}return _.stretch_x&&_.stretch_x.length&&_B(_,"x"),_.stretch_y&&_.stretch_y.length&&_B(_,"y"),y}(d.readFields(dse,{name:void 0},f))}(a,a.readVarint()+a.pos))}function _B(l,i){const a=[],d=l[`stretch_${i}`];let f=null;for(let y=0;y<d.length;y++)f===null?f=a.length===0?d[0]:a[a.length-1][1]+d[y]:(a.push([f,f+d[y]]),f=null);l[`stretch_${i}_areas`]=a}function dse(l,i,a){l===1?i.name=a.readString():l===2?i.metadata=function(d,f){return d.readFields(fse,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},f)}(a,a.readVarint()+a.pos):l===3&&(i.usvg_tree=function(d,f){return d.readFields(gse,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},f)}(a,a.readVarint()+a.pos),i.data="usvg_tree")}function fse(l,i,a){l===1?i.stretch_x=a.readPackedVarint():l===2?i.stretch_y=a.readPackedVarint():l===3?i.content_area=function(d,f){return d.readFields(pse,{left:0},f)}(a,a.readVarint()+a.pos):l===4&&i.variables.push(function(d,f){return d.readFields(mse,{name:void 0},f)}(a,a.readVarint()+a.pos))}function pse(l,i,a){l===1?i.left=a.readVarint():l===2?i.width=a.readVarint():l===3?i.top=a.readVarint():l===4&&(i.height=a.readVarint())}function mse(l,i,a){l===1?i.name=a.readString():l===2&&(i.rgb_color=lT(a.readVarint()),i.value="rgb_color")}function gse(l,i,a){l===1?i.width=i.height=a.readVarint():l===2?i.height=a.readVarint():l===3?i.children.push(oT(a,a.readVarint()+a.pos)):l===4?i.linear_gradients.push(function(d,f){return d.readFields(Sse,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},f)}(a,a.readVarint()+a.pos)):l===5?i.radial_gradients.push(function(d,f){return d.readFields(Ese,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},f)}(a,a.readVarint()+a.pos)):l===7?i.clip_paths.push(function(d,f){return d.readFields(Ase,{children:[]},f)}(a,a.readVarint()+a.pos)):l===8&&i.masks.push(function(d,f){const y=d.readFields(kse,{left:0,width:20,mask_type:yB.MASK_TYPE_LUMINANCE,children:[]},f);return y.height==null&&(y.height=y.width),y.top==null&&(y.top=y.left),y}(a,a.readVarint()+a.pos))}function oT(l,i){return l.readFields(yse,{},i)}function yse(l,i,a){l===1?(i.group=function(d,f){return d.readFields(_se,{opacity:255,children:[]},f)}(a,a.readVarint()+a.pos),i.node="group"):l===2&&(i.path=function(d,f){return d.readFields(xse,{paint_order:1,commands:[],step:1,diffs:[],rule:aI.PATH_RULE_NON_ZERO},f)}(a,a.readVarint()+a.pos),i.node="path")}function _se(l,i,a){l===1?i.transform=aT(a,a.readVarint()+a.pos):l===2?i.opacity=a.readVarint():l===5?i.clip_path_idx=a.readVarint():l===6?i.mask_idx=a.readVarint():l===7&&i.children.push(oT(a,a.readVarint()+a.pos))}function aT(l,i){return l.readFields(vse,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function vse(l,i,a){l===1?i.sx=a.readFloat():l===2?i.ky=a.readFloat():l===3?i.kx=a.readFloat():l===4?i.sy=a.readFloat():l===5?i.tx=a.readFloat():l===6&&(i.ty=a.readFloat())}function xse(l,i,a){l===1?i.fill=function(d,f){return d.readFields(bse,{rgb_color:oI,paint:"rgb_color",opacity:255},f)}(a,a.readVarint()+a.pos):l===2?i.stroke=function(d,f){return d.readFields(wse,{rgb_color:oI,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},f)}(a,a.readVarint()+a.pos):l===3?i.paint_order=a.readVarint():l===5?a.readPackedVarint(i.commands):l===6?i.step=a.readFloat():l===7?a.readPackedSVarint(i.diffs):l===8&&(i.rule=a.readVarint())}function bse(l,i,a){l===1?(i.rgb_color=lT(a.readVarint()),i.paint="rgb_color"):l===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):l===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):l===5&&(i.opacity=a.readVarint())}function lT(l){return new Tn((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function wse(l,i,a){l===1?(i.rgb_color=lT(a.readVarint()),i.paint="rgb_color"):l===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):l===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):l===5?a.readPackedFloat(i.dasharray):l===6?i.dashoffset=a.readFloat():l===7?i.miterlimit=a.readFloat():l===8?i.opacity=a.readVarint():l===9?i.width=a.readFloat():l===10?i.linecap=a.readVarint():l===11&&(i.linejoin=a.readVarint())}function Sse(l,i,a){l===1?i.transform=aT(a,a.readVarint()+a.pos):l===2?i.spread_method=a.readVarint():l===3?i.stops.push(vB(a,a.readVarint()+a.pos)):l===4?i.x1=a.readFloat():l===5?i.y1=a.readFloat():l===6?i.x2=a.readFloat():l===7&&(i.y2=a.readFloat())}function vB(l,i){return l.readFields(Tse,{offset:0,opacity:255,rgb_color:oI},i)}function Tse(l,i,a){l===1?i.offset=a.readFloat():l===2?i.opacity=a.readVarint():l===3&&(i.rgb_color=lT(a.readVarint()))}function Ese(l,i,a){l===1?i.transform=aT(a,a.readVarint()+a.pos):l===2?i.spread_method=a.readVarint():l===3?i.stops.push(vB(a,a.readVarint()+a.pos)):l===4?i.cx=a.readFloat():l===5?i.cy=a.readFloat():l===6?i.r=a.readFloat():l===7?i.fx=a.readFloat():l===8?i.fy=a.readFloat():l===9&&(i.fr=a.readFloat())}function Ase(l,i,a){l===1?i.transform=aT(a,a.readVarint()+a.pos):l===2?i.clip_path_idx=a.readVarint():l===3&&i.children.push(oT(a,a.readVarint()+a.pos))}function kse(l,i,a){l===1?i.left=i.top=a.readFloat():l===2?i.width=i.height=a.readFloat():l===3?i.top=a.readFloat():l===4?i.height=a.readFloat():l===5?i.mask_type=a.readVarint():l===6?i.mask_idx=a.readVarint():l===7&&i.children.push(oT(a,a.readVarint()+a.pos))}class Pse{static calculate(i={},a=[]){const d=new Map,f=new Map;if(Object.keys(i).length===0)return d;a.forEach(y=>{f.set(y.name,y.rgb_color||new Tn(0,0,0))});for(const[y,_]of Object.entries(i))f.has(y)?d.set(f.get(y).toString(),_):console.warn(`Ignoring unknown image variable "${y}"`);return d}}function ey(l,i=255,a){const d=i/255,f=l.toString(),y=a.has(f)?a.get(f).clone():l.clone();return y.a*=d,y.toString()}function dx(l,i){if(!$m()){const a=document.createElement("canvas");return a.width=l,a.height=i,a}return new OffscreenCanvas(l,i)}function Cse(l,i){const a=Pse.calculate(i.params,l.metadata?l.metadata.variables:[]),d=l.usvg_tree,f=d.width,y=d.height,_=i.transform?i.transform:new DOMMatrix,S=Math.max(1,Math.round(f*_.a)),A=Math.max(1,Math.round(y*_.d)),k=new DOMMatrix([S/f,0,0,A/y,0,0]),j=dx(S,A).getContext("2d");return cI(j,k,d,d,a),j.getImageData(0,0,S,A)}function cI(l,i,a,d,f){for(const y of d.children)xB(l,i,a,y,f)}function xB(l,i,a,d,f){d.group?(l.save(),function(y,_,S,A,k){const j=A.mask_idx!=null?S.masks[A.mask_idx]:null,R=A.clip_path_idx!=null?S.clip_paths[A.clip_path_idx]:null;if(A.transform&&(_=ty(A.transform).preMultiplySelf(_)),!function(q,J,Q){return q.opacity!==255||J||Q}(A,R!=null,j!=null))return void cI(y,_,S,A,k);const L=dx(y.canvas.width,y.canvas.height),W=L.getContext("2d");cI(W,_,S,A,k),R&&kB(W,_,S,R),j&&PB(W,_,S,j,k),y.globalAlpha=A.opacity/255,y.drawImage(L,0,0)}(l,i,a,d.group,f),l.restore()):d.path&&(l.save(),function(y,_,S,A,k){y.setTransform(_),A.paint_order===use.PAINT_ORDER_FILL_AND_STROKE?(bB(y,S,A,k),SB(y,S,A,k)):(SB(y,S,A,k),bB(y,S,A,k))}(l,i,a,d.path,f),l.restore())}function bB(l,i,a,d){const f=a.fill;if(!f)return;const y=f.opacity/255;switch(l.save(),l.beginPath(),CB(a,l),f.paint){case"rgb_color":l.fillStyle=ey(f.rgb_color,f.opacity,d);break;case"linear_gradient_idx":{const _=i.linear_gradients[f.linear_gradient_idx];_.transform&&l.setTransform(ty(_.transform).preMultiplySelf(l.getTransform())),l.fillStyle=TB(l,_,y,d);break}case"radial_gradient_idx":{const _=i.radial_gradients[f.radial_gradient_idx];_.transform&&l.setTransform(ty(_.transform).preMultiplySelf(l.getTransform())),l.fillStyle=EB(l,_,y,d)}}l.fill(wB(a)),l.restore()}function wB(l){return l.rule===aI.PATH_RULE_NON_ZERO?"nonzero":l.rule===aI.PATH_RULE_EVEN_ODD?"evenodd":void 0}function SB(l,i,a,d){const f=a.stroke;if(!f)return;const y=IB(a);l.lineWidth=f.width,l.miterLimit=f.miterlimit,l.setLineDash(f.dasharray),l.lineDashOffset=f.dashoffset;const _=f.opacity/255;switch(f.paint){case"rgb_color":l.strokeStyle=ey(f.rgb_color,f.opacity,d);break;case"linear_gradient_idx":l.strokeStyle=TB(l,i.linear_gradients[f.linear_gradient_idx],_,d,!0);break;case"radial_gradient_idx":l.strokeStyle=EB(l,i.radial_gradients[f.radial_gradient_idx],_,d,!0)}switch(f.linejoin){case sT.LINE_JOIN_MITER_CLIP:case sT.LINE_JOIN_MITER:l.lineJoin="miter";break;case sT.LINE_JOIN_ROUND:l.lineJoin="round";break;case sT.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(f.linecap){case lI.LINE_CAP_BUTT:l.lineCap="butt";break;case lI.LINE_CAP_ROUND:l.lineCap="round";break;case lI.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(y)}function TB(l,i,a,d,f=!1){if(i.stops.length===1){const L=i.stops[0];return ey(L.rgb_color,L.opacity*a,d)}const{x1:y,y1:_,x2:S,y2:A}=i;let k=new DOMPoint(y,_),j=new DOMPoint(S,A);if(f){const L=ty(i.transform);k=L.transformPoint(k),j=L.transformPoint(j)}const R=l.createLinearGradient(k.x,k.y,j.x,j.y);for(const L of i.stops)R.addColorStop(L.offset,ey(L.rgb_color,L.opacity*a,d));return R}function EB(l,i,a,d,f=!1){if(i.stops.length===1){const oe=i.stops[0];return ey(oe.rgb_color,oe.opacity*a,d)}const y=ty(i.transform),{fx:_,fy:S,fr:A,cx:k,cy:j,r:R}=i;let L=new DOMPoint(_,S),W=new DOMPoint(k,j),q=A,J=R;if(f){L=y.transformPoint(L),W=y.transformPoint(W);const oe=(y.a+y.d)/2;q=A*oe,J=i.r*oe}const Q=l.createRadialGradient(L.x,L.y,q,W.x,W.y,J);for(const oe of i.stops)Q.addColorStop(oe.offset,ey(oe.rgb_color,oe.opacity*a,d));return Q}function AB(l,i,a,d){const f=d.transform?ty(d.transform).preMultiplySelf(i):i,y=dx(l.canvas.width,l.canvas.height),_=y.getContext("2d");for(const A of d.children)if(A.group)AB(_,f,a,A.group);else if(A.path){const k=A.path,j=new Path2D;j.addPath(IB(k),f),_.fill(j,wB(k))}const S=d.clip_path_idx!=null?a.clip_paths[d.clip_path_idx]:null;S&&kB(_,f,a,S),l.globalCompositeOperation="source-over",l.drawImage(y,0,0)}function kB(l,i,a,d){const f=dx(l.canvas.width,l.canvas.height);AB(f.getContext("2d"),i,a,d),l.globalCompositeOperation="destination-in",l.drawImage(f,0,0)}function PB(l,i,a,d,f){if(d.children.length===0)return;const y=d.mask_idx!=null?a.masks[d.mask_idx]:null;y&&PB(l,i,a,y,f);const _=l.canvas.width,S=l.canvas.height,A=dx(_,S),k=A.getContext("2d"),j=d.width,R=d.height,L=d.left,W=d.top,q=new Path2D,J=new Path2D;J.rect(L,W,j,R),q.addPath(J,i),k.clip(q);for(const de of d.children)xB(k,i,a,de,f);const Q=k.getImageData(0,0,_,S),oe=Q.data;if(d.mask_type===yB.MASK_TYPE_LUMINANCE)for(let de=0;de<oe.length;de+=4)oe[de+3]=oe[de+3]/255*(.2126*oe[de]+.7152*oe[de+1]+.0722*oe[de+2]);k.putImageData(Q,0,0),l.globalCompositeOperation="destination-in",l.drawImage(A,0,0)}function ty(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function CB(l,i){const a=l.step;let d=l.diffs[0]*a,f=l.diffs[1]*a;i.moveTo(d,f);for(let y=0,_=2;y<l.commands.length;y++)switch(l.commands[y]){case hx.PATH_COMMAND_MOVE:d+=l.diffs[_++]*a,f+=l.diffs[_++]*a,i.moveTo(d,f);break;case hx.PATH_COMMAND_LINE:d+=l.diffs[_++]*a,f+=l.diffs[_++]*a,i.lineTo(d,f);break;case hx.PATH_COMMAND_QUAD:{const S=d+l.diffs[_++]*a,A=f+l.diffs[_++]*a;d=S+l.diffs[_++]*a,f=A+l.diffs[_++]*a,i.quadraticCurveTo(S,A,d,f);break}case hx.PATH_COMMAND_CUBIC:{const S=d+l.diffs[_++]*a,A=f+l.diffs[_++]*a,k=S+l.diffs[_++]*a,j=A+l.diffs[_++]*a;d=k+l.diffs[_++]*a,f=j+l.diffs[_++]*a,i.bezierCurveTo(S,A,k,j,d,f);break}case hx.PATH_COMMAND_CLOSE:i.closePath()}return i}function IB(l){return CB(l,new Path2D)}class cT{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const a=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,a),a}put(i,a){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,a)}delete(i){this.cache.delete(i)}}qt(cT,"LRUCache");class uI{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new Ds(i,i.data)}getFromCache(i,a,d){return this.cacheMap.has(d)||this.cacheMap.set(d,new cT(150)),this.cacheMap.get(d).get(fd(i.toString(),a))}setInCache(i,a,d,f){this.cacheDependenciesMap.has(f)||this.cacheDependenciesMap.set(f,new Map),this.cacheMap.has(f)||this.cacheMap.set(f,new cT(150));const y=this.cacheDependenciesMap.get(f),_=fd(i.id.toString(),d);y.get(_)||y.set(_,new Set);const S=this.cacheMap.get(f),A=i.toString();y.get(_).add(A),S.put(fd(i.toString(),d),a)}removeImagesFromCacheByIds(i,a,d=0){if(!this.cacheMap.has(d)||!this.cacheDependenciesMap.has(d))return;const f=this.cacheMap.get(d),y=this.cacheDependenciesMap.get(d);for(const _ of i){const S=fd(_.toString(),a);if(y.has(S)){for(const A of y.get(S))f.delete(A);y.delete(S)}}}rasterize(i,a,d,f,y=Cse){const _=this.getFromCache(i,d,f);if(_)return _.clone();const S=y(a.icon,i.options),A=uI._getImage(S);return this.setInCache(i,A,d,f),A.clone()}}class MB{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const d=this.toIdx(i,a);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function OB(l,i,a,d){let f=0,y=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(d[_])<1e-15){if(a[_]<l[_]||a[_]>i[_])return null}else{const S=1/d[_];let A=(l[_]-a[_])*S,k=(i[_]-a[_])*S;if(A>k){const j=A;A=k,k=j}if(A>f&&(f=A),k<y&&(y=k),f>y)return null}return f}function jB(l,i,a,d,f,y,_,S,A,k,j){const R=d-l,L=f-i,W=y-a,q=_-l,J=S-i,Q=A-a,oe=j[1]*Q-j[2]*J,de=j[2]*q-j[0]*Q,he=j[0]*J-j[1]*q,fe=R*oe+L*de+W*he;if(Math.abs(fe)<1e-15)return null;const Ie=1/fe,Ae=k[0]-l,ke=k[1]-i,Le=k[2]-a,Be=(Ae*oe+ke*de+Le*he)*Ie;if(Be<0||Be>1)return null;const at=ke*W-Le*L,Ge=Le*R-Ae*W,ft=Ae*L-ke*R,wt=(j[0]*at+j[1]*Ge+j[2]*ft)*Ie;return wt<0||Be+wt>1?null:(q*at+J*Ge+Q*ft)*Ie}function RB(l,i,a){return(l-i)/(a-i)}function DB(l,i,a,d,f,y,_,S,A){const k=1<<a,j=y-d,R=_-f,L=(l+1)/k*j+d,W=(i+0)/k*R+f,q=(i+1)/k*R+f;S[0]=(l+0)/k*j+d,S[1]=W,A[0]=L,A[1]=q}class LB{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(y){const _=Math.ceil(Math.log2(y.dim/8)),S=[];let A=Math.ceil(Math.pow(2,_));const k=1/A,j=(W,q,J,Q,oe)=>{const de=Q?1:0,he=(W+1)*J-de,fe=q*J,Ie=(q+1)*J-de;oe[0]=W*J,oe[1]=fe,oe[2]=he,oe[3]=Ie};let R=new MB(A);const L=[];for(let W=0;W<A*A;W++){j(W%A,Math.floor(W/A),k,!1,L);const q=jd(L[0],L[1],y),J=jd(L[2],L[1],y),Q=jd(L[2],L[3],y),oe=jd(L[0],L[3],y);R.minimums.push(Math.min(q,J,Q,oe)),R.maximums.push(Math.max(q,J,Q,oe)),R.leaves.push(1)}for(S.push(R),A/=2;A>=1;A/=2){const W=S[S.length-1];R=new MB(A);for(let q=0;q<A*A;q++){j(q%A,Math.floor(q/A),2,!0,L);const J=W.getElevation(L[0],L[1]),Q=W.getElevation(L[2],L[1]),oe=W.getElevation(L[2],L[3]),de=W.getElevation(L[0],L[3]),he=W.isLeaf(L[0],L[1]),fe=W.isLeaf(L[2],L[1]),Ie=W.isLeaf(L[2],L[3]),Ae=W.isLeaf(L[0],L[3]),ke=Math.min(J.min,Q.min,oe.min,de.min),Le=Math.max(J.max,Q.max,oe.max,de.max),Be=he&&fe&&Ie&&Ae;R.maximums.push(Le),R.minimums.push(ke),R.leaves.push(Le-ke<=5&&Be?1:0)}S.push(R)}return S}(this.dem),d=a.length-1,f=a[d];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(a,0,0,d,0)}raycastRoot(i,a,d,f,y,_,S=1){return OB([i,a,-100],[d,f,this.maximums[0]*S],y,_)}raycast(i,a,d,f,y,_,S=1){if(!this.nodeCount)return null;const A=this.raycastRoot(i,a,d,f,y,_,S);if(A==null)return null;const k=[],j=[],R=[],L=[],W=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;W.length>0;){const{idx:q,t:J,nodex:Q,nodey:oe,depth:de}=W.pop();if(this.leaves[q]){DB(Q,oe,de,i,a,d,f,R,L);const fe=1<<de,Ie=(Q+0)/fe,Ae=(Q+1)/fe,ke=(oe+0)/fe,Le=(oe+1)/fe,Be=jd(Ie,ke,this.dem)*S,at=jd(Ae,ke,this.dem)*S,Ge=jd(Ae,Le,this.dem)*S,ft=jd(Ie,Le,this.dem)*S,wt=jB(R[0],R[1],Be,L[0],R[1],at,L[0],L[1],Ge,y,_),xt=jB(L[0],L[1],Ge,R[0],L[1],ft,R[0],R[1],Be,y,_),At=Math.min(wt!==null?wt:Number.MAX_VALUE,xt!==null?xt:Number.MAX_VALUE);if(At!==Number.MAX_VALUE)return At;{const kt=ct([],y,_,J);if(zB(Be,at,ft,Ge,RB(kt[0],R[0],L[0]),RB(kt[1],R[1],L[1]))>=kt[2])return J}continue}let he=0;for(let fe=0;fe<this._siblingOffset.length;fe++){DB((Q<<1)+this._siblingOffset[fe][0],(oe<<1)+this._siblingOffset[fe][1],de+1,i,a,d,f,R,L),R[2]=-100,L[2]=this.maximums[this.childOffsets[q]+fe]*S;const Ie=OB(R,L,y,_);if(Ie!=null){const Ae=Ie;k[fe]=Ae;let ke=!1;for(let Le=0;Le<he&&!ke;Le++)Ae>=k[j[Le]]&&(j.splice(Le,0,fe),ke=!0);ke||(j[he]=fe),he++}}for(let fe=0;fe<he;fe++){const Ie=j[fe];W.push({idx:this.childOffsets[q]+Ie,t:k[Ie],nodex:(Q<<1)+this._siblingOffset[Ie][0],nodey:(oe<<1)+this._siblingOffset[Ie][1],depth:de+1})}}return null}_addNode(i,a,d){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,d,f,y){if(i[f].isLeaf(a,d)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const _=f-1,S=i[_];let A=0,k=0;for(let j=0;j<this._siblingOffset.length;j++){const R=2*a+this._siblingOffset[j][0],L=2*d+this._siblingOffset[j][1],W=S.getElevation(R,L),q=S.isLeaf(R,L),J=this._addNode(W.min,W.max,q);q&&(A|=1<<j),k||(k=J)}for(let j=0;j<this._siblingOffset.length;j++)A&1<<j||this._construct(i,2*a+this._siblingOffset[j][0],2*d+this._siblingOffset[j][1],_,k+j)}}function zB(l,i,a,d,f,y){return lr(lr(l,a,y),lr(i,d,y),f)}function jd(l,i,a){const d=a.dim,f=xe(l*d-.5,0,d-1),y=xe(i*d-.5,0,d-1),_=Math.floor(f),S=Math.floor(y),A=Math.min(_+1,d-1),k=Math.min(S+1,d-1);return zB(a.get(_,S),a.get(A,S),a.get(_,k),a.get(A,k),f-_,y-S)}const Ise={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Mse(l,i,a){return(256*l*256+256*i+a)/10-1e4}function Ose(l,i,a){return 256*l+i+a/256-32768}class uT{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,d,f=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void qr(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const y=this.dim=a.height-2,_=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let A=0;A<y;A++)_[this._idx(-1,A)]=_[this._idx(0,A)],_[this._idx(y,A)]=_[this._idx(y-1,A)],_[this._idx(A,-1)]=_[this._idx(A,0)],_[this._idx(A,y)]=_[this._idx(A,y-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(y,-1)]=_[this._idx(y-1,0)],_[this._idx(-1,y)]=_[this._idx(0,y-1)],_[this._idx(y,y)]=_[this._idx(y-1,y-1)]}const S=d==="terrarium"?Ose:Mse;for(let A=0;A<_.length;++A){const k=4*A;this.floatView[A]=S(this.pixels[k],this.pixels[k+1],this.pixels[k+2])}this._timestamp=Qa.now()}_buildQuadTree(){this._tree=new LB(this)}get(i,a,d=!1){d&&(i=xe(i,-1,this.dim),a=xe(a,-1,this.dim));const f=this._idx(i,a);return this.floatView[f]}set(i,a,d){const f=this._idx(i,a),y=this.floatView[f];return this.floatView[f]=d,d-y}static getUnpackVector(i){return Ise[i]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}static pack(i,a){const d=[0,0,0,0],f=uT.getUnpackVector(a);let y=Math.floor((i+f[3])/f[2]);return d[2]=y%256,y=Math.floor(y/256),d[1]=y%256,y=Math.floor(y/256),d[0]=y,d}getPixels(){return new ON({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let f=a*this.dim,y=a*this.dim+this.dim,_=d*this.dim,S=d*this.dim+this.dim;switch(a){case-1:f=y-1;break;case 1:y=f+1}switch(d){case-1:_=S-1;break;case 1:S=_+1}const A=-a*this.dim,k=-d*this.dim;for(let j=_;j<S;j++)for(let R=f;R<y;R++){const L=4*this._idx(R,j),W=4*this._idx(R+A,j+k);this.pixels[L+0]=i.pixels[W+0],this.pixels[L+1]=i.pixels[W+1],this.pixels[L+2]=i.pixels[W+2],this.pixels[L+3]=i.pixels[W+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function jse(l,i,a){l===1?i.headerLength=a.readFixed32():l===2?i.x=a.readVarint():l===3?i.y=a.readVarint():l===4?i.z=a.readVarint():l===5&&i.layers.push(function(d,f){return d.readFields(Nse,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(a,a.readVarint()+a.pos))}function Rse(l,i,a){l===1?(i.delta_filter=function(d,f){return d.readFields(Dse,{blockSize:0},f)}(a,a.readVarint()+a.pos),i.filter="delta_filter"):l===2?(a.readVarint(),i.filter="zigzag_filter"):l===3?(a.readVarint(),i.filter="bitshuffle_filter"):l===4&&(a.readVarint(),i.filter="byteshuffle_filter")}function Dse(l,i,a){l===1&&(i.blockSize=a.readVarint())}function Lse(l,i,a){l===1?(a.readVarint(),i.codec="gzip_data"):l===2?(a.readVarint(),i.codec="jpeg_image"):l===3?(a.readVarint(),i.codec="webp_image"):l===4&&(a.readVarint(),i.codec="png_image")}function zse(l,i,a){let d=0,f=0;l===1?i.firstByte=a.readFixed64():l===2?i.lastByte=a.readFixed64():l===3?i.filters.push(function(y,_){return y.readFields(Rse,{},_)}(a,a.readVarint()+a.pos)):l===4?i.codec=function(y,_){return y.readFields(Lse,{},_)}(a,a.readVarint()+a.pos):l===5?f=a.readFloat():l===6?d=a.readFloat():l===7?i.bands.push(a.readString()):l===8?i.offset=a.readDouble():l===9&&(i.scale=a.readDouble()),i.offset===0&&(i.offset=f),i.scale===0&&(i.scale=d)}function Nse(l,i,a){l===1?i.version=a.readVarint():l===2?i.name=a.readString():l===3?i.units=a.readString():l===4?i.tileSize=a.readVarint():l===5?i.buffer=a.readVarint():l===6?i.pixelFormat=a.readVarint():l===7&&i.dataIndex.push(function(d,f){return d.readFields(zse,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(a,a.readVarint()+a.pos))}function Fse(l,i,a){if(l===2)(function(d,f,y){d.readFields(Bse,y,f)})(a,a.readVarint()+a.pos,i);else if(l===3)throw new Error("Not implemented")}function Bse(l,i,a){if(l===1){let d=0;const f=a.readVarint()+a.pos;for(;a.pos<f;)i[d++]=a.readVarint()}}function Vse(l,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let a=i[3];for(let d=2;d>=1;d--){const f=d===1?1:0,y=d===2?1:0;for(let _=0;_<i[0];_++){const S=i[1]*_;for(let A=f;A<i[1];A++){const k=i[2]*(A+S);for(let j=y;j<i[2];j++){const R=i[3]*(j+k);for(let L=0;L<i[3];L++){const W=R+L;l[W]+=l[W-a]}}}}a*=i[d]}return l}function Use(l){for(let i=0,a=l.length;i<a;i++)l[i]=l[i]>>>1^-(1&l[i]);return l}function $se(l,i){switch(i){case"uint32":return l;case"uint16":for(let a=0;a<l.length;a+=2){const d=l[a],f=l[a+1];l[a]=(240&d)>>4|(61440&d)>>8|(240&f)<<4|61440&f,l[a+1]=15&d|(3840&d)>>4|(15&f)<<8|(3840&f)<<4}return l;case"uint8":for(let a=0;a<l.length;a+=4){const d=l[a],f=l[a+1],y=l[a+2],_=l[a+3];l[a+0]=(192&d)>>6|(192&f)>>4|(192&y)>>2|192&_,l[a+1]=(48&d)>>4|(48&f)>>2|48&y|(48&_)<<2,l[a+2]=(12&d)>>2|12&f|(12&y)<<2|(12&_)<<4,l[a+3]=3&d|(3&f)<<2|(3&y)<<4|(3&_)<<6}return l;default:throw new Error(`Invalid pixel format, "${i}"`)}}qt(uT,"DEMData"),qt(LB,"DemMinMaxQuadTree",{omit:["dem"]});var nl=Uint8Array,fx=Uint16Array,Gse=Int32Array,NB=new nl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),FB=new nl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Hse=new nl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),BB=function(l,i){for(var a=new fx(31),d=0;d<31;++d)a[d]=i+=1<<l[d-1];var f=new Gse(a[30]);for(d=1;d<30;++d)for(var y=a[d];y<a[d+1];++y)f[y]=y-a[d]<<5|d;return{b:a,r:f}},VB=BB(NB,2),UB=VB.b,Wse=VB.r;UB[28]=258,Wse[258]=28;for(var qse=BB(FB,0).b,$B=new fx(32768),rs=0;rs<32768;++rs){var ry=(43690&rs)>>1|(21845&rs)<<1;$B[rs]=((65280&(ry=(61680&(ry=(52428&ry)>>2|(13107&ry)<<2))>>4|(3855&ry)<<4))>>8|(255&ry)<<8)>>1}var px=function(l,i,a){for(var d=l.length,f=0,y=new fx(i);f<d;++f)l[f]&&++y[l[f]-1];var _,S=new fx(i);for(f=1;f<i;++f)S[f]=S[f-1]+y[f-1]<<1;_=new fx(1<<i);var A=15-i;for(f=0;f<d;++f)if(l[f])for(var k=f<<4|l[f],j=i-l[f],R=S[l[f]-1]++<<j,L=R|(1<<j)-1;R<=L;++R)_[$B[R]>>A]=k;return _},mx=new nl(288);for(rs=0;rs<144;++rs)mx[rs]=8;for(rs=144;rs<256;++rs)mx[rs]=9;for(rs=256;rs<280;++rs)mx[rs]=7;for(rs=280;rs<288;++rs)mx[rs]=8;var GB=new nl(32);for(rs=0;rs<32;++rs)GB[rs]=5;var Zse=px(mx,9),Kse=px(GB,5),hI=function(l){for(var i=l[0],a=1;a<l.length;++a)l[a]>i&&(i=l[a]);return i},ec=function(l,i,a){var d=i/8|0;return(l[d]|l[d+1]<<8)>>(7&i)&a},dI=function(l,i){var a=i/8|0;return(l[a]|l[a+1]<<8|l[a+2]<<16)>>(7&i)},Xse=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],tc=function(l,i,a){var d=new Error(i||Xse[l]);if(d.code=l,Error.captureStackTrace&&Error.captureStackTrace(d,tc),!a)throw d;return d},Yse=new nl(0),Jse=typeof TextDecoder<"u"&&new TextDecoder;try{Jse.decode(Yse,{stream:!0})}catch{}const Qse={gzip_data:"gzip"};class wl extends Error{constructor(i){super(i),this.name="MRTError"}}const eoe={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},HB={uint32:1,uint16:2,uint8:4},toe={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let fI;class hT{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const a=this.layers[i];if(!a)throw new wl(`Layer '${i}' not found`);return a}getHeaderLength(i){const a=new Uint8Array(i),d=new DataView(i);if(a[0]!==13)throw new wl("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(i){const a=new Uint8Array(i),d=this.getHeaderLength(i);if(a.length<d)throw new wl(`Expected header with length >= ${d} but got buffer of length ${a.length}`);const f=new fI(a.subarray(0,d)).readFields(jse,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new wl(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const y of f.layers)this.layers[y.name]=new WB(y,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const a=[],d=this.getLayer(i.layerName);for(let f of i.blockIndices){const y=d.dataIndex[f],_=y.firstByte-i.firstByte,S=y.lastByte-i.firstByte;if(d._blocksInProgress.has(f))continue;const A={layerName:d.name,firstByte:_,lastByte:S,pixelFormat:d.pixelFormat,blockIndex:f,blockShape:[y.bands.length].concat(d.bandShape),buffer:d.buffer,codec:y.codec.codec,filters:y.filters.map(k=>k.filter)};d._blocksInProgress.add(f),a.push(A)}return new qB(a,()=>{a.forEach(f=>d._blocksInProgress.delete(f.blockIndex))},(f,y)=>{if(a.forEach(_=>d._blocksInProgress.delete(_.blockIndex)),f)throw f;y.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class WB{constructor({version:i,name:a,units:d,tileSize:f,pixelFormat:y,buffer:_,dataIndex:S},A){if(this.version=i,this.version!==1)throw new wl(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=a,this.units=d,this.tileSize=f,this.buffer=_,this.pixelFormat=eoe[y],this.dataIndex=S,this.bandShape=[f+2*_,f+2*_,HB[this.pixelFormat]],this._decodedBlocks=new cT(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return HB[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const a=i.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,i.data)}getBlockForBand(i){let a=0;switch(typeof i){case"string":for(const[d,f]of this.dataIndex.entries()){for(const[y,_]of f.bands.entries())if(_===i)return{bandIndex:a+y,blockIndex:d,blockBandIndex:y};a+=f.bands.length}break;case"number":for(const[d,f]of this.dataIndex.entries()){if(i>=a&&i<a+f.bands.length)return{bandIndex:i,blockIndex:d,blockBandIndex:i-a};a+=f.bands.length}break;default:throw new wl(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let a=1/0,d=-1/0;const f=[],y=new Set;for(const _ of i){const{blockIndex:S}=this.getBlockForBand(_);if(S<0)throw new wl(`Invalid band: ${JSON.stringify(_)}`);const A=this.dataIndex[S];f.includes(S)||f.push(S),y.add(S),a=Math.min(a,A.firstByte),d=Math.max(d,A.lastByte)}if(y.size>this.cacheSize)throw new wl(`Number of blocks to decode (${y.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:d,blockIndices:f}}hasBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0}hasDataForBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(i){const{blockIndex:a,blockBandIndex:d}=this.getBlockForBand(i);if(a<0)throw new wl(`Band not found: ${JSON.stringify(i)}`);const f=this._decodedBlocks.get(a.toString());if(!f)throw new wl(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const y=this.dataIndex[a],_=this.bandShape.reduce((k,j)=>k*j,1),S=d*_,A=f.subarray(S,S+_);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:y.offset,scale:y.scale}}}hT.setPbf=function(l){fI=l};class qB{constructor(i,a,d){this.tasks=i,this._onCancel=a,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,a){this._finalized||(this._onComplete(i,a),this._finalized=!0)}}hT.performDecoding=function(l,i){const a=new Uint8Array(l);return Promise.all(i.tasks.map(d=>{const{layerName:f,firstByte:y,lastByte:_,pixelFormat:S,blockShape:A,blockIndex:k,filters:j,codec:R}=d,L=a.subarray(y,_+1),W=new Uint32Array(A[0]*A[1]*A[2]);let q;if(R!=="gzip_data")throw new wl(`Unhandled codec: ${R}`);return q=function(J,Q){if(!globalThis.DecompressionStream&&Q==="gzip_data")return Promise.resolve(((fe=function(ke){ke[0]==31&&ke[1]==139&&ke[2]==8||tc(6,"invalid gzip data");var Le=ke[3],Be=10;4&Le&&(Be+=2+(ke[10]|ke[11]<<8));for(var at=(Le>>3&1)+(Le>>4&1);at>0;at-=!ke[Be++]);return Be+(2&Le)}(he=J))+8>he.length&&tc(6,"invalid gzip data"),function(ke,Le,Be,at){var Ge=ke.length;if(!Ge||Le.f&&!Le.l)return Be||new nl(0);var ft=!Be,wt=ft||Le.i!=2,xt=Le.i;ft&&(Be=new nl(3*Ge));var At,kt,it=function(di){var Jn=Be.length;if(di>Jn){var Gn=new nl(Math.max(2*Jn,di));Gn.set(Be),Be=Gn}},Tt=Le.f||0,Xe=Le.p||0,ot=Le.b||0,It=Le.l,St=Le.d,or=Le.m,Kt=Le.n,_t=8*Ge;do{if(!It){Tt=ec(ke,Xe,1);var Ct=ec(ke,Xe+1,3);if(Xe+=3,!Ct){var rr=ke[(_e=4+((Xe+7)/8|0))-4]|ke[_e-3]<<8,Bt=_e+rr;if(Bt>Ge){xt&&tc(0);break}wt&&it(ot+rr),Be.set(ke.subarray(_e,Bt),ot),Le.b=ot+=rr,Le.p=Xe=8*Bt,Le.f=Tt;continue}if(Ct==1)It=Zse,St=Kse,or=9,Kt=5;else if(Ct==2){var Nt=ec(ke,Xe,31)+257,Ht=ec(ke,Xe+10,15)+4,pr=Nt+ec(ke,Xe+5,31)+1;Xe+=14;for(var gr=new nl(pr),Cr=new nl(19),Ar=0;Ar<Ht;++Ar)Cr[Hse[Ar]]=ec(ke,Xe+3*Ar,7);Xe+=3*Ht;var Qr=hI(Cr),Vr=(1<<Qr)-1,Kn=px(Cr,Qr);for(Ar=0;Ar<pr;){var _e,ve=Kn[ec(ke,Xe,Vr)];if(Xe+=15&ve,(_e=ve>>4)<16)gr[Ar++]=_e;else{var st=0,Rt=0;for(_e==16?(Rt=3+ec(ke,Xe,3),Xe+=2,st=gr[Ar-1]):_e==17?(Rt=3+ec(ke,Xe,7),Xe+=3):_e==18&&(Rt=11+ec(ke,Xe,127),Xe+=7);Rt--;)gr[Ar++]=st}}var zt=gr.subarray(0,Nt),Lt=gr.subarray(Nt);or=hI(zt),Kt=hI(Lt),It=px(zt,or),St=px(Lt,Kt)}else tc(1);if(Xe>_t){xt&&tc(0);break}}wt&&it(ot+131072);for(var Jt=(1<<or)-1,yr=(1<<Kt)-1,Ur=Xe;;Ur=Xe){var $r=(st=It[dI(ke,Xe)&Jt])>>4;if((Xe+=15&st)>_t){xt&&tc(0);break}if(st||tc(2),$r<256)Be[ot++]=$r;else{if($r==256){Ur=Xe,It=null;break}var jr=$r-254;$r>264&&(jr=ec(ke,Xe,(1<<(Mr=NB[Ar=$r-257]))-1)+UB[Ar],Xe+=Mr);var jn=St[dI(ke,Xe)&yr],gi=jn>>4;if(jn||tc(3),Xe+=15&jn,Lt=qse[gi],gi>3){var Mr=FB[gi];Lt+=dI(ke,Xe)&(1<<Mr)-1,Xe+=Mr}if(Xe>_t){xt&&tc(0);break}wt&&it(ot+131072);var ti=ot+jr;if(ot<Lt){var $n=0-Lt,An=Math.min(Lt,ti);for($n+ot<0&&tc(3);ot<An;++ot)Be[ot]=(void 0)[$n+ot]}for(;ot<ti;++ot)Be[ot]=Be[ot-Lt]}}Le.l=It,Le.p=Ur,Le.b=ot,Le.f=Tt,It&&(Tt=1,Le.m=or,Le.d=St,Le.n=Kt)}while(!Tt);return ot!=Be.length&&ft?(At=Be,((kt=ot)==null||kt>At.length)&&(kt=At.length),new nl(At.subarray(0,kt))):Be.subarray(0,ot)}(he.subarray(fe,-8),{i:2},new nl(((oe=he)[(de=oe.length)-4]|oe[de-3]<<8|oe[de-2]<<16|oe[de-1]<<24)>>>0))));var oe,de,he,fe;const Ie=Qse[Q];if(!Ie)throw new Error(`Unhandled codec: ${Q}`);const Ae=new globalThis.DecompressionStream(Ie);return new Response(new Blob([J]).stream().pipeThrough(Ae)).arrayBuffer().then(ke=>new Uint8Array(ke))}(L,R).then(J=>(function(Q,oe){Q.readFields(Fse,oe)}(new fI(J),W),new toe[S](W.buffer))),q.then(J=>{for(let Q=j.length-1;Q>=0;Q--)switch(j[Q]){case"delta_filter":Vse(J,A);break;case"zigzag_filter":Use(J);break;case"bitshuffle_filter":$se(J,S);break;default:throw new wl(`Unhandled filter "${j[Q]}"`)}return{layerName:f,blockIndex:k,data:J}}).catch(J=>{throw J})}))},qt(qB,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),qt(hT,"MapboxRasterTile"),qt(WB,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class ZB{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const d=i[a];this._stringToNumber[d]=a,this._numberToString[a]=d}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const roe=["id","tile","layer","source","sourceLayer","state"];class ny{constructor(i,a,d,f,y){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=d,this._y=f,this.properties=i.properties,this.id=y}clone(){const i=new ny(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of roe)this[a]!==void 0&&(i[a]=this[a]);return i}}class KB{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new qc(Dt,16,0),this.featureIndexArray=new lS,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,a,d,f,y,_=0,S=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,f,y,_);const k=this.grid;for(let j=0;j<a.length;j++){const R=a[j],L=[1/0,1/0,-1/0,-1/0];for(let W=0;W<R.length;W++){const q=R[W];L[0]=Math.min(L[0],q.x),L[1]=Math.min(L[1],q.y),L[2]=Math.max(L[2],q.x),L[3]=Math.max(L[3],q.y)}S!==0&&(L[0]-=S,L[1]-=S,L[2]+=S,L[3]+=S),L[0]<Dt&&L[1]<Dt&&L[2]>=0&&L[3]>=0&&k.insert(A,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ir(new FS(this.rawTileData)).layers,this.sourceLayerCoder=new ZB(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a){const{tilespaceGeometry:d,transform:f,tileTransform:y,pixelPosMatrix:_,availableImages:S,worldview:A}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const k=d.bufferedTilespaceBounds,j=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,(q,J,Q,oe)=>Ri(d.bufferedTilespaceGeometry,q,J,Q,oe));j.sort(noe);let R=null;f.elevation&&j.length>0&&(R=Qg.create(f.elevation,this.tileID));const L={};let W;for(let q=0;q<j.length;q++){const J=j[q];if(J===W)continue;W=J;const Q=this.featureIndexArray.get(J);let oe=null;this.is3DTile?this.loadMatchingModelFeature(L,Q,i,d,f,A):this.loadMatchingFeature(L,Q,i,S,A,(de,he,fe,Ie=0)=>(oe||(oe=nt(de,this.tileID.canonical,y)),he.queryIntersectsFeature(d,de,fe,oe,this.z,f,_,R,Ie)))}return L}loadMatchingFeature(i,a,d,f,y,_){const{featureIndex:S,bucketIndex:A,sourceLayerIndex:k,layoutVertexArrayOffset:j}=a,R=this.bucketLayerIDs[A],L=d.layers,W=Object.keys(L);if(W.length&&!Wr(W,R))return;const q=d.sourceCache,J=this.sourceLayerCoder.decode(k),Q=this.vtLayers[J].feature(S),oe=this.getId(Q,J);for(let de=0;de<R.length;de++){const he=R[de];if(!L[he])continue;const{styleLayer:fe,targets:Ie}=L[he];let Ae={};oe!==void 0&&(Ae=q.getFeatureState(fe.sourceLayer,oe));const ke=!_||_(Q,fe,Ae,j);if(!ke)continue;const Le=new ny(Q,this.z,this.x,this.y,oe);Le.tile=this.tileID.canonical,Le.state=Ae;let Be=this.serializedLayersCache.get(he);Be||(Be=fe.serialize(),Be.id=he,this.serializedLayersCache.set(he,Be)),Le.source=Be.source,Le.sourceLayer=Be["source-layer"],Le.layer=Qe({},Be),Le.layer.paint=XB(Be.paint,fe.paint,Q,Ae,f),Le.layer.layout=XB(Be.layout,fe.layout,Q,Ae,f);let at=!1;for(const Ge of Ie){this.updateFeatureProperties(Le,Ge);const{filter:ft}=Ge;if(ft){if(Q.properties=Le.properties,ft.needGeometry){const wt=Ze(Q,!0);if(!ft.filter(new On(this.tileID.overscaledZ,{worldview:y}),wt,this.tileID.canonical))continue}else if(!ft.filter(new On(this.tileID.overscaledZ,{worldview:y}),Q))continue}at=!0,Ge.targetId&&this.addFeatureVariant(Le,Ge)}at&&this.appendToResult(i,he,S,Le,ke)}}loadMatchingModelFeature(i,a,d,f,y,_){const{featureIndex:S,bucketIndex:A}=a,k=this.bucketLayerIDs[A],j=d.layers,R=Object.keys(j);if(!R.length||Wr(R,k))for(let L=0;L<k.length;L++){const W=k[L],{styleLayer:q,targets:J}=j[W];if(q.type!=="model")continue;const Q=f.tile,oe=Q.getBucket(q);if(!(oe&&oe instanceof iT))continue;const de=lse(oe,S,f,y);if(!de)continue;const{z:he,x:fe,y:Ie}=Q.tileID.canonical,{feature:Ae,intersectionZ:ke,position:Le}=de;let Be={};Ae.id!==void 0&&(Be=d.sourceCache.getFeatureState(q.sourceLayer,Ae.id));const at=new ny({},he,fe,Ie,Ae.id);at.tile=this.tileID.canonical,at.state=Be,at.properties=Ae.properties,at.geometry={type:"Point",coordinates:[Le.lng,Le.lat]};let Ge=this.serializedLayersCache.get(W);Ge||(Ge=q.serialize(),Ge.id=W,this.serializedLayersCache.set(W,Ge)),at.source=Ge.source,at.sourceLayer=Ge["source-layer"],at.layer=Qe({},Ge);let ft=!1;for(const wt of J){this.updateFeatureProperties(at,wt);const{filter:xt}=wt;if(xt){if(Ae.properties=at.properties,xt.needGeometry){if(!xt.filter(new On(this.tileID.overscaledZ,{worldview:_}),Ae,this.tileID.canonical))continue}else if(!xt.filter(new On(this.tileID.overscaledZ,{worldview:_}),Ae))continue}ft=!0,wt.targetId&&this.addFeatureVariant(at,wt)}ft&&this.appendToResult(i,W,S,at,ke)}}updateFeatureProperties(i,a,d){if(a.properties){const f={};for(const y in a.properties){const _=a.properties[y].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,d);_!=null&&(f[y]=_)}i.properties=f}}addFeatureVariant(i,a,d){const f={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(f.properties=i.properties),i.variants=i.variants||{},i.variants[a.targetId]=i.variants[a.targetId]||[],i.variants[a.targetId].push(f)}appendToResult(i,a,d,f,y){let _=i[a];_===void 0&&(_=i[a]=[]),_.push({featureIndex:d,feature:f,intersectionZ:y})}lookupSymbolFeatures(i,a,d,f,y,_){const S={};this.loadVTLayers();for(const A of i)this.loadMatchingFeature(S,{bucketIndex:a,sourceLayerIndex:d,featureIndex:A,layoutVertexArrayOffset:0},f,y,_);return S}loadFeature(i){const{featureIndex:a,sourceLayerIndex:d}=i;this.loadVTLayers();const f=this.sourceLayerCoder.decode(d),y=this.vtFeatures[f];if(y[a])return y[a];const _=this.vtLayers[f].feature(a);return y[a]=_,_}hasLayer(i){for(const a of this.bucketLayerIDs)for(const d of a)if(i===d)return!0;return!1}getId(i,a){let d=i.id;if(this.promoteId){const f=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(f!=null)if(Array.isArray(f)){if(!this.promoteIdExpression){const y=Zu(f);if(y.result!=="success"){const _=y.value.map(S=>`${S.key}: ${S.message}`).join(", ");return void qr(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=y.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Xf),d=this.promoteIdExpression.evaluate({zoom:0},i)}else d=i.properties[f];typeof d=="boolean"&&(d=Number(d))}return d}}function XB(l,i,a,d,f){return Tr(l,(y,_)=>{const S=i instanceof rl?i.get(_):null;return S&&S.evaluate?S.evaluate(a,d,void 0,f):S})}function noe(l,i){return i-l}qt(KB,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const YB=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pI{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,d]=new Uint8Array(i,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=d>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const y=YB[15&d];if(!y)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(i,2,1),[S]=new Uint32Array(i,4,1);return new pI(S,_,y,i)}constructor(i,a=64,d=Float64Array,f){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=d,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const y=YB.indexOf(this.ArrayType),_=2*i*this.ArrayType.BYTES_PER_ELEMENT,S=i*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-S%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${d}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+A,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+_+S+A),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+A,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=i)}add(i,a){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=i,this.coords[this._pos++]=a,d}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return mI(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,a,d,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:_,nodeSize:S}=this,A=[0,y.length-1,0],k=[];for(;A.length;){const j=A.pop()||0,R=A.pop()||0,L=A.pop()||0;if(R-L<=S){for(let Q=L;Q<=R;Q++){const oe=_[2*Q],de=_[2*Q+1];oe>=i&&oe<=d&&de>=a&&de<=f&&k.push(y[Q])}continue}const W=L+R>>1,q=_[2*W],J=_[2*W+1];q>=i&&q<=d&&J>=a&&J<=f&&k.push(y[W]),(j===0?i<=q:a<=J)&&(A.push(L),A.push(W-1),A.push(1-j)),(j===0?d>=q:f>=J)&&(A.push(W+1),A.push(R),A.push(1-j))}return k}within(i,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:_}=this,S=[0,f.length-1,0],A=[],k=d*d;for(;S.length;){const j=S.pop()||0,R=S.pop()||0,L=S.pop()||0;if(R-L<=_){for(let Q=L;Q<=R;Q++)QB(y[2*Q],y[2*Q+1],i,a)<=k&&A.push(f[Q]);continue}const W=L+R>>1,q=y[2*W],J=y[2*W+1];QB(q,J,i,a)<=k&&A.push(f[W]),(j===0?i-d<=q:a-d<=J)&&(S.push(L),S.push(W-1),S.push(1-j)),(j===0?i+d>=q:a+d>=J)&&(S.push(W+1),S.push(R),S.push(1-j))}return A}}function mI(l,i,a,d,f,y){if(f-d<=a)return;const _=d+f>>1;JB(l,i,_,d,f,y),mI(l,i,a,d,_-1,1-y),mI(l,i,a,_+1,f,1-y)}function JB(l,i,a,d,f,y){for(;f>d;){if(f-d>600){const k=f-d+1,j=a-d+1,R=Math.log(k),L=.5*Math.exp(2*R/3),W=.5*Math.sqrt(R*L*(k-L)/k)*(j-k/2<0?-1:1);JB(l,i,a,Math.max(d,Math.floor(a-j*L/k+W)),Math.min(f,Math.floor(a+(k-j)*L/k+W)),y)}const _=i[2*a+y];let S=d,A=f;for(gx(l,i,d,a),i[2*f+y]>_&&gx(l,i,d,f);S<A;){for(gx(l,i,S,A),S++,A--;i[2*S+y]<_;)S++;for(;i[2*A+y]>_;)A--}i[2*d+y]===_?gx(l,i,d,A):(A++,gx(l,i,A,f)),A<=a&&(d=A+1),a<=A&&(f=A-1)}}function gx(l,i,a,d){gI(l,a,d),gI(i,2*a,2*d),gI(i,2*a+1,2*d+1)}function gI(l,i,a){const d=l[i];l[i]=l[a],l[a]=d}function QB(l,i,a,d){const f=l-a,y=i-d;return f*f+y*y}s.$=ws,s.A=ql,s.B=Kl,s.C=fd,s.D=Gg,s.E=Fu,s.F=2,s.G=rx,s.H=E5,s.I=Bo,s.J=Lc,s.K=class extends nT{},s.L=Bu,s.M=tS,s.N=xg,s.O=vg,s.P=ut,s.Q=H1,s.R=Nf,s.S=n0,s.T=IC,s.U=cp,s.V=nT,s.W=i0,s.X=Zu,s.Y=sg,s.Z=id,s._=nd,s.a=function(l){return Cs.API_CDN_URL_REGEX.test(l)},s.a$=gt,s.a0=Av,s.a1=up,s.a2=bg,s.a3=G1,s.a4=function(l){const i=l.value;let a=[];if(!i)return a;const d=Lc(i);return d!=="string"?(a=a.concat([new nT(l.key,i,`string expected, "${d}" found`)]),a):(nI(i,!0)||(a=a.concat([new nT(l.key,i,`invalid url "${i}"`)])),a)},s.a5=$e,s.a6=lp,s.a7=wi,s.a8=Mt,s.a9=class{constructor(l){this.specification=l}possiblyEvaluate(l,i){return qi(l.expression.evaluate(i))}interpolate(l,i,a){return{x:lr(l.x,i.x,a),y:lr(l.y,i.y,a),z:lr(l.z,i.z,a),azimuthal:lr(l.azimuthal,i.azimuthal,a),polar:lr(l.polar,i.polar,a)}}},s.aA=Bi,s.aB=Zs,s.aC=si,s.aD=re,s.aE=dt,s.aF=function(l,i){const a={};for(let d=0;d<i.length;d++){const f=i[d];f in l&&(a[f]=l[f])}return a},s.aG=$,s.aH=ie,s.aI=class{constructor(l){this.entries={},this.scheduler=l}request(l,i,a,d){const f=this.entries[l]=this.entries[l]||{callbacks:[]};if(f.result){const[y,_]=f.result;return this.scheduler?this.scheduler.add(()=>{d(y,_)},i):d(y,_),()=>{}}return f.callbacks.push(d),f.cancel||(f.cancel=a((y,_)=>{f.result=[y,_];for(const S of f.callbacks)this.scheduler?this.scheduler.add(()=>{S(y,_)},i):S(y,_);setTimeout(()=>delete this.entries[l],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(y=>y!==d),f.callbacks.length||(f.cancel(),delete this.entries[l]))}}},s.aJ=function(l,i,a){const d=JSON.stringify(l.request);return l.data&&(this.deduped.entries[d]={result:[null,l.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},f=>{const y=Ff(l.request,(_,S,A,k)=>{_?f(_):S&&f(null,{vectorTile:a?void 0:new ir(new FS(S)),rawData:S,cacheControl:A,expires:k})});return()=>{y.cancel(),f()}},i)},s.aK=function(l){bv++,bv>Wl&&(l.getActor().send("enforceCacheSizeLimit",el),bv=0)},s.aL=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},s.aM=$i,s.aN=eB,s.aO=oB,s.aP=Q5,s.aQ=function(l,i){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let d=0;d<l.length;d++){const f=document.createElement("source");SP(l[d])||(a.crossOrigin="Anonymous"),f.src=l[d],a.appendChild(f)}return{cancel:()=>{}}},s.aR=X0,s.aS=function(l){return fetch(l).then(i=>i.arrayBuffer()).then(i=>MF(i,0,l))},s.aT=FF,s.aU=class{constructor(l,i,a,d){this.id=l,this.position=i!=null?new H(i[0],i[1]):new H(0,0),this.orientation=a??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,i){if(U(l.matrix,i,l.matrix),l.meshes)for(const a of l.meshes){const d=kr.applyTransformFast(a.aabb,l.matrix);this.aabb.encapsulate(d)}if(l.children)for(const a of l.children)this._applyTransformations(a,l.matrix)}computeBoundsAndApplyParent(){const l=N([]);for(const i of this.nodes)this._applyTransformations(i,l)}computeModelMatrix(l,i,a,d,f,y,_=!1){zF(this.matrix,this,l.transform,this.position,i,a,d,f,y,_)}upload(l){if(!this.uploaded){for(const i of this.nodes)jC(i,l);for(const i of this.nodes)NS(i);this.uploaded=!0}}destroy(){for(const l of this.nodes)RC(l)}},s.aV=_r,s.aW=sx,s.aX=pe,s.aY=me,s.aZ=md,s.a_=ii,s.aa=On,s.ab=Wc,s.ac=Ue,s.ad=Qt,s.ae=Ye,s.af=Fe,s.ag=rl,s.ah=Ad,s.ai=lr,s.aj=Dt,s.ak=v1,s.al=Br,s.am=Tn,s.an=class{constructor(l){this.specification=l}possiblyEvaluate(l,i){return function([a,d]){const f=qi([1,a,d]);return{x:f.x,y:f.y,z:f.z}}(l.expression.evaluate(i))}interpolate(l,i,a){return{x:lr(l.x,i.x,a),y:lr(l.y,i.y,a),z:lr(l.z,i.z,a)}}},s.ao=function(l,i,a=0,d=!0){const f=new ut(a,a),y=l.sub(f),_=i.add(f),S=[y,new ut(_.x,y.y),_,new ut(y.x,_.y)];return d&&S.push(y.clone()),S},s.ap=function(l,i){const a=[];for(let d=0;d<l.length;d++){const f=et(d-1,-1,l.length-1),y=et(d+1,-1,l.length-1),_=l[d],S=l[y],A=l[f].sub(_).unit(),k=S.sub(_).unit(),j=k.angleWithSep(A.x,A.y),R=A.add(k).unit().mult(-1*i/Math.sin(j/2));a.push(_.add(R))}return a},s.aq=F5,s.ar=Ri,s.as=function(l,i,a=0){return Oe(((i.x-a)*l.scale-l.x)*Dt,(i.y*l.scale-l.y)*Dt,Te(i.z,i.y))},s.at=Kr,s.au=Er,s.av=hn,s.aw=XF,s.ax=function(l){let i=1/0,a=1/0,d=-1/0,f=-1/0;for(const y of l)i=Math.min(i,y.x),a=Math.min(a,y.y),d=Math.max(d,y.x),f=Math.max(f,y.y);return{min:new ut(i,a),max:new ut(d,f)}},s.ay=xe,s.az=U,s.b=function(l){return Cs.API_FONTS_REGEX.test(l)},s.b$=ZC,s.b0=sS,s.b1=QS,s.b2=function(){_l.isLoading()||_l.isLoaded()||h0()!=="deferred"||J1()},s.b3=hd,s.b4=Ze,s.b5=ny,s.b6=pn,s.b7=zC,s.b8=mC,s.b9=nt,s.bA=function(l,i){const{x:a,y:d}=l.point,f=vN(a,d,l.worldSize/l._pixelsPerMercatorPixel,0,0);return U(f,f,sC(ru(i)))},s.bB=T,s.bC=Nn,s.bD=function(l,i){return Math.hypot(i[0]-l[0],i[1]-l[1],i[2]-l[2])},s.bE=ct,s.bF=br,s.bG=Ft,s.bH=tx,s.bI=ha,s.bJ=GC,s.bK=function(l,i,a,d,f){const y=5*i+2;l.float32[y+0]=a,l.float32[y+1]=d,l.float32[y+2]=f},s.bL=JS,s.bM=oo,s.bN=Ja,s.bO=Ta,s.bP=To,s.bQ=et,s.bR=function(l,i,a,d){var f=new w(4);return f[0]=l,f[1]=i,f[2]=a,f[3]=d,f},s.bS=IS,s.bT=Ei,s.bU=Ss,s.bV=XN,s.bW=aB,s.bX=eF,s.bY=_C,s.bZ=$C,s.b_=O5,s.ba=Io,s.bb=E0,s.bc=fN,s.bd=ui,s.be=Ug,s.bf=tI,s.bg=function(l,i){const a=Ad(i.zoom);if(a===0)return ru(l);const d=vS(l),f=iC(d),y=re(d.getWest())*i.worldSize,_=re(d.getEast())*i.worldSize,S=ie(d.getNorth())*i.worldSize,A=ie(d.getSouth())*i.worldSize,k=[y,S,0],j=[_,S,0],R=[y,A,0],L=[_,A,0],W=G([],i.globeMatrix);return Qt(k,k,W),Qt(j,j,W),Qt(R,R,W),Qt(L,L,W),f[0]=eh(f[0],R,a),f[1]=eh(f[1],L,a),f[2]=eh(f[2],j,a),f[3]=eh(f[3],k,a),kr.fromPoints(f)},s.bh=bS,s.bi=G,s.bj=D0,s.bk=eh,s.bl=pd,s.bm=Rre,s.bn=le,s.bo=V,s.bp=hT,s.bq=FS,s.br=Ff,s.bs=function(l,i){const a=[];for(const d in l)d in i||a.push(d);return a},s.bt=Ve,s.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bv=qn,s.bw=function(l){var i=new w(16);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],i},s.bx=N,s.by=ae,s.bz=B,s.c=Bm,s.c$=45,s.c0=pI,s.c1=mt,s.c2=Fi,s.c3=vs,s.c4=function(l,i,a){a*=.5;var d=i[0],f=i[1],y=i[2],_=i[3],S=Math.sin(a),A=Math.cos(a);return l[0]=d*A+f*S,l[1]=f*A-d*S,l[2]=y*A+_*S,l[3]=_*A-y*S,l},s.c5=$l,s.c6=pi,s.c7=function(l,i){return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l[3]=i[3],l},s.c8=je,s.c9=function(l,i,a,d,f){var y,_=1/Math.tan(i/2);return l[0]=_/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=_,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,f!=null&&f!==1/0?(l[10]=(f+d)*(y=1/(d-f)),l[14]=2*f*d*y):(l[10]=-1,l[14]=-2*d),l},s.cA=Oo,s.cB=gN,s.cC=function(l,i,a,d,f,y,_,S,A){if(A.name==="globe")return gN(l,i,new Oo(a,d,f),!1);const k=sx({z:a,x:d,y:f},A);return new kr([(y+k.x/k.scale)*i,i*(k.y/k.scale),_],[(y+k.x2/k.scale)*i,i*(k.y2/k.scale),S])},s.cD=function(l,i,a){return l[0]=Math.min(i[0],a[0]),l[1]=Math.min(i[1],a[1]),l[2]=Math.min(i[2],a[2]),l[3]=Math.min(i[3],a[3]),l},s.cE=function(l,i,a){return l[0]=Math.max(i[0],a[0]),l[1]=Math.max(i[1],a[1]),l[2]=Math.max(i[2],a[2]),l[3]=Math.max(i[3],a[3]),l},s.cF=function(l){const i=Math.round((l+45+360)%360/90)%4;return se[i]},s.cG=we,s.cH=ks,s.cI=o,s.cJ=function(l){const i=N(new Float64Array(16));U(i,l.pixelMatrix,l.globeMatrix);const a=[0,b,0],d=[0,E,0];return Qt(a,a,i),Qt(d,d,i),[a[0]>0&&a[0]<=l.width&&a[1]>0&&a[1]<=l.height&&!aC(l,new H(l.center.lat,90)),d[0]>0&&d[0]<=l.width&&d[1]>0&&d[1]<=l.height&&!aC(l,new H(l.center.lat,-90))]},s.cK=function(l,i){const{scale:a}=l.tileTransform,d=a*Dt/(l.tileSize*Math.pow(2,i.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return function(f,y,_){var S=y[1],A=y[2],k=y[3],j=_[0],R=_[1];return f[0]=y[0]*j,f[1]=S*j,f[2]=A*R,f[3]=k*R,f}(new Float32Array(4),i.inverseAdjustmentMatrix,[d,d])},s.cL=LS,s.cM=ze,s.cN=OF,s.cO=function(l){const i=OF(l,!0);return T([],[i[0],i[1],i[4],i[5]])},s.cP=X,s.cQ=Zn,s.cR=Y,s.cS=function(l){const{x:i,y:a}=l.point,{lng:d,lat:f}=l._center;return vN(i,a,l.worldSize,d,f)},s.cT=rt,s.cU=He,s.cV=Da,s.cW=Un,s.cX=m,s.cY=function(l,i,a){let d=0;for(let f=0;f<2;++f)l[f]>0&&(d+=(l[f]-0)*(l[f]-0)),i[f]<0&&(d+=(0-i[f])*(0-i[f]));return d},s.cZ=function(l){return l*l*l*l*l},s.c_=ee,s.ca=function(l,i,a,d,f,y,_){var S=1/(i-a),A=1/(d-f),k=1/(y-_);return l[0]=-2*S,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*A,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*k,l[11]=0,l[12]=(i+a)*S,l[13]=(f+d)*A,l[14]=(_+y)*k,l[15]=1,l},s.cb=ue,s.cc=function(l,i,a){l[4*i+0]=a[0],l[4*i+1]=a[1],l[4*i+2]=a[2],l[4*i+3]=a[3]},s.cd=Vg,s.ce=wd,s.cf=Mi,s.cg=bl,s.ch=_p,s.ci=H,s.cj=G5,s.ck=function(){var l=new w(4);return w!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},s.cl=function(l,i,a){var d=i[0],f=i[1],y=i[2],_=i[3],S=Math.sin(a),A=Math.cos(a);return l[0]=d*A+y*S,l[1]=f*A+_*S,l[2]=d*-S+y*A,l[3]=f*-S+_*A,l},s.cm=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]&&l[3]===i[3]},s.cn=Jr,s.co=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},s.cp=Xa,s.cq=Vt,s.cr=tu,s.cs=3,s.ct=2,s.cu=7,s.cv=6,s.cw=Yt,s.cx=Pe,s.cy=hi,s.cz=jF,s.d=function(l){return Cs.API_TILEJSON_REGEX.test(l)},s.d$=(l,i,a,d,f,y,_,S,A,k)=>{const j=l.transform,R=j.calculatePixelsToTileUnitsMatrix(i),L=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",W=j.pitch<15?YF(.07,.7,xe((14-j.zoom)/5,0,1)):.07;return{u_matrix:QF(l,i,a,d),u_pixels_to_tile_units:R,u_device_pixel_ratio:y,u_width_scale:_,u_floor_width_scale:S,u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:t5(a)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:JF(i,l.transform),u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:W,u_tile_to_meter:Ee(i.tileID.canonical,0),u_ground_shadow_factor:k}},s.d0=yp,s.d1=function(l,i,a){const d=Math.sqrt(l*l+i*i+a*a),f=d>0?Math.acos(a/d)*$s:0;let y=l!==0||i!==0?Math.atan2(-i,-l)*$s+90:0;return y<0&&(y+=360),[d,y,f]},s.d2=Oe,s.d3=qi,s.d4=Ee,s.d5=We,s.d6=kr,s.d7=lt,s.d8=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},s.d9=nI,s.dA=vS,s.dB=function(l){const i=we-5;l=xe(l,-i,i)/i*90;const a=Math.pow(Math.abs(Math.sin(Br(l))),3);return Math.round(a*(x.length-1))},s.dC=function(l,i,a,d){const f=i.getNorth(),y=i.getSouth(),_=i.getWest(),S=i.getEast(),A=1<<l.z,k=S-_,j=f-y,R=k/g,L=-j/x[a],W=[0,R,0,L,0,0,f,_,0];if(l.z>0){const q=180/d;D(W,W,[q/k+1,0,0,0,q/j+1,0,-.5*q/R,.5*q/L,1])}return W[2]=A,W[5]=l.x,W[8]=l.y,W},s.dD=ru,s.dE=function(l,i,a){const d=N(new Float64Array(16)),f=(i/(1<<l)-.5)*Math.PI*2;return ne(d,a.globeMatrix,f),Float32Array.from(d)},s.dF=class{isDataAvailableAtPoint(l){const i=this._source();if(this.isUsingMockSource()||!i||l.y<0||l.y>1)return!1;const a=i.getSource().maxzoom,d=1<<a,f=Math.floor(l.x),y=Math.floor((l.x-f)*d),_=Math.floor(l.y*d),S=this.findDEMTileFor(new $i(a,f,a,y,_));return!(!S||!S.dem)}getAtPointOrZero(l,i=0){return this.getAtPoint(l,i)||0}getAtPoint(l,i,a=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const d=this._source();if(!d||l.y<0||l.y>1)return i;const f=d.getSource().maxzoom,y=1<<f,_=Math.floor(l.x),S=l.x-_,A=new $i(f,_,f,Math.floor(S*y),Math.floor(l.y*y)),k=this.findDEMTileFor(A);if(!k||!k.dem)return i;const j=k.dem,R=1<<k.tileID.canonical.z,L=(S*R-k.tileID.canonical.x)*j.dim,W=(l.y*R-k.tileID.canonical.y)*j.dim,q=Math.floor(L),J=Math.floor(W);return(a?this.exaggeration():1)*lr(lr(j.get(q,J),j.get(q,J+1),W-J),lr(j.get(q+1,J),j.get(q+1,J+1),W-J),L-q)}getAtTileOffset(l,i,a){const d=1<<l.canonical.z;return this.getAtPointOrZero(new Ue(l.wrap+(l.canonical.x+i/Dt)/d,(l.canonical.y+a/Dt)/d))}getAtTileOffsetFunc(l,i,a,d){return f=>{const y=this.getAtTileOffset(l,f.x,f.y),_=d.upVector(l.canonical,f.x,f.y);return mt(_,_,y*d.upVectorScale(l.canonical,i,a).metersToTile),_}}getForTilePoints(l,i,a,d){if(this.isUsingMockSource())return!1;const f=Qg.create(this,l,d);return!!f&&(i.forEach(y=>{y[2]=this.exaggeration()*f.getElevationAt(y[0],y[1],a)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(l);if(!i||!i.dem)return null;const a=i.dem.tree,d=i.tileID,f=1<<l.canonical.z-d.canonical.z;let y=l.canonical.x/f-d.canonical.x,_=l.canonical.y/f-d.canonical.y,S=0;for(let A=0;A<l.canonical.z-d.canonical.z&&!a.leaves[S];A++){y*=2,_*=2;const k=2*Math.floor(_)+Math.floor(y);S=a.childOffsets[S]+k,y%=1,_%=1}return{min:this.exaggeration()*a.minimums[S],max:this.exaggeration()*a.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let i=!1,a=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const f of l){const y=this.getMinMaxForTile(f.tileID);y&&(a=Math.min(a,y.min),d=Math.max(d,y.max),i=!0)}return i?{min:a,max:d}:null}},s.dG=ON,s.dH=_S,s.dI=function(l,i){return[Math.pow(l[0],2.2)*i,Math.pow(l[1],2.2)*i,Math.pow(l[2],2.2)*i]},s.dJ=I,s.dK=function(l,i){var a=Math.sin(i),d=Math.cos(i);return l[0]=d,l[1]=a,l[2]=0,l[3]=-a,l[4]=d,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},s.dL=Sr,s.dM=_N,s.dN=Eo,s.dO=Gs,s.dP=256,s.dQ=function(l,i){const a=[0,0,0];return Qt(a,a,bS(ru(i.canonical))),Qt(a,a,l),a},s.dR=l=>({u_matrix:new _p(l),u_texsize:new bl(l),u_pixels_to_tile_units:new j0(l),u_device_pixel_ratio:new Mi(l),u_width_scale:new Mi(l),u_floor_width_scale:new Mi(l),u_image:new Vg(l),u_units_to_pixels:new bl(l),u_tile_units_to_pixels:new Mi(l),u_alpha_discard_threshold:new Mi(l),u_trim_offset:new bl(l),u_trim_fade_range:new bl(l),u_trim_color:new yp(l),u_emissive_strength:new Mi(l),u_zbias_factor:new Mi(l),u_tile_to_meter:new Mi(l),u_ground_shadow_factor:new wd(l),u_pattern_transition:new Mi(l)}),s.dS=l=>({u_matrix:new _p(l),u_pixels_to_tile_units:new j0(l),u_device_pixel_ratio:new Mi(l),u_width_scale:new Mi(l),u_floor_width_scale:new Mi(l),u_units_to_pixels:new bl(l),u_dash_image:new Vg(l),u_gradient_image:new Vg(l),u_image_height:new Mi(l),u_texsize:new bl(l),u_tile_units_to_pixels:new Mi(l),u_alpha_discard_threshold:new Mi(l),u_trim_offset:new bl(l),u_trim_fade_range:new bl(l),u_trim_color:new yp(l),u_emissive_strength:new Mi(l),u_zbias_factor:new Mi(l),u_tile_to_meter:new Mi(l),u_ground_shadow_factor:new wd(l)}),s.dT=l=>({u_camera_to_center_distance:new Mi(l),u_extrude_scale:new j0(l),u_device_pixel_ratio:new Mi(l),u_matrix:new _p(l),u_inv_rot_matrix:new _p(l),u_merc_center:new bl(l),u_tile_id:new wd(l),u_zoom_transition:new Mi(l),u_up_dir:new wd(l),u_emissive_strength:new Mi(l)}),s.dU=_d,s.dV=mie,s.dW=wN,s.dX=(l,i,a,d,f,y)=>{const _=l.transform,S=_.projection.name==="globe";let A;if(y.paint.get("circle-pitch-alignment")==="map")if(S){const j=_N(_.zoom,i.canonical)*_._pixelsPerMercatorPixel;A=Float32Array.from([j,0,0,j])}else A=_.calculatePixelsToTileUnitsMatrix(a);else A=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(_.projection),u_matrix:l.translatePosMatrix(i.projMatrix,a,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Qa.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:Fre,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:y.paint.get("circle-emissive-strength")};if(S){k.u_inv_rot_matrix=d,k.u_merc_center=f,k.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],k.u_zoom_transition=Ad(_.zoom);const j=f[0]*Dt,R=f[1]*Dt;k.u_up_dir=_.projection.upVector(new Oo(0,0,0),j,R)}return k},s.dY=e5,s.dZ=ko,s.d_=(l,i,a,d,f,y,_,S,A,k)=>{const j=l.transform,R=j.pitch<15?YF(.07,.7,xe((14-j.zoom)/5,0,1)):.07,L=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:QF(l,i,a,d),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:j.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:f,u_width_scale:y,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:JF(i,j),u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:Ee(i.tileID.canonical,0),u_ground_shadow_factor:A,u_pattern_transition:k}},s.da=function(l,i){return l.readFields(hse,{icons:[]},i)},s.db=MS,s.dc=Xg,s.dd=WC,s.de=Gm,s.df=Y1,s.dg=Aa,s.dh=qh,s.di=zr,s.dj=function(l){const i=l.indexOf(hp);return i>=0?l.slice(0,i):l},s.dk=function(l){return l.indexOf(hp)>=0},s.dl=function(l){const i=l.lastIndexOf(hp);return i>=0?l.slice(i+1):""},s.dm=function(l){const i=[],a=l.id;return a===void 0&&i.push({message:`layers.${a}: missing required property "id"`}),l.render===void 0&&i.push({message:`layers.${a}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},s.dn=function(l,i,a,d){return l.type==="custom"?new sse(l,i):new cse[l.type](l,i,a,d)},s.dp=Gr,s.dq=function(l){const i=l.indexOf(hp);return i>=0?l.slice(i+1):""},s.dr=class extends ny{constructor(l,i){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},s.ds=u0,s.dt=Hh,s.du=function(l){return l({pluginStatus:uo,pluginURL:Zc}),u0.on("pluginStateChange",l),l},s.dv=O0,s.dw=class extends Ma{constructor(l){super(l),this.current=JP}set(l,i,a){if(this.fetchUniformLocation(l,i)){for(let d=0;d<9;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},s.dx=ce,s.dy=function(l,i,a){const d=Ad(a.zoom),f=l.style.map._antialias,y=l.terrain&&l.terrain.exaggeration()>0;return d===0&&!f&&!y},s.dz=function(l){const i=l.pixelsPerMeter,a=i/ue(1,l.center.lat),d=N(new Float64Array(16));return V(d,d,[l.point.x,l.point.y,0]),X(d,d,[a,a,i]),Float32Array.from(d)},s.e=Cs,s.e$=h0,s.e0=ar,s.e1=L0,s.e2=Te,s.e3=Ore,s.e4=CS,s.e5=dF,s.e6=Pd,s.e7=450,s.e8=7,s.e9=be,s.eA=function(l,i,a,d,f,y,_,S,A,k,j,R,L,W,q,J){var Q=new w(16);return Q[0]=l,Q[1]=i,Q[2]=a,Q[3]=d,Q[4]=f,Q[5]=y,Q[6]=_,Q[7]=S,Q[8]=A,Q[9]=k,Q[10]=j,Q[11]=R,Q[12]=L,Q[13]=W,Q[14]=q,Q[15]=J,Q},s.eB=z,s.eC=S0,s.eD=fp,s.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ut(1/0,1/0),max:new ut(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,i=!1){const a=JN(new ut(0,0),new ut(Dt,Dt),l),d=[];if(i&&!gC(a,this._globalClipBounds))return d;for(const f of this._activeRegions){if(f.hiddenByOverlap||!gC(a,f))continue;const y=fne(f.min,f.max,l);d.push({min:y.min,max:y.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return d}setSources(l){this._setSources(l.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const a=[];for(const d of i.cache.getVisibleCoordinates()){const f=i.cache.getTile(d).buckets[i.layer];f&&f.updateFootprints(d.toUnwrapped(),a)}return a},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(l){const i=l.getFootprints();if(i.length===0)return;const a=l.getOrder(),d=l.getClipMask(),f=l.getClipScope();for(const y of i){if(!y.footprint)continue;const _=JN(y.footprint.min,y.footprint.max,y.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:y.id,footprint:y.footprint,order:a,clipMask:d,clipScope:f})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,a)=>i.priority-a.priority||AS(i.min,a.min)||AS(i.max,a.max)||i.order-a.order||i.clipMask-a.clipMask||function(d,f){const y=(_,S)=>_+S;return d.length-f.length||d.reduce(y,"").localeCompare(f.reduce(y,""))}(i.clipScope,a.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let i=0;for(;!l&&i!==this._activeRegions.length;){const a=this._activeRegions[i],d=this._prevRegions[i];l=a.priority!==d.priority||!YN(a,d)||a.order!==d.order||a.clipMask!==d.clipMask||!qn(a.clipScope,d.clipScope),++i}}if(l){++this._updateTime;for(const a of this._activeRegions)a.order!==U0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const i=a=>{const d=this._activeRegions;if(a>=d.length)return a;const f=d[a].priority;for(;a<d.length&&d[a].priority===f;)++a;return a};if(this._sourceIds.length>1){let a=0,d=i(a);for(;a!==d;){let f=a;const y=a;for(;f!==d;){const _=this._activeRegions[f];_.hiddenByOverlap=!1;for(let S=0;S<y;S++){const A=this._activeRegions[S];if(!A.hiddenByOverlap&&_.order===U0&&gC(_,A)&&(_.hiddenByOverlap=QN(_.footprint,_.tileId,A.footprint,A.tileId),_.hiddenByOverlap))break}++f}a=d,d=i(a)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=l.length-1;i>=0;i--)this._addSource(l[i]);this._computeReplacement()}},s.eF=U0,s.eG=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,i){const a=new Io,d=new ii,f=[],y=l+1+2,_=i[0]+1,S=i[0]+1+(1+i.length),A=(k,j,R)=>{let L=k===y-1?k-2:k===0?k:k-1;return L+=R?24575:0,[L,j]};for(let k=0;k<y;++k)a.emplaceBack(...A(k,0,!0));for(let k=0;k<_;++k)for(let j=0;j<y;++j)a.emplaceBack(...A(j,k,(j===0||j===y-1)&&!0));for(let k=0;k<i.length;++k){const j=i[k];for(let R=0;R<y;++R)a.emplaceBack(...A(R,j,!0))}for(let k=0;k<i.length;++k){const j=d.length,R=i[k]+1+2,L=new ii;for(let J=0;J<R-1;J++){const Q=J===R-2,oe=Q?y*(S-i.length+k-J):y;for(let de=0;de<y-1;de++){const he=J*y+de;J===0||Q||de===0||de===y-2?(L.emplaceBack(he+1,he,he+oe),L.emplaceBack(he+oe,he+oe+1,he+1)):(d.emplaceBack(he+1,he,he+oe),d.emplaceBack(he+oe,he+oe+1,he+1))}}const W=ui.simpleSegment(0,j,a.length,d.length-j);for(let J=0;J<L.uint16.length;J+=3)d.emplaceBack(L.uint16[J],L.uint16[J+1],L.uint16[J+2]);const q=ui.simpleSegment(0,j,a.length,d.length-j);f.push({withoutSkirts:W,withSkirts:q})}return{vertices:a,indices:d,segments:f}}_createGrid(l){const i=this._fillGridMeshWithLods(g,x);this._gridSegments=i.segments,this._gridBuffer=l.createVertexBuffer(i.vertices,fN.members),this._gridIndexBuffer=l.createIndexBuffer(i.indices,!0)}_createPoles(l){const i=new ii;for(let _=0;_<=g;_++)i.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=l.createIndexBuffer(i,!0);const a=new Ju,d=new Ju,f=new Ju,y=new Ju;this._poleSegments=[];for(let _=0,S=0;_<m;_++){const A=360/(1<<_);a.emplaceBack(0,-Zs,0,.5,0),d.emplaceBack(0,-Zs,0,.5,1),f.emplaceBack(0,-Zs,0,.5,.5),y.emplaceBack(0,-Zs,0,.5,.5);for(let k=0;k<=g;k++){let j=k/g,R=0;const L=lr(0,A,j),[W,q,J]=C(zre,Nre,L,Zs);a.emplaceBack(W,q,J,j,R),d.emplaceBack(W,q,J,j,1-R);const Q=Br(L);j=.5+.5*Math.sin(Q),R=.5+.5*Math.cos(Q),f.emplaceBack(W,q,J,j,R),y.emplaceBack(W,q,J,j,1-R)}this._poleSegments.push(ui.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(a,yS,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(d,yS,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(f,yS,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(y,yS,!1)}getGridBuffers(l,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},s.eH=KN,s.eI=ye,s.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eK=Me,s.eL=Se,s.eM=function(l,i,a){return l[0]=i[0]/a[0],l[1]=i[1]/a[1],l[2]=i[2]/a[2],l},s.eN=Mn,s.eO=M,s.eP=xr,s.eQ=tt,s.eR=function([l,i,a]){const d=Math.hypot(l,i,a),f=Math.atan2(l,a),y=.5*Math.PI-Math.acos(-i/d);return new H(He(f),He(y))},s.eS=Wi,s.eT=MC,s.eU=function(l){const i=l.navigator?l.navigator.userAgent:null;return!!function(a){if(bi==null){const d=a.navigator?a.navigator.userAgent:null;bi=!!a.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return bi}(l)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eV=function(l,i){el=l,Wl=i},s.eW=aC,s.eX=xN,s.eY=function(l){const i=[0,0,0],a=N(new Float64Array(16));return U(a,l.pixelMatrix,l.globeMatrix),Qt(i,i,a),new ut(i[0],i[1])},s.eZ=function(){const l=Z0;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(SC),Z0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.e_=function(){MS().acquire(SC)},s.ea=function(l,i){if(l===i){var a=i[1],d=i[2],f=i[3],y=i[6],_=i[7],S=i[11];l[1]=i[4],l[2]=i[8],l[3]=i[12],l[4]=a,l[6]=i[9],l[7]=i[13],l[8]=d,l[9]=y,l[11]=i[14],l[12]=f,l[13]=_,l[14]=S}else l[0]=i[0],l[1]=i[4],l[2]=i[8],l[3]=i[12],l[4]=i[1],l[5]=i[5],l[6]=i[9],l[7]=i[13],l[8]=i[2],l[9]=i[6],l[10]=i[10],l[11]=i[14],l[12]=i[3],l[13]=i[7],l[14]=i[11],l[15]=i[15];return l},s.eb=ise,s.ec=Yr,s.ed=A0,s.ee=256,s.ef=sC,s.eg=oa,s.eh=ne,s.ei=function(l,i){return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[4],l[4]=i[5],l[5]=i[6],l[6]=i[8],l[7]=i[9],l[8]=i[10],l},s.ej=Ju,s.ek=w0,s.el=V1,s.em=function(l,i,a,d,f){return xe((l-i)/(a-i)*(f-d)+d,d,f)},s.en=kc,s.eo=function(l,i){var a=i[0],d=i[1],f=i[2],y=i[3],_=i[4],S=i[5],A=i[6],k=i[7],j=i[8],R=j*_-S*k,L=-j*y+S*A,W=k*y-_*A,q=a*R+d*L+f*W;return q?(l[0]=R*(q=1/q),l[1]=(-j*d+f*k)*q,l[2]=(S*d-f*_)*q,l[3]=L*q,l[4]=(j*a-f*A)*q,l[5]=(-S*a+f*y)*q,l[6]=W*q,l[7]=(-k*a+d*A)*q,l[8]=(_*a-d*y)*q,l):null},s.ep=2,s.eq=tn,s.er=OC,s.es=[1,1,1],s.et=class{constructor(l,i,a,d){this.context=l,this.format=d,this.size=a,this.texture=l.gl.createTexture();const[f,y,_]=this.size,{gl:S}=l;S.bindTexture(S.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),S.texImage3D(S.TEXTURE_3D,0,this.format,f,y,_,0,PC(this.format),CC(this.format),i.data)}bind(l,i){const{context:a}=this,{gl:d}=a;d.bindTexture(d.TEXTURE_3D,this.texture),l!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,l),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,l),this.minFilter=l),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},s.eu=Qg,s.ev=Us,s.ew=function(l,i,a,d){var f=i[0],y=i[1],_=i[2],S=i[3];return l[0]=f+d*(a[0]-f),l[1]=y+d*(a[1]-y),l[2]=_+d*(a[2]-_),l[3]=S+d*(a[3]-S),l},s.ex=Zg,s.ey=xl,s.ez=Jc,s.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(i,a)=>String.fromCharCode(+("0x"+a))))},s.f0=function(l,i,a=!1){if(uo===Uo.deferred||uo===Uo.loading||uo===Uo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Zc=Qa.resolveURL(l),uo=Uo.deferred,l0=i,c0(),a||J1()},s.f1=function(l){Hg=Qa.resolveURL(l),Wg||(Wg=new Gg(MS(),new Fu)),Wg.broadcast("setMeshoptUrl",Hg)},s.f2=EF,s.f3=function(l){EC=Qa.resolveURL(l),Wg||(Wg=new Gg(MS(),new Fu)),Wg.broadcast("setDracoUrl",EC)},s.f4=TF,s.f5=q0,s.f6=function(l){const i=Du();if(!i)return;const a=i.delete(Hl);l&&a.then(()=>l()).catch(l)},s.f7=Sp,s.f8=qt,s.f9=kd,s.fa=Ql,s.fb=ZB,s.fc=KB,s.fd=qF,s.fe=er,s.ff="hd_road_elevation",s.fg=rn,s.fh=Tr,s.fi=bp,s.fj=HC,s.fk=Ap,s.fl=function(l,i,a,d,f,y,_,S=1,A,k,j){l.createArrays(),l.tilePixelRatio=Dt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const R=l.layers[0].layout,L=l.layers[0]._unevaluatedLayout._values,W={};W.scaleFactor=S,W.textSizeScaleRange=R.get("text-size-scale-range"),W.iconSizeScaleRange=R.get("icon-size-scale-range");const[q,J]=W.textSizeScaleRange,[Q,oe]=W.iconSizeScaleRange;W.textScaleFactor=xe(W.scaleFactor,q,J),W.iconScaleFactor=xe(W.scaleFactor,Q,oe);const de=L["text-size"],he=L["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:Be,maxZoom:at}=l.textSizeData;W.compositeTextSizes=[de.possiblyEvaluate(new On(Be,{worldview:j}),y),de.possiblyEvaluate(new On(at,{worldview:j}),y)]}if(l.iconSizeData.kind==="composite"){const{minZoom:Be,maxZoom:at}=l.iconSizeData;W.compositeIconSizes=[he.possiblyEvaluate(new On(Be,{worldview:j}),y),he.possiblyEvaluate(new On(at,{worldview:j}),y)]}W.layoutTextSize=de.possiblyEvaluate(new On(_+1,{worldview:j}),y),W.layoutIconSize=he.possiblyEvaluate(new On(_+1,{worldview:j}),y),W.textMaxSize=de.possiblyEvaluate(new On(18,{worldview:j}),y);const fe=R.get("symbol-placement"),Ie=R.get("text-rotation-alignment")==="map"&&fe!=="point",Ae=R.get("text-size");let ke=!1;const Le=[];for(const Be of l.features){const at=R.get("text-font").evaluate(Be,{},y).join(","),Ge=Ae.evaluate(Be,{},y)*W.textScaleFactor,ft=W.layoutTextSize.evaluate(Be,{},y)*W.textScaleFactor,wt=W.layoutIconSize.evaluate(Be,{},y)*W.iconScaleFactor,xt={horizontal:{},vertical:void 0},At=Be.text;let kt,it=[0,0];if(At){const Ht=At.toString(),pr=R.get("text-letter-spacing").evaluate(Be,{},y)*Ss,gr=R.get("text-line-height").evaluate(Be,{},y)*Ss,Cr=VP(Ht)?pr:0,Ar=R.get("text-anchor").evaluate(Be,{},y),Qr=R.get("text-variable-anchor");if(!Qr){const st=R.get("text-radial-offset").evaluate(Be,{},y);if(st)it=O5(Ar,[st*Ss,qC]);else{const Rt=R.get("text-offset").evaluate(Be,{},y);it=[Rt[0]*Ss,Rt[1]*Ss]}}let Vr=Ie?"center":R.get("text-justify").evaluate(Be,{},y);const Kn=fe==="point",_e=Kn?R.get("text-max-width").evaluate(Be,{},y)*Ss:1/0,ve=st=>{l.allowVerticalPlacement&&a0(Ht)&&(xt.vertical=UC(At,i,a,f,at,_e,gr,Ar,st,Cr,it,ha.vertical,!0,ft,Ge,A))};if(!Ie&&Qr){const st=Vr==="auto"?Qr.map(zt=>ZC(zt)):[Vr];let Rt=!1;for(let zt=0;zt<st.length;zt++){const Lt=st[zt];if(!xt.horizontal[Lt])if(Rt)xt.horizontal[Lt]=xt.horizontal[0];else{const Jt=UC(At,i,a,f,at,_e,gr,"center",Lt,Cr,it,ha.horizontal,!1,ft,Ge,A);Jt&&(xt.horizontal[Lt]=Jt,Rt=Jt.positionedLines.length===1)}}ve("left")}else{if(Vr==="auto"&&(Vr=ZC(Ar)),Kn||R.get("text-writing-mode").indexOf("horizontal")>=0||!a0(Ht)){const st=UC(At,i,a,f,at,_e,gr,Ar,Vr,Cr,it,ha.horizontal,!1,ft,Ge,A);st&&(xt.horizontal[Vr]=st)}ve(Kn?"left":Vr)}}let Tt,Xe,ot,It,St,or,Kt=!1;const _t=R.get("icon-text-fit").evaluate(Be,{},y);if(Be.icon&&Be.icon.hasPrimary()){const Ht=R5(Be.icon,l.iconSizeData,L["icon-size"],y,l.zoom,Be,A,W.iconScaleFactor,j);Tt=Ht.iconPrimary,ot=Ht.iconSecondary;const pr=Tt.toString();if(Xe=d.get(pr),Xe&&(St=R.get("icon-offset").evaluate(Be,{},y),or=R.get("icon-anchor").evaluate(Be,{},y),kt=Rie(f.get(pr),ot?f.get(ot.toString()):void 0,St,or),Kt=Xe.sdf,l.sdfIcons===void 0?l.sdfIcons=Xe.sdf:l.sdfIcons!==Xe.sdf&&qr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xe.pixelRatio!==l.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),ot){const gr=ot.toString();It=d.get(gr)}}ke=ke||!(!Be.icon||!Be.icon.hasSecondary());const Ct=KC(xt.horizontal)||xt.vertical;l.iconsInText||(l.iconsInText=!!Ct&&Ct.iconsInText);const rr=ft*W.textScaleFactor/Ss,{defaultShapedIcon:Bt,verticallyShapedIcon:Nt}=Gie(l,kt,R,Be,y,xt,rr,St,_t);_t!=="none"&&kt&&(g5(kt)||y5(kt))&&(GS(0,Xe,Tt,kt,Bt,_t,k,d,f),GS(0,It,ot,kt,Bt,_t,k,d,f),Nt&&(GS(0,Xe,Tt,kt,Nt,_t,k,d,f),GS(0,It,ot,kt,Nt,_t,k,d,f))),kt=Bt,Le.push({feature:Be,shapedTextOrientations:xt,shapedText:Ct,shapedIcon:kt,iconPrimary:Tt,iconSecondary:ot,iconOffset:St,iconAnchor:or,verticallyShapedIcon:Nt,layoutTextSize:ft,layoutIconSize:wt,textOffset:it,isSDFIcon:Kt,iconTextFit:_t})}return{featureData:Le,sizes:W,hasAnySecondaryIcon:ke,textAlongLine:Ie,symbolPlacement:fe}},s.fm=A5,s.fn=function(l,i,a,d,f,y,_,S,A,k){const{featureData:j,hasAnySecondaryIcon:R,sizes:L,textAlongLine:W,symbolPlacement:q}=i;for(const J of j){const{shapedIcon:Q,verticallyShapedIcon:oe,feature:de,shapedTextOrientations:he,shapedText:fe,layoutTextSize:Ie,textOffset:Ae,isSDFIcon:ke,iconPrimary:Le,iconSecondary:Be,iconTextFit:at,iconOffset:Ge}=J;D5(Q,k.iconPositions,Le,Be),D5(oe,k.iconPositions,Le,Be),$ie(he,k.iconPositions),Uie(Le,Be,k.iconPositions),(fe||Q)&&Hie(l,de,he,Q,oe,A,L,Ie,0,Ae,ke,d,f,_,S,R,at,Ge,W,q)}a&&l.generateCollisionDebugBuffers(y,l.collisionBoxArray,L.textScaleFactor)},s.fo=ir,s.fp=uT,s.fq=yt,s.fr=function(l){let i=0;if(new Uint32Array(l,0,1)[0]!==kF){const a=new Uint32Array(l,0,7),[,,d,f,y,_]=a;i=a.byteLength+f+y+_+y,(d!==l.byteLength||i>=l.byteLength)&&qr("Invalid b3dm header information.")}return MF(l,i)},s.fs=function(l,i){const a=FF(l);for(const d of a){for(const f of d.meshes)Gne(f);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(Hne(d.lights,i)))}return a},s.ft=iT,s.fu=Dn,s.fv=wF,s.fw=_l,s.fx=Uo,s.fy=function(l){$h(),jc?.then(i=>{i.keys().then(a=>{for(let d=0;d<a.length-l;d++)i.delete(a[d]).catch(f=>qr(f.message))}).catch(a=>qr(a.message))}).catch(i=>qr(i.message))},s.g=function(l,i){return Hh(Qe(l,{method:"GET"}),i)},s.h=Qe,s.i=function(l){return Cs.API_STYLE_REGEX.test(l)&&!Bm(l)},s.j=function(l){return l.indexOf("mapbox:")===0},s.k=Oc,s.l=wv,s.m=function(l){return decodeURIComponent(atob(l).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.n=function(l,i){return Hh(Qe(l,{type:"json"}),i)},s.o=Vf,s.p=function(l,i){return Hh(Qe(l,{method:"POST"}),i)},s.q=Qa,s.r=Ds,s.s=function(l){try{const i=self[l];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=$m,s.u=function(){return function l(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},s.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},s.w=qr,s.x=function(){return TC||(TC=new Sp),TC},s.y=uI,s.z=na}),h(["./shared"],function(s){function v(He){const se=He?He.url.toString():void 0;return se?performance.getEntriesByName(se):[]}function w(He){if(typeof He=="number"||typeof He=="boolean"||typeof He=="string"||He==null)return JSON.stringify(He);if(Array.isArray(He)){let ce="[";for(const ye of He)ce+=`${w(ye)},`;return`${ce}]`}let se="{";for(const ce of Object.keys(He).sort())se+=`${ce}:${w(He[ce])},`;return`${se}}`}function T(He){let se="";for(const ce of s.bu)se+=`/${w(He[ce])}`;return se}class I{constructor(se){this.keyCache={},this._layers={},this._layerConfigs={},se&&this.replace(se)}replace(se,ce){this._layerConfigs={},this._layers={},this.update(se,[],ce)}update(se,ce,ye){this._options=ye;for(const xe of se)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=s.dn(xe,this.scope,null,this._options)).compileFilter(ye),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of ce)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const Me=function(xe,Fe){const et={};for(let Qe=0;Qe<xe.length;Qe++){const Ot=xe[Qe];let gt=Fe&&Fe[Ot.id];gt||(Ot.type==="symbol"?gt=Ot.id:(gt=T(Ot),Ot.type==="line"&&Ot.paint&&function _r(Tr){return typeof Tr=="string"&&Tr==="line-progress"||(Array.isArray(Tr)?Tr.some(_r):!(!Tr||typeof Tr!="object")&&Object.values(Tr).some(_r))}(Ot.paint["line-width"])&&(gt+=`/${w(Ot.paint["line-width"])}`))),Fe&&(Fe[Ot.id]=gt);let ar=et[gt];ar||(ar=et[gt]=[]),ar.push(Ot)}const Ve=[];for(const Qe in et)Ve.push(et[Qe]);return Ve}(Object.values(this._layerConfigs),this.keyCache);for(const xe of Me){const Fe=xe.map(ar=>this._layers[ar.id]),et=Fe[0];if(et.visibility==="none")continue;const Ve=et.source||"";let Qe=this.familiesBySource[Ve];Qe||(Qe=this.familiesBySource[Ve]={});const Ot=et.sourceLayer||"_geojsonTileLayer";let gt=Qe[Ot];gt||(gt=Qe[Ot]=[]),gt.push(Fe)}}}const O=1*s.fa;class D{constructor(se){const ce={},ye=[];for(const et in se){const Ve=se[et],Qe=ce[et]={};for(const Ot in Ve.glyphs){const gt=Ve.glyphs[+Ot];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const ar=gt.metrics.localGlyph?O:1,_r={x:0,y:0,w:gt.bitmap.width+2*ar,h:gt.bitmap.height+2*ar};ye.push(_r),Qe[Ot]=_r}}const{w:Me,h:xe}=s.H(ye),Fe=new s.f9({width:Me||1,height:xe||1});for(const et in se){const Ve=se[et];for(const Qe in Ve.glyphs){const Ot=Ve.glyphs[+Qe];if(!Ot||Ot.bitmap.width===0||Ot.bitmap.height===0)continue;const gt=ce[et][Qe],ar=Ot.metrics.localGlyph?O:1;s.f9.copy(Ot.bitmap,Fe,{x:0,y:0},{x:gt.x+ar,y:gt.y+ar},Ot.bitmap)}}this.image=Fe,this.positions=ce}}s.f8(D,"GlyphAtlas");class B{constructor(se){this.tileID=new s.aM(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.lut=se.lut,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.scope=se.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.request&&se.request.collectResourceTiming,this.promoteId=se.promoteId,this.isSymbolTile=se.isSymbolTile,this.tileTransform=s.aW(se.tileID.canonical,se.projection),this.projection=se.projection,this.worldview=se.worldview,this.localizableLayerIds=se.localizableLayerIds,this.brightness=se.brightness,this.extraShadowCaster=!!se.extraShadowCaster,this.tessellationStep=se.tessellationStep,this.scaleFactor=se.scaleFactor,this.worldview=se.worldview}parse(se,ce,ye,Me,xe,Fe){this.status="parsing",this.data=se,this.collisionBoxArray=new s.b0;const et=new s.fb(Object.keys(se.layers).sort()),Ve=new s.fc(this.tileID,this.promoteId);Ve.bucketLayerIDs=[];const Qe={},Ot=new s.fd(256,256),gt={featureIndex:Ve,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ot,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ar=[],_r=ce.familiesBySource[this.source];for(const Gr in _r){const zr=se.layers[Gr];if(!zr)continue;let Wr=!1,Vn=!1,qr=!1;for(const Dn of _r[Gr])Dn[0].type==="symbol"?Wr=!0:Vn=!0,Dn[0].is3D()&&Dn[0].type!=="model"&&(qr=!0);if(this.extraShadowCaster&&!qr||this.isSymbolTile===!0&&!Wr||this.isSymbolTile===!1&&!Vn)continue;zr.version===1&&s.w(`Vector tile source "${this.source}" layer "${Gr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ti=et.encode(Gr),ts=[];let qi=!1;for(let Dn=0,pn=0;Dn<zr.length;Dn++){const bi=zr.feature(Dn),pi=Ve.getId(bi,Gr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Gr)){const ci=bi.properties?bi.properties.worldview:null;if(this.worldview&&typeof ci=="string")if(ci==="all")bi.properties.$localized=!0;else{if(!ci.split(",").includes(this.worldview))continue;bi.properties.$localized=!0,bi.properties.worldview=this.worldview}}!qi&&bi.properties&&bi.properties.hasOwnProperty(s.fe)&&(qi=!0),ts.push({feature:bi,id:pi,index:pn,sourceLayerIndex:Ti}),pn++}qi&&!gt.elevationFeatures&&se.layers.hasOwnProperty(s.ff)&&(gt.elevationFeatures=s.fg.parseFrom(se.layers[s.ff],this.canonical));for(const Dn of _r[Gr]){const pn=Dn[0];if(this.extraShadowCaster&&(!pn.is3D()||pn.type==="model")||this.isSymbolTile!==void 0&&pn.type==="symbol"!==this.isSymbolTile||pn.minzoom&&this.zoom<Math.floor(pn.minzoom)||pn.maxzoom&&this.zoom>=pn.maxzoom||pn.visibility==="none")continue;N(Dn,this.zoom,gt.brightness,ye,this.worldview);const bi=Qe[pn.id]=pn.createBucket({index:Ve.bucketLayerIDs.length,layers:Dn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ti,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Me,worldview:this.worldview});Ve.bucketLayerIDs.push(Dn.map(ci=>s.C(ci.id,ci.scope)));let pi=bi.prepare?bi.prepare():null;pi!=null?(pi=pi.then(()=>bi.populate(ts,gt,this.tileID.canonical,this.tileTransform)),ar.push(pi)):bi.populate(ts,gt,this.tileID.canonical,this.tileTransform)}}const Tr=()=>{let Gr,zr,Wr,Vn,qr,Ti;Ot.trim();const ts={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},qi=()=>{if(Gr)return this.status="done",Fe(Gr);if(this.extraShadowCaster)this.status="done",Fe(null,{buckets:Object.values(Qe).filter(pn=>!pn.isEmpty()),featureIndex:Ve,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:gt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(zr&&Wr&&Vn){const pn=new D(zr),bi=new Map;for(const[bs,Eo]of Wr.entries()){const{imagePosition:Gs}=s.fj(bs,Eo,s.fk);bi.set(bs,Gs)}const pi={};for(const bs in Qe){const Eo=Qe[bs];Eo instanceof s.b1&&(N(Eo.layers,this.zoom,gt.brightness,ye,this.worldview),pi[bs]=s.fl(Eo,zr,pn.positions,Wr,bi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,qr,this.worldview))}const ci={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(xe,Wr,qr,()=>{ci.iconsPending=!1,Dn(pi,pn,ci)}),this.rasterizeIfNeeded(xe,Vn,Ti,()=>{ci.patternsPending=!1,Dn(pi,pn,ci)})}},Dn=(pn,bi,pi,ci)=>{if(pi.iconsPending||pi.patternsPending)return;const bs=new s.fm(Wr,Vn,this.lut);for(const Eo in Qe){const Gs=Qe[Eo];if(Eo in pn)s.fn(Gs,pn[Eo],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Wr,bs);else if(Gs.hasPattern&&(Gs instanceof s.b7||Gs instanceof s.b8||Gs instanceof s.e4)){N(Gs.layers,this.zoom,gt.brightness,ye,this.worldview);const Mf=Object.fromEntries(bs.patternPositions);Gs.addFeatures(gt,this.tileID.canonical,Mf,ye,this.tileTransform,this.brightness)}}this.status="done",Fe(null,{buckets:Object.values(Qe).filter(Eo=>!Eo.isEmpty()),featureIndex:Ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bi.image,lineAtlas:Ot,imageAtlas:bs,brightness:gt.brightness})};if(!this.extraShadowCaster){const pn=s.fh(gt.glyphDependencies,ci=>Object.keys(ci).map(Number));Object.keys(pn).length?xe.send("getGlyphs",{uid:this.uid,stacks:pn},(ci,bs)=>{Gr||(Gr=ci,zr=bs,qi())},void 0,!1,ts):zr={};const bi=Array.from(gt.iconDependencies.keys()).map(ci=>s.I.parse(ci));bi.length?xe.send("getImages",{images:bi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ci,bs)=>{Gr||(Gr=ci,Wr=new Map,qr=this.updateImageMapAndGetImageTaskQueue(Wr,bs,gt.iconDependencies),qi())},void 0,!1,ts):(Wr=new Map,qr=new Map);const pi=Array.from(gt.patternDependencies.keys()).map(ci=>s.I.parse(ci));pi.length?xe.send("getImages",{images:pi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ci,bs)=>{Gr||(Gr=ci,Vn=new Map,Ti=this.updateImageMapAndGetImageTaskQueue(Vn,bs,gt.patternDependencies),qi())},void 0,!1,ts):(Vn=new Map,Ti=new Map)}if(gt.elevationFeatures&&gt.elevationFeatures.length>0){const pn=[];for(const pi of Object.values(Qe))if(pi instanceof s.b8){const ci=pi.getUnevaluatedPortalGraph();ci&&pn.push(ci)}const bi=s.fi.evaluate(pn);for(const pi of Object.values(Qe))if(pi instanceof s.b8){const ci=se.layers[et.decode(pi.sourceLayerIndex)];pi.setEvaluatedPortalGraph(bi,ci,this.tileID.canonical,gt.availableImages,gt.brightness)}}qi()};ar.length>0?Promise.allSettled(ar).then(Tr).catch(Fe):Tr()}rasterizeIfNeeded(se,ce,ye,Me){Array.from(ce.values()).some(xe=>xe.usvg)?this.rasterize(se,ce,ye,Me):Me()}updateImageMapAndGetImageTaskQueue(se,ce,ye){const Me=new Map;for(const xe of ce.keys()){const Fe=ye.get(xe)||[];for(const et of Fe){const Ve=et.toString(),Qe=ce.get(et.id.toString());Qe.usvg?Me.has(Ve)||(Me.set(Ve,et),se.set(Ve,Object.assign({},Qe))):se.set(Ve,Qe)}}return Me}rasterize(se,ce,ye,Me){this.rasterizeTask=se.send("rasterizeImages",{scope:this.scope,tasks:ye},(xe,Fe)=>{if(!xe)for(const[et,Ve]of Fe.entries()){const Qe=Object.assign(ce.get(et),{data:Ve});ce.set(et,Qe)}Me()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function N(He,se,ce,ye,Me){const xe=new s.aa(se,{brightness:ce,worldview:Me});for(const Fe of He)Fe.recalculate(xe,ye)}class G extends s.E{constructor(se,ce,ye,Me,xe,Fe,et){super(),this.actor=se,this.layerIndex=ce,this.availableImages=ye,this.availableModels=Me,this.loadVectorData=Fe||s.aJ,this.loading={},this.loaded={},this.deduped=new s.aI(se.scheduler),this.isSpriteLoaded=xe,this.scheduler=se.scheduler,this.brightness=et}loadTile(se,ce){const ye=se.uid,Me=se&&se.request,xe=Me&&Me.collectResourceTiming,Fe=this.loading[ye]=new B(se);Fe.abort=this.loadVectorData(se,(et,Ve)=>{const Qe=!this.loading[ye];if(delete this.loading[ye],Fe.cancelRasterize(),Qe||et||!Ve)return Fe.status="done",Qe||(this.loaded[ye]=Fe),ce(et);const Ot=Ve.rawData,gt={};Ve.expires&&(gt.expires=Ve.expires),Ve.cacheControl&&(gt.cacheControl=Ve.cacheControl),Fe.vectorTile=Ve.vectorTile||new s.fo(new s.bq(Ot));const ar=()=>{Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(_r,Tr)=>{if(_r||!Tr)return ce(_r);const Gr={};if(xe){const zr=v(Me);zr.length>0&&(Gr.resourceTiming=JSON.parse(JSON.stringify(zr)))}ce(null,s.h({rawTileData:Ot.slice(0)},Tr,gt,Gr))})};this.isSpriteLoaded?ar():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ar,{type:"parseTile",isSymbolTile:se.isSymbolTile,zoom:se.tileZoom}):ar()}),this.loaded=this.loaded||{},this.loaded[ye]=Fe})}reloadTile(se,ce){const ye=this.loaded,Me=se.uid;if(ye&&ye[Me]){const xe=ye[Me];xe.scaleFactor=se.scaleFactor,xe.showCollisionBoxes=se.showCollisionBoxes,xe.projection=se.projection,xe.brightness=se.brightness,xe.tileTransform=s.aW(se.tileID.canonical,se.projection),xe.extraShadowCaster=se.extraShadowCaster,xe.lut=se.lut,xe.worldview=se.worldview;const Fe=(et,Ve)=>{const Qe=xe.reloadCallback;Qe&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Qe)),ce(et,Ve)};xe.status==="parsing"?xe.reloadCallback=Fe:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe):Fe())}else ce(null,void 0)}abortTile(se,ce){const ye=se.uid,Me=this.loading[ye];Me&&(Me.abort&&Me.abort(),delete this.loading[ye]),ce()}removeTile(se,ce){const ye=this.loaded,Me=se.uid;ye&&ye[Me]&&delete ye[Me],ce()}}class U{loadTile(se,ce){const{uid:ye,encoding:Me,rawImageData:xe,padding:Fe}=se,et=ImageBitmap&&xe instanceof ImageBitmap?this.getImageData(xe,Fe):xe;ce(null,new s.fp(ye,et,Me,Fe<1))}reloadTile(se,ce){ce(null,null)}abortTile(se,ce){ce()}removeTile(se,ce){ce()}getImageData(se,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const ye=this.offscreenCanvasContext.getImageData(-ce,-ce,se.width+2*ce,se.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}s.bp.setPbf(s.bq);class V{constructor(se){this._mrt=new s.bp(se.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=se.uid,this.tileID=se.tileID,this.source=se.source}parse(se,ce){const ye=this._mrt;this.status="parsing",this._entireBuffer=se;try{ye.parseHeader(se),this._isHeaderLoaded=!0;const Me=[];for(const xe in ye.layers){const Fe=ye.getLayer(xe),et=Fe.getDataRange(Fe.getBandList()),Ve=ye.createDecodingTask(et),Qe=se.slice(et.firstByte,et.lastByte+1),Ot=s.bp.performDecoding(Qe,Ve).then(gt=>Ve.complete(null,gt)).catch(gt=>Ve.complete(gt,null));Me.push(Ot)}Promise.allSettled(Me).then(()=>ce(null,ye)).catch(xe=>ce(xe))}catch(Me){ce(Me)}}}class X{constructor(se){this.actor=se,this.loading={},this.loaded={}}loadTile(se,ce){const ye=se.uid,Me=se.request,xe=this.loading[ye]=new V(se),{cancel:Fe}=s.br(Me,(et,Ve,Qe,Ot)=>{const gt=!this.loading[ye];if(delete this.loading[ye],gt||et||!Ve)return xe.status="done",gt||(this.loaded[ye]=xe),ce(et);xe.parse(Ve,(ar,_r)=>{if(ar||!_r)return ce(ar);ce(null,_r,Qe,Ot)}),this.loaded[ye]=xe});xe.abort=Fe}reloadTile(se,ce){ce(null,void 0)}abortTile(se,ce){const ye=se.uid,Me=this.loading[ye];Me&&(Me.abort&&Me.abort(),delete this.loading[ye]),ce()}removeTile(se,ce){const ye=se.uid;this.loaded[ye]&&delete this.loaded[ye],ce()}decodeRasterArray(se,ce){s.bp.performDecoding(se.buffer,se.task).then(ye=>ce(null,ye)).catch(ye=>ce(ye))}}const Y=s.fq.prototype.toGeoJSON;class ne{constructor(se){this._feature=se,this.extent=s.aj,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const ce of this._feature.geometry)se.push([new s.P(ce[0],ce[1])]);return se}{const se=[];for(const ce of this._feature.geometry){const ye=[];for(const Me of ce)ye.push(new s.P(Me[0],Me[1]));se.push(ye)}return se}}toGeoJSON(se,ce,ye){return Y.call(this,se,ce,ye)}}class ae{constructor(se,ce){this.name=se,this.extent=s.aj,this.length=ce.length,this._jsonFeatures=ce}feature(se){return new ne(this._jsonFeatures[se])}}class le{constructor(se){this.layers={},this.extent=s.aj;for(const ce of Object.keys(se))this.layers[ce]=new ae(ce,se[ce])}}const ge=64/4096,je=128;class ze{constructor(){this.features=new Map}clear(){this.features.clear()}load(se=[],ce){for(const ye of se){const Me=ye.id;if(Me==null)continue;let xe=this.features.get(Me);xe&&this.updateCache(xe,ce),ye.geometry?(xe=Ke(ye),this.updateCache(xe,ce),this.features.set(Me,xe)):this.features.delete(Me),this.updateCache(xe,ce)}}updateCache(se,ce){for(const{canonical:ye,uid:Me}of Object.values(ce)){const{z:xe,x:Fe,y:et}=ye;Pe(se,Math.pow(2,xe),Fe,et)&&delete ce[Me]}}getTile(se,ce,ye){const Me=Math.pow(2,se),xe=[];for(const Fe of this.features.values())Pe(Fe,Me,ce,ye)&&xe.push(We(Fe,Me,ce,ye));return{features:xe}}getFeatures(){return[...this.features.values()]}}function Pe({minX:He,minY:se,maxX:ce,maxY:ye},Me,xe,Fe){return He<(xe+1+ge)/Me&&se<(Fe+1+ge)/Me&&ce>(xe-ge)/Me&&ye>(Fe-ge)/Me}function Ke(He){const{id:se,geometry:ce,properties:ye}=He;if(!ce)return;if(ce.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Me,coordinates:xe}=ce,Fe={id:se,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},et=Fe.geometry;if(Me==="Point")Ye(xe,et,Fe);else if(Me==="MultiPoint")for(const Ve of xe)Ye(Ve,et,Fe);else if(Me==="LineString")Fe.type=2,Oe(xe,et,Fe);else if(Me==="MultiLineString")Fe.type=2,tt(xe,et,Fe);else if(Me==="Polygon")Fe.type=3,tt(xe,et,Fe,!0);else{if(Me!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Fe.type=3;for(const Ve of xe)tt(Ve,et,Fe,!0)}return Fe}function Ye([He,se],ce,ye){const Me=s.aD(He);let xe=s.aH(se);xe=xe<0?0:xe>1?1:xe,ce.push(Me,xe),ye.minX=Math.min(ye.minX,Me),ye.minY=Math.min(ye.minY,xe),ye.maxX=Math.max(ye.maxX,Me),ye.maxY=Math.max(ye.maxY,xe)}function Oe(He,se,ce,ye=!1,Me=!1){const xe=[];for(const Fe of He)Ye(Fe,xe,ce);se.push(xe),ye&&function(Fe,et){let Ve=0;for(let Qe=0,Ot=Fe.length,gt=Ot-2;Qe<Ot;gt=Qe,Qe+=2)Ve+=(Fe[Qe]-Fe[gt])*(Fe[Qe+1]+Fe[gt+1]);if(Ve>0===et)for(let Qe=0,Ot=Fe.length;Qe<Ot/2;Qe+=2){const gt=Fe[Qe],ar=Fe[Qe+1];Fe[Qe]=Fe[Ot-2-Qe],Fe[Qe+1]=Fe[Ot-1-Qe],Fe[Ot-2-Qe]=gt,Fe[Ot-1-Qe]=ar}}(xe,Me)}function tt(He,se,ce,ye=!1){for(let Me=0;Me<He.length;Me++)Oe(He[Me],se,ce,ye,Me===0)}function We(He,se,ce,ye){const{id:Me,type:xe,geometry:Fe,tags:et}=He,Ve=[];if(xe===1)(function(Qe,Ot,gt,ar,_r){for(let Tr=0;Tr<Qe.length;Tr+=2){const Gr=Math.round(s.aj*(Qe[Tr+0]*Ot-gt)),zr=Math.round(s.aj*(Qe[Tr+1]*Ot-ar));_r.push([Gr,zr])}})(Fe,se,ce,ye,Ve);else for(const Qe of Fe)lt(Qe,se,ce,ye,Ve);return{id:Me,type:xe,geometry:Ve,tags:et}}function lt(He,se,ce,ye,Me){const xe=-je,Fe=s.aj+je;let et;for(let Ve=0;Ve<He.length-2;Ve+=2){let Qe=Math.round(s.aj*(He[Ve+0]*se-ce)),Ot=Math.round(s.aj*(He[Ve+1]*se-ye)),gt=Math.round(s.aj*(He[Ve+2]*se-ce)),ar=Math.round(s.aj*(He[Ve+3]*se-ye));const _r=gt-Qe,Tr=ar-Ot;Qe<xe&&gt<xe||(Qe<xe?(Ot+=Math.round(Tr*((xe-Qe)/_r)),Qe=xe):gt<xe&&(ar=Ot+Math.round(Tr*((xe-Qe)/_r)),gt=xe),Ot<xe&&ar<xe||(Ot<xe?(Qe+=Math.round(_r*((xe-Ot)/Tr)),Ot=xe):ar<xe&&(gt=Qe+Math.round(_r*((xe-Ot)/Tr)),ar=xe),Qe>=Fe&&gt>=Fe||(Qe>=Fe?(Ot+=Math.round(Tr*((Fe-Qe)/_r)),Qe=Fe):gt>=Fe&&(ar=Ot+Math.round(Tr*((Fe-Qe)/_r)),gt=Fe),Ot>=Fe&&ar>=Fe||(Ot>=Fe?(Qe+=Math.round(_r*((Fe-Ot)/Tr)),Ot=Fe):ar>=Fe&&(gt=Qe+Math.round(_r*((Fe-Ot)/Tr)),ar=Fe),et&&Qe===et[et.length-1][0]&&Ot===et[et.length-1][1]||(et=[[Qe,Ot]],Me.push(et)),et.push([gt,ar])))))}}function rt({name:He,features:se},ce){ce.writeStringField(1,He),ce.writeVarintField(5,s.aj);const ye=new Map,Me=new Map,xe={keys:ye,values:Me,feature:null};for(const Fe of se)xe.feature=Fe,ce.writeMessage(2,ht,xe);for(const Fe of ye.keys())ce.writeStringField(3,Fe);for(const Fe of Me.keys())ce.writeMessage(4,xr,Fe)}function ht(He,se){const ce=He.feature;ce.id===void 0||isNaN(+ce.id)||se.writeVarintField(1,+ce.id),ce.tags&&se.writeMessage(2,vt,He),se.writeVarintField(3,ce.type),se.writeMessage(4,Ut,ce)}function vt({keys:He,values:se,feature:ce},ye){for(const Me of Object.keys(ce.tags)){let xe=ce.tags[Me];if(xe===null)continue;let Fe=He.get(Me);Fe===void 0&&(Fe=He.size,He.set(Me,Fe)),ye.writeVarint(Fe);const et=typeof xe;et!=="string"&&et!=="boolean"&&et!=="number"&&(xe=JSON.stringify(xe));let Ve=se.get(xe);Ve===void 0&&(Ve=se.size,se.set(xe,Ve)),ye.writeVarint(Ve)}}function mt(He,se){return(se<<3)+(7&He)}function ct(He){return He<<1^He>>31}function Ut(He,se){const{geometry:ce,type:ye}=He;let Me=0,xe=0;if(ye===1){se.writeVarint(mt(1,ce.length));for(const Fe of ce){const et=Fe[0]-Me,Ve=Fe[1]-xe;se.writeVarint(ct(et)),se.writeVarint(ct(Ve)),Me+=et,xe+=Ve}}else for(const Fe of ce){se.writeVarint(mt(1,1));const et=Fe.length-(ye===3?1:0);for(let Ve=0;Ve<et;Ve++){Ve===1&&se.writeVarint(mt(2,et-1));const Qe=Fe[Ve][0]-Me,Ot=Fe[Ve][1]-xe;se.writeVarint(ct(Qe)),se.writeVarint(ct(Ot)),Me+=Qe,xe+=Ot}ye===3&&se.writeVarint(mt(7,1))}}function xr(He,se){const ce=typeof He;ce==="string"?se.writeStringField(1,He):ce==="boolean"?se.writeBooleanField(7,He):ce==="number"&&(He%1!=0?se.writeDoubleField(3,He):He<0?se.writeSVarintField(6,He):se.writeVarintField(5,He))}const tn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:He=>He},Er=Math.fround||(Ft=new Float32Array(1),He=>(Ft[0]=+He,Ft[0]));var Ft;const br=3,Yt=5,Qt=6;class Sr{constructor(se){this.options=Object.assign(Object.create(tn),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:ce,minZoom:ye,maxZoom:Me}=this.options;ce&&console.time("total time");const xe=`prepare ${se.length} points`;ce&&console.time(xe),this.points=se;const Fe=[];for(let Ve=0;Ve<se.length;Ve++){const Qe=se[Ve];if(!Qe.geometry)continue;const[Ot,gt]=Qe.geometry.coordinates,ar=Er(Jr(Ot)),_r=Er(Kr(gt));Fe.push(ar,_r,1/0,Ve,-1,1),this.options.reduce&&Fe.push(0)}let et=this.trees[Me+1]=this._createTree(Fe);ce&&console.timeEnd(xe);for(let Ve=Me;Ve>=ye;Ve--){const Qe=+Date.now();et=this.trees[Ve]=this._createTree(this._cluster(et,Ve)),ce&&console.log("z%d: %d clusters in %dms",Ve,et.numItems,+Date.now()-Qe)}return ce&&console.timeEnd("total time"),this}getClusters(se,ce){let ye=((se[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,se[1]));let xe=se[2]===180?180:((se[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)ye=-180,xe=180;else if(ye>xe){const gt=this.getClusters([ye,Me,180,Fe],ce),ar=this.getClusters([-180,Me,xe,Fe],ce);return gt.concat(ar)}const et=this.trees[this._limitZoom(ce)],Ve=et.range(Jr(ye),Kr(Fe),Jr(xe),Kr(Me)),Qe=et.data,Ot=[];for(const gt of Ve){const ar=this.stride*gt;Ot.push(Qe[ar+Yt]>1?Vt(Qe,ar,this.clusterProps):this.points[Qe[ar+br]])}return Ot}getChildren(se){const ce=this._getOriginId(se),ye=this._getOriginZoom(se),Me="No cluster with the specified id.",xe=this.trees[ye];if(!xe)throw new Error(Me);const Fe=xe.data;if(ce*this.stride>=Fe.length)throw new Error(Me);const et=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),Ve=xe.within(Fe[ce*this.stride],Fe[ce*this.stride+1],et),Qe=[];for(const Ot of Ve){const gt=Ot*this.stride;Fe[gt+4]===se&&Qe.push(Fe[gt+Yt]>1?Vt(Fe,gt,this.clusterProps):this.points[Fe[gt+br]])}if(Qe.length===0)throw new Error(Me);return Qe}getLeaves(se,ce,ye){const Me=[];return this._appendLeaves(Me,se,ce=ce||10,ye=ye||0,0),Me}getTile(se,ce,ye){const Me=this.trees[this._limitZoom(se)],xe=Math.pow(2,se),{extent:Fe,radius:et}=this.options,Ve=et/Fe,Qe=(ye-Ve)/xe,Ot=(ye+1+Ve)/xe,gt={features:[]};return this._addTileFeatures(Me.range((ce-Ve)/xe,Qe,(ce+1+Ve)/xe,Ot),Me.data,ce,ye,xe,gt),ce===0&&this._addTileFeatures(Me.range(1-Ve/xe,Qe,1,Ot),Me.data,xe,ye,xe,gt),ce===xe-1&&this._addTileFeatures(Me.range(0,Qe,Ve/xe,Ot),Me.data,-1,ye,xe,gt),gt.features.length?gt:null}getClusterExpansionZoom(se){let ce=this._getOriginZoom(se)-1;for(;ce<=this.options.maxZoom;){const ye=this.getChildren(se);if(ce++,ye.length!==1)break;se=ye[0].properties.cluster_id}return ce}_appendLeaves(se,ce,ye,Me,xe){const Fe=this.getChildren(ce);for(const et of Fe){const Ve=et.properties;if(Ve&&Ve.cluster?xe+Ve.point_count<=Me?xe+=Ve.point_count:xe=this._appendLeaves(se,Ve.cluster_id,ye,Me,xe):xe<Me?xe++:se.push(et),se.length===ye)break}return xe}_createTree(se){const ce=new s.c0(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<se.length;ye+=this.stride)ce.add(se[ye],se[ye+1]);return ce.finish(),ce.data=se,ce}_addTileFeatures(se,ce,ye,Me,xe,Fe){for(const et of se){const Ve=et*this.stride,Qe=ce[Ve+Yt]>1;let Ot,gt,ar;if(Qe)Ot=Nn(ce,Ve,this.clusterProps),gt=ce[Ve],ar=ce[Ve+1];else{const Gr=this.points[ce[Ve+br]];Ot=Gr.properties;const[zr,Wr]=Gr.geometry.coordinates;gt=Jr(zr),ar=Kr(Wr)}const _r={type:1,geometry:[[Math.round(this.options.extent*(gt*xe-ye)),Math.round(this.options.extent*(ar*xe-Me))]],tags:Ot};let Tr;Tr=Qe||this.options.generateId?ce[Ve+br]:this.points[ce[Ve+br]].id,Tr!==void 0&&(_r.id=Tr),Fe.features.push(_r)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,ce){const{radius:ye,extent:Me,reduce:xe,minPoints:Fe}=this.options,et=ye/(Me*Math.pow(2,ce)),Ve=se.data,Qe=[],Ot=this.stride;for(let gt=0;gt<Ve.length;gt+=Ot){if(Ve[gt+2]<=ce)continue;Ve[gt+2]=ce;const ar=Ve[gt],_r=Ve[gt+1],Tr=se.within(Ve[gt],Ve[gt+1],et),Gr=Ve[gt+Yt];let zr=Gr;for(const Wr of Tr){const Vn=Wr*Ot;Ve[Vn+2]>ce&&(zr+=Ve[Vn+Yt])}if(zr>Gr&&zr>=Fe){let Wr,Vn=ar*Gr,qr=_r*Gr,Ti=-1;const ts=(gt/Ot<<5)+(ce+1)+this.points.length;for(const qi of Tr){const Dn=qi*Ot;if(Ve[Dn+2]<=ce)continue;Ve[Dn+2]=ce;const pn=Ve[Dn+Yt];Vn+=Ve[Dn]*pn,qr+=Ve[Dn+1]*pn,Ve[Dn+4]=ts,xe&&(Wr||(Wr=this._map(Ve,gt,!0),Ti=this.clusterProps.length,this.clusterProps.push(Wr)),xe(Wr,this._map(Ve,Dn)))}Ve[gt+4]=ts,Qe.push(Vn/zr,qr/zr,1/0,ts,-1,zr),xe&&Qe.push(Ti)}else{for(let Wr=0;Wr<Ot;Wr++)Qe.push(Ve[gt+Wr]);if(zr>1)for(const Wr of Tr){const Vn=Wr*Ot;if(!(Ve[Vn+2]<=ce)){Ve[Vn+2]=ce;for(let qr=0;qr<Ot;qr++)Qe.push(Ve[Vn+qr])}}}}return Qe}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,ce,ye){if(se[ce+Yt]>1){const Fe=this.clusterProps[se[ce+Qt]];return ye?Object.assign({},Fe):Fe}const Me=this.points[se[ce+br]].properties,xe=this.options.map(Me);return ye&&xe===Me?Object.assign({},xe):xe}}function Vt(He,se,ce){return{type:"Feature",id:He[se+br],properties:Nn(He,se,ce),geometry:{type:"Point",coordinates:[(ye=He[se],360*(ye-.5)),Mn(He[se+1])]}};var ye}function Nn(He,se,ce){const ye=He[se+Yt],Me=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,xe=He[se+Qt],Fe=xe===-1?{}:Object.assign({},ce[xe]);return Object.assign(Fe,{cluster:!0,cluster_id:He[se+br],point_count:ye,point_count_abbreviated:Me})}function Jr(He){return He/360+.5}function Kr(He){const se=Math.sin(He*Math.PI/180),ce=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ce<0?0:ce>1?1:ce}function Mn(He){const se=(180-360*He)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function Fi(He,se,ce,ye){let Me=ye;const xe=se+(ce-se>>1);let Fe,et=ce-se;const Ve=He[se],Qe=He[se+1],Ot=He[ce],gt=He[ce+1];for(let ar=se+3;ar<ce;ar+=3){const _r=Us(He[ar],He[ar+1],Ve,Qe,Ot,gt);if(_r>Me)Fe=ar,Me=_r;else if(_r===Me){const Tr=Math.abs(ar-xe);Tr<et&&(Fe=ar,et=Tr)}}Me>ye&&(Fe-se>3&&Fi(He,se,Fe,ye),He[Fe+2]=Me,ce-Fe>3&&Fi(He,Fe,ce,ye))}function Us(He,se,ce,ye,Me,xe){let Fe=Me-ce,et=xe-ye;if(Fe!==0||et!==0){const Ve=((He-ce)*Fe+(se-ye)*et)/(Fe*Fe+et*et);Ve>1?(ce=Me,ye=xe):Ve>0&&(ce+=Fe*Ve,ye+=et*Ve)}return Fe=He-ce,et=se-ye,Fe*Fe+et*et}function ks(He,se,ce,ye){const Me={id:He??null,type:se,geometry:ce,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")Wi(Me,ce);else if(se==="Polygon")Wi(Me,ce[0]);else if(se==="MultiLineString")for(const xe of ce)Wi(Me,xe);else if(se==="MultiPolygon")for(const xe of ce)Wi(Me,xe[0]);return Me}function Wi(He,se){for(let ce=0;ce<se.length;ce+=3)He.minX=Math.min(He.minX,se[ce]),He.minY=Math.min(He.minY,se[ce+1]),He.maxX=Math.max(He.maxX,se[ce]),He.maxY=Math.max(He.maxY,se[ce+1])}function Bi(He,se,ce,ye){if(!se.geometry)return;const Me=se.geometry.coordinates;if(Me&&Me.length===0)return;const xe=se.geometry.type,Fe=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let et=[],Ve=se.id;if(ce.promoteId?Ve=se.properties[ce.promoteId]:ce.generateId&&(Ve=ye||0),xe==="Point")wo(Me,et);else if(xe==="MultiPoint")for(const Qe of Me)wo(Qe,et);else if(xe==="LineString")vs(Me,et,Fe,!1);else if(xe==="MultiLineString"){if(ce.lineMetrics){for(const Qe of Me)et=[],vs(Qe,et,Fe,!1),He.push(ks(Ve,"LineString",et,se.properties));return}$l(Me,et,Fe,!1)}else if(xe==="Polygon")$l(Me,et,Fe,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const Qe of se.geometry.geometries)Bi(He,{id:Ve,geometry:Qe,properties:se.properties},ce,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Qe of Me){const Ot=[];$l(Qe,Ot,Fe,!0),et.push(Ot)}}He.push(ks(Ve,xe,et,se.properties))}function wo(He,se){se.push(kc(He[0]),Pi(He[1]),0)}function vs(He,se,ce,ye){let Me,xe,Fe=0;for(let Ve=0;Ve<He.length;Ve++){const Qe=kc(He[Ve][0]),Ot=Pi(He[Ve][1]);se.push(Qe,Ot,0),Ve>0&&(Fe+=ye?(Me*Ot-Qe*xe)/2:Math.sqrt(Math.pow(Qe-Me,2)+Math.pow(Ot-xe,2))),Me=Qe,xe=Ot}const et=se.length-3;se[2]=1,Fi(se,0,et,ce),se[et+2]=1,se.size=Math.abs(Fe),se.start=0,se.end=se.size}function $l(He,se,ce,ye){for(let Me=0;Me<He.length;Me++){const xe=[];vs(He[Me],xe,ce,ye),se.push(xe)}}function kc(He){return He/360+.5}function Pi(He){const se=Math.sin(He*Math.PI/180),ce=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ce<0?0:ce>1?1:ce}function xs(He,se,ce,ye,Me,xe,Fe,et){if(ye/=se,xe>=(ce/=se)&&Fe<ye)return He;if(Fe<ce||xe>=ye)return null;const Ve=[];for(const Qe of He){const Ot=Qe.geometry;let gt=Qe.type;const ar=Me===0?Qe.minX:Qe.minY,_r=Me===0?Qe.maxX:Qe.maxY;if(ar>=ce&&_r<ye){Ve.push(Qe);continue}if(_r<ce||ar>=ye)continue;let Tr=[];if(gt==="Point"||gt==="MultiPoint")ju(Ot,Tr,ce,ye,Me);else if(gt==="LineString")Xa(Ot,Tr,ce,ye,Me,!1,et.lineMetrics);else if(gt==="MultiLineString")Ps(Ot,Tr,ce,ye,Me,!1);else if(gt==="Polygon")Ps(Ot,Tr,ce,ye,Me,!0);else if(gt==="MultiPolygon")for(const Gr of Ot){const zr=[];Ps(Gr,zr,ce,ye,Me,!0),zr.length&&Tr.push(zr)}if(Tr.length){if(et.lineMetrics&&gt==="LineString"){for(const Gr of Tr)Ve.push(ks(Qe.id,gt,Gr,Qe.tags));continue}gt!=="LineString"&&gt!=="MultiLineString"||(Tr.length===1?(gt="LineString",Tr=Tr[0]):gt="MultiLineString"),gt!=="Point"&&gt!=="MultiPoint"||(gt=Tr.length===3?"Point":"MultiPoint"),Ve.push(ks(Qe.id,gt,Tr,Qe.tags))}}return Ve.length?Ve:null}function ju(He,se,ce,ye,Me){for(let xe=0;xe<He.length;xe+=3){const Fe=He[xe+Me];Fe>=ce&&Fe<=ye&&oo(se,He[xe],He[xe+1],He[xe+2])}}function Xa(He,se,ce,ye,Me,xe,Fe){let et=Ya(He);const Ve=Me===0?Ta:ao;let Qe,Ot,gt=He.start;for(let zr=0;zr<He.length-3;zr+=3){const Wr=He[zr],Vn=He[zr+1],qr=He[zr+2],Ti=He[zr+3],ts=He[zr+4],qi=Me===0?Wr:Vn,Dn=Me===0?Ti:ts;let pn=!1;Fe&&(Qe=Math.sqrt(Math.pow(Wr-Ti,2)+Math.pow(Vn-ts,2))),qi<ce?Dn>ce&&(Ot=Ve(et,Wr,Vn,Ti,ts,ce),Fe&&(et.start=gt+Qe*Ot)):qi>ye?Dn<ye&&(Ot=Ve(et,Wr,Vn,Ti,ts,ye),Fe&&(et.start=gt+Qe*Ot)):oo(et,Wr,Vn,qr),Dn<ce&&qi>=ce&&(Ot=Ve(et,Wr,Vn,Ti,ts,ce),pn=!0),Dn>ye&&qi<=ye&&(Ot=Ve(et,Wr,Vn,Ti,ts,ye),pn=!0),!xe&&pn&&(Fe&&(et.end=gt+Qe*Ot),se.push(et),et=Ya(He)),Fe&&(gt+=Qe)}let ar=He.length-3;const _r=He[ar],Tr=He[ar+1],Gr=Me===0?_r:Tr;Gr>=ce&&Gr<=ye&&oo(et,_r,Tr,He[ar+2]),ar=et.length-3,xe&&ar>=3&&(et[ar]!==et[0]||et[ar+1]!==et[1])&&oo(et,et[0],et[1],et[2]),et.length&&se.push(et)}function Ya(He){const se=[];return se.size=He.size,se.start=He.start,se.end=He.end,se}function Ps(He,se,ce,ye,Me,xe){for(const Fe of He)Xa(Fe,se,ce,ye,Me,xe,!1)}function oo(He,se,ce,ye){He.push(se,ce,ye)}function Ta(He,se,ce,ye,Me,xe){const Fe=(xe-se)/(ye-se);return oo(He,xe,ce+(Me-ce)*Fe,1),Fe}function ao(He,se,ce,ye,Me,xe){const Fe=(xe-ce)/(Me-ce);return oo(He,se+(ye-se)*Fe,xe,1),Fe}function Ja(He,se){const ce=[];for(let ye=0;ye<He.length;ye++){const Me=He[ye],xe=Me.type;let Fe;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Fe=So(Me.geometry,se);else if(xe==="MultiLineString"||xe==="Polygon"){Fe=[];for(const et of Me.geometry)Fe.push(So(et,se))}else if(xe==="MultiPolygon"){Fe=[];for(const et of Me.geometry){const Ve=[];for(const Qe of et)Ve.push(So(Qe,se));Fe.push(Ve)}}ce.push(ks(Me.id,xe,Fe,Me.tags))}return ce}function So(He,se){const ce=[];ce.size=He.size,He.start!==void 0&&(ce.start=He.start,ce.end=He.end);for(let ye=0;ye<He.length;ye+=3)ce.push(He[ye]+se,He[ye+1],He[ye+2]);return ce}function Pc(He,se){if(He.transformed)return He;const ce=1<<He.z,ye=He.x,Me=He.y;for(const xe of He.features){const Fe=xe.geometry,et=xe.type;if(xe.geometry=[],et===1)for(let Ve=0;Ve<Fe.length;Ve+=2)xe.geometry.push(Yn(Fe[Ve],Fe[Ve+1],se,ce,ye,Me));else for(let Ve=0;Ve<Fe.length;Ve++){const Qe=[];for(let Ot=0;Ot<Fe[Ve].length;Ot+=2)Qe.push(Yn(Fe[Ve][Ot],Fe[Ve][Ot+1],se,ce,ye,Me));xe.geometry.push(Qe)}}return He.transformed=!0,He}function Yn(He,se,ce,ye,Me,xe){return[Math.round(ce*(He*ye-Me)),Math.round(ce*(se*ye-xe))]}function Cc(He,se,ce,ye,Me){const xe=se===Me.maxZoom?0:Me.tolerance/((1<<se)*Me.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:He.length,source:null,x:ce,y:ye,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of He)Ic(Fe,et,xe,Me);return Fe}function Ic(He,se,ce,ye){const Me=se.geometry,xe=se.type,Fe=[];if(He.minX=Math.min(He.minX,se.minX),He.minY=Math.min(He.minY,se.minY),He.maxX=Math.max(He.maxX,se.maxX),He.maxY=Math.max(He.maxY,se.maxY),xe==="Point"||xe==="MultiPoint")for(let et=0;et<Me.length;et+=3)Fe.push(Me[et],Me[et+1]),He.numPoints++,He.numSimplified++;else if(xe==="LineString")To(Fe,Me,He,ce,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let et=0;et<Me.length;et++)To(Fe,Me[et],He,ce,xe==="Polygon",et===0);else if(xe==="MultiPolygon")for(let et=0;et<Me.length;et++){const Ve=Me[et];for(let Qe=0;Qe<Ve.length;Qe++)To(Fe,Ve[Qe],He,ce,!0,Qe===0)}if(Fe.length){let et=se.tags||null;if(xe==="LineString"&&ye.lineMetrics){et={};for(const Qe in se.tags)et[Qe]=se.tags[Qe];et.mapbox_clip_start=Me.start/Me.size,et.mapbox_clip_end=Me.end/Me.size}const Ve={geometry:Fe,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:et};se.id!==null&&(Ve.id=se.id),He.features.push(Ve)}}function To(He,se,ce,ye,Me,xe){const Fe=ye*ye;if(ye>0&&se.size<(Me?Fe:ye))return void(ce.numPoints+=se.length/3);const et=[];for(let Ve=0;Ve<se.length;Ve+=3)(ye===0||se[Ve+2]>Fe)&&(ce.numSimplified++,et.push(se[Ve],se[Ve+1])),ce.numPoints++;Me&&function(Ve,Qe){let Ot=0;for(let gt=0,ar=Ve.length,_r=ar-2;gt<ar;_r=gt,gt+=2)Ot+=(Ve[gt]-Ve[_r])*(Ve[gt+1]+Ve[_r+1]);if(Ot>0===Qe)for(let gt=0,ar=Ve.length;gt<ar/2;gt+=2){const _r=Ve[gt],Tr=Ve[gt+1];Ve[gt]=Ve[ar-2-gt],Ve[gt+1]=Ve[ar-1-gt],Ve[ar-2-gt]=_r,Ve[ar-1-gt]=Tr}}(et,xe),He.push(et)}const Gl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ea{constructor(se,ce){const ye=(ce=this.options=function(xe,Fe){for(const et in Fe)xe[et]=Fe[et];return xe}(Object.create(Gl),ce)).debug;if(ye&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let Me=function(xe,Fe){const et=[];if(xe.type==="FeatureCollection")for(let Ve=0;Ve<xe.features.length;Ve++)Bi(et,xe.features[Ve],Fe,Ve);else Bi(et,xe.type==="Feature"?xe:{geometry:xe},Fe);return et}(se,ce);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=function(xe,Fe){const et=Fe.buffer/Fe.extent;let Ve=xe;const Qe=xs(xe,1,-1-et,et,0,-1,2,Fe),Ot=xs(xe,1,1-et,2+et,0,-1,2,Fe);return(Qe||Ot)&&(Ve=xs(xe,1,-et,1+et,0,-1,2,Fe)||[],Qe&&(Ve=Ja(Qe,1).concat(Ve)),Ot&&(Ve=Ve.concat(Ja(Ot,-1)))),Ve}(Me,ce),Me.length&&this.splitTile(Me,0,0,0),ye&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,ce,ye,Me,xe,Fe,et){const Ve=[se,ce,ye,Me],Qe=this.options,Ot=Qe.debug;for(;Ve.length;){Me=Ve.pop(),ye=Ve.pop(),ce=Ve.pop(),se=Ve.pop();const gt=1<<ce,ar=Mc(ce,ye,Me);let _r=this.tiles[ar];if(!_r&&(Ot>1&&console.time("creation"),_r=this.tiles[ar]=Cc(se,ce,ye,Me,Qe),this.tileCoords.push({z:ce,x:ye,y:Me}),Ot)){Ot>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ye,Me,_r.numFeatures,_r.numPoints,_r.numSimplified),console.timeEnd("creation"));const pn=`z${ce}`;this.stats[pn]=(this.stats[pn]||0)+1,this.total++}if(_r.source=se,xe==null){if(ce===Qe.indexMaxZoom||_r.numPoints<=Qe.indexMaxPoints)continue}else{if(ce===Qe.maxZoom||ce===xe)continue;if(xe!=null){const pn=xe-ce;if(ye!==Fe>>pn||Me!==et>>pn)continue}}if(_r.source=null,se.length===0)continue;Ot>1&&console.time("clipping");const Tr=.5*Qe.buffer/Qe.extent,Gr=.5-Tr,zr=.5+Tr,Wr=1+Tr;let Vn=null,qr=null,Ti=null,ts=null,qi=xs(se,gt,ye-Tr,ye+zr,0,_r.minX,_r.maxX,Qe),Dn=xs(se,gt,ye+Gr,ye+Wr,0,_r.minX,_r.maxX,Qe);se=null,qi&&(Vn=xs(qi,gt,Me-Tr,Me+zr,1,_r.minY,_r.maxY,Qe),qr=xs(qi,gt,Me+Gr,Me+Wr,1,_r.minY,_r.maxY,Qe),qi=null),Dn&&(Ti=xs(Dn,gt,Me-Tr,Me+zr,1,_r.minY,_r.maxY,Qe),ts=xs(Dn,gt,Me+Gr,Me+Wr,1,_r.minY,_r.maxY,Qe),Dn=null),Ot>1&&console.timeEnd("clipping"),Ve.push(Vn||[],ce+1,2*ye,2*Me),Ve.push(qr||[],ce+1,2*ye,2*Me+1),Ve.push(Ti||[],ce+1,2*ye+1,2*Me),Ve.push(ts||[],ce+1,2*ye+1,2*Me+1)}}getTile(se,ce,ye){se=+se,ce=+ce,ye=+ye;const Me=this.options,{extent:xe,debug:Fe}=Me;if(se<0||se>24)return null;const et=1<<se,Ve=Mc(se,ce=ce+et&et-1,ye);if(this.tiles[Ve])return Pc(this.tiles[Ve],xe);Fe>1&&console.log("drilling down to z%d-%d-%d",se,ce,ye);let Qe,Ot=se,gt=ce,ar=ye;for(;!Qe&&Ot>0;)Ot--,gt>>=1,ar>>=1,Qe=this.tiles[Mc(Ot,gt,ar)];return Qe&&Qe.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",Ot,gt,ar),console.time("drilling down")),this.splitTile(Qe.source,Ot,gt,ar,se,ce,ye),Fe>1&&console.timeEnd("drilling down"),this.tiles[Ve]?Pc(this.tiles[Ve],xe):null):null}}function Mc(He,se,ce){return 32*((1<<He)*ce+se)+He}function ut(He,se){const ce=He.tileID.canonical;if(!this._geoJSONIndex)return void se(null,null);const ye=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!ye)return void se(null,null);const Me=Qe=>Qe.tags&&"3d_elevation_id"in Qe.tags&&"source"in Qe.tags&&Qe.tags.source==="elevation",xe=ye.features.filter(Qe=>Me(Qe));let Fe={_geojsonTileLayer:ye.features};xe.length>0&&(Fe={_geojsonTileLayer:ye.features.filter(Qe=>!Me(Qe)),hd_road_elevation:xe});const et=new le(Fe),Ve=function(Qe){const Ot=new s.bq;for(const gt of Object.keys(Qe))Ot.writeMessage(3,rt,{name:gt,features:Qe[gt]});return Ot.finish()}(Fe).buffer;se(null,{vectorTile:et,rawData:Ve})}class qn extends G{constructor(se,ce,ye,Me,xe,Fe,et){super(se,ce,ye,Me,xe,ut,et),Fe&&(this.loadGeoJSON=Fe),this._dynamicIndex=new ze}loadData(se,ce){const ye=se&&se.request,Me=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(se,(xe,Fe)=>{if(xe||!Fe)return ce(xe);if(typeof Fe!="object")return ce(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{try{if(se.filter){const Ve=s.X(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));Fe.features=Fe.features.filter(Qe=>Ve.value.evaluate({zoom:0},Qe))}se.dynamic?(Fe.type==="Feature"&&(Fe={type:"FeatureCollection",features:[Fe]}),se.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Fe.features,this.loaded),se.cluster&&(Fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=se.cluster?new Sr(function({superclusterOptions:Ve,clusterProperties:Qe}){if(!Qe||!Ve)return Ve;const Ot={},gt={},ar={accumulated:null,zoom:0},_r={properties:null},Tr=Object.keys(Qe);for(const Gr of Tr){const[zr,Wr]=Qe[Gr],Vn=s.X(Wr),qr=s.X(typeof zr=="string"?[zr,["accumulated"],["get",Gr]]:zr);Ot[Gr]=Vn.value,gt[Gr]=qr.value}return Ve.map=Gr=>{_r.properties=Gr;const zr={};for(const Wr of Tr)zr[Wr]=Ot[Wr].evaluate(ar,_r);return zr},Ve.reduce=(Gr,zr)=>{_r.properties=zr;for(const Wr of Tr)ar.accumulated=Gr[Wr],Gr[Wr]=gt[Wr].evaluate(ar,_r)},Ve}(se)).load(Fe.features):se.dynamic?this._dynamicIndex:function(Ve,Qe){return new Ea(Ve,Qe)}(Fe,se.geojsonVtOptions)}catch(Ve){return ce(Ve)}const et={};if(Me){const Ve=v(ye);Ve&&(et.resourceTiming={},et.resourceTiming[se.source]=JSON.parse(JSON.stringify(Ve)))}ce(null,et)}})}reloadTile(se,ce){const ye=this.loaded;return ye&&ye[se.uid]?se.partial?ce(null,void 0):super.reloadTile(se,ce):this.loadTile(se,ce)}loadGeoJSON(se,ce){if(se.request)s.n(se.request,ce);else{if(typeof se.data!="string")return ce(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ce(null,JSON.parse(se.data))}catch{return ce(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(se,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(ye){ce(ye)}}getClusterChildren(se,ce){try{ce(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(ye){ce(ye)}}getClusterLeaves(se,ce){try{ce(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(ye){ce(ye)}}}class Ci{constructor(se,ce,ye){this.tileID=new s.aM(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=se.projection,this.brightness=ce,this.worldview=ye}parse(se,ce,ye,Me){this.status="parsing";const xe=new s.aM(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Fe=[],et=ce.familiesBySource[ye.source],Ve=new s.fc(xe,ye.promoteId);Ve.bucketLayerIDs=[],Ve.is3DTile=!0,s.fr(se).then(Qe=>{if(!Qe)return Me(new Error("Could not parse tile"));const Ot=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Qe.json.asset.extras&&Qe.json.asset.extras.MAPBOX_mesh_features,gt=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("EXT_meshopt_compression"),ar=new s.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const _r in et)for(const Tr of et[_r]){const Gr=Tr[0];Ve.bucketLayerIDs.push(Tr.map(Vn=>s.C(Vn.id,Vn.scope))),Gr.recalculate(ar,[]);const zr=s.fs(Qe,1/s.d4(ye.tileID.canonical)),Wr=new s.ft(Tr,zr,xe,Ot,gt,this.brightness,Ve,this.worldview);Ot||(Wr.needsUpload=!0),Fe.push(Wr),Wr.evaluate(Gr)}this.status="done",Me(null,{buckets:Fe,featureIndex:Ve,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Qe=>Me(new Error(Qe.message)))}}class $s{constructor(se,ce,ye,Me,xe,Fe,et,Ve){this.actor=se,this.layerIndex=ce,this.availableImages=ye,this.availableModels=Me,this.brightness=et,this.loading={},this.loaded={},this.worldview=Ve}loadTile(se,ce){const ye=se.uid,Me=this.loading[ye]=new Ci(se,this.brightness,this.worldview);s.br(se.request,(xe,Fe)=>{const et=!this.loading[ye];return delete this.loading[ye],et||xe?(Me.status="done",et||(this.loaded[ye]=Me),ce(xe)):Fe&&Fe.byteLength!==0?void Me.parse(Fe,this.layerIndex,se,(Ve,Qe)=>{Me.status="done",this.loaded=this.loaded||{},this.loaded[ye]=Me,Ve||!Qe?ce(Ve):ce(null,Qe)}):(Me.status="done",this.loaded[ye]=Me,ce())})}reloadTile(se,ce){const ye=this.loaded,Me=se.uid;if(ye&&ye[Me]){const xe=ye[Me];xe.projection=se.projection,xe.brightness=se.brightness;const Fe=(et,Ve)=>{xe.reloadCallback&&(delete xe.reloadCallback,this.loadTile(se,ce)),ce(et,Ve)};xe.status==="parsing"?xe.reloadCallback=Fe:xe.status==="done"&&this.loadTile(se,ce)}}abortTile(se,ce){const ye=se.uid;this.loading[ye]&&delete this.loading[ye],ce()}removeTile(se,ce){const ye=this.loaded,Me=se.uid;ye&&ye[Me]&&delete ye[Me],ce()}}class Br{constructor(se){this.self=se,this.actor=new s.fv(se,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cj({name:"mercator"}),this.workerSourceTypes={vector:G,geojson:qn,"raster-dem":U,"raster-array":X,"batched-model":$s},this.workerSources={},this.self.registerWorkerSource=(ce,ye)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=ye},this.self.registerRTLTextPlugin=ce=>{if(s.fw.isParsed())throw new Error("RTL text plugin already registered.");s.fw.setState({pluginStatus:s.fx.parsed,pluginURL:s.fw.getPluginURL()}),s.fw.applyArabicShaping=ce.applyArabicShaping,s.fw.processBidirectionalText=ce.processBidirectionalText,s.fw.processStyledBidirectionalText=ce.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(se,ce,ye){delete this.layerIndexes[se],delete this.availableImages[se],delete this.availableModels[se],delete this.workerSources[se],ye()}checkIfReady(se,ce,ye){ye()}setReferrer(se,ce){this.referrer=ce}spriteLoaded(se,ce){this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={});const{scope:ye,isLoaded:Me}=ce;if(this.isSpriteLoaded[se][ye]=Me,this.workerSources[se]&&this.workerSources[se][ye])for(const xe in this.workerSources[se][ye]){const Fe=this.workerSources[se][ye][xe];for(const et in Fe){const Ve=Fe[et];Ve instanceof G&&(Ve.isSpriteLoaded=Me,Ve.fire(new s.A("isSpriteLoaded")))}}}setImages(se,ce,ye){this.availableImages[se]||(this.availableImages[se]={});const{scope:Me,images:xe}=ce;if(this.availableImages[se][Me]=xe,this.workerSources[se]&&this.workerSources[se][Me]){for(const Fe in this.workerSources[se][Me]){const et=this.workerSources[se][Me][Fe];for(const Ve in et)et[Ve].availableImages=xe}ye()}else ye()}setModels(se,{scope:ce,models:ye},Me){if(this.availableModels[se]||(this.availableModels[se]={}),this.availableModels[se][ce]=ye,this.workerSources[se]&&this.workerSources[se][ce]){for(const xe in this.workerSources[se][ce]){const Fe=this.workerSources[se][ce][xe];for(const et in Fe)Fe[et].availableModels=ye}Me()}else Me()}setProjection(se,ce){this.projections[se]=s.cj(ce)}setBrightness(se,ce,ye){this.brightness=ce,ye()}setWorldview(se,ce,ye){this.worldview=ce,ye()}setLayers(se,ce,ye){this.getLayerIndex(se,ce.scope).replace(ce.layers,ce.options),ye()}updateLayers(se,ce,ye){this.getLayerIndex(se,ce.scope).update(ce.layers,ce.removedIds,ce.options),ye()}loadTile(se,ce,ye){ce.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ce.type,ce.source,ce.scope).loadTile(ce,ye)}decodeRasterArray(se,ce,ye){this.getWorkerSource(se,ce.type,ce.source,ce.scope).decodeRasterArray(ce,ye)}reloadTile(se,ce,ye){ce.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ce.type,ce.source,ce.scope).reloadTile(ce,ye)}abortTile(se,ce,ye){this.getWorkerSource(se,ce.type,ce.source,ce.scope).abortTile(ce,ye)}removeTile(se,ce,ye){this.getWorkerSource(se,ce.type,ce.source,ce.scope).removeTile(ce,ye)}removeSource(se,ce,ye){if(!(this.workerSources[se]&&this.workerSources[se][ce.scope]&&this.workerSources[se][ce.scope][ce.type]&&this.workerSources[se][ce.scope][ce.type][ce.source]))return;const Me=this.workerSources[se][ce.scope][ce.type][ce.source];delete this.workerSources[se][ce.scope][ce.type][ce.source],Me.removeSource!==void 0?Me.removeSource(ce,ye):ye()}loadWorkerSource(se,ce,ye){try{this.self.importScripts(ce.url),ye()}catch(Me){ye(Me.toString())}}syncRTLPluginState(se,ce,ye){if(s.fw.isParsed())ye(null,!0);else if(s.fw.isParsing())this.rtlPluginParsingListeners.push(ye);else try{s.fw.setState(ce);const Me=s.fw.getPluginURL();!s.fw.isLoaded()||s.fw.isParsed()||s.fw.isParsing()||Me==null||(s.fw.setState({pluginStatus:s.fx.parsing,pluginURL:s.fw.getPluginURL()}),this.self.importScripts(Me),s.fw.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(Me){ye(Me.toString())}}setDracoUrl(se,ce){this.dracoUrl=ce}getAvailableImages(se,ce){this.availableImages[se]||(this.availableImages[se]={});let ye=this.availableImages[se][ce];return ye||(ye=[]),ye}getAvailableModels(se,ce){this.availableModels[se]||(this.availableModels[se]={});let ye=this.availableModels[se][ce];return ye||(ye={}),ye}getLayerIndex(se,ce){this.layerIndexes[se]||(this.layerIndexes[se]={});let ye=this.layerIndexes[se][ce];return ye||(ye=this.layerIndexes[se][ce]=new I,ye.scope=ce),ye}getWorkerSource(se,ce,ye,Me){const xe=this.workerSources;return xe[se]||(xe[se]={}),xe[se][Me]||(xe[se][Me]={}),xe[se][Me][ce]||(xe[se][Me][ce]={}),this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={}),xe[se][Me][ce][ye]||(xe[se][Me][ce][ye]=new this.workerSourceTypes[ce]({send:(Fe,et,Ve,Qe,Ot,gt)=>this.actor.send(Fe,et,Ve,se,Ot,gt),scheduler:this.actor.scheduler},this.getLayerIndex(se,Me),this.getAvailableImages(se,Me),this.getAvailableModels(se,Me),this.isSpriteLoaded[se][Me],void 0,this.brightness,this.worldview)),xe[se][Me][ce][ye]}rasterizeImagesWorker(se,ce,ye){const Me=new Map;for(const[xe,{image:Fe,imageVariant:et}]of ce.tasks.entries()){const Ve=this.imageRasterizer.rasterize(et,Fe,ce.scope,se);Me.set(xe,Ve)}ye(void 0,Me)}removeRasterizedImages(se,ce,ye){this.imageRasterizer.removeImagesFromCacheByIds(ce.imageIds,ce.scope,se),ye()}enforceCacheSizeLimit(se,ce){s.fy(ce)}getWorkerPerformanceMetrics(se,ce,ye){ye(void 0,void 0)}}return s.fu(self)&&(self.worker=new Br(self)),Br}),h(["./shared"],function(s){var v="3.14.0";const w={create:"create",load:"load",fullLoad:"fullLoad"},T={mark(m){performance.mark(m)},measure(m,o,u){performance.measure(m,o,u)}};function I(m){const o=m.name.split("?")[0];return s.a(o)&&o.includes("mapbox-gl.js")?"javascript":s.a(o)&&o.includes("mapbox-gl.css")?"css":s.b(o)?"fontRange":s.c(o)?"sprite":s.i(o)?"style":s.d(o)?"tilejson":"other"}var O,D={},B=function(){if(O)return D;function m(g){return!o(g)}function o(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,E,C=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(C);try{E=new Worker(M),b=!0}catch{b=!1}return E&&E.terminate(),URL.revokeObjectURL(M),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var E=b.getContext("2d");if(!E)return!1;var C=E.getImageData(0,0,1,1);return C&&C.width===b.width}()?(u[x=g&&g.failIfMajorPerformanceCaveat]===void 0&&(u[x]=function(b){var E,C=function(M){var z=document.createElement("canvas"),F=Object.create(m.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=M,z.getContext("webgl2",F)}(b);if(!C)return!1;try{E=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!E||C.isContextLost())&&(C.shaderSource(E,"void main() {}"),C.compileShader(E),C.getShaderParameter(E,C.COMPILE_STATUS)===!0)}(x)),u[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}O=1,D.supported=m,D.notSupportedReason=o;var u={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},D}();function N(m,o,u){const g=document.createElement(m);return o!=null&&(g.className=o),u&&u.appendChild(g),g}function G(m,o,u){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(o))g.setAttributeNS(null,x,String(o[x]));return u&&u.appendChild(g),g}const U=typeof document<"u"?document.documentElement&&document.documentElement.style:null,V=U&&U.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;function Y(){U&&V&&(X=U[V],U[V]="none")}function ne(){U&&V&&(U[V]=X)}function ae(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",ae,!0)}function le(){window.addEventListener("click",ae,!0),window.setTimeout(()=>{window.removeEventListener("click",ae,!0)},0)}function ge(m,o){const u=m.getBoundingClientRect();return Pe(m,u,o)}function je(m,o){const u=m.getBoundingClientRect(),g=[];for(let x=0;x<o.length;x++)g.push(Pe(m,u,o[x]));return g}function ze(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function Pe(m,o,u){const g=m.offsetWidth===o.width?1:m.offsetWidth/o.width;return new s.P((u.clientX-o.left)*g,(u.clientY-o.top)*g)}const Ke="01",Ye="NO_ACCESS_TOKEN";class Oe{constructor(o,u,g){this._transformRequestFn=o,this._customAccessToken=u,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const o=function(){let u="";for(let g=0;g<10;g++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ke,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}}normalizeStyleURL(o,u){if(!s.j(o))return o;const g=We(o);return g.params.push(`sdk=js-${v}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeGlyphsURL(o,u){if(!s.j(o))return o;const g=We(o);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeModelURL(o,u){if(!s.j(o))return o;const g=We(o);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeSourceURL(o,u,g,x){if(!s.j(o))return o;const b=We(o);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),g&&b.params.push(`language=${g}`),x&&b.params.push(`worldview=${x}`),this._makeAPIURL(b,this._customAccessToken||u)}normalizeIconsetURL(o,u){const g=We(o);return s.j(o)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||u)):lt(g)}normalizeSpriteURL(o,u,g,x){const b=We(o);return s.j(o)?(b.path=`/styles/v1${b.path}/sprite${u}${g}`,this._makeAPIURL(b,this._customAccessToken||x)):(b.path+=`${u}${g}`,lt(b))}normalizeTileURL(o,u,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!s.j(o))return o;const x=We(o);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||g&&x.authority!=="raster"&&g===512?"@2x":""}${s.l.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${s.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${s.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${s.e.TILE_URL_VERSION}${x.path}`);const b=this._customAccessToken||function(E){for(const C of E){const M=C.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(x.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,b)}canonicalizeTileURL(o,u){const g=We(o);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return o;let x="mapbox://";g.path.match(/^\/raster\/v1\//)?x+=`raster/${g.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${g.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${g.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let b=g.params;return u&&(b=b.filter(E=>!E.match(/^access_token=/))),b.length&&(x+=`?${b.join("&")}`),x}canonicalizeTileset(o,u){const g=!!u&&s.j(u),x=[];for(const b of o.tiles||[])s.k(b)?x.push(this.canonicalizeTileURL(b,g)):x.push(b);return x}_makeAPIURL(o,u){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=We(s.e.API_URL);if(o.protocol=x.protocol,o.authority=x.authority,o.protocol==="http"){const b=o.params.indexOf("secure");b>=0&&o.params.splice(b,1)}if(x.path!=="/"&&(o.path=`${x.path}${o.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return lt(o);if(u=u||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return o.params=o.params.filter(b=>b.indexOf("access_token")===-1),o.params.push(`access_token=${u||""}`),lt(o)}}const tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function We(m){const o=m.match(tt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function lt(m){const o=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${o}`}const rt="mapbox.eventData";function ht(m){if(!m)return null;const o=m.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(s.m(o[1]))}catch{return null}}class vt{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const u=ht(s.e.ACCESS_TOKEN);let g="";return g=u&&u.u?s.f(u.u):s.e.ACCESS_TOKEN||"",o?`${rt}.${o}:${g}`:`${rt}:${g}`}fetchEventData(){const o=s.s("localStorage"),u=this.getStorageKey(),g=this.getStorageKey("uuid");if(o)try{const x=localStorage.getItem(u);x&&(this.eventData=JSON.parse(x));const b=localStorage.getItem(g);b&&(this.anonId=b)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const o=s.s("localStorage"),u=this.getStorageKey(),g=this.getStorageKey("uuid"),x=this.anonId;if(o&&x)try{localStorage.setItem(g,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(u,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,u,g,x){if(!s.e.EVENTS_URL)return;const b=We(s.e.EVENTS_URL);b.params.push(`access_token=${x||s.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(o).toISOString()},C=u?s.h(E,u):E,M={url:lt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=s.p(M,z=>{this.pendingRequest=null,g(z),this.saveEventData(),this.processRequests(x)})}queueRequest(o,u){this.queue.push(o),this.processRequests(u)}}const mt=new class extends vt{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,o){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(u=>s.j(u)||s.k(u))&&this.queueRequest(Date.now(),o)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=ht(s.e.ACCESS_TOKEN),u=o?o.u:s.e.ACCESS_TOKEN;let g=u!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),g=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),E=new Date(x),C=(x-this.eventData.lastSuccess)/864e5;g=g||C>=1||C<-1||b.getDate()!==E.getDate()}else g=!0;g?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ke,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=x,this.eventData.tokenU=u)},m):this.processRequests()}},ct=mt.postTurnstileEvent.bind(mt),Ut=new class extends vt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,o,u,g){this.skuToken=o,this.errorCb=g,s.e.EVENTS_URL&&(u||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(Ye)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ke,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):o&&(this.success[o]=!0)},m))}remove(){this.errorCb=null}},xr=Ut.postMapLoadEvent.bind(Ut),tn=new class extends vt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let o=this.mapInstanceIdMap.get(m);return o||(o=s.u(),this.mapInstanceIdMap.set(m,o)),o}getEventId(m){const o=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,o+1),o}postStyleLoadEvent(m,o){const{map:u,style:g,importedStyles:x}=o;if(!s.e.EVENTS_URL||!m&&!s.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(u),E={mapInstanceId:b,eventId:this.getEventId(b),style:g};x.length&&(E.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:E},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:u}=this.queue.shift();this.postEvent(o,u,()=>{},m)}},Er=tn.postStyleLoadEvent.bind(tn),Ft=new class extends vt{constructor(){super("gljs.performance")}postPerformanceEvent(m,o){s.e.EVENTS_URL&&(m||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:u}=this.queue.shift(),g=function(x){const b=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),C=function(K){const te={};if(K){for(const ee in K)if(ee!=="other")for(const re of K[ee]){const ie=`${ee}ResolveRangeMin`,ue=`${ee}ResolveRangeMax`,pe=`${ee}RequestCount`,me=`${ee}RequestCachedCount`;te[ie]=Math.min(te[ie]||1/0,re.startTime),te[ue]=Math.max(te[ue]||-1/0,re.responseEnd);const Te=we=>{te[we]===void 0&&(te[we]=0),++te[we]};re.transferSize!==void 0&&re.transferSize===0&&Te(me),Te(pe)}}return te}(function(K,te){const ee={};if(K)for(const re of K){const ie=te(re);ee[ie]===void 0&&(ee[ie]=[]),ee[ie].push(re)}return ee}(b,I)),M=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=z?z.effectiveType:void 0,H={counters:[],metadata:[],attributes:[]},$=(K,te,ee)=>{ee!=null&&K.push({name:te,value:ee.toString()})};for(const K in C)$(H.counters,K,C[K]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&($(H.counters,"interactionRangeMin",x.interactionRange[0]),$(H.counters,"interactionRangeMax",x.interactionRange[1])),E)for(const K of Object.keys(w)){const te=w[K],ee=E.find(re=>re.name===te);ee&&$(H.counters,te,ee.startTime)}return $(H.counters,"visibilityHidden",x.visibilityHidden),$(H.attributes,"style",function(K){if(K)for(const te of K){const ee=te.name.split("?")[0];if(s.i(ee)){const re=ee.split("/").slice(-2);if(re.length===2)return`mapbox://styles/${re[0]}/${re[1]}`}}}(b)),$(H.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),$(H.attributes,"fogEnabled",x.fogEnabled?"true":"false"),$(H.attributes,"projection",x.projection),$(H.attributes,"zoom",x.zoom),$(H.metadata,"devicePixelRatio",M),$(H.metadata,"connectionEffectiveType",F),$(H.metadata,"navigatorUserAgent",navigator.userAgent),$(H.metadata,"screenWidth",window.screen.width),$(H.metadata,"screenHeight",window.screen.height),$(H.metadata,"windowWidth",window.innerWidth),$(H.metadata,"windowHeight",window.innerHeight),$(H.metadata,"mapWidth",x.width/M),$(H.metadata,"mapHeight",x.height/M),$(H.metadata,"webglRenderer",x.renderer),$(H.metadata,"webglVendor",x.vendor),$(H.metadata,"sdkVersion",v),$(H.metadata,"sdkIdentifier","mapbox-gl-js"),H}(u);for(const x of g.metadata);for(const x of g.counters);for(const x of g.attributes);this.postEvent(o,g,()=>{},m)}},br=Ft.postPerformanceEvent.bind(Ft),Yt=new class extends vt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,o,u,g){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const x=We(s.e.API_URL+s.e.SESSION_PATH);x.params.push(`sku=${o||""}`),x.params.push(`access_token=${g||s.e.ACCESS_TOKEN||""}`);const b={url:lt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(b,E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,o,u,g){this.skuToken=o,this.errorCb=g,s.e.SESSION_PATH&&s.e.API_URL&&(u||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(Ye)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||this.getSession(u,this.skuToken,g=>{g?this.errorCb(g):o&&(this.success[o]=!0)},m)}remove(){this.errorCb=null}},Qt=Yt.getSessionAPI.bind(Yt),Sr=new Set;function Vt(m,o){o?Sr.add(m):Sr.delete(m)}class Nn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,u){this._updatedSourceCaches[o]=u,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const u=o.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(o.id),this.setDirty()}removeLayer(o){const u=o.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][o.id]=o,this._updatedLayers[u].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const u in this._updatedLayers)o[u]=o[u]||{},o[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)o[u]=o[u]||{},o[u].removedIds=Object.keys(this._removedLayers[u]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,u){this._updatedImages[u]=this._updatedImages[u]||new Set,this._updatedImages[u].add(s.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Jr(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class Kr extends s.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new s.r({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const u=this.atlasTexture.get(o);u&&(u.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,u){this.imageProviders.has(u)||this.imageProviders.set(u,new Map),this.imageProviders.get(u).set(o.id,o)}removeImageProvider(o,u){this.imageProviders.has(u)&&this.imageProviders.get(u).delete(o)}getPendingImageProviders(){const o=[];for(const u of this.imageProviders.values())for(const g of u.values())g.hasPendingRequests()&&o.push(g);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,u){if(this.loaded.get(u)!==o&&(this.loaded.set(u,o),o)){for(const{ids:g,callback:x}of this.requestors)this._notify(g,u,x);this.requestors=[]}}hasImage(o,u){return!!this.getImage(o,u)}getImage(o,u){return this.images.get(u).get(o.toString())}addImage(o,u,g){this._validate(o,g)&&this.images.get(u).set(o.toString(),g)}_validate(o,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new s.z(new Error(`Image "${o.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new s.z(new Error(`Image "${o.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new s.z(new Error(`Image "${o.name}" has invalid "content" value`))),g=!1),g}_validateStretch(o,u){if(!o)return!0;let g=0;for(const x of o){if(x[0]<g||x[1]<x[0]||u<x[1])return!1;g=x[1]}return!0}_validateContent(o,u){return o?o.length!==4||!u.usvg&&(o[0]<0||u.data.width<o[0]||o[1]<0||u.data.height<o[1]||o[2]<0||u.data.width<o[2]||o[3]<0||u.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,u,g){const x=this.images.get(u).get(o.toString());g.version=x.version+1,this.images.get(u).set(o.toString(),g),this.updatedImages.get(u).add(o),this.removeFromImageRasterizerCache(o,u)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,u){this.spriteFormat!=="raster"&&(s.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:u}):this.imageRasterizer.removeImagesFromCacheByIds([o],u))}removeImage(o,u){const g=this.images.get(u),x=g.get(o.toString());g.delete(o.toString()),this.patterns.get(u).delete(o.toString()),this.removeFromImageRasterizerCache(o,u),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(u=>s.I.from(u))}getImages(o,u,g){const x=[],b=[],E=this.imageProviders.get(u);for(const F of o){if(!F.iconsetId){x.push(F);continue}const H=E.get(F.iconsetId);H&&(this.getImage(F,u)?b.push(F):H.addPendingRequest(F))}if(x.length===0)return void this._notify(b,u,g);let C=!0;const M=!!this.loaded.get(u),z=this.images.get(u);if(!M)for(const F of x)z.has(F.toString())||(C=!1);M||C?this._notify(x,u,g):this.requestors.push({ids:x,scope:u,callback:g})}rasterizeImages(o,u){const g=new Map,{tasks:x,scope:b}=o;for(const[E,C]of x.entries()){const M=this.getImage(C.id,b);M&&g.set(E,{image:M,imageVariant:C})}this._rasterizeImages(b,g,u)}_rasterizeImages(o,u,g){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:u,scope:o},g);else{const x=new Map;for(const[b,{image:E,imageVariant:C}]of u.entries())x.set(b,this.imageRasterizer.rasterize(C,E,o,0));g(void 0,x)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,u,g){const x=this.images.get(u),b=new Map;for(const E of o){if(!x.get(E.toString())){if(E.iconsetId)continue;this.fire(new s.A("styleimagemissing",{id:E.name}))}const C=x.get(E.toString());if(!C){s.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const M={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)};C.usvg&&Object.assign(M,{width:C.icon.usvg_tree.width,height:C.icon.usvg_tree.height}),b.set(s.I.toString(E),M)}g(null,b)}getPixelSize(o){const{width:u,height:g}=this.atlasImage.get(o);return{width:u,height:g}}getPattern(o,u,g){const x=o.toString(),b=this.patterns.get(u),E=b.get(x),C=this.getImage(o,u);if(!C)return null;if(E){if(E.position.version===C.version)return E.position;E.position.version=C.version}else{if(C.usvg&&!C.data){const M=this.getPatternInFlightId(x,u);if(this.patternsInFlight.has(M))return null;this.patternsInFlight.add(M);const z=new s.B(o).scaleSelf(s.q.devicePixelRatio),F=new Map([[z.toString(),{image:C,imageVariant:z}]]);return this._rasterizeImages(u,F,(H,$)=>this.storePatternImage(z,u,C,g,$)),null}this.storePattern(o,u,C)}return this._updatePatternAtlas(u,g),b.get(x).position}getPatternInFlightId(o,u){return s.C(o,u)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,u,g,x,b){const E=o.toString(),C=b?b.get(E):void 0;C&&(g.data=C,this.storePattern(o.id,u,g),this._updatePatternAtlas(u,x),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),u)))}storePattern(o,u,g){const x={w:g.data.width+2*s.F,h:g.data.height+2*s.F,x:0,y:0},b=new s.G(x,g,s.F);this.patterns.get(u).set(o.toString(),{bin:x,position:b})}destroyAtlasTextures(){for(const o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,u){const g=o.gl;let x=this.atlasTexture.get(u);x?this.dirty&&(x.update(this.atlasImage.get(u)),this.dirty=!1):(x=new s.T(o,this.atlasImage.get(u),g.RGBA8),this.atlasTexture.set(u,x)),x.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(o,u){const g=this.patterns.get(o),x=Array.from(g.values()).map(({bin:z})=>z),{w:b,h:E}=s.H(x),C=this.atlasImage.get(o);C.resize({width:b||1,height:E||1});const M=this.images.get(o);for(const[z,{bin:F,position:H}]of g.entries()){let $=H.padding;const K=F.x+$,te=F.y+$,ee=M.get(z).data,re=ee.width,ie=ee.height;$=$>1?$-1:$,s.r.copy(ee,C,{x:0,y:0},{x:K,y:te},{width:re,height:ie},u),s.r.copy(ee,C,{x:0,y:ie-$},{x:K,y:te-$},{width:re,height:$},u),s.r.copy(ee,C,{x:0,y:0},{x:K,y:te+ie},{width:re,height:$},u),s.r.copy(ee,C,{x:re-$,y:0},{x:K-$,y:te},{width:$,height:ie},u),s.r.copy(ee,C,{x:0,y:0},{x:K+re,y:te},{width:$,height:ie},u),s.r.copy(ee,C,{x:re-$,y:ie-$},{x:K-$,y:te-$},{width:$,height:$},u),s.r.copy(ee,C,{x:0,y:ie-$},{x:K+re,y:te-$},{width:$,height:$},u),s.r.copy(ee,C,{x:0,y:0},{x:K+re,y:te+ie},{width:$,height:$},u),s.r.copy(ee,C,{x:re-$,y:0},{x:K-$,y:te+ie},{width:$,height:$},u)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,u){const g=this.images.get(u);for(const x of o){if(this.callbackDispatchedThisFrame.get(u).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(u).add(x.toString());const b=g.get(x.toString());Jr(b)&&this.updateImage(x,u,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Mn(m){const o=m.key,u=m.value,g=m.valueSpec||{},x=m.objectElementValidators||{},b=m.style,E=m.styleSpec;let C=[];const M=s.J(u);if(M!=="object")return[new s.V(o,u,`object expected, ${M} found`)];for(const z in u){const F=z.split(".")[0];let H;x[F]?H=x[F]:g[F]?H=Yn:x["*"]?H=x["*"]:g["*"]&&(H=Yn),H?C=C.concat(H({key:(o&&`${o}.`)+z,value:u[z],valueSpec:g[F]||g["*"],style:b,styleSpec:E,object:u,objectKey:z},u)):C.push(new s.K(o,u[z],`unknown property "${z}"`))}for(const z in g)x[z]||g[z].required&&g[z].default===void 0&&u[z]===void 0&&C.push(new s.V(o,u,`missing required property "${z}"`));return C}function Fi(m){const o=m.value,u=m.valueSpec,g=m.style,x=m.styleSpec,b=m.key,E=m.arrayElementValidator||Yn;if(s.J(o)!=="array")return[new s.V(b,o,`array expected, ${s.J(o)} found`)];if(u.length&&o.length!==u.length)return[new s.V(b,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new s.V(b,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let C={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};x.$version<7&&(C.function=u.function),s.J(u.value)==="object"&&(C=u.value);let M=[];for(let z=0;z<o.length;z++)M=M.concat(E({array:o,arrayIndex:z,value:o[z],valueSpec:C,style:g,styleSpec:x,key:`${b}[${z}]`},!0));return M}function Us(m){const o=m.key,u=m.value,g=m.valueSpec;let x=s.J(u);if(x==="number"&&u!=u&&(x="NaN"),x!=="number")return[new s.V(o,u,`number expected, ${x} found`)];if("minimum"in g){let b=g.minimum;if(s.J(g.minimum)==="array"&&(b=g.minimum[m.arrayIndex]),u<b)return[new s.V(o,u,`${u} is less than the minimum value ${b}`)]}if("maximum"in g){let b=g.maximum;if(s.J(g.maximum)==="array"&&(b=g.maximum[m.arrayIndex]),u>b)return[new s.V(o,u,`${u} is greater than the maximum value ${b}`)]}return[]}function ks(m){const o=m.valueSpec,u=s.M(m.value.type);let g,x,b,E={};const C=u!=="categorical"&&m.value.property===void 0,M=!C,z=s.J(m.value.stops)==="array"&&s.J(m.value.stops[0])==="array"&&s.J(m.value.stops[0][0])==="object",F=Mn({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(K){if(u==="identity")return[new s.V(K.key,K.value,'identity function may not have a "stops" property')];let te=[];const ee=K.value;return te=te.concat(Fi({key:K.key,value:ee,valueSpec:K.valueSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:H})),s.J(ee)==="array"&&ee.length===0&&te.push(new s.V(K.key,ee,"array must have at least one stop")),te},default:function(K){return Yn({key:K.key,value:K.value,valueSpec:o,style:K.style,styleSpec:K.styleSpec})}}});return u==="identity"&&C&&F.push(new s.V(m.key,m.value,'missing required property "property"')),u==="identity"||m.value.stops||F.push(new s.V(m.key,m.value,'missing required property "stops"')),u==="exponential"&&m.valueSpec.expression&&!s.N(m.valueSpec)&&F.push(new s.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(M&&!s.O(m.valueSpec)?F.push(new s.V(m.key,m.value,"property functions not supported")):C&&!s.Q(m.valueSpec)&&F.push(new s.V(m.key,m.value,"zoom functions not supported"))),u!=="categorical"&&!z||m.value.property!==void 0||F.push(new s.V(m.key,m.value,'"property" property is required')),F;function H(K){let te=[];const ee=K.value,re=K.key;if(s.J(ee)!=="array")return[new s.V(re,ee,`array expected, ${s.J(ee)} found`)];if(ee.length!==2)return[new s.V(re,ee,`array length 2 expected, length ${ee.length} found`)];if(z){if(s.J(ee[0])!=="object")return[new s.V(re,ee,`object expected, ${s.J(ee[0])} found`)];if(ee[0].zoom===void 0)return[new s.V(re,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new s.V(re,ee,"object stop key must have value")];const ie=s.M(ee[0].zoom);if(typeof ie!="number")return[new s.V(re,ee[0].zoom,"stop zoom values must be numbers")];if(b&&b>ie)return[new s.V(re,ee[0].zoom,"stop zoom values must appear in ascending order")];ie!==b&&(b=ie,x=void 0,E={}),te=te.concat(Mn({key:`${re}[0]`,value:ee[0],valueSpec:{zoom:{}},style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:Us,value:$}}))}else te=te.concat($({key:`${re}[0]`,value:ee[0],style:K.style,styleSpec:K.styleSpec},ee));return s.S(s.U(ee[1]))?te.concat([new s.V(`${re}[1]`,ee[1],"expressions are not allowed in function stops.")]):te.concat(Yn({key:`${re}[1]`,value:ee[1],valueSpec:o,style:K.style,styleSpec:K.styleSpec}))}function $(K,te){const ee=s.J(K.value),re=s.M(K.value),ie=K.value!==null?K.value:te;if(g){if(ee!==g)return[new s.V(K.key,ie,`${ee} stop domain type must match previous stop domain type ${g}`)]}else g=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new s.V(K.key,ie,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&u!=="categorical"){let ue=`number expected, ${ee} found`;return s.O(o)&&u===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(K.key,ie,ue)]}return u!=="categorical"||ee!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?u!=="categorical"&&ee==="number"&&typeof re=="number"&&typeof x=="number"&&x!==void 0&&re<x?[new s.V(K.key,ie,"stop domain values must appear in ascending order")]:(x=re,u==="categorical"&&re in E?[new s.V(K.key,ie,"stop domain values must be unique")]:(E[re]=!0,[])):[new s.V(K.key,ie,`integer expected, found ${String(re)}`)]}}function Wi(m){const o=(m.expressionContext==="property"?s.W:s.X)(s.U(m.value),m.valueSpec);if(o.result==="error")return o.value.map(g=>new s.V(`${m.key}${g.key}`,m.value,g.message));const u=o.value.expression||o.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!u.outputDefined())return[new s.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!s.Y(u))return[new s.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return Bi(u,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!s.Z(u,["zoom","feature-state"]))return[new s.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!s._(u))return[new s.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bi(m,o){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const x of o.valueSpec.expression.parameters)u.delete(x);if(u.size===0)return[];const g=[];return m instanceof s.$&&u.has(m.name)?[new s.V(o.key,o.value,`["${m.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(m.eachChild(x=>{g.push(...Bi(x,o))}),g)}function wo(m){const o=m.key,u=m.value,g=m.valueSpec,x=[];return Array.isArray(g.values)?g.values.indexOf(s.M(u))===-1&&x.push(new s.V(o,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(s.M(u))===-1&&x.push(new s.V(o,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),x}function vs(m){return s.a1(s.U(m.value))?Wi(s.L({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):$l(m)}function $l(m){const o=m.value,u=m.key;if(s.J(o)!=="array")return[new s.V(u,o,`array expected, ${s.J(o)} found`)];const g=m.styleSpec;let x,b=[];if(o.length<1)return[new s.V(u,o,"filter array must have at least 1 element")];switch(b=b.concat(wo({key:`${u}[0]`,value:o[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),s.M(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&s.M(o[1])==="$type"&&b.push(new s.V(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&b.push(new s.V(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(x=s.J(o[1]),x!=="string"&&b.push(new s.V(`${u}[1]`,o[1],`string expected, ${x} found`)));for(let E=2;E<o.length;E++)x=s.J(o[E]),s.M(o[1])==="$type"?b=b.concat(wo({key:`${u}[${E}]`,value:o[E],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&b.push(new s.V(`${u}[${E}]`,o[E],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let E=1;E<o.length;E++)b=b.concat($l({key:`${u}[${E}]`,value:o[E],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":x=s.J(o[1]),o.length!==2?b.push(new s.V(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):x!=="string"&&b.push(new s.V(`${u}[1]`,o[1],`string expected, ${x} found`))}return b}function kc(m,o){const u=m.key,g=m.style,x=m.layer,b=m.styleSpec,E=m.value,C=m.objectKey,M=b[`${o}_${m.layerType}`];if(!M)return[];const z=C.match(/^(.*)-use-theme$/);if(o==="paint"&&z&&M[z[1]])return s.S(E)?[].concat(Yn({key:m.key,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:b,expressionContext:"property",propertyType:o,propertyKey:C})):Yn({key:u,value:E,valueSpec:{type:"string"},style:g,styleSpec:b});const F=C.match(/^(.*)-transition$/);if(o==="paint"&&F&&M[F[1]]&&M[F[1]].transition)return Yn({key:u,value:E,valueSpec:b.transition,style:g,styleSpec:b});const H=m.valueSpec||M[C];if(!H)return[new s.K(u,E,`unknown property "${C}"`)];let $;if(s.J(E)==="string"&&s.O(H)&&!H.tokens&&($=/^{([^}]+)}$/.exec(E))){const te=`\`{ "type": "identity", "property": ${$?JSON.stringify($[1]):'"_"'} }\``;return[new s.V(u,E,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${te}.`)]}const K=[];if(m.layerType==="symbol")C!=="text-field"||!g||g.glyphs||g.imports||K.push(new s.V(u,E,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&s.a2(s.U(E))&&s.M(E.type)==="identity"&&K.push(new s.V(u,E,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&o==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&s.O(H)&&(s.a3(H)||s.Q(H))){const te=s.W(s.U(E),H),ee=te.value.expression||te.value._styleExpression.expression;ee&&!s.Z(ee,["measure-light"])&&(C==="model-emissive-strength"&&s._(ee)&&s.Y(ee)||K.push(new s.V(u,E,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return K.concat(Yn({key:m.key,value:E,valueSpec:H,style:g,styleSpec:b,expressionContext:"property",propertyType:o,propertyKey:C}))}function Pi(m){return kc(m,"paint")}function xs(m){return kc(m,"layout")}function ju(m){let o=[];const u=m.value,g=m.key,x=m.style,b=m.styleSpec;u.type||u.ref||o.push(new s.V(g,u,'either "type" or "ref" is required'));let E=s.M(u.type);const C=s.M(u.ref);if(u.id){const M=s.M(u.id);for(let z=0;z<m.arrayIndex;z++){const F=x.layers[z];s.M(F.id)===M&&o.push(new s.V(g,u.id,`duplicate layer id "${u.id}", previously used at line ${F.id.__line__}`))}}if("ref"in u){let M;["type","source","source-layer","filter","layout"].forEach(z=>{z in u&&o.push(new s.V(g,u[z],`"${z}" is prohibited for ref layers`))}),x.layers.forEach(z=>{s.M(z.id)===C&&(M=z)}),M?M.ref?o.push(new s.V(g,u.ref,"ref cannot reference another ref layer")):E=s.M(M.type):typeof C=="string"&&o.push(new s.V(g,u.ref,`ref layer "${C}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(u.source){const M=x.sources&&x.sources[u.source],z=M&&s.M(M.type);M?z==="vector"&&E==="raster"?o.push(new s.V(g,u.source,`layer "${u.id}" requires a raster source`)):z==="raster"&&E!=="raster"?o.push(new s.V(g,u.source,`layer "${u.id}" requires a vector source`)):z!=="vector"||u["source-layer"]?z==="raster-dem"&&E!=="hillshade"?o.push(new s.V(g,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&u.paint&&(u.paint["line-gradient"]||u.paint["line-trim-offset"])&&z==="geojson"&&!M.lineMetrics?o.push(new s.V(g,u,`layer "${u.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&z!=="raster-array"&&o.push(new s.V(g,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):o.push(new s.V(g,u.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new s.V(g,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new s.V(g,u.source,`source "${u.source}" not found`))}else o.push(new s.V(g,u,'missing required property "source"'));return o=o.concat(Mn({key:g,value:u,valueSpec:b.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Yn({key:`${g}.type`,value:u.type,valueSpec:b.layer.type,style:m.style,styleSpec:m.styleSpec,object:u,objectKey:"type"}),filter:M=>vs(s.L({layerType:E},M)),layout:M=>Mn({layer:u,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":z=>xs(s.L({layerType:E},z))}}),paint:M=>Mn({layer:u,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":z=>Pi(s.L({layerType:E,layer:u},z))}})}})),o}function Xa(m){const o=m.value,u=m.key,g=s.J(o);return g!=="string"?[new s.V(u,o,`string expected, ${g} found`)]:[]}const Ya={promoteId:function m({key:o,value:u}){if(s.J(u)==="string")return Xa({key:o,value:u});if(Array.isArray(u)){const g=[],x=s.U(u),b=s.X(x);return b.result==="error"&&b.value.forEach(E=>{g.push(new s.V(`${o}${E.key}`,null,`${E.message}`))}),s.Z(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new s.V(`${o}`,null,"promoteId expression should be only feature dependent")),g}{const g=[];for(const x in u)g.push(...m({key:`${o}.${x}`,value:u[x]}));return g}}};function Ps(m){const o=m.value,u=m.key,g=m.styleSpec,x=m.style;if(!o.type)return[new s.V(u,o,'"type" is required')];const b=s.M(o.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(o.url||o.tiles||E.push(new s.K(u,o,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Mn({key:u,value:o,valueSpec:g[`source_${b.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:Ya})),E;case"geojson":if(E=Mn({key:u,value:o,valueSpec:g.source_geojson,style:x,styleSpec:g,objectElementValidators:Ya}),o.cluster)for(const C in o.clusterProperties){const[M,z]=o.clusterProperties[C],F=typeof M=="string"?[M,["accumulated"],["get",C]]:M;E.push(...Wi({key:`${u}.${C}.map`,value:z,expressionContext:"cluster-map"})),E.push(...Wi({key:`${u}.${C}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return E;case"video":return Mn({key:u,value:o,valueSpec:g.source_video,style:x,styleSpec:g});case"image":return Mn({key:u,value:o,valueSpec:g.source_image,style:x,styleSpec:g});case"canvas":return[new s.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wo({key:`${u}.type`,value:o.type,valueSpec:{values:oo(g)}})}}function oo(m){return m.source.reduce((o,u)=>{const g=m[u];return g.type.type==="enum"&&(o=o.concat(Object.keys(g.type.values))),o},[])}function Ta(m){const o=m.value,u=m.styleSpec,g=u.light,x=m.style;let b=[];const E=s.J(o);if(o===void 0)return b;if(E!=="object")return b=b.concat([new s.V("light",o,`object expected, ${E} found`)]),b;for(const C in o){const M=C.match(/^(.*)-transition$/),z=C.match(/^(.*)-use-theme$/);b=b.concat(z&&g[z[1]]?Yn({key:C,value:o[C],valueSpec:{type:"string"},style:x,styleSpec:u}):M&&g[M[1]]&&g[M[1]].transition?Yn({key:C,value:o[C],valueSpec:u.transition,style:x,styleSpec:u}):g[C]?Yn({key:C,value:o[C],valueSpec:g[C],style:x,styleSpec:u}):[new s.V(C,o[C],`unknown property "${C}"`)])}return b}function ao(m){const o=m.value;let u=[];if(!o)return u;const g=s.J(o);if(g!=="object")return u=u.concat([new s.V("light-3d",o,`object expected, ${g} found`)]),u;const x=m.styleSpec,b=x["light-3d"],E=m.key,C=m.style,M=m.style.lights;for(const H of["type","id"])if(!(H in o))return u=u.concat([new s.V("light-3d",o,`missing property ${H} on light`)]),u;if(o.type&&M)for(let H=0;H<m.arrayIndex;H++){const $=s.M(o.type),K=M[H];s.M(K.type)===$&&u.push(new s.V(E,o.id,`duplicate light type "${o.type}", previously defined at line ${K.id.__line__}`))}const z=`properties_light_${o.type}`;if(!(z in x))return u=u.concat([new s.V("light-3d",o,`Invalid light type ${o.type}`)]),u;const F=x[z];for(const H in o)if(H==="properties"){const $=o[H],K=s.J($);if(K!=="object")return u=u.concat([new s.V("properties",$,`object expected, ${K} found`)]),u;for(const te in $){const ee=te.match(/^(.*)-transition$/),re=te.match(/^(.*)-use-theme$/);u=u.concat(re&&F[re[1]]?Yn({key:H,value:$[te],valueSpec:{type:"string"},style:C,styleSpec:x}):ee&&F[ee[1]]&&F[ee[1]].transition?Yn({key:H,value:o[H],valueSpec:x.transition,style:C,styleSpec:x}):F[te]?Yn({key:te,value:$[te],valueSpec:F[te],style:C,styleSpec:x}):[new s.K(m.key,$[te],`unknown property "${te}"`)])}}else u=u.concat(b[H]?Yn({key:H,value:o[H],valueSpec:b[H],style:C,styleSpec:x}):[new s.K(H,o[H],`unknown property "${H}"`)]);return u}function Ja(m){const o=m.value,u=m.key,g=m.style,x=m.styleSpec,b=x.terrain;let E=[];const C=s.J(o);if(o===void 0||C==="null")return E;if(C!=="object")return E=E.concat([new s.V("terrain",o,`object expected, ${C} found`)]),E;for(const M in o){const z=M.match(/^(.*)-transition$/),F=M.match(/^(.*)-use-theme$/);E=E.concat(F&&b[F[1]]?Yn({key:M,value:o[M],valueSpec:{type:"string"},style:g,styleSpec:x}):z&&b[z[1]]&&b[z[1]].transition?Yn({key:M,value:o[M],valueSpec:x.transition,style:g,styleSpec:x}):b[M]?Yn({key:M,value:o[M],valueSpec:b[M],style:g,styleSpec:x}):[new s.K(M,o[M],`unknown property "${M}"`)])}if(o.source){const M=g.sources&&g.sources[o.source],z=M&&s.M(M.type);M?z!=="raster-dem"&&E.push(new s.V(u,o.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):E.push(new s.V(u,o.source,`source "${o.source}" not found`))}else E.push(new s.V(u,o,'terrain is missing required property "source"'));return E}function So(m){const o=m.value,u=m.style,g=m.styleSpec,x=g.fog;let b=[];const E=s.J(o);if(o===void 0)return b;if(E!=="object")return b=b.concat([new s.V("fog",o,`object expected, ${E} found`)]),b;for(const C in o){const M=C.match(/^(.*)-transition$/),z=C.match(/^(.*)-use-theme$/);b=b.concat(z&&x[z[1]]?Yn({key:C,value:o[C],valueSpec:{type:"string"},style:u,styleSpec:g}):M&&x[M[1]]&&x[M[1]].transition?Yn({key:C,value:o[C],valueSpec:g.transition,style:u,styleSpec:g}):x[C]?Yn({key:C,value:o[C],valueSpec:x[C],style:u,styleSpec:g}):[new s.K(C,o[C],`unknown property "${C}"`)])}return b}const Pc={"*":()=>[],array:Fi,boolean:function(m){const o=m.value,u=m.key,g=s.J(o);return g!=="boolean"?[new s.V(u,o,`boolean expected, ${g} found`)]:[]},number:Us,color:function(m){const o=m.key,u=m.value,g=s.J(u);return g!=="string"?[new s.V(o,u,`color expected, ${g} found`)]:s.a0.parseCSSColor(u)===null?[new s.V(o,u,`color expected, "${u}" found`)]:[]},enum:wo,filter:vs,function:ks,layer:ju,object:Mn,source:Ps,model:s.a4,light:Ta,"light-3d":ao,terrain:Ja,fog:So,string:Xa,formatted:function(m){return Xa(m).length===0?[]:Wi(m)},resolvedImage:function(m){return Xa(m).length===0?[]:Wi(m)},projection:function(m){const o=m.value,u=m.styleSpec,g=u.projection,x=m.style;let b=[];const E=s.J(o);if(E==="object")for(const C in o)b=b.concat(Yn({key:C,value:o[C],valueSpec:g[C],style:x,styleSpec:u}));else E!=="string"&&(b=b.concat([new s.V("projection",o,`object or string expected, ${E} found`)]));return b},import:function(m){const{value:o,styleSpec:u}=m,{data:g,...x}=o;Object.defineProperty(x,"__line__",{value:o.__line__,enumerable:!1});let b=Mn(s.L({},m,{value:x,valueSpec:u.import}));return s.M(x.id)===""&&b.push(new s.V(`${m.key}.id`,x,"import id can't be an empty string")),g&&(b=b.concat(Ic(g,u,{key:`${m.key}.data`}))),b},iconset:function(m){const o=m.value,u=m.key,g=m.styleSpec,x=m.style;if(!o.type)return[new s.V(u,o,'"type" is required')];const b=s.M(o.type);let E=[];if(E=E.concat(Mn({key:u,value:o,valueSpec:g[`iconset_${b}`],style:x,styleSpec:g})),b==="source"&&o.source){const C=x.sources&&x.sources[o.source],M=C&&s.M(C.type);C?M!=="raster-array"&&E.push(new s.V(u,o.source,`iconset cannot be used with a source of type ${String(M)}, it only be used with a "raster-array" source type`)):E.push(new s.V(u,o.source,`source "${o.source}" not found`))}return E}};function Yn(m,o=!1){const u=m.value,g=m.valueSpec,x=m.styleSpec;if(g.expression&&s.a2(s.M(u)))return ks(m);if(g.expression&&s.S(s.U(u)))return Wi(m);if(g.type&&Pc[g.type]){const b=Pc[g.type](m);return o===!0&&b.length>0&&s.J(m.value)==="array"?Wi(m):b}return Mn(s.L({},m,{valueSpec:g.type?x[g.type]:g}))}function Cc(m){const o=m.value,u=m.key,g=Xa(m);return g.length||(o.indexOf("{fontstack}")===-1&&g.push(new s.V(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&g.push(new s.V(u,o,'"glyphs" url must include a "{range}" token'))),g}function Ic(m,o=s.a5,u={}){return Yn({key:u.key||"",value:m,valueSpec:o.$root,styleSpec:o,style:m,objectElementValidators:{glyphs:Cc,"*":()=>[]}})}function To(m,o=s.a5){return Me(Ic(m,o))}const Gl=m=>Me(Ps(m)),Ea=m=>Me(Ta(m)),Mc=m=>Me(ao(m)),ut=m=>Me(Ja(m)),qn=m=>Me(So(m)),Ci=m=>Me(function(o){const u=o.value,g=o.style,x=o.styleSpec,b=x.snow;let E=[];const C=s.J(u);if(u===void 0)return E;if(C!=="object")return E=E.concat([new s.V("snow",u,`object expected, ${C} found`)]),E;for(const M in u){const z=M.match(/^(.*)-transition$/);E=E.concat(z&&b[z[1]]&&b[z[1]].transition?Yn({key:M,value:u[M],valueSpec:x.transition,style:g,styleSpec:x}):b[M]?Yn({key:M,value:u[M],valueSpec:b[M],style:g,styleSpec:x}):[new s.K(M,u[M],`unknown property "${M}"`)])}return E}(m)),$s=m=>Me(function(o){const u=o.value,g=o.style,x=o.styleSpec,b=x.rain;let E=[];const C=s.J(u);if(u===void 0)return E;if(C!=="object")return E=E.concat([new s.V("rain",u,`object expected, ${C} found`)]),E;for(const M in u){const z=M.match(/^(.*)-transition$/);E=E.concat(z&&b[z[1]]&&b[z[1]].transition?Yn({key:M,value:u[M],valueSpec:x.transition,style:g,styleSpec:x}):b[M]?Yn({key:M,value:u[M],valueSpec:b[M],style:g,styleSpec:x}):[new s.K(M,u[M],`unknown property "${M}"`)])}return E}(m)),Br=m=>Me(ju(m)),He=m=>Me(vs(m)),se=m=>Me(Pi(m)),ce=m=>Me(xs(m)),ye=m=>Me(s.a4(m));function Me(m){return m.slice().sort((o,u)=>o.line&&u.line?o.line-u.line:0)}function xe(m,o){let u=!1;if(o&&o.length)for(const g of o)g instanceof s.K?s.w(g.message):(m.fire(new s.z(new Error(g.message))),u=!0);return u}let Fe;class et extends s.E{constructor(o,u="flat"){super(),this._transitionable=new s.a6(Fe||(Fe=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(o,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u,g={}){this._validate(Ea,o,g)||(this._transitionable.setTransitionOrValue(o),this.id=u)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||g.validate!==!1)&&xe(this,o.call(To,s.h({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Ve=class extends s.E{constructor(m,o,u,g,x){super(),this.scope=u,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),u,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=x}get(){return this._transitionable.serialize()}set(m,o){this._transitionable.setTransitionOrValue(m,o)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new s.aa(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const o=m.value.expression;if(!o)return null;let u=-1,g=-1,x=1;for(const b of o.zoomStops)x=o.evaluate(new s.aa(b,{worldview:this.worldview})),x>.01?(u=b,g=-1):g=b;return x<.01&&u>0&&g>u?[u,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof s.ab}};const Qe=45,Ot=65,gt=.05;function ar(m,o,u,g){const x=s.af(Qe,Ot,u),[b,E]=_r(m,g);let C=1-Math.min(1,Math.exp((o-b)/(E-b)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*x*m.alpha}function _r(m,o){const u=.5/Math.tan(.5*o);return[m.range[0]+u,m.range[1]+u]}function Tr(m,o,u,g,x){const b=s.ad([],[o,u,g],x.mercatorFogMatrix);return ar(m,s.ae(b),x.pitch,x._fov)}function Gr(m,o,u,g,x,b,E){const C=[[u,g,0],[x,g,0],[x,b,0],[u,b,0]];let M=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const F of C){const H=s.ad([],F,o),$=s.ae(H);M=Math.min(M,$),z=Math.max(z,$)}return[ar(m,M,E.pitch,E._fov),ar(m,z,E.pitch,E._fov)]}class zr extends s.E{constructor(o,u,g,x){super();const b=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(b,g,new Map(x)),this.set(o,x),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new s.ag(b),this.scope=g}get state(){const o=this._transform,u=o.projection.name==="globe",g=s.ah(o.zoom),x=this.properties.get("range"),b=[.5,3];return{range:u?[s.ai(b[0],x[0],g),s.ai(b[1],x[1],g)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,u,g={}){if(this._validate(qn,o,g))return;const x=s.h({},o);for(const b of Object.keys(s.a5.fog))x[b]===void 0&&(x[b]=s.a5.fog[b].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.af(Qe,Ot,o))*u.a}getOpacityAtLatLng(o,u){return this._transform.projection.supportsFog?function(g,x,b){const E=s.ac.fromLngLat(x),C=b.elevation?b.elevation.getAtPointOrZero(E):0;return Tr(g,E.x,E.y,C,b)}(this.state,o,u):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Gr(this.state,u,0,0,s.aj,s.aj,this._transform)}getOpacityForBounds(o,u,g,x,b){return this._transform.projection.supportsFog?Gr(this.state,o,u,g,x,b,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?_r(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const g of u){const x=o.points[g];let b;if(x[2]>=0)b=x;else{const E=o.points[g-4];b=s.ak(E,x,E[2]/(E[2]-x[2]))}if(Tr(this.state,b[0],b[1],0,this._transform)>=gt)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||g.validate!==!1)&&xe(this,o.call(To,s.h({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Wr,Vn,qr,Ti,ts=class extends s.E{constructor(m,o,u,g){super();const x=Wr||(Wr=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(x,u,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(x),this.scope=u}get state(){const m=this.properties.get("opacity"),o=this.properties.get("color"),u=this.properties.get("direction"),g=s.al(u[0]),x=-Math.max(s.al(u[1]),.01),b=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(o.r,o.g,o.b,o.a*m),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(m,o,u={}){if(this._validate(Ci,m,u))return;const g=s.h({},m);for(const x of Object.keys(s.a5.snow))g[x]===void 0&&(g[x]=s.a5.snow[x].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,o,u){return(!u||u.validate!==!1)&&xe(this,m.call(To,s.h({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},qi=class extends s.E{constructor(m,o,u,g){super();const x=Vn||(Vn=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(x,u,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(x),this.scope=u}get state(){const m=this.properties.get("opacity"),o=this.properties.get("color"),u=this.properties.get("direction"),g=s.al(u[0]),x=-Math.max(s.al(u[1]),.01),b=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(o.r,o.g,o.b,o.a*m),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(m,o,u={}){if(this._validate($s,m,u))return;const g=s.h({},m);for(const x of Object.keys(s.a5.rain))g[x]===void 0&&(g[x]=s.a5.rain[x].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,o,u){return(!u||u.validate!==!1)&&xe(this,m.call(To,s.h({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class Dn extends s.E{constructor(o,u,g,x){super(),this.scope=g,this._options=o,this.properties=new s.ag(u),this._transitionable=new s.a6(u,g,new Map(x)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,u){this._options=o,this._transitionable.setTransitionOrValue(o.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class pn{constructor(o,u,g){this.screenBounds=o,this.cameraPoint=g.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(o,u){let g,x;if(o instanceof s.P||typeof o[0]=="number"){const b=s.P.convert(o);g=[b],x=u.isPointAboveHorizon(b)}else{const b=s.P.convert(o[0]),E=s.P.convert(o[1]),C=b.add(E)._div(2);g=[b,E],x=s.ao(b,E).every(M=>u.isPointAboveHorizon(M))&&u.isPointAboveHorizon(C)}return new pn(g,x,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return s.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.ao(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(x[3]=this.cameraPoint)),s.ap(x,o)}bufferedCameraGeometryGlobe(o){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.ao(u,g,o),b=this.cameraPoint.clone();switch(3*((b.y>u.y)+(b.y>g.y))+((b.x>u.x)+(b.x>g.x))){case 0:x[0]=b,x[4]=b.clone();break;case 1:x.splice(1,0,b);break;case 2:x[1]=b;break;case 3:x.splice(4,0,b);break;case 5:x.splice(2,0,b);break;case 6:x[3]=b;break;case 7:x.splice(3,0,b);break;case 8:x[2]=b}return x}containsTile(o,u,g,x=0){const b=o.queryPadding/u._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(b,u):this._bufferedScreenMercator(b,u);let C=o.tileID.wrap+(E.unwrapped?x:0);const M=E.polygon.map(re=>s.aq(o.tileTransform,re,C));if(!s.ar(M,0,0,s.aj,s.aj))return;C=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const z=this.screenGeometryMercator.polygon.map(re=>s.as(o.tileTransform,re,C)),F=z.map(re=>new s.P(re[0],re[1])),H=u.getFreeCameraOptions().position||new s.ac(0,0,0),$=s.as(o.tileTransform,H,C),K=z.map(re=>{const ie=s.at(re,re,$);return s.au(ie,ie),new s.av($,ie)}),te=s.aw(o,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:K,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(ee=s.ax(M),ee.min.x=s.ay(ee.min.x,0,s.aj),ee.min.y=s.ay(ee.min.y,0,s.aj),ee.max.x=s.ay(ee.max.x,0,s.aj),ee.max.y=s.ay(ee.max.y,0,s.aj),ee),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:te};var ee}_bufferedScreenMercator(o,u){const g=ci(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),u):{polygon:this.bufferedScreenGeometry(o).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(o,u){const g=ci(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),u):{polygon:this.bufferedCameraGeometry(o).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=x,x}}_projectAndResample(o,u){const g=function(b,E){const C=s.az([],E.pixelMatrix,E.globeMatrix),M=[0,-s.aB,0,1],z=[0,s.aB,0,1],F=[0,0,0,1];s.aA(M,M,C),s.aA(z,z,C),s.aA(F,F,C);const H=new s.P(M[0]/M[3],M[1]/M[3]),$=new s.P(z[0]/z[3],z[1]/z[3]),K=s.aC(b,H)&&M[3]<F[3],te=s.aC(b,$)&&z[3]<F[3];if(!K&&!te)return null;const ee=function(Ce,be,Se){for(let Ee=1;Ee<Ce.length;Ee++){const Ue=pi(be.pointCoordinate3D(Ce[Ee-1]).x),De=pi(be.pointCoordinate3D(Ce[Ee]).x);if(Se<0){if(Ue<De)return{idx:Ee,t:-Ue/(De-1-Ue)}}else if(De<Ue)return{idx:Ee,t:(1-Ue)/(De+1-Ue)}}return null}(b,E,K?-1:1);if(!ee)return null;const{idx:re,t:ie}=ee;let ue=re>1?bi(b.slice(0,re),E):[],pe=re<b.length?bi(b.slice(re),E):[];ue=ue.map(Ce=>new s.P(pi(Ce.x),Ce.y)),pe=pe.map(Ce=>new s.P(pi(Ce.x),Ce.y));const me=[...ue];me.length===0&&me.push(pe[pe.length-1]);const Te=s.ai(me[me.length-1].y,(pe.length===0?ue[0]:pe[0]).y,ie);let we;return we=K?[new s.P(0,Te),new s.P(0,0),new s.P(1,0),new s.P(1,Te)]:[new s.P(1,Te),new s.P(1,1),new s.P(0,1),new s.P(0,Te)],me.push(...we),pe.length===0?me.push(ue[0]):me.push(...pe),{polygon:me.map(Ce=>new s.ac(Ce.x,Ce.y)),unwrapped:!1}}(o,u);if(g)return g;const x=function(b,E){let C=!1,M=-1/0,z=0;for(let H=0;H<b.length-1;H++)b[H].x>M&&(M=b[H].x,z=H);for(let H=0;H<b.length-1;H++){const $=(z+H)%(b.length-1),K=b[$],te=b[$+1];Math.abs(K.x-te.x)>.5&&(K.x<te.x?(K.x+=1,$===0&&(b[b.length-1].x+=1)):(te.x+=1,$+1===b.length-1&&(b[0].x+=1)),C=!0)}const F=s.aD(E.center.lng);return C&&F<Math.abs(F-1)&&b.forEach(H=>{H.x-=1}),{polygon:b,unwrapped:C}}(bi(o,u).map(b=>new s.P(pi(b.x),b.y)),u);return{polygon:x.polygon.map(b=>new s.ac(b.x,b.y)),unwrapped:x.unwrapped}}}function bi(m,o){return s.aE(m,u=>{const g=o.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function pi(m){return m<0?1+m%1:m%1}function ci(m){return 100*m|0}function bs(m,o,u,g,x){const b=function(C,M){if(C)return x(C);if(M){if(m.url&&M.tiles&&m.tiles&&delete m.tiles,M.variants){if(!Array.isArray(M.variants))return x(new Error("variants must be an array"));for(const F of M.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return x(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){M=s.h(M,F);break}}}const z=s.aF(s.h({},M,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=o.canonicalizeTileset(z,m.url),x(null,z)}},E=function(C,M,z){if(!C)return null;if(!M&&!z)return C;z=z||C.worldview_default;const F=Object.values(C.language||{});if(F.length===0)return null;const H=Object.values(C.worldview||{});if(H.length===0)return null;const $=F.every(te=>te===M),K=H.every(te=>te===z);return $&&K?C:M in(C.language_options||{})||z in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(m.data,u,g);return E?s.q.frame(()=>b(null,E)):m.url?s.n(o.transformRequest(o.normalizeSourceURL(m.url,null,u,g),s.R.Source),b):s.q.frame(()=>{const{data:C,...M}=m;b(null,M)})}function Eo(m,o){const u=Math.pow(2,o.z),g=Math.floor(s.aD(m.getWest())*u),x=Math.floor(s.aH(m.getNorth())*u),b=Math.ceil(s.aD(m.getEast())*u),E=Math.ceil(s.aH(m.getSouth())*u);return o.x>=g&&o.x<b&&o.y>=x&&o.y<E}class Gs{constructor(o,u,g){this.bounds=o?s.aG.convert(this.validateBounds(o)):null,this.minzoom=u||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const u of o)this.extraBounds.push(s.aG.convert(this.validateBounds(u)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!Eo(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const u of this.extraBounds)if(Eo(u,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const u=new Gs(o.bounds,o.minzoom,o.maxzoom);return u.addExtraBounds(o.extra_bounds),u}}class Mf extends s.E{constructor(o,u,g,x){if(super(),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.h(this,s.aF(u,["url","scheme","tileSize","promoteId"])),this._options=s.h({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new s.aI}load(o){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=bs(this._options,this.map._requestManager,u,g,(x,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new s.z(x));else if(b){if(s.h(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of b.vector_layers)this.vectorLayerIds.push(E.id),b.worldview&&b.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=Gs.fromTileJSON(b),ct(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}o&&o(x)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}loadTile(o,u){const g=o.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(g),b=this.map._requestManager.transformRequest(x,s.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,C=E?{image:E.image.clone()}:null,M={request:b,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&s.j(g)&&(M.localizableLayerIds=this.localizableLayerIds),M.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=u:o.request=o.actor.send("reloadTile",M,z.bind(this));else if(o.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",M,z.bind(this),void 0,!0);else{const F=s.aJ.call({deduped:this._deduped},M,(H,$)=>{H||!$?z.call(this,H):(M.data={cacheControl:$.cacheControl,expires:$.expires,rawData:$.rawData.slice(0)},o.actor&&o.actor.send("loadTile",M,z.bind(this),void 0,!0))},!0);o.request={cancel:F}}function z(F,H){return delete o.request,o.aborted?u(null):F&&F.status!==404?u(F):(H&&H.resourceTiming&&(o.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&o.setExpiryData(H),o.loadVectorData(H,this.map.painter),s.aK(this.dispatcher),u(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,u){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Cs extends s.E{constructor(o,u,g,x){super(),this.id=o,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.h({type:"raster"},u),s.h(this,s.aF(u,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const u=this.map.getWorldview();this._tileJSONRequest=bs(this._options,this.map._requestManager,null,u,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new s.z(g)):x&&(s.h(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=Gs.fromTileJSON(x),ct(x.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),o&&o(g)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,u){const g=s.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=s.o(this.map._requestManager.transformRequest(x,s.R.Tile),(b,E,C,M)=>(delete o.request,o.aborted?(o.state="unloaded",u(null)):b?(o.state="errored",u(b)):E?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:C,expires:M}),o.setTexture(E,this.map.painter),o.state="loaded",s.aK(this.dispatcher),void u(null)):u(null)))}abortTile(o,u){o.request&&(o.request.cancel(),delete o.request),u&&u()}unloadTile(o,u){o.texture&&o.texture instanceof s.T?(o.destroy(!0),o.texture&&o.texture instanceof s.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Oc extends Cs{constructor(o,u,g,x){super(o,u,g,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.h({type:"raster-array"},u)}triggerRepaint(o){const u=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);u&&u.enabled&&g&&u._clearRenderCacheForTile(g.id,o.tileID),this.map.triggerRepaint()}loadTile(o,u){const g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(g,s.R.Tile),b={request:x,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=x,o.actor||(o.actor=this.dispatcher.getActor());const E=(C,M,z,F)=>{if(delete o.request,o.aborted)return o.state="unloaded",u(null);if(C)return C.name==="AbortError"?void 0:(o.state="errored",u(C));if(this.map._refreshExpiredTiles&&M&&o.setExpiryData({cacheControl:z,expires:F}),this.partial)o.state="empty";else{if(!M)return u(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=M}u(null)};o.request=this.partial?o.fetchHeader(void 0,E.bind(this)):o.actor.send("loadTile",b,E.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,u){const g=o.texturePerLayer;if(o.flushAllQueues(),g.size){o.destroy(!0);for(const x of g.values())this.map.painter.saveTileTexture(x)}else o.destroy()}prepareTile(o,u,g,x){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBand(u,g,x,(b,E)=>{if(b)return o.state="errored",this.fire(new s.z(b)),void this.triggerRepaint(o);E&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(g,E,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:b})=>b===o),g=u&&u.fields,x=g&&g.bands&&g.bands;return x?x[0]:0}getTextureDescriptor(o,u,g){if(!o)return;const x=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let b=null;u instanceof s.aN?b=u.paint.get("raster-array-band"):u instanceof s.aO&&(b=u.paint.get("raster-particle-array-band"));const E=b||this.getInitialBand(x);if(E==null)return;if(!o.textureDescriptorPerLayer.get(u.id))return void this.prepareTile(o,x,u.id,E);if(o.updateNeeded(u.id,E)&&!g)return;const C=o.textureDescriptorPerLayer.get(u.id);return Object.assign({},C,{texture:o.texturePerLayer.get(u.id)})}getImages(o,u){const g=new Map;for(const x of o)for(const b of u){const[E,C]=b.split("/"),M=x.getLayer(E);if(!M||!M.hasBand(C)||!M.hasDataForBand(C))continue;const{bytes:z,tileSize:F,buffer:H}=M.getBandView(C),$=F+2*H,K={data:new s.r({width:$,height:$},z),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(b,K)}return g}}const Bm={vector:Mf,raster:Cs,"raster-dem":class extends Cs{constructor(m,o,u,g){super(m,o,u,g),this.type="raster-dem",this.maxzoom=22,this._options=s.h({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(m,o){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,b){x&&(m.state="errored",o(x)),b&&(m.dem=b,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",o(null))}m.request=s.o(this.map._requestManager.transformRequest(u,s.R.Tile),function(x,b,E,C){if(delete m.request,m.aborted)m.state="unloaded",o(null);else if(x)m.state="errored",o(x);else if(b){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:E,expires:C});const M=ImageBitmap&&b instanceof ImageBitmap&&s.t(),z=1-(b.width-s.aL(b.width))/2;z<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const F=M?b:s.q.getImageData(b,z),H={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:z};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",H,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const o=m.canonical,u=Math.pow(2,o.z),g=(o.x-1+u)%u,x=o.x===0?m.wrap-1:m.wrap,b=(o.x+1+u)%u,E=o.x+1===u?m.wrap+1:m.wrap,C={};return C[new s.aM(m.overscaledZ,x,o.z,g,o.y).key]={backfilled:!1},C[new s.aM(m.overscaledZ,E,o.z,b,o.y).key]={backfilled:!1},o.y>0&&(C[new s.aM(m.overscaledZ,x,o.z,g,o.y-1).key]={backfilled:!1},C[new s.aM(m.overscaledZ,m.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},C[new s.aM(m.overscaledZ,E,o.z,b,o.y-1).key]={backfilled:!1}),o.y+1<u&&(C[new s.aM(m.overscaledZ,x,o.z,g,o.y+1).key]={backfilled:!1},C[new s.aM(m.overscaledZ,m.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},C[new s.aM(m.overscaledZ,E,o.z,b,o.y+1).key]={backfilled:!1}),C}},"raster-array":Oc,geojson:class extends s.E{constructor(m,o,u,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=o.data,this._options=s.h({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const x=s.aj/this.tileSize;this.workerOptions=s.h({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*x,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*x,extent:s.aj,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.aj,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*x,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const u of this._data.features)o.set(u.id,u);for(const u of m.features)o.set(u.id,u);this._data.features=[...o.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},o),this}getClusterChildren(m,o){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},o),this}getClusterLeaves(m,o,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:o,offset:u},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const o=s.h({append:m},this.workerOptions);o.scope=this.scope;const u=this._data;typeof u=="string"?(o.request=this.map._requestManager.transformRequest(s.q.resolveURL(u),s.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(g,x)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new s.z(g));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(b.resourceTiming=x.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new s.A("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=s.C(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,o){const u=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,x=g?{image:g.image.clone()}:null,b=this._partialReload,E={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview()};m.request=this.actor.send(u,E,(C,M)=>b&&!M?(m.state="loaded",o(null)):(delete m.request,m.destroy(),m.aborted?o(null):C?o(C):(m.loadVectorData(M,this.map.painter,u==="reloadTile"),o(null))),void 0,u==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,o){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aP{constructor(m,o,u,g){super(m,o,u,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const o of m.urls)this.urls.push(this.map._requestManager.transformRequest(o,s.R.Source).url);s.aQ(this.urls,(o,u)=>{this._loaded=!0,o?this.fire(new s.z(o)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const o=this.video.seekable;m<o.start(0)||m>o.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,o=m.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(m,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aP,model:class extends s.E{constructor(m,o,u,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){const m=[];for(const o in this._options.models){const u=this._options.models[o],g=s.aS(this.map._requestManager.transformRequest(u.uri,s.R.Model).url).then(x=>{if(!x)return;const b=s.aT(x),E=new s.aU(o,u.position,u.orientation,b);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(x=>{this.fire(new s.z(new Error(`Could not load model ${o} from ${u.uri}: ${x.message}`)))});m.push(g)}Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this._loaded=!0,this.fire(new s.z(new Error(`Could not load models: ${o.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,o){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(m,o,u,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=bs(this._options,this.map._requestManager,o,u,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new s.z(g))):x&&(s.h(this,x),x.bounds&&(this.tileBounds=new Gs(x.bounds,this.minzoom,this.maxzoom)),ct(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,o){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,s.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=o;else{if(m.buckets){const b=Object.values(m.buckets);for(const E of b)E.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,x.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,x.bind(this),void 0,!0);function x(b,E){return m.aborted?o(null):b&&b.status!==404?o(b):(this.map._refreshExpiredTiles&&E&&m.setExpiryData(E),m.loadModelData(E,this.map.painter),m.state="loaded",void o(null))}}serialize(){return s.h({},this._options)}},canvas:class extends s.aP{constructor(m,o,u,g){super(m,o,u,g),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(b=>typeof b!="number"))||this.fire(new s.z(new s.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${m}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof s.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends s.E{constructor(m,o,u,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Gs(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),s.h(this,s.aF(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:o,y:u,z:g}=m.canonical;return this._implementation.hasTile({x:o,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,o){const{x:u,y:g,z:x}=m.tileID.canonical,b=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:u,y:g,z:x},{signal:b.signal})).then(function(E){return delete m.request,m.aborted?(m.state="unloaded",o(null)):E===void 0?(m.state="errored",o(null)):E===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(E)?(this.loadTileData(m,E),m.state="loaded",void o(null)):(m.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(E=>{E.name!=="AbortError"&&(m.state="errored",o(E))}),m.request.cancel=()=>b.abort()}loadTileData(m,o){m.setTexture(o,this.map.painter)}unloadTile(m,o){if(m.texture&&m.texture instanceof s.T?(m.destroy(!0),m.texture&&m.texture instanceof s.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:u,y:g,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:x})}o&&o()}abortTile(m,o){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=s.C(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},Of=function(m,o,u,g){const x=new Bm[o.type](m,o,u,g);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return s.aV(["load","abort","unload","serialize","prepare"],x),x};function jf(m,o,u=""){return`${u}:${o.id||""}:${o.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:x,importId:b}=g;return`featureset:${x}${b?`:import:${b}`:""}`}}(m.target)}`}function Vm(m,o,u,g=""){if(m.uniqueFeatureID){const x=jf(m,o,g);if(u.has(x))return!0;u.add(x)}return!1}function Um(m,o,u,g,x=!1){const b=o.sourceCache.transform,E=o.sourceCache.tilesIn(m,o.has3DLayers,x);E.sort($m);const C=[];for(const M of E){const z=M.tile.queryRenderedFeatures(o,M,u,g,b,x);Object.keys(z).length&&C.push({wrappedTileID:M.tile.tileID.wrapped().key,queryResults:z})}return C.length===0?{}:function(M){const z={},F={};for(const H of M){const $=H.queryResults,K=H.wrappedTileID,te=F[K]=F[K]||{};for(const ee in $){const re=$[ee],ie=te[ee]=te[ee]||{},ue=z[ee]=z[ee]||[];for(const pe of re)ie[pe.featureIndex]||(ie[pe.featureIndex]=!0,ue.push(pe))}}return z}(C)}function Ru(m,o,u,g,x,b){const E={},C=g.queryRenderedSymbols(m),M=[];for(const z of Object.keys(C).map(Number))M.push(x[z]);M.sort($m);for(const z of M){const F=z.featureIndex.lookupSymbolFeatures(C[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,o,u,b);for(const H in F){const $=E[H]=E[H]||[],K=F[H];K.sort((te,ee)=>{const re=z.featureSortOrder;if(re){const ie=re.indexOf(te.featureIndex);return re.indexOf(ee.featureIndex)-ie}return ee.featureIndex-te.featureIndex});for(const te of K)$.push(te)}}return E}function Rf(m,o){const u=m.getRenderableIds().map(b=>m.getTileByID(b)),g=[],x={};for(let b=0;b<u.length;b++){const E=u[b],C=E.tileID.canonical.key;x[C]||(x[C]=!0,E.querySourceFeatures(g,o))}return g}function $m(m,o){const u=m.tileID,g=o.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function Qa(m,o){const u={};if(!o)return u;for(const g of m){const x=g.layerIds.map(b=>o.getLayer(b)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(b=>x.filter(E=>E.id===b)[0]));for(const b of x)u[b.fqid]=g}}return u}const ra=32,Aa=33,Hl=new Uint16Array(8184);for(let m=0;m<2046;m++){let o=m+2,u=0,g=0,x=0,b=0,E=0,C=0;for(1&o?x=b=E=ra:u=g=C=ra;(o>>=1)>1;){const z=u+x>>1,F=g+b>>1;1&o?(x=u,b=g,u=E,g=C):(u=x,g=b,x=E,b=C),E=z,C=F}const M=4*m;Hl[M+0]=u,Hl[M+1]=g,Hl[M+2]=x,Hl[M+3]=b}const el=new Uint16Array(2178),Wl=new Uint8Array(1089),Df=new Uint16Array(1089);function jc(m){return m===0?-.03125:m===32?.03125:0}const Lf={type:2,extent:s.aj,loadGeometry:()=>[[new s.P(0,0),new s.P(s.aj+1,0),new s.P(s.aj+1,s.aj+1),new s.P(0,s.aj+1),new s.P(0,0)]]};class Du{constructor(o,u,g,x,b,E){this.tileID=o,this.uid=s.a$(),this.uses=0,this.tileSize=u,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=E}registerFadeDuration(o){const u=o+this.timeAdded;u<s.q.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,u,g){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=Qa(o.buckets,u.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.b1){if(this.hasSymbolBuckets=!0,!g)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.b1&&b.hasRTLText){this.hasRTLText=!0,s.b2();break}}this.queryPadding=0;for(const x in this.buckets){const b=this.buckets[x],E=u.style.getOwnLayer(x);if(!E)continue;const C=E.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,C)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new s.b0}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,u,g){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,Qa(o.buckets,u.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o){for(const x in this.buckets){const b=this.buckets[x];b.uploadPending()&&b.upload(o)}const u=o.gl,g=this.imageAtlas;g&&!g.uploaded&&(this.imageAtlasTexture=new s.T(o,g.image,u.RGBA8,{useMipmap:!!g.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(o,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(o,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(o,u,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,g),!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=u.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(u,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(o,u,g,x,b,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=function(M,z){const F=s.bn([],[.5*M.width,.5*-M.height,1]);return s.bo(F,F,[1,-1,0]),s.az(F,F,M.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(F)}(b,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:u,pixelPosMatrix:C,transform:x,availableImages:g,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(o,u){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const x=g.loadVTLayers(),b=u?u.sourceLayer:"",E=x._geojsonTileLayer||x[b];if(!E)return;const C=s.b3(u&&u.filter),{z:M,x:z,y:F}=this.tileID.canonical,H={z:M,x:z,y:F};for(let $=0;$<E.length;$++){const K=E.feature($);if(C.needGeometry){const re=s.b4(K,!0);if(!C.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),re,this.tileID.canonical))continue}else if(!C.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),K))continue;const te=g.getId(K,b),ee=new s.b5(K,M,z,F,te);ee.tile=H,o.push(ee)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const u=this.expirationTime;if(o.cacheControl){const g=s.b6(o.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const g=Date.now();let x=!1;if(this.expirationTime>g)x=!1;else if(u)if(this.expirationTime<u)x=!0;else{const b=this.expirationTime-u;b?this.expirationTime=g+Math.max(b,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}updateBuckets(o,u){if(!this.latestFeatureIndex||!o.style)return;const g=this.latestFeatureIndex.loadVTLayers(),x=o.style.listImages(),b=o.style.getBrightness();for(const E in this.buckets){if(!o.style.hasLayer(E))continue;const C=this.buckets[E],M=C.layers[0],z=M.sourceLayer||"_geojsonTileLayer",F=g[z],H=o.style.getLayerSourceCache(M);let $={};H&&($=H._state.getState(z,void 0));const K=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},te=Object.keys($).length>0&&!u;te&&!C.stateDependentLayers.length&&!u||C.update($,F,x,K,te?C.stateDependentLayers:C.layers,u,b),(C instanceof s.b7||C instanceof s.b8)&&o._terrain&&o._terrain.enabled&&H&&C.uploadPending()&&o._terrain._clearRenderCacheForTile(H.id,this.tileID);const ee=o&&o.style&&o.style.getOwnLayer(E);ee&&(this.queryPadding=Math.max(this.queryPadding,ee.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=s.q.now()+o}setTexture(o,u){const g=u.context,x=g.gl;this.texture=this.texture||u.getTileTexture(o.width),this.texture&&this.texture instanceof s.T?this.texture.update(o):(this.texture=new s.T(g,o,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(o,u){const g={};for(const x of u)g[x]=!0;this.dependencies[o]=g}hasDependency(o,u){for(const g of o){const x=this.dependencies[g];if(x){for(const b of u)if(x[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const g=s.b9(Lf,this.tileID.canonical,this.tileTransform)[0],x=new s.ba,b=new s.bb;for(let E=0;E<g.length;E++){const{x:C,y:M}=g[E];x.emplaceBack(C,M),b.emplaceBack(E)}b.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(x,s.bc.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,x.length,b.length)}_makeTileBoundsBuffers(o,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const g=s.b9(Lf,this.tileID.canonical,this.tileTransform)[0];let x,b;if(this.isRaster){const E=function(C,M){const z=s.aW(C,M),F=Math.pow(2,C.z);for(let re=0;re<Aa;re++)for(let ie=0;ie<Aa;ie++){const ue=s.aX((C.x+(ie+jc(ie))/ra)/F),pe=s.aY((C.y+(re+jc(re))/ra)/F),me=M.project(ue,pe),Te=re*Aa+ie;el[2*Te+0]=Math.round((me.x*z.scale-z.x)*s.aj),el[2*Te+1]=Math.round((me.y*z.scale-z.y)*s.aj)}Wl.fill(0),Df.fill(0);for(let re=2045;re>=0;re--){const ie=4*re,ue=Hl[ie+0],pe=Hl[ie+1],me=Hl[ie+2],Te=Hl[ie+3],we=ue+me>>1,Ce=pe+Te>>1,be=we+Ce-pe,Se=Ce+ue-we,Ee=pe*Aa+ue,Ue=Te*Aa+me,De=Ce*Aa+we,dt=Math.hypot((el[2*Ee+0]+el[2*Ue+0])/2-el[2*De+0],(el[2*Ee+1]+el[2*Ue+1])/2-el[2*De+1])>=16;Wl[De]=Wl[De]||(dt?1:0),re<1022&&(Wl[De]=Wl[De]||Wl[(pe+Se>>1)*Aa+(ue+be>>1)]||Wl[(Te+Se>>1)*Aa+(me+be>>1)])}const H=new s.aZ,$=new s.a_;let K=0;function te(re,ie){const ue=ie*Aa+re;return Df[ue]===0&&(H.emplaceBack(el[2*ue+0],el[2*ue+1],re*s.aj/ra,ie*s.aj/ra),Df[ue]=++K),Df[ue]-1}function ee(re,ie,ue,pe,me,Te){const we=re+ue>>1,Ce=ie+pe>>1;if(Math.abs(re-me)+Math.abs(ie-Te)>1&&Wl[Ce*Aa+we])ee(me,Te,re,ie,we,Ce),ee(ue,pe,me,Te,we,Ce);else{const be=te(re,ie),Se=te(ue,pe),Ee=te(me,Te);$.emplaceBack(be,Se,Ee)}}return ee(0,0,ra,ra,ra,0),ee(ra,ra,0,0,0,ra),{vertices:H,indices:$}}(this.tileID.canonical,u);x=E.vertices,b=E.indices}else{x=new s.aZ,b=new s.a_;for(const{x:C,y:M}of g)x.emplaceBack(C,M,0,0);const E=s.be(x.int16.subarray(0,4*x.length),void 0,4);for(let C=0;C<E.length;C+=3)b.emplaceBack(E[C],E[C+1],E[C+2])}this._tileBoundsBuffer=o.createVertexBuffer(x,s.bf.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(b),this._tileBoundsSegments=s.bd.simpleSegment(0,0,x.length,b.length)}_makeGlobeTileDebugBuffers(o,u){const g=u.projection;if(!g||g.name!=="globe"||u.freezeTileCoverage)return;const x=this.tileID.canonical,b=s.bg(x,u),E=s.bh(b),C=s.ah(u.zoom);let M;C>0&&(M=s.bi(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,x,u,E,M,C),this._makeGlobeTileDebugTextBuffer(o,x,u,E,M,C)}_globePoint(o,u,g,x,b,E,C){let M=s.bj(o,u,g);if(E){const z=1<<g.z,F=s.aD(x.center.lng),H=s.aH(x.center.lat),$=(g.x+.5)/z-F;let K=0;$>.5?K=-1:$<-.5&&(K=1);let te=(o/s.aj+g.x)/z+K,ee=(u/s.aj+g.y)/z;te=(te-F)*x._pixelsPerMercatorPixel+F,ee=(ee-H)*x._pixelsPerMercatorPixel+H;const re=[te*x.worldSize,ee*x.worldSize,0];s.ad(re,re,E),M=s.bk(M,re,C)}return s.ad(M,M,b)}_makeGlobeTileDebugBorderBuffer(o,u,g,x,b,E){const C=new s.ba,M=new s.bb,z=new s.bl,F=($,K,te,ee,re)=>{const ie=(te-$)/(re-1),ue=(ee-K)/(re-1),pe=C.length;for(let me=0;me<re;me++){const Te=$+me*ie,we=K+me*ue;C.emplaceBack(Te,we);const Ce=this._globePoint(Te,we,u,g,x,b,E);z.emplaceBack(Ce[0],Ce[1],Ce[2]),M.emplaceBack(pe+me)}},H=s.aj;F(0,0,H,0,16),F(H,0,H,H,16),F(H,H,0,H,16),F(0,H,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(M),this._tileDebugBuffer=o.createVertexBuffer(C,s.bc.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(z,s.bm.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,C.length,M.length)}_makeGlobeTileDebugTextBuffer(o,u,g,x,b,E){const C=s.aj/4,M=new s.ba,z=new s.a_,F=new s.bl,H=25;z.reserve(32),M.reserve(H),F.reserve(H);const $=(K,te)=>H*K+te;for(let K=0;K<H;K++){const te=K*C;for(let ee=0;ee<H;ee++){const re=ee*C;M.emplaceBack(re,te);const ie=this._globePoint(re,te,u,g,x,b,E);F.emplaceBack(ie[0],ie[1],ie[2])}}for(let K=0;K<4;K++)for(let te=0;te<4;te++){const ee=$(K,te),re=$(K,te+1),ie=$(K+1,te),ue=$(K+1,te+1);z.emplaceBack(ee,re,ie),z.emplaceBack(ie,re,ue)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(z),this._tileDebugTextBuffer=o.createVertexBuffer(M,s.bc.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(F,s.bm.members),this._tileDebugTextSegments=s.bd.simpleSegment(0,0,H,32)}destroy(o=!1){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bp.setPbf(s.bq);class $h extends Du{constructor(o,u,g,x,b){super(o,u,g,x,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,u,g){const x=g.context,b=x.gl;let E=this.texturePerLayer.get(o)||g.getTileTexture(u.width);E&&E instanceof s.T?E.update(u,{premultiply:!1}):E=new s.T(x,u,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,E)}flushQueues(o){const u=this._workQueuePerLayer.get(o)||[],g=this._fetchQueuePerLayer.get(o)||[];for(;u.length;)u.pop()();for(;g.length;)g.pop()()}flushAllQueues(){for(const o of this._workQueuePerLayer.keys()){const u=this._workQueuePerLayer.get(o)||[];for(;u.length;)u.pop()()}for(const o of this._fetchQueuePerLayer.keys()){const u=this._fetchQueuePerLayer.get(o)||[];for(;u.length;)u.pop()()}}fetchHeader(o=16384,u){const g=this._mrt=new s.bp(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=s.br(x,(b,E,C,M)=>{if(b)u(b);else try{const z=g.getHeaderLength(E);if(z>o)return void(this.request=this.fetchHeader(z,u));g.parseHeader(E),this._isHeaderLoaded=!0;let F=0;for(const H of Object.values(g.layers))F=Math.max(F,H.dataIndex[H.dataIndex.length-1].lastByte);E.byteLength>=F&&(this.entireBuffer=E),u(null,this.entireBuffer||E,C,M)}catch(z){u(z)}}),this.request}fetchBand(o,u,g,x){const b=this._mrt;if(!this._isHeaderLoaded||!b)return void x(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void x(new Error("Can't fetch tile band without an actor"));let C;const M=($,K)=>{if(C.complete($,K),$)return void x($);this.updateTextureDescriptor(o,u,g);const te=this.textureDescriptorPerLayer.get(u);x(null,te&&te.img)},z=($,K)=>{if($)return x($);const te=E.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:K,task:C},M,void 0,!0),ee=this._workQueuePerLayer.get(u)||[];ee.push(()=>{te&&te.cancel(),C.cancel()}),this._workQueuePerLayer.has(u)||this._workQueuePerLayer.set(u,ee)},F=b.getLayer(o);if(!F)return void x(new Error(`Unknown sourceLayer "${o}"`));if(F.hasDataForBand(g)){this.updateTextureDescriptor(o,u,g);const $=this.textureDescriptorPerLayer.get(u);return void x(null,$?$.img:null)}const H=F.getDataRange([g]);if(C=b.createDecodingTask(H),!C||C.tasks.length)if(this.flushQueues(u),this.entireBuffer)z(null,this.entireBuffer.slice(H.firstByte,H.lastByte+1));else{const $=Object.assign({},this.requestParams,{headers:{Range:`bytes=${H.firstByte}-${H.lastByte}`}}),K=s.br($,z),te=this._fetchQueuePerLayer.get(u)||[];te.push(()=>{K.cancel(),C.cancel()}),this._fetchQueuePerLayer.has(u)||this._fetchQueuePerLayer.set(u,te)}else x(null)}updateNeeded(o,u){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==u)&&this.state!=="errored"}updateTextureDescriptor(o,u,g){if(!this._mrt)return;const x=this._mrt.getLayer(o);if(!x||!x.hasBand(g)||!x.hasDataForBand(g))return;const{bytes:b,tileSize:E,buffer:C,offset:M,scale:z}=x.getBandView(g),F=E+2*C,H=new s.r({width:F,height:F},b),$=this.texturePerLayer.get(u);$&&$ instanceof s.T&&$.update(H,{premultiply:!1}),this.textureDescriptorPerLayer.set(u,{layer:o,band:g,img:H,buffer:C,offset:M,tileSize:E,format:x.pixelFormat,mix:[z,256*z,65536*z,16777216*z]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(const u of this.texturePerLayer.values())u&&u instanceof s.T&&u.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class bv{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(const o in this.data)for(const u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,g){const x=o.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const b={value:u,timeout:void 0};if(g!==void 0&&(b.timeout=setTimeout(()=>{this.remove(o,b)},g)),this.data[x].push(b),this.order.push(x),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){const u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;const g=o.wrapped().key,x=u===void 0?0:this.data[g].indexOf(u),b=this.data[g][x];return this.data[g].splice(x,1),b.timeout&&clearTimeout(b.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(b.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){const u=[];for(const g in this.data)for(const x of this.data[g])o(x.value)||u.push(x);for(const g of u)this.remove(g.value.tileID,g)}}class wv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,g){const x=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][x]=this.stateChanges[o][x]||{},s.h(this.stateChanges[o][x],g),this.deletedStates[o]===null){this.deletedStates[o]={};for(const b in this.state[o])b!==x&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][x]===null){this.deletedStates[o][x]={};for(const b in this.state[o][x])g[b]||(this.deletedStates[o][x][b]=null)}else for(const b in g)this.deletedStates[o]&&this.deletedStates[o][x]&&this.deletedStates[o][x][b]===null&&delete this.deletedStates[o][x][b]}removeFeatureState(o,u,g){if(this.deletedStates[o]===null)return;const x=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},g&&u!==void 0)this.deletedStates[o][x]!==null&&(this.deletedStates[o][x]=this.deletedStates[o][x]||{},this.deletedStates[o][x][g]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][x])for(g in this.deletedStates[o][x]={},this.stateChanges[o][x])this.deletedStates[o][x][g]=null;else this.deletedStates[o][x]=null;else this.deletedStates[o]=null}getState(o,u){const g=this.state[o]||{},x=this.stateChanges[o]||{},b=this.deletedStates[o];if(b===null)return{};if(u!==void 0){const C=String(u),M=s.h({},g[C],x[C]);if(b){const z=b[u];if(z===null)return{};for(const F in z)delete M[F]}return M}const E=s.h({},g,x);if(b)for(const C in b)delete E[C];return E}initializeTileState(o,u){o.refreshFeatureState(u)}coalesceChanges(o,u){const g={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const b={};for(const E in this.stateChanges[x])this.state[x][E]||(this.state[x][E]={}),s.h(this.state[x][E],this.stateChanges[x][E]),b[E]=this.state[x][E];g[x]=b}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const b={};if(this.deletedStates[x]===null)for(const E in this.state[x])b[E]={},this.state[x][E]={};else for(const E in this.deletedStates[x]){if(this.deletedStates[x][E]===null)this.state[x][E]={};else if(this.state[x][E])for(const C of Object.keys(this.deletedStates[x][E]))delete this.state[x][E][C];b[E]=this.state[x][E]}g[x]=g[x]||{},s.h(g[x],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const x in o)o[x].refreshFeatureState(u)}}class Ao extends s.E{constructor(o,u,g){super(),this.id=o,this._onlySymbols=g,u.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new bv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new wv,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,u){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,u)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const g=this._tiles[u];g.upload(o),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Lu).map(o=>o.key)}getRenderableIds(o,u){const g=[];for(const x in this._tiles)this._isIdRenderable(+x,o,u)&&g.push(this._tiles[x]);return o?g.sort((x,b)=>{const E=x.tileID,C=b.tileID,M=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),z=new s.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-C.overscaledZ||z.y-M.y||z.x-M.x}).map(x=>x.tileID.key):g.map(x=>x.tileID).sort(Lu).map(x=>x.key)}hasRenderableParent(o){const u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u,g){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())&&(g||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,u){const g=this._tiles[o];g&&(g.state!=="loading"&&(g.state=u),this._loadTile(g,this._tileLoaded.bind(this,g,o,u)))}_tileLoaded(o,u,g,x){if(x)if(o.state="errored",x.status!==404)this._source.fire(new s.z(x,{tile:o}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else o.timeAdded=s.q.now(),g==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const u=this.getRenderableIds();for(let x=0;x<u.length;x++){const b=u[x];if(o.neighboringTiles&&o.neighboringTiles[b]){const E=this.getTileByID(b);g(o,E),g(E,o)}}function g(x,b){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let E=b.tileID.canonical.x-x.tileID.canonical.x;const C=b.tileID.canonical.y-x.tileID.canonical.y,M=Math.pow(2,x.tileID.canonical.z),z=b.tileID.key;E===0&&C===0||Math.abs(C)>1||(Math.abs(E)>1&&(Math.abs(E+M)===1?E+=M:Math.abs(E-M)===1&&(E-=M)),b.dem&&x.dem&&(x.dem.backfillBorder(b.dem,E,C),x.neighboringTiles&&x.neighboringTiles[z]&&(x.neighboringTiles[z].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,g,x){for(const b in this._tiles){let E=this._tiles[b];if(x[b]||!E.hasData()||E.tileID.overscaledZ<=u||E.tileID.overscaledZ>g)continue;let C=E.tileID;for(;E&&E.tileID.overscaledZ>u+1;){const z=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[z.key],E&&E.hasData()&&(C=z)}let M=C;for(;M.overscaledZ>u;)if(M=M.scaledTo(M.overscaledZ-1),o[M.key]){x[C.key]=C;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){const g=this._loadedParentTiles[o.key];return g&&g.tileID.overscaledZ>=u?g:null}for(let g=o.overscaledZ-1;g>=u;g--){const x=o.scaledTo(g),b=this._getLoadedTile(x);if(b)return b}}_getLoadedTile(o){const u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,u){u=u||this._source.tileSize;const g=Math.ceil(o.width/u)+1,x=Math.ceil(o.height/u)+1,b=Math.floor(g*x*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(C)}handleWrapJump(o){const u=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,u){const g={};for(const x in this._tiles){const b=this._tiles[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),g[b.tileID.key]=b}this._tiles=g;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(o,u,g,x,b){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(o,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let C,M=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const $=z.attenuationRange()[0],K=Math.floor($)-Math.log2(z.getDemUpscale());M>K&&(M=K)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=o.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new s.aM($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y));else if(this.tileCoverLift!==0){const $=o.clone();$.tileCoverLift=this.tileCoverLift,C=$.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&o.projection.name==="globe"&&(C.push(new s.aM(1,0,1,0,0)),C.push(new s.aM(1,0,1,1,0)),C.push(new s.aM(1,0,1,0,1)),C.push(new s.aM(1,0,1,1,1)))}else if(C=o.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const $=this._source.hasTile.bind(this._source);C=C.filter(K=>$(K))}}else C=[];if(C.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!zf(this._source.type)){const $=o.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),K=Math.min($,this._source.maxzoom);if(E){const te=o.extendTileCover(C,K);for(const ee of te)C.push(ee)}else if(b){const te=o.extendTileCoverToNearPlane(C,this.transform.getFrustum(K),K);for(const ee of te)C.push(ee)}else if(this.castsShadows&&x){const te=o.extendTileCover(C,K,x);for(const ee of te)this._shadowCasterTiles[ee.key]=!0,C.push(ee)}}const F=this._updateRetainedTiles(C);if(zf(this._source.type)&&C.length!==0){const $={},K={},te=Object.keys(F);for(const re of te){const ie=F[re],ue=this._tiles[re];if(!ue||ue.fadeEndTime&&ue.fadeEndTime<=s.q.now())continue;const pe=this.findLoadedParent(ie,Math.max(ie.overscaledZ-Ao.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),$[pe.tileID.key]=pe.tileID),K[re]=ie}const ee=C[C.length-1].overscaledZ;for(const re in this._tiles){const ie=this._tiles[re];if(F[re]||!ie.hasData())continue;let ue=ie.tileID;for(;ue.overscaledZ>ee;){ue=ue.scaledTo(ue.overscaledZ-1);const pe=this._tiles[ue.key];if(pe&&pe.hasData()&&K[ue.key]){F[re]=ie.tileID;break}}}for(const re in $)F[re]||(this._coveredTiles[re]=!0,F[re]=$[re])}for(const $ in F)this._tiles[$].clearFadeHold();const H=s.bs(this._tiles,F);for(const $ of H){const K=this._tiles[$];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(+$)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const u={};if(o.length===0)return u;const g={},x=o.reduce((z,F)=>Math.min(z,F.overscaledZ),1/0),b=o[0].overscaledZ,E=Math.max(b-Ao.maxOverzooming,this._source.minzoom),C=Math.max(b+Ao.maxUnderzooming,this._source.minzoom),M={};for(const z of o){const F=this._addTile(z);u[z.key]=z,F.hasData()||x<this._source.maxzoom&&(M[z.key]=z)}this._retainLoadedChildren(M,x,C,u);for(const z of o){let F=this._tiles[z.key];if(F.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const $=z.children(this._source.maxzoom)[0],K=this.getTile($);if(K&&K.hasData()){u[$.key]=$;continue}}else{const $=z.children(this._source.maxzoom);if(u[$[0].key]&&u[$[1].key]&&u[$[2].key]&&u[$[3].key])continue}let H=F.wasRequested();for(let $=z.overscaledZ-1;$>=E;--$){const K=z.scaledTo($);if(g[K.key]||(g[K.key]=!0,F=this.getTile(K),!F&&H&&(F=this._addTile(K)),F&&(u[K.key]=K,H=F.wasRequested(),F.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const u=[];let g,x=this._tiles[o].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){g=this._loadedParentTiles[x.key];break}u.push(x.key);const b=x.scaledTo(x.overscaledZ-1);if(g=this._getLoadedTile(b),g)break;x=b}for(const b of u)this._loadedParentTiles[b]=g}}_addTile(o){let u=this._tiles[o.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));const g=!!u;if(!g){const x=this.map?this.map.painter:null,b=this._source.tileSize*o.overscaleFactor();u=this._source.type==="raster-array"?new $h(o,b,this.transform.tileZoom,x,this._isRaster):new Du(o,b,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(u,this._tileLoaded.bind(this,u,o.key,u.state))}return u.uses++,this._tiles[o.key]=u,g||this._source.fire(new s.A("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const g=u.getExpiryTimeout();g&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},g))}_removeTile(o){const u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,u,g){const x=[],b=this.transform;if(!b)return x;const E=b.projection.name==="globe",C=s.aD(b.center.lng);for(const M in this._tiles){const z=this._tiles[M];if(g&&z.clearQueryDebugViz(),z.holdingForFade())continue;let F;if(E){const H=z.tileID.canonical;if(H.z===0){const $=[Math.abs(s.ay(C,...Gh(H,-1))-C),Math.abs(s.ay(C,...Gh(H,1))-C)];F=[0,2*$.indexOf(Math.min(...$))-1]}else{const $=[Math.abs(s.ay(C,...Gh(H,-1))-C),Math.abs(s.ay(C,...Gh(H,0))-C),Math.abs(s.ay(C,...Gh(H,1))-C)];F=[$.indexOf(Math.min(...$))-1]}}else F=[0];for(const H of F){const $=o.containsTile(z,b,u,H);$&&x.push($)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,u){const g=this.getRenderableIds(o,u).map(b=>this._tiles[b].tileID),x=this.transform.projection.name==="globe";for(const b of g)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=x?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return g}sortCoordinatesByDistance(o){const u=o.slice(),g=this.transform._camera.position,x=this.transform._camera.forward(),b={};for(const E of u){const C=1/(1<<E.canonical.z);b[E.key]=((E.canonical.x+.5)*C+E.wrap-g[0])*x[0]+((E.canonical.y+.5)*C-g[1])*x[1]-g[2]*x[2]}return u.sort((E,C)=>b[E.key]-b[C.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(zf(this._source.type))for(const o in this._tiles){const u=this._tiles[o];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(o,u,g){this._state.updateState(o=o||"_geojsonTileLayer",u,g)}removeFeatureState(o,u,g){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,g)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,g){const x=this._tiles[o];x&&x.setDependencies(u,g)}reloadTilesForDependencies(o,u){for(const g in this._tiles)this._tiles[g].hasDependency(o,u)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(o,u))}_preloadTiles(o,u){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(o,u))};return void this._source.on("data",M)}const g=new Map,x=Array.isArray(o)?o:[o],b=this.map.painter.terrain,E=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const M of x){const z=M.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of z)g.set(F.key,F);this.usedForTerrain&&M.updateElevation(!1)}const C=Array.from(g.values());s.bt(C,(M,z)=>{const F=new Du(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,H=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),z(H,F)})},u)}}function Lu(m,o){const u=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*o.wrap)-+(o.wrap<0);return m.overscaledZ-o.overscaledZ||g-u||o.canonical.y-m.canonical.y||o.canonical.x-m.canonical.x}function zf(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function Gh(m,o){const u=1<<m.z;return[m.x/u+o,(m.x+1)/u+o]}Ao.maxOverzooming=10,Ao.maxUnderzooming=3;class f1{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,u=!1;for(const g in this.style._mergedLayers){const x=this.style._mergedLayers[g];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:o,visibilityChanged:u});else if(x.type==="model"){const b=this.style.getLayerSource(x);b&&b.type==="batched-model"&&this.layers.push({layer:x,visible:o,visibilityChanged:u})}}}onNewFrame(o){this.layersGotHidden=!1;for(const u of this.layers){const g=u.layer;let x=!1;g.type==="fill-extrusion"?x=!g.isHidden(o)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="building"?x=!g.isHidden(o)&&g.paint.get("building-opacity")>0:g.type==="model"&&(x=!g.isHidden(o)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&u.visible,u.visible=x}}updateZOffset(o,u){this.currentBuildingBuckets=[];for(const x of this.layers){const b=x.layer,E=this.style.getLayerSourceCache(b);let C=1;b.type==="fill-extrusion"?C=x.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(C=x.visible?b.paint.get("building-vertical-scale"):0);let M=E?E.getTile(u):null;if(!M&&E)for(const z in E._tiles){const F=E._tiles[z];if(u.canonical.isChildOf(F.tileID.canonical)){M=F;break}}this.currentBuildingBuckets.push({bucket:M?M.getBucket(b):null,tileID:M?M.tileID:u,verticalScale:C})}o.hasAnyZOffset=!1;let g=!1;for(let x=0;x<o.symbolInstances.length;x++){const b=o.symbolInstances.get(x),E=b.zOffset,C=this._getHeightAtTileOffset(u,b.tileAnchorX,b.tileAnchorY);b.zOffset=C!==Number.NEGATIVE_INFINITY?C:E,g||E===b.zOffset||(g=!0),o.hasAnyZOffset||b.zOffset===0||(o.hasAnyZOffset=!0)}g&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,u,g,x){let b=u,E=g;if(o.canonical.z!==x.canonical.z){const C=x.canonical,M=1/(1<<o.canonical.z-C.z);b=(u+o.canonical.x*s.aj)*M-C.x*s.aj|0,E=(g+o.canonical.y*s.aj)*M-C.y*s.aj|0}return{tileX:b,tileY:E}}_getHeightAtTileOffset(o,u,g){let x,b;for(let E=0;E<this.layers.length;++E){const C=this.layers[E].layer;if(C.type!=="fill-extrusion"&&C.type!=="building")continue;const{bucket:M,tileID:z,verticalScale:F}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:H,tileY:$}=this._mapCoordToOverlappingTile(o,u,g,z),K=M.getHeightAtTileCoord(H,$);K&&K.height!==void 0&&(K.hidden?x=K.height:b=Math.max(K.height*F,b||0))}if(b!==void 0)return b;for(let E=0;E<this.layers.length;++E){const C=this.layers[E];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:M,tileID:z}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:F,tileY:H}=this._mapCoordToOverlappingTile(o,u,g,z),$=M.getHeightAtTileCoord(F,H);if($&&!$.hidden)return $.height===void 0&&x!==void 0?Math.min($.maxHeight,x)*$.verticalScale:$.height?$.height*$.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function p1(m,o){const u={};for(const g in m)g!=="ref"&&(u[g]=m[g]);return s.bu.forEach(g=>{g in o&&(u[g]=o[g])}),u}function Nf(m){m=m.slice();const o=Object.create(null);for(let u=0;u<m.length;u++)o[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=p1(m[u],o[m[u].ref]));return m}const sn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Gm(m,o,u){u.push({command:sn.addSource,args:[m,o[m]]})}function Hh(m,o,u){o.push({command:sn.removeSource,args:[m]}),u[m]=!0}function Ff(m,o,u,g){Hh(m,u,g),Gm(m,o,u)}function SP(m,o,u){let g;for(g in m[u])if(m[u].hasOwnProperty(g)&&g!=="data"&&!s.bv(m[u][g],o[u][g]))return!1;for(g in o[u])if(o[u].hasOwnProperty(g)&&g!=="data"&&!s.bv(m[u][g],o[u][g]))return!1;return!0}function Bf(m,o,u,g,x,b){let E;for(E in o=o||{},m=m||{})m.hasOwnProperty(E)&&(s.bv(m[E],o[E])||u.push({command:b,args:[g,E,o[E],x]}));for(E in o)o.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(s.bv(m[E],o[E])||u.push({command:b,args:[g,E,o[E],x]}))}function zu(m){return m.id}function Rc(m,o){return m[o.id]=o,m}function Vf(m,o,u){const g=o.createTileMatrix(m,m.worldSize,u.toUnwrapped());return s.az(new Float32Array(16),m.projMatrix,g)}function m1(m,o,u){if(o.projection.name===u.projection.name)return m.projMatrix;const g=u.clone();return g.setProjection(o.projection),Vf(g,o.getProjection(),m)}function Hm(m,o,u){return o.name===u.projection.name?m.projMatrix:Vf(u,o,m)}class g1{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.ay(o,0,1);let u=1,g=this._distances[u];const x=o*this.paddedLength+this.padding;for(;g<x&&u<this._distances.length;)g=this._distances[++u];const b=u-1,E=this._distances[b],C=g-E,M=C>0?(x-E)/C:0;return this.points[b].mult(1-M).add(this.points[u].mult(M))}}class Wh{constructor(o,u,g){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(u/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,g,x,b){this._forEachCell(u,g,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(o,u,g,x){this._forEachCell(u-x,g-x,u+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(g),this.circles.push(x)}_insertBoxCell(o,u,g,x,b,E){this.boxCells[b].push(E)}_insertCircleCell(o,u,g,x,b,E){this.circleCells[b].push(E)}_query(o,u,g,x,b,E){if(g<0||o>this.width||x<0||u>this.height)return!b&&[];const C=[];if(o<=0&&u<=0&&this.width<=g&&this.height<=x){if(b)return!0;for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const z=this.circles[3*M],F=this.circles[3*M+1],H=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:z-H,y1:F-H,x2:z+H,y2:F+H})}return E?C.filter(E):C}return this._forEachCell(o,u,g,x,this._queryCell,C,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?C.length>0:C}_queryCircle(o,u,g,x,b){const E=o-g,C=o+g,M=u-g,z=u+g;if(C<0||E>this.width||z<0||M>this.height)return!x&&[];const F=[];return this._forEachCell(E,M,C,z,this._queryCellCircle,F,{hitTest:x,circle:{x:o,y:u,radius:g},seenUids:{box:{},circle:{}}},b),x?F.length>0:F}query(o,u,g,x,b){return this._query(o,u,g,x,!1,b)}hitTest(o,u,g,x,b){return this._query(o,u,g,x,!0,b)}hitTestCircle(o,u,g,x){return this._queryCircle(o,u,g,!0,x)}_queryCell(o,u,g,x,b,E,C,M){const z=C.seenUids,F=this.boxCells[b];if(F!==null){const $=this.bboxes;for(const K of F)if(!z.box[K]){z.box[K]=!0;const te=4*K;if(o<=$[te+2]&&u<=$[te+3]&&g>=$[te+0]&&x>=$[te+1]&&(!M||M(this.boxKeys[K]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[K],x1:$[te],y1:$[te+1],x2:$[te+2],y2:$[te+3]})}}}const H=this.circleCells[b];if(H!==null){const $=this.circles;for(const K of H)if(!z.circle[K]){z.circle[K]=!0;const te=3*K;if(this._circleAndRectCollide($[te],$[te+1],$[te+2],o,u,g,x)&&(!M||M(this.circleKeys[K]))){if(C.hitTest)return E.push(!0),!0;{const ee=$[te],re=$[te+1],ie=$[te+2];E.push({key:this.circleKeys[K],x1:ee-ie,y1:re-ie,x2:ee+ie,y2:re+ie})}}}}}_queryCellCircle(o,u,g,x,b,E,C,M){const z=C.circle,F=C.seenUids,H=this.boxCells[b];if(H!==null){const K=this.bboxes;for(const te of H)if(!F.box[te]){F.box[te]=!0;const ee=4*te;if(this._circleAndRectCollide(z.x,z.y,z.radius,K[ee+0],K[ee+1],K[ee+2],K[ee+3])&&(!M||M(this.boxKeys[te])))return E.push(!0),!0}}const $=this.circleCells[b];if($!==null){const K=this.circles;for(const te of $)if(!F.circle[te]){F.circle[te]=!0;const ee=3*te;if(this._circlesCollide(K[ee],K[ee+1],K[ee+2],z.x,z.y,z.radius)&&(!M||M(this.circleKeys[te])))return E.push(!0),!0}}}_forEachCell(o,u,g,x,b,E,C,M){const z=this._convertToXCellCoord(o),F=this._convertToYCellCoord(u),H=this._convertToXCellCoord(g),$=this._convertToYCellCoord(x);for(let K=z;K<=H;K++)for(let te=F;te<=$;te++)if(b.call(this,o,u,g,x,this.xCellCount*te+K,E,C,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,g,x,b,E){const C=x-o,M=b-u,z=g+E;return z*z>C*C+M*M}_circleAndRectCollide(o,u,g,x,b,E,C){const M=(E-x)/2,z=Math.abs(o-(x+M));if(z>M+g)return!1;const F=(C-b)/2,H=Math.abs(u-(b+F));if(H>F+g)return!1;if(z<=M||H<=F)return!0;const $=z-M,K=H-F;return $*$+K*K<=g*g}}const Nu={unknown:0,flipRequired:1,flipNotRequired:2},y1=Math.tan(85*Math.PI/180);function Uf(m,o,u,g,x,b,E){const C=s.bz();if(u)if(b.name==="globe"){const M=s.bA(x,o);s.az(C,C,M)}else{const M=s.bB([],E);C[0]=M[0],C[1]=M[1],C[4]=M[2],C[5]=M[3],g||s.by(C,C,x.angle)}else s.az(C,x.labelPlaneMatrix,m);return C}function qh(m,o,u,g,x,b,E){const C=Uf(m,o,u,g,x,b,E);return b.name==="globe"&&u||(C[2]=C[6]=C[10]=C[14]=0),C}function ql(m,o,u,g,x,b,E){if(u){if(b.name==="globe"){const C=Uf(m,o,u,g,x,b,E);return s.bi(C,C),s.az(C,m,C),C}{const C=s.bw(m),M=s.bx([]);return M[0]=E[0],M[1]=E[1],M[4]=E[2],M[5]=E[3],s.az(C,C,M),g||s.by(C,C,-x.angle),C}}return x.glCoordMatrix}function na(m,o,u,g){const x=[m,o,u,1];u?s.aA(x,x,g):_1(x,x,g);const b=x[3];return x[0]/=b,x[1]/=b,x[2]/=b,x}function Sv(m,o){return Math.min(.5+m/o*.5,1.5)}function Tv(m,o){const u=m[0]/m[3],g=m[1]/m[3];return u>=-o[0]&&u<=o[0]&&g>=-o[1]&&g<=o[1]}function Fu(m,o,u,g,x,b,E,C,M,z){const F=u.transform,H=g?m.textSizeData:m.iconSizeData,$=s.bH(H,u.transform.zoom),K=F.projection.name==="globe",te=[256/u.width*2+1,256/u.height*2+1],ee=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ee.clear();let re=null;K&&(re=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const ie=m.lineVertexArray,ue=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,pe=u.transform.width/u.transform.height;let me,Te=!1;for(let we=0;we<ue.length;we++){const Ce=ue.get(we),{numGlyphs:be,writingMode:Se}=Ce;if(Se!==s.bI.vertical||Te||me===s.bI.horizontal||(Te=!0),me=Se,(Ce.hidden||Se===s.bI.vertical)&&!Te){Zh(be,ee);continue}Te=!1;const Ee=new s.P(Ce.tileAnchorX,Ce.tileAnchorY);let{x:Ue,y:De,z:dt}=F.projection.projectTilePoint(Ee.x,Ee.y,z.canonical);if(M){const[tr,ir,Zt]=M(Ee);Ue+=tr,De+=ir,dt+=Zt}const Je=[Ue,De,dt,1];if(s.aA(Je,Je,o),!Tv(Je,te)){Zh(be,ee);continue}const pt=Je[3],Pt=Sv(u.transform.getCameraToCenterDistance(F.projection),pt),qe=s.bJ(H,$,Ce),Re=E?qe/Pt:qe*Pt,nt=na(Ue,De,dt,x);if(nt[3]<=0){Zh(be,ee);continue}let Ze={};const yt=s.al(m.layers[0].layout.get("text-max-angle")),bt=Math.cos(yt),Et=E?null:M,jt=Wm(Ce,Re,!1,C,o,x,b,m.glyphOffsetArray,ie,ee,re,nt,Ee,Ze,pe,Et,F.projection,z,E,bt);Te=jt.useVertical,Et&&jt.needsFlipping&&(Ze={}),(jt.notEnoughRoom||Te||jt.needsFlipping&&Wm(Ce,Re,!0,C,o,x,b,m.glyphOffsetArray,ie,ee,re,nt,Ee,Ze,pe,Et,F.projection,z,E,bt).notEnoughRoom)&&Zh(be,ee)}g?(m.text.dynamicLayoutVertexBuffer.updateData(ee),re&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(re)):(m.icon.dynamicLayoutVertexBuffer.updateData(ee),re&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(re))}function Bo(m,o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re){const{lineStartIndex:ie,glyphStartIndex:ue,segment:pe}=C,me=ue+C.numGlyphs,Te=ie+C.lineLength,we=o.getoffsetX(ue),Ce=o.getoffsetX(me-1),be=$f(m*we,u,g,x,b,E,pe,ie,Te,M,z,F,H,$,!0,K,te,ee,re);if(!be)return null;const Se=$f(m*Ce,u,g,x,b,E,pe,ie,Te,M,z,F,H,$,!0,K,te,ee,re);return Se?{first:be,last:Se}:null}function Ev(m,o,u,g){return m===s.bI.horizontal&&Math.abs(g)>Math.abs(u)?{useVertical:!0}:m===s.bI.vertical?g>0?{needsFlipping:!0}:null:o!==Nu.unknown&&function(x,b){return x===0||Math.abs(b/x)>y1}(u,g)?o===Nu.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function Wm(m,o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re,ie,ue,pe){const me=o/24,Te=m.lineOffsetX*me,we=m.lineOffsetY*me,{lineStartIndex:Ce,glyphStartIndex:be,numGlyphs:Se,segment:Ee,writingMode:Ue,flipState:De}=m,dt=Ce+m.lineLength,Je=pt=>{if(F){const[nt,Ze,yt]=pt.up,bt=z.length;s.bK(F,bt+0,nt,Ze,yt),s.bK(F,bt+1,nt,Ze,yt),s.bK(F,bt+2,nt,Ze,yt),s.bK(F,bt+3,nt,Ze,yt)}const[Pt,qe,Re]=pt.point;s.bL(z,Pt,qe,Re,pt.angle)};if(Se>1){const pt=Bo(me,C,Te,we,u,H,$,m,M,b,K,ee,!1,re,ie,ue,pe);if(!pt)return{notEnoughRoom:!0};if(g&&!u){let[Pt,qe,Re]=pt.first.point,[nt,Ze,yt]=pt.last.point;[Pt,qe]=na(Pt,qe,Re,E),[nt,Ze]=na(nt,Ze,yt,E);const bt=Ev(Ue,De,(nt-Pt)*te,Ze-qe);if(m.flipState=bt&&bt.needsFlipping?Nu.flipRequired:Nu.flipNotRequired,bt)return bt}Je(pt.first);for(let Pt=be+1;Pt<be+Se-1;Pt++){const qe=$f(me*C.getoffsetX(Pt),Te,we,u,H,$,Ee,Ce,dt,M,b,K,ee,!1,!1,re,ie,ue,pe);if(!qe)return z.length-=4*(Pt-be),{notEnoughRoom:!0};Je(qe)}Je(pt.last)}else{if(g&&!u){const Pt=na($.x,$.y,0,x),qe=Ce+Ee+1,Re=new s.P(M.getx(qe),M.gety(qe)),nt=na(Re.x,Re.y,0,x),Ze=nt[3]>0?nt:Tn($,Re,Pt,1,x,void 0,re,ie.canonical),yt=Ev(Ue,De,(Ze[0]-Pt[0])*te,Ze[1]-Pt[1]);if(m.flipState=yt&&yt.needsFlipping?Nu.flipRequired:Nu.flipNotRequired,yt)return yt}const pt=$f(me*C.getoffsetX(be),Te,we,u,H,$,Ee,Ce,dt,M,b,K,ee,!1,!1,re,ie,ue,pe);if(!pt)return{notEnoughRoom:!0};Je(pt)}return{}}function Av(m,o,u,g,x){const{x:b,y:E,z:C}=g.projectTilePoint(m.x,m.y,o);if(!x)return na(b,E,C,u);const[M,z,F]=x(m);return na(b+M,E+z,C+F,u)}function Tn(m,o,u,g,x,b,E,C){const M=Av(m.sub(o)._unit()._add(m),C,x,E,b);return s.at(M,u,M),s.au(M,M),s.bE(M,u,M,g)}function $f(m,o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re,ie,ue){const pe=g?m-o:m+o;let me=pe>0?1:-1,Te=0;g&&(me*=-1,Te=Math.PI),me<0&&(Te+=Math.PI);let we=C+E+(me>0?0:1)|0,Ce=x,be=x,Se=0,Ee=0;const Ue=Math.abs(pe),De=[],dt=[];let Je=b,pt=Je,Pt=s.bC([]);const qe=()=>Tn(pt,Je,be,Ue-Se+1,F,$,ee,re.canonical);for(;Se+Ee<=Ue;){if(we+=me,we<C||we>=M)return null;if(be=Ce,pt=Je,De.push(be),K&&dt.push(pt),Je=new s.P(z.getx(we),z.gety(we)),Ce=H[we],!Ce){const Zt=Av(Je,re.canonical,F,ee,$);Ce=Zt[3]>0?H[we]=Zt:qe()}Se+=Ee;const tr=s.at([],Ce,be),ir=s.bD(be,Ce);if(u&&ir>0&&Ee>0&&s.bG(Pt,tr)/(Ee*ir)<ue)return null;Ee=ir,Pt=tr}te&&$&&(H[we]&&(Ce=qe(),Ee=s.bD(be,Ce),Pt=s.at([],Ce,be)),H[we]=Ce);const Re=(Ue-Se)/Ee,nt=Je.sub(pt)._mult(Re)._add(pt),Ze=s.bE([],be,Pt,Re);let yt=[0,0,1],bt=Pt[0],Et=Pt[1];if(ie&&(yt=ee.upVector(re.canonical,nt.x,nt.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const tr=[yt[2],0,-yt[0]],ir=s.bF([],yt,tr);s.au(tr,tr),s.au(ir,ir),bt=s.bG(Pt,tr),Et=s.bG(Pt,ir)}if(u){const tr=s.bF([],yt,Pt);s.au(tr,tr),s.bE(Ze,Ze,tr,u*me)}const jt=Te+Math.atan2(Et,bt);return De.push(Ze),K&&dt.push(nt),{point:Ze,angle:jt,path:De,tilePath:dt,up:yt}}function Zh(m,o){const u=o.length,g=u+4*m;o.resize(g),o.float32.fill(-1/0,4*u,4*g)}function _1(m,o,u){const g=o[0],x=o[1];return m[0]=u[0]*g+u[4]*x+u[12],m[1]=u[1]*g+u[5]*x+u[13],m[3]=u[3]*g+u[7]*x+u[15],m}const lr=100;class v1{constructor(o,u,g=new Wh(o.width+200,o.height+200,25),x=new Wh(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+lr,this.screenBottomBoundary=o.height+lr,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=u}placeCollisionBox(o,u,g,x,b,E,C,M,z,F,H){let $=g.projectedAnchorX,K=g.projectedAnchorY,te=g.projectedAnchorZ;const ee=g.tileAnchorX,re=g.tileAnchorY,ie=g.elevation,ue=g.tileID,pe=o.getProjection();if(ie&&ue){const[dt,Je,pt]=pe.upVector(ue.canonical,g.tileAnchorX,g.tileAnchorY),Pt=pe.upVectorScale(ue.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$+=dt*ie*Pt,K+=Je*ie*Pt,te+=pt*ie*Pt}const me=o.projection.name==="globe",Te=o.projection.name==="globe"?s.ah(this.transform.zoom):0;if(ue&&me&&Te<1&&!E){const dt=1<<ue.canonical.z,Je=s.bM(ee,re);s.bN(Je,Je,1/s.aj),s.bO(Je,Je,s.bM(ue.canonical.x,ue.canonical.y)),s.bN(Je,Je,1/dt),s.bP(Je,Je,s.bM(x[0],x[1])),Je[0]=s.bQ(Je[0],-.5,.5),s.bN(Je,Je,s.aj);const pt=s.bR(Je[0],Je[1],s.aj/(2*Math.PI),1);s.aA(pt,pt,b),$=s.ai($,pt[0],Te),K=s.ai(K,pt[1],Te),te=s.ai(te,pt[2],Te)}const we=this.projectAndGetPerspectiveRatio(F,$,K,te,g.tileID,pe.name==="globe"||!!ie||this.transform.pitch>0,pe),Ce=z*we.perspectiveRatio,be=(g.x1*u+C.x-g.padding)*Ce+we.point.x,Se=(g.y1*u+C.y-g.padding)*Ce+we.point.y,Ee=(g.x2*u+C.x+g.padding)*Ce+we.point.x,Ue=(g.y2*u+C.y+g.padding)*Ce+we.point.y,De=we.perspectiveRatio<=.55||we.occluded;return!this.isInsideGrid(be,Se,Ee,Ue)||!M&&this.grid.hitTest(be,Se,Ee,Ue,H)||De?{box:[],offscreen:!1,occluded:we.occluded}:{box:[be,Se,Ee,Ue],offscreen:this.isOffscreen(be,Se,Ee,Ue),occluded:!1}}placeCollisionCircles(o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee){const re=[],ie=this.transform.elevation,ue=o.getProjection(),pe=ie?ie.getAtTileOffsetFunc(ee,this.transform.center.lat,this.transform.worldSize,ue):null,me=new s.P(g.tileAnchorX,g.tileAnchorY);let{x:Te,y:we,z:Ce}=ue.projectTilePoint(me.x,me.y,ee.canonical);if(pe){const[yt,bt,Et]=pe(me);Te+=yt,we+=bt,Ce+=Et}const be=ue.name==="globe",Se=this.projectAndGetPerspectiveRatio(C,Te,we,Ce,ee,be||!!ie||this.transform.pitch>0,ue),{perspectiveRatio:Ee}=Se,Ue=(H?E/Ee:E*Ee)/s.bU,De=na(Te,we,Ce,M),dt=g.lineOffsetX*Ue,Je=g.lineOffsetY*Ue,pt=s.al(o.layers[0].layout.get("text-max-angle")),Pt=Math.cos(pt),qe=Se.signedDistanceFromCamera>0?Bo(Ue,b,dt,Je,!1,De,me,g,x,M,{},ie&&!H?pe:null,H&&!!ie,ue,ee,H,Pt):null;let Re=!1,nt=!1,Ze=!0;if(qe&&!Se.occluded){const yt=.5*K*Ee+te,bt=new s.P(-100,-100),Et=new s.P(this.screenRightBoundary,this.screenBottomBoundary),jt=new g1,{first:tr,last:ir}=qe,Zt=tr.path.length;let er=[];for(let Pr=Zt-1;Pr>=1;Pr--)er.push(tr.path[Pr]);for(let Pr=1;Pr<ir.path.length;Pr++)er.push(ir.path[Pr]);const nr=2.5*yt;z&&(er=er.map(([Pr,Nr,Pn],vr)=>(pe&&!be&&(Pn=pe(vr<Zt-1?tr.tilePath[Zt-1-vr]:ir.tilePath[vr-Zt+2])[2]),na(Pr,Nr,Pn,z))),er.some(Pr=>Pr[3]<=0)&&(er=[]));let wr=[];if(er.length>0){let Pr=1/0,Nr=-1/0,Pn=1/0,vr=-1/0;for(const un of er)Pr=Math.min(Pr,un[0]),Pn=Math.min(Pn,un[1]),Nr=Math.max(Nr,un[0]),vr=Math.max(vr,un[1]);Nr>=bt.x&&Pr<=Et.x&&vr>=bt.y&&Pn<=Et.y&&(wr=[er.map(un=>new s.P(un[0],un[1]))],(Pr<bt.x||Nr>Et.x||Pn<bt.y||vr>Et.y)&&(wr=s.bS(wr,bt.x,bt.y,Et.x,Et.y)))}for(const Pr of wr){jt.reset(Pr,.25*yt);let Nr=0;Nr=jt.length<=.5*yt?1:Math.ceil(jt.paddedLength/nr)+1;for(let Pn=0;Pn<Nr;Pn++){const vr=Pn/Math.max(Nr-1,1),un=jt.lerp(vr),hn=un.x+lr,Zn=un.y+lr;re.push(hn,Zn,yt,0);const Ir=hn-yt,on=Zn-yt,cn=hn+yt,vn=Zn+yt;if(Ze=Ze&&this.isOffscreen(Ir,on,cn,vn),nt=nt||this.isInsideGrid(Ir,on,cn,vn),!u&&this.grid.hitTestCircle(hn,Zn,yt,$)&&(Re=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!F&&Re||!nt?[]:re,offscreen:Ze,collisionDetected:Re,occluded:Se.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let g=1/0,x=1/0,b=-1/0,E=-1/0;for(const F of o){const H=new s.P(F.x+lr,F.y+lr);g=Math.min(g,H.x),x=Math.min(x,H.y),b=Math.max(b,H.x),E=Math.max(E,H.y),u.push(H)}const C=this.grid.query(g,x,b,E).concat(this.ignoredGrid.query(g,x,b,E)),M={},z={};for(const F of C){const H=F.key;if(M[H.bucketInstanceId]===void 0&&(M[H.bucketInstanceId]={}),M[H.bucketInstanceId][H.featureIndex])continue;const $=[new s.P(F.x1,F.y1),new s.P(F.x2,F.y1),new s.P(F.x2,F.y2),new s.P(F.x1,F.y2)];s.bT(u,$)&&(M[H.bucketInstanceId][H.featureIndex]=!0,z[H.bucketInstanceId]===void 0&&(z[H.bucketInstanceId]=[]),z[H.bucketInstanceId].push(H.featureIndex))}return z}insertCollisionBox(o,u,g,x,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:b},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,g,x,b){const E=u?this.ignoredGrid:this.grid,C={bucketInstanceId:g,featureIndex:x,collisionGroupID:b};for(let M=0;M<o.length;M+=4)E.insertCircle(C,o[M],o[M+1],o[M+2])}projectAndGetPerspectiveRatio(o,u,g,x,b,E,C){const M=[u,g,x,1];let z=!1;x||this.transform.pitch>0?(s.aA(M,M,o),this.fogState&&b&&C.name!=="globe"&&(z=function(H,$,K,te,ee,re){const ie=re.calculateFogTileMatrix(ee),ue=[$,K,te];return s.ad(ue,ue,ie),ar(H,s.ae(ue),re.pitch,re._fov)}(this.fogState,u,g,x,b.toUnwrapped(),this.transform)>.9)):_1(M,M,o);const F=M[3];return{point:new s.P((M[0]/F+1)/2*this.transform.width+lr,(-M[1]/F+1)/2*this.transform.height+lr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/F*.5,1.5),signedDistanceFromCamera:F,occluded:E&&M[2]>F||z}}isOffscreen(o,u,g,x){return g<lr||o>=this.screenRightBoundary||x<lr||u>this.screenBottomBoundary}isInsideGrid(o,u,g,x){return g>=0&&o<this.gridRightBoundary&&x>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=s.bx([]);return s.bo(o,o,[-100,-100,0]),o}}class Gf{constructor(o,u,g,x){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):x&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Bu{constructor(o,u,g,x,b,E=!1){this.text=new Gf(o?o.text:null,u,g,b),this.icon=new Gf(o?o.icon:null,u,x,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ia{constructor(o,u,g,x=!1){this.text=o,this.icon=u,this.skipFade=g,this.clipped=x}}class kv{constructor(){this.invProjMatrix=s.bz(),this.viewportMatrix=s.bz(),this.circles=[]}}class Kh{constructor(o,u,g,x,b){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=b}}class sr{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[o]}}function yn(m,o,u,g,x){const{horizontalAlign:b,verticalAlign:E}=s.bZ(m),C=-(b-.5)*o,M=-(E-.5)*u,z=s.b_(m,g);return new s.P(C+z[0]*x,M+z[1]*x)}function _n(m,o,u,g,x){const b=new s.P(m,o);return u&&b._rotate(g?x:-x),b}class Vo{constructor(o,u,g,x,b,E){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new v1(this.transform,b),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new sr(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,u,g,x,b=1){const E=g.getBucket(u),C=g.latestFeatureIndex;if(!E||!C||u.fqid!==E.layerIds[0])return;const M=E.layers[0].layout,z=E.layers[0].paint,F=g.collisionBoxArray,H=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),$=g.tileSize/s.aj,K=g.tileID.toUnwrapped();this.transform.setProjection(E.projection);const te=(ee=g.tileID,re=E.getProjection(),ie=this.transform,re.name===this.projection?ie.calculateProjMatrix(ee.toUnwrapped()):Vf(ie,re,ee));var ee,re,ie;const ue=M.get("text-pitch-alignment")==="map",pe=M.get("text-rotation-alignment")==="map";u.compileFilter(u.options);const me=u.dynamicFilter(),Te=u.dynamicFilterNeedsFeature(),we=this.transform.calculatePixelsToTileUnitsMatrix(g),Ce=qh(te,g.tileID.canonical,ue,pe,this.transform,E.getProjection(),we);let be=null;const Se=E.getProjection().createInversionMatrix(this.transform,g.tileID.canonical);if(ue){const Re=ql(te,g.tileID.canonical,ue,pe,this.transform,E.getProjection(),we);be=s.az([],this.transform.labelPlaneMatrix,Re)}let Ee=null;me&&g.latestFeatureIndex&&(Ee={unwrappedTileID:K,dynamicFilter:me,dynamicFilterNeedsFeature:Te}),this.retainedQueryData[E.bucketInstanceId]=new Kh(E.bucketInstanceId,C,E.sourceLayerIndex,E.index,g.tileID);const[Ue,De]=E.layers[0].layout.get("text-size-scale-range"),dt=s.ay(b,Ue,De),[Je,pt]=M.get("icon-size-scale-range"),Pt=s.ay(b,Je,pt),qe={bucket:E,layout:M,paint:z,posMatrix:te,invMatrix:Se,mercatorCenter:[s.aD(this.transform.center.lng),s.aH(this.transform.center.lat)],textLabelPlaneMatrix:Ce,labelToScreenMatrix:be,clippingData:Ee,scale:H,textPixelRatio:$,holdingForFade:g.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:s.bH(E.textSizeData,this.transform.zoom,dt),partiallyEvaluatedIconSize:s.bH(E.iconSizeData,this.transform.zoom,Pt),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(x)for(const Re of E.sortKeyRanges){const{sortKey:nt,symbolInstanceStart:Ze,symbolInstanceEnd:yt}=Re;o.push({sortKey:nt,symbolInstanceStart:Ze,symbolInstanceEnd:yt,parameters:qe})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:qe})}attemptAnchorPlacement(o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re,ie,ue,pe,me,Te){const{textOffset0:we,textOffset1:Ce,crossTileID:be}=ee,Se=[we,Ce],Ee=yn(o,E,C,Se,M),Ue=this.collisionIndex.placeCollisionBox(ie,M,u,g,x,b,_n(Ee.x,Ee.y,z,F,this.transform.angle),te,H,$,K.predicate);if(pe){const De=ie.getSymbolInstanceIconSize(Te,this.transform.zoom,ee.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ie,De,pe,g,x,b,_n(Ee.x,Ee.y,z,F,this.transform.angle),te,H,$,K.predicate).box.length===0)return}if(Ue.box.length>0){let De;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(De=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:Se,width:E,height:C,anchor:o,textScale:M,prevAnchor:De},this.markUsedJustification(ie,o,ee,ue),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ue,ee),this.placedOrientations[be]=ue),{shift:Ee,placedGlyphBoxes:Ue}}}placeLayerBucketPart(o,u,g,x,b=1){const{bucket:E,layout:C,paint:M,posMatrix:z,textLabelPlaneMatrix:F,labelToScreenMatrix:H,clippingData:$,textPixelRatio:K,mercatorCenter:te,invMatrix:ee,holdingForFade:re,collisionBoxArray:ie,partiallyEvaluatedTextSize:ue,partiallyEvaluatedIconSize:pe,collisionGroup:me,latestFeatureIndex:Te}=o.parameters,we=C.get("text-optional"),Ce=C.get("icon-optional"),be=C.get("text-allow-overlap"),Se=C.get("icon-allow-overlap"),Ee=C.get("text-rotation-alignment")==="map",Ue=C.get("icon-rotation-alignment")==="map",De=C.get("text-pitch-alignment")==="map",dt=M.get("symbol-z-offset"),Je=C.get("symbol-elevation-reference")==="sea",pt=C.get("symbol-placement"),[Pt,qe]=C.get("text-size-scale-range"),[Re,nt]=C.get("icon-size-scale-range"),Ze=s.ay(b,Pt,qe),yt=s.ay(b,Re,nt),bt=C.get("text-variable-anchor"),Et=Ee&&pt!=="point",jt=Ue&&pt!=="point",tr=bt&&E.hasTextData(),ir=E.hasIconTextFit()&&tr&&E.hasIconData();this.transform.setProjection(E.projection);const Zt=tr||Et,er=jt||ir;let nr=be&&(Se||!E.hasIconData()||Ce),wr=Se&&(be||!E.hasTextData()||we);const Pr=!dt.isConstant();!E.collisionArrays&&ie&&E.deserializeCollisionBoxes(ie),g&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,ie,Ze,yt);const Nr=(vr,un,hn)=>{const{crossTileID:Zn,numVerticalGlyphVertices:Ir}=vr;let on=null;if($&&$.dynamicFilterNeedsFeature||Pr){const si=this.retainedQueryData[E.bucketInstanceId];on=Te.loadFeature({featureIndex:vr.featureIndex,bucketIndex:si.bucketIndex,sourceLayerIndex:si.sourceLayerIndex,layoutVertexArrayOffset:0})}if($&&!(0,$.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},on,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new s.P(vr.tileAnchorX,vr.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[Zn]=new ia(!1,!1,!1,!0),void u.add(Zn);const cn=dt.evaluate(on,{});if(u.has(Zn))return;if(re)return void(this.placements[Zn]=new ia(!1,!1,!1));let vn=!1,hi=!1,kr=!0,mn=!1,mi=!1,rn=null,xn={box:null,offscreen:null,occluded:null},Ln={box:null},Ei=null,Oi=null,ji=null,Rs=0,ca=0,$o=0;hn.textFeatureIndex?Rs=hn.textFeatureIndex:vr.useRuntimeCollisionCircles&&(Rs=vr.featureIndex),hn.verticalTextFeatureIndex&&(ca=hn.verticalTextFeatureIndex);const fo=si=>{si.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Ri=this.transform.elevation;si.elevation=Je?cn:cn+(Ri?Ri.getAtTileOffset(si.tileID,si.tileAnchorX,si.tileAnchorY):0),si.elevation+=vr.zOffset},po=hn.textBox;if(po){fo(po);const si=Un=>{let Di=s.bI.horizontal;if(E.allowVerticalPlacement&&!Un&&this.prevPlacement){const Ks=this.prevPlacement.placedOrientations[Zn];Ks&&(this.placedOrientations[Zn]=Ks,Di=Ks,this.markUsedOrientation(E,Di,vr))}return Di},Ri=(Un,Di)=>{if(E.allowVerticalPlacement&&Ir>0&&hn.verticalTextBox){for(const Ks of E.writingModes)if(Ks===s.bI.vertical?(xn=Di(),Ln=xn):xn=Un(),xn&&xn.box&&xn.box.length)break}else xn=Un()};if(bt){let Un=bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Zn]){const _i=this.prevPlacement.variableOffsets[Zn];Un.indexOf(_i.anchor)>0&&(Un=Un.filter(Mo=>Mo!==_i.anchor),Un.unshift(_i.anchor))}const Di=(_i,Mo,Qu)=>{const Qc=E.getSymbolInstanceTextSize(ue,vr,this.transform.zoom,un),Td=(_i.x2-_i.x1)*Qc+2*_i.padding,Ed=(_i.y2-_i.y1)*Qc+2*_i.padding,eu=vr.hasIconTextFit&&!Se?Mo:null;eu&&fo(eu);let Oo={box:[],offscreen:!1,occluded:!1};const tu=be?2*Un.length:Un.length;for(let $i=0;$i<tu;++$i){const Da=this.attemptAnchorPlacement(Un[$i%Un.length],_i,te,ee,Zt,Td,Ed,Qc,Ee,De,K,z,me,$i>=Un.length,vr,un,E,Qu,eu,ue,pe);if(Da&&(Oo=Da.placedGlyphBoxes,Oo&&Oo.box&&Oo.box.length)){vn=!0,rn=Da.shift;break}}return Oo};Ri(()=>Di(po,hn.iconBox,s.bI.horizontal),()=>{const _i=hn.verticalTextBox;return _i&&fo(_i),E.allowVerticalPlacement&&!(xn&&xn.box&&xn.box.length)&&Ir>0&&_i?Di(_i,hn.verticalIconBox,s.bI.vertical):{box:null,offscreen:null,occluded:null}}),xn&&(vn=xn.box,kr=xn.offscreen,mn=xn.occluded);const Ks=si(!(!xn||!xn.box));if(!vn&&this.prevPlacement){const _i=this.prevPlacement.variableOffsets[Zn];_i&&(this.variableOffsets[Zn]=_i,this.markUsedJustification(E,_i.anchor,vr,Ks))}}else{const Un=(Di,Ks)=>{const _i=E.getSymbolInstanceTextSize(ue,vr,this.transform.zoom,un,b),Mo=this.collisionIndex.placeCollisionBox(E,_i,Di,te,ee,Zt,new s.P(0,0),be,K,z,me.predicate);return Mo&&Mo.box&&Mo.box.length&&(this.markUsedOrientation(E,Ks,vr),this.placedOrientations[Zn]=Ks),Mo};Ri(()=>Un(po,s.bI.horizontal),()=>{const Di=hn.verticalTextBox;return E.allowVerticalPlacement&&Ir>0&&Di?(fo(Di),Un(Di,s.bI.vertical)):{box:null,offscreen:null,occluded:null}}),si(!!(xn&&xn.box&&xn.box.length))}}if(Ei=xn,vn=Ei&&Ei.box&&Ei.box.length>0,kr=Ei&&Ei.offscreen,mn=Ei&&Ei.occluded,vr.useRuntimeCollisionCircles){const si=E.text.placedSymbolArray.get(vr.centerJustifiedTextSymbolIndex>=0?vr.centerJustifiedTextSymbolIndex:vr.verticalPlacedTextSymbolIndex),Ri=s.bJ(E.textSizeData,ue,si),Un=C.get("text-padding");Oi=this.collisionIndex.placeCollisionCircles(E,be,si,E.lineVertexArray,E.glyphOffsetArray,Ri,z,F,H,g,De,me.predicate,vr.collisionCircleDiameter*Ri/s.bU,Un,this.retainedQueryData[E.bucketInstanceId].tileID),vn=be||Oi.circles.length>0&&!Oi.collisionDetected,kr=kr&&Oi.offscreen,mn=Oi.occluded}if(hn.iconFeatureIndex&&($o=hn.iconFeatureIndex),hn.iconBox){const si=Ri=>{fo(Ri);const Un=vr.hasIconTextFit&&rn?_n(rn.x,rn.y,Ee,De,this.transform.angle):new s.P(0,0),Di=E.getSymbolInstanceIconSize(pe,this.transform.zoom,vr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Di,Ri,te,ee,er,Un,Se,K,z,me.predicate)};Ln&&Ln.box&&Ln.box.length&&hn.verticalIconBox?(ji=si(hn.verticalIconBox),hi=ji.box.length>0):(ji=si(hn.iconBox),hi=ji.box.length>0),kr=kr&&ji.offscreen,mi=ji.occluded}const Go=we||vr.numHorizontalGlyphVertices===0&&Ir===0,ja=Ce||vr.numIconVertices===0;if(Go||ja?ja?Go||(hi=hi&&vn):vn=hi&&vn:hi=vn=hi&&vn,vn&&Ei&&Ei.box&&this.collisionIndex.insertCollisionBox(Ei.box,C.get("text-ignore-placement"),E.bucketInstanceId,Ln&&Ln.box&&ca?ca:Rs,me.ID),hi&&ji&&this.collisionIndex.insertCollisionBox(ji.box,C.get("icon-ignore-placement"),E.bucketInstanceId,$o,me.ID),Oi&&(vn&&this.collisionIndex.insertCollisionCircles(Oi.circles,C.get("text-ignore-placement"),E.bucketInstanceId,Rs,me.ID),g)){const si=E.bucketInstanceId;let Ri=this.collisionCircleArrays[si];Ri===void 0&&(Ri=this.collisionCircleArrays[si]=new kv);for(let Un=0;Un<Oi.circles.length;Un+=4)Ri.circles.push(Oi.circles[Un+0]),Ri.circles.push(Oi.circles[Un+1]),Ri.circles.push(Oi.circles[Un+2]),Ri.circles.push(Oi.collisionDetected?1:0)}const Ra=E.projection.name!=="globe";nr=nr&&(Ra||!mn),wr=wr&&(Ra||!mi),this.placements[Zn]=new ia(vn||nr,hi||wr,kr||E.justReloaded),u.add(Zn)},Pn=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,Pn),E.elevationType==="road"&&E.updateRoadElevation(Pn.canonical),E.updateZOffset(),E.sortFeaturesByY){const vr=E.getSortedSymbolIndexes(this.transform.angle);for(let un=vr.length-1;un>=0;--un){const hn=vr[un];Nr(E.symbolInstances.get(hn),hn,E.collisionArrays[hn])}E.hasAnyZOffset&&s.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const vr=E.getSortedIndexesByZOffset();for(let un=0;un<vr.length;++un){const hn=vr[un];Nr(E.symbolInstances.get(hn),hn,E.collisionArrays[hn])}}else for(let vr=o.symbolInstanceStart;vr<o.symbolInstanceEnd;vr++)Nr(E.symbolInstances.get(vr),vr,E.collisionArrays[vr]);if(g&&E.bucketInstanceId in this.collisionCircleArrays){const vr=this.collisionCircleArrays[E.bucketInstanceId];s.bi(vr.invProjMatrix,z),vr.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(o,u,g,x){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:M,crossTileID:z}=g,F=s.b$(u),H=x===s.bI.vertical?M:F==="left"?b:F==="center"?E:F==="right"?C:-1;b>=0&&(o.text.placedSymbolArray.get(b).crossTileID=H>=0&&b!==H?0:z),E>=0&&(o.text.placedSymbolArray.get(E).crossTileID=H>=0&&E!==H?0:z),C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=H>=0&&C!==H?0:z),M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=H>=0&&M!==H?0:z)}markUsedOrientation(o,u,g){const x=u===s.bI.horizontal||u===s.bI.horizontalOnly?u:0,b=u===s.bI.vertical?u:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:z}=g,F=o.text.placedSymbolArray;E>=0&&(F.get(E).placedOrientation=x),C>=0&&(F.get(C).placedOrientation=x),M>=0&&(F.get(M).placedOrientation=x),z>=0&&(F.get(z).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const x=u?u.symbolFadeChange(o):1,b=u?u.opacities:{},E=u?u.variableOffsets:{},C=u?u.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],F=b[M];F?(this.opacities[M]=new Bu(F,x,z.text,z.icon,null,z.clipped),g=g||z.text!==F.text.placed||z.icon!==F.icon.placed):(this.opacities[M]=new Bu(null,x,z.text,z.icon,z.skipFade,z.clipped),g=g||z.text||z.icon)}for(const M in b){const z=b[M];if(!this.opacities[M]){const F=new Bu(z,x,!1,!1);F.isHidden()||(this.opacities[M]=F,g=g||z.text.placed||z.icon.placed)}}for(const M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(const M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);g?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u,g,x){const b=new Set;for(const E of u){const C=E.getBucket(o);C&&E.latestFeatureIndex&&o.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,b,E,E.collisionBoxArray,g,x,E.tileID,o.scope),C.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,E.tileID),C.elevationType==="road"&&C.updateRoadElevation(E.tileID.canonical),C.updateZOffset())}}updateBucketOpacities(o,u,g,x,b,E,C,M){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const z=o.layers[0].layout,F=o.layers[0].paint,H=!!o.layers[0].dynamicFilter(),$=new Bu(null,0,!1,!1,!0),K=z.get("text-allow-overlap"),te=z.get("icon-allow-overlap"),ee=z.get("text-variable-anchor"),re=z.get("text-rotation-alignment")==="map",ie=z.get("text-pitch-alignment")==="map",ue=F.get("symbol-z-offset"),pe=z.get("symbol-elevation-reference")==="sea",me=!ue.isConstant(),Te=new Bu(null,0,K&&(te||!o.hasIconData()||z.get("icon-optional")),te&&(K||!o.hasTextData()||z.get("text-optional")),!0);!o.collisionArrays&&x&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(x);const we=(be,Se,Ee)=>{for(let Ue=0;Ue<Se/4;Ue++)be.opacityVertexArray.emplaceBack(Ee)};let Ce=0;E&&o.updateReplacement(C,E);for(let be=0;be<o.symbolInstances.length;be++){const Se=o.symbolInstances.get(be),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Ue,crossTileID:De,numIconVertices:dt,tileAnchorX:Je,tileAnchorY:pt}=Se;let Pt=null;const qe=this.retainedQueryData[o.bucketInstanceId];me&&Se&&qe&&(Pt=g.latestFeatureIndex.loadFeature({featureIndex:Se.featureIndex,bucketIndex:qe.bucketIndex,sourceLayerIndex:qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Re=ue.evaluate(Pt,{}),nt=u.has(De);let Ze=this.opacities[De];nt?Ze=$:Ze||(Ze=Te,this.opacities[De]=Ze),u.add(De);const yt=Ee>0||Ue>0,bt=dt>0,Et=this.placedOrientations[De],jt=Et===s.bI.vertical,tr=Et===s.bI.horizontal||Et===s.bI.horizontalOnly;!yt&&!bt||Ze.isHidden()||Ce++;let ir=!1;if((yt||bt)&&E)for(const Zt of o.activeReplacements){if(s.bV(Zt,b,s.bW.Symbol,M)||Zt.min.x>Je||Je>Zt.max.x||Zt.min.y>pt||pt>Zt.max.y)continue;const er=s.bX(Je,pt,C.canonical,Zt.footprintTileId.canonical);if(ir=s.bY(er,Zt.footprint),ir)break}if(yt){const Zt=ir?Dc:Xh(Ze.text);we(o.text,Ee,jt?Dc:Zt),we(o.text,Ue,tr?Dc:Zt);const er=Ze.text.isHidden(),{leftJustifiedTextSymbolIndex:nr,centerJustifiedTextSymbolIndex:wr,rightJustifiedTextSymbolIndex:Pr,verticalPlacedTextSymbolIndex:Nr}=Se,Pn=o.text.placedSymbolArray,vr=er||jt?1:0;nr>=0&&(Pn.get(nr).hidden=vr),wr>=0&&(Pn.get(wr).hidden=vr),Pr>=0&&(Pn.get(Pr).hidden=vr),Nr>=0&&(Pn.get(Nr).hidden=er||tr?1:0);const un=this.variableOffsets[De];un&&this.markUsedJustification(o,un.anchor,Se,Et);const hn=this.placedOrientations[De];hn&&(this.markUsedJustification(o,"left",Se,hn),this.markUsedOrientation(o,hn,Se))}if(bt){const Zt=ir?Dc:Xh(Ze.icon),{placedIconSymbolIndex:er,verticalPlacedIconSymbolIndex:nr}=Se,wr=o.icon.placedSymbolArray,Pr=Ze.icon.isHidden()?1:0;er>=0&&(we(o.icon,dt,jt?Dc:Zt),wr.get(er).hidden=Pr),nr>=0&&(we(o.icon,Se.numVerticalIconVertices,tr?Dc:Zt),wr.get(nr).hidden=Pr)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Zt=o.collisionArrays[be];if(Zt){let er=new s.P(0,0),nr=!0;if(Zt.textBox||Zt.verticalTextBox){if(ee){const Pr=this.variableOffsets[De];Pr?(er=yn(Pr.anchor,Pr.width,Pr.height,Pr.textOffset,Pr.textScale),re&&er._rotate(ie?this.transform.angle:-this.transform.angle)):nr=!1}H&&(nr=!Ze.clipped),Zt.textBox&&Zl(o.textCollisionBox.collisionVertexArray,Ze.text.placed,!nr||jt,Re,pe,er.x,er.y),Zt.verticalTextBox&&Zl(o.textCollisionBox.collisionVertexArray,Ze.text.placed,!nr||tr,Re,pe,er.x,er.y)}const wr=nr&&!!(!tr&&Zt.verticalIconBox);Zt.iconBox&&Zl(o.iconCollisionBox.collisionVertexArray,Ze.icon.placed,wr,Re,pe,Se.hasIconTextFit?er.x:0,Se.hasIconTextFit?er.y:0),Zt.verticalIconBox&&Zl(o.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!wr,Re,pe,Se.hasIconTextFit?er.x:0,Se.hasIconTextFit?er.y:0)}}}if(o.fullyClipped=Ce===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=be.invProjMatrix,o.placementViewportMatrix=be.viewportMatrix,o.collisionCircleArray=be.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function Zl(m,o,u,g,x,b,E){m.emplaceBack(o?1:0,u?1:0,b||0,E||0,g,x?1:0),m.emplaceBack(o?1:0,u?1:0,b||0,E||0,g,x?1:0),m.emplaceBack(o?1:0,u?1:0,b||0,E||0,g,x?1:0),m.emplaceBack(o?1:0,u?1:0,b||0,E||0,g,x?1:0)}const En=Math.pow(2,25),qm=Math.pow(2,24),Hf=Math.pow(2,17),Wf=Math.pow(2,16),Hs=Math.pow(2,9),Zi=Math.pow(2,8),TP=Math.pow(2,1);function Xh(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const o=m.placed?1:0,u=Math.floor(127*m.opacity);return u*En+o*qm+u*Hf+o*Wf+u*Hs+o*Zi+u*TP+o}const Dc=0;class qf{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,u,g,x,b,E){const C=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(C,x,o[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((M,z)=>M.sortKey-z.sortKey));this._currentPartIndex<C.length;){const M=C[this._currentPartIndex];if(u.placeLayerBucketPart(M,this._seenCrossTileIDs,g,M.symbolInstanceStart===0,E),this._currentPartIndex++,b())return!0}return!1}}class Zm{constructor(o,u,g,x,b,E,C,M,z){this.placement=new Vo(o,b,E,C,M,z),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,u,g,x,b){const E=s.q.now(),C=()=>{const M=s.q.now()-E;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=u[o[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=z)&&(!M.maxzoom||M.maxzoom>z)){const F=M,H=F.layout.get("symbol-z-elevate"),$=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,K=F.layout.get("symbol-z-order"),te=K==="viewport-y"||K==="auto"&&!(K!=="viewport-y"&&$),ee=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),re=te&&ee,ie=this._inProgressLayer=this._inProgressLayer||new qf(F),ue=s.C(M.source,M.scope);if(ie.continuePlacement(H||re?x[ue]:g[ue],this.placement,this._showCollisionBoxes,M,C,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Zf=512/s.aj/2;class Km{constructor(o,u,g){this.tileID=o,this.bucketInstanceId=g,this.index=new s.c0(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=o.canonical.x*s.aj,b=o.canonical.y*s.aj;for(let E=0;E<u.length;E++){const{key:C,crossTileID:M,tileAnchorX:z,tileAnchorY:F}=u.get(E),H=Math.floor((x+z)*Zf),$=Math.floor((b+F)*Zf);this.index.add(H,$),this.keys.push(C),this.crossTileIDs.push(M)}this.index.finish()}findMatches(o,u,g){const x=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),b=Zf/Math.pow(2,u.canonical.z-this.tileID.canonical.z),E=u.canonical.x*s.aj,C=u.canonical.y*s.aj;for(let M=0;M<o.length;M++){const z=o.get(M);if(z.crossTileID)continue;const{key:F,tileAnchorX:H,tileAnchorY:$}=z,K=Math.floor((E+H)*b),te=Math.floor((C+$)*b),ee=this.index.range(K-x,te-x,K+x,te+x).sort((re,ie)=>re-ie);for(const re of ee){const ie=this.crossTileIDs[re];if(this.keys[re]===F&&!g.has(ie)){g.add(ie),z.crossTileID=ie;break}}}}}class lo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(u!==0)for(const g in this.indexes){const x=this.indexes[g],b={};for(const E in x){const C=x[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+u),b[C.tileID.key]=C}this.indexes[g]=b}this.lng=o}addBucket(o,u,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const x=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>o.overscaledZ)for(const C in E){const M=E[C];M.tileID.isChildOf(o)&&M.findMatches(u.symbolInstances,o,x)}else{const C=E[o.scaledTo(Number(b)).key];C&&C.findMatches(u.symbolInstances,o,x)}}for(let b=0;b<u.symbolInstances.length;b++){const E=u.symbolInstances.get(b);E.crossTileID||(E.crossTileID=g.generate(),x.add(E.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Km(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const g of u.crossTileIDs)this.usedCrossTileIDs[o].delete(g)}removeStaleBuckets(o){let u=!1;for(const g in this.indexes){const x=this.indexes[g];for(const b in x)o[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[b]),delete x[b],u=!0)}return u}}class ko{constructor(){this.layerIndexes={},this.crossTileIDs=new lo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,g,x){let b=this.layerIndexes[o.fqid];b===void 0&&(b=this.layerIndexes[o.fqid]=new Kl);let E=!1;const C={};x.name!=="globe"&&b.handleWrapJump(g);for(const M of u){const z=M.getBucket(o);z&&o.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(M.tileID,z,this.crossTileIDs)&&(E=!0),C[z.bucketInstanceId]=!0)}return b.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(o){const u={};o.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const Vu=771;class Or{constructor(o,u,g,x){this.blendFunction=o,this.blendColor=u.toNonPremultipliedRenderColor(null),this.mask=g,this.blendEquation=x}}Or.Replace=[1,0,1,0],Or.disabled=new Or(Or.Replace,s.am.transparent,[!1,!1,!1,!1]),Or.unblended=new Or(Or.Replace,s.am.transparent,[!0,!0,!0,!0]),Or.alphaBlended=new Or([1,Vu,1,Vu],s.am.transparent,[!0,!0,!0,!0]),Or.alphaBlendedNonPremultiplied=new Or([770,Vu,770,Vu],s.am.transparent,[!0,!0,!0,!0]),Or.multiply=new Or([774,0,774,0],s.am.transparent,[!0,!0,!0,!0]);class Wt{constructor(o,u,g){this.func=o,this.mask=u,this.range=g}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const ka=7680;class mr{constructor(o,u,g,x,b,E){this.test=o,this.ref=u,this.mask=g,this.fail=x,this.depthFail=b,this.pass=E}}mr.disabled=new mr({func:519,mask:0},0,0,ka,ka,ka);const Ui=1029,Kf=2305;class ur{constructor(o,u,g){this.enable=o,this.mode=u,this.frontFace=g}}function Yh(m,o){const u=s.c6(m,3);s.c8(m,o),s.cc(m,3,u)}function Jh(m,o){const u=s.c3([]);return s.c4(u,u,-o),s.c5(u,u,-m),u}function Lc(m,o){const u=[m[0],m[1],0],g=[o[0],o[1],0];if(s.ae(u)>=1e-15){const E=s.au([],u);s.c1(g,E,s.bG(g,E)),o[0]=g[0],o[1]=g[1]}const x=s.bF([],o,m);if(s.c2(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return Jh(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),b)}ur.disabled=new ur(!1,Ui,Kf),ur.backCCW=new ur(!0,Ui,Kf),ur.backCW=new ur(!0,Ui,2304),ur.frontCW=new ur(!0,1028,2304),ur.frontCCW=new ur(!0,1028,Kf);class x1{constructor(o,u){this.position=o,this.orientation=u}get position(){return this._position}set position(o){if(o){const u=o instanceof s.ac?o:new s.ac(o[0],o[1],o[2]);this._renderWorldCopies&&(u.x=s.bQ(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(o,u){if(this.orientation=null,!this.position)return;const g=this.position,x=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(o)):0,b=s.ac.fromLngLat(o,x),E=[b.x-g.x,b.y-g.y,b.z-g.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Lc(E,u)}setPitchBearing(o,u){this.orientation=Jh(s.al(o),s.al(-u))}}class Pa{constructor(o,u){this._transform=s.bx([]),this.orientation=u,this.position=o}get mercatorPosition(){const o=this.position;return new s.ac(o[0],o[1],o[2])}get position(){const o=s.c6(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var u;o&&s.cc(this._transform,3,[(u=o)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||s.c3([]),o&&Yh(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,u){this._orientation=Jh(o,u),Yh(this._transform,this._orientation)}forward(){const o=s.c6(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=s.c6(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=s.c6(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,u){const g=new Float64Array(16);return s.bi(g,this.getWorldToCamera(o,u)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,u,g){const x=this.position;s.c1(x,x,-o);const b=new Float64Array(16);return s.bn(b,[g,g,g]),s.bo(b,b,x),b[10]*=u,b}getWorldToCamera(o,u){const g=new Float64Array(16),x=new Float64Array(4),b=this.position;return s.c7(x,this._orientation),s.c1(b,b,-o),s.c8(g,x),s.bo(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(o,u,g,x){const b=new Float64Array(16);return s.c9(b,o,u,g,x),b}getCameraToClipOrthographic(o,u,g,x,b,E){const C=new Float64Array(16);return s.ca(C,o,u,g,x,b,E),C}getDistanceToElevation(o,u=!1){const g=o===0?0:s.cb(o,u?s.aY(this.position[1]):this.position[1]),x=this.forward();return(g-this.position[2])/x[2]}clone(){return new Pa([...this.position],[...this.orientation])}}const co={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Xf{constructor(o=0,u=0,g=0,x=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=g,this.right=x}interpolate(o,u,g){return u.top!=null&&o.top!=null&&(this.top=s.ai(o.top,u.top,g)),u.bottom!=null&&o.bottom!=null&&(this.bottom=s.ai(o.bottom,u.bottom,g)),u.left!=null&&o.left!=null&&(this.left=s.ai(o.left,u.left,g)),u.right!=null&&o.right!=null&&(this.right=s.ai(o.right,u.right,g)),this}getCenter(o,u){const g=s.ay((this.left+o-this.right)/2,0,o),x=s.ay((this.top+u-this.bottom)/2,0,u);return new s.P(g,x)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Xf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ws=15;class Pv{constructor(o,u,g,x,b,E,C){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=g??0,this._maxPitch=x??60,this.setProjection(E),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new s.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Xf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Pa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new Pv(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ws}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,u=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(o||g)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return s.aF(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=s.cj(this.projectionOptions);const g=this.getProjection(),x=!s.bv(u,g);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cj({name:"mercator"});const u=o!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bQ(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const u=-o*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=s.ck(),s.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const u=s.ay(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=s.al(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const u=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,b=0;for(let E=0;E<u.length;E++){const C=new s.P(u[E][0]*this.width,g+u[E][1]*(this.height-g)),M=o.pointCoordinate(C);if(!M)continue;const z=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);x+=M[3]*z,b+=z}return b===0?NaN:x/b}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,x=this._mercatorZfromZoom(o),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-g,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[u.x,u.y,u.z]:[o.x,o.y,o.z];const x=s.ae(s.at([],this._camera.position,g));return s.ay(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let u=!1;if(o.orientation&&!s.cm(o.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];s.cn(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,u=new x1;return u.position=new s.ac(o[0],o[1],o[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(o){if(!s.co(o))return!1;s.cp(o,o);const u=s.cq([],[0,0,-1],o),g=s.cq([],[0,-1,0],o);if(g[2]<0)return!1;const x=Lc(u,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(o){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;o[2]=s.ay(o[2],x/g,x/u),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,g){this._unmodified=!1,this._edgeInsets.interpolate(o,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const u=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(o){const u=[new s.cr(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new s.P(0,0)),x=this.pointCoordinate(new s.P(this.width,0)),b=this.pointCoordinate(new s.P(this.width,this.height)),E=this.pointCoordinate(new s.P(0,this.height)),C=Math.floor(Math.min(g.x,x.x,b.x,E.x)),M=Math.floor(Math.max(g.x,x.x,b.x,E.x)),z=1;for(let F=C-z;F<=M+z;F++)F!==0&&u.push(new s.cr(F,o))}return u}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,u,g){let x=[];const b=g!=null,E=!b;if(E&&this.zoom<u||b&&g[0]===0&&g[1]===0)return x;const C=new Set,M=(F,H,$,K,te)=>{const ee=s.cV(H,F,$,K,te);C.has(ee)||(x.push(new s.aM(F,H,$,K,te)),C.add(ee))};for(let F=0;F<o.length;F++){const H=o[F];if(E&&H.canonical.z!==u)continue;const $=H.canonical,K=H.overscaledZ,te=H.wrap,ee=1<<$.z,re=$.x+1<ee,ie=$.x>0,ue=$.y+1<ee,pe=$.y>0,me=H.wrap-(ie?0:1),Te=H.wrap+(re?0:1),we=ie?$.x-1:ee-1,Ce=re?$.x+1:0;if(b)g[0]<0?(M(K,Te,$.z,Ce,$.y),g[1]<0&&ue&&(M(K,te,$.z,$.x,$.y+1),M(K,Te,$.z,Ce,$.y+1)),g[1]>0&&pe&&(M(K,te,$.z,$.x,$.y-1),M(K,Te,$.z,Ce,$.y-1))):g[0]>0?(M(K,me,$.z,we,$.y),g[1]<0&&ue&&(M(K,te,$.z,$.x,$.y+1),M(K,me,$.z,we,$.y+1)),g[1]>0&&pe&&(M(K,te,$.z,$.x,$.y-1),M(K,me,$.z,we,$.y-1))):g[1]<0&&ue?M(K,te,$.z,$.x,$.y+1):pe&&M(K,te,$.z,$.x,$.y-1);else{const be=H.visibleQuadrants;1&be&&(M(K,me,$.z,we,$.y),pe&&(M(K,te,$.z,$.x,$.y-1),M(K,me,$.z,we,$.y-1))),2&be&&(M(K,Te,$.z,Ce,$.y),pe&&(M(K,te,$.z,$.x,$.y-1),M(K,Te,$.z,Ce,$.y-1))),4&be&&(M(K,me,$.z,we,$.y),ue&&(M(K,te,$.z,$.x,$.y+1),M(K,me,$.z,we,$.y+1))),8&be&&(M(K,Te,$.z,Ce,$.y),ue&&(M(K,te,$.z,$.x,$.y+1),M(K,Te,$.z,Ce,$.y+1)))}}const z=[];for(const F of x)x.some(H=>F.isChildOf(H))||z.push(F);if(x=z.filter(F=>!o.some(H=>!!(F.overscaledZ<u&&H.isChildOf(F))||F.equals(H)||F.isChildOf(H))),E){const F=1<<u,H=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=[F*H.x,F*H.y],K=4,te=K*K;x=x.filter(ee=>{const re=ee.canonical.x+.5-$[0],ie=ee.canonical.y+.5-$[1];return re*re+ie*ie<te})}return x}extendTileCoverToNearPlane(o,u,g){const x=[],b=new Set;for(const ue of o)b.add(ue.key);const E=(ue,pe,me,Te,we)=>{const Ce=s.cV(pe,ue,me,Te,we);b.has(Ce)||(x.push(new s.aM(ue,pe,me,Te,we)),b.add(Ce))},C=o.reduce((ue,pe)=>Math.max(ue,pe.overscaledZ),g),M=1<<g,z=[new s.P(0,0),new s.P(s.aj,0),new s.P(s.aj,s.aj),new s.P(0,s.aj)],F=new s.P(0,0),H=new s.P(0,0),$=(ue,pe)=>{const me=Math.floor(ue[0]),Te=Math.floor(ue[1]),we=(ue[0]-me)*s.aj,Ce=(ue[1]-Te)*s.aj,be=Math.floor(pe[0]),Se=Math.floor(pe[1]),Ee=(pe[0]-be)*s.aj,Ue=(pe[1]-Se)*s.aj;for(let De=-1;De<=1;De++){const dt=me+De;if(!(dt<0||dt>=M)){F.x=we-De*s.aj,H.x=Ee-(dt-be)*s.aj;for(let Je=-1;Je<=1;Je++){const pt=Te+Je;F.y=Ce-Je*s.aj,H.y=Ue-(pt-Se)*s.aj,s.cW(F,H,z)&&E(C,0,g,dt,pt)}}}},K=u.points,te=K[s.cs],ee=K[s.ct],re=this._projectToGround(te,K[s.cu]),ie=this._projectToGround(ee,K[s.cv]);return $(te,re),$(ee,ie),x}_projectToGround(o,u){return s.cw(s.cx(),o,u,o[2]/(o[2]-u[2]))}coveringTiles(o){let u=this.coveringZoomLevel(o);const g=u,x=this.elevation&&this.elevation.exaggeration(),b=x&&!o.isTerrainDEM,E=this.projection.name==="mercator";if(o.minzoom!==void 0&&u<o.minzoom)return[];o.maxzoom!==void 0&&u>o.maxzoom&&(u=o.maxzoom);const C=this.locationCoordinate(this.center),M=this.center.lat,z=1<<u,F=[z*C.x,z*C.y,0],H=this.projection.name==="globe",$=!H,K=s.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,$),te=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=z*s.cb(1,this.center.lat),re=this._camera.position[2]/s.cb(1,this.center.lat),ie=[z*te.x,z*te.y,re*($?1:ee)],ue=H||x,pe=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),me=this.isLODDisabled(!0)?u:0;let Te;if(this._elevation&&o.isTerrainDEM)Te=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();Te=Re?Re.max:this._centerAltitude}else Te=this._centerAltitude;const we=o.isTerrainDEM?-Te:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ce=this.projection.isReprojectedInTileSpace?s.cz(this):1,be=Re=>{const nt=new s.ac(Re.x+25e-6,Re.y,Re.z),Ze=new s.ac(Re.x,Re.y+25e-6,Re.z),yt=Re.toLngLat(),bt=nt.toLngLat(),Et=Ze.toLngLat(),jt=this.locationCoordinate(yt),tr=this.locationCoordinate(bt),ir=this.locationCoordinate(Et),Zt=Math.hypot(tr.x-jt.x,tr.y-jt.y),er=Math.hypot(ir.x-jt.x,ir.y-jt.y);return Math.sqrt(Zt*er)*Ce/25e-6},Se=Re=>{const nt=Te,Ze=we;return{aabb:s.cC(this,z,0,0,0,Re,Ze,nt,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:nt,wrap:Re,fullyVisible:!1}},Ee=[];let Ue=[];const De=u,dt=o.reparseOverscaled?g:u,Je=(re-this._centerAltitude)*ee,pt=Re=>{if(!this._elevation||!Re.tileID||!E)return;const nt=this._elevation.getMinMaxForTile(Re.tileID),Ze=Re.aabb;nt?(Ze.min[2]=nt.min,Ze.max[2]=nt.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(Re.shouldSplit=qe(Re),Re.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Pt=(Re,nt)=>{if(.707*nt<Re)return 1;const Ze=nt/Re;return Ze/(1.4144271570014144+(Math.pow(1.1,Ze-1.4144271570014144+1)-1)/(1.1-1)-1)},qe=Re=>{if(Re.zoom<me)return!0;if(Re.zoom===De)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const nt=Re.aabb.distanceX(ie),Ze=Re.aabb.distanceY(ie);let yt=Je,bt=1;if(H){yt=Re.aabb.distanceZ(ie);const nr=Math.pow(2,Re.zoom),wr=s.aY((Re.y+1)/nr),Pr=s.aY(Re.y/nr),Nr=Math.min(Math.max(M,wr),Pr),Pn=s.c_(Nr)/s.c_(M);if(bt=Nr===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pn/this._mercatorScaleRatio),this.zoom<=s.cX&&Re.zoom===De-1&&Pn>=.9)return!0}else if(b&&(yt=Re.aabb.distanceZ(ie)*ee),this.projection.isReprojectedInTileSpace&&g<=5){const nr=Math.pow(2,Re.zoom),wr=be(new s.ac((Re.x+.5)/nr,(Re.y+.5)/nr));bt=wr>.85?1:wr}if(!E){const nr=Math.sqrt(nt*nt+Ze*Ze+yt*yt);let wr=(1<<De-Re.zoom)*pe*bt;return wr*=Pt(Math.max(yt,Je),nr),nr<wr}let Et=Number.MAX_VALUE,jt=0;const tr=Re.aabb.getCorners(),ir=[];for(const nr of tr){s.at(ir,nr,ie),H||(b?ir[2]*=ee:ir[2]=Je);const wr=s.bG(ir,this._camera.forward());wr<Et&&(Et=wr,jt=Math.abs(ir[2]))}let Zt=(1<<De-Re.zoom)*pe*bt;if(Zt*=Pt(Math.max(jt,Je),Et),Et<Zt)return!0;const er=Re.aabb.closestPoint(F);return er[0]===F[0]&&er[1]===F[1]};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Ee.push(Se(-Re)),Ee.push(Se(Re));for(Ee.push(Se(0));Ee.length>0;){const Re=Ee.pop(),nt=Re.x,Ze=Re.y;let yt=Re.fullyVisible;const bt=()=>this.projection.name==="globe"&&(Re.y===0||Re.y===(1<<Re.zoom)-1);if(!yt){let Et=ue?Re.aabb.intersects(K):Re.aabb.intersectsFlat(K);if(Et===0&&bt()){const jt=new s.cA(Re.zoom,nt,Ze);Et=s.cB(this,z,jt,!0).intersects(K)}if(Et===0)continue;yt=Et===2}if(Re.zoom!==De&&qe(Re))for(let Et=0;Et<4;Et++){const jt=(nt<<1)+Et%2,tr=(Ze<<1)+(Et>>1),ir={aabb:E?Re.aabb.quadrant(Et):s.cC(this,z,Re.zoom+1,jt,tr,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:jt,y:tr,wrap:Re.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};b&&!H&&(ir.tileID=new s.aM(Re.zoom+1===De?dt:Re.zoom+1,Re.wrap,Re.zoom+1,jt,tr),pt(ir)),Ee.push(ir)}else{const Et=Re.zoom===De?dt:Re.zoom;if(o.minzoom&&o.minzoom>Et)continue;let jt=0;if(!yt){let er=ue?Re.aabb.intersectsPrecise(K):Re.aabb.intersectsPreciseFlat(K);if(er===0&&bt()){const nr=new s.cA(Re.zoom,nt,Ze);er=s.cB(this,z,nr,!0).intersectsPrecise(K)}if(er===0)continue;if(o.calculateQuadrantVisibility)if(K.containsPoint(Re.aabb.center))jt=15;else for(let nr=0;nr<4;nr++)Re.aabb.quadrant(nr).intersects(K)!==0&&(jt|=1<<nr)}const tr=F[0]-(.5+nt+(Re.wrap<<Re.zoom))*(1<<u-Re.zoom),ir=F[1]-.5-Ze,Zt=Re.tileID?Re.tileID:new s.aM(Et,Re.wrap,Re.zoom,nt,Ze);o.calculateQuadrantVisibility&&(Zt.visibleQuadrants=jt),Ue.push({tileID:Zt,distanceSq:tr*tr+ir*ir})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,nt=this.horizonLineFromTop();Ue=Ue.filter(Ze=>{const yt=[0,0,0,1],bt=[s.aj,s.aj,0,1],Et=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());s.aA(yt,yt,Et),s.aA(bt,bt,Et);const jt=s.cD([],yt,bt),tr=s.cE([],yt,bt),ir=s.cY(jt,tr);if(ir===0)return!0;let Zt=!1;const er=this._elevation;if(er&&ir>Re&&nt!==0){const nr=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let wr;o.isTerrainDEM||(wr=er.getMinMaxForTile(Ze.tileID)),wr||(wr={min:we,max:Te});const Pr=s.cF(this.rotation),Nr=[Pr[0]*s.aj,Pr[1]*s.aj,wr.max];s.ad(Nr,Nr,nr),Zt=(1-Nr[1])*this.height*.5<nt}return ir<Re||Zt})}return Ue.sort((Re,nt)=>Re.distanceSq-nt.distanceSq).map(Re=>Re.tileID)}resize(o,u){this.width=o,this.height=u,this.pixelsToGLUnits=[2/o,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const u=s.ay(o.lat,-s.cG,s.cG),g=this.projection.project(o.lng,u);return new s.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,u){let g,x;const b=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;g=(u.x-b.x)/C,x=(u.y-b.y)/C}else{const C=this.pointCoordinate(u),M=this.pointCoordinate(b);g=C.x-M.x,x=C.y-M.y}const E=this.locationCoordinate(o);this.setLocation(new s.ac(E.x-g,E.y-x))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,u){return this.projection.locationPoint(this,o,u)}locationPoint3D(o,u){return this.projection.locationPoint(this,o,u,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,u){return this.coordinateLocation(this.pointCoordinate3D(o,u))}locationCoordinate(o,u){const g=u?s.cb(u,o.lat):void 0,x=this.projection.project(o.lng,o.lat);return new s.ac(x.x,x.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,u){const g=u??this._centerAltitude,x=[o.x,o.y,0,1],b=[o.x,o.y,1,1];s.aA(x,x,this.pixelMatrixInverse),s.aA(b,b,this.pixelMatrixInverse);const E=b[3];s.cH(x,x,1/x[3]),s.cH(b,b,1/E);const C=x[2],M=b[2];return{p0:x,p1:b,t:C===M?0:(g-C)/(M-C)}}screenPointToMercatorRay(o){const u=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return s.aA(u,u,this.pixelMatrixInverse),s.aA(g,g,this.pixelMatrixInverse),s.cH(u,u,1/u[3]),s.cH(g,g,1/g[3]),u[2]=s.cb(u[2],this._center.lat)*this.worldSize,g[2]=s.cb(g[2],this._center.lat)*this.worldSize,s.cH(u,u,1/this.worldSize),s.cH(g,g,1/this.worldSize),new s.av([u[0],u[1],u[2]],s.au([],s.at([],g,u)))}rayIntersectionCoordinate(o){const{p0:u,p1:g,t:x}=o,b=s.cb(u[2],this._center.lat),E=s.cb(g[2],this._center.lat);return new s.ac(s.ai(u[0],g[0],x)/this.worldSize,s.ai(u[1],g[1],x)/this.worldSize,s.ai(b,E,x))}pointCoordinate(o,u=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,u)}pointCoordinate3D(o,u){if(!this.elevation)return this.pointCoordinate(o,u);let g=this.projection.pointCoordinate3D(this,o.x,o.y);if(g)return new s.ac(g[0],g[1],g[2]);let x=0,b=this.horizonLineFromTop();if(o.y>b)return this.pointCoordinate(o,u);const E=.02*b,C=o.clone();for(let M=0;M<10&&b-x>E;M++){C.y=s.ai(x,b,.66);const z=this.projection.pointCoordinate3D(this,C.x,C.y);z?(b=C.y,g=z):x=C.y}return g?new s.ac(g[0],g[1],g[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=s.cI)return!this.isPointAboveHorizon(o);const u=this.pointCoordinate(o);return u.y>=0&&u.y<=1}_coordinatePoint(o,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,x=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return s.aA(x,x,this.pixelMatrix),x[3]>0?new s.P(x[0]/x[3],x[1]/x[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:u}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.P(u,o)),E=this.pointLocation3D(new s.P(x,o)),C=this.pointLocation3D(new s.P(x,g)),M=this.pointLocation3D(new s.P(u,g));let z=Math.min(b.lng,E.lng,C.lng,M.lng),F=Math.max(b.lng,E.lng,C.lng,M.lng),H=Math.min(b.lat,E.lat,C.lat,M.lat),$=Math.max(b.lat,E.lat,C.lat,M.lat);const K=Math.pow(2,-this.zoom)/16*270,te=this.projection.name==="globe"?1:4,ee=(re,ie,ue,pe,me)=>{const Te=(re+ue)/2,we=(ie+pe)/2,Ce=new s.P(Te,we),{lng:be,lat:Se}=this.pointLocation3D(Ce),Ee=Math.max(0,z-be,H-Se,be-F,Se-$);z=Math.min(z,be),F=Math.max(F,be),H=Math.min(H,Se),$=Math.max($,Se),(me<te||Ee>K)&&(ee(re,ie,Te,we,me+1),ee(Te,we,ue,pe,me+1))};if(ee(u,o,x,o,1),ee(x,o,x,g,1),ee(x,g,u,g,1),ee(u,g,u,o,1),this.projection.name==="globe"){const[re,ie]=s.cJ(this);re?($=90,F=180,z=-180):ie&&(H=-90,F=180,z=-180)}return new s.aG(new s.ci(z,H),new s.ci(F,$))}_getBoundsRectangular(o,u){const{top:g,left:x}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,C=new s.P(x,g),M=new s.P(E,g),z=new s.P(E,b),F=new s.P(x,b);let H=this.pointCoordinate(C,o),$=this.pointCoordinate(M,o);const K=this.pointCoordinate(z,u),te=this.pointCoordinate(F,u),ee=(re,ie)=>(ie.y-re.y)/(ie.x-re.x);return H.y>1&&$.y>=0?H=new s.ac((1-te.y)/ee(te,H)+te.x,1):H.y<0&&$.y<=1&&(H=new s.ac(-te.y/ee(te,H)+te.x,0)),$.y>1&&H.y>=0?$=new s.ac((1-K.y)/ee(K,$)+K.x,1):$.y<0&&H.y<=1&&($=new s.ac(-K.y/ee(K,$)+K.x,0)),new s.aG().extend(this.coordinateLocation(H)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(K))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=o.visibleDemTiles.reduce((g,x)=>{if(x.dem){const b=x.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*o.exaggeration(),u.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-s.cG,this.maxLat=s.cG,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aD(this.minLng)*this.tileSize,this.worldMaxX=s.aD(this.maxLng)*this.tileSize,this.worldMinY=s.aH(this.maxLat)*this.tileSize,this.worldMaxY=s.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,u){return this.projection.createTileMatrix(this,u,o)}calculateDistanceTileData(o){const u=o.key,g=this._distanceTileDataCache;if(g[u])return g[u];const x=o.canonical,b=1/this.height,E=this.cameraWorldSize,C=E/this.zoomScale(x.z),M=(x.x+Math.pow(2,x.z)*o.wrap)*C,z=x.y*C,F=this.point;F.x*=E/this.worldSize,F.y*=E/this.worldSize;const H=this.angle,$=Math.sin(-H),K=-Math.cos(-H);return g[u]={bearing:[$,K],center:[(F.x-M)*b,(F.y-z)*b],scale:C/s.aj*b},g[u]}calculateFogTileMatrix(o){const u=o.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return s.az(x,this.worldToFogMatrix,x),g[u]=new Float32Array(x),g[u]}calculateProjMatrix(o,u=!1,g=!1){const x=o.key;let b;if(b=g?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,b[x])return b[x];const E=this.calculatePosMatrix(o,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,s.az(E,C,E),b[x]=new Float32Array(E),b[x]}calculatePixelsToTileUnitsMatrix(o){const u=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const x=s.cK(o,this);return g[u]=x,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,u=s.bn([],[o,o,o]);return s.az(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const u=s.cb(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),x=this._camera.forward(),b=s.cb(1,this._center.lat);g[2]/=b,x[2]/=b,s.au(x,x);const E=o.raycast(g,x,o.exaggeration());if(E){const C=s.bE([],g,x,E),M=new s.ac(C[0],C[1],s.cb(C[2],s.aY(C[1]))),z=(M.z+s.ae([M.x-g[0],M.y-g[1],M.z-g[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const u=this._elevation,g=s.cb(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(g),b=u.getAtPointOrZero(new s.ac(...x)),E=this.pixelsPerMeter/this.worldSize*b,C=this._minimumHeightOverTerrain(),M=x[2]-E;if(M<=C)if(M<0||o){const z=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],z.z-x[2]],H=s.ae(F);F[2]-=(C-M)/this._pixelsPerMercatorPixel;const $=s.ae(F);if($===0)return;s.c1(F,F,H/$*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],z.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const $=this.center;return $.lat=s.ay($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&($.lng=s.ay($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const u=this._unmodified,{x:g,y:x}=this.point;let b=0,E=g,C=x;const M=this.width/2,z=this.height/2,F=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(x-z<F&&(C=F+z),x+z>H&&(C=H-z),H-F<this.height&&(b=Math.max(b,this.height/(H-F)),C=(H+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,te=this.worldSize/2-($+K)/2;E=(g+te+this.worldSize)%this.worldSize-te,E-M<$&&(E=$+M),E+M>K&&(E=K-M),K-$<this.width&&(b=Math.max(b,this.width/(K-$)),E=(K+$)/2)}E===g&&C===x||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(E,C))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,u=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cb(1,this.center.lat)/s.cb(1,s.c$));const x=s.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?g:1,E=this._camera.getWorldToCamera(this.worldSize,b);let C;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-o.x/this.width,M[9]=2*o.y/this.height,this.isOrthographic){let Se=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ee=Se*this.aspect,Ue=-Ee,De=-Se;Ee-=o.x,Ue-=o.x,Se+=o.y,De+=o.y,C=this._camera.getCameraToClipOrthographic(Ue,Ee,De,Se,this._nearZ,this._farZ),((dt,Je,pt,Pt)=>{for(let qe=0;qe<16;qe++)dt[qe]=s.ai(Je[qe],pt[qe],Pt)})(C,C,M,s.cZ(this.pitch>=ws?1:this.pitch/ws))}else C=M;const z=s.cM([],M,E);let F=s.cM([],C,E);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Ee=s.bx([]);s.bo(Ee,Ee,[Se.x*this.worldSize,Se.y*this.worldSize,0]),s.az(Ee,Ee,s.cN(this)),s.bo(Ee,Ee,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),s.az(F,F,Ee),s.az(z,z,Ee),this.inverseAdjustmentMatrix=s.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cP([],F,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=F,this.invProjMatrix=s.bi(new Float64Array(16),this.projMatrix),u){const Se=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Se[8]=2*-o.x/this.width,Se[9]=2*o.y/this.height,this.expandedFarZProjMatrix=s.cM([],Se,E)}else this.expandedFarZProjMatrix=this.projMatrix;const H=s.bi([],C);this.frustumCorners=s.cQ.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const $=new Float32Array(16);s.bx($),s.cP($,$,[1,-1,1]),s.cR($,$,this._pitch),s.by($,$,this.angle);const K=s.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bw(K);const te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;K[8]=2*-o.x/this.width,K[9]=2*(o.y+te)/this.height,this.skyboxMatrix=s.az($,K,$);const ee=this.point,re=ee.x,ie=ee.y,ue=this.width%2/2,pe=this.height%2/2,me=Math.cos(this.angle),Te=Math.sin(this.angle),we=re-Math.round(re)+me*ue+Te*pe,Ce=ie-Math.round(ie)+me*pe+Te*ue,be=new Float64Array(F);if(s.bo(be,be,[we>.5?we-1:we,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=be,F=s.bz(),s.cP(F,F,[this.width/2,-this.height/2,1]),s.bo(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=s.bz(),s.cP(F,F,[1,-1,1]),s.bo(F,F,[-1,-1,0]),s.cP(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=s.az(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},F=s.bi(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cS(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad(Se,Se,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,b=[o,o,u];s.c1(b,b,x),s.c1(g,g,-1),s.cT(g,g,b);const E=s.bz();s.bo(E,E,g),s.cP(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,u,x)}_computeCameraPosition(o){const u=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-o/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-g[0]*b,x.y/this.worldSize-g[1]*b,o/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],x=o[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(b=Math.min((u-g)/x,1)),this._camera.position=s.bE([],this._camera.position,o,b),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),b=s.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.al(this._maxPitch)),C=Math.max((o[2]-b)/Math.cos(g),E),M=this._zoomFromMercatorZ(C);s.bE(o,o,u,C),this._pitch=s.ay(g,s.al(this.minPitch),s.al(this.maxPitch)),this.angle=s.bQ(x,-Math.PI,Math.PI),this._setZoom(s.ay(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let u=0,g=s.cI,x=0,b=1/0;for(;g-u>1e-6&&g>u;){const E=u+.5*(g-u),C=this.tileSize*Math.pow(2,E),M=this.getCameraToCenterDistance(this.projection,E,C),z=this.scaleZoom(M/(Math.max(0,o)*this.tileSize)),F=Math.abs(E-z);F<b&&(b=F,x=E),E<z?u=E:g=E}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,u){const g=Math.min(o.x,u.x),x=Math.max(o.x,u.x),b=Math.min(o.y,u.y),E=Math.max(o.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new s.P(g,b),new s.P(x,E),new s.P(g,E),new s.P(x,b)],M=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const F of C){const H=this.pointRayIntersection(F);if(H.t<0)return!0;const $=this.rayIntersectionCoordinate(H);if($.x<M||$.y<0||$.x>z||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(o,u){const g=s.ae(s.at([],this._camera.position,o)),x=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([u,g,x],b){const E=[u,g,x,1];s.aA(E,E,b);const C=E[3]=Math.max(E[3],1e-6);return E[0]/=C,E[1]/=C,E[2]/=C,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,o))}}getCameraToCenterDistance(o,u=this.zoom,g=this.worldSize){const x=s.cL(o,u,this.width,this.height,1024),b=o.pixelSpaceConversion(this.center.lat,g,x);let E=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(E=s.ai(1,E,s.cZ(this.pitch>=ws?1:this.pitch/ws))),E}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.az(o,o,this.globeMatrix),o}getFrustum(o){return s.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const yl=(m,o)=>{if(o>0&&m.terrain&&s.w("Cutoff is currently disabled on terrain"),o<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=m.transform,g=Math.max(Math.abs(u._zoom-(m.minCutoffZoom-1)),1),x=u.isLODDisabled(!1)?s.af(60,45,u.pitch):s.af(30,15,u.pitch),b=u._farZ-u._nearZ,E=o*u.height,C=((1-(M=x))*u.cameraToCenterDistance+M*(u._farZ+E))*g;var M;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(C-u._nearZ)/b,(C-E-u._nearZ)/b]}}},Ws={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Yf{constructor(o,u){this.aabb=o,this.lastCascade=u}}class EP{add(o,u){const g=this.receivers[o.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],u.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],u.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],u.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],u.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],u.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],u.max[2])):this.receivers[o.key]=new Yf(u,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,u,g){const x=s.d6.fromPoints(o.points);let b=0;for(const E in this.receivers){const C=this.receivers[E];if(!C||!x.intersectsAabb(C.aabb))continue;C.aabb.min=x.closestPoint(C.aabb.min),C.aabb.max=x.closestPoint(C.aabb.max);const M=C.aabb.getCorners();for(let z=0;z<g.length;z++){let F=!0;for(const H of M){const $=[H[0]*u,H[1]*u,H[2]];if(s.ad($,$,g[z].matrix),$[0]<-1||$[0]>1||$[1]<-1||$[1]>1){F=!1;break}}if(C.lastCascade=z,b=Math.max(b,z),F)break}}return b+1}}class AP{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new EP,this._depthMode=new Wt(o.context.gl.LEQUAL,Wt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(Ws,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(Ws,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),o.tp.registerParameter(Ws,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,u){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;const x=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||x<=0||(this._shadowLayerCount=g.style.order.reduce((te,ee)=>{const re=g.style._mergedLayers[ee];return te+(re.hasShadowPass()&&!re.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=g.context,E=Ws.shadowMapResolution,C=Ws.shadowMapResolution;if(this._cascades.length===0||Ws.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let te=0;te<Ws.cascadeCount;++te){const ee=g._shadowMapDebug,re=b.gl,ie=b.createFramebuffer(E,C,ee,"texture"),ue=new s.T(b,{width:E,height:C,data:null},re.DEPTH_COMPONENT16);if(ie.depthAttachment.set(ue.texture),ee){const pe=new s.T(b,{width:E,height:C,data:null},re.RGBA8);ie.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:ie,texture:ue,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cy,scale:0})}}this.shadowDirection=Qh(u);let M=0;if(o.elevation){const te=o.elevation,ee=[1e4,-1e4];te.visibleDemTiles.filter(re=>re.dem).forEach(re=>{const ie=re.dem.tree;ee[0]=Math.min(ee[0],ie.minimums[0]),ee[1]=Math.max(ee[1],ie.maximums[0])}),ee[0]!==1e4&&(M=(ee[1]-ee[0])*te.exaggeration())}const z=1.5*o.cameraToCenterDistance,F=3*z,H=new Float64Array(16);for(let te=0;te<this._cascades.length;++te){const ee=this._cascades[te];let re=o.height/50,ie=1;Ws.cascadeCount===1?ie=F:te===0?ie=z:(re=z,ie=F);const[ue,pe]=ed(o,this.shadowDirection,re,ie,Ws.shadowMapResolution,M);ee.scale=o.scale,ee.matrix=ue,ee.boundingSphereRadius=pe,s.bi(H,ee.matrix),ee.frustum=s.cy.fromInvProjectionMatrix(H,1,0,!0),ee.far=ie}const $=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[$].far,this._cascades[$].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ws.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ws.shadowMapResolution,this._uniformValues.u_shadowmap_0=co.ShadowMap0,this._uniformValues.u_shadowmap_1=co.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const K=g.transform.elevation;for(const te of this._groundShadowTiles){let ee={min:0,max:0};if(K){const re=K.getMinMaxForTile(te);re&&(ee=re)}this.addShadowReceiver(te.toUnwrapped(),ee.min,ee.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,u){if(!this.enabled)return;const g=this.painter,x=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),x.viewport.set([0,0,Ws.shadowMapResolution,Ws.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){g.currentShadowCascade=b,x.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),x.clear({color:s.am.white,depth:1});for(const E of o.order){const C=o._mergedLayers[E];if(!C.hasShadowPass()||C.isHidden(g.transform.zoom))continue;const M=o.getLayerSourceCache(C),z=M?u[M.id]:void 0;(C.type==="model"||z&&z.length)&&g.renderLayer(g,M,C,z)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,u=o.style,g=o.context,x=g.gl,b=u.directionalLight,E=u.ambientLight;if(!b||!E)return;const C=[],M=yl(o,o.longestCutoffRange);M.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");const z=Uu(u,b,E),F=new Wt(x.LEQUAL,Wt.ReadOnly,o.depthRangeFor3D),H=new mr({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const $ of this._groundShadowTiles){const K=$.toUnwrapped(),te=o.isTileAffectedByFog($),ee=o.getOrCreateProgram("groundShadow",{defines:C,overrideFog:te});this.setupShadows(K,ee),o.uploadCommonUniforms(g,ee,K,null,M);const re={u_matrix:o.transform.calculateProjMatrix(K),u_ground_shadow_factor:z};ee.draw(o,x.TRIANGLES,F,H,Or.multiply,ur.disabled,re,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Or.unblended:Or.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const u=this.painter.transform,g=u.calculatePosMatrix(o,u.worldSize);return s.az(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(o){return s.az(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,u,g){if(!this.enabled)return;const x=this.painter.transform,b=this.painter.context,E=b.gl,C=this._uniformValues,M=new Float64Array(16),z=x.calculatePosMatrix(o,x.worldSize);for(let F=0;F<this._cascades.length;F++)s.az(M,this._cascades[F].matrix,z),C[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),b.activeTexture.set(E.TEXTURE0+co.ShadowMap0+F),this._cascades[F].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);if(this.useNormalOffset=!!g,this.useNormalOffset){const F=s.d4(o.canonical),H=2/x.tileSize*s.aj/Ws.shadowMapResolution,$=H*this._cascades[0].boundingSphereRadius,K=H*this._cascades[this._cascades.length-1].boundingSphereRadius,te=(g==="vector-tile"?1:3)*function(ee,re,ie,ue,pe){const me=s.ay((ee-22)/-22,0,1);return .125*(1-me)+4*me}(x.zoom);C.u_shadow_normal_offset=[F,$*te,K*te],C.u_shadow_bias=[1e-4,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(b,C)}setupShadowsFromMatrix(o,u,g=!1){if(!this.enabled)return;const x=this.painter.context,b=x.gl,E=this._uniformValues,C=new Float64Array(16);for(let M=0;M<Ws.cascadeCount;M++)s.az(C,this._cascades[M].matrix,o),E[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),x.activeTexture.set(b.TEXTURE0+co.ShadowMap0+M),this._cascades[M].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=g,g){const M=Ws.normalOffset;E.u_shadow_normal_offset=[1,M,M],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(x,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,u,g,x){if(x[2]>=0)return{};const b=function(M,z,F){const H=F/(1<<M.canonical.z);return new s.d6([M.canonical.x*H+M.wrap*F,M.canonical.y*H+M.wrap*F,0],[(M.canonical.x+1)*H+M.wrap*F,(M.canonical.y+1)*H+M.wrap*F,z])}(o,u,g).getCorners(),E=u/-x[2];x[0]<0?(s.d5(b[0],b[0],[x[0]*E,0,0]),s.d5(b[3],b[3],[x[0]*E,0,0])):x[0]>0&&(s.d5(b[1],b[1],[x[0]*E,0,0]),s.d5(b[2],b[2],[x[0]*E,0,0])),x[1]<0?(s.d5(b[0],b[0],[0,x[1]*E,0]),s.d5(b[1],b[1],[0,x[1]*E,0])):x[1]>0&&(s.d5(b[2],b[2],[0,x[1]*E,0]),s.d5(b[3],b[3],[0,x[1]*E,0]));const C={};return C.vertices=b,C.planes=[zc(b[1],b[0],b[4]),zc(b[2],b[1],b[5]),zc(b[3],b[2],b[6]),zc(b[0],b[3],b[7])],C}addShadowReceiver(o,u,g){this._receivers.add(o,s.d6.fromTileIdAndHeight(o,u,g))}getMaxCascadeForTile(o){const u=this._receivers.get(o);return u&&u.lastCascade?u.lastCascade:0}}function zc(m,o,u){const g=s.at([],u,o),x=s.at([],m,o),b=s.bF([],g,x),E=s.ae(b);return E===0?[0,0,1,0]:(s.c1(b,b,1/E),[b[0],b[1],b[2],-s.bG(b,o)])}function Qh(m){const o=m.properties.get("direction"),u=s.d1(o.x,o.y,o.z);u[2]=s.ay(u[2],0,75);const g=s.d3([u[0],u[1],u[2]]);return s.d2(g.x,g.y,g.z)}function Uu(m,o,u){const g=o.properties.get("color-use-theme")==="none",x=o.properties.get("color"),b=o.properties.get("intensity"),E=o.properties.get("direction"),C=[E.x,E.y,E.z],M=u.properties.get("color-use-theme")==="none",z=u.properties.get("color"),F=u.properties.get("intensity"),H=Math.max(s.bG([0,0,1],C),0),$=[0,0,0];s.c1($,z.toPremultipliedRenderColor(M?null:m.getLut(o.scope)).toArray01Linear().slice(0,3),F);const K=[0,0,0];return s.c1(K,x.toPremultipliedRenderColor(g?null:m.getLut(u.scope)).toArray01Linear().slice(0,3),H*b),s.d8([$[0]>0?$[0]/($[0]+K[0]):0,$[1]>0?$[1]/($[1]+K[1]):0,$[2]>0?$[2]/($[2]+K[2]):0])}function ed(m,o,u,g,x,b){const E=m.zoom,C=m.scale,M=m.worldSize,z=1/M,F=m.aspect,H=Math.sqrt(1+F*F)*Math.tan(.5*m.fovX),$=H*H,K=g-u,te=g+u;let ee,re;$>K/te?(ee=g,re=g*H):(ee=.5*te*(1+$),re=.5*Math.sqrt(K*K+2*(g*g+u*u)*$+te*te*$*$));const ie=m.projection.pixelsPerMeter(m.center.lat,M),ue=m._camera.getCameraToWorldMercator(),pe=[0,0,-ee*z];s.ad(pe,pe,ue);let me=re*z;const Te=m._edgeInsets;if(!(Te.left===0&&Te.top===0&&Te.right===0&&Te.bottom===0||Te.left===Te.right&&Te.top===Te.bottom)){const yt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ie:1),bt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,u,g);bt[8]=2*-m.centerOffset.x/m.width,bt[9]=2*m.centerOffset.y/m.height;const Et=new Float64Array(16);s.cM(Et,bt,yt);const jt=new Float64Array(16);s.bi(jt,Et);const tr=s.cy.fromInvProjectionMatrix(jt,M,E,!0);for(const ir of tr.points){const Zt=((we=ir)[0]/=C,we[1]/=C,we[2]=s.cb(we[2],m._center.lat),we);me=Math.max(me,s.c2(s.d7([],pe,Zt)))}}var we;me*=x/(x-1);const Ce=Math.acos(o[2]),be=Math.atan2(-o[0],-o[1]),Se=new Pa;Se.position=pe,Se.setPitchBearing(Ce,be);const Ee=Se.getWorldToCamera(M,ie),Ue=me*M,De=Math.min(m._mercatorZfromZoom(17)*M*-2,-2*Ue),dt=Se.getCameraToClipOrthographic(-Ue,Ue,-Ue,Ue,De,(Ue+b*ie)/o[2]),Je=new Float64Array(16);s.az(Je,dt,Ee);const pt=s.d2(Math.floor(1e6*pe[0])/1e6*M,Math.floor(1e6*pe[1])/1e6*M,0),Pt=.5*x,qe=[0,0,0];s.ad(qe,pt,Je),s.c1(qe,qe,Pt);const Re=[Math.floor(qe[0]),Math.floor(qe[1]),Math.floor(qe[2])],nt=[0,0,0];s.at(nt,qe,Re),s.c1(nt,nt,-1/Pt);const Ze=new Float64Array(16);return s.bx(Ze),s.bo(Ze,Ze,nt),s.az(Je,Ze,Je),[Je,Ue]}class b1 extends s.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,u){return s.aS(this.requestManager.transformRequest(u,s.R.Model).url).then(g=>{if(!g)return;const x=s.aT(g),b=new s.aU(o,void 0,void 0,x);return b.computeBoundsAndApplyParent(),b}).catch(g=>{if(g&&g.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${o} from ${u}: ${g.message}`)))})}load(o,u,g={forceReload:!1}){this.models[u]||(this.models[u]={});const x=Object.keys(o),b=[],E=[];for(const C of x){const M=o[C];this.hasURLBeenRequested(M)&&!g.forceReload||(this.modelByURL[M]={modelId:C,scope:u},b.push(this.loadModel(C,M)),E.push(C)),this.models[u][C]||(this.models[u][C]={model:null,numReferences:1})}this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+E.length,Promise.allSettled(b).then(C=>{for(let M=0;M<C.length;M++){const{status:z}=C[M];if(z==="rejected")continue;const{value:F}=C[M];this.models[u][E[M]]||(this.models[u][E[M]]={model:null,numReferences:1}),this.models[u][E[M]].model=F}this.numModelsLoading[u]-=E.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(C=>{this.fire(new s.z(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,u,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(o,u):this.getModelByURL(this.modelUris[u][o]))}getModel(o,u){return this.models[u]||(this.models[u]={}),this.models[u][o]?this.models[u][o].model:void 0}getModelByURL(o){if(!o)return null;const u=this.modelByURL[o];return u?this.models[u.scope][u.modelId].model:null}hasModelBeenAdded(o,u){return this.models[u]&&this.models[u][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,u,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const x=this.requestManager.normalizeModelURL(u);if((this.hasModel(o,g,{exactIdMatch:!0})||this.hasModelBeenAdded(o,g))&&this.modelUris[g][o]===x)this.models[g][o].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:b,modelId:E}=this.modelByURL[x];this.models[b][E].numReferences++}else this.modelUris[g][o]=x,this.load({[o]:this.modelUris[g][o]},g)}addModelURLs(o,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const g=this.modelUris[u];for(const x in o)g[x]=this.requestManager.normalizeModelURL(o[x])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const g={};for(const x of o)this.hasModel(x,u,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[u][x].numReferences++:this.modelUris[u][x]&&!this.hasURLBeenRequested(x)?g[x]=this.modelUris[u][x]:!this.hasURLBeenRequested(x)&&s.d9(x,!1)&&(this.modelUris[u][x]=this.requestManager.normalizeModelURL(x),g[x]=this.modelUris[u][x]);this.load(g,u)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,u,g=!1,x=!1){if(this.models[u]&&this.models[u][o]&&(this.models[u][o].numReferences--,this.models[u][o].numReferences===0||x)){const b=this.modelUris[u][o];g||delete this.modelUris[u][o],delete this.modelByURL[b];const E=this.models[u][o].model;if(!E)return;delete this.models[u][o],E.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const u of Object.keys(this.models[o])){const g=this.models[o][u].model;delete this.models[o][u],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,u){this.models[u]||(this.models[u]={});for(const g in this.models[u])this.models[u][g].model&&this.models[u][g].model.upload(o.context)}}const Xm=new s.a7({data:new s.a8(s.a5.colorTheme.data)});class Cv{constructor(o){this._scope=o,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(o){const u=this._makeBuildingsQueryArea(o),g=this._makeFloorsQueryArea(o),x=o.queryRenderedFeatures(u,this._buildingQueryParams).filter(C=>C.properties.shape_type==="building").reduce((C,M)=>{const z=M.properties.id;return M.properties.shape_type!=="building"||C.some(F=>F.properties.id===z)||C.push(M),C},[]),b=o.queryRenderedFeatures(g,this._floorQueryParams).filter(C=>C.properties.shape_type==="floor").reduce((C,M)=>{const z=M.properties.id;return M.properties.shape_type!=="floor"||C.some(F=>F.properties.id===z)||C.push(M),C},[]),E=[o.getCenter().lng,o.getCenter().lat];return{floors:b,building:this._findBuildingAtCenter(E,x)||(x.length>0?x[0]:null)}}_makeBuildingsQueryArea(o){const u=o.transform.width,g=o.transform.height,x=Math.min(u,g),b=x*(1/8),E=x*(1/8),C=.5*(u-b),M=.5*(g-E);return[new s.P(C,M),new s.P(C+b,M+E)]}_makeFloorsQueryArea(o){const u=o.transform.width,g=o.transform.height,x=u*(2/3),b=g*(2/3),E=.5*(u-x),C=.5*(g-b);return[new s.P(E,C),new s.P(E+x,C+b)]}_findBuildingAtCenter(o,u){for(const g of u)if(g.geometry.type==="Polygon"&&this._pointInPolygon(o,g.geometry.coordinates[0]))return g;return null}_pointInPolygon(o,u){let g=!1;for(let x=0,b=u.length-1;x<u.length;b=x++){const E=u[x][0],C=u[x][1],M=u[b][1];C>o[1]!=M>o[1]&&o[0]<(u[b][0]-E)*(o[1]-C)/(M-C)+E&&(g=!g)}return g}}class Nc{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(o){this._selectedBuildingId=o}setFloors(o){if(this._floors=o.filter(u=>u.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(u=>u.properties.id).includes(this._selectedFloorId)){const u=this._floors.map(g=>({id:g.properties.id,level:g.properties.floor_level})).reduce((g,x)=>{const b=Math.abs(g.level-1),E=Math.abs(x.level-1);return E<b||E===b&&x.level>g.level?x:g});this._selectedFloorId=u.id}}setFloorId(o){this._selectedFloorId=o}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const kP={"mbx-indoor-level-selected":{default:["literal",[]]}};function w1(m){return m=m||{},Object.assign(m,kP)}class PP extends s.E{constructor(o){super(),s.aV(["_onLoad","_onMove"],this),this._map=o,this._floorSelectionState=new Nc,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(o=>{o.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=o.scope,this._indoorDataQuery=new Cv(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const o=this._indoorDataQuery.execute(this._map);o&&o.floors.length!==0?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(o)):this._clearIndoorData()}_selectFloors(o){if(o.building)this._floorSelectionState.setBuildingId(o.building.properties.id),this._floorSelectionState.setFloors(o.floors),this._updateUI();else{const u=this._floorSelectionState.getSelectedFloorId();if(u&&o.floors.some(g=>g.properties.id===u))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const o=this._floorSelectionState.getCurrentBuildingFloors().map(g=>({id:g.properties.id,name:g.properties.name,shortName:g.properties.floor_level,levelOrder:g.properties.floor_level})),u=this._floorSelectionState.getSelectedFloorId();u?(this._updateIndoorConfig(),this.fire(new s.A("indoorupdate",{selectedFloorId:u,floors:o}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const o=this._floorSelectionState.getSelectedFloorId();o?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[o]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(o){this._floorSelectionState.setFloorId(o),this._updateIndoorConfig()}}function S1(m){if(!m.metadata||!m.metadata.content_area)return;const o=s.q.devicePixelRatio,{left:u,top:g,width:x,height:b}=m.metadata.content_area,E=u*o,C=g*o;return[E,C,E+x*o,C+b*o]}function T1(m){if(m)return m.map(([o,u])=>[o*s.q.devicePixelRatio,u*s.q.devicePixelRatio])}class Iv{constructor(o,u,g){this.id=o,this.scope=u,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const u=this.sourceCache.getVisibleCoordinates();if(u.length===0)return o;const g=this.sourceCache.getSource();if(!(g instanceof Oc))return o;const x=u.map(E=>this.sourceCache.getTile(E)),b=g.getImages(x,Array.from(this.pendingRequests));for(const[E,C]of b)o.set(s.I.from({name:E,iconsetId:this.id}),C),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),o}}const Fc=(m,o)=>xe(m,o&&o.filter(u=>u.identifier!=="source.canvas")),E1=s.aF(sn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),A1=s.aF(sn,["setCenter","setZoom","setBearing","setPitch"]),Ym=new Set(["background","sky","slot","custom"]),Bc={version:8,layers:[],sources:{}},Jf={duration:300,delay:0};class Ca extends s.E{constructor(o,u={}){super(),this.map=o,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=s.h({},Jf),this._buildingIndex=new f1(this),this.crossTileSymbolIndex=new ko,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new Nn,this.dispatcher=u.dispatcher?u.dispatcher:new s.D(s.db(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new Kr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new s.dc(o._requestManager,u.localFontFamily?s.dd.all:u.localIdeographFontFamily?s.dd.ideographs:s.dd.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new b1(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:u.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",s.de());const g=this;this._rtlTextPluginCallback=Ca.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,E)=>{if(s.df(b),E&&E.every(C=>C))for(const C in g._sourceCaches){const M=g._sourceCaches[C],z=M.getSource().type;z!=="vector"&&z!=="geojson"||M.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getOwnSource(x.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===b.id&&this._validateLayer(C)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(s.j(o))return o;const u=s.dg(o);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${s.dh(JSON.stringify(o))}`}_diffStyle(o,u,g){this.globalId=this._getGlobalId(o);const x=(b,E)=>{try{E(null,this.setState(b,g))}catch(C){E(C,!1)}};if(typeof o=="string"){const b=this.map._requestManager.normalizeStyleURL(o),E=this.map._requestManager.transformRequest(b,s.R.Style);s.n(E,(C,M)=>{C?this.fire(new s.z(C)):M&&x(M,u)})}else typeof o=="object"&&x(o,u)}loadURL(o,u={}){this.fire(new s.A("dataloading",{dataType:"style"}));const g=typeof u.validate=="boolean"?u.validate:!s.j(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,u.accessToken),this.resolvedImports.add(o);const x=this.importsCache.get(o);if(x)return this._load(x,g);const b=this.map._requestManager.transformRequest(o,s.R.Style);this._request=s.n(b,(E,C)=>{if(this._request=null,E)this.fire(new s.z(E));else if(C)return this.importsCache.set(o,C),this._load(C,g)})}loadJSON(o,u={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=s.q.frame(()=>{this._request=null,this._load(o,u.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(Bc,!1)}_loadImports(o,u,g){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const b of o){const E=this._createFragmentStyle(b),C=new Promise(F=>{E.once("style.import.load",F),E.once("error",F)}).then(()=>this.mergeAll());if(x.push(C),this.resolvedImports.has(b.url)){E.loadEmpty();continue}const M=b.data||this.importsCache.get(b.url);M?(E.loadJSON(M,{validate:u}),this._isInternalStyle(M)&&(E.globalId=null)):b.url?E.loadURL(b.url,{validate:u}):E.loadEmpty();const z={style:E,id:b.id,config:b.config};if(g){const F=this.fragments.findIndex(({id:H})=>H===g);this.fragments=this.fragments.slice(0,F).concat(z).concat(this.fragments.slice(F))}else this.fragments.push(z)}return Promise.allSettled(x)}getImportGlobalIds(o=this,u=new Set){for(const g of o.fragments)g.style.globalId&&u.add(g.style.globalId),this.getImportGlobalIds(g.style,u);return[...u.values()]}_createFragmentStyle(o){const u=this.scope?s.C(o.id,this.scope):o.id;let g;const x=this._initialConfig&&this._initialConfig[u];(o.config||x)&&(g=s.h({},o.config,x));const b=new Ca(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,u){const g=o.indoor?w1(o.schema):o.schema;if(this._isInternalStyle(o)){const E=s.h({},Bc,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(E,u)}if(this.updateConfig(this._config,g),u&&Fc(this,To(o)))return;this._loaded=!0,this.stylesheet=s.di(o);const x=()=>{for(const z in o.sources)this.addSource(z,o.sources[z],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const z in o.iconsets)this.addIconset(z,o.iconsets[z]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);const E=Nf(this.stylesheet.layers);if(this._order=E.map(z=>z.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new et(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new et(this.stylesheet.light)),this._layers={};for(const z of E){const F=s.dn(z,this.scope,this._styleColorTheme.lut,this.options);F.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const H=this.getOwnLayerSourceCache(F),$=!!this.directionalLight&&this.directionalLight.shadowsEnabled();H&&F.canCastShadows()&&$&&(H.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const M=this.isRootStyle();o.imports?this._loadImports(o.imports,u).then(()=>{this._reloadImports(),this.fire(new s.A(M?"style.load":"style.import.load"))}).catch(z=>{this.fire(new s.z(new Error("Failed to load imports",z))),this.fire(new s.A(M?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(M?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const E=this._evaluateColorThemeData(b);this._loadColorTheme(E).then(()=>{x()}).catch(C=>{s.w(`Couldn't load color theme from the stylesheet: ${C}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,u,g,x,b,E,C,M,z,F;const H={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle($=>{if($.stylesheet){if($.light!=null&&(o=$.light),$.stylesheet.lights)for(const K of $.stylesheet.lights)K.type==="ambient"&&$.ambientLight!=null&&(u=$.ambientLight),K.type==="directional"&&$.directionalLight!=null&&(g=$.directionalLight);x=this._prioritizeTerrain(x,$.terrain,$.stylesheet.terrain),$.stylesheet.fog&&$.fog!=null&&(b=$.fog),$.stylesheet.snow&&$.snow!=null&&(E=$.snow),$.stylesheet.rain&&$.rain!=null&&(C=$.rain),$.stylesheet.camera!=null&&(F=$.stylesheet.camera),$.stylesheet.projection!=null&&(M=$.stylesheet.projection),$.stylesheet.transition!=null&&(z=$.stylesheet.transition),H[$.scope]=$._styleColorTheme}}),this.light=o,this.ambientLight=u,this.directionalLight=g,this.fog=b,this.snow=E,this.rain=C,this._styleColorThemeForScope=H,x===null?delete this.terrain:this.terrain=x,this.camera=F||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=s.h({},Jf,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){const u=g=>{for(const x of g.fragments)u(x.style);o(g)};u(this)}_prioritizeTerrain(o,u,g){const x=o&&o.drapeRenderMode===0;return g===null?u&&u.drapeRenderMode===0?u:x?o:null:u!=null&&(!o||x||u&&u.drapeRenderMode===1)?u:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{o=this._prioritizeTerrain(o,u.terrain,u.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(o=u.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},u={},g={};this.forEachFragmentStyle(x=>{for(const b in x._sourceCaches){const E=s.C(b,x.scope);o[E]=x._sourceCaches[b]}for(const b in x._otherSourceCaches){const E=s.C(b,x.scope);u[E]=x._otherSourceCaches[b]}for(const b in x._symbolSourceCaches){const E=s.C(b,x.scope);g[E]=x._symbolSourceCaches[b]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=g}mergeLayers(){const o={},u=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const E of b._order){const C=b._layers[E];if(C.type==="slot"){const M=s.dj(E);if(o[M])continue;o[M]=[]}C.slot&&o[C.slot]?o[C.slot].push(C):u.push(C)}}),this._mergedOrder=[];const x=(b=[])=>{for(const E of b)if(E.type==="slot"){const C=s.dj(E.id);o[C]&&x(o[C]),this._mergedSlots.push(C)}else{const C=s.C(E.id,E.scope);this._mergedOrder.push(C),g[C]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};x(u),this._mergedOrder.sort((b,E)=>{const C=g[b],M=g[E];return C.hasInitialOcclusionOpacityProperties?M.is3D(!!this.terrain)?1:0:C.is3D(!!this.terrain)&&M.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=s.h({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(u,g,x,b){const E=s.h({},g);for(const M of Object.keys(s.a5.colorTheme))E[M]===void 0&&(E[M]=s.a5.colorTheme[M].default);const C=new s.a6(Xm,u,new Map(x));return C.setTransitionOrValue(E,x),C.untransitioned().possiblyEvaluate(new s.aa(0,{worldview:void 0}))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,x)=>{const b="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let E=o;E.startsWith(b)||(E=b+E);const C=s.I.from("mapbox-reserved-lut"),M=new Image;M.src=E,M.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},M.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void g();this._styleColorTheme.lutLoading=!1;const{width:z,height:F,data:H}=s.q.getImageData(M);if(F>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==F*F)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new s.r({width:z,height:F},H),pixelRatio:1,sdf:!1,usvg:!1,version:0});const $=this.imageManager.getImage(C,this.scope);$?(this._styleColorTheme.lut={image:$.data,data:o},g()):x(new Error("Missing LUT image."))}})}getLut(o){const u=this._styleColorThemeForScope[o];return u?u.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(u,g,x){let b,E,C;const M=s.q.devicePixelRatio>1?"@2x":"";let z=s.n(g.transformRequest(g.normalizeSpriteURL(u,M,".json"),s.R.SpriteJSON),($,K)=>{z=null,C||(C=$,b=K,H())}),F=s.o(g.transformRequest(g.normalizeSpriteURL(u,M,".png"),s.R.SpriteImage),($,K)=>{F=null,C||(C=$,E=K,H())});function H(){if(C)x(C);else if(b&&E){const $=s.q.getImageData(E),K={};for(const te in b){const{width:ee,height:re,x:ie,y:ue,sdf:pe,pixelRatio:me,stretchX:Te,stretchY:we,content:Ce}=b[te],be=new s.r({width:ee,height:re});s.r.copy($,be,{x:ie,y:ue},{x:0,y:0},{width:ee,height:re},null),K[te]={data:be,pixelRatio:me,sdf:pe,stretchX:Te,stretchY:we,content:Ce,usvg:!1}}x(null,K)}}return{cancel(){z&&(z.cancel(),z=null),F&&(F.cancel(),F=null)}}}(o,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new s.z(u));else if(g){const x=new Map;for(const b in g)x.set(s.I.from(b),g[b]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(o,u){if(u.type==="sprite")return void this._loadSprite(u.url);const g=this.getOwnSourceCache(u.source);if(!g)return void this.fire(new s.z(new Error(`Source "${u.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const x=g.getSource();if(x.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${u.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const b=new Iv(o,this.scope,g);this.imageManager.addImageProvider(b,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!s.j(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const u=this.map._spriteFormat==="auto";var g,x;this._spriteRequest=(x=(b,E)=>{if(this._spriteRequest=null,b)u?this._loadSprite(o):this.fire(new s.z(b));else if(E){const C=new Map;for(const M in E)C.set(s.I.from(M),E[M]);this.addImages(C)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.br((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(o),s.R.Iconset),(b,E)=>{if(b)return void x(b);const C={},M=s.da(new s.bq(E));for(const z of M.icons){const F={version:1,pixelRatio:s.q.devicePixelRatio,content:S1(z),stretchX:z.metadata?T1(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?T1(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};C[z.name]=F}x(null,C)}))}_validateLayer(o){const u=this.getOwnSource(o.source);if(!u)return;const g=o.sourceLayer;g&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(g)===-1)&&this.fire(new s.z(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,u)=>{const g=this.fragments[u];return g&&g.style&&(o.data=g.style.serialize()),o})}_serializeSources(){const o={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();o[g.id]||(o[g.id]=g.serialize())}return o}_serializeLayers(o){const u=[];for(const g of o){const x=this._layers[g];x&&x.type!=="custom"&&u.push(x.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const u=this.getOwnLayer(o);if(u)return u;this.fire(new s.z(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const u=this.getOwnSource(o);if(u)return u;this.fire(new s.z(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,u){const g=this.map.painter;if(g)for(let x=o.minzoom||0;x<(o.maxzoom||25.5);x++){const b=o.getProgramIds();if(b)for(const E of b){const C=o.getDefaultProgramParams(E,u.zoom,this._styleColorTheme.lut);C&&(g.style=this,this.fog&&(g._fogVisible=!0,C.overrideFog=!0,g.getOrCreateProgram(E,C)),g._fogVisible=!1,C.overrideFog=!1,g.getOrCreateProgram(E,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,g.getOrCreateProgram(E,C)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const u=this.calculateLightsBrightness();o.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const g=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const M in C){const{updatedIds:z,removedIds:F}=C[M];(z||F)&&(this._updateWorkerLayers(M,z,F),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const b={};for(const C in this._mergedSourceCaches){const M=this._mergedSourceCaches[C];b[C]=M.used,M.used=!1,M.tileCoverLift=0}for(const C of this._mergedOrder){const M=this._mergedLayers[C];if(M.recalculate(o,this._availableImages),!M.isHidden(o.zoom)){const z=this.getLayerSourceCache(M);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,o)}):this.precompilePrograms(M,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const C of E)C.sourceCache.used=!0;for(const C in b){const M=this._mergedSourceCaches[C];b[C]!==M.used&&M.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const u of o){const g=u.resolvePendingRequests(),x=this.getFragmentStyle(u.scope);x&&x.addImages(g)}}_updateTilesForChangedImages(){const o={};for(const u in this._mergedSourceCaches){const g=this._mergedSourceCaches[u].getSource().scope;o[g]=o[g]||this._changes.getUpdatedImages(g),o[g].length!==0&&this._mergedSourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o[g])}for(const u in o)this._changes.resetUpdatedImages(u)}_updateWorkerLayers(o,u,g){const x=this.getFragmentStyle(o);x&&this.dispatcher.broadcast("updateLayers",{layers:u?x._serializeLayers(u):[],scope:o,removedIds:g||[],options:x.options})}setState(o,u){if(this._checkLoaded(),Fc(this,To(o)))return!1;(o=s.di(o)).layers=Nf(o.layers);const g=function(E,C){if(!E)return[{command:sn.setStyle,args:[C]}];let M=[];try{if(!s.bv(E.version,C.version))return[{command:sn.setStyle,args:[C]}];if(s.bv(E.center,C.center)||M.push({command:sn.setCenter,args:[C.center]}),s.bv(E.zoom,C.zoom)||M.push({command:sn.setZoom,args:[C.zoom]}),s.bv(E.bearing,C.bearing)||M.push({command:sn.setBearing,args:[C.bearing]}),s.bv(E.pitch,C.pitch)||M.push({command:sn.setPitch,args:[C.pitch]}),s.bv(E.sprite,C.sprite)||M.push({command:sn.setSprite,args:[C.sprite]}),s.bv(E.glyphs,C.glyphs)||M.push({command:sn.setGlyphs,args:[C.glyphs]}),s.bv(E.imports,C.imports)||function(K=[],te=[],ee){te=te||[];const re=(K=K||[]).map(zu),ie=te.map(zu),ue=K.reduce(Rc,{}),pe=te.reduce(Rc,{}),me=re.slice();let Te,we,Ce,be;for(Te=0,we=0;Te<re.length;Te++)Ce=re[Te],pe.hasOwnProperty(Ce)?we++:(ee.push({command:sn.removeImport,args:[Ce]}),me.splice(me.indexOf(Ce,we),1));for(Te=0,we=0;Te<ie.length;Te++)Ce=ie[ie.length-1-Te],me[me.length-1-Te]!==Ce&&(ue.hasOwnProperty(Ce)?(ee.push({command:sn.removeImport,args:[Ce]}),me.splice(me.lastIndexOf(Ce,me.length-we),1)):we++,be=me[me.length-Te],ee.push({command:sn.addImport,args:[pe[Ce],be]}),me.splice(me.length-Te,0,Ce));for(const Se of te){const Ee=ue[Se.id];Ee&&(delete Ee.data,s.bv(Ee,Se)||ee.push({command:sn.updateImport,args:[Se.id,Se]}))}}(E.imports,C.imports,M),s.bv(E.transition,C.transition)||M.push({command:sn.setTransition,args:[C.transition]}),s.bv(E.light,C.light)||M.push({command:sn.setLight,args:[C.light]}),s.bv(E.fog,C.fog)||M.push({command:sn.setFog,args:[C.fog]}),s.bv(E.snow,C.snow)||M.push({command:sn.setSnow,args:[C.snow]}),s.bv(E.rain,C.rain)||M.push({command:sn.setRain,args:[C.rain]}),s.bv(E.projection,C.projection)||M.push({command:sn.setProjection,args:[C.projection]}),s.bv(E.lights,C.lights)||M.push({command:sn.setLights,args:[C.lights]}),s.bv(E.camera,C.camera)||M.push({command:sn.setCamera,args:[C.camera]}),s.bv(E.iconsets,C.iconsets)||function(K,te,ee){let re;for(re in te=te||{},K=K||{})K.hasOwnProperty(re)&&(te.hasOwnProperty(re)||ee.push({command:sn.removeIconset,args:[re]}));for(re in te){if(!te.hasOwnProperty(re))continue;const ie=te[re];K.hasOwnProperty(re)?s.bv(K[re],ie)||(ee.push({command:sn.removeIconset,args:[re]}),ee.push({command:sn.addIconset,args:[re,ie]})):ee.push({command:sn.addIconset,args:[re,ie]})}}(E.iconsets,C.iconsets,M),!s.bv(E["color-theme"],C["color-theme"]))return[{command:sn.setStyle,args:[C]}];const z={},F=[];(function(K,te,ee,re){let ie;for(ie in te=te||{},K=K||{})K.hasOwnProperty(ie)&&(te.hasOwnProperty(ie)||Hh(ie,ee,re));for(ie in te){if(!te.hasOwnProperty(ie))continue;const ue=te[ie];K.hasOwnProperty(ie)?s.bv(K[ie],ue)||(K[ie].type==="geojson"&&ue.type==="geojson"&&SP(K,te,ie)?ee.push({command:sn.setGeoJSONSourceData,args:[ie,ue.data]}):Ff(ie,te,ee,re)):Gm(ie,te,ee)}})(E.sources,C.sources,F,z);const H=[];E.layers&&E.layers.forEach(K=>{K.source&&z[K.source]?M.push({command:sn.removeLayer,args:[K.id]}):H.push(K)});let $=E.terrain;$&&z[$.source]&&(M.push({command:sn.setTerrain,args:[void 0]}),$=void 0),M=M.concat(F),s.bv($,C.terrain)||M.push({command:sn.setTerrain,args:[C.terrain]}),function(K,te,ee){te=te||[];const re=(K=K||[]).map(zu),ie=te.map(zu),ue=K.reduce(Rc,{}),pe=te.reduce(Rc,{}),me=re.slice(),Te=Object.create(null);let we,Ce,be,Se,Ee,Ue,De;for(we=0,Ce=0;we<re.length;we++)be=re[we],pe.hasOwnProperty(be)?Ce++:(ee.push({command:sn.removeLayer,args:[be]}),me.splice(me.indexOf(be,Ce),1));for(we=0,Ce=0;we<ie.length;we++)be=ie[ie.length-1-we],me[me.length-1-we]!==be&&(ue.hasOwnProperty(be)?(ee.push({command:sn.removeLayer,args:[be]}),me.splice(me.lastIndexOf(be,me.length-Ce),1)):Ce++,Ue=me[me.length-we],ee.push({command:sn.addLayer,args:[pe[be],Ue]}),me.splice(me.length-we,0,be),Te[be]=!0);for(we=0;we<ie.length;we++)if(be=ie[we],Se=ue[be],Ee=pe[be],!Te[be]&&!s.bv(Se,Ee))if(s.bv(Se.source,Ee.source)&&s.bv(Se["source-layer"],Ee["source-layer"])&&s.bv(Se.type,Ee.type)){for(De in Bf(Se.layout,Ee.layout,ee,be,null,sn.setLayoutProperty),Bf(Se.paint,Ee.paint,ee,be,null,sn.setPaintProperty),s.bv(Se.slot,Ee.slot)||ee.push({command:sn.setSlot,args:[be,Ee.slot]}),s.bv(Se.filter,Ee.filter)||ee.push({command:sn.setFilter,args:[be,Ee.filter]}),s.bv(Se.minzoom,Ee.minzoom)&&s.bv(Se.maxzoom,Ee.maxzoom)||ee.push({command:sn.setLayerZoomRange,args:[be,Ee.minzoom,Ee.maxzoom]}),Se)Se.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?Bf(Se[De],Ee[De],ee,be,De.slice(6),sn.setPaintProperty):s.bv(Se[De],Ee[De])||ee.push({command:sn.setLayerProperty,args:[be,De,Ee[De]]}));for(De in Ee)Ee.hasOwnProperty(De)&&!Se.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?Bf(Se[De],Ee[De],ee,be,De.slice(6),sn.setPaintProperty):s.bv(Se[De],Ee[De])||ee.push({command:sn.setLayerProperty,args:[be,De,Ee[De]]}))}else ee.push({command:sn.removeLayer,args:[be]}),Ue=me[me.lastIndexOf(be)+1],ee.push({command:sn.addLayer,args:[Ee,Ue]})}(H,C.layers,M)}catch(z){console.warn("Unable to compute style diff:",z),M=[{command:sn.setStyle,args:[C]}]}return M}(this.serialize(),o).filter(E=>!(E.command in A1));if(g.length===0)return!1;const x=g.filter(E=>!(E.command in E1));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);const b=[];return g.forEach(E=>{b.push(this[E.command](...E.args))}),u&&Promise.all(b).then(u).catch(u),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(const[u,g]of o.entries()){if(this.getImage(u))return this.fire(new s.z(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,this.scope,g),this._changes.updateImage(u,this.scope)}return this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this}addImage(o,u){return this.getImage(o)?this.fire(new s.z(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,u),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(o,u,g=!1){this.imageManager.updateImage(o,this.scope,u),g&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(o){return this.modelManager.addModelURLs(o,this.scope),this._updateWorkerModels(),this.fire(new s.A("data",{dataType:"style"})),this}addModel(o,u,g={}){return this._checkLoaded(),this._validate(ye,`models.${o}`,u,null,g)||(this.modelManager.addModel(o,u,this.scope),this.fire(new s.A("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope,!1,!0),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,u,g={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(Gl,`sources.${o}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const x=Of(o,u,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const b=E=>{const C=(E?"symbol:":"other:")+x.id,M=s.C(C,this.scope),z=this._sourceCaches[C]=new Ao(M,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=z,z.onAdd(this.map)};b(!1),u.type!=="vector"&&u.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const u=this.getOwnSource(o);if(!u)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===o)return this.fire(new s.z(new Error(`Source "${o}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new s.z(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([b,E])=>E.type==="source"&&E.source===o);if(x)return this.fire(new s.z(new Error(`Source "${o}" cannot be removed while iconset "${x[0]}" is using it.`)))}const g=this.getOwnSourceCaches(o);for(const x of g){const b=s.dj(x.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(x.id),x.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,u){this._checkLoaded(),this.getOwnSource(o).setData(u),this._changes.setDirty()}getOwnSource(o){const u=this.getOwnSourceCache(o);return u&&u.getSource()}getOwnSources(){const o=[];for(const u in this._otherSourceCaches){const g=this.getOwnSourceCache(u);g&&o.push(g.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const u in o){const g=o[u]._tiles;for(const x in g){const b=g[x];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const b of o){if(this._validate(Mc,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(b),E.updateTransitions(u)}else this.ambientLight=new Dn(b,qr||(qr=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(b),E.updateTransitions(u)}else this.directionalLight=new Dn(b,Ti||(Ti=new s.a7({direction:new s.an(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=Object.assign(u,{worldview:this.map.getWorldview()}),x=new s.aa(this.z||0,g);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,u=this.ambientLight;if(!o||!u)return;const g=$=>.2126*($[0]<=.03928?$[0]/12.92:Math.pow(($[0]+.055)/1.055,2.4))+.7152*($[1]<=.03928?$[1]/12.92:Math.pow(($[1]+.055)/1.055,2.4))+.0722*($[2]<=.03928?$[2]/12.92:Math.pow(($[2]+.055)/1.055,2.4)),x=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=o.properties.get("intensity"),E=o.properties.get("direction"),C=1-s.d1(E.x,E.y,E.z)[2]/90,M=g(x)*b*C,z=u.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=u.properties.get("intensity"),H=g(z)*F;return Number(((M+H)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(s.dk(o)){const u=s.dl(o),g=this.fragments.find(({id:b})=>b===u);if(!g)return;const x=s.dj(o);return g.style.getFragmentStyle(x)}{const u=this.fragments.find(({id:g})=>g===o);return u?u.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const u={},g=(x,b="")=>`${x}::${b}`;this._featuresetSelectors={};for(const x in o){const b=this._featuresetSelectors[x]=[];for(const E of o[x].selectors){if(E.featureNamespace){const M=this.getOwnLayer(E.layer);if(!M){s.w(`Layer is undefined for selector: ${E.layer}`);continue}const z=g(M.source,M.sourceLayer);if(z in u&&u[z]!==E.featureNamespace){s.w(`"featureNamespace ${E.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}u[z]=E.featureNamespace}let C;if(E.properties)for(const M in E.properties){const z=s.X(E.properties[M]);z.result==="success"&&(C=C||{},C[M]=z.value)}b.push({layerId:E.layer,namespace:E.featureNamespace,properties:C,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const u=this.getFragmentStyle(o);if(!u||!u.stylesheet.featuresets)return[];const g=[];for(const x in u.stylesheet.featuresets)g.push({featuresetId:x,importId:u.scope?u.scope:void 0});return g}getFeaturesetLayers(o,u){const g=this.getFragmentStyle(u),x=g.stylesheet.featuresets;if(!x||!x[o])return this.fire(new s.z(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const E of x[o].selectors){const C=g.getOwnLayer(E.layer);C&&b.push(C)}return b}getConfigProperty(o,u){const g=this.getFragmentStyle(o);if(!g)return null;const x=s.C(u,g.scope),b=g.options.get(x),E=b?b.value||b.default:null;return E?E.serialize():null}setConfigProperty(o,u,g){const x=this.getFragmentStyle(o);if(!x)return;const b=x.stylesheet.indoor?w1(x.stylesheet.schema):x.stylesheet.schema;if(!b||!b[u])return;const E=s.X(g);if(E.result!=="success")return void Fc(this,E.value);const C=E.value.expression,M=s.C(u,x.scope),z=x.options.get(M);if(!z)return;let F;const{minValue:H,maxValue:$,stepValue:K,type:te,values:ee}=b[u],re=s.X(b[u].default);re.result==="success"&&(F=re.value.expression),F?(this.options.set(M,Object.assign({},z,{value:C,default:F,minValue:H,maxValue:$,stepValue:K,type:te,values:ee})),this.updateConfigDependencies(u)):this.fire(new s.z(new Error(`No schema defined for the config option "${u}" in the "${o}" fragment.`)))}getConfig(o){const u=this.getFragmentStyle(o);if(!u)return null;const g=u.stylesheet.schema;if(!g)return null;const x={};for(const b in g){const E=s.C(b,u.scope),C=u.options.get(E),M=C?C.value||C.default:null;x[b]=M?M.serialize():null}return x}setConfig(o,u){const g=this.getFragmentStyle(o);g&&(g.updateConfig(u,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const u=this.getFragmentStyle(o);return u?u.stylesheet.schema:null}setSchema(o,u){const g=this.getFragmentStyle(o);g&&(g.stylesheet.schema=u,g.updateConfig(g._config,u),this.updateConfigDependencies())}updateConfig(o,u){if(this._config=o,o||u)if(u)for(const g in u){let x,b;const E=s.X(u[g].default);if(E.result==="success"&&(x=E.value.expression),o&&o[g]!==void 0){const $=s.X(o[g]);$.result==="success"&&(b=$.value.expression)}const{minValue:C,maxValue:M,stepValue:z,type:F,values:H}=u[g];if(x){const $=s.C(g,this.scope);this.options.set($,{default:x,value:b,minValue:C,maxValue:M,stepValue:z,type:F,values:H})}else this.fire(new s.z(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(o){for(const u of this._configDependentLayers){const g=this.getLayer(u);if(g){if(o&&!g.configDependencies.has(o))continue;g.possiblyEvaluateVisibility(),this._updateLayer(g)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(u=>{const g=u._styleColorTheme.colorThemeOverride?u._styleColorTheme.colorThemeOverride:u._styleColorTheme.colorTheme;if(g){const x=u._evaluateColorThemeData(g);(!u._styleColorTheme.lut&&x!==""||u._styleColorTheme.lut&&x!==u._styleColorTheme.lut.data)&&u.setColorTheme(g)}}),this._changes.setDirty()}addLayer(o,u,g={}){this._checkLoaded();const x=o.id;if(this._layers[x])return void this.fire(new s.z(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(o.type==="custom"){if(Fc(this,s.dm(o)))return;b=s.dn(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(x,o.source),o=s.di(o),o=s.h(o,{source:x})),this._validate(Br,`layers.${x}`,o,{arrayIndex:-1},g))return;b=s.dn(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let E=this._order.length;if(u){const F=this._order.indexOf(u);if(F===-1)return void this.fire(new s.z(new Error(`Layer with id "${u}" does not exist on this map.`)));b.slot===this._layers[u].slot?E=F:s.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const C=this.getOwnLayerSourceCache(b),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&b.canCastShadows()&&M&&(C.castsShadows=!0);const z=this._changes.getRemovedLayer(b);if(z&&b.source&&C&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const F=s.C(b.source,b.scope);z.type!==b.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),C.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(o,u){this._checkLoaded();const g=this._checkLayer(o);if(!g||o===u)return;const x=this._order.indexOf(o);this._order.splice(x,1);let b=this._order.length;if(u){const E=this._order.indexOf(u);if(E===-1)return void this.fire(new s.z(new Error(`Layer with id "${u}" does not exist on this map.`)));g.slot===this._layers[u].slot?b=E:s.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const u=this._checkLayer(o);if(!u)return;u.setEventedParent(null);const g=this._order.indexOf(o);this._order.splice(g,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const x=this.getOwnLayerSourceCache(u);if(x&&x.castsShadows){let b=!1;for(const E in this._layers)if(this._layers[E].source===u.source&&this._layers[E].canCastShadows()){b=!0;break}x.castsShadows=b}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const u in this._layers)if(this._layers[u].type===o)return!0;return!1}setLayerZoomRange(o,u,g){this._checkLoaded();const x=this._checkLayer(o);x&&(x.minzoom===u&&x.maxzoom===g||(u!=null&&(x.minzoom=u),g!=null&&(x.maxzoom=g),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,u){this._checkLoaded();const g=this._checkLayer(o);g&&g.slot!==u&&(g.slot=u,this._updateLayer(g))}setFilter(o,u,g={}){this._checkLoaded();const x=this._checkLayer(o);if(x&&!s.bv(x.filter,u))return u==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(He,`layers.${x.id}.filter`,u,{layerType:x.type},g)||(x.filter=s.di(u),this._updateLayer(x)))}getFilter(o){const u=this._checkLayer(o);if(u)return s.di(u.filter)}setLayoutProperty(o,u,g,x={}){this._checkLoaded();const b=this._checkLayer(o);if(b&&!s.bv(b.getLayoutProperty(u),g)){if(g!=null&&(!x||x.validate!==!1)&&Fc(b,ce.call(To,{key:`layers.${o}.layout.${u}`,layerType:b.type,objectKey:u,value:g,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(u,g),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(o,u){const g=this._checkLayer(o);if(g)return g.getLayoutProperty(u)}setPaintProperty(o,u,g,x={}){this._checkLoaded();const b=this._checkLayer(o);if(!b||s.bv(b.getPaintProperty(u),g)||g!=null&&(!x||x.validate!==!1)&&Fc(b,se.call(To,{key:`layers.${o}.paint.${u}`,layerType:b.type,objectKey:u,value:g,styleSpec:s.a5})))return;const E=b.setPaintProperty(u,g);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),E&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(o,u){const g=this._checkLayer(o);if(g)return g.getPaintProperty(u)}setFeatureState(o,u){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:M,importId:z}=o.target,F=this.getFragmentStyle(z),H=F.getFeaturesetLayers(M);for(const{source:$,sourceLayer:K}of H)F.setFeatureState({id:o.id,source:$,sourceLayer:K},u)}else if("layerId"in o.target){const{layerId:M}=o.target,z=this.getLayer(M);this.setFeatureState({id:o.id,source:z.source,sourceLayer:z.sourceLayer},u)}return}const g=o.source,x=o.sourceLayer,b=this._checkSource(g);if(!b)return;const E=b.type;if(E==="geojson"&&x)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(g);for(const M of C)M.setFeatureState(x,o.id,u)}removeFeatureState(o,u){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:M,importId:z}=o.target,F=this.getFragmentStyle(z),H=F.getFeaturesetLayers(M);for(const{source:$,sourceLayer:K}of H)F.removeFeatureState({id:o.id,source:$,sourceLayer:K},u)}else if("layerId"in o.target){const{layerId:M}=o.target,z=this.getLayer(M);this.removeFeatureState({id:o.id,source:z.source,sourceLayer:z.sourceLayer},u)}return}const g=o.source,x=this._checkSource(g);if(!x)return;const b=x.type,E=b==="vector"?o.sourceLayer:void 0;if(b==="vector"&&!E)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(g);for(const M of C)M.removeFeatureState(E,o.id,u)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let b;if("featuresetId"in o.target){const{featuresetId:E,importId:C}=o.target,M=this.getFragmentStyle(C),z=M.getFeaturesetLayers(E);for(const{source:F,sourceLayer:H}of z){const $=M.getFeatureState({id:o.id,source:F,sourceLayer:H});if($&&!b)b=$;else if(!s.bv(b,$))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:E}=o.target,C=this.getLayer(E);b=this.getFeatureState({id:o.id,source:C.source,sourceLayer:C.sourceLayer})}return b}const u=o.source,g=o.sourceLayer,x=this._checkSource(u);if(x){if(x.type!=="vector"||g)return o.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(g,o.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=s.h({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return s.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),u=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return s.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(o){for(const u of Object.values(this._mergedLayers))o(u)&&this._updateLayer(u)}_updateLayer(o){this._changes.updateLayer(o);const u=this.getLayerSourceCache(o),g=s.C(o.source,o.scope),x=this._changes.getUpdatedSourceCaches();o.source&&!x[g]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),u.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const u=C=>this._mergedLayers[C].is3D(!!this.terrain),g=this.order,x={},b=[];for(let C=g.length-1;C>=0;C--){const M=g[C];if(u(M)){x[M]=C;for(const z of o){const F=z[M];if(F)for(const H of F)b.push(H)}}}b.sort((C,M)=>M.intersectionZ-C.intersectionZ);const E=[];for(let C=g.length-1;C>=0;C--){const M=g[C];if(u(M))for(let z=b.length-1;z>=0;z--){const F=b[z].feature;if(F.layer&&x[F.layer.id]<C)break;E.push(F),b.pop()}else for(const z of o){const F=z[M];if(F)for(const H of F)E.push(H.feature)}}return E}queryRenderedFeatures(o,u,g){let x;u&&!Array.isArray(u)&&u.filter&&(this._validate(He,"queryRenderedFeatures.filter",u.filter,null,u),x=s.b3(u.filter));const b={},E=F=>{if(Ym.has(F.type))return;const H=this.getOwnLayerSourceCache(F),$=b[H.id]=b[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&($.has3DLayers=!0),$.layers[F.fqid]=$.layers[F.fqid]||{styleLayer:F,targets:[]},$.layers[F.fqid].targets.push({filter:x})};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const F of u.layers){const H=this._layers[F];if(!H)return this.fire(new s.z(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];E(H)}}else for(const F in this._layers)E(this._layers[F]);const C=this._queryRenderedFeatures(o,b,g),M=this._flattenAndSortRenderedFeatures(C),z=[];for(const F of M)s.dq(F.layer.id)===this.scope&&z.push(F);return z}queryRenderedFeatureset(o,u,g){let x;u&&!Array.isArray(u)&&u.filter&&(this._validate(He,"queryRenderedFeatures.filter",u.filter,null,u),x=s.b3(u.filter));const b="mock",E=[];if(u&&u.target)E.push(Object.assign({},u,{targetId:b,filter:x}));else{const F=this.getFeaturesetDescriptors();for(const H of F)E.push({targetId:b,filter:x,target:H});for(const{style:H}of this.fragments){const $=H.getFeaturesetDescriptors();for(const K of $)E.push({targetId:b,filter:x,target:K})}}const C=this.queryRenderedTargets(o,E,g),M=[],z=new Set;for(const F of C)for(const H of F.variants[b])Vm(H,F,z)||M.push(new s.dr(F,H));return M}queryRenderedTargets(o,u,g){const x={},b=(C,M,z,F)=>{const H=x[M.id]=x[M.id]||{sourceCache:M,layers:{},has3DLayers:!1};if(H.layers[C.fqid]=H.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D(!!this.terrain)&&(H.has3DLayers=!0),!F)return z.uniqueFeatureID=!1,void H.layers[C.fqid].targets.push(z);H.layers[C.fqid].targets.push(Object.assign({},z,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const C of u)if("featuresetId"in C.target){const{featuresetId:M,importId:z}=C.target,F=this.getFragmentStyle(z);if(!F||!F._featuresetSelectors)continue;const H=F._featuresetSelectors[M];if(!H){this.fire(new s.z(new Error(`The featureset '${M}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const $ of H){const K=F.getOwnLayer($.layerId);K&&!Ym.has(K.type)&&b(K,F.getOwnLayerSourceCache(K),C,$)}}else if("layerId"in C.target){const{layerId:M}=C.target,z=this.getLayer(M);if(!z||Ym.has(z.type))continue;b(z,this.getLayerSourceCache(z),C)}const E=this._queryRenderedFeatures(o,x,g);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(o,u,g){const x=[],b=!!this.map._showQueryGeometry,E=pn.createFromScreenPoints(o,g);for(const C in u){const M=Um(E,u[C],this._availableImages,g,b);Object.keys(M).length&&x.push(M)}if(this.placement)for(const C in u){if(!u[C].sourceCache._onlySymbols)continue;const M=Ru(E.screenGeometry,u[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(M).length&&x.push(M)}return x}querySourceFeatures(o,u){const g=u&&u.filter;g&&this._validate(He,"querySourceFeatures.filter",g,null,u);let x=[];const b=this.getOwnSourceCaches(o);for(const E of b)x=x.concat(Rf(E,u));return x}addSourceType(o,u,g){return Ca.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(Ca.setSourceType(o,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:u.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,u,g={}){this._checkLoaded();const x=this.light.getLight();let b=!1;for(const C in o)if(!s.bv(o[C],x[C])){b=!0;break}if(!b)return;const E=this._getTransitionParameters();this.light.setLight(o,u,g),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,u=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),u===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=o;const x=o.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){const C="terrain-dem-src";this.addSource(C,g.source),g=s.di(g),g=s.h(g,{source:C})}const b=s.h({},g),E={};if(this.terrain&&x){b.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(E.style=C.serialize())}if(this._validate(ut,"terrain",b,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&u!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,u),this.fire(new s.A("data",{dataType:"style"}))}else{const b=this.terrain,E=b.get();for(const C of Object.keys(s.a5.terrain))!g.hasOwnProperty(C)&&s.a5.terrain[C].default&&(g[C]=s.a5.terrain[C].default);for(const C in o)if(!s.bv(o[C],E[C])){b.set(o,this.options),this.stylesheet.terrain=o;const M=this._getTransitionParameters({duration:0});b.updateTransitions(M),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const u=this.fog=new zr(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_createSnow(o){const u=this.snow=new ts(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_createRain(o){const u=this.rain=new qi(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!s.bv(u.get(),o)){u.set(o,this.options),this.stylesheet.fog=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const u=this.snow;if(!s.bv(u.get(),o)){u.set(o,this.options),this.stylesheet.snow=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const u=this.rain;if(!s.bv(u.get(),o)){u.set(o,this.options),this.stylesheet.rain=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},u=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!u)return this._styleColorTheme.lut=null,void o();const g=this._evaluateColorThemeData(u);this._loadColorTheme(g).then(()=>{this.fire(new s.A("colorthemeset")),o()}).catch(x=>{s.w(`Couldn't set color theme: ${x}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,u){const g=this.getFragmentStyle(o);g&&(g._styleColorTheme.colorThemeOverride=u,g._reloadColorTheme())}_getTransitionParameters(o){return{now:s.q.now(),transition:s.h(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],u=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?o.push(g):u.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...u)}_createTerrain(o,u){const g=this.terrain=new Ve(o,u,this.scope,this.options,this.map.getWorldview());u===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});g.updateTransitions(x)}_force3DLayerUpdate(){for(const o in this._layers){const u=this._layers[o];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const u=this._layers[o];u.type==="symbol"&&this._updateLayer(u)}}_validate(o,u,g,x,b={}){if(b&&b.validate===!1)return!1;const E=s.h({},this.serialize());return Fc(this,o.call(To,s.h({key:u,style:E,value:g,styleSpec:s.a5},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const u=this.getSourceCaches(o);for(const g of u)g.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(const o in this._mergedLayers){const u=this._mergedLayers[o];u._clear&&u._clear()}}reloadSource(o){const u=this.getSourceCaches(o);for(const g of u)g.resume(),g.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let u;this.directionalLight&&(u=Qh(this.directionalLight));const g=new Set;for(const x in this._mergedLayers){const b=this._mergedLayers[x];b.hasElevation()&&!g.has(b.source)&&g.add(b.source)}for(const x in this._mergedSourceCaches){const b=this._mergedSourceCaches[x],E=g.has(b._source.id);b.update(o,void 0,void 0,u,E)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const u=this._sourceCaches[o];u.resume(),u.reload()}}_updatePlacement(o,u,g,x,b,E,C=!1){let M=!1,z=!1;const F={},H={};for(const $ of this._mergedOrder){const K=this._mergedLayers[$];if(K.type!=="symbol")continue;const te=s.C(K.source,K.scope);let ee=F[te];if(!ee){const ie=this.getLayerSourceCache(K);if(!ie)continue;const ue=ie.getRenderableIds(!0).map(pe=>ie.getTileByID(pe));H[te]=ue.slice(),ee=F[te]=ue.sort((pe,me)=>me.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(me.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer(K,ee,u.center.lng,u.projection);M=M||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),u.zoom))&&(this.pauseablePlacement=new Zm(u,this._mergedOrder,C,g,x,b,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,H,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),z=!0),M&&this.pauseablePlacement.placement.setStale()),z||M){this._buildingIndex.onNewFrame(u.zoom);for(let $=0;$<this._mergedOrder.length;$++){const K=this._mergedLayers[this._mergedOrder[$]];if(K.type!=="symbol")continue;const te=this.isLayerClipped(K);this.placement.updateLayerOpacities(K,F[s.C(K.source,K.scope)],$,te?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,u){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:b})=>b===o.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!u)return g.push(o),this._loadImports([o],!0);const x=g.findIndex(({id:b})=>b===u);return x===-1&&this.fire(new s.z(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,x).concat(o).concat(g.slice(x)),this._loadImports([o],!0,u)}updateImport(o,u){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(o);return x===-1?this:typeof u=="string"?(this.setImportUrl(o,u),this):(u.url&&u.url!==g[x].url&&this.setImportUrl(o,u.url),s.bv(u.config,g[x].config)||this.setImportConfig(o,u.config,u.data.schema),s.bv(u.data,g[x].data)||this.setImportData(o,u.data),this)}moveImport(o,u){this._checkLoaded();let g=this.stylesheet.imports||[];const x=this.getImportIndex(o);if(x===-1)return this;const b=this.getImportIndex(u);if(b===-1)return this;const E=g[x],C=this.fragments[x];return g=g.filter(({id:M})=>M!==o),this.fragments=this.fragments.filter(({id:M})=>M!==o),this.stylesheet.imports=g.slice(0,b).concat(E).concat(g.slice(b)),this.fragments=this.fragments.slice(0,b).concat(C).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(o,u){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(o);if(x===-1)return this;g[x].url=u;const b=this.fragments[x];return b.style=this._createFragmentStyle(g[x]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(u),this}setImportData(o,u){this._checkLoaded();const g=this.getImportIndex(o),x=this.stylesheet.imports||[];return g===-1?this:u?(this.fragments[g].style.setState(u),this._reloadImports(),this):(delete x[g].data,this.setImportUrl(o,x[g].url))}setImportConfig(o,u,g){this._checkLoaded();const x=this.getImportIndex(o),b=this.stylesheet.imports||[];if(x===-1)return this;u?b[x].config=u:delete b[x].config;const E=this.fragments[x];g&&E.style.stylesheet&&(E.style.stylesheet.schema=g);const C=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=u,E.style.updateConfig(u,C),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const u=this.stylesheet.imports||[],g=this.getImportIndex(o);g!==-1&&(u.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(o){const u=(this.stylesheet.imports||[]).findIndex(g=>g.id===o);return u===-1&&this.fire(new s.z(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),u}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const u in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[u];g&&o.push(g.getSource())}return o}getSource(o,u){const g=this.getSourceCache(o,u);return g&&g.getSource()}getLayerSource(o){const u=this.getLayerSourceCache(o);return u&&u.getSource()}getSourceCache(o,u){const g=s.C(o,u);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(o){const u=s.C(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[o]&&u.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&u.push(this._mergedSymbolSourceCaches[o]),u}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const u in o){const g=o[u];g==="reload"?this.reloadSource(u):g==="clear"&&this.clearSource(u)}}updateLayers(o){const u=this._changes.getUpdatedPaintProperties();for(const g of u){const x=this.getLayer(g);x&&x.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,u,g){this.imageManager.getImages(u.images,u.scope,g),this._updateTilesForChangedImages();const x=E=>{if(E){const C=u.images.map(M=>s.I.toString(M));E.setDependencies(u.tileID.key,u.type,C)}},b=s.C(u.source,u.scope);x(this._mergedOtherSourceCaches[b]),x(this._mergedSymbolSourceCaches[b]),u.images.some(E=>E.iconsetId)&&this.fire(new s.A("data",{dataType:"style"}))}rasterizeImages(o,u,g){this.imageManager.rasterizeImages(u,g)}getGlyphs(o,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(o,u,g){return s.dt(u,g)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const u=[];return this._otherSourceCaches[o]&&u.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&u.push(this._symbolSourceCaches[o]),u}_isSourceCacheLoaded(o){const u=this.getOwnSourceCaches(o);return u.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${o}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,u){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const g=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),x=o.type==="building";if(o.is3D(!!this.terrain)){if(g||x||u&&u.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ca.getSourceType=function(m){return Bm[m]},Ca.setSourceType=function(m,o){Bm[m]=o},Ca.registerForPluginStateChange=s.du;var Mv=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,td=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,rd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ov="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Jm=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,sa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Dt=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jv=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,eg=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,tg=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Qf=[];tl(Mv,Qf),tl(rd,Qf),tl(td,Qf);const $u={"_prelude_fog.vertex.glsl":sa,"_prelude_terrain.vertex.glsl":Jm,"_prelude_shadow.vertex.glsl":eg,"_prelude_fog.fragment.glsl":Qm,"_prelude_shadow.fragment.glsl":tg,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Dt,"_prelude_raster_particle.glsl":jv},Ia={};Xr("",Jm),Xr(Qm,sa),Xr(tg,eg),Xr(Dt,""),Xr(jv,"");const rg=Xr(td,rd),Vc=Mv;var ep={background:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Xr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Xr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Xr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Xr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Xr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Xr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Xr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Xr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Xr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Xr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Xr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Xr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Xr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Xr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Xr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Xr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Xr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Xr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ov),skyboxGradient:Xr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ov),skyboxCapture:Xr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Xr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Xr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Xr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Xr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Xr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Xr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Xr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function tl(m,o){const u=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of u)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=g.split(" ");for(const b of x)o.includes(b)||o.push(b)}}function Xr(m,o){const u=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(z=>{const F=z.split(" ");return F[F.length-1]}),x=[...new Set(x)]);const b={},E=[],C=[];if(m=m.replace(u,(z,F)=>(C.push(F),"")),(o=o.replace(u,(z,F)=>(E.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...Qf];tl(m,M),tl(o,M);for(const z of[...E,...C])$u[z]||console.error(`Undefined include: ${z}`),Ia[z]||(Ia[z]=[],tl($u[z],Ia[z])),M=[...M,...Ia[z]];return{fragmentSource:m=m.replace(g,(z,F,H,$,K)=>(b[K]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${K}
in ${H} ${$} ${K};
#else
uniform ${H} ${$} u_${K};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${K}
    ${H} ${$} ${K} = u_${K};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${H} ${$} ${K};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(g,(z,F,H,$,K)=>{const te=$==="float"?"vec2":$,ee=K.match(/color/)?"color":te;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${K}
in ${H} ${$} a_${K};
#endif
`:b[K]?F==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${H} ${te} a_${K};
out ${H} ${$} ${K};
#else
uniform ${H} ${$} u_${K};
#endif
`:F==="initialize"?ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${H} ${$} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${ee}(a_${K}, u_${K}_t);
#else
    ${H} ${$} ${K} = u_${K};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${H} ${$} a_${K};
    out ${H} ${$} ${K};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${K} = a_${K};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${H} ${te} a_${K};
#else
uniform ${H} ${$} u_${K};
#endif
`:F==="define-instanced"?ee==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${K}0;
in vec4 a_${K}1;
in vec4 a_${K}2;
in vec4 a_${K}3;
#else
uniform ${H} ${$} u_${K};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${H} ${te} a_${K};
#else
uniform ${H} ${$} u_${K};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${H} ${$} ${K} = a_${K};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${H} ${$} ${K} = a_${K};
#else
    ${H} ${$} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${H} ${$} ${K} = unpack_mix_${ee}(a_${K}, u_${K}_t);
#else
    ${H} ${$} ${K} = u_${K};
#endif
`}),staticAttributes:x,usedDefines:M,vertexIncludes:E,fragmentIncludes:C}}class CP{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,u,g,x,b,E,C,M){this.context=o;let z=this.boundPaintVertexBuffers.length!==x.length;for(let H=0;!z&&H<x.length;H++)this.boundPaintVertexBuffers[H]!==x[H]&&(z=!0);let F=this.boundDynamicVertexBuffers.length!==C.length;for(let H=0;!F&&H<C.length;H++)this.boundDynamicVertexBuffers[H]!==C[H]&&(F=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||z||F||this.boundIndexBuffer!==b||this.boundVertexOffset!==E)this.freshBind(u,g,x,b,E,C,M);else{o.bindVertexArrayOES.set(this.vao);for(const H of C)H&&(H.bind(),M&&H.instanceCount&&H.setVertexAttribDivisor(o.gl,u,M));b&&b.dynamicDraw&&b.bind()}}freshBind(o,u,g,x,b,E,C){const M=o.numAttributes,z=this.context,F=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=E,u.enableAttributes(F,o),u.bind(),u.setVertexAttribPointers(F,o,b);for(const H of g)H.enableAttributes(F,o),H.bind(),H.setVertexAttribPointers(F,o,b);for(const H of E)H&&(H.enableAttributes(F,o),H.bind(),H.setVertexAttribPointers(F,o,b),C&&H.instanceCount&&H.setVertexAttribDivisor(F,o,C));x&&x.bind(),z.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Rv(m,o){const u=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new s.ac(0,g/u).toLngLat().lat,new s.ac(0,(g+1)/u).toLngLat().lat]}function IP(m,o,u,g,x,b,E){const C=m.context,M=C.gl,z=u.hillshadeFBO;if(!z)return;m.prepareDrawTile();const F=m.isTileAffectedByFog(o),H=m.getOrCreateProgram("hillshade",{overrideFog:F});C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,z.colorAttachment.get());const $=((re,ie,ue,pe)=>{const me=ue.paint.get("hillshade-shadow-color"),Te=ue.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",we=ue.paint.get("hillshade-highlight-color"),Ce=ue.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",be=ue.paint.get("hillshade-accent-color"),Se=ue.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ee=ue.paint.get("hillshade-emissive-strength");let Ue=s.al(ue.paint.get("hillshade-illumination-direction"));if(ue.paint.get("hillshade-illumination-anchor")==="viewport")Ue-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const dt=re.style.directionalLight.properties.get("direction"),Je=s.d1(dt.x,dt.y,dt.z);Ue=s.al(Je[1])}const De=!re.options.moving;return{u_matrix:pe||re.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),De),u_image:0,u_latrange:Rv(0,ie.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),Ue],u_shadow:me.toPremultipliedRenderColor(Te?null:ue.lut),u_highlight:we.toPremultipliedRenderColor(Ce?null:ue.lut),u_emissive_strength:Ee,u_accent:be.toPremultipliedRenderColor(Se?null:ue.lut)}})(m,u,g,m.terrain?o.projMatrix:null);m.uploadCommonUniforms(C,H,o.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:te,tileBoundsSegments:ee}=m.getTileBoundsBuffers(u);H.draw(m,M.TRIANGLES,x,b,E,ur.disabled,$,g.id,K,te,ee)}function Dv(m,o,u){if(!o.needsDEMTextureUpload)return;const g=m.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(u.stride);const b=u.getPixels();o.demTexture?o.demTexture.update(b,{premultiply:!1}):o.demTexture=new s.T(g,b,x.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function k1(m,o,u){const g=m.context,x=g.gl;if(!o.dem)return;const b=o.dem;if(g.activeTexture.set(x.TEXTURE1),Dv(m,o,b),!o.demTexture)return;o.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const E=b.dim;g.activeTexture.set(x.TEXTURE0);let C=o.hillshadeFBO;if(!C){const $=new s.T(g,{width:E,height:E,data:null},x.RGBA8);$.bind(x.LINEAR,x.CLAMP_TO_EDGE),C=o.hillshadeFBO=g.createFramebuffer(E,E,!0,"renderbuffer"),C.colorAttachment.set($.texture)}g.bindFramebuffer.set(C.framebuffer),g.viewport.set([0,0,E,E]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:z,tileBoundsSegments:F}=m.getMercatorTileBoundsBuffers(),H=[];m.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(m,x.TRIANGLES,Wt.disabled,mr.disabled,Or.unblended,ur.disabled,(($,K)=>{const te=K.stride,ee=s.bz();return s.ca(ee,0,s.aj,-s.aj,0,0,1),s.bo(ee,ee,[0,-s.aj,0]),{u_matrix:ee,u_image:1,u_dimension:[te,te],u_zoom:$.overscaledZ}})(o.tileID,b),u.id,M,z,F),o.needsHillshadePrepare=!1}class li{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class MP extends li{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class OP extends li{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class jP extends li{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class RP extends li{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class P1 extends li{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class DP extends li{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ng extends li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class LP extends li{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class C1 extends li{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class Lv extends li{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class ig extends li{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class zv extends li{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Gu extends li{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class nd extends li{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class sg extends li{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class og extends li{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class id extends li{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class I1 extends li{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Nv extends li{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let M1=class extends li{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class sd extends li{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class ag extends li{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class lg extends li{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Fv extends li{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class cg extends li{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class tp extends li{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class O1 extends li{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class j1 extends li{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class R1 extends li{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class od extends li{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class D1 extends li{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Bv extends li{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class zP extends Bv{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class L1 extends Bv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Vv extends Bv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Uv extends L1{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const $v=(m,o,u)=>({u_matrix:m,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:u}),ug=(m,o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:x,u_merc_center:b,u_image0:0,u_frustum_tl:E,u_frustum_tr:C,u_frustum_br:M,u_frustum_bl:z,u_globe_pos:F,u_globe_radius:H,u_viewport:$,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:K,u_far_z_cutoff:te});function Gv(m,o){return m!=null&&o!=null&&!(!m.hasData()||!o.hasData())&&m.demTexture!=null&&o.demTexture!=null&&m.tileID.key!==o.tileID.key}const Hu=new class{constructor(){this.operations={}}newMorphing(m,o,u,g,x){if(m in this.operations){const b=this.operations[m];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[m]={startTime:g,phase:0,duration:x,from:o,to:u,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const o=this.operations[m];return{from:o.from,to:o.to,phase:o.phase}}update(m){for(const o in this.operations){const u=this.operations[o];for(u.phase=(m-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,m)){delete this.operations[o];break}}}_nextOp(m,o){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=o,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},z1={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ad(m,o,u){if(o===0)return 0;const g=o<1&&u===514?.25/o:1;return 6*Math.pow(1.5,22-m)*Math.max(o,1)*g}function rp(m,o){const u=1<<m.z;return!o&&(m.x===0||m.x===u-1)||m.y===0||m.y===u-1}const hg=m=>({u_matrix:m});function Po(m,o,u,g,x){if(x>0){const b=s.q.now(),E=(b-m.timeAdded)/x,C=o?(b-o.timeAdded)/x:-1,M=u.getSource(),z=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),F=!o||Math.abs(o.tileID.overscaledZ-z)>Math.abs(m.tileID.overscaledZ-z),H=F&&m.refreshedUponExpiration?1:s.ay(F?E:1-C,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class Hv extends Ao{constructor(o){const u=Of("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",u,!1),u.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,u){o.state="loaded",u(null)}}class dg extends Ao{constructor(o){const u=Of("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,u,g){if(o.freezeTileCoverage)return;this.transform=o;const x=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const C=new Du(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);C.state="loaded",this._tiles[E.key]=C}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(o){const u=this.proxyCachedFBO[o];if(u!==void 0){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class np extends s.aM{constructor(o,u,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class fg extends s.dF{constructor(o,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,b]=function(M){const z=new s.ba,F=new s.a_,H=131;z.reserve(17161),F.reserve(33800);const $=s.aj/128,K=s.aj+$/2,te=K+$;for(let re=-$;re<te;re+=$)for(let ie=-$;ie<te;ie+=$){const ue=ie<0||ie>K||re<0||re>K?24575:0,pe=s.ay(Math.round(ie),0,s.aj),me=s.ay(Math.round(re),0,s.aj);z.emplaceBack(pe+ue,me)}const ee=(re,ie)=>{const ue=ie*H+re;F.emplaceBack(ue+1,ue,ue+H),F.emplaceBack(ue+H,ue+H+1,ue+1)};for(let re=1;re<129;re++)for(let ie=1;ie<129;ie++)ee(ie,re);return[0,129].forEach(re=>{for(let ie=0;ie<130;ie++)ee(ie,re),ee(re,ie)}),[z,F,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(g,s.bc.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=s.bd.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=s.bd.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new dg(u.map),this.orthoMatrix=s.bz(),s.ca(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.aj,0,s.aj,0,1);const C=E.gl;this._overlapStencilMode=new mr({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Hv(u.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,u,g){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const x=o.terrain.properties,b=o.terrain.drapeRenderMode===0,E=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const C=o.terrain&&o.terrain.scope,M=x.get("source"),z=b?this._mockSourceCache:o.getSourceCache(M,C);if(!z)return void s.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=z,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(u):x.get("exaggeration"),!u.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const H=this.getScaledDemTileSize();this.sourceCache.update(u,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),u.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const u=this._previousCameraAltitude,g=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=g;const x=u!=null?g-u:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const b=o.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(b);let C=b-this._previousZoom;const M=this._previousUpdateTimestamp;let z=b;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(b-z)>.5&&(C=.5*(b-z+C)),C*x<0&&(z+=C)),this._evaluationZoom=z;const F=E.getExaggeration(z),H=F===E.getExaggeration(Math.max(0,z-.1));if(H&&Math.abs(F-this._exaggeration)<.01)return F;let $=Math.min(.1,.00375*(this._updateTimestamp-M));return(H||F<.1||Math.abs(C)<1e-4)&&($=Math.min(.2,4*$)),s.ai(this._exaggeration,F,$)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=u.getIds().map(M=>{const z=u.getTileByID(M).tileID;return z.projMatrix=g.calculateProjMatrix(z.toUnwrapped()),z});(function(M,z){const F=z.transform.pointCoordinate(z.transform.getCameraPoint()),H=new s.P(F.x,F.y);M.sort(($,K)=>{if(K.overscaledZ-$.overscaledZ)return K.overscaledZ-$.overscaledZ;const te=new s.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),ee=new s.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),re=H.mult(1<<$.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(te)-re.distSqr(ee)})})(x,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const M in E){const z=E[M];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,o[M],b),z.usedForTerrain))continue;const F=o[M];z.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[u.id]=x.map(M=>new np(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const z=this.terrainTileForTile[M.key];if(!z)continue;const F=z.tileID.key;F in C||(this._visibleDemTiles.push(z),C[F]=F)}}_assignTerrainTiles(o){this._initializing||o.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,u=o.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(o.activeTexture.set(u.TEXTURE1),Dv(this.painter,x,b))}}_prepareDemTileUniforms(o,u,g,x){if(!u||u.demTexture==null)return!1;const b=o.tileID.canonical,E=Math.pow(2,u.tileID.canonical.z-b.z),C=x||"";return g[`u_dem_tl${C}`]=[b.x*E%1,b.y*E%1],g[`u_dem_scale${C}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const u=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const b=x.dem.tree.minimums[0];return b>0&&o++,g+b},0);return o?u/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,u=o.gl;o.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),x=new s.dG({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new s.T(o,x,u.R32F,{premultiply:!1}),b}setupElevationDraw(o,u,g){const x=this.painter.context,b=x.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let C=null,M=null,z=1;if(g&&g.morphing&&this._useVertexMorphing){const K=g.morphing.srcDemTile,te=g.morphing.dstDemTile;z=g.morphing.phase,K&&te&&(this._prepareDemTileUniforms(o,K,E,"_prev")&&(M=K),this._prepareDemTileUniforms(o,te,E)&&(C=te))}const F=K=>K&&K.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let H=null;var $;if(this.enabled?M&&C?(H=C.demTexture,x.activeTexture.set(b.TEXTURE4),M.demTexture.bind(F(M),b.CLAMP_TO_EDGE),E.u_dem_lerp=z):(C=this.terrainTileForTile[o.tileID.key],H=this._prepareDemTileUniforms(o,C,E)?C.demTexture:this.emptyDEMTexture):H=this.emptyDEMTexture,x.activeTexture.set(b.TEXTURE2),H&&(E.u_dem_size=($=H).size[0]===1?1:$.size[0]-2,H.bind(F(C),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,u,E),g&&g.useMeterToDem&&C){const K=(1<<C.tileID.canonical.z)*s.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=K}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(x,E),this.painter.transform.projection.name==="globe"){const K=this.globeUniformValues(this.painter.transform,o.tileID.canonical,g&&g.useDenormalizedUpVectorScale);u.setGlobeUniformValues(x,K)}}globeUniformValues(o,u,g){const x=o.projection;return{u_tile_tl_up:x.upVector(u,0,0),u_tile_tr_up:x.upVector(u,s.aj,0),u_tile_br_up:x.upVector(u,s.aj,s.aj),u_tile_bl_up:x.upVector(u,0,s.aj),u_tile_up_scale:g?s.dH(1):x.upVectorScale(u,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const u=this.painter,g=this.painter.context;o.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,b,E,C,M){if(x.transform.projection.name==="globe")(function(z,F,H,$,K){const te=z.context,ee=te.gl;let re,ie;const ue=z.transform,pe=s.dy(z,te,ue),me=(dt,Je)=>{if(ie===Je)return;const pt=[z1[Je],"PROJECTION_GLOBE_VIEW"];pe&&pt.push("CUSTOM_ANTIALIASING");const Pt=z.isTileAffectedByFog(dt);re=z.getOrCreateProgram("globeRaster",{defines:pt,overrideFog:Pt}),ie=Je},Te=z.colorModeForRenderPass(),we=new Wt(ee.LEQUAL,Wt.ReadWrite,z.depthRangeFor3D);Hu.update(K);const Ce=s.dz(ue),be=[s.aD(ue.center.lng),s.aH(ue.center.lat)],Se=z.globeSharedBuffers,Ee=[ue.width*s.q.devicePixelRatio,ue.height*s.q.devicePixelRatio],Ue=Float32Array.from(ue.globeMatrix),De={useDenormalizedUpVectorScale:!0};{const dt=z.transform,Je=ad(dt.zoom,F.exaggeration(),F.sourceCache._source.tileSize);ie=-1;const pt=ee.TRIANGLES;for(const Pt of $){const qe=H.getTile(Pt),Re=mr.disabled,nt=F.prevTerrainTileForTile[Pt.key],Ze=F.terrainTileForTile[Pt.key];Gv(nt,Ze)&&Hu.newMorphing(Pt.key,nt,Ze,K,250),te.activeTexture.set(ee.TEXTURE0),qe.texture&&qe.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const yt=Hu.getMorphValuesForProxy(Pt.key),bt=yt?1:0;yt&&s.L(De,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:s.dx(yt.phase)}});const Et=s.dA(Pt.canonical),jt=s.dB(Et.getCenter().lat),tr=s.dC(Pt.canonical,Et,jt,dt.worldSize/dt._pixelsPerMercatorPixel),ir=s.bh(s.dD(Pt.canonical)),Zt=ug(dt.expandedFarZProjMatrix,Ue,Ce,ir,s.ah(dt.zoom),be,dt.frustumCorners.TL,dt.frustumCorners.TR,dt.frustumCorners.BR,dt.frustumCorners.BL,dt.globeCenterInViewSpace,dt.globeRadius,Ee,Je,dt._farZ,tr);if(me(Pt,bt),re&&(F.setupElevationDraw(qe,re,De),z.uploadCommonUniforms(te,re,Pt.toUnwrapped()),Se)){const[er,nr,wr]=Se.getGridBuffers(jt,Je!==0);re.draw(z,pt,we,Re,Te,ur.backCCW,Zt,"globe_raster",er,nr,wr)}}}if(Se&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const dt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&dt.push("CUSTOM_ANTIALIASING"),re=z.getOrCreateProgram("globeRaster",{defines:dt});for(const Je of $){const{x:pt,y:Pt,z:qe}=Je.canonical,Re=Pt===0,nt=Pt===(1<<qe)-1,[Ze,yt,bt,Et]=Se.getPoleBuffers(qe,!1);if(Et&&(Re||nt)){const jt=H.getTile(Je);te.activeTexture.set(ee.TEXTURE0),jt.texture&&jt.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);let tr=s.dE(qe,pt,ue);const ir=s.bh(s.dD(Je.canonical)),Zt=(er,nr)=>er.draw(z,ee.TRIANGLES,we,mr.disabled,Te,ur.disabled,ug(ue.expandedFarZProjMatrix,tr,tr,ir,0,be,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,Ee,0,ue._farZ),"globe_pole_raster",nr,bt,Et);F.setupElevationDraw(jt,re,De),z.uploadCommonUniforms(te,re,Je.toUnwrapped()),Re&&z.renderDefaultNorthPole&&Zt(re,Ze),nt&&z.renderDefaultSouthPole&&(tr=s.cP(s.bz(),tr,[1,-1,1]),Zt(re,yt))}}}})(x,b,E,C,M);else{const z=x.context,F=z.gl;let H,$;const K=x.shadowRenderer,te=yl(x,x.longestCutoffRange),ee=Te=>{if($===Te)return;const we=[];we.push(z1[Te]),te.shouldRenderCutoff&&we.push("RENDER_CUTOFF"),K&&(we.push("RENDER_SHADOWS","DEPTH_TEXTURE"),K.useNormalOffset&&we.push("NORMAL_OFFSET")),H=x.getOrCreateProgram("terrainRaster",{defines:we}),$=Te},re=x.colorModeForRenderPass(),ie=new Wt(F.LEQUAL,Wt.ReadWrite,x.depthRangeFor3D);Hu.update(M);const ue=x.transform,pe=ad(ue.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let me=[0,0,0];if(K){const Te=x.style.directionalLight,we=x.style.ambientLight;Te&&we&&(me=Uu(x.style,Te,we))}{$=-1;const Te=F.TRIANGLES,[we,Ce]=[b.gridIndexBuffer,b.gridSegments];for(const be of C){const Se=E.getTile(be),Ee=mr.disabled,Ue=b.prevTerrainTileForTile[be.key],De=b.terrainTileForTile[be.key];Gv(Ue,De)&&Hu.newMorphing(be.key,Ue,De,M,250),z.activeTexture.set(F.TEXTURE0),Se.texture&&Se.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const dt=Hu.getMorphValuesForProxy(be.key),Je=dt?1:0;let pt;dt&&(pt={morphing:{srcDemTile:dt.from,dstDemTile:dt.to,phase:s.dx(dt.phase)}});const Pt=$v(be.projMatrix,rp(be.canonical,ue.renderWorldCopies)?pe/10:pe,me);if(ee(Je),!H)continue;b.setupElevationDraw(Se,H,pt);const qe=be.toUnwrapped();K&&K.setupShadows(qe,H),x.uploadCommonUniforms(z,H,qe,null,te),H.draw(x,Te,ie,Ee,re,ur.backCCW,Pt,"terrain_raster",b.gridBuffer,we,Ce)}}}}(u,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),C=u.style.order,M=[];let z=0;for(const F of b){const H=x.getTileByID(F.proxyTileKey),$=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][o]:void 0,K=$!==void 0?x.renderCache[$]:this.pool[z++],te=$!==void 0;if(H.texture=K.tex,te&&!K.dirty){M.push(H.tileID);continue}let ee;g.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(g.clear({color:s.am.transparent,stencil:0}),K.dirty=!1);for(let re=E.start;re<=E.end;++re){const ie=u.style._mergedLayers[C[re]];if(ie.isHidden(u.transform.zoom))continue;const ue=u.style.getLayerSourceCache(ie),pe=ue?this.proxyToSource[F.key][ue.id]:[F];if(!pe)continue;const me=pe;g.viewport.set([0,0,K.fb.width,K.fb.height]),ee!==(ue?ue.id:null)&&(this._setupStencil(K,pe,ie,ue),ee=ue?ue.id:null),u.renderLayer(u,ue,ie,me)}if(this._drapedRenderBatches.length===0)for(const re of this._pendingGroundEffectLayers){const ie=u.style._mergedLayers[C[re]];if(ie.isHidden(u.transform.zoom))continue;const ue=u.style.getLayerSourceCache(ie),pe=ue?this.proxyToSource[F.key][ue.id]:[F];if(!pe)continue;const me=pe;g.viewport.set([0,0,K.fb.width,K.fb.height]),ee!==(ue?ue.id:null)&&(this._setupStencil(K,pe,ie,ue),ee=ue?ue.id:null),u.renderLayer(u,ue,ie,me)}this.renderedToTile?(K.dirty=!0,M.push(H.tileID)):te||--z,z===5&&(z=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),E.end+1}postRender(){}isLayerOrderingCorrect(o){const u=o.order.length;let g=-1,x=u;for(let b=0;b<u;++b)this._style.isLayerDraped(o._mergedLayers[o.order[b]])?g=Math.max(g,b):x=Math.min(x,b);return x>g}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{o=Math.min(o,u.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,u,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,C=1<<E.overscaledZ,{x:M,y:z}=E.canonical,F=M/C,H=(M+1)/C,$=z/C,K=(z+1)/C;return{minx:F,miny:$,maxx:H,maxy:K,t:b.dem.tree.raycastRoot(F,$,H,K,o,u,g),tile:b}});x.sort((b,E)=>(b.t!==null?b.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const b of x){if(b.t==null)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,o,u,g);if(E!=null)return E}return null}_createFBO(){const o=this.painter.context,u=o.gl,g=this.drapeBufferSize;o.activeTexture.set(u.TEXTURE0);const x=new s.T(o,{width:g[0],height:g[1],data:null},u.RGBA8);x.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=o.createFramebuffer(g[0],g[1],!0,null);return b.colorAttachment.set(x.texture),b.depthAttachment=new Uv(o,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const u=this._style._mergedLayers[o],g=u.isHidden(this.painter.transform.zoom);return u.type==="hillshade"||u.type==="custom"?!g&&u.shouldRedrape():!g&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const g of this._style.getSources())if(g instanceof Mf){o=!0;break}if(!o)return;const u={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],b=this._style.getLayerSourceCache(x);if(b&&!u[b.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof s.ab){u[b.id]=!0;for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][b.id];if(C)for(const M of C)this._clearRenderCacheForTile(b.id,M)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof Cs){o=!0;break}if(!o)return;const u={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],b=this._style.getLayerSourceCache(x);if(!b||u[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const E=x.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const M=this.proxyToSource[C.key][b.id];if(M)for(const z of M){const F=Po(b.getTile(z),b.findLoadedParent(z,0),b,this.painter.transform,E);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(b.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,u=o.length;if(u===0)return;const g=[];this._pendingGroundEffectLayers=[];let x,b=0,E=this._style._mergedLayers[o[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<u;)E=this._style._mergedLayers[o[b]];for(;b<u;++b){const C=this._style._mergedLayers[o[b]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?x===void 0&&(x=b):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),x!==void 0&&(g.push({start:x,end:b-1}),x=void 0)))}if(x!==void 0&&g.push({start:x,end:b-1}),g.length!==0){const C=g[g.length-1];this._pendingGroundEffectLayers.every(M=>M>C.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(o){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const E=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let C=0;C<E.length;++C){const M=Object.values(E[C]);u.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let E=g.length-1;E>=0;E--){const C=g[E];if(u.getTileByID(C.key),u.proxyCachedFBO[C.key]!==void 0){const M=o[C.key],z=this.proxyToSource[C.key];let F=0;for(const H in z){const $=z[H],K=M[H];if(!K||K.length!==$.length||$.some((te,ee)=>te!==K[ee]||x[H]&&x[H].hasOwnProperty(te.key))){F=-1;break}++F}for(const H in u.proxyCachedFBO[C.key])u.renderCache[u.proxyCachedFBO[C.key][H]].dirty=F<0||F!==Object.values(M).length}}const b=[...this._drapedRenderBatches];b.sort((E,C)=>C.end-C.start-(E.end-E.start));for(const E of b)for(const C of g){if(u.proxyCachedFBO[C.key])continue;let M=u.renderCachePool.pop();M===void 0&&u.renderCache.length<50&&(M=u.renderCache.length,u.renderCache.push(this._createFBO())),M!==void 0&&(u.proxyCachedFBO[C.key]={},u.proxyCachedFBO[C.key][E.start]=M,u.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(o,u,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let C;if(g.isTileClipped())C=u.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):mr.disabled}_renderTileClippingMasks(o,u){const g=this.painter,x=this.painter.context,b=x.gl;g._tileClippingMaskIDs={},x.setColorMode(Or.disabled),x.setDepthMode(Wt.disabled);const E=g.getOrCreateProgram("clippingMask");for(const C of o){const M=g._tileClippingMaskIDs[C.key]=--u;E.draw(g,b.TRIANGLES,Wt.disabled,new mr({func:b.ALWAYS,mask:0},M,255,b.KEEP,b.KEEP,b.REPLACE),Or.disabled,ur.disabled,hg(C.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const u=this.painter.transform;if(o.x<0||o.x>u.width||o.y<0||o.y>u.height)return null;const g=[o.x,o.y,1,1];s.aA(g,g,u.pixelMatrixInverse),s.cH(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const x=u._camera.position,b=s.cb(1,u.center.lat),E=[x[0],x[1],x[2]/b,0],C=s.d7([],g.slice(0,3),E);s.au(C,C);const M=this.raycast(E,C,this._exaggeration);return M!==null&&M?(s.bE(E,E,C,M),E[3]=E[2],E[2]*=b,E):null}_setupProxiedCoordsForOrtho(o,u,g){if(o.getSource()instanceof s.aP)return this._setupProxiedCoordsForImageSource(o,u,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const x=this.proxiedCoords[o.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const z=b[M],F=this._findTileCoveringTileID(z,o);if(F){const H=this._createProxiedId(z,F,g[z.key]&&g[z.key][o.id]);x.push(H),this.proxyToSource[z.key][o.id]=[H]}}let E=!1;const C=new Set;for(let M=0;M<u.length;M++){const z=o.getTile(u[M]);if(!z||!z.hasData())continue;const F=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==z.tileID.canonical.z){const H=this.proxyToSource[F.tileID.key][o.id],$=this._createProxiedId(F.tileID,z,g[F.tileID.key]&&g[F.tileID.key][o.id]);H?H.splice(H.length-1,0,$):this.proxyToSource[F.tileID.key][o.id]=[$];const K=this.proxyToSource[F.tileID.key][o.id];C.has(K)||C.add(K),x.push($),E=!0}}if(this._sourceTilesOverlap[o.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const M of C)M.sort((z,F)=>F.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(o,u,g){if(!o.getSource().loaded())return;const x=this.proxiedCoords[o.id]=[],b=this.proxyCoords,E=o.getSource(),C=E.tileID;if(!C)return;const M=new s.P(C.x,C.y)._div(1<<C.z),z=E.coordinates.map(s.ac.fromLngLat).reduce((H,$)=>(H.min.x=Math.min(H.min.x,$.x-M.x),H.min.y=Math.min(H.min.y,$.y-M.y),H.max.x=Math.max(H.max.x,$.x-M.x),H.max.y=Math.max(H.max.y,$.y-M.y),H),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(H,$)=>{const K=H.wrap+H.canonical.x/(1<<H.canonical.z),te=H.canonical.y/(1<<H.canonical.z),ee=s.aj/(1<<H.canonical.z),re=$.wrap+$.canonical.x/(1<<$.canonical.z),ie=$.canonical.y/(1<<$.canonical.z);return K+ee<re+z.min.x||K>re+z.max.x||te+ee<ie+z.min.y||te>ie+z.max.y};for(let H=0;H<b.length;H++){const $=b[H];for(let K=0;K<u.length;K++){const te=o.getTile(u[K]);if(!te||!te.hasData()||F($,te.tileID))continue;const ee=this._createProxiedId($,te,g[$.key]&&g[$.key][o.id]),re=this.proxyToSource[$.key][o.id];re?re.push(ee):this.proxyToSource[$.key][o.id]=[ee],x.push(ee)}}}_createProxiedId(o,u,g){let x=this.orthoMatrix;if(g){const b=g.find(E=>E.key===u.tileID.key);if(b)return b}if(u.tileID.key!==o.key){const b=o.canonical.z-u.tileID.canonical.z;let E,C,M;x=s.bz();const z=u.tileID.wrap-o.wrap<<o.overscaledZ;b>0?(E=s.aj>>b,C=E*((u.tileID.canonical.x<<b)-o.canonical.x+z),M=E*((u.tileID.canonical.y<<b)-o.canonical.y)):(E=s.aj<<-b,C=s.aj*(u.tileID.canonical.x-(o.canonical.x+z<<-b)),M=s.aj*(u.tileID.canonical.y-(o.canonical.y<<-b))),s.ca(x,0,E,0,E,0,1),s.bo(x,x,[C,M,0])}return new np(u.tileID,o.key,x)}_findTileCoveringTileID(o,u){let g=u.getTile(o);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[u.id],b=x[o.key];if(g=b?u.getTileByID(b):null,g&&g.hasData()||b===null)return g;let E=g?g.tileID:o,C=E.overscaledZ;const M=u.getSource().minzoom,z=[];if(!b){const H=u.getSource().maxzoom;if(o.canonical.z>=H){const $=o.canonical.z-H;u.getSource().reparseOverscaled?(C=Math.max(o.canonical.z+2,u.transform.tileZoom),E=new s.aM(C,o.wrap,H,o.canonical.x>>$,o.canonical.y>>$)):$!==0&&(C=H,E=new s.aM(C,o.wrap,H,o.canonical.x>>$,o.canonical.y>>$))}E.key!==o.key&&(z.push(E.key),g=u.getTile(E))}const F=H=>{z.forEach($=>{x[$]=H}),z.length=0};for(C-=1;C>=M&&(!g||!g.hasData());C--){g&&F(g.tileID.key);const H=E.calculateScaledKey(C);if(g=u.getTileByID(H),g&&g.hasData())break;const $=x[H];if($===null)break;$===void 0?z.push(H):g=u.getTileByID($)}return F(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,u){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[u.key]=!0}}function Wv(m,o,u){const g=function(C,M,z){const F=s.bG(M,C),H=s.bG(z,[.2126,.7152,.0722]),$=(te,ee,re)=>(1-re)*te+re*ee,K=$(1-.3*Math.min(H,1),1,Math.min(F+1,1));return $(.92,1,Math.asin(s.ay(M[2],-1,1))/Math.PI+.5)*K}(m,[0,0,1],o),x=[0,0,0];s.c1(x,u.slice(0,3),g);const b=[0,0,0];s.c1(b,o.slice(0,3),m[2]);const E=[0,0,0];return s.d5(E,x,b),s.d8(E)}const qv=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],pg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class mg{static cacheKey(o,u,g,x){let b=`${u}${x?x.cacheKey:""}`;for(const E of g)o.usedDefines.includes(E)&&(b+=`/${E}`);return b}constructor(o,u,g,x,b,E){const C=o.gl;this.program=C.createProgram(),this.configuration=x,this.name=u,this.fixedDefines=[...E];const M=x?x.getBinderAttributes():[],z=(g.staticAttributes||[]).concat(M);let F=x?x.defines():[];F=F.concat(E.map(re=>`#define ${re}`));const H=`#version 300 es
`;let $=H+F.concat("precision mediump float;",Vc,rg.fragmentSource).join(`
`);for(const re of g.fragmentIncludes)$+=`
${$u[re]}`;$+=`
${g.fragmentSource}`;let K=H+F.concat("precision highp float;",Vc,rg.vertexSource).join(`
`);for(const re of g.vertexIncludes)K+=`
${$u[re]}`;this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&g.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(K+=`
uniform int u_instanceID;
`),K+=`
${g.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(K=K.replaceAll("gl_InstanceID","u_instanceID"));const te=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(te,$),C.compileShader(te),C.attachShader(this.program,te);const ee=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(ee,K),C.compileShader(ee),C.attachShader(this.program,ee),this.attributes={},this.numAttributes=z.length;for(let re=0;re<this.numAttributes;re++)if(z[re]){const ie=z[re].startsWith("a_")?z[re]:`a_${z[re]}`;C.bindAttribLocation(this.program,re,ie),this.attributes[ie]=re}C.linkProgram(this.program),C.deleteShader(ee),C.deleteShader(te),this.fixedUniforms=b(o),this.binderUniforms=x?x.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(re=>({u_instanceID:new s.cd(re)}))(o)),(E.includes("TERRAIN")||u.indexOf("symbol")!==-1||u.indexOf("circle")!==-1)&&(this.terrainUniforms=(re=>({u_dem:new s.cd(re),u_dem_prev:new s.cd(re),u_dem_tl:new s.cg(re),u_dem_scale:new s.cf(re),u_dem_tl_prev:new s.cg(re),u_dem_scale_prev:new s.cf(re),u_dem_size:new s.cf(re),u_dem_lerp:new s.cf(re),u_exaggeration:new s.cf(re),u_depth:new s.cd(re),u_depth_size_inv:new s.cg(re),u_depth_range_unpack:new s.cg(re),u_occluder_half_size:new s.cf(re),u_occlusion_depth_offset:new s.cf(re),u_meter_to_dem:new s.cf(re),u_label_plane_matrix_inv:new s.ch(re)}))(o)),E.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new s.ce(re),u_tile_tr_up:new s.ce(re),u_tile_br_up:new s.ce(re),u_tile_bl_up:new s.ce(re),u_tile_up_scale:new s.cf(re)}))(o)),E.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new s.ch(re),u_fog_range:new s.cg(re),u_fog_color:new s.d0(re),u_fog_horizon_blend:new s.cf(re),u_fog_vertical_limit:new s.cg(re),u_fog_temporal_offset:new s.cf(re),u_frustum_tl:new s.ce(re),u_frustum_tr:new s.ce(re),u_frustum_br:new s.ce(re),u_frustum_bl:new s.ce(re),u_globe_pos:new s.ce(re),u_globe_radius:new s.cf(re),u_globe_transition:new s.cf(re),u_is_globe:new s.cd(re),u_viewport:new s.cg(re)}))(o)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(re=>({u_cutoff_params:new s.d0(re)}))(o)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(re=>({u_lighting_ambient_color:new s.ce(re),u_lighting_directional_dir:new s.ce(re),u_lighting_directional_color:new s.ce(re),u_ground_radiance:new s.ce(re)}))(o)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(re=>({u_light_matrix_0:new s.ch(re),u_light_matrix_1:new s.ch(re),u_fade_range:new s.cg(re),u_shadow_normal_offset:new s.ce(re),u_shadow_intensity:new s.cf(re),u_shadow_texel_size:new s.cf(re),u_shadow_map_resolution:new s.cf(re),u_shadow_direction:new s.ce(re),u_shadow_bias:new s.ce(re),u_shadowmap_0:new s.cd(re),u_shadowmap_1:new s.cd(re)}))(o))}}setTerrainUniformValues(o,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in u)g[x]&&g[x].set(this.program,x,u[x])}}setGlobeUniformValues(o,u){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in u)g[x]&&g[x].set(this.program,x,u[x])}}setFogUniformValues(o,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}setCutoffUniformValues(o,u){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}setLightsUniformValues(o,u){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}setShadowUniformValues(o,u){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;o.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}_drawDebugWireframe(o,u,g,x,b,E,C,M,z,F){const H=o.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;const $=o.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||o._terrain&&o._terrain.renderingToTexture||!qv.includes(this.name))||!(!H.layers3D||!pg.includes(this.name))))return;const K=$.gl,te=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,b,$);if(!te)return;const ee=[...this.fixedDefines];ee.push("DEBUG_WIREFRAME");const re=o.getOrCreateProgram(this.name,{config:this.configuration,defines:ee});$.program.set(re.program);const ie=(me,Te,we)=>{if(Te[me]&&we[me])for(const Ce in Te[me])we[me][Ce]&&we[me][Ce].set(we.program,Ce,Te[me][Ce].current)};z&&z.setUniforms(re.program,$,re.binderUniforms,C,{zoom:M}),ie("fixedUniforms",this,re),ie("terrainUniforms",this,re),ie("globeUniforms",this,re),ie("fogUniforms",this,re),ie("lightsUniforms",this,re),ie("shadowUniforms",this,re),te.bind(),$.setColorMode(new Or([K.ONE,K.ONE_MINUS_SRC_ALPHA,K.ZERO,K.ONE],s.am.transparent,[!0,!0,!0,!1])),$.setDepthMode(new Wt(u.func===K.LESS?K.LEQUAL:u.func,Wt.ReadOnly,u.range)),$.setStencilMode(mr.disabled);const ue=3*E.primitiveLength*2,pe=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const me=F||1;for(let Te=0;Te<me;++Te)re.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),K.drawElements(K.LINES,ue,K.UNSIGNED_SHORT,pe)}else F&&F>1?K.drawElementsInstanced(K.LINES,ue,K.UNSIGNED_SHORT,pe,F):K.drawElements(K.LINES,ue,K.UNSIGNED_SHORT,pe);b.bind(),$.program.set(this.program),$.setDepthMode(u),$.setStencilMode(g),$.setColorMode(x)}checkUniforms(o,u,g){if(this.fixedDefines.includes(u)){for(const x of Object.keys(g))if(!g[x].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${x} not set but required by ${u} being defined`)}}draw(o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re){const ie=o.context,ue=ie.gl;if(this.failedToCreate)return;ie.program.set(this.program),ie.setDepthMode(g),ie.setStencilMode(x),ie.setColorMode(b),ie.setCullFace(E);for(const Te of Object.keys(this.fixedUniforms))this.fixedUniforms[Te].set(this.program,Te,C[Te]);te&&te.setUniforms(this.program,ie,this.binderUniforms,$,{zoom:K});const pe={[ue.POINTS]:1,[ue.LINES]:2,[ue.TRIANGLES]:3,[ue.LINE_STRIP]:1}[u];this.checkUniforms(M,"RENDER_SHADOWS",this.shadowUniforms);const me=re&&re>0?1:void 0;for(const Te of H.get()){const we=Te.vaos||(Te.vaos={});if((we[M]||(we[M]=new CP)).bind(ie,this,z,te?te.getPaintVertexBuffers():[],F,Te.vertexOffset,ee||[],me),this.forceManualRenderingForInstanceIDShaders){const Ce=re||1;for(let be=0;be<Ce;++be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),F?ue.drawElements(u,Te.primitiveLength*pe,ue.UNSIGNED_SHORT,Te.primitiveOffset*pe*2):ue.drawArrays(u,Te.vertexOffset,Te.vertexLength)}else re&&re>1?ue.drawElementsInstanced(u,Te.primitiveLength*pe,ue.UNSIGNED_SHORT,Te.primitiveOffset*pe*2,re):F?ue.drawElements(u,Te.primitiveLength*pe,ue.UNSIGNED_SHORT,Te.primitiveOffset*pe*2):ue.drawArrays(u,Te.vertexOffset,Te.vertexLength);u===ue.TRIANGLES&&F&&this._drawDebugWireframe(o,g,x,b,F,Te,$,K,te,re)}}}function gg(m,o,u=0){const g=Math.pow(2,o.tileID.overscaledZ),x=o.tileSize*Math.pow(2,m.transform.tileZoom)/g,b=x*(o.tileID.canonical.x+o.tileID.wrap*g),E=x*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.aw(o,1,m.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E],u_pattern_transition:u}}const Wu={terrain:0,flat:1},Zv=s.bz(),Kv=(m,o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re,ie)=>{const ue=o.style.light,pe=ue.properties.get("position"),me=[pe.x,pe.y,pe.z],Te=s.dJ();ue.properties.get("anchor")==="viewport"&&(s.dK(Te,-o.transform.angle),s.dL(me,me,Te));const we=ue.properties.get("color").toPremultipliedRenderColor(null),Ce=o.transform,be={u_matrix:m,u_lightpos:me,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[we.r,we.g,we.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zv,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Wu[z],u_base_type:Wu[F],u_ao:x,u_edge_radius:b,u_width_scale:E,u_flood_light_color:te,u_vertical_scale:ee,u_flood_light_intensity:re,u_ground_shadow_factor:ie};return Ce.projection.name==="globe"&&(be.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],be.u_zoom_transition=H,be.u_inv_rot_matrix=K,be.u_merc_center=$,be.u_up_dir=Ce.projection.upVector(new s.cA(0,0,0),$[0]*s.aj,$[1]*s.aj),be.u_height_lift=M),be},N1=(m,o,u,g,x,b)=>({u_matrix:m,u_edge_radius:o,u_width_scale:u,u_vertical_scale:g,u_height_type:Wu[x],u_base_type:Wu[b]}),ld=(m,o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re,ie)=>{const ue=Kv(m,o,u,g,x,b,E,C,z,F,H,$,K,te,ee,re,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,C.overscaledZ)/M.tileSize/8};return s.h(ue,gg(o,M,ie),pe)},F1=(m,o,u)=>({u_matrix:m,u_emissive_strength:o,u_ground_shadow_factor:u}),B1=(m,o,u,g,x,b=0)=>s.h(F1(m,o,x),gg(u,g,b)),NP=(m,o,u,g)=>({u_matrix:m,u_world:u,u_emissive_strength:o,u_ground_shadow_factor:g}),FP=(m,o,u,g,x,b,E=0)=>s.h(B1(m,o,u,g,b,E),{u_world:x}),BP=(m,o)=>({u_matrix:m,u_ground_shadow_factor:o}),yg=(m,o,u,g,x)=>({u_matrix:m,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:u,u_height_scale:g,u_reset_depth:x}),Xv=(m,o)=>({u_matrix:m,u_normal_matrix:o,u_opacity:1}),Yv=m=>({u_matrix:m}),V1=m=>({u_matrix:m}),cd=(m,o,u,g,x,b,E,C)=>{const M=s.aj/b.tileSize;return{u_matrix:m,u_inv_rot_matrix:o,u_camera_to_center_distance:u.getCameraToCenterDistance(C),u_extrude_scale:[u.pixelsToGLUnits[0]/M,u.pixelsToGLUnits[1]/M],u_zoom_transition:g,u_tile_id:E,u_merc_center:x}},Jv=(m,o,u=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:u}),U1=s.bz(),$1=(m,o,u,g,x,b,E)=>{const C=m.transform,M=C.projection.name==="globe",z=M?s.dM(C.zoom,o.canonical)*C._pixelsPerMercatorPixel:s.aw(u,1,b),F={u_matrix:o.projMatrix,u_extrude_scale:z,u_intensity:E,u_inv_rot_matrix:U1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){F.u_inv_rot_matrix=g,F.u_merc_center=x,F.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],F.u_zoom_transition=s.ah(C.zoom);const H=x[0]*s.aj,$=x[1]*s.aj;F.u_up_dir=C.projection.upVector(new s.cA(0,0,0),H,$)}return F};function _g(m,[o,u,g,x],[b,E]){if(b===E)return[0,0,0,0];const C=255*(m-1)/(m*(E-b));return[o*C,u*C,g*C,x*C]}function Uc(m,o,[u,g]){return u===g?0:.5/m+(o-u)*(m-1)/(m*(g-u))}const Qv=(m,o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re,ie,ue,pe,me)=>({u_matrix:m,u_normalize_matrix:o,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:s.dO(H.paint.get("raster-saturation")),u_contrast_factor:s.dN(H.paint.get("raster-contrast")),u_spin_weights:$c(H.paint.get("raster-hue-rotate")),u_perspective_transform:$,u_raster_elevation:K,u_zoom_transition:E,u_merc_center:C,u_cutoff_params:M,u_colorization_mix:_g(s.dP,ee,ie),u_colorization_offset:Uc(s.dP,re,ie),u_color_ramp:te,u_texture_offset:[pe/(ue+2*pe),ue/(ue+2*pe)],u_texture_res:[ue+2*pe,ue+2*pe],u_emissive_strength:me});function $c(m){m*=Math.PI/180;const o=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const Gc=.05,vg=(m,o,u,g,x,b,E,C,M,z,F,H)=>({u_matrix:m,u_normalize_matrix:o,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:H,u_zoom_transition:E,u_merc_center:C,u_cutoff_params:M}),G1=(m,o,u,g,x,b,E,C,M,z)=>({u_particle_texture:m,u_particle_texture_side_len:o,u_tile_offset:u,u_velocity:g,u_color_ramp:b,u_velocity_res:x,u_max_speed:E,u_uv_offset:C,u_data_scale:[255*M[0],255*M[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Gc,Gc]}),H1=(m,o,u,g,x,b,E,C,M,z)=>({u_particle_texture:m,u_particle_texture_side_len:o,u_velocity:u,u_velocity_res:g,u_max_speed:x,u_speed_factor:b,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*M[0],255*M[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Gc,Gc]}),xg=s.bz(),bg=(m,o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re,ie,ue,pe,me,Te,we,Ce)=>{const be=x.transform,Se={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(ue),u_rotate_symbol:+u,u_aspect_ratio:be.width/be.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+z,u_elevation_from_sea:M?1:0,u_pitch_with_map:+g,u_texsize:F,u_texsize_icon:H,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xg,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xg,u_up_vector:[0,-1,0],u_color_adj_mat:Te,u_icon_transition:we||0,u_gamma_scale:g?x.transform.getCameraToCenterDistance(ue)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Ce||1,u_ground_shadow_factor:pe,u_inv_matrix:s.bi(s.bz(),E),u_normal_scale:me};return ue.name==="globe"&&(Se.u_tile_id=[K.canonical.x,K.canonical.y,1<<K.canonical.z],Se.u_zoom_transition=te,Se.u_inv_rot_matrix=re,Se.u_merc_center=ee,Se.u_camera_forward=be._camera.forward(),Se.u_ecef_origin=s.dQ(be.globeMatrix,K.toUnwrapped()),Se.u_tile_matrix=Float32Array.from(be.globeMatrix),Se.u_up_vector=ie),Se},W1=(m,o,u,g)=>({u_matrix:m,u_emissive_strength:o,u_opacity:u,u_color:g}),e0=(m,o,u,g,x,b,E,C,M)=>s.h(function(z,F,H,$,K,te){const{width:ee,height:re}=$.imageManager.getPixelSize(F),ie=Math.pow(2,te.tileID.overscaledZ),ue=te.tileSize*Math.pow(2,$.transform.tileZoom)/ie,pe=ue*(te.tileID.canonical.x+te.tileID.wrap*ie),me=ue*te.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[ee,re],u_pattern_size:H.displaySize,u_pattern_units_to_pixels:K?[$.transform.width,-1*$.transform.height]:[1/s.aw(te,1,$.transform.tileZoom),1/s.aw(te,1,$.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,me>>16],u_pixel_coord_lower:[65535&pe,65535&me]}}(0,b,E,g,C,M),{u_matrix:m,u_emissive_strength:o,u_opacity:u}),qu=new Float32Array(s.bx([])),t0=(m,o,u,g,x,b,E,C,M,z,F,H,$,K=[0,0,0],te)=>{const ee=x.style.light,re=ee.properties.get("position"),ie=[-re.x,-re.y,re.z],ue=s.dJ();ee.properties.get("anchor")==="viewport"&&(s.dK(ue,-x.transform.angle),s.dL(ie,ie,ue));const pe=F.alphaMode==="MASK",me=ee.properties.get("color").toNonPremultipliedRenderColor(null),Te=$.paint.get("model-ambient-occlusion-intensity"),we=$.paint.get("model-color").constantOr(s.am.white).toNonPremultipliedRenderColor(null);return we.a=$.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:m,u_lighting_matrix:o,u_normal_matrix:u,u_node_matrix:g||qu,u_lightpos:ie,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_camera_pos:K,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:C.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:M,u_roughnessFactor:z,u_baseColorTexture:co.BaseColor,u_metallicRoughnessTexture:co.MetallicRoughness,u_normalTexture:co.Normal,u_occlusionTexture:co.Occlusion,u_emissionTexture:co.Emission,u_lutTexture:co.LUT,u_color_mix:we.toArray01(),u_aoIntensity:Te,u_emissive_strength:H,u_occlusionTextureTransform:te||[0,0,0,0]}},q1=(m,o=qu,u=qu)=>({u_matrix:m,u_instance:o,u_node_matrix:u}),Z1={fillExtrusion:m=>({u_matrix:new s.ch(m),u_lightpos:new s.ce(m),u_lightintensity:new s.cf(m),u_lightcolor:new s.ce(m),u_vertical_gradient:new s.cf(m),u_opacity:new s.cf(m),u_edge_radius:new s.cf(m),u_width_scale:new s.cf(m),u_ao:new s.cg(m),u_height_type:new s.cd(m),u_base_type:new s.cd(m),u_tile_id:new s.ce(m),u_zoom_transition:new s.cf(m),u_inv_rot_matrix:new s.ch(m),u_merc_center:new s.cg(m),u_up_dir:new s.ce(m),u_height_lift:new s.cf(m),u_flood_light_color:new s.ce(m),u_vertical_scale:new s.cf(m),u_flood_light_intensity:new s.cf(m),u_ground_shadow_factor:new s.ce(m)}),fillExtrusionDepth:m=>({u_matrix:new s.ch(m),u_edge_radius:new s.cf(m),u_width_scale:new s.cf(m),u_vertical_scale:new s.cf(m),u_height_type:new s.cd(m),u_base_type:new s.cd(m)}),fillExtrusionPattern:m=>({u_matrix:new s.ch(m),u_lightpos:new s.ce(m),u_lightintensity:new s.cf(m),u_lightcolor:new s.ce(m),u_vertical_gradient:new s.cf(m),u_height_factor:new s.cf(m),u_edge_radius:new s.cf(m),u_width_scale:new s.cf(m),u_ao:new s.cg(m),u_height_type:new s.cd(m),u_base_type:new s.cd(m),u_tile_id:new s.ce(m),u_zoom_transition:new s.cf(m),u_inv_rot_matrix:new s.ch(m),u_merc_center:new s.cg(m),u_up_dir:new s.ce(m),u_height_lift:new s.cf(m),u_image:new s.cd(m),u_texsize:new s.cg(m),u_pixel_coord_upper:new s.cg(m),u_pixel_coord_lower:new s.cg(m),u_tile_units_to_pixels:new s.cf(m),u_opacity:new s.cf(m),u_pattern_transition:new s.cf(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new s.ch(m),u_opacity:new s.cf(m),u_ao_pass:new s.cf(m),u_meter_to_tile:new s.cf(m),u_ao:new s.cg(m),u_flood_light_intensity:new s.cf(m),u_flood_light_color:new s.ce(m),u_attenuation:new s.cf(m),u_edge_radius:new s.cf(m),u_fb:new s.cd(m),u_fb_size:new s.cf(m),u_dynamic_offset:new s.cf(m)}),fill:m=>({u_matrix:new s.ch(m),u_emissive_strength:new s.cf(m),u_ground_shadow_factor:new s.ce(m)}),fillPattern:m=>({u_matrix:new s.ch(m),u_emissive_strength:new s.cf(m),u_image:new s.cd(m),u_texsize:new s.cg(m),u_pixel_coord_upper:new s.cg(m),u_pixel_coord_lower:new s.cg(m),u_tile_units_to_pixels:new s.cf(m),u_ground_shadow_factor:new s.ce(m),u_pattern_transition:new s.cf(m)}),fillOutline:m=>({u_matrix:new s.ch(m),u_emissive_strength:new s.cf(m),u_world:new s.cg(m),u_ground_shadow_factor:new s.ce(m)}),fillOutlinePattern:m=>({u_matrix:new s.ch(m),u_emissive_strength:new s.cf(m),u_world:new s.cg(m),u_image:new s.cd(m),u_texsize:new s.cg(m),u_pixel_coord_upper:new s.cg(m),u_pixel_coord_lower:new s.cg(m),u_tile_units_to_pixels:new s.cf(m),u_ground_shadow_factor:new s.ce(m),u_pattern_transition:new s.cf(m)}),building:m=>({u_matrix:new s.ch(m),u_normal_matrix:new s.ch(m),u_opacity:new s.cf(m)}),buildingBloom:m=>({u_matrix:new s.ch(m)}),buildingDepth:m=>({u_matrix:new s.ch(m)}),elevatedStructuresDepth:m=>({u_matrix:new s.ch(m),u_depth_bias:new s.cf(m)}),elevatedStructures:m=>({u_matrix:new s.ch(m),u_ground_shadow_factor:new s.ce(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new s.ch(m),u_camera_pos:new s.ce(m),u_depth_bias:new s.cf(m),u_height_scale:new s.cf(m),u_reset_depth:new s.cf(m)}),circle:s.dT,collisionBox:m=>({u_matrix:new s.ch(m),u_inv_rot_matrix:new s.ch(m),u_camera_to_center_distance:new s.cf(m),u_extrude_scale:new s.cg(m),u_zoom_transition:new s.cf(m),u_merc_center:new s.cg(m),u_tile_id:new s.ce(m)}),collisionCircle:m=>({u_matrix:new s.ch(m),u_inv_matrix:new s.ch(m),u_camera_to_center_distance:new s.cf(m),u_viewport_size:new s.cg(m)}),debug:m=>({u_color:new s.dv(m),u_matrix:new s.ch(m),u_overlay:new s.cd(m),u_overlay_scale:new s.cf(m)}),clippingMask:m=>({u_matrix:new s.ch(m)}),heatmap:m=>({u_extrude_scale:new s.cf(m),u_intensity:new s.cf(m),u_matrix:new s.ch(m),u_inv_rot_matrix:new s.ch(m),u_merc_center:new s.cg(m),u_tile_id:new s.ce(m),u_zoom_transition:new s.cf(m),u_up_dir:new s.ce(m)}),heatmapTexture:m=>({u_image:new s.cd(m),u_color_ramp:new s.cd(m),u_opacity:new s.cf(m)}),hillshade:m=>({u_matrix:new s.ch(m),u_image:new s.cd(m),u_latrange:new s.cg(m),u_light:new s.cg(m),u_shadow:new s.dv(m),u_highlight:new s.dv(m),u_emissive_strength:new s.cf(m),u_accent:new s.dv(m)}),hillshadePrepare:m=>({u_matrix:new s.ch(m),u_image:new s.cd(m),u_dimension:new s.cg(m),u_zoom:new s.cf(m)}),line:s.dS,linePattern:s.dR,raster:m=>({u_matrix:new s.ch(m),u_normalize_matrix:new s.ch(m),u_globe_matrix:new s.ch(m),u_merc_matrix:new s.ch(m),u_grid_matrix:new s.dw(m),u_tl_parent:new s.cg(m),u_scale_parent:new s.cf(m),u_fade_t:new s.cf(m),u_opacity:new s.cf(m),u_image0:new s.cd(m),u_image1:new s.cd(m),u_brightness_low:new s.cf(m),u_brightness_high:new s.cf(m),u_saturation_factor:new s.cf(m),u_contrast_factor:new s.cf(m),u_spin_weights:new s.ce(m),u_perspective_transform:new s.cg(m),u_raster_elevation:new s.cf(m),u_zoom_transition:new s.cf(m),u_merc_center:new s.cg(m),u_cutoff_params:new s.d0(m),u_colorization_mix:new s.d0(m),u_colorization_offset:new s.cf(m),u_color_ramp:new s.cd(m),u_texture_offset:new s.cg(m),u_texture_res:new s.cg(m),u_emissive_strength:new s.cf(m)}),rasterParticle:m=>({u_matrix:new s.ch(m),u_normalize_matrix:new s.ch(m),u_globe_matrix:new s.ch(m),u_merc_matrix:new s.ch(m),u_grid_matrix:new s.dw(m),u_tl_parent:new s.cg(m),u_scale_parent:new s.cf(m),u_fade_t:new s.cf(m),u_opacity:new s.cf(m),u_image0:new s.cd(m),u_image1:new s.cd(m),u_raster_elevation:new s.cf(m),u_zoom_transition:new s.cf(m),u_merc_center:new s.cg(m),u_cutoff_params:new s.d0(m)}),rasterParticleTexture:m=>({u_texture:new s.cd(m),u_opacity:new s.cf(m)}),rasterParticleDraw:m=>({u_particle_texture:new s.cd(m),u_particle_texture_side_len:new s.cf(m),u_tile_offset:new s.cg(m),u_velocity:new s.cd(m),u_color_ramp:new s.cd(m),u_velocity_res:new s.cg(m),u_max_speed:new s.cf(m),u_uv_offset:new s.cg(m),u_data_scale:new s.cg(m),u_data_offset:new s.cf(m),u_particle_pos_scale:new s.cf(m),u_particle_pos_offset:new s.cg(m)}),rasterParticleUpdate:m=>({u_particle_texture:new s.cd(m),u_particle_texture_side_len:new s.cf(m),u_velocity:new s.cd(m),u_velocity_res:new s.cg(m),u_max_speed:new s.cf(m),u_speed_factor:new s.cf(m),u_reset_rate:new s.cf(m),u_rand_seed:new s.cf(m),u_uv_offset:new s.cg(m),u_data_scale:new s.cg(m),u_data_offset:new s.cf(m),u_particle_pos_scale:new s.cf(m),u_particle_pos_offset:new s.cg(m)}),symbol:m=>({u_is_size_zoom_constant:new s.cd(m),u_is_size_feature_constant:new s.cd(m),u_size_t:new s.cf(m),u_size:new s.cf(m),u_camera_to_center_distance:new s.cf(m),u_rotate_symbol:new s.cd(m),u_aspect_ratio:new s.cf(m),u_fade_change:new s.cf(m),u_matrix:new s.ch(m),u_label_plane_matrix:new s.ch(m),u_coord_matrix:new s.ch(m),u_is_text:new s.cd(m),u_elevation_from_sea:new s.cd(m),u_pitch_with_map:new s.cd(m),u_texsize:new s.cg(m),u_texsize_icon:new s.cg(m),u_texture:new s.cd(m),u_texture_icon:new s.cd(m),u_gamma_scale:new s.cf(m),u_device_pixel_ratio:new s.cf(m),u_tile_id:new s.ce(m),u_zoom_transition:new s.cf(m),u_inv_rot_matrix:new s.ch(m),u_merc_center:new s.cg(m),u_camera_forward:new s.ce(m),u_tile_matrix:new s.ch(m),u_up_vector:new s.ce(m),u_ecef_origin:new s.ce(m),u_is_halo:new s.cd(m),u_icon_transition:new s.cf(m),u_color_adj_mat:new s.ch(m),u_scale_factor:new s.cf(m),u_ground_shadow_factor:new s.ce(m),u_inv_matrix:new s.ch(m),u_normal_scale:new s.cf(m)}),background:m=>({u_matrix:new s.ch(m),u_emissive_strength:new s.cf(m),u_opacity:new s.cf(m),u_color:new s.dv(m)}),backgroundPattern:m=>({u_matrix:new s.ch(m),u_emissive_strength:new s.cf(m),u_opacity:new s.cf(m),u_image:new s.cd(m),u_pattern_tl:new s.cg(m),u_pattern_br:new s.cg(m),u_texsize:new s.cg(m),u_pattern_size:new s.cg(m),u_pixel_coord_upper:new s.cg(m),u_pixel_coord_lower:new s.cg(m),u_pattern_units_to_pixels:new s.cg(m)}),terrainRaster:m=>({u_matrix:new s.ch(m),u_image0:new s.cd(m),u_skirt_height:new s.cf(m),u_ground_shadow_factor:new s.ce(m)}),skybox:m=>({u_matrix:new s.ch(m),u_sun_direction:new s.ce(m),u_cubemap:new s.cd(m),u_opacity:new s.cf(m),u_temporal_offset:new s.cf(m)}),skyboxGradient:m=>({u_matrix:new s.ch(m),u_color_ramp:new s.cd(m),u_center_direction:new s.ce(m),u_radius:new s.cf(m),u_opacity:new s.cf(m),u_temporal_offset:new s.cf(m)}),skyboxCapture:m=>({u_matrix_3f:new s.dw(m),u_sun_direction:new s.ce(m),u_sun_intensity:new s.cf(m),u_color_tint_r:new s.d0(m),u_color_tint_m:new s.d0(m),u_luminance:new s.cf(m)}),globeRaster:m=>({u_proj_matrix:new s.ch(m),u_globe_matrix:new s.ch(m),u_normalize_matrix:new s.ch(m),u_merc_matrix:new s.ch(m),u_zoom_transition:new s.cf(m),u_merc_center:new s.cg(m),u_image0:new s.cd(m),u_grid_matrix:new s.dw(m),u_skirt_height:new s.cf(m),u_far_z_cutoff:new s.cf(m),u_frustum_tl:new s.ce(m),u_frustum_tr:new s.ce(m),u_frustum_br:new s.ce(m),u_frustum_bl:new s.ce(m),u_globe_pos:new s.ce(m),u_globe_radius:new s.cf(m),u_viewport:new s.cg(m)}),globeAtmosphere:m=>({u_frustum_tl:new s.ce(m),u_frustum_tr:new s.ce(m),u_frustum_br:new s.ce(m),u_frustum_bl:new s.ce(m),u_horizon:new s.cf(m),u_transition:new s.cf(m),u_fadeout_range:new s.cf(m),u_color:new s.d0(m),u_high_color:new s.d0(m),u_space_color:new s.d0(m),u_temporal_offset:new s.cf(m),u_horizon_angle:new s.cf(m)}),model:m=>({u_matrix:new s.ch(m),u_lighting_matrix:new s.ch(m),u_normal_matrix:new s.ch(m),u_node_matrix:new s.ch(m),u_lightpos:new s.ce(m),u_lightintensity:new s.cf(m),u_lightcolor:new s.ce(m),u_camera_pos:new s.ce(m),u_opacity:new s.cf(m),u_baseColorFactor:new s.d0(m),u_emissiveFactor:new s.d0(m),u_metallicFactor:new s.cf(m),u_roughnessFactor:new s.cf(m),u_baseTextureIsAlpha:new s.cd(m),u_alphaMask:new s.cd(m),u_alphaCutoff:new s.cf(m),u_baseColorTexture:new s.cd(m),u_metallicRoughnessTexture:new s.cd(m),u_normalTexture:new s.cd(m),u_occlusionTexture:new s.cd(m),u_emissionTexture:new s.cd(m),u_lutTexture:new s.cd(m),u_color_mix:new s.d0(m),u_aoIntensity:new s.cf(m),u_emissive_strength:new s.cf(m),u_occlusionTextureTransform:new s.d0(m)}),modelDepth:m=>({u_matrix:new s.ch(m),u_instance:new s.ch(m),u_node_matrix:new s.ch(m)}),groundShadow:m=>({u_matrix:new s.ch(m),u_ground_shadow_factor:new s.ce(m)}),stars:m=>({u_matrix:new s.ch(m),u_up:new s.ce(m),u_right:new s.ce(m),u_intensity_multiplier:new s.cf(m)}),snowParticle:m=>({u_modelview:new s.ch(m),u_projection:new s.ch(m),u_time:new s.cf(m),u_cam_pos:new s.ce(m),u_velocityConeAperture:new s.cf(m),u_velocity:new s.cf(m),u_horizontalOscillationRadius:new s.cf(m),u_horizontalOscillationRate:new s.cf(m),u_boxSize:new s.cf(m),u_billboardSize:new s.cf(m),u_simpleShapeParameters:new s.cg(m),u_screenSize:new s.cg(m),u_thinningCenterPos:new s.cg(m),u_thinningShape:new s.ce(m),u_thinningAffectedRatio:new s.cf(m),u_thinningParticleOffset:new s.cf(m),u_particleColor:new s.d0(m),u_direction:new s.ce(m)}),rainParticle:m=>({u_modelview:new s.ch(m),u_projection:new s.ch(m),u_time:new s.cf(m),u_cam_pos:new s.ce(m),u_texScreen:new s.cd(m),u_velocityConeAperture:new s.cf(m),u_velocity:new s.cf(m),u_boxSize:new s.cf(m),u_rainDropletSize:new s.cg(m),u_distortionStrength:new s.cf(m),u_rainDirection:new s.ce(m),u_color:new s.d0(m),u_screenSize:new s.cg(m),u_thinningCenterPos:new s.cg(m),u_thinningShape:new s.ce(m),u_thinningAffectedRatio:new s.cf(m),u_thinningParticleOffset:new s.cf(m),u_shapeDirectionalPower:new s.cf(m),u_shapeNormalPower:new s.cf(m),u_mode:new s.cf(m)}),vignette:m=>({u_vignetteShape:new s.ce(m),u_vignetteColor:new s.d0(m)}),occlusion:m=>({u_matrix:new s.ch(m),u_anchorPos:new s.ce(m),u_screenSizePx:new s.cg(m),u_occluderSizePx:new s.cg(m),u_color:new s.d0(m)})};class Hc{constructor(o,u,g,x){this.id=Hc.uniqueIdxCounter,Hc.uniqueIdxCounter++,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||x||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=Hc.uniqueIdxCounter,Hc.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Hc.uniqueIdxCounter=0;const r0={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class n0{constructor(o,u,g,x,b,E){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=x,this.instanceCount=E,this.context=o;const C=o.gl;this.buffer=C.createBuffer(),o.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||b||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let g=0;g<this.attributes.length;g++){const x=u.attributes[this.attributes[g].name];x!==void 0&&o.enableVertexAttribArray(x)}}setVertexAttribPointers(o,u,g){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],E=u.attributes[b.name];E!==void 0&&o.vertexAttribPointer(E,b.components,o[r0[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(o,u,g){for(let x=0;x<this.attributes.length;x++){const b=u.attributes[this.attributes[x].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(b,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Zu{constructor(o,u,g,x,b){this.context=o,this.width=u,this.height=g;const E=this.framebuffer=o.gl.createFramebuffer();x&&(this.colorAttachment=new zP(o,E)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new L1(o,E):new Vv(o,E))}destroy(){const o=this.context.gl;if(this.colorAttachment){const u=this.colorAttachment.get();u&&o.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&o.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&o.deleteTexture(u)}o.deleteFramebuffer(this.framebuffer)}}class wg{constructor(o,u){this.gl=o,this.clearColor=new MP(this),this.clearDepth=new OP(this),this.clearStencil=new jP(this),this.colorMask=new RP(this),this.depthMask=new P1(this),this.stencilMask=new DP(this),this.stencilFunc=new ng(this),this.stencilOp=new LP(this),this.stencilTest=new C1(this),this.depthRange=new Lv(this),this.depthTest=new ig(this),this.depthFunc=new zv(this),this.blend=new Gu(this),this.blendFunc=new nd(this),this.blendColor=new sg(this),this.blendEquation=new og(this),this.cullFace=new id(this),this.cullFaceSide=new I1(this),this.frontFace=new Nv(this),this.program=new M1(this),this.activeTexture=new sd(this),this.viewport=new ag(this),this.bindFramebuffer=new lg(this),this.bindRenderbuffer=new Fv(this),this.bindTexture=new cg(this),this.bindVertexBuffer=new tp(this),this.bindElementBuffer=new O1(this),this.bindVertexArrayOES=new j1(this),this.pixelStoreUnpack=new R1(this),this.pixelStoreUnpackPremultiplyAlpha=new od(this),this.pixelStoreUnpackFlipY=new D1(this),this.options=u?Object.assign({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=u&&!!u.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u,g){return new Hc(this,o,u,g)}createVertexBuffer(o,u,g,x,b){return new n0(this,o,u,g,x,b)}createRenderbuffer(o,u,g){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,o,u,g),this.bindRenderbuffer.set(null),b}createFramebuffer(o,u,g,x){return new Zu(this,o,u,g,x)}clear({color:o,depth:u,stencil:g,colorMask:x}){const b=this.gl;let E=0;o&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),u!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),g!==void 0&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),b.clear(E)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){s.bv(o.blendFunction,Or.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Wc;function i0(m,o,u,g,x,b,E){const C=m.context,M=C.gl,z=m.transform,F=[s.aD(z.center.lng),s.aH(z.center.lat)],H=u.layout.get("symbol-placement"),$=u.layout.get("text-variable-anchor"),K=u.layout.get("icon-rotation-alignment")==="map",te=u.layout.get("text-rotation-alignment")==="map",ee=H!=="point",re=[];let ie=0,ue=0;for(let Se=0;Se<g.length;Se++){const Ee=g[Se],Ue=o.getTile(Ee),De=Ue.getBucket(u);if(!De)continue;const dt=De.getProjection().createInversionMatrix(z,Ee.canonical),Je=[],pt=m1(Ee,De,z),Pt=!E&&K&&ee,qe=E&&te&&ee,Re=$&&De.hasTextData(),nt=De.hasIconTextFit()&&Re&&De.hasIconData(),Ze=Pt||qe||E&&Re||nt,yt=De.projection.name==="globe",bt=yt?s.ah(z.zoom):0;yt&&(Je.push("PROJECTION_GLOBE_VIEW"),Ze&&Je.push("PROJECTED_POS_ON_VIEWPORT"));const Et=m.getOrCreateProgram("collisionBox",{defines:Je});let jt=pt;x[0]===0&&x[1]===0||(jt=m.translatePosMatrix(pt,Ue,x,b));const tr=E?De.textCollisionBox:De.iconCollisionBox,ir=De.collisionCircleArray;if(ir.length>0){const er=s.bz(),nr=jt;s.cM(er,De.placementInvProjMatrix,z.glCoordMatrix),s.cM(er,er,De.placementViewportMatrix),re.push({circleArray:ir,circleOffset:ue,transform:nr,invTransform:er,projection:De.getProjection()}),ie+=ir.length/4,ue=ie}if(!tr)continue;m.terrain&&m.terrain.setupElevationDraw(Ue,Et);const Zt=yt?[Ee.canonical.x,Ee.canonical.y,1<<Ee.canonical.z]:[0,0,0];Et.draw(m,M.LINES,Wt.disabled,mr.disabled,m.colorModeForRenderPass(),ur.disabled,cd(jt,dt,z,bt,F,Ue,Zt,De.getProjection()),u.id,tr.layoutVertexBuffer,tr.indexBuffer,tr.segments,null,z.zoom,null,[tr.collisionVertexBuffer,tr.collisionVertexBufferExt])}if(!E||!re.length)return;const pe=m.getOrCreateProgram("collisionCircle"),me=new s.dU;me.resize(4*ie),me._trim();let Te=0;for(const Se of re)for(let Ee=0;Ee<Se.circleArray.length/4;Ee++){const Ue=4*Ee,De=Se.circleArray[Ue+0],dt=Se.circleArray[Ue+1],Je=Se.circleArray[Ue+2],pt=Se.circleArray[Ue+3];me.emplace(Te++,De,dt,Je,pt,0),me.emplace(Te++,De,dt,Je,pt,1),me.emplace(Te++,De,dt,Je,pt,2),me.emplace(Te++,De,dt,Je,pt,3)}(!Wc||Wc.length<2*ie)&&(Wc=function(Se){const Ee=2*Se,Ue=new s.a_;Ue.resize(Ee),Ue._trim();for(let De=0;De<Ee;De++){const dt=6*De;Ue.uint16[dt+0]=4*De+0,Ue.uint16[dt+1]=4*De+1,Ue.uint16[dt+2]=4*De+2,Ue.uint16[dt+3]=4*De+2,Ue.uint16[dt+4]=4*De+3,Ue.uint16[dt+5]=4*De+0}return Ue}(ie));const we=C.createIndexBuffer(Wc,!0),Ce=C.createVertexBuffer(me,s.dV.members,!0);for(const Se of re){const Ee={u_matrix:Se.transform,u_inv_matrix:Se.invTransform,u_camera_to_center_distance:(be=z).getCameraToCenterDistance(Se.projection),u_viewport_size:[be.width,be.height]};pe.draw(m,M.TRIANGLES,Wt.disabled,mr.disabled,m.colorModeForRenderPass(),ur.disabled,Ee,u.id,Ce,we,s.bd.simpleSegment(0,2*Se.circleOffset,Se.circleArray.length,Se.circleArray.length/2),null,z.zoom)}var be;Ce.destroy(),we.destroy()}const Ku=s.bz();function ip(m){const o=m._camera.getWorldToCamera(m.worldSize,1),u=s.az([],o,m.globeMatrix);s.bi(u,u);const g=[0,0,0],x=[0,1,0,0];return s.aA(x,x,u),g[0]=x[0],g[1]=x[1],g[2]=x[2],s.au(g,g),g}function s0({width:m,height:o,anchor:u,textOffset:g,textScale:x},b){const{horizontalAlign:E,verticalAlign:C}=s.bZ(u),M=-(E-.5)*m,z=-(C-.5)*o,F=s.b_(u,g);return new s.P((M/x+F[0])*b,(z/x+F[1])*b)}function K1(m,o,u,g,x,b,E,C,M,z){const F=m.text.placedSymbolArray,H=m.text.dynamicLayoutVertexArray,$=m.icon.dynamicLayoutVertexArray,K={},te=m.getProjection(),ee=Hm(E,te,x),re=x.elevation,ie=te.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;H.clear();for(let ue=0;ue<F.length;ue++){const pe=F.get(ue),{tileAnchorX:me,tileAnchorY:Te,numGlyphs:we}=pe,Ce=pe.hidden||!pe.crossTileID||m.allowVerticalPlacement&&!pe.placedOrientation?null:g[pe.crossTileID];if(Ce){let be=0,Se=0,Ee=0;if(re){const nt=re?re.getAtTileOffset(E,me,Te):0,[Ze,yt,bt]=te.upVector(E.canonical,me,Te);be=nt*Ze*ie,Se=nt*yt*ie,Ee=nt*bt*ie}let[Ue,De,dt,Je]=na(pe.projectedAnchorX+be,pe.projectedAnchorY+Se,pe.projectedAnchorZ+Ee,u?ee:b);const pt=Sv(x.getCameraToCenterDistance(te),Je);let Pt=s.bJ(m.textSizeData,M,pe)*pt/s.bU;u&&(Pt*=m.tilePixelRatio/C);const qe=s0(Ce,Pt);u?({x:Ue,y:De,z:dt}=te.projectTilePoint(me+qe.x,Te+qe.y,E.canonical),[Ue,De,dt]=na(Ue+be,De+Se,dt+Ee,b)):(o&&qe._rotate(-x.angle),Ue+=qe.x,De+=qe.y,dt=0);const Re=m.allowVerticalPlacement&&pe.placedOrientation===s.bI.vertical?Math.PI/2:0;for(let nt=0;nt<we;nt++)s.bL(H,Ue,De,dt,Re);z&&pe.associatedIconIndex>=0&&(K[pe.associatedIconIndex]={x:Ue,y:De,z:dt,angle:Re})}else Zh(we,H)}if(z){$.clear();const ue=m.icon.placedSymbolArray;for(let pe=0;pe<ue.length;pe++){const me=ue.get(pe),{numGlyphs:Te}=me,we=K[pe];if(me.hidden||!we)Zh(Te,$);else{const{x:Ce,y:be,z:Se,angle:Ee}=we;for(let Ue=0;Ue<Te;Ue++)s.bL($,Ce,be,Se,Ee)}}m.icon.dynamicLayoutVertexBuffer.updateData($)}m.text.dynamicLayoutVertexBuffer.updateData(H)}function o0(m,o,u,g,x,b,E={}){const C=u.paint.get("icon-translate"),M=u.paint.get("text-translate"),z=u.paint.get("icon-translate-anchor"),F=u.paint.get("text-translate-anchor"),H=u.layout.get("icon-rotation-alignment"),$=u.layout.get("text-rotation-alignment"),K=u.layout.get("icon-pitch-alignment"),te=u.layout.get("text-pitch-alignment"),ee=u.layout.get("icon-keep-upright"),re=u.layout.get("text-keep-upright"),ie=u.paint.get("icon-color-saturation"),ue=u.paint.get("icon-color-contrast"),pe=u.paint.get("icon-color-brightness-min"),me=u.paint.get("icon-color-brightness-max"),Te=u.layout.get("symbol-elevation-reference")==="sea",we=m.context,Ce=we.gl,be=m.transform,Se=H==="map",Ee=$==="map",Ue=K==="map",De=te==="map",dt=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Je=!1;const pt=m.depthModeForSublayer(0,Wt.ReadOnly),Pt=new Wt(m.context.gl.LEQUAL,Wt.ReadOnly,m.depthRangeFor3D),qe=[s.aD(be.center.lng),s.aH(be.center.lat)],Re=u.layout.get("text-variable-anchor"),nt=be.projection.name==="globe",Ze=[],yt=[0,-1,0];for(const bt of g){const Et=o.getTile(bt),jt=Et.getBucket(u);if(!jt||jt.projection.name==="mercator"&&nt||jt.fullyClipped)continue;const tr=jt.projection.name==="globe",ir=tr?s.ah(be.zoom):0,Zt=Hm(bt,jt.getProjection(),be),er=be.calculatePixelsToTileUnitsMatrix(Et),nr=Re&&jt.hasTextData(),wr=jt.hasIconTextFit()&&nr&&jt.hasIconData(),Pr=jt.getProjection().createInversionMatrix(be,bt.canonical),Nr=(1<<Et.tileID.canonical.z)*s.aj/m.transform.worldSize,Pn=kr=>{let mn=[0,0,0];if(kr){const mi=m.style.directionalLight,rn=m.style.ambientLight;mi&&rn&&(mn=Uu(m.style,mi,rn))}return mn},vr=kr=>{be.depthOcclusionForSymbolsAndCircles&&(u.hasInitialOcclusionOpacityProperties||m.terrain)&&(kr.push("DEPTH_D24"),kr.push("DEPTH_OCCLUSION"))},un=()=>{const kr=Se&&u.layout.get("symbol-placement")!=="point",mn=[];vr(mn);const mi=kr||wr,rn=jt.elevationType==="road",xn=m.shadowRenderer,Ln=rn&&Ue&&!!xn&&xn.enabled,Ei=Pn(Ln),Oi=rn&&Ue&&!m.terrain?Pt:pt,ji=u.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&Ue&&mn.push("PITCH_WITH_MAP_TERRAIN"),tr&&(mn.push("PROJECTION_GLOBE_VIEW"),mi&&mn.push("PROJECTED_POS_ON_VIEWPORT")),ji>0&&jt.hasAnySecondaryIcon&&mn.push("ICON_TRANSITION"),!jt.icon.zOffsetVertexBuffer||rn&&m.terrain||mn.push("Z_OFFSET"),ie===0&&ue===0&&pe===0&&me===1||mn.push("COLOR_ADJUSTMENT"),jt.sdfIcons&&mn.push("RENDER_SDF"),Ln&&mn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),rn&&Ue&&!m.terrain&&jt.icon.orientationVertexBuffer&&mn.push("ELEVATED_ROADS");const Rs=jt.icon.programConfigurations.get(u.id),ca=m.getOrCreateProgram("symbol",{config:Rs,defines:mn}),$o=Et.imageAtlasTexture?Et.imageAtlasTexture.size:[0,0],fo=jt.iconSizeData,po=s.bH(fo,be.zoom),Go=Ue||!be.isOrthographic,ja=Uf(Zt,Et.tileID.canonical,Ue,Se,be,jt.getProjection(),er),Ra=ql(Zt,Et.tileID.canonical,Ue,Se,be,jt.getProjection(),er),si=m.translatePosMatrix(Ra,Et,C,z,!0),Ri=m.translatePosMatrix(Zt,Et,C,z),Un=mi?Ku:ja,Di=Se&&!Ue&&!kr;let Ks=yt;!nt&&!be.mercatorFromTransition||Se||(Ks=ip(be));const _i=tr?Ks:yt,Mo=u.getColorAdjustmentMatrix(ie,ue,pe,me),Qu=bg(fo.kind,po,Di,Ue,m,Ri,Un,si,Te,!1,$o,[0,0],0,bt,ir,qe,Pr,_i,jt.getProjection(),Ei,Nr,Mo,ji,null),Qc=Et.imageAtlasTexture?Et.imageAtlasTexture:null,Td=u.layout.get("icon-size").constantOr(0)!==1||jt.iconsNeedLinear,Ed=jt.sdfIcons||m.options.rotating||m.options.zooming||Td||Go?Ce.LINEAR:Ce.NEAREST,eu=jt.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,Oo=m.terrain&&Ue&&kr?s.bi(s.bz(),ja):Ku;if(kr&&jt.icon){const tu=be.elevation,$i=tu?tu.getAtTileOffsetFunc(bt,be.center.lat,be.worldSize,jt.getProjection()):null,Da=qh(Zt,Et.tileID.canonical,Ue,Se,be,jt.getProjection(),er);Fu(jt,Zt,m,!1,Da,Ra,Ue,ee,$i,bt)}return{program:ca,buffers:jt.icon,uniformValues:Qu,atlasTexture:Qc,atlasTextureIcon:null,atlasInterpolation:Ed,atlasInterpolationIcon:null,isSDF:jt.sdfIcons,hasHalo:eu,depthMode:Oi,tile:Et,renderWithShadows:Ln,labelPlaneMatrixInv:Oo}},hn=()=>{const kr=Ee&&u.layout.get("symbol-placement")!=="point",mn=[],mi=kr||Re||wr,rn=jt.elevationType==="road",xn=m.shadowRenderer,Ln=rn&&De&&!!xn&&xn.enabled,Ei=Pn(Ln),Oi=rn&&De&&!m.terrain?Pt:pt;m.terrainRenderModeElevated()&&De&&mn.push("PITCH_WITH_MAP_TERRAIN"),tr&&(mn.push("PROJECTION_GLOBE_VIEW"),mi&&mn.push("PROJECTED_POS_ON_VIEWPORT")),!jt.text.zOffsetVertexBuffer||rn&&m.terrain||mn.push("Z_OFFSET"),jt.iconsInText&&mn.push("RENDER_TEXT_AND_SYMBOL"),mn.push("RENDER_SDF"),Ln&&mn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),rn&&De&&!m.terrain&&jt.text.orientationVertexBuffer&&mn.push("ELEVATED_ROADS"),vr(mn);const ji=jt.text.programConfigurations.get(u.id),Rs=m.getOrCreateProgram("symbol",{config:ji,defines:mn});let ca,$o=[0,0],fo=null;const po=jt.textSizeData;jt.iconsInText&&($o=Et.imageAtlasTexture?Et.imageAtlasTexture.size:[0,0],fo=Et.imageAtlasTexture?Et.imageAtlasTexture:null,ca=De||!be.isOrthographic||m.options.rotating||m.options.zooming||po.kind==="composite"||po.kind==="camera"?Ce.LINEAR:Ce.NEAREST);const Go=Et.glyphAtlasTexture?Et.glyphAtlasTexture.size:[0,0],ja=u.layout.get("text-size-scale-range"),Ra=s.ay(m.scaleFactor,ja[0],ja[1]),si=s.bH(po,be.zoom,Ra),Ri=Uf(Zt,Et.tileID.canonical,De,Ee,be,jt.getProjection(),er),Un=ql(Zt,Et.tileID.canonical,De,Ee,be,jt.getProjection(),er),Di=m.translatePosMatrix(Un,Et,M,F,!0),Ks=m.translatePosMatrix(Zt,Et,M,F),_i=mi?Ku:Ri,Mo=Ee&&!De&&!kr;let Qu=yt;!nt&&!be.mercatorFromTransition||Ee||(Qu=ip(be));const Qc=bg(po.kind,si,Mo,De,m,Ks,_i,Di,Te,!0,Go,$o,0,bt,ir,qe,Pr,tr?Qu:yt,jt.getProjection(),Ei,Nr,null,null,Ra),Td=Et.glyphAtlasTexture?Et.glyphAtlasTexture:null,Ed=Ce.LINEAR,eu=u.paint.get("text-halo-width").constantOr(1)!==0,Oo=m.terrain&&De&&kr?s.bi(s.bz(),Ri):Ku;if(kr&&jt.text){const tu=be.elevation,$i=tu?tu.getAtTileOffsetFunc(bt,be.center.lat,be.worldSize,jt.getProjection()):null,Da=qh(Zt,Et.tileID.canonical,De,Ee,be,jt.getProjection(),er);Fu(jt,Zt,m,!0,Da,Un,De,re,$i,bt)}return{program:Rs,buffers:jt.text,uniformValues:Qc,atlasTexture:Td,atlasTextureIcon:fo,atlasInterpolation:Ed,atlasInterpolationIcon:ca,isSDF:!0,hasHalo:eu,depthMode:Oi,tile:Et,renderWithShadows:Ln,labelPlaneMatrixInv:Oo}},Zn=jt.icon.segments.get().length,Ir=jt.text.segments.get().length,on=Zn&&!E.onlyText?un():null,cn=Ir&&!E.onlyIcons?hn():null,vn=u.paint.get("icon-opacity").constantOr(1),hi=u.paint.get("text-opacity").constantOr(1);if(dt&&jt.canOverlap){Je=!0;const kr=vn&&!E.onlyText?jt.icon.segments.get():[],mn=hi&&!E.onlyIcons?jt.text.segments.get():[];for(const mi of kr)Ze.push({segments:new s.bd([mi]),sortKey:mi.sortKey,state:on});for(const mi of mn)Ze.push({segments:new s.bd([mi]),sortKey:mi.sortKey,state:cn})}else E.onlyText||Ze.push({segments:vn?jt.icon.segments:new s.bd([]),sortKey:0,state:on}),E.onlyIcons||Ze.push({segments:hi?jt.text.segments:new s.bd([]),sortKey:0,state:cn})}Je&&Ze.sort((bt,Et)=>bt.sortKey-Et.sortKey);for(const bt of Ze){const Et=bt.state;if(Et)if(m.terrain?m.terrain.setupElevationDraw(Et.tile,Et.program,{useDepthForOcclusion:be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Et.labelPlaneMatrixInv}):m.setupDepthForOcclusion(be.depthOcclusionForSymbolsAndCircles,Et.program),we.activeTexture.set(Ce.TEXTURE0),Et.atlasTexture&&Et.atlasTexture.bind(Et.atlasInterpolation,Ce.CLAMP_TO_EDGE,!0),Et.atlasTextureIcon&&(we.activeTexture.set(Ce.TEXTURE1),Et.atlasTextureIcon&&Et.atlasTextureIcon.bind(Et.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE,!0)),Et.renderWithShadows&&m.shadowRenderer.setupShadows(Et.tile.tileID.toUnwrapped(),Et.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,Et.program),Et.hasHalo){const jt=Et.uniformValues;jt.u_is_halo=1,qc(Et.buffers,bt.segments,u,m,Et.program,Et.depthMode,x,b,jt,2),jt.u_is_halo=0}else{if(Et.isSDF){const jt=Et.uniformValues;Et.hasHalo&&(jt.u_is_halo=1,qc(Et.buffers,bt.segments,u,m,Et.program,Et.depthMode,x,b,jt,1)),jt.u_is_halo=0}qc(Et.buffers,bt.segments,u,m,Et.program,Et.depthMode,x,b,Et.uniformValues,1)}}}function qc(m,o,u,g,x,b,E,C,M,z){const F=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];x.draw(g,g.context.gl.TRIANGLES,b,E,C,ur.disabled,M,u.id,m.layoutVertexBuffer,m.indexBuffer,o,u.paint,g.transform.zoom,m.programConfigurations.get(u.id),F,z)}function sp(m,o){const u=1<<m.canonical.z,g=(o.x*u-m.canonical.x-m.wrap*u)*s.aj,x=(o.y*u-m.canonical.y)*s.aj,b=s.e2(o.z,o.y);return s.d2(g,x,b)}function qt(m,o,u,g,x){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const b=m.context.gl,E=new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),C=new Wt(m.context.gl.GREATER,Wt.ReadWrite,m.depthRangeFor3D),M=function(K){const te=s.cU(K.pitch);let ee=.01;return K.isOrthographic&&(ee=s.ai(1e-4,ee,s.cZ(te>=ws?1:te/ws))),2*ee}(m.transform),z=m.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",H=m.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),$=m.getOrCreateProgram(F);for(const K of g){const te=o.getTile(K),ee=te.getBucket(u);if(!ee)continue;const re=ee.elevatedStructures;if(!re)continue;const ie=ee.elevationBufferData.heightRange,ue=sp(K.toUnwrapped(),z),pe=m.translatePosMatrix(K.projMatrix,te,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));let me,Te,we,Ce;if(x==="initialize"){if(!ie||ie.min>=1||re.depthSegments.segments[0].primitiveLength===0)continue;me=yg(pe,ue,M,1,0),Te=E,we=re.depthSegments,Ce=H}else if(x==="reset"){if(!ie||ie.min>=0||re.maskSegments.segments[0].primitiveLength===0)continue;me=yg(pe,ue,0,0,1),Te=C,we=re.maskSegments,Ce=H}else if(x==="geometry"){if(re.depthSegments.segments[0].primitiveLength===0)continue;me=yg(pe,ue,M,1,0),Te=E,we=re.depthSegments,Ce=$}Ce.draw(m,b.TRIANGLES,Te,mr.disabled,Or.disabled,ur.disabled,me,u.id,re.vertexBuffer,re.indexBuffer,we,u.paint,m.transform.zoom)}}function Sg(m,o,u){const{painter:g,sourceCache:x,layer:b,coords:E,colorMode:C,elevationType:M,terrainEnabled:z,pass:F}=m,H=g.context.gl,$=b.paint.get("fill-pattern"),K=b.paint.get("fill-pattern-cross-fade"),te=$.constantOr(null);let ee=M;M!=="road"||o&&!z||(ee="none");const re=ee==="road",ie=m.painter.shadowRenderer,ue=re&&!!ie&&ie.enabled,pe=new Wt(g.context.gl.LEQUAL,Wt.ReadOnly,g.depthRangeFor3D);let me=[0,0,0];if(ue){const Ce=g.style.directionalLight,be=g.style.ambientLight;Ce&&be&&(me=Uu(g.style,Ce,be))}const Te=$&&$.constantOr(1),we=(Ce,be)=>{let Se,Ee,Ue,De,dt;be?(Se=Te&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ue=H.LINES):(Se=Te?"fillPattern":"fill",Ue=H.TRIANGLES);for(const Je of E){const pt=x.getTile(Je);if(Te&&!pt.patternsLoaded())continue;const Pt=pt.getBucket(b);if(!Pt)continue;const qe=o?Pt.elevationBufferData:Pt.bufferData;if(qe.isEmpty())continue;g.prepareDrawTile();const Re=qe.programConfigurations.get(b.id),nt=g.isTileAffectedByFog(Je),Ze=[],yt=[];re&&(Ze.push("ELEVATED_ROADS"),yt.push(qe.elevatedLayoutVertexBuffer)),ue&&Ze.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Te&&(g.context.activeTexture.set(H.TEXTURE0),pt.imageAtlasTexture&&pt.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Re.updatePaintBuffers());let bt=!1;if(te&&pt.imageAtlas){const Zt=pt.imageAtlas,er=s.dZ.from(te),nr=er.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),wr=er.getSecondary(),Pr=Zt.patternPositions.get(nr),Nr=wr?Zt.patternPositions.get(wr.scaleSelf(s.q.devicePixelRatio).toString()):null;bt=!!Pr&&!!Nr,Pr&&Re.setConstantPatternPositions(Pr,Nr)}K>0&&(bt||Re.getPatternTransitionVertexBuffer("fill-pattern"))&&Ze.push("FILL_PATTERN_TRANSITION");const Et=g.getOrCreateProgram(Se,{config:Re,overrideFog:nt,defines:Ze}),jt=g.translatePosMatrix(Je.projMatrix,pt,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));ue&&ie.setupShadows(pt.tileID.toUnwrapped(),Et,"vector-tile");const tr=b.paint.get("fill-emissive-strength");if(be){De=qe.lineIndexBuffer,dt=qe.lineSegments;const Zt=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[H.drawingBufferWidth,H.drawingBufferHeight];Ee=Se==="fillOutlinePattern"&&Te?FP(jt,tr,g,pt,Zt,me,K):NP(jt,tr,Zt,me)}else De=qe.indexBuffer,dt=qe.triangleSegments,Ee=Te?B1(jt,tr,g,pt,me,K):F1(jt,tr,me);g.uploadCommonUniforms(g.context,Et,Je.toUnwrapped());let ir=Ce;(M==="road"&&!z||M==="offset")&&(ir=pe),Et.draw(g,Ue,ir,u||g.stencilModeForClipping(Je),C,ur.disabled,Ee,b.id,qe.layoutVertexBuffer,De,dt,b.paint,g.transform.zoom,Re,yt)}};g.renderPass===F&&we(g.depthModeForSublayer(1,g.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly),!1),ee==="none"&&g.renderPass==="translucent"&&b.paint.get("fill-antialias")&&we(g.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly),!0)}function op(m,o,u,g,x,b,E,C){u.resetLayerRenderingStats(m);const M=m.context,z=M.gl,F=m.transform,H=u.paint.get("fill-extrusion-pattern"),$=u.paint.get("fill-extrusion-pattern-cross-fade"),K=H.constantOr(null),te=H.constantOr(1),ee=u.paint.get("fill-extrusion-opacity"),re=m.style.enable3dLights(),ie=u.paint.get(re&&!te?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ue=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),ie],pe=u.layout.get("fill-extrusion-edge-radius"),me=pe>0&&!u.paint.get("fill-extrusion-rounded-roof"),Te=me?0:pe,we=F.projection.name==="globe"?s.e5():0,Ce=F.projection.name==="globe",be=Ce?s.ah(F.zoom):0,Se=[s.aD(F.center.lng),s.aH(F.center.lat)],Ee=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ue=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ee?null:u.lut).toArray01().slice(0,3),De=u.paint.get("fill-extrusion-flood-light-intensity"),dt=u.paint.get("fill-extrusion-vertical-scale"),Je=u.paint.get("fill-extrusion-line-width").constantOr(1)!==0,pt=u.paint.get("fill-extrusion-height-alignment"),Pt=u.paint.get("fill-extrusion-base-alignment"),qe=yl(m,u.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let nt;Ce&&Re.push("PROJECTION_GLOBE_VIEW"),ue[0]>0&&Re.push("FAUX_AO"),me&&Re.push("ZERO_ROOF_RADIUS"),C&&Re.push("HAS_CENTROID"),De>0&&Re.push("FLOOD_LIGHT"),qe.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),Je&&Re.push("RENDER_WALL_MODE");const Ze=m.renderPass==="shadow",yt=m.shadowRenderer,bt=Ze&&!!yt,Et=Ze?ur.disabled:ur.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let jt=[0,0,0];if(yt){const Zt=m.style.directionalLight,er=m.style.ambientLight;Zt&&er&&(jt=Uu(m.style,Zt,er)),Ze||(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),yt.useNormalOffset&&Re.push("NORMAL_OFFSET")),nt=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const tr=bt?"fillExtrusionDepth":te?"fillExtrusionPattern":"fillExtrusion",ir=u.getLayerRenderingStats();for(const Zt of g){const er=o.getTile(Zt),nr=er.getBucket(u);if(!nr||nr.projection.name!==F.projection.name)continue;let wr=!1;yt&&(wr=yt.getMaxCascadeForTile(Zt.toUnwrapped())===0);const Pr=m.isTileAffectedByFog(Zt),Nr=nr.programConfigurations.get(u.id);let Pn=!1;if(K&&er.imageAtlas){const cn=er.imageAtlas,vn=s.dZ.from(K),hi=vn.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),kr=vn.getSecondary(),mn=cn.patternPositions.get(hi),mi=kr?cn.patternPositions.get(kr.scaleSelf(s.q.devicePixelRatio).toString()):null;Pn=!!mn&&!!mi,mn&&Nr.setConstantPatternPositions(mn,mi)}$>0&&(Pn||Nr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Re.push("FILL_EXTRUSION_PATTERN_TRANSITION");const vr=m.getOrCreateProgram(tr,{config:Nr,defines:wr?nt:Re,overrideFog:Pr});if(m.terrain&&m.terrain.setupElevationDraw(er,vr,{useMeterToDem:!0}),!nr.centroidVertexBuffer){const cn=vr.attributes.a_centroid_pos;cn!==void 0&&z.vertexAttrib2f(cn,0,0)}!Ze&&yt&&yt.setupShadows(er.tileID.toUnwrapped(),vr,"vector-tile"),te&&(m.context.activeTexture.set(z.TEXTURE0),er.imageAtlasTexture&&er.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Nr.updatePaintBuffers());const un=u.paint.get("fill-extrusion-vertical-gradient"),hn=1/nr.tileToMeter;let Zn;if(Ze&&yt){if(Tg(er.tileID,nr.maxHeight,m))continue;const cn=yt.calculateShadowPassMatrixFromTile(er.tileID.toUnwrapped());Zn=N1(cn,Te,hn,dt,pt,Pt)}else{const cn=m.translatePosMatrix(Zt.expandedProjMatrix,er,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),vn=F.projection.createInversionMatrix(F,Zt.canonical);Zn=te?ld(cn,m,un,ee,ue,Te,hn,Zt,er,we,pt,Pt,be,Se,vn,Ue,dt,$):Kv(cn,m,un,ee,ue,Te,hn,Zt,we,pt,Pt,be,Se,vn,Ue,dt,De,jt)}m.uploadCommonUniforms(M,vr,Zt.toUnwrapped(),null,qe);let Ir=nr.segments;if(F.projection.name==="mercator"&&!Ze&&(Ir=nr.getVisibleSegments(er.tileID,m.terrain,m.transform.getFrustum(0)),!Ir.get().length))continue;if(ir)if(Ze)for(const cn of Ir.get())ir.numRenderedVerticesInShadowPass+=cn.primitiveLength;else for(const cn of Ir.get())ir.numRenderedVerticesInTransparentPass+=cn.primitiveLength;const on=[];(m.terrain||C)&&on.push(nr.centroidVertexBuffer),Ce&&on.push(nr.layoutVertexExtBuffer),Je&&on.push(nr.wallVertexBuffer),vr.draw(m,M.gl.TRIANGLES,x,b,E,Et,Zn,u.id,nr.layoutVertexBuffer,nr.indexBuffer,Ir,u.paint,m.transform.zoom,Nr,on)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class Xl{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Co(m,o,u,g,x,b,E,C,M,z,F,H,$,K,te,ee,re,ie,ue,pe){const me=o.context,Te=me.gl,we=o.transform,Ce=o.transform.zoom,be=[],Se=m.translate,Ee=m.translateAnchor,Ue=m.edgeRadius,De=yl(o,m.cutoffFadeRange);F==="clear"?(be.push("CLEAR_SUBPASS"),pe&&(be.push("CLEAR_FROM_TEXTURE"),me.activeTexture.set(Te.TEXTURE0),pe.bind(Te.LINEAR,Te.CLAMP_TO_EDGE))):F==="sdf"&&be.push("SDF_SUBPASS"),ie&&be.push("HAS_CENTROID"),De.shouldRenderCutoff&&be.push("RENDER_CUTOFF");const dt=(Je,pt,Pt,qe,Re)=>{const nt=pt.programConfigurations.get(g.id),Ze=o.isTileAffectedByFog(Je),yt=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:nt,defines:be,overrideFog:Ze}),bt=((jt,tr,ir,Zt,er,nr,wr,Pr,Nr,Pn,vr)=>({u_matrix:tr,u_opacity:ir,u_ao_pass:Zt?1:0,u_meter_to_tile:er,u_ao:nr,u_flood_light_intensity:wr,u_flood_light_color:Pr,u_attenuation:Nr,u_edge_radius:Pn,u_fb:0,u_fb_size:vr,u_dynamic_offset:1}))(0,qe,H,z,Re,[$,K*Re],te,ee,re,Ce>=17?0:Ue*Re,pe?pe.size[0]:0),Et=[];ie&&Et.push(pt.hiddenByLandmarkVertexBuffer),o.uploadCommonUniforms(me,yt,Je.toUnwrapped(),null,De),yt.draw(o,me.gl.TRIANGLES,b,E,C,M,bt,g.id,pt.vertexBuffer,pt.indexBuffer,Pt,g.paint,Ce,nt,Et)};for(const Je of x){const pt=u.getTile(Je),Pt=pt.getBucket(g);if(!Pt||Pt.projection.name!==we.projection.name||!Pt.groundEffect||Pt.groundEffect&&!Pt.groundEffect.hasData())continue;const qe=Pt.groundEffect,Re=1/Pt.tileToMeter;{const nt=o.translatePosMatrix(Je.projMatrix,pt,Se,Ee),Ze=qe.getDefaultSegment();dt(Je,qe,Ze,nt,Re)}if(ue)for(let nt=0;nt<4;nt++){const Ze=s.e3[nt](Je),yt=u.getTile(Ze);if(!yt)continue;const bt=yt.getBucket(g);if(!bt||bt.projection.name!==we.projection.name||!bt.groundEffect||bt.groundEffect&&!bt.groundEffect.hasData())continue;const Et=bt.groundEffect;let jt,tr;nt===0?(jt=[-s.aj,0,0],tr=1):nt===1?(jt=[s.aj,0,0],tr=0):nt===2?(jt=[0,-s.aj,0],tr=3):(jt=[0,s.aj,0],tr=2);const ir=Et.regionSegments[tr];if(!ir)continue;const Zt=new Float32Array(16);s.bo(Zt,Je.projMatrix,jt),dt(Je,Et,ir,o.translatePosMatrix(Zt,pt,Se,Ee),Re)}}}function hr(m,o,u,g,x,b,E){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const C=b?b.findDEMTileFor(u):null;if(!(C&&C.dem||E))return;b&&C&&C.dem&&g.selfDEMTileTimestamp!==C.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=C.dem._timestamp);const M=ie=>new s.P(Math.ceil((ie+s.e7)*s.e8),0),z=ie=>{const ue=o.getSource().minzoom,pe=Te=>{const we=o.getTileByID(Te);if(we&&we.hasData())return we.getBucket(x)},me=[0,-1,1];for(const Te of me){if(ie.overscaledZ+Te<ue)continue;const we=pe(ie.calculateScaledKey(ie.overscaledZ+Te));if(we)return we}},F=[0,0,0],H=(ie,ue)=>(F[0]=Math.min(ie.min.y,ue.min.y),F[1]=Math.max(ie.max.y,ue.max.y),F[2]=s.aj-ue.min.x>ie.max.x?ue.min.x-s.aj:ie.max.x,F),$=(ie,ue)=>(F[0]=Math.min(ie.min.x,ue.min.x),F[1]=Math.max(ie.max.x,ue.max.x),F[2]=s.aj-ue.min.y>ie.max.y?ue.min.y-s.aj:ie.max.y,F),K=[(ie,ue)=>H(ie,ue),(ie,ue)=>H(ue,ie),(ie,ue)=>$(ie,ue),(ie,ue)=>$(ue,ie)],te=(ie,ue,pe,me,Te,we,Ce)=>{if(!b)return 0;const be=[[we?pe:ie,we?ie:pe,0],[we?pe:ue,we?ue:pe,0]],Se=Ce<0?s.aj+Ce:Ce,Ee=[we?Se:(ie+ue)/2,we?(ie+ue)/2:Se,0];return pe===0&&Ce<0||pe!==0&&Ce>0?b.getForTilePoints(Te,[Ee],!0,me):be.push(Ee),b.getForTilePoints(u,be,!0,C),Math.max(be[0][2],be[1][2],Ee[2])/b.exaggeration()};for(let ie=0;ie<4;ie++){const ue=g.borderFeatureIndices[ie];if(ue.length===0)continue;const pe=s.e3[ie](u),me=z(pe);if(!(me&&me instanceof s.e4))continue;const Te=b?b.findDEMTileFor(pe):null;if(!(Te&&Te.dem||E)||(b&&Te&&Te.dem&&g.borderDEMTileTimestamp[ie]!==Te.dem._timestamp&&(g.borderDoneWithNeighborZ[ie]=-1,g.borderDEMTileTimestamp[ie]=Te.dem._timestamp),g.borderDoneWithNeighborZ[ie]===me.canonical.z))continue;me.centroidVertexArray.length===0&&me.createCentroidsBuffer();const we=(ie<2?1:5)-ie,Ce=me.borderDoneWithNeighborZ[we]!==g.canonical.z,be=me.borderFeatureIndices[we];let Se=0;if(g.canonical.z!==me.canonical.z){for(const Ee of ue)g.showCentroid(g.featuresOnBorder[Ee]);if(Ce)for(const Ee of be)me.showCentroid(me.featuresOnBorder[Ee]);g.borderDoneWithNeighborZ[ie]=me.canonical.z,me.borderDoneWithNeighborZ[we]=g.canonical.z}for(const Ee of ue){const Ue=g.featuresOnBorder[Ee],De=g.centroidData[Ue.centroidDataIndex],dt=Ue.borders[ie];let Je;for(;Se<be.length;){Je=me.featuresOnBorder[be[Se]];const pt=Je.borders[we];if(pt[1]>dt[0]+3||pt[0]>dt[0]-3)break;me.showCentroid(Je),Se++}if(Je&&Se<be.length){const pt=Se;let Pt=0;for(;!(Je.borders[we][0]>dt[1]-3)&&(Pt++,++Se!==be.length);)Je=me.featuresOnBorder[be[Se]];Je=me.featuresOnBorder[be[pt]];let qe=!1;if(Pt>=1){const Ze=Je.borders[we];Math.abs(dt[0]-Ze[0])<3&&Math.abs(dt[1]-Ze[1])<3&&(Pt=1,qe=!0,Se=pt+1)}else if(Pt===0){g.showCentroid(Ue);continue}const Re=me.centroidData[Je.centroidDataIndex];E&&qe&&(((ee=De).flags|(re=Re).flags)&s.e6?(ee.flags|=s.e6,re.flags|=s.e6):(ee.flags&=~s.e6,re.flags&=~s.e6));const nt=Ue.intersectsCount()>1||Je.intersectsCount()>1;if(Pt>1)Se=pt,De.centroidXY=Re.centroidXY=new s.P(0,0);else if(Te&&Te.dem&&!nt){const Ze=K[ie](De,Re),yt=ie%2?s.aj-1:0,bt=te(Ze[0],Math.min(s.aj-1,Ze[1]),yt,Te,pe,ie<2,Ze[2]);De.centroidXY=Re.centroidXY=M(bt)}else nt?De.centroidXY=Re.centroidXY=new s.P(0,0):(De.centroidXY=g.encodeBorderCentroid(Ue),Re.centroidXY=me.encodeBorderCentroid(Je));g.writeCentroidToBuffer(De),me.writeCentroidToBuffer(Re)}else g.showCentroid(Ue)}g.borderDoneWithNeighborZ[ie]=me.canonical.z,me.borderDoneWithNeighborZ[we]=g.canonical.z}var ee,re;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const a0=[1,0,0],VP=[0,1,0],UP=[0,0,1];function Tg(m,o,u){const g=u.transform,x=u.shadowRenderer;if(!x)return!0;const b=m.toUnwrapped(),E=g.tileSize*x._cascades[u.currentShadowCascade].scale;let C=o;if(g.elevation){const ee=g.elevation.getMinMaxForTile(m);ee&&(C+=ee.max)}const M=[...x.shadowDirection];M[2]=-M[2];const z=x.computeSimplifiedTileShadowVolume(b,C,E,M);if(!z)return!1;const F=[a0,VP,UP,M,[M[0],0,M[2]],[0,M[1],M[2]]],H=g.projection.name==="globe",$=g.scaleZoom(E),K=s.cy.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,$,!H),te=x.getCurrentCascadeFrustum();return K.intersectsPrecise(z.vertices,z.planes,F)===0||te.intersectsPrecise(z.vertices,z.planes,F)===0}function Eg(m){const{painter:o,source:u,layer:g,coords:x}=m,b=m.defines,E=o.context,C=o.renderPass==="shadow",M=o.renderPass==="light-beam",z=o.shadowRenderer;let F;z&&(F=b.concat(["SHADOWS_SINGLE_CASCADE"]));const H=s.e9(o.transform.center.lat,o.transform.zoom);for(const $ of x){const K=u.getTile($),te=K.getBucket(g);if(!te)continue;let ee=!1;z&&(ee=z.getMaxCascadeForTile($.toUnwrapped())===0);const re=te.programConfigurations.get(g.id);let ie,ue,pe=o.translatePosMatrix($.expandedProjMatrix,K,[0,0],"map");if(pe=s.cP(s.bz(),pe,[1,1,m.verticalScale]),C&&z){if(Tg(K.tileID,te.maxHeight*H,o))continue;let me=z.calculateShadowPassMatrixFromTile(K.tileID.toUnwrapped());me=s.cP(s.bz(),me,[1,1,m.verticalScale]),ue=V1(me),ie=o.getOrCreateProgram("buildingDepth",{config:re,defines:ee?F:b,overrideFog:!1})}else if(M)ie=o.getOrCreateProgram("buildingBloom",{config:re,defines:ee?F:b,overrideFog:!1}),ue=Yv(pe);else{const me=o.transform.calculatePosMatrix($.toUnwrapped(),o.transform.worldSize);s.cP(me,me,[1,1,m.verticalScale]);const Te=s.bz();s.cP(Te,me,[1,-1,1/H]),s.bi(Te,Te),s.ea(Te,Te),ue=Xv(pe,Te),ie=o.getOrCreateProgram("building",{config:re,defines:ee?F:b,overrideFog:!1}),z&&z.setupShadowsFromMatrix(me,ie,!0)}if(o.uploadCommonUniforms(E,ie,$.toUnwrapped(),null,null),M){const me=te.bloomGeometry;ie.draw(o,E.gl.TRIANGLES,m.depthMode,mr.disabled,m.blendMode,ur.disabled,ue,g.id,me.layoutVertexBuffer,me.indexBuffer,me.segmentsBucket,g.paint,o.transform.zoom,re,[me.layoutAttenuationBuffer,me.layoutColorBuffer])}else ie.draw(o,E.gl.TRIANGLES,m.depthMode,mr.disabled,m.blendMode,C?ur.disabled:ur.backCW,ue,g.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,g.paint,o.transform.zoom,re,[te.layoutNormalBuffer,te.layoutColorBuffer])}}function X1(m){return[m[0]*s.eb,m[1]*s.eb,m[2]*s.eb,0]}function Ag(m,o,u,g,x,b,E,C,M){const z=g.getSource(),F=u.globeSharedBuffers;if(!F)return;let H,$,K;if(o&&(H=g.getTile(o)),z instanceof s.aP?($=z.texture,K=s.dE(0,0,u.transform)):H&&o&&($=H.texture,K=s.dE(o.canonical.z,o.canonical.x,u.transform)),!$||!K)return;m||(K=s.cP(s.bz(),K,[1,-1,1]));const te=u.context,ee=te.gl,re=x.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR,ie=u.colorModeForDrapableLayerRenderPass(b),ue=E.defines;ue.push("GLOBE_POLES");const pe=new Wt(ee.LEQUAL,Wt.ReadWrite,u.depthRangeFor3D),me=Float32Array.from(u.transform.expandedFarZProjMatrix),Te=Float32Array.from(s.bh(s.dD(new s.cA(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),te.activeTexture.set(ee.TEXTURE0),$.bind(re,ee.CLAMP_TO_EDGE),te.activeTexture.set(ee.TEXTURE1),$.bind(re,ee.CLAMP_TO_EDGE),"useMipmap"in $&&te.extTextureFilterAnisotropic&&u.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,te.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,te.extTextureFilterAnisotropicMax);const[we,Ce,be,Se]=o?F.getPoleBuffers(o.canonical.z,!1):F.getPoleBuffers(0,!0),Ee=x.paint.get("raster-elevation");let Ue;m?(Ue=we,u.renderDefaultNorthPole=Ee!==0):(Ue=Ce,u.renderDefaultSouthPole=Ee!==0);const De=X1(E.mix),dt=((pt,Pt,qe,Re,nt,Ze,yt,bt,Et,jt,tr,ir,Zt)=>Qv(pt,Pt,qe,new Float32Array(16),new Float32Array(9),[0,0],Re,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],bt,2,jt,tr,ir,1,0,Zt))(me,Te,K,s.ah(u.transform.zoom),0,x,0,Ee,0,De,E.offset,E.range,b),Je=u.getOrCreateProgram("raster",{defines:ue});u.uploadCommonUniforms(te,Je,null),Je.draw(u,ee.TRIANGLES,pe,M,ie,C,dt,x.id,Ue,be,Se)}function $P(m){const o=m._nearZ,u=m.projection.farthestPixelDistance(m),g=u-o,x=.2*m.height,b=o+x;return[o,u,(b-x-o)/g,(b-o)/g]}function GP(m,o,u,g){if(m)return o instanceof Oc&&m instanceof $h?o.getTextureDescriptor(m,u,!0):{texture:m.texture,mix:X1(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Uo=s.ec([{name:"a_index",type:"Int16",components:1}]);class l0{constructor(o,u,g,x){const b={width:g[0],height:g[1],data:null},E=o.gl;this.targetColorTexture=new s.T(o,b,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(o,b,E.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(u,x),this.lastInvalidatedAt=0}updateParticleTexture(o,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,x=u.width*u.height;this.particleTexture0=new s.T(this.context,u,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,u,g.RGBA8,{premultiply:!1,useMipmap:!1});const b=new s.ed;b.reserve(x);for(let E=0;E<x;E++)b.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(b,Uo.members,!0),this.particleSegment=s.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function uo(m,o,u){if(!m)return null;const g=o.getTextureDescriptor(m,u,!0);if(!g)return null;let{texture:x,mix:b,offset:E,tileSize:C,buffer:M,format:z}=g;if(!x||!z)return null;let F=!1;return z==="uint32"&&(F=!0,b[3]=0,b=_g(s.ee,b,[0,u.paint.get("raster-particle-max-speed")]),E=Uc(s.ee,E,[0,u.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[M/(C+2*M),C/(C+2*M)],tileSize:C,scalarData:F,scale:b,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Zc(m){const o=m._nearZ,u=m.projection.farthestPixelDistance(m),g=u-o,x=.2*m.height,b=o+x;return[o,u,(b-x-o)/g,(b-o)/g]}const Y1=new s.am(1,0,0,1),c0=new s.am(0,1,0,1),u0=new s.am(0,0,1,1),h0=new s.am(1,0,1,1),J1=new s.am(0,1,1,1);function _l(m,o,u,g,x,b){for(let E=0;E<u.length;E++)if(x){const C=new s.am(g.r*.8,g.g*.8,g.b*.8,1);On(m,o,u[E],g,-1,-1,b),On(m,o,u[E],g,-1,1,b),On(m,o,u[E],g,1,1,b),On(m,o,u[E],g,1,-1,b),On(m,o,u[E],C,0,0,b)}else On(m,o,u[E],g,0,0,b)}function On(m,o,u,g,x,b,E){const C=m.context,M=m.transform,z=C.gl,F=M.projection.name==="globe",H=F?["PROJECTION_GLOBE_VIEW"]:[];let $=s.bw(u.projMatrix);if(F&&s.ah(M.zoom)>0){const De=s.bg(u.canonical,M),dt=s.ef(De);$=s.az(new Float32Array(16),M.globeMatrix,dt),s.az($,M.projMatrix,$)}const K=s.bz();K[12]+=2*x/(s.q.devicePixelRatio*M.width),K[13]+=2*b/(s.q.devicePixelRatio*M.height),s.az($,K,$);const te=m.getOrCreateProgram("debug",{defines:H}),ee=o.getTileByID(u.key);m.terrain&&m.terrain.setupElevationDraw(ee,te);const re=Wt.disabled,ie=mr.disabled,ue=m.colorModeForRenderPass(),pe="$debug";C.activeTexture.set(z.TEXTURE0),m.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),F?ee._makeGlobeTileDebugBuffers(m.context,M):ee._makeDebugTileBoundsBuffers(m.context,M.projection);const me=ee._tileDebugBuffer||m.debugBuffer,Te=ee._tileDebugIndexBuffer||m.debugIndexBuffer,we=ee._tileDebugSegments||m.debugSegments;if(te.draw(m,z.LINE_STRIP,re,ie,ue,ur.disabled,Jv($,g.toPremultipliedRenderColor(null)),pe,me,Te,we,null,null,null,[ee._globeTileDebugBorderBuffer]),E){const De=ee.latestRawTileData,dt=Math.floor((De&&De.byteLength||0)/1024);let Je=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Je+=` => ${u.overscaledZ}`),Je+=` ${ee.state}`,Je+=` ${dt}kb`,function(pt,Pt){pt.initDebugOverlayCanvas();const qe=pt.debugOverlayCanvas,Re=pt.context.gl,nt=pt.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,qe.width,qe.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(Pt,5,5),nt.strokeText(Pt,5,5),pt.debugOverlayTexture.update(qe),pt.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(m,Je)}const Ce=o.getTile(u).tileSize,be=512/Math.min(Ce,512)*(u.overscaledZ/M.zoom)*.5,Se=ee._tileDebugTextBuffer||m.debugBuffer,Ee=ee._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ue=ee._tileDebugTextSegments||m.debugSegments;te.draw(m,z.TRIANGLES,re,ie,Or.alphaBlended,ur.disabled,Jv($,s.am.transparent.toPremultipliedRenderColor(null),be),pe,Se,Ee,Ue,null,null,null,[ee._globeTileDebugTextBuffer])}function ap(m,o,u,g){lp(m,0,o+u/2,m.transform.width,u,g)}function kg(m,o,u,g){lp(m,o-u/2,0,u,m.transform.height,g)}function lp(m,o,u,g,x,b){const E=m.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(o*s.q.devicePixelRatio,u*s.q.devicePixelRatio,g*s.q.devicePixelRatio,x*s.q.devicePixelRatio),E.clear({color:b}),C.disable(C.SCISSOR_TEST)}const Q1=s.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:eS}=Q1;function Kc(m,o,u,g){m.emplaceBack(o,u,g)}class Xu{constructor(o){this.vertexArray=new s.eg,this.indices=new s.a_,Kc(this.vertexArray,-1,-1,1),Kc(this.vertexArray,1,-1,1),Kc(this.vertexArray,-1,1,1),Kc(this.vertexArray,1,1,1),Kc(this.vertexArray,-1,-1,-1),Kc(this.vertexArray,1,-1,-1),Kc(this.vertexArray,-1,1,-1),Kc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,eS),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=s.bd.simpleSegment(0,0,36,12)}}function rl(m,o,u,g,x,b){const E=m.context.gl,C=o.paint.get("sky-atmosphere-color"),M=o.paint.get("sky-atmosphere-halo-color"),z=o.paint.get("sky-atmosphere-sun-intensity"),F=((H,$,K,te,ee)=>({u_matrix_3f:H,u_sun_direction:$,u_sun_intensity:K,u_color_tint_r:[te.r,te.g,te.b,te.a],u_color_tint_m:[ee.r,ee.g,ee.b,ee.a],u_luminance:5e-5}))(s.ei(s.dJ(),g),x,z,C.toPremultipliedRenderColor(null),M.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,o.skyboxTexture,0),u.draw(m,E.TRIANGLES,Wt.disabled,mr.disabled,Or.unblended,ur.frontCW,F,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Mt=s.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class $t{constructor(o){const u=new s.ej;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const g=new s.a_;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(u,Mt.members),this.indexBuffer=o.createIndexBuffer(g),this.segments=s.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ud=s.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class wi{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class $e{constructor(o){this.colorModeAlphaBlendedWriteRGB=new Or([1,Vu,1,Vu],s.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Or([1,0,1,0],s.am.transparent,[!1,!1,!1,!0]),this.params=new wi,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){const u=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new $t(u);const g=this.params.sizeRange,x=this.params.intensityRange,b=function(F){const H=s.el(30),$=[];for(let K=0;K<F;++K){const te=2*Math.PI*H(),ee=Math.acos(1-2*H())-.5*Math.PI;$.push(s.d2(Math.cos(ee)*Math.cos(te),Math.cos(ee)*Math.sin(te),Math.sin(ee)))}return $}(this.params.starsCount),E=s.el(300),C=new s.ek,M=new s.a_;let z=0;for(let F=0;F<b.length;++F){const H=s.c1([],b[F],200),$=Math.max(0,1+.01*g*(1*E()-.5)),K=Math.max(0,1+.01*x*(1*E()-.5));C.emplaceBack(H[0],H[1],H[2],-1,-1,$,K),C.emplaceBack(H[0],H[1],H[2],1,-1,$,K),C.emplaceBack(H[0],H[1],H[2],1,1,$,K),C.emplaceBack(H[0],H[1],H[2],-1,1,$,K),M.emplaceBack(z+0,z+1,z+2),M.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=u.createVertexBuffer(C,ud.members),this.starsIdx=u.createIndexBuffer(M),this.starsSegments=s.bd.simpleSegment(0,0,C.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,u){const g=o.context,x=g.gl,b=o.transform,E=new Wt(x.LEQUAL,Wt.ReadOnly,[0,1]),C=s.ah(b.zoom),M=o.style.getLut(u.scope),z=u.properties.get("color-use-theme")==="none",F=u.properties.get("color").toNonPremultipliedRenderColor(z?null:M).toArray01(),H=u.properties.get("high-color-use-theme")==="none",$=u.properties.get("high-color").toNonPremultipliedRenderColor(H?null:M).toArray01(),K=u.properties.get("space-color-use-theme")==="none",te=u.properties.get("space-color").toNonPremultipliedRenderColor(K?null:M).toArray01(),ee=5e-4,re=s.em(u.properties.get("horizon-blend"),0,1,ee,.25),ie=s.dy(o,g,b)&&re===ee?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,ue=o.frameCounter/1e3%1,pe=s.ae(b.globeCenterInViewSpace),me=Math.sqrt(Math.pow(pe,2)-Math.pow(ie,2)),Te=Math.acos(me/pe),we=Ce=>{const be=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ce&&be.push("ALPHA_PASS");const Se=o.getOrCreateProgram("globeAtmosphere",{defines:be}),Ee=((De,dt,Je,pt,Pt,qe,Re,nt,Ze,yt,bt,Et)=>({u_frustum_tl:De,u_frustum_tr:dt,u_frustum_br:Je,u_frustum_bl:pt,u_horizon:Pt,u_transition:qe,u_fadeout_range:Re,u_color:nt,u_high_color:Ze,u_space_color:yt,u_temporal_offset:bt,u_horizon_angle:Et}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,C,re,F,$,te,ue,Te);o.uploadCommonUniforms(g,Se);const Ue=this.atmosphereBuffer;Ue&&Se.draw(o,x.TRIANGLES,E,mr.disabled,Ce?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ur.backCW,Ee,Ce?"atmosphere_glow_alpha":"atmosphere_glow",Ue.vertexBuffer,Ue.indexBuffer,Ue.segments)};we(!1),we(!0)}drawStars(o,u){const g=s.ay(u.properties.get("star-intensity"),0,1);if(g===0)return;const x=o.context,b=x.gl,E=o.transform,C=o.getOrCreateProgram("stars"),M=s.c3([]);s.c5(M,M,-E._pitch),s.c4(M,M,-E.angle),s.c5(M,M,s.al(E._center.lat)),s.en(M,M,-s.al(E._center.lng));const z=s.c8(new Float32Array(16),M),F=s.az([],E.starsProjMatrix,z),H=s.ei([],z),$=s.eo([],H),K=[0,1,0];s.dL(K,K,$),s.c1(K,K,this.params.sizeMultiplier);const te=[1,0,0];s.dL(te,te,$),s.c1(te,te,this.params.sizeMultiplier);const ee=(re=K,ie=te,ue=g,{u_matrix:Float32Array.from(F),u_up:re,u_right:ie,u_intensity_multiplier:ue});var re,ie,ue;o.uploadCommonUniforms(x,C),this.starsVx&&this.starsIdx&&C.draw(o,b.TRIANGLES,Wt.disabled,mr.disabled,this.colorModeAlphaBlendedWriteRGB,ur.disabled,ee,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class tS{constructor(){this.visibleTiles=[]}updateBorders(o,u){const g=[],x=[],b=o._getRenderableCoordinates(!1,!0);for(const M of b){const z=o.getTile(M);if(!z.hasData())continue;const F=z.getBucket(u);F&&(F.isEmpty()||(g.push(M.key),x.push({bucket:F,tileID:M.canonical})))}let E=g.length!==this.visibleTiles.length;if(!E){g.sort();for(let M=0;M<g.length;M++)if(g[M]!==this.visibleTiles[M]){E=!0;break}}if(!E)return;const C=new Set;this.visibleTiles=g,x.sort((M,z)=>M.tileID.z-z.tileID.z||M.tileID.x-z.tileID.x||M.tileID.y-z.tileID.y);for(const M of x){const z=new Array,F=new Array,H=M.bucket;for(const $ of H.featuresOnBorder)C.has($.featureId)?F.push($.footprintIndex):(C.add($.featureId),z.push($.footprintIndex));H.updateFootprintHiddenFlags(z,s.ep,!1),H.updateFootprintHiddenFlags(F,s.ep,!0)}}}function cp(m,o){const u=[...m],g=o.cameraWorldSizeForFog/o.worldSize,x=s.bx([]);return s.cP(x,x,[g,g,1]),s.az(u,x,u),s.az(u,o.worldToFogMatrix,u),u}function up(m,o,u,g,x){const b=u.material,E=g.context,{baseColorTexture:C,metallicRoughnessTexture:M}=b.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:F,emissionTexture:H}=b;function $(te,ee,re){if(te&&(m.push(ee),E.activeTexture.set(E.gl.TEXTURE0+re),te.gfxTexture)){const{minFilter:ie,magFilter:ue,wrapS:pe,wrapT:me}=te.sampler;te.gfxTexture.bindExtraParam(ie,ue,pe,me)}}$(C,"HAS_TEXTURE_u_baseColorTexture",co.BaseColor),$(M,"HAS_TEXTURE_u_metallicRoughnessTexture",co.MetallicRoughness),$(z,"HAS_TEXTURE_u_normalTexture",co.Normal),$(F,"HAS_TEXTURE_u_occlusionTexture",co.Occlusion),$(H,"HAS_TEXTURE_u_emissionTexture",co.Emission),x&&(x.texture||(x.texture=new s.et(g.context,x.image,[x.image.height,x.image.height,x.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+co.LUT),x.texture&&x.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(u.texcoordBuffer)),u.colorBuffer&&(m.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(u.colorBuffer)),u.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(u.normalBuffer)),u.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(u.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||m.push("DIFFUSE_SHADED");const K=g.shadowRenderer;K&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),K.useNormalOffset&&m.push("NORMAL_OFFSET"))}function hd(m,o,u,g,x,b){const E=u.paint.get("model-opacity").constantOr(1),C=o.context,M=new Wt(o.context.gl.LEQUAL,Wt.ReadWrite,o.depthRangeFor3D),z=o.transform,F=m.mesh,H=F.material,$=H.pbrMetallicRoughness,K=o.style.fog;let te;te=o.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:s.az([],g.zScaleMatrix,m.nodeModelMatrix),s.az(te,g.negCameraPosMatrix,te);const ee=s.bi([],te);s.ea(ee,ee);const re=u.paint.get("model-color-use-theme").constantOr("default")==="none",ie=u.paint.get("model-emissive-strength").constantOr(0),ue=t0(new Float32Array(m.worldViewProjection),new Float32Array(te),new Float32Array(ee),null,o,E,$.baseColorFactor,H.emissiveFactor,$.metallicFactor,$.roughnessFactor,H,ie,u),pe={defines:[]},me=[],Te=o.shadowRenderer;Te&&(Te.useNormalOffset=!1),up(pe.defines,me,F,o,re?null:u.lut);let we=null;if(K){const Se=cp(m.nodeModelMatrix,o.transform);if(we=new Float32Array(Se),z.projection.name!=="globe"){const Ee=F.aabb.min,Ue=F.aabb.max,[De,dt]=K.getOpacityForBounds(Se,Ee[0],Ee[1],Ue[0],Ue[1]);pe.overrideFog=De>=gt||dt>=gt}}const Ce=yl(o,u.paint.get("model-cutoff-fade-range"));Ce.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const be=o.getOrCreateProgram("model",pe);o.uploadCommonUniforms(C,be,null,we,Ce),o.renderPass!=="shadow"&&Te&&Te.setupShadowsFromMatrix(m.nodeModelMatrix,be),be.draw(o,C.gl.TRIANGLES,M,x,b,F.material.doubleSided?ur.disabled:ur.backCCW,ue,u.id,F.vertexBuffer,F.indexBuffer,F.segments,u.paint,o.transform.zoom,void 0,me)}function d0(m,o,u,g,x,b,E){let C;C=m.projection.name==="globe"?s.er(u,m):[...u],s.az(C,C,o.matrix);const M=s.az([],g,C);if(o.meshes)for(const z of o.meshes){if(z.material.alphaMode!=="BLEND"){E.push({mesh:z,depth:0,modelIndex:x,worldViewProjection:M,nodeModelMatrix:C});continue}const F=s.ad([],z.centroid,M);!m.isOrthographic&&F[2]<=0||b.push({mesh:z,depth:F[2],modelIndex:x,worldViewProjection:M,nodeModelMatrix:C})}if(o.children)for(const z of o.children)d0(m,z,u,g,x,b,E)}function Pg(m,o,u,g){const x=u.shadowRenderer;if(!x)return;const b=x.getShadowPassDepthMode(),E=x.getShadowPassColorMode(),C=x.calculateShadowPassMatrixFromMatrix(o),M=q1(C);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,b,mr.disabled,E,ur.backCCW,M,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,u.transform.zoom,void 0,void 0)}function dd(m,o,u){const g=o.updateZoomBasedPaintProperties(),x=function(b,E,C){let M,z,F,H=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&H>0){const $=b.terrain,K=$.findDEMTileFor(C);K&&K.dem?M=s.eu.create($,C,K):H=0}if(H===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),H===E.validForExaggeration&&(H===0||M&&M._demTile&&M._demTile.tileID===E.validForDEMTile.id&&M._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const $ in E.instancesPerModel){const K=E.instancesPerModel[$];for(let te=0;te<K.instancedDataArray.length;++te){const ee=(M?H*M.getElevationAt(0|K.instancedDataArray.float32[16*te],0|K.instancedDataArray.float32[16*te+1],!0,!0):0)+K.instancesEvaluatedElevation[te];K.instancedDataArray.float32[16*te+6]=ee,z=z?Math.min(E.terrainElevationMin,ee):ee,F=F?Math.max(E.terrainElevationMax,ee):ee}}return E.terrainElevationMin=z||0,E.terrainElevationMax=F||0,E.validForExaggeration=H,E.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,o,u);(g||x)&&(o.uploaded=!1,o.upload(m.context))}const vl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d6([0,0,0],[s.aj,s.aj,0])};function HP(m,o){const u=1<<m.canonical.z,g=o.getFreeCameraOptions().position,x=o.elevation,b=m.canonical.x/u,E=(m.canonical.x+1)/u,C=m.canonical.y/u,M=(m.canonical.y+1)/u;let z=o._centerAltitude;if(x){const K=x.getMinMaxForTile(m);K&&K.max>z&&(z=K.max)}const F=s.ay(g.x,b,E)-g.x,H=s.ay(g.y,C,M)-g.y,$=s.cb(z,o.center.lat)-g.z;return o._zoomFromMercatorZ(Math.sqrt(F*F+H*H+$*$))}function f0(m,o,u,g,x,b,E){const C=m.context,M=m.renderPass==="shadow",z=m.shadowRenderer,F=M&&z?z.getShadowPassDepthMode():new Wt(C.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),H=m.isTileAffectedByFog(b);if(u.meshes)for(const $ of u.meshes){const K=["MODEL_POSITION_ON_GPU"],te=[];let ee,re,ie;g.instancedDataArray.length>20&&K.push("INSTANCED_ARRAYS");const ue=yl(m,o.paint.get("model-cutoff-fade-range"));if(ue.shouldRenderCutoff&&K.push("RENDER_CUTOFF"),M&&z)ee=m.getOrCreateProgram("modelDepth",{defines:K}),re=q1(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(u.matrix)),ie=z.getShadowPassColorMode();else{up(K,te,$,m,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),ee=m.getOrCreateProgram("model",{defines:K,overrideFog:H});const me=$.material,Te=me.pbrMetallicRoughness,we=o.paint.get("model-opacity").constantOr(1),Ce=o.paint.get("model-emissive-strength").constantOr(0);re=t0(b.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,m,we,Te.baseColorFactor,me.emissiveFactor,Te.metallicFactor,Te.roughnessFactor,me,Ce,o,x),z&&(E.shadowUniformsInitialized?ee.setShadowUniformValues(C,z.getShadowUniformValues()):(z.setupShadows(b.toUnwrapped(),ee,"model-tile"),E.shadowUniformsInitialized=!0)),ie=ue.shouldRenderCutoff||we<1||me.alphaMode!=="OPAQUE"?Or.alphaBlended:Or.unblended}m.uploadCommonUniforms(C,ee,b.toUnwrapped(),null,ue);const pe=$.material.doubleSided?ur.disabled:ur.backCCW;if(g.instancedDataArray.length>20)te.push(g.instancedDataBuffer),ee.draw(m,C.gl.TRIANGLES,F,mr.disabled,ie,pe,re,o.id,$.vertexBuffer,$.indexBuffer,$.segments,o.paint,m.transform.zoom,void 0,te,g.instancedDataArray.length);else{const me=M?"u_instance":"u_normal_matrix";for(let Te=0;Te<g.instancedDataArray.length;++Te)re[me]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Te,16),ee.draw(m,C.gl.TRIANGLES,F,mr.disabled,ie,pe,re,o.id,$.vertexBuffer,$.indexBuffer,$.segments,o.paint,m.transform.zoom,void 0,te)}}if(u.children)for(const $ of u.children)f0(m,o,$,g,x,b,E)}const Cg=[1,-1,1];function p0(m,o,u,g){if(!u.modelManager)return!0;const x=u.modelManager;if(!u.shadowRenderer)return!0;const b=u.shadowRenderer,E=o.aabb;let C=!0,M=m.maxHeight;if(M===0){let F=0;for(const H in m.instancesPerModel){const $=x.getModel(H,g);$?F=Math.max(F,Math.max(Math.max($.aabb.max[0],$.aabb.max[1]),$.aabb.max[2])):C=!1}M=m.maxScale*F*1.41+m.maxVerticalOffset,C&&(m.maxHeight=M)}E.max[2]=M,E.min[2]+=m.terrainElevationMin,E.max[2]+=m.terrainElevationMax,s.ad(E.min,E.min,o.tileMatrix),s.ad(E.max,E.max,o.tileMatrix);const z=E.intersects(b.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=z===2),z===0}function rS(m,o){const u=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],x=m.uniformValues.u_cutoff_params[2],b=m.uniformValues.u_cutoff_params[3];return g===u||b===x?1:s.ay(((o-u)/(g-u)-x)/(b-x),0,1)}function nS(m,o,u,g){if(o.pitch<20)return 1;const x=o.getWorldToCameraMatrix();s.az(x,x,m);const b=s.bR(u.min[0],u.min[1],u.min[2],1);let E=s.aA(s.ev(),b,x),C=E,M=E;b[1]=u.max[1],E=s.aA(s.ev(),b,x),C=E[1]<C[1]?E:C,M=E[1]>M[1]?E:M,b[0]=u.max[0],E=s.aA(s.ev(),b,x),C=E[1]<C[1]?E:C,M=E[1]>M[1]?E:M,b[1]=u.min[1],E=s.aA(s.ev(),b,x),C=E[1]<C[1]?E:C,M=E[1]>M[1]?E:M;const z=s.ay(g[0],0,1),F=100*o.pixelsPerMeter*s.ay(g[1],0,1),H=s.ay(g[2],0,1),$=s.ew(s.ev(),C,M,z),K=Math.tan(.5*o.fovX),te=-$[2]*K;if(F===0)return $[1]<-Math.abs(te)?H:1;const ee=(-Math.abs(te)-$[1])/F,re=(ue,pe,me)=>(1-me)*ue+me*pe,ie=s.ay(re(1,H,ee),H,1);return re(1,ie,s.ay((o.pitch-20)/20,0,1))}class Ig{}class hp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,u,g){{const H=this._storage.get(u.id);if(H)return H.lastUsedFrameIdx=o,H.buf}const x=g.gl,b=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),E=new ArrayBuffer(b),C=new Int16Array(E);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const M=new s.ey;for(let H=0;H<b/2;H+=3){const $=C[H],K=C[H+1],te=C[H+2];M.emplaceBack($,K),M.emplaceBack(K,te),M.emplaceBack(te,$)}const z=g.bindVertexArrayOES.current,F=new Ig;return F.buf=new Hc(g,M),F.lastUsedFrameIdx=o,this._storage.set(u.id,F),g.bindVertexArrayOES.set(z),F.buf}update(o){for(const[u,g]of this._storage)o-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(u))}destroy(){for(const[o,u]of this._storage)u.buf.destroy(),this._storage.delete(o)}}class fd{constructor(o){this.occluderSize=30,this.depthOffset=-1e-4,o.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const iS=s.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class WP{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class qs{constructor(o,u){this.revealStart=11,this.revealRange=2,o.registerParameter(this,[...u,"Reveal"],"revealStart",{min:0,max:17,step:.05}),o.registerParameter(this,[...u,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const qP=s.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class dp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,u){const g=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new s.ez,C=new s.a_;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(E,qP.members),this.vignetteIdx=o.context.createIndexBuffer(C)}const x=s.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,g);const E={u_vignetteShape:(b={vignetteShape:[u.start,u.range,Math.pow(10,u.fadePower)],vignetteColor:[u.color.r,u.color.g,u.color.b,u.color.a*u.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};g.draw(o,o.context.gl.TRIANGLES,Wt.disabled,mr.disabled,Or.alphaBlended,ur.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,x)}var b}}class ei{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,u){const g=o.getFreeCameraOptions().position,x=g.toAltitude(),b=g.toLngLat(),E=s.al(b.lng),C=s.al(b.lat),M=o.pixelsPerMeter/u,z=E*s.eB,F=s.eB*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const H=-this._offsetYPrev+F,$=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*M,this._accumulatedOffsetY+=H*M,this._accumulatedElevation+=$*M,this._offsetXPrev=z,this._offsetYPrev=F,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Yr(m,o){return[-(m[0]-Math.floor(m[0]/o)*o),-(m[1]-Math.floor(m[1]/o)*o),-(m[2]-Math.floor(m[2]/o)*o)]}function m0(m){const o=s.el(1323123451230),u=[];for(let g=0;g<m;++g){const x=2*o()-1,b=2*o()-1,E=2*o()-1;u.push(s.d2(x,b,E))}return u}function Io(m,o,u,g,x){const b=s.ay((x-u)/(g-u),0,1);return(1-b)*m+b*o}class pd{constructor(o){this._movement=new ei,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new dp,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,u){const g=o.transform;this._movement.update(g,this._ppmScaleFactor);const x=g.starsProjMatrix,b=s.c3([]);s.c5(b,b,s.al(90)-g._pitch),s.c4(b,b,-g.angle);const E=s.c8(new Float32Array(16),b),C=s.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),M=s.ea([],C),z=s.az([],M,E),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*u,this._prevTime=F,{projectionMatrix:x,modelviewMatrix:z}}}class md extends pd{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new qs(o.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const u=o.context;if(!this.particlesVx){const g=m0(this.particlesCount),x=new s.eC,b=new s.a_;let E=0;const C=s.el(1323123451230);for(let M=0;M<g.length;++M){const z=g[M],F=[2*C()-1,C(),C(),C()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...F),x.emplaceBack(z[0],z[1],z[2],1,-1,...F),x.emplaceBack(z[0],z[1],z[2],1,1,...F),x.emplaceBack(z[0],z[1],z[2],-1,1,...F),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=u.createVertexBuffer(x,iS.members),this.particlesIdx=u.createIndexBuffer(b)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const u=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=o.transform.zoom;if(u.revealStart>g)return;const x=Io(0,1,u.revealStart,u.revealStart+u.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let E=[-b.direction.x,b.direction.y,-100];s.au(E,E);const C=structuredClone(this._vignetteParams);C.strength*=x,b.overrideStyleParameters||(b.intensity=o.style.rain.state.density,b.timeFactor=o.style.rain.state.intensity,b.color=structuredClone(o.style.rain.state.color),E=structuredClone(o.style.rain.state.direction),b.screenThinning.intensity=o.style.rain.state.centerThinning,b.dropletSizeX=o.style.rain.state.dropletSize[0],b.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],b.distortionStrength=100*o.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(o.style.rain.state.vignetteColor));const M=this.updateOnRender(o,b.timeFactor),z=o.context,F=z.gl,H=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new s.T(z,{width:o.width,height:o.height,data:null},F.RGBA8)),b.distortionStrength>0&&(z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const $=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(z,$),z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const K=[b.color.r,b.color.g,b.color.b,b.color.a],te=(ee,re)=>{const ie=Yr(this._movement.getPosition(),ee),ue=b.dropletSizeX,pe=b.dropletSizeX*b.dropletSizeYScale,me=o.width/2,Te=o.height/2,we=Io(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ce=Io(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),be=Io(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Se=(Ee={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:ee,rainDropletSize:[ue,pe],distortionStrength:b.distortionStrength,rainDirection:E,color:K,screenSize:[H.width,H.height],thinningCenterPos:[me,Te],thinningShape:[we,Ce,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:re?0:1},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_texScreen:0,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_boxSize:Ee.boxSize,u_rainDropletSize:Ee.rainDropletSize,u_distortionStrength:Ee.distortionStrength,u_rainDirection:Ee.rainDirection,u_color:Ee.color,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_shapeDirectionalPower:Ee.shapeDirectionalPower,u_shapeNormalPower:Ee.shapeNormalPower,u_mode:Ee.mode});var Ee;const Ue=Math.round(b.intensity*this.particlesCount),De=s.bd.simpleSegment(0,0,4*Ue,2*Ue);$.draw(o,F.TRIANGLES,Wt.disabled,mr.disabled,Or.alphaBlended,ur.disabled,Se,"rain_particles",this.particlesVx,this.particlesIdx,De)};b.distortionStrength>0&&te(b.boxSize,!0),te(b.boxSize,!1),this._vignette.draw(o,C)}}const Yu=s.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class g0 extends pd{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new qs(o.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const u=o.context;if(!this.particlesVx){const g=m0(this.particlesCount),x=new s.eD,b=new s.a_;let E=0;const C=s.el(1323123451230);for(let M=0;M<g.length;++M){const z=g[M],F=C(),H=C(),$=C(),K=[M/g.length,F,H,$],te=[C(),C()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...K,...te),x.emplaceBack(z[0],z[1],z[2],1,-1,...K,...te),x.emplaceBack(z[0],z[1],z[2],1,1,...K,...te),x.emplaceBack(z[0],z[1],z[2],-1,1,...K,...te),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=u.createVertexBuffer(x,Yu.members),this.particlesIdx=u.createIndexBuffer(b)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const u=structuredClone(this._params);let g=[-u.direction.x,u.direction.y,-100];s.au(g,g);const x=structuredClone(this._vignetteParams),b=u.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=o.transform.zoom;if(b.revealStart>E)return;const C=Io(0,1,b.revealStart,b.revealStart+b.revealRange,E);x.strength*=C,u.overrideStyleParameters||(u.intensity=o.style.snow.state.density,u.timeFactor=o.style.snow.state.intensity,u.color=structuredClone(o.style.snow.state.color),g=structuredClone(o.style.snow.state.direction),u.screenThinning.intensity=o.style.snow.state.centerThinning,u.billboardSize=2.79*o.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(o.style.snow.state.vignetteColor));const M=this.updateOnRender(o,u.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=o.context,F=z.gl,H=o.transform,$=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(z,$),((K,te,ee)=>{const re=Yr(this._movement.getPosition(),K),ie=H.width/2,ue=H.height/2,pe=Io(0,ee.screenThinning.start,0,1,ee.screenThinning.intensity),me=Io(.001,ee.screenThinning.range,0,1,ee.screenThinning.intensity),Te=Io(0,ee.screenThinning.particleOffset,0,1,ee.screenThinning.intensity),we=(Ce={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:ee.velocityConeAperture,velocity:ee.velocity,horizontalOscillationRadius:ee.horizontalOscillationRadius,horizontalOscillationRate:ee.horizontalOscillationRate,boxSize:K,billboardSize:1*ee.billboardSize,simpleShapeParameters:[ee.shapeFadeStart,ee.shapeFadePower],screenSize:[H.width,H.height],thinningCenterPos:[ie,ue],thinningShape:[pe,me,Math.pow(10,ee.screenThinning.fadePower)],thinningAffectedRatio:ee.screenThinning.affectedRatio,thinningParticleOffset:Te,color:[ee.color.r,ee.color.g,ee.color.b,ee.color.a],direction:g},{u_modelview:Float32Array.from(Ce.modelview),u_projection:Float32Array.from(Ce.projection),u_time:Ce.time,u_cam_pos:Ce.camPos,u_velocityConeAperture:Ce.velocityConeAperture,u_velocity:Ce.velocity,u_horizontalOscillationRadius:Ce.horizontalOscillationRadius,u_horizontalOscillationRate:Ce.horizontalOscillationRate,u_boxSize:Ce.boxSize,u_billboardSize:Ce.billboardSize,u_simpleShapeParameters:Ce.simpleShapeParameters,u_screenSize:Ce.screenSize,u_thinningCenterPos:Ce.thinningCenterPos,u_thinningShape:Ce.thinningShape,u_thinningAffectedRatio:Ce.thinningAffectedRatio,u_thinningParticleOffset:Ce.thinningParticleOffset,u_particleColor:Ce.color,u_direction:Ce.direction});var Ce;const be=Math.round(ee.intensity*this.particlesCount),Se=s.bd.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&$.draw(o,F.TRIANGLES,Wt.disabled,mr.disabled,Or.alphaBlended,ur.disabled,we,"snow_particles",this.particlesVx,this.particlesIdx,Se)})(u.boxSize,0,u),this._vignette.draw(o,x)}}const y0={symbol:function(m,o,u,g,x){if(m.renderPass!=="translucent")return;const b=mr.disabled,E=m.colorModeForRenderPass(),C=u.layout.get("text-variable-anchor"),M=u.layout.get("text-size-scale-range"),z=s.ay(m.scaleFactor,M[0],M[1]);C&&function($,K,te,ee,re,ie,ue,pe){const me=K.transform,Te=re==="map",we=ie==="map";for(const Ce of $){const be=ee.getTile(Ce),Se=be.getBucket(te);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const Ee=s.bH(Se.textSizeData,me.zoom,pe),Ue=Hm(Ce,Se.getProjection(),me),De=me.calculatePixelsToTileUnitsMatrix(be),dt=Uf(Ue,be.tileID.canonical,we,Te,me,Se.getProjection(),De),Je=Se.hasIconTextFit()&&Se.hasIconData();Ee&&K1(Se,Te,we,ue,me,dt,Ce,Math.pow(2,me.zoom-be.tileID.overscaledZ),Ee,Je)}}(g,m,u,o,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),x,z);const F=u.paint.get("icon-opacity").constantOr(1)!==0,H=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||H)?o0(m,o,u,g,b,E):(F&&o0(m,o,u,g,b,E,{onlyIcons:!0}),H&&o0(m,o,u,g,b,E,{onlyText:!0})),o.map.showCollisionBoxes&&(i0(m,o,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),i0(m,o,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,u,g){if(m.renderPass!=="translucent")return;const x=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),E=u.paint.get("circle-stroke-opacity"),C=u.layout.get("circle-sort-key").constantOr(1)!==void 0,M=u.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;const z=m.context,F=z.gl,H=m.transform,$=!(!m.terrain||!m.terrain.enabled),K=u.layout.get("circle-elevation-reference"),te=m.depthModeForSublayer(0,Wt.ReadOnly),ee=new Wt(m.context.gl.LEQUAL,Wt.ReadOnly,m.depthRangeFor3D),re=K==="none"||$?te:ee,ie=mr.disabled,ue=m.colorModeForDrapableLayerRenderPass(M),pe=H.projection.name==="globe",me=[s.aD(H.center.lng),s.aH(H.center.lat)],Te=[];for(let Ce=0;Ce<g.length;Ce++){const be=g[Ce],Se=o.getTile(be),Ee=Se.getBucket(u);if(!Ee||Ee.projection.name!==H.projection.name)continue;const Ue=Ee.programConfigurations.get(u.id),De=Ee.layoutVertexBuffer,dt=Ee.globeExtVertexBuffer,Je=Ee.indexBuffer,pt=s.dW(u),Pt=[dt],qe=m.isTileAffectedByFog(be);pe&&pt.push("PROJECTION_GLOBE_VIEW"),pt.push("DEPTH_D24"),m.terrain&&H.depthOcclusionForSymbolsAndCircles&&pt.push("DEPTH_OCCLUSION"),Ee.hasElevation&&!m.terrain&&(pt.push("ELEVATED_ROADS"),Pt.push(Ee.elevatedLayoutVertexBuffer));const Re=m.getOrCreateProgram("circle",{config:Ue,defines:pt,overrideFog:qe}),nt=H.projection.createInversionMatrix(H,be.canonical),Ze={programConfiguration:Ue,program:Re,layoutVertexBuffer:De,dynamicBuffers:Pt,indexBuffer:Je,uniformValues:s.dX(m,be,Se,nt,me,u),tile:Se};if(C){const yt=Ee.segments.get();for(const bt of yt)Te.push({segments:new s.bd([bt]),sortKey:bt.sortKey,state:Ze})}else Te.push({segments:Ee.segments,sortKey:0,state:Ze})}C&&Te.sort((Ce,be)=>Ce.sortKey-be.sortKey);const we={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(const Ce of Te){const{programConfiguration:be,program:Se,layoutVertexBuffer:Ee,dynamicBuffers:Ue,indexBuffer:De,uniformValues:dt,tile:Je}=Ce.state,pt=Ce.segments;m.terrain&&m.terrain.setupElevationDraw(Je,Se,we),m.uploadCommonUniforms(z,Se,Je.tileID.toUnwrapped()),Se.draw(m,F.TRIANGLES,re,ie,ue,ur.disabled,dt,u.id,Ee,De,pt,u.paint,H.zoom,be,Ue)}},heatmap:function(m,o,u,g){if(u.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,b=x.gl,E=mr.disabled,C=new Or([b.ONE,b.ONE,b.ONE,b.ONE],s.am.transparent,[!0,!0,!0,!0]);(function(K,te,ee,re){const ie=K.gl,ue=te.width*re,pe=te.height*re;K.activeTexture.set(ie.TEXTURE1),K.viewport.set([0,0,ue,pe]);let me=ee.heatmapFbo;if(!me||me&&(me.width!==ue||me.height!==pe)){me&&me.destroy();const Te=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,Te),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),me=ee.heatmapFbo=K.createFramebuffer(ue,pe,!0,null),function(we,Ce,be,Se,Ee,Ue){const De=we.gl;De.texImage2D(De.TEXTURE_2D,0,we.extRenderToTextureHalfFloat?De.RGBA16F:De.RGBA,Ee,Ue,0,De.RGBA,we.extRenderToTextureHalfFloat?De.HALF_FLOAT:De.UNSIGNED_BYTE,null),Se.colorAttachment.set(be)}(K,0,Te,me,ue,pe)}else ie.bindTexture(ie.TEXTURE_2D,me.colorAttachment.get()),K.bindFramebuffer.set(me.framebuffer)})(x,m,u,m.transform.projection.name==="globe"?.5:.25),x.clear({color:s.am.transparent});const M=m.transform,z=M.projection.name==="globe",F=z?["PROJECTION_GLOBE_VIEW"]:[],H=z?ur.frontCCW:ur.disabled,$=[s.aD(M.center.lng),s.aH(M.center.lat)];for(let K=0;K<g.length;K++){const te=g[K];if(o.hasRenderableParent(te))continue;const ee=o.getTile(te),re=ee.getBucket(u);if(!re||re.projection.name!==M.projection.name)continue;const ie=m.isTileAffectedByFog(te),ue=re.programConfigurations.get(u.id),pe=m.getOrCreateProgram("heatmap",{config:ue,defines:F,overrideFog:ie}),{zoom:me}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ee,pe),m.uploadCommonUniforms(x,pe,te.toUnwrapped());const Te=M.projection.createInversionMatrix(M,te.canonical);pe.draw(m,b.TRIANGLES,Wt.disabled,E,C,H,$1(m,te,ee,Te,$,me,u.paint.get("heatmap-intensity")),u.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,u.paint,m.transform.zoom,ue,z?[re.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,b){const E=x.context,C=E.gl,M=b.heatmapFbo;if(!M)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let z=b.colorRampTexture;z||(z=b.colorRampTexture=new s.T(E,b.colorRamp,C.RGBA8)),z.bind(C.LINEAR,C.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,C.TRIANGLES,Wt.disabled,mr.disabled,x.colorModeForRenderPass(),ur.disabled,((F,H,$,K)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(m,u))},line:function(m,o,u,g){if(m.renderPass!=="translucent")return;const x=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const E=u.paint.get("line-emissive-strength"),C=u.paint.get("line-occlusion-opacity"),M=u.layout.get("line-elevation-reference"),z=u.layout.get("line-width-unit")==="meters",F=M==="sea",H=!(!m.terrain||!m.terrain.enabled),$=m.context,K=$.gl;if(u.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const te=u.layout.get("line-cross-slope"),ee=te!==void 0,re=te<1,ie=m.colorModeForDrapableLayerRenderPass(E),ue=m.terrain&&m.terrain.renderingToTexture,pe=ue?1:s.q.devicePixelRatio,me=u.paint.get("line-dasharray"),Te=me.constantOr(1),we=u.layout.get("line-cap"),Ce=me.constantOr(null),be=we.constantOr(null),Se=u.paint.get("line-pattern"),Ee=Se.constantOr(1),Ue=u.paint.get("line-pattern-cross-fade"),De=Se.constantOr(null),dt=u.paint.get("line-opacity").constantOr(1);let Je=!Ee&&dt!==1||m.depthOcclusion&&C>0&&C<1;const pt=u.paint.get("line-gradient"),Pt=Ee?"linePattern":"line",qe=s.dY(u);let Re;if(ue&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Je=!1),C!==0&&m.depthOcclusion){const bt=u.paint._values["line-opacity"];bt&&bt.value&&bt.value.kind==="constant"?Re=bt.value:s.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&qe.push("VARIABLE_LINE_WIDTH");const nt=(bt,Et,jt,tr,ir,Zt)=>{for(const er of bt){const nr=o.getTile(er);if(Ee&&!nr.patternsLoaded())continue;const wr=nr.getBucket(u);if(!wr||wr.elevationType!=="none"&&!ir||wr.elevationType==="none"&&ir)continue;m.prepareDrawTile();const Pr=[...Et],Nr=m.shadowRenderer,Pn=wr.elevationType==="road"&&!!Nr&&Nr.enabled;let vr=[0,0,0];if(Pn){const rn=m.style.directionalLight,xn=m.style.ambientLight;rn&&xn&&(vr=Uu(m.style,rn,xn)),Pr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const un=wr.programConfigurations.get(u.id);let hn=!1;if(De&&nr.imageAtlas){const rn=s.dZ.from(De),xn=rn.getPrimary().scaleSelf(pe).toString(),Ln=nr.imageAtlas.patternPositions.get(xn),Ei=rn.getSecondary(),Oi=Ei?nr.imageAtlas.patternPositions.get(Ei.scaleSelf(pe).toString()):null;hn=!!Ln&&!!Oi,Ln&&un.setConstantPatternPositions(Ln,Oi)}Ue>0&&(hn||un.getPatternTransitionVertexBuffer("line-pattern"))&&Pr.push("LINE_PATTERN_TRANSITION");const Zn=m.isTileAffectedByFog(er),Ir=m.getOrCreateProgram(Pt,{config:un,defines:Pr,overrideFog:Zn});if(!Ee&&Ce&&be&&nr.lineAtlas){const rn=nr.lineAtlas.getDash(Ce,be);rn&&un.setConstantPatternPositions(rn)}Pn&&Nr.setupShadows(nr.tileID.toUnwrapped(),Ir,"vector-tile");let[on,cn]=u.paint.get("line-trim-offset");(be==="round"||be==="square")&&on!==cn&&(on===0&&(on-=1),cn===1&&(cn+=1));const vn=ue?er.projMatrix:null,hi=z?1/wr.tileToMeter/s.aw(nr,1,m.transform.zoom):1,kr=z?1/wr.tileToMeter/s.aw(nr,1,Math.floor(m.transform.zoom)):1,mn=Ee?s.d_(m,nr,u,vn,pe,hi,kr,[on,cn],vr,Ue):s.d$(m,nr,u,vn,wr.lineClipsArray.length,pe,hi,kr,[on,cn],vr);if(pt){const rn=wr.gradients[u.id];let xn=rn.texture;if(u.gradientVersion!==rn.version){let Ln=256;if(u.stepInterpolant){const Ei=o.getSource().maxzoom,Oi=er.canonical.z===Ei?Math.ceil(1<<m.transform.maxZoom-er.canonical.z):1;Ln=s.ay(s.e0(wr.maxLineLength/s.aj*1024*Oi),256,$.maxTextureSize)}rn.gradient=s.e1({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Ln,image:rn.gradient||void 0,clips:wr.lineClipsArray}),rn.texture?rn.texture.update(rn.gradient):rn.texture=new s.T($,rn.gradient,K.RGBA8),rn.version=u.gradientVersion,xn=rn.texture}$.activeTexture.set(K.TEXTURE1),xn.bind(u.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}Te&&($.activeTexture.set(K.TEXTURE0),nr.lineAtlasTexture&&nr.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),un.updatePaintBuffers()),Ee&&($.activeTexture.set(K.TEXTURE0),nr.imageAtlasTexture&&nr.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),un.updatePaintBuffers()),ir&&!F&&m.terrain.setupElevationDraw(nr,Ir),m.uploadCommonUniforms($,Ir,er.toUnwrapped());const mi=rn=>{Re!=null&&(Re.value=dt*C),Ir.draw(m,K.TRIANGLES,jt,rn,ie,ur.disabled,mn,u.id,wr.layoutVertexBuffer,wr.indexBuffer,wr.segments,u.paint,m.transform.zoom,un,[wr.layoutVertexBuffer2,wr.patternVertexBuffer,wr.zOffsetVertexBuffer]),Re!=null&&(Re.value=dt)};if(Je&&!ir){const rn=m.stencilModeForClipping(er).ref;rn===0&&ue&&$.clear({stencil:0});const xn={func:K.EQUAL,mask:255};mn.u_alpha_discard_threshold=.8,mi(new mr(xn,rn,255,K.KEEP,K.KEEP,K.INVERT)),mn.u_alpha_discard_threshold=0,mi(new mr(xn,rn,255,K.KEEP,K.KEEP,K.KEEP))}else mn.u_alpha_discard_threshold=Je&&ir&&Zt?.8:0,mi(ir?tr:m.stencilModeForClipping(er))}};let Ze=m.depthModeForSublayer(0,Wt.ReadOnly);const yt=new Wt(m.depthOcclusion?K.GREATER:K.LEQUAL,Wt.ReadOnly,m.depthRangeFor3D);if(u.hasNonElevatedBuckets){const bt=!ue&&m.terrain;C!==0&&bt?s.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has line-z-offset enabled.`):bt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${u.id}.`):nt(g,qe,Ze,mr.disabled,!1,!0)}if(u.hasElevatedBuckets){M==="hd-road-markup"?H||(Ze=yt,qe.push("ELEVATED_ROADS")):(qe.push("ELEVATED"),Ze=yt,ee&&qe.push(re?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&qe.push("ELEVATION_REFERENCE_SEA"));const bt=Je?m.stencilModeFor3D():mr.disabled;m.forceTerrainMode=!0,nt(g,qe,Ze,bt,!0,!0),Je&&nt(g,qe,Ze,bt,!0,!1),m.forceTerrainMode=!1}Je&&(m.resetStencilClippingMasks(),ue&&$.clear({stencil:0})),C===0||m.depthOcclusion||ue||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,o,u,g){const x=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const E=u.paint.get("fill-emissive-strength"),C=m.colorModeForDrapableLayerRenderPass(E),M=u.paint.get("fill-pattern"),z=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&x.constantOr(s.am.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let F="none";u.layout.get("fill-elevation-reference")!=="none"?F="road":u.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const H=!(!m.terrain||!m.terrain.enabled),$={painter:m,sourceCache:o,layer:u,coords:g,colorMode:C,elevationType:F,terrainEnabled:H,pass:z};if(m.renderPass!=="shadow")if(F!=="offset"){if(Sg($,!1),F==="road"){const K=!H&&m.renderPass==="translucent";K&&qt(m,o,u,g,"geometry"),Sg($,!0,mr.disabled),K&&function(te){const{painter:ee,sourceCache:re,layer:ie,coords:ue,colorMode:pe}=te,me=ee.context.gl,Te=te.painter.shadowRenderer,we=!!Te&&Te.enabled,Ce=new Wt(ee.context.gl.LEQUAL,Wt.ReadOnly,ee.depthRangeFor3D);let be=[0,0,0];if(we){const Ee=ee.style.directionalLight,Ue=ee.style.ambientLight;Ee&&Ue&&(be=Uu(ee.style,Ee,Ue))}const Se=Ee=>{for(const Ue of ue){const De=re.getTile(Ue),dt=De.getBucket(ie);if(!dt)continue;const Je=dt.elevatedStructures;if(!Je)continue;let pt,Pt;if(Ee?(pt=Je.renderableBridgeSegments,Pt=Je.bridgeProgramConfigurations.get(ie.id)):(pt=Je.renderableTunnelSegments,Pt=Je.tunnelProgramConfigurations.get(ie.id)),!pt||pt.segments[0].primitiveLength===0)continue;Pt.updatePaintBuffers(),ee.prepareDrawTile();const qe=ee.isTileAffectedByFog(Ue),Re=[];we&&Re.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const nt=ee.getOrCreateProgram("elevatedStructures",{config:Pt,overrideFog:qe,defines:Re}),Ze=ee.translatePosMatrix(Ue.projMatrix,De,ie.paint.get("fill-translate"),ie.paint.get("fill-translate-anchor"));we&&Te.setupShadows(De.tileID.toUnwrapped(),nt,"vector-tile");const yt=BP(Ze,be);ee.uploadCommonUniforms(ee.context,nt,Ue.toUnwrapped()),nt.draw(ee,me.TRIANGLES,Ce,mr.disabled,pe,ur.backCCW,yt,ie.id,Je.vertexBuffer,Je.indexBuffer,pt,ie.paint,ee.transform.zoom,Pt,[Je.vertexBufferNormal])}};Se(!0),Se(!1)}($)}}else Sg($,!1,m.stencilModeFor3D());else m.shadowRenderer&&F==="road"&&!H&&function(K){const{painter:te,sourceCache:ee,layer:re,coords:ie}=K,ue=te.context.gl,pe=K.painter.shadowRenderer;for(const me of ie){const Te=ee.getTile(me),we=Te.getBucket(re);if(!we)continue;const Ce=we.elevatedStructures;if(!Ce||!Ce.shadowCasterSegments||Ce.shadowCasterSegments.segments[0].primitiveLength===0)continue;te.prepareDrawTile();const be=we.bufferData.programConfigurations.get(re.id),Se=te.isTileAffectedByFog(me),Ee=te.getOrCreateProgram("elevatedStructuresDepth",{config:be,overrideFog:Se}),Ue=pe.calculateShadowPassMatrixFromTile(Te.tileID.toUnwrapped());te.uploadCommonUniforms(te.context,Ee,me.toUnwrapped());const De={u_matrix:Ue,u_depth_bias:0};Ee.draw(te,ue.TRIANGLES,pe.getShadowPassDepthMode(),mr.disabled,pe.getShadowPassColorMode(),ur.disabled,De,re.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.shadowCasterSegments,re.paint,te.transform.zoom,be)}}($)},"fill-extrusion":function(m,o,u,g){const x=u.paint.get("fill-extrusion-opacity"),b=m.context,E=b.gl,C=m.terrain,M=C&&C.renderingToTexture;if(x===0)return;const z=m.conflationActive&&m.style.isLayerClipped(u,o.getSource()),F=m.style.order.indexOf(u.fqid);if(z&&function(H,$,K,te,ee){for(const re of te){const ie=$.getTile(re).getBucket(K);ie&&(ie.updateReplacement(re,H.replacementSource,ee),ie.uploadCentroid(H.context))}}(m,o,u,g,F),C||z)for(const H of g){const $=o.getTile(H).getBucket(u);$&&hr(m.context,o,H,$,u,C,z)}if(m.renderPass==="shadow"&&m.shadowRenderer){const H=m.shadowRenderer;if(C&&x<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const $=H.getShadowPassDepthMode(),K=H.getShadowPassColorMode();op(m,o,u,g,$,mr.disabled,K,z)}else if(m.renderPass==="translucent"){const H=!u.paint.get("fill-extrusion-pattern").constantOr(1),$=u.paint.get("fill-extrusion-color").constantOr(s.am.white);if(!M&&$.a!==0){const K=new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D);x===1&&H?op(m,o,u,g,K,mr.disabled,Or.unblended,z):(op(m,o,u,g,K,mr.disabled,Or.disabled,z),op(m,o,u,g,K,m.stencilModeFor3D(),m.colorModeForRenderPass(),z),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&H&&(!C&&m.transform.projection.name!=="globe"||M)){const K=u.paint.get("fill-extrusion-opacity"),te=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),ee=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=u.paint.get("fill-extrusion-flood-light-intensity"),ie=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ue=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ie?null:u.lut).toArray01().slice(0,3),pe=te>0&&ee>0,me=re>0,Te=(be,Se,Ee)=>(1-Ee)*be+Ee*Se,we=new Xl;we.translate=u.paint.get("fill-extrusion-translate"),we.translateAnchor=u.paint.get("fill-extrusion-translate-anchor"),we.edgeRadius=u.layout.get("fill-extrusion-edge-radius"),we.cutoffFadeRange=u.paint.get("fill-extrusion-cutoff-fade-range");const Ce=be=>{const Se=m.depthModeForSublayer(1,Wt.ReadOnly,E.LEQUAL,!0),Ee=u.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ue=Te(.1,3,Ee),De=m._showOverdrawInspector;if(!De){const dt=new mr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Je=new Or([E.ONE,E.ONE,E.ONE,E.ONE],s.am.transparent,[!1,!1,!1,!0],E.MIN);Co(we,m,o,u,g,Se,dt,Je,ur.disabled,be,"sdf",K,te,ee,re,ue,Ue,z,!1)}{const dt=De?mr.disabled:new mr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Je=De?m.colorModeForRenderPass():new Or([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],s.am.transparent,[!0,!0,!0,!0]);Co(we,m,o,u,g,Se,dt,Je,ur.disabled,be,"color",K,te,ee,re,ue,Ue,z,!1)}};if(M){const be=(Se,Ee,Ue)=>{const De=m.depthModeForSublayer(1,Wt.ReadOnly,E.LEQUAL,!1),dt=u.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Je=Te(.1,3,dt);{const pt=new Or([E.ONE,E.ONE,E.ONE,E.ONE],s.am.transparent,[!1,!1,!1,!0]);Co(we,m,o,u,g,De,mr.disabled,pt,ur.disabled,Se,"clear",K,te,ee,re,ue,Je,z,Ee)}{const pt=new mr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Pt=new Or([E.ONE,E.ONE,E.ONE,E.ONE],s.am.transparent,[!1,!1,!1,!0],E.MIN);Co(we,m,o,u,g,De,pt,Pt,ur.disabled,Se,"sdf",K,te,ee,re,ue,Je,z,Ee)}{const pt=Se?E.ZERO:E.ONE_MINUS_DST_ALPHA,Pt=new mr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),qe=new Or([pt,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],s.am.transparent,[!0,!0,!0,!0]);Co(we,m,o,u,g,De,Pt,qe,ur.disabled,Se,"color",K,te,ee,re,ue,Je,z,Ee)}{const pt=new Or([E.ONE,E.ONE,E.ONE,Se?E.ZERO:E.ONE],s.am.transparent,[!1,!1,!1,!0],Se?E.FUNC_ADD:E.MAX);Co(we,m,o,u,g,De,mr.disabled,pt,ur.disabled,Se,"clear",K,te,ee,re,ue,Je,z,Ee,Ue)}};if(pe||me){let Se;if(m.prepareDrawTile(),C){const Ee=C.drapeBufferSize[0],Ue=C.drapeBufferSize[1];Se=C.framebufferCopyTexture,Se&&(!Se||Se.size[0]===Ee&&Se.size[1]===Ue)||(Se&&Se.destroy(),Se=C.framebufferCopyTexture=new s.T(b,new s.r({width:Ee,height:Ue}),E.RGBA8)),Se.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,Ee,Ue)}pe&&be(!0,!1,Se),me&&be(!1,!0,Se)}}else pe&&Ce(!0),me&&Ce(!1),(pe||me)&&m.resetStencilClippingMasks()}}},building:function(m,o,u,g){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const x=u.paint.get("building-ambient-occlusion-ground-intensity"),b=u.paint.get("building-ambient-occlusion-ground-radius"),E=u.paint.get("building-ambient-occlusion-ground-attenuation");let C=x>0&&b>0,M=!0;const z=u.paint.get("building-vertical-scale");z<1&&(M=!1);const F=m.conflationActive&&m.style.isLayerClipped(u,o.getSource()),H=m.style.order.indexOf(u.fqid);if(function($,K,te,ee,re,ie){for(const ue of ie){const pe=K.getTile(ue).getBucket(te);pe&&(re&&pe.updateReplacement(ue,$.replacementSource,ee),pe.uploadUpdatedIndexBuffer($.context))}}(m,o,u,H,F,g),function($,K,te,ee){for(const re of ee){const ie=K.getTile(re).getBucket(te);ie&&ie.needsEvaluation($,te)&&(ie.evaluate(te),ie.uploadUpdatedColorBuffer($.context))}}(m,o,u,g),u.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const $=m.shadowRenderer,K=[],te=$.getShadowPassDepthMode();Eg({painter:m,source:o,layer:u,coords:g,defines:K,blendMode:$.getShadowPassColorMode(),depthMode:te,verticalScale:z})}else if(m.renderPass==="translucent"){C&&function(ee,re,ie,ue,pe,me,Te,we,Ce,be,Se,Ee,Ue){const De=ee.context.gl,dt=ee.depthModeForSublayer(1,Wt.ReadOnly,De.LEQUAL,!0),Je=.1*(1-(pt=Se))+3*pt;var pt;const Pt=ee._showOverdrawInspector,qe=Ee,Re=new Xl;Pt||Co(Re,ee,re,ie,ue,dt,new mr({func:De.ALWAYS,mask:255},255,255,De.KEEP,De.KEEP,De.REPLACE),new Or([De.ONE,De.ONE,De.ONE,De.ONE],s.am.transparent,[!1,!1,!1,!0],De.MIN),ur.disabled,pe,"sdf",1,Te,we,0,be,Je,qe,!1);{const nt=Pt?mr.disabled:new mr({func:De.EQUAL,mask:255},255,255,De.KEEP,De.DECR,De.DECR),Ze=Pt?ee.colorModeForRenderPass():new Or([De.ONE_MINUS_DST_ALPHA,De.DST_ALPHA,De.ONE,De.ONE],s.am.transparent,[!0,!0,!0,!0]);Co(Re,ee,re,ie,ue,dt,nt,Ze,ur.disabled,pe,"color",1,Te,we,0,be,Je,qe,!1)}}(m,o,u,g,!0,0,x,b,0,[0,0,0],E,F);let $=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];M&&($=$.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer.useNormalOffset&&($=$.concat("NORMAL_OFFSET"));const K=new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),te=m.colorModeForRenderPass();Eg({painter:m,source:o,layer:u,coords:g,defines:$,blendMode:te,depthMode:K,verticalScale:z})}else if(m.renderPass==="light-beam"){const $=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],K=new Wt(m.context.gl.LEQUAL,Wt.ReadOnly,m.depthRangeFor3D);Eg({painter:m,source:o,layer:u,coords:g,defines:$,blendMode:Or.alphaBlended,depthMode:K,verticalScale:z})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,o,u,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const x=m.context,b=m.terrain&&m.terrain.renderingToTexture,[E,C]=m.renderPass!=="translucent"||b?[{},g]:m.stencilConfigForOverlap(g);for(const M of C){const z=o.getTile(M);if(z.needsHillshadePrepare&&m.renderPass==="offscreen")k1(m,z,u);else if(m.renderPass==="translucent"){const F=m.depthModeForSublayer(0,Wt.ReadOnly),H=u.paint.get("hillshade-emissive-strength"),$=m.colorModeForDrapableLayerRenderPass(H),K=b&&m.terrain?m.terrain.stencilModeForRTTOverlap(M):E[M.overscaledZ];IP(m,M,z,u,F,K,$)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,o,u,g,x,b){if(m.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const E=m.transform.projection.name==="globe",C=u.paint.get("raster-elevation")!==0,M=C&&E;if(m.renderElevatedRasterBackface&&!M)return;const z=m.context,F=z.gl,H=o.getSource(),$=function(we,Ce,be,Se){const Ee=Ce.paint.get("raster-color"),Ue=we.type==="raster-array",De=[],dt=Ce.paint.get("raster-resampling"),Je=Ce.paint.get("raster-color-mix");let pt=Ce.paint.get("raster-color-range");const Pt=[Je[0],Je[1],Je[2],0],qe=Je[3];let Re=dt==="nearest"?Se.NEAREST:Se.LINEAR;if(Ue&&(De.push("RASTER_ARRAY"),Ee||De.push("RASTER_COLOR"),dt==="linear"&&De.push("RASTER_ARRAY_LINEAR"),Re=Se.NEAREST,!pt&&we.rasterLayers)){const nt=we.rasterLayers.find(({id:Ze})=>Ze===Ce.sourceLayer);nt&&nt.fields&&nt.fields.range&&(pt=nt.fields.range)}if(pt=pt||[0,1],Ee){De.push("RASTER_COLOR"),be.activeTexture.set(Se.TEXTURE2),Ce.updateColorRamp(pt);let nt=Ce.colorRampTexture;nt||(nt=Ce.colorRampTexture=new s.T(be,Ce.colorRamp,Se.RGBA8)),nt.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}return{mix:Pt,range:pt,offset:qe,defines:De,resampling:Re}}(H,u,z,F);if(H instanceof s.aP&&!g.length&&!E)return;const K=u.paint.get("raster-emissive-strength"),te=m.colorModeForDrapableLayerRenderPass(K),ee=m.terrain&&m.terrain.renderingToTexture,re=!m.options.moving,ie=u.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(H instanceof s.aP&&!g.length&&(H.onNorthPole||H.onSouthPole)){const we=C?m.stencilModeFor3D():mr.disabled;return void Ag(!!H.onNorthPole,null,m,o,u,K,$,ur.disabled,we)}if(!g.length)return;const[ue,pe]=H instanceof s.aP||ee?[{},g]:m.stencilConfigForOverlap(g),me=pe[pe.length-1].overscaledZ;M&&$.defines.push("PROJECTION_GLOBE_VIEW"),C&&$.defines.push("RENDER_CUTOFF");const Te=(we,Ce,be)=>{for(const Se of we){const Ee=Se.toUnwrapped(),Ue=o.getTile(Se);if(ee&&(!Ue||!Ue.hasData()))continue;z.activeTexture.set(F.TEXTURE0);const De=GP(Ue,H,u,$);if(!De||!De.texture)continue;const{texture:dt,mix:Je,offset:pt,tileSize:Pt,buffer:qe}=De;let Re,nt;ee?(Re=Wt.disabled,nt=Se.projMatrix):C?(Re=new Wt(F.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),nt=E?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Ee,re)):(Re=m.depthModeForSublayer(Se.overscaledZ-me,u.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,F.LESS),nt=m.transform.calculateProjMatrix(Ee,re));const Ze=m.terrain&&ee?m.terrain.stencilModeForRTTOverlap(Se):ue[Se.overscaledZ],yt=b?0:u.paint.get("raster-fade-duration");Ue.registerFadeDuration(yt);const bt=o.findLoadedParent(Se,0),Et=Po(Ue,bt,o,m.transform,yt);let jt,tr;m.terrain&&m.terrain.prepareDrawTile(),z.activeTexture.set(F.TEXTURE0),dt.bind(ie,F.CLAMP_TO_EDGE),z.activeTexture.set(F.TEXTURE1),bt?(bt.texture&&bt.texture.bind(ie,F.CLAMP_TO_EDGE),jt=Math.pow(2,bt.tileID.overscaledZ-Ue.tileID.overscaledZ),tr=[Ue.tileID.canonical.x*jt%1,Ue.tileID.canonical.y*jt%1]):dt.bind(ie,F.CLAMP_TO_EDGE),"useMipmap"in dt&&z.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const ir=m.transform;let Zt;const er=C?$P(ir):[0,0,0,0];let nr,wr,Pr,Nr,Pn,vr=0;if(M&&H instanceof s.aP&&H.coordinates.length>3)nr=Float32Array.from(s.bh(s.dD(new s.cA(0,0,0)))),wr=Float32Array.from(ir.globeMatrix),Pr=Float32Array.from(s.dz(ir)),Nr=[s.aD(ir.center.lng),s.aH(ir.center.lat)],Zt=H.elevatedGlobePerspectiveTransform,Pn=H.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){const Ir=s.dA(Se.canonical);vr=s.dB(Ir.getCenter().lat),nr=Float32Array.from(s.bh(s.dD(Se.canonical))),wr=Float32Array.from(ir.globeMatrix),Pr=Float32Array.from(s.dz(ir)),Nr=[s.aD(ir.center.lng),s.aH(ir.center.lat)],Zt=[0,0],Pn=Float32Array.from(s.dC(Se.canonical,Ir,vr,ir.worldSize/ir._pixelsPerMercatorPixel))}else Zt=H instanceof s.aP?H.perspectiveTransform:[0,0],nr=new Float32Array(16),wr=new Float32Array(9),Pr=new Float32Array(16),Nr=[0,0],Pn=new Float32Array(9);const un=Qv(nt,nr,wr,Pr,Pn,tr||[0,0],s.ah(m.transform.zoom),Nr,er,jt||1,Et,u,Zt,C?u.paint.get("raster-elevation"):0,2,Je,pt,$.range,Pt,qe,K),hn=m.isTileAffectedByFog(Se),Zn=m.getOrCreateProgram("raster",{defines:$.defines,overrideFog:hn});if(m.uploadCommonUniforms(z,Zn,Ee),H instanceof s.aP){const Ir=H.elevatedGlobeVertexBuffer,on=H.elevatedGlobeIndexBuffer;if(ee||!E)H.boundsBuffer&&H.boundsSegments&&Zn.draw(m,F.TRIANGLES,Re,mr.disabled,te,ur.disabled,un,u.id,H.boundsBuffer,m.quadTriangleIndexBuffer,H.boundsSegments);else if(Ir&&on){const cn=ir.zoom<=s.cX?H.elevatedGlobeSegments:H.getSegmentsForLongitude(ir.center.lng);cn&&Zn.draw(m,F.TRIANGLES,Re,mr.disabled,te,Ce,un,u.id,Ir,on,cn)}}else if(M){Re=new Wt(F.LEQUAL,Wt.ReadOnly,m.depthRangeFor3D);const Ir=m.globeSharedBuffers;if(Ir){const[on,cn,vn]=Ir.getGridBuffers(vr,!1);Zn.draw(m,F.TRIANGLES,Re,be||Ze,m.colorModeForRenderPass(),Ce,un,u.id,on,cn,vn)}}else{const{tileBoundsBuffer:Ir,tileBoundsIndexBuffer:on,tileBoundsSegments:cn}=m.getTileBoundsBuffers(Ue);Zn.draw(m,F.TRIANGLES,Re,Ze,te,ur.disabled,un,u.id,Ir,on,cn)}}if(!(H instanceof s.aP)&&M)for(const Se of we){const Ee=Se.canonical.y===(1<<Se.canonical.z)-1;Se.canonical.y===0&&Ag(!0,Se,m,o,u,K,$,Ce,be||mr.disabled),Ee&&Ag(!1,Se,m,o,u,K,$,Ce===ur.frontCW?ur.backCW:ur.frontCW,be||mr.disabled)}};M?Te(pe,m.renderElevatedRasterBackface?ur.backCW:ur.frontCW,m.stencilModeFor3D()):Te(pe,ur.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,o,u,g,x,b){m.renderPass==="offscreen"&&function(E,C,M,z){if(!z.length)return;const F=E.context,H=F.gl,$=C.getSource();if(!($ instanceof Oc))return;const K=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count")));let te=M.particlePositionRGBAImage;if(!te||te.width!==K){const pe=function(me){const Te=me*me,we=new Uint8Array(4*Te),Ce=function(Se){return Se|=0,Se=Math.imul(2747636419^Se,2654435769),Se=Math.imul(Se^Se>>>16,2654435769),((Se=Math.imul(Se^Se>>>16,2654435769))>>>0)/4294967296},be=1/1.1;for(let Se=0;Se<Te;Se++){const Ee=be*(Ce(2*Se+0)+Gc),Ue=be*(Ce(2*Se+1)+Gc),De=255*Ee%1,dt=255*Ue%1,Je=De,pt=Ue-dt/255,Pt=dt;we[4*Se+0]=255*(Ee-De/255),we[4*Se+1]=255*Je,we[4*Se+2]=255*pt,we[4*Se+3]=255*Pt}return we}(K);te=M.particlePositionRGBAImage=new s.r({width:K,height:K},pe)}let ee=M.particleFramebuffer;ee?ee.width!==K&&(ee.destroy(),ee=M.particleFramebuffer=F.createFramebuffer(K,K,!0,null)):ee=M.particleFramebuffer=F.createFramebuffer(K,K,!0,null);const re=[];for(const pe of z){const me=C.getTile(pe);if(!(me instanceof $h))continue;const Te=uo(me,$,M);if(!Te)continue;const we=[me.tileSize,me.tileSize];let Ce=M.tileFramebuffer;Ce||(Ce=M.tileFramebuffer=F.createFramebuffer(we[0],we[1],!0,null));let be=me.rasterParticleState;be||(be=me.rasterParticleState=new l0(F,pe,we,te));const Se=be.update(M.lastInvalidatedAt);be.particleTextureDimension!==K&&be.updateParticleTexture(pe,te);const Ee=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=Ee;const Ue=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=Ue,re.push([pe,Te,be,Se])}if(re.length===0)return;const ie=s.q.now(),ue=M.previousDrawTimestamp?.001*(ie-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=ie,M.hasColorMap()){F.activeTexture.set(H.TEXTURE0+2);let pe=M.colorRampTexture;pe||(pe=M.colorRampTexture=new s.T(F,M.colorRamp,H.RGBA8)),pe.bind(H.LINEAR,H.CLAMP_TO_EDGE)}F.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(pe,me,Te){const we=pe.context,Ce=we.gl,be=me.tileFramebuffer;we.activeTexture.set(Ce.TEXTURE0);const Se={u_texture:0,u_opacity:1.05*(Ue=me.paint.get("raster-particle-fade-opacity-factor"))/(Ue+.05)},Ee=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ue;for(const De of Te){const[,,dt,Je]=De;be.colorAttachment.set(dt.targetColorTexture.texture),we.viewport.set([0,0,be.width,be.height]),we.clear({color:s.am.transparent}),Je&&(dt.backgroundColorTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE),Ee.draw(pe,Ce.TRIANGLES,Wt.disabled,mr.disabled,Or.alphaBlended,ur.disabled,Se,me.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(E,M,re),function(pe,me,Te,we){const Ce=pe.context,be=Ce.gl,Se=Te.tileFramebuffer,Ee=pe.transform.projection.name==="globe",Ue=Te.paint.get("raster-particle-max-speed");for(const De of we){const[dt,Je,pt]=De;Ce.activeTexture.set(be.TEXTURE0+0),Je.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Se.colorAttachment.set(pt.targetColorTexture.texture);const Pt=pe.getOrCreateProgram("rasterParticleDraw",{defines:Je.defines,overrideFog:!1});Ce.activeTexture.set(be.TEXTURE0+1);const qe=Je.scalarData?[]:[0,1,2,3].map(Ze=>s.e3[Ze](dt));qe.push(dt);const Re=dt.canonical.x,nt=dt.canonical.y;for(const Ze of qe){const yt=me.getTile(Ee?Ze.wrapped():Ze);if(!yt)continue;const bt=yt.rasterParticleState;if(!bt)continue;const Et=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-dt.wrap),jt=Ze.canonical.y;bt.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const tr=G1(1,bt.particleTexture0.size[0],[Et-Re,jt-nt],0,Je.texture.size,2,Ue,Je.textureOffset,Je.scale,Je.offset);Pt.draw(pe,be.POINTS,Wt.disabled,mr.disabled,Or.alphaBlended,ur.disabled,tr,Te.id,bt.particleIndexBuffer,void 0,bt.particleSegment)}}}(E,C,M,re),F.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(pe,me,Te,we){const Ce=pe.context,be=Ce.gl,Se=me.paint.get("raster-particle-max-speed"),Ee=we*me.paint.get("raster-particle-speed-factor")*.15,Ue=function(dt){return Math.pow(dt,6)}(.01+1*me.paint.get("raster-particle-reset-rate-factor")),De=me.particleFramebuffer;Ce.viewport.set([0,0,De.width,De.height]);for(const dt of Te){const[,Je,pt]=dt;Ce.activeTexture.set(be.TEXTURE0+0),Je.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Ce.activeTexture.set(be.TEXTURE0+1);const Pt=pt.particleTexture0;Pt.bind(be.NEAREST,be.CLAMP_TO_EDGE);const qe=H1(1,Pt.size[0],0,Je.texture.size,Se,Ee,Ue,Je.textureOffset,Je.scale,Je.offset);De.colorAttachment.set(pt.particleTexture1.texture),Ce.clear({color:s.am.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:Je.defines}).draw(pe,be.TRIANGLES,Wt.disabled,mr.disabled,Or.unblended,ur.disabled,qe,me.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(E,M,re,ue)}(m,o,u,g),m.renderPass==="translucent"&&(function(E,C,M,z,F){const H=E.context,$=H.gl,K=C.getSource().tileSize,te=5*(1-s.af(s.cI,s.cI+1,E.transform.zoom))*K+M.paint.get("raster-particle-elevation"),ee=!E.options.moving,re=E.transform.projection.name==="globe";if(!z.length)return;const[ie,ue]=E.stencilConfigForOverlap(z),pe=[];re&&pe.push("PROJECTION_GLOBE_VIEW");const me=E.stencilModeFor3D();for(const Te of ue){const we=Te.toUnwrapped(),Ce=C.getTile(Te);if(!Ce.rasterParticleState)continue;const be=Ce.rasterParticleState,Se=100;Ce.registerFadeDuration(Se);const Ee=C.findLoadedParent(Te,0),Ue=Po(Ce,Ee,C,E.transform,Se);let De,dt;E.terrain&&E.terrain.prepareDrawTile(),H.activeTexture.set($.TEXTURE0),be.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),H.activeTexture.set($.TEXTURE1),Ee&&Ee.rasterParticleState?(Ee.rasterParticleState.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),De=Math.pow(2,Ee.tileID.overscaledZ-Ce.tileID.overscaledZ),dt=[Ce.tileID.canonical.x*De%1,Ce.tileID.canonical.y*De%1]):be.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const Je=re?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(we,ee),pt=E.transform,Pt=Zc(pt),qe=s.dA(Te.canonical),Re=s.dB(qe.getCenter().lat);let nt,Ze,yt,bt,Et;re?(nt=Float32Array.from(s.bh(s.dD(Te.canonical))),Ze=Float32Array.from(pt.globeMatrix),yt=Float32Array.from(s.dz(pt)),bt=[s.aD(pt.center.lng),s.aH(pt.center.lat)],Et=Float32Array.from(s.dC(Te.canonical,qe,Re,pt.worldSize/pt._pixelsPerMercatorPixel))):(nt=new Float32Array(16),Ze=new Float32Array(9),yt=new Float32Array(16),bt=[0,0],Et=new Float32Array(9));const jt=vg(Je,nt,Ze,yt,Et,dt||[0,0],s.ah(E.transform.zoom),bt,Pt,De||1,Ue,te),tr=E.isTileAffectedByFog(Te),ir=E.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:tr});if(E.uploadCommonUniforms(H,ir,we),re){const Zt=new Wt($.LEQUAL,Wt.ReadOnly,E.depthRangeFor3D),er=0,nr=E.globeSharedBuffers;if(nr){const[wr,Pr,Nr]=nr.getGridBuffers(Re,er!==0);ir.draw(E,$.TRIANGLES,Zt,me,Or.alphaBlended,E.renderElevatedRasterBackface?ur.frontCCW:ur.backCCW,jt,M.id,wr,Pr,Nr)}}else{const Zt=E.depthModeForSublayer(0,Wt.ReadOnly),er=ie[Te.overscaledZ],{tileBoundsBuffer:nr,tileBoundsIndexBuffer:wr,tileBoundsSegments:Pr}=E.getTileBoundsBuffers(Ce);ir.draw(E,$.TRIANGLES,Zt,er,Or.alphaBlended,ur.disabled,jt,M.id,nr,wr,Pr)}}E.resetStencilClippingMasks()}(m,o,u,g),m.style.map.triggerRepaint())},background:function(m,o,u,g){const x=u.paint.get("background-color"),b=u.paint.get("background-color-use-theme").constantOr("default")==="none",E=u.paint.get("background-opacity"),C=u.paint.get("background-emissive-strength"),M=u.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const z=m.context,F=z.gl,H=m.transform,$=H.tileSize,K=u.paint.get("background-pattern");let te;if(K!==void 0&&(K===null||(te=m.imageManager.getPattern(s.I.from(K.toString()),u.scope,m.style.getLut(u.scope)),!te)))return;const ee=!K&&x.a===1&&E===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ee)return;const re=mr.disabled,ie=m.depthModeForSublayer(0,ee==="opaque"?Wt.ReadWrite:Wt.ReadOnly),ue=m.colorModeForDrapableLayerRenderPass(C),pe=K?"backgroundPattern":"background";let me,Te=g;if(Te||(me=m.getBackgroundTiles(),Te=Object.values(me).map(we=>we.tileID)),K&&(z.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context,u.scope)),M){const we=m.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),Ce=new Float32Array(s.bx([])),be=new s.aM(0,0,0,0,0),Se=K?e0(Ce,C,E,m,0,u.scope,te,M,{tileID:be,tileSize:$}):W1(Ce,C,E,x.toPremultipliedRenderColor(b?null:u.lut));we.draw(m,F.TRIANGLES,ie,re,ue,ur.disabled,Se,u.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const we of Te){const Ce=m.isTileAffectedByFog(we),be=m.getOrCreateProgram(pe,{overrideFog:Ce}),Se=we.toUnwrapped(),Ee=g?we.projMatrix:m.transform.calculateProjMatrix(Se);m.prepareDrawTile();const Ue=o?o.getTile(we):me?me[we.key]:new Du(we,$,H.zoom,m),De=K?e0(Ee,C,E,m,0,u.scope,te,M,{tileID:we,tileSize:$}):W1(Ee,C,E,x.toPremultipliedRenderColor(b?null:u.lut));m.uploadCommonUniforms(z,be,Se);const{tileBoundsBuffer:dt,tileBoundsIndexBuffer:Je,tileBoundsSegments:pt}=m.getTileBoundsBuffers(Ue);be.draw(m,F.TRIANGLES,ie,re,ue,ur.disabled,De,u.id,dt,Je,pt)}},sky:function(m,o,u){const g=m._atmosphere?s.ah(m.transform.zoom):1,x=u.paint.get("sky-opacity")*g;if(x===0)return;const b=m.context,E=u.paint.get("sky-type"),C=new Wt(b.gl.LEQUAL,Wt.ReadOnly,[0,1]),M=m.frameCounter/1e3%1;E==="atmosphere"?m.renderPass==="offscreen"?u.needsSkyboxCapture(m)&&(function(z,F,H,$){const K=z.context,te=K.gl;let ee=F.skyboxFbo;if(!ee){ee=F.skyboxFbo=K.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Xu(K),F.skyboxTexture=K.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,F.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let pe=0;pe<6;++pe)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(ee.framebuffer),K.viewport.set([0,0,32,32]);const re=F.getCenter(z,!0),ie=z.getOrCreateProgram("skyboxCapture"),ue=new Float64Array(16);s.bx(ue),s.eh(ue,ue,.5*-Math.PI),rl(z,F,ie,ue,re,0),s.bx(ue),s.eh(ue,ue,.5*Math.PI),rl(z,F,ie,ue,re,1),s.bx(ue),s.cR(ue,ue,.5*-Math.PI),rl(z,F,ie,ue,re,2),s.bx(ue),s.cR(ue,ue,.5*Math.PI),rl(z,F,ie,ue,re,3),s.bx(ue),rl(z,F,ie,ue,re,4),s.bx(ue),s.eh(ue,ue,Math.PI),rl(z,F,ie,ue,re,5),K.viewport.set([0,0,z.width,z.height])}(m,u),u.markSkyboxValid(m)):m.renderPass==="sky"&&function(z,F,H,$,K){const te=z.context,ee=te.gl,re=z.transform,ie=z.getOrCreateProgram("skybox");te.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,F.skyboxTexture);const ue=((pe,me,Te,we,Ce)=>({u_matrix:pe,u_sun_direction:me,u_cubemap:0,u_opacity:we,u_temporal_offset:Ce}))(re.skyboxMatrix,F.getCenter(z,!1),0,$,K);z.uploadCommonUniforms(te,ie),ie.draw(z,ee.TRIANGLES,H,mr.disabled,z.colorModeForRenderPass(),ur.backCW,ue,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,u,C,x,M):E==="gradient"&&m.renderPass==="sky"&&function(z,F,H,$,K){const te=z.context,ee=te.gl,re=z.transform,ie=z.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Xu(te)),te.activeTexture.set(ee.TEXTURE0);let ue=F.colorRampTexture;ue||(ue=F.colorRampTexture=new s.T(te,F.colorRamp,ee.RGBA8)),ue.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const pe=((me,Te,we,Ce,be)=>({u_matrix:me,u_color_ramp:0,u_center_direction:Te,u_radius:s.al(we),u_opacity:Ce,u_temporal_offset:be}))(re.skyboxMatrix,F.getCenter(z,!1),F.paint.get("sky-gradient-radius"),$,K);z.uploadCommonUniforms(te,ie),ie.draw(z,ee.TRIANGLES,H,mr.disabled,z.colorModeForRenderPass(),ur.backCW,pe,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,u,C,x,M)},custom:function(m,o,u,g){const x=m.context,b=u.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&u.isDraped(o)){if(m.renderPass==="offscreen"){const E=b.prerender;if(E){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const C=m.transform.pointMerc;E.call(b,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.ah(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else E.call(b,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const C=b.renderToTile;if(C){const M=g[0].canonical,z={x:M.x+g[0].wrap*(b.wrapTileId?0:1<<M.z),y:M.y,z:M.z};x.setDepthMode(Wt.disabled),x.setStencilMode(mr.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),C.call(b,x.gl,z),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(mr.disabled);const E=b.renderingMode==="3d"?new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Wt.ReadOnly);if(x.setDepthMode(E),m.transform.projection.name==="globe"){const C=m.transform.pointMerc;b.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.ah(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else b.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,o,u,g){if(m.renderPass==="opaque")return;const x=u.paint.get("model-opacity").constantOr(1);if(x===0)return;const b=u.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!b||m.terrain&&x<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const E=m.shadowRenderer,C=u.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,C||(E.enabled=!1));const M=()=>{E&&(E.useNormalOffset=!0,C||(E.enabled=!0))},z=o.getSource();if(m.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(ie,ue,pe,me,Te){const we=ie.transform;if(we.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${we.projection.name} projection is not yet implemented`);const Ce=we.getFreeCameraOptions().position;if(!ie.modelManager)return;const be=ie.modelManager;pe.modelManager=be;const Se=ie.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ee=pe._unevaluatedLayout._values["model-id"],Ue=Object.assign({},pe.layout.get("model-id").parameters),De=ie.style.order.indexOf(pe.fqid);for(const dt of me){const Je=ue.getTile(dt).getBucket(pe);if(!Je||Je.projection.name!==we.projection.name)continue;const pt=Je.getModelUris();pt&&!Je.modelsRequested&&(be.addModelsFromBucket(pt,Te),Je.modelsRequested=!0);const Pt=HP(dt,we);Ue.zoom=Pt;const qe=Ee.possiblyEvaluate(Ue);if(dd(ie,Je,dt),vl.shadowUniformsInitialized=!1,vl.useSingleShadowCascade=!!Se&&Se.getMaxCascadeForTile(dt.toUnwrapped())===0,ie.renderPass==="shadow"&&Se){if(ie.currentShadowCascade===1&&Je.isInsideFirstShadowMapFrustum)continue;const Ze=we.calculatePosMatrix(dt.toUnwrapped(),we.worldSize);if(vl.tileMatrix.set(Ze),vl.shadowTileMatrix=Float32Array.from(Se.calculateShadowPassMatrixFromMatrix(Ze)),vl.aabb.min.fill(0),vl.aabb.max[0]=vl.aabb.max[1]=s.aj,vl.aabb.max[2]=0,p0(Je,vl,ie,pe.scope))continue}const Re=1<<dt.canonical.z,nt=[((Ce.x-dt.wrap)*Re-dt.canonical.x)*s.aj,(Ce.y*Re-dt.canonical.y)*s.aj,Ce.z*Re*s.aj];ie.conflationActive&&Object.keys(Je.instancesPerModel).length>0&&ie.style.isLayerClipped(pe,ue.getSource())&&Je.updateReplacement(dt,ie.replacementSource,De,Te)&&(Je.uploaded=!1,Je.upload(ie.context));for(let Ze in Je.instancesPerModel){const yt=Je.instancesPerModel[Ze];yt.features.length>0&&(Ze=qe.evaluate(yt.features[0].feature,{}));const bt=be.getModel(Ze,Te);if(bt||be.hasURLBeenRequested(Ze)||Je.modelUris.includes(Ze)||(Je.modelUris.push(Ze),Je.modelsRequested=!1),bt&&bt.uploaded)for(const Et of bt.nodes)f0(ie,pe,Et,yt,nt,dt,vl)}}}(m,o,u,g,z.type==="vector"?u.scope:""),void M();if(!z.loaded())return;if(z.type==="batched-model")return function(ie,ue,pe,me){pe.resetLayerRenderingStats(ie);const Te=ie.context,we=ie.transform,Ce=ie.style.fog,be=ie.shadowRenderer;if(we.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${we.projection.name} projection is not yet implemented`);const Se=ie.transform.getFreeCameraOptions().position,Ee=s.c1([],[Se.x,Se.y,Se.z],ie.transform.worldSize),Ue=s.eq([],Ee),De=s.bx([]),dt=s.e9(we.center.lat,we.zoom),Je=s.bn([],[1,1,1/dt]);s.bo(De,De,Ue);const pt=pe.paint.get("model-opacity").constantOr(1),Pt=new Wt(Te.gl.LEQUAL,Wt.ReadWrite,ie.depthRangeFor3D),qe=new Wt(Te.gl.LEQUAL,Wt.ReadOnly,ie.depthRangeFor3D),Re=new s.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),nt=ie.renderPass==="shadow",Ze=nt&&be?be.getCurrentCascadeFrustum():we.getFrustum(we.scaleZoom(we.worldSize)),yt=pe.paint.get("model-front-cutoff"),bt=yt[2]<1,Et=yl(ie,pe.paint.get("model-cutoff-fade-range")),jt=pe.getLayerRenderingStats();(function(tr,ir,Zt,er){const nr=tr.terrain?tr.terrain.exaggeration():0,wr=tr.transform.zoom;for(const Pr of er){const Nr=ir.getTile(Pr).getBucket(Zt);Nr&&(Nr.setFilter(Zt.filter),tr.conflationActive&&Nr.updateReplacement(Pr,tr.replacementSource),Nr.evaluateTransform(tr,Zt),tr.terrain&&nr>0&&Nr.elevationUpdate(tr.terrain,nr,Pr,Zt.source),Nr.needsReEvaluation(tr,wr,Zt)&&Nr.evaluate(Zt))}})(ie,ue,pe,me),function(){let tr,ir,Zt;bt?(tr=me.length-1,ir=-1,Zt=-1):(tr=0,ir=me.length,Zt=1);const er=new Float64Array(16),nr=s.cx(),wr=new s.P(0,0);for(let Pr=tr;Pr!==ir;Pr+=Zt){const Nr=me[Pr],Pn=ue.getTile(Nr).getBucket(pe);if(!Pn||!Pn.uploaded)continue;let vr=!1;be&&(vr=be.getMaxCascadeForTile(Nr.toUnwrapped())===0);const un=we.calculatePosMatrix(Nr.toUnwrapped(),we.worldSize),hn=Pn.modelTraits;!nt&&bt&&(s.bi(er,un),s.ad(nr,Ee,er),wr.x=nr[0],wr.y=nr[1]);const Zn=[];Pn.setFilter(pe.filter);for(const Ir of Pn.getNodesInfo()){if(Ir.hiddenByReplacement||!Ir.node.meshes)continue;const on=Ir.node;let cn=0;ie.terrain&&on.elevation&&(cn=on.elevation*ie.terrain.exaggeration());const vn=(()=>{const Rs=Ir.aabb;return Re.min=[...Rs.min],Re.max=[...Rs.max],Re.min[2]+=cn,Re.max[2]+=cn,s.ad(Re.min,Re.min,un),s.ad(Re.max,Re.max,un),Re})(),hi=Ir.evaluatedScale;if(hi[0]<=1&&hi[1]<=1&&hi[2]<=1&&vn.intersects(Ze)===0)continue;if(!nt&&bt){const Rs=.16666666666666666;Ir.cameraCollisionOpacity=Ee[0]>vn.min[0]&&Ee[0]<vn.max[0]&&Ee[1]>vn.min[1]&&Ee[1]<vn.max[1]&&Ee[2]*dt<vn.max[2]&&on.footprint&&s.bY(wr,on.footprint)?Math.max(Ir.cameraCollisionOpacity-Rs,0):Math.min(1,Ir.cameraCollisionOpacity+Rs)}const kr=[...un],mn=1/s.d4(Nr.canonical),mi=on.anchor?on.anchor[0]:0,rn=on.anchor?on.anchor[1]:0;s.bo(kr,kr,[mi*(hi[0]-1)+Ir.evaluatedTranslation[0]*mn,rn*(hi[1]-1)+Ir.evaluatedTranslation[1]*mn,cn+Ir.evaluatedTranslation[2]]),s.cn(hi,s.es)||s.cP(kr,kr,hi);const xn=s.az([],kr,on.matrix),Ln=s.az([],we.expandedFarZProjMatrix,xn),Ei=s.az([],we.expandedFarZProjMatrix,kr),Oi=s.aA([],[mi,rn,cn,1],Ln)[2];on.hidden=!1;let ji=pt;nt||(bt&&(ji*=Ir.cameraCollisionOpacity,ji*=nS(kr,we,Ir.aabb,yt)),ji*=rS(Et,Oi)),ji!==0?Zn.push({nodeInfo:Ir,depth:Oi,opacity:ji,wvpForNode:Ln,wvpForTile:Ei,nodeModelMatrix:xn,tileModelMatrix:kr}):on.hidden=!0}nt||Zn.sort((Ir,on)=>!bt||Ir.opacity===1&&on.opacity===1?Ir.depth<on.depth?-1:1:Ir.opacity===1?-1:on.opacity===1?1:Ir.depth>on.depth?-1:1);for(const Ir of Zn){const on=Ir.nodeInfo,cn=on.node;let vn=s.az([],Je,Ir.tileModelMatrix);s.az(vn,De,vn);const hi=s.bi([],vn);s.ea(hi,hi),s.cP(hi,hi,Cg),vn=s.az(vn,vn,cn.matrix);const kr=ie.renderPass==="light-beam",mn=pe.paint.get("model-color-use-theme").constantOr("default")==="none",mi=hn&s.ex.HasMapboxMeshFeatures,rn=mi?0:on.evaluatedRMEA[0][2];for(let xn=0;xn<cn.meshes.length;++xn){const Ln=cn.meshes[xn],Ei=xn===cn.lightMeshIndex;let Oi=Ir.wvpForNode;if(Ei){if(!kr&&!ie.terrain&&ie.shadowRenderer){ie.currentLayer<ie.firstLightBeamLayer&&(ie.firstLightBeamLayer=ie.currentLayer);continue}Oi=Ir.wvpForTile}else if(kr)continue;const ji={defines:[]},Rs=[];if(!nt&&be&&(be.useNormalOffset=!!Ln.normalBuffer),up(ji.defines,Rs,Ln,ie,mn?null:pe.lut),mi||ji.defines.push("DIFFUSE_SHADED"),vr&&ji.defines.push("SHADOWS_SINGLE_CASCADE"),jt&&(nt?jt.numRenderedVerticesInShadowPass+=Ln.vertexArray.length:jt.numRenderedVerticesInTransparentPass+=Ln.vertexArray.length),nt){Pg(Ln,Ir.nodeModelMatrix,ie,pe);continue}let ca=null;if(Ce){const Ra=cp(Ir.nodeModelMatrix,ie.transform);if(ca=new Float32Array(Ra),we.projection.name!=="globe"){const si=Ln.aabb.min,Ri=Ln.aabb.max,[Un,Di]=Ce.getOpacityForBounds(Ra,si[0],si[1],Ri[0],Ri[1]);ji.overrideFog=Un>=gt||Di>=gt}}const $o=Ln.material;let fo;$o.occlusionTexture&&$o.occlusionTexture.offsetScale&&(fo=$o.occlusionTexture.offsetScale,ji.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const po=ie.getOrCreateProgram("model",ji);!nt&&be&&be.setupShadowsFromMatrix(Ir.tileModelMatrix,po,be.useNormalOffset),ie.uploadCommonUniforms(Te,po,null,ca);const Go=$o.pbrMetallicRoughness;Go.metallicFactor=.9,Go.roughnessFactor=.5;const ja=t0(new Float32Array(Oi),new Float32Array(vn),new Float32Array(hi),new Float32Array(cn.matrix),ie,Ir.opacity,Go.baseColorFactor,$o.emissiveFactor,Go.metallicFactor,Go.roughnessFactor,$o,rn,pe,[0,0,0],fo);!Ei&&(on.hasTranslucentParts||Ir.opacity<1)&&po.draw(ie,Te.gl.TRIANGLES,Pt,mr.disabled,Or.disabled,ur.backCCW,ja,pe.id,Ln.vertexBuffer,Ln.indexBuffer,Ln.segments,pe.paint,ie.transform.zoom,void 0,Rs),po.draw(ie,Te.gl.TRIANGLES,Ei?qe:Pt,mr.disabled,Ei||Ir.opacity<1||on.hasTranslucentParts?Or.alphaBlended:Or.unblended,ur.backCCW,ja,pe.id,Ln.vertexBuffer,Ln.indexBuffer,Ln.segments,pe.paint,ie.transform.zoom,void 0,Rs)}}}}()}(m,o,u,g),void M();if(z.type!=="model")return;const F=z.getModels(),H=[],$=m.transform.getFreeCameraOptions().position,K=s.c1([],[$.x,$.y,$.z],m.transform.worldSize);s.eq(K,K);const te=[],ee=[];let re=0;for(const ie of F){const ue=u.paint.get("model-rotation").constantOr(null),pe=u.paint.get("model-scale").constantOr(null),me=u.paint.get("model-translation").constantOr(null);ie.computeModelMatrix(m,ue,pe,me,!0,!0,!1);const Te=s.bx([]),we=s.e9(ie.position.lat,m.transform.zoom),Ce=s.bn([],[1,1,1/we]);s.bo(Te,Te,K),H.push({zScaleMatrix:Ce,negCameraPosMatrix:Te});for(const be of ie.nodes)d0(m.transform,be,ie.matrix,m.transform.expandedFarZProjMatrix,re,te,ee);re++}if(te.sort((ie,ue)=>ue.depth-ie.depth),m.renderPass!=="shadow"){if(x===1)for(const ie of ee)hd(ie,m,u,H[ie.modelIndex],mr.disabled,m.colorModeForRenderPass());else{for(const ie of ee)hd(ie,m,u,H[ie.modelIndex],mr.disabled,Or.disabled);for(const ie of ee)hd(ie,m,u,H[ie.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const ie of te)hd(ie,m,u,H[ie.modelIndex],mr.disabled,m.colorModeForRenderPass());M()}else{for(const ie of ee)Pg(ie.mesh,ie.nodeModelMatrix,m,u);for(const ie of te)Pg(ie.mesh,ie.nodeModelMatrix,m,u);M()}}},Mg={line:function(m,o,u){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const g=o.getVisibleCoordinates();for(const x of g){const b=o.getTile(x).getBucket(m);if(b&&(b.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,o,u){const g=o.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,g.type==="vector"?m.scope:""));if(g.type==="batched-model"||g.type!=="model")return;const x=g.getModels();for(const b of x)b.upload(u.context)},raster:function(m,o,u){const g=o.getSource();if(!(g instanceof Oc&&g.loaded()))return;const x=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const b=m.paint.get("raster-array-band")||g.getInitialBand(x);if(b==null)return;const E=o.getIds().map(C=>o.getTileByID(C));for(const C of E)C.updateNeeded(m.id,b)&&g.prepareTile(C,x,m.id,b)},"raster-particle":function(m,o,u){const g=o.getSource();if(!(g instanceof Oc&&g.loaded()))return;const x=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const b=m.paint.get("raster-particle-array-band")||g.getInitialBand(x);if(b==null)return;const E=o.getIds().map(C=>o.getTileByID(C));for(const C of E)C.updateNeeded(m.id,b)&&g.prepareTile(C,x,m.id,b)}},Og={fill:qt},oa={fill:function(m,o,u,g){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const x=m.context.gl,b=new Wt(x.LEQUAL,Wt.ReadOnly,m.depthRangeFor3D),E=new mr({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),C=m.transform.getFreeCameraOptions().position,M=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const z of g){const F=o.getTile(z),H=F.getBucket(u);if(!H)continue;const $=H.elevatedStructures;if(!$||$.depthSegments.segments[0].primitiveLength===0)continue;const K=sp(z.toUnwrapped(),C),te=m.translatePosMatrix(z.projMatrix,F,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),ee=yg(te,K,0,1,0);M.draw(m,x.TRIANGLES,b,E,Or.disabled,ur.disabled,ee,u.id,$.vertexBuffer,$.indexBuffer,$.depthSegments,u.paint,m.transform.zoom)}}};class Xc{constructor(o,u,g,x,b,E){this.context=new wg(o,u),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const z of C)this._debugParams.enabledLayers[z]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const z of C)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],z);this.occlusionParams=new fd(b),this.setup(),this.numSublayers=Ao.maxUnderzooming+Ao.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new AP(this),this._wireframeDebugCache=new hp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const M=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,M,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=E}updateTerrain(o,u){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fg(this,o));const x=this._terrain;this.transform.elevation=g?x:null,x.update(o,this.transform,u),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(o){const u=o.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=u.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const b=g+.78*(x-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new fg(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,u){if(this.width=o*s.q.devicePixelRatio,this.height=u*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const o=this.context,u=new s.ba;u.emplaceBack(0,0),u.emplaceBack(s.aj,0),u.emplaceBack(0,s.aj),u.emplaceBack(s.aj,s.aj),this.tileExtentBuffer=o.createVertexBuffer(u,s.bc.members),this.tileExtentSegments=s.bd.simpleSegment(0,0,4,2);const g=new s.ba;g.emplaceBack(0,0),g.emplaceBack(s.aj,0),g.emplaceBack(0,s.aj),g.emplaceBack(s.aj,s.aj),this.debugBuffer=o.createVertexBuffer(g,s.bc.members),this.debugSegments=s.bd.simpleSegment(0,0,4,5);const x=new s.ba;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,s.bc.members),this.viewportSegments=s.bd.simpleSegment(0,0,4,2);const b=new s.aZ;b.emplaceBack(0,0,0,0),b.emplaceBack(s.aj,0,s.aj,0),b.emplaceBack(0,s.aj,0,s.aj),b.emplaceBack(s.aj,s.aj,s.aj,s.aj),this.mercatorBoundsBuffer=o.createVertexBuffer(b,s.bf.members),this.mercatorBoundsSegments=s.bd.simpleSegment(0,0,4,2);const E=new s.a_;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const C=new s.bb;for(const z of[0,1,3,2,0])C.emplaceBack(z);this.debugIndexBuffer=o.createIndexBuffer(C),this.emptyTexture=new s.T(o,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=s.bz();const M=this.context.gl;this.stencilClearMode=new mr({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Wt.disabled,this.stencilClearMode,Or.disabled,ur.disabled,hg(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,u,g){if(!u||this.currentStencilSource===u.id||!o.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const M of g)if(this._tileClippingMaskIDs[M.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=u.id;const x=this.context,b=x.gl;this.nextStencilID+g.length>256&&this.clearStencil(),x.setColorMode(Or.disabled),x.setDepthMode(Wt.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of g){const M=u.getTile(C),z=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:H,tileBoundsSegments:$}=this.getTileBoundsBuffers(M);E.draw(this,b.TRIANGLES,Wt.disabled,new mr({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),Or.disabled,ur.disabled,hg(C.projMatrix),"$clipping",F,H,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new mr({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const u=this.context.gl;return new mr({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(o){const u=this.context.gl,g=o.sort((E,C)=>C.overscaledZ-E.overscaledZ),x=g[g.length-1].overscaledZ,b=g[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let C=0;C<b;C++)E[C+x]=new mr({func:u.GEQUAL,mask:255},C+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[E,g]}return[{[x]:mr.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Or([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new s.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Or.unblended:Or.alphaBlended}colorModeForDrapableLayerRenderPass(o){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Or([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new s.am(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,u,g,x=!1){if(this.depthOcclusion)return new Wt(this.context.gl.GREATER,Wt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Wt.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Wt(g||this.context.gl.LEQUAL,u,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,u=Math.ceil(this.width),g=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),b=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===u&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),u!==0&&g!==0&&(this.depthFBO=new Zu(this.context,u,g,!1,"texture"),this.depthTexture=new s.T(this.context,{width:u,height:g,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),o.bindTexture(o.TEXTURE_2D,b),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,u,g,0,0,u,g,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,u)=>o+u/this._fpsHistory.length,0))}render(o,u){const g=s.q.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=u;const x=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(b).filter(qe=>{const Re=x[qe];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]});let C=E(),M=!1,z=!1,F=null;for(const qe of C){const Re=x[qe];Re.type==="circle"?M=!0:Re.type==="building"?F=Re:Re.type==="symbol"&&(Re.hasInitialOcclusionOpacityProperties?z=!0:M=!0)}let H=C.map(qe=>x[qe]);const $=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let K=0,te=!1;for(const qe in $){const Re=$[qe];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++K)}let ee=!1;for(const qe of H)qe.isHidden(this.transform.zoom)||(qe.type==="clip"&&(ee=!0),this.prepareLayer(qe));const re={},ie={},ue={},pe={},me={};for(const qe in $){const Re=$[qe];re[qe]=Re.getVisibleCoordinates(),ie[qe]=re[qe].slice().reverse(),ue[qe]=Re.getVisibleCoordinates(!0).reverse(),pe[qe]=Re.getShadowCasterCoordinates(),me[qe]=Re.sortCoordinatesByDistance(re[qe])}const Te=qe=>{const Re=this.style.getLayerSourceCache(qe);return Re&&Re.used?Re.getSource():null};if(K||ee||this._clippingActiveLastFrame){const qe=[],Re=[];let nt=0;for(const Ze of H)this.isSourceForClippingOrConflation(Ze,Te(Ze))&&(qe.push(Ze),Re.push(nt)),nt++;if(qe&&(ee||qe.length>1)||this._clippingActiveLastFrame){ee=!1;const Ze=[];for(let yt=0;yt<qe.length;yt++){const bt=qe[yt],Et=Re[yt],jt=this.style.getLayerSourceCache(bt);if(!jt||!jt.used||!jt.getSource().usedInConflation&&bt.type!=="clip"&&bt.type!=="building")continue;let tr=s.eF,ir=s.bW.None;const Zt=[];let er=!0;if(bt.type==="building")tr=s.eH;else if(bt.type==="clip"){tr=Et;for(const nr of bt.layout.get("clip-layer-types"))ir|=nr==="model"?s.bW.Model:nr==="symbol"?s.bW.Symbol:s.bW.FillExtrusion;for(const nr of bt.layout.get("clip-layer-scope"))Zt.push(nr);bt.isHidden(this.transform.zoom)?er=!1:ee=!0}er&&Ze.push({layer:bt.fqid,cache:jt,order:tr,clipMask:ir,clipScope:Zt})}this.replacementSource.setSources(Ze),te=!0}}this._clippingActiveLastFrame=ee,te||this.replacementSource.clear(),this.conflationActive=te,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let qe=0;qe<H.length;qe++){const Re=H[qe],nt=Re.cutoffRange();if(this.longestCutoffRange=Math.max(nt,this.longestCutoffRange),nt>0){const Ze=Te(Re);Ze&&(this.minCutoffZoom=Math.max(Ze.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=qe),this._lastOcclusionLayer=qe)}const we=this.style&&this.style.fog;we?(this._fogVisible=we.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ue),this.opaquePassCutoff=0,C=E(),H=C.map(qe=>x[qe]));const Ce=this._shadowRenderer;if(Ce){Ce.updateShadowParameters(this.transform,this.style.directionalLight);for(const qe in $)for(const Re of re[qe]){let nt={min:0,max:0};this.terrain&&(nt=this.terrain.getMinMaxForTile(Re)||nt),Ce.addShadowReceiver(Re.toUnwrapped(),nt.min,nt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new $e(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Se=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(be&&!this._snow&&(this._snow=new g0(this)),!be&&this._snow&&(this._snow.destroy(),delete this._snow),Se&&!this._rain&&(this._rain=new md(this)),!Se&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),F){this.buildingTileBorderManager||(this.buildingTileBorderManager=new tS);const qe=this.style.getLayerSourceCache(F);this.buildingTileBorderManager.updateBorders(qe,F)}if(!Sr.has(this.context.gl))return;this.renderPass="offscreen";for(const qe of H){const Re=o.getLayerSourceCache(qe);if(!qe.hasOffscreenPass()||qe.isHidden(this.transform.zoom))continue;const nt=Re?ie[Re.id]:void 0;(qe.type==="custom"||qe.type==="raster"||qe.type==="raster-particle"||qe.isSky()||nt&&nt.length)&&this.renderLayer(this,Re,qe,nt)}this.depthRangeFor3D=[0,1-(H.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,pe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ee=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ue=(()=>{if(u.showOverdrawInspector)return s.am.black;const qe=this.style.fog;if(qe&&this.transform.projection.supportsFog){const Re=this.style.getLut(qe.scope);if(!Ee){const nt=qe.properties.get("color-use-theme")==="none",Ze=qe.properties.get("color").toNonPremultipliedRenderColor(nt?null:Re).toArray01();return new s.am(...Ze)}if(Ee){const nt=qe.properties.get("space-color-use-theme")==="none",Ze=qe.properties.get("space-color").toNonPremultipliedRenderColor(nt?null:Re).toArray01();return new s.am(...Ze)}}return s.am.transparent})();if(this.context.clear({color:Ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const qe=H[this.currentLayer],Re=o.getLayerSourceCache(qe);if(qe.isSky())continue;const nt=Re?(qe.is3D(b)?me:ie)[Re.id]:void 0;this._renderTileClippingMasks(qe,Re,nt),this.renderLayer(this,Re,qe,nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const qe=H[this.currentLayer],Re=o.getLayerSourceCache(qe);qe.isSky()&&this.renderLayer(this,Re,qe,Re?ie[Re.id]:void 0)}function De(qe,Re){let nt;return Re&&(nt=(qe.type==="symbol"?ue:qe.is3D(b)?me:ie)[Re.id]),nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const qe=H[this.currentLayer];if(qe.type==="raster"||qe.type==="raster-particle"){const Re=o.getLayerSourceCache(qe);this.renderLayer(this,Re,qe,De(qe,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let dt=0;Ce&&(dt=Ce.getShadowCastingLayerCount());let Je=!1,pt=-1;for(let qe=0;qe<C.length;++qe){const Re=H[qe];Re.isHidden(this.transform.zoom)||Re.is3D(b)&&(pt=qe)}z&&pt===-1&&(M=!0);let Pt=!1;for(;this.currentLayer<C.length;){const qe=H[this.currentLayer],Re=o.getLayerSourceCache(qe);if(qe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(qe)){if(qe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Pt&&qe.is3D(b)&&!b){const nt=this.currentLayer,Ze=yt=>{for(this.currentLayer=0;this.currentLayer<H.length;this.currentLayer++){const bt=H[this.currentLayer];if(Og[bt.type]){const Et=this.style.getLayerSourceCache(bt);Og[bt.type](this,Et,bt,De(bt,Et),yt)}}};Ze("initialize"),Ze("reset"),this.currentLayer=nt,Pt=!0}if(M&&!Je&&this.terrain&&!this.transform.isOrthographic&&(Je=!0,this.blitDepth()),z&&pt!==-1&&this.currentLayer===pt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(qe,Re,Re?re[Re.id]:void 0),this.renderLayer(this,Re,qe,De(qe,Re)),!this.terrain&&Ce&&dt>0&&qe.hasShadowPass()&&--dt==0){{this.clearStencil(),this.resetStencilClippingMasks();const nt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<H.length;this.currentLayer++){const Ze=H[this.currentLayer];if(oa[Ze.type]){const yt=this.style.getLayerSourceCache(Ze);oa[Ze.type](this,yt,Ze,De(Ze,yt))}}this.currentLayer=nt}if(Ce.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=nt;this.currentLayer++){const Ze=H[this.currentLayer];if(!Ze.hasLightBeamPass())continue;const yt=o.getLayerSourceCache(Ze);this.renderLayer(this,yt,Ze,yt?ie[yt.id]:void 0)}this.currentLayer=nt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const nt=this.currentLayer;this.depthOcclusion=!0;for(const Ze of this.layersWithOcclusionOpacity){this.currentLayer=Ze;const yt=H[this.currentLayer],bt=o.getLayerSourceCache(yt),Et=bt?ie[bt.id]:void 0;this.terrain||this._renderTileClippingMasks(yt,bt,bt?re[bt.id]:void 0),this.renderLayer(this,bt,yt,Et)}this.depthOcclusion=!1,this.currentLayer=nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let qe=null;H.forEach(Re=>{const nt=o.getLayerSourceCache(Re);nt&&!Re.isHidden(this.transform.zoom)&&nt.getVisibleCoordinates().length&&(!qe||qe.getSource().maxzoom<nt.getSource().maxzoom)&&(qe=nt)}),qe&&this.options.showTileBoundaries&&_l(this,qe,qe.getVisibleCoordinates(),s.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&_l(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(qe){const Re=qe.transform.padding;ap(qe,qe.transform.height-(Re.top||0),3,Y1),ap(qe,Re.bottom||0,3,c0),kg(qe,Re.left||0,3,u0),kg(qe,qe.transform.width-(Re.right||0),3,h0);const nt=qe.transform.centerPoint;(function(Ze,yt,bt,Et){lp(Ze,yt-1,bt-10,2,20,Et),lp(Ze,yt-10,bt-1,20,2,Et)})(qe,nt.x,qe.transform.height-nt.y,J1)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),te||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:u}=this.transform.projection,g=!u||!u.includes(o.type);if(Mg[o.type]&&(g||this.terrain&&o.type==="custom")){const x=this.style.getLayerSourceCache(o);Mg[o.type](o,x,this)}this.gpuTimingEnd()}renderLayer(o,u,g,x){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)&&(!o.terrain||g.type!=="custom")||g.type==="clip"||y0[g.type](o,u,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,g=this.context.gl;let x=this.gpuTimers[o.id];x||(x=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:g.createQuery()}),x.calls++,g.beginQuery(u.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,u=this.context.gl,g=u.createQuery();this.deferredRenderGpuTimeQueries.push(g),u.beginQuery(o.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const u={};for(const g in o){const x=o[g],b=this.context.extTimerQuery,E=b.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(x.query),u[g]=E}return u}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.gl;let g=0;for(const x of o)g+=u.getQueryParameter(x,u.QUERY_RESULT)/1e6,u.deleteQuery(x);return g}translatePosMatrix(o,u,g,x,b){if(!g[0]&&!g[1])return o;const E=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const z=Math.sin(E),F=Math.cos(E);g=[g[0]*F-g[1]*z,g[0]*z+g[1]*F]}const C=[b?g[0]:s.aw(u,g[0],this.transform.zoom),b?g[1]:s.aw(u,g[1],this.transform.zoom),0],M=new Float32Array(16);return s.bo(M,o,C),M}saveTileTexture(o){if(o.context!==this.context)return;const u=o.size[0],g=this._tileTextures[u];g?g.push(o):this._tileTextures[u]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,u,g){const x=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,b=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||x||u!==void 0&&!u||b.push("FOG","FOG_DITHERING"),x&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(o,u){this.cache=this.cache||{};const g=u&&u.defines||[],x=u&&u.config,b=this.currentGlobalDefines(o,u&&u.overrideFog,u&&u.overrideRtt).concat(g),E=mg.cacheKey(ep[o],o,b,x);return this.cache[E]||(this.cache[E]=new mg(this.context,o,ep[o],x,Z1[o],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,u){if(this.style.enable3dLights()){const g=this.style.directionalLight,x=this.style.ambientLight;if(g&&x){const b=((E,C,M)=>{const z=E.properties.get("direction"),F=E.properties.get("color-use-theme")==="none",H=E.properties.get("color").toNonPremultipliedRenderColor(F?null:M.getLut(E.scope)).toArray01(),$=E.properties.get("intensity"),K=C.properties.get("color-use-theme")==="none",te=C.properties.get("color").toNonPremultipliedRenderColor(K?null:M.getLut(C.scope)).toArray01(),ee=C.properties.get("intensity"),re=[z.x,z.y,z.z],ie=s.dI(te,ee),ue=s.dI(H,$);return{u_lighting_ambient_color:ie,u_lighting_directional_dir:re,u_lighting_directional_color:ue,u_ground_radiance:Wv(re,ue,ie)}})(g,x,this.style);u.setLightsUniformValues(o,b)}}}uploadCommonUniforms(o,u,g,x,b){if(this.uploadCommonLightUniforms(o,u),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const C=E.getOpacity(this.transform.pitch),M=((z,F,H,$,K,te,ee,re,ie,ue,pe,me)=>{const Te=z.transform,we=F.properties.get("color-use-theme")==="none",Ce=F.properties.get("color").toNonPremultipliedRenderColor(we?null:z.style.getLut(F.scope)).toArray01();Ce[3]=$;const be=z.frameCounter/1e3%1,[Se,Ee]=F.properties.get("vertical-range");return{u_fog_matrix:H?Te.calculateFogTileMatrix(H):me||z.identityMat,u_fog_range:F.getFovAdjustedRange(Te._fov),u_fog_color:Ce,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Se,Ee),Ee],u_fog_temporal_offset:be,u_frustum_tl:K,u_frustum_tr:te,u_frustum_br:ee,u_frustum_bl:re,u_globe_pos:ie,u_globe_radius:ue,u_viewport:pe,u_globe_transition:s.ah(Te.zoom),u_is_globe:+(Te.projection.name==="globe")}})(this,E,g,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],x);u.setFogUniformValues(o,M)}b&&u.setCutoffUniformValues(o,b.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,u=o.createTexture();return o.bindTexture(o.TEXTURE_2D,u),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const x of g)u[x.key]=o[x.key]||new Du(x,512,this.transform.tileZoom,this,void 0,this.worldview);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,u){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!u||u.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[o.key];return u||(this._cachedTileFogOpacities[o.key]=u=this.style.fog.getOpacityForTile(o)),u[0]>=gt||u[1]>=gt}setupDepthForOcclusion(o,u,g){const x=this.context,b=x.gl,E=!!g;var C;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(b.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),x.activeTexture.set(b.TEXTURE0),E||u.setTerrainUniformValues(x,g)}}function gd(m,o){let u=!1,g=null;const x=()=>{g=null,u&&(m(),g=setTimeout(x,o),u=!1)};return()=>(u=!0,g||x(),g)}class jg{constructor(o){this._hashName=o&&encodeURIComponent(o),s.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=gd(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const u=Rg(o);if(this._hashName){const g=this._hashName;let x=!1;const b=location.hash.slice(1).split("&").map(E=>{const C=E.split("=")[0];return C===g?(x=!0,`${C}=${u}`):E}).filter(E=>E);return x||b.push(`${g}=${u}`),`#${b.join("&")}`}return`#${u}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(Number(g)))){const g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(u[3]||0):o.getBearing();return o.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Rg(m,o){const u=m.getCenter(),g=Math.round(100*m.getZoom())/100,x=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),E=Math.round(u.lng*b)/b,C=Math.round(u.lat*b)/b,M=m.getBearing(),z=m.getPitch();let F=o?`/${E}/${C}/${g}`:`${g}/${C}/${E}`;return(M||z)&&(F+="/"+Math.round(10*M)/10),z&&(F+=`/${Math.round(z)}`),F}const yd={linearity:.3,easing:s.eI(0,0,.3,1)},Yc=s.h({deceleration:2500,maxSpeed:1400},yd),_0=s.h({deceleration:20,maxSpeed:1400},yd),xl=s.h({deceleration:1e3,maxSpeed:360},yd),v0=s.h({deceleration:1e3,maxSpeed:90},yd);class Dg{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=s.q.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(u.pan.mag()){const b=vd(u.pan.mag(),g,s.h({},Yc,o||{}));x.offset=u.pan.mult(b.amount/u.pan.mag()),x.center=this._map.transform.center,_d(x,b)}if(u.zoom){const b=vd(u.zoom,g,_0);x.zoom=this._map.transform.zoom+b.amount,_d(x,b)}if(u.bearing){const b=vd(u.bearing,g,xl);x.bearing=this._map.transform.bearing+s.ay(b.amount,-179,179),_d(x,b)}if(u.pitch){const b=vd(u.pitch,g,v0);x.pitch=this._map.transform.pitch+b.amount,_d(x,b)}if(x.zoom||x.bearing){const b=u.pinchAround===void 0?u.around:u.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function _d(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function vd(m,o,u){const{maxSpeed:g,linearity:x,deceleration:b}=u,E=s.ay(m*x/(o/1e3),-g,g),C=Math.abs(E)/(b*x);return{easing:u.easing,duration:1e3*C,amount:E*(C/2)}}class ii extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g,x={}){const b=ge(u.getCanvasContainer(),g),E=u.unproject(b);super(o,s.h({point:b,lngLat:E,originalEvent:g},x)),this._defaultPrevented=!1,this.target=u}}class xd extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){const x=o==="touchend"?g.changedTouches:g.touches,b=je(u.getCanvasContainer(),x),E=b.map(M=>u.unproject(M)),C=b.reduce((M,z,F,H)=>M.add(z.div(H.length)),new s.P(0,0));super(o,{points:b,point:C,lngLats:E,lngLat:u.unproject(C),originalEvent:g}),this._defaultPrevented=!1}}class x0 extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class b0{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new x0(this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new ii(o.type,this._map,o))}mouseup(o){this._map.fire(new ii(o.type,this._map,o))}preclick(o){const u=s.h({},o);u.type="preclick",this._map.fire(new ii(u.type,this._map,u))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(o),this._map.fire(new ii(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new ii(o.type,this._map,o))}mouseover(o){this._map.fire(new ii(o.type,this._map,o))}mouseout(o){this._map.fire(new ii(o.type,this._map,o))}touchstart(o){return this._firePreventable(new xd(o.type,this._map,o))}touchmove(o){this._map.fire(new xd(o.type,this._map,o))}touchend(o){this._map.fire(new xd(o.type,this._map,o))}touchcancel(o){this._map.fire(new xd(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ju{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new ii(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ii("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new ii(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class w0{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&o.button===0&&(Y(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const g=u,x=this._startPos,b=this._lastPos;if(!x||!b||b.equals(g)||!this._box&&g.dist(x)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=N("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const E=Math.min(x.x,g.x),C=Math.max(x.x,g.x),M=Math.min(x.y,g.y),z=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${M}px)`,this._box.style.width=C-E+"px",this._box.style.height=z-M+"px")})}mouseupWindow(o,u){if(!this._active)return;const g=this._startPos,x=u;if(g&&o.button===0){if(this.reset(),le(),g.x!==x.x||g.y!==x.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ne(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new s.A(o,{originalEvent:u}))}}function fp(m,o){const u={};for(let g=0;g<m.length;g++)u[m[g].identifier]=o[g];return u}class S0{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const b=new s.P(0,0);for(const E of x)b._add(E);return b.div(x.length)}(u),this.touches=fp(g,u)))}touchmove(o,u,g){if(this.aborted||!this.centroid)return;const x=fp(g,u);for(const b in this.touches){const E=x[b];(!E||E.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(o,u,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Jc{constructor(o){this.singleTap=new S0(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,u,g){this.singleTap.touchstart(o,u,g)}touchmove(o,u,g){this.singleTap.touchmove(o,u,g)}touchend(o,u,g){const x=this.singleTap.touchend(o,u,g);if(x){const b=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(b&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class T0{constructor(){this._zoomIn=new Jc({numTouches:1,numTaps:2}),this._zoomOut=new Jc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,g){this._zoomIn.touchstart(o,u,g),this._zoomOut.touchstart(o,u,g)}touchmove(o,u,g){this._zoomIn.touchmove(o,u,g),this._zoomOut.touchmove(o,u,g)}touchend(o,u,g){const x=this._zoomIn.touchend(o,u,g),b=this._zoomOut.touchend(o,u,g);return x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const E0={0:1,2:2},Lg={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class bd{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,u){return!1}_move(o,u){return{}}mousedown(o,u){if(this._lastPoint)return;const g=ze(o);this._correctButton(o,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(o,u){const g=this._lastPoint;if(g){if(o.preventDefault(),this._eventButton!=null&&function(x,b){const E=E0[b];return x.buttons===void 0||(x.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}}mouseupWindow(o){this._lastPoint&&ze(o)===this._eventButton&&(this._moved&&le(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class A0 extends bd{mousedown(o,u){super.mousedown(o,u),this._lastPoint&&(this._active=!0)}_correctButton(o,u){return u===0&&!o.ctrlKey}_move(o,u){return{around:u,panDelta:u.sub(o)}}}class zg extends bd{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Lg[o.pitchRotateKey]:void 0}_correctButton(o,u){return this._pitchRotateKey?u===0&&o[this._pitchRotateKey]:u===0&&o.ctrlKey||u===2}_move(o,u){const g=.8*(u.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class k0 extends bd{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Lg[o.pitchRotateKey]:void 0}_correctButton(o,u){return this._pitchRotateKey?u===0&&o[this._pitchRotateKey]:u===0&&o.ctrlKey||u===2}_move(o,u){const g=-.5*(u.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class sS{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),s.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(o,u,g){return this._calculateTransform(o,u,g)}touchmove(o,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!s.eJ())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,u,g)}}touchend(o,u,g){this._calculateTransform(o,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,g){g.length>0&&(this._active=!0);const x=fp(g,u),b=new s.P(0,0),E=new s.P(0,0);let C=0;for(const z in x){const F=x[z],H=this._touches[z];H&&(b._add(F),E._add(F.sub(H)),C++,x[z]=F)}if(this._touches=x,C<this._minTouches||!E.mag())return;const M=E.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(C),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ng{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,u,g){return{}}touchstart(o,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,g){const x=this._firstTwoTouches;if(!x)return;o.preventDefault();const[b,E]=x,C=pp(g,u,b),M=pp(g,u,E);if(!C||!M)return;const z=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],z,o)}touchend(o,u,g){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,E=pp(g,u,x),C=pp(g,u,b);E&&C||(this._active&&le(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function pp(m,o,u){for(let g=0;g<m.length;g++)if(m[g].identifier===u)return o[g]}function P0(m,o){return Math.log(m/o)/Math.LN2}class oS extends Ng{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(P0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:P0(this._distance,g),pinchAround:u}}}function C0(m,o){return 180*m.angleWith(o)/Math.PI}class aS extends Ng{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u){const g=this._vector;if(this._vector=o[0].sub(o[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:C0(this._vector,g),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const x=C0(o,g);return Math.abs(x)<u}}function Fg(m){return Math.abs(m.y)>Math.abs(m.x)}class lS extends Ng{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Fg(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,g){const x=this._lastPoints;if(!x)return;const b=o[0].sub(x[0]),E=o[1].sub(x[1]);return this._map._cooperativeGestures&&!s.eJ()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5})}gestureBeginsVertically(o,u,g){if(this._valid!==void 0)return this._valid;const x=o.mag()>=2,b=u.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=o.y>0==u.y>0;return Fg(o)&&Fg(u)&&E}}const cS={panStep:100,bearingStep:15,pitchStep:10};class uS{constructor(){const o=cS;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,g=0,x=0,b=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?x=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?x=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:C=>{const M=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:hS,zoom:u?Math.round(M)+u*(o.shiftKey?2:1):M,bearing:C.getBearing()+g*this._bearingStep,pitch:C.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hS(m){return m*(2-m)}const dS=4.000244140625,ZP=1/450;class KP{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ZP,s.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||s.eJ()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=s.q.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,u!==0&&u%dS==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=u,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(x*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=ge(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>dS?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&F!==0&&(F=1/F);const H=u(),$=Math.pow(2,H),K=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(K*F))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:u(),x=this._startZoom,b=this._easing;let E,C=!1;if(this._type==="wheel"&&x&&b){const z=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),F=b(z);E=s.ai(x,g,F),z<1?this._frameId||(this._frameId=!0):C=!0}else E=g,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=E-u();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=s.eK;if(this._prevEase){const g=this._prevEase,x=(s.q.now()-g.start)/g.duration,b=g.easing(x+.01)-g.easing(x),E=.27/Math.sqrt(b*b+1e-4)*.01,C=Math.sqrt(.0729-E*E);u=s.eI(E,C,.25,1)}return this._prevEase={start:s.q.now(),duration:o,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ui{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fS{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,u){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class XP{constructor(){this._tap=new Jc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,u,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,u,g))}touchmove(o,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=u[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,u,g)}touchend(o,u,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(o,u,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class I0{constructor(o,u,g){this._el=o,this._mousePan=u,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class YP{constructor(o,u,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mp{constructor(o,u,g,x){this._el=o,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gp=m=>m.zoom||m.drag||m.pitch||m.rotate;class M0 extends s.A{}class Bg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,u){const g=s.at([],u,o);this.radius=s.ae(g[2]<0?s.eM([],g,this.constants):[g[0],g[1],0])}projectRay(o){s.eM(o,o,this.constants),s.au(o,o),s.eN(o,o,this.constants);const u=s.c1([],o,this.radius);if(u[2]>0){const g=s.c1([],[0,0,1],s.bG(u,[0,0,1])),x=s.c1([],s.au([],[u[0],u[1],0]),this.radius),b=s.d5([],u,s.c1([],s.at([],s.d5([],x,g),u),2));u[0]=b[0],u[1]=b[1]}return u}}function Ma(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Vg{constructor(o,u){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dg(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Bg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),s.aV(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,b,E]of this._listeners){const C=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(b,C,E)}}destroy(){for(const[o,u,g]of this._listeners){const x=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(u,x,g)}}_addDefaultHandlers(o){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new b0(u,o));const x=u.boxZoom=new w0(u,o);this._add("boxZoom",x);const b=new T0,E=new fS;u.doubleClickZoom=new ui(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const C=new XP;this._add("tapDragZoom",C);const M=u.touchPitch=new lS(u);this._add("touchPitch",M);const z=new zg(o),F=new k0(o);u.dragRotate=new YP(o,z,F),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const H=new A0(o),$=new sS(u,o);u.dragPan=new I0(g,H,$),this._add("mousePan",H),this._add("touchPan",$,["touchZoom","touchRotate"]);const K=new aS,te=new oS;u.touchZoomRotate=new mp(g,te,K,C),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ju(u));const ee=u.scrollZoom=new KP(u,this);this._add("scrollZoom",ee,["mousePan"]);const re=u.keyboard=new uS;this._add("keyboard",re);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[ie]&&u[ie].enable(o[ie])}_add(o,u,g){this._handlers.push({handlerName:o,handler:u,allowed:g}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,u,g){for(const x in o)if(x!==g&&(!u||u.indexOf(x)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const u=[];for(const g of o)this._el.contains(g.target)&&u.push(g);return u}handleEvent(o,u){this._updatingCamera=!0;const g=o.type==="renderFrame",x=g?void 0:o,b={needsRenderFrame:!1},E={},C={},M=o.touches?this._getMapTouches(o.touches):void 0,z=M?je(this._el,M):g?void 0:ge(this._el,o);for(const{handlerName:$,handler:K,allowed:te}of this._handlers){if(!K.isEnabled())continue;let ee;this._blockedByActive(C,te,$)?K.reset():K[u||o.type]&&(ee=K[u||o.type](o,z,M),this.mergeHandlerResult(b,E,ee,$,x),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||K.isActive())&&(C[$]=K)}const F={};for(const $ in this._previousActiveHandlers)C[$]||(F[$]=x);this._previousActiveHandlers=C,(Object.keys(F).length||Ma(b))&&(this._changes.push([b,E,F]),this._triggerRenderFrame()),(Object.keys(C).length||Ma(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=b;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(o,u,g,x,b){if(!g)return;s.h(o,g);const E={handlerName:x,originalEvent:g.originalEvent||b};g.zoomDelta!==void 0&&(u.zoom=E),g.panDelta!==void 0&&(u.drag=E),g.pitchDelta!==void 0&&(u.pitch=E),g.bearingDelta!==void 0&&(u.rotate=E)}_applyChanges(){const o={},u={},g={};for(const[x,b,E]of this._changes)x.panDelta&&(o.panDelta=(o.panDelta||new s.P(0,0))._add(x.panDelta)),x.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(o.around=x.around),x.aroundCoord!==void 0&&(o.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(o.pinchAround=x.pinchAround),x.noInertia&&(o.noInertia=x.noInertia),s.h(u,b),s.h(g,E);this._updateMapTransform(o,u,g),this._changes=[]}_updateMapTransform(o,u,g){const x=this._map,b=x.transform,E=ue=>[ue.x,ue.y,ue.z];if((ue=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!Ma(o)){const ue=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),ue!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&x._stop(!0),!Ma(o))return void this._fireEvents(u,g,!0);let{panDelta:C,zoomDelta:M,bearingDelta:z,pitchDelta:F,around:H,aroundCoord:$,pinchAround:K}=o;b._isCameraConstrained&&(M>0&&(M=0),b._isCameraConstrained=!1),K!==void 0&&(H=K),(M||(ue=>u[ue]&&!this._eventsInProgress[ue])("drag"))&&H&&(this._dragOrigin=E(b.pointCoordinate3D(H)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),H=H||x.transform.centerPoint,z&&(b.bearing+=z),F&&(b.pitch+=F),b._updateCameraState();const te=[0,0,0];if(C)if(b.projection.name==="mercator"){const ue=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H).dir),pe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H.sub(C)).dir);te[0]=pe[0]-ue[0],te[1]=pe[1]-ue[1]}else{const ue=b.pointCoordinate(H);if(b.projection.name==="globe"){C=C.rotate(-b.angle);const pe=b._pixelsPerMercatorPixel/b.worldSize;te[0]=-C.x*s.eL(s.aY(ue.y))*pe,te[1]=-C.y*s.eL(b.center.lat)*pe}else{const pe=b.pointCoordinate(H.sub(C));ue&&pe&&(te[0]=pe.x-ue.x,te[1]=pe.y-ue.y)}}const ee=b.zoom,re=[0,0,0];if(M){const ue=E($||b.pointCoordinate3D(H)),pe={dir:s.au([],s.at([],ue,b._camera.position))};if(pe.dir[2]<0){const me=b.zoomDeltaToMovement(ue,M);s.c1(re,pe.dir,me)}}const ie=s.d5(te,te,re);b._translateCameraConstrained(ie),M&&Math.abs(b.zoom-ee)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,g,!0)}_fireEvents(o,u,g){const x=gp(this._eventsInProgress),b=gp(o),E={};for(const F in o){const{originalEvent:H}=o[F];this._eventsInProgress[F]||(E[`${F}start`]=H),this._eventsInProgress[F]=o[F]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const F in E)this._fireEvent(F,E[F]);b&&this._fireEvent("move",b.originalEvent);for(const F in o){const{originalEvent:H}=o[F];this._fireEvent(F,H)}const C={};let M;for(const F in this._eventsInProgress){const{handlerName:H,originalEvent:$}=this._eventsInProgress[F];this._handlersById[H].isActive()||(delete this._eventsInProgress[F],M=u[H]||$,C[`${F}end`]=M)}for(const F in C)this._fireEvent(F,C[F]);const z=gp(this._eventsInProgress);if(g&&(x||b)&&!z){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;F?(H(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:M})):(this._map.fire(new s.A("moveend",{originalEvent:M})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new s.A(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new M0("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Mi="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class bl extends s.E{constructor(o,u){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,s.aV(["_renderFrameCallback"],this)}getCenter(){return new s.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}panBy(o,u,g){return o=s.P.convert(o).mult(-1),this.panTo(this.transform.center,s.h({offset:o},u),g)}panTo(o,u,g){return this.easeTo(s.h({center:o},u),g)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,g){return this.easeTo(s.h({zoom:o},u),g)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,g){return this.easeTo(s.h({bearing:o},u),g)}resetNorth(o,u){return this.rotateTo(0,s.h({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(s.h({bearing:0,pitch:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}cameraForBounds(o,u){o=s.aG.convert(o);const g=u&&u.bearing||0,x=u&&u.pitch||0,b=o.getNorthWest(),E=o.getSouthEast();return this._cameraForBounds(this.transform,b,E,g,x,u)}_extendPadding(o){const u={top:0,right:0,bottom:0,left:0};return o==null?s.h({},u,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:s.h({},u,o)}_extendCameraOptions(o){return(o=s.h({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,u){const g=u.max[0]-u.min[0],x=u.max[1]-u.min[1];return g/x>o.aspect?g/(2*Math.tan(.5*o.fovX)*o.aspect):x/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,u,g,x,b,E){const C=o.clone(),M=this._extendCameraOptions(E);C.bearing=x,C.pitch=b;const z=s.ci.convert(u),F=s.ci.convert(g),H=.5*(z.lat+F.lat),$=.5*(z.lng+F.lng),K=s.eO(H,$),te=s.au([],K),ee=s.au([],s.bF([],te,[0,1,0])),re=s.bF([],ee,te),ie=[ee[0],ee[1],ee[2],0,re[0],re[1],re[2],0,te[0],te[1],te[2],0,0,0,0,1],ue=[K,s.eO(z.lat,z.lng),s.eO(F.lat,z.lng),s.eO(F.lat,F.lng),s.eO(z.lat,F.lng),s.eO(H,z.lng),s.eO(H,F.lng),s.eO(z.lat,$),s.eO(F.lat,$)];let pe=s.d6.fromPoints(ue.map(Ze=>[s.bG(ee,Ze),s.bG(re,Ze),s.bG(te,Ze)]));const me=s.ad([],pe.center,ie);s.eP(me)===0&&s.eQ(me,0,0,1),s.au(me,me),s.c1(me,me,s.aB),C.center=s.eR(me);const Te=C.getWorldToCameraMatrix(),we=s.bi(new Float64Array(16),Te);pe=s.d6.applyTransform(pe,s.az([],Te,ie));const Ce=this._extendAABB(pe,C,M,x);if(!Ce)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=Ce,s.ad(me,me,Te);const be=.5*(pe.max[2]-pe.min[2]),Se=this._minimumAABBFrustumDistance(C,pe),Ee=s.c1([],[0,0,1],be),Ue=s.d5(Ee,me,Ee),De=Se+(C.pitch===0?0:s.bD(me,Ue)),dt=C.globeCenterInViewSpace,Je=s.at([],me,[dt[0],dt[1],dt[2]]);s.au(Je,Je),s.c1(Je,Je,De);const pt=s.d5([],me,Je);s.ad(pt,pt,we);const Pt=s.eB/s.aB,qe=s.ae(pt),Re=s.cb(Math.max(qe*Pt-s.eB,Number.EPSILON),0),nt=Math.min(C.zoomFromMercatorZAdjusted(Re),M.maxZoom);return nt>.5*(s.cX+s.cI)?(C.setProjection({name:"mercator"}),C.zoom=nt,this._cameraForBounds(C,u,g,x,b,E)):{center:C.center,zoom:nt,bearing:x,pitch:b}}_extendAABB(o,u,g,x){const b=.5*((g.padding.left||0)+(g.padding.right||0)),E=.5*((g.padding.top||0)+(g.padding.bottom||0)),C=E,M=b,z=b,F=E,H=u.width-(M+z),$=u.height-(C+F),K=s.at([],o.max,o.min),te=Math.min(H/K[0],$/K[1]),ee=Math.min(u.scaleZoom(u.scale*te),g.maxZoom);if(isNaN(ee))return null;const re=u.scale/u.zoomScale(ee),ie=new s.d6([o.min[0]-M*re,o.min[1]-F*re,o.min[2]],[o.max[0]+z*re,o.max[1]+C*re,o.max[2]]),ue=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new s.P(g.offset.x,g.offset.y):s.P.convert(g.offset)).rotate(-s.al(x));return ie.center[0]-=ue.x*re,ie.center[1]+=ue.y*re,ie}queryTerrainElevation(o,u){const g=this.transform.elevation;return g?(u=s.h({},{exaggerated:!0},u),g.getAtPoint(s.ac.fromLngLat(o),null,u.exaggerated)):null}_cameraForBounds(o,u,g,x,b,E){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,u,g,x,b,E);const C=o.clone(),M=this._extendCameraOptions(E);C.bearing=x,C.pitch=b;const z=s.ci.convert(u),F=s.ci.convert(g),H=new s.ci(z.lng,F.lat),$=new s.ci(F.lng,z.lat),K=C.project(z),te=C.project(F),ee=this.queryTerrainElevation(z),re=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(H),ue=this.queryTerrainElevation($),pe=[[K.x,K.y,Math.min(ee||0,re||0,ie||0,ue||0)],[te.x,te.y,Math.max(ee||0,re||0,ie||0,ue||0)]];let me=s.d6.fromPoints(pe);const Te=C.getWorldToCameraMatrix(),we=s.bi(new Float64Array(16),Te);me=s.d6.applyTransform(me,Te);const Ce=this._extendAABB(me,C,M,x);if(!Ce)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Ce;const be=.5*s.at([],me.max,me.min)[2],Se=this._minimumAABBFrustumDistance(C,me),Ee=[0,0,1,0];s.aA(Ee,Ee,Te),s.eS(Ee,Ee);const Ue=s.c1([],Ee,Se+be),De=s.d5([],me.center,Ue);s.ad(me.center,me.center,we),s.ad(De,De,we);const dt=C.unproject(new s.P(me.center[0],me.center[1])),Je=s.eT(C.projection,dt),pt=Math.pow(2,Je),Pt=Math.min(C._zoomFromMercatorZ(De[2]*C.pixelsPerMeter*pt/C.worldSize),M.maxZoom);return C.mercatorFromTransition&&Pt<.5*(s.cX+s.cI)?(C.setProjection({name:"globe"}),C.zoom=Pt,this._cameraForBounds(C,u,g,x,b,E)):{center:dt,zoom:Pt,bearing:x,pitch:b}}fitBounds(o,u,g){const x=this.cameraForBounds(o,u);return this._fitInternal(x,u,g)}fitScreenCoordinates(o,u,g,x,b){const E=s.P.convert(o),C=s.P.convert(u),M=new s.P(Math.min(E.x,C.x),Math.min(E.y,C.y)),z=new s.P(Math.max(E.x,C.x),Math.max(E.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,C))return this;const F=this.transform.pointLocation3D(M),H=this.transform.pointLocation3D(z),$=this.transform.pointLocation3D(new s.P(M.x,z.y)),K=this.transform.pointLocation3D(new s.P(z.x,M.y)),te=[Math.min(F.lng,H.lng,$.lng,K.lng),Math.min(F.lat,H.lat,$.lat,K.lat)],ee=[Math.max(F.lng,H.lng,$.lng,K.lng),Math.max(F.lat,H.lat,$.lat,K.lat)],re=x&&x.pitch?x.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,te,ee,g,re,x);return this._fitInternal(ie,x,b)}_fitInternal(o,u,g){return o?(u=s.h(o,u)).linear?this.easeTo(u,g):this.flyTo(u,g):this}jumpTo(o,u){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,E=!1;"zoom"in o&&g.zoom!==+o.zoom&&(x=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=s.ci.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(b=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(E=!0,g.pitch=+o.pitch);const C=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!g.isPaddingEqual(C))if(o.retainPadding===!1){const M=g.clone();M.padding=C,g.setLocationAtPoint(g.center,M.centerPoint)}else g.padding=C;return o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new s.A("movestart",u)).fire(new s.A("move",u)),x&&this.fire(new s.A("zoomstart",u)).fire(new s.A("zoom",u)).fire(new s.A("zoomend",u)),b&&this.fire(new s.A("rotatestart",u)).fire(new s.A("rotate",u)).fire(new s.A("rotateend",u)),E&&this.fire(new s.A("pitchstart",u)).fire(new s.A("pitch",u)).fire(new s.A("pitchend",u)),this.fire(new s.A("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Mi),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return s.w(Mi),this;this.stop();const x=g.zoom,b=g.pitch,E=g.bearing;g.setFreeCameraOptions(o);const C=x!==g.zoom,M=b!==g.pitch,z=E!==g.bearing;return this.fire(new s.A("movestart",u)).fire(new s.A("move",u)),C&&this.fire(new s.A("zoomstart",u)).fire(new s.A("zoom",u)).fire(new s.A("zoomend",u)),z&&this.fire(new s.A("rotatestart",u)).fire(new s.A("rotate",u)).fire(new s.A("rotateend",u)),M&&this.fire(new s.A("pitchstart",u)).fire(new s.A("pitch",u)).fire(new s.A("pitchend",u)),this.fire(new s.A("moveend",u)),this}easeTo(o,u){this._stop(!1,o.easeId),((o=s.h({offset:[0,0],duration:500,easing:s.eK},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const g=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),C=this.getPadding(),M="zoom"in o?+o.zoom:x,z="bearing"in o?this._normalizeBearing(o.bearing,b):b,F="pitch"in o?+o.pitch:E,H=this._extendPadding(o.padding),$=s.P.convert(o.offset);let K,te,ee;if(g.projection.name==="globe"){const Ee=s.ac.fromLngLat(g.center),Ue=$.rotate(-g.angle);Ee.x+=Ue.x/g.worldSize,Ee.y+=Ue.y/g.worldSize;const De=Ee.toLngLat(),dt=s.ci.convert(o.center||De);this._normalizeCenter(dt),K=g.centerPoint.add(Ue),te=new s.P(Ee.x,Ee.y).mult(g.worldSize),ee=new s.P(s.aD(dt.lng),s.aH(dt.lat)).mult(g.worldSize).sub(te)}else{K=g.centerPoint.add($);const Ee=g.pointLocation(K),Ue=s.ci.convert(o.center||Ee);this._normalizeCenter(Ue),te=g.project(Ee),ee=g.project(Ue).sub(te)}const re=g.zoomScale(M-x);let ie,ue;o.around&&(ie=s.ci.convert(o.around),ue=g.locationPoint(ie));const pe=this._zooming||M!==x,me=this._rotating||b!==z,Te=this._pitching||F!==E,we=!g.isPaddingEqual(H),Ce=o.retainPadding===!1?g.clone():g,be=Ee=>Ue=>{if(pe&&(Ee.zoom=s.ai(x,M,Ue)),me&&(Ee.bearing=s.ai(b,z,Ue)),Te&&(Ee.pitch=s.ai(E,F,Ue)),we&&(Ce.interpolatePadding(C,H,Ue),K=Ce.centerPoint.add($)),ie)Ee.setLocationAtPoint(ie,ue);else{const De=Ee.zoomScale(Ee.zoom-x),dt=M>x?Math.min(2,re):Math.max(.5,re),Je=Math.pow(dt,1-Ue),pt=Ee.unproject(te.add(ee.mult(Ue*Je)).mult(De));Ee.setLocationAtPoint(Ee.renderWorldCopies?pt.wrap():pt,K)}return o.preloadOnly||this._fireMoveEvents(u),Ee};if(o.preloadOnly){const Ee=this._emulate(be,o.duration,g);return this._preloadTiles(Ee),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=me,this._pitching=Te,this._padding=we,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,Se),this._ease(be(g),Ee=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(u,Ee)},o),this}_prepareEase(o,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||g.moving||this.fire(new s.A("movestart",o)),this._zooming&&!g.zooming&&this.fire(new s.A("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new s.A("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new s.A("pitchstart",o))}_fireMoveEvents(o){this.fire(new s.A("move",o)),this._zooming&&this.fire(new s.A("zoom",o)),this._rotating&&this.fire(new s.A("rotate",o)),this._pitching&&this.fire(new s.A("pitch",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new s.A("zoomend",o)),x&&this.fire(new s.A("rotateend",o)),b&&this.fire(new s.A("pitchend",o)),this.fire(new s.A("moveend",o))}flyTo(o,u){if(this._prefersReducedMotion(o)){const Ze=s.aF(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ze,u)}this.stop(),o=s.h({offset:[0,0],speed:1.2,curve:1.42,easing:s.eK},o);const g=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),C=this.getPadding(),M="zoom"in o?s.ay(+o.zoom,g.minZoom,g.maxZoom):x,z="bearing"in o?this._normalizeBearing(o.bearing,b):b,F="pitch"in o?+o.pitch:E,H=this._extendPadding(o.padding),$=g.zoomScale(M-x),K=s.P.convert(o.offset);let te=g.centerPoint.add(K);const ee=g.pointLocation(te),re=s.ci.convert(o.center||ee);this._normalizeCenter(re);const ie=g.project(ee),ue=g.project(re).sub(ie);let pe=o.curve;const me=Math.max(g.width,g.height),Te=me/$,we=ue.mag();if("minZoom"in o){const Ze=s.ay(Math.min(o.minZoom,x,M),g.minZoom,g.maxZoom),yt=me/g.zoomScale(Ze-x);pe=Math.sqrt(yt/we*2)}const Ce=pe*pe;function be(Ze){const yt=(Te*Te-me*me+(Ze?-1:1)*Ce*Ce*we*we)/(2*(Ze?Te:me)*Ce*we);return Math.log(Math.sqrt(yt*yt+1)-yt)}function Se(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ee(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Ue=be(0);let De=function(Ze){return Ee(Ue)/Ee(Ue+pe*Ze)},dt=function(Ze){return me*((Ee(Ue)*(Se(yt=Ue+pe*Ze)/Ee(yt))-Se(Ue))/Ce)/we;var yt},Je=(be(1)-Ue)/pe;if(Math.abs(we)<1e-6||!isFinite(Je)){if(Math.abs(me-Te)<1e-6)return this.easeTo(o,u);const Ze=Te<me?-1:1;Je=Math.abs(Math.log(Te/me))/pe,dt=function(){return 0},De=function(yt){return Math.exp(Ze*pe*yt)}}o.duration="duration"in o?+o.duration:1e3*Je/("screenSpeed"in o?+o.screenSpeed/pe:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const pt=b!==z,Pt=F!==E,qe=!g.isPaddingEqual(H),Re=o.retainPadding===!1?g.clone():g,nt=Ze=>yt=>{const bt=yt*Je,Et=1/De(bt);Ze.zoom=yt===1?M:x+Ze.scaleZoom(Et),pt&&(Ze.bearing=s.ai(b,z,yt)),Pt&&(Ze.pitch=s.ai(E,F,yt)),qe&&(Re.interpolatePadding(C,H,yt),te=Re.centerPoint.add(K));const jt=yt===1?re:Ze.unproject(ie.add(ue.mult(dt(bt))).mult(Et));return Ze.setLocationAtPoint(Ze.renderWorldCopies?jt.wrap():jt,te),Ze._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(u),Ze};if(o.preloadOnly){const Ze=this._emulate(nt,o.duration,g);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=pt,this._pitching=Pt,this._padding=qe,this._prepareEase(u,!1),this._ease(nt(g),()=>this._afterEase(u),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,u,g){g.animate===!1||g.duration===0?(o(1),u()):(this._easeStart=s.q.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,u){o=s.bQ(o,-180,180);const g=Math.abs(o-u);return Math.abs(o-360-u)<g&&(o-=360),Math.abs(o+360-u)<g&&(o+=360),o}_normalizeCenter(o){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const g=o.lng-u.center.lng;o.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,u,g){const x=Math.ceil(15*u/1e3),b=[],E=o(g.clone());for(let C=0;C<=x;C++){const M=E(C/x);b.push(M.clone())}return b}_preloadTiles(o,u){}}class wd{constructor(o={}){this.options=o,s.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const u=this.options&&this.options.compact,g=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=N("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const x=N("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",g),this._innerContainer=N("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(o){const g=u.reduce((x,b,E)=>(b.value&&(x+=`${b.key}=${b.value}${E<u.length-1?"&":""}`),x),"?");o.href=`${s.e.FEEDBACK_URL}/${g}#${Rg(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const u=this._map.style._mergedSourceCaches;for(const x in u){const b=u[x];if(b.used){const E=b.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((x,b)=>x.length-b.length),o=o.filter((x,b)=>{for(let E=b+1;E<o.length;E++)if(o[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yp{constructor(){s.aV(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=N("div","mapboxgl-ctrl");const u=N("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const u in o){const g=o[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class O0{constructor(){s.aV(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",u=>this._onIndoorUpdate({selectedFloorId:u.selectedFloorId,floors:u.floors})),this._container}_createButton(o,u){const g=N("button",o,this._container);return g.type="button",g.addEventListener("click",u),g}_setButtonTitle(o,u){this._map&&(o.setAttribute("aria-label",u),o.innerHTML=`<strong>${u}</strong>`,o.firstElementChild&&o.firstElementChild.setAttribute("title",u))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return void(this._container.style.display="none");const u=this._model;this._model=o,this._container.style.display="inline-block";const g=o.floors.sort((x,b)=>x.levelOrder-b.levelOrder);u?(Array.from(this._container.children).forEach(x=>x.remove()),this.addCurrentFloors(g)):this.addCurrentFloors(g)}addCurrentFloors(o){for(const u of o){const g=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(u.id),Array.from(this._container.children).forEach(x=>{x.classList.remove("mapboxgl-ctrl-level-button-selected")}),g.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(g,u.shortName),this._model&&u.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(u.id),g.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(g)}}}class pS{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const x of g)if(x.id===o)return void(x.cancelled=!0)}run(o=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class _p{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const u=s.dx((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,u,g){this._start=this.getValue(u),this._end=o,this._startTime=u,this._endTime=u+g}}const JP={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class mS extends s.A{constructor(o,u,g,x){const{point:b,lngLat:E,originalEvent:C,target:M}=o;super(o.type,{point:b,lngLat:E,originalEvent:C,target:M}),this.preventDefault=()=>{o.preventDefault()},this.id=u,this.interaction=g,this.feature=x}}class j0{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,u){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const g=u.filter;let x=u.type;g&&this.filters.set(o,s.b3(g)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const b=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,u)):b.size===0&&this.map.on(x,this.handleType),b.size===0&&this.interactionsByType.set(x,b),b.set(o,u),this.typeById.set(o,x)}get(o){const u=this.typeById.get(o);if(!u)return;const g=this.interactionsByType.get(u);return g?g.get(o):void 0}remove(o){const u=this.typeById.get(o);if(!u)return;this.typeById.delete(o),this.filters.delete(o);const g=this.interactionsByType.get(u);g&&(g.delete(o),u==="mouseenter"||u==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(u,this.handleType))}queryTargets(o,u){const g=[];for(const[x,b]of u)b.target&&g.push({targetId:x,target:b.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(o,g,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const u=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());u.length&&(o.type="mouseenter",this.handleType(o,u));const g=new Map;for(const[x,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||g.set(b.id,b);g.size&&(o.type="mouseleave",this.handleType(o,Array.from(g.values())))}handleOut(o){const u=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);u.length&&(o.type="mouseleave",this.handleType(o,u)),this.hoveredFeatures.clear()}handleType(o,u){const g=o.type==="mouseenter";if(g&&!this.interactionsByType.has(o.type))return void s.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(o.type)).reverse(),b=!!u;u=u||this.queryTargets(o.point,x);let E=!1;const C=new Set;for(const M of u){for(const[z,F]of x){if(!F.target)continue;const H=M.variants?M.variants[z]:null;if(H){for(const $ of H){if(Vm($,M,C,z))continue;const K=new s.dr(M,$),te=jf($,M,z);b&&(K.state=this.map.getFeatureState(K));const ee=g?this.prevHoveredFeatures.get(te):null,re=new mS(o,z,F,K),ie=ee?ee.stop:F.handler(re);if(g&&this.hoveredFeatures.set(te,{feature:M,stop:ie}),ie!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[M,z]of x){const{handler:F,target:H}=z;if(!H&&F(new mS(o,M,z,null))!==!1)break}}}function R0(m,o){if(Array.isArray(m)&&Array.isArray(o)){const u=new Set(m),g=new Set(o);return u.size===g.size&&m.every(x=>g.has(x))}return s.bv(m,o)}const vp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Sd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yl{constructor(o,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new zg({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new k0({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),s.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(o,u){this.mouseRotate.mousedown(o,u),this.mousePitch&&this.mousePitch.mousedown(o,u),Y()}move(o,u){const g=this.map,x=this.mouseRotate.mousemoveWindow(o,u),b=x&&x.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const E=this.mousePitch.mousemoveWindow(o,u),C=E&&E.pitchDelta;C&&g.setPitch(g.getPitch()+C)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ne(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(s.h({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ge(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ge(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=je(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=je(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Oa(m,o,u){if(m=new s.ci(m.lng,m.lat),o){const g=new s.ci(m.lng-360,m.lat),x=new s.ci(m.lng+360,m.lat),b=360*Math.ceil(Math.abs(m.lng-u.center.lng)/360),E=u.locationPoint3D(m).distSqr(o),C=o.x<0||o.y<0||o.x>u.width||o.y>u.height;u.locationPoint3D(g).distSqr(o)<E&&(C||Math.abs(g.lng-u.center.lng)<b)?m=g:u.locationPoint3D(x).distSqr(o)<E&&(C||Math.abs(x.lng-u.center.lng)<b)&&(m=x)}for(;Math.abs(m.lng-u.center.lng)>180;){const g=u.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ho={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class la extends s.E{constructor(o,u){super(),(o instanceof HTMLElement||u)&&(o=s.h({element:o},u)),s.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:x="#3FB1CE",scale:b=1,draggable:E=!1,clickTolerance:C=0,rotation:M=ho.rotation,rotationAlignment:z=ho.rotationAlignment,pitchAlignment:F=ho.pitchAlignment,occludedOpacity:H=ho.occludedOpacity,altitude:$=ho.altitude}=o||{};this._anchor=g,this._color=x,this._scale=b,this._draggable=E,this._clickTolerance=C,this._rotation=M,this._rotationAlignment=z,this._pitchAlignment=F,this._occludedOpacity=H,this._altitude=$,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=s.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ee=>{ee.preventDefault()}),this._element.addEventListener("mousedown",ee=>{ee.preventDefault()});const K=this._element.classList;for(const ee in aa)K.remove(`mapboxgl-marker-anchor-${ee}`);K.add(`mapboxgl-marker-anchor-${this._anchor}`);const te=o&&o.className?o.className.trim().split(/\s+/):[];K.add(...te),this._popup=null}_createDefaultMarker(){const o=N("div"),u=G("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const g=G("radialGradient",{id:"shadowGradient"},G("defs",{},u));G("stop",{offset:"10%","stop-opacity":.4},g),G("stop",{offset:"100%","stop-opacity":.05},g),G("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u)}return G("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),G("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),G("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.ci.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||ho.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const u=o.code,g=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(o){const u=o.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,u=this._pos;if(!o||!u)return!1;const g=o.unproject(u,this._altitude),x=o.getFreeCameraOptions();if(!x.position)return!1;const b=x.position.toLngLat();return b.distanceTo(g)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const u=this._pos;if(!u||u.x<0||u.x>o.transform.width||u.y<0||u.y>o.transform.height)return void this._clearFadeTimer();const g=o.unproject(u,this._altitude);let x;o._showingGlobe()&&s.eW(o.transform,this._lngLat)?x=0:(x=1-o._queryFogOpacity(g),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${aa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const o=this._pos,u=this._map,g=this.getPitchAlignment();if(!u||!o||g!=="map")return"";if(!u._showingGlobe()){const M=u.getPitch();return M?`rotateX(${M}deg)`:""}const x=s.cU(s.eX(u.transform,this._lngLat)),b=o.sub(s.eY(u.transform)),E=Math.abs(b.x)+Math.abs(b.y);if(E===0)return"";const C=x/E;return`rotateX(${-b.y*C}deg) rotateY(${b.x*C}deg)`}_calculateZTransform(){const o=this._pos,u=this._map;if(!u||!o)return"";let g=0;const x=this.getRotationAlignment();if(x==="map")if(u._showingGlobe()){const b=u.project(new s.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=u.project(new s.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);g=s.cU(Math.atan2(E.y,E.x))-90}else g=-u.getBearing();else if(x==="horizon"){const b=s.af(4,6,u.getZoom()),E=s.eY(u.transform);E.y+=b*u.transform.height;const C=o.sub(E),M=s.cU(Math.atan2(C.y,C.x));g=(M>90?M-270:M+90)*(1-b)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Oa(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=s.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const u=this._map;if(!u)return;const g=this._pointerdownPos,x=this._positionDelta;if(g&&x){if(!this._isDragging){const b=this._clickTolerance||u._clickTolerance;if(o.point.dist(g)<b)return;this._isDragging=!0}this._pos=o.point.sub(x),this._lngLat=u.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(o){const u=this._map,g=this._pos;u&&g&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(g),this._pointerdownPos=o.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const u=this._map;return u&&(o?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||ho.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||ho.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||ho.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||ho.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const QP={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},eC={maxWidth:100,unit:"metric"},tC={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},rC={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},gS=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zs(m=new s.P(0,0),o="bottom"){if(typeof m=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(o){case"top":return new s.P(0,m);case"top-left":return new s.P(u,u);case"top-right":return new s.P(-u,u);case"bottom":return new s.P(0,-m);case"bottom-left":return new s.P(u,-u);case"bottom-right":return new s.P(-u,-u);case"left":return new s.P(m,0);case"right":return new s.P(-m,0)}return new s.P(0,0)}return m instanceof s.P||Array.isArray(m)?s.P.convert(m):s.P.convert(m[o]||[0,0])}return{version:v,supported:B.supported,setRTLTextPlugin:s.f0,getRTLTextPluginStatus:s.e$,Map:class extends bl{constructor(m){T.mark(w.create);const o=m;if((m=s.h({},vp,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&s.eU(window)&&(m.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Pv(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new pS,this._domRenderTaskQueue=new pS,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.a$(),this._locale=s.h({},JP,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new _p(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Oe(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const u=document.getElementById(m.container);if(!u)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=u}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,s.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new WP),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Vg(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||s.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new PP(this),m.hash&&(this._hash=new jg(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const u=m.bounds;u&&(this.resize(),this.fitBounds(u,s.h({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new wd({customAttribution:m.customAttribution})),this._logoControl=new yp,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new s.A(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new s.A(`${u.dataType}dataloading`,u))}),this._interactions=new j0(this)}_getMapId(){return this._mapId}addControl(m,o){if(o===void 0&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[o];return o.indexOf("bottom")!==-1?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new s.A("movestart",m)).fire(new s.A("move",m)),this.fire(new s.A("resize",m)),o&&this.fire(new s.A("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(s.aG.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(o=>o==="auto"?navigator.language:o):m}setLanguage(m){const o=this._parseLanguage(m);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,o=m.projection.name;let u;o==="globe"&&m.zoom>=s.cI?(m.setMercatorFromTransition(),u=!0):o==="mercator"&&m.zoom<s.cI&&(m.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,o){return this._updateProjection(m||o||{name:"mercator"})}_updateProjection(m){let o;return o=m.name==="globe"&&this.transform.zoom>=s.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,o){return this.transform.locationPoint3D(s.ci.convert(m),o)}unproject(m,o){return this.transform.pointLocation3D(s.P.convert(m),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,o,u){const g=x=>{let b=[];if(Array.isArray(o)){const E=o.filter(C=>this.getLayer(C));b=E.length?this.queryRenderedFeatures(x,{layers:E}):[]}else b=this.queryRenderedFeatures(x,{target:o});return b};if(m==="mouseenter"||m==="mouseover"){let x=!1;return{listener:u,targets:o,delegates:{mousemove:b=>{const E=g(b.point);E.length?x||(x=!0,u.call(this,new ii(m,this,b.originalEvent,{features:E}))):x=!1},mouseout:()=>{x=!1}}}}if(m==="mouseleave"||m==="mouseout"){let x=!1;return{listener:u,targets:o,delegates:{mousemove:b=>{g(b.point).length?x=!0:x&&(x=!1,u.call(this,new ii(m,this,b.originalEvent)))},mouseout:b=>{x&&(x=!1,u.call(this,new ii(m,this,b.originalEvent)))}}}}{const x=b=>{const E=g(b.point);E.length&&(b.features=E,u.call(this,b),delete b.features)};return{listener:u,targets:o,delegates:{[m]:x}}}}on(m,o,u){if(typeof o=="function"||u===void 0)return super.on(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._createDelegatedListener(m,o,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(m,o,u){if(typeof o=="function"||u===void 0)return super.once(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._createDelegatedListener(m,o,u);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(m,o,u){if(typeof o=="function"||u===void 0)return super.off(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(x=>{for(let b=0;b<x.length;b++){const E=x[b];if(E.listener===u&&R0(E.targets,o)){for(const C in E.delegates)this.off(C,E.delegates[C]);return x.splice(b,1),this}}})(g),this}queryRenderedFeatures(m,o){if(!this.style)return[];if(m===void 0||m instanceof s.P||Array.isArray(m)||o!==void 0||(o=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!o){const b=this.style.queryRenderedFeatures(m,void 0,this.transform),E=this.style.queryRenderedFeatureset(m,void 0,this.transform);return b.concat(E)}let u=!0;if(o.target&&(u=this._isTargetValid(o.target),u&&!o.layers))return this.style.queryRenderedFeatureset(m,o,this.transform);let g=!0;if(o.layers&&Array.isArray(o.layers)){for(const b of o.layers)if(!this._isValidId(b)){g=!1;break}if(g&&!o.target)return this.style.queryRenderedFeatures(m,o,this.transform)}let x=[];return g&&(x=x.concat(this.style.queryRenderedFeatures(m,o,this.transform))),u&&(x=x.concat(this.style.queryRenderedFeatureset(m,o,this.transform))),x}querySourceFeatures(m,o){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,o)}isPointOnSurface(m){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&s.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(m))}addInteraction(m,o){return this._interactions.add(m,o),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,o){return o=s.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&m&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(m,(u,g)=>{if(u){const x=typeof u=="string"?u:u instanceof Error?u.message:u.error;s.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(m,o)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(m,o))}_getUIString(m){const o=this._locale[m];if(o==null)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const u=s.h({},o);o&&o.config&&(u.initialConfig=o.config,delete u.config),this.style=new Ca(this,u).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.dk(m)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const o of m)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(m)}addSource(m,o){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,o,u){this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,u)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,o,{pixelRatio:u=1,sdf:g=!1,stretchX:x,stretchY:b,content:E}={}){this._lazyInitEmptyStyle();const C=s.I.from(m);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:M,height:z,data:F}=s.q.getImageData(o);this.style.addImage(C,{data:new s.r({width:M,height:z},F),pixelRatio:u,stretchX:x,stretchY:b,content:E,sdf:g,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:z}=o,F=o;this.style.addImage(C,{data:new s.r({width:M,height:z},new Uint8Array(F.data)),pixelRatio:u,stretchX:x,stretchY:b,content:E,sdf:g,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}updateImage(m,o){this._lazyInitEmptyStyle();const u=s.I.from(m),g=this.style.getImage(u);if(!g)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?s.q.getImageData(o):o,{width:b,height:E,data:C}=x;if(b===void 0||E===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||E!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${b}, ${E})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const M=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let z=!1;g.usvg?(g.data=new s.r({width:b,height:E},new Uint8Array(C)),g.usvg=!1,g.icon=void 0,z=!0):g.data.replace(C,M),this.style.updateImage(u,g,z)}hasImage(m){return m?!!this.style&&!!this.style.getImage(s.I.from(m)):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(s.I.from(m))}loadImage(m,o){s.o(this._requestManager.transformRequest(m,s.R.Image),(u,g)=>{o(u,g instanceof HTMLImageElement?s.q.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,o){this._lazyInitEmptyStyle(),this.style.addModel(m,o)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,o){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)):this}getSlot(m){const o=this.getLayer(m);return o&&o.slot||null}setSlot(m,o){return this.style.setSlot(m,o),this.style.mergeLayers(),this._update(!0)}addImport(m,o){return this.style.addImport(m,o).catch(u=>this.fire(new s.z(new Error("Failed to add import",u)))),this}updateImport(m,o){return typeof o!="string"&&o.id!==m?(this.removeImport(m),this.addImport(o)):(this.style.updateImport(m,o),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,o){return this.style.moveImport(m,o),this._update(!0)}moveLayer(m,o){return this._isValidId(m)?(this.style.moveLayer(m,o),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const o=this.style.getOwnLayer(m);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,o,u){return this._isValidId(m)?(this.style.setLayerZoomRange(m,o,u),this._update(!0)):this}setFilter(m,o,u={}){return this._isValidId(m)?(this.style.setFilter(m,o,u),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,o,u,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,o,u,g),this._update(!0)):this}getPaintProperty(m,o){return this._isValidId(m)?this.style.getPaintProperty(m,o):null}setLayoutProperty(m,o,u,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,o,u,g),this._update(!0)):this}getLayoutProperty(m,o){return this._isValidId(m)?this.style.getLayoutProperty(m,o):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,o){return this.style.setSchema(m,o),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,o){return this.style.setConfig(m,o),this._update(!0)}getConfigProperty(m,o){return this.style.getConfigProperty(m,o)}setConfigProperty(m,o,u){return this.style.setConfigProperty(m,o,u),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const o=m[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,o),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.ci.convert(m),this.transform):0}setFeatureState(m,o){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,o),this._update())}removeFeatureState(m,o){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,o),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.indoor.selectFloor(m)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new O0),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let u,g,x,b=this._container;for(;b&&(!g||!x);){const E=window.getComputedStyle(b).transform;E&&E!=="none"&&(u=E.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(g=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(x=u[3])),b=b.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=x?Math.abs(o/x):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=N("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=N("div","mapboxgl-canvas-container",m);this._canvas=N("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=N("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{g[x]=N("div",`mapboxgl-ctrl-${x}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o){const u=s.q.devicePixelRatio||1;this._canvas.width=u*Math.ceil(m),this._canvas.height=u*Math.ceil(o),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const o=this._markers.indexOf(m);o!==-1&&this._markers.splice(o,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const o=this._popups.indexOf(m);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const m=s.h({},B.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",m);o?(Vt(o,!0),this.painter=new Xc(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.l.testSupport(o)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let o;this.fire(new s.A("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,g=s.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=x.createQuery(),x.beginQuery(u.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,F=this.transform.pitch,H=s.q.now(),$=new s.aa(z,{now:H,fadeDuration:b,pitch:F,transition:this.style.transition,worldview:this._worldview});this.style.update($)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,T.mark(w.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const z=s.q.now()-g;x.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const F=x.getQueryParameter(o,x.QUERY_RESULT)/1e6;x.deleteQuery(o),this.fire(new s.A("gpu-timing-frame",{cpuTime:z,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(z);this.fire(new s.A("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(z);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:F}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(M||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,T.mark(w.fullLoad),this._performanceMetricsCollection&&br(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const o of this._markers)m&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!m||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(m,o=!1){const u=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(o||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const x=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const E=Math.abs(x-b);if(E>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(b),u(b);this._averageElevation.easeTo(b,m,300)}else if(E>1e-4)return this._averageElevation.jumpTo(b),u(b)}return!!this._averageElevation.isEasing(m)&&u(this._averageElevation.getValue(m))}_authenticate(){Qt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===Ye||m.status===401)){const o=this.painter.context.gl;Vt(o,!1),this._logoControl instanceof yp&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),xr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Er(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function x(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const E=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,E),E}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(x(m),o.canvasCopies.map(x),o.timeStamps)}_canvasPixelComparison(m,o,u){let g=u[1]-u[0];const x=m.length/4;for(let b=0;b<o.length;b++){const E=o[b];let C=0;for(let M=0;M<E.length;M+=4)E[M]===m[M]&&E[M+1]===m[M+1]&&E[M+2]===m[M+2]&&E[M+3]===m[M+3]&&(C+=1);g+=(u[b+2]-u[b+1])*(1-C/x)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Sr.delete(this.painter.context.gl),Yt.remove(),Ut.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=s.q.frame(o=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(o)}))}_preloadTiles(m){const o=this.style?this.style.getSourceCaches():[];return s.bt(o,(u,g)=>u._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,o){s.eV(m,o)}get version(){return v}},NavigationControl:class{constructor(m={}){this.options=s.h({},Sd,m),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(s.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),N("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),N("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:o}):u.resetNorth({},{originalEvent:o}))}),this._compassIcon=N("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const o=m.getZoom(),u=o===m.getMaxZoom(),g=o===m.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yl(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,o){const u=N("button",m,this._container);return u.type="button",u.addEventListener("click",o),u}_setButtonTitle(m,o){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${o}`);m.setAttribute("aria-label",u),m.firstElementChild&&m.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends s.E{constructor(m={}){super();const o=navigator.geolocation;this.options=s.h({geolocation:o},QP,m),s.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=gd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const o=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,m(u)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>o(u.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),u=m.coords;return!!o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",m)),this._finish()}}_updateCamera(m){const o=new s.ci(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,g=this._map.getBearing(),x=s.h({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(u),x,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new s.ci(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,o=s.cb(1,m._center.lat)*m.worldSize,u=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=N("button","mapboxgl-ctrl-geolocate",this._container),N("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N("div","mapboxgl-user-location"),this._dotElement.appendChild(N("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(N("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new la({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=N("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new la({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:wd,ScaleControl:class{constructor(m={}){this.options=s.h({},eC,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,o=this._map,u=o._containerHeight/2,g=o._containerWidth/2-m/2,x=o.unproject([g,u]),b=o.unproject([g+m,u]),E=x.distanceTo(b);if(this.options.unit==="imperial"){const C=3.2808*E;C>5280?this._setScale(m,C/5280,"mile"):this._setScale(m,C,"foot")}else this.options.unit==="nautical"?this._setScale(m,E/1852,"nautical-mile"):E>=1e3?this._setScale(m,E/1e3,"kilometer"):this._setScale(m,E,"meter")}_setScale(m,o,u){this._map._requestDomTask(()=>{const g=function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let C=b/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z}(C),E*C}(o),x=g/o;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(g):`${g}&nbsp;${tC[u]}`,this._container.style.width=m*x+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),s.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=N("button","mapboxgl-ctrl-fullscreen",this._controlContainer);N("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:O0,Popup:class extends s.E{constructor(m){super(),this.options=s.h(Object.create(rC),m),this._altitude=this.options.altitude,s.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=s.ci.convert(m),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const o=document.createDocumentFragment(),u=document.createElement("body");let g;for(u.innerHTML=m;g=u.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=N("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(m),this.options.closeButton){const u=this._closeButton=N("button","mapboxgl-popup-close-button",o);u.type="button",u.setAttribute("aria-label","Close popup"),u.innerHTML='<span aria-hidden="true">&#215;</span>',u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let o;return this._classList.delete(m)?o=!1:(this._classList.add(m),o=!0),this._updateClassList(),o}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const o=this._map,u=this._container,g=this._pos;if(!o||!u||!g)return"bottom";const x=u.offsetWidth,b=u.offsetHeight,E=g.x<x/2,C=g.x>o.transform.width-x/2;if(g.y+m<b)return E?"top-left":C?"top-right":"top";if(g.y>o.transform.height-b){if(E)return"bottom-left";if(C)return"bottom-right"}return E?"left":C?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),m.className=o.join(" ")}_update(m){const o=this._map,u=this._content;if(!o||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=N("div","mapboxgl-popup",o.getContainer()),this._tip=N("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Oa(this._lngLat,this._pos,o.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m instanceof s.P?m:o.project(this._lngLat,this._altitude),b=Zs(this.options.offset),E=this._anchor=this._getAnchor(b.y),C=Zs(this.options.offset,E),M=x.add(C).round();o._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${aa[E]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&o._showingGlobe()){const x=s.eW(o.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(gS);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:la,Style:Ca,LngLat:s.ci,LngLatBounds:s.aG,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:x1,Evented:s.E,config:s.e,prewarm:s.e_,clearPrewarmedResources:s.eZ,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(m){s.e.ACCESS_TOKEN=m},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(m){s.e.API_URL=m},get workerCount(){return s.f7.workerCount},set workerCount(m){s.f7.workerCount=m},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){s.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){s.f6(m)},get workerUrl(){return s.f5.workerUrl},set workerUrl(m){s.f5.workerUrl=m},get workerClass(){return s.f5.workerClass},set workerClass(m){s.f5.workerClass=m},get workerParams(){return s.f5.workerParams},set workerParams(m){s.f5.workerParams=m},get dracoUrl(){return s.f4()},set dracoUrl(m){s.f3(m)},get meshoptUrl(){return s.f2()},set meshoptUrl(m){s.f1(m)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var p=c;return p})})(aZ);var ppe=aZ.exports;const E2=ki(ppe),iV=e=>{let t;const r=new Set,n=(s,v)=>{const w=typeof s=="function"?s(t):s;if(!Object.is(w,t)){const T=t;t=v??(typeof w!="object"||w===null)?w:Object.assign({},t,w),r.forEach(I=>I(t,T))}},c=()=>t,h={setState:n,getState:c,getInitialState:()=>p,subscribe:s=>(r.add(s),()=>r.delete(s))},p=t=e(n,c,h);return h},mpe=e=>e?iV(e):iV,gpe=e=>e;function ype(e,t=gpe){const r=Ne.useSyncExternalStore(e.subscribe,Ne.useCallback(()=>t(e.getState()),[e,t]),Ne.useCallback(()=>t(e.getInitialState()),[e,t]));return Ne.useDebugValue(r),r}const sV=e=>{const t=mpe(e),r=n=>ype(t,n);return Object.assign(r,t),r},cZ=e=>e?sV(e):sV,_s=cZ((e,t)=>({preschools:[],filteredPreschools:[],selectedPreschool:null,searchFilters:{},isLoading:!1,mapCenter:[15.2,62.4],mapZoom:4.9,showClusters:!0,heatmapType:"density",heatmapIntensity:1,showHeatmap:!1,layerVisibility:{heatmap:!1,clusters:!0,markers:!0,communeBorders:!1},visiblePreschools:[],listContext:"viewport",listSortOrder:"distance",selectedCommune:null,statisticsData:null,showStatistics:!1,performanceMode:"high",searchBoxCollapsed:!1,listPanelCollapsed:!1,searchTerm:"",updatePreschool:r=>e(n=>({preschools:n.preschools.map(c=>c.id===r.id?r:c)})),setPreschools:r=>{console.log(`Setting ${r.length} preschools in store`),e({preschools:r}),t().applyFilters(),e({lastUpdated:Date.now()})},setFilteredPreschools:r=>e({filteredPreschools:r}),setSelectedPreschool:r=>e({selectedPreschool:r}),setSearchFilters:r=>{const n=t(),c={...n.searchFilters,...r};e({searchFilters:c}),n.applyFilters();const h=t();if(r.kommuner&&r.kommuner.length>0)if(r.kommuner.length===1){const p=r.kommuner[0],s=_pe(p);if(s)e({mapCenter:s,mapZoom:11});else{const v=h.filteredPreschools.filter(w=>w.kommun===p);if(v.length>0){const w=v.map(I=>I.latitud).filter(Boolean),T=v.map(I=>I.longitud).filter(Boolean);if(w.length>0){const I=w.reduce((U,V)=>U+V,0)/w.length,O=T.reduce((U,V)=>U+V,0)/T.length,D=Math.max(...w)-Math.min(...w),B=Math.max(...T)-Math.min(...T),N=Math.max(D,B);let G=12;N<.005?G=15:N<.01?G=14:N<.02?G=13:N<.05?G=12:G=11,e({mapCenter:[O,I],mapZoom:G})}}}}else{const p=h.filteredPreschools,s=p.map(w=>w.latitud).filter(Boolean),v=p.map(w=>w.longitud).filter(Boolean);if(s.length>0){const w=s.reduce((N,G)=>N+G,0)/s.length,T=v.reduce((N,G)=>N+G,0)/v.length,I=Math.max(...s)-Math.min(...s),O=Math.max(...v)-Math.min(...v),D=Math.max(I,O);let B=8;D<.05?B=11:D<.1?B=10:D<.3?B=9:D<.5?B=8:D<1?B=7:B=6,e({mapCenter:[T,w],mapZoom:B})}}else if(r.center&&r.nearbyMode)e({mapCenter:r.center,mapZoom:13});else if(r.query&&!r.kommuner){const p=h.filteredPreschools;if(p.length>0)if(p.length===1){const s=p[0];s.longitud&&s.latitud&&e({mapCenter:[s.longitud,s.latitud],mapZoom:15})}else{const s=p.map(w=>w.latitud).filter(Boolean),v=p.map(w=>w.longitud).filter(Boolean);if(s.length>0){const w=s.reduce((N,G)=>N+G,0)/s.length,T=v.reduce((N,G)=>N+G,0)/v.length,I=Math.max(...s)-Math.min(...s),O=Math.max(...v)-Math.min(...v),D=Math.max(I,O);let B=12;D<.005?B=15:D<.01?B=14:D<.02?B=13:D<.05?B=12:D<.1?B=11:B=10,e({mapCenter:[T,w],mapZoom:B})}}}else if(h.filteredPreschools.length>0&&Object.keys(c).length>0){const p=h.filteredPreschools,s=p.map(w=>w.latitud).filter(Boolean),v=p.map(w=>w.longitud).filter(Boolean);if(s.length>0&&v.length>0){const w=s.reduce((N,G)=>N+G,0)/s.length,T=v.reduce((N,G)=>N+G,0)/v.length,I=Math.max(...s)-Math.min(...s),O=Math.max(...v)-Math.min(...v),D=Math.max(I,O);let B=10;D<.01?B=15:D<.05?B=13:D<.1?B=11:D<.5?B=9:B=7,e({mapCenter:[T,w],mapZoom:B})}}},clearFilters:()=>{e({searchFilters:{},mapCenter:[15,62],mapZoom:5}),t().applyFilters()},clearSearchFilters:()=>{e({searchFilters:{},mapCenter:[15,62],mapZoom:5}),t().applyFilters()},clearSpecificFilter:r=>{const n=t(),c={...n.searchFilters};delete c[r],r==="nearbyMode"?(delete c.center,delete c.radius,e({searchFilters:c,mapCenter:[15,62],mapZoom:5})):e({searchFilters:c}),n.applyFilters()},get hasActiveFilters(){const r=t().searchFilters;return!!(r.kommuner&&r.kommuner.length>0||r.huvudman&&r.huvudman!=="alla"||r.maxChildren&&r.maxChildren<200||r.nearbyMode||r.radius&&r.center||r.query&&r.query.trim().length>0||r.minPersonaltäthet||r.maxPersonaltäthet||r.minExamen||r.maxExamen||r.minBarngrupper||r.maxBarngrupper||r.travelTime)},setLoading:r=>e({isLoading:r}),setMapCenter:r=>e({mapCenter:r}),setMapZoom:r=>e({mapZoom:r}),setShowClusters:r=>e({showClusters:r}),setHeatmapType:r=>e({heatmapType:r}),setHeatmapIntensity:r=>e({heatmapIntensity:r}),setShowHeatmap:r=>e({showHeatmap:r}),setLayerVisibility:(r,n)=>{e(c=>({layerVisibility:{...c.layerVisibility,[r]:n}}))},setSelectedCommune:r=>e({selectedCommune:r}),setStatisticsData:r=>e({statisticsData:r}),setShowStatistics:r=>e({showStatistics:r}),setVisiblePreschools:r=>e({visiblePreschools:r}),setListContext:r=>e({listContext:r}),setListSortOrder:r=>e({listSortOrder:r}),updateVisiblePreschoolsFromViewport:r=>{const{filteredPreschools:n,listSortOrder:c}=t(),h=n.filter(p=>{if(!p.latitud||!p.longitud)return!1;const s=p.latitud,v=p.longitud;return s>=r.south&&s<=r.north&&v>=r.west&&v<=r.east});if(h.length<1e3)switch(c){case"rating":h.sort((p,s)=>(s.google_rating||0)-(p.google_rating||0));break;case"name":h.sort((p,s)=>p.namn.localeCompare(s.namn));break;case"quality":h.sort((p,s)=>(s.andel_med_förskollärarexamen||0)-(p.andel_med_förskollärarexamen||0));break}e({visiblePreschools:h})},setPerformanceMode:r=>e({performanceMode:r}),setSearchBoxCollapsed:r=>e({searchBoxCollapsed:r}),setListPanelCollapsed:r=>e({listPanelCollapsed:r}),setSearchTerm:r=>e({searchTerm:r}),applyFilters:()=>{const{preschools:r,searchFilters:n}=t(),c=r.filter(h=>{if(n.query){const p=n.query.toLowerCase(),s=h.namn.toLowerCase().includes(p),v=h.kommun.toLowerCase().includes(p);if(!s&&!v)return!1}if(n.maxChildren&&h.antal_barn&&h.antal_barn>n.maxChildren||n.kommuner&&n.kommuner.length>0&&!n.kommuner.includes(h.kommun))return!1;if(n.huvudman){const p=n.huvudman==="Fristående"?"Enskild":n.huvudman;if(h.huvudman!==p)return!1}if(n.minPersonaltäthet&&(!h.personaltäthet||h.personaltäthet<n.minPersonaltäthet)||n.maxPersonaltäthet&&(!h.personaltäthet||h.personaltäthet>n.maxPersonaltäthet)||n.minExamen&&(!h.andel_med_förskollärarexamen||h.andel_med_förskollärarexamen<n.minExamen)||n.maxExamen&&(!h.andel_med_förskollärarexamen||h.andel_med_förskollärarexamen>n.maxExamen)||n.minBarngrupper&&h.antal_barngrupper<n.minBarngrupper||n.maxBarngrupper&&h.antal_barngrupper>n.maxBarngrupper)return!1;if(n.radius&&n.center){const[p,s]=Array.isArray(n.center)?n.center:"lng"in n.center?[n.center.lng,n.center.lat]:[n.center.lon,n.center.lat],v=oV(s,p,h.latitud,h.longitud),w=n.radius/1e3;if(v>w)return!1}if(n.travelTime){const p=n.travelTime.userLocation.lat,s=n.travelTime.userLocation.lng,v=oV(p,s,h.latitud,h.longitud),w={walking:5,bicycling:15,driving:30,transit:20}[n.travelTime.transportMode];if(v/w*60>n.travelTime.maxMinutes)return!1}return!0});e({filteredPreschools:c}),console.log(`🔍 Applied filters, ${c.length} preschools match criteria`)}}));function oV(e,t,r,n){const c=LT(r-e),h=LT(n-t),p=Math.sin(c/2)*Math.sin(c/2)+Math.cos(LT(e))*Math.cos(LT(r))*Math.sin(h/2)*Math.sin(h/2);return 6371*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))}function LT(e){return e*(Math.PI/180)}function _pe(e){return{Stockholm:[18.0686,59.3293],Göteborg:[11.9746,57.7089],Malmö:[13.0034,55.605],Uppsala:[17.6389,59.8585],Västerås:[16.5554,59.6099],Örebro:[15.2066,59.2741],Linköping:[15.6214,58.4108],Helsingborg:[12.6945,56.0465],Jönköping:[14.1618,57.7826],Norrköping:[16.1926,58.5877],Lund:[13.191,55.7047],Umeå:[20.263,63.8258],Gävle:[17.1414,60.6749],Borås:[12.9401,57.721],Eskilstuna:[16.5077,59.3706],Södertälje:[17.6253,59.1955],Karlstad:[13.5034,59.3793],Täby:[18.0631,59.4439],Växjö:[14.8059,56.8777],Halmstad:[12.858,56.6745],Sundsvall:[17.3063,62.3908],Luleå:[22.1567,65.5848],Trollhättan:[12.2886,58.2837],Östersund:[14.6357,63.1792],Borlänge:[15.4357,60.4858],Falun:[15.6356,60.6066],Skövde:[13.8454,58.3914],Karlskrona:[15.5866,56.1612],Kristianstad:[14.1591,56.0294],Kalmar:[16.3614,56.6634],Vänersborg:[12.3225,58.3789],Varberg:[12.2504,57.1057],Trelleborg:[13.1567,55.3753],Åkersberga:[18.2878,59.4797],Visby:[18.2948,57.6348],Mora:[14.5389,61.0088],Sandviken:[16.7725,60.6184],Kiruna:[20.2253,67.8558],Kungälv:[11.9746,57.8737],Partille:[11.9989,57.7396],Mölndal:[12.0134,57.6554],Lerum:[12.2691,57.7706],Stenungsund:[11.8263,58.0706],Ale:[12.0465,57.9378],Alingsås:[12.5344,57.9304],Vårgårda:[12.8162,58.0356],Herrljunga:[13.0239,58.0916],Tranemo:[13.3454,57.4886],Svenljunga:[13.1064,57.4976],Vara:[12.9584,58.2596],Götene:[13.4234,58.3896],Tibro:[12.5264,58.4236],Lidköping:[13.1577,58.5052],Mariestad:[13.8238,58.7096],Kungsbacka:[12.0784,57.4866]}[e]||null}const i3=Z.createContext({});function Xw(e){const t=Z.useRef(null);return t.current===null&&(t.current=e()),t.current}const s3=typeof window<"u",o3=s3?Z.useLayoutEffect:Z.useEffect,ik=Z.createContext(null);function a3(e,t){e.indexOf(t)===-1&&e.push(t)}function l3(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const Ch=(e,t,r)=>r>t?t:r<e?e:r;let c3=()=>{};const Ih={},uZ=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function hZ(e){return typeof e=="object"&&e!==null}const dZ=e=>/^0[^.\s]+$/u.test(e);function u3(e){let t;return()=>(t===void 0&&(t=e()),t)}const Dl=e=>e,vpe=(e,t)=>r=>t(e(r)),Yw=(...e)=>e.reduce(vpe),Qb=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n};class h3{constructor(){this.subscriptions=[]}add(t){return a3(this.subscriptions,t),()=>l3(this.subscriptions,t)}notify(t,r,n){const c=this.subscriptions.length;if(c)if(c===1)this.subscriptions[0](t,r,n);else for(let h=0;h<c;h++){const p=this.subscriptions[h];p&&p(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const xu=e=>e*1e3,bu=e=>e/1e3;function fZ(e,t){return t?e*(1e3/t):0}const pZ=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,xpe=1e-7,bpe=12;function wpe(e,t,r,n,c){let h,p,s=0;do p=t+(r-t)/2,h=pZ(p,n,c)-e,h>0?r=p:t=p;while(Math.abs(h)>xpe&&++s<bpe);return p}function Jw(e,t,r,n){if(e===t&&r===n)return Dl;const c=h=>wpe(h,0,1,e,r);return h=>h===0||h===1?h:pZ(c(h),t,n)}const mZ=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,gZ=e=>t=>1-e(1-t),yZ=Jw(.33,1.53,.69,.99),d3=gZ(yZ),_Z=mZ(d3),vZ=e=>(e*=2)<1?.5*d3(e):.5*(2-Math.pow(2,-10*(e-1))),f3=e=>1-Math.sin(Math.acos(e)),xZ=gZ(f3),bZ=mZ(f3),Spe=Jw(.42,0,1,1),Tpe=Jw(0,0,.58,1),wZ=Jw(.42,0,.58,1),Epe=e=>Array.isArray(e)&&typeof e[0]!="number",SZ=e=>Array.isArray(e)&&typeof e[0]=="number",Ape={linear:Dl,easeIn:Spe,easeInOut:wZ,easeOut:Tpe,circIn:f3,circInOut:bZ,circOut:xZ,backIn:d3,backInOut:_Z,backOut:yZ,anticipate:vZ},kpe=e=>typeof e=="string",aV=e=>{if(SZ(e)){c3(e.length===4);const[t,r,n,c]=e;return Jw(t,r,n,c)}else if(kpe(e))return Ape[e];return e},zT=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Ppe(e,t){let r=new Set,n=new Set,c=!1,h=!1;const p=new WeakSet;let s={delta:0,timestamp:0,isProcessing:!1};function v(T){p.has(T)&&(w.schedule(T),e()),T(s)}const w={schedule:(T,I=!1,O=!1)=>{const D=O&&c?r:n;return I&&p.add(T),D.has(T)||D.add(T),T},cancel:T=>{n.delete(T),p.delete(T)},process:T=>{if(s=T,c){h=!0;return}c=!0,[r,n]=[n,r],r.forEach(v),r.clear(),c=!1,h&&(h=!1,w.process(T))}};return w}const Cpe=40;function TZ(e,t){let r=!1,n=!0;const c={delta:0,timestamp:0,isProcessing:!1},h=()=>r=!0,p=zT.reduce((U,V)=>(U[V]=Ppe(h),U),{}),{setup:s,read:v,resolveKeyframes:w,preUpdate:T,update:I,preRender:O,render:D,postRender:B}=p,N=()=>{const U=Ih.useManualTiming?c.timestamp:performance.now();r=!1,Ih.useManualTiming||(c.delta=n?1e3/60:Math.max(Math.min(U-c.timestamp,Cpe),1)),c.timestamp=U,c.isProcessing=!0,s.process(c),v.process(c),w.process(c),T.process(c),I.process(c),O.process(c),D.process(c),B.process(c),c.isProcessing=!1,r&&t&&(n=!1,e(N))},G=()=>{r=!0,n=!0,c.isProcessing||e(N)};return{schedule:zT.reduce((U,V)=>{const X=p[V];return U[V]=(Y,ne=!1,ae=!1)=>(r||G(),X.schedule(Y,ne,ae)),U},{}),cancel:U=>{for(let V=0;V<zT.length;V++)p[zT[V]].cancel(U)},state:c,steps:p}}const{schedule:cs,cancel:Mh,state:Lo,steps:XI}=TZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Dl,!0);let A2;function Ipe(){A2=void 0}const Ua={now:()=>(A2===void 0&&Ua.set(Lo.isProcessing||Ih.useManualTiming?Lo.timestamp:performance.now()),A2),set:e=>{A2=e,queueMicrotask(Ipe)}},EZ=e=>t=>typeof t=="string"&&t.startsWith(e),p3=EZ("--"),Mpe=EZ("var(--"),m3=e=>Mpe(e)?Ope.test(e.split("/*")[0].trim()):!1,Ope=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,rv={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},ew={...rv,transform:e=>Ch(0,1,e)},NT={...rv,default:1},yb=e=>Math.round(e*1e5)/1e5,g3=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function jpe(e){return e==null}const Rpe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,y3=(e,t)=>r=>!!(typeof r=="string"&&Rpe.test(r)&&r.startsWith(e)||t&&!jpe(r)&&Object.prototype.hasOwnProperty.call(r,t)),AZ=(e,t,r)=>n=>{if(typeof n!="string")return n;const[c,h,p,s]=n.match(g3);return{[e]:parseFloat(c),[t]:parseFloat(h),[r]:parseFloat(p),alpha:s!==void 0?parseFloat(s):1}},Dpe=e=>Ch(0,255,e),YI={...rv,transform:e=>Math.round(Dpe(e))},Qp={test:y3("rgb","red"),parse:AZ("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+YI.transform(e)+", "+YI.transform(t)+", "+YI.transform(r)+", "+yb(ew.transform(n))+")"};function Lpe(e){let t="",r="",n="",c="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),c=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),c=e.substring(4,5),t+=t,r+=r,n+=n,c+=c),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:c?parseInt(c,16)/255:1}}const mj={test:y3("#"),parse:Lpe,transform:Qp.transform},Qw=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Bd=Qw("deg"),wu=Qw("%"),bn=Qw("px"),zpe=Qw("vh"),Npe=Qw("vw"),lV={...wu,parse:e=>wu.parse(e)/100,transform:e=>wu.transform(e*100)},Ly={test:y3("hsl","hue"),parse:AZ("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+wu.transform(yb(t))+", "+wu.transform(yb(r))+", "+yb(ew.transform(n))+")"},Fs={test:e=>Qp.test(e)||mj.test(e)||Ly.test(e),parse:e=>Qp.test(e)?Qp.parse(e):Ly.test(e)?Ly.parse(e):mj.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Qp.transform(e):Ly.transform(e),getAnimatableNone:e=>{const t=Fs.parse(e);return t.alpha=0,Fs.transform(t)}},Fpe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Bpe(e){return isNaN(e)&&typeof e=="string"&&(e.match(g3)?.length||0)+(e.match(Fpe)?.length||0)>0}const kZ="number",PZ="color",Vpe="var",Upe="var(",cV="${}",$pe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function tw(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},c=[];let h=0;const p=t.replace($pe,s=>(Fs.test(s)?(n.color.push(h),c.push(PZ),r.push(Fs.parse(s))):s.startsWith(Upe)?(n.var.push(h),c.push(Vpe),r.push(s)):(n.number.push(h),c.push(kZ),r.push(parseFloat(s))),++h,cV)).split(cV);return{values:r,split:p,indexes:n,types:c}}function CZ(e){return tw(e).values}function IZ(e){const{split:t,types:r}=tw(e),n=t.length;return c=>{let h="";for(let p=0;p<n;p++)if(h+=t[p],c[p]!==void 0){const s=r[p];s===kZ?h+=yb(c[p]):s===PZ?h+=Fs.transform(c[p]):h+=c[p]}return h}}const Gpe=e=>typeof e=="number"?0:Fs.test(e)?Fs.getAnimatableNone(e):e;function Hpe(e){const t=CZ(e);return IZ(e)(t.map(Gpe))}const _f={test:Bpe,parse:CZ,createTransformer:IZ,getAnimatableNone:Hpe};function JI(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Wpe({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let c=0,h=0,p=0;if(!t)c=h=p=r;else{const s=r<.5?r*(1+t):r+t-r*t,v=2*r-s;c=JI(v,s,e+1/3),h=JI(v,s,e),p=JI(v,s,e-1/3)}return{red:Math.round(c*255),green:Math.round(h*255),blue:Math.round(p*255),alpha:n}}function dE(e,t){return r=>r>0?t:e}const ms=(e,t,r)=>e+(t-e)*r,QI=(e,t,r)=>{const n=e*e,c=r*(t*t-n)+n;return c<0?0:Math.sqrt(c)},qpe=[mj,Qp,Ly],Zpe=e=>qpe.find(t=>t.test(e));function uV(e){const t=Zpe(e);if(!t)return!1;let r=t.parse(e);return t===Ly&&(r=Wpe(r)),r}const hV=(e,t)=>{const r=uV(e),n=uV(t);if(!r||!n)return dE(e,t);const c={...r};return h=>(c.red=QI(r.red,n.red,h),c.green=QI(r.green,n.green,h),c.blue=QI(r.blue,n.blue,h),c.alpha=ms(r.alpha,n.alpha,h),Qp.transform(c))},gj=new Set(["none","hidden"]);function Kpe(e,t){return gj.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function Xpe(e,t){return r=>ms(e,t,r)}function _3(e){return typeof e=="number"?Xpe:typeof e=="string"?m3(e)?dE:Fs.test(e)?hV:Qpe:Array.isArray(e)?MZ:typeof e=="object"?Fs.test(e)?hV:Ype:dE}function MZ(e,t){const r=[...e],n=r.length,c=e.map((h,p)=>_3(h)(h,t[p]));return h=>{for(let p=0;p<n;p++)r[p]=c[p](h);return r}}function Ype(e,t){const r={...e,...t},n={};for(const c in r)e[c]!==void 0&&t[c]!==void 0&&(n[c]=_3(e[c])(e[c],t[c]));return c=>{for(const h in n)r[h]=n[h](c);return r}}function Jpe(e,t){const r=[],n={color:0,var:0,number:0};for(let c=0;c<t.values.length;c++){const h=t.types[c],p=e.indexes[h][n[h]],s=e.values[p]??0;r[c]=s,n[h]++}return r}const Qpe=(e,t)=>{const r=_f.createTransformer(t),n=tw(e),c=tw(t);return n.indexes.var.length===c.indexes.var.length&&n.indexes.color.length===c.indexes.color.length&&n.indexes.number.length>=c.indexes.number.length?gj.has(e)&&!c.values.length||gj.has(t)&&!n.values.length?Kpe(e,t):Yw(MZ(Jpe(n,c),c.values),r):dE(e,t)};function OZ(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?ms(e,t,r):_3(e)(e,t)}const eme=e=>{const t=({timestamp:r})=>e(r);return{start:(r=!0)=>cs.update(t,r),stop:()=>Mh(t),now:()=>Lo.isProcessing?Lo.timestamp:Ua.now()}},jZ=(e,t,r=10)=>{let n="";const c=Math.max(Math.round(t/r),2);for(let h=0;h<c;h++)n+=Math.round(e(h/(c-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},fE=2e4;function v3(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<fE;)t+=r,n=e.next(t);return t>=fE?1/0:t}function tme(e,t=100,r){const n=r({...e,keyframes:[0,t]}),c=Math.min(v3(n),fE);return{type:"keyframes",ease:h=>n.next(c*h).value/t,duration:bu(c)}}const rme=5;function RZ(e,t,r){const n=Math.max(t-rme,0);return fZ(r-e(n),t-n)}const Ts={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},eM=.001;function nme({duration:e=Ts.duration,bounce:t=Ts.bounce,velocity:r=Ts.velocity,mass:n=Ts.mass}){let c,h,p=1-t;p=Ch(Ts.minDamping,Ts.maxDamping,p),e=Ch(Ts.minDuration,Ts.maxDuration,bu(e)),p<1?(c=w=>{const T=w*p,I=T*e,O=T-r,D=yj(w,p),B=Math.exp(-I);return eM-O/D*B},h=w=>{const T=w*p*e,I=T*r+r,O=Math.pow(p,2)*Math.pow(w,2)*e,D=Math.exp(-T),B=yj(Math.pow(w,2),p);return(-c(w)+eM>0?-1:1)*((I-O)*D)/B}):(c=w=>{const T=Math.exp(-w*e),I=(w-r)*e+1;return-eM+T*I},h=w=>{const T=Math.exp(-w*e),I=(r-w)*(e*e);return T*I});const s=5/e,v=sme(c,h,s);if(e=xu(e),isNaN(v))return{stiffness:Ts.stiffness,damping:Ts.damping,duration:e};{const w=Math.pow(v,2)*n;return{stiffness:w,damping:p*2*Math.sqrt(n*w),duration:e}}}const ime=12;function sme(e,t,r){let n=r;for(let c=1;c<ime;c++)n=n-e(n)/t(n);return n}function yj(e,t){return e*Math.sqrt(1-t*t)}const ome=["duration","bounce"],ame=["stiffness","damping","mass"];function dV(e,t){return t.some(r=>e[r]!==void 0)}function lme(e){let t={velocity:Ts.velocity,stiffness:Ts.stiffness,damping:Ts.damping,mass:Ts.mass,isResolvedFromDuration:!1,...e};if(!dV(e,ame)&&dV(e,ome))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(r*1.2),c=n*n,h=2*Ch(.05,1,1-(e.bounce||0))*Math.sqrt(c);t={...t,mass:Ts.mass,stiffness:c,damping:h}}else{const r=nme(e);t={...t,...r,mass:Ts.mass},t.isResolvedFromDuration=!0}return t}function pE(e=Ts.visualDuration,t=Ts.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:c}=r;const h=r.keyframes[0],p=r.keyframes[r.keyframes.length-1],s={done:!1,value:h},{stiffness:v,damping:w,mass:T,duration:I,velocity:O,isResolvedFromDuration:D}=lme({...r,velocity:-bu(r.velocity||0)}),B=O||0,N=w/(2*Math.sqrt(v*T)),G=p-h,U=bu(Math.sqrt(v/T)),V=Math.abs(G)<5;n||(n=V?Ts.restSpeed.granular:Ts.restSpeed.default),c||(c=V?Ts.restDelta.granular:Ts.restDelta.default);let X;if(N<1){const ne=yj(U,N);X=ae=>{const le=Math.exp(-N*U*ae);return p-le*((B+N*U*G)/ne*Math.sin(ne*ae)+G*Math.cos(ne*ae))}}else if(N===1)X=ne=>p-Math.exp(-U*ne)*(G+(B+U*G)*ne);else{const ne=U*Math.sqrt(N*N-1);X=ae=>{const le=Math.exp(-N*U*ae),ge=Math.min(ne*ae,300);return p-le*((B+N*U*G)*Math.sinh(ge)+ne*G*Math.cosh(ge))/ne}}const Y={calculatedDuration:D&&I||null,next:ne=>{const ae=X(ne);if(D)s.done=ne>=I;else{let le=ne===0?B:0;N<1&&(le=ne===0?xu(B):RZ(X,ne,ae));const ge=Math.abs(le)<=n,je=Math.abs(p-ae)<=c;s.done=ge&&je}return s.value=s.done?p:ae,s},toString:()=>{const ne=Math.min(v3(Y),fE),ae=jZ(le=>Y.next(ne*le).value,ne,30);return ne+"ms "+ae},toTransition:()=>{}};return Y}pE.applyToOptions=e=>{const t=tme(e,100,pE);return e.ease=t.ease,e.duration=xu(t.duration),e.type="keyframes",e};function _j({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:c=10,bounceStiffness:h=500,modifyTarget:p,min:s,max:v,restDelta:w=.5,restSpeed:T}){const I=e[0],O={done:!1,value:I},D=ge=>s!==void 0&&ge<s||v!==void 0&&ge>v,B=ge=>s===void 0?v:v===void 0||Math.abs(s-ge)<Math.abs(v-ge)?s:v;let N=r*t;const G=I+N,U=p===void 0?G:p(G);U!==G&&(N=U-I);const V=ge=>-N*Math.exp(-ge/n),X=ge=>U+V(ge),Y=ge=>{const je=V(ge),ze=X(ge);O.done=Math.abs(je)<=w,O.value=O.done?U:ze};let ne,ae;const le=ge=>{D(O.value)&&(ne=ge,ae=pE({keyframes:[O.value,B(O.value)],velocity:RZ(X,ge,O.value),damping:c,stiffness:h,restDelta:w,restSpeed:T}))};return le(0),{calculatedDuration:null,next:ge=>{let je=!1;return!ae&&ne===void 0&&(je=!0,Y(ge),le(ge)),ne!==void 0&&ge>=ne?ae.next(ge-ne):(!je&&Y(ge),O)}}}function cme(e,t,r){const n=[],c=r||Ih.mix||OZ,h=e.length-1;for(let p=0;p<h;p++){let s=c(e[p],e[p+1]);if(t){const v=Array.isArray(t)?t[p]||Dl:t;s=Yw(v,s)}n.push(s)}return n}function DZ(e,t,{clamp:r=!0,ease:n,mixer:c}={}){const h=e.length;if(c3(h===t.length),h===1)return()=>t[0];if(h===2&&t[0]===t[1])return()=>t[1];const p=e[0]===e[1];e[0]>e[h-1]&&(e=[...e].reverse(),t=[...t].reverse());const s=cme(t,n,c),v=s.length,w=T=>{if(p&&T<e[0])return t[0];let I=0;if(v>1)for(;I<e.length-2&&!(T<e[I+1]);I++);const O=Qb(e[I],e[I+1],T);return s[I](O)};return r?T=>w(Ch(e[0],e[h-1],T)):w}function ume(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const c=Qb(0,t,n);e.push(ms(r,1,c))}}function hme(e){const t=[0];return ume(t,e.length-1),t}function dme(e,t){return e.map(r=>r*t)}function fme(e,t){return e.map(()=>t||wZ).splice(0,e.length-1)}function _b({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const c=Epe(n)?n.map(aV):aV(n),h={done:!1,value:t[0]},p=dme(r&&r.length===t.length?r:hme(t),e),s=DZ(p,t,{ease:Array.isArray(c)?c:fme(t,c)});return{calculatedDuration:e,next:v=>(h.value=s(v),h.done=v>=e,h)}}const pme=e=>e!==null;function x3(e,{repeat:t,repeatType:r="loop"},n,c=1){const h=e.filter(pme),p=c<0||t&&r!=="loop"&&t%2===1?0:h.length-1;return!p||n===void 0?h[p]:n}const mme={decay:_j,inertia:_j,tween:_b,keyframes:_b,spring:pE};function LZ(e){typeof e.type=="string"&&(e.type=mme[e.type])}class b3{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,r){return this.finished.then(t,r)}}const gme=e=>e/100;class w3 extends b3{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==Ua.now()&&this.tick(Ua.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;LZ(t);const{type:r=_b,repeat:n=0,repeatDelay:c=0,repeatType:h,velocity:p=0}=t;let{keyframes:s}=t;const v=r||_b;v!==_b&&typeof s[0]!="number"&&(this.mixKeyframes=Yw(gme,OZ(s[0],s[1])),s=[0,100]);const w=v({...t,keyframes:s});h==="mirror"&&(this.mirroredGenerator=v({...t,keyframes:[...s].reverse(),velocity:-p})),w.calculatedDuration===null&&(w.calculatedDuration=v3(w));const{calculatedDuration:T}=w;this.calculatedDuration=T,this.resolvedDuration=T+c,this.totalDuration=this.resolvedDuration*(n+1)-c,this.generator=w}updateTime(t){const r=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(t,r=!1){const{generator:n,totalDuration:c,mixKeyframes:h,mirroredGenerator:p,resolvedDuration:s,calculatedDuration:v}=this;if(this.startTime===null)return n.next(0);const{delay:w=0,keyframes:T,repeat:I,repeatType:O,repeatDelay:D,type:B,onUpdate:N,finalKeyframe:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-c/this.speed,this.startTime)),r?this.currentTime=t:this.updateTime(t);const U=this.currentTime-w*(this.playbackSpeed>=0?1:-1),V=this.playbackSpeed>=0?U<0:U>c;this.currentTime=Math.max(U,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=c);let X=this.currentTime,Y=n;if(I){const ge=Math.min(this.currentTime,c)/s;let je=Math.floor(ge),ze=ge%1;!ze&&ge>=1&&(ze=1),ze===1&&je--,je=Math.min(je,I+1),je%2&&(O==="reverse"?(ze=1-ze,D&&(ze-=D/s)):O==="mirror"&&(Y=p)),X=Ch(0,1,ze)*s}const ne=V?{done:!1,value:T[0]}:Y.next(X);h&&(ne.value=h(ne.value));let{done:ae}=ne;!V&&v!==null&&(ae=this.playbackSpeed>=0?this.currentTime>=c:this.currentTime<=0);const le=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ae);return le&&B!==_j&&(ne.value=x3(T,this.options,G,this.speed)),N&&N(ne.value),le&&this.finish(),ne}then(t,r){return this.finished.then(t,r)}get duration(){return bu(this.calculatedDuration)}get time(){return bu(this.currentTime)}set time(t){t=xu(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(Ua.now());const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=bu(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=eme,startTime:r}=this.options;this.driver||(this.driver=t(c=>this.tick(c))),this.options.onPlay?.();const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=r??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Ua.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function yme(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const em=e=>e*180/Math.PI,vj=e=>{const t=em(Math.atan2(e[1],e[0]));return xj(t)},_me={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:vj,rotateZ:vj,skewX:e=>em(Math.atan(e[1])),skewY:e=>em(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},xj=e=>(e=e%360,e<0&&(e+=360),e),fV=vj,pV=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),mV=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),vme={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:pV,scaleY:mV,scale:e=>(pV(e)+mV(e))/2,rotateX:e=>xj(em(Math.atan2(e[6],e[5]))),rotateY:e=>xj(em(Math.atan2(-e[2],e[0]))),rotateZ:fV,rotate:fV,skewX:e=>em(Math.atan(e[4])),skewY:e=>em(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function bj(e){return e.includes("scale")?1:0}function wj(e,t){if(!e||e==="none")return bj(t);const r=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,c;if(r)n=vme,c=r;else{const s=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=_me,c=s}if(!c)return bj(t);const h=n[t],p=c[1].split(",").map(bme);return typeof h=="function"?h(p):p[h]}const xme=(e,t)=>{const{transform:r="none"}=getComputedStyle(e);return wj(r,t)};function bme(e){return parseFloat(e.trim())}const nv=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],iv=new Set(nv),gV=e=>e===rv||e===bn,wme=new Set(["x","y","z"]),Sme=nv.filter(e=>!wme.has(e));function Tme(e){const t=[];return Sme.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}const lm={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>wj(t,"x"),y:(e,{transform:t})=>wj(t,"y")};lm.translateX=lm.x;lm.translateY=lm.y;const cm=new Set;let Sj=!1,Tj=!1,Ej=!1;function zZ(){if(Tj){const e=Array.from(cm).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),r=new Map;t.forEach(n=>{const c=Tme(n);c.length&&(r.set(n,c),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const c=r.get(n);c&&c.forEach(([h,p])=>{n.getValue(h)?.set(p)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}Tj=!1,Sj=!1,cm.forEach(e=>e.complete(Ej)),cm.clear()}function NZ(){cm.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Tj=!0)})}function Eme(){Ej=!0,NZ(),zZ(),Ej=!1}class S3{constructor(t,r,n,c,h,p=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=n,this.motionValue=c,this.element=h,this.isAsync=p}scheduleResolve(){this.state="scheduled",this.isAsync?(cm.add(this),Sj||(Sj=!0,cs.read(NZ),cs.resolveKeyframes(zZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:n,motionValue:c}=this;if(t[0]===null){const h=c?.get(),p=t[t.length-1];if(h!==void 0)t[0]=h;else if(n&&r){const s=n.readValue(r,p);s!=null&&(t[0]=s)}t[0]===void 0&&(t[0]=p),c&&h===void 0&&c.set(t[0])}yme(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),cm.delete(this)}cancel(){this.state==="scheduled"&&(cm.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Ame=e=>e.startsWith("--");function kme(e,t,r){Ame(t)?e.style.setProperty(t,r):e.style[t]=r}const Pme=u3(()=>window.ScrollTimeline!==void 0),Cme={};function Ime(e,t){const r=u3(e);return()=>Cme[t]??r()}const FZ=Ime(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),rb=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,yV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:rb([0,.65,.55,1]),circOut:rb([.55,0,1,.45]),backIn:rb([.31,.01,.66,-.59]),backOut:rb([.33,1.53,.69,.99])};function BZ(e,t){if(e)return typeof e=="function"?FZ()?jZ(e,t):"ease-out":SZ(e)?rb(e):Array.isArray(e)?e.map(r=>BZ(r,t)||yV.easeOut):yV[e]}function Mme(e,t,r,{delay:n=0,duration:c=300,repeat:h=0,repeatType:p="loop",ease:s="easeOut",times:v}={},w=void 0){const T={[t]:r};v&&(T.offset=v);const I=BZ(s,c);Array.isArray(I)&&(T.easing=I);const O={delay:n,duration:c,easing:Array.isArray(I)?"linear":I,fill:"both",iterations:h+1,direction:p==="reverse"?"alternate":"normal"};return w&&(O.pseudoElement=w),e.animate(T,O)}function VZ(e){return typeof e=="function"&&"applyToOptions"in e}function Ome({type:e,...t}){return VZ(e)&&FZ()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class jme extends b3{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:r,name:n,keyframes:c,pseudoElement:h,allowFlatten:p=!1,finalKeyframe:s,onComplete:v}=t;this.isPseudoElement=!!h,this.allowFlatten=p,this.options=t,c3(typeof t.type!="string");const w=Ome(t);this.animation=Mme(r,n,c,w,h),w.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!h){const T=x3(c,this.options,s,this.speed);this.updateMotionValue?this.updateMotionValue(T):kme(r,n,T),this.animation.cancel()}v?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return bu(Number(t))}get time(){return bu(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=xu(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&Pme()?(this.animation.timeline=t,Dl):r(this)}}const UZ={anticipate:vZ,backInOut:_Z,circInOut:bZ};function Rme(e){return e in UZ}function Dme(e){typeof e.ease=="string"&&Rme(e.ease)&&(e.ease=UZ[e.ease])}const _V=10;class Lme extends jme{constructor(t){Dme(t),LZ(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:r,onUpdate:n,onComplete:c,element:h,...p}=this.options;if(!r)return;if(t!==void 0){r.set(t);return}const s=new w3({...p,autoplay:!1}),v=xu(this.finishedTime??this.time);r.setWithVelocity(s.sample(v-_V).value,s.sample(v).value,_V),s.stop()}}const vV=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(_f.test(e)||e==="0")&&!e.startsWith("url("));function zme(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function Nme(e,t,r,n){const c=e[0];if(c===null)return!1;if(t==="display"||t==="visibility")return!0;const h=e[e.length-1],p=vV(c,t),s=vV(h,t);return!p||!s?!1:zme(e)||(r==="spring"||VZ(r))&&n}function Aj(e){e.duration=0,e.type}const Fme=new Set(["opacity","clipPath","filter","transform"]),Bme=u3(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Vme(e){const{motionValue:t,name:r,repeatDelay:n,repeatType:c,damping:h,type:p}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:s,transformTemplate:v}=t.owner.getProps();return Bme()&&r&&Fme.has(r)&&(r!=="transform"||!v)&&!s&&!n&&c!=="mirror"&&h!==0&&p!=="inertia"}const Ume=40;class $me extends b3{constructor({autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:c=0,repeatDelay:h=0,repeatType:p="loop",keyframes:s,name:v,motionValue:w,element:T,...I}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Ua.now();const O={autoplay:t,delay:r,type:n,repeat:c,repeatDelay:h,repeatType:p,name:v,motionValue:w,element:T,...I},D=T?.KeyframeResolver||S3;this.keyframeResolver=new D(s,(B,N,G)=>this.onKeyframesResolved(B,N,O,!G),v,w,T),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,r,n,c){this.keyframeResolver=void 0;const{name:h,type:p,velocity:s,delay:v,isHandoff:w,onUpdate:T}=n;this.resolvedAt=Ua.now(),Nme(t,h,p,s)||((Ih.instantAnimations||!v)&&T?.(x3(t,n,r)),t[0]=t[t.length-1],Aj(n),n.repeat=0);const I={startTime:c?this.resolvedAt?this.resolvedAt-this.createdAt>Ume?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...n,keyframes:t},O=!w&&Vme(I)?new Lme({...I,element:I.motionValue.owner.current}):new w3(I);O.finished.then(()=>this.notifyFinished()).catch(Dl),this.pendingTimeline&&(this.stopTimeline=O.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=O}get finished(){return this._animation?this.animation.finished:this._finished}then(t,r){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Eme()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const Gme=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Hme(e){const t=Gme.exec(e);if(!t)return[,];const[,r,n,c]=t;return[`--${r??n}`,c]}function $Z(e,t,r=1){const[n,c]=Hme(e);if(!n)return;const h=window.getComputedStyle(t).getPropertyValue(n);if(h){const p=h.trim();return uZ(p)?parseFloat(p):p}return m3(c)?$Z(c,t,r+1):c}function T3(e,t){return e?.[t]??e?.default??e}const GZ=new Set(["width","height","top","left","right","bottom",...nv]),Wme={test:e=>e==="auto",parse:e=>e},HZ=e=>t=>t.test(e),WZ=[rv,bn,wu,Bd,Npe,zpe,Wme],xV=e=>WZ.find(HZ(e));function qme(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||dZ(e):!0}const Zme=new Set(["brightness","contrast","saturate","opacity"]);function Kme(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(g3)||[];if(!n)return e;const c=r.replace(n,"");let h=Zme.has(t)?1:0;return n!==r&&(h*=100),t+"("+h+c+")"}const Xme=/\b([a-z-]*)\(.*?\)/gu,kj={..._f,getAnimatableNone:e=>{const t=e.match(Xme);return t?t.map(Kme).join(" "):e}},bV={...rv,transform:Math.round},Yme={rotate:Bd,rotateX:Bd,rotateY:Bd,rotateZ:Bd,scale:NT,scaleX:NT,scaleY:NT,scaleZ:NT,skew:Bd,skewX:Bd,skewY:Bd,distance:bn,translateX:bn,translateY:bn,translateZ:bn,x:bn,y:bn,z:bn,perspective:bn,transformPerspective:bn,opacity:ew,originX:lV,originY:lV,originZ:bn},E3={borderWidth:bn,borderTopWidth:bn,borderRightWidth:bn,borderBottomWidth:bn,borderLeftWidth:bn,borderRadius:bn,radius:bn,borderTopLeftRadius:bn,borderTopRightRadius:bn,borderBottomRightRadius:bn,borderBottomLeftRadius:bn,width:bn,maxWidth:bn,height:bn,maxHeight:bn,top:bn,right:bn,bottom:bn,left:bn,padding:bn,paddingTop:bn,paddingRight:bn,paddingBottom:bn,paddingLeft:bn,margin:bn,marginTop:bn,marginRight:bn,marginBottom:bn,marginLeft:bn,backgroundPositionX:bn,backgroundPositionY:bn,...Yme,zIndex:bV,fillOpacity:ew,strokeOpacity:ew,numOctaves:bV},Jme={...E3,color:Fs,backgroundColor:Fs,outlineColor:Fs,fill:Fs,stroke:Fs,borderColor:Fs,borderTopColor:Fs,borderRightColor:Fs,borderBottomColor:Fs,borderLeftColor:Fs,filter:kj,WebkitFilter:kj},qZ=e=>Jme[e];function ZZ(e,t){let r=qZ(e);return r!==kj&&(r=_f),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const Qme=new Set(["auto","none","0"]);function ege(e,t,r){let n=0,c;for(;n<e.length&&!c;){const h=e[n];typeof h=="string"&&!Qme.has(h)&&tw(h).values.length&&(c=e[n]),n++}if(c&&r)for(const h of t)e[h]=ZZ(r,c)}class tge extends S3{constructor(t,r,n,c,h){super(t,r,n,c,h,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let w=t[v];if(typeof w=="string"&&(w=w.trim(),m3(w))){const T=$Z(w,r.current);T!==void 0&&(t[v]=T),v===t.length-1&&(this.finalKeyframe=w)}}if(this.resolveNoneKeyframes(),!GZ.has(n)||t.length!==2)return;const[c,h]=t,p=xV(c),s=xV(h);if(p!==s)if(gV(p)&&gV(s))for(let v=0;v<t.length;v++){const w=t[v];typeof w=="string"&&(t[v]=parseFloat(w))}else lm[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,n=[];for(let c=0;c<t.length;c++)(t[c]===null||qme(t[c]))&&n.push(c);n.length&&ege(t,n,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=lm[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const c=r[r.length-1];c!==void 0&&t.getValue(n,c).jump(c,!1)}measureEndState(){const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const c=t.getValue(r);c&&c.jump(this.measuredOrigin,!1);const h=n.length-1,p=n[h];n[h]=lm[r](t.measureViewportBox(),window.getComputedStyle(t.current)),p!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=p),this.removedTransforms?.length&&this.removedTransforms.forEach(([s,v])=>{t.getValue(s).set(v)}),this.resolveNoneKeyframes()}}function rge(e,t,r){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const n=document.querySelectorAll(e);return n?Array.from(n):[]}return Array.from(e)}const KZ=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function XZ(e){return hZ(e)&&"offsetHeight"in e}const wV=30,nge=e=>!isNaN(parseFloat(e)),vb={current:void 0};class ige{constructor(t,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{const c=Ua.now();if(this.updatedAt!==c&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const h of this.dependents)h.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=Ua.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=nge(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new h3);const n=this.events[t].add(r);return t==="change"?()=>{n(),cs.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return vb.current&&vb.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const t=Ua.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>wV)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,wV);return fZ(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function vm(e,t){return new ige(e,t)}const{schedule:A3}=TZ(queueMicrotask,!1),ac={x:!1,y:!1};function YZ(){return ac.x||ac.y}function sge(e){return e==="x"||e==="y"?ac[e]?null:(ac[e]=!0,()=>{ac[e]=!1}):ac.x||ac.y?null:(ac.x=ac.y=!0,()=>{ac.x=ac.y=!1})}function JZ(e,t){const r=rge(e),n=new AbortController,c={passive:!0,...t,signal:n.signal};return[r,c,()=>n.abort()]}function SV(e){return!(e.pointerType==="touch"||YZ())}function oge(e,t,r={}){const[n,c,h]=JZ(e,r),p=s=>{if(!SV(s))return;const{target:v}=s,w=t(v,s);if(typeof w!="function"||!v)return;const T=I=>{SV(I)&&(w(I),v.removeEventListener("pointerleave",T))};v.addEventListener("pointerleave",T,c)};return n.forEach(s=>{s.addEventListener("pointerenter",p,c)}),h}const QZ=(e,t)=>t?e===t?!0:QZ(e,t.parentElement):!1,k3=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,age=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function lge(e){return age.has(e.tagName)||e.tabIndex!==-1}const k2=new WeakSet;function TV(e){return t=>{t.key==="Enter"&&e(t)}}function tM(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const cge=(e,t)=>{const r=e.currentTarget;if(!r)return;const n=TV(()=>{if(k2.has(r))return;tM(r,"down");const c=TV(()=>{tM(r,"up")}),h=()=>tM(r,"cancel");r.addEventListener("keyup",c,t),r.addEventListener("blur",h,t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function EV(e){return k3(e)&&!YZ()}function uge(e,t,r={}){const[n,c,h]=JZ(e,r),p=s=>{const v=s.currentTarget;if(!EV(s))return;k2.add(v);const w=t(v,s),T=(D,B)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",O),k2.has(v)&&k2.delete(v),EV(D)&&typeof w=="function"&&w(D,{success:B})},I=D=>{T(D,v===window||v===document||r.useGlobalTarget||QZ(v,D.target))},O=D=>{T(D,!1)};window.addEventListener("pointerup",I,c),window.addEventListener("pointercancel",O,c)};return n.forEach(s=>{(r.useGlobalTarget?window:s).addEventListener("pointerdown",p,c),XZ(s)&&(s.addEventListener("focus",v=>cge(v,c)),!lge(s)&&!s.hasAttribute("tabindex")&&(s.tabIndex=0))}),h}function eK(e){return hZ(e)&&"ownerSVGElement"in e}function hge(e){return eK(e)&&e.tagName==="svg"}function dge(...e){const t=!Array.isArray(e[0]),r=t?0:-1,n=e[0+r],c=e[1+r],h=e[2+r],p=e[3+r],s=DZ(c,h,p);return t?s(n):s}const ea=e=>!!(e&&e.getVelocity),fge=[...WZ,Fs,_f],pge=e=>fge.find(HZ(e)),sk=Z.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class mge extends Z.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=r.offsetParent,c=XZ(n)&&n.offsetWidth||0,h=this.props.sizeRef.current;h.height=r.offsetHeight||0,h.width=r.offsetWidth||0,h.top=r.offsetTop,h.left=r.offsetLeft,h.right=c-h.width-h.left}return null}componentDidUpdate(){}render(){return this.props.children}}function gge({children:e,isPresent:t,anchorX:r,root:n}){const c=Z.useId(),h=Z.useRef(null),p=Z.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:s}=Z.useContext(sk);return Z.useInsertionEffect(()=>{const{width:v,height:w,top:T,left:I,right:O}=p.current;if(t||!h.current||!v||!w)return;const D=r==="left"?`left: ${I}`:`right: ${O}`;h.current.dataset.motionPopId=c;const B=document.createElement("style");s&&(B.nonce=s);const N=n??document.head;return N.appendChild(B),B.sheet&&B.sheet.insertRule(`
          [data-motion-pop-id="${c}"] {
            position: absolute !important;
            width: ${v}px !important;
            height: ${w}px !important;
            ${D}px !important;
            top: ${T}px !important;
          }
        `),()=>{N.contains(B)&&N.removeChild(B)}},[t]),P.jsx(mge,{isPresent:t,childRef:h,sizeRef:p,children:Z.cloneElement(e,{ref:h})})}const yge=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:c,presenceAffectsLayout:h,mode:p,anchorX:s,root:v})=>{const w=Xw(_ge),T=Z.useId();let I=!0,O=Z.useMemo(()=>(I=!1,{id:T,initial:t,isPresent:r,custom:c,onExitComplete:D=>{w.set(D,!0);for(const B of w.values())if(!B)return;n&&n()},register:D=>(w.set(D,!1),()=>w.delete(D))}),[r,w,n]);return h&&I&&(O={...O}),Z.useMemo(()=>{w.forEach((D,B)=>w.set(B,!1))},[r]),Z.useEffect(()=>{!r&&!w.size&&n&&n()},[r]),p==="popLayout"&&(e=P.jsx(gge,{isPresent:r,anchorX:s,root:v,children:e})),P.jsx(ik.Provider,{value:O,children:e})};function _ge(){return new Map}function tK(e=!0){const t=Z.useContext(ik);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:c}=t,h=Z.useId();Z.useEffect(()=>{if(e)return c(h)},[e]);const p=Z.useCallback(()=>e&&n&&n(h),[h,n,e]);return!r&&n?[!1,p]:[!0]}const FT=e=>e.key||"";function AV(e){const t=[];return Z.Children.forEach(e,r=>{Z.isValidElement(r)&&t.push(r)}),t}const Tc=({children:e,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:c=!0,mode:h="sync",propagate:p=!1,anchorX:s="left",root:v})=>{const[w,T]=tK(p),I=Z.useMemo(()=>AV(e),[e]),O=p&&!w?[]:I.map(FT),D=Z.useRef(!0),B=Z.useRef(I),N=Xw(()=>new Map),[G,U]=Z.useState(I),[V,X]=Z.useState(I);o3(()=>{D.current=!1,B.current=I;for(let ae=0;ae<V.length;ae++){const le=FT(V[ae]);O.includes(le)?N.delete(le):N.get(le)!==!0&&N.set(le,!1)}},[V,O.length,O.join("-")]);const Y=[];if(I!==G){let ae=[...I];for(let le=0;le<V.length;le++){const ge=V[le],je=FT(ge);O.includes(je)||(ae.splice(le,0,ge),Y.push(ge))}return h==="wait"&&Y.length&&(ae=Y),X(AV(ae)),U(I),null}const{forceRender:ne}=Z.useContext(i3);return P.jsx(P.Fragment,{children:V.map(ae=>{const le=FT(ae),ge=p&&!w?!1:I===V||O.includes(le),je=()=>{if(N.has(le))N.set(le,!0);else return;let ze=!0;N.forEach(Pe=>{Pe||(ze=!1)}),ze&&(ne?.(),X(B.current),p&&T?.(),n&&n())};return P.jsx(yge,{isPresent:ge,initial:!D.current||r?void 0:!1,custom:t,presenceAffectsLayout:c,mode:h,root:v,onExitComplete:ge?void 0:je,anchorX:s,children:ae},le)})})},rK=Z.createContext({strict:!1}),kV={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},v_={};for(const e in kV)v_[e]={isEnabled:t=>kV[e].some(r=>!!t[r])};function vge(e){for(const t in e)v_[t]={...v_[t],...e[t]}}const xge=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function mE(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||xge.has(e)}let nK=e=>!mE(e);function bge(e){typeof e=="function"&&(nK=t=>t.startsWith("on")?!mE(t):e(t))}try{bge(require("@emotion/is-prop-valid").default)}catch{}function wge(e,t,r){const n={};for(const c in e)c==="values"&&typeof e.values=="object"||(nK(c)||r===!0&&mE(c)||!t&&!mE(c)||e.draggable&&c.startsWith("onDrag"))&&(n[c]=e[c]);return n}const ok=Z.createContext({});function ak(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function rw(e){return typeof e=="string"||Array.isArray(e)}const P3=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],C3=["initial",...P3];function lk(e){return ak(e.animate)||C3.some(t=>rw(e[t]))}function iK(e){return!!(lk(e)||e.variants)}function Sge(e,t){if(lk(e)){const{initial:r,animate:n}=e;return{initial:r===!1||rw(r)?r:void 0,animate:rw(n)?n:void 0}}return e.inherit!==!1?t:{}}function Tge(e){const{initial:t,animate:r}=Sge(e,Z.useContext(ok));return Z.useMemo(()=>({initial:t,animate:r}),[PV(t),PV(r)])}function PV(e){return Array.isArray(e)?e.join(" "):e}const nw={};function Ege(e){for(const t in e)nw[t]=e[t],p3(t)&&(nw[t].isCSSVariable=!0)}function sK(e,{layout:t,layoutId:r}){return iv.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!nw[e]||e==="opacity")}const Age={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},kge=nv.length;function Pge(e,t,r){let n="",c=!0;for(let h=0;h<kge;h++){const p=nv[h],s=e[p];if(s===void 0)continue;let v=!0;if(typeof s=="number"?v=s===(p.startsWith("scale")?1:0):v=parseFloat(s)===0,!v||r){const w=KZ(s,E3[p]);if(!v){c=!1;const T=Age[p]||p;n+=`${T}(${w}) `}r&&(t[p]=w)}}return n=n.trim(),r?n=r(t,c?"":n):c&&(n="none"),n}function I3(e,t,r){const{style:n,vars:c,transformOrigin:h}=e;let p=!1,s=!1;for(const v in t){const w=t[v];if(iv.has(v)){p=!0;continue}else if(p3(v)){c[v]=w;continue}else{const T=KZ(w,E3[v]);v.startsWith("origin")?(s=!0,h[v]=T):n[v]=T}}if(t.transform||(p||r?n.transform=Pge(t,e.transform,r):n.transform&&(n.transform="none")),s){const{originX:v="50%",originY:w="50%",originZ:T=0}=h;n.transformOrigin=`${v} ${w} ${T}`}}const M3=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function oK(e,t,r){for(const n in t)!ea(t[n])&&!sK(n,r)&&(e[n]=t[n])}function Cge({transformTemplate:e},t){return Z.useMemo(()=>{const r=M3();return I3(r,t,e),Object.assign({},r.vars,r.style)},[t])}function Ige(e,t){const r=e.style||{},n={};return oK(n,r,e),Object.assign(n,Cge(e,t)),n}function Mge(e,t){const r={},n=Ige(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const Oge={offset:"stroke-dashoffset",array:"stroke-dasharray"},jge={offset:"strokeDashoffset",array:"strokeDasharray"};function Rge(e,t,r=1,n=0,c=!0){e.pathLength=1;const h=c?Oge:jge;e[h.offset]=bn.transform(-n);const p=bn.transform(t),s=bn.transform(r);e[h.array]=`${p} ${s}`}function aK(e,{attrX:t,attrY:r,attrScale:n,pathLength:c,pathSpacing:h=1,pathOffset:p=0,...s},v,w,T){if(I3(e,s,w),v){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:I,style:O}=e;I.transform&&(O.transform=I.transform,delete I.transform),(O.transform||I.transformOrigin)&&(O.transformOrigin=I.transformOrigin??"50% 50%",delete I.transformOrigin),O.transform&&(O.transformBox=T?.transformBox??"fill-box",delete I.transformBox),t!==void 0&&(I.x=t),r!==void 0&&(I.y=r),n!==void 0&&(I.scale=n),c!==void 0&&Rge(I,c,h,p,!1)}const lK=()=>({...M3(),attrs:{}}),cK=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Dge(e,t,r,n){const c=Z.useMemo(()=>{const h=lK();return aK(h,t,cK(n),e.transformTemplate,e.style),{...h.attrs,style:{...h.style}}},[t]);if(e.style){const h={};oK(h,e.style,e),c.style={...h,...c.style}}return c}const Lge=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function O3(e){return typeof e!="string"||e.includes("-")?!1:!!(Lge.indexOf(e)>-1||/[A-Z]/u.test(e))}function zge(e,t,r,{latestValues:n},c,h=!1){const p=(O3(e)?Dge:Mge)(t,n,c,e),s=wge(t,typeof e=="string",h),v=e!==Z.Fragment?{...s,...p,ref:r}:{},{children:w}=t,T=Z.useMemo(()=>ea(w)?w.get():w,[w]);return Z.createElement(e,{...v,children:T})}function CV(e){const t=[{},{}];return e?.values.forEach((r,n)=>{t[0][n]=r.get(),t[1][n]=r.getVelocity()}),t}function j3(e,t,r,n){if(typeof t=="function"){const[c,h]=CV(n);t=t(r!==void 0?r:e.custom,c,h)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[c,h]=CV(n);t=t(r!==void 0?r:e.custom,c,h)}return t}function P2(e){return ea(e)?e.get():e}function Nge({scrapeMotionValuesFromProps:e,createRenderState:t},r,n,c){return{latestValues:Fge(r,n,c,e),renderState:t()}}function Fge(e,t,r,n){const c={},h=n(e,{});for(const O in h)c[O]=P2(h[O]);let{initial:p,animate:s}=e;const v=lk(e),w=iK(e);t&&w&&!v&&e.inherit!==!1&&(p===void 0&&(p=t.initial),s===void 0&&(s=t.animate));let T=r?r.initial===!1:!1;T=T||p===!1;const I=T?s:p;if(I&&typeof I!="boolean"&&!ak(I)){const O=Array.isArray(I)?I:[I];for(let D=0;D<O.length;D++){const B=j3(e,O[D]);if(B){const{transitionEnd:N,transition:G,...U}=B;for(const V in U){let X=U[V];if(Array.isArray(X)){const Y=T?X.length-1:0;X=X[Y]}X!==null&&(c[V]=X)}for(const V in N)c[V]=N[V]}}}return c}const uK=e=>(t,r)=>{const n=Z.useContext(ok),c=Z.useContext(ik),h=()=>Nge(e,t,n,c);return r?h():Xw(h)};function R3(e,t,r){const{style:n}=e,c={};for(const h in n)(ea(n[h])||t.style&&ea(t.style[h])||sK(h,e)||r?.getValue(h)?.liveStyle!==void 0)&&(c[h]=n[h]);return c}const Bge=uK({scrapeMotionValuesFromProps:R3,createRenderState:M3});function hK(e,t,r){const n=R3(e,t,r);for(const c in e)if(ea(e[c])||ea(t[c])){const h=nv.indexOf(c)!==-1?"attr"+c.charAt(0).toUpperCase()+c.substring(1):c;n[h]=e[c]}return n}const Vge=uK({scrapeMotionValuesFromProps:hK,createRenderState:lK}),Uge=Symbol.for("motionComponentSymbol");function zy(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function $ge(e,t,r){return Z.useCallback(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):zy(r)&&(r.current=n))},[t])}const D3=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Gge="framerAppearId",dK="data-"+D3(Gge),fK=Z.createContext({});function Hge(e,t,r,n,c){const{visualElement:h}=Z.useContext(ok),p=Z.useContext(rK),s=Z.useContext(ik),v=Z.useContext(sk).reducedMotion,w=Z.useRef(null);n=n||p.renderer,!w.current&&n&&(w.current=n(e,{visualState:t,parent:h,props:r,presenceContext:s,blockInitialAnimation:s?s.initial===!1:!1,reducedMotionConfig:v}));const T=w.current,I=Z.useContext(fK);T&&!T.projection&&c&&(T.type==="html"||T.type==="svg")&&Wge(w.current,r,c,I);const O=Z.useRef(!1);Z.useInsertionEffect(()=>{T&&O.current&&T.update(r,s)});const D=r[dK],B=Z.useRef(!!D&&!window.MotionHandoffIsComplete?.(D)&&window.MotionHasOptimisedAnimation?.(D));return o3(()=>{T&&(O.current=!0,window.MotionIsMounted=!0,T.updateFeatures(),T.scheduleRenderMicrotask(),B.current&&T.animationState&&T.animationState.animateChanges())}),Z.useEffect(()=>{T&&(!B.current&&T.animationState&&T.animationState.animateChanges(),B.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(D)}),B.current=!1),T.enteringChildren=void 0)}),T}function Wge(e,t,r,n){const{layoutId:c,layout:h,drag:p,dragConstraints:s,layoutScroll:v,layoutRoot:w,layoutCrossfade:T}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:pK(e.parent)),e.projection.setOptions({layoutId:c,layout:h,alwaysMeasureLayout:!!p||s&&zy(s),visualElement:e,animationType:typeof h=="string"?h:"both",initialPromotionConfig:n,crossfade:T,layoutScroll:v,layoutRoot:w})}function pK(e){if(e)return e.options.allowProjection!==!1?e.projection:pK(e.parent)}function rM(e,{forwardMotionProps:t=!1}={},r,n){r&&vge(r);const c=O3(e)?Vge:Bge;function h(s,v){let w;const T={...Z.useContext(sk),...s,layoutId:qge(s)},{isStatic:I}=T,O=Tge(s),D=c(s,I);if(!I&&s3){Zge();const B=Kge(T);w=B.MeasureLayout,O.visualElement=Hge(e,D,T,n,B.ProjectionNode)}return P.jsxs(ok.Provider,{value:O,children:[w&&O.visualElement?P.jsx(w,{visualElement:O.visualElement,...T}):null,zge(e,s,$ge(D,O.visualElement,v),D,I,t)]})}h.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const p=Z.forwardRef(h);return p[Uge]=e,p}function qge({layoutId:e}){const t=Z.useContext(i3).id;return t&&e!==void 0?t+"-"+e:e}function Zge(e,t){Z.useContext(rK).strict}function Kge(e){const{drag:t,layout:r}=v_;if(!t&&!r)return{};const n={...t,...r};return{MeasureLayout:t?.isEnabled(e)||r?.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function Xge(e,t){if(typeof Proxy>"u")return rM;const r=new Map,n=(h,p)=>rM(h,p,e,t),c=(h,p)=>n(h,p);return new Proxy(c,{get:(h,p)=>p==="create"?n:(r.has(p)||r.set(p,rM(p,void 0,e,t)),r.get(p))})}function mK({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function Yge({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Jge(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function nM(e){return e===void 0||e===1}function Pj({scale:e,scaleX:t,scaleY:r}){return!nM(e)||!nM(t)||!nM(r)}function Vp(e){return Pj(e)||gK(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function gK(e){return IV(e.x)||IV(e.y)}function IV(e){return e&&e!=="0%"}function gE(e,t,r){const n=e-r,c=t*n;return r+c}function MV(e,t,r,n,c){return c!==void 0&&(e=gE(e,c,n)),gE(e,r,n)+t}function Cj(e,t=0,r=1,n,c){e.min=MV(e.min,t,r,n,c),e.max=MV(e.max,t,r,n,c)}function yK(e,{x:t,y:r}){Cj(e.x,t.translate,t.scale,t.originPoint),Cj(e.y,r.translate,r.scale,r.originPoint)}const OV=.999999999999,jV=1.0000000000001;function Qge(e,t,r,n=!1){const c=r.length;if(!c)return;t.x=t.y=1;let h,p;for(let s=0;s<c;s++){h=r[s],p=h.projectionDelta;const{visualElement:v}=h.options;v&&v.props.style&&v.props.style.display==="contents"||(n&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Fy(e,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),p&&(t.x*=p.x.scale,t.y*=p.y.scale,yK(e,p)),n&&Vp(h.latestValues)&&Fy(e,h.latestValues))}t.x<jV&&t.x>OV&&(t.x=1),t.y<jV&&t.y>OV&&(t.y=1)}function Ny(e,t){e.min=e.min+t,e.max=e.max+t}function RV(e,t,r,n,c=.5){const h=ms(e.min,e.max,c);Cj(e,t,r,h,n)}function Fy(e,t){RV(e.x,t.x,t.scaleX,t.scale,t.originX),RV(e.y,t.y,t.scaleY,t.scale,t.originY)}function _K(e,t){return mK(Jge(e.getBoundingClientRect(),t))}function eye(e,t,r){const n=_K(e,r),{scroll:c}=t;return c&&(Ny(n.x,c.offset.x),Ny(n.y,c.offset.y)),n}const DV=()=>({translate:0,scale:1,origin:0,originPoint:0}),By=()=>({x:DV(),y:DV()}),LV=()=>({min:0,max:0}),Os=()=>({x:LV(),y:LV()}),Ij={current:null},vK={current:!1};function tye(){if(vK.current=!0,!!s3)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Ij.current=e.matches;e.addEventListener("change",t),t()}else Ij.current=!1}const rye=new WeakMap;function nye(e,t,r){for(const n in t){const c=t[n],h=r[n];if(ea(c))e.addValue(n,c);else if(ea(h))e.addValue(n,vm(c,{owner:e}));else if(h!==c)if(e.hasValue(n)){const p=e.getValue(n);p.liveStyle===!0?p.jump(c):p.hasAnimated||p.set(c)}else{const p=e.getStaticValue(n);e.addValue(n,vm(p!==void 0?p:c,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const zV=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class iye{scrapeMotionValuesFromProps(t,r,n){return{}}constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:c,blockInitialAnimation:h,visualState:p},s={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=S3,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const O=Ua.now();this.renderScheduledAt<O&&(this.renderScheduledAt=O,cs.render(this.render,!1,!0))};const{latestValues:v,renderState:w}=p;this.latestValues=v,this.baseTarget={...v},this.initialValues=r.initial?{...v}:{},this.renderState=w,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=c,this.options=s,this.blockInitialAnimation=!!h,this.isControllingVariants=lk(r),this.isVariantNode=iK(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:T,...I}=this.scrapeMotionValuesFromProps(r,{},this);for(const O in I){const D=I[O];v[O]!==void 0&&ea(D)&&D.set(v[O])}}mount(t){this.current=t,rye.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),vK.current||tye(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Ij.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Mh(this.notifyUpdate),Mh(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const r=this.features[t];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=iv.has(t);n&&this.onBindTransform&&this.onBindTransform();const c=r.on("change",p=>{this.latestValues[t]=p,this.props.onUpdate&&cs.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let h;window.MotionCheckAppearSync&&(h=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{c(),h&&h(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in v_){const r=v_[t];if(!r)continue;const{isEnabled:n,Feature:c}=r;if(!this.features[t]&&c&&n(this.props)&&(this.features[t]=new c(this)),this.features[t]){const h=this.features[t];h.isMounted?h.update():(h.mount(),h.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Os()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<zV.length;n++){const c=zV[n];this.propEventSubscriptions[c]&&(this.propEventSubscriptions[c](),delete this.propEventSubscriptions[c]);const h="on"+c,p=t[h];p&&(this.propEventSubscriptions[c]=this.on(c,p))}this.prevMotionValues=nye(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const n=this.values.get(t);r!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=vm(r===null?void 0:r,{owner:this}),this.addValue(t,n)),n}readValue(t,r){let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(uZ(n)||dZ(n))?n=parseFloat(n):!pge(n)&&_f.test(r)&&(n=ZZ(t,r)),this.setBaseTarget(t,ea(n)?n.get():n)),ea(n)?n.get():n}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const h=j3(this.props,r,this.presenceContext?.custom);h&&(n=h[t])}if(r&&n!==void 0)return n;const c=this.getBaseTargetFromProps(this.props,t);return c!==void 0&&!ea(c)?c:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new h3),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}scheduleRenderMicrotask(){A3.render(this.render)}}class xK extends iye{constructor(){super(...arguments),this.KeyframeResolver=tge}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ea(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function bK(e,{style:t,vars:r},n,c){const h=e.style;let p;for(p in t)h[p]=t[p];c?.applyProjectionStyles(h,n);for(p in r)h.setProperty(p,r[p])}function sye(e){return window.getComputedStyle(e)}class oye extends xK{constructor(){super(...arguments),this.type="html",this.renderInstance=bK}readValueFromInstance(t,r){if(iv.has(r))return this.projection?.isProjecting?bj(r):xme(t,r);{const n=sye(t),c=(p3(r)?n.getPropertyValue(r):n[r])||0;return typeof c=="string"?c.trim():c}}measureInstanceViewportBox(t,{transformPagePoint:r}){return _K(t,r)}build(t,r,n){I3(t,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,r,n){return R3(t,r,n)}}const wK=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function aye(e,t,r,n){bK(e,t,void 0,n);for(const c in t.attrs)e.setAttribute(wK.has(c)?c:D3(c),t.attrs[c])}class lye extends xK{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Os}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(iv.has(r)){const n=qZ(r);return n&&n.default||0}return r=wK.has(r)?r:D3(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,n){return hK(t,r,n)}build(t,r,n){aK(t,r,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(t,r,n,c){aye(t,r,n,c)}mount(t){this.isSVGTag=cK(t.tagName),super.mount(t)}}const cye=(e,t)=>O3(e)?new lye(t):new oye(t,{allowProjection:e!==Z.Fragment});function t_(e,t,r){const n=e.getProps();return j3(n,t,r!==void 0?r:n.custom,e)}const Mj=e=>Array.isArray(e);function uye(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,vm(r))}function hye(e){return Mj(e)?e[e.length-1]||0:e}function dye(e,t){const r=t_(e,t);let{transitionEnd:n={},transition:c={},...h}=r||{};h={...h,...n};for(const p in h){const s=hye(h[p]);uye(e,p,s)}}function fye(e){return!!(ea(e)&&e.add)}function Oj(e,t){const r=e.getValue("willChange");if(fye(r))return r.add(t);if(!r&&Ih.WillChange){const n=new Ih.WillChange("auto");e.addValue("willChange",n),n.add(t)}}function SK(e){return e.props[dK]}const pye=e=>e!==null;function mye(e,{repeat:t,repeatType:r="loop"},n){const c=e.filter(pye),h=t&&r!=="loop"&&t%2===1?0:c.length-1;return c[h]}const gye={type:"spring",stiffness:500,damping:25,restSpeed:10},yye=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),_ye={type:"keyframes",duration:.8},vye={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},xye=(e,{keyframes:t})=>t.length>2?_ye:iv.has(e)?e.startsWith("scale")?yye(t[1]):gye:vye;function bye({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:c,repeat:h,repeatType:p,repeatDelay:s,from:v,elapsed:w,...T}){return!!Object.keys(T).length}const L3=(e,t,r,n={},c,h)=>p=>{const s=T3(n,e)||{},v=s.delay||n.delay||0;let{elapsed:w=0}=n;w=w-xu(v);const T={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...s,delay:-w,onUpdate:O=>{t.set(O),s.onUpdate&&s.onUpdate(O)},onComplete:()=>{p(),s.onComplete&&s.onComplete()},name:e,motionValue:t,element:h?void 0:c};bye(s)||Object.assign(T,xye(e,T)),T.duration&&(T.duration=xu(T.duration)),T.repeatDelay&&(T.repeatDelay=xu(T.repeatDelay)),T.from!==void 0&&(T.keyframes[0]=T.from);let I=!1;if((T.type===!1||T.duration===0&&!T.repeatDelay)&&(Aj(T),T.delay===0&&(I=!0)),(Ih.instantAnimations||Ih.skipAnimations)&&(I=!0,Aj(T),T.delay=0),T.allowFlatten=!s.type&&!s.ease,I&&!h&&t.get()!==void 0){const O=mye(T.keyframes,s);if(O!==void 0){cs.update(()=>{T.onUpdate(O),T.onComplete()});return}}return s.isSync?new w3(T):new $me(T)};function wye({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function TK(e,t,{delay:r=0,transitionOverride:n,type:c}={}){let{transition:h=e.getDefaultTransition(),transitionEnd:p,...s}=t;n&&(h=n);const v=[],w=c&&e.animationState&&e.animationState.getState()[c];for(const T in s){const I=e.getValue(T,e.latestValues[T]??null),O=s[T];if(O===void 0||w&&wye(w,T))continue;const D={delay:r,...T3(h||{},T)},B=I.get();if(B!==void 0&&!I.isAnimating&&!Array.isArray(O)&&O===B&&!D.velocity)continue;let N=!1;if(window.MotionHandoffAnimation){const U=SK(e);if(U){const V=window.MotionHandoffAnimation(U,T,cs);V!==null&&(D.startTime=V,N=!0)}}Oj(e,T),I.start(L3(T,I,O,e.shouldReduceMotion&&GZ.has(T)?{type:!1}:D,e,N));const G=I.animation;G&&v.push(G)}return p&&Promise.all(v).then(()=>{cs.update(()=>{p&&dye(e,p)})}),v}function EK(e,t,r,n=0,c=1){const h=Array.from(e).sort((v,w)=>v.sortNodePosition(w)).indexOf(t),p=e.size,s=(p-1)*n;return typeof r=="function"?r(h,p):c===1?h*n:s-h*n}function jj(e,t,r={}){const n=t_(e,t,r.type==="exit"?e.presenceContext?.custom:void 0);let{transition:c=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(c=r.transitionOverride);const h=n?()=>Promise.all(TK(e,n,r)):()=>Promise.resolve(),p=e.variantChildren&&e.variantChildren.size?(v=0)=>{const{delayChildren:w=0,staggerChildren:T,staggerDirection:I}=c;return Sye(e,t,v,w,T,I,r)}:()=>Promise.resolve(),{when:s}=c;if(s){const[v,w]=s==="beforeChildren"?[h,p]:[p,h];return v().then(()=>w())}else return Promise.all([h(),p(r.delay)])}function Sye(e,t,r=0,n=0,c=0,h=1,p){const s=[];for(const v of e.variantChildren)v.notify("AnimationStart",t),s.push(jj(v,t,{...p,delay:r+(typeof n=="function"?0:n)+EK(e.variantChildren,v,n,c,h)}).then(()=>v.notify("AnimationComplete",t)));return Promise.all(s)}function Tye(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const c=t.map(h=>jj(e,h,r));n=Promise.all(c)}else if(typeof t=="string")n=jj(e,t,r);else{const c=typeof t=="function"?t_(e,t,r.custom):t;n=Promise.all(TK(e,c,r))}return n.then(()=>{e.notify("AnimationComplete",t)})}function AK(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}const Eye=C3.length;function kK(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?kK(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<Eye;r++){const n=C3[r],c=e.props[n];(rw(c)||c===!1)&&(t[n]=c)}return t}const Aye=[...P3].reverse(),kye=P3.length;function Pye(e){return t=>Promise.all(t.map(({animation:r,options:n})=>Tye(e,r,n)))}function Cye(e){let t=Pye(e),r=NV(),n=!0;const c=v=>(w,T)=>{const I=t_(e,T,v==="exit"?e.presenceContext?.custom:void 0);if(I){const{transition:O,transitionEnd:D,...B}=I;w={...w,...B,...D}}return w};function h(v){t=v(e)}function p(v){const{props:w}=e,T=kK(e.parent)||{},I=[],O=new Set;let D={},B=1/0;for(let G=0;G<kye;G++){const U=Aye[G],V=r[U],X=w[U]!==void 0?w[U]:T[U],Y=rw(X),ne=U===v?V.isActive:null;ne===!1&&(B=G);let ae=X===T[U]&&X!==w[U]&&Y;if(ae&&n&&e.manuallyAnimateOnMount&&(ae=!1),V.protectedKeys={...D},!V.isActive&&ne===null||!X&&!V.prevProp||ak(X)||typeof X=="boolean")continue;const le=Iye(V.prevProp,X);let ge=le||U===v&&V.isActive&&!ae&&Y||G>B&&Y,je=!1;const ze=Array.isArray(X)?X:[X];let Pe=ze.reduce(c(U),{});ne===!1&&(Pe={});const{prevResolvedValues:Ke={}}=V,Ye={...Ke,...Pe},Oe=We=>{ge=!0,O.has(We)&&(je=!0,O.delete(We)),V.needsAnimating[We]=!0;const lt=e.getValue(We);lt&&(lt.liveStyle=!1)};for(const We in Ye){const lt=Pe[We],rt=Ke[We];if(D.hasOwnProperty(We))continue;let ht=!1;Mj(lt)&&Mj(rt)?ht=!AK(lt,rt):ht=lt!==rt,ht?lt!=null?Oe(We):O.add(We):lt!==void 0&&O.has(We)?Oe(We):V.protectedKeys[We]=!0}V.prevProp=X,V.prevResolvedValues=Pe,V.isActive&&(D={...D,...Pe}),n&&e.blockInitialAnimation&&(ge=!1);const tt=ae&&le;ge&&(!tt||je)&&I.push(...ze.map(We=>{const lt={type:U};if(typeof We=="string"&&n&&!tt&&e.manuallyAnimateOnMount&&e.parent){const{parent:rt}=e,ht=t_(rt,We);if(rt.enteringChildren&&ht){const{delayChildren:vt}=ht.transition||{};lt.delay=EK(rt.enteringChildren,e,vt)}}return{animation:We,options:lt}}))}if(O.size){const G={};if(typeof w.initial!="boolean"){const U=t_(e,Array.isArray(w.initial)?w.initial[0]:w.initial);U&&U.transition&&(G.transition=U.transition)}O.forEach(U=>{const V=e.getBaseTarget(U),X=e.getValue(U);X&&(X.liveStyle=!0),G[U]=V??null}),I.push({animation:G})}let N=!!I.length;return n&&(w.initial===!1||w.initial===w.animate)&&!e.manuallyAnimateOnMount&&(N=!1),n=!1,N?t(I):Promise.resolve()}function s(v,w){if(r[v].isActive===w)return Promise.resolve();e.variantChildren?.forEach(I=>I.animationState?.setActive(v,w)),r[v].isActive=w;const T=p(v);for(const I in r)r[I].protectedKeys={};return T}return{animateChanges:p,setActive:s,setAnimateFunction:h,getState:()=>r,reset:()=>{r=NV(),n=!0}}}function Iye(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!AK(t,e):!1}function jp(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function NV(){return{animate:jp(!0),whileInView:jp(),whileHover:jp(),whileTap:jp(),whileDrag:jp(),whileFocus:jp(),exit:jp()}}class wf{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Mye extends wf{constructor(t){super(t),t.animationState||(t.animationState=Cye(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();ak(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Oye=0;class jye extends wf{constructor(){super(...arguments),this.id=Oye++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const c=this.node.animationState.setActive("exit",!t);r&&!t&&c.then(()=>{r(this.id)})}mount(){const{register:t,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Rye={animation:{Feature:Mye},exit:{Feature:jye}};function iw(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function e1(e){return{point:{x:e.pageX,y:e.pageY}}}const Dye=e=>t=>k3(t)&&e(t,e1(t));function xb(e,t,r,n){return iw(e,t,Dye(r),n)}const PK=1e-4,Lye=1-PK,zye=1+PK,CK=.01,Nye=0-CK,Fye=0+CK;function ga(e){return e.max-e.min}function Bye(e,t,r){return Math.abs(e-t)<=r}function FV(e,t,r,n=.5){e.origin=n,e.originPoint=ms(t.min,t.max,e.origin),e.scale=ga(r)/ga(t),e.translate=ms(r.min,r.max,e.origin)-e.originPoint,(e.scale>=Lye&&e.scale<=zye||isNaN(e.scale))&&(e.scale=1),(e.translate>=Nye&&e.translate<=Fye||isNaN(e.translate))&&(e.translate=0)}function bb(e,t,r,n){FV(e.x,t.x,r.x,n?n.originX:void 0),FV(e.y,t.y,r.y,n?n.originY:void 0)}function BV(e,t,r){e.min=r.min+t.min,e.max=e.min+ga(t)}function Vye(e,t,r){BV(e.x,t.x,r.x),BV(e.y,t.y,r.y)}function VV(e,t,r){e.min=t.min-r.min,e.max=e.min+ga(t)}function wb(e,t,r){VV(e.x,t.x,r.x),VV(e.y,t.y,r.y)}function kl(e){return[e("x"),e("y")]}const IK=({current:e})=>e?e.ownerDocument.defaultView:null,UV=(e,t)=>Math.abs(e-t);function Uye(e,t){const r=UV(e.x,t.x),n=UV(e.y,t.y);return Math.sqrt(r**2+n**2)}class MK{constructor(t,r,{transformPagePoint:n,contextWindow:c=window,dragSnapToOrigin:h=!1,distanceThreshold:p=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=sM(this.lastMoveEventInfo,this.history),D=this.startEvent!==null,B=Uye(O.offset,{x:0,y:0})>=this.distanceThreshold;if(!D&&!B)return;const{point:N}=O,{timestamp:G}=Lo;this.history.push({...N,timestamp:G});const{onStart:U,onMove:V}=this.handlers;D||(U&&U(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),V&&V(this.lastMoveEvent,O)},this.handlePointerMove=(O,D)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=iM(D,this.transformPagePoint),cs.update(this.updatePoint,!0)},this.handlePointerUp=(O,D)=>{this.end();const{onEnd:B,onSessionEnd:N,resumeAnimation:G}=this.handlers;if(this.dragSnapToOrigin&&G&&G(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const U=sM(O.type==="pointercancel"?this.lastMoveEventInfo:iM(D,this.transformPagePoint),this.history);this.startEvent&&B&&B(O,U),N&&N(O,U)},!k3(t))return;this.dragSnapToOrigin=h,this.handlers=r,this.transformPagePoint=n,this.distanceThreshold=p,this.contextWindow=c||window;const s=e1(t),v=iM(s,this.transformPagePoint),{point:w}=v,{timestamp:T}=Lo;this.history=[{...w,timestamp:T}];const{onSessionStart:I}=r;I&&I(t,sM(v,this.history)),this.removeListeners=Yw(xb(this.contextWindow,"pointermove",this.handlePointerMove),xb(this.contextWindow,"pointerup",this.handlePointerUp),xb(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Mh(this.updatePoint)}}function iM(e,t){return t?{point:t(e.point)}:e}function $V(e,t){return{x:e.x-t.x,y:e.y-t.y}}function sM({point:e},t){return{point:e,delta:$V(e,OK(t)),offset:$V(e,$ye(t)),velocity:Gye(t,.1)}}function $ye(e){return e[0]}function OK(e){return e[e.length-1]}function Gye(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const c=OK(e);for(;r>=0&&(n=e[r],!(c.timestamp-n.timestamp>xu(t)));)r--;if(!n)return{x:0,y:0};const h=bu(c.timestamp-n.timestamp);if(h===0)return{x:0,y:0};const p={x:(c.x-n.x)/h,y:(c.y-n.y)/h};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function Hye(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?ms(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?ms(r,e,n.max):Math.min(e,r)),e}function GV(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function Wye(e,{top:t,left:r,bottom:n,right:c}){return{x:GV(e.x,r,c),y:GV(e.y,t,n)}}function HV(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function qye(e,t){return{x:HV(e.x,t.x),y:HV(e.y,t.y)}}function Zye(e,t){let r=.5;const n=ga(e),c=ga(t);return c>n?r=Qb(t.min,t.max-n,e.min):n>c&&(r=Qb(e.min,e.max-c,t.min)),Ch(0,1,r)}function Kye(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const Rj=.35;function Xye(e=Rj){return e===!1?e=0:e===!0&&(e=Rj),{x:WV(e,"left","right"),y:WV(e,"top","bottom")}}function WV(e,t,r){return{min:qV(e,t),max:qV(e,r)}}function qV(e,t){return typeof e=="number"?e:e[t]||0}const Yye=new WeakMap;class Jye{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Os(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:r=!1,distanceThreshold:n}={}){const{presenceContext:c}=this.visualElement;if(c&&c.isPresent===!1)return;const h=I=>{const{dragSnapToOrigin:O}=this.getProps();O?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(e1(I).point)},p=(I,O)=>{const{drag:D,dragPropagation:B,onDragStart:N}=this.getProps();if(D&&!B&&(this.openDragLock&&this.openDragLock(),this.openDragLock=sge(D),!this.openDragLock))return;this.latestPointerEvent=I,this.latestPanInfo=O,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),kl(U=>{let V=this.getAxisMotionValue(U).get()||0;if(wu.test(V)){const{projection:X}=this.visualElement;if(X&&X.layout){const Y=X.layout.layoutBox[U];Y&&(V=ga(Y)*(parseFloat(V)/100))}}this.originPoint[U]=V}),N&&cs.postRender(()=>N(I,O)),Oj(this.visualElement,"transform");const{animationState:G}=this.visualElement;G&&G.setActive("whileDrag",!0)},s=(I,O)=>{this.latestPointerEvent=I,this.latestPanInfo=O;const{dragPropagation:D,dragDirectionLock:B,onDirectionLock:N,onDrag:G}=this.getProps();if(!D&&!this.openDragLock)return;const{offset:U}=O;if(B&&this.currentDirection===null){this.currentDirection=Qye(U),this.currentDirection!==null&&N&&N(this.currentDirection);return}this.updateAxis("x",O.point,U),this.updateAxis("y",O.point,U),this.visualElement.render(),G&&G(I,O)},v=(I,O)=>{this.latestPointerEvent=I,this.latestPanInfo=O,this.stop(I,O),this.latestPointerEvent=null,this.latestPanInfo=null},w=()=>kl(I=>this.getAnimationState(I)==="paused"&&this.getAxisMotionValue(I).animation?.play()),{dragSnapToOrigin:T}=this.getProps();this.panSession=new MK(t,{onSessionStart:h,onStart:p,onMove:s,onSessionEnd:v,resumeAnimation:w},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,distanceThreshold:n,contextWindow:IK(this.visualElement)})}stop(t,r){const n=t||this.latestPointerEvent,c=r||this.latestPanInfo,h=this.isDragging;if(this.cancel(),!h||!c||!n)return;const{velocity:p}=c;this.startAnimation(p);const{onDragEnd:s}=this.getProps();s&&cs.postRender(()=>s(n,c))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:c}=this.getProps();if(!n||!BT(t,c,this.currentDirection))return;const h=this.getAxisMotionValue(t);let p=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(p=Hye(p,this.constraints[t],this.elastic[t])),h.set(p)}resolveConstraints(){const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,c=this.constraints;t&&zy(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=Wye(n.layoutBox,t):this.constraints=!1,this.elastic=Xye(r),c!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&kl(h=>{this.constraints!==!1&&this.getAxisMotionValue(h)&&(this.constraints[h]=Kye(n.layoutBox[h],this.constraints[h]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!zy(t))return!1;const n=t.current,{projection:c}=this.visualElement;if(!c||!c.layout)return!1;const h=eye(n,c.root,this.visualElement.getTransformPagePoint());let p=qye(c.layout.layoutBox,h);if(r){const s=r(Yge(p));this.hasMutatedConstraints=!!s,s&&(p=mK(s))}return p}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:c,dragTransition:h,dragSnapToOrigin:p,onDragTransitionEnd:s}=this.getProps(),v=this.constraints||{},w=kl(T=>{if(!BT(T,r,this.currentDirection))return;let I=v&&v[T]||{};p&&(I={min:0,max:0});const O=c?200:1e6,D=c?40:1e7,B={type:"inertia",velocity:n?t[T]:0,bounceStiffness:O,bounceDamping:D,timeConstant:750,restDelta:1,restSpeed:10,...h,...I};return this.startAxisValueAnimation(T,B)});return Promise.all(w).then(s)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return Oj(this.visualElement,t),n.start(L3(t,n,0,r,this.visualElement,!1))}stopAnimation(){kl(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){kl(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps();return n[r]||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){kl(r=>{const{drag:n}=this.getProps();if(!BT(r,n,this.currentDirection))return;const{projection:c}=this.visualElement,h=this.getAxisMotionValue(r);if(c&&c.layout){const{min:p,max:s}=c.layout.layoutBox[r];h.set(t[r]-ms(p,s,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!zy(r)||!n||!this.constraints)return;this.stopAnimation();const c={x:0,y:0};kl(p=>{const s=this.getAxisMotionValue(p);if(s&&this.constraints!==!1){const v=s.get();c[p]=Zye({min:v,max:v},this.constraints[p])}});const{transformTemplate:h}=this.visualElement.getProps();this.visualElement.current.style.transform=h?h({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),kl(p=>{if(!BT(p,t,null))return;const s=this.getAxisMotionValue(p),{min:v,max:w}=this.constraints[p];s.set(ms(v,w,c[p]))})}addListeners(){if(!this.visualElement.current)return;Yye.set(this.visualElement,this);const t=this.visualElement.current,r=xb(t,"pointerdown",v=>{const{drag:w,dragListener:T=!0}=this.getProps();w&&T&&this.start(v)}),n=()=>{const{dragConstraints:v}=this.getProps();zy(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:c}=this.visualElement,h=c.addEventListener("measure",n);c&&!c.layout&&(c.root&&c.root.updateScroll(),c.updateLayout()),cs.read(n);const p=iw(window,"resize",()=>this.scalePositionWithinConstraints()),s=c.addEventListener("didUpdate",({delta:v,hasLayoutChanged:w})=>{this.isDragging&&w&&(kl(T=>{const I=this.getAxisMotionValue(T);I&&(this.originPoint[T]+=v[T].translate,I.set(I.get()+v[T].translate))}),this.visualElement.render())});return()=>{p(),r(),h(),s&&s()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:c=!1,dragConstraints:h=!1,dragElastic:p=Rj,dragMomentum:s=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:c,dragConstraints:h,dragElastic:p,dragMomentum:s}}}function BT(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function Qye(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class e_e extends wf{constructor(t){super(t),this.removeGroupControls=Dl,this.removeListeners=Dl,this.controls=new Jye(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Dl}unmount(){this.removeGroupControls(),this.removeListeners()}}const ZV=e=>(t,r)=>{e&&cs.postRender(()=>e(t,r))};class t_e extends wf{constructor(){super(...arguments),this.removePointerDownListener=Dl}onPointerDown(t){this.session=new MK(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:IK(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:c}=this.node.getProps();return{onSessionStart:ZV(t),onStart:ZV(r),onMove:n,onEnd:(h,p)=>{delete this.session,c&&cs.postRender(()=>c(h,p))}}}mount(){this.removePointerDownListener=xb(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const C2={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function KV(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const zx={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(bn.test(e))e=parseFloat(e);else return e;const r=KV(e,t.target.x),n=KV(e,t.target.y);return`${r}% ${n}%`}},r_e={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,c=_f.parse(e);if(c.length>5)return n;const h=_f.createTransformer(e),p=typeof c[0]!="number"?1:0,s=r.x.scale*t.x,v=r.y.scale*t.y;c[0+p]/=s,c[1+p]/=v;const w=ms(s,v,.5);return typeof c[2+p]=="number"&&(c[2+p]/=w),typeof c[3+p]=="number"&&(c[3+p]/=w),h(c)}};let oM=!1;class n_e extends Z.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:c}=this.props,{projection:h}=t;Ege(i_e),h&&(r.group&&r.group.add(h),n&&n.register&&c&&n.register(h),oM&&h.root.didUpdate(),h.addEventListener("animationComplete",()=>{this.safeToRemove()}),h.setOptions({...h.options,onExitComplete:()=>this.safeToRemove()})),C2.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:c,isPresent:h}=this.props,{projection:p}=n;return p&&(p.isPresent=h,oM=!0,c||t.layoutDependency!==r||r===void 0||t.isPresent!==h?p.willUpdate():this.safeToRemove(),t.isPresent!==h&&(h?p.promote():p.relegate()||cs.postRender(()=>{const s=p.getStack();(!s||!s.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),A3.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:c}=t;oM=!0,c&&(c.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(c),n&&n.deregister&&n.deregister(c))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function jK(e){const[t,r]=tK(),n=Z.useContext(i3);return P.jsx(n_e,{...e,layoutGroup:n,switchLayoutGroup:Z.useContext(fK),isPresent:t,safeToRemove:r})}const i_e={borderRadius:{...zx,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:zx,borderTopRightRadius:zx,borderBottomLeftRadius:zx,borderBottomRightRadius:zx,boxShadow:r_e};function s_e(e,t,r){const n=ea(e)?e:vm(e);return n.start(L3("",n,t,r)),n.animation}const o_e=(e,t)=>e.depth-t.depth;class a_e{constructor(){this.children=[],this.isDirty=!1}add(t){a3(this.children,t),this.isDirty=!0}remove(t){l3(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(o_e),this.isDirty=!1,this.children.forEach(t)}}function l_e(e,t){const r=Ua.now(),n=({timestamp:c})=>{const h=c-r;h>=t&&(Mh(n),e(h-t))};return cs.setup(n,!0),()=>Mh(n)}const RK=["TopLeft","TopRight","BottomLeft","BottomRight"],c_e=RK.length,XV=e=>typeof e=="string"?parseFloat(e):e,YV=e=>typeof e=="number"||bn.test(e);function u_e(e,t,r,n,c,h){c?(e.opacity=ms(0,r.opacity??1,h_e(n)),e.opacityExit=ms(t.opacity??1,0,d_e(n))):h&&(e.opacity=ms(t.opacity??1,r.opacity??1,n));for(let p=0;p<c_e;p++){const s=`border${RK[p]}Radius`;let v=JV(t,s),w=JV(r,s);v===void 0&&w===void 0||(v||(v=0),w||(w=0),v===0||w===0||YV(v)===YV(w)?(e[s]=Math.max(ms(XV(v),XV(w),n),0),(wu.test(w)||wu.test(v))&&(e[s]+="%")):e[s]=w)}(t.rotate||r.rotate)&&(e.rotate=ms(t.rotate||0,r.rotate||0,n))}function JV(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const h_e=DK(0,.5,xZ),d_e=DK(.5,.95,Dl);function DK(e,t,r){return n=>n<e?0:n>t?1:r(Qb(e,t,n))}function QV(e,t){e.min=t.min,e.max=t.max}function Sl(e,t){QV(e.x,t.x),QV(e.y,t.y)}function eU(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function tU(e,t,r,n,c){return e-=t,e=gE(e,1/r,n),c!==void 0&&(e=gE(e,1/c,n)),e}function f_e(e,t=0,r=1,n=.5,c,h=e,p=e){if(wu.test(t)&&(t=parseFloat(t),t=ms(p.min,p.max,t/100)-p.min),typeof t!="number")return;let s=ms(h.min,h.max,n);e===h&&(s-=t),e.min=tU(e.min,t,r,s,c),e.max=tU(e.max,t,r,s,c)}function rU(e,t,[r,n,c],h,p){f_e(e,t[r],t[n],t[c],t.scale,h,p)}const p_e=["x","scaleX","originX"],m_e=["y","scaleY","originY"];function nU(e,t,r,n){rU(e.x,t,p_e,r?r.x:void 0,n?n.x:void 0),rU(e.y,t,m_e,r?r.y:void 0,n?n.y:void 0)}function iU(e){return e.translate===0&&e.scale===1}function LK(e){return iU(e.x)&&iU(e.y)}function sU(e,t){return e.min===t.min&&e.max===t.max}function g_e(e,t){return sU(e.x,t.x)&&sU(e.y,t.y)}function oU(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function zK(e,t){return oU(e.x,t.x)&&oU(e.y,t.y)}function aU(e){return ga(e.x)/ga(e.y)}function lU(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class y_e{constructor(){this.members=[]}add(t){a3(this.members,t),t.scheduleRender()}remove(t){if(l3(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(c=>t===c);if(r===0)return!1;let n;for(let c=r;c>=0;c--){const h=this.members[c];if(h.isPresent!==!1){n=h;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:c}=t.options;c===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function __e(e,t,r){let n="";const c=e.x.translate/t.x,h=e.y.translate/t.y,p=r?.z||0;if((c||h||p)&&(n=`translate3d(${c}px, ${h}px, ${p}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:w,rotate:T,rotateX:I,rotateY:O,skewX:D,skewY:B}=r;w&&(n=`perspective(${w}px) ${n}`),T&&(n+=`rotate(${T}deg) `),I&&(n+=`rotateX(${I}deg) `),O&&(n+=`rotateY(${O}deg) `),D&&(n+=`skewX(${D}deg) `),B&&(n+=`skewY(${B}deg) `)}const s=e.x.scale*t.x,v=e.y.scale*t.y;return(s!==1||v!==1)&&(n+=`scale(${s}, ${v})`),n||"none"}const aM=["","X","Y","Z"],v_e=1e3;let x_e=0;function lM(e,t,r,n){const{latestValues:c}=t;c[e]&&(r[e]=c[e],t.setStaticValue(e,0),n&&(n[e]=0))}function NK(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=SK(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:c,layoutId:h}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",cs,!(c||h))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&NK(n)}function FK({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:c}){return class{constructor(h={},p=t?.()){this.id=x_e++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(S_e),this.nodes.forEach(k_e),this.nodes.forEach(P_e),this.nodes.forEach(T_e)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=h,this.root=p?p.root||p:this,this.path=p?[...p.path,p]:[],this.parent=p,this.depth=p?p.depth+1:0;for(let s=0;s<this.path.length;s++)this.path[s].shouldResetTransform=!0;this.root===this&&(this.nodes=new a_e)}addEventListener(h,p){return this.eventHandlers.has(h)||this.eventHandlers.set(h,new h3),this.eventHandlers.get(h).add(p)}notifyListeners(h,...p){const s=this.eventHandlers.get(h);s&&s.notify(...p)}hasListeners(h){return this.eventHandlers.has(h)}mount(h){if(this.instance)return;this.isSVG=eK(h)&&!hge(h),this.instance=h;const{layoutId:p,layout:s,visualElement:v}=this.options;if(v&&!v.current&&v.mount(h),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(s||p)&&(this.isLayoutDirty=!0),e){let w,T=0;const I=()=>this.root.updateBlockedByResize=!1;cs.read(()=>{T=window.innerWidth}),e(h,()=>{const O=window.innerWidth;O!==T&&(T=O,this.root.updateBlockedByResize=!0,w&&w(),w=l_e(I,250),C2.hasAnimatedSinceResize&&(C2.hasAnimatedSinceResize=!1,this.nodes.forEach(hU)))})}p&&this.root.registerSharedNode(p,this),this.options.animate!==!1&&v&&(p||s)&&this.addEventListener("didUpdate",({delta:w,hasLayoutChanged:T,hasRelativeLayoutChanged:I,layout:O})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const D=this.options.transition||v.getDefaultTransition()||j_e,{onLayoutAnimationStart:B,onLayoutAnimationComplete:N}=v.getProps(),G=!this.targetLayout||!zK(this.targetLayout,O),U=!T&&I;if(this.options.layoutRoot||this.resumeFrom||U||T&&(G||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const V={...T3(D,"layout"),onPlay:B,onComplete:N};(v.shouldReduceMotion||this.options.layoutRoot)&&(V.delay=0,V.type=!1),this.startAnimation(V),this.setAnimationOrigin(w,U)}else T||hU(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=O})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const h=this.getStack();h&&h.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Mh(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(C_e),this.animationId++)}getTransformTemplate(){const{visualElement:h}=this.options;return h&&h.getProps().transformTemplate}willUpdate(h=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&NK(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const T=this.path[w];T.shouldResetTransform=!0,T.updateScroll("snapshot"),T.options.layoutRoot&&T.willUpdate(!1)}const{layoutId:p,layout:s}=this.options;if(p===void 0&&!s)return;const v=this.getTransformTemplate();this.prevTransformTemplateValue=v?v(this.latestValues,""):void 0,this.updateSnapshot(),h&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(cU);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(uU);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(A_e),this.nodes.forEach(b_e),this.nodes.forEach(w_e)):this.nodes.forEach(uU),this.clearAllSnapshots();const h=Ua.now();Lo.delta=Ch(0,1e3/60,h-Lo.timestamp),Lo.timestamp=h,Lo.isProcessing=!0,XI.update.process(Lo),XI.preRender.process(Lo),XI.render.process(Lo),Lo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,A3.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(E_e),this.sharedNodes.forEach(I_e)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,cs.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){cs.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ga(this.snapshot.measuredBox.x)&&!ga(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++)this.path[s].updateScroll();const h=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Os(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:p}=this.options;p&&p.notify("LayoutMeasure",this.layout.layoutBox,h?h.layoutBox:void 0)}updateScroll(h="measure"){let p=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===h&&(p=!1),p&&this.instance){const s=n(this.instance);this.scroll={animationId:this.root.animationId,phase:h,isRoot:s,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:s}}}resetTransform(){if(!c)return;const h=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,p=this.projectionDelta&&!LK(this.projectionDelta),s=this.getTransformTemplate(),v=s?s(this.latestValues,""):void 0,w=v!==this.prevTransformTemplateValue;h&&this.instance&&(p||Vp(this.latestValues)||w)&&(c(this.instance,v),this.shouldResetTransform=!1,this.scheduleRender())}measure(h=!0){const p=this.measurePageBox();let s=this.removeElementScroll(p);return h&&(s=this.removeTransform(s)),R_e(s),{animationId:this.root.animationId,measuredBox:p,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:h}=this.options;if(!h)return Os();const p=h.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(D_e))){const{scroll:s}=this.root;s&&(Ny(p.x,s.offset.x),Ny(p.y,s.offset.y))}return p}removeElementScroll(h){const p=Os();if(Sl(p,h),this.scroll?.wasRoot)return p;for(let s=0;s<this.path.length;s++){const v=this.path[s],{scroll:w,options:T}=v;v!==this.root&&w&&T.layoutScroll&&(w.wasRoot&&Sl(p,h),Ny(p.x,w.offset.x),Ny(p.y,w.offset.y))}return p}applyTransform(h,p=!1){const s=Os();Sl(s,h);for(let v=0;v<this.path.length;v++){const w=this.path[v];!p&&w.options.layoutScroll&&w.scroll&&w!==w.root&&Fy(s,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),Vp(w.latestValues)&&Fy(s,w.latestValues)}return Vp(this.latestValues)&&Fy(s,this.latestValues),s}removeTransform(h){const p=Os();Sl(p,h);for(let s=0;s<this.path.length;s++){const v=this.path[s];if(!v.instance||!Vp(v.latestValues))continue;Pj(v.latestValues)&&v.updateSnapshot();const w=Os(),T=v.measurePageBox();Sl(w,T),nU(p,v.latestValues,v.snapshot?v.snapshot.layoutBox:void 0,w)}return Vp(this.latestValues)&&nU(p,this.latestValues),p}setTargetDelta(h){this.targetDelta=h,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(h){this.options={...this.options,...h,crossfade:h.crossfade!==void 0?h.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Lo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(h=!1){const p=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=p.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=p.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=p.isSharedProjectionDirty);const s=!!this.resumingFrom||this!==p;if(!(h||s&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:v,layoutId:w}=this.options;if(!(!this.layout||!(v||w))){if(this.resolvedRelativeTargetAt=Lo.timestamp,!this.targetDelta&&!this.relativeTarget){const T=this.getClosestProjectingParent();T&&T.layout&&this.animationProgress!==1?(this.relativeParent=T,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Os(),this.relativeTargetOrigin=Os(),wb(this.relativeTargetOrigin,this.layout.layoutBox,T.layout.layoutBox),Sl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Os(),this.targetWithTransforms=Os()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Vye(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Sl(this.target,this.layout.layoutBox),yK(this.target,this.targetDelta)):Sl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const T=this.getClosestProjectingParent();T&&!!T.resumingFrom==!!this.resumingFrom&&!T.options.layoutScroll&&T.target&&this.animationProgress!==1?(this.relativeParent=T,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Os(),this.relativeTargetOrigin=Os(),wb(this.relativeTargetOrigin,this.target,T.target),Sl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Pj(this.parent.latestValues)||gK(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const h=this.getLead(),p=!!this.resumingFrom||this!==h;let s=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(s=!1),p&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(s=!1),this.resolvedRelativeTargetAt===Lo.timestamp&&(s=!1),s)return;const{layout:v,layoutId:w}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(v||w))return;Sl(this.layoutCorrected,this.layout.layoutBox);const T=this.treeScale.x,I=this.treeScale.y;Qge(this.layoutCorrected,this.treeScale,this.path,p),h.layout&&!h.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(h.target=h.layout.layoutBox,h.targetWithTransforms=Os());const{target:O}=h;if(!O){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(eU(this.prevProjectionDelta.x,this.projectionDelta.x),eU(this.prevProjectionDelta.y,this.projectionDelta.y)),bb(this.projectionDelta,this.layoutCorrected,O,this.latestValues),(this.treeScale.x!==T||this.treeScale.y!==I||!lU(this.projectionDelta.x,this.prevProjectionDelta.x)||!lU(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",O))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(h=!0){if(this.options.visualElement?.scheduleRender(),h){const p=this.getStack();p&&p.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=By(),this.projectionDelta=By(),this.projectionDeltaWithTransform=By()}setAnimationOrigin(h,p=!1){const s=this.snapshot,v=s?s.latestValues:{},w={...this.latestValues},T=By();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!p;const I=Os(),O=s?s.source:void 0,D=this.layout?this.layout.source:void 0,B=O!==D,N=this.getStack(),G=!N||N.members.length<=1,U=!!(B&&!G&&this.options.crossfade===!0&&!this.path.some(O_e));this.animationProgress=0;let V;this.mixTargetDelta=X=>{const Y=X/1e3;dU(T.x,h.x,Y),dU(T.y,h.y,Y),this.setTargetDelta(T),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(wb(I,this.layout.layoutBox,this.relativeParent.layout.layoutBox),M_e(this.relativeTarget,this.relativeTargetOrigin,I,Y),V&&g_e(this.relativeTarget,V)&&(this.isProjectionDirty=!1),V||(V=Os()),Sl(V,this.relativeTarget)),B&&(this.animationValues=w,u_e(w,v,this.latestValues,Y,U,G)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Y},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(h){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Mh(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=cs.update(()=>{C2.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=vm(0)),this.currentAnimation=s_e(this.motionValue,[0,1e3],{...h,velocity:0,isSync:!0,onUpdate:p=>{this.mixTargetDelta(p),h.onUpdate&&h.onUpdate(p)},onStop:()=>{},onComplete:()=>{h.onComplete&&h.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const h=this.getStack();h&&h.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(v_e),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const h=this.getLead();let{targetWithTransforms:p,target:s,layout:v,latestValues:w}=h;if(!(!p||!s||!v)){if(this!==h&&this.layout&&v&&BK(this.options.animationType,this.layout.layoutBox,v.layoutBox)){s=this.target||Os();const T=ga(this.layout.layoutBox.x);s.x.min=h.target.x.min,s.x.max=s.x.min+T;const I=ga(this.layout.layoutBox.y);s.y.min=h.target.y.min,s.y.max=s.y.min+I}Sl(p,s),Fy(p,w),bb(this.projectionDeltaWithTransform,this.layoutCorrected,p,w)}}registerSharedNode(h,p){this.sharedNodes.has(h)||this.sharedNodes.set(h,new y_e),this.sharedNodes.get(h).add(p);const s=p.options.initialPromotionConfig;p.promote({transition:s?s.transition:void 0,preserveFollowOpacity:s&&s.shouldPreserveFollowOpacity?s.shouldPreserveFollowOpacity(p):void 0})}isLead(){const h=this.getStack();return h?h.lead===this:!0}getLead(){const{layoutId:h}=this.options;return h?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:h}=this.options;return h?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:h}=this.options;if(h)return this.root.sharedNodes.get(h)}promote({needsReset:h,transition:p,preserveFollowOpacity:s}={}){const v=this.getStack();v&&v.promote(this,s),h&&(this.projectionDelta=void 0,this.needsReset=!0),p&&this.setOptions({transition:p})}relegate(){const h=this.getStack();return h?h.relegate(this):!1}resetSkewAndRotation(){const{visualElement:h}=this.options;if(!h)return;let p=!1;const{latestValues:s}=h;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(p=!0),!p)return;const v={};s.z&&lM("z",h,v,this.animationValues);for(let w=0;w<aM.length;w++)lM(`rotate${aM[w]}`,h,v,this.animationValues),lM(`skew${aM[w]}`,h,v,this.animationValues);h.render();for(const w in v)h.setStaticValue(w,v[w]),this.animationValues&&(this.animationValues[w]=v[w]);h.scheduleRender()}applyProjectionStyles(h,p){if(!this.instance||this.isSVG)return;if(!this.isVisible){h.visibility="hidden";return}const s=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,h.visibility="",h.opacity="",h.pointerEvents=P2(p?.pointerEvents)||"",h.transform=s?s(this.latestValues,""):"none";return}const v=this.getLead();if(!this.projectionDelta||!this.layout||!v.target){this.options.layoutId&&(h.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,h.pointerEvents=P2(p?.pointerEvents)||""),this.hasProjected&&!Vp(this.latestValues)&&(h.transform=s?s({},""):"none",this.hasProjected=!1);return}h.visibility="";const w=v.animationValues||v.latestValues;this.applyTransformsToTarget();let T=__e(this.projectionDeltaWithTransform,this.treeScale,w);s&&(T=s(w,T)),h.transform=T;const{x:I,y:O}=this.projectionDelta;h.transformOrigin=`${I.origin*100}% ${O.origin*100}% 0`,v.animationValues?h.opacity=v===this?w.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:w.opacityExit:h.opacity=v===this?w.opacity!==void 0?w.opacity:"":w.opacityExit!==void 0?w.opacityExit:0;for(const D in nw){if(w[D]===void 0)continue;const{correct:B,applyTo:N,isCSSVariable:G}=nw[D],U=T==="none"?w[D]:B(w[D],v);if(N){const V=N.length;for(let X=0;X<V;X++)h[N[X]]=U}else G?this.options.visualElement.renderState.vars[D]=U:h[D]=U}this.options.layoutId&&(h.pointerEvents=v===this?P2(p?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(h=>h.currentAnimation?.stop()),this.root.nodes.forEach(cU),this.root.sharedNodes.clear()}}}function b_e(e){e.updateLayout()}function w_e(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=e.layout,{animationType:c}=e.options,h=t.source!==e.layout.source;c==="size"?kl(T=>{const I=h?t.measuredBox[T]:t.layoutBox[T],O=ga(I);I.min=r[T].min,I.max=I.min+O}):BK(c,t.layoutBox,r)&&kl(T=>{const I=h?t.measuredBox[T]:t.layoutBox[T],O=ga(r[T]);I.max=I.min+O,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[T].max=e.relativeTarget[T].min+O)});const p=By();bb(p,r,t.layoutBox);const s=By();h?bb(s,e.applyTransform(n,!0),t.measuredBox):bb(s,r,t.layoutBox);const v=!LK(p);let w=!1;if(!e.resumeFrom){const T=e.getClosestProjectingParent();if(T&&!T.resumeFrom){const{snapshot:I,layout:O}=T;if(I&&O){const D=Os();wb(D,t.layoutBox,I.layoutBox);const B=Os();wb(B,r,O.layoutBox),zK(D,B)||(w=!0),T.options.layoutRoot&&(e.relativeTarget=B,e.relativeTargetOrigin=D,e.relativeParent=T)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:s,layoutDelta:p,hasLayoutChanged:v,hasRelativeLayoutChanged:w})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function S_e(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function T_e(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function E_e(e){e.clearSnapshot()}function cU(e){e.clearMeasurements()}function uU(e){e.isLayoutDirty=!1}function A_e(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function hU(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function k_e(e){e.resolveTargetDelta()}function P_e(e){e.calcProjection()}function C_e(e){e.resetSkewAndRotation()}function I_e(e){e.removeLeadSnapshot()}function dU(e,t,r){e.translate=ms(t.translate,0,r),e.scale=ms(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function fU(e,t,r,n){e.min=ms(t.min,r.min,n),e.max=ms(t.max,r.max,n)}function M_e(e,t,r,n){fU(e.x,t.x,r.x,n),fU(e.y,t.y,r.y,n)}function O_e(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const j_e={duration:.45,ease:[.4,0,.1,1]},pU=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),mU=pU("applewebkit/")&&!pU("chrome/")?Math.round:Dl;function gU(e){e.min=mU(e.min),e.max=mU(e.max)}function R_e(e){gU(e.x),gU(e.y)}function BK(e,t,r){return e==="position"||e==="preserve-aspect"&&!Bye(aU(t),aU(r),.2)}function D_e(e){return e!==e.root&&e.scroll?.wasRoot}const L_e=FK({attachResizeListener:(e,t)=>iw(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),cM={current:void 0},VK=FK({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!cM.current){const e=new L_e({});e.mount(window),e.setOptions({layoutScroll:!0}),cM.current=e}return cM.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),z_e={pan:{Feature:t_e},drag:{Feature:e_e,ProjectionNode:VK,MeasureLayout:jK}};function yU(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",r==="Start");const c="onHover"+r,h=n[c];h&&cs.postRender(()=>h(t,e1(t)))}class N_e extends wf{mount(){const{current:t}=this.node;t&&(this.unmount=oge(t,(r,n)=>(yU(this.node,n,"Start"),c=>yU(this.node,c,"End"))))}unmount(){}}class F_e extends wf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Yw(iw(this.node.current,"focus",()=>this.onFocus()),iw(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function _U(e,t,r){const{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",r==="Start");const c="onTap"+(r==="End"?"":r),h=n[c];h&&cs.postRender(()=>h(t,e1(t)))}class B_e extends wf{mount(){const{current:t}=this.node;t&&(this.unmount=uge(t,(r,n)=>(_U(this.node,n,"Start"),(c,{success:h})=>_U(this.node,c,h?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Dj=new WeakMap,uM=new WeakMap,V_e=e=>{const t=Dj.get(e.target);t&&t(e)},U_e=e=>{e.forEach(V_e)};function $_e({root:e,...t}){const r=e||document;uM.has(r)||uM.set(r,{});const n=uM.get(r),c=JSON.stringify(t);return n[c]||(n[c]=new IntersectionObserver(U_e,{root:e,...t})),n[c]}function G_e(e,t,r){const n=$_e(t);return Dj.set(e,r),n.observe(e),()=>{Dj.delete(e),n.unobserve(e)}}const H_e={some:0,all:1};class W_e extends wf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:c="some",once:h}=t,p={root:r?r.current:void 0,rootMargin:n,threshold:typeof c=="number"?c:H_e[c]},s=v=>{const{isIntersecting:w}=v;if(this.isInView===w||(this.isInView=w,h&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:T,onViewportLeave:I}=this.node.getProps(),O=w?T:I;O&&O(v)};return G_e(this.node.current,p,s)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(q_e(t,r))&&this.startObserver()}unmount(){}}function q_e({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const Z_e={inView:{Feature:W_e},tap:{Feature:B_e},focus:{Feature:F_e},hover:{Feature:N_e}},K_e={layout:{ProjectionNode:VK,MeasureLayout:jK}},X_e={...Rye,...Z_e,...z_e,...K_e},Fr=Xge(X_e,cye);function UK(e){const t=Xw(()=>vm(e)),{isStatic:r}=Z.useContext(sk);if(r){const[,n]=Z.useState(e);Z.useEffect(()=>t.on("change",n),[])}return t}function $K(e,t){const r=UK(t()),n=()=>r.set(t());return n(),o3(()=>{const c=()=>cs.preRender(n,!1,!0),h=e.map(p=>p.on("change",c));return()=>{h.forEach(p=>p()),Mh(n)}}),r}function Y_e(e){vb.current=[],e();const t=$K(vb.current,e);return vb.current=void 0,t}function hM(e,t,r,n){if(typeof e=="function")return Y_e(e);const c=typeof t=="function"?t:dge(t,r,n);return Array.isArray(e)?vU(e,c):vU([e],([h])=>c(h))}function vU(e,t){const r=Xw(()=>[]);return $K(e,()=>{r.length=0;const n=e.length;for(let c=0;c<n;c++)r[c]=e[c].get();return t(r)})}const kn=Z.forwardRef(({className:e,...t},r)=>P.jsx("div",{ref:r,className:ln("rounded-xl border bg-card text-card-foreground shadow-soft transition-all duration-300",e),...t}));kn.displayName="Card";const r_=Z.forwardRef(({className:e,...t},r)=>P.jsx("div",{ref:r,className:ln("flex flex-col space-y-2 p-6",e),...t}));r_.displayName="CardHeader";const n_=Z.forwardRef(({className:e,...t},r)=>P.jsx("h3",{ref:r,className:ln("text-2xl font-heading font-semibold leading-none tracking-tight",e),...t}));n_.displayName="CardTitle";const GK=Z.forwardRef(({className:e,...t},r)=>P.jsx("p",{ref:r,className:ln("text-sm text-muted-foreground",e),...t}));GK.displayName="CardDescription";const Pl=Z.forwardRef(({className:e,...t},r)=>P.jsx("div",{ref:r,className:ln("p-6 pt-0",e),...t}));Pl.displayName="CardContent";const J_e=Z.forwardRef(({className:e,...t},r)=>P.jsx("div",{ref:r,className:ln("flex items-center p-6 pt-0",e),...t}));J_e.displayName="CardFooter";const Q_e=Y_("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:scale-105",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:shadow-lg",outline:"border border-input bg-background/50 hover:bg-accent hover:text-accent-foreground hover:shadow-md hover:scale-105",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:shadow-md",ghost:"hover:bg-accent hover:text-accent-foreground hover:scale-105",link:"text-primary underline-offset-4 hover:underline hover:scale-105",glass:"bg-white/10 backdrop-blur-md border border-white/20 text-white hover:bg-white/20 hover:shadow-lg",gradient:"bg-gradient-primary text-primary-foreground hover:shadow-glow hover:scale-105"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Hr=Z.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...c},h)=>{const p=n?Ule:"button";return P.jsx(p,{className:ln(Q_e({variant:t,size:r,className:e})),ref:h,...c})});Hr.displayName="Button";const eve=Y_("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function an({className:e,variant:t,...r}){return P.jsx("div",{className:ln(eve({variant:t}),e),...r})}const tve=({rating:e,reviewCount:t=0,showReviewCount:r=!0,size:n="md",className:c})=>{const h={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},p={sm:"text-xs",md:"text-sm",lg:"text-base"};return P.jsxs("div",{className:ln("flex items-center gap-2",c),children:[P.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((s,v)=>P.jsx(ba,{className:ln(h[n],v<Math.floor(e)?"text-yellow-400 fill-yellow-400":v<e?"text-yellow-400 fill-yellow-400/50":"text-muted-foreground")},v))}),P.jsx("span",{className:ln("font-medium",p[n]),children:e.toFixed(1)}),r&&t>0&&P.jsxs("span",{className:ln("text-muted-foreground",p[n]),children:["(",t," ",t===1?"recension":"recensioner",")"]})]})},rve=({onClickOutside:e,children:t,className:r="",disabled:n=!1})=>{const c=Z.useRef(null);return Z.useEffect(()=>{if(n)return;const h=p=>{c.current&&!c.current.contains(p.target)&&e()};return document.addEventListener("mousedown",h,!0),()=>{document.removeEventListener("mousedown",h,!0)}},[e,n]),P.jsx("div",{ref:c,className:r,children:t})},nve=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>tv(async()=>{const{default:n}=await Promise.resolve().then(()=>sv);return{default:n}}).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)};class z3 extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class ive extends z3{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class xU extends z3{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class bU extends z3{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Lj;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(Lj||(Lj={}));var sve=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function s(T){try{w(n.next(T))}catch(I){p(I)}}function v(T){try{w(n.throw(T))}catch(I){p(I)}}function w(T){T.done?h(T.value):c(T.value).then(s,v)}w((n=n.apply(e,[])).next())})};class ove{constructor(t,{headers:r={},customFetch:n,region:c=Lj.Any}={}){this.url=t,this.headers=r,this.region=c,this.fetch=nve(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,r={}){var n;return sve(this,void 0,void 0,function*(){try{const{headers:c,method:h,body:p}=r;let s={},{region:v}=r;v||(v=this.region);const w=new URL(`${this.url}/${t}`);v&&v!=="any"&&(s["x-region"]=v,w.searchParams.set("forceFunctionRegion",v));let T;p&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)&&(typeof Blob<"u"&&p instanceof Blob||p instanceof ArrayBuffer?(s["Content-Type"]="application/octet-stream",T=p):typeof p=="string"?(s["Content-Type"]="text/plain",T=p):typeof FormData<"u"&&p instanceof FormData?T=p:(s["Content-Type"]="application/json",T=JSON.stringify(p)));const I=yield this.fetch(w.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},s),this.headers),c),body:T}).catch(N=>{throw new ive(N)}),O=I.headers.get("x-relay-error");if(O&&O==="true")throw new xU(I);if(!I.ok)throw new bU(I);let D=((n=I.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),B;return D==="application/json"?B=yield I.json():D==="application/octet-stream"?B=yield I.blob():D==="text/event-stream"?B=I:D==="multipart/form-data"?B=yield I.formData():B=yield I.text(),{data:B,error:null,response:I}}catch(c){return{data:null,error:c,response:c instanceof bU||c instanceof xU?c.context:void 0}}})}}var Ba={},N3={},ck={},t1={},uk={},hk={},ave=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},x_=ave();const lve=x_.fetch,HK=x_.fetch.bind(x_),WK=x_.Headers,cve=x_.Request,uve=x_.Response,sv=Object.freeze(Object.defineProperty({__proto__:null,Headers:WK,Request:cve,Response:uve,default:HK,fetch:lve},Symbol.toStringTag,{value:"Module"})),hve=uoe(sv);var dk={};Object.defineProperty(dk,"__esModule",{value:!0});let dve=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};dk.default=dve;var qK=zo&&zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(hk,"__esModule",{value:!0});const fve=qK(hve),pve=qK(dk);let mve=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=fve.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var h,p,s,v;let w=null,T=null,I=null,O=c.status,D=c.statusText;if(c.ok){if(this.method!=="HEAD"){const G=await c.text();G===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&!((h=this.headers.get("Accept"))===null||h===void 0)&&h.includes("application/vnd.pgrst.plan+text")?T=G:T=JSON.parse(G))}const B=(p=this.headers.get("Prefer"))===null||p===void 0?void 0:p.match(/count=(exact|planned|estimated)/),N=(s=c.headers.get("content-range"))===null||s===void 0?void 0:s.split("/");B&&N&&N.length>1&&(I=parseInt(N[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(T)&&(T.length>1?(w={code:"PGRST116",details:`Results contain ${T.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},T=null,I=null,O=406,D="Not Acceptable"):T.length===1?T=T[0]:T=null)}else{const B=await c.text();try{w=JSON.parse(B),Array.isArray(w)&&c.status===404&&(T=[],w=null,O=200,D="OK")}catch{c.status===404&&B===""?(O=204,D="No Content"):w={message:B}}if(w&&this.isMaybeSingle&&!((v=w?.details)===null||v===void 0)&&v.includes("0 rows")&&(w=null,O=200,D="OK"),w&&this.shouldThrowOnError)throw new pve.default(w)}return{error:w,data:T,count:I,status:O,statusText:D}});return this.shouldThrowOnError||(n=n.catch(c=>{var h,p,s;return{error:{message:`${(h=c?.name)!==null&&h!==void 0?h:"FetchError"}: ${c?.message}`,details:`${(p=c?.stack)!==null&&p!==void 0?p:""}`,hint:"",code:`${(s=c?.code)!==null&&s!==void 0?s:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};hk.default=mve;var gve=zo&&zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(uk,"__esModule",{value:!0});const yve=gve(hk);let _ve=class extends yve.default{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:c=n}={}){const h=c?`${c}.order`:"order",p=this.url.searchParams.get(h);return this.url.searchParams.set(h,`${p?`${p},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const c=typeof n>"u"?"offset":`${n}.offset`,h=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(c,`${e}`),this.url.searchParams.set(h,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:c=!1,format:h="text"}={}){var p;const s=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,c?"wal":null].filter(Boolean).join("|"),v=(p=this.headers.get("Accept"))!==null&&p!==void 0?p:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${h}; for="${v}"; options=${s};`),h==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};uk.default=_ve;var vve=zo&&zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t1,"__esModule",{value:!0});const xve=vve(uk);let bve=class extends xve.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let c="";n==="plain"?c="pl":n==="phrase"?c="ph":n==="websearch"&&(c="w");const h=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${c}fts${h}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};t1.default=bve;var wve=zo&&zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ck,"__esModule",{value:!0});const Nx=wve(t1);let Sve=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let c=!1;const h=(e??"*").split("").map(p=>/\s/.test(p)&&!c?"":(p==='"'&&(c=!c),p)).join("");return this.url.searchParams.set("select",h),r&&this.headers.append("Prefer",`count=${r}`),new Nx.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var n;const c="POST";if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const h=e.reduce((p,s)=>p.concat(Object.keys(s)),[]);if(h.length>0){const p=[...new Set(h)].map(s=>`"${s}"`);this.url.searchParams.set("columns",p.join(","))}}return new Nx.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:c=!0}={}){var h;const p="POST";if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const s=e.reduce((v,w)=>v.concat(Object.keys(w)),[]);if(s.length>0){const v=[...new Set(s)].map(w=>`"${w}"`);this.url.searchParams.set("columns",v.join(","))}}return new Nx.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}update(e,{count:t}={}){var r;const n="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Nx.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:e}={}){var t;const r="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Nx.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};ck.default=Sve;var ZK=zo&&zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(N3,"__esModule",{value:!0});const Tve=ZK(ck),Eve=ZK(t1);let Ave=class KK{constructor(t,{headers:r={},schema:n,fetch:c}={}){this.url=t,this.headers=new Headers(r),this.schemaName=n,this.fetch=c}from(t){const r=new URL(`${this.url}/${t}`);return new Tve.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new KK(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:n=!1,get:c=!1,count:h}={}){var p;let s;const v=new URL(`${this.url}/rpc/${t}`);let w;n||c?(s=n?"HEAD":"GET",Object.entries(r).filter(([I,O])=>O!==void 0).map(([I,O])=>[I,Array.isArray(O)?`{${O.join(",")}}`:`${O}`]).forEach(([I,O])=>{v.searchParams.append(I,O)})):(s="POST",w=r);const T=new Headers(this.headers);return h&&T.set("Prefer",`count=${h}`),new Eve.default({method:s,url:v,headers:T,schema:this.schemaName,body:w,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}};N3.default=Ave;var ov=zo&&zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ba,"__esModule",{value:!0});Ba.PostgrestError=Ba.PostgrestBuilder=Ba.PostgrestTransformBuilder=Ba.PostgrestFilterBuilder=Ba.PostgrestQueryBuilder=Ba.PostgrestClient=void 0;const XK=ov(N3);Ba.PostgrestClient=XK.default;const YK=ov(ck);Ba.PostgrestQueryBuilder=YK.default;const JK=ov(t1);Ba.PostgrestFilterBuilder=JK.default;const QK=ov(uk);Ba.PostgrestTransformBuilder=QK.default;const eX=ov(hk);Ba.PostgrestBuilder=eX.default;const tX=ov(dk);Ba.PostgrestError=tX.default;var kve=Ba.default={PostgrestClient:XK.default,PostgrestQueryBuilder:YK.default,PostgrestFilterBuilder:JK.default,PostgrestTransformBuilder:QK.default,PostgrestBuilder:eX.default,PostgrestError:tX.default};const{PostgrestClient:Pve,PostgrestQueryBuilder:r7e,PostgrestFilterBuilder:n7e,PostgrestTransformBuilder:i7e,PostgrestBuilder:s7e,PostgrestError:o7e}=kve;class Cve{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge"))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const r=parseInt(process.versions.node.split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const Ive="2.15.1",Mve=`realtime-js/${Ive}`,Ove="1.0.0",zj=1e4,jve=1e3,Rve=100;var Sb;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Sb||(Sb={}));var Qs;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(Qs||(Qs={}));var dc;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(dc||(dc={}));var Nj;(function(e){e.websocket="websocket"})(Nj||(Nj={}));var qp;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(qp||(qp={}));class Dve{constructor(){this.HEADER_LENGTH=1}decode(t,r){return t.constructor===ArrayBuffer?r(this._binaryDecode(t)):r(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const r=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,r,n)}_decodeBroadcast(t,r,n){const c=r.getUint8(1),h=r.getUint8(2);let p=this.HEADER_LENGTH+2;const s=n.decode(t.slice(p,p+c));p=p+c;const v=n.decode(t.slice(p,p+h));p=p+h;const w=JSON.parse(n.decode(t.slice(p,t.byteLength)));return{ref:null,topic:s,event:v,payload:w}}}class rX{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Yi;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Yi||(Yi={}));const wU=(e,t,r={})=>{var n;const c=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(t).reduce((h,p)=>(h[p]=Lve(p,e,t,c),h),{})},Lve=(e,t,r,n)=>{const c=t.find(s=>s.name===e),h=c?.type,p=r[e];return h&&!n.includes(h)?nX(h,p):Fj(p)},nX=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return Bve(t,r)}switch(e){case Yi.bool:return zve(t);case Yi.float4:case Yi.float8:case Yi.int2:case Yi.int4:case Yi.int8:case Yi.numeric:case Yi.oid:return Nve(t);case Yi.json:case Yi.jsonb:return Fve(t);case Yi.timestamp:return Vve(t);case Yi.abstime:case Yi.date:case Yi.daterange:case Yi.int4range:case Yi.int8range:case Yi.money:case Yi.reltime:case Yi.text:case Yi.time:case Yi.timestamptz:case Yi.timetz:case Yi.tsrange:case Yi.tstzrange:return Fj(t);default:return Fj(t)}},Fj=e=>e,zve=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Nve=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Fve=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Bve=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let c;const h=e.slice(1,r);try{c=JSON.parse("["+h+"]")}catch{c=h?h.split(","):[]}return c.map(p=>nX(t,p))}return e},Vve=e=>typeof e=="string"?e.replace(" ","T"):e,iX=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class dM{constructor(t,r,n={},c=zj){this.channel=t,this.event=r,this.payload=n,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var SU;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(SU||(SU={}));class Tb{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},c=>{const{onJoin:h,onLeave:p,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Tb.syncState(this.state,c,h,p),this.pendingDiffs.forEach(v=>{this.state=Tb.syncDiff(this.state,v,h,p)}),this.pendingDiffs=[],s()}),this.channel._on(n.diff,{},c=>{const{onJoin:h,onLeave:p,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(c):(this.state=Tb.syncDiff(this.state,c,h,p),s())}),this.onJoin((c,h,p)=>{this.channel._trigger("presence",{event:"join",key:c,currentPresences:h,newPresences:p})}),this.onLeave((c,h,p)=>{this.channel._trigger("presence",{event:"leave",key:c,currentPresences:h,leftPresences:p})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,c){const h=this.cloneDeep(t),p=this.transformState(r),s={},v={};return this.map(h,(w,T)=>{p[w]||(v[w]=T)}),this.map(p,(w,T)=>{const I=h[w];if(I){const O=T.map(G=>G.presence_ref),D=I.map(G=>G.presence_ref),B=T.filter(G=>D.indexOf(G.presence_ref)<0),N=I.filter(G=>O.indexOf(G.presence_ref)<0);B.length>0&&(s[w]=B),N.length>0&&(v[w]=N)}else s[w]=T}),this.syncDiff(h,{joins:s,leaves:v},n,c)}static syncDiff(t,r,n,c){const{joins:h,leaves:p}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),c||(c=()=>{}),this.map(h,(s,v)=>{var w;const T=(w=t[s])!==null&&w!==void 0?w:[];if(t[s]=this.cloneDeep(v),T.length>0){const I=t[s].map(D=>D.presence_ref),O=T.filter(D=>I.indexOf(D.presence_ref)<0);t[s].unshift(...O)}n(s,T,v)}),this.map(p,(s,v)=>{let w=t[s];if(!w)return;const T=v.map(I=>I.presence_ref);w=w.filter(I=>T.indexOf(I.presence_ref)<0),t[s]=w,c(s,w,v),w.length===0&&delete t[s]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const c=t[n];return"metas"in c?r[n]=c.metas.map(h=>(h.presence_ref=h.phx_ref,delete h.phx_ref,delete h.phx_ref_prev,h)):r[n]=c,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var TU;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(TU||(TU={}));var Eb;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Eb||(Eb={}));var uh;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(uh||(uh={}));class F3{constructor(t,r={config:{}},n){this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=Qs.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new dM(this,dc.join,this.params,this.timeout),this.rejoinTimer=new rX(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Qs.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Qs.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Qs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Qs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Qs.errored,this.rejoinTimer.scheduleTimeout())}),this._on(dc.reply,{},(c,h)=>{this._trigger(this._replyEventName(h),c)}),this.presence=new Tb(this),this.broadcastEndpointURL=iX(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(t,r=this.timeout){var n,c;if(this.socket.isConnected()||this.socket.connect(),this.state==Qs.closed){const{config:{broadcast:h,presence:p,private:s}}=this.params,v=(c=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(O=>O.filter))!==null&&c!==void 0?c:[],w=!!this.bindings[Eb.PRESENCE]&&this.bindings[Eb.PRESENCE].length>0,T={},I={broadcast:h,presence:Object.assign(Object.assign({},p),{enabled:w}),postgres_changes:v,private:s};this.socket.accessTokenValue&&(T.access_token=this.socket.accessTokenValue),this._onError(O=>t?.(uh.CHANNEL_ERROR,O)),this._onClose(()=>t?.(uh.CLOSED)),this.updateJoinPayload(Object.assign({config:I},T)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:O})=>{var D;if(this.socket.setAuth(),O===void 0){t?.(uh.SUBSCRIBED);return}else{const B=this.bindings.postgres_changes,N=(D=B?.length)!==null&&D!==void 0?D:0,G=[];for(let U=0;U<N;U++){const V=B[U],{filter:{event:X,schema:Y,table:ne,filter:ae}}=V,le=O&&O[U];if(le&&le.event===X&&le.schema===Y&&le.table===ne&&le.filter===ae)G.push(Object.assign(Object.assign({},V),{id:le.id}));else{this.unsubscribe(),this.state=Qs.errored,t?.(uh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=G,t&&t(uh.SUBSCRIBED);return}}).receive("error",O=>{this.state=Qs.errored,t?.(uh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(O).join(", ")||"error")))}).receive("timeout",()=>{t?.(uh.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===Qs.joined&&t===Eb.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async send(t,r={}){var n,c;if(!this._canPush()&&t.type==="broadcast"){const{event:h,payload:p}=t,s={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:h,payload:p,private:this.private}]})};try{const v=await this._fetchWithTimeout(this.broadcastEndpointURL,s,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((c=v.body)===null||c===void 0?void 0:c.cancel()),v.ok?"ok":"error"}catch(v){return v.name==="AbortError"?"timed out":"error"}}else return new Promise(h=>{var p,s,v;const w=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((v=(s=(p=this.params)===null||p===void 0?void 0:p.config)===null||s===void 0?void 0:s.broadcast)===null||v===void 0)&&v.ack)&&h("ok"),w.receive("ok",()=>h("ok")),w.receive("error",()=>h("error")),w.receive("timeout",()=>h("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Qs.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(dc.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(c=>{n=new dM(this,dc.leave,{},t),n.receive("ok",()=>{r(),c("ok")}).receive("timeout",()=>{r(),c("timed out")}).receive("error",()=>{c("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Qs.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const c=new AbortController,h=setTimeout(()=>c.abort(),n),p=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:c.signal}));return clearTimeout(h),p}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let c=new dM(this,t,r,n);return this._canPush()?c.send():this._addToPushBuffer(c),c}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Rve){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var c,h;const p=t.toLocaleLowerCase(),{close:s,error:v,leave:w,join:T}=dc;if(n&&[s,v,w,T].indexOf(p)>=0&&n!==this._joinRef())return;let I=this._onMessage(p,r,n);if(r&&!I)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(p)?(c=this.bindings.postgres_changes)===null||c===void 0||c.filter(O=>{var D,B,N;return((D=O.filter)===null||D===void 0?void 0:D.event)==="*"||((N=(B=O.filter)===null||B===void 0?void 0:B.event)===null||N===void 0?void 0:N.toLocaleLowerCase())===p}).map(O=>O.callback(I,n)):(h=this.bindings[p])===null||h===void 0||h.filter(O=>{var D,B,N,G,U,V;if(["broadcast","presence","postgres_changes"].includes(p))if("id"in O){const X=O.id,Y=(D=O.filter)===null||D===void 0?void 0:D.event;return X&&((B=r.ids)===null||B===void 0?void 0:B.includes(X))&&(Y==="*"||Y?.toLocaleLowerCase()===((N=r.data)===null||N===void 0?void 0:N.type.toLocaleLowerCase()))}else{const X=(U=(G=O?.filter)===null||G===void 0?void 0:G.event)===null||U===void 0?void 0:U.toLocaleLowerCase();return X==="*"||X===((V=r?.event)===null||V===void 0?void 0:V.toLocaleLowerCase())}else return O.type.toLocaleLowerCase()===p}).map(O=>{if(typeof I=="object"&&"ids"in I){const D=I.data,{schema:B,table:N,commit_timestamp:G,type:U,errors:V}=D;I=Object.assign(Object.assign({},{schema:B,table:N,commit_timestamp:G,eventType:U,new:{},old:{},errors:V}),this._getPayloadRecords(D))}O.callback(I,n)})}_isClosed(){return this.state===Qs.closed}_isJoined(){return this.state===Qs.joined}_isJoining(){return this.state===Qs.joining}_isLeaving(){return this.state===Qs.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const c=t.toLocaleLowerCase(),h={type:c,filter:r,callback:n};return this.bindings[c]?this.bindings[c].push(h):this.bindings[c]=[h],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(c=>{var h;return!(((h=c.type)===null||h===void 0?void 0:h.toLocaleLowerCase())===n&&F3.isEqual(c.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(dc.close,{},t)}_onError(t){this._on(dc.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Qs.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=wU(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=wU(t.columns,t.old_record)),r}}const EU=()=>{},VT={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Uve=[1e3,2e3,5e3,1e4],$ve=1e4,Gve=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Hve{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=zj,this.transport=null,this.heartbeatIntervalMs=VT.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=EU,this.ref=0,this.reconnectTimer=null,this.logger=EU,this.conn=null,this.sendBuffer=[],this.serializer=new Dve,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=c=>{let h;return c?h=c:typeof fetch>"u"?h=(...p)=>tv(async()=>{const{default:s}=await Promise.resolve().then(()=>sv);return{default:s}}).then(({default:s})=>s(...p)).catch(s=>{throw new Error(`Failed to load @supabase/node-fetch: ${s.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):h=fetch,(...p)=>h(...p)},!(!((n=r?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${Nj.websocket}`,this.httpEndpoint=iX(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Cve.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ove}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},t?this.conn.close(t,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Sb.connecting:return qp.Connecting;case Sb.open:return qp.Open;case Sb.closing:return qp.Closing;default:return qp.Closed}}isConnected(){return this.connectionState()===qp.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,c=this.getChannels().find(h=>h.topic===n);if(c)return c;{const h=new F3(`realtime:${t}`,r,this);return this.channels.push(h),h}}push(t){const{topic:r,event:n,payload:c,ref:h}=t,p=()=>{this.encode(t,s=>{var v;(v=this.conn)===null||v===void 0||v.send(s)})};this.log("push",`${r} ${n} (${h})`,c),this.isConnected()?p():this.sendBuffer.push(p)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(jve,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},VT.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{r.topic==="phoenix"&&r.event==="phx_reply"&&this.heartbeatCallback(r.payload.status==="ok"?"ok":"error"),r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:c,payload:h,ref:p}=r,s=p?`(${p})`:"",v=h.status||"";this.log("receive",`${v} ${n} ${c} ${s}`.trim(),h),this.channels.filter(w=>w._isMember(n)).forEach(w=>w._trigger(c,h,p)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(dc.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",c=new URLSearchParams(r);return`${t}${n}${c}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([Gve],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const c={access_token:r,version:Mve};r&&n.updateJoinPayload(c),n.joinedOnce&&n._isJoined()&&n._push(dc.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(c){this.log("error",`error in ${t} callback`,c)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new rX(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},VT.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,c,h,p,s,v,w;if(this.transport=(r=t?.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t?.timeout)!==null&&n!==void 0?n:zj,this.heartbeatIntervalMs=(c=t?.heartbeatIntervalMs)!==null&&c!==void 0?c:VT.HEARTBEAT_INTERVAL,this.worker=(h=t?.worker)!==null&&h!==void 0?h:!1,this.accessToken=(p=t?.accessToken)!==null&&p!==void 0?p:null,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(s=t?.reconnectAfterMs)!==null&&s!==void 0?s:T=>Uve[T-1]||$ve,this.encode=(v=t?.encode)!==null&&v!==void 0?v:(T,I)=>I(JSON.stringify(T)),this.decode=(w=t?.decode)!==null&&w!==void 0?w:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}class B3 extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function eo(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class Wve extends B3{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Bj extends B3{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}var qve=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function s(T){try{w(n.next(T))}catch(I){p(I)}}function v(T){try{w(n.throw(T))}catch(I){p(I)}}function w(T){T.done?h(T.value):c(T.value).then(s,v)}w((n=n.apply(e,[])).next())})};const sX=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>tv(async()=>{const{default:n}=await Promise.resolve().then(()=>sv);return{default:n}}).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},Zve=()=>qve(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield tv(()=>Promise.resolve().then(()=>sv))).Response:Response}),Vj=e=>{if(Array.isArray(e))return e.map(r=>Vj(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const c=r.replace(/([-_][a-z])/gi,h=>h.toUpperCase().replace(/[-_]/g,""));t[c]=Vj(n)}),t},Kve=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)};var Dm=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function s(T){try{w(n.next(T))}catch(I){p(I)}}function v(T){try{w(n.throw(T))}catch(I){p(I)}}function w(T){T.done?h(T.value):c(T.value).then(s,v)}w((n=n.apply(e,[])).next())})};const fM=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Xve=(e,t,r)=>Dm(void 0,void 0,void 0,function*(){const n=yield Zve();e instanceof n&&!r?.noResolveJson?e.json().then(c=>{const h=e.status||500,p=c?.statusCode||h+"";t(new Wve(fM(c),h,p))}).catch(c=>{t(new Bj(fM(c),c))}):t(new Bj(fM(e),e))}),Yve=(e,t,r,n)=>{const c={method:e,headers:t?.headers||{}};return e==="GET"||!n?c:(Kve(n)?(c.headers=Object.assign({"Content-Type":"application/json"},t?.headers),c.body=JSON.stringify(n)):c.body=n,t?.duplex&&(c.duplex=t.duplex),Object.assign(Object.assign({},c),r))};function r1(e,t,r,n,c,h){return Dm(this,void 0,void 0,function*(){return new Promise((p,s)=>{e(r,Yve(t,n,c,h)).then(v=>{if(!v.ok)throw v;return n?.noResolveJson?v:v.json()}).then(v=>p(v)).catch(v=>Xve(v,s,n))})})}function yE(e,t,r,n){return Dm(this,void 0,void 0,function*(){return r1(e,"GET",t,r,n)})}function uu(e,t,r,n,c){return Dm(this,void 0,void 0,function*(){return r1(e,"POST",t,n,c,r)})}function Uj(e,t,r,n,c){return Dm(this,void 0,void 0,function*(){return r1(e,"PUT",t,n,c,r)})}function Jve(e,t,r,n){return Dm(this,void 0,void 0,function*(){return r1(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function oX(e,t,r,n,c){return Dm(this,void 0,void 0,function*(){return r1(e,"DELETE",t,n,c,r)})}var da=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function s(T){try{w(n.next(T))}catch(I){p(I)}}function v(T){try{w(n.throw(T))}catch(I){p(I)}}function w(T){T.done?h(T.value):c(T.value).then(s,v)}w((n=n.apply(e,[])).next())})};const Qve={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},AU={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class e0e{constructor(t,r={},n,c){this.url=t,this.headers=r,this.bucketId=n,this.fetch=sX(c)}uploadOrUpdate(t,r,n,c){return da(this,void 0,void 0,function*(){try{let h;const p=Object.assign(Object.assign({},AU),c);let s=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(p.upsert)});const v=p.metadata;typeof Blob<"u"&&n instanceof Blob?(h=new FormData,h.append("cacheControl",p.cacheControl),v&&h.append("metadata",this.encodeMetadata(v)),h.append("",n)):typeof FormData<"u"&&n instanceof FormData?(h=n,h.append("cacheControl",p.cacheControl),v&&h.append("metadata",this.encodeMetadata(v))):(h=n,s["cache-control"]=`max-age=${p.cacheControl}`,s["content-type"]=p.contentType,v&&(s["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),c?.headers&&(s=Object.assign(Object.assign({},s),c.headers));const w=this._removeEmptyFolders(r),T=this._getFinalPath(w),I=yield(t=="PUT"?Uj:uu)(this.fetch,`${this.url}/object/${T}`,h,Object.assign({headers:s},p?.duplex?{duplex:p.duplex}:{}));return{data:{path:w,id:I.Id,fullPath:I.Key},error:null}}catch(h){if(eo(h))return{data:null,error:h};throw h}})}upload(t,r,n){return da(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,c){return da(this,void 0,void 0,function*(){const h=this._removeEmptyFolders(t),p=this._getFinalPath(h),s=new URL(this.url+`/object/upload/sign/${p}`);s.searchParams.set("token",r);try{let v;const w=Object.assign({upsert:AU.upsert},c),T=Object.assign(Object.assign({},this.headers),{"x-upsert":String(w.upsert)});typeof Blob<"u"&&n instanceof Blob?(v=new FormData,v.append("cacheControl",w.cacheControl),v.append("",n)):typeof FormData<"u"&&n instanceof FormData?(v=n,v.append("cacheControl",w.cacheControl)):(v=n,T["cache-control"]=`max-age=${w.cacheControl}`,T["content-type"]=w.contentType);const I=yield Uj(this.fetch,s.toString(),v,{headers:T});return{data:{path:h,fullPath:I.Key},error:null}}catch(v){if(eo(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(t,r){return da(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const c=Object.assign({},this.headers);r?.upsert&&(c["x-upsert"]="true");const h=yield uu(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:c}),p=new URL(this.url+h.url),s=p.searchParams.get("token");if(!s)throw new B3("No token returned by API");return{data:{signedUrl:p.toString(),path:t,token:s},error:null}}catch(n){if(eo(n))return{data:null,error:n};throw n}})}update(t,r,n){return da(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return da(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(c){if(eo(c))return{data:null,error:c};throw c}})}copy(t,r,n){return da(this,void 0,void 0,function*(){try{return{data:{path:(yield uu(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(c){if(eo(c))return{data:null,error:c};throw c}})}createSignedUrl(t,r,n){return da(this,void 0,void 0,function*(){try{let c=this._getFinalPath(t),h=yield uu(this.fetch,`${this.url}/object/sign/${c}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const p=n?.download?`&download=${n.download===!0?"":n.download}`:"";return h={signedUrl:encodeURI(`${this.url}${h.signedURL}${p}`)},{data:h,error:null}}catch(c){if(eo(c))return{data:null,error:c};throw c}})}createSignedUrls(t,r,n){return da(this,void 0,void 0,function*(){try{const c=yield uu(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),h=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:c.map(p=>Object.assign(Object.assign({},p),{signedUrl:p.signedURL?encodeURI(`${this.url}${p.signedURL}${h}`):null})),error:null}}catch(c){if(eo(c))return{data:null,error:c};throw c}})}download(t,r){return da(this,void 0,void 0,function*(){const n=typeof r?.transform<"u"?"render/image/authenticated":"object",c=this.transformOptsToQueryString(r?.transform||{}),h=c?`?${c}`:"";try{const p=this._getFinalPath(t);return{data:yield(yield yE(this.fetch,`${this.url}/${n}/${p}${h}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(p){if(eo(p))return{data:null,error:p};throw p}})}info(t){return da(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield yE(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:Vj(n),error:null}}catch(n){if(eo(n))return{data:null,error:n};throw n}})}exists(t){return da(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield Jve(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(eo(n)&&n instanceof Bj){const c=n.originalError;if([400,404].includes(c?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),c=[],h=r?.download?`download=${r.download===!0?"":r.download}`:"";h!==""&&c.push(h);const p=typeof r?.transform<"u"?"render/image":"object",s=this.transformOptsToQueryString(r?.transform||{});s!==""&&c.push(s);let v=c.join("&");return v!==""&&(v=`?${v}`),{data:{publicUrl:encodeURI(`${this.url}/${p}/public/${n}${v}`)}}}remove(t){return da(this,void 0,void 0,function*(){try{return{data:yield oX(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(eo(r))return{data:null,error:r};throw r}})}list(t,r,n){return da(this,void 0,void 0,function*(){try{const c=Object.assign(Object.assign(Object.assign({},Qve),r),{prefix:t||""});return{data:yield uu(this.fetch,`${this.url}/object/list/${this.bucketId}`,c,{headers:this.headers},n),error:null}}catch(c){if(eo(c))return{data:null,error:c};throw c}})}listV2(t,r){return da(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield uu(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(eo(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const t0e="2.11.0",r0e={"X-Client-Info":`storage-js/${t0e}`};var hy=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function s(T){try{w(n.next(T))}catch(I){p(I)}}function v(T){try{w(n.throw(T))}catch(I){p(I)}}function w(T){T.done?h(T.value):c(T.value).then(s,v)}w((n=n.apply(e,[])).next())})};class n0e{constructor(t,r={},n,c){const h=new URL(t);c?.useNewHostname&&/supabase\.(co|in|red)$/.test(h.hostname)&&!h.hostname.includes("storage.supabase.")&&(h.hostname=h.hostname.replace("supabase.","storage.supabase.")),this.url=h.href,this.headers=Object.assign(Object.assign({},r0e),r),this.fetch=sX(n)}listBuckets(){return hy(this,void 0,void 0,function*(){try{return{data:yield yE(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(eo(t))return{data:null,error:t};throw t}})}getBucket(t){return hy(this,void 0,void 0,function*(){try{return{data:yield yE(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(eo(r))return{data:null,error:r};throw r}})}createBucket(t,r={public:!1}){return hy(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(eo(n))return{data:null,error:n};throw n}})}updateBucket(t,r){return hy(this,void 0,void 0,function*(){try{return{data:yield Uj(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(eo(n))return{data:null,error:n};throw n}})}emptyBucket(t){return hy(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(eo(r))return{data:null,error:r};throw r}})}deleteBucket(t){return hy(this,void 0,void 0,function*(){try{return{data:yield oX(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(eo(r))return{data:null,error:r};throw r}})}}class i0e extends n0e{constructor(t,r={},n,c){super(t,r,n,c)}from(t){return new e0e(this.url,this.headers,t,this.fetch)}}const s0e="2.56.0";let nb="";typeof Deno<"u"?nb="deno":typeof document<"u"?nb="web":typeof navigator<"u"&&navigator.product==="ReactNative"?nb="react-native":nb="node";const o0e={"X-Client-Info":`supabase-js-${nb}/${s0e}`},a0e={headers:o0e},l0e={schema:"public"},c0e={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},u0e={};var h0e=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function s(T){try{w(n.next(T))}catch(I){p(I)}}function v(T){try{w(n.throw(T))}catch(I){p(I)}}function w(T){T.done?h(T.value):c(T.value).then(s,v)}w((n=n.apply(e,[])).next())})};const d0e=e=>{let t;return e?t=e:typeof fetch>"u"?t=HK:t=fetch,(...r)=>t(...r)},f0e=()=>typeof Headers>"u"?WK:Headers,p0e=(e,t,r)=>{const n=d0e(r),c=f0e();return(h,p)=>h0e(void 0,void 0,void 0,function*(){var s;const v=(s=yield t())!==null&&s!==void 0?s:e;let w=new c(p?.headers);return w.has("apikey")||w.set("apikey",e),w.has("Authorization")||w.set("Authorization",`Bearer ${v}`),n(h,Object.assign(Object.assign({},p),{headers:w}))})};var m0e=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function s(T){try{w(n.next(T))}catch(I){p(I)}}function v(T){try{w(n.throw(T))}catch(I){p(I)}}function w(T){T.done?h(T.value):c(T.value).then(s,v)}w((n=n.apply(e,[])).next())})};function g0e(e){return e.endsWith("/")?e:e+"/"}function y0e(e,t){var r,n;const{db:c,auth:h,realtime:p,global:s}=e,{db:v,auth:w,realtime:T,global:I}=t,O={db:Object.assign(Object.assign({},v),c),auth:Object.assign(Object.assign({},w),h),realtime:Object.assign(Object.assign({},T),p),storage:{},global:Object.assign(Object.assign(Object.assign({},I),s),{headers:Object.assign(Object.assign({},(r=I?.headers)!==null&&r!==void 0?r:{}),(n=s?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>m0e(this,void 0,void 0,function*(){return""})};return e.accessToken?O.accessToken=e.accessToken:delete O.accessToken,O}const aX="2.71.1",wy=30*1e3,$j=3,pM=$j*wy,_0e="http://localhost:9999",v0e="supabase.auth.token",x0e={"X-Client-Info":`gotrue-js/${aX}`},Gj="X-Supabase-Api-Version",lX={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},b0e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,w0e=10*60*1e3;class V3 extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function Fn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class S0e extends V3{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function T0e(e){return Fn(e)&&e.name==="AuthApiError"}class cX extends V3{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Sf extends V3{constructor(t,r,n,c){super(t,n,c),this.name=r,this.status=n}}class Vd extends Sf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function E0e(e){return Fn(e)&&e.name==="AuthSessionMissingError"}class UT extends Sf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class $T extends Sf{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class GT extends Sf{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function A0e(e){return Fn(e)&&e.name==="AuthImplicitGrantRedirectError"}class kU extends Sf{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Hj extends Sf{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function mM(e){return Fn(e)&&e.name==="AuthRetryableFetchError"}class PU extends Sf{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class Wj extends Sf{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const _E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),CU=` 	
\r=`.split(""),k0e=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<CU.length;t+=1)e[CU[t].charCodeAt(0)]=-2;for(let t=0;t<_E.length;t+=1)e[_E[t].charCodeAt(0)]=t;return e})();function IU(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(_E[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(_E[n]),t.queuedBits-=6}}function uX(e,t,r){const n=k0e[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function MU(e){const t=[],r=p=>{t.push(String.fromCodePoint(p))},n={utf8seq:0,codepoint:0},c={queue:0,queuedBits:0},h=p=>{I0e(p,n,r)};for(let p=0;p<e.length;p+=1)uX(e.charCodeAt(p),c,h);return t.join("")}function P0e(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function C0e(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const c=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|c)+65536,r+=1}P0e(n,t)}}function I0e(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function M0e(e){const t=[],r={queue:0,queuedBits:0},n=c=>{t.push(c)};for(let c=0;c<e.length;c+=1)uX(e.charCodeAt(c),r,n);return new Uint8Array(t)}function O0e(e){const t=[];return C0e(e,r=>t.push(r)),new Uint8Array(t)}function j0e(e){const t=[],r={queue:0,queuedBits:0},n=c=>{t.push(c)};return e.forEach(c=>IU(c,r,n)),IU(null,r,n),t.join("")}function R0e(e){return Math.round(Date.now()/1e3)+e}function D0e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const oc=()=>typeof window<"u"&&typeof document<"u",Rp={tested:!1,writable:!1},hX=()=>{if(!oc())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Rp.tested)return Rp.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Rp.tested=!0,Rp.writable=!0}catch{Rp.tested=!0,Rp.writable=!1}return Rp.writable};function L0e(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((n,c)=>{t[c]=n})}catch{}return r.searchParams.forEach((n,c)=>{t[c]=n}),t}const dX=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>tv(async()=>{const{default:n}=await Promise.resolve().then(()=>sv);return{default:n}}).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},z0e=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Sy=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Dp=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Fd=async(e,t)=>{await e.removeItem(t)};class fk{constructor(){this.promise=new fk.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}fk.promiseConstructor=Promise;function gM(e){const t=e.split(".");if(t.length!==3)throw new Wj("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!b0e.test(t[r]))throw new Wj("JWT not in base64url format");return{header:JSON.parse(MU(t[0])),payload:JSON.parse(MU(t[1])),signature:M0e(t[2]),raw:{header:t[0],payload:t[1]}}}async function N0e(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function F0e(e,t){return new Promise((r,n)=>{(async()=>{for(let c=0;c<1/0;c++)try{const h=await e(c);if(!t(c,null,h)){r(h);return}}catch(h){if(!t(c,h)){n(h);return}}})()})}function B0e(e){return("0"+e.toString(16)).substr(-2)}function V0e(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let c=0;c<56;c++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,B0e).join("")}async function U0e(e){const t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(c=>String.fromCharCode(c)).join("")}async function $0e(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await U0e(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function dy(e,t,r=!1){const n=V0e();let c=n;r&&(c+="/PASSWORD_RECOVERY"),await Sy(e,`${t}-code-verifier`,c);const h=await $0e(n);return[h,n===h?"plain":"s256"]}const G0e=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function H0e(e){const t=e.headers.get(Gj);if(!t||!t.match(G0e))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function W0e(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function q0e(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Z0e=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function fy(e){if(!Z0e.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function yM(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function OU(e){return JSON.parse(JSON.stringify(e))}var K0e=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(e);c<n.length;c++)t.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(e,n[c])&&(r[n[c]]=e[n[c]]);return r};const Up=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),X0e=[502,503,504];async function jU(e){var t;if(!z0e(e))throw new Hj(Up(e),0);if(X0e.includes(e.status))throw new Hj(Up(e),e.status);let r;try{r=await e.json()}catch(h){throw new cX(Up(h),h)}let n;const c=H0e(e);if(c&&c.getTime()>=lX["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new PU(Up(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new Vd}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((h,p)=>h&&typeof p=="string",!0))throw new PU(Up(r),e.status,r.weak_password.reasons);throw new S0e(Up(r),e.status||500,n)}const Y0e=(e,t,r,n)=>{const c={method:e,headers:t?.headers||{}};return e==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),c.body=JSON.stringify(n),Object.assign(Object.assign({},c),r))};async function oi(e,t,r,n){var c;const h=Object.assign({},n?.headers);h[Gj]||(h[Gj]=lX["2024-01-01"].name),n?.jwt&&(h.Authorization=`Bearer ${n.jwt}`);const p=(c=n?.query)!==null&&c!==void 0?c:{};n?.redirectTo&&(p.redirect_to=n.redirectTo);const s=Object.keys(p).length?"?"+new URLSearchParams(p).toString():"",v=await J0e(e,t,r+s,{headers:h,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(v):{data:Object.assign({},v),error:null}}async function J0e(e,t,r,n,c,h){const p=Y0e(t,n,c,h);let s;try{s=await e(r,Object.assign({},p))}catch(v){throw console.error(v),new Hj(Up(v),0)}if(s.ok||await jU(s),n?.noResolveJson)return s;try{return await s.json()}catch(v){await jU(v)}}function lh(e){var t;let r=null;rxe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=R0e(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function RU(e){const t=lh(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Xd(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Q0e(e){return{data:e,error:null}}function exe(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:c,verification_type:h}=e,p=K0e(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),s={action_link:t,email_otp:r,hashed_token:n,redirect_to:c,verification_type:h},v=Object.assign({},p);return{data:{properties:s,user:v},error:null}}function txe(e){return e}function rxe(e){return e.access_token&&e.refresh_token&&e.expires_in}const _M=["global","local","others"];var nxe=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(e);c<n.length;c++)t.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(e,n[c])&&(r[n[c]]=e[n[c]]);return r};class ixe{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=dX(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,r=_M[0]){if(_M.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${_M.join(", ")}`);try{return await oi(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Fn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await oi(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Xd})}catch(n){if(Fn(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=nxe(t,["options"]),c=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(c.new_email=n?.newEmail,delete c.newEmail),await oi(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:c,headers:this.headers,xform:exe,redirectTo:r?.redirectTo})}catch(r){if(Fn(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await oi(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Xd})}catch(r){if(Fn(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,c,h,p,s,v;try{const w={nextPage:null,lastPage:0,total:0},T=await oi(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(h=(c=t?.perPage)===null||c===void 0?void 0:c.toString())!==null&&h!==void 0?h:""},xform:txe});if(T.error)throw T.error;const I=await T.json(),O=(p=T.headers.get("x-total-count"))!==null&&p!==void 0?p:0,D=(v=(s=T.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&v!==void 0?v:[];return D.length>0&&(D.forEach(B=>{const N=parseInt(B.split(";")[0].split("=")[1].substring(0,1)),G=JSON.parse(B.split(";")[1].split("=")[1]);w[`${G}Page`]=N}),w.total=parseInt(O)),{data:Object.assign(Object.assign({},I),w),error:null}}catch(w){if(Fn(w))return{data:{users:[]},error:w};throw w}}async getUserById(t){fy(t);try{return await oi(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Xd})}catch(r){if(Fn(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){fy(t);try{return await oi(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Xd})}catch(n){if(Fn(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){fy(t);try{return await oi(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Xd})}catch(n){if(Fn(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){fy(t.userId);try{const{data:r,error:n}=await oi(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:c=>({data:{factors:c},error:null})});return{data:r,error:n}}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async _deleteFactor(t){fy(t.userId),fy(t.id);try{return{data:await oi(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(Fn(r))return{data:null,error:r};throw r}}}function DU(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}function sxe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const py={debug:!!(globalThis&&hX()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class fX extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class oxe extends fX{}async function axe(e,t,r){py.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),py.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async c=>{if(c){py.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,c.name);try{return await r()}finally{py.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,c.name)}}else{if(t===0)throw py.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new oxe(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(py.debug)try{const h=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(h,null,"  "))}catch(h){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",h)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}sxe();const lxe={url:_0e,storageKey:v0e,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:x0e,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function LU(e,t,r){return await r()}const my={};class sw{constructor(t){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=sw.nextInstanceID,sw.nextInstanceID+=1,this.instanceID>0&&oc()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const c=Object.assign(Object.assign({},lxe),t);if(this.logDebugMessages=!!c.debug,typeof c.debug=="function"&&(this.logger=c.debug),this.persistSession=c.persistSession,this.storageKey=c.storageKey,this.autoRefreshToken=c.autoRefreshToken,this.admin=new ixe({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=dX(c.fetch),this.lock=c.lock||LU,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,c.lock?this.lock=c.lock:oc()&&!((r=globalThis?.navigator)===null||r===void 0)&&r.locks?this.lock=axe:this.lock=LU,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(c.storage?this.storage=c.storage:hX()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=DU(this.memoryStorage)),c.userStorage&&(this.userStorage=c.userStorage)):(this.memoryStorage={},this.storage=DU(this.memoryStorage)),oc()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(h){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",h)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async h=>{this._debug("received broadcast notification from other tab or client",h),await this._notifyAllSubscribers(h.data.event,h.data.session,!1)})}this.initialize()}get jwks(){var t,r;return(r=(t=my[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){my[this.storageKey]=Object.assign(Object.assign({},my[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=my[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){my[this.storageKey]=Object.assign(Object.assign({},my[this.storageKey]),{cachedAt:t})}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${aX}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const r=L0e(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),oc()&&this.detectSessionInUrl&&n!=="none"){const{data:c,error:h}=await this._getSessionFromURL(r,n);if(h){if(this._debug("#_initialize()","error detecting session from URL",h),A0e(h)){const v=(t=h.details)===null||t===void 0?void 0:t.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:h}}return await this._removeSession(),{error:h}}const{session:p,redirectType:s}=c;return this._debug("#_initialize()","detected session in URL",p,"redirect type",s),await this._saveSession(p),setTimeout(async()=>{s==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",p):await this._notifyAllSubscribers("SIGNED_IN",p)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Fn(r)?{error:r}:{error:new cX("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,c;try{const h=await oi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(c=t?.options)===null||c===void 0?void 0:c.captchaToken}},xform:lh}),{data:p,error:s}=h;if(s||!p)return{data:{user:null,session:null},error:s};const v=p.session,w=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:w,session:v},error:null}}catch(h){if(Fn(h))return{data:{user:null,session:null},error:h};throw h}}async signUp(t){var r,n,c;try{let h;if("email"in t){const{email:T,password:I,options:O}=t;let D=null,B=null;this.flowType==="pkce"&&([D,B]=await dy(this.storage,this.storageKey)),h=await oi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:O?.emailRedirectTo,body:{email:T,password:I,data:(r=O?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:O?.captchaToken},code_challenge:D,code_challenge_method:B},xform:lh})}else if("phone"in t){const{phone:T,password:I,options:O}=t;h=await oi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:T,password:I,data:(n=O?.data)!==null&&n!==void 0?n:{},channel:(c=O?.channel)!==null&&c!==void 0?c:"sms",gotrue_meta_security:{captcha_token:O?.captchaToken}},xform:lh})}else throw new $T("You must provide either an email or phone number and a password");const{data:p,error:s}=h;if(s||!p)return{data:{user:null,session:null},error:s};const v=p.session,w=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:w,session:v},error:null}}catch(h){if(Fn(h))return{data:{user:null,session:null},error:h};throw h}}async signInWithPassword(t){try{let r;if("email"in t){const{email:h,password:p,options:s}=t;r=await oi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:h,password:p,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:RU})}else if("phone"in t){const{phone:h,password:p,options:s}=t;r=await oi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:h,password:p,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:RU})}else throw new $T("You must provide either an email or phone number and a password");const{data:n,error:c}=r;return c?{data:{user:null,session:null},error:c}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new UT}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:c})}catch(r){if(Fn(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(t){var r,n,c,h;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:(h=t.options)===null||h===void 0?void 0:h.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;if(r==="solana")return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(t){var r,n,c,h,p,s,v,w,T,I,O,D;let B,N;if("message"in t)B=t.message,N=t.signature;else{const{chain:G,wallet:U,statement:V,options:X}=t;let Y;if(oc())if(typeof U=="object")Y=U;else{const ae=window;if("solana"in ae&&typeof ae.solana=="object"&&("signIn"in ae.solana&&typeof ae.solana.signIn=="function"||"signMessage"in ae.solana&&typeof ae.solana.signMessage=="function"))Y=ae.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof U!="object"||!X?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Y=U}const ne=new URL((r=X?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in Y&&Y.signIn){const ae=await Y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},X?.signInWithSolana),{version:"1",domain:ne.host,uri:ne.href}),V?{statement:V}:null));let le;if(Array.isArray(ae)&&ae[0]&&typeof ae[0]=="object")le=ae[0];else if(ae&&typeof ae=="object"&&"signedMessage"in ae&&"signature"in ae)le=ae;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in le&&"signature"in le&&(typeof le.signedMessage=="string"||le.signedMessage instanceof Uint8Array)&&le.signature instanceof Uint8Array)B=typeof le.signedMessage=="string"?le.signedMessage:new TextDecoder().decode(le.signedMessage),N=le.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Y)||typeof Y.signMessage!="function"||!("publicKey"in Y)||typeof Y!="object"||!Y.publicKey||!("toBase58"in Y.publicKey)||typeof Y.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");B=[`${ne.host} wants you to sign in with your Solana account:`,Y.publicKey.toBase58(),...V?["",V,""]:[""],"Version: 1",`URI: ${ne.href}`,`Issued At: ${(c=(n=X?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&c!==void 0?c:new Date().toISOString()}`,...!((h=X?.signInWithSolana)===null||h===void 0)&&h.notBefore?[`Not Before: ${X.signInWithSolana.notBefore}`]:[],...!((p=X?.signInWithSolana)===null||p===void 0)&&p.expirationTime?[`Expiration Time: ${X.signInWithSolana.expirationTime}`]:[],...!((s=X?.signInWithSolana)===null||s===void 0)&&s.chainId?[`Chain ID: ${X.signInWithSolana.chainId}`]:[],...!((v=X?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${X.signInWithSolana.nonce}`]:[],...!((w=X?.signInWithSolana)===null||w===void 0)&&w.requestId?[`Request ID: ${X.signInWithSolana.requestId}`]:[],...!((I=(T=X?.signInWithSolana)===null||T===void 0?void 0:T.resources)===null||I===void 0)&&I.length?["Resources",...X.signInWithSolana.resources.map(le=>`- ${le}`)]:[]].join(`
`);const ae=await Y.signMessage(new TextEncoder().encode(B),"utf8");if(!ae||!(ae instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=ae}}try{const{data:G,error:U}=await oi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:B,signature:j0e(N)},!((O=t.options)===null||O===void 0)&&O.captchaToken?{gotrue_meta_security:{captcha_token:(D=t.options)===null||D===void 0?void 0:D.captchaToken}}:null),xform:lh});if(U)throw U;return!G||!G.session||!G.user?{data:{user:null,session:null},error:new UT}:(G.session&&(await this._saveSession(G.session),await this._notifyAllSubscribers("SIGNED_IN",G.session)),{data:Object.assign({},G),error:U})}catch(G){if(Fn(G))return{data:{user:null,session:null},error:G};throw G}}async _exchangeCodeForSession(t){const r=await Dp(this.storage,`${this.storageKey}-code-verifier`),[n,c]=(r??"").split("/");try{const{data:h,error:p}=await oi(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:lh});if(await Fd(this.storage,`${this.storageKey}-code-verifier`),p)throw p;return!h||!h.session||!h.user?{data:{user:null,session:null,redirectType:null},error:new UT}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:Object.assign(Object.assign({},h),{redirectType:c??null}),error:p})}catch(h){if(Fn(h))return{data:{user:null,session:null,redirectType:null},error:h};throw h}}async signInWithIdToken(t){try{const{options:r,provider:n,token:c,access_token:h,nonce:p}=t,s=await oi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:c,access_token:h,nonce:p,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:lh}),{data:v,error:w}=s;return w?{data:{user:null,session:null},error:w}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new UT}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:w})}catch(r){if(Fn(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(t){var r,n,c,h,p;try{if("email"in t){const{email:s,options:v}=t;let w=null,T=null;this.flowType==="pkce"&&([w,T]=await dy(this.storage,this.storageKey));const{error:I}=await oi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:(r=v?.data)!==null&&r!==void 0?r:{},create_user:(n=v?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:w,code_challenge_method:T},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:I}}if("phone"in t){const{phone:s,options:v}=t,{data:w,error:T}=await oi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:s,data:(c=v?.data)!==null&&c!==void 0?c:{},create_user:(h=v?.shouldCreateUser)!==null&&h!==void 0?h:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(p=v?.channel)!==null&&p!==void 0?p:"sms"}});return{data:{user:null,session:null,messageId:w?.message_id},error:T}}throw new $T("You must provide either an email or phone number.")}catch(s){if(Fn(s))return{data:{user:null,session:null},error:s};throw s}}async verifyOtp(t){var r,n;try{let c,h;"options"in t&&(c=(r=t.options)===null||r===void 0?void 0:r.redirectTo,h=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:p,error:s}=await oi(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:h}}),redirectTo:c,xform:lh});if(s)throw s;if(!p)throw new Error("An error occurred on token verification.");const v=p.session,w=p.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:w,session:v},error:null}}catch(c){if(Fn(c))return{data:{user:null,session:null},error:c};throw c}}async signInWithSSO(t){var r,n,c;try{let h=null,p=null;return this.flowType==="pkce"&&([h,p]=await dy(this.storage,this.storageKey)),await oi(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((c=t?.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:p}),headers:this.headers,xform:Q0e})}catch(h){if(Fn(h))return{data:null,error:h};throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new Vd;const{error:c}=await oi(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:c}})}catch(t){if(Fn(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:c,options:h}=t,{error:p}=await oi(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:c,gotrue_meta_security:{captcha_token:h?.captchaToken}},redirectTo:h?.emailRedirectTo});return{data:{user:null,session:null},error:p}}else if("phone"in t){const{phone:n,type:c,options:h}=t,{data:p,error:s}=await oi(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:c,gotrue_meta_security:{captcha_token:h?.captchaToken}}});return{data:{user:null,session:null,messageId:p?.message_id},error:s}}throw new $T("You must provide either an email or phone number and a type")}catch(r){if(Fn(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await c}catch{}})()),c}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const c=[...this.pendingInLock];await Promise.all(c),this.pendingInLock.splice(0,c.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Dp(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<pM:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const p=await Dp(this.userStorage,this.storageKey+"-user");p?.user?t.user=p.user:t.user=yM()}if(this.storage.isServer&&t.user){let p=this.suppressGetSessionWarning;t=new Proxy(t,{get:(s,v,w)=>(!p&&v==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),p=!0,this.suppressGetSessionWarning=!0),Reflect.get(s,v,w))})}return{data:{session:t},error:null}}const{session:c,error:h}=await this._callRefreshToken(t.refresh_token);return h?{data:{session:null},error:h}:{data:{session:c},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await oi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Xd}):await this._useSession(async r=>{var n,c,h;const{data:p,error:s}=r;if(s)throw s;return!(!((n=p.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Vd}:await oi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(h=(c=p.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0,xform:Xd})})}catch(r){if(Fn(r))return E0e(r)&&(await this._removeSession(),await Fd(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:c,error:h}=n;if(h)throw h;if(!c.session)throw new Vd;const p=c.session;let s=null,v=null;this.flowType==="pkce"&&t.email!=null&&([s,v]=await dy(this.storage,this.storageKey));const{data:w,error:T}=await oi(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:s,code_challenge_method:v}),jwt:p.access_token,xform:Xd});if(T)throw T;return p.user=w.user,await this._saveSession(p),await this._notifyAllSubscribers("USER_UPDATED",p),{data:{user:p.user},error:null}})}catch(n){if(Fn(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Vd;const r=Date.now()/1e3;let n=r,c=!0,h=null;const{payload:p}=gM(t.access_token);if(p.exp&&(n=p.exp,c=n<=r),c){const{session:s,error:v}=await this._callRefreshToken(t.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!s)return{data:{user:null,session:null},error:null};h=s}else{const{data:s,error:v}=await this._getUser(t.access_token);if(v)throw v;h={access_token:t.access_token,refresh_token:t.refresh_token,user:s.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(h),await this._notifyAllSubscribers("SIGNED_IN",h)}return{data:{user:h.user,session:h},error:null}}catch(r){if(Fn(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:p,error:s}=r;if(s)throw s;t=(n=p.session)!==null&&n!==void 0?n:void 0}if(!t?.refresh_token)throw new Vd;const{session:c,error:h}=await this._callRefreshToken(t.refresh_token);return h?{data:{user:null,session:null},error:h}:c?{data:{user:c.user,session:c},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Fn(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(t,r){try{if(!oc())throw new GT("No browser detected.");if(t.error||t.error_description||t.error_code)throw new GT(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new kU("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new GT("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new kU("No code detected.");const{data:V,error:X}=await this._exchangeCodeForSession(t.code);if(X)throw X;const Y=new URL(window.location.href);return Y.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Y.toString()),{data:{session:V.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:c,access_token:h,refresh_token:p,expires_in:s,expires_at:v,token_type:w}=t;if(!h||!s||!p||!w)throw new GT("No session defined in URL");const T=Math.round(Date.now()/1e3),I=parseInt(s);let O=T+I;v&&(O=parseInt(v));const D=O-T;D*1e3<=wy&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${D}s, should have been closer to ${I}s`);const B=O-I;T-B>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",B,O,T):T-B<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",B,O,T);const{data:N,error:G}=await this._getUser(h);if(G)throw G;const U={provider_token:n,provider_refresh_token:c,access_token:h,expires_in:I,expires_at:O,refresh_token:p,token_type:w,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:U,redirectType:t.type},error:null}}catch(n){if(Fn(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Dp(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:c,error:h}=r;if(h)return{error:h};const p=(n=c.session)===null||n===void 0?void 0:n.access_token;if(p){const{error:s}=await this.admin.signOut(p,t);if(s&&!(T0e(s)&&(s.status===404||s.status===401||s.status===403)))return{error:s}}return t!=="others"&&(await this._removeSession(),await Fd(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const r=D0e(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,c;try{const{data:{session:h},error:p}=r;if(p)throw p;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",h)),this._debug("INITIAL_SESSION","callback id",t,"session",h)}catch(h){await((c=this.stateChangeEmitters.get(t))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",h),console.error(h)}})}async resetPasswordForEmail(t,r={}){let n=null,c=null;this.flowType==="pkce"&&([n,c]=await dy(this.storage,this.storageKey,!0));try{return await oi(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:c,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(h){if(Fn(h))return{data:null,error:h};throw h}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async linkIdentity(t){var r;try{const{data:n,error:c}=await this._useSession(async h=>{var p,s,v,w,T;const{data:I,error:O}=h;if(O)throw O;const D=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(p=t.options)===null||p===void 0?void 0:p.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(v=t.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await oi(this.fetch,"GET",D,{headers:this.headers,jwt:(T=(w=I.session)===null||w===void 0?void 0:w.access_token)!==null&&T!==void 0?T:void 0})});if(c)throw c;return oc()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:t.provider,url:n?.url},error:null}}catch(n){if(Fn(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,c;const{data:h,error:p}=r;if(p)throw p;return await oi(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(c=(n=h.session)===null||n===void 0?void 0:n.access_token)!==null&&c!==void 0?c:void 0})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await F0e(async c=>(c>0&&await N0e(200*Math.pow(2,c-1)),this._debug(r,"refreshing attempt",c),await oi(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:lh})),(c,h)=>{const p=200*Math.pow(2,c);return h&&mM(h)&&Date.now()+p-n<wy})}catch(n){if(this._debug(r,"error",n),Fn(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),oc()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const c=await Dp(this.storage,this.storageKey);if(c&&this.userStorage){let p=await Dp(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!p&&(p={user:c.user},await Sy(this.userStorage,this.storageKey+"-user",p)),c.user=(t=p?.user)!==null&&t!==void 0?t:yM()}else if(c&&!c.user&&!c.user){const p=await Dp(this.storage,this.storageKey+"-user");p&&p?.user?(c.user=p.user,await Fd(this.storage,this.storageKey+"-user"),await Sy(this.storage,this.storageKey,c)):c.user=yM()}if(this._debug(n,"session from storage",c),!this._isValidSession(c)){this._debug(n,"session is not valid"),c!==null&&await this._removeSession();return}const h=((r=c.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<pM;if(this._debug(n,`session has${h?"":" not"} expired with margin of ${pM}s`),h){if(this.autoRefreshToken&&c.refresh_token){const{error:p}=await this._callRefreshToken(c.refresh_token);p&&(console.error(p),mM(p)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",p),await this._removeSession()))}}else if(c.user&&c.user.__isUserNotAvailableProxy===!0)try{const{data:p,error:s}=await this._getUser(c.access_token);!s&&p?.user?(c.user=p.user,await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(p){console.error("Error getting user data:",p),this._debug(n,"error getting user data, skipping SIGNED_IN notification",p)}else await this._notifyAllSubscribers("SIGNED_IN",c)}catch(c){this._debug(n,"error",c),console.error(c);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new Vd;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const c=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(c,"begin");try{this.refreshingDeferred=new fk;const{data:h,error:p}=await this._refreshAccessToken(t);if(p)throw p;if(!h.session)throw new Vd;await this._saveSession(h.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",h.session);const s={session:h.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(h){if(this._debug(c,"error",h),Fn(h)){const p={session:null,error:h};return mM(h)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(p),p}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(h),h}finally{this.refreshingDeferred=null,this._debug(c,"end")}}async _notifyAllSubscribers(t,r,n=!0){const c=`#_notifyAllSubscribers(${t})`;this._debug(c,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const h=[],p=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(t,r)}catch(v){h.push(v)}});if(await Promise.all(p),h.length>0){for(let s=0;s<h.length;s+=1)console.error(h[s]);throw h[0]}}finally{this._debug(c,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Sy(this.userStorage,this.storageKey+"-user",{user:r.user});const c=Object.assign({},r);delete c.user;const h=OU(c);await Sy(this.storage,this.storageKey,h)}else{const c=OU(r);await Sy(this.storage,this.storageKey,c)}}async _removeSession(){this._debug("#_removeSession()"),await Fd(this.storage,this.storageKey),await Fd(this.storage,this.storageKey+"-code-verifier"),await Fd(this.storage,this.storageKey+"-user"),this.userStorage&&await Fd(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&oc()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),wy);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const c=Math.floor((n.expires_at*1e3-t)/wy);this._debug("#_autoRefreshTokenTick()",`access token expires in ${c} ticks, a tick lasts ${wy}ms, refresh threshold is ${$j} ticks`),c<=$j&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof fX)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!oc()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const c=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&c.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&c.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[h,p]=await dy(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(h)}`,code_challenge_method:`${encodeURIComponent(p)}`});c.push(s.toString())}if(n?.queryParams){const h=new URLSearchParams(n.queryParams);c.push(h.toString())}return n?.skipBrowserRedirect&&c.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${c.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:c,error:h}=r;return h?{data:null,error:h}:await oi(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=c?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,c;const{data:h,error:p}=r;if(p)return{data:null,error:p};const s=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:v,error:w}=await oi(this.fetch,"POST",`${this.url}/factors`,{body:s,headers:this.headers,jwt:(n=h?.session)===null||n===void 0?void 0:n.access_token});return w?{data:null,error:w}:(t.factorType==="totp"&&!((c=v?.totp)===null||c===void 0)&&c.qr_code&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:c,error:h}=r;if(h)return{data:null,error:h};const{data:p,error:s}=await oi(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(n=c?.session)===null||n===void 0?void 0:n.access_token});return s?{data:null,error:s}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+p.expires_in},p)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",p),{data:p,error:s})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:c,error:h}=r;return h?{data:null,error:h}:await oi(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(n=c?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=t?.factors||[],c=n.filter(p=>p.factor_type==="totp"&&p.status==="verified"),h=n.filter(p=>p.factor_type==="phone"&&p.status==="verified");return{data:{all:n,totp:c,phone:h},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var r,n;const{data:{session:c},error:h}=t;if(h)return{data:null,error:h};if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:p}=gM(c.access_token);let s=null;p.aal&&(s=p.aal);let v=s;((n=(r=c.user.factors)===null||r===void 0?void 0:r.filter(T=>T.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(v="aal2");const w=p.amr||[];return{data:{currentLevel:s,nextLevel:v,currentAuthenticationMethods:w},error:null}}))}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(s=>s.kid===t);if(n)return n;const c=Date.now();if(n=this.jwks.keys.find(s=>s.kid===t),n&&this.jwks_cached_at+w0e>c)return n;const{data:h,error:p}=await oi(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(p)throw p;return!h.keys||h.keys.length===0||(this.jwks=h,this.jwks_cached_at=c,n=h.keys.find(s=>s.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:O,error:D}=await this.getSession();if(D||!O.session)return{data:null,error:D};n=O.session.access_token}const{header:c,payload:h,signature:p,raw:{header:s,payload:v}}=gM(n);r?.allowExpired||W0e(h.exp);const w=!c.alg||c.alg.startsWith("HS")||!c.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(c.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!w){const{error:O}=await this.getUser(n);if(O)throw O;return{data:{claims:h,header:c,signature:p},error:null}}const T=q0e(c.alg),I=await crypto.subtle.importKey("jwk",w,T,!0,["verify"]);if(!await crypto.subtle.verify(T,I,p,O0e(`${s}.${v}`)))throw new Wj("Invalid JWT signature");return{data:{claims:h,header:c,signature:p},error:null}}catch(n){if(Fn(n))return{data:null,error:n};throw n}}}sw.nextInstanceID=0;const cxe=sw;class uxe extends cxe{constructor(t){super(t)}}var hxe=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function s(T){try{w(n.next(T))}catch(I){p(I)}}function v(T){try{w(n.throw(T))}catch(I){p(I)}}function w(T){T.done?h(T.value):c(T.value).then(s,v)}w((n=n.apply(e,[])).next())})};class dxe{constructor(t,r,n){var c,h,p;if(this.supabaseUrl=t,this.supabaseKey=r,!t)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const s=g0e(t),v=new URL(s);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const w=`sb-${v.hostname.split(".")[0]}-auth-token`,T={db:l0e,realtime:u0e,auth:Object.assign(Object.assign({},c0e),{storageKey:w}),global:a0e},I=y0e(n??{},T);this.storageKey=(c=I.auth.storageKey)!==null&&c!==void 0?c:"",this.headers=(h=I.global.headers)!==null&&h!==void 0?h:{},I.accessToken?(this.accessToken=I.accessToken,this.auth=new Proxy({},{get:(O,D)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(D)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((p=I.auth)!==null&&p!==void 0?p:{},this.headers,I.global.fetch),this.fetch=p0e(r,this._getAccessToken.bind(this),I.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},I.realtime)),this.rest=new Pve(new URL("rest/v1",v).href,{headers:this.headers,schema:I.db.schema,fetch:this.fetch}),this.storage=new i0e(this.storageUrl.href,this.headers,this.fetch,n?.storage),I.accessToken||this._listenForAuthEvents()}get functions(){return new ove(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,r;return hxe(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:c,storageKey:h,flowType:p,lock:s,debug:v},w,T){const I={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new uxe({url:this.authUrl.href,headers:Object.assign(Object.assign({},I),w),storageKey:h,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:c,flowType:p,lock:s,debug:v,fetch:T,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new Hve(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const fxe=(e,t,r)=>new dxe(e,t,r);function pxe(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}pxe()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const mxe="https://zfeqsdtddvelapbrwlol.supabase.co",gxe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmZXFzZHRkZHZlbGFwYnJ3bG9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3Njk1NzIsImV4cCI6MjA3MDM0NTU3Mn0.EhgHQSRum7-ZglFq1aAl7vPMM_c0i54gs5eD1fN03UU",gn=fxe(mxe,gxe,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),yxe=({preschool:e,onClose:t,onViewDetails:r,nationalAverage:n})=>{const[c,h]=Z.useState([]),[p,s]=Z.useState(null),[v,w]=Z.useState(null),[T,I]=Z.useState(!1),[O,D]=Z.useState(0),B=Z.useRef(new Map);Z.useEffect(()=>{N(),G()},[e.id]);const N=async()=>{try{const V=B.current.get(e.id);if(V){h(V);return}const{data:X,error:Y}=await gn.from("preschool_images").select("image_url").eq("preschool_id",e.id).eq("image_type","google_places").limit(2).order("created_at");if(!Y&&X&&X.length>0){const ne=X.map(ae=>ae.image_url);B.current.set(e.id,ne),h(ne);return}if(e.latitud&&e.longitud)try{const{data:ne,error:ae}=await gn.functions.invoke("google-places-enricher",{body:{preschoolId:e.id,lat:e.latitud,lng:e.longitud,address:e.adress,name:e.namn}});if(!ae&&ne?.success){const{data:le}=await gn.from("preschool_images").select("image_url").eq("preschool_id",e.id).eq("image_type","google_places").limit(2).order("created_at");if(le&&le.length>0){const ge=le.map(je=>je.image_url);B.current.set(e.id,ge),h(ge)}}}catch(ne){console.error("Google Places enricher error:",ne)}}catch(V){console.error("Error fetching images:",V)}},G=async()=>{if(!(!e.latitud||!e.longitud)){I(!0),w(null);try{const{data:V,error:X}=await gn.functions.invoke("street-view-generator",{body:{lat:e.latitud,lng:e.longitud,size:"400x200"}});if(X)throw X;if(V?.success&&V?.data?.static_url)s(V.data.static_url);else throw new Error("No street view available")}catch(V){console.error("Street view error:",V),w("Gatuvy ej tillgänglig"),O<2&&setTimeout(()=>{D(X=>X+1),G()},1e3)}finally{I(!1)}}},U=(V,X,Y=!0)=>{const ne=V-X,ae=ne/X*100;if(Math.abs(ae)<5)return null;const le=Y?ne>0:ne<0;return P.jsxs(an,{variant:le?"default":"secondary",className:"text-xs ml-1",children:[le?"↑":"↓"," ",Math.abs(ae).toFixed(0),"%"]})};return P.jsx(rve,{onClickOutside:t,children:P.jsx(Fr.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.2},className:"fixed left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md mx-4",children:P.jsxs(kn,{className:"bg-card/95 backdrop-blur-sm border-border/50 shadow-lg",children:[P.jsxs("div",{className:"p-4 border-b border-border",children:[P.jsxs("div",{className:"flex items-start justify-between",children:[P.jsxs("div",{className:"flex-1",children:[P.jsx("h3",{className:"font-semibold text-lg text-foreground",children:e.namn}),P.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[P.jsx(an,{variant:"outline",className:"text-xs",children:e.huvudman==="Enskild"?"Fristående":e.huvudman}),e.google_rating&&e.google_rating>=4.5&&P.jsx(an,{variant:"default",className:"text-xs",children:"Toppenbetyg"})]})]}),P.jsx(Hr,{onClick:t,variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:P.jsx(Qo,{className:"h-4 w-4"})})]}),e.google_rating&&P.jsx("div",{className:"mt-3",children:P.jsx(tve,{rating:e.google_rating,reviewCount:e.google_reviews_count||0,size:"sm"})})]}),P.jsxs("div",{className:"p-4 space-y-4",children:[p&&P.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-muted",children:[P.jsx("img",{src:p,alt:`Gatuvy för ${e.namn}`,className:"w-full h-24 object-cover cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>window.open(`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${e.latitud},${e.longitud}`,"_blank"),loading:"lazy"}),P.jsx("div",{className:"absolute top-2 right-2",children:P.jsxs(an,{variant:"secondary",className:"text-xs bg-black/50 text-white border-none",children:[P.jsx($L,{className:"w-3 h-3 mr-1"}),"Gatuvy"]})})]}),T&&P.jsx("div",{className:"h-24 bg-muted rounded-lg flex items-center justify-center",children:P.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[P.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-primary border-t-transparent rounded-full"}),"Laddar gatuvy..."]})}),v&&!p&&!T&&P.jsx("div",{className:"h-16 bg-muted rounded-lg flex items-center justify-center",children:P.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-xs",children:[P.jsx(Bce,{className:"w-3 h-3"}),v]})}),P.jsxs("div",{className:"flex items-start gap-3",children:[P.jsx(qa,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),P.jsxs("div",{className:"flex-1",children:[P.jsx("p",{className:"text-sm font-medium",children:e.adress}),P.jsx("p",{className:"text-xs text-muted-foreground",children:e.kommun})]})]}),c.length>0&&P.jsxs("div",{className:"mb-4",children:[P.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[P.jsx(Nce,{className:"w-4 h-4 text-muted-foreground"}),P.jsx("span",{className:"text-sm font-medium",children:"Bilder"})]}),P.jsx("div",{className:"grid grid-cols-2 gap-2",children:c.map((V,X)=>P.jsx("img",{src:V,alt:`${e.namn} bild ${X+1}`,className:"w-full h-20 object-cover rounded-md hover:scale-105 transition-transform duration-200 cursor-pointer",loading:"lazy",onClick:r},X))})]}),P.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(Rm,{className:"h-4 w-4 text-primary"}),P.jsxs("div",{className:"flex-1",children:[P.jsx("p",{className:"text-sm font-medium",children:e.antal_barn||"N/A"}),P.jsx("p",{className:"text-xs text-muted-foreground",children:"Barn"}),n&&e.antal_barn&&U(e.antal_barn,n.avgChildren)]})]}),P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(ba,{className:"h-4 w-4 text-primary"}),P.jsxs("div",{className:"flex-1",children:[P.jsx("p",{className:"text-sm font-medium",children:e.personaltäthet?e.personaltäthet.toFixed(1):"N/A"}),P.jsx("p",{className:"text-xs text-muted-foreground",children:"Personal"}),n&&e.personaltäthet&&U(e.personaltäthet,n.avgStaff,!1)]})]}),P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(BL,{className:"h-4 w-4 text-primary"}),P.jsxs("div",{className:"flex-1",children:[P.jsx("p",{className:"text-sm font-medium",children:e.andel_med_förskollärarexamen?`${e.andel_med_förskollärarexamen}%`:"N/A"}),P.jsx("p",{className:"text-xs text-muted-foreground",children:"Lärarexamen"}),n&&e.andel_med_förskollärarexamen&&U(e.andel_med_förskollärarexamen,n.avgTeacherExam)]})]}),P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(jm,{className:"h-4 w-4 text-primary"}),P.jsxs("div",{className:"flex-1",children:[P.jsx("p",{className:"text-sm font-medium",children:e.antal_barngrupper}),P.jsx("p",{className:"text-xs text-muted-foreground",children:"Grupper"})]})]})]}),P.jsxs("div",{className:"flex gap-2 pt-2",children:[P.jsx(Hr,{onClick:r,className:"flex-1",variant:"default",size:"sm",children:"Mer detaljer"}),P.jsx(Hr,{onClick:()=>window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${e.adress}, ${e.kommun}`)}`,"_blank"),variant:"outline",size:"sm",children:"Vägbeskrivning"})]})]})]})})})};class pX{static async request(t){try{console.log(`🌐 API Manager: ${t.type} request to ${t.endpoint}`);const{data:r,error:n}=await gn.functions.invoke(this.FUNCTION_URL,{body:t});return n?(console.error("API Manager function error:",n),{success:!1,error:n.message}):(r.cached&&console.log(`📦 Using cached response for ${t.type}:${t.endpoint}`),r)}catch(r){return console.error("API Manager client error:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}static async googlePlaces(t,r,n=3600){return this.request({type:"google_places",endpoint:t,params:r,cache_duration:n})}static async googleMaps(t,r,n=3600){return this.request({type:"google_maps",endpoint:t,params:r,cache_duration:n})}static async mapbox(t,r,n=1800){return this.request({type:"mapbox",endpoint:t,params:r,cache_duration:n})}static async streetView(t,r,n=7200){return this.request({type:"street_view",endpoint:t,params:r,cache_duration:n})}static async enrichPreschool(t,r,n,c,h,p=0){try{console.log(`🏫 Enriching preschool ${t}: ${h}`);const{data:s,error:v}=await gn.functions.invoke("google-places-enricher",{body:{preschoolId:t,lat:r,lng:n,address:c,name:h,priority:p}});return v?(console.error("Preschool enrichment error:",v),{success:!1,error:v.message}):(console.log(`✅ Successfully enriched preschool ${t}`),s)}catch(s){return console.error("Preschool enrichment client error:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}static async downloadImages(t,r,n="google_places"){try{console.log(`🖼️  Downloading ${r.length} images for preschool ${t}`);const{data:c,error:h}=await gn.functions.invoke("image-downloader",{body:{preschool_id:t,images:r,image_type:n}});return h?(console.error("Image download error:",h),{success:!1,error:h.message}):(console.log(`✅ Successfully downloaded ${c.success_count}/${c.processed_count} images for preschool ${t}`),c)}catch(c){return console.error("Image download client error:",c),{success:!1,error:c instanceof Error?c.message:"Unknown error"}}}static async clearExpiredCache(){try{const{error:t}=await gn.from("api_cache").delete().lt("expires_at",new Date().toISOString());return t?(console.error("Cache cleanup error:",t),{success:!1,error:t.message}):(console.log("✅ Cleared expired cache entries"),{success:!0})}catch(t){return console.error("Cache cleanup client error:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}static async getCacheStats(){try{const{data:t,error:r}=await gn.from("api_cache").select("api_type, count(*)").gte("expires_at",new Date().toISOString());return r?(console.error("Cache stats error:",r),{success:!1,error:r.message}):{success:!0,data:t.reduce((n,c)=>(n[c.api_type]=c.count,n),{})}}catch(t){return console.error("Cache stats client error:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}}ob(pX,"FUNCTION_URL","api-manager");class _xe{constructor(){ob(this,"cache",new Map),ob(this,"CACHE_DURATION",5*60*1e3),ob(this,"STORAGE_KEY","preschool_cluster_cache"),this.loadFromStorage()}getCacheKey(t){return`zoom_${Math.round(t*2)/2}`}saveClusterState(t,r){const n=this.getCacheKey(t),c={zoom:t,clusters:r,timestamp:Date.now()};this.cache.set(n,c),this.saveToStorage(),console.log(`💾 Saved cluster cache for zoom ${t} with ${r.length} clusters`)}getClusterState(t){const r=this.getCacheKey(t),n=this.cache.get(r);return n?Date.now()-n.timestamp>this.CACHE_DURATION?(this.cache.delete(r),null):(console.log(`📦 Using cached clusters for zoom ${t}: ${n.clusters.length} clusters`),n):null}generateSwedishClusterApproximation(){return[{center:[18.0686,59.3293],count:850,bounds:{north:59.5,south:59.1,east:18.3,west:17.8},averageRating:4.2,totalChildren:12500,timestamp:Date.now()},{center:[11.9746,57.7089],count:420,bounds:{north:57.9,south:57.5,east:12.2,west:11.7},averageRating:4.1,totalChildren:6800,timestamp:Date.now()},{center:[13.0034,55.605],count:280,bounds:{north:55.8,south:55.4,east:13.3,west:12.7},averageRating:4,totalChildren:4200,timestamp:Date.now()},{center:[17.6389,59.8585],count:180,bounds:{north:60,south:59.7,east:17.9,west:17.4},averageRating:4.3,totalChildren:2800,timestamp:Date.now()},{center:[15.6214,58.4108],count:140,bounds:{north:58.6,south:58.2,east:15.9,west:15.3},averageRating:4.2,totalChildren:2100,timestamp:Date.now()},{center:[15.2066,59.2741],count:120,bounds:{north:59.4,south:59.1,east:15.5,west:14.9},averageRating:4.1,totalChildren:1900,timestamp:Date.now()},{center:[20.263,63.8258],count:85,bounds:{north:64,south:63.6,east:20.5,west:20},averageRating:4,totalChildren:1400,timestamp:Date.now()},{center:[16.5,60.6],count:95,bounds:{north:60.8,south:60.4,east:16.8,west:16.2},averageRating:4.1,totalChildren:1500,timestamp:Date.now()},{center:[14.8,56.9],count:165,bounds:{north:57.2,south:56.6,east:15.2,west:14.4},averageRating:4,totalChildren:2600,timestamp:Date.now()},{center:[13.5,59.4],count:110,bounds:{north:59.7,south:59.1,east:13.8,west:13.2},averageRating:4.1,totalChildren:1800,timestamp:Date.now()},{center:[17.3,62.4],count:75,bounds:{north:62.6,south:62.2,east:17.6,west:17},averageRating:4,totalChildren:1200,timestamp:Date.now()},{center:[22.15,65.58],count:65,bounds:{north:65.8,south:65.3,east:22.5,west:21.8},averageRating:4.2,totalChildren:1e3,timestamp:Date.now()}]}saveToStorage(){try{const t=Array.from(this.cache.entries());localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(t){console.warn("Failed to save cluster cache to storage:",t)}}loadFromStorage(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(t){const r=JSON.parse(t);this.cache=new Map(r),console.log(`📂 Loaded cluster cache with ${this.cache.size} entries`)}}catch(t){console.warn("Failed to load cluster cache from storage:",t)}}clearCache(){this.cache.clear(),localStorage.removeItem(this.STORAGE_KEY),console.log("🗑️ Cleared all cluster cache")}getCacheStats(){let t=0,r=Date.now();return this.cache.forEach(n=>{t+=n.clusters.length,n.timestamp<r&&(r=n.timestamp)}),{entries:this.cache.size,totalClusters:t,oldestEntry:r}}}const Fx=new _xe;function U3(e,t){const[r,n]=Z.useState(e);return Z.useEffect(()=>{const c=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(c)}},[e,t]),r}const vxe=e=>{const{updateVisiblePreschoolsFromViewport:t}=_s(),r=Z.useRef(0),n=Z.useRef(),c=Z.useCallback(()=>{if(!e)return;const p=Date.now();if(p-r.current<100)return;const s=e.getBounds();t({north:s.getNorth(),south:s.getSouth(),east:s.getEast(),west:s.getWest()}),r.current=p},[e,t]),h=U3(c,150);return Z.useEffect(()=>{if(!e)return;const p=()=>{n.current&&clearTimeout(n.current),c()},s=()=>{h()},v=()=>{c()};return e.on("moveend",p),e.on("move",s),e.on("zoomend",v),c(),()=>{e.off("moveend",p),e.off("move",s),e.off("zoomend",v),n.current&&clearTimeout(n.current)}},[e,c,h]),{updateViewport:c}},xxe="pk.eyJ1Ijoic2tvZ3N0YWRpc2FrIiwiYSI6ImNtY3BhaXRpMjA0ZGcycHBqNHM4dmlwOW0ifQ.KKHGGPnrZVjNjDdITF-_bw";E2.accessToken=xxe;const bxe=({className:e})=>{const t=Z.useRef(null),r=Z.useRef(null),[n,c]=Z.useState(!0),[h,p]=Z.useState(!1),[s,v]=Z.useState(null),{filteredPreschools:w,selectedPreschool:T,setSelectedPreschool:I,mapCenter:O,mapZoom:D,setMapCenter:B,setMapZoom:N,preschools:G,lastUpdated:U,updateVisiblePreschoolsFromViewport:V}=_s();vxe(r.current),Z.useEffect(()=>{console.log("🎯 Preloading Swedish cluster data for instant display...");const ae=Fx.generateSwedishClusterApproximation();console.log(`📦 Preloaded ${ae.length} cluster approximations for Sweden`)},[]),Z.useEffect(()=>{if(!t.current)return;r.current=new E2.Map({container:t.current,style:"mapbox://styles/mapbox/streets-v12",center:[15.2,62.4],zoom:4.9,minZoom:2,maxZoom:18,pitch:0,bearing:0,maxBounds:[[7,55],[25,70]]}),r.current.on("style.load",()=>{if(!r.current)return;console.log("🗺️ Mapbox style loaded, map is ready"),c(!1);const ge=r.current.getZoom();let je=Fx.getClusterState(ge);if(je)console.log("⚡ Using cached clusters for instant display"),X(je.clusters);else{console.log("🏃‍♂️ No cache found, using Swedish cluster approximation for instant display");const ze=Fx.generateSwedishClusterApproximation();X(ze)}setTimeout(()=>{if(r.current){const ze=r.current.getBounds();V({north:ze.getNorth(),south:ze.getSouth(),east:ze.getEast(),west:ze.getWest()}),console.log("🎯 Initial viewport preschools updated")}},1e3)}),r.current.addControl(new E2.NavigationControl,"top-right");const ae=new E2.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});r.current.addControl(ae,"top-right"),ae.on("geolocate",ge=>{const{longitude:je,latitude:ze}=ge.coords;console.log(`User location detected: [${je}, ${ze}]`),B([je,ze]),N(13)});let le;return r.current.on("moveend",()=>{clearTimeout(le),le=setTimeout(()=>{if(!r.current)return;const ge=r.current.getCenter(),je=r.current.getZoom();B([ge.lng,ge.lat]),N(je);const ze=r.current.getBounds();V({north:ze.getNorth(),south:ze.getSouth(),east:ze.getEast(),west:ze.getWest()}),setTimeout(()=>{if(r.current&&r.current.getLayer("preschools-clusters")){const Pe=r.current.queryRenderedFeatures({layers:["preschools-clusters"]});if(Pe.length>0){const Ke=Pe.map(Ye=>({center:Ye.geometry.coordinates,count:Ye.properties.point_count,bounds:{north:Ye.geometry.coordinates[1]+.5,south:Ye.geometry.coordinates[1]-.5,east:Ye.geometry.coordinates[0]+.5,west:Ye.geometry.coordinates[0]-.5},averageRating:Ye.properties.avg_rating||4,totalChildren:Ye.properties.total_children||0,timestamp:Date.now()}));Fx.saveClusterState(je,Ke),console.log(`💾 Cached ${Ke.length} clusters for zoom ${je.toFixed(1)}`)}}},500),console.log("🗺️ Map moved - updated visible preschools for viewport")},300)}),()=>{r.current?.remove()}},[]);const X=Z.useCallback(ae=>{if(!r.current||!r.current.isStyleLoaded())return;r.current.getLayer("cached-clusters")&&r.current.removeLayer("cached-clusters"),r.current.getLayer("cached-cluster-count")&&r.current.removeLayer("cached-cluster-count"),r.current.getSource("cached-clusters")&&r.current.removeSource("cached-clusters");const le={type:"FeatureCollection",features:ae.map((ge,je)=>({type:"Feature",id:je,properties:{cluster_id:je,point_count:ge.count,point_count_abbreviated:ge.count>1e3?`${(ge.count/1e3).toFixed(1)}k`:ge.count.toString()},geometry:{type:"Point",coordinates:ge.center}}))};r.current.addSource("cached-clusters",{type:"geojson",data:le}),r.current.addLayer({id:"cached-clusters",type:"circle",source:"cached-clusters",paint:{"circle-color":["interpolate",["linear"],["get","point_count"],1,"#34d399",25,"#10b981",100,"#f59e0b",500,"#f97316",1e3,"#dc2626"],"circle-radius":["interpolate",["exponential",1.2],["get","point_count"],1,20,25,28,100,36,500,44,1e3,52],"circle-stroke-width":3,"circle-stroke-color":"#ffffff","circle-opacity":.8}}),r.current.addLayer({id:"cached-cluster-count",type:"symbol",source:"cached-clusters",layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":16},paint:{"text-color":"#ffffff"}}),console.log(`⚡ Added ${ae.length} cached clusters for immediate display`)},[]),Y=Z.useMemo(()=>{const ae=w.filter(le=>le.latitud!==null&&le.longitud!==null&&typeof le.latitud=="number"&&typeof le.longitud=="number"&&le.latitud>=55&&le.latitud<=69.1&&le.longitud>=10.9&&le.longitud<=24.2);return console.log(`📍 Valid preschools for map: ${ae.length}/${w.length}`),ae.length>0&&console.log(`✅ First preschool: ${ae[0].namn} at [${ae[0].longitud}, ${ae[0].latitud}]`),ae},[w]),ne=Z.useMemo(()=>{const ae={type:"FeatureCollection",features:Y.map(le=>({type:"Feature",properties:{id:le.id,namn:le.namn,kommun:le.kommun,huvudman:le.huvudman,google_rating:le.google_rating||0},geometry:{type:"Point",coordinates:[le.longitud,le.latitud]}}))};return console.log(`🌍 Generated GeoJSON with ${ae.features.length} features`),ae},[Y]);return Z.useEffect(()=>{if(console.log(`🔄 Map useEffect triggered - valid preschools: ${Y.length}`),!r.current){console.log("❌ No map instance available");return}if(!r.current.isStyleLoaded()){console.log("⏳ Waiting for map style to load...");const ge=()=>{r.current?.isStyleLoaded()?(console.log("✅ Style loaded, adding preschools"),ae()):setTimeout(ge,100)};ge();return}ae();function ae(){if(r.current){if(["cached-clusters","cached-cluster-count"].forEach(ge=>{r.current?.getLayer(ge)&&(r.current.removeLayer(ge),console.log(`🗑️ Removed cached layer: ${ge}`))}),r.current?.getSource("cached-clusters")&&(r.current.removeSource("cached-clusters"),console.log("🗑️ Removed cached clusters source")),["preschools-clusters","preschools-cluster-count","preschools-unclustered"].forEach(ge=>{r.current?.getLayer(ge)&&r.current.removeLayer(ge)}),r.current?.getSource("preschools")&&r.current.removeSource("preschools"),Y.length===0){console.log("No valid preschools to display on map");return}console.log(`🗺️ Replacing cached clusters with ${Y.length} real preschools`),r.current.addSource("preschools",{type:"geojson",data:ne,cluster:!0,clusterMaxZoom:13,clusterRadius:45,clusterProperties:{avg_rating:["/",["+",["get","google_rating"]],["get","point_count"]],total_children:["+",["get","antal_barn"]],preschool_count:["get","point_count"]}}),r.current.addLayer({id:"preschools-clusters",type:"circle",source:"preschools",filter:["has","point_count"],paint:{"circle-color":["interpolate",["linear"],["get","point_count"],1,"#34d399",25,"#10b981",100,"#f59e0b",500,"#f97316",1e3,"#dc2626"],"circle-radius":["interpolate",["exponential",1.2],["get","point_count"],1,20,25,28,100,36,500,44,1e3,52],"circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.85}}),r.current.addLayer({id:"preschools-cluster-count",type:"symbol",source:"preschools",filter:["has","point_count"],layout:{"text-field":"{point_count}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),r.current.addLayer({id:"preschools-unclustered",type:"circle",source:"preschools",filter:["!",["has","point_count"]],paint:{"circle-color":["case",[">",["get","google_rating"],4],"#10b981",[">",["get","google_rating"],3],"#f59e0b",["==",["get","google_rating"],0],"#6b7280","#ef4444"],"circle-radius":["interpolate",["exponential",1.5],["zoom"],10,6,15,10],"circle-stroke-width":["interpolate",["linear"],["zoom"],10,1,15,2],"circle-stroke-color":"#ffffff","circle-opacity":.9}}),r.current.on("click","preschools-unclustered",async ge=>{if(ge.features&&ge.features[0]){const je=ge.features[0].properties?.id,ze=w.find(Pe=>Pe.id===je);ze&&(v(ze),p(!0),ze.latitud&&ze.longitud&&!ze.google_rating&&(console.log(`🔄 Auto-enriching preschool: ${ze.namn}`),pX.enrichPreschool(ze.id,ze.latitud,ze.longitud,ze.adress||"",ze.namn,1)))}}),r.current.on("click","preschools-clusters",ge=>{const je=r.current.queryRenderedFeatures(ge.point,{layers:["preschools-clusters"]}),ze=je[0].properties.cluster_id;r.current.getSource("preschools").getClusterExpansionZoom(ze,(Pe,Ke)=>{Pe||r.current.easeTo({center:je[0].geometry.coordinates,zoom:Ke})})}),setTimeout(()=>{le()},1e3)}}function le(){if(!r.current)return;const ge=r.current.getZoom(),je=r.current.queryRenderedFeatures({layers:["preschools-clusters"]});if(je.length>0){const ze=je.map(Pe=>({center:Pe.geometry.coordinates,count:Pe.properties.point_count,bounds:{north:Pe.geometry.coordinates[1]+.5,south:Pe.geometry.coordinates[1]-.5,east:Pe.geometry.coordinates[0]+.5,west:Pe.geometry.coordinates[0]-.5},averageRating:Pe.properties.avg_rating||4,totalChildren:Pe.properties.total_children||0,timestamp:Date.now()}));Fx.saveClusterState(ge,ze),console.log(`💾 Saved ${ze.length} real clusters to cache for zoom ${ge.toFixed(1)}`)}}},[w,ne,U]),Z.useEffect(()=>{if(!r.current)return;const ae=r.current.getCenter(),le=r.current.getZoom(),ge=Array.isArray(O)?O:[O.lng||O.lon,O.lat],[je,ze]=ge,Pe=Math.abs(ae.lng-je)+Math.abs(ae.lat-ze),Ke=Math.abs(le-D);(Pe>.01||Ke>.5)&&(console.log(`Flying to: [${je}, ${ze}] zoom: ${D}`),r.current.flyTo({center:[je,ze],zoom:D,duration:1e3}))},[O,D]),Z.useEffect(()=>{T&&r.current&&T.latitud&&T.longitud&&r.current.flyTo({center:[T.longitud,T.latitud],zoom:14,duration:1e3})},[T]),P.jsxs("div",{className:`relative ${e}`,children:[P.jsx(Tc,{children:h&&s&&P.jsx(yxe,{preschool:s,onClose:()=>{p(!1),v(null)},onViewDetails:()=>{I(s),p(!1),v(null)}})}),P.jsx("div",{ref:t,className:"w-full h-full rounded-lg overflow-hidden"}),n&&P.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-gradient-to-br from-primary/20 to-secondary/20 backdrop-blur-sm flex items-center justify-center rounded-lg",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-primary border-t-transparent rounded-full mx-auto mb-4"}),P.jsx("p",{className:"text-foreground font-medium",children:"Laddar karta över Sverige..."})]})})]})};class vM extends Ne.Component{constructor(t){super(t),ob(this,"retry",()=>{this.setState({hasError:!1,error:void 0})}),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error("ErrorBoundary caught an error:",t,r)}render(){if(this.state.hasError){if(this.props.fallback){const t=this.props.fallback;return P.jsx(t,{error:this.state.error,retry:this.retry})}return P.jsxs(kn,{className:"p-6 m-4 border-destructive/50",children:[P.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[P.jsx(rue,{className:"h-6 w-6 text-destructive"}),P.jsx("h3",{className:"text-lg font-semibold text-destructive",children:"Något gick fel"})]}),P.jsx("p",{className:"text-muted-foreground mb-4",children:"Ett oväntat fel uppstod. Försök ladda om sidan eller kontakta support om problemet kvarstår."}),this.state.error&&P.jsxs("details",{className:"mb-4",children:[P.jsx("summary",{className:"text-sm text-muted-foreground cursor-pointer hover:text-foreground",children:"Teknisk information"}),P.jsx("pre",{className:"mt-2 text-xs bg-muted p-2 rounded overflow-auto",children:this.state.error.message})]}),P.jsxs(Hr,{onClick:this.retry,variant:"outline",className:"w-full",children:[P.jsx(Hd,{className:"h-4 w-4 mr-2"}),"Försök igen"]})]})}return this.props.children}}function Bx({className:e,...t}){return P.jsx("div",{className:ln("animate-pulse rounded-md bg-muted",e),...t})}const wxe=({className:e})=>P.jsx(kn,{className:`p-4 ${e}`,children:P.jsxs("div",{className:"space-y-3",children:[P.jsx(Bx,{className:"h-4 w-3/4"}),P.jsx(Bx,{className:"h-4 w-1/2"}),P.jsxs("div",{className:"space-y-2",children:[P.jsx(Bx,{className:"h-3 w-full"}),P.jsx(Bx,{className:"h-3 w-5/6"}),P.jsx(Bx,{className:"h-3 w-4/6"})]})]})}),zU=({children:e,fallback:t,className:r})=>P.jsx(Z.Suspense,{fallback:t||P.jsx(wxe,{className:r}),children:e}),Sxe=({children:e})=>{const[t,r]=Z.useState(navigator.onLine),[n,c]=Z.useState(!1);Z.useEffect(()=>{const p=()=>{r(!0),c(!1),XO({title:"Anslutning återställd",description:"Du är nu online igen",duration:3e3})},s=()=>{r(!1),c(!0),XO({title:"Ingen internetanslutning",description:"Kontrollera din anslutning för att få de senaste uppdateringarna",variant:"destructive",duration:5e3})};return window.addEventListener("online",p),window.addEventListener("offline",s),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",s)}},[]);const h=()=>{window.location.reload()};return P.jsxs(P.Fragment,{children:[n&&P.jsx(kn,{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-destructive/90 text-destructive-foreground border-destructive",children:P.jsxs("div",{className:"p-3 flex items-center gap-3",children:[P.jsx(nue,{className:"h-5 w-5"}),P.jsxs("div",{className:"flex-1",children:[P.jsx("p",{className:"text-sm font-medium",children:"Ingen internetanslutning"}),P.jsx("p",{className:"text-xs opacity-90",children:"Vissa funktioner kanske inte fungerar"})]}),P.jsxs(Hr,{size:"sm",variant:"secondary",onClick:h,className:"h-8",children:[P.jsx(Hd,{className:"h-4 w-4 mr-1"}),"Försök igen"]})]})}),e,P.jsx("div",{className:"fixed bottom-4 left-4 z-40"})]})},mX=Z.memo(({children:e})=>P.jsx(P.Fragment,{children:e}));mX.displayName="PerformanceOptimizer";var Txe=Z.createContext(void 0);function pk(e){const t=Z.useContext(Txe);return e||t||"ltr"}function qj(e,[t,r]){return Math.min(r,Math.max(t,e))}function Exe(e,t){return Z.useReducer((r,n)=>t[r][n]??r,e)}var $3="ScrollArea",[gX,a7e]=wc($3),[Axe,Bl]=gX($3),yX=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:c,scrollHideDelay:h=600,...p}=e,[s,v]=Z.useState(null),[w,T]=Z.useState(null),[I,O]=Z.useState(null),[D,B]=Z.useState(null),[N,G]=Z.useState(null),[U,V]=Z.useState(0),[X,Y]=Z.useState(0),[ne,ae]=Z.useState(!1),[le,ge]=Z.useState(!1),je=yi(t,Pe=>v(Pe)),ze=pk(c);return P.jsx(Axe,{scope:r,type:n,dir:ze,scrollHideDelay:h,scrollArea:s,viewport:w,onViewportChange:T,content:I,onContentChange:O,scrollbarX:D,onScrollbarXChange:B,scrollbarXEnabled:ne,onScrollbarXEnabledChange:ae,scrollbarY:N,onScrollbarYChange:G,scrollbarYEnabled:le,onScrollbarYEnabledChange:ge,onCornerWidthChange:V,onCornerHeightChange:Y,children:P.jsx(fn.div,{dir:ze,...p,ref:je,style:{position:"relative","--radix-scroll-area-corner-width":U+"px","--radix-scroll-area-corner-height":X+"px",...e.style}})})});yX.displayName=$3;var _X="ScrollAreaViewport",vX=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:c,...h}=e,p=Bl(_X,r),s=Z.useRef(null),v=yi(t,s,p.onViewportChange);return P.jsxs(P.Fragment,{children:[P.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:c}),P.jsx(fn.div,{"data-radix-scroll-area-viewport":"",...h,ref:v,style:{overflowX:p.scrollbarXEnabled?"scroll":"hidden",overflowY:p.scrollbarYEnabled?"scroll":"hidden",...e.style},children:P.jsx("div",{ref:p.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});vX.displayName=_X;var Iu="ScrollAreaScrollbar",G3=Z.forwardRef((e,t)=>{const{forceMount:r,...n}=e,c=Bl(Iu,e.__scopeScrollArea),{onScrollbarXEnabledChange:h,onScrollbarYEnabledChange:p}=c,s=e.orientation==="horizontal";return Z.useEffect(()=>(s?h(!0):p(!0),()=>{s?h(!1):p(!1)}),[s,h,p]),c.type==="hover"?P.jsx(kxe,{...n,ref:t,forceMount:r}):c.type==="scroll"?P.jsx(Pxe,{...n,ref:t,forceMount:r}):c.type==="auto"?P.jsx(xX,{...n,ref:t,forceMount:r}):c.type==="always"?P.jsx(H3,{...n,ref:t}):null});G3.displayName=Iu;var kxe=Z.forwardRef((e,t)=>{const{forceMount:r,...n}=e,c=Bl(Iu,e.__scopeScrollArea),[h,p]=Z.useState(!1);return Z.useEffect(()=>{const s=c.scrollArea;let v=0;if(s){const w=()=>{window.clearTimeout(v),p(!0)},T=()=>{v=window.setTimeout(()=>p(!1),c.scrollHideDelay)};return s.addEventListener("pointerenter",w),s.addEventListener("pointerleave",T),()=>{window.clearTimeout(v),s.removeEventListener("pointerenter",w),s.removeEventListener("pointerleave",T)}}},[c.scrollArea,c.scrollHideDelay]),P.jsx(Sc,{present:r||h,children:P.jsx(xX,{"data-state":h?"visible":"hidden",...n,ref:t})})}),Pxe=Z.forwardRef((e,t)=>{const{forceMount:r,...n}=e,c=Bl(Iu,e.__scopeScrollArea),h=e.orientation==="horizontal",p=gk(()=>v("SCROLL_END"),100),[s,v]=Exe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return Z.useEffect(()=>{if(s==="idle"){const w=window.setTimeout(()=>v("HIDE"),c.scrollHideDelay);return()=>window.clearTimeout(w)}},[s,c.scrollHideDelay,v]),Z.useEffect(()=>{const w=c.viewport,T=h?"scrollLeft":"scrollTop";if(w){let I=w[T];const O=()=>{const D=w[T];I!==D&&(v("SCROLL"),p()),I=D};return w.addEventListener("scroll",O),()=>w.removeEventListener("scroll",O)}},[c.viewport,h,v,p]),P.jsx(Sc,{present:r||s!=="hidden",children:P.jsx(H3,{"data-state":s==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:Zr(e.onPointerEnter,()=>v("POINTER_ENTER")),onPointerLeave:Zr(e.onPointerLeave,()=>v("POINTER_LEAVE"))})})}),xX=Z.forwardRef((e,t)=>{const r=Bl(Iu,e.__scopeScrollArea),{forceMount:n,...c}=e,[h,p]=Z.useState(!1),s=e.orientation==="horizontal",v=gk(()=>{if(r.viewport){const w=r.viewport.offsetWidth<r.viewport.scrollWidth,T=r.viewport.offsetHeight<r.viewport.scrollHeight;p(s?w:T)}},10);return b_(r.viewport,v),b_(r.content,v),P.jsx(Sc,{present:n||h,children:P.jsx(H3,{"data-state":h?"visible":"hidden",...c,ref:t})})}),H3=Z.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,c=Bl(Iu,e.__scopeScrollArea),h=Z.useRef(null),p=Z.useRef(0),[s,v]=Z.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),w=EX(s.viewport,s.content),T={...n,sizes:s,onSizesChange:v,hasThumb:w>0&&w<1,onThumbChange:O=>h.current=O,onThumbPointerUp:()=>p.current=0,onThumbPointerDown:O=>p.current=O};function I(O,D){return Rxe(O,p.current,s,D)}return r==="horizontal"?P.jsx(Cxe,{...T,ref:t,onThumbPositionChange:()=>{if(c.viewport&&h.current){const O=c.viewport.scrollLeft,D=NU(O,s,c.dir);h.current.style.transform=`translate3d(${D}px, 0, 0)`}},onWheelScroll:O=>{c.viewport&&(c.viewport.scrollLeft=O)},onDragScroll:O=>{c.viewport&&(c.viewport.scrollLeft=I(O,c.dir))}}):r==="vertical"?P.jsx(Ixe,{...T,ref:t,onThumbPositionChange:()=>{if(c.viewport&&h.current){const O=c.viewport.scrollTop,D=NU(O,s);h.current.style.transform=`translate3d(0, ${D}px, 0)`}},onWheelScroll:O=>{c.viewport&&(c.viewport.scrollTop=O)},onDragScroll:O=>{c.viewport&&(c.viewport.scrollTop=I(O))}}):null}),Cxe=Z.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...c}=e,h=Bl(Iu,e.__scopeScrollArea),[p,s]=Z.useState(),v=Z.useRef(null),w=yi(t,v,h.onScrollbarXChange);return Z.useEffect(()=>{v.current&&s(getComputedStyle(v.current))},[v]),P.jsx(wX,{"data-orientation":"horizontal",...c,ref:w,sizes:r,style:{bottom:0,left:h.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:h.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":mk(r)+"px",...e.style},onThumbPointerDown:T=>e.onThumbPointerDown(T.x),onDragScroll:T=>e.onDragScroll(T.x),onWheelScroll:(T,I)=>{if(h.viewport){const O=h.viewport.scrollLeft+T.deltaX;e.onWheelScroll(O),kX(O,I)&&T.preventDefault()}},onResize:()=>{v.current&&h.viewport&&p&&n({content:h.viewport.scrollWidth,viewport:h.viewport.offsetWidth,scrollbar:{size:v.current.clientWidth,paddingStart:xE(p.paddingLeft),paddingEnd:xE(p.paddingRight)}})}})}),Ixe=Z.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...c}=e,h=Bl(Iu,e.__scopeScrollArea),[p,s]=Z.useState(),v=Z.useRef(null),w=yi(t,v,h.onScrollbarYChange);return Z.useEffect(()=>{v.current&&s(getComputedStyle(v.current))},[v]),P.jsx(wX,{"data-orientation":"vertical",...c,ref:w,sizes:r,style:{top:0,right:h.dir==="ltr"?0:void 0,left:h.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":mk(r)+"px",...e.style},onThumbPointerDown:T=>e.onThumbPointerDown(T.y),onDragScroll:T=>e.onDragScroll(T.y),onWheelScroll:(T,I)=>{if(h.viewport){const O=h.viewport.scrollTop+T.deltaY;e.onWheelScroll(O),kX(O,I)&&T.preventDefault()}},onResize:()=>{v.current&&h.viewport&&p&&n({content:h.viewport.scrollHeight,viewport:h.viewport.offsetHeight,scrollbar:{size:v.current.clientHeight,paddingStart:xE(p.paddingTop),paddingEnd:xE(p.paddingBottom)}})}})}),[Mxe,bX]=gX(Iu),wX=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:c,onThumbChange:h,onThumbPointerUp:p,onThumbPointerDown:s,onThumbPositionChange:v,onDragScroll:w,onWheelScroll:T,onResize:I,...O}=e,D=Bl(Iu,r),[B,N]=Z.useState(null),G=yi(t,je=>N(je)),U=Z.useRef(null),V=Z.useRef(""),X=D.viewport,Y=n.content-n.viewport,ne=ro(T),ae=ro(v),le=gk(I,10);function ge(je){if(U.current){const ze=je.clientX-U.current.left,Pe=je.clientY-U.current.top;w({x:ze,y:Pe})}}return Z.useEffect(()=>{const je=ze=>{const Pe=ze.target;B?.contains(Pe)&&ne(ze,Y)};return document.addEventListener("wheel",je,{passive:!1}),()=>document.removeEventListener("wheel",je,{passive:!1})},[X,B,Y,ne]),Z.useEffect(ae,[n,ae]),b_(B,le),b_(D.content,le),P.jsx(Mxe,{scope:r,scrollbar:B,hasThumb:c,onThumbChange:ro(h),onThumbPointerUp:ro(p),onThumbPositionChange:ae,onThumbPointerDown:ro(s),children:P.jsx(fn.div,{...O,ref:G,style:{position:"absolute",...O.style},onPointerDown:Zr(e.onPointerDown,je=>{je.button===0&&(je.target.setPointerCapture(je.pointerId),U.current=B.getBoundingClientRect(),V.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",D.viewport&&(D.viewport.style.scrollBehavior="auto"),ge(je))}),onPointerMove:Zr(e.onPointerMove,ge),onPointerUp:Zr(e.onPointerUp,je=>{const ze=je.target;ze.hasPointerCapture(je.pointerId)&&ze.releasePointerCapture(je.pointerId),document.body.style.webkitUserSelect=V.current,D.viewport&&(D.viewport.style.scrollBehavior=""),U.current=null})})})}),vE="ScrollAreaThumb",SX=Z.forwardRef((e,t)=>{const{forceMount:r,...n}=e,c=bX(vE,e.__scopeScrollArea);return P.jsx(Sc,{present:r||c.hasThumb,children:P.jsx(Oxe,{ref:t,...n})})}),Oxe=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...c}=e,h=Bl(vE,r),p=bX(vE,r),{onThumbPositionChange:s}=p,v=yi(t,I=>p.onThumbChange(I)),w=Z.useRef(void 0),T=gk(()=>{w.current&&(w.current(),w.current=void 0)},100);return Z.useEffect(()=>{const I=h.viewport;if(I){const O=()=>{if(T(),!w.current){const D=Dxe(I,s);w.current=D,s()}};return s(),I.addEventListener("scroll",O),()=>I.removeEventListener("scroll",O)}},[h.viewport,T,s]),P.jsx(fn.div,{"data-state":p.hasThumb?"visible":"hidden",...c,ref:v,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:Zr(e.onPointerDownCapture,I=>{const O=I.target.getBoundingClientRect(),D=I.clientX-O.left,B=I.clientY-O.top;p.onThumbPointerDown({x:D,y:B})}),onPointerUp:Zr(e.onPointerUp,p.onThumbPointerUp)})});SX.displayName=vE;var W3="ScrollAreaCorner",TX=Z.forwardRef((e,t)=>{const r=Bl(W3,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?P.jsx(jxe,{...e,ref:t}):null});TX.displayName=W3;var jxe=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,c=Bl(W3,r),[h,p]=Z.useState(0),[s,v]=Z.useState(0),w=!!(h&&s);return b_(c.scrollbarX,()=>{const T=c.scrollbarX?.offsetHeight||0;c.onCornerHeightChange(T),v(T)}),b_(c.scrollbarY,()=>{const T=c.scrollbarY?.offsetWidth||0;c.onCornerWidthChange(T),p(T)}),w?P.jsx(fn.div,{...n,ref:t,style:{width:h,height:s,position:"absolute",right:c.dir==="ltr"?0:void 0,left:c.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function xE(e){return e?parseInt(e,10):0}function EX(e,t){const r=e/t;return isNaN(r)?0:r}function mk(e){const t=EX(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function Rxe(e,t,r,n="ltr"){const c=mk(r),h=c/2,p=t||h,s=c-p,v=r.scrollbar.paddingStart+p,w=r.scrollbar.size-r.scrollbar.paddingEnd-s,T=r.content-r.viewport,I=n==="ltr"?[0,T]:[T*-1,0];return AX([v,w],I)(e)}function NU(e,t,r="ltr"){const n=mk(t),c=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,h=t.scrollbar.size-c,p=t.content-t.viewport,s=h-n,v=r==="ltr"?[0,p]:[p*-1,0],w=qj(e,v);return AX([0,p],[0,s])(w)}function AX(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function kX(e,t){return e>0&&e<t}var Dxe=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function c(){const h={left:e.scrollLeft,top:e.scrollTop},p=r.left!==h.left,s=r.top!==h.top;(p||s)&&t(),r=h,n=window.requestAnimationFrame(c)}(),()=>window.cancelAnimationFrame(n)};function gk(e,t){const r=ro(e),n=Z.useRef(0);return Z.useEffect(()=>()=>window.clearTimeout(n.current),[]),Z.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function b_(e,t){const r=ro(t);xo(()=>{let n=0;if(e){const c=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return c.observe(e),()=>{window.cancelAnimationFrame(n),c.unobserve(e)}}},[e,r])}var PX=yX,Lxe=vX,zxe=TX;const Zj=Z.forwardRef(({className:e,children:t,...r},n)=>P.jsxs(PX,{ref:n,className:ln("relative overflow-hidden",e),...r,children:[P.jsx(Lxe,{className:"h-full w-full rounded-[inherit]",children:t}),P.jsx(CX,{}),P.jsx(zxe,{})]}));Zj.displayName=PX.displayName;const CX=Z.forwardRef(({className:e,orientation:t="vertical",...r},n)=>P.jsx(G3,{ref:n,orientation:t,className:ln("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:P.jsx(SX,{className:"relative flex-1 rounded-full bg-border"})}));CX.displayName=G3.displayName;var xM="rovingFocusGroup.onEntryFocus",Nxe={bubbles:!1,cancelable:!0},n1="RovingFocusGroup",[Kj,IX,Fxe]=LL(n1),[Bxe,MX]=wc(n1,[Fxe]),[Vxe,Uxe]=Bxe(n1),OX=Z.forwardRef((e,t)=>P.jsx(Kj.Provider,{scope:e.__scopeRovingFocusGroup,children:P.jsx(Kj.Slot,{scope:e.__scopeRovingFocusGroup,children:P.jsx($xe,{...e,ref:t})})}));OX.displayName=n1;var $xe=Z.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:c=!1,dir:h,currentTabStopId:p,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:v,onEntryFocus:w,preventScrollOnEntryFocus:T=!1,...I}=e,O=Z.useRef(null),D=yi(t,O),B=pk(h),[N,G]=ym({prop:p,defaultProp:s??null,onChange:v,caller:n1}),[U,V]=Z.useState(!1),X=ro(w),Y=IX(r),ne=Z.useRef(!1),[ae,le]=Z.useState(0);return Z.useEffect(()=>{const ge=O.current;if(ge)return ge.addEventListener(xM,X),()=>ge.removeEventListener(xM,X)},[X]),P.jsx(Vxe,{scope:r,orientation:n,dir:B,loop:c,currentTabStopId:N,onItemFocus:Z.useCallback(ge=>G(ge),[G]),onItemShiftTab:Z.useCallback(()=>V(!0),[]),onFocusableItemAdd:Z.useCallback(()=>le(ge=>ge+1),[]),onFocusableItemRemove:Z.useCallback(()=>le(ge=>ge-1),[]),children:P.jsx(fn.div,{tabIndex:U||ae===0?-1:0,"data-orientation":n,...I,ref:D,style:{outline:"none",...e.style},onMouseDown:Zr(e.onMouseDown,()=>{ne.current=!0}),onFocus:Zr(e.onFocus,ge=>{const je=!ne.current;if(ge.target===ge.currentTarget&&je&&!U){const ze=new CustomEvent(xM,Nxe);if(ge.currentTarget.dispatchEvent(ze),!ze.defaultPrevented){const Pe=Y().filter(tt=>tt.focusable),Ke=Pe.find(tt=>tt.active),Ye=Pe.find(tt=>tt.id===N),Oe=[Ke,Ye,...Pe].filter(Boolean).map(tt=>tt.ref.current);DX(Oe,T)}}ne.current=!1}),onBlur:Zr(e.onBlur,()=>V(!1))})})}),jX="RovingFocusGroupItem",RX=Z.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:c=!1,tabStopId:h,children:p,...s}=e,v=hf(),w=h||v,T=Uxe(jX,r),I=T.currentTabStopId===w,O=IX(r),{onFocusableItemAdd:D,onFocusableItemRemove:B,currentTabStopId:N}=T;return Z.useEffect(()=>{if(n)return D(),()=>B()},[n,D,B]),P.jsx(Kj.ItemSlot,{scope:r,id:w,focusable:n,active:c,children:P.jsx(fn.span,{tabIndex:I?0:-1,"data-orientation":T.orientation,...s,ref:t,onMouseDown:Zr(e.onMouseDown,G=>{n?T.onItemFocus(w):G.preventDefault()}),onFocus:Zr(e.onFocus,()=>T.onItemFocus(w)),onKeyDown:Zr(e.onKeyDown,G=>{if(G.key==="Tab"&&G.shiftKey){T.onItemShiftTab();return}if(G.target!==G.currentTarget)return;const U=Wxe(G,T.orientation,T.dir);if(U!==void 0){if(G.metaKey||G.ctrlKey||G.altKey||G.shiftKey)return;G.preventDefault();let V=O().filter(X=>X.focusable).map(X=>X.ref.current);if(U==="last")V.reverse();else if(U==="prev"||U==="next"){U==="prev"&&V.reverse();const X=V.indexOf(G.currentTarget);V=T.loop?qxe(V,X+1):V.slice(X+1)}setTimeout(()=>DX(V))}}),children:typeof p=="function"?p({isCurrentTabStop:I,hasTabStop:N!=null}):p})})});RX.displayName=jX;var Gxe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Hxe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Wxe(e,t,r){const n=Hxe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return Gxe[n]}function DX(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function qxe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var Zxe=OX,Kxe=RX,yk="Tabs",[Xxe,l7e]=wc(yk,[MX]),LX=MX(),[Yxe,q3]=Xxe(yk),zX=Z.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:c,defaultValue:h,orientation:p="horizontal",dir:s,activationMode:v="automatic",...w}=e,T=pk(s),[I,O]=ym({prop:n,onChange:c,defaultProp:h??"",caller:yk});return P.jsx(Yxe,{scope:r,baseId:hf(),value:I,onValueChange:O,orientation:p,dir:T,activationMode:v,children:P.jsx(fn.div,{dir:T,"data-orientation":p,...w,ref:t})})});zX.displayName=yk;var NX="TabsList",FX=Z.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...c}=e,h=q3(NX,r),p=LX(r);return P.jsx(Zxe,{asChild:!0,...p,orientation:h.orientation,dir:h.dir,loop:n,children:P.jsx(fn.div,{role:"tablist","aria-orientation":h.orientation,...c,ref:t})})});FX.displayName=NX;var BX="TabsTrigger",VX=Z.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:c=!1,...h}=e,p=q3(BX,r),s=LX(r),v=GX(p.baseId,n),w=HX(p.baseId,n),T=n===p.value;return P.jsx(Kxe,{asChild:!0,...s,focusable:!c,active:T,children:P.jsx(fn.button,{type:"button",role:"tab","aria-selected":T,"aria-controls":w,"data-state":T?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:v,...h,ref:t,onMouseDown:Zr(e.onMouseDown,I=>{!c&&I.button===0&&I.ctrlKey===!1?p.onValueChange(n):I.preventDefault()}),onKeyDown:Zr(e.onKeyDown,I=>{[" ","Enter"].includes(I.key)&&p.onValueChange(n)}),onFocus:Zr(e.onFocus,()=>{const I=p.activationMode!=="manual";!T&&!c&&I&&p.onValueChange(n)})})})});VX.displayName=BX;var UX="TabsContent",$X=Z.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:c,children:h,...p}=e,s=q3(UX,r),v=GX(s.baseId,n),w=HX(s.baseId,n),T=n===s.value,I=Z.useRef(T);return Z.useEffect(()=>{const O=requestAnimationFrame(()=>I.current=!1);return()=>cancelAnimationFrame(O)},[]),P.jsx(Sc,{present:c||T,children:({present:O})=>P.jsx(fn.div,{"data-state":T?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":v,hidden:!O,id:w,tabIndex:0,...p,ref:t,style:{...e.style,animationDuration:I.current?"0s":void 0},children:O&&h})})});$X.displayName=UX;function GX(e,t){return`${e}-trigger-${t}`}function HX(e,t){return`${e}-content-${t}`}var Jxe=zX,WX=FX,qX=VX,ZX=$X;const Z3=Jxe,_k=Z.forwardRef(({className:e,...t},r)=>P.jsx(WX,{ref:r,className:ln("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));_k.displayName=WX.displayName;const Su=Z.forwardRef(({className:e,...t},r)=>P.jsx(qX,{ref:r,className:ln("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));Su.displayName=qX.displayName;const Tu=Z.forwardRef(({className:e,...t},r)=>P.jsx(ZX,{ref:r,className:ln("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Tu.displayName=ZX.displayName;var K3="Progress",X3=100,[Qxe,c7e]=wc(K3),[ebe,tbe]=Qxe(K3),KX=Z.forwardRef((e,t)=>{const{__scopeProgress:r,value:n=null,max:c,getValueLabel:h=rbe,...p}=e;(c||c===0)&&!FU(c)&&console.error(nbe(`${c}`,"Progress"));const s=FU(c)?c:X3;n!==null&&!BU(n,s)&&console.error(ibe(`${n}`,"Progress"));const v=BU(n,s)?n:null,w=bE(v)?h(v,s):void 0;return P.jsx(ebe,{scope:r,value:v,max:s,children:P.jsx(fn.div,{"aria-valuemax":s,"aria-valuemin":0,"aria-valuenow":bE(v)?v:void 0,"aria-valuetext":w,role:"progressbar","data-state":JX(v,s),"data-value":v??void 0,"data-max":s,...p,ref:t})})});KX.displayName=K3;var XX="ProgressIndicator",YX=Z.forwardRef((e,t)=>{const{__scopeProgress:r,...n}=e,c=tbe(XX,r);return P.jsx(fn.div,{"data-state":JX(c.value,c.max),"data-value":c.value??void 0,"data-max":c.max,...n,ref:t})});YX.displayName=XX;function rbe(e,t){return`${Math.round(e/t*100)}%`}function JX(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function bE(e){return typeof e=="number"}function FU(e){return bE(e)&&!isNaN(e)&&e>0}function BU(e,t){return bE(e)&&!isNaN(e)&&e<=t&&e>=0}function nbe(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${X3}\`.`}function ibe(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${X3} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var QX=KX,sbe=YX;const Y3=Z.forwardRef(({className:e,value:t,...r},n)=>P.jsx(QX,{ref:n,className:ln("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:P.jsx(sbe,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Y3.displayName=QX.displayName;function eY(e){const t=Z.useRef({value:e,previous:e});return Z.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var vk="Switch",[obe,u7e]=wc(vk),[abe,lbe]=obe(vk),tY=Z.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:c,defaultChecked:h,required:p,disabled:s,value:v="on",onCheckedChange:w,form:T,...I}=e,[O,D]=Z.useState(null),B=yi(t,X=>D(X)),N=Z.useRef(!1),G=O?T||!!O.closest("form"):!0,[U,V]=ym({prop:c,defaultProp:h??!1,onChange:w,caller:vk});return P.jsxs(abe,{scope:r,checked:U,disabled:s,children:[P.jsx(fn.button,{type:"button",role:"switch","aria-checked":U,"aria-required":p,"data-state":sY(U),"data-disabled":s?"":void 0,disabled:s,value:v,...I,ref:B,onClick:Zr(e.onClick,X=>{V(Y=>!Y),G&&(N.current=X.isPropagationStopped(),N.current||X.stopPropagation())})}),G&&P.jsx(iY,{control:O,bubbles:!N.current,name:n,value:v,checked:U,required:p,disabled:s,form:T,style:{transform:"translateX(-100%)"}})]})});tY.displayName=vk;var rY="SwitchThumb",nY=Z.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,c=lbe(rY,r);return P.jsx(fn.span,{"data-state":sY(c.checked),"data-disabled":c.disabled?"":void 0,...n,ref:t})});nY.displayName=rY;var cbe="SwitchBubbleInput",iY=Z.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...c},h)=>{const p=Z.useRef(null),s=yi(p,h),v=eY(r),w=S9(t);return Z.useEffect(()=>{const T=p.current;if(!T)return;const I=window.HTMLInputElement.prototype,O=Object.getOwnPropertyDescriptor(I,"checked").set;if(v!==r&&O){const D=new Event("click",{bubbles:n});O.call(T,r),T.dispatchEvent(D)}},[v,r,n]),P.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...c,tabIndex:-1,ref:s,style:{...c.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});iY.displayName=cbe;function sY(e){return e?"checked":"unchecked"}var oY=tY,ube=nY;const aY=Z.forwardRef(({className:e,...t},r)=>P.jsx(oY,{className:ln("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:r,children:P.jsx(ube,{className:ln("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));aY.displayName=oY.displayName;const hbe=({onDataChange:e,isEnabled:t=!0}={})=>{const r=Z.useCallback((n,c)=>{console.log(`Admin Monitor: Critical change in ${c}:`,n),n.eventType==="INSERT"?fh.success(`Ny data tillagd i ${c}`,{description:`${n.eventType} operation utförd`,duration:5e3}):n.eventType==="UPDATE"?fh.info(`Data uppdaterad i ${c}`,{description:`Rad ${n.new?.id||"unknown"} modifierad`,duration:3e3}):n.eventType==="DELETE"&&fh.error(`Data borttagen från ${c}`,{description:`Rad ${n.old?.id||"unknown"} raderad`,duration:5e3}),e&&setTimeout(e,500)},[e]);return Z.useEffect(()=>{if(!t)return;console.log("Admin Real-time Monitor: Starting subscriptions");const n=gn.channel("admin_preschool_monitor").on("postgres_changes",{event:"*",schema:"public",table:"Förskolor"},v=>r(v,"Förskolor")).subscribe(),c=gn.channel("admin_google_monitor").on("postgres_changes",{event:"*",schema:"public",table:"preschool_google_data"},v=>r(v,"Google Data")).subscribe(),h=gn.channel("admin_image_monitor").on("postgres_changes",{event:"*",schema:"public",table:"preschool_images"},v=>r(v,"Preschool Images")).subscribe(),p=gn.channel("admin_favorites_monitor").on("postgres_changes",{event:"*",schema:"public",table:"user_favorites"},v=>{console.log("Admin Monitor: User favorites activity:",v),e&&setTimeout(e,1e3)}).subscribe(),s=gn.channel("admin_search_monitor").on("postgres_changes",{event:"*",schema:"public",table:"user_search_history"},v=>{console.log("Admin Monitor: Search activity:",v),e&&setTimeout(e,1e3)}).subscribe();return()=>{console.log("Admin Real-time Monitor: Cleaning up subscriptions"),gn.removeChannel(n),gn.removeChannel(c),gn.removeChannel(h),gn.removeChannel(p),gn.removeChannel(s)}},[t,r]),{isMonitoring:t}},dbe=()=>{const[e,t]=Z.useState(null),[r,n]=Z.useState(!0),{preschools:c}=_s(),h=()=>{if(!c.length)return;const p=c.length,s=c.filter(I=>I.latitud!==null&&I.longitud!==null&&I.latitud!==0&&I.longitud!==0).length,v=p-s,w=c.filter(I=>I.latitud===null||I.longitud===null||I.latitud===0||I.longitud===0).length,T={};c.forEach(I=>{T[I.kommun]||(T[I.kommun]={total:0,missing:0,percentage:0}),T[I.kommun].total++,(I.latitud===null||I.longitud===null||I.latitud===0||I.longitud===0)&&T[I.kommun].missing++}),Object.keys(T).forEach(I=>{const O=T[I];O.percentage=Math.round(O.missing/O.total*100)}),t({total:p,withCoordinates:s,missingCoordinates:v,needsGeocoding:w,byKommun:T}),n(!1)};return Z.useEffect(()=>{h()},[c]),{stats:e,isLoading:r,refresh:h}},fbe=Y_("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),lY=Z.forwardRef(({className:e,variant:t,...r},n)=>P.jsx("div",{ref:n,role:"alert",className:ln(fbe({variant:t}),e),...r}));lY.displayName="Alert";const pbe=Z.forwardRef(({className:e,...t},r)=>P.jsx("h5",{ref:r,className:ln("mb-1 font-medium leading-none tracking-tight",e),...t}));pbe.displayName="AlertTitle";const cY=Z.forwardRef(({className:e,...t},r)=>P.jsx("div",{ref:r,className:ln("text-sm [&_p]:leading-relaxed",e),...t}));cY.displayName="AlertDescription";const mbe=({missingCoordinatesCount:e,onComplete:t})=>{const[r,n]=Z.useState(!1),[c,h]=Z.useState(0),[p,s]=Z.useState(0),[v,w]=Z.useState(0),[T,I]=Z.useState(0),[O,D]=Z.useState(0),[B,N]=Z.useState([]),{preschools:G}=_s(),{toast:U}=DL(),V=async()=>{n(!0),h(0),s(0),w(0),N([]);try{const ne=G.filter(Pe=>Pe.latitud===null||Pe.longitud===null||Pe.latitud===0||Pe.longitud===0);if(ne.length===0){U({title:"Ingen bearbetning krävs",description:"Alla förskolor har redan koordinater."}),n(!1);return}const ae=25,le=Math.ceil(ne.length/ae);D(le),console.log(`Starting batch processing: ${ne.length} preschools in ${le} batches`);let ge=0,je=0;const ze=[];for(let Pe=0;Pe<le;Pe++){I(Pe+1);const Ke=Pe*ae,Ye=Math.min(Ke+ae,ne.length),Oe=ne.slice(Ke,Ye);console.log(`Processing batch ${Pe+1}/${le}: ${Oe.length} preschools`);const tt=Oe.map(We=>({id:We.id,Namn:We.namn,Adress:We.adress,Kommun:We.kommun,Postnummer:null,Latitud:We.latitud,Longitud:We.longitud}));try{const{data:We,error:lt}=await gn.functions.invoke("geocoding-service",{body:{preschools:tt}});lt?(console.error(`Batch ${Pe+1} error:`,lt),U({title:`Batch ${Pe+1} misslyckades`,description:lt.message,variant:"destructive"})):We&&(ge+=We.processed||0,je+=We.successful||0,ze.push(...We.results||[]),console.log(`Batch ${Pe+1} completed: ${We.successful}/${We.processed} successful`))}catch(We){console.error(`Batch ${Pe+1} exception:`,We),U({title:`Batch ${Pe+1} fel`,description:`Oväntat fel: ${We}`,variant:"destructive"})}s(ge),w(je),h(Math.round((Pe+1)/le*100)),Pe<le-1&&(console.log("Waiting 5 seconds before next batch..."),await new Promise(We=>setTimeout(We,5e3)))}N(ze),U({title:"Batch-bearbetning slutförd",description:`${je} av ${ge} förskolor bearbetades framgångsrikt.`}),t&&t()}catch(ne){console.error("Batch processing error:",ne),U({title:"Bearbetningsfel",description:`Ett fel uppstod: ${ne}`,variant:"destructive"})}finally{n(!1)}},X=()=>{n(!1),U({title:"Bearbetning stoppad",description:"Batch-bearbetningen har stoppats."})},Y=()=>{h(0),s(0),w(0),I(0),D(0),N([])};return P.jsxs(kn,{children:[P.jsxs(r_,{children:[P.jsxs(n_,{className:"flex items-center gap-2",children:[P.jsx(qa,{className:"h-5 w-5"}),"Koordinat Batch-processor"]}),P.jsx(GK,{children:"Bearbeta förskolor som saknar koordinater i batch-operationer"})]}),P.jsxs(Pl,{className:"space-y-4",children:[e>0&&P.jsxs(lY,{children:[P.jsx(qa,{className:"h-4 w-4"}),P.jsxs(cY,{children:[P.jsx("strong",{children:e})," förskolor saknar koordinater och behöver bearbetas."]})]}),r&&P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex justify-between text-sm",children:[P.jsxs("span",{children:["Batch ",T," av ",O]}),P.jsxs("span",{children:[v,"/",p," framgångsrika"]})]}),P.jsx(Y3,{value:c,className:"w-full"}),P.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[P.jsx("span",{children:"Bearbetar koordinater..."}),P.jsxs("span",{children:[c,"% färdigt"]})]})]}),P.jsx("div",{className:"flex gap-2",children:r?P.jsxs(Hr,{variant:"destructive",onClick:X,className:"flex items-center gap-2",children:[P.jsx(Qq,{className:"h-4 w-4"}),"Stoppa bearbetning"]}):P.jsxs(P.Fragment,{children:[P.jsxs(Hr,{onClick:V,disabled:e===0,className:"flex items-center gap-2",children:[P.jsx(Jq,{className:"h-4 w-4"}),"Starta batch-bearbetning"]}),(p>0||B.length>0)&&P.jsxs(Hr,{variant:"outline",onClick:Y,className:"flex items-center gap-2",children:[P.jsx(Jce,{className:"h-4 w-4"}),"Återställ"]})]})}),B.length>0&&P.jsxs("div",{className:"mt-4",children:[P.jsx("h4",{className:"font-medium mb-2",children:"Senaste resultat:"}),P.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:B.slice(-10).map((ne,ae)=>P.jsxs("div",{className:"flex justify-between items-center text-sm",children:[P.jsx("span",{className:"truncate",children:ne.namn}),P.jsx(an,{variant:ne.success?"default":"destructive",children:ne.success?"✓":"✗"})]},ae))})]})]})]})};var bM=0;function uY(){Z.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??VU()),document.body.insertAdjacentElement("beforeend",e[1]??VU()),bM++,()=>{bM===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),bM--}},[])}function VU(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var wM="focusScope.autoFocusOnMount",SM="focusScope.autoFocusOnUnmount",UU={bubbles:!1,cancelable:!0},gbe="FocusScope",J3=Z.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:c,onUnmountAutoFocus:h,...p}=e,[s,v]=Z.useState(null),w=ro(c),T=ro(h),I=Z.useRef(null),O=yi(t,N=>v(N)),D=Z.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Z.useEffect(()=>{if(n){let N=function(X){if(D.paused||!s)return;const Y=X.target;s.contains(Y)?I.current=Y:Ud(I.current,{select:!0})},G=function(X){if(D.paused||!s)return;const Y=X.relatedTarget;Y!==null&&(s.contains(Y)||Ud(I.current,{select:!0}))},U=function(X){if(document.activeElement===document.body)for(const Y of X)Y.removedNodes.length>0&&Ud(s)};document.addEventListener("focusin",N),document.addEventListener("focusout",G);const V=new MutationObserver(U);return s&&V.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",N),document.removeEventListener("focusout",G),V.disconnect()}}},[n,s,D.paused]),Z.useEffect(()=>{if(s){GU.add(D);const N=document.activeElement;if(!s.contains(N)){const G=new CustomEvent(wM,UU);s.addEventListener(wM,w),s.dispatchEvent(G),G.defaultPrevented||(ybe(wbe(hY(s)),{select:!0}),document.activeElement===N&&Ud(s))}return()=>{s.removeEventListener(wM,w),setTimeout(()=>{const G=new CustomEvent(SM,UU);s.addEventListener(SM,T),s.dispatchEvent(G),G.defaultPrevented||Ud(N??document.body,{select:!0}),s.removeEventListener(SM,T),GU.remove(D)},0)}}},[s,w,T,D]);const B=Z.useCallback(N=>{if(!r&&!n||D.paused)return;const G=N.key==="Tab"&&!N.altKey&&!N.ctrlKey&&!N.metaKey,U=document.activeElement;if(G&&U){const V=N.currentTarget,[X,Y]=_be(V);X&&Y?!N.shiftKey&&U===Y?(N.preventDefault(),r&&Ud(X,{select:!0})):N.shiftKey&&U===X&&(N.preventDefault(),r&&Ud(Y,{select:!0})):U===V&&N.preventDefault()}},[r,n,D.paused]);return P.jsx(fn.div,{tabIndex:-1,...p,ref:O,onKeyDown:B})});J3.displayName=gbe;function ybe(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(Ud(n,{select:t}),document.activeElement!==r)return}function _be(e){const t=hY(e),r=$U(t,e),n=$U(t.reverse(),e);return[r,n]}function hY(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const c=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||c?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function $U(e,t){for(const r of e)if(!vbe(r,{upTo:t}))return r}function vbe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function xbe(e){return e instanceof HTMLInputElement&&"select"in e}function Ud(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&xbe(e)&&t&&e.select()}}var GU=bbe();function bbe(){let e=[];return{add(t){const r=e[0];t!==r&&r?.pause(),e=HU(e,t),e.unshift(t)},remove(t){e=HU(e,t),e[0]?.resume()}}}function HU(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function wbe(e){return e.filter(t=>t.tagName!=="A")}var Sbe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},gy=new WeakMap,HT=new WeakMap,WT={},TM=0,dY=function(e){return e&&(e.host||dY(e.parentNode))},Tbe=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=dY(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},Ebe=function(e,t,r,n){var c=Tbe(t,Array.isArray(e)?e:[e]);WT[r]||(WT[r]=new WeakMap);var h=WT[r],p=[],s=new Set,v=new Set(c),w=function(I){!I||s.has(I)||(s.add(I),w(I.parentNode))};c.forEach(w);var T=function(I){!I||v.has(I)||Array.prototype.forEach.call(I.children,function(O){if(s.has(O))T(O);else try{var D=O.getAttribute(n),B=D!==null&&D!=="false",N=(gy.get(O)||0)+1,G=(h.get(O)||0)+1;gy.set(O,N),h.set(O,G),p.push(O),N===1&&B&&HT.set(O,!0),G===1&&O.setAttribute(r,"true"),B||O.setAttribute(n,"true")}catch(U){console.error("aria-hidden: cannot operate on ",O,U)}})};return T(t),s.clear(),TM++,function(){p.forEach(function(I){var O=gy.get(I)-1,D=h.get(I)-1;gy.set(I,O),h.set(I,D),O||(HT.has(I)||I.removeAttribute(n),HT.delete(I)),D||I.removeAttribute(r)}),TM--,TM||(gy=new WeakMap,gy=new WeakMap,HT=new WeakMap,WT={})}},fY=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),c=Sbe(e);return c?(n.push.apply(n,Array.from(c.querySelectorAll("[aria-live], script"))),Ebe(n,c,r,"aria-hidden")):function(){return null}},du=function(){return du=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c])}return e},du.apply(this,arguments)};function pY(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(e);c<n.length;c++)t.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(e,n[c])&&(r[n[c]]=e[n[c]]);return r}function Abe(e,t,r){for(var n=0,c=t.length,h;n<c;n++)(h||!(n in t))&&(h||(h=Array.prototype.slice.call(t,0,n)),h[n]=t[n]);return e.concat(h||Array.prototype.slice.call(t))}var I2="right-scroll-bar-position",M2="width-before-scroll-bar",kbe="with-scroll-bars-hidden",Pbe="--removed-body-scroll-bar-size";function EM(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Cbe(e,t){var r=Z.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var c=r.value;c!==n&&(r.value=n,r.callback(n,c))}}}})[0];return r.callback=t,r.facade}var Ibe=typeof window<"u"?Z.useLayoutEffect:Z.useEffect,WU=new WeakMap;function Mbe(e,t){var r=Cbe(null,function(n){return e.forEach(function(c){return EM(c,n)})});return Ibe(function(){var n=WU.get(r);if(n){var c=new Set(n),h=new Set(e),p=r.current;c.forEach(function(s){h.has(s)||EM(s,null)}),h.forEach(function(s){c.has(s)||EM(s,p)})}WU.set(r,e)},[e]),r}function Obe(e){return e}function jbe(e,t){t===void 0&&(t=Obe);var r=[],n=!1,c={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(h){var p=t(h,n);return r.push(p),function(){r=r.filter(function(s){return s!==p})}},assignSyncMedium:function(h){for(n=!0;r.length;){var p=r;r=[],p.forEach(h)}r={push:function(s){return h(s)},filter:function(){return r}}},assignMedium:function(h){n=!0;var p=[];if(r.length){var s=r;r=[],s.forEach(h),p=r}var v=function(){var T=p;p=[],T.forEach(h)},w=function(){return Promise.resolve().then(v)};w(),r={push:function(T){p.push(T),w()},filter:function(T){return p=p.filter(T),r}}}};return c}function Rbe(e){e===void 0&&(e={});var t=jbe(null);return t.options=du({async:!0,ssr:!1},e),t}var mY=function(e){var t=e.sideCar,r=pY(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return Z.createElement(n,du({},r))};mY.isSideCarExport=!0;function Dbe(e,t){return e.useMedium(t),mY}var gY=Rbe(),AM=function(){},xk=Z.forwardRef(function(e,t){var r=Z.useRef(null),n=Z.useState({onScrollCapture:AM,onWheelCapture:AM,onTouchMoveCapture:AM}),c=n[0],h=n[1],p=e.forwardProps,s=e.children,v=e.className,w=e.removeScrollBar,T=e.enabled,I=e.shards,O=e.sideCar,D=e.noRelative,B=e.noIsolation,N=e.inert,G=e.allowPinchZoom,U=e.as,V=U===void 0?"div":U,X=e.gapMode,Y=pY(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),ne=O,ae=Mbe([r,t]),le=du(du({},Y),c);return Z.createElement(Z.Fragment,null,T&&Z.createElement(ne,{sideCar:gY,removeScrollBar:w,shards:I,noRelative:D,noIsolation:B,inert:N,setCallbacks:h,allowPinchZoom:!!G,lockRef:r,gapMode:X}),p?Z.cloneElement(Z.Children.only(s),du(du({},le),{ref:ae})):Z.createElement(V,du({},le,{className:v,ref:ae}),s))});xk.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};xk.classNames={fullWidth:M2,zeroRight:I2};var Lbe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function zbe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Lbe();return t&&e.setAttribute("nonce",t),e}function Nbe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function Fbe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Bbe=function(){var e=0,t=null;return{add:function(r){e==0&&(t=zbe())&&(Nbe(t,r),Fbe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Vbe=function(){var e=Bbe();return function(t,r){Z.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},yY=function(){var e=Vbe(),t=function(r){var n=r.styles,c=r.dynamic;return e(n,c),null};return t},Ube={left:0,top:0,right:0,gap:0},kM=function(e){return parseInt(e||"",10)||0},$be=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],c=t[e==="padding"?"paddingRight":"marginRight"];return[kM(r),kM(n),kM(c)]},Gbe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Ube;var t=$be(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},Hbe=yY(),i_="data-scroll-locked",Wbe=function(e,t,r,n){var c=e.left,h=e.top,p=e.right,s=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(kbe,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(s,"px ").concat(n,`;
  }
  body[`).concat(i_,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(c,`px;
    padding-top: `).concat(h,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(s,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(I2,` {
    right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(M2,` {
    margin-right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(I2," .").concat(I2,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(M2," .").concat(M2,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(i_,`] {
    `).concat(Pbe,": ").concat(s,`px;
  }
`)},qU=function(){var e=parseInt(document.body.getAttribute(i_)||"0",10);return isFinite(e)?e:0},qbe=function(){Z.useEffect(function(){return document.body.setAttribute(i_,(qU()+1).toString()),function(){var e=qU()-1;e<=0?document.body.removeAttribute(i_):document.body.setAttribute(i_,e.toString())}},[])},Zbe=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,c=n===void 0?"margin":n;qbe();var h=Z.useMemo(function(){return Gbe(c)},[c]);return Z.createElement(Hbe,{styles:Wbe(h,!t,c,r?"":"!important")})},Xj=!1;if(typeof window<"u")try{var qT=Object.defineProperty({},"passive",{get:function(){return Xj=!0,!0}});window.addEventListener("test",qT,qT),window.removeEventListener("test",qT,qT)}catch{Xj=!1}var yy=Xj?{passive:!1}:!1,Kbe=function(e){return e.tagName==="TEXTAREA"},_Y=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!Kbe(e)&&r[t]==="visible")},Xbe=function(e){return _Y(e,"overflowY")},Ybe=function(e){return _Y(e,"overflowX")},ZU=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var c=vY(e,n);if(c){var h=xY(e,n),p=h[1],s=h[2];if(p>s)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},Jbe=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},Qbe=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},vY=function(e,t){return e==="v"?Xbe(t):Ybe(t)},xY=function(e,t){return e==="v"?Jbe(t):Qbe(t)},ewe=function(e,t){return e==="h"&&t==="rtl"?-1:1},twe=function(e,t,r,n,c){var h=ewe(e,window.getComputedStyle(t).direction),p=h*n,s=r.target,v=t.contains(s),w=!1,T=p>0,I=0,O=0;do{if(!s)break;var D=xY(e,s),B=D[0],N=D[1],G=D[2],U=N-G-h*B;(B||U)&&vY(e,s)&&(I+=U,O+=B);var V=s.parentNode;s=V&&V.nodeType===Node.DOCUMENT_FRAGMENT_NODE?V.host:V}while(!v&&s!==document.body||v&&(t.contains(s)||t===s));return(T&&Math.abs(I)<1||!T&&Math.abs(O)<1)&&(w=!0),w},ZT=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},KU=function(e){return[e.deltaX,e.deltaY]},XU=function(e){return e&&"current"in e?e.current:e},rwe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},nwe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},iwe=0,_y=[];function swe(e){var t=Z.useRef([]),r=Z.useRef([0,0]),n=Z.useRef(),c=Z.useState(iwe++)[0],h=Z.useState(yY)[0],p=Z.useRef(e);Z.useEffect(function(){p.current=e},[e]),Z.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(c));var N=Abe([e.lockRef.current],(e.shards||[]).map(XU)).filter(Boolean);return N.forEach(function(G){return G.classList.add("allow-interactivity-".concat(c))}),function(){document.body.classList.remove("block-interactivity-".concat(c)),N.forEach(function(G){return G.classList.remove("allow-interactivity-".concat(c))})}}},[e.inert,e.lockRef.current,e.shards]);var s=Z.useCallback(function(N,G){if("touches"in N&&N.touches.length===2||N.type==="wheel"&&N.ctrlKey)return!p.current.allowPinchZoom;var U=ZT(N),V=r.current,X="deltaX"in N?N.deltaX:V[0]-U[0],Y="deltaY"in N?N.deltaY:V[1]-U[1],ne,ae=N.target,le=Math.abs(X)>Math.abs(Y)?"h":"v";if("touches"in N&&le==="h"&&ae.type==="range")return!1;var ge=ZU(le,ae);if(!ge)return!0;if(ge?ne=le:(ne=le==="v"?"h":"v",ge=ZU(le,ae)),!ge)return!1;if(!n.current&&"changedTouches"in N&&(X||Y)&&(n.current=ne),!ne)return!0;var je=n.current||ne;return twe(je,G,N,je==="h"?X:Y)},[]),v=Z.useCallback(function(N){var G=N;if(!(!_y.length||_y[_y.length-1]!==h)){var U="deltaY"in G?KU(G):ZT(G),V=t.current.filter(function(ne){return ne.name===G.type&&(ne.target===G.target||G.target===ne.shadowParent)&&rwe(ne.delta,U)})[0];if(V&&V.should){G.cancelable&&G.preventDefault();return}if(!V){var X=(p.current.shards||[]).map(XU).filter(Boolean).filter(function(ne){return ne.contains(G.target)}),Y=X.length>0?s(G,X[0]):!p.current.noIsolation;Y&&G.cancelable&&G.preventDefault()}}},[]),w=Z.useCallback(function(N,G,U,V){var X={name:N,delta:G,target:U,should:V,shadowParent:owe(U)};t.current.push(X),setTimeout(function(){t.current=t.current.filter(function(Y){return Y!==X})},1)},[]),T=Z.useCallback(function(N){r.current=ZT(N),n.current=void 0},[]),I=Z.useCallback(function(N){w(N.type,KU(N),N.target,s(N,e.lockRef.current))},[]),O=Z.useCallback(function(N){w(N.type,ZT(N),N.target,s(N,e.lockRef.current))},[]);Z.useEffect(function(){return _y.push(h),e.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:O}),document.addEventListener("wheel",v,yy),document.addEventListener("touchmove",v,yy),document.addEventListener("touchstart",T,yy),function(){_y=_y.filter(function(N){return N!==h}),document.removeEventListener("wheel",v,yy),document.removeEventListener("touchmove",v,yy),document.removeEventListener("touchstart",T,yy)}},[]);var D=e.removeScrollBar,B=e.inert;return Z.createElement(Z.Fragment,null,B?Z.createElement(h,{styles:nwe(c)}):null,D?Z.createElement(Zbe,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function owe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const awe=Dbe(gY,swe);var Q3=Z.forwardRef(function(e,t){return Z.createElement(xk,du({},e,{ref:t,sideCar:awe}))});Q3.classNames=xk.classNames;var lwe=[" ","Enter","ArrowUp","ArrowDown"],cwe=[" ","Enter"],xm="Select",[bk,wk,uwe]=LL(xm),[av,h7e]=wc(xm,[uwe,XA]),Sk=XA(),[hwe,Tf]=av(xm),[dwe,fwe]=av(xm),bY=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:c,onOpenChange:h,value:p,defaultValue:s,onValueChange:v,dir:w,name:T,autoComplete:I,disabled:O,required:D,form:B}=e,N=Sk(t),[G,U]=Z.useState(null),[V,X]=Z.useState(null),[Y,ne]=Z.useState(!1),ae=pk(w),[le,ge]=ym({prop:n,defaultProp:c??!1,onChange:h,caller:xm}),[je,ze]=ym({prop:p,defaultProp:s,onChange:v,caller:xm}),Pe=Z.useRef(null),Ke=G?B||!!G.closest("form"):!0,[Ye,Oe]=Z.useState(new Set),tt=Array.from(Ye).map(We=>We.props.value).join(";");return P.jsx(Lde,{...N,children:P.jsxs(hwe,{required:D,scope:t,trigger:G,onTriggerChange:U,valueNode:V,onValueNodeChange:X,valueNodeHasChildren:Y,onValueNodeHasChildrenChange:ne,contentId:hf(),value:je,onValueChange:ze,open:le,onOpenChange:ge,dir:ae,triggerPointerDownPosRef:Pe,disabled:O,children:[P.jsx(bk.Provider,{scope:t,children:P.jsx(dwe,{scope:e.__scopeSelect,onNativeOptionAdd:Z.useCallback(We=>{Oe(lt=>new Set(lt).add(We))},[]),onNativeOptionRemove:Z.useCallback(We=>{Oe(lt=>{const rt=new Set(lt);return rt.delete(We),rt})},[]),children:r})}),Ke?P.jsxs(HY,{"aria-hidden":!0,required:D,tabIndex:-1,name:T,autoComplete:I,value:je,onChange:We=>ze(We.target.value),disabled:O,form:B,children:[je===void 0?P.jsx("option",{value:""}):null,Array.from(Ye)]},tt):null]})})};bY.displayName=xm;var wY="SelectTrigger",SY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...c}=e,h=Sk(r),p=Tf(wY,r),s=p.disabled||n,v=yi(t,p.onTriggerChange),w=wk(r),T=Z.useRef("touch"),[I,O,D]=qY(N=>{const G=w().filter(X=>!X.disabled),U=G.find(X=>X.value===p.value),V=ZY(G,N,U);V!==void 0&&p.onValueChange(V.value)}),B=N=>{s||(p.onOpenChange(!0),D()),N&&(p.triggerPointerDownPosRef.current={x:Math.round(N.pageX),y:Math.round(N.pageY)})};return P.jsx(j9,{asChild:!0,...h,children:P.jsx(fn.button,{type:"button",role:"combobox","aria-controls":p.contentId,"aria-expanded":p.open,"aria-required":p.required,"aria-autocomplete":"none",dir:p.dir,"data-state":p.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":WY(p.value)?"":void 0,...c,ref:v,onClick:Zr(c.onClick,N=>{N.currentTarget.focus(),T.current!=="mouse"&&B(N)}),onPointerDown:Zr(c.onPointerDown,N=>{T.current=N.pointerType;const G=N.target;G.hasPointerCapture(N.pointerId)&&G.releasePointerCapture(N.pointerId),N.button===0&&N.ctrlKey===!1&&N.pointerType==="mouse"&&(B(N),N.preventDefault())}),onKeyDown:Zr(c.onKeyDown,N=>{const G=I.current!=="";!(N.ctrlKey||N.altKey||N.metaKey)&&N.key.length===1&&O(N.key),!(G&&N.key===" ")&&lwe.includes(N.key)&&(B(),N.preventDefault())})})})});SY.displayName=wY;var TY="SelectValue",EY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:c,children:h,placeholder:p="",...s}=e,v=Tf(TY,r),{onValueNodeHasChildrenChange:w}=v,T=h!==void 0,I=yi(t,v.onValueNodeChange);return xo(()=>{w(T)},[w,T]),P.jsx(fn.span,{...s,ref:I,style:{pointerEvents:"none"},children:WY(v.value)?P.jsx(P.Fragment,{children:p}):h})});EY.displayName=TY;var pwe="SelectIcon",AY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...c}=e;return P.jsx(fn.span,{"aria-hidden":!0,...c,ref:t,children:n||"▼"})});AY.displayName=pwe;var mwe="SelectPortal",kY=e=>P.jsx(UA,{asChild:!0,...e});kY.displayName=mwe;var bm="SelectContent",PY=Z.forwardRef((e,t)=>{const r=Tf(bm,e.__scopeSelect),[n,c]=Z.useState();if(xo(()=>{c(new DocumentFragment)},[]),!r.open){const h=n;return h?Om.createPortal(P.jsx(CY,{scope:e.__scopeSelect,children:P.jsx(bk.Slot,{scope:e.__scopeSelect,children:P.jsx("div",{children:e.children})})}),h):null}return P.jsx(IY,{...e,ref:t})});PY.displayName=bm;var lc=10,[CY,Ef]=av(bm),gwe="SelectContentImpl",ywe=g_("SelectContent.RemoveScroll"),IY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:c,onEscapeKeyDown:h,onPointerDownOutside:p,side:s,sideOffset:v,align:w,alignOffset:T,arrowPadding:I,collisionBoundary:O,collisionPadding:D,sticky:B,hideWhenDetached:N,avoidCollisions:G,...U}=e,V=Tf(bm,r),[X,Y]=Z.useState(null),[ne,ae]=Z.useState(null),le=yi(t,Ft=>Y(Ft)),[ge,je]=Z.useState(null),[ze,Pe]=Z.useState(null),Ke=wk(r),[Ye,Oe]=Z.useState(!1),tt=Z.useRef(!1);Z.useEffect(()=>{if(X)return fY(X)},[X]),uY();const We=Z.useCallback(Ft=>{const[br,...Yt]=Ke().map(Vt=>Vt.ref.current),[Qt]=Yt.slice(-1),Sr=document.activeElement;for(const Vt of Ft)if(Vt===Sr||(Vt?.scrollIntoView({block:"nearest"}),Vt===br&&ne&&(ne.scrollTop=0),Vt===Qt&&ne&&(ne.scrollTop=ne.scrollHeight),Vt?.focus(),document.activeElement!==Sr))return},[Ke,ne]),lt=Z.useCallback(()=>We([ge,X]),[We,ge,X]);Z.useEffect(()=>{Ye&&lt()},[Ye,lt]);const{onOpenChange:rt,triggerPointerDownPosRef:ht}=V;Z.useEffect(()=>{if(X){let Ft={x:0,y:0};const br=Qt=>{Ft={x:Math.abs(Math.round(Qt.pageX)-(ht.current?.x??0)),y:Math.abs(Math.round(Qt.pageY)-(ht.current?.y??0))}},Yt=Qt=>{Ft.x<=10&&Ft.y<=10?Qt.preventDefault():X.contains(Qt.target)||rt(!1),document.removeEventListener("pointermove",br),ht.current=null};return ht.current!==null&&(document.addEventListener("pointermove",br),document.addEventListener("pointerup",Yt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",br),document.removeEventListener("pointerup",Yt,{capture:!0})}}},[X,rt,ht]),Z.useEffect(()=>{const Ft=()=>rt(!1);return window.addEventListener("blur",Ft),window.addEventListener("resize",Ft),()=>{window.removeEventListener("blur",Ft),window.removeEventListener("resize",Ft)}},[rt]);const[vt,mt]=qY(Ft=>{const br=Ke().filter(Sr=>!Sr.disabled),Yt=br.find(Sr=>Sr.ref.current===document.activeElement),Qt=ZY(br,Ft,Yt);Qt&&setTimeout(()=>Qt.ref.current.focus())}),ct=Z.useCallback((Ft,br,Yt)=>{const Qt=!tt.current&&!Yt;(V.value!==void 0&&V.value===br||Qt)&&(je(Ft),Qt&&(tt.current=!0))},[V.value]),Ut=Z.useCallback(()=>X?.focus(),[X]),xr=Z.useCallback((Ft,br,Yt)=>{const Qt=!tt.current&&!Yt;(V.value!==void 0&&V.value===br||Qt)&&Pe(Ft)},[V.value]),tn=n==="popper"?Yj:MY,Er=tn===Yj?{side:s,sideOffset:v,align:w,alignOffset:T,arrowPadding:I,collisionBoundary:O,collisionPadding:D,sticky:B,hideWhenDetached:N,avoidCollisions:G}:{};return P.jsx(CY,{scope:r,content:X,viewport:ne,onViewportChange:ae,itemRefCallback:ct,selectedItem:ge,onItemLeave:Ut,itemTextRefCallback:xr,focusSelectedItem:lt,selectedItemText:ze,position:n,isPositioned:Ye,searchRef:vt,children:P.jsx(Q3,{as:ywe,allowPinchZoom:!0,children:P.jsx(J3,{asChild:!0,trapped:V.open,onMountAutoFocus:Ft=>{Ft.preventDefault()},onUnmountAutoFocus:Zr(c,Ft=>{V.trigger?.focus({preventScroll:!0}),Ft.preventDefault()}),children:P.jsx(Ww,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:h,onPointerDownOutside:p,onFocusOutside:Ft=>Ft.preventDefault(),onDismiss:()=>V.onOpenChange(!1),children:P.jsx(tn,{role:"listbox",id:V.contentId,"data-state":V.open?"open":"closed",dir:V.dir,onContextMenu:Ft=>Ft.preventDefault(),...U,...Er,onPlaced:()=>Oe(!0),ref:le,style:{display:"flex",flexDirection:"column",outline:"none",...U.style},onKeyDown:Zr(U.onKeyDown,Ft=>{const br=Ft.ctrlKey||Ft.altKey||Ft.metaKey;if(Ft.key==="Tab"&&Ft.preventDefault(),!br&&Ft.key.length===1&&mt(Ft.key),["ArrowUp","ArrowDown","Home","End"].includes(Ft.key)){let Yt=Ke().filter(Qt=>!Qt.disabled).map(Qt=>Qt.ref.current);if(["ArrowUp","End"].includes(Ft.key)&&(Yt=Yt.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ft.key)){const Qt=Ft.target,Sr=Yt.indexOf(Qt);Yt=Yt.slice(Sr+1)}setTimeout(()=>We(Yt)),Ft.preventDefault()}})})})})})})});IY.displayName=gwe;var _we="SelectItemAlignedPosition",MY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...c}=e,h=Tf(bm,r),p=Ef(bm,r),[s,v]=Z.useState(null),[w,T]=Z.useState(null),I=yi(t,le=>T(le)),O=wk(r),D=Z.useRef(!1),B=Z.useRef(!0),{viewport:N,selectedItem:G,selectedItemText:U,focusSelectedItem:V}=p,X=Z.useCallback(()=>{if(h.trigger&&h.valueNode&&s&&w&&N&&G&&U){const le=h.trigger.getBoundingClientRect(),ge=w.getBoundingClientRect(),je=h.valueNode.getBoundingClientRect(),ze=U.getBoundingClientRect();if(h.dir!=="rtl"){const Qt=ze.left-ge.left,Sr=je.left-Qt,Vt=le.left-Sr,Nn=le.width+Vt,Jr=Math.max(Nn,ge.width),Kr=window.innerWidth-lc,Mn=qj(Sr,[lc,Math.max(lc,Kr-Jr)]);s.style.minWidth=Nn+"px",s.style.left=Mn+"px"}else{const Qt=ge.right-ze.right,Sr=window.innerWidth-je.right-Qt,Vt=window.innerWidth-le.right-Sr,Nn=le.width+Vt,Jr=Math.max(Nn,ge.width),Kr=window.innerWidth-lc,Mn=qj(Sr,[lc,Math.max(lc,Kr-Jr)]);s.style.minWidth=Nn+"px",s.style.right=Mn+"px"}const Pe=O(),Ke=window.innerHeight-lc*2,Ye=N.scrollHeight,Oe=window.getComputedStyle(w),tt=parseInt(Oe.borderTopWidth,10),We=parseInt(Oe.paddingTop,10),lt=parseInt(Oe.borderBottomWidth,10),rt=parseInt(Oe.paddingBottom,10),ht=tt+We+Ye+rt+lt,vt=Math.min(G.offsetHeight*5,ht),mt=window.getComputedStyle(N),ct=parseInt(mt.paddingTop,10),Ut=parseInt(mt.paddingBottom,10),xr=le.top+le.height/2-lc,tn=Ke-xr,Er=G.offsetHeight/2,Ft=G.offsetTop+Er,br=tt+We+Ft,Yt=ht-br;if(br<=xr){const Qt=Pe.length>0&&G===Pe[Pe.length-1].ref.current;s.style.bottom="0px";const Sr=w.clientHeight-N.offsetTop-N.offsetHeight,Vt=Math.max(tn,Er+(Qt?Ut:0)+Sr+lt),Nn=br+Vt;s.style.height=Nn+"px"}else{const Qt=Pe.length>0&&G===Pe[0].ref.current;s.style.top="0px";const Sr=Math.max(xr,tt+N.offsetTop+(Qt?ct:0)+Er)+Yt;s.style.height=Sr+"px",N.scrollTop=br-xr+N.offsetTop}s.style.margin=`${lc}px 0`,s.style.minHeight=vt+"px",s.style.maxHeight=Ke+"px",n?.(),requestAnimationFrame(()=>D.current=!0)}},[O,h.trigger,h.valueNode,s,w,N,G,U,h.dir,n]);xo(()=>X(),[X]);const[Y,ne]=Z.useState();xo(()=>{w&&ne(window.getComputedStyle(w).zIndex)},[w]);const ae=Z.useCallback(le=>{le&&B.current===!0&&(X(),V?.(),B.current=!1)},[X,V]);return P.jsx(xwe,{scope:r,contentWrapper:s,shouldExpandOnScrollRef:D,onScrollButtonChange:ae,children:P.jsx("div",{ref:v,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Y},children:P.jsx(fn.div,{...c,ref:I,style:{boxSizing:"border-box",maxHeight:"100%",...c.style}})})})});MY.displayName=_we;var vwe="SelectPopperPosition",Yj=Z.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:c=lc,...h}=e,p=Sk(r);return P.jsx(R9,{...p,...h,ref:t,align:n,collisionPadding:c,style:{boxSizing:"border-box",...h.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Yj.displayName=vwe;var[xwe,ez]=av(bm,{}),Jj="SelectViewport",OY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...c}=e,h=Ef(Jj,r),p=ez(Jj,r),s=yi(t,h.onViewportChange),v=Z.useRef(0);return P.jsxs(P.Fragment,{children:[P.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),P.jsx(bk.Slot,{scope:r,children:P.jsx(fn.div,{"data-radix-select-viewport":"",role:"presentation",...c,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...c.style},onScroll:Zr(c.onScroll,w=>{const T=w.currentTarget,{contentWrapper:I,shouldExpandOnScrollRef:O}=p;if(O?.current&&I){const D=Math.abs(v.current-T.scrollTop);if(D>0){const B=window.innerHeight-lc*2,N=parseFloat(I.style.minHeight),G=parseFloat(I.style.height),U=Math.max(N,G);if(U<B){const V=U+D,X=Math.min(B,V),Y=V-X;I.style.height=X+"px",I.style.bottom==="0px"&&(T.scrollTop=Y>0?Y:0,I.style.justifyContent="flex-end")}}}v.current=T.scrollTop})})})]})});OY.displayName=Jj;var jY="SelectGroup",[bwe,wwe]=av(jY),Swe=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,c=hf();return P.jsx(bwe,{scope:r,id:c,children:P.jsx(fn.div,{role:"group","aria-labelledby":c,...n,ref:t})})});Swe.displayName=jY;var RY="SelectLabel",DY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,c=wwe(RY,r);return P.jsx(fn.div,{id:c.id,...n,ref:t})});DY.displayName=RY;var wE="SelectItem",[Twe,LY]=av(wE),zY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:c=!1,textValue:h,...p}=e,s=Tf(wE,r),v=Ef(wE,r),w=s.value===n,[T,I]=Z.useState(h??""),[O,D]=Z.useState(!1),B=yi(t,V=>v.itemRefCallback?.(V,n,c)),N=hf(),G=Z.useRef("touch"),U=()=>{c||(s.onValueChange(n),s.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return P.jsx(Twe,{scope:r,value:n,disabled:c,textId:N,isSelected:w,onItemTextChange:Z.useCallback(V=>{I(X=>X||(V?.textContent??"").trim())},[]),children:P.jsx(bk.ItemSlot,{scope:r,value:n,disabled:c,textValue:T,children:P.jsx(fn.div,{role:"option","aria-labelledby":N,"data-highlighted":O?"":void 0,"aria-selected":w&&O,"data-state":w?"checked":"unchecked","aria-disabled":c||void 0,"data-disabled":c?"":void 0,tabIndex:c?void 0:-1,...p,ref:B,onFocus:Zr(p.onFocus,()=>D(!0)),onBlur:Zr(p.onBlur,()=>D(!1)),onClick:Zr(p.onClick,()=>{G.current!=="mouse"&&U()}),onPointerUp:Zr(p.onPointerUp,()=>{G.current==="mouse"&&U()}),onPointerDown:Zr(p.onPointerDown,V=>{G.current=V.pointerType}),onPointerMove:Zr(p.onPointerMove,V=>{G.current=V.pointerType,c?v.onItemLeave?.():G.current==="mouse"&&V.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Zr(p.onPointerLeave,V=>{V.currentTarget===document.activeElement&&v.onItemLeave?.()}),onKeyDown:Zr(p.onKeyDown,V=>{v.searchRef?.current!==""&&V.key===" "||(cwe.includes(V.key)&&U(),V.key===" "&&V.preventDefault())})})})})});zY.displayName=wE;var ib="SelectItemText",NY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:c,...h}=e,p=Tf(ib,r),s=Ef(ib,r),v=LY(ib,r),w=fwe(ib,r),[T,I]=Z.useState(null),O=yi(t,U=>I(U),v.onItemTextChange,U=>s.itemTextRefCallback?.(U,v.value,v.disabled)),D=T?.textContent,B=Z.useMemo(()=>P.jsx("option",{value:v.value,disabled:v.disabled,children:D},v.value),[v.disabled,v.value,D]),{onNativeOptionAdd:N,onNativeOptionRemove:G}=w;return xo(()=>(N(B),()=>G(B)),[N,G,B]),P.jsxs(P.Fragment,{children:[P.jsx(fn.span,{id:v.textId,...h,ref:O}),v.isSelected&&p.valueNode&&!p.valueNodeHasChildren?Om.createPortal(h.children,p.valueNode):null]})});NY.displayName=ib;var FY="SelectItemIndicator",BY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return LY(FY,r).isSelected?P.jsx(fn.span,{"aria-hidden":!0,...n,ref:t}):null});BY.displayName=FY;var Qj="SelectScrollUpButton",VY=Z.forwardRef((e,t)=>{const r=Ef(Qj,e.__scopeSelect),n=ez(Qj,e.__scopeSelect),[c,h]=Z.useState(!1),p=yi(t,n.onScrollButtonChange);return xo(()=>{if(r.viewport&&r.isPositioned){let s=function(){const w=v.scrollTop>0;h(w)};const v=r.viewport;return s(),v.addEventListener("scroll",s),()=>v.removeEventListener("scroll",s)}},[r.viewport,r.isPositioned]),c?P.jsx($Y,{...e,ref:p,onAutoScroll:()=>{const{viewport:s,selectedItem:v}=r;s&&v&&(s.scrollTop=s.scrollTop-v.offsetHeight)}}):null});VY.displayName=Qj;var eR="SelectScrollDownButton",UY=Z.forwardRef((e,t)=>{const r=Ef(eR,e.__scopeSelect),n=ez(eR,e.__scopeSelect),[c,h]=Z.useState(!1),p=yi(t,n.onScrollButtonChange);return xo(()=>{if(r.viewport&&r.isPositioned){let s=function(){const w=v.scrollHeight-v.clientHeight,T=Math.ceil(v.scrollTop)<w;h(T)};const v=r.viewport;return s(),v.addEventListener("scroll",s),()=>v.removeEventListener("scroll",s)}},[r.viewport,r.isPositioned]),c?P.jsx($Y,{...e,ref:p,onAutoScroll:()=>{const{viewport:s,selectedItem:v}=r;s&&v&&(s.scrollTop=s.scrollTop+v.offsetHeight)}}):null});UY.displayName=eR;var $Y=Z.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...c}=e,h=Ef("SelectScrollButton",r),p=Z.useRef(null),s=wk(r),v=Z.useCallback(()=>{p.current!==null&&(window.clearInterval(p.current),p.current=null)},[]);return Z.useEffect(()=>()=>v(),[v]),xo(()=>{s().find(w=>w.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[s]),P.jsx(fn.div,{"aria-hidden":!0,...c,ref:t,style:{flexShrink:0,...c.style},onPointerDown:Zr(c.onPointerDown,()=>{p.current===null&&(p.current=window.setInterval(n,50))}),onPointerMove:Zr(c.onPointerMove,()=>{h.onItemLeave?.(),p.current===null&&(p.current=window.setInterval(n,50))}),onPointerLeave:Zr(c.onPointerLeave,()=>{v()})})}),Ewe="SelectSeparator",GY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return P.jsx(fn.div,{"aria-hidden":!0,...n,ref:t})});GY.displayName=Ewe;var tR="SelectArrow",Awe=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,c=Sk(r),h=Tf(tR,r),p=Ef(tR,r);return h.open&&p.position==="popper"?P.jsx(D9,{...c,...n,ref:t}):null});Awe.displayName=tR;var kwe="SelectBubbleInput",HY=Z.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const c=Z.useRef(null),h=yi(n,c),p=eY(t);return Z.useEffect(()=>{const s=c.current;if(!s)return;const v=window.HTMLSelectElement.prototype,w=Object.getOwnPropertyDescriptor(v,"value").set;if(p!==t&&w){const T=new Event("change",{bubbles:!0});w.call(s,t),s.dispatchEvent(T)}},[p,t]),P.jsx(fn.select,{...r,style:{...Aq,...r.style},ref:h,defaultValue:t})});HY.displayName=kwe;function WY(e){return e===""||e===void 0}function qY(e){const t=ro(e),r=Z.useRef(""),n=Z.useRef(0),c=Z.useCallback(p=>{const s=r.current+p;t(s),function v(w){r.current=w,window.clearTimeout(n.current),w!==""&&(n.current=window.setTimeout(()=>v(""),1e3))}(s)},[t]),h=Z.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return Z.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,c,h]}function ZY(e,t,r){const n=t.length>1&&Array.from(t).every(s=>s===t[0])?t[0]:t,c=r?e.indexOf(r):-1;let h=Pwe(e,Math.max(c,0));n.length===1&&(h=h.filter(s=>s!==r));const p=h.find(s=>s.textValue.toLowerCase().startsWith(n.toLowerCase()));return p!==r?p:void 0}function Pwe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var Cwe=bY,KY=SY,Iwe=EY,Mwe=AY,Owe=kY,XY=PY,jwe=OY,YY=DY,JY=zY,Rwe=NY,Dwe=BY,QY=VY,eJ=UY,tJ=GY;const rR=Cwe,nR=Iwe,SE=Z.forwardRef(({className:e,children:t,...r},n)=>P.jsxs(KY,{ref:n,className:ln("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,P.jsx(Mwe,{asChild:!0,children:P.jsx(Zw,{className:"h-4 w-4 opacity-50"})})]}));SE.displayName=KY.displayName;const rJ=Z.forwardRef(({className:e,...t},r)=>P.jsx(QY,{ref:r,className:ln("flex cursor-default items-center justify-center py-1",e),...t,children:P.jsx(HA,{className:"h-4 w-4"})}));rJ.displayName=QY.displayName;const nJ=Z.forwardRef(({className:e,...t},r)=>P.jsx(eJ,{ref:r,className:ln("flex cursor-default items-center justify-center py-1",e),...t,children:P.jsx(Zw,{className:"h-4 w-4"})}));nJ.displayName=eJ.displayName;const TE=Z.forwardRef(({className:e,children:t,position:r="popper",...n},c)=>P.jsx(Owe,{children:P.jsxs(XY,{ref:c,className:ln("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[P.jsx(rJ,{}),P.jsx(jwe,{className:ln("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),P.jsx(nJ,{})]})}));TE.displayName=XY.displayName;const Lwe=Z.forwardRef(({className:e,...t},r)=>P.jsx(YY,{ref:r,className:ln("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));Lwe.displayName=YY.displayName;const fu=Z.forwardRef(({className:e,children:t,...r},n)=>P.jsxs(JY,{ref:n,className:ln("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[P.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:P.jsx(Dwe,{children:P.jsx(Fce,{className:"h-4 w-4"})})}),P.jsx(Rwe,{children:t})]}));fu.displayName=JY.displayName;const zwe=Z.forwardRef(({className:e,...t},r)=>P.jsx(tJ,{ref:r,className:ln("-mx-1 my-1 h-px bg-muted",e),...t}));zwe.displayName=tJ.displayName;var Nwe="Label",iJ=Z.forwardRef((e,t)=>P.jsx(fn.label,{...e,ref:t,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));iJ.displayName=Nwe;var sJ=iJ;const Fwe=Y_("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),iR=Z.forwardRef(({className:e,...t},r)=>P.jsx(sJ,{ref:r,className:ln(Fwe(),e),...t}));iR.displayName=sJ.displayName;const Bwe=({isOpen:e,onClose:t})=>{const[r,n]=Z.useState(!1),[c,h]=Z.useState(0),[p,s]=Z.useState(10),[v,w]=Z.useState(!0),[T,I]=Z.useState([]),[O,D]=Z.useState("checking"),[B,N]=Z.useState(null),[G,U]=Z.useState(!1),{preschools:V}=_s(),{toast:X}=DL(),{stats:Y,isLoading:ne,refresh:ae}=dbe(),le=V.filter(Oe=>Oe.latitud===null||Oe.longitud===null||Oe.latitud===0||Oe.longitud===0),ge=async()=>{U(!0);try{const{data:Oe,error:tt}=await gn.functions.invoke("admin-stats");if(tt)throw tt;Oe&&Oe.database&&N({database:{totalPreschools:Oe.database.totalPreschools,missingCoordinates:Oe.database.missingCoordinates,withGoogleData:Oe.database.withGoogleData,withImages:Oe.database.withImages,coordinatesCoverage:Oe.database.coordinatesCoverage,googleDataCoverage:Oe.database.googleDataCoverage,imagesCoverage:Oe.database.imagesCoverage,userFavorites:Oe.database.userFavorites,searchHistory:Oe.database.searchHistory,googleDataEntries:Oe.database.googleDataEntries,imagesCount:Oe.database.imagesCount},storage:Oe.storage,activity:Oe.activity,systemHealth:{databaseOnline:Oe.systemHealth.databaseOnline,lastUpdated:Oe.systemHealth.lastUpdated}})}catch(Oe){console.error("Failed to load admin stats:",Oe),X({title:"Fel",description:"Kunde inte ladda administrativa statistik via admin-stats funktion",variant:"destructive"});try{const{data:tt,count:We}=await gn.from("Förskolor").select("id",{count:"exact",head:!0}),{count:lt}=await gn.from("Förskolor").select("id",{count:"exact",head:!0}).or("Latitud.is.null,Longitud.is.null,Latitud.eq.0,Longitud.eq.0"),{count:rt}=await gn.from("preschool_google_data").select("id",{count:"exact",head:!0}),{count:ht}=await gn.from("preschool_images").select("id",{count:"exact",head:!0}),vt=We||0,mt=lt||0,ct=rt||0,Ut=ht||0;N({database:{totalPreschools:vt,missingCoordinates:mt,withGoogleData:ct,withImages:Ut,coordinatesCoverage:vt>0?(vt-mt)/vt*100:0,googleDataCoverage:vt>0?ct/vt*100:0,imagesCoverage:vt>0?Ut/vt*100:0},systemHealth:{databaseOnline:!0,lastUpdated:new Date().toISOString()}})}catch(tt){console.error("Fallback stats loading also failed:",tt)}}finally{U(!1)}};hbe({onDataChange:ge,isEnabled:e});const je=async()=>{D("checking");try{const{data:Oe,error:tt}=await gn.from("Förskolor").select("count").limit(1);if(tt)throw tt;D("online")}catch(Oe){console.error("API Status check failed:",Oe),D("offline")}},ze=async()=>{if(!r){n(!0),h(0),I([]);try{const Oe=await gn.functions.invoke("fix-missing-geocoding",{body:{batchSize:p,dryRun:v}});if(Oe.error)throw Oe.error;const tt=Oe.data;I(tt.results||[]),h(100),X({title:v?"Test slutförd":"Geocoding slutförd",description:`Bearbetade ${tt.processed} förskolor. ${tt.success} lyckades, ${tt.errors} misslyckades.`,variant:tt.success>0?"default":"destructive"}),!v&&tt.success>0&&await ge()}catch(Oe){console.error("Geocoding failed:",Oe),X({title:"Geocoding misslyckades",description:Oe.message,variant:"destructive"})}finally{n(!1)}}},Pe=()=>{n(!1),h(0)},Ke=()=>{I([]),h(0)},Ye=async()=>{if(!le.length){X({title:"Inga förskolor att bearbeta",description:"Alla förskolor har redan koordinater"});return}n(!0),I([]);try{const Oe=await gn.functions.invoke("geocoding-service",{body:{preschools:le.slice(0,p).map(We=>({id:We.id,Namn:We.namn,Adress:We.adress,Kommun:We.kommun,Latitud:We.latitud,Longitud:We.longitud}))}});if(Oe.error)throw Oe.error;const tt=Oe.data;I(tt.results||[]),X({title:"Avancerad geocoding slutförd",description:`${tt.successful}/${tt.processed} förskolor geocodade framgångsrikt`,variant:tt.successful>0?"default":"destructive"}),await ge()}catch(Oe){console.error("Advanced geocoding failed:",Oe),X({title:"Avancerad geocoding misslyckades",description:Oe.message,variant:"destructive"})}finally{n(!1)}};return Z.useEffect(()=>{e&&(je(),ge())},[e]),e?P.jsx(Tc,{children:P.jsxs(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 glass-nav",children:[P.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:t}),P.jsx(Fr.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"absolute top-4 left-4 right-4 bottom-4 max-w-6xl mx-auto",children:P.jsxs(kn,{className:"h-full glass-card border-0 shadow-lg",children:[P.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border/20",children:[P.jsxs("div",{className:"flex items-center gap-3",children:[P.jsx(GL,{className:"h-6 w-6 text-primary"}),P.jsx("h2",{className:"text-2xl font-heading font-bold",children:"Admin Panel"}),P.jsx(an,{variant:O==="online"?"default":"destructive",children:O==="online"?"Online":O==="offline"?"Offline":"Kontrollerar..."})]}),P.jsx(Hr,{onClick:t,variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover-scale",children:P.jsx(Qo,{className:"h-4 w-4"})})]}),P.jsx("div",{className:"flex-1 p-6",children:P.jsxs(Z3,{defaultValue:"overview",className:"h-full",children:[P.jsxs(_k,{className:"grid w-full grid-cols-3",children:[P.jsxs(Su,{value:"overview",children:[P.jsx(Ah,{className:"w-4 h-4 mr-2"}),"Översikt"]}),P.jsxs(Su,{value:"geocoding",children:[P.jsx(qa,{className:"w-4 h-4 mr-2"}),"Koordinater"]}),P.jsxs(Su,{value:"system",children:[P.jsx(v6,{className:"w-4 h-4 mr-2"}),"System"]})]}),P.jsx(Tu,{value:"overview",className:"mt-6",children:P.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:G?P.jsxs("div",{className:"col-span-full flex items-center justify-center py-12",children:[P.jsx(Hd,{className:"h-8 w-8 animate-spin text-primary"}),P.jsx("span",{className:"ml-2 font-heading",children:"Laddar statistik..."})]}):B?P.jsxs(P.Fragment,{children:[P.jsxs(kn,{className:"p-6 card-hover",children:[P.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[P.jsx(UL,{className:"h-8 w-8 text-primary"}),P.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Databas"})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Totalt förskolor:"}),P.jsx(an,{variant:"secondary",children:B.database.totalPreschools.toLocaleString()})]}),P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Saknar koordinater:"}),P.jsx(an,{variant:B.database.missingCoordinates>0?"destructive":"default",children:B.database.missingCoordinates.toLocaleString()})]}),P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Koordinattäckning:"}),P.jsxs(an,{variant:"default",children:[B.database.coordinatesCoverage.toFixed(1),"%"]})]})]})]}),P.jsxs(kn,{className:"p-6 card-hover",children:[P.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[P.jsx(ba,{className:"h-8 w-8 text-yellow-500"}),P.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Google Data"})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Med Google data:"}),P.jsx(an,{variant:"secondary",children:B.database.withGoogleData.toLocaleString()})]}),P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Datatäckning:"}),P.jsxs(an,{variant:"default",children:[B.database.googleDataCoverage.toFixed(1),"%"]})]})]})]}),P.jsxs(kn,{className:"p-6 card-hover",children:[P.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[P.jsx(qce,{className:"h-8 w-8 text-green-500"}),P.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Bilder"})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Med bilder:"}),P.jsx(an,{variant:"secondary",children:B.database.withImages.toLocaleString()})]}),P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Bildtäckning:"}),P.jsxs(an,{variant:"default",children:[B.database.imagesCoverage.toFixed(1),"%"]})]}),B.database.imagesCount&&P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Totalt bilder:"}),P.jsx(an,{variant:"outline",children:B.database.imagesCount.toLocaleString()})]})]})]}),B.database.userFavorites!==void 0&&P.jsxs(kn,{className:"p-6 card-hover",children:[P.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[P.jsx(Rm,{className:"h-8 w-8 text-blue-500"}),P.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Användaraktivitet"})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Favoriter:"}),P.jsx(an,{variant:"secondary",children:B.database.userFavorites.toLocaleString()})]}),B.database.searchHistory!==void 0&&P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Sökhistorik:"}),P.jsx(an,{variant:"secondary",children:B.database.searchHistory.toLocaleString()})]})]})]}),B.storage&&P.jsxs(kn,{className:"p-6 card-hover",children:[P.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[P.jsx(Wce,{className:"h-8 w-8 text-purple-500"}),P.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Lagring"})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Total storlek:"}),P.jsx(an,{variant:"secondary",children:B.storage.totalSizeFormatted})]}),P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Buckets:"}),P.jsx(an,{variant:"outline",children:B.storage.buckets.length})]})]})]}),B.activity&&B.activity.recentLogs.length>0&&P.jsxs(kn,{className:"p-6 card-hover col-span-full",children:[P.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[P.jsx(iE,{className:"h-8 w-8 text-orange-500"}),P.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Senaste aktivitet"})]}),P.jsx(Zj,{className:"h-40",children:P.jsx("div",{className:"space-y-2",children:B.activity.recentLogs.slice(0,5).map((Oe,tt)=>P.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-muted/30",children:[P.jsx("span",{className:"text-sm text-muted-foreground truncate",children:Oe.message}),P.jsx(an,{variant:"outline",className:"text-xs",children:new Date(Oe.created_at).toLocaleTimeString()})]},tt))})})]})]}):P.jsx("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"Kunde inte ladda statistik"})})}),P.jsx(Tu,{value:"geocoding",className:"mt-6",children:P.jsxs("div",{className:"space-y-6",children:[P.jsx(kn,{className:"glass-popup",children:P.jsxs("div",{className:"p-6",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-xl font-heading font-semibold",children:"Koordinat-statistik"}),P.jsxs(Hr,{variant:"outline",size:"sm",onClick:ae,disabled:ne,className:"flex items-center gap-2",children:[P.jsx(Hd,{className:`h-4 w-4 ${ne?"animate-spin":""}`}),"Uppdatera"]})]}),ne?P.jsxs("div",{className:"flex items-center justify-center py-8",children:[P.jsx(Hd,{className:"h-6 w-6 animate-spin"}),P.jsx("span",{className:"ml-2",children:"Laddar koordinatstatistik..."})]}):Y?P.jsxs("div",{className:"space-y-4",children:[P.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[P.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[P.jsx("div",{className:"text-2xl font-bold",children:Y.total}),P.jsx("p",{className:"text-xs text-muted-foreground",children:"Totalt förskolor"})]}),P.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[P.jsx("div",{className:"text-2xl font-bold text-green-600",children:Y.withCoordinates}),P.jsx("p",{className:"text-xs text-muted-foreground",children:"Med koordinater"})]}),P.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[P.jsx("div",{className:"text-2xl font-bold text-red-600",children:Y.missingCoordinates}),P.jsx("p",{className:"text-xs text-muted-foreground",children:"Saknar koordinater"})]}),P.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[P.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(Y.withCoordinates/Y.total*100),"%"]}),P.jsx("p",{className:"text-xs text-muted-foreground",children:"Täckning"})]})]}),Object.entries(Y.byKommun).filter(([Oe,tt])=>tt.missing>0).length>0&&P.jsxs("div",{className:"space-y-2",children:[P.jsx("h4",{className:"font-medium",children:"Kommuner med saknade koordinater:"}),P.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Object.entries(Y.byKommun).filter(([Oe,tt])=>tt.missing>0).sort((Oe,tt)=>tt[1].missing-Oe[1].missing).slice(0,10).map(([Oe,tt])=>P.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-background/30 rounded",children:[P.jsx("span",{className:"truncate font-medium",children:Oe}),P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("span",{className:"text-red-600 font-semibold",children:tt.missing}),P.jsxs("span",{className:"text-muted-foreground",children:["av ",tt.total]}),P.jsxs(an,{variant:"outline",children:[tt.percentage,"%"]})]})]},Oe))})]})]}):P.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Kunde inte ladda koordinatstatistik"})]})}),P.jsx(mbe,{missingCoordinatesCount:le.length,onComplete:()=>{ge(),ae(),X({title:"Koordinater uppdaterade",description:"Förskoledata har uppdaterats med nya koordinater."})}}),P.jsx(kn,{className:"glass-popup",children:P.jsxs("div",{className:"p-6",children:[P.jsxs("div",{className:"flex items-center justify-between mb-6",children:[P.jsxs("div",{children:[P.jsx("h3",{className:"text-xl font-heading font-semibold mb-2",children:"Äldre geocoding-verktyg"}),P.jsx("p",{className:"text-muted-foreground",children:"Fallback-verktyg för manuell geocoding-hantering"})]}),P.jsxs(an,{variant:le.length>0?"destructive":"default",children:[le.length," saknar koordinater"]})]}),P.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[P.jsxs("div",{className:"space-y-4",children:[P.jsxs("div",{children:[P.jsx(iR,{htmlFor:"batch-size",className:"font-heading font-medium",children:"Antal per omgång"}),P.jsxs(rR,{value:p.toString(),onValueChange:Oe=>s(Number(Oe)),children:[P.jsx(SE,{children:P.jsx(nR,{})}),P.jsxs(TE,{children:[P.jsx(fu,{value:"5",children:"5 förskolor"}),P.jsx(fu,{value:"10",children:"10 förskolor"}),P.jsx(fu,{value:"20",children:"20 förskolor"}),P.jsx(fu,{value:"50",children:"50 förskolor"})]})]})]}),P.jsxs("div",{className:"flex items-center space-x-2",children:[P.jsx(aY,{id:"dry-run",checked:v,onCheckedChange:w}),P.jsx(iR,{htmlFor:"dry-run",className:"font-heading font-medium",children:"Test-läge (sparar inte)"})]})]}),P.jsxs("div",{className:"space-y-4",children:[P.jsxs("div",{className:"flex gap-2",children:[P.jsx(Hr,{onClick:ze,disabled:r||le.length===0,className:"flex-1 hover-scale",variant:v?"outline":"default",children:r?P.jsxs(P.Fragment,{children:[P.jsx(Hd,{className:"w-4 h-4 mr-2 animate-spin"}),"Kör..."]}):P.jsxs(P.Fragment,{children:[P.jsx(Jq,{className:"w-4 h-4 mr-2"}),v?"Testa":"Kör"," Geocoding"]})}),r&&P.jsx(Hr,{onClick:Pe,variant:"destructive",size:"sm",className:"hover-scale",children:P.jsx(Qq,{className:"w-4 h-4"})})]}),P.jsxs(Hr,{onClick:Ye,disabled:r||le.length===0,variant:"secondary",className:"w-full hover-scale",children:[P.jsx(Zq,{className:"w-4 h-4 mr-2"}),"Avancerad Geocoding"]})]})]}),c>0&&P.jsxs("div",{className:"mb-6",children:[P.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[P.jsx("span",{className:"font-heading font-medium",children:"Framsteg"}),P.jsxs("span",{children:[c.toFixed(0),"%"]})]}),P.jsx(Y3,{value:c,className:"h-2"})]}),T.length>0&&P.jsxs("div",{children:[P.jsxs("div",{className:"flex justify-between items-center mb-4",children:[P.jsxs("h4",{className:"font-heading font-medium",children:["Resultat (",T.length,")"]}),P.jsxs(Hr,{onClick:Ke,variant:"ghost",size:"sm",className:"hover-scale",children:[P.jsx(Qo,{className:"w-4 h-4 mr-1"}),"Rensa"]})]}),P.jsx(Zj,{className:"h-64 rounded-lg border",children:P.jsx("div",{className:"p-4 space-y-2",children:T.map((Oe,tt)=>P.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background/50 hover:bg-background/70 transition-colors",children:[P.jsxs("div",{className:"flex items-center gap-3",children:[Oe.status==="success"?P.jsx(Vce,{className:"w-4 h-4 text-green-500"}):P.jsx(Uce,{className:"w-4 h-4 text-red-500"}),P.jsxs("div",{children:[P.jsx("div",{className:"font-heading font-medium text-sm",children:Oe.name}),Oe.coordinates&&P.jsxs("div",{className:"text-xs text-muted-foreground",children:[Oe.coordinates.lat.toFixed(4),", ",Oe.coordinates.lng.toFixed(4)]}),Oe.error&&P.jsx("div",{className:"text-xs text-red-500",children:Oe.error})]})]}),P.jsx(an,{variant:Oe.status==="success"?"default":"destructive",children:Oe.updated?"Sparad":Oe.status==="success"?"Test":"Fel"})]},tt))})})]})]})})]})}),P.jsx(Tu,{value:"system",className:"mt-6",children:P.jsxs("div",{className:"grid gap-6",children:[P.jsxs(kn,{className:"p-6 card-hover",children:[P.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[P.jsx(iE,{className:"h-6 w-6 text-primary"}),P.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Systemhälsa"})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-muted-foreground",children:"Databas:"}),P.jsx(an,{variant:O==="online"?"default":"destructive",children:O==="online"?"Online":"Offline"})]}),B&&P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-muted-foreground",children:"Senast uppdaterad:"}),P.jsx("span",{className:"text-sm",children:new Date(B.systemHealth.lastUpdated).toLocaleString("sv-SE")})]})]})]}),P.jsxs(kn,{className:"p-6 card-hover",children:[P.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[P.jsx(iue,{className:"h-6 w-6 text-primary"}),P.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Verktyg"})]}),P.jsxs("div",{className:"flex gap-3",children:[P.jsxs(Hr,{onClick:ge,disabled:G,variant:"outline",className:"hover-scale",children:[G?P.jsx(Hd,{className:"w-4 h-4 mr-2 animate-spin"}):P.jsx(Hd,{className:"w-4 h-4 mr-2"}),"Uppdatera statistik"]}),P.jsxs(Hr,{onClick:je,variant:"outline",className:"hover-scale",children:[P.jsx(v6,{className:"w-4 h-4 mr-2"}),"Kontrollera API"]})]})]})]})})]})})]})})]})}):null},Vwe=({className:e})=>{const[t,r]=Z.useState(!1),{preschools:n,filteredPreschools:c,visiblePreschools:h,searchFilters:p,mapZoom:s}=_s(),v=Z.useMemo(()=>{const O=s>8?h:c;if(O.length===0)return null;const D=O.reduce((Y,ne)=>Y+(ne.antal_barn||0),0)/O.length,B=O.filter(Y=>Y.personaltäthet&&Y.personaltäthet>0),N=B.length>0?B.reduce((Y,ne)=>Y+ne.personaltäthet,0)/B.length:0,G=O.filter(Y=>Y.andel_med_förskollärarexamen!=null),U=G.length>0?G.reduce((Y,ne)=>Y+(ne.andel_med_förskollärarexamen||0),0)/G.length:0,V=O.filter(Y=>Y.huvudman==="Kommunal").length,X=O.filter(Y=>Y.huvudman==="Enskild").length;return{total:O.length,avgChildren:Math.round(D),avgStaff:Number(N.toFixed(1)),avgExam:Math.round(U),municipal:V,privatCount:X}},[c,h,s]),w=Z.useMemo(()=>{if(n.length===0)return null;const O=n.reduce((U,V)=>U+(V.antal_barn||0),0)/n.length,D=n.filter(U=>U.personaltäthet&&U.personaltäthet>0),B=D.length>0?D.reduce((U,V)=>U+V.personaltäthet,0)/D.length:0,N=n.filter(U=>U.andel_med_förskollärarexamen!=null),G=N.length>0?N.reduce((U,V)=>U+(V.andel_med_förskollärarexamen||0),0)/N.length:0;return{avgChildren:Math.round(O),avgStaff:Number(B.toFixed(1)),avgExam:Math.round(G)}},[n]),T=(O,D,B=!0)=>{if(Math.abs(O-D)<D*.05)return P.jsx(Yq,{className:"w-3 h-3 text-muted-foreground"});const N=O>D;return(B?N:!N)?P.jsx(jm,{className:"w-3 h-3 text-green-600"}):P.jsx(tue,{className:"w-3 h-3 text-orange-500"})},I=()=>p.kommuner&&p.kommuner.length>0?`${p.kommuner[0]} vs Riket`:s>8?"Synliga vs Riket":"Aktuellt urval vs Riket";return!v||!w?null:P.jsx("div",{className:`fixed bottom-4 right-4 z-60 ${e}`,children:P.jsx(Tc,{mode:"wait",children:t?P.jsx(Fr.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{duration:.3,ease:"easeInOut"},children:P.jsxs(kn,{className:"w-80 p-4 bg-card/95 backdrop-blur-xl border-border/50 shadow-2xl",children:[P.jsxs("div",{className:"flex items-center justify-between mb-3",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(Ah,{className:"w-4 h-4"}),P.jsx("h3",{className:"font-medium text-sm",children:I()})]}),P.jsx(Hr,{onClick:()=>r(!1),variant:"ghost",size:"icon",className:"w-6 h-6 rounded-full",children:P.jsx(Qo,{className:"w-3 h-3"})})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("span",{className:"text-sm text-muted-foreground",children:"Förskolor"}),P.jsx(an,{variant:"outline",className:"text-xs",children:v.total})]}),P.jsxs("div",{className:"space-y-2",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("span",{className:"text-sm",children:"Barn/förskola"}),P.jsxs("div",{className:"flex items-center gap-1",children:[T(v.avgChildren,w.avgChildren),P.jsx("span",{className:"text-sm font-medium",children:v.avgChildren}),P.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",w.avgChildren,")"]})]})]}),P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("span",{className:"text-sm",children:"Personaltäthet"}),P.jsxs("div",{className:"flex items-center gap-1",children:[T(v.avgStaff,w.avgStaff),P.jsx("span",{className:"text-sm font-medium",children:v.avgStaff}),P.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",w.avgStaff,")"]})]})]}),P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("span",{className:"text-sm",children:"Lärarexamen %"}),P.jsxs("div",{className:"flex items-center gap-1",children:[T(v.avgExam,w.avgExam),P.jsxs("span",{className:"text-sm font-medium",children:[v.avgExam,"%"]}),P.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",w.avgExam,"%)"]})]})]})]}),P.jsxs("div",{className:"border-t border-border/50 pt-3",children:[P.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Huvudman"}),P.jsxs("div",{className:"flex justify-between",children:[P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"text-sm font-medium",children:v.municipal}),P.jsx("div",{className:"text-xs text-muted-foreground",children:"Kommunal"})]}),P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"text-sm font-medium",children:v.privatCount}),P.jsx("div",{className:"text-xs text-muted-foreground",children:"Enskild"})]})]})]})]})]})},"popup"):P.jsx(Fr.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2}},"button")})})},Uwe=({className:e})=>{const{layerVisibility:t,heatmapType:r,heatmapIntensity:n,showHeatmap:c,setLayerVisibility:h,setHeatmapType:p,setHeatmapIntensity:s,setShowHeatmap:v}=_s();return P.jsx(Fr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:`absolute top-4 right-4 z-10 ${e}`})},YU="m 145.3125,527.5 0.5,3.75 -0.5,2.75 -1.4375,-1.1875 -2.125,-0.4375 -1.625,2.4375 2.125,3.0625 1.8125,1.25 0.0625,2.25 -1.4375,0.875 -0.6875,1.8125 0.875,1.1875 1.625,-0.625 0,1.5 -0.875,0.8125 -2.25,0.25 2.25,2.6875 0.5625,1.6875 -0.8125,2.75 -0.9375,2.5 -1.75,0.0625 0.3125,2.5 -1.9375,1.5 0.4375,2.25 -0.875,1.8125 0.9375,3 2.125,1 -2.25,3.375 -0.875,2.5 0.125,2.0625 -0.5625,2.5 -0.75,4.1875 0.9375,-0.5625 0.6875,1.1875 -0.8125,0.9375 -1.0625,-0.9375 -1.0625,4.6875 -1.875,0.4375 -1.125,2.25 -0.3125,1.375 0.0625,2.1875 -0.9375,0.375 -0.625,2.125 -1.0625,1.125 -0.9375,3.125 -0.8125,3.6875 -1.0625,4.0625 -1.375,2.875 -1.125,0.75 -1.5625,3.4375 -1.6875,-1.5 -2,1.1875 -1.1875,-0.4375 1.625,-1.5625 0.4375,-1.375 -1.3125,-1.125 -2.5625,0.4375 -0.875,-0.625 -1.6875,0.625 -1,1 -1.1875,-1.3125 -0.625,1.1875 -1.8125,1 -0.5625,-2 -1.0625,0.375 -2.3125,0.375 -1.75,-0.0625 -0.9375,-1.125 -1,1.125 -1.8125,0.0625 -2.625,0.125 -1.9375,0.25",$we=({phase:e,progress:t,markerCount:r})=>{const[n]=Z.useState(()=>{const h=[];for(let p=0;p<120;p++){const s=50+Math.random()*190,v=50+Math.random()*500;let w=s;v<200&&(w=100+Math.random()*90),v>400&&(w=70+Math.random()*150),h.push({id:p,x:w,y:v,size:1.2+Math.random()*.8,delay:Math.random()*.8})}return h}),c=Math.floor(t/100*n.length);return P.jsxs("div",{className:"relative w-32 h-72 mx-auto",children:[P.jsxs("svg",{viewBox:"0 0 290 660",className:"w-full h-full drop-shadow-xl",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.15))"},children:[P.jsx(Fr.path,{d:YU,fill:"none",stroke:"url(#swedenBorderGradient)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"2000",initial:{strokeDashoffset:2e3},animate:{strokeDashoffset:e==="drawing"?2e3-t*20:0},transition:{duration:0,ease:"linear"},style:{willChange:"stroke-dashoffset",transform:"translateZ(0)"},filter:"url(#borderGlow)"}),P.jsx(Fr.path,{d:YU,fill:"url(#swedenFillGradient)",stroke:"none",initial:{opacity:0,scale:.95},animate:{opacity:e==="filling"||e==="markers"||e==="complete"?.2:0,scale:e==="filling"||e==="markers"||e==="complete"?1:.95},transition:{duration:.6,ease:"easeOut"},filter:"url(#innerGlow)"}),e==="markers"&&n.slice(0,c).map(h=>P.jsxs(Fr.g,{style:{willChange:"transform, opacity",transform:"translateZ(0)"},children:[P.jsx(Fr.circle,{cx:h.x,cy:h.y,r:h.size,fill:"hsl(0, 80%, 60%)",initial:{scale:0,opacity:0,y:h.y+8},animate:{scale:1,opacity:.9,y:h.y},transition:{delay:h.delay*.02,duration:.25,type:"spring",stiffness:800,damping:30},style:{willChange:"transform, opacity",transform:"translateZ(0)"},filter:"url(#markerGlow)"}),P.jsx(Fr.circle,{cx:h.x,cy:h.y,r:"0",fill:"none",stroke:"hsl(0, 75%, 65%)",strokeWidth:"1",opacity:"0.6",initial:{r:0,opacity:0},animate:{r:[0,h.size*4,0],opacity:[0,.8,0]},transition:{delay:h.delay*.02+.15,duration:1,ease:"easeOut"},style:{willChange:"transform, opacity",transform:"translateZ(0)"}})]},h.id)),P.jsxs("defs",{children:[P.jsxs("linearGradient",{id:"swedenBorderGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[P.jsx("stop",{offset:"0%",stopColor:"hsl(210, 100%, 50%)"}),P.jsx("stop",{offset:"50%",stopColor:"hsl(220, 90%, 55%)"}),P.jsx("stop",{offset:"100%",stopColor:"hsl(230, 80%, 60%)"})]}),P.jsxs("linearGradient",{id:"swedenFillGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[P.jsx("stop",{offset:"0%",stopColor:"hsl(210, 50%, 75%)"}),P.jsx("stop",{offset:"50%",stopColor:"hsl(220, 40%, 80%)"}),P.jsx("stop",{offset:"100%",stopColor:"hsl(230, 30%, 85%)"})]}),P.jsxs("filter",{id:"borderGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[P.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),P.jsxs("feMerge",{children:[P.jsx("feMergeNode",{in:"coloredBlur"}),P.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),P.jsxs("filter",{id:"markerGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[P.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),P.jsxs("feMerge",{children:[P.jsx("feMergeNode",{in:"coloredBlur"}),P.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),P.jsxs("filter",{id:"innerGlow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[P.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),P.jsxs("feMerge",{children:[P.jsx("feMergeNode",{in:"coloredBlur"}),P.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]})]}),e==="markers"&&P.jsx(Fr.div,{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2 bg-white/95 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg border border-red-100",initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.3,type:"spring",stiffness:400},children:P.jsxs(Fr.span,{className:"text-sm font-bold text-red-600",initial:{opacity:.8,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.15},children:[r.toLocaleString("sv-SE")," förskolor"]},r)})]})},Gwe=({step:e,isActive:t,isCompleted:r,index:n})=>{const c=e.icon;return P.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.08,duration:.5,type:"spring",stiffness:400},className:"text-center relative",children:[P.jsxs(Fr.div,{className:"w-12 h-12 rounded-xl flex items-center justify-center mb-2 mx-auto relative overflow-hidden",style:{backgroundColor:r?e.color:t?`${e.color}15`:"hsl(0, 0%, 96%)",border:t?`2px solid ${e.color}`:"2px solid transparent"},animate:{boxShadow:t?[`0 4px 20px ${e.color}25`,`0 8px 30px ${e.color}35`,`0 4px 20px ${e.color}25`]:"0 2px 8px rgba(0,0,0,0.05)",scale:t?[1,1.05,1]:1},transition:{boxShadow:{duration:2,repeat:1/0},scale:{duration:.6}},children:[P.jsx(Fr.div,{animate:{rotate:t?[0,5,-5,0]:0,scale:r?1.1:1},transition:{rotate:{duration:1,repeat:t?1/0:0},scale:{duration:.3}},children:P.jsx(c,{className:"w-5 h-5",style:{color:r?"white":t?e.color:"hsl(0, 0%, 60%)"}})}),r&&!t&&P.jsx(Fr.div,{className:"absolute top-0 right-0 w-3 h-3 bg-green-500 rounded-full flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:600},children:P.jsx("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:P.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),P.jsx(Fr.p,{className:"text-xs font-medium mb-1",animate:{color:r||t?"hsl(0, 0%, 20%)":"hsl(0, 0%, 60%)"},children:e.label}),P.jsx(Fr.p,{className:"text-xs opacity-70",animate:{opacity:t?1:.5},children:e.detail})]})},Hwe=({onComplete:e})=>{const[t,r]=Z.useState("hidden"),[n,c]=Z.useState(0),[h,p]=Z.useState(0),[s,v]=Z.useState(0),[w,T]=Z.useState(0),[I,O]=Z.useState(!1),[D,B]=Z.useState(!1),{preschools:N}=_s(),G=N.length>0?N.length:8739;Z.useEffect(()=>{const V=X=>{console.error("Animation error:",X),B(!0),setTimeout(e,100)};return window.addEventListener("error",V),()=>window.removeEventListener("error",V)},[e]),Z.useEffect(()=>{const V=setTimeout(()=>{console.warn("Animation taking too long, forcing completion"),e()},8e3);return()=>clearTimeout(V)},[e]);const U=[{label:"Hämtar förskolor",detail:`${G.toLocaleString("sv-SE")} enheter`,icon:am,color:"hsl(0, 80%, 60%)"},{label:"Öppnar data",detail:"Betyg & information",icon:UL,color:"hsl(210, 90%, 55%)"},{label:"Skapar karta",detail:"Interaktiv visning",icon:qa,color:"hsl(85, 60%, 50%)"}];return Z.useEffect(()=>{try{console.log("🚀 Starting loading animation - background data fetching is now active");const V=[{time:0,action:()=>O(!0)},{time:200,action:()=>{r("drawing"),p(0)}},{time:900,action:()=>{r("filling"),p(1)}},{time:1300,action:()=>{r("markers"),p(2)}},{time:2100,action:()=>r("complete")},{time:2200,action:()=>O(!1)},{time:2500,action:()=>{console.log("✅ Loading animation complete - map should display with preloaded data"),e()}}].map(({time:X,action:Y})=>setTimeout(()=>{try{Y()}catch(ne){console.error("Timeline action error:",ne),B(!0),e()}},X));return()=>V.forEach(clearTimeout)}catch(V){console.error("Animation setup error:",V),B(!0),setTimeout(e,100)}},[e]),Z.useEffect(()=>{if(!I)return;const V=Date.now(),X=2e3;let Y;const ne=()=>{const ae=Date.now()-V,le=Math.min(ae/X,1);let ge;le<.8?ge=1-Math.pow(1-le/.8,2.5):ge=.95+(le-.8)/.2*.05;const je=Math.floor(G*ge);T(je),le<1?Y=requestAnimationFrame(ne):T(G)};return Y=requestAnimationFrame(ne),()=>cancelAnimationFrame(Y)},[I,G]),Z.useEffect(()=>{let V,X=Date.now();const Y=()=>{const ne=Date.now()-X;let ae=0,le=0;switch(t){case"drawing":ae=Math.min(ne/700*100,100);break;case"filling":ae=100;break;case"markers":const ge=ne-0,je=Math.min(ge/800,1);let ze;je<.7?ze=1-Math.pow(1-je/.7,3):ze=.99+(je-.7)/.3*.01,ae=ze*100,le=Math.floor(G*ze),v(le);break;default:ae=0}c(ae),(t==="drawing"||t==="markers")&&(V=requestAnimationFrame(Y))};return(t==="drawing"||t==="markers")&&(X=Date.now(),V=requestAnimationFrame(Y)),()=>{V&&cancelAnimationFrame(V)}},[t,G]),P.jsx(Tc,{children:I&&P.jsx(Fr.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95,filter:"blur(8px)"},transition:{duration:.4,ease:[.25,.46,.45,.94]},className:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50/50 to-indigo-50/30",style:{willChange:"transform, opacity",transform:"translateZ(0)",backfaceVisibility:"hidden",perspective:"1000px"},children:P.jsxs("div",{className:"text-center max-w-sm mx-auto px-6",children:[P.jsx($we,{phase:t,progress:n,markerCount:s}),P.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.6},className:"mb-6 mt-6 text-center",children:[P.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent mb-3",children:"Sveriges Förskolor"}),P.jsxs(Fr.div,{className:"mb-3",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.5},children:[P.jsx(Fr.div,{className:"text-4xl font-bold font-mono text-blue-700 mb-1",initial:{opacity:.9,scale:.98},animate:{opacity:1,scale:1},transition:{duration:.1},style:{willChange:"transform, opacity",transform:"translateZ(0)"},children:w.toLocaleString("sv-SE")},w),P.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"förskolor laddade"})]}),P.jsx("p",{className:"text-xs text-gray-500",children:"Interaktiv karta över hela Sverige"})]}),P.jsx("div",{className:"grid grid-cols-3 gap-6 mb-6",children:U.map((V,X)=>P.jsx(Gwe,{step:V,isActive:h===X,isCompleted:h>X,index:X},X))}),P.jsx("div",{className:"w-64 h-1.5 bg-gray-200 rounded-full mx-auto overflow-hidden",children:P.jsx(Fr.div,{className:"h-full bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 rounded-full",initial:{width:0},animate:{width:`${Math.min((h+1)/U.length*100,100)}%`},transition:{duration:.6,ease:"easeOut"}})})]})})})},Wwe=({isMapVisible:e,children:t,onTransitionComplete:r})=>(Z.useEffect(()=>{if(e){const n=setTimeout(()=>{r?.()},1e3);return()=>clearTimeout(n)}},[e,r]),P.jsxs(Fr.div,{initial:{opacity:0,scale:.95},animate:{opacity:e?1:0,scale:e?1:.95},transition:{duration:1,ease:[.25,.46,.45,.94]},className:"relative w-full h-full",children:[t,P.jsx(Fr.div,{initial:{opacity:1},animate:{opacity:e?0:1},transition:{duration:.8,delay:.2},className:"absolute inset-0 bg-gradient-to-br from-background/80 via-background/60 to-background/40 pointer-events-none",style:{backdropFilter:"blur(2px)",background:"linear-gradient(135deg, hsl(var(--background)/0.8) 0%, hsl(var(--background)/0.6) 50%, hsl(var(--background)/0.4) 100%)"}})]})),qwe=({children:e,onClick:t,className:r,variant:n="default",size:c="default",disabled:h=!1})=>P.jsx(Fr.div,{whileHover:{scale:1.02},whileTap:{scale:.98},transition:{type:"spring",stiffness:400,damping:17},children:P.jsx(Hr,{onClick:t,variant:n,size:c,disabled:h,className:ln("transition-all duration-200 hover:shadow-glow",r),children:e})}),Tk=cZ((e,t)=>({selectedPreschools:[],isOpen:!1,addToComparison:r=>{const n=t().selectedPreschools;n.length>=5||n.find(c=>c.id===r.id)||e({selectedPreschools:[...n,r]})},removeFromComparison:r=>{const n=t().selectedPreschools;e({selectedPreschools:n.filter(c=>c.id!==r)})},clearComparison:()=>{e({selectedPreschools:[]})},isInComparison:r=>t().selectedPreschools.some(n=>n.id===r),setIsOpen:r=>{e({isOpen:r})}})),Zwe=()=>{const{selectedPreschools:e,removeFromComparison:t,clearComparison:r,setIsOpen:n}=Tk(),[c,h]=Z.useState(!1);if(e.length===0)return null;const p=T=>{const I=e.map(O=>O[T]).filter(O=>O!=null);return I.length>0?I.reduce((O,D)=>O+D,0)/I.length:0},s=p("antal_barn"),v=p("personaltäthet"),w=p("andel_med_förskollärarexamen");return P.jsx(Tc,{children:P.jsx(Fr.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"fixed bottom-4 right-4 z-50",children:P.jsxs(kn,{className:"bg-card/95 backdrop-blur-lg shadow-nordic border-border/50 p-4 max-w-sm",children:[P.jsxs("div",{className:"flex items-center justify-between mb-3",children:[P.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2",children:[P.jsx(Ah,{className:"w-4 h-4"}),"Jämförelse"]}),P.jsxs("div",{className:"flex items-center gap-1",children:[P.jsx(Hr,{variant:"ghost",size:"sm",onClick:()=>h(!c),className:"h-6 w-6 p-0",children:P.jsx(jm,{className:"h-3 w-3"})}),P.jsx(Hr,{variant:"ghost",size:"sm",onClick:r,className:"h-6 w-6 p-0",children:P.jsx(Qo,{className:"h-3 w-3"})})]})]}),c&&e.length>=2&&P.jsxs(Fr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-3 p-2 bg-muted/30 rounded-md space-y-1",children:[P.jsxs("div",{className:"flex items-center justify-between text-xs",children:[P.jsxs("span",{className:"flex items-center gap-1",children:[P.jsx(Rm,{className:"w-3 h-3"}),"Snitt barn:"]}),P.jsx("span",{className:"font-medium",children:s.toFixed(0)})]}),P.jsxs("div",{className:"flex items-center justify-between text-xs",children:[P.jsxs("span",{className:"flex items-center gap-1",children:[P.jsx(ba,{className:"w-3 h-3"}),"Personal:"]}),P.jsx("span",{className:"font-medium",children:v.toFixed(1)})]}),P.jsxs("div",{className:"flex items-center justify-between text-xs",children:[P.jsxs("span",{className:"flex items-center gap-1",children:[P.jsx(BL,{className:"w-3 h-3"}),"Examen:"]}),P.jsxs("span",{className:"font-medium",children:[w.toFixed(0),"%"]})]})]}),P.jsx("div",{className:"space-y-2 mb-4",children:e.map(T=>P.jsxs("div",{className:"flex items-center justify-between bg-muted/50 rounded-md p-2",children:[P.jsxs("div",{className:"flex-1 min-w-0",children:[P.jsx("p",{className:"text-xs font-medium truncate",children:T.namn}),P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("p",{className:"text-xs text-muted-foreground truncate",children:T.kommun}),T.google_rating&&P.jsxs(an,{variant:"outline",className:"text-xs h-4 px-1",children:["★ ",T.google_rating.toFixed(1)]})]})]}),P.jsx(Hr,{variant:"ghost",size:"sm",onClick:()=>t(T.id),className:"h-5 w-5 p-0 ml-2",children:P.jsx(Qo,{className:"h-3 w-3"})})]},T.id))}),P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs(an,{variant:"secondary",className:"text-xs",children:[e.length,"/5"]}),e.length>=2&&P.jsxs(Hr,{onClick:()=>n(!0),size:"sm",className:"text-xs",children:["Jämför ",e.length," förskolor"]})]})]})})})};var Ek="Dialog",[oJ,d7e]=wc(Ek),[Kwe,Ec]=oJ(Ek),aJ=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:c,onOpenChange:h,modal:p=!0}=e,s=Z.useRef(null),v=Z.useRef(null),[w,T]=ym({prop:n,defaultProp:c??!1,onChange:h,caller:Ek});return P.jsx(Kwe,{scope:t,triggerRef:s,contentRef:v,contentId:hf(),titleId:hf(),descriptionId:hf(),open:w,onOpenChange:T,onOpenToggle:Z.useCallback(()=>T(I=>!I),[T]),modal:p,children:r})};aJ.displayName=Ek;var lJ="DialogTrigger",cJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(lJ,r),h=yi(t,c.triggerRef);return P.jsx(fn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":c.open,"aria-controls":c.contentId,"data-state":nz(c.open),...n,ref:h,onClick:Zr(e.onClick,c.onOpenToggle)})});cJ.displayName=lJ;var tz="DialogPortal",[Xwe,uJ]=oJ(tz,{forceMount:void 0}),hJ=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:c}=e,h=Ec(tz,t);return P.jsx(Xwe,{scope:t,forceMount:r,children:Z.Children.map(n,p=>P.jsx(Sc,{present:r||h.open,children:P.jsx(UA,{asChild:!0,container:c,children:p})}))})};hJ.displayName=tz;var EE="DialogOverlay",dJ=Z.forwardRef((e,t)=>{const r=uJ(EE,e.__scopeDialog),{forceMount:n=r.forceMount,...c}=e,h=Ec(EE,e.__scopeDialog);return h.modal?P.jsx(Sc,{present:n||h.open,children:P.jsx(Jwe,{...c,ref:t})}):null});dJ.displayName=EE;var Ywe=g_("DialogOverlay.RemoveScroll"),Jwe=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(EE,r);return P.jsx(Q3,{as:Ywe,allowPinchZoom:!0,shards:[c.contentRef],children:P.jsx(fn.div,{"data-state":nz(c.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),wm="DialogContent",fJ=Z.forwardRef((e,t)=>{const r=uJ(wm,e.__scopeDialog),{forceMount:n=r.forceMount,...c}=e,h=Ec(wm,e.__scopeDialog);return P.jsx(Sc,{present:n||h.open,children:h.modal?P.jsx(Qwe,{...c,ref:t}):P.jsx(e1e,{...c,ref:t})})});fJ.displayName=wm;var Qwe=Z.forwardRef((e,t)=>{const r=Ec(wm,e.__scopeDialog),n=Z.useRef(null),c=yi(t,r.contentRef,n);return Z.useEffect(()=>{const h=n.current;if(h)return fY(h)},[]),P.jsx(pJ,{...e,ref:c,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Zr(e.onCloseAutoFocus,h=>{h.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:Zr(e.onPointerDownOutside,h=>{const p=h.detail.originalEvent,s=p.button===0&&p.ctrlKey===!0;(p.button===2||s)&&h.preventDefault()}),onFocusOutside:Zr(e.onFocusOutside,h=>h.preventDefault())})}),e1e=Z.forwardRef((e,t)=>{const r=Ec(wm,e.__scopeDialog),n=Z.useRef(!1),c=Z.useRef(!1);return P.jsx(pJ,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:h=>{e.onCloseAutoFocus?.(h),h.defaultPrevented||(n.current||r.triggerRef.current?.focus(),h.preventDefault()),n.current=!1,c.current=!1},onInteractOutside:h=>{e.onInteractOutside?.(h),h.defaultPrevented||(n.current=!0,h.detail.originalEvent.type==="pointerdown"&&(c.current=!0));const p=h.target;r.triggerRef.current?.contains(p)&&h.preventDefault(),h.detail.originalEvent.type==="focusin"&&c.current&&h.preventDefault()}})}),pJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:c,onCloseAutoFocus:h,...p}=e,s=Ec(wm,r),v=Z.useRef(null),w=yi(t,v);return uY(),P.jsxs(P.Fragment,{children:[P.jsx(J3,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:c,onUnmountAutoFocus:h,children:P.jsx(Ww,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":nz(s.open),...p,ref:w,onDismiss:()=>s.onOpenChange(!1)})}),P.jsxs(P.Fragment,{children:[P.jsx(t1e,{titleId:s.titleId}),P.jsx(n1e,{contentRef:v,descriptionId:s.descriptionId})]})]})}),rz="DialogTitle",mJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(rz,r);return P.jsx(fn.h2,{id:c.titleId,...n,ref:t})});mJ.displayName=rz;var gJ="DialogDescription",yJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(gJ,r);return P.jsx(fn.p,{id:c.descriptionId,...n,ref:t})});yJ.displayName=gJ;var _J="DialogClose",vJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(_J,r);return P.jsx(fn.button,{type:"button",...n,ref:t,onClick:Zr(e.onClick,()=>c.onOpenChange(!1))})});vJ.displayName=_J;function nz(e){return e?"open":"closed"}var xJ="DialogTitleWarning",[f7e,bJ]=Ble(xJ,{contentName:wm,titleName:rz,docsSlug:"dialog"}),t1e=({titleId:e})=>{const t=bJ(xJ),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return Z.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},r1e="DialogDescriptionWarning",n1e=({contentRef:e,descriptionId:t})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${bJ(r1e).contentName}}.`;return Z.useEffect(()=>{const n=e.current?.getAttribute("aria-describedby");t&&n&&(document.getElementById(t)||console.warn(r))},[r,e,t]),null},wJ=aJ,i1e=cJ,SJ=hJ,Ak=dJ,kk=fJ,Pk=mJ,Ck=yJ,TJ=vJ;const s1e=wJ,o1e=SJ,EJ=Z.forwardRef(({className:e,...t},r)=>P.jsx(Ak,{ref:r,className:ln("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));EJ.displayName=Ak.displayName;const AJ=Z.forwardRef(({className:e,children:t,...r},n)=>P.jsxs(o1e,{children:[P.jsx(EJ,{}),P.jsxs(kk,{ref:n,className:ln("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,P.jsxs(TJ,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[P.jsx(Qo,{className:"h-4 w-4"}),P.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));AJ.displayName=kk.displayName;const kJ=({className:e,...t})=>P.jsx("div",{className:ln("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});kJ.displayName="DialogHeader";const PJ=Z.forwardRef(({className:e,...t},r)=>P.jsx(Pk,{ref:r,className:ln("text-lg font-semibold leading-none tracking-tight",e),...t}));PJ.displayName=Pk.displayName;const a1e=Z.forwardRef(({className:e,...t},r)=>P.jsx(Ck,{ref:r,className:ln("text-sm text-muted-foreground",e),...t}));a1e.displayName=Ck.displayName;const l1e=()=>{const{selectedPreschools:e,isOpen:t,setIsOpen:r,clearComparison:n}=Tk(),c=(v,w,T=!0)=>{const I=Math.min(...w.filter(N=>N>0)),O=Math.max(...w.filter(N=>N>0));if(I===O)return"bg-muted";const D=(v-I)/(O-I),B=T?D:1-D;return B>=.7?"bg-green-500":B>=.4?"bg-yellow-500":"bg-red-500"};if(!t||e.length<2)return null;const h=e.map(v=>v.google_rating||0),p=e.map(v=>v.personaltäthet||0),s=e.map(v=>v.andel_med_förskollärarexamen||0);return e.map(v=>v.antal_barn||0),P.jsx(s1e,{open:t,onOpenChange:r,children:P.jsxs(AJ,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[P.jsx(kJ,{children:P.jsxs(PJ,{className:"flex items-center gap-2",children:[P.jsx(Ah,{className:"w-5 h-5"}),"Jämför ",e.length," förskolor"]})}),P.jsxs("div",{className:"space-y-6",children:[P.jsx("div",{className:"overflow-x-auto",children:P.jsxs("table",{className:"w-full border-collapse",children:[P.jsx("thead",{children:P.jsxs("tr",{className:"border-b",children:[P.jsx("th",{className:"text-left p-3 font-semibold",children:"Förskola"}),P.jsx("th",{className:"text-left p-3 font-semibold",children:"Huvudman"}),P.jsx("th",{className:"text-left p-3 font-semibold",children:"Kommun"}),P.jsx("th",{className:"text-left p-3 font-semibold",children:"Barn"})]})}),P.jsx("tbody",{children:e.map(v=>P.jsxs("tr",{className:"border-b",children:[P.jsx("td",{className:"p-3 font-medium",children:v.namn}),P.jsx("td",{className:"p-3",children:P.jsx(an,{variant:"secondary",children:v.huvudman})}),P.jsx("td",{className:"p-3 text-muted-foreground",children:v.kommun}),P.jsx("td",{className:"p-3",children:v.antal_barn||"N/A"})]},v.id))})]})}),P.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[P.jsxs(kn,{className:"p-4",children:[P.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[P.jsx(ba,{className:"w-4 h-4 text-yellow-500"}),"Google betyg"]}),P.jsx("div",{className:"space-y-3",children:e.map(v=>P.jsxs("div",{className:"space-y-1",children:[P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-sm font-medium truncate pr-2",children:v.namn}),P.jsx("span",{className:"text-sm font-bold",children:v.google_rating?.toFixed(1)||"N/A"})]}),v.google_rating&&P.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:P.jsx("div",{className:`h-2 rounded-full ${c(v.google_rating,h)}`,style:{width:`${v.google_rating/5*100}%`}})})]},v.id))})]}),P.jsxs(kn,{className:"p-4",children:[P.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[P.jsx(Rm,{className:"w-4 h-4 text-blue-500"}),"Personaltäthet"]}),P.jsx("div",{className:"space-y-3",children:e.map(v=>P.jsxs("div",{className:"space-y-1",children:[P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-sm font-medium truncate pr-2",children:v.namn}),P.jsx("span",{className:"text-sm font-bold",children:v.personaltäthet?.toFixed(1)||"N/A"})]}),v.personaltäthet&&P.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:P.jsx("div",{className:`h-2 rounded-full ${c(v.personaltäthet,p)}`,style:{width:`${Math.min(v.personaltäthet/Math.max(...p)*100,100)}%`}})})]},v.id))})]}),P.jsxs(kn,{className:"p-4",children:[P.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[P.jsx(Kq,{className:"w-4 h-4 text-green-500"}),"Lärarexamen %"]}),P.jsx("div",{className:"space-y-3",children:e.map(v=>P.jsxs("div",{className:"space-y-1",children:[P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-sm font-medium truncate pr-2",children:v.namn}),P.jsxs("span",{className:"text-sm font-bold",children:[v.andel_med_förskollärarexamen?.toFixed(0),"% || 'N/A'"]})]}),v.andel_med_förskollärarexamen&&P.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:P.jsx("div",{className:`h-2 rounded-full ${c(v.andel_med_förskollärarexamen,s)}`,style:{width:`${v.andel_med_förskollärarexamen}%`}})})]},v.id))})]})]}),P.jsxs("div",{className:"flex justify-between",children:[P.jsx(Hr,{onClick:n,variant:"outline",children:"Rensa jämförelse"}),P.jsx(Hr,{onClick:()=>r(!1),variant:"default",children:"Stäng"})]})]})]})})},c1e=wJ,u1e=i1e,h1e=SJ,CJ=Z.forwardRef(({className:e,...t},r)=>P.jsx(Ak,{className:ln("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));CJ.displayName=Ak.displayName;const d1e=Y_("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),IJ=Z.forwardRef(({side:e="right",className:t,children:r,...n},c)=>P.jsxs(h1e,{children:[P.jsx(CJ,{}),P.jsxs(kk,{ref:c,className:ln(d1e({side:e}),t),...n,children:[r,P.jsxs(TJ,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[P.jsx(Qo,{className:"h-4 w-4"}),P.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));IJ.displayName=kk.displayName;const f1e=Z.forwardRef(({className:e,...t},r)=>P.jsx(Pk,{ref:r,className:ln("text-lg font-semibold text-foreground",e),...t}));f1e.displayName=Pk.displayName;const p1e=Z.forwardRef(({className:e,...t},r)=>P.jsx(Ck,{ref:r,className:ln("text-sm text-muted-foreground",e),...t}));p1e.displayName=Ck.displayName;const m1e=()=>{const{filteredPreschools:e}=_s(),{selectedPreschools:t,setIsOpen:r}=Tk(),n=[{icon:tb,label:"Sök",action:()=>{const c=document.querySelector("[data-search-trigger]");c&&c.click()}},{icon:Kce,label:"Karta",action:()=>{window.scrollTo({top:0,behavior:"smooth"})}},{icon:Ah,label:"Statistik",action:()=>{const c=document.querySelector('[data-testid="statistics-button"]');c&&c.click()},badge:e.length},{icon:Xq,label:"Jämför",action:()=>{t.length>0&&r(!0)},badge:t.length}];return P.jsxs(P.Fragment,{children:[P.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-card border-t border-border md:hidden",children:P.jsx("div",{className:"grid grid-cols-4 gap-1 p-2",children:n.map(c=>P.jsxs(Hr,{variant:"ghost",size:"sm",onClick:c.action,className:"flex flex-col items-center gap-1 h-auto p-2 relative",children:[P.jsx(c.icon,{className:"h-5 w-5"}),P.jsx("span",{className:"text-xs",children:c.label}),c.badge!==void 0&&c.badge>0&&P.jsx(an,{variant:"secondary",className:"absolute -top-1 -right-1 h-5 w-5 p-0 text-xs flex items-center justify-center",children:c.badge>99?"99+":c.badge})]},c.label))})}),P.jsx("div",{className:"fixed top-0 left-0 right-0 z-40 bg-card/95 backdrop-blur border-b border-border md:hidden",children:P.jsxs("div",{className:"flex items-center justify-between p-4",children:[P.jsx("h1",{className:"text-lg font-bold",children:"Sveriges Förskolor"}),P.jsxs(c1e,{children:[P.jsx(u1e,{asChild:!0,children:P.jsx(Hr,{variant:"ghost",size:"sm",children:P.jsx(Xce,{className:"h-5 w-5"})})}),P.jsx(IJ,{side:"right",className:"w-80",children:P.jsxs("div",{className:"space-y-4 mt-8",children:[P.jsxs("div",{className:"space-y-2",children:[P.jsx("h3",{className:"font-semibold",children:"Navigation"}),n.map(c=>P.jsxs(Hr,{variant:"ghost",onClick:c.action,className:"w-full justify-start",children:[P.jsx(c.icon,{className:"h-4 w-4 mr-2"}),c.label,c.badge!==void 0&&c.badge>0&&P.jsx(an,{variant:"secondary",className:"ml-auto",children:c.badge})]},c.label))]}),P.jsxs("div",{className:"space-y-2",children:[P.jsx("h3",{className:"font-semibold",children:"Information"}),P.jsxs(Hr,{variant:"ghost",className:"w-full justify-start",children:[P.jsx(Zce,{className:"h-4 w-4 mr-2"}),"Om tjänsten"]}),P.jsxs(Hr,{variant:"ghost",className:"w-full justify-start",children:[P.jsx(GL,{className:"h-4 w-4 mr-2"}),"Inställningar"]})]})]})})]})]})})]})};var g1e=Array.isArray,Ka=g1e,y1e=typeof zo=="object"&&zo&&zo.Object===Object&&zo,MJ=y1e,_1e=MJ,v1e=typeof self=="object"&&self&&self.Object===Object&&self,x1e=_1e||v1e||Function("return this")(),Mu=x1e,b1e=Mu,w1e=b1e.Symbol,i1=w1e,JU=i1,OJ=Object.prototype,S1e=OJ.hasOwnProperty,T1e=OJ.toString,Vx=JU?JU.toStringTag:void 0;function E1e(e){var t=S1e.call(e,Vx),r=e[Vx];try{e[Vx]=void 0;var n=!0}catch{}var c=T1e.call(e);return n&&(t?e[Vx]=r:delete e[Vx]),c}var A1e=E1e,k1e=Object.prototype,P1e=k1e.toString;function C1e(e){return P1e.call(e)}var I1e=C1e,QU=i1,M1e=A1e,O1e=I1e,j1e="[object Null]",R1e="[object Undefined]",e8=QU?QU.toStringTag:void 0;function D1e(e){return e==null?e===void 0?R1e:j1e:e8&&e8 in Object(e)?M1e(e):O1e(e)}var Fh=D1e;function L1e(e){return e!=null&&typeof e=="object"}var Bh=L1e,z1e=Fh,N1e=Bh,F1e="[object Symbol]";function B1e(e){return typeof e=="symbol"||N1e(e)&&z1e(e)==F1e}var lv=B1e,V1e=Ka,U1e=lv,$1e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,G1e=/^\w*$/;function H1e(e,t){if(V1e(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||U1e(e)?!0:G1e.test(e)||!$1e.test(e)||t!=null&&e in Object(t)}var iz=H1e;function W1e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Af=W1e;const cv=ki(Af);var q1e=Fh,Z1e=Af,K1e="[object AsyncFunction]",X1e="[object Function]",Y1e="[object GeneratorFunction]",J1e="[object Proxy]";function Q1e(e){if(!Z1e(e))return!1;var t=q1e(e);return t==X1e||t==Y1e||t==K1e||t==J1e}var sz=Q1e;const Cn=ki(sz);var eSe=Mu,tSe=eSe["__core-js_shared__"],rSe=tSe,PM=rSe,t8=function(){var e=/[^.]+$/.exec(PM&&PM.keys&&PM.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function nSe(e){return!!t8&&t8 in e}var iSe=nSe,sSe=Function.prototype,oSe=sSe.toString;function aSe(e){if(e!=null){try{return oSe.call(e)}catch{}try{return e+""}catch{}}return""}var jJ=aSe,lSe=sz,cSe=iSe,uSe=Af,hSe=jJ,dSe=/[\\^$.*+?()[\]{}|]/g,fSe=/^\[object .+?Constructor\]$/,pSe=Function.prototype,mSe=Object.prototype,gSe=pSe.toString,ySe=mSe.hasOwnProperty,_Se=RegExp("^"+gSe.call(ySe).replace(dSe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function vSe(e){if(!uSe(e)||cSe(e))return!1;var t=lSe(e)?_Se:fSe;return t.test(hSe(e))}var xSe=vSe;function bSe(e,t){return e?.[t]}var wSe=bSe,SSe=xSe,TSe=wSe;function ESe(e,t){var r=TSe(e,t);return SSe(r)?r:void 0}var Lm=ESe,ASe=Lm,kSe=ASe(Object,"create"),Ik=kSe,r8=Ik;function PSe(){this.__data__=r8?r8(null):{},this.size=0}var CSe=PSe;function ISe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var MSe=ISe,OSe=Ik,jSe="__lodash_hash_undefined__",RSe=Object.prototype,DSe=RSe.hasOwnProperty;function LSe(e){var t=this.__data__;if(OSe){var r=t[e];return r===jSe?void 0:r}return DSe.call(t,e)?t[e]:void 0}var zSe=LSe,NSe=Ik,FSe=Object.prototype,BSe=FSe.hasOwnProperty;function VSe(e){var t=this.__data__;return NSe?t[e]!==void 0:BSe.call(t,e)}var USe=VSe,$Se=Ik,GSe="__lodash_hash_undefined__";function HSe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=$Se&&t===void 0?GSe:t,this}var WSe=HSe,qSe=CSe,ZSe=MSe,KSe=zSe,XSe=USe,YSe=WSe;function uv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}uv.prototype.clear=qSe;uv.prototype.delete=ZSe;uv.prototype.get=KSe;uv.prototype.has=XSe;uv.prototype.set=YSe;var JSe=uv;function QSe(){this.__data__=[],this.size=0}var eTe=QSe;function tTe(e,t){return e===t||e!==e&&t!==t}var oz=tTe,rTe=oz;function nTe(e,t){for(var r=e.length;r--;)if(rTe(e[r][0],t))return r;return-1}var Mk=nTe,iTe=Mk,sTe=Array.prototype,oTe=sTe.splice;function aTe(e){var t=this.__data__,r=iTe(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():oTe.call(t,r,1),--this.size,!0}var lTe=aTe,cTe=Mk;function uTe(e){var t=this.__data__,r=cTe(t,e);return r<0?void 0:t[r][1]}var hTe=uTe,dTe=Mk;function fTe(e){return dTe(this.__data__,e)>-1}var pTe=fTe,mTe=Mk;function gTe(e,t){var r=this.__data__,n=mTe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var yTe=gTe,_Te=eTe,vTe=lTe,xTe=hTe,bTe=pTe,wTe=yTe;function hv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}hv.prototype.clear=_Te;hv.prototype.delete=vTe;hv.prototype.get=xTe;hv.prototype.has=bTe;hv.prototype.set=wTe;var Ok=hv,STe=Lm,TTe=Mu,ETe=STe(TTe,"Map"),az=ETe,n8=JSe,ATe=Ok,kTe=az;function PTe(){this.size=0,this.__data__={hash:new n8,map:new(kTe||ATe),string:new n8}}var CTe=PTe;function ITe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var MTe=ITe,OTe=MTe;function jTe(e,t){var r=e.__data__;return OTe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var jk=jTe,RTe=jk;function DTe(e){var t=RTe(this,e).delete(e);return this.size-=t?1:0,t}var LTe=DTe,zTe=jk;function NTe(e){return zTe(this,e).get(e)}var FTe=NTe,BTe=jk;function VTe(e){return BTe(this,e).has(e)}var UTe=VTe,$Te=jk;function GTe(e,t){var r=$Te(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var HTe=GTe,WTe=CTe,qTe=LTe,ZTe=FTe,KTe=UTe,XTe=HTe;function dv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}dv.prototype.clear=WTe;dv.prototype.delete=qTe;dv.prototype.get=ZTe;dv.prototype.has=KTe;dv.prototype.set=XTe;var lz=dv,RJ=lz,YTe="Expected a function";function cz(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(YTe);var r=function(){var n=arguments,c=t?t.apply(this,n):n[0],h=r.cache;if(h.has(c))return h.get(c);var p=e.apply(this,n);return r.cache=h.set(c,p)||h,p};return r.cache=new(cz.Cache||RJ),r}cz.Cache=RJ;var DJ=cz;const JTe=ki(DJ);var QTe=DJ,e2e=500;function t2e(e){var t=QTe(e,function(n){return r.size===e2e&&r.clear(),n}),r=t.cache;return t}var r2e=t2e,n2e=r2e,i2e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s2e=/\\(\\)?/g,o2e=n2e(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(i2e,function(r,n,c,h){t.push(c?h.replace(s2e,"$1"):n||r)}),t}),a2e=o2e;function l2e(e,t){for(var r=-1,n=e==null?0:e.length,c=Array(n);++r<n;)c[r]=t(e[r],r,e);return c}var uz=l2e,i8=i1,c2e=uz,u2e=Ka,h2e=lv,s8=i8?i8.prototype:void 0,o8=s8?s8.toString:void 0;function LJ(e){if(typeof e=="string")return e;if(u2e(e))return c2e(e,LJ)+"";if(h2e(e))return o8?o8.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var d2e=LJ,f2e=d2e;function p2e(e){return e==null?"":f2e(e)}var zJ=p2e,m2e=Ka,g2e=iz,y2e=a2e,_2e=zJ;function v2e(e,t){return m2e(e)?e:g2e(e,t)?[e]:y2e(_2e(e))}var NJ=v2e,x2e=lv;function b2e(e){if(typeof e=="string"||x2e(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var Rk=b2e,w2e=NJ,S2e=Rk;function T2e(e,t){t=w2e(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[S2e(t[r++])];return r&&r==n?e:void 0}var hz=T2e,E2e=hz;function A2e(e,t,r){var n=e==null?void 0:E2e(e,t);return n===void 0?r:n}var FJ=A2e;const fl=ki(FJ);function k2e(e){return e==null}var P2e=k2e;const ni=ki(P2e);var C2e=Fh,I2e=Ka,M2e=Bh,O2e="[object String]";function j2e(e){return typeof e=="string"||!I2e(e)&&M2e(e)&&C2e(e)==O2e}var R2e=j2e;const Sm=ki(R2e);var BJ={exports:{}},Ni={};/**
* @license React
* react-is.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var dz=Symbol.for("react.element"),fz=Symbol.for("react.portal"),Dk=Symbol.for("react.fragment"),Lk=Symbol.for("react.strict_mode"),zk=Symbol.for("react.profiler"),Nk=Symbol.for("react.provider"),Fk=Symbol.for("react.context"),D2e=Symbol.for("react.server_context"),Bk=Symbol.for("react.forward_ref"),Vk=Symbol.for("react.suspense"),Uk=Symbol.for("react.suspense_list"),$k=Symbol.for("react.memo"),Gk=Symbol.for("react.lazy"),L2e=Symbol.for("react.offscreen"),VJ;VJ=Symbol.for("react.module.reference");function Vl(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case dz:switch(e=e.type,e){case Dk:case zk:case Lk:case Vk:case Uk:return e;default:switch(e=e&&e.$$typeof,e){case D2e:case Fk:case Bk:case Gk:case $k:case Nk:return e;default:return t}}case fz:return t}}}Ni.ContextConsumer=Fk;Ni.ContextProvider=Nk;Ni.Element=dz;Ni.ForwardRef=Bk;Ni.Fragment=Dk;Ni.Lazy=Gk;Ni.Memo=$k;Ni.Portal=fz;Ni.Profiler=zk;Ni.StrictMode=Lk;Ni.Suspense=Vk;Ni.SuspenseList=Uk;Ni.isAsyncMode=function(){return!1};Ni.isConcurrentMode=function(){return!1};Ni.isContextConsumer=function(e){return Vl(e)===Fk};Ni.isContextProvider=function(e){return Vl(e)===Nk};Ni.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===dz};Ni.isForwardRef=function(e){return Vl(e)===Bk};Ni.isFragment=function(e){return Vl(e)===Dk};Ni.isLazy=function(e){return Vl(e)===Gk};Ni.isMemo=function(e){return Vl(e)===$k};Ni.isPortal=function(e){return Vl(e)===fz};Ni.isProfiler=function(e){return Vl(e)===zk};Ni.isStrictMode=function(e){return Vl(e)===Lk};Ni.isSuspense=function(e){return Vl(e)===Vk};Ni.isSuspenseList=function(e){return Vl(e)===Uk};Ni.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Dk||e===zk||e===Lk||e===Vk||e===Uk||e===L2e||typeof e=="object"&&e!==null&&(e.$$typeof===Gk||e.$$typeof===$k||e.$$typeof===Nk||e.$$typeof===Fk||e.$$typeof===Bk||e.$$typeof===VJ||e.getModuleId!==void 0)};Ni.typeOf=Vl;BJ.exports=Ni;var z2e=BJ.exports,N2e=Fh,F2e=Bh,B2e="[object Number]";function V2e(e){return typeof e=="number"||F2e(e)&&N2e(e)==B2e}var UJ=V2e;const U2e=ki(UJ);var $2e=UJ;function G2e(e){return $2e(e)&&e!=+e}var H2e=G2e;const s1=ki(H2e);var ya=function(e){return e===0?0:e>0?1:-1},tm=function(e){return Sm(e)&&e.indexOf("%")===e.length-1},fr=function(e){return U2e(e)&&!s1(e)},W2e=function(e){return ni(e)},io=function(e){return fr(e)||Sm(e)},q2e=0,o1=function(e){var t=++q2e;return"".concat(e||"").concat(t)},_a=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!fr(e)&&!Sm(e))return r;var c;if(tm(e)){var h=e.indexOf("%");c=t*parseFloat(e.slice(0,h))/100}else c=+e;return s1(c)&&(c=r),n&&c>t&&(c=t),c},Yd=function(e){if(!e)return null;var t=Object.keys(e);return t&&t.length?e[t[0]]:null},Z2e=function(e){if(!Array.isArray(e))return!1;for(var t=e.length,r={},n=0;n<t;n++)if(!r[e[n]])r[e[n]]=!0;else return!0;return!1},Wd=function(e,t){return fr(e)&&fr(t)?function(r){return e+r*(t-e)}:function(){return t}};function sR(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):fl(n,t))===r})}var K2e=function(e,t){return fr(e)&&fr(t)?e-t:Sm(e)&&Sm(t)?e.localeCompare(t):e instanceof Date&&t instanceof Date?e.getTime()-t.getTime():String(e).localeCompare(String(t))};function s_(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function oR(e){"@babel/helpers - typeof";return oR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oR(e)}var X2e=["viewBox","children"],Y2e=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],a8=["points","pathLength"],J2e={svg:X2e,polygon:a8,polyline:a8},pz=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],AE=function(e,t){if(!e||typeof e=="function"||typeof e=="boolean")return null;var r=e;if(Z.isValidElement(e)&&(r=e.props),!cv(r))return null;var n={};return Object.keys(r).forEach(function(c){pz.includes(c)&&(n[c]=t||function(h){return r[c](r,h)})}),n},Q2e=function(e,t,r){return function(n){return e(t,r,n),null}},Tm=function(e,t,r){if(!cv(e)||oR(e)!=="object")return null;var n=null;return Object.keys(e).forEach(function(c){var h=e[c];pz.includes(c)&&typeof h=="function"&&(n||(n={}),n[c]=Q2e(h,t,r))}),n},eEe=["children"],tEe=["children"];function l8(e,t){if(e==null)return{};var r=rEe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function rEe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var c8={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},xh=function(e){return typeof e=="string"?e:e?e.displayName||e.name||"Component":""},u8=null,CM=null,mz=function e(t){if(t===u8&&Array.isArray(CM))return CM;var r=[];return Z.Children.forEach(t,function(n){ni(n)||(z2e.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),CM=r,u8=t,r};function Ll(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(c){return xh(c)}):n=[xh(t)],mz(e).forEach(function(c){var h=fl(c,"type.displayName")||fl(c,"type.name");n.indexOf(h)!==-1&&r.push(c)}),r}function ol(e,t){var r=Ll(e,t);return r&&r[0]}var h8=function(e){if(!e||!e.props)return!1;var t=e.props,r=t.width,n=t.height;return!(!fr(r)||r<=0||!fr(n)||n<=0)},nEe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],iEe=function(e){return e&&e.type&&Sm(e.type)&&nEe.indexOf(e.type)>=0},sEe=function(e,t,r,n){var c,h=(c=J2e?.[n])!==null&&c!==void 0?c:[];return t.startsWith("data-")||!Cn(e)&&(n&&h.includes(t)||Y2e.includes(t))||r&&pz.includes(t)},Sn=function(e,t,r){if(!e||typeof e=="function"||typeof e=="boolean")return null;var n=e;if(Z.isValidElement(e)&&(n=e.props),!cv(n))return null;var c={};return Object.keys(n).forEach(function(h){var p;sEe((p=n)===null||p===void 0?void 0:p[h],h,t,r)&&(c[h]=n[h])}),c},aR=function e(t,r){if(t===r)return!0;var n=Z.Children.count(t);if(n!==Z.Children.count(r))return!1;if(n===0)return!0;if(n===1)return d8(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var c=0;c<n;c++){var h=t[c],p=r[c];if(Array.isArray(h)||Array.isArray(p)){if(!e(h,p))return!1}else if(!d8(h,p))return!1}return!0},d8=function(e,t){if(ni(e)&&ni(t))return!0;if(!ni(e)&&!ni(t)){var r=e.props||{},n=r.children,c=l8(r,eEe),h=t.props||{},p=h.children,s=l8(h,tEe);return n&&p?s_(c,s)&&aR(n,p):!n&&!p?s_(c,s):!1}return!1},f8=function(e,t){var r=[],n={};return mz(e).forEach(function(c,h){if(iEe(c))r.push(c);else if(c){var p=xh(c.type),s=t[p]||{},v=s.handler,w=s.once;if(v&&(!w||!n[p])){var T=v(c,p,h);r.push(T),n[p]=!0}}}),r},oEe=function(e){var t=e&&e.type;return t&&c8[t]?c8[t]:null},aEe=function(e,t){return mz(t).indexOf(e)},lEe=["children","width","height","viewBox","className","style","title","desc"];function lR(){return lR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lR.apply(this,arguments)}function cEe(e,t){if(e==null)return{};var r=uEe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function uEe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function cR(e){var t=e.children,r=e.width,n=e.height,c=e.viewBox,h=e.className,p=e.style,s=e.title,v=e.desc,w=cEe(e,lEe),T=c||{width:r,height:n,x:0,y:0},I=Wn("recharts-surface",h);return Ne.createElement("svg",lR({},Sn(w,!0,"svg"),{className:I,width:r,height:n,style:p,viewBox:"".concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height)}),Ne.createElement("title",null,s),Ne.createElement("desc",null,v),t)}var hEe=["children","className"];function uR(){return uR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uR.apply(this,arguments)}function dEe(e,t){if(e==null)return{};var r=fEe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function fEe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Li=Ne.forwardRef(function(e,t){var r=e.children,n=e.className,c=dEe(e,hEe),h=Wn("recharts-layer",n);return Ne.createElement("g",uR({className:h},Sn(c,!0),{ref:t}),r)}),_c=function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),c=2;c<r;c++)n[c-2]=arguments[c]};function pEe(e,t,r){var n=-1,c=e.length;t<0&&(t=-t>c?0:c+t),r=r>c?c:r,r<0&&(r+=c),c=t>r?0:r-t>>>0,t>>>=0;for(var h=Array(c);++n<c;)h[n]=e[n+t];return h}var mEe=pEe,gEe=mEe;function yEe(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:gEe(e,t,r)}var _Ee=yEe,vEe="\\ud800-\\udfff",xEe="\\u0300-\\u036f",bEe="\\ufe20-\\ufe2f",wEe="\\u20d0-\\u20ff",SEe=xEe+bEe+wEe,TEe="\\ufe0e\\ufe0f",EEe="\\u200d",AEe=RegExp("["+EEe+vEe+SEe+TEe+"]");function kEe(e){return AEe.test(e)}var $J=kEe;function PEe(e){return e.split("")}var CEe=PEe,GJ="\\ud800-\\udfff",IEe="\\u0300-\\u036f",MEe="\\ufe20-\\ufe2f",OEe="\\u20d0-\\u20ff",jEe=IEe+MEe+OEe,REe="\\ufe0e\\ufe0f",DEe="["+GJ+"]",hR="["+jEe+"]",dR="\\ud83c[\\udffb-\\udfff]",LEe="(?:"+hR+"|"+dR+")",HJ="[^"+GJ+"]",WJ="(?:\\ud83c[\\udde6-\\uddff]){2}",qJ="[\\ud800-\\udbff][\\udc00-\\udfff]",zEe="\\u200d",ZJ=LEe+"?",KJ="["+REe+"]?",NEe="(?:"+zEe+"(?:"+[HJ,WJ,qJ].join("|")+")"+KJ+ZJ+")*",FEe=KJ+ZJ+NEe,BEe="(?:"+[HJ+hR+"?",hR,WJ,qJ,DEe].join("|")+")",VEe=RegExp(dR+"(?="+dR+")|"+BEe+FEe,"g");function UEe(e){return e.match(VEe)||[]}var $Ee=UEe,GEe=CEe,HEe=$J,WEe=$Ee;function qEe(e){return HEe(e)?WEe(e):GEe(e)}var ZEe=qEe,KEe=_Ee,XEe=$J,YEe=ZEe,JEe=zJ;function QEe(e){return function(t){t=JEe(t);var r=XEe(t)?YEe(t):void 0,n=r?r[0]:t.charAt(0),c=r?KEe(r,1).join(""):t.slice(1);return n[e]()+c}}var eAe=QEe,tAe=eAe,rAe=tAe("toUpperCase"),nAe=rAe;const Hk=ki(nAe);function os(e){return function(){return e}}const XJ=Math.cos,kE=Math.sin,Ac=Math.sqrt,PE=Math.PI,Wk=2*PE,fR=Math.PI,pR=2*fR,$p=1e-6,iAe=pR-$p;function YJ(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function sAe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return YJ;const r=10**t;return function(n){this._+=n[0];for(let c=1,h=n.length;c<h;++c)this._+=Math.round(arguments[c]*r)/r+n[c]}}class oAe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?YJ:sAe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,c){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+c}`}bezierCurveTo(t,r,n,c,h,p){this._append`C${+t},${+r},${+n},${+c},${this._x1=+h},${this._y1=+p}`}arcTo(t,r,n,c,h){if(t=+t,r=+r,n=+n,c=+c,h=+h,h<0)throw new Error(`negative radius: ${h}`);let p=this._x1,s=this._y1,v=n-t,w=c-r,T=p-t,I=s-r,O=T*T+I*I;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(O>$p)if(!(Math.abs(I*v-w*T)>$p)||!h)this._append`L${this._x1=t},${this._y1=r}`;else{let D=n-p,B=c-s,N=v*v+w*w,G=D*D+B*B,U=Math.sqrt(N),V=Math.sqrt(O),X=h*Math.tan((fR-Math.acos((N+O-G)/(2*U*V)))/2),Y=X/V,ne=X/U;Math.abs(Y-1)>$p&&this._append`L${t+Y*T},${r+Y*I}`,this._append`A${h},${h},0,0,${+(I*D>T*B)},${this._x1=t+ne*v},${this._y1=r+ne*w}`}}arc(t,r,n,c,h,p){if(t=+t,r=+r,n=+n,p=!!p,n<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(c),v=n*Math.sin(c),w=t+s,T=r+v,I=1^p,O=p?c-h:h-c;this._x1===null?this._append`M${w},${T}`:(Math.abs(this._x1-w)>$p||Math.abs(this._y1-T)>$p)&&this._append`L${w},${T}`,n&&(O<0&&(O=O%pR+pR),O>iAe?this._append`A${n},${n},0,1,${I},${t-s},${r-v}A${n},${n},0,1,${I},${this._x1=w},${this._y1=T}`:O>$p&&this._append`A${n},${n},0,${+(O>=fR)},${I},${this._x1=t+n*Math.cos(h)},${this._y1=r+n*Math.sin(h)}`)}rect(t,r,n,c){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+c}h${-n}Z`}toString(){return this._}}function gz(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new oAe(t)}function yz(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function JJ(e){this._context=e}JJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function qk(e){return new JJ(e)}function QJ(e){return e[0]}function eQ(e){return e[1]}function tQ(e,t){var r=os(!0),n=null,c=qk,h=null,p=gz(s);e=typeof e=="function"?e:e===void 0?QJ:os(e),t=typeof t=="function"?t:t===void 0?eQ:os(t);function s(v){var w,T=(v=yz(v)).length,I,O=!1,D;for(n==null&&(h=c(D=p())),w=0;w<=T;++w)!(w<T&&r(I=v[w],w,v))===O&&((O=!O)?h.lineStart():h.lineEnd()),O&&h.point(+e(I,w,v),+t(I,w,v));if(D)return h=null,D+""||null}return s.x=function(v){return arguments.length?(e=typeof v=="function"?v:os(+v),s):e},s.y=function(v){return arguments.length?(t=typeof v=="function"?v:os(+v),s):t},s.defined=function(v){return arguments.length?(r=typeof v=="function"?v:os(!!v),s):r},s.curve=function(v){return arguments.length?(c=v,n!=null&&(h=c(n)),s):c},s.context=function(v){return arguments.length?(v==null?n=h=null:h=c(n=v),s):n},s}function KT(e,t,r){var n=null,c=os(!0),h=null,p=qk,s=null,v=gz(w);e=typeof e=="function"?e:e===void 0?QJ:os(+e),t=typeof t=="function"?t:os(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?eQ:os(+r);function w(I){var O,D,B,N=(I=yz(I)).length,G,U=!1,V,X=new Array(N),Y=new Array(N);for(h==null&&(s=p(V=v())),O=0;O<=N;++O){if(!(O<N&&c(G=I[O],O,I))===U)if(U=!U)D=O,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),B=O-1;B>=D;--B)s.point(X[B],Y[B]);s.lineEnd(),s.areaEnd()}U&&(X[O]=+e(G,O,I),Y[O]=+t(G,O,I),s.point(n?+n(G,O,I):X[O],r?+r(G,O,I):Y[O]))}if(V)return s=null,V+""||null}function T(){return tQ().defined(c).curve(p).context(h)}return w.x=function(I){return arguments.length?(e=typeof I=="function"?I:os(+I),n=null,w):e},w.x0=function(I){return arguments.length?(e=typeof I=="function"?I:os(+I),w):e},w.x1=function(I){return arguments.length?(n=I==null?null:typeof I=="function"?I:os(+I),w):n},w.y=function(I){return arguments.length?(t=typeof I=="function"?I:os(+I),r=null,w):t},w.y0=function(I){return arguments.length?(t=typeof I=="function"?I:os(+I),w):t},w.y1=function(I){return arguments.length?(r=I==null?null:typeof I=="function"?I:os(+I),w):r},w.lineX0=w.lineY0=function(){return T().x(e).y(t)},w.lineY1=function(){return T().x(e).y(r)},w.lineX1=function(){return T().x(n).y(t)},w.defined=function(I){return arguments.length?(c=typeof I=="function"?I:os(!!I),w):c},w.curve=function(I){return arguments.length?(p=I,h!=null&&(s=p(h)),w):p},w.context=function(I){return arguments.length?(I==null?h=s=null:s=p(h=I),w):h},w}class rQ{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function aAe(e){return new rQ(e,!0)}function lAe(e){return new rQ(e,!1)}const _z={draw(e,t){const r=Ac(t/PE);e.moveTo(r,0),e.arc(0,0,r,0,Wk)}},cAe={draw(e,t){const r=Ac(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},nQ=Ac(1/3),uAe=nQ*2,hAe={draw(e,t){const r=Ac(t/uAe),n=r*nQ;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},dAe={draw(e,t){const r=Ac(t),n=-r/2;e.rect(n,n,r,r)}},fAe=.8908130915292852,iQ=kE(PE/10)/kE(7*PE/10),pAe=kE(Wk/10)*iQ,mAe=-XJ(Wk/10)*iQ,gAe={draw(e,t){const r=Ac(t*fAe),n=pAe*r,c=mAe*r;e.moveTo(0,-r),e.lineTo(n,c);for(let h=1;h<5;++h){const p=Wk*h/5,s=XJ(p),v=kE(p);e.lineTo(v*r,-s*r),e.lineTo(s*n-v*c,v*n+s*c)}e.closePath()}},IM=Ac(3),yAe={draw(e,t){const r=-Ac(t/(IM*3));e.moveTo(0,r*2),e.lineTo(-IM*r,-r),e.lineTo(IM*r,-r),e.closePath()}},Tl=-.5,El=Ac(3)/2,mR=1/Ac(12),_Ae=(mR/2+1)*3,vAe={draw(e,t){const r=Ac(t/_Ae),n=r/2,c=r*mR,h=n,p=r*mR+r,s=-h,v=p;e.moveTo(n,c),e.lineTo(h,p),e.lineTo(s,v),e.lineTo(Tl*n-El*c,El*n+Tl*c),e.lineTo(Tl*h-El*p,El*h+Tl*p),e.lineTo(Tl*s-El*v,El*s+Tl*v),e.lineTo(Tl*n+El*c,Tl*c-El*n),e.lineTo(Tl*h+El*p,Tl*p-El*h),e.lineTo(Tl*s+El*v,Tl*v-El*s),e.closePath()}};function xAe(e,t){let r=null,n=gz(c);e=typeof e=="function"?e:os(e||_z),t=typeof t=="function"?t:os(t===void 0?64:+t);function c(){let h;if(r||(r=h=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),h)return r=null,h+""||null}return c.type=function(h){return arguments.length?(e=typeof h=="function"?h:os(h),c):e},c.size=function(h){return arguments.length?(t=typeof h=="function"?h:os(+h),c):t},c.context=function(h){return arguments.length?(r=h??null,c):r},c}function CE(){}function IE(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function sQ(e){this._context=e}sQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:IE(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:IE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function bAe(e){return new sQ(e)}function oQ(e){this._context=e}oQ.prototype={areaStart:CE,areaEnd:CE,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:IE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function wAe(e){return new oQ(e)}function aQ(e){this._context=e}aQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:IE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function SAe(e){return new aQ(e)}function lQ(e){this._context=e}lQ.prototype={areaStart:CE,areaEnd:CE,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function TAe(e){return new lQ(e)}function p8(e){return e<0?-1:1}function m8(e,t,r){var n=e._x1-e._x0,c=t-e._x1,h=(e._y1-e._y0)/(n||c<0&&-0),p=(r-e._y1)/(c||n<0&&-0),s=(h*c+p*n)/(n+c);return(p8(h)+p8(p))*Math.min(Math.abs(h),Math.abs(p),.5*Math.abs(s))||0}function g8(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function MM(e,t,r){var n=e._x0,c=e._y0,h=e._x1,p=e._y1,s=(h-n)/3;e._context.bezierCurveTo(n+s,c+s*t,h-s,p-s*r,h,p)}function ME(e){this._context=e}ME.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:MM(this,this._t0,g8(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,MM(this,g8(this,r=m8(this,e,t)),r);break;default:MM(this,this._t0,r=m8(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function cQ(e){this._context=new uQ(e)}(cQ.prototype=Object.create(ME.prototype)).point=function(e,t){ME.prototype.point.call(this,t,e)};function uQ(e){this._context=e}uQ.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,c,h){this._context.bezierCurveTo(t,e,n,r,h,c)}};function EAe(e){return new ME(e)}function AAe(e){return new cQ(e)}function hQ(e){this._context=e}hQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=y8(e),c=y8(t),h=0,p=1;p<r;++h,++p)this._context.bezierCurveTo(n[0][h],c[0][h],n[1][h],c[1][h],e[p],t[p]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function y8(e){var t,r=e.length-1,n,c=new Array(r),h=new Array(r),p=new Array(r);for(c[0]=0,h[0]=2,p[0]=e[0]+2*e[1],t=1;t<r-1;++t)c[t]=1,h[t]=4,p[t]=4*e[t]+2*e[t+1];for(c[r-1]=2,h[r-1]=7,p[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=c[t]/h[t-1],h[t]-=n,p[t]-=n*p[t-1];for(c[r-1]=p[r-1]/h[r-1],t=r-2;t>=0;--t)c[t]=(p[t]-c[t+1])/h[t];for(h[r-1]=(e[r]+c[r-1])/2,t=0;t<r-1;++t)h[t]=2*e[t+1]-c[t+1];return[c,h]}function kAe(e){return new hQ(e)}function Zk(e,t){this._context=e,this._t=t}Zk.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function PAe(e){return new Zk(e,.5)}function CAe(e){return new Zk(e,0)}function IAe(e){return new Zk(e,1)}function w_(e,t){if((p=e.length)>1)for(var r=1,n,c,h=e[t[0]],p,s=h.length;r<p;++r)for(c=h,h=e[t[r]],n=0;n<s;++n)h[n][1]+=h[n][0]=isNaN(c[n][1])?c[n][0]:c[n][1]}function gR(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function MAe(e,t){return e[t]}function OAe(e){const t=[];return t.key=e,t}function jAe(){var e=os([]),t=gR,r=w_,n=MAe;function c(h){var p=Array.from(e.apply(this,arguments),OAe),s,v=p.length,w=-1,T;for(const I of h)for(s=0,++w;s<v;++s)(p[s][w]=[0,+n(I,p[s].key,w,h)]).data=I;for(s=0,T=yz(t(p));s<v;++s)p[T[s]].index=s;return r(p,T),p}return c.keys=function(h){return arguments.length?(e=typeof h=="function"?h:os(Array.from(h)),c):e},c.value=function(h){return arguments.length?(n=typeof h=="function"?h:os(+h),c):n},c.order=function(h){return arguments.length?(t=h==null?gR:typeof h=="function"?h:os(Array.from(h)),c):t},c.offset=function(h){return arguments.length?(r=h??w_,c):r},c}function RAe(e,t){if((n=e.length)>0){for(var r,n,c=0,h=e[0].length,p;c<h;++c){for(p=r=0;r<n;++r)p+=e[r][c][1]||0;if(p)for(r=0;r<n;++r)e[r][c][1]/=p}w_(e,t)}}function DAe(e,t){if((c=e.length)>0){for(var r=0,n=e[t[0]],c,h=n.length;r<h;++r){for(var p=0,s=0;p<c;++p)s+=e[p][r][1]||0;n[r][1]+=n[r][0]=-s/2}w_(e,t)}}function LAe(e,t){if(!(!((p=e.length)>0)||!((h=(c=e[t[0]]).length)>0))){for(var r=0,n=1,c,h,p;n<h;++n){for(var s=0,v=0,w=0;s<p;++s){for(var T=e[t[s]],I=T[n][1]||0,O=T[n-1][1]||0,D=(I-O)/2,B=0;B<s;++B){var N=e[t[B]],G=N[n][1]||0,U=N[n-1][1]||0;D+=G-U}v+=I,w+=D*I}c[n-1][1]+=c[n-1][0]=r,v&&(r-=w/v)}c[n-1][1]+=c[n-1][0]=r,w_(e,t)}}function ow(e){"@babel/helpers - typeof";return ow=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ow(e)}var zAe=["type","size","sizeType"];function yR(){return yR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yR.apply(this,arguments)}function _8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function v8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_8(Object(r),!0).forEach(function(n){NAe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NAe(e,t,r){return t=FAe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FAe(e){var t=BAe(e,"string");return ow(t)=="symbol"?t:t+""}function BAe(e,t){if(ow(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ow(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function VAe(e,t){if(e==null)return{};var r=UAe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function UAe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var dQ={symbolCircle:_z,symbolCross:cAe,symbolDiamond:hAe,symbolSquare:dAe,symbolStar:gAe,symbolTriangle:yAe,symbolWye:vAe},$Ae=Math.PI/180,GAe=function(e){var t="symbol".concat(Hk(e));return dQ[t]||_z},HAe=function(e,t,r){if(t==="area")return e;switch(r){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var n=18*$Ae;return 1.25*e*e*(Math.tan(n)-Math.tan(n*2)*Math.pow(Math.tan(n),2))}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},WAe=function(e,t){dQ["symbol".concat(Hk(e))]=t},vz=function(e){var t=e.type,r=t===void 0?"circle":t,n=e.size,c=n===void 0?64:n,h=e.sizeType,p=h===void 0?"area":h,s=VAe(e,zAe),v=v8(v8({},s),{},{type:r,size:c,sizeType:p}),w=function(){var B=GAe(r),N=xAe().type(B).size(HAe(c,p,r));return N()},T=v.className,I=v.cx,O=v.cy,D=Sn(v,!0);return I===+I&&O===+O&&c===+c?Ne.createElement("path",yR({},D,{className:Wn("recharts-symbols",T),transform:"translate(".concat(I,", ").concat(O,")"),d:w()})):null};vz.registerSymbol=WAe;function S_(e){"@babel/helpers - typeof";return S_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S_(e)}function _R(){return _R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_R.apply(this,arguments)}function x8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function qAe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x8(Object(r),!0).forEach(function(n){aw(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZAe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KAe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pQ(n.key),n)}}function XAe(e,t,r){return t&&KAe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function YAe(e,t,r){return t=OE(t),JAe(e,fQ()?Reflect.construct(t,r||[],OE(e).constructor):t.apply(e,r))}function JAe(e,t){if(t&&(S_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QAe(e)}function QAe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fQ=function(){return!!e})()}function OE(e){return OE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},OE(e)}function eke(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vR(e,t)}function vR(e,t){return vR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},vR(e,t)}function aw(e,t,r){return t=pQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pQ(e){var t=tke(e,"string");return S_(t)=="symbol"?t:t+""}function tke(e,t){if(S_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(S_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Al=32,xz=function(e){function t(){return ZAe(this,t),YAe(this,t,arguments)}return eke(t,e),XAe(t,[{key:"renderIcon",value:function(r){var n=this.props.inactiveColor,c=Al/2,h=Al/6,p=Al/3,s=r.inactive?n:r.color;if(r.type==="plainline")return Ne.createElement("line",{strokeWidth:4,fill:"none",stroke:s,strokeDasharray:r.payload.strokeDasharray,x1:0,y1:c,x2:Al,y2:c,className:"recharts-legend-icon"});if(r.type==="line")return Ne.createElement("path",{strokeWidth:4,fill:"none",stroke:s,d:"M0,".concat(c,"h").concat(p,`
            A`).concat(h,",").concat(h,",0,1,1,").concat(2*p,",").concat(c,`
            H`).concat(Al,"M").concat(2*p,",").concat(c,`
            A`).concat(h,",").concat(h,",0,1,1,").concat(p,",").concat(c),className:"recharts-legend-icon"});if(r.type==="rect")return Ne.createElement("path",{stroke:"none",fill:s,d:"M0,".concat(Al/8,"h").concat(Al,"v").concat(Al*3/4,"h").concat(-Al,"z"),className:"recharts-legend-icon"});if(Ne.isValidElement(r.legendIcon)){var v=qAe({},r);return delete v.legendIcon,Ne.cloneElement(r.legendIcon,v)}return Ne.createElement(vz,{fill:s,cx:c,cy:c,size:Al,sizeType:"diameter",type:r.type})}},{key:"renderItems",value:function(){var r=this,n=this.props,c=n.payload,h=n.iconSize,p=n.layout,s=n.formatter,v=n.inactiveColor,w={x:0,y:0,width:Al,height:Al},T={display:p==="horizontal"?"inline-block":"block",marginRight:10},I={display:"inline-block",verticalAlign:"middle",marginRight:4};return c.map(function(O,D){var B=O.formatter||s,N=Wn(aw(aw({"recharts-legend-item":!0},"legend-item-".concat(D),!0),"inactive",O.inactive));if(O.type==="none")return null;var G=Cn(O.value)?null:O.value;_c(!Cn(O.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var U=O.inactive?v:O.color;return Ne.createElement("li",_R({className:N,style:T,key:"legend-item-".concat(D)},Tm(r.props,O,D)),Ne.createElement(cR,{width:h,height:h,viewBox:w,style:I},r.renderIcon(O)),Ne.createElement("span",{className:"recharts-legend-item-text",style:{color:U}},B?B(G,O,D):G))})}},{key:"render",value:function(){var r=this.props,n=r.payload,c=r.layout,h=r.align;if(!n||!n.length)return null;var p={padding:0,margin:0,textAlign:c==="horizontal"?h:"left"};return Ne.createElement("ul",{className:"recharts-default-legend",style:p},this.renderItems())}}])}(Z.PureComponent);aw(xz,"displayName","Legend");aw(xz,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var rke=Ok;function nke(){this.__data__=new rke,this.size=0}var ike=nke;function ske(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var oke=ske;function ake(e){return this.__data__.get(e)}var lke=ake;function cke(e){return this.__data__.has(e)}var uke=cke,hke=Ok,dke=az,fke=lz,pke=200;function mke(e,t){var r=this.__data__;if(r instanceof hke){var n=r.__data__;if(!dke||n.length<pke-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new fke(n)}return r.set(e,t),this.size=r.size,this}var gke=mke,yke=Ok,_ke=ike,vke=oke,xke=lke,bke=uke,wke=gke;function fv(e){var t=this.__data__=new yke(e);this.size=t.size}fv.prototype.clear=_ke;fv.prototype.delete=vke;fv.prototype.get=xke;fv.prototype.has=bke;fv.prototype.set=wke;var mQ=fv,Ske="__lodash_hash_undefined__";function Tke(e){return this.__data__.set(e,Ske),this}var Eke=Tke;function Ake(e){return this.__data__.has(e)}var kke=Ake,Pke=lz,Cke=Eke,Ike=kke;function jE(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Pke;++t<r;)this.add(e[t])}jE.prototype.add=jE.prototype.push=Cke;jE.prototype.has=Ike;var gQ=jE;function Mke(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var yQ=Mke;function Oke(e,t){return e.has(t)}var _Q=Oke,jke=gQ,Rke=yQ,Dke=_Q,Lke=1,zke=2;function Nke(e,t,r,n,c,h){var p=r&Lke,s=e.length,v=t.length;if(s!=v&&!(p&&v>s))return!1;var w=h.get(e),T=h.get(t);if(w&&T)return w==t&&T==e;var I=-1,O=!0,D=r&zke?new jke:void 0;for(h.set(e,t),h.set(t,e);++I<s;){var B=e[I],N=t[I];if(n)var G=p?n(N,B,I,t,e,h):n(B,N,I,e,t,h);if(G!==void 0){if(G)continue;O=!1;break}if(D){if(!Rke(t,function(U,V){if(!Dke(D,V)&&(B===U||c(B,U,r,n,h)))return D.push(V)})){O=!1;break}}else if(!(B===N||c(B,N,r,n,h))){O=!1;break}}return h.delete(e),h.delete(t),O}var vQ=Nke,Fke=Mu,Bke=Fke.Uint8Array,Vke=Bke;function Uke(e){var t=-1,r=Array(e.size);return e.forEach(function(n,c){r[++t]=[c,n]}),r}var $ke=Uke;function Gke(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var bz=Gke,b8=i1,w8=Vke,Hke=oz,Wke=vQ,qke=$ke,Zke=bz,Kke=1,Xke=2,Yke="[object Boolean]",Jke="[object Date]",Qke="[object Error]",ePe="[object Map]",tPe="[object Number]",rPe="[object RegExp]",nPe="[object Set]",iPe="[object String]",sPe="[object Symbol]",oPe="[object ArrayBuffer]",aPe="[object DataView]",S8=b8?b8.prototype:void 0,OM=S8?S8.valueOf:void 0;function lPe(e,t,r,n,c,h,p){switch(r){case aPe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case oPe:return!(e.byteLength!=t.byteLength||!h(new w8(e),new w8(t)));case Yke:case Jke:case tPe:return Hke(+e,+t);case Qke:return e.name==t.name&&e.message==t.message;case rPe:case iPe:return e==t+"";case ePe:var s=qke;case nPe:var v=n&Kke;if(s||(s=Zke),e.size!=t.size&&!v)return!1;var w=p.get(e);if(w)return w==t;n|=Xke,p.set(e,t);var T=Wke(s(e),s(t),n,c,h,p);return p.delete(e),T;case sPe:if(OM)return OM.call(e)==OM.call(t)}return!1}var cPe=lPe;function uPe(e,t){for(var r=-1,n=t.length,c=e.length;++r<n;)e[c+r]=t[r];return e}var xQ=uPe,hPe=xQ,dPe=Ka;function fPe(e,t,r){var n=t(e);return dPe(e)?n:hPe(n,r(e))}var pPe=fPe;function mPe(e,t){for(var r=-1,n=e==null?0:e.length,c=0,h=[];++r<n;){var p=e[r];t(p,r,e)&&(h[c++]=p)}return h}var gPe=mPe;function yPe(){return[]}var _Pe=yPe,vPe=gPe,xPe=_Pe,bPe=Object.prototype,wPe=bPe.propertyIsEnumerable,T8=Object.getOwnPropertySymbols,SPe=T8?function(e){return e==null?[]:(e=Object(e),vPe(T8(e),function(t){return wPe.call(e,t)}))}:xPe,TPe=SPe;function EPe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var APe=EPe,kPe=Fh,PPe=Bh,CPe="[object Arguments]";function IPe(e){return PPe(e)&&kPe(e)==CPe}var MPe=IPe,E8=MPe,OPe=Bh,bQ=Object.prototype,jPe=bQ.hasOwnProperty,RPe=bQ.propertyIsEnumerable,DPe=E8(function(){return arguments}())?E8:function(e){return OPe(e)&&jPe.call(e,"callee")&&!RPe.call(e,"callee")},wz=DPe,RE={exports:{}};function LPe(){return!1}var zPe=LPe;RE.exports;(function(e,t){var r=Mu,n=zPe,c=t&&!t.nodeType&&t,h=c&&!0&&e&&!e.nodeType&&e,p=h&&h.exports===c,s=p?r.Buffer:void 0,v=s?s.isBuffer:void 0,w=v||n;e.exports=w})(RE,RE.exports);var wQ=RE.exports,NPe=9007199254740991,FPe=/^(?:0|[1-9]\d*)$/;function BPe(e,t){var r=typeof e;return t=t??NPe,!!t&&(r=="number"||r!="symbol"&&FPe.test(e))&&e>-1&&e%1==0&&e<t}var Sz=BPe,VPe=9007199254740991;function UPe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=VPe}var Tz=UPe,$Pe=Fh,GPe=Tz,HPe=Bh,WPe="[object Arguments]",qPe="[object Array]",ZPe="[object Boolean]",KPe="[object Date]",XPe="[object Error]",YPe="[object Function]",JPe="[object Map]",QPe="[object Number]",eCe="[object Object]",tCe="[object RegExp]",rCe="[object Set]",nCe="[object String]",iCe="[object WeakMap]",sCe="[object ArrayBuffer]",oCe="[object DataView]",aCe="[object Float32Array]",lCe="[object Float64Array]",cCe="[object Int8Array]",uCe="[object Int16Array]",hCe="[object Int32Array]",dCe="[object Uint8Array]",fCe="[object Uint8ClampedArray]",pCe="[object Uint16Array]",mCe="[object Uint32Array]",ss={};ss[aCe]=ss[lCe]=ss[cCe]=ss[uCe]=ss[hCe]=ss[dCe]=ss[fCe]=ss[pCe]=ss[mCe]=!0;ss[WPe]=ss[qPe]=ss[sCe]=ss[ZPe]=ss[oCe]=ss[KPe]=ss[XPe]=ss[YPe]=ss[JPe]=ss[QPe]=ss[eCe]=ss[tCe]=ss[rCe]=ss[nCe]=ss[iCe]=!1;function gCe(e){return HPe(e)&&GPe(e.length)&&!!ss[$Pe(e)]}var yCe=gCe;function _Ce(e){return function(t){return e(t)}}var SQ=_Ce,DE={exports:{}};DE.exports;(function(e,t){var r=MJ,n=t&&!t.nodeType&&t,c=n&&!0&&e&&!e.nodeType&&e,h=c&&c.exports===n,p=h&&r.process,s=function(){try{var v=c&&c.require&&c.require("util").types;return v||p&&p.binding&&p.binding("util")}catch{}}();e.exports=s})(DE,DE.exports);var vCe=DE.exports,xCe=yCe,bCe=SQ,A8=vCe,k8=A8&&A8.isTypedArray,wCe=k8?bCe(k8):xCe,TQ=wCe,SCe=APe,TCe=wz,ECe=Ka,ACe=wQ,kCe=Sz,PCe=TQ,CCe=Object.prototype,ICe=CCe.hasOwnProperty;function MCe(e,t){var r=ECe(e),n=!r&&TCe(e),c=!r&&!n&&ACe(e),h=!r&&!n&&!c&&PCe(e),p=r||n||c||h,s=p?SCe(e.length,String):[],v=s.length;for(var w in e)(t||ICe.call(e,w))&&!(p&&(w=="length"||c&&(w=="offset"||w=="parent")||h&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||kCe(w,v)))&&s.push(w);return s}var OCe=MCe,jCe=Object.prototype;function RCe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||jCe;return e===r}var DCe=RCe;function LCe(e,t){return function(r){return e(t(r))}}var EQ=LCe,zCe=EQ,NCe=zCe(Object.keys,Object),FCe=NCe,BCe=DCe,VCe=FCe,UCe=Object.prototype,$Ce=UCe.hasOwnProperty;function GCe(e){if(!BCe(e))return VCe(e);var t=[];for(var r in Object(e))$Ce.call(e,r)&&r!="constructor"&&t.push(r);return t}var HCe=GCe,WCe=sz,qCe=Tz;function ZCe(e){return e!=null&&qCe(e.length)&&!WCe(e)}var a1=ZCe,KCe=OCe,XCe=HCe,YCe=a1;function JCe(e){return YCe(e)?KCe(e):XCe(e)}var Kk=JCe,QCe=pPe,eIe=TPe,tIe=Kk;function rIe(e){return QCe(e,tIe,eIe)}var nIe=rIe,P8=nIe,iIe=1,sIe=Object.prototype,oIe=sIe.hasOwnProperty;function aIe(e,t,r,n,c,h){var p=r&iIe,s=P8(e),v=s.length,w=P8(t),T=w.length;if(v!=T&&!p)return!1;for(var I=v;I--;){var O=s[I];if(!(p?O in t:oIe.call(t,O)))return!1}var D=h.get(e),B=h.get(t);if(D&&B)return D==t&&B==e;var N=!0;h.set(e,t),h.set(t,e);for(var G=p;++I<v;){O=s[I];var U=e[O],V=t[O];if(n)var X=p?n(V,U,O,t,e,h):n(U,V,O,e,t,h);if(!(X===void 0?U===V||c(U,V,r,n,h):X)){N=!1;break}G||(G=O=="constructor")}if(N&&!G){var Y=e.constructor,ne=t.constructor;Y!=ne&&"constructor"in e&&"constructor"in t&&!(typeof Y=="function"&&Y instanceof Y&&typeof ne=="function"&&ne instanceof ne)&&(N=!1)}return h.delete(e),h.delete(t),N}var lIe=aIe,cIe=Lm,uIe=Mu,hIe=cIe(uIe,"DataView"),dIe=hIe,fIe=Lm,pIe=Mu,mIe=fIe(pIe,"Promise"),gIe=mIe,yIe=Lm,_Ie=Mu,vIe=yIe(_Ie,"Set"),AQ=vIe,xIe=Lm,bIe=Mu,wIe=xIe(bIe,"WeakMap"),SIe=wIe,xR=dIe,bR=az,wR=gIe,SR=AQ,TR=SIe,kQ=Fh,pv=jJ,C8="[object Map]",TIe="[object Object]",I8="[object Promise]",M8="[object Set]",O8="[object WeakMap]",j8="[object DataView]",EIe=pv(xR),AIe=pv(bR),kIe=pv(wR),PIe=pv(SR),CIe=pv(TR),Gp=kQ;(xR&&Gp(new xR(new ArrayBuffer(1)))!=j8||bR&&Gp(new bR)!=C8||wR&&Gp(wR.resolve())!=I8||SR&&Gp(new SR)!=M8||TR&&Gp(new TR)!=O8)&&(Gp=function(e){var t=kQ(e),r=t==TIe?e.constructor:void 0,n=r?pv(r):"";if(n)switch(n){case EIe:return j8;case AIe:return C8;case kIe:return I8;case PIe:return M8;case CIe:return O8}return t});var IIe=Gp,jM=mQ,MIe=vQ,OIe=cPe,jIe=lIe,R8=IIe,D8=Ka,L8=wQ,RIe=TQ,DIe=1,z8="[object Arguments]",N8="[object Array]",XT="[object Object]",LIe=Object.prototype,F8=LIe.hasOwnProperty;function zIe(e,t,r,n,c,h){var p=D8(e),s=D8(t),v=p?N8:R8(e),w=s?N8:R8(t);v=v==z8?XT:v,w=w==z8?XT:w;var T=v==XT,I=w==XT,O=v==w;if(O&&L8(e)){if(!L8(t))return!1;p=!0,T=!1}if(O&&!T)return h||(h=new jM),p||RIe(e)?MIe(e,t,r,n,c,h):OIe(e,t,v,r,n,c,h);if(!(r&DIe)){var D=T&&F8.call(e,"__wrapped__"),B=I&&F8.call(t,"__wrapped__");if(D||B){var N=D?e.value():e,G=B?t.value():t;return h||(h=new jM),c(N,G,r,n,h)}}return O?(h||(h=new jM),jIe(e,t,r,n,c,h)):!1}var NIe=zIe,FIe=NIe,B8=Bh;function PQ(e,t,r,n,c){return e===t?!0:e==null||t==null||!B8(e)&&!B8(t)?e!==e&&t!==t:FIe(e,t,r,n,PQ,c)}var Ez=PQ,BIe=mQ,VIe=Ez,UIe=1,$Ie=2;function GIe(e,t,r,n){var c=r.length,h=c,p=!n;if(e==null)return!h;for(e=Object(e);c--;){var s=r[c];if(p&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++c<h;){s=r[c];var v=s[0],w=e[v],T=s[1];if(p&&s[2]){if(w===void 0&&!(v in e))return!1}else{var I=new BIe;if(n)var O=n(w,T,v,e,t,I);if(!(O===void 0?VIe(T,w,UIe|$Ie,n,I):O))return!1}}return!0}var HIe=GIe,WIe=Af;function qIe(e){return e===e&&!WIe(e)}var CQ=qIe,ZIe=CQ,KIe=Kk;function XIe(e){for(var t=KIe(e),r=t.length;r--;){var n=t[r],c=e[n];t[r]=[n,c,ZIe(c)]}return t}var YIe=XIe;function JIe(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var IQ=JIe,QIe=HIe,eMe=YIe,tMe=IQ;function rMe(e){var t=eMe(e);return t.length==1&&t[0][2]?tMe(t[0][0],t[0][1]):function(r){return r===e||QIe(r,e,t)}}var nMe=rMe;function iMe(e,t){return e!=null&&t in Object(e)}var sMe=iMe,oMe=NJ,aMe=wz,lMe=Ka,cMe=Sz,uMe=Tz,hMe=Rk;function dMe(e,t,r){t=oMe(t,e);for(var n=-1,c=t.length,h=!1;++n<c;){var p=hMe(t[n]);if(!(h=e!=null&&r(e,p)))break;e=e[p]}return h||++n!=c?h:(c=e==null?0:e.length,!!c&&uMe(c)&&cMe(p,c)&&(lMe(e)||aMe(e)))}var fMe=dMe,pMe=sMe,mMe=fMe;function gMe(e,t){return e!=null&&mMe(e,t,pMe)}var yMe=gMe,_Me=Ez,vMe=FJ,xMe=yMe,bMe=iz,wMe=CQ,SMe=IQ,TMe=Rk,EMe=1,AMe=2;function kMe(e,t){return bMe(e)&&wMe(t)?SMe(TMe(e),t):function(r){var n=vMe(r,e);return n===void 0&&n===t?xMe(r,e):_Me(t,n,EMe|AMe)}}var PMe=kMe;function CMe(e){return e}var mv=CMe;function IMe(e){return function(t){return t?.[e]}}var MMe=IMe,OMe=hz;function jMe(e){return function(t){return OMe(t,e)}}var RMe=jMe,DMe=MMe,LMe=RMe,zMe=iz,NMe=Rk;function FMe(e){return zMe(e)?DMe(NMe(e)):LMe(e)}var BMe=FMe,VMe=nMe,UMe=PMe,$Me=mv,GMe=Ka,HMe=BMe;function WMe(e){return typeof e=="function"?e:e==null?$Me:typeof e=="object"?GMe(e)?UMe(e[0],e[1]):VMe(e):HMe(e)}var Ou=WMe;function qMe(e,t,r,n){for(var c=e.length,h=r+(n?1:-1);n?h--:++h<c;)if(t(e[h],h,e))return h;return-1}var MQ=qMe;function ZMe(e){return e!==e}var KMe=ZMe;function XMe(e,t,r){for(var n=r-1,c=e.length;++n<c;)if(e[n]===t)return n;return-1}var YMe=XMe,JMe=MQ,QMe=KMe,eOe=YMe;function tOe(e,t,r){return t===t?eOe(e,t,r):JMe(e,QMe,r)}var rOe=tOe,nOe=rOe;function iOe(e,t){var r=e==null?0:e.length;return!!r&&nOe(e,t,0)>-1}var sOe=iOe;function oOe(e,t,r){for(var n=-1,c=e==null?0:e.length;++n<c;)if(r(t,e[n]))return!0;return!1}var aOe=oOe;function lOe(){}var cOe=lOe,RM=AQ,uOe=cOe,hOe=bz,dOe=1/0,fOe=RM&&1/hOe(new RM([,-0]))[1]==dOe?function(e){return new RM(e)}:uOe,pOe=fOe,mOe=gQ,gOe=sOe,yOe=aOe,_Oe=_Q,vOe=pOe,xOe=bz,bOe=200;function wOe(e,t,r){var n=-1,c=gOe,h=e.length,p=!0,s=[],v=s;if(r)p=!1,c=yOe;else if(h>=bOe){var w=t?null:vOe(e);if(w)return xOe(w);p=!1,c=_Oe,v=new mOe}else v=t?[]:s;e:for(;++n<h;){var T=e[n],I=t?t(T):T;if(T=r||T!==0?T:0,p&&I===I){for(var O=v.length;O--;)if(v[O]===I)continue e;t&&v.push(I),s.push(T)}else c(v,I,r)||(v!==s&&v.push(I),s.push(T))}return s}var SOe=wOe,TOe=Ou,EOe=SOe;function AOe(e,t){return e&&e.length?EOe(e,TOe(t)):[]}var kOe=AOe;const V8=ki(kOe);function OQ(e,t,r){return t===!0?V8(e,r):Cn(t)?V8(e,t):e}function T_(e){"@babel/helpers - typeof";return T_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T_(e)}var POe=["ref"];function U8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function ah(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U8(Object(r),!0).forEach(function(n){Xk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function COe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $8(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,RQ(n.key),n)}}function IOe(e,t,r){return t&&$8(e.prototype,t),r&&$8(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function MOe(e,t,r){return t=LE(t),OOe(e,jQ()?Reflect.construct(t,r||[],LE(e).constructor):t.apply(e,r))}function OOe(e,t){if(t&&(T_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jOe(e)}function jOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jQ=function(){return!!e})()}function LE(e){return LE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},LE(e)}function ROe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ER(e,t)}function ER(e,t){return ER=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},ER(e,t)}function Xk(e,t,r){return t=RQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RQ(e){var t=DOe(e,"string");return T_(t)=="symbol"?t:t+""}function DOe(e,t){if(T_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(T_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function LOe(e,t){if(e==null)return{};var r=zOe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function zOe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function NOe(e){return e.value}function FOe(e,t){if(Ne.isValidElement(e))return Ne.cloneElement(e,t);if(typeof e=="function")return Ne.createElement(e,t);t.ref;var r=LOe(t,POe);return Ne.createElement(xz,r)}var G8=1,o_=function(e){function t(){var r;COe(this,t);for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];return r=MOe(this,t,[].concat(c)),Xk(r,"lastBoundingBox",{width:-1,height:-1}),r}return ROe(t,e),IOe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var r=this.wrapperNode.getBoundingClientRect();return r.height=this.wrapperNode.offsetHeight,r.width=this.wrapperNode.offsetWidth,r}return null}},{key:"updateBBox",value:function(){var r=this.props.onBBoxUpdate,n=this.getBBox();n?(Math.abs(n.width-this.lastBoundingBox.width)>G8||Math.abs(n.height-this.lastBoundingBox.height)>G8)&&(this.lastBoundingBox.width=n.width,this.lastBoundingBox.height=n.height,r&&r(n)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,r&&r(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?ah({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(r){var n=this.props,c=n.layout,h=n.align,p=n.verticalAlign,s=n.margin,v=n.chartWidth,w=n.chartHeight,T,I;if(!r||(r.left===void 0||r.left===null)&&(r.right===void 0||r.right===null))if(h==="center"&&c==="vertical"){var O=this.getBBoxSnapshot();T={left:((v||0)-O.width)/2}}else T=h==="right"?{right:s&&s.right||0}:{left:s&&s.left||0};if(!r||(r.top===void 0||r.top===null)&&(r.bottom===void 0||r.bottom===null))if(p==="middle"){var D=this.getBBoxSnapshot();I={top:((w||0)-D.height)/2}}else I=p==="bottom"?{bottom:s&&s.bottom||0}:{top:s&&s.top||0};return ah(ah({},T),I)}},{key:"render",value:function(){var r=this,n=this.props,c=n.content,h=n.width,p=n.height,s=n.wrapperStyle,v=n.payloadUniqBy,w=n.payload,T=ah(ah({position:"absolute",width:h||"auto",height:p||"auto"},this.getDefaultPosition(s)),s);return Ne.createElement("div",{className:"recharts-legend-wrapper",style:T,ref:function(I){r.wrapperNode=I}},FOe(c,ah(ah({},this.props),{},{payload:OQ(w,v,NOe)})))}}],[{key:"getWithHeight",value:function(r,n){var c=ah(ah({},this.defaultProps),r.props),h=c.layout;return h==="vertical"&&fr(r.props.height)?{height:r.props.height}:h==="horizontal"?{width:r.props.width||n}:null}}])}(Z.PureComponent);Xk(o_,"displayName","Legend");Xk(o_,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var H8=i1,BOe=wz,VOe=Ka,W8=H8?H8.isConcatSpreadable:void 0;function UOe(e){return VOe(e)||BOe(e)||!!(W8&&e&&e[W8])}var $Oe=UOe,GOe=xQ,HOe=$Oe;function DQ(e,t,r,n,c){var h=-1,p=e.length;for(r||(r=HOe),c||(c=[]);++h<p;){var s=e[h];t>0&&r(s)?t>1?DQ(s,t-1,r,n,c):GOe(c,s):n||(c[c.length]=s)}return c}var LQ=DQ;function WOe(e){return function(t,r,n){for(var c=-1,h=Object(t),p=n(t),s=p.length;s--;){var v=p[e?s:++c];if(r(h[v],v,h)===!1)break}return t}}var qOe=WOe,ZOe=qOe,KOe=ZOe(),XOe=KOe,YOe=XOe,JOe=Kk;function QOe(e,t){return e&&YOe(e,t,JOe)}var zQ=QOe,eje=a1;function tje(e,t){return function(r,n){if(r==null)return r;if(!eje(r))return e(r,n);for(var c=r.length,h=t?c:-1,p=Object(r);(t?h--:++h<c)&&n(p[h],h,p)!==!1;);return r}}var rje=tje,nje=zQ,ije=rje,sje=ije(nje),Az=sje,oje=Az,aje=a1;function lje(e,t){var r=-1,n=aje(e)?Array(e.length):[];return oje(e,function(c,h,p){n[++r]=t(c,h,p)}),n}var NQ=lje;function cje(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var uje=cje,q8=lv;function hje(e,t){if(e!==t){var r=e!==void 0,n=e===null,c=e===e,h=q8(e),p=t!==void 0,s=t===null,v=t===t,w=q8(t);if(!s&&!w&&!h&&e>t||h&&p&&v&&!s&&!w||n&&p&&v||!r&&v||!c)return 1;if(!n&&!h&&!w&&e<t||w&&r&&c&&!n&&!h||s&&r&&c||!p&&c||!v)return-1}return 0}var dje=hje,fje=dje;function pje(e,t,r){for(var n=-1,c=e.criteria,h=t.criteria,p=c.length,s=r.length;++n<p;){var v=fje(c[n],h[n]);if(v){if(n>=s)return v;var w=r[n];return v*(w=="desc"?-1:1)}}return e.index-t.index}var mje=pje,DM=uz,gje=hz,yje=Ou,_je=NQ,vje=uje,xje=SQ,bje=mje,wje=mv,Sje=Ka;function Tje(e,t,r){t.length?t=DM(t,function(h){return Sje(h)?function(p){return gje(p,h.length===1?h[0]:h)}:h}):t=[wje];var n=-1;t=DM(t,xje(yje));var c=_je(e,function(h,p,s){var v=DM(t,function(w){return w(h)});return{criteria:v,index:++n,value:h}});return vje(c,function(h,p){return bje(h,p,r)})}var Eje=Tje;function Aje(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var kje=Aje,Pje=kje,Z8=Math.max;function Cje(e,t,r){return t=Z8(t===void 0?e.length-1:t,0),function(){for(var n=arguments,c=-1,h=Z8(n.length-t,0),p=Array(h);++c<h;)p[c]=n[t+c];c=-1;for(var s=Array(t+1);++c<t;)s[c]=n[c];return s[t]=r(p),Pje(e,this,s)}}var Ije=Cje;function Mje(e){return function(){return e}}var Oje=Mje,jje=Lm,Rje=function(){try{var e=jje(Object,"defineProperty");return e({},"",{}),e}catch{}}(),FQ=Rje,Dje=Oje,K8=FQ,Lje=mv,zje=K8?function(e,t){return K8(e,"toString",{configurable:!0,enumerable:!1,value:Dje(t),writable:!0})}:Lje,Nje=zje,Fje=800,Bje=16,Vje=Date.now;function Uje(e){var t=0,r=0;return function(){var n=Vje(),c=Bje-(n-r);if(r=n,c>0){if(++t>=Fje)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var $je=Uje,Gje=Nje,Hje=$je,Wje=Hje(Gje),qje=Wje,Zje=mv,Kje=Ije,Xje=qje;function Yje(e,t){return Xje(Kje(e,t,Zje),e+"")}var Jje=Yje,Qje=oz,eRe=a1,tRe=Sz,rRe=Af;function nRe(e,t,r){if(!rRe(r))return!1;var n=typeof t;return(n=="number"?eRe(r)&&tRe(t,r.length):n=="string"&&t in r)?Qje(r[t],e):!1}var Yk=nRe,iRe=LQ,sRe=Eje,oRe=Jje,X8=Yk,aRe=oRe(function(e,t){if(e==null)return[];var r=t.length;return r>1&&X8(e,t[0],t[1])?t=[]:r>2&&X8(t[0],t[1],t[2])&&(t=[t[0]]),sRe(e,iRe(t,1),[])}),lRe=aRe;const kz=ki(lRe);function lw(e){"@babel/helpers - typeof";return lw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lw(e)}function AR(){return AR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AR.apply(this,arguments)}function cRe(e,t){return fRe(e)||dRe(e,t)||hRe(e,t)||uRe()}function uRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hRe(e,t){if(e){if(typeof e=="string")return Y8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Y8(e,t)}}function Y8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function dRe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function fRe(e){if(Array.isArray(e))return e}function J8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function LM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?J8(Object(r),!0).forEach(function(n){pRe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pRe(e,t,r){return t=mRe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mRe(e){var t=gRe(e,"string");return lw(t)=="symbol"?t:t+""}function gRe(e,t){if(lw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(lw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yRe(e){return Array.isArray(e)&&io(e[0])&&io(e[1])?e.join(" ~ "):e}var _Re=function(e){var t=e.separator,r=t===void 0?" : ":t,n=e.contentStyle,c=n===void 0?{}:n,h=e.itemStyle,p=h===void 0?{}:h,s=e.labelStyle,v=s===void 0?{}:s,w=e.payload,T=e.formatter,I=e.itemSorter,O=e.wrapperClassName,D=e.labelClassName,B=e.label,N=e.labelFormatter,G=e.accessibilityLayer,U=G===void 0?!1:G,V=function(){if(w&&w.length){var ze={padding:0,margin:0},Pe=(I?kz(w,I):w).map(function(Ke,Ye){if(Ke.type==="none")return null;var Oe=LM({display:"block",paddingTop:4,paddingBottom:4,color:Ke.color||"#000"},p),tt=Ke.formatter||T||yRe,We=Ke.value,lt=Ke.name,rt=We,ht=lt;if(tt&&rt!=null&&ht!=null){var vt=tt(We,lt,Ke,Ye,w);if(Array.isArray(vt)){var mt=cRe(vt,2);rt=mt[0],ht=mt[1]}else rt=vt}return Ne.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(Ye),style:Oe},io(ht)?Ne.createElement("span",{className:"recharts-tooltip-item-name"},ht):null,io(ht)?Ne.createElement("span",{className:"recharts-tooltip-item-separator"},r):null,Ne.createElement("span",{className:"recharts-tooltip-item-value"},rt),Ne.createElement("span",{className:"recharts-tooltip-item-unit"},Ke.unit||""))});return Ne.createElement("ul",{className:"recharts-tooltip-item-list",style:ze},Pe)}return null},X=LM({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},c),Y=LM({margin:0},v),ne=!ni(B),ae=ne?B:"",le=Wn("recharts-default-tooltip",O),ge=Wn("recharts-tooltip-label",D);ne&&N&&w!==void 0&&w!==null&&(ae=N(B,w));var je=U?{role:"status","aria-live":"assertive"}:{};return Ne.createElement("div",AR({className:le,style:X},je),Ne.createElement("p",{className:ge,style:Y},Ne.isValidElement(ae)?ae:"".concat(ae)),V())};function cw(e){"@babel/helpers - typeof";return cw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cw(e)}function YT(e,t,r){return t=vRe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vRe(e){var t=xRe(e,"string");return cw(t)=="symbol"?t:t+""}function xRe(e,t){if(cw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ux="recharts-tooltip-wrapper",bRe={visibility:"hidden"};function wRe(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Wn(Ux,YT(YT(YT(YT({},"".concat(Ux,"-right"),fr(r)&&t&&fr(t.x)&&r>=t.x),"".concat(Ux,"-left"),fr(r)&&t&&fr(t.x)&&r<t.x),"".concat(Ux,"-bottom"),fr(n)&&t&&fr(t.y)&&n>=t.y),"".concat(Ux,"-top"),fr(n)&&t&&fr(t.y)&&n<t.y))}function Q8(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,c=e.offsetTopLeft,h=e.position,p=e.reverseDirection,s=e.tooltipDimension,v=e.viewBox,w=e.viewBoxDimension;if(h&&fr(h[n]))return h[n];var T=r[n]-s-c,I=r[n]+c;if(t[n])return p[n]?T:I;if(p[n]){var O=T,D=v[n];return O<D?Math.max(I,v[n]):Math.max(T,v[n])}var B=I+s,N=v[n]+w;return B>N?Math.max(T,v[n]):Math.max(I,v[n])}function SRe(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function TRe(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,c=e.position,h=e.reverseDirection,p=e.tooltipBox,s=e.useTranslate3d,v=e.viewBox,w,T,I;return p.height>0&&p.width>0&&r?(T=Q8({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:c,reverseDirection:h,tooltipDimension:p.width,viewBox:v,viewBoxDimension:v.width}),I=Q8({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:c,reverseDirection:h,tooltipDimension:p.height,viewBox:v,viewBoxDimension:v.height}),w=SRe({translateX:T,translateY:I,useTranslate3d:s})):w=bRe,{cssProperties:w,cssClasses:wRe({translateX:T,translateY:I,coordinate:r})}}function E_(e){"@babel/helpers - typeof";return E_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E_(e)}function e$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function t$(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e$(Object(r),!0).forEach(function(n){PR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ERe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ARe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,VQ(n.key),n)}}function kRe(e,t,r){return t&&ARe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function PRe(e,t,r){return t=zE(t),CRe(e,BQ()?Reflect.construct(t,r||[],zE(e).constructor):t.apply(e,r))}function CRe(e,t){if(t&&(E_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return IRe(e)}function IRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function BQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(BQ=function(){return!!e})()}function zE(e){return zE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zE(e)}function MRe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kR(e,t)}function kR(e,t){return kR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},kR(e,t)}function PR(e,t,r){return t=VQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VQ(e){var t=ORe(e,"string");return E_(t)=="symbol"?t:t+""}function ORe(e,t){if(E_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(E_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var r$=1,jRe=function(e){function t(){var r;ERe(this,t);for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];return r=PRe(this,t,[].concat(c)),PR(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),PR(r,"handleKeyDown",function(p){if(p.key==="Escape"){var s,v,w,T;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(s=(v=r.props.coordinate)===null||v===void 0?void 0:v.x)!==null&&s!==void 0?s:0,y:(w=(T=r.props.coordinate)===null||T===void 0?void 0:T.y)!==null&&w!==void 0?w:0}})}}),r}return MRe(t,e),kRe(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var r=this.wrapperNode.getBoundingClientRect();(Math.abs(r.width-this.state.lastBoundingBox.width)>r$||Math.abs(r.height-this.state.lastBoundingBox.height)>r$)&&this.setState({lastBoundingBox:{width:r.width,height:r.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var r,n;this.props.active&&this.updateBBox(),this.state.dismissed&&(((r=this.props.coordinate)===null||r===void 0?void 0:r.x)!==this.state.dismissedAtCoordinate.x||((n=this.props.coordinate)===null||n===void 0?void 0:n.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var r=this,n=this.props,c=n.active,h=n.allowEscapeViewBox,p=n.animationDuration,s=n.animationEasing,v=n.children,w=n.coordinate,T=n.hasPayload,I=n.isAnimationActive,O=n.offset,D=n.position,B=n.reverseDirection,N=n.useTranslate3d,G=n.viewBox,U=n.wrapperStyle,V=TRe({allowEscapeViewBox:h,coordinate:w,offsetTopLeft:O,position:D,reverseDirection:B,tooltipBox:this.state.lastBoundingBox,useTranslate3d:N,viewBox:G}),X=V.cssClasses,Y=V.cssProperties,ne=t$(t$({transition:I&&c?"transform ".concat(p,"ms ").concat(s):void 0},Y),{},{pointerEvents:"none",visibility:!this.state.dismissed&&c&&T?"visible":"hidden",position:"absolute",top:0,left:0},U);return Ne.createElement("div",{tabIndex:-1,className:X,style:ne,ref:function(ae){r.wrapperNode=ae}},v)}}])}(Z.PureComponent),RRe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},gv={isSsr:RRe()};function A_(e){"@babel/helpers - typeof";return A_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A_(e)}function n$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function i$(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?n$(Object(r),!0).forEach(function(n){Pz(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function DRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LRe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$Q(n.key),n)}}function zRe(e,t,r){return t&&LRe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function NRe(e,t,r){return t=NE(t),FRe(e,UQ()?Reflect.construct(t,r||[],NE(e).constructor):t.apply(e,r))}function FRe(e,t){if(t&&(A_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BRe(e)}function BRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function UQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(UQ=function(){return!!e})()}function NE(e){return NE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},NE(e)}function VRe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CR(e,t)}function CR(e,t){return CR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},CR(e,t)}function Pz(e,t,r){return t=$Q(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $Q(e){var t=URe(e,"string");return A_(t)=="symbol"?t:t+""}function URe(e,t){if(A_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(A_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function $Re(e){return e.dataKey}function GRe(e,t){return Ne.isValidElement(e)?Ne.cloneElement(e,t):typeof e=="function"?Ne.createElement(e,t):Ne.createElement(_Re,t)}var Na=function(e){function t(){return DRe(this,t),NRe(this,t,arguments)}return VRe(t,e),zRe(t,[{key:"render",value:function(){var r=this,n=this.props,c=n.active,h=n.allowEscapeViewBox,p=n.animationDuration,s=n.animationEasing,v=n.content,w=n.coordinate,T=n.filterNull,I=n.isAnimationActive,O=n.offset,D=n.payload,B=n.payloadUniqBy,N=n.position,G=n.reverseDirection,U=n.useTranslate3d,V=n.viewBox,X=n.wrapperStyle,Y=D??[];T&&Y.length&&(Y=OQ(D.filter(function(ae){return ae.value!=null&&(ae.hide!==!0||r.props.includeHidden)}),B,$Re));var ne=Y.length>0;return Ne.createElement(jRe,{allowEscapeViewBox:h,animationDuration:p,animationEasing:s,isAnimationActive:I,active:c,coordinate:w,hasPayload:ne,offset:O,position:N,reverseDirection:G,useTranslate3d:U,viewBox:V,wrapperStyle:X},GRe(v,i$(i$({},this.props),{},{payload:Y})))}}])}(Z.PureComponent);Pz(Na,"displayName","Tooltip");Pz(Na,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!gv.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var HRe=Mu,WRe=function(){return HRe.Date.now()},qRe=WRe,ZRe=/\s/;function KRe(e){for(var t=e.length;t--&&ZRe.test(e.charAt(t)););return t}var XRe=KRe,YRe=XRe,JRe=/^\s+/;function QRe(e){return e&&e.slice(0,YRe(e)+1).replace(JRe,"")}var eDe=QRe,tDe=eDe,s$=Af,rDe=lv,o$=NaN,nDe=/^[-+]0x[0-9a-f]+$/i,iDe=/^0b[01]+$/i,sDe=/^0o[0-7]+$/i,oDe=parseInt;function aDe(e){if(typeof e=="number")return e;if(rDe(e))return o$;if(s$(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=s$(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=tDe(e);var r=iDe.test(e);return r||sDe.test(e)?oDe(e.slice(2),r?2:8):nDe.test(e)?o$:+e}var GQ=aDe,lDe=Af,zM=qRe,a$=GQ,cDe="Expected a function",uDe=Math.max,hDe=Math.min;function dDe(e,t,r){var n,c,h,p,s,v,w=0,T=!1,I=!1,O=!0;if(typeof e!="function")throw new TypeError(cDe);t=a$(t)||0,lDe(r)&&(T=!!r.leading,I="maxWait"in r,h=I?uDe(a$(r.maxWait)||0,t):h,O="trailing"in r?!!r.trailing:O);function D(ae){var le=n,ge=c;return n=c=void 0,w=ae,p=e.apply(ge,le),p}function B(ae){return w=ae,s=setTimeout(U,t),T?D(ae):p}function N(ae){var le=ae-v,ge=ae-w,je=t-le;return I?hDe(je,h-ge):je}function G(ae){var le=ae-v,ge=ae-w;return v===void 0||le>=t||le<0||I&&ge>=h}function U(){var ae=zM();if(G(ae))return V(ae);s=setTimeout(U,N(ae))}function V(ae){return s=void 0,O&&n?D(ae):(n=c=void 0,p)}function X(){s!==void 0&&clearTimeout(s),w=0,n=v=c=s=void 0}function Y(){return s===void 0?p:V(zM())}function ne(){var ae=zM(),le=G(ae);if(n=arguments,c=this,v=ae,le){if(s===void 0)return B(v);if(I)return clearTimeout(s),s=setTimeout(U,t),D(v)}return s===void 0&&(s=setTimeout(U,t)),p}return ne.cancel=X,ne.flush=Y,ne}var fDe=dDe,pDe=fDe,mDe=Af,gDe="Expected a function";function yDe(e,t,r){var n=!0,c=!0;if(typeof e!="function")throw new TypeError(gDe);return mDe(r)&&(n="leading"in r?!!r.leading:n,c="trailing"in r?!!r.trailing:c),pDe(e,t,{leading:n,maxWait:t,trailing:c})}var _De=yDe;const HQ=ki(_De);function uw(e){"@babel/helpers - typeof";return uw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uw(e)}function l$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function JT(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?l$(Object(r),!0).forEach(function(n){vDe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vDe(e,t,r){return t=xDe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xDe(e){var t=bDe(e,"string");return uw(t)=="symbol"?t:t+""}function bDe(e,t){if(uw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(uw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wDe(e,t){return ADe(e)||EDe(e,t)||TDe(e,t)||SDe()}function SDe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TDe(e,t){if(e){if(typeof e=="string")return c$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c$(e,t)}}function c$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function EDe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function ADe(e){if(Array.isArray(e))return e}var Ab=Z.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,c=n===void 0?{width:-1,height:-1}:n,h=e.width,p=h===void 0?"100%":h,s=e.height,v=s===void 0?"100%":s,w=e.minWidth,T=w===void 0?0:w,I=e.minHeight,O=e.maxHeight,D=e.children,B=e.debounce,N=B===void 0?0:B,G=e.id,U=e.className,V=e.onResize,X=e.style,Y=X===void 0?{}:X,ne=Z.useRef(null),ae=Z.useRef();ae.current=V,Z.useImperativeHandle(t,function(){return Object.defineProperty(ne.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),ne.current},configurable:!0})});var le=Z.useState({containerWidth:c.width,containerHeight:c.height}),ge=wDe(le,2),je=ge[0],ze=ge[1],Pe=Z.useCallback(function(Ye,Oe){ze(function(tt){var We=Math.round(Ye),lt=Math.round(Oe);return tt.containerWidth===We&&tt.containerHeight===lt?tt:{containerWidth:We,containerHeight:lt}})},[]);Z.useEffect(function(){var Ye=function(rt){var ht,vt=rt[0].contentRect,mt=vt.width,ct=vt.height;Pe(mt,ct),(ht=ae.current)===null||ht===void 0||ht.call(ae,mt,ct)};N>0&&(Ye=HQ(Ye,N,{trailing:!0,leading:!1}));var Oe=new ResizeObserver(Ye),tt=ne.current.getBoundingClientRect(),We=tt.width,lt=tt.height;return Pe(We,lt),Oe.observe(ne.current),function(){Oe.disconnect()}},[Pe,N]);var Ke=Z.useMemo(function(){var Ye=je.containerWidth,Oe=je.containerHeight;if(Ye<0||Oe<0)return null;_c(tm(p)||tm(v),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,p,v),_c(!r||r>0,"The aspect(%s) must be greater than zero.",r);var tt=tm(p)?Ye:p,We=tm(v)?Oe:v;r&&r>0&&(tt?We=tt/r:We&&(tt=We*r),O&&We>O&&(We=O)),_c(tt>0||We>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,tt,We,p,v,T,I,r);var lt=!Array.isArray(D)&&xh(D.type).endsWith("Chart");return Ne.Children.map(D,function(rt){return Ne.isValidElement(rt)?Z.cloneElement(rt,JT({width:tt,height:We},lt?{style:JT({height:"100%",width:"100%",maxHeight:We,maxWidth:tt},rt.props.style)}:{})):rt})},[r,D,v,O,I,T,je,p]);return Ne.createElement("div",{id:G?"".concat(G):void 0,className:Wn("recharts-responsive-container",U),style:JT(JT({},Y),{},{width:p,height:v,minWidth:T,minHeight:I,maxHeight:O}),ref:ne},Ke)}),l1=function(e){return null};l1.displayName="Cell";function hw(e){"@babel/helpers - typeof";return hw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hw(e)}function u$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function IR(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?u$(Object(r),!0).forEach(function(n){kDe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kDe(e,t,r){return t=PDe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PDe(e){var t=CDe(e,"string");return hw(t)=="symbol"?t:t+""}function CDe(e,t){if(hw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var vy={widthCache:{},cacheCount:0},IDe=2e3,MDe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},h$="recharts_measurement_span";function ODe(e){var t=IR({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var kb=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||gv.isSsr)return{width:0,height:0};var r=ODe(t),n=JSON.stringify({text:e,copyStyle:r});if(vy.widthCache[n])return vy.widthCache[n];try{var c=document.getElementById(h$);c||(c=document.createElement("span"),c.setAttribute("id",h$),c.setAttribute("aria-hidden","true"),document.body.appendChild(c));var h=IR(IR({},MDe),r);Object.assign(c.style,h),c.textContent="".concat(e);var p=c.getBoundingClientRect(),s={width:p.width,height:p.height};return vy.widthCache[n]=s,++vy.cacheCount>IDe&&(vy.cacheCount=0,vy.widthCache={}),s}catch{return{width:0,height:0}}},jDe=function(e){return{top:e.top+window.scrollY-document.documentElement.clientTop,left:e.left+window.scrollX-document.documentElement.clientLeft}};function dw(e){"@babel/helpers - typeof";return dw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dw(e)}function FE(e,t){return zDe(e)||LDe(e,t)||DDe(e,t)||RDe()}function RDe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DDe(e,t){if(e){if(typeof e=="string")return d$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d$(e,t)}}function d$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function LDe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;v=!1}else for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function zDe(e){if(Array.isArray(e))return e}function NDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f$(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,BDe(n.key),n)}}function FDe(e,t,r){return t&&f$(e.prototype,t),r&&f$(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function BDe(e){var t=VDe(e,"string");return dw(t)=="symbol"?t:t+""}function VDe(e,t){if(dw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(dw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var p$=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,m$=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,UDe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,$De=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,WQ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},GDe=Object.keys(WQ),Vy="NaN";function HDe(e,t){return e*WQ[t]}var QT=function(){function e(t,r){NDe(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!UDe.test(r)&&(this.num=NaN,this.unit=""),GDe.includes(r)&&(this.num=HDe(t,r),this.unit="px")}return FDe(e,[{key:"add",value:function(t){return this.unit!==t.unit?new e(NaN,""):new e(this.num+t.num,this.unit)}},{key:"subtract",value:function(t){return this.unit!==t.unit?new e(NaN,""):new e(this.num-t.num,this.unit)}},{key:"multiply",value:function(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new e(NaN,""):new e(this.num*t.num,this.unit||t.unit)}},{key:"divide",value:function(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new e(NaN,""):new e(this.num/t.num,this.unit||t.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(t){var r,n=(r=$De.exec(t))!==null&&r!==void 0?r:[],c=FE(n,3),h=c[1],p=c[2];return new e(parseFloat(h),p??"")}}])}();function qQ(e){if(e.includes(Vy))return Vy;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=p$.exec(t))!==null&&r!==void 0?r:[],c=FE(n,4),h=c[1],p=c[2],s=c[3],v=QT.parse(h??""),w=QT.parse(s??""),T=p==="*"?v.multiply(w):v.divide(w);if(T.isNaN())return Vy;t=t.replace(p$,T.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var I,O=(I=m$.exec(t))!==null&&I!==void 0?I:[],D=FE(O,4),B=D[1],N=D[2],G=D[3],U=QT.parse(B??""),V=QT.parse(G??""),X=N==="+"?U.add(V):U.subtract(V);if(X.isNaN())return Vy;t=t.replace(m$,X.toString())}return t}var g$=/\(([^()]*)\)/;function WDe(e){for(var t=e;t.includes("(");){var r=g$.exec(t),n=FE(r,2),c=n[1];t=t.replace(g$,qQ(c))}return t}function qDe(e){var t=e.replace(/\s+/g,"");return t=WDe(t),t=qQ(t),t}function ZDe(e){try{return qDe(e)}catch{return Vy}}function NM(e){var t=ZDe(e.slice(5,-1));return t===Vy?"":t}var KDe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],XDe=["dx","dy","angle","className","breakAll"];function MR(){return MR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},MR.apply(this,arguments)}function y$(e,t){if(e==null)return{};var r=YDe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function YDe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function _$(e,t){return tLe(e)||eLe(e,t)||QDe(e,t)||JDe()}function JDe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QDe(e,t){if(e){if(typeof e=="string")return v$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v$(e,t)}}function v$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function eLe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;v=!1}else for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function tLe(e){if(Array.isArray(e))return e}var ZQ=/[ \f\n\r\t\v\u2028\u2029]+/,KQ=function(e){var t=e.children,r=e.breakAll,n=e.style;try{var c=[];ni(t)||(r?c=t.toString().split(""):c=t.toString().split(ZQ));var h=c.map(function(s){return{word:s,width:kb(s,n).width}}),p=r?0:kb(" ",n).width;return{wordsWithComputedWidth:h,spaceWidth:p}}catch{return null}},rLe=function(e,t,r,n,c){var h=e.maxLines,p=e.children,s=e.style,v=e.breakAll,w=fr(h),T=p,I=function(){var Ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ye.reduce(function(Oe,tt){var We=tt.word,lt=tt.width,rt=Oe[Oe.length-1];if(rt&&(n==null||c||rt.width+lt+r<Number(n)))rt.words.push(We),rt.width+=lt+r;else{var ht={words:[We],width:lt};Oe.push(ht)}return Oe},[])},O=I(t),D=function(Ye){return Ye.reduce(function(Oe,tt){return Oe.width>tt.width?Oe:tt})};if(!w)return O;for(var B="…",N=function(Ye){var Oe=T.slice(0,Ye),tt=KQ({breakAll:v,style:s,children:Oe+B}).wordsWithComputedWidth,We=I(tt),lt=We.length>h||D(We).width>Number(n);return[lt,We]},G=0,U=T.length-1,V=0,X;G<=U&&V<=T.length-1;){var Y=Math.floor((G+U)/2),ne=Y-1,ae=N(ne),le=_$(ae,2),ge=le[0],je=le[1],ze=N(Y),Pe=_$(ze,1),Ke=Pe[0];if(!ge&&!Ke&&(G=Y+1),ge&&Ke&&(U=Y-1),!ge&&Ke){X=je;break}V++}return X||O},x$=function(e){var t=ni(e)?[]:e.toString().split(ZQ);return[{words:t}]},nLe=function(e){var t=e.width,r=e.scaleToFit,n=e.children,c=e.style,h=e.breakAll,p=e.maxLines;if((t||r)&&!gv.isSsr){var s,v,w=KQ({breakAll:h,children:n,style:c});if(w){var T=w.wordsWithComputedWidth,I=w.spaceWidth;s=T,v=I}else return x$(n);return rLe({breakAll:h,children:n,maxLines:p,style:c},s,v,t,r)}return x$(n)},b$="#808080",Em=function(e){var t=e.x,r=t===void 0?0:t,n=e.y,c=n===void 0?0:n,h=e.lineHeight,p=h===void 0?"1em":h,s=e.capHeight,v=s===void 0?"0.71em":s,w=e.scaleToFit,T=w===void 0?!1:w,I=e.textAnchor,O=I===void 0?"start":I,D=e.verticalAnchor,B=D===void 0?"end":D,N=e.fill,G=N===void 0?b$:N,U=y$(e,KDe),V=Z.useMemo(function(){return nLe({breakAll:U.breakAll,children:U.children,maxLines:U.maxLines,scaleToFit:T,style:U.style,width:U.width})},[U.breakAll,U.children,U.maxLines,T,U.style,U.width]),X=U.dx,Y=U.dy,ne=U.angle,ae=U.className,le=U.breakAll,ge=y$(U,XDe);if(!io(r)||!io(c))return null;var je=r+(fr(X)?X:0),ze=c+(fr(Y)?Y:0),Pe;switch(B){case"start":Pe=NM("calc(".concat(v,")"));break;case"middle":Pe=NM("calc(".concat((V.length-1)/2," * -").concat(p," + (").concat(v," / 2))"));break;default:Pe=NM("calc(".concat(V.length-1," * -").concat(p,")"));break}var Ke=[];if(T){var Ye=V[0].width,Oe=U.width;Ke.push("scale(".concat((fr(Oe)?Oe/Ye:1)/Ye,")"))}return ne&&Ke.push("rotate(".concat(ne,", ").concat(je,", ").concat(ze,")")),Ke.length&&(ge.transform=Ke.join(" ")),Ne.createElement("text",MR({},Sn(ge,!0),{x:je,y:ze,className:Wn("recharts-text",ae),textAnchor:O,fill:G.includes("url")?b$:G}),V.map(function(tt,We){var lt=tt.words.join(le?"":" ");return Ne.createElement("tspan",{x:je,dy:We===0?Pe:p,key:"".concat(lt,"-").concat(We)},lt)}))};function df(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function iLe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function XQ(e){let t,r,n;e.length!==2?(t=df,r=(s,v)=>df(e(s),v),n=(s,v)=>e(s)-v):(t=e===df||e===iLe?e:sLe,r=e,n=e);function c(s,v,w=0,T=s.length){if(w<T){if(t(v,v)!==0)return T;do{const I=w+T>>>1;r(s[I],v)<0?w=I+1:T=I}while(w<T)}return w}function h(s,v,w=0,T=s.length){if(w<T){if(t(v,v)!==0)return T;do{const I=w+T>>>1;r(s[I],v)<=0?w=I+1:T=I}while(w<T)}return w}function p(s,v,w=0,T=s.length){const I=c(s,v,w,T-1);return I>w&&n(s[I-1],v)>-n(s[I],v)?I-1:I}return{left:c,center:p,right:h}}function sLe(){return 0}function YQ(e){return e===null?NaN:+e}function*oLe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const aLe=XQ(df),c1=aLe.right;XQ(YQ).center;class w$ extends Map{constructor(t,r=uLe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,c]of t)this.set(n,c)}get(t){return super.get(S$(this,t))}has(t){return super.has(S$(this,t))}set(t,r){return super.set(lLe(this,t),r)}delete(t){return super.delete(cLe(this,t))}}function S$({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function lLe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function cLe({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function uLe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function hLe(e=df){if(e===df)return JQ;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function JQ(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const dLe=Math.sqrt(50),fLe=Math.sqrt(10),pLe=Math.sqrt(2);function BE(e,t,r){const n=(t-e)/Math.max(0,r),c=Math.floor(Math.log10(n)),h=n/Math.pow(10,c),p=h>=dLe?10:h>=fLe?5:h>=pLe?2:1;let s,v,w;return c<0?(w=Math.pow(10,-c)/p,s=Math.round(e*w),v=Math.round(t*w),s/w<e&&++s,v/w>t&&--v,w=-w):(w=Math.pow(10,c)*p,s=Math.round(e/w),v=Math.round(t/w),s*w<e&&++s,v*w>t&&--v),v<s&&.5<=r&&r<2?BE(e,t,r*2):[s,v,w]}function OR(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[c,h,p]=n?BE(t,e,r):BE(e,t,r);if(!(h>=c))return[];const s=h-c+1,v=new Array(s);if(n)if(p<0)for(let w=0;w<s;++w)v[w]=(h-w)/-p;else for(let w=0;w<s;++w)v[w]=(h-w)*p;else if(p<0)for(let w=0;w<s;++w)v[w]=(c+w)/-p;else for(let w=0;w<s;++w)v[w]=(c+w)*p;return v}function jR(e,t,r){return t=+t,e=+e,r=+r,BE(e,t,r)[2]}function mLe(e,t,r){t=+t,e=+e,r=+r;const n=t<e,c=n?jR(t,e,r):jR(e,t,r);return(n?-1:1)*(c<0?1/-c:c)}function T$(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function E$(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function QQ(e,t,r=0,n=1/0,c){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(c=c===void 0?JQ:hLe(c);n>r;){if(n-r>600){const v=n-r+1,w=t-r+1,T=Math.log(v),I=.5*Math.exp(2*T/3),O=.5*Math.sqrt(T*I*(v-I)/v)*(w-v/2<0?-1:1),D=Math.max(r,Math.floor(t-w*I/v+O)),B=Math.min(n,Math.floor(t+(v-w)*I/v+O));QQ(e,t,D,B,c)}const h=e[t];let p=r,s=n;for($x(e,r,t),c(e[n],h)>0&&$x(e,r,n);p<s;){for($x(e,p,s),++p,--s;c(e[p],h)<0;)++p;for(;c(e[s],h)>0;)--s}c(e[r],h)===0?$x(e,r,s):(++s,$x(e,s,n)),s<=t&&(r=s+1),t<=s&&(n=s-1)}return e}function $x(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function gLe(e,t,r){if(e=Float64Array.from(oLe(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return E$(e);if(t>=1)return T$(e);var n,c=(n-1)*t,h=Math.floor(c),p=T$(QQ(e,h).subarray(0,h+1)),s=E$(e.subarray(h+1));return p+(s-p)*(c-h)}}function yLe(e,t,r=YQ){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,c=(n-1)*t,h=Math.floor(c),p=+r(e[h],h,e),s=+r(e[h+1],h+1,e);return p+(s-p)*(c-h)}}function _Le(e,t,r){e=+e,t=+t,r=(c=arguments.length)<2?(t=e,e=0,1):c<3?1:+r;for(var n=-1,c=Math.max(0,Math.ceil((t-e)/r))|0,h=new Array(c);++n<c;)h[n]=e+n*r;return h}function Ul(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Vh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const RR=Symbol("implicit");function Cz(){var e=new w$,t=[],r=[],n=RR;function c(h){let p=e.get(h);if(p===void 0){if(n!==RR)return n;e.set(h,p=t.push(h)-1)}return r[p%r.length]}return c.domain=function(h){if(!arguments.length)return t.slice();t=[],e=new w$;for(const p of h)e.has(p)||e.set(p,t.push(p)-1);return c},c.range=function(h){return arguments.length?(r=Array.from(h),c):r.slice()},c.unknown=function(h){return arguments.length?(n=h,c):n},c.copy=function(){return Cz(t,r).unknown(n)},Ul.apply(c,arguments),c}function fw(){var e=Cz().unknown(void 0),t=e.domain,r=e.range,n=0,c=1,h,p,s=!1,v=0,w=0,T=.5;delete e.unknown;function I(){var O=t().length,D=c<n,B=D?c:n,N=D?n:c;h=(N-B)/Math.max(1,O-v+w*2),s&&(h=Math.floor(h)),B+=(N-B-h*(O-v))*T,p=h*(1-v),s&&(B=Math.round(B),p=Math.round(p));var G=_Le(O).map(function(U){return B+h*U});return r(D?G.reverse():G)}return e.domain=function(O){return arguments.length?(t(O),I()):t()},e.range=function(O){return arguments.length?([n,c]=O,n=+n,c=+c,I()):[n,c]},e.rangeRound=function(O){return[n,c]=O,n=+n,c=+c,s=!0,I()},e.bandwidth=function(){return p},e.step=function(){return h},e.round=function(O){return arguments.length?(s=!!O,I()):s},e.padding=function(O){return arguments.length?(v=Math.min(1,w=+O),I()):v},e.paddingInner=function(O){return arguments.length?(v=Math.min(1,O),I()):v},e.paddingOuter=function(O){return arguments.length?(w=+O,I()):w},e.align=function(O){return arguments.length?(T=Math.max(0,Math.min(1,O)),I()):T},e.copy=function(){return fw(t(),[n,c]).round(s).paddingInner(v).paddingOuter(w).align(T)},Ul.apply(I(),arguments)}function eee(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return eee(t())},e}function Pb(){return eee(fw.apply(null,arguments).paddingInner(1))}function Iz(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function tee(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function u1(){}var pw=.7,VE=1/pw,a_="\\s*([+-]?\\d+)\\s*",mw="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Eu="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vLe=/^#([0-9a-f]{3,8})$/,xLe=new RegExp(`^rgb\\(${a_},${a_},${a_}\\)$`),bLe=new RegExp(`^rgb\\(${Eu},${Eu},${Eu}\\)$`),wLe=new RegExp(`^rgba\\(${a_},${a_},${a_},${mw}\\)$`),SLe=new RegExp(`^rgba\\(${Eu},${Eu},${Eu},${mw}\\)$`),TLe=new RegExp(`^hsl\\(${mw},${Eu},${Eu}\\)$`),ELe=new RegExp(`^hsla\\(${mw},${Eu},${Eu},${mw}\\)$`),A$={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Iz(u1,gw,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:k$,formatHex:k$,formatHex8:ALe,formatHsl:kLe,formatRgb:P$,toString:P$});function k$(){return this.rgb().formatHex()}function ALe(){return this.rgb().formatHex8()}function kLe(){return ree(this).formatHsl()}function P$(){return this.rgb().formatRgb()}function gw(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=vLe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?C$(t):r===3?new $a(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?e2(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?e2(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=xLe.exec(e))?new $a(t[1],t[2],t[3],1):(t=bLe.exec(e))?new $a(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=wLe.exec(e))?e2(t[1],t[2],t[3],t[4]):(t=SLe.exec(e))?e2(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=TLe.exec(e))?O$(t[1],t[2]/100,t[3]/100,1):(t=ELe.exec(e))?O$(t[1],t[2]/100,t[3]/100,t[4]):A$.hasOwnProperty(e)?C$(A$[e]):e==="transparent"?new $a(NaN,NaN,NaN,0):null}function C$(e){return new $a(e>>16&255,e>>8&255,e&255,1)}function e2(e,t,r,n){return n<=0&&(e=t=r=NaN),new $a(e,t,r,n)}function PLe(e){return e instanceof u1||(e=gw(e)),e?(e=e.rgb(),new $a(e.r,e.g,e.b,e.opacity)):new $a}function DR(e,t,r,n){return arguments.length===1?PLe(e):new $a(e,t,r,n??1)}function $a(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}Iz($a,DR,tee(u1,{brighter(e){return e=e==null?VE:Math.pow(VE,e),new $a(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?pw:Math.pow(pw,e),new $a(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new $a(um(this.r),um(this.g),um(this.b),UE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:I$,formatHex:I$,formatHex8:CLe,formatRgb:M$,toString:M$}));function I$(){return`#${rm(this.r)}${rm(this.g)}${rm(this.b)}`}function CLe(){return`#${rm(this.r)}${rm(this.g)}${rm(this.b)}${rm((isNaN(this.opacity)?1:this.opacity)*255)}`}function M$(){const e=UE(this.opacity);return`${e===1?"rgb(":"rgba("}${um(this.r)}, ${um(this.g)}, ${um(this.b)}${e===1?")":`, ${e})`}`}function UE(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function um(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function rm(e){return e=um(e),(e<16?"0":"")+e.toString(16)}function O$(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new mc(e,t,r,n)}function ree(e){if(e instanceof mc)return new mc(e.h,e.s,e.l,e.opacity);if(e instanceof u1||(e=gw(e)),!e)return new mc;if(e instanceof mc)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,c=Math.min(t,r,n),h=Math.max(t,r,n),p=NaN,s=h-c,v=(h+c)/2;return s?(t===h?p=(r-n)/s+(r<n)*6:r===h?p=(n-t)/s+2:p=(t-r)/s+4,s/=v<.5?h+c:2-h-c,p*=60):s=v>0&&v<1?0:p,new mc(p,s,v,e.opacity)}function ILe(e,t,r,n){return arguments.length===1?ree(e):new mc(e,t,r,n??1)}function mc(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}Iz(mc,ILe,tee(u1,{brighter(e){return e=e==null?VE:Math.pow(VE,e),new mc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?pw:Math.pow(pw,e),new mc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,c=2*r-n;return new $a(FM(e>=240?e-240:e+120,c,n),FM(e,c,n),FM(e<120?e+240:e-120,c,n),this.opacity)},clamp(){return new mc(j$(this.h),t2(this.s),t2(this.l),UE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=UE(this.opacity);return`${e===1?"hsl(":"hsla("}${j$(this.h)}, ${t2(this.s)*100}%, ${t2(this.l)*100}%${e===1?")":`, ${e})`}`}}));function j$(e){return e=(e||0)%360,e<0?e+360:e}function t2(e){return Math.max(0,Math.min(1,e||0))}function FM(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const Mz=e=>()=>e;function MLe(e,t){return function(r){return e+r*t}}function OLe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function jLe(e){return(e=+e)==1?nee:function(t,r){return r-t?OLe(t,r,e):Mz(isNaN(t)?r:t)}}function nee(e,t){var r=t-e;return r?MLe(e,r):Mz(isNaN(e)?t:e)}const R$=function e(t){var r=jLe(t);function n(c,h){var p=r((c=DR(c)).r,(h=DR(h)).r),s=r(c.g,h.g),v=r(c.b,h.b),w=nee(c.opacity,h.opacity);return function(T){return c.r=p(T),c.g=s(T),c.b=v(T),c.opacity=w(T),c+""}}return n.gamma=e,n}(1);function RLe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),c;return function(h){for(c=0;c<r;++c)n[c]=e[c]*(1-h)+t[c]*h;return n}}function DLe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function LLe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,c=new Array(n),h=new Array(r),p;for(p=0;p<n;++p)c[p]=yv(e[p],t[p]);for(;p<r;++p)h[p]=t[p];return function(s){for(p=0;p<n;++p)h[p]=c[p](s);return h}}function zLe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function $E(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function NLe(e,t){var r={},n={},c;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(c in t)c in e?r[c]=yv(e[c],t[c]):n[c]=t[c];return function(h){for(c in r)n[c]=r[c](h);return n}}var LR=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,BM=new RegExp(LR.source,"g");function FLe(e){return function(){return e}}function BLe(e){return function(t){return e(t)+""}}function VLe(e,t){var r=LR.lastIndex=BM.lastIndex=0,n,c,h,p=-1,s=[],v=[];for(e=e+"",t=t+"";(n=LR.exec(e))&&(c=BM.exec(t));)(h=c.index)>r&&(h=t.slice(r,h),s[p]?s[p]+=h:s[++p]=h),(n=n[0])===(c=c[0])?s[p]?s[p]+=c:s[++p]=c:(s[++p]=null,v.push({i:p,x:$E(n,c)})),r=BM.lastIndex;return r<t.length&&(h=t.slice(r),s[p]?s[p]+=h:s[++p]=h),s.length<2?v[0]?BLe(v[0].x):FLe(t):(t=v.length,function(w){for(var T=0,I;T<t;++T)s[(I=v[T]).i]=I.x(w);return s.join("")})}function yv(e,t){var r=typeof t,n;return t==null||r==="boolean"?Mz(t):(r==="number"?$E:r==="string"?(n=gw(t))?(t=n,R$):VLe:t instanceof gw?R$:t instanceof Date?zLe:DLe(t)?RLe:Array.isArray(t)?LLe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?NLe:$E)(e,t)}function Oz(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function ULe(e,t){t===void 0&&(t=e,e=yv);for(var r=0,n=t.length-1,c=t[0],h=new Array(n<0?0:n);r<n;)h[r]=e(c,c=t[++r]);return function(p){var s=Math.max(0,Math.min(n-1,Math.floor(p*=n)));return h[s](p-s)}}function $Le(e){return function(){return e}}function GE(e){return+e}var D$=[0,1];function va(e){return e}function zR(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:$Le(isNaN(t)?NaN:.5)}function GLe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function HLe(e,t,r){var n=e[0],c=e[1],h=t[0],p=t[1];return c<n?(n=zR(c,n),h=r(p,h)):(n=zR(n,c),h=r(h,p)),function(s){return h(n(s))}}function WLe(e,t,r){var n=Math.min(e.length,t.length)-1,c=new Array(n),h=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++p<n;)c[p]=zR(e[p],e[p+1]),h[p]=r(t[p],t[p+1]);return function(s){var v=c1(e,s,1,n)-1;return h[v](c[v](s))}}function h1(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Jk(){var e=D$,t=D$,r=yv,n,c,h,p=va,s,v,w;function T(){var O=Math.min(e.length,t.length);return p!==va&&(p=GLe(e[0],e[O-1])),s=O>2?WLe:HLe,v=w=null,I}function I(O){return O==null||isNaN(O=+O)?h:(v||(v=s(e.map(n),t,r)))(n(p(O)))}return I.invert=function(O){return p(c((w||(w=s(t,e.map(n),$E)))(O)))},I.domain=function(O){return arguments.length?(e=Array.from(O,GE),T()):e.slice()},I.range=function(O){return arguments.length?(t=Array.from(O),T()):t.slice()},I.rangeRound=function(O){return t=Array.from(O),r=Oz,T()},I.clamp=function(O){return arguments.length?(p=O?!0:va,T()):p!==va},I.interpolate=function(O){return arguments.length?(r=O,T()):r},I.unknown=function(O){return arguments.length?(h=O,I):h},function(O,D){return n=O,c=D,T()}}function jz(){return Jk()(va,va)}function qLe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function HE(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function k_(e){return e=HE(Math.abs(e)),e?e[1]:NaN}function ZLe(e,t){return function(r,n){for(var c=r.length,h=[],p=0,s=e[0],v=0;c>0&&s>0&&(v+s+1>n&&(s=Math.max(1,n-v)),h.push(r.substring(c-=s,c+s)),!((v+=s+1)>n));)s=e[p=(p+1)%e.length];return h.reverse().join(t)}}function KLe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var XLe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function yw(e){if(!(t=XLe.exec(e)))throw new Error("invalid format: "+e);var t;return new Rz({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}yw.prototype=Rz.prototype;function Rz(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Rz.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function YLe(e){e:for(var t=e.length,r=1,n=-1,c;r<t;++r)switch(e[r]){case".":n=c=r;break;case"0":n===0&&(n=r),c=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(c+1):e}var iee;function JLe(e,t){var r=HE(e,t);if(!r)return e+"";var n=r[0],c=r[1],h=c-(iee=Math.max(-8,Math.min(8,Math.floor(c/3)))*3)+1,p=n.length;return h===p?n:h>p?n+new Array(h-p+1).join("0"):h>0?n.slice(0,h)+"."+n.slice(h):"0."+new Array(1-h).join("0")+HE(e,Math.max(0,t+h-1))[0]}function L$(e,t){var r=HE(e,t);if(!r)return e+"";var n=r[0],c=r[1];return c<0?"0."+new Array(-c).join("0")+n:n.length>c+1?n.slice(0,c+1)+"."+n.slice(c+1):n+new Array(c-n.length+2).join("0")}const z$={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:qLe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>L$(e*100,t),r:L$,s:JLe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function N$(e){return e}var F$=Array.prototype.map,B$=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function QLe(e){var t=e.grouping===void 0||e.thousands===void 0?N$:ZLe(F$.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",c=e.decimal===void 0?".":e.decimal+"",h=e.numerals===void 0?N$:KLe(F$.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"−":e.minus+"",v=e.nan===void 0?"NaN":e.nan+"";function w(I){I=yw(I);var O=I.fill,D=I.align,B=I.sign,N=I.symbol,G=I.zero,U=I.width,V=I.comma,X=I.precision,Y=I.trim,ne=I.type;ne==="n"?(V=!0,ne="g"):z$[ne]||(X===void 0&&(X=12),Y=!0,ne="g"),(G||O==="0"&&D==="=")&&(G=!0,O="0",D="=");var ae=N==="$"?r:N==="#"&&/[boxX]/.test(ne)?"0"+ne.toLowerCase():"",le=N==="$"?n:/[%p]/.test(ne)?p:"",ge=z$[ne],je=/[defgprs%]/.test(ne);X=X===void 0?6:/[gprs]/.test(ne)?Math.max(1,Math.min(21,X)):Math.max(0,Math.min(20,X));function ze(Pe){var Ke=ae,Ye=le,Oe,tt,We;if(ne==="c")Ye=ge(Pe)+Ye,Pe="";else{Pe=+Pe;var lt=Pe<0||1/Pe<0;if(Pe=isNaN(Pe)?v:ge(Math.abs(Pe),X),Y&&(Pe=YLe(Pe)),lt&&+Pe==0&&B!=="+"&&(lt=!1),Ke=(lt?B==="("?B:s:B==="-"||B==="("?"":B)+Ke,Ye=(ne==="s"?B$[8+iee/3]:"")+Ye+(lt&&B==="("?")":""),je){for(Oe=-1,tt=Pe.length;++Oe<tt;)if(We=Pe.charCodeAt(Oe),48>We||We>57){Ye=(We===46?c+Pe.slice(Oe+1):Pe.slice(Oe))+Ye,Pe=Pe.slice(0,Oe);break}}}V&&!G&&(Pe=t(Pe,1/0));var rt=Ke.length+Pe.length+Ye.length,ht=rt<U?new Array(U-rt+1).join(O):"";switch(V&&G&&(Pe=t(ht+Pe,ht.length?U-Ye.length:1/0),ht=""),D){case"<":Pe=Ke+Pe+Ye+ht;break;case"=":Pe=Ke+ht+Pe+Ye;break;case"^":Pe=ht.slice(0,rt=ht.length>>1)+Ke+Pe+Ye+ht.slice(rt);break;default:Pe=ht+Ke+Pe+Ye;break}return h(Pe)}return ze.toString=function(){return I+""},ze}function T(I,O){var D=w((I=yw(I),I.type="f",I)),B=Math.max(-8,Math.min(8,Math.floor(k_(O)/3)))*3,N=Math.pow(10,-B),G=B$[8+B/3];return function(U){return D(N*U)+G}}return{format:w,formatPrefix:T}}var r2,Dz,see;e3e({thousands:",",grouping:[3],currency:["$",""]});function e3e(e){return r2=QLe(e),Dz=r2.format,see=r2.formatPrefix,r2}function t3e(e){return Math.max(0,-k_(Math.abs(e)))}function r3e(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(k_(t)/3)))*3-k_(Math.abs(e)))}function n3e(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,k_(t)-k_(e))+1}function oee(e,t,r,n){var c=mLe(e,t,r),h;switch(n=yw(n??",f"),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(h=r3e(c,p))&&(n.precision=h),see(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(h=n3e(c,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=h-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(h=t3e(c))&&(n.precision=h-(n.type==="%")*2);break}}return Dz(n)}function kf(e){var t=e.domain;return e.ticks=function(r){var n=t();return OR(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var c=t();return oee(c[0],c[c.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),c=0,h=n.length-1,p=n[c],s=n[h],v,w,T=10;for(s<p&&(w=p,p=s,s=w,w=c,c=h,h=w);T-- >0;){if(w=jR(p,s,r),w===v)return n[c]=p,n[h]=s,t(n);if(w>0)p=Math.floor(p/w)*w,s=Math.ceil(s/w)*w;else if(w<0)p=Math.ceil(p*w)/w,s=Math.floor(s*w)/w;else break;v=w}return e},e}function WE(){var e=jz();return e.copy=function(){return h1(e,WE())},Ul.apply(e,arguments),kf(e)}function aee(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,GE),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return aee(e).unknown(t)},e=arguments.length?Array.from(e,GE):[0,1],kf(r)}function lee(e,t){e=e.slice();var r=0,n=e.length-1,c=e[r],h=e[n],p;return h<c&&(p=r,r=n,n=p,p=c,c=h,h=p),e[r]=t.floor(c),e[n]=t.ceil(h),e}function V$(e){return Math.log(e)}function U$(e){return Math.exp(e)}function i3e(e){return-Math.log(-e)}function s3e(e){return-Math.exp(-e)}function o3e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function a3e(e){return e===10?o3e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function l3e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function $$(e){return(t,r)=>-e(-t,r)}function Lz(e){const t=e(V$,U$),r=t.domain;let n=10,c,h;function p(){return c=l3e(n),h=a3e(n),r()[0]<0?(c=$$(c),h=$$(h),e(i3e,s3e)):e(V$,U$),t}return t.base=function(s){return arguments.length?(n=+s,p()):n},t.domain=function(s){return arguments.length?(r(s),p()):r()},t.ticks=s=>{const v=r();let w=v[0],T=v[v.length-1];const I=T<w;I&&([w,T]=[T,w]);let O=c(w),D=c(T),B,N;const G=s==null?10:+s;let U=[];if(!(n%1)&&D-O<G){if(O=Math.floor(O),D=Math.ceil(D),w>0){for(;O<=D;++O)for(B=1;B<n;++B)if(N=O<0?B/h(-O):B*h(O),!(N<w)){if(N>T)break;U.push(N)}}else for(;O<=D;++O)for(B=n-1;B>=1;--B)if(N=O>0?B/h(-O):B*h(O),!(N<w)){if(N>T)break;U.push(N)}U.length*2<G&&(U=OR(w,T,G))}else U=OR(O,D,Math.min(D-O,G)).map(h);return I?U.reverse():U},t.tickFormat=(s,v)=>{if(s==null&&(s=10),v==null&&(v=n===10?"s":","),typeof v!="function"&&(!(n%1)&&(v=yw(v)).precision==null&&(v.trim=!0),v=Dz(v)),s===1/0)return v;const w=Math.max(1,n*s/t.ticks().length);return T=>{let I=T/h(Math.round(c(T)));return I*n<n-.5&&(I*=n),I<=w?v(T):""}},t.nice=()=>r(lee(r(),{floor:s=>h(Math.floor(c(s))),ceil:s=>h(Math.ceil(c(s)))})),t}function cee(){const e=Lz(Jk()).domain([1,10]);return e.copy=()=>h1(e,cee()).base(e.base()),Ul.apply(e,arguments),e}function G$(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function H$(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function zz(e){var t=1,r=e(G$(t),H$(t));return r.constant=function(n){return arguments.length?e(G$(t=+n),H$(t)):t},kf(r)}function uee(){var e=zz(Jk());return e.copy=function(){return h1(e,uee()).constant(e.constant())},Ul.apply(e,arguments)}function W$(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function c3e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function u3e(e){return e<0?-e*e:e*e}function Nz(e){var t=e(va,va),r=1;function n(){return r===1?e(va,va):r===.5?e(c3e,u3e):e(W$(r),W$(1/r))}return t.exponent=function(c){return arguments.length?(r=+c,n()):r},kf(t)}function Fz(){var e=Nz(Jk());return e.copy=function(){return h1(e,Fz()).exponent(e.exponent())},Ul.apply(e,arguments),e}function h3e(){return Fz.apply(null,arguments).exponent(.5)}function q$(e){return Math.sign(e)*e*e}function d3e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function hee(){var e=jz(),t=[0,1],r=!1,n;function c(h){var p=d3e(e(h));return isNaN(p)?n:r?Math.round(p):p}return c.invert=function(h){return e.invert(q$(h))},c.domain=function(h){return arguments.length?(e.domain(h),c):e.domain()},c.range=function(h){return arguments.length?(e.range((t=Array.from(h,GE)).map(q$)),c):t.slice()},c.rangeRound=function(h){return c.range(h).round(!0)},c.round=function(h){return arguments.length?(r=!!h,c):r},c.clamp=function(h){return arguments.length?(e.clamp(h),c):e.clamp()},c.unknown=function(h){return arguments.length?(n=h,c):n},c.copy=function(){return hee(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Ul.apply(c,arguments),kf(c)}function dee(){var e=[],t=[],r=[],n;function c(){var p=0,s=Math.max(1,t.length);for(r=new Array(s-1);++p<s;)r[p-1]=yLe(e,p/s);return h}function h(p){return p==null||isNaN(p=+p)?n:t[c1(r,p)]}return h.invertExtent=function(p){var s=t.indexOf(p);return s<0?[NaN,NaN]:[s>0?r[s-1]:e[0],s<r.length?r[s]:e[e.length-1]]},h.domain=function(p){if(!arguments.length)return e.slice();e=[];for(let s of p)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(df),c()},h.range=function(p){return arguments.length?(t=Array.from(p),c()):t.slice()},h.unknown=function(p){return arguments.length?(n=p,h):n},h.quantiles=function(){return r.slice()},h.copy=function(){return dee().domain(e).range(t).unknown(n)},Ul.apply(h,arguments)}function fee(){var e=0,t=1,r=1,n=[.5],c=[0,1],h;function p(v){return v!=null&&v<=v?c[c1(n,v,0,r)]:h}function s(){var v=-1;for(n=new Array(r);++v<r;)n[v]=((v+1)*t-(v-r)*e)/(r+1);return p}return p.domain=function(v){return arguments.length?([e,t]=v,e=+e,t=+t,s()):[e,t]},p.range=function(v){return arguments.length?(r=(c=Array.from(v)).length-1,s()):c.slice()},p.invertExtent=function(v){var w=c.indexOf(v);return w<0?[NaN,NaN]:w<1?[e,n[0]]:w>=r?[n[r-1],t]:[n[w-1],n[w]]},p.unknown=function(v){return arguments.length&&(h=v),p},p.thresholds=function(){return n.slice()},p.copy=function(){return fee().domain([e,t]).range(c).unknown(h)},Ul.apply(kf(p),arguments)}function pee(){var e=[.5],t=[0,1],r,n=1;function c(h){return h!=null&&h<=h?t[c1(e,h,0,n)]:r}return c.domain=function(h){return arguments.length?(e=Array.from(h),n=Math.min(e.length,t.length-1),c):e.slice()},c.range=function(h){return arguments.length?(t=Array.from(h),n=Math.min(e.length,t.length-1),c):t.slice()},c.invertExtent=function(h){var p=t.indexOf(h);return[e[p-1],e[p]]},c.unknown=function(h){return arguments.length?(r=h,c):r},c.copy=function(){return pee().domain(e).range(t).unknown(r)},Ul.apply(c,arguments)}const VM=new Date,UM=new Date;function so(e,t,r,n){function c(h){return e(h=arguments.length===0?new Date:new Date(+h)),h}return c.floor=h=>(e(h=new Date(+h)),h),c.ceil=h=>(e(h=new Date(h-1)),t(h,1),e(h),h),c.round=h=>{const p=c(h),s=c.ceil(h);return h-p<s-h?p:s},c.offset=(h,p)=>(t(h=new Date(+h),p==null?1:Math.floor(p)),h),c.range=(h,p,s)=>{const v=[];if(h=c.ceil(h),s=s==null?1:Math.floor(s),!(h<p)||!(s>0))return v;let w;do v.push(w=new Date(+h)),t(h,s),e(h);while(w<h&&h<p);return v},c.filter=h=>so(p=>{if(p>=p)for(;e(p),!h(p);)p.setTime(p-1)},(p,s)=>{if(p>=p)if(s<0)for(;++s<=0;)for(;t(p,-1),!h(p););else for(;--s>=0;)for(;t(p,1),!h(p););}),r&&(c.count=(h,p)=>(VM.setTime(+h),UM.setTime(+p),e(VM),e(UM),Math.floor(r(VM,UM))),c.every=h=>(h=Math.floor(h),!isFinite(h)||!(h>0)?null:h>1?c.filter(n?p=>n(p)%h===0:p=>c.count(0,p)%h===0):c)),c}const qE=so(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);qE.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?so(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):qE);qE.range;const gh=1e3,jl=gh*60,yh=jl*60,Oh=yh*24,Bz=Oh*7,Z$=Oh*30,$M=Oh*365,nm=so(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*gh)},(e,t)=>(t-e)/gh,e=>e.getUTCSeconds());nm.range;const Vz=so(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*gh)},(e,t)=>{e.setTime(+e+t*jl)},(e,t)=>(t-e)/jl,e=>e.getMinutes());Vz.range;const Uz=so(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*jl)},(e,t)=>(t-e)/jl,e=>e.getUTCMinutes());Uz.range;const $z=so(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*gh-e.getMinutes()*jl)},(e,t)=>{e.setTime(+e+t*yh)},(e,t)=>(t-e)/yh,e=>e.getHours());$z.range;const Gz=so(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*yh)},(e,t)=>(t-e)/yh,e=>e.getUTCHours());Gz.range;const d1=so(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*jl)/Oh,e=>e.getDate()-1);d1.range;const Qk=so(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Oh,e=>e.getUTCDate()-1);Qk.range;const mee=so(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Oh,e=>Math.floor(e/Oh));mee.range;function zm(e){return so(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*jl)/Bz)}const eP=zm(0),ZE=zm(1),f3e=zm(2),p3e=zm(3),P_=zm(4),m3e=zm(5),g3e=zm(6);eP.range;ZE.range;f3e.range;p3e.range;P_.range;m3e.range;g3e.range;function Nm(e){return so(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/Bz)}const tP=Nm(0),KE=Nm(1),y3e=Nm(2),_3e=Nm(3),C_=Nm(4),v3e=Nm(5),x3e=Nm(6);tP.range;KE.range;y3e.range;_3e.range;C_.range;v3e.range;x3e.range;const Hz=so(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());Hz.range;const Wz=so(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Wz.range;const jh=so(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());jh.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:so(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});jh.range;const Rh=so(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Rh.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:so(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Rh.range;function GM(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function b3e(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function w3e(e){let t,r,n;e.length!==2?(t=GM,r=(s,v)=>GM(e(s),v),n=(s,v)=>e(s)-v):(t=e===GM||e===b3e?e:S3e,r=e,n=e);function c(s,v,w=0,T=s.length){if(w<T){if(t(v,v)!==0)return T;do{const I=w+T>>>1;r(s[I],v)<0?w=I+1:T=I}while(w<T)}return w}function h(s,v,w=0,T=s.length){if(w<T){if(t(v,v)!==0)return T;do{const I=w+T>>>1;r(s[I],v)<=0?w=I+1:T=I}while(w<T)}return w}function p(s,v,w=0,T=s.length){const I=c(s,v,w,T-1);return I>w&&n(s[I-1],v)>-n(s[I],v)?I-1:I}return{left:c,center:p,right:h}}function S3e(){return 0}const T3e=Math.sqrt(50),E3e=Math.sqrt(10),A3e=Math.sqrt(2);function gee(e,t,r){const n=(t-e)/Math.max(0,r),c=Math.floor(Math.log10(n)),h=n/Math.pow(10,c),p=h>=T3e?10:h>=E3e?5:h>=A3e?2:1;let s,v,w;return c<0?(w=Math.pow(10,-c)/p,s=Math.round(e*w),v=Math.round(t*w),s/w<e&&++s,v/w>t&&--v,w=-w):(w=Math.pow(10,c)*p,s=Math.round(e/w),v=Math.round(t/w),s*w<e&&++s,v*w>t&&--v),v<s&&.5<=r&&r<2?gee(e,t,r*2):[s,v,w]}function K$(e,t,r){return t=+t,e=+e,r=+r,gee(e,t,r)[2]}function X$(e,t,r){t=+t,e=+e,r=+r;const n=t<e,c=n?K$(t,e,r):K$(e,t,r);return(n?-1:1)*(c<0?1/-c:c)}function yee(e,t,r,n,c,h){const p=[[nm,1,gh],[nm,5,5*gh],[nm,15,15*gh],[nm,30,30*gh],[h,1,jl],[h,5,5*jl],[h,15,15*jl],[h,30,30*jl],[c,1,yh],[c,3,3*yh],[c,6,6*yh],[c,12,12*yh],[n,1,Oh],[n,2,2*Oh],[r,1,Bz],[t,1,Z$],[t,3,3*Z$],[e,1,$M]];function s(w,T,I){const O=T<w;O&&([w,T]=[T,w]);const D=I&&typeof I.range=="function"?I:v(w,T,I),B=D?D.range(w,+T+1):[];return O?B.reverse():B}function v(w,T,I){const O=Math.abs(T-w)/I,D=w3e(([,,G])=>G).right(p,O);if(D===p.length)return e.every(X$(w/$M,T/$M,I));if(D===0)return qE.every(Math.max(X$(w,T,I),1));const[B,N]=p[O/p[D-1][2]<p[D][2]/O?D-1:D];return B.every(N)}return[s,v]}const[k3e,P3e]=yee(Rh,Wz,tP,mee,Gz,Uz),[C3e,I3e]=yee(jh,Hz,eP,d1,$z,Vz);function HM(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function WM(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Gx(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function M3e(e){var t=e.dateTime,r=e.date,n=e.time,c=e.periods,h=e.days,p=e.shortDays,s=e.months,v=e.shortMonths,w=Hx(c),T=Wx(c),I=Hx(h),O=Wx(h),D=Hx(p),B=Wx(p),N=Hx(s),G=Wx(s),U=Hx(v),V=Wx(v),X={a:lt,A:rt,b:ht,B:vt,c:null,d:rG,e:rG,f:eze,g:uze,G:dze,H:Y3e,I:J3e,j:Q3e,L:_ee,m:tze,M:rze,p:mt,q:ct,Q:sG,s:oG,S:nze,u:ize,U:sze,V:oze,w:aze,W:lze,x:null,X:null,y:cze,Y:hze,Z:fze,"%":iG},Y={a:Ut,A:xr,b:tn,B:Er,c:null,d:nG,e:nG,f:yze,g:kze,G:Cze,H:pze,I:mze,j:gze,L:xee,m:_ze,M:vze,p:Ft,q:br,Q:sG,s:oG,S:xze,u:bze,U:wze,V:Sze,w:Tze,W:Eze,x:null,X:null,y:Aze,Y:Pze,Z:Ize,"%":iG},ne={a:ze,A:Pe,b:Ke,B:Ye,c:Oe,d:eG,e:eG,f:q3e,g:Q$,G:J$,H:tG,I:tG,j:$3e,L:W3e,m:U3e,M:G3e,p:je,q:V3e,Q:K3e,s:X3e,S:H3e,u:L3e,U:z3e,V:N3e,w:D3e,W:F3e,x:tt,X:We,y:Q$,Y:J$,Z:B3e,"%":Z3e};X.x=ae(r,X),X.X=ae(n,X),X.c=ae(t,X),Y.x=ae(r,Y),Y.X=ae(n,Y),Y.c=ae(t,Y);function ae(Yt,Qt){return function(Sr){var Vt=[],Nn=-1,Jr=0,Kr=Yt.length,Mn,Fi,Us;for(Sr instanceof Date||(Sr=new Date(+Sr));++Nn<Kr;)Yt.charCodeAt(Nn)===37&&(Vt.push(Yt.slice(Jr,Nn)),(Fi=Y$[Mn=Yt.charAt(++Nn)])!=null?Mn=Yt.charAt(++Nn):Fi=Mn==="e"?" ":"0",(Us=Qt[Mn])&&(Mn=Us(Sr,Fi)),Vt.push(Mn),Jr=Nn+1);return Vt.push(Yt.slice(Jr,Nn)),Vt.join("")}}function le(Yt,Qt){return function(Sr){var Vt=Gx(1900,void 0,1),Nn=ge(Vt,Yt,Sr+="",0),Jr,Kr;if(Nn!=Sr.length)return null;if("Q"in Vt)return new Date(Vt.Q);if("s"in Vt)return new Date(Vt.s*1e3+("L"in Vt?Vt.L:0));if(Qt&&!("Z"in Vt)&&(Vt.Z=0),"p"in Vt&&(Vt.H=Vt.H%12+Vt.p*12),Vt.m===void 0&&(Vt.m="q"in Vt?Vt.q:0),"V"in Vt){if(Vt.V<1||Vt.V>53)return null;"w"in Vt||(Vt.w=1),"Z"in Vt?(Jr=WM(Gx(Vt.y,0,1)),Kr=Jr.getUTCDay(),Jr=Kr>4||Kr===0?KE.ceil(Jr):KE(Jr),Jr=Qk.offset(Jr,(Vt.V-1)*7),Vt.y=Jr.getUTCFullYear(),Vt.m=Jr.getUTCMonth(),Vt.d=Jr.getUTCDate()+(Vt.w+6)%7):(Jr=HM(Gx(Vt.y,0,1)),Kr=Jr.getDay(),Jr=Kr>4||Kr===0?ZE.ceil(Jr):ZE(Jr),Jr=d1.offset(Jr,(Vt.V-1)*7),Vt.y=Jr.getFullYear(),Vt.m=Jr.getMonth(),Vt.d=Jr.getDate()+(Vt.w+6)%7)}else("W"in Vt||"U"in Vt)&&("w"in Vt||(Vt.w="u"in Vt?Vt.u%7:"W"in Vt?1:0),Kr="Z"in Vt?WM(Gx(Vt.y,0,1)).getUTCDay():HM(Gx(Vt.y,0,1)).getDay(),Vt.m=0,Vt.d="W"in Vt?(Vt.w+6)%7+Vt.W*7-(Kr+5)%7:Vt.w+Vt.U*7-(Kr+6)%7);return"Z"in Vt?(Vt.H+=Vt.Z/100|0,Vt.M+=Vt.Z%100,WM(Vt)):HM(Vt)}}function ge(Yt,Qt,Sr,Vt){for(var Nn=0,Jr=Qt.length,Kr=Sr.length,Mn,Fi;Nn<Jr;){if(Vt>=Kr)return-1;if(Mn=Qt.charCodeAt(Nn++),Mn===37){if(Mn=Qt.charAt(Nn++),Fi=ne[Mn in Y$?Qt.charAt(Nn++):Mn],!Fi||(Vt=Fi(Yt,Sr,Vt))<0)return-1}else if(Mn!=Sr.charCodeAt(Vt++))return-1}return Vt}function je(Yt,Qt,Sr){var Vt=w.exec(Qt.slice(Sr));return Vt?(Yt.p=T.get(Vt[0].toLowerCase()),Sr+Vt[0].length):-1}function ze(Yt,Qt,Sr){var Vt=D.exec(Qt.slice(Sr));return Vt?(Yt.w=B.get(Vt[0].toLowerCase()),Sr+Vt[0].length):-1}function Pe(Yt,Qt,Sr){var Vt=I.exec(Qt.slice(Sr));return Vt?(Yt.w=O.get(Vt[0].toLowerCase()),Sr+Vt[0].length):-1}function Ke(Yt,Qt,Sr){var Vt=U.exec(Qt.slice(Sr));return Vt?(Yt.m=V.get(Vt[0].toLowerCase()),Sr+Vt[0].length):-1}function Ye(Yt,Qt,Sr){var Vt=N.exec(Qt.slice(Sr));return Vt?(Yt.m=G.get(Vt[0].toLowerCase()),Sr+Vt[0].length):-1}function Oe(Yt,Qt,Sr){return ge(Yt,t,Qt,Sr)}function tt(Yt,Qt,Sr){return ge(Yt,r,Qt,Sr)}function We(Yt,Qt,Sr){return ge(Yt,n,Qt,Sr)}function lt(Yt){return p[Yt.getDay()]}function rt(Yt){return h[Yt.getDay()]}function ht(Yt){return v[Yt.getMonth()]}function vt(Yt){return s[Yt.getMonth()]}function mt(Yt){return c[+(Yt.getHours()>=12)]}function ct(Yt){return 1+~~(Yt.getMonth()/3)}function Ut(Yt){return p[Yt.getUTCDay()]}function xr(Yt){return h[Yt.getUTCDay()]}function tn(Yt){return v[Yt.getUTCMonth()]}function Er(Yt){return s[Yt.getUTCMonth()]}function Ft(Yt){return c[+(Yt.getUTCHours()>=12)]}function br(Yt){return 1+~~(Yt.getUTCMonth()/3)}return{format:function(Yt){var Qt=ae(Yt+="",X);return Qt.toString=function(){return Yt},Qt},parse:function(Yt){var Qt=le(Yt+="",!1);return Qt.toString=function(){return Yt},Qt},utcFormat:function(Yt){var Qt=ae(Yt+="",Y);return Qt.toString=function(){return Yt},Qt},utcParse:function(Yt){var Qt=le(Yt+="",!0);return Qt.toString=function(){return Yt},Qt}}}var Y$={"-":"",_:" ",0:"0"},bo=/^\s*\d+/,O3e=/^%/,j3e=/[\\^$*+?|[\]().{}]/g;function Si(e,t,r){var n=e<0?"-":"",c=(n?-e:e)+"",h=c.length;return n+(h<r?new Array(r-h+1).join(t)+c:c)}function R3e(e){return e.replace(j3e,"\\$&")}function Hx(e){return new RegExp("^(?:"+e.map(R3e).join("|")+")","i")}function Wx(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function D3e(e,t,r){var n=bo.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function L3e(e,t,r){var n=bo.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function z3e(e,t,r){var n=bo.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function N3e(e,t,r){var n=bo.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function F3e(e,t,r){var n=bo.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function J$(e,t,r){var n=bo.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function Q$(e,t,r){var n=bo.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function B3e(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function V3e(e,t,r){var n=bo.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function U3e(e,t,r){var n=bo.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function eG(e,t,r){var n=bo.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function $3e(e,t,r){var n=bo.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function tG(e,t,r){var n=bo.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function G3e(e,t,r){var n=bo.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function H3e(e,t,r){var n=bo.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function W3e(e,t,r){var n=bo.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function q3e(e,t,r){var n=bo.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Z3e(e,t,r){var n=O3e.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function K3e(e,t,r){var n=bo.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function X3e(e,t,r){var n=bo.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function rG(e,t){return Si(e.getDate(),t,2)}function Y3e(e,t){return Si(e.getHours(),t,2)}function J3e(e,t){return Si(e.getHours()%12||12,t,2)}function Q3e(e,t){return Si(1+d1.count(jh(e),e),t,3)}function _ee(e,t){return Si(e.getMilliseconds(),t,3)}function eze(e,t){return _ee(e,t)+"000"}function tze(e,t){return Si(e.getMonth()+1,t,2)}function rze(e,t){return Si(e.getMinutes(),t,2)}function nze(e,t){return Si(e.getSeconds(),t,2)}function ize(e){var t=e.getDay();return t===0?7:t}function sze(e,t){return Si(eP.count(jh(e)-1,e),t,2)}function vee(e){var t=e.getDay();return t>=4||t===0?P_(e):P_.ceil(e)}function oze(e,t){return e=vee(e),Si(P_.count(jh(e),e)+(jh(e).getDay()===4),t,2)}function aze(e){return e.getDay()}function lze(e,t){return Si(ZE.count(jh(e)-1,e),t,2)}function cze(e,t){return Si(e.getFullYear()%100,t,2)}function uze(e,t){return e=vee(e),Si(e.getFullYear()%100,t,2)}function hze(e,t){return Si(e.getFullYear()%1e4,t,4)}function dze(e,t){var r=e.getDay();return e=r>=4||r===0?P_(e):P_.ceil(e),Si(e.getFullYear()%1e4,t,4)}function fze(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Si(t/60|0,"0",2)+Si(t%60,"0",2)}function nG(e,t){return Si(e.getUTCDate(),t,2)}function pze(e,t){return Si(e.getUTCHours(),t,2)}function mze(e,t){return Si(e.getUTCHours()%12||12,t,2)}function gze(e,t){return Si(1+Qk.count(Rh(e),e),t,3)}function xee(e,t){return Si(e.getUTCMilliseconds(),t,3)}function yze(e,t){return xee(e,t)+"000"}function _ze(e,t){return Si(e.getUTCMonth()+1,t,2)}function vze(e,t){return Si(e.getUTCMinutes(),t,2)}function xze(e,t){return Si(e.getUTCSeconds(),t,2)}function bze(e){var t=e.getUTCDay();return t===0?7:t}function wze(e,t){return Si(tP.count(Rh(e)-1,e),t,2)}function bee(e){var t=e.getUTCDay();return t>=4||t===0?C_(e):C_.ceil(e)}function Sze(e,t){return e=bee(e),Si(C_.count(Rh(e),e)+(Rh(e).getUTCDay()===4),t,2)}function Tze(e){return e.getUTCDay()}function Eze(e,t){return Si(KE.count(Rh(e)-1,e),t,2)}function Aze(e,t){return Si(e.getUTCFullYear()%100,t,2)}function kze(e,t){return e=bee(e),Si(e.getUTCFullYear()%100,t,2)}function Pze(e,t){return Si(e.getUTCFullYear()%1e4,t,4)}function Cze(e,t){var r=e.getUTCDay();return e=r>=4||r===0?C_(e):C_.ceil(e),Si(e.getUTCFullYear()%1e4,t,4)}function Ize(){return"+0000"}function iG(){return"%"}function sG(e){return+e}function oG(e){return Math.floor(+e/1e3)}var xy,wee,See;Mze({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Mze(e){return xy=M3e(e),wee=xy.format,xy.parse,See=xy.utcFormat,xy.utcParse,xy}function Oze(e){return new Date(e)}function jze(e){return e instanceof Date?+e:+new Date(+e)}function qz(e,t,r,n,c,h,p,s,v,w){var T=jz(),I=T.invert,O=T.domain,D=w(".%L"),B=w(":%S"),N=w("%I:%M"),G=w("%I %p"),U=w("%a %d"),V=w("%b %d"),X=w("%B"),Y=w("%Y");function ne(ae){return(v(ae)<ae?D:s(ae)<ae?B:p(ae)<ae?N:h(ae)<ae?G:n(ae)<ae?c(ae)<ae?U:V:r(ae)<ae?X:Y)(ae)}return T.invert=function(ae){return new Date(I(ae))},T.domain=function(ae){return arguments.length?O(Array.from(ae,jze)):O().map(Oze)},T.ticks=function(ae){var le=O();return e(le[0],le[le.length-1],ae??10)},T.tickFormat=function(ae,le){return le==null?ne:w(le)},T.nice=function(ae){var le=O();return(!ae||typeof ae.range!="function")&&(ae=t(le[0],le[le.length-1],ae??10)),ae?O(lee(le,ae)):T},T.copy=function(){return h1(T,qz(e,t,r,n,c,h,p,s,v,w))},T}function Rze(){return Ul.apply(qz(C3e,I3e,jh,Hz,eP,d1,$z,Vz,nm,wee).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Dze(){return Ul.apply(qz(k3e,P3e,Rh,Wz,tP,Qk,Gz,Uz,nm,See).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function rP(){var e=0,t=1,r,n,c,h,p=va,s=!1,v;function w(I){return I==null||isNaN(I=+I)?v:p(c===0?.5:(I=(h(I)-r)*c,s?Math.max(0,Math.min(1,I)):I))}w.domain=function(I){return arguments.length?([e,t]=I,r=h(e=+e),n=h(t=+t),c=r===n?0:1/(n-r),w):[e,t]},w.clamp=function(I){return arguments.length?(s=!!I,w):s},w.interpolator=function(I){return arguments.length?(p=I,w):p};function T(I){return function(O){var D,B;return arguments.length?([D,B]=O,p=I(D,B),w):[p(0),p(1)]}}return w.range=T(yv),w.rangeRound=T(Oz),w.unknown=function(I){return arguments.length?(v=I,w):v},function(I){return h=I,r=I(e),n=I(t),c=r===n?0:1/(n-r),w}}function Pf(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Tee(){var e=kf(rP()(va));return e.copy=function(){return Pf(e,Tee())},Vh.apply(e,arguments)}function Eee(){var e=Lz(rP()).domain([1,10]);return e.copy=function(){return Pf(e,Eee()).base(e.base())},Vh.apply(e,arguments)}function Aee(){var e=zz(rP());return e.copy=function(){return Pf(e,Aee()).constant(e.constant())},Vh.apply(e,arguments)}function Zz(){var e=Nz(rP());return e.copy=function(){return Pf(e,Zz()).exponent(e.exponent())},Vh.apply(e,arguments)}function Lze(){return Zz.apply(null,arguments).exponent(.5)}function kee(){var e=[],t=va;function r(n){if(n!=null&&!isNaN(n=+n))return t((c1(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let c of n)c!=null&&!isNaN(c=+c)&&e.push(c);return e.sort(df),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,c)=>t(c/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(c,h)=>gLe(e,h/n))},r.copy=function(){return kee(t).domain(e)},Vh.apply(r,arguments)}function nP(){var e=0,t=.5,r=1,n=1,c,h,p,s,v,w=va,T,I=!1,O;function D(N){return isNaN(N=+N)?O:(N=.5+((N=+T(N))-h)*(n*N<n*h?s:v),w(I?Math.max(0,Math.min(1,N)):N))}D.domain=function(N){return arguments.length?([e,t,r]=N,c=T(e=+e),h=T(t=+t),p=T(r=+r),s=c===h?0:.5/(h-c),v=h===p?0:.5/(p-h),n=h<c?-1:1,D):[e,t,r]},D.clamp=function(N){return arguments.length?(I=!!N,D):I},D.interpolator=function(N){return arguments.length?(w=N,D):w};function B(N){return function(G){var U,V,X;return arguments.length?([U,V,X]=G,w=ULe(N,[U,V,X]),D):[w(0),w(.5),w(1)]}}return D.range=B(yv),D.rangeRound=B(Oz),D.unknown=function(N){return arguments.length?(O=N,D):O},function(N){return T=N,c=N(e),h=N(t),p=N(r),s=c===h?0:.5/(h-c),v=h===p?0:.5/(p-h),n=h<c?-1:1,D}}function Pee(){var e=kf(nP()(va));return e.copy=function(){return Pf(e,Pee())},Vh.apply(e,arguments)}function Cee(){var e=Lz(nP()).domain([.1,1,10]);return e.copy=function(){return Pf(e,Cee()).base(e.base())},Vh.apply(e,arguments)}function Iee(){var e=zz(nP());return e.copy=function(){return Pf(e,Iee()).constant(e.constant())},Vh.apply(e,arguments)}function Kz(){var e=Nz(nP());return e.copy=function(){return Pf(e,Kz()).exponent(e.exponent())},Vh.apply(e,arguments)}function zze(){return Kz.apply(null,arguments).exponent(.5)}const aG=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:fw,scaleDiverging:Pee,scaleDivergingLog:Cee,scaleDivergingPow:Kz,scaleDivergingSqrt:zze,scaleDivergingSymlog:Iee,scaleIdentity:aee,scaleImplicit:RR,scaleLinear:WE,scaleLog:cee,scaleOrdinal:Cz,scalePoint:Pb,scalePow:Fz,scaleQuantile:dee,scaleQuantize:fee,scaleRadial:hee,scaleSequential:Tee,scaleSequentialLog:Eee,scaleSequentialPow:Zz,scaleSequentialQuantile:kee,scaleSequentialSqrt:Lze,scaleSequentialSymlog:Aee,scaleSqrt:h3e,scaleSymlog:uee,scaleThreshold:pee,scaleTime:Rze,scaleUtc:Dze,tickFormat:oee},Symbol.toStringTag,{value:"Module"}));var Nze=lv;function Fze(e,t,r){for(var n=-1,c=e.length;++n<c;){var h=e[n],p=t(h);if(p!=null&&(s===void 0?p===p&&!Nze(p):r(p,s)))var s=p,v=h}return v}var iP=Fze;function Bze(e,t){return e>t}var Mee=Bze,Vze=iP,Uze=Mee,$ze=mv;function Gze(e){return e&&e.length?Vze(e,$ze,Uze):void 0}var Hze=Gze;const sP=ki(Hze);function Wze(e,t){return e<t}var Oee=Wze,qze=iP,Zze=Oee,Kze=mv;function Xze(e){return e&&e.length?qze(e,Kze,Zze):void 0}var Yze=Xze;const oP=ki(Yze);var Jze=uz,Qze=Ou,eNe=NQ,tNe=Ka;function rNe(e,t){var r=tNe(e)?Jze:eNe;return r(e,Qze(t))}var nNe=rNe,iNe=LQ,sNe=nNe;function oNe(e,t){return iNe(sNe(e,t),1)}var aNe=oNe;const lNe=ki(aNe);var cNe=Ez;function uNe(e,t){return cNe(e,t)}var hNe=uNe;const aP=ki(hNe);var _v=1e9,dNe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Yz,ds=!0,Fl="[DecimalError] ",hm=Fl+"Invalid argument: ",Xz=Fl+"Exponent out of range: ",vv=Math.floor,Hp=Math.pow,fNe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,cl,go=1e7,as=7,jee=9007199254740991,XE=vv(jee/as),Lr={};Lr.absoluteValue=Lr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Lr.comparedTo=Lr.cmp=function(e){var t,r,n,c,h=this;if(e=new h.constructor(e),h.s!==e.s)return h.s||-e.s;if(h.e!==e.e)return h.e>e.e^h.s<0?1:-1;for(n=h.d.length,c=e.d.length,t=0,r=n<c?n:c;t<r;++t)if(h.d[t]!==e.d[t])return h.d[t]>e.d[t]^h.s<0?1:-1;return n===c?0:n>c^h.s<0?1:-1};Lr.decimalPlaces=Lr.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*as;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Lr.dividedBy=Lr.div=function(e){return bh(this,new this.constructor(e))};Lr.dividedToIntegerBy=Lr.idiv=function(e){var t=this,r=t.constructor;return Hi(bh(t,new r(e),0,1),r.precision)};Lr.equals=Lr.eq=function(e){return!this.cmp(e)};Lr.exponent=function(){return Vs(this)};Lr.greaterThan=Lr.gt=function(e){return this.cmp(e)>0};Lr.greaterThanOrEqualTo=Lr.gte=function(e){return this.cmp(e)>=0};Lr.isInteger=Lr.isint=function(){return this.e>this.d.length-2};Lr.isNegative=Lr.isneg=function(){return this.s<0};Lr.isPositive=Lr.ispos=function(){return this.s>0};Lr.isZero=function(){return this.s===0};Lr.lessThan=Lr.lt=function(e){return this.cmp(e)<0};Lr.lessThanOrEqualTo=Lr.lte=function(e){return this.cmp(e)<1};Lr.logarithm=Lr.log=function(e){var t,r=this,n=r.constructor,c=n.precision,h=c+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(cl))throw Error(Fl+"NaN");if(r.s<1)throw Error(Fl+(r.s?"NaN":"-Infinity"));return r.eq(cl)?new n(0):(ds=!1,t=bh(_w(r,h),_w(e,h),h),ds=!0,Hi(t,c))};Lr.minus=Lr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Lee(t,e):Ree(t,(e.s=-e.s,e))};Lr.modulo=Lr.mod=function(e){var t,r=this,n=r.constructor,c=n.precision;if(e=new n(e),!e.s)throw Error(Fl+"NaN");return r.s?(ds=!1,t=bh(r,e,0,1).times(e),ds=!0,r.minus(t)):Hi(new n(r),c)};Lr.naturalExponential=Lr.exp=function(){return Dee(this)};Lr.naturalLogarithm=Lr.ln=function(){return _w(this)};Lr.negated=Lr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Lr.plus=Lr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Ree(t,e):Lee(t,(e.s=-e.s,e))};Lr.precision=Lr.sd=function(e){var t,r,n,c=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(hm+e);if(t=Vs(c)+1,n=c.d.length-1,r=n*as+1,n=c.d[n],n){for(;n%10==0;n/=10)r--;for(n=c.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Lr.squareRoot=Lr.sqrt=function(){var e,t,r,n,c,h,p,s=this,v=s.constructor;if(s.s<1){if(!s.s)return new v(0);throw Error(Fl+"NaN")}for(e=Vs(s),ds=!1,c=Math.sqrt(+s),c==0||c==1/0?(t=mu(s.d),(t.length+e)%2==0&&(t+="0"),c=Math.sqrt(t),e=vv((e+1)/2)-(e<0||e%2),c==1/0?t="5e"+e:(t=c.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new v(t)):n=new v(c.toString()),r=v.precision,c=p=r+3;;)if(h=n,n=h.plus(bh(s,h,p+2)).times(.5),mu(h.d).slice(0,p)===(t=mu(n.d)).slice(0,p)){if(t=t.slice(p-3,p+1),c==p&&t=="4999"){if(Hi(h,r+1,0),h.times(h).eq(s)){n=h;break}}else if(t!="9999")break;p+=4}return ds=!0,Hi(n,r)};Lr.times=Lr.mul=function(e){var t,r,n,c,h,p,s,v,w,T=this,I=T.constructor,O=T.d,D=(e=new I(e)).d;if(!T.s||!e.s)return new I(0);for(e.s*=T.s,r=T.e+e.e,v=O.length,w=D.length,v<w&&(h=O,O=D,D=h,p=v,v=w,w=p),h=[],p=v+w,n=p;n--;)h.push(0);for(n=w;--n>=0;){for(t=0,c=v+n;c>n;)s=h[c]+D[n]*O[c-n-1]+t,h[c--]=s%go|0,t=s/go|0;h[c]=(h[c]+t)%go|0}for(;!h[--p];)h.pop();return t?++r:h.shift(),e.d=h,e.e=r,ds?Hi(e,I.precision):e};Lr.toDecimalPlaces=Lr.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Pu(e,0,_v),t===void 0?t=n.rounding:Pu(t,0,8),Hi(r,e+Vs(r)+1,t))};Lr.toExponential=function(e,t){var r,n=this,c=n.constructor;return e===void 0?r=Am(n,!0):(Pu(e,0,_v),t===void 0?t=c.rounding:Pu(t,0,8),n=Hi(new c(n),e+1,t),r=Am(n,!0,e+1)),r};Lr.toFixed=function(e,t){var r,n,c=this,h=c.constructor;return e===void 0?Am(c):(Pu(e,0,_v),t===void 0?t=h.rounding:Pu(t,0,8),n=Hi(new h(c),e+Vs(c)+1,t),r=Am(n.abs(),!1,e+Vs(n)+1),c.isneg()&&!c.isZero()?"-"+r:r)};Lr.toInteger=Lr.toint=function(){var e=this,t=e.constructor;return Hi(new t(e),Vs(e)+1,t.rounding)};Lr.toNumber=function(){return+this};Lr.toPower=Lr.pow=function(e){var t,r,n,c,h,p,s=this,v=s.constructor,w=12,T=+(e=new v(e));if(!e.s)return new v(cl);if(s=new v(s),!s.s){if(e.s<1)throw Error(Fl+"Infinity");return s}if(s.eq(cl))return s;if(n=v.precision,e.eq(cl))return Hi(s,n);if(t=e.e,r=e.d.length-1,p=t>=r,h=s.s,p){if((r=T<0?-T:T)<=jee){for(c=new v(cl),t=Math.ceil(n/as+4),ds=!1;r%2&&(c=c.times(s),cG(c.d,t)),r=vv(r/2),r!==0;)s=s.times(s),cG(s.d,t);return ds=!0,e.s<0?new v(cl).div(c):Hi(c,n)}}else if(h<0)throw Error(Fl+"NaN");return h=h<0&&e.d[Math.max(t,r)]&1?-1:1,s.s=1,ds=!1,c=e.times(_w(s,n+w)),ds=!0,c=Dee(c),c.s=h,c};Lr.toPrecision=function(e,t){var r,n,c=this,h=c.constructor;return e===void 0?(r=Vs(c),n=Am(c,r<=h.toExpNeg||r>=h.toExpPos)):(Pu(e,1,_v),t===void 0?t=h.rounding:Pu(t,0,8),c=Hi(new h(c),e,t),r=Vs(c),n=Am(c,e<=r||r<=h.toExpNeg,e)),n};Lr.toSignificantDigits=Lr.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Pu(e,1,_v),t===void 0?t=n.rounding:Pu(t,0,8)),Hi(new n(r),e,t)};Lr.toString=Lr.valueOf=Lr.val=Lr.toJSON=Lr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Vs(e),r=e.constructor;return Am(e,t<=r.toExpNeg||t>=r.toExpPos)};function Ree(e,t){var r,n,c,h,p,s,v,w,T=e.constructor,I=T.precision;if(!e.s||!t.s)return t.s||(t=new T(e)),ds?Hi(t,I):t;if(v=e.d,w=t.d,p=e.e,c=t.e,v=v.slice(),h=p-c,h){for(h<0?(n=v,h=-h,s=w.length):(n=w,c=p,s=v.length),p=Math.ceil(I/as),s=p>s?p+1:s+1,h>s&&(h=s,n.length=1),n.reverse();h--;)n.push(0);n.reverse()}for(s=v.length,h=w.length,s-h<0&&(h=s,n=w,w=v,v=n),r=0;h;)r=(v[--h]=v[h]+w[h]+r)/go|0,v[h]%=go;for(r&&(v.unshift(r),++c),s=v.length;v[--s]==0;)v.pop();return t.d=v,t.e=c,ds?Hi(t,I):t}function Pu(e,t,r){if(e!==~~e||e<t||e>r)throw Error(hm+e)}function mu(e){var t,r,n,c=e.length-1,h="",p=e[0];if(c>0){for(h+=p,t=1;t<c;t++)n=e[t]+"",r=as-n.length,r&&(h+=qd(r)),h+=n;p=e[t],n=p+"",r=as-n.length,r&&(h+=qd(r))}else if(p===0)return"0";for(;p%10===0;)p/=10;return h+p}var bh=function(){function e(n,c){var h,p=0,s=n.length;for(n=n.slice();s--;)h=n[s]*c+p,n[s]=h%go|0,p=h/go|0;return p&&n.unshift(p),n}function t(n,c,h,p){var s,v;if(h!=p)v=h>p?1:-1;else for(s=v=0;s<h;s++)if(n[s]!=c[s]){v=n[s]>c[s]?1:-1;break}return v}function r(n,c,h){for(var p=0;h--;)n[h]-=p,p=n[h]<c[h]?1:0,n[h]=p*go+n[h]-c[h];for(;!n[0]&&n.length>1;)n.shift()}return function(n,c,h,p){var s,v,w,T,I,O,D,B,N,G,U,V,X,Y,ne,ae,le,ge,je=n.constructor,ze=n.s==c.s?1:-1,Pe=n.d,Ke=c.d;if(!n.s)return new je(n);if(!c.s)throw Error(Fl+"Division by zero");for(v=n.e-c.e,le=Ke.length,ne=Pe.length,D=new je(ze),B=D.d=[],w=0;Ke[w]==(Pe[w]||0);)++w;if(Ke[w]>(Pe[w]||0)&&--v,h==null?V=h=je.precision:p?V=h+(Vs(n)-Vs(c))+1:V=h,V<0)return new je(0);if(V=V/as+2|0,w=0,le==1)for(T=0,Ke=Ke[0],V++;(w<ne||T)&&V--;w++)X=T*go+(Pe[w]||0),B[w]=X/Ke|0,T=X%Ke|0;else{for(T=go/(Ke[0]+1)|0,T>1&&(Ke=e(Ke,T),Pe=e(Pe,T),le=Ke.length,ne=Pe.length),Y=le,N=Pe.slice(0,le),G=N.length;G<le;)N[G++]=0;ge=Ke.slice(),ge.unshift(0),ae=Ke[0],Ke[1]>=go/2&&++ae;do T=0,s=t(Ke,N,le,G),s<0?(U=N[0],le!=G&&(U=U*go+(N[1]||0)),T=U/ae|0,T>1?(T>=go&&(T=go-1),I=e(Ke,T),O=I.length,G=N.length,s=t(I,N,O,G),s==1&&(T--,r(I,le<O?ge:Ke,O))):(T==0&&(s=T=1),I=Ke.slice()),O=I.length,O<G&&I.unshift(0),r(N,I,G),s==-1&&(G=N.length,s=t(Ke,N,le,G),s<1&&(T++,r(N,le<G?ge:Ke,G))),G=N.length):s===0&&(T++,N=[0]),B[w++]=T,s&&N[0]?N[G++]=Pe[Y]||0:(N=[Pe[Y]],G=1);while((Y++<ne||N[0]!==void 0)&&V--)}return B[0]||B.shift(),D.e=v,Hi(D,p?h+Vs(D)+1:h)}}();function Dee(e,t){var r,n,c,h,p,s,v=0,w=0,T=e.constructor,I=T.precision;if(Vs(e)>16)throw Error(Xz+Vs(e));if(!e.s)return new T(cl);for(ds=!1,s=I,p=new T(.03125);e.abs().gte(.1);)e=e.times(p),w+=5;for(n=Math.log(Hp(2,w))/Math.LN10*2+5|0,s+=n,r=c=h=new T(cl),T.precision=s;;){if(c=Hi(c.times(e),s),r=r.times(++v),p=h.plus(bh(c,r,s)),mu(p.d).slice(0,s)===mu(h.d).slice(0,s)){for(;w--;)h=Hi(h.times(h),s);return T.precision=I,t==null?(ds=!0,Hi(h,I)):h}h=p}}function Vs(e){for(var t=e.e*as,r=e.d[0];r>=10;r/=10)t++;return t}function qM(e,t,r){if(t>e.LN10.sd())throw ds=!0,r&&(e.precision=r),Error(Fl+"LN10 precision limit exceeded");return Hi(new e(e.LN10),t)}function qd(e){for(var t="";e--;)t+="0";return t}function _w(e,t){var r,n,c,h,p,s,v,w,T,I=1,O=10,D=e,B=D.d,N=D.constructor,G=N.precision;if(D.s<1)throw Error(Fl+(D.s?"NaN":"-Infinity"));if(D.eq(cl))return new N(0);if(t==null?(ds=!1,w=G):w=t,D.eq(10))return t==null&&(ds=!0),qM(N,w);if(w+=O,N.precision=w,r=mu(B),n=r.charAt(0),h=Vs(D),Math.abs(h)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)D=D.times(e),r=mu(D.d),n=r.charAt(0),I++;h=Vs(D),n>1?(D=new N("0."+r),h++):D=new N(n+"."+r.slice(1))}else return v=qM(N,w+2,G).times(h+""),D=_w(new N(n+"."+r.slice(1)),w-O).plus(v),N.precision=G,t==null?(ds=!0,Hi(D,G)):D;for(s=p=D=bh(D.minus(cl),D.plus(cl),w),T=Hi(D.times(D),w),c=3;;){if(p=Hi(p.times(T),w),v=s.plus(bh(p,new N(c),w)),mu(v.d).slice(0,w)===mu(s.d).slice(0,w))return s=s.times(2),h!==0&&(s=s.plus(qM(N,w+2,G).times(h+""))),s=bh(s,new N(I),w),N.precision=G,t==null?(ds=!0,Hi(s,G)):s;s=v,c+=2}}function lG(e,t){var r,n,c;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(c=t.length;t.charCodeAt(c-1)===48;)--c;if(t=t.slice(n,c),t){if(c-=n,r=r-n-1,e.e=vv(r/as),e.d=[],n=(r+1)%as,r<0&&(n+=as),n<c){for(n&&e.d.push(+t.slice(0,n)),c-=as;n<c;)e.d.push(+t.slice(n,n+=as));t=t.slice(n),n=as-t.length}else n-=c;for(;n--;)t+="0";if(e.d.push(+t),ds&&(e.e>XE||e.e<-XE))throw Error(Xz+r)}else e.s=0,e.e=0,e.d=[0];return e}function Hi(e,t,r){var n,c,h,p,s,v,w,T,I=e.d;for(p=1,h=I[0];h>=10;h/=10)p++;if(n=t-p,n<0)n+=as,c=t,w=I[T=0];else{if(T=Math.ceil((n+1)/as),h=I.length,T>=h)return e;for(w=h=I[T],p=1;h>=10;h/=10)p++;n%=as,c=n-as+p}if(r!==void 0&&(h=Hp(10,p-c-1),s=w/h%10|0,v=t<0||I[T+1]!==void 0||w%h,v=r<4?(s||v)&&(r==0||r==(e.s<0?3:2)):s>5||s==5&&(r==4||v||r==6&&(n>0?c>0?w/Hp(10,p-c):0:I[T-1])%10&1||r==(e.s<0?8:7))),t<1||!I[0])return v?(h=Vs(e),I.length=1,t=t-h-1,I[0]=Hp(10,(as-t%as)%as),e.e=vv(-t/as)||0):(I.length=1,I[0]=e.e=e.s=0),e;if(n==0?(I.length=T,h=1,T--):(I.length=T+1,h=Hp(10,as-n),I[T]=c>0?(w/Hp(10,p-c)%Hp(10,c)|0)*h:0),v)for(;;)if(T==0){(I[0]+=h)==go&&(I[0]=1,++e.e);break}else{if(I[T]+=h,I[T]!=go)break;I[T--]=0,h=1}for(n=I.length;I[--n]===0;)I.pop();if(ds&&(e.e>XE||e.e<-XE))throw Error(Xz+Vs(e));return e}function Lee(e,t){var r,n,c,h,p,s,v,w,T,I,O=e.constructor,D=O.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new O(e),ds?Hi(t,D):t;if(v=e.d,I=t.d,n=t.e,w=e.e,v=v.slice(),p=w-n,p){for(T=p<0,T?(r=v,p=-p,s=I.length):(r=I,n=w,s=v.length),c=Math.max(Math.ceil(D/as),s)+2,p>c&&(p=c,r.length=1),r.reverse(),c=p;c--;)r.push(0);r.reverse()}else{for(c=v.length,s=I.length,T=c<s,T&&(s=c),c=0;c<s;c++)if(v[c]!=I[c]){T=v[c]<I[c];break}p=0}for(T&&(r=v,v=I,I=r,t.s=-t.s),s=v.length,c=I.length-s;c>0;--c)v[s++]=0;for(c=I.length;c>p;){if(v[--c]<I[c]){for(h=c;h&&v[--h]===0;)v[h]=go-1;--v[h],v[c]+=go}v[c]-=I[c]}for(;v[--s]===0;)v.pop();for(;v[0]===0;v.shift())--n;return v[0]?(t.d=v,t.e=n,ds?Hi(t,D):t):new O(0)}function Am(e,t,r){var n,c=Vs(e),h=mu(e.d),p=h.length;return t?(r&&(n=r-p)>0?h=h.charAt(0)+"."+h.slice(1)+qd(n):p>1&&(h=h.charAt(0)+"."+h.slice(1)),h=h+(c<0?"e":"e+")+c):c<0?(h="0."+qd(-c-1)+h,r&&(n=r-p)>0&&(h+=qd(n))):c>=p?(h+=qd(c+1-p),r&&(n=r-c-1)>0&&(h=h+"."+qd(n))):((n=c+1)<p&&(h=h.slice(0,n)+"."+h.slice(n)),r&&(n=r-p)>0&&(c+1===p&&(h+="."),h+=qd(n))),e.s<0?"-"+h:h}function cG(e,t){if(e.length>t)return e.length=t,!0}function zee(e){var t,r,n;function c(h){var p=this;if(!(p instanceof c))return new c(h);if(p.constructor=c,h instanceof c){p.s=h.s,p.e=h.e,p.d=(h=h.d)?h.slice():h;return}if(typeof h=="number"){if(h*0!==0)throw Error(hm+h);if(h>0)p.s=1;else if(h<0)h=-h,p.s=-1;else{p.s=0,p.e=0,p.d=[0];return}if(h===~~h&&h<1e7){p.e=0,p.d=[h];return}return lG(p,h.toString())}else if(typeof h!="string")throw Error(hm+h);if(h.charCodeAt(0)===45?(h=h.slice(1),p.s=-1):p.s=1,fNe.test(h))lG(p,h);else throw Error(hm+h)}if(c.prototype=Lr,c.ROUND_UP=0,c.ROUND_DOWN=1,c.ROUND_CEIL=2,c.ROUND_FLOOR=3,c.ROUND_HALF_UP=4,c.ROUND_HALF_DOWN=5,c.ROUND_HALF_EVEN=6,c.ROUND_HALF_CEIL=7,c.ROUND_HALF_FLOOR=8,c.clone=zee,c.config=c.set=pNe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return c.config(e),c}function pNe(e){if(!e||typeof e!="object")throw Error(Fl+"Object expected");var t,r,n,c=["precision",1,_v,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<c.length;t+=3)if((n=e[r=c[t]])!==void 0)if(vv(n)===n&&n>=c[t+1]&&n<=c[t+2])this[r]=n;else throw Error(hm+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(hm+r+": "+n);return this}var Yz=zee(dNe);cl=new Yz(1);const Vi=Yz;function mNe(e){return vNe(e)||_Ne(e)||yNe(e)||gNe()}function gNe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yNe(e,t){if(e){if(typeof e=="string")return NR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return NR(e,t)}}function _Ne(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function vNe(e){if(Array.isArray(e))return NR(e)}function NR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var xNe=function(e){return e},Nee={},Fee=function(e){return e===Nee},uG=function(e){return function t(){return arguments.length===0||arguments.length===1&&Fee(arguments.length<=0?void 0:arguments[0])?t:e.apply(void 0,arguments)}},bNe=function e(t,r){return t===1?r:uG(function(){for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];var p=c.filter(function(s){return s!==Nee}).length;return p>=t?r.apply(void 0,c):e(t-p,uG(function(){for(var s=arguments.length,v=new Array(s),w=0;w<s;w++)v[w]=arguments[w];var T=c.map(function(I){return Fee(I)?v.shift():I});return r.apply(void 0,mNe(T).concat(v))}))})},lP=function(e){return bNe(e.length,e)},FR=function(e,t){for(var r=[],n=e;n<t;++n)r[n-e]=n;return r},wNe=lP(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),SNe=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!t.length)return xNe;var n=t.reverse(),c=n[0],h=n.slice(1);return function(){return h.reduce(function(p,s){return s(p)},c.apply(void 0,arguments))}},BR=function(e){return Array.isArray(e)?e.reverse():e.split("").reverse.join("")},Bee=function(e){var t=null,r=null;return function(){for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];return t&&c.every(function(p,s){return p===t[s]})||(t=c,r=e.apply(void 0,c)),r}};function TNe(e){var t;return e===0?t=1:t=Math.floor(new Vi(e).abs().log(10).toNumber())+1,t}function ENe(e,t,r){for(var n=new Vi(e),c=0,h=[];n.lt(t)&&c<1e5;)h.push(n.toNumber()),n=n.add(r),c++;return h}var ANe=lP(function(e,t,r){var n=+e,c=+t;return n+r*(c-n)}),kNe=lP(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),PNe=lP(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const cP={rangeStep:ENe,getDigitCount:TNe,interpolateNumber:ANe,uninterpolateNumber:kNe,uninterpolateTruncation:PNe};function VR(e){return MNe(e)||INe(e)||Vee(e)||CNe()}function CNe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function INe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function MNe(e){if(Array.isArray(e))return UR(e)}function vw(e,t){return RNe(e)||jNe(e,t)||Vee(e,t)||ONe()}function ONe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vee(e,t){if(e){if(typeof e=="string")return UR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return UR(e,t)}}function UR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function jNe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,c=!1,h=void 0;try{for(var p=e[Symbol.iterator](),s;!(n=(s=p.next()).done)&&(r.push(s.value),!(t&&r.length===t));n=!0);}catch(v){c=!0,h=v}finally{try{!n&&p.return!=null&&p.return()}finally{if(c)throw h}}return r}}function RNe(e){if(Array.isArray(e))return e}function Uee(e){var t=vw(e,2),r=t[0],n=t[1],c=r,h=n;return r>n&&(c=n,h=r),[c,h]}function $ee(e,t,r){if(e.lte(0))return new Vi(0);var n=cP.getDigitCount(e.toNumber()),c=new Vi(10).pow(n),h=e.div(c),p=n!==1?.05:.1,s=new Vi(Math.ceil(h.div(p).toNumber())).add(r).mul(p),v=s.mul(c);return t?v:new Vi(Math.ceil(v))}function DNe(e,t,r){var n=1,c=new Vi(e);if(!c.isint()&&r){var h=Math.abs(e);h<1?(n=new Vi(10).pow(cP.getDigitCount(e)-1),c=new Vi(Math.floor(c.div(n).toNumber())).mul(n)):h>1&&(c=new Vi(Math.floor(e)))}else e===0?c=new Vi(Math.floor((t-1)/2)):r||(c=new Vi(Math.floor(e)));var p=Math.floor((t-1)/2),s=SNe(wNe(function(v){return c.add(new Vi(v-p).mul(n)).toNumber()}),FR);return s(0,t)}function Gee(e,t,r,n){var c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Vi(0),tickMin:new Vi(0),tickMax:new Vi(0)};var h=$ee(new Vi(t).sub(e).div(r-1),n,c),p;e<=0&&t>=0?p=new Vi(0):(p=new Vi(e).add(t).div(2),p=p.sub(new Vi(p).mod(h)));var s=Math.ceil(p.sub(e).div(h).toNumber()),v=Math.ceil(new Vi(t).sub(p).div(h).toNumber()),w=s+v+1;return w>r?Gee(e,t,r,n,c+1):(w<r&&(v=t>0?v+(r-w):v,s=t>0?s:s+(r-w)),{step:h,tickMin:p.sub(new Vi(s).mul(h)),tickMax:p.add(new Vi(v).mul(h))})}function LNe(e){var t=vw(e,2),r=t[0],n=t[1],c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,p=Math.max(c,2),s=Uee([r,n]),v=vw(s,2),w=v[0],T=v[1];if(w===-1/0||T===1/0){var I=T===1/0?[w].concat(VR(FR(0,c-1).map(function(){return 1/0}))):[].concat(VR(FR(0,c-1).map(function(){return-1/0})),[T]);return r>n?BR(I):I}if(w===T)return DNe(w,c,h);var O=Gee(w,T,p,h),D=O.step,B=O.tickMin,N=O.tickMax,G=cP.rangeStep(B,N.add(new Vi(.1).mul(D)),D);return r>n?BR(G):G}function zNe(e,t){var r=vw(e,2),n=r[0],c=r[1],h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,p=Uee([n,c]),s=vw(p,2),v=s[0],w=s[1];if(v===-1/0||w===1/0)return[n,c];if(v===w)return[v];var T=Math.max(t,2),I=$ee(new Vi(w).sub(v).div(T-1),h,0),O=[].concat(VR(cP.rangeStep(new Vi(v),new Vi(w).sub(new Vi(.99).mul(I)),I)),[w]);return n>c?BR(O):O}var NNe=Bee(LNe),FNe=Bee(zNe),BNe="Invariant failed";function km(e,t){throw new Error(BNe)}var VNe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function I_(e){"@babel/helpers - typeof";return I_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I_(e)}function YE(){return YE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},YE.apply(this,arguments)}function UNe(e,t){return WNe(e)||HNe(e,t)||GNe(e,t)||$Ne()}function $Ne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GNe(e,t){if(e){if(typeof e=="string")return hG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hG(e,t)}}function hG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function HNe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function WNe(e){if(Array.isArray(e))return e}function qNe(e,t){if(e==null)return{};var r=ZNe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ZNe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function KNe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XNe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qee(n.key),n)}}function YNe(e,t,r){return t&&XNe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function JNe(e,t,r){return t=JE(t),QNe(e,Hee()?Reflect.construct(t,r||[],JE(e).constructor):t.apply(e,r))}function QNe(e,t){if(t&&(I_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eFe(e)}function eFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Hee=function(){return!!e})()}function JE(e){return JE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},JE(e)}function tFe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$R(e,t)}function $R(e,t){return $R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},$R(e,t)}function Wee(e,t,r){return t=qee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qee(e){var t=rFe(e,"string");return I_(t)=="symbol"?t:t+""}function rFe(e,t){if(I_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(I_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var uP=function(e){function t(){return KNe(this,t),JNe(this,t,arguments)}return tFe(t,e),YNe(t,[{key:"render",value:function(){var r=this.props,n=r.offset,c=r.layout,h=r.width,p=r.dataKey,s=r.data,v=r.dataPointFormatter,w=r.xAxis,T=r.yAxis,I=qNe(r,VNe),O=Sn(I,!1);this.props.direction==="x"&&w.type!=="number"&&km();var D=s.map(function(B){var N=v(B,p),G=N.x,U=N.y,V=N.value,X=N.errorVal;if(!X)return null;var Y=[],ne,ae;if(Array.isArray(X)){var le=UNe(X,2);ne=le[0],ae=le[1]}else ne=ae=X;if(c==="vertical"){var ge=w.scale,je=U+n,ze=je+h,Pe=je-h,Ke=ge(V-ne),Ye=ge(V+ae);Y.push({x1:Ye,y1:ze,x2:Ye,y2:Pe}),Y.push({x1:Ke,y1:je,x2:Ye,y2:je}),Y.push({x1:Ke,y1:ze,x2:Ke,y2:Pe})}else if(c==="horizontal"){var Oe=T.scale,tt=G+n,We=tt-h,lt=tt+h,rt=Oe(V-ne),ht=Oe(V+ae);Y.push({x1:We,y1:ht,x2:lt,y2:ht}),Y.push({x1:tt,y1:rt,x2:tt,y2:ht}),Y.push({x1:We,y1:rt,x2:lt,y2:rt})}return Ne.createElement(Li,YE({className:"recharts-errorBar",key:"bar-".concat(Y.map(function(vt){return"".concat(vt.x1,"-").concat(vt.x2,"-").concat(vt.y1,"-").concat(vt.y2)}))},O),Y.map(function(vt){return Ne.createElement("line",YE({},vt,{key:"line-".concat(vt.x1,"-").concat(vt.x2,"-").concat(vt.y1,"-").concat(vt.y2)}))}))});return Ne.createElement(Li,{className:"recharts-errorBars"},D)}}])}(Ne.Component);Wee(uP,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});Wee(uP,"displayName","ErrorBar");function xw(e){"@babel/helpers - typeof";return xw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xw(e)}function dG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Lp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dG(Object(r),!0).forEach(function(n){nFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nFe(e,t,r){return t=iFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function iFe(e){var t=sFe(e,"string");return xw(t)=="symbol"?t:t+""}function sFe(e,t){if(xw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Zee=function(e){var t=e.children,r=e.formattedGraphicalItems,n=e.legendWidth,c=e.legendContent,h=ol(t,o_);if(!h)return null;var p=o_.defaultProps,s=p!==void 0?Lp(Lp({},p),h.props):{},v;return h.props&&h.props.payload?v=h.props&&h.props.payload:c==="children"?v=(r||[]).reduce(function(w,T){var I=T.item,O=T.props,D=O.sectors||O.data||[];return w.concat(D.map(function(B){return{type:h.props.iconType||I.props.legendType,value:B.name,color:B.fill,payload:B}}))},[]):v=(r||[]).map(function(w){var T=w.item,I=T.type.defaultProps,O=I!==void 0?Lp(Lp({},I),T.props):{},D=O.dataKey,B=O.name,N=O.legendType,G=O.hide;return{inactive:G,dataKey:D,type:s.iconType||N||"square",color:Jz(T),value:B||D,payload:O}}),Lp(Lp(Lp({},s),o_.getWithHeight(h,n)),{},{payload:v,item:h})};function bw(e){"@babel/helpers - typeof";return bw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bw(e)}function fG(e){return cFe(e)||lFe(e)||aFe(e)||oFe()}function oFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aFe(e,t){if(e){if(typeof e=="string")return GR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return GR(e,t)}}function lFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function cFe(e){if(Array.isArray(e))return GR(e)}function GR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function As(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pG(Object(r),!0).forEach(function(n){l_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l_(e,t,r){return t=uFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uFe(e){var t=hFe(e,"string");return bw(t)=="symbol"?t:t+""}function hFe(e,t){if(bw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jo(e,t,r){return ni(e)||ni(t)?r:io(t)?fl(e,t,r):Cn(t)?t(e):r}function O2(e,t,r,n){var c=lNe(e,function(s){return Jo(s,t)});if(r==="number"){var h=c.filter(function(s){return fr(s)||parseFloat(s)});return h.length?[oP(h),sP(h)]:[1/0,-1/0]}var p=n?c.filter(function(s){return!ni(s)}):c;return p.map(function(s){return io(s)||s instanceof Date?s:""})}var dFe=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0,h=-1,p=(t=r?.length)!==null&&t!==void 0?t:0;if(p<=1)return 0;if(c&&c.axisType==="angleAxis"&&Math.abs(Math.abs(c.range[1]-c.range[0])-360)<=1e-6)for(var s=c.range,v=0;v<p;v++){var w=v>0?n[v-1].coordinate:n[p-1].coordinate,T=n[v].coordinate,I=v>=p-1?n[0].coordinate:n[v+1].coordinate,O=void 0;if(ya(T-w)!==ya(I-T)){var D=[];if(ya(I-T)===ya(s[1]-s[0])){O=I;var B=T+s[1]-s[0];D[0]=Math.min(B,(B+w)/2),D[1]=Math.max(B,(B+w)/2)}else{O=w;var N=I+s[1]-s[0];D[0]=Math.min(T,(N+T)/2),D[1]=Math.max(T,(N+T)/2)}var G=[Math.min(T,(O+T)/2),Math.max(T,(O+T)/2)];if(e>G[0]&&e<=G[1]||e>=D[0]&&e<=D[1]){h=n[v].index;break}}else{var U=Math.min(w,I),V=Math.max(w,I);if(e>(U+T)/2&&e<=(V+T)/2){h=n[v].index;break}}}else for(var X=0;X<p;X++)if(X===0&&e<=(r[X].coordinate+r[X+1].coordinate)/2||X>0&&X<p-1&&e>(r[X].coordinate+r[X-1].coordinate)/2&&e<=(r[X].coordinate+r[X+1].coordinate)/2||X===p-1&&e>(r[X].coordinate+r[X-1].coordinate)/2){h=r[X].index;break}return h},Jz=function(e){var t,r=e,n=r.type.displayName,c=(t=e.type)!==null&&t!==void 0&&t.defaultProps?As(As({},e.type.defaultProps),e.props):e.props,h=c.stroke,p=c.fill,s;switch(n){case"Line":s=h;break;case"Area":case"Radar":s=h&&h!=="none"?h:p;break;default:s=p;break}return s},fFe=function(e){var t=e.barSize,r=e.totalSize,n=e.stackGroups,c=n===void 0?{}:n;if(!c)return{};for(var h={},p=Object.keys(c),s=0,v=p.length;s<v;s++)for(var w=c[p[s]].stackGroups,T=Object.keys(w),I=0,O=T.length;I<O;I++){var D=w[T[I]],B=D.items,N=D.cateAxisId,G=B.filter(function(ae){return xh(ae.type).indexOf("Bar")>=0});if(G&&G.length){var U=G[0].type.defaultProps,V=U!==void 0?As(As({},U),G[0].props):G[0].props,X=V.barSize,Y=V[N];h[Y]||(h[Y]=[]);var ne=ni(X)?t:X;h[Y].push({item:G[0],stackList:G.slice(1),barSize:ni(ne)?void 0:_a(ne,r,0)})}}return h},pFe=function(e){var t=e.barGap,r=e.barCategoryGap,n=e.bandSize,c=e.sizeList,h=c===void 0?[]:c,p=e.maxBarSize,s=h.length;if(s<1)return null;var v=_a(t,n,0,!0),w,T=[];if(h[0].barSize===+h[0].barSize){var I=!1,O=n/s,D=h.reduce(function(X,Y){return X+Y.barSize||0},0);D+=(s-1)*v,D>=n&&(D-=(s-1)*v,v=0),D>=n&&O>0&&(I=!0,O*=.9,D=s*O);var B=(n-D)/2>>0,N={offset:B-v,size:0};w=h.reduce(function(X,Y){var ne={item:Y.item,position:{offset:N.offset+N.size+v,size:I?O:Y.barSize}},ae=[].concat(fG(X),[ne]);return N=ae[ae.length-1].position,Y.stackList&&Y.stackList.length&&Y.stackList.forEach(function(le){ae.push({item:le,position:N})}),ae},T)}else{var G=_a(r,n,0,!0);n-2*G-(s-1)*v<=0&&(v=0);var U=(n-2*G-(s-1)*v)/s;U>1&&(U>>=0);var V=p===+p?Math.min(U,p):U;w=h.reduce(function(X,Y,ne){var ae=[].concat(fG(X),[{item:Y.item,position:{offset:G+(U+v)*ne+(U-V)/2,size:V}}]);return Y.stackList&&Y.stackList.length&&Y.stackList.forEach(function(le){ae.push({item:le,position:ae[ae.length-1].position})}),ae},T)}return w},mFe=function(e,t,r,n){var c=r.children,h=r.width,p=r.margin,s=h-(p.left||0)-(p.right||0),v=Zee({children:c,legendWidth:s});if(v){var w=n||{},T=w.width,I=w.height,O=v.align,D=v.verticalAlign,B=v.layout;if((B==="vertical"||B==="horizontal"&&D==="middle")&&O!=="center"&&fr(e[O]))return As(As({},e),{},l_({},O,e[O]+(T||0)));if((B==="horizontal"||B==="vertical"&&O==="center")&&D!=="middle"&&fr(e[D]))return As(As({},e),{},l_({},D,e[D]+(I||0)))}return e},gFe=function(e,t,r){return ni(t)?!0:e==="horizontal"?t==="yAxis":e==="vertical"||r==="x"?t==="xAxis":r==="y"?t==="yAxis":!0},Kee=function(e,t,r,n,c){var h=t.props.children,p=Ll(h,uP).filter(function(v){return gFe(n,c,v.props.direction)});if(p&&p.length){var s=p.map(function(v){return v.props.dataKey});return e.reduce(function(v,w){var T=Jo(w,r);if(ni(T))return v;var I=Array.isArray(T)?[oP(T),sP(T)]:[T,T],O=s.reduce(function(D,B){var N=Jo(w,B,0),G=I[0]-Math.abs(Array.isArray(N)?N[0]:N),U=I[1]+Math.abs(Array.isArray(N)?N[1]:N);return[Math.min(G,D[0]),Math.max(U,D[1])]},[1/0,-1/0]);return[Math.min(O[0],v[0]),Math.max(O[1],v[1])]},[1/0,-1/0])}return null},yFe=function(e,t,r,n,c){var h=t.map(function(p){return Kee(e,p,r,c,n)}).filter(function(p){return!ni(p)});return h&&h.length?h.reduce(function(p,s){return[Math.min(p[0],s[0]),Math.max(p[1],s[1])]},[1/0,-1/0]):null},Xee=function(e,t,r,n,c){var h=t.map(function(s){var v=s.props.dataKey;return r==="number"&&v&&Kee(e,s,v,n)||O2(e,v,r,c)});if(r==="number")return h.reduce(function(s,v){return[Math.min(s[0],v[0]),Math.max(s[1],v[1])]},[1/0,-1/0]);var p={};return h.reduce(function(s,v){for(var w=0,T=v.length;w<T;w++)p[v[w]]||(p[v[w]]=!0,s.push(v[w]));return s},[])},Yee=function(e,t){return e==="horizontal"&&t==="xAxis"||e==="vertical"&&t==="yAxis"||e==="centric"&&t==="angleAxis"||e==="radial"&&t==="radiusAxis"},Jee=function(e,t,r,n){if(n)return e.map(function(s){return s.coordinate});var c,h,p=e.map(function(s){return s.coordinate===t&&(c=!0),s.coordinate===r&&(h=!0),s.coordinate});return c||p.push(t),h||p.push(r),p},_h=function(e,t,r){if(!e)return null;var n=e.scale,c=e.duplicateDomain,h=e.type,p=e.range,s=e.realScaleType==="scaleBand"?n.bandwidth()/2:2,v=(t||r)&&h==="category"&&n.bandwidth?n.bandwidth()/s:0;if(v=e.axisType==="angleAxis"&&p?.length>=2?ya(p[0]-p[1])*2*v:v,t&&(e.ticks||e.niceTicks)){var w=(e.ticks||e.niceTicks).map(function(T){var I=c?c.indexOf(T):T;return{coordinate:n(I)+v,value:T,offset:v}});return w.filter(function(T){return!s1(T.coordinate)})}return e.isCategorical&&e.categoricalDomain?e.categoricalDomain.map(function(T,I){return{coordinate:n(T)+v,value:T,index:I,offset:v}}):n.ticks&&!r?n.ticks(e.tickCount).map(function(T){return{coordinate:n(T)+v,value:T,offset:v}}):n.domain().map(function(T,I){return{coordinate:n(T)+v,value:c?c[T]:T,index:I,offset:v}})},ZM=new WeakMap,n2=function(e,t){if(typeof t!="function")return e;ZM.has(e)||ZM.set(e,new WeakMap);var r=ZM.get(e);if(r.has(t))return r.get(t);var n=function(){e.apply(void 0,arguments),t.apply(void 0,arguments)};return r.set(t,n),n},Qee=function(e,t,r){var n=e.scale,c=e.type,h=e.layout,p=e.axisType;if(n==="auto")return h==="radial"&&p==="radiusAxis"?{scale:fw(),realScaleType:"band"}:h==="radial"&&p==="angleAxis"?{scale:WE(),realScaleType:"linear"}:c==="category"&&t&&(t.indexOf("LineChart")>=0||t.indexOf("AreaChart")>=0||t.indexOf("ComposedChart")>=0&&!r)?{scale:Pb(),realScaleType:"point"}:c==="category"?{scale:fw(),realScaleType:"band"}:{scale:WE(),realScaleType:"linear"};if(Sm(n)){var s="scale".concat(Hk(n));return{scale:(aG[s]||Pb)(),realScaleType:aG[s]?s:"point"}}return Cn(n)?{scale:n}:{scale:Pb(),realScaleType:"point"}},mG=1e-4,ete=function(e){var t=e.domain();if(!(!t||t.length<=2)){var r=t.length,n=e.range(),c=Math.min(n[0],n[1])-mG,h=Math.max(n[0],n[1])+mG,p=e(t[0]),s=e(t[r-1]);(p<c||p>h||s<c||s>h)&&e.domain([t[0],t[r-1]])}},_Fe=function(e,t){if(!e)return null;for(var r=0,n=e.length;r<n;r++)if(e[r].item===t)return e[r].position;return null},vFe=function(e,t){if(!t||t.length!==2||!fr(t[0])||!fr(t[1]))return e;var r=Math.min(t[0],t[1]),n=Math.max(t[0],t[1]),c=[e[0],e[1]];return(!fr(e[0])||e[0]<r)&&(c[0]=r),(!fr(e[1])||e[1]>n)&&(c[1]=n),c[0]>n&&(c[0]=n),c[1]<r&&(c[1]=r),c},xFe=function(e){var t=e.length;if(!(t<=0))for(var r=0,n=e[0].length;r<n;++r)for(var c=0,h=0,p=0;p<t;++p){var s=s1(e[p][r][1])?e[p][r][0]:e[p][r][1];s>=0?(e[p][r][0]=c,e[p][r][1]=c+s,c=e[p][r][1]):(e[p][r][0]=h,e[p][r][1]=h+s,h=e[p][r][1])}},bFe=function(e){var t=e.length;if(!(t<=0))for(var r=0,n=e[0].length;r<n;++r)for(var c=0,h=0;h<t;++h){var p=s1(e[h][r][1])?e[h][r][0]:e[h][r][1];p>=0?(e[h][r][0]=c,e[h][r][1]=c+p,c=e[h][r][1]):(e[h][r][0]=0,e[h][r][1]=0)}},wFe={sign:xFe,expand:RAe,none:w_,silhouette:DAe,wiggle:LAe,positive:bFe},SFe=function(e,t,r){var n=t.map(function(p){return p.props.dataKey}),c=wFe[r],h=jAe().keys(n).value(function(p,s){return+Jo(p,s,0)}).order(gR).offset(c);return h(e)},TFe=function(e,t,r,n,c,h){if(!e)return null;var p=h?t.reverse():t,s={},v=p.reduce(function(T,I){var O,D=(O=I.type)!==null&&O!==void 0&&O.defaultProps?As(As({},I.type.defaultProps),I.props):I.props,B=D.stackId,N=D.hide;if(N)return T;var G=D[r],U=T[G]||{hasStack:!1,stackGroups:{}};if(io(B)){var V=U.stackGroups[B]||{numericAxisId:r,cateAxisId:n,items:[]};V.items.push(I),U.hasStack=!0,U.stackGroups[B]=V}else U.stackGroups[o1("_stackId_")]={numericAxisId:r,cateAxisId:n,items:[I]};return As(As({},T),{},l_({},G,U))},s),w={};return Object.keys(v).reduce(function(T,I){var O=v[I];if(O.hasStack){var D={};O.stackGroups=Object.keys(O.stackGroups).reduce(function(B,N){var G=O.stackGroups[N];return As(As({},B),{},l_({},N,{numericAxisId:r,cateAxisId:n,items:G.items,stackedData:SFe(e,G.items,c)}))},D)}return As(As({},T),{},l_({},I,O))},w)},tte=function(e,t){var r=t.realScaleType,n=t.type,c=t.tickCount,h=t.originalDomain,p=t.allowDecimals,s=r||t.scale;if(s!=="auto"&&s!=="linear")return null;if(c&&n==="number"&&h&&(h[0]==="auto"||h[1]==="auto")){var v=e.domain();if(!v.length)return null;var w=NNe(v,c,p);return e.domain([oP(w),sP(w)]),{niceTicks:w}}if(c&&n==="number"){var T=e.domain(),I=FNe(T,c,p);return{niceTicks:I}}return null},gG=function(e){var t=e.axis,r=e.ticks,n=e.offset,c=e.bandSize,h=e.entry,p=e.index;if(t.type==="category")return r[p]?r[p].coordinate+n:null;var s=Jo(h,t.dataKey,t.domain[p]);return ni(s)?null:t.scale(s)-c/2+n},EFe=function(e){var t=e.numericAxis,r=t.scale.domain();if(t.type==="number"){var n=Math.min(r[0],r[1]),c=Math.max(r[0],r[1]);return n<=0&&c>=0?0:c<0?c:n}return r[0]},AFe=function(e,t){var r,n=(r=e.type)!==null&&r!==void 0&&r.defaultProps?As(As({},e.type.defaultProps),e.props):e.props,c=n.stackId;if(io(c)){var h=t[c];if(h){var p=h.items.indexOf(e);return p>=0?h.stackedData[p]:null}}return null},kFe=function(e){return e.reduce(function(t,r){return[oP(r.concat([t[0]]).filter(fr)),sP(r.concat([t[1]]).filter(fr))]},[1/0,-1/0])},rte=function(e,t,r){return Object.keys(e).reduce(function(n,c){var h=e[c],p=h.stackedData,s=p.reduce(function(v,w){var T=kFe(w.slice(t,r+1));return[Math.min(v[0],T[0]),Math.max(v[1],T[1])]},[1/0,-1/0]);return[Math.min(s[0],n[0]),Math.max(s[1],n[1])]},[1/0,-1/0]).map(function(n){return n===1/0||n===-1/0?0:n})},yG=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,_G=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,HR=function(e,t,r){if(Cn(e))return e(t,r);if(!Array.isArray(e))return t;var n=[];if(fr(e[0]))n[0]=r?e[0]:Math.min(e[0],t[0]);else if(yG.test(e[0])){var c=+yG.exec(e[0])[1];n[0]=t[0]-c}else Cn(e[0])?n[0]=e[0](t[0]):n[0]=t[0];if(fr(e[1]))n[1]=r?e[1]:Math.max(e[1],t[1]);else if(_G.test(e[1])){var h=+_G.exec(e[1])[1];n[1]=t[1]+h}else Cn(e[1])?n[1]=e[1](t[1]):n[1]=t[1];return n},QE=function(e,t,r){if(e&&e.scale&&e.scale.bandwidth){var n=e.scale.bandwidth();if(!r||n>0)return n}if(e&&t&&t.length>=2){for(var c=kz(t,function(T){return T.coordinate}),h=1/0,p=1,s=c.length;p<s;p++){var v=c[p],w=c[p-1];h=Math.min((v.coordinate||0)-(w.coordinate||0),h)}return h===1/0?0:h}return r?void 0:0},vG=function(e,t,r){return!e||!e.length||aP(e,fl(r,"type.defaultProps.domain"))?t:e},nte=function(e,t){var r=e.type.defaultProps?As(As({},e.type.defaultProps),e.props):e.props,n=r.dataKey,c=r.name,h=r.unit,p=r.formatter,s=r.tooltipType,v=r.chartType,w=r.hide;return As(As({},Sn(e,!1)),{},{dataKey:n,unit:h,formatter:p,name:c||n,color:Jz(e),value:Jo(t,n),type:s,payload:t,chartType:v,hide:w})};function ww(e){"@babel/helpers - typeof";return ww=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ww(e)}function xG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function hh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xG(Object(r),!0).forEach(function(n){ite(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ite(e,t,r){return t=PFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PFe(e){var t=CFe(e,"string");return ww(t)=="symbol"?t:t+""}function CFe(e,t){if(ww(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ww(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function IFe(e,t){return RFe(e)||jFe(e,t)||OFe(e,t)||MFe()}function MFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OFe(e,t){if(e){if(typeof e=="string")return bG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bG(e,t)}}function bG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function jFe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function RFe(e){if(Array.isArray(e))return e}var eA=Math.PI/180,DFe=function(e){return e*180/Math.PI},es=function(e,t,r,n){return{x:e+Math.cos(-eA*n)*r,y:t+Math.sin(-eA*n)*r}},ste=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(e-(r.left||0)-(r.right||0)),Math.abs(t-(r.top||0)-(r.bottom||0)))/2},LFe=function(e,t,r,n,c){var h=e.width,p=e.height,s=e.startAngle,v=e.endAngle,w=_a(e.cx,h,h/2),T=_a(e.cy,p,p/2),I=ste(h,p,r),O=_a(e.innerRadius,I,0),D=_a(e.outerRadius,I,I*.8),B=Object.keys(t);return B.reduce(function(N,G){var U=t[G],V=U.domain,X=U.reversed,Y;if(ni(U.range))n==="angleAxis"?Y=[s,v]:n==="radiusAxis"&&(Y=[O,D]),X&&(Y=[Y[1],Y[0]]);else{Y=U.range;var ne=Y,ae=IFe(ne,2);s=ae[0],v=ae[1]}var le=Qee(U,c),ge=le.realScaleType,je=le.scale;je.domain(V).range(Y),ete(je);var ze=tte(je,hh(hh({},U),{},{realScaleType:ge})),Pe=hh(hh(hh({},U),ze),{},{range:Y,radius:D,realScaleType:ge,scale:je,cx:w,cy:T,innerRadius:O,outerRadius:D,startAngle:s,endAngle:v});return hh(hh({},N),{},ite({},G,Pe))},{})},zFe=function(e,t){var r=e.x,n=e.y,c=t.x,h=t.y;return Math.sqrt(Math.pow(r-c,2)+Math.pow(n-h,2))},NFe=function(e,t){var r=e.x,n=e.y,c=t.cx,h=t.cy,p=zFe({x:r,y:n},{x:c,y:h});if(p<=0)return{radius:p};var s=(r-c)/p,v=Math.acos(s);return n>h&&(v=2*Math.PI-v),{radius:p,angle:DFe(v),angleInRadian:v}},FFe=function(e){var t=e.startAngle,r=e.endAngle,n=Math.floor(t/360),c=Math.floor(r/360),h=Math.min(n,c);return{startAngle:t-h*360,endAngle:r-h*360}},BFe=function(e,t){var r=t.startAngle,n=t.endAngle,c=Math.floor(r/360),h=Math.floor(n/360),p=Math.min(c,h);return e+p*360},wG=function(e,t){var r=e.x,n=e.y,c=NFe({x:r,y:n},t),h=c.radius,p=c.angle,s=t.innerRadius,v=t.outerRadius;if(h<s||h>v)return!1;if(h===0)return!0;var w=FFe(t),T=w.startAngle,I=w.endAngle,O=p,D;if(T<=I){for(;O>I;)O-=360;for(;O<T;)O+=360;D=O>=T&&O<=I}else{for(;O>T;)O-=360;for(;O<I;)O+=360;D=O>=I&&O<=T}return D?hh(hh({},t),{},{radius:h,angle:BFe(O,t)}):null},ote=function(e){return!Z.isValidElement(e)&&!Cn(e)&&typeof e!="boolean"?e.className:""};function Sw(e){"@babel/helpers - typeof";return Sw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sw(e)}var VFe=["offset"];function UFe(e){return WFe(e)||HFe(e)||GFe(e)||$Fe()}function $Fe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GFe(e,t){if(e){if(typeof e=="string")return WR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WR(e,t)}}function HFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function WFe(e){if(Array.isArray(e))return WR(e)}function WR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qFe(e,t){if(e==null)return{};var r=ZFe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ZFe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function SG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Js(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SG(Object(r),!0).forEach(function(n){KFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KFe(e,t,r){return t=XFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XFe(e){var t=YFe(e,"string");return Sw(t)=="symbol"?t:t+""}function YFe(e,t){if(Sw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Tw(){return Tw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tw.apply(this,arguments)}var JFe=function(e){var t=e.value,r=e.formatter,n=ni(e.children)?t:e.children;return Cn(r)?r(n):n},QFe=function(e,t){var r=ya(t-e),n=Math.min(Math.abs(t-e),360);return r*n},e5e=function(e,t,r){var n=e.position,c=e.viewBox,h=e.offset,p=e.className,s=c,v=s.cx,w=s.cy,T=s.innerRadius,I=s.outerRadius,O=s.startAngle,D=s.endAngle,B=s.clockWise,N=(T+I)/2,G=QFe(O,D),U=G>=0?1:-1,V,X;n==="insideStart"?(V=O+U*h,X=B):n==="insideEnd"?(V=D-U*h,X=!B):n==="end"&&(V=D+U*h,X=B),X=G<=0?X:!X;var Y=es(v,w,N,V),ne=es(v,w,N,V+(X?1:-1)*359),ae="M".concat(Y.x,",").concat(Y.y,`
    A`).concat(N,",").concat(N,",0,1,").concat(X?0:1,`,
    `).concat(ne.x,",").concat(ne.y),le=ni(e.id)?o1("recharts-radial-line-"):e.id;return Ne.createElement("text",Tw({},r,{dominantBaseline:"central",className:Wn("recharts-radial-bar-label",p)}),Ne.createElement("defs",null,Ne.createElement("path",{id:le,d:ae})),Ne.createElement("textPath",{xlinkHref:"#".concat(le)},t))},t5e=function(e){var t=e.viewBox,r=e.offset,n=e.position,c=t,h=c.cx,p=c.cy,s=c.innerRadius,v=c.outerRadius,w=c.startAngle,T=c.endAngle,I=(w+T)/2;if(n==="outside"){var O=es(h,p,v+r,I),D=O.x,B=O.y;return{x:D,y:B,textAnchor:D>=h?"start":"end",verticalAnchor:"middle"}}if(n==="center")return{x:h,y:p,textAnchor:"middle",verticalAnchor:"middle"};if(n==="centerTop")return{x:h,y:p,textAnchor:"middle",verticalAnchor:"start"};if(n==="centerBottom")return{x:h,y:p,textAnchor:"middle",verticalAnchor:"end"};var N=(s+v)/2,G=es(h,p,N,I),U=G.x,V=G.y;return{x:U,y:V,textAnchor:"middle",verticalAnchor:"middle"}},r5e=function(e){var t=e.viewBox,r=e.parentViewBox,n=e.offset,c=e.position,h=t,p=h.x,s=h.y,v=h.width,w=h.height,T=w>=0?1:-1,I=T*n,O=T>0?"end":"start",D=T>0?"start":"end",B=v>=0?1:-1,N=B*n,G=B>0?"end":"start",U=B>0?"start":"end";if(c==="top"){var V={x:p+v/2,y:s-T*n,textAnchor:"middle",verticalAnchor:O};return Js(Js({},V),r?{height:Math.max(s-r.y,0),width:v}:{})}if(c==="bottom"){var X={x:p+v/2,y:s+w+I,textAnchor:"middle",verticalAnchor:D};return Js(Js({},X),r?{height:Math.max(r.y+r.height-(s+w),0),width:v}:{})}if(c==="left"){var Y={x:p-N,y:s+w/2,textAnchor:G,verticalAnchor:"middle"};return Js(Js({},Y),r?{width:Math.max(Y.x-r.x,0),height:w}:{})}if(c==="right"){var ne={x:p+v+N,y:s+w/2,textAnchor:U,verticalAnchor:"middle"};return Js(Js({},ne),r?{width:Math.max(r.x+r.width-ne.x,0),height:w}:{})}var ae=r?{width:v,height:w}:{};return c==="insideLeft"?Js({x:p+N,y:s+w/2,textAnchor:U,verticalAnchor:"middle"},ae):c==="insideRight"?Js({x:p+v-N,y:s+w/2,textAnchor:G,verticalAnchor:"middle"},ae):c==="insideTop"?Js({x:p+v/2,y:s+I,textAnchor:"middle",verticalAnchor:D},ae):c==="insideBottom"?Js({x:p+v/2,y:s+w-I,textAnchor:"middle",verticalAnchor:O},ae):c==="insideTopLeft"?Js({x:p+N,y:s+I,textAnchor:U,verticalAnchor:D},ae):c==="insideTopRight"?Js({x:p+v-N,y:s+I,textAnchor:G,verticalAnchor:D},ae):c==="insideBottomLeft"?Js({x:p+N,y:s+w-I,textAnchor:U,verticalAnchor:O},ae):c==="insideBottomRight"?Js({x:p+v-N,y:s+w-I,textAnchor:G,verticalAnchor:O},ae):cv(c)&&(fr(c.x)||tm(c.x))&&(fr(c.y)||tm(c.y))?Js({x:p+_a(c.x,v),y:s+_a(c.y,w),textAnchor:"end",verticalAnchor:"end"},ae):Js({x:p+v/2,y:s+w/2,textAnchor:"middle",verticalAnchor:"middle"},ae)},n5e=function(e){return"cx"in e&&fr(e.cx)};function _o(e){var t=e.offset,r=t===void 0?5:t,n=qFe(e,VFe),c=Js({offset:r},n),h=c.viewBox,p=c.position,s=c.value,v=c.children,w=c.content,T=c.className,I=T===void 0?"":T,O=c.textBreakAll;if(!h||ni(s)&&ni(v)&&!Z.isValidElement(w)&&!Cn(w))return null;if(Z.isValidElement(w))return Z.cloneElement(w,c);var D;if(Cn(w)){if(D=Z.createElement(w,c),Z.isValidElement(D))return D}else D=JFe(c);var B=n5e(h),N=Sn(c,!0);if(B&&(p==="insideStart"||p==="insideEnd"||p==="end"))return e5e(c,D,N);var G=B?t5e(c):r5e(c);return Ne.createElement(Em,Tw({className:Wn("recharts-label",I)},N,G,{breakAll:O}),D)}_o.displayName="Label";var ate=function(e){var t=e.cx,r=e.cy,n=e.angle,c=e.startAngle,h=e.endAngle,p=e.r,s=e.radius,v=e.innerRadius,w=e.outerRadius,T=e.x,I=e.y,O=e.top,D=e.left,B=e.width,N=e.height,G=e.clockWise,U=e.labelViewBox;if(U)return U;if(fr(B)&&fr(N)){if(fr(T)&&fr(I))return{x:T,y:I,width:B,height:N};if(fr(O)&&fr(D))return{x:O,y:D,width:B,height:N}}return fr(T)&&fr(I)?{x:T,y:I,width:0,height:0}:fr(t)&&fr(r)?{cx:t,cy:r,startAngle:c||n||0,endAngle:h||n||0,innerRadius:v||0,outerRadius:w||s||p||0,clockWise:G}:e.viewBox?e.viewBox:{}},i5e=function(e,t){return e?e===!0?Ne.createElement(_o,{key:"label-implicit",viewBox:t}):io(e)?Ne.createElement(_o,{key:"label-implicit",viewBox:t,value:e}):Z.isValidElement(e)?e.type===_o?Z.cloneElement(e,{key:"label-implicit",viewBox:t}):Ne.createElement(_o,{key:"label-implicit",content:e,viewBox:t}):Cn(e)?Ne.createElement(_o,{key:"label-implicit",content:e,viewBox:t}):cv(e)?Ne.createElement(_o,Tw({viewBox:t},e,{key:"label-implicit"})):null:null},s5e=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,c=ate(e),h=Ll(n,_o).map(function(s,v){return Z.cloneElement(s,{viewBox:t||c,key:"label-".concat(v)})});if(!r)return h;var p=i5e(e.label,t||c);return[p].concat(UFe(h))};_o.parseViewBox=ate;_o.renderCallByParent=s5e;function o5e(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var a5e=o5e;const l5e=ki(a5e);function Ew(e){"@babel/helpers - typeof";return Ew=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ew(e)}var c5e=["valueAccessor"],u5e=["data","dataKey","clockWise","id","textBreakAll"];function h5e(e){return m5e(e)||p5e(e)||f5e(e)||d5e()}function d5e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f5e(e,t){if(e){if(typeof e=="string")return qR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qR(e,t)}}function p5e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function m5e(e){if(Array.isArray(e))return qR(e)}function qR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tA(){return tA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tA.apply(this,arguments)}function TG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function EG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TG(Object(r),!0).forEach(function(n){g5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function g5e(e,t,r){return t=y5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y5e(e){var t=_5e(e,"string");return Ew(t)=="symbol"?t:t+""}function _5e(e,t){if(Ew(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ew(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function AG(e,t){if(e==null)return{};var r=v5e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function v5e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var x5e=function(e){return Array.isArray(e.value)?l5e(e.value):e.value};function ff(e){var t=e.valueAccessor,r=t===void 0?x5e:t,n=AG(e,c5e),c=n.data,h=n.dataKey,p=n.clockWise,s=n.id,v=n.textBreakAll,w=AG(n,u5e);return!c||!c.length?null:Ne.createElement(Li,{className:"recharts-label-list"},c.map(function(T,I){var O=ni(h)?r(T,I):Jo(T&&T.payload,h),D=ni(s)?{}:{id:"".concat(s,"-").concat(I)};return Ne.createElement(_o,tA({},Sn(T,!0),w,D,{parentViewBox:T.parentViewBox,value:O,textBreakAll:v,viewBox:_o.parseViewBox(ni(p)?T:EG(EG({},T),{},{clockWise:p})),key:"label-".concat(I),index:I}))}))}ff.displayName="LabelList";function b5e(e,t){return e?e===!0?Ne.createElement(ff,{key:"labelList-implicit",data:t}):Ne.isValidElement(e)||Cn(e)?Ne.createElement(ff,{key:"labelList-implicit",data:t,content:e}):cv(e)?Ne.createElement(ff,tA({data:t},e,{key:"labelList-implicit"})):null:null}function w5e(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,c=Ll(n,ff).map(function(p,s){return Z.cloneElement(p,{data:t,key:"labelList-".concat(s)})});if(!r)return c;var h=b5e(e.label,t);return[h].concat(h5e(c))}ff.renderCallByParent=w5e;function Aw(e){"@babel/helpers - typeof";return Aw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Aw(e)}function ZR(){return ZR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ZR.apply(this,arguments)}function kG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function PG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kG(Object(r),!0).forEach(function(n){S5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function S5e(e,t,r){return t=T5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T5e(e){var t=E5e(e,"string");return Aw(t)=="symbol"?t:t+""}function E5e(e,t){if(Aw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Aw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var A5e=function(e,t){var r=ya(t-e),n=Math.min(Math.abs(t-e),359.999);return r*n},i2=function(e){var t=e.cx,r=e.cy,n=e.radius,c=e.angle,h=e.sign,p=e.isExternal,s=e.cornerRadius,v=e.cornerIsExternal,w=s*(p?1:-1)+n,T=Math.asin(s/w)/eA,I=v?c:c+h*T,O=es(t,r,w,I),D=es(t,r,n,I),B=v?c-h*T:c,N=es(t,r,w*Math.cos(T*eA),B);return{center:O,circleTangency:D,lineTangency:N,theta:T}},lte=function(e){var t=e.cx,r=e.cy,n=e.innerRadius,c=e.outerRadius,h=e.startAngle,p=e.endAngle,s=A5e(h,p),v=h+s,w=es(t,r,c,h),T=es(t,r,c,v),I="M ".concat(w.x,",").concat(w.y,`
    A `).concat(c,",").concat(c,`,0,
    `).concat(+(Math.abs(s)>180),",").concat(+(h>v),`,
    `).concat(T.x,",").concat(T.y,`
  `);if(n>0){var O=es(t,r,n,h),D=es(t,r,n,v);I+="L ".concat(D.x,",").concat(D.y,`
            A `).concat(n,",").concat(n,`,0,
            `).concat(+(Math.abs(s)>180),",").concat(+(h<=v),`,
            `).concat(O.x,",").concat(O.y," Z")}else I+="L ".concat(t,",").concat(r," Z");return I},k5e=function(e){var t=e.cx,r=e.cy,n=e.innerRadius,c=e.outerRadius,h=e.cornerRadius,p=e.forceCornerRadius,s=e.cornerIsExternal,v=e.startAngle,w=e.endAngle,T=ya(w-v),I=i2({cx:t,cy:r,radius:c,angle:v,sign:T,cornerRadius:h,cornerIsExternal:s}),O=I.circleTangency,D=I.lineTangency,B=I.theta,N=i2({cx:t,cy:r,radius:c,angle:w,sign:-T,cornerRadius:h,cornerIsExternal:s}),G=N.circleTangency,U=N.lineTangency,V=N.theta,X=s?Math.abs(v-w):Math.abs(v-w)-B-V;if(X<0)return p?"M ".concat(D.x,",").concat(D.y,`
        a`).concat(h,",").concat(h,",0,0,1,").concat(h*2,`,0
        a`).concat(h,",").concat(h,",0,0,1,").concat(-h*2,`,0
      `):lte({cx:t,cy:r,innerRadius:n,outerRadius:c,startAngle:v,endAngle:w});var Y="M ".concat(D.x,",").concat(D.y,`
    A`).concat(h,",").concat(h,",0,0,").concat(+(T<0),",").concat(O.x,",").concat(O.y,`
    A`).concat(c,",").concat(c,",0,").concat(+(X>180),",").concat(+(T<0),",").concat(G.x,",").concat(G.y,`
    A`).concat(h,",").concat(h,",0,0,").concat(+(T<0),",").concat(U.x,",").concat(U.y,`
  `);if(n>0){var ne=i2({cx:t,cy:r,radius:n,angle:v,sign:T,isExternal:!0,cornerRadius:h,cornerIsExternal:s}),ae=ne.circleTangency,le=ne.lineTangency,ge=ne.theta,je=i2({cx:t,cy:r,radius:n,angle:w,sign:-T,isExternal:!0,cornerRadius:h,cornerIsExternal:s}),ze=je.circleTangency,Pe=je.lineTangency,Ke=je.theta,Ye=s?Math.abs(v-w):Math.abs(v-w)-ge-Ke;if(Ye<0&&h===0)return"".concat(Y,"L").concat(t,",").concat(r,"Z");Y+="L".concat(Pe.x,",").concat(Pe.y,`
      A`).concat(h,",").concat(h,",0,0,").concat(+(T<0),",").concat(ze.x,",").concat(ze.y,`
      A`).concat(n,",").concat(n,",0,").concat(+(Ye>180),",").concat(+(T>0),",").concat(ae.x,",").concat(ae.y,`
      A`).concat(h,",").concat(h,",0,0,").concat(+(T<0),",").concat(le.x,",").concat(le.y,"Z")}else Y+="L".concat(t,",").concat(r,"Z");return Y},P5e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},cte=function(e){var t=PG(PG({},P5e),e),r=t.cx,n=t.cy,c=t.innerRadius,h=t.outerRadius,p=t.cornerRadius,s=t.forceCornerRadius,v=t.cornerIsExternal,w=t.startAngle,T=t.endAngle,I=t.className;if(h<c||w===T)return null;var O=Wn("recharts-sector",I),D=h-c,B=_a(p,D,0,!0),N;return B>0&&Math.abs(w-T)<360?N=k5e({cx:r,cy:n,innerRadius:c,outerRadius:h,cornerRadius:Math.min(B,D/2),forceCornerRadius:s,cornerIsExternal:v,startAngle:w,endAngle:T}):N=lte({cx:r,cy:n,innerRadius:c,outerRadius:h,startAngle:w,endAngle:T}),Ne.createElement("path",ZR({},Sn(t,!0),{className:O,d:N,role:"img"}))};function kw(e){"@babel/helpers - typeof";return kw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kw(e)}function KR(){return KR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KR.apply(this,arguments)}function CG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function IG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CG(Object(r),!0).forEach(function(n){C5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function C5e(e,t,r){return t=I5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function I5e(e){var t=M5e(e,"string");return kw(t)=="symbol"?t:t+""}function M5e(e,t){if(kw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(kw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var MG={curveBasisClosed:wAe,curveBasisOpen:SAe,curveBasis:bAe,curveBumpX:aAe,curveBumpY:lAe,curveLinearClosed:TAe,curveLinear:qk,curveMonotoneX:EAe,curveMonotoneY:AAe,curveNatural:kAe,curveStep:PAe,curveStepAfter:IAe,curveStepBefore:CAe},s2=function(e){return e.x===+e.x&&e.y===+e.y},qx=function(e){return e.x},Zx=function(e){return e.y},O5e=function(e,t){if(Cn(e))return e;var r="curve".concat(Hk(e));return(r==="curveMonotone"||r==="curveBump")&&t?MG["".concat(r).concat(t==="vertical"?"Y":"X")]:MG[r]||qk},j5e=function(e){var t=e.type,r=t===void 0?"linear":t,n=e.points,c=n===void 0?[]:n,h=e.baseLine,p=e.layout,s=e.connectNulls,v=s===void 0?!1:s,w=O5e(r,p),T=v?c.filter(function(B){return s2(B)}):c,I;if(Array.isArray(h)){var O=v?h.filter(function(B){return s2(B)}):h,D=T.map(function(B,N){return IG(IG({},B),{},{base:O[N]})});return p==="vertical"?I=KT().y(Zx).x1(qx).x0(function(B){return B.base.x}):I=KT().x(qx).y1(Zx).y0(function(B){return B.base.y}),I.defined(s2).curve(w),I(D)}return p==="vertical"&&fr(h)?I=KT().y(Zx).x1(qx).x0(h):fr(h)?I=KT().x(qx).y1(Zx).y0(h):I=tQ().x(qx).y(Zx),I.defined(s2).curve(w),I(T)},XR=function(e){var t=e.className,r=e.points,n=e.path,c=e.pathRef;if((!r||!r.length)&&!n)return null;var h=r&&r.length?j5e(e):n;return Z.createElement("path",KR({},Sn(e,!1),AE(e),{className:Wn("recharts-curve",t),d:h,ref:c}))},ute={exports:{}},R5e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",D5e=R5e,L5e=D5e;function hte(){}function dte(){}dte.resetWarningCache=hte;var z5e=function(){function e(n,c,h,p,s,v){if(v!==L5e){var w=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw w.name="Invariant Violation",w}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:dte,resetWarningCache:hte};return r.PropTypes=r,r};ute.exports=z5e();var N5e=ute.exports;const Ii=ki(N5e);var F5e=Object.getOwnPropertyNames,B5e=Object.getOwnPropertySymbols,V5e=Object.prototype.hasOwnProperty;function OG(e,t){return function(r,n,c){return e(r,n,c)&&t(r,n,c)}}function o2(e){return function(t,r,n){if(!t||!r||typeof t!="object"||typeof r!="object")return e(t,r,n);var c=n.cache,h=c.get(t),p=c.get(r);if(h&&p)return h===r&&p===t;c.set(t,r),c.set(r,t);var s=e(t,r,n);return c.delete(t),c.delete(r),s}}function jG(e){return F5e(e).concat(B5e(e))}var U5e=Object.hasOwn||function(e,t){return V5e.call(e,t)};function Fm(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var $5e="__v",G5e="__o",H5e="_owner",RG=Object.getOwnPropertyDescriptor,DG=Object.keys;function W5e(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function q5e(e,t){return Fm(e.getTime(),t.getTime())}function Z5e(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function K5e(e,t){return e===t}function LG(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var c=new Array(n),h=e.entries(),p,s,v=0;(p=h.next())&&!p.done;){for(var w=t.entries(),T=!1,I=0;(s=w.next())&&!s.done;){if(c[I]){I++;continue}var O=p.value,D=s.value;if(r.equals(O[0],D[0],v,I,e,t,r)&&r.equals(O[1],D[1],O[0],D[0],e,t,r)){T=c[I]=!0;break}I++}if(!T)return!1;v++}return!0}var X5e=Fm;function Y5e(e,t,r){var n=DG(e),c=n.length;if(DG(t).length!==c)return!1;for(;c-- >0;)if(!fte(e,t,r,n[c]))return!1;return!0}function Kx(e,t,r){var n=jG(e),c=n.length;if(jG(t).length!==c)return!1;for(var h,p,s;c-- >0;)if(h=n[c],!fte(e,t,r,h)||(p=RG(e,h),s=RG(t,h),(p||s)&&(!p||!s||p.configurable!==s.configurable||p.enumerable!==s.enumerable||p.writable!==s.writable)))return!1;return!0}function J5e(e,t){return Fm(e.valueOf(),t.valueOf())}function Q5e(e,t){return e.source===t.source&&e.flags===t.flags}function zG(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var c=new Array(n),h=e.values(),p,s;(p=h.next())&&!p.done;){for(var v=t.values(),w=!1,T=0;(s=v.next())&&!s.done;){if(!c[T]&&r.equals(p.value,s.value,p.value,s.value,e,t,r)){w=c[T]=!0;break}T++}if(!w)return!1}return!0}function eBe(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function tBe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function fte(e,t,r,n){return(n===H5e||n===G5e||n===$5e)&&(e.$$typeof||t.$$typeof)?!0:U5e(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var rBe="[object Arguments]",nBe="[object Boolean]",iBe="[object Date]",sBe="[object Error]",oBe="[object Map]",aBe="[object Number]",lBe="[object Object]",cBe="[object RegExp]",uBe="[object Set]",hBe="[object String]",dBe="[object URL]",fBe=Array.isArray,NG=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,FG=Object.assign,pBe=Object.prototype.toString.call.bind(Object.prototype.toString);function mBe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,c=e.areFunctionsEqual,h=e.areMapsEqual,p=e.areNumbersEqual,s=e.areObjectsEqual,v=e.arePrimitiveWrappersEqual,w=e.areRegExpsEqual,T=e.areSetsEqual,I=e.areTypedArraysEqual,O=e.areUrlsEqual;return function(D,B,N){if(D===B)return!0;if(D==null||B==null)return!1;var G=typeof D;if(G!==typeof B)return!1;if(G!=="object")return G==="number"?p(D,B,N):G==="function"?c(D,B,N):!1;var U=D.constructor;if(U!==B.constructor)return!1;if(U===Object)return s(D,B,N);if(fBe(D))return t(D,B,N);if(NG!=null&&NG(D))return I(D,B,N);if(U===Date)return r(D,B,N);if(U===RegExp)return w(D,B,N);if(U===Map)return h(D,B,N);if(U===Set)return T(D,B,N);var V=pBe(D);return V===iBe?r(D,B,N):V===cBe?w(D,B,N):V===oBe?h(D,B,N):V===uBe?T(D,B,N):V===lBe?typeof D.then!="function"&&typeof B.then!="function"&&s(D,B,N):V===dBe?O(D,B,N):V===sBe?n(D,B,N):V===rBe?s(D,B,N):V===nBe||V===aBe||V===hBe?v(D,B,N):!1}}function gBe(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,c={areArraysEqual:n?Kx:W5e,areDatesEqual:q5e,areErrorsEqual:Z5e,areFunctionsEqual:K5e,areMapsEqual:n?OG(LG,Kx):LG,areNumbersEqual:X5e,areObjectsEqual:n?Kx:Y5e,arePrimitiveWrappersEqual:J5e,areRegExpsEqual:Q5e,areSetsEqual:n?OG(zG,Kx):zG,areTypedArraysEqual:n?Kx:eBe,areUrlsEqual:tBe};if(r&&(c=FG({},c,r(c))),t){var h=o2(c.areArraysEqual),p=o2(c.areMapsEqual),s=o2(c.areObjectsEqual),v=o2(c.areSetsEqual);c=FG({},c,{areArraysEqual:h,areMapsEqual:p,areObjectsEqual:s,areSetsEqual:v})}return c}function yBe(e){return function(t,r,n,c,h,p,s){return e(t,r,s)}}function _Be(e){var t=e.circular,r=e.comparator,n=e.createState,c=e.equals,h=e.strict;if(n)return function(s,v){var w=n(),T=w.cache,I=T===void 0?t?new WeakMap:void 0:T,O=w.meta;return r(s,v,{cache:I,equals:c,meta:O,strict:h})};if(t)return function(s,v){return r(s,v,{cache:new WeakMap,equals:c,meta:void 0,strict:h})};var p={cache:void 0,equals:c,meta:void 0,strict:h};return function(s,v){return r(s,v,p)}}var vBe=Cf();Cf({strict:!0});Cf({circular:!0});Cf({circular:!0,strict:!0});Cf({createInternalComparator:function(){return Fm}});Cf({strict:!0,createInternalComparator:function(){return Fm}});Cf({circular:!0,createInternalComparator:function(){return Fm}});Cf({circular:!0,createInternalComparator:function(){return Fm},strict:!0});function Cf(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,c=e.createState,h=e.strict,p=h===void 0?!1:h,s=gBe(e),v=mBe(s),w=n?n(v):yBe(v);return _Be({circular:r,comparator:v,createState:c,equals:w,strict:p})}function xBe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function BG(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function c(h){r<0&&(r=h),h-r>t?(e(h),r=-1):xBe(c)};requestAnimationFrame(n)}function YR(e){"@babel/helpers - typeof";return YR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YR(e)}function bBe(e){return EBe(e)||TBe(e)||SBe(e)||wBe()}function wBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SBe(e,t){if(e){if(typeof e=="string")return VG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return VG(e,t)}}function VG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function TBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function EBe(e){if(Array.isArray(e))return e}function ABe(){var e={},t=function(){return null},r=!1,n=function c(h){if(!r){if(Array.isArray(h)){if(!h.length)return;var p=h,s=bBe(p),v=s[0],w=s.slice(1);if(typeof v=="number"){BG(c.bind(null,w),v);return}c(v),BG(c.bind(null,w));return}YR(h)==="object"&&(e=h,t(e)),typeof h=="function"&&h()}};return{stop:function(){r=!0},start:function(c){r=!1,n(c)},subscribe:function(c){return t=c,function(){t=function(){return null}}}}}function Pw(e){"@babel/helpers - typeof";return Pw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pw(e)}function UG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function $G(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?UG(Object(r),!0).forEach(function(n){pte(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):UG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pte(e,t,r){return t=kBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kBe(e){var t=PBe(e,"string");return Pw(t)==="symbol"?t:String(t)}function PBe(e,t){if(Pw(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Pw(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var CBe=function(e,t){return[Object.keys(e),Object.keys(t)].reduce(function(r,n){return r.filter(function(c){return n.includes(c)})})},IBe=function(e){return e},MBe=function(e){return e.replace(/([A-Z])/g,function(t){return"-".concat(t.toLowerCase())})},Cb=function(e,t){return Object.keys(t).reduce(function(r,n){return $G($G({},r),{},pte({},n,e(n,t[n])))},{})},GG=function(e,t,r){return e.map(function(n){return"".concat(MBe(n)," ").concat(t,"ms ").concat(r)}).join(",")};function OBe(e,t){return DBe(e)||RBe(e,t)||mte(e,t)||jBe()}function jBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RBe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function DBe(e){if(Array.isArray(e))return e}function LBe(e){return FBe(e)||NBe(e)||mte(e)||zBe()}function zBe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mte(e,t){if(e){if(typeof e=="string")return JR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return JR(e,t)}}function NBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function FBe(e){if(Array.isArray(e))return JR(e)}function JR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var rA=1e-4,gte=function(e,t){return[0,3*e,3*t-6*e,3*e-3*t+1]},yte=function(e,t){return e.map(function(r,n){return r*Math.pow(t,n)}).reduce(function(r,n){return r+n})},HG=function(e,t){return function(r){var n=gte(e,t);return yte(n,r)}},BBe=function(e,t){return function(r){var n=gte(e,t),c=[].concat(LBe(n.map(function(h,p){return h*p}).slice(1)),[0]);return yte(c,r)}},WG=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0],c=t[1],h=t[2],p=t[3];if(t.length===1)switch(t[0]){case"linear":n=0,c=0,h=1,p=1;break;case"ease":n=.25,c=.1,h=.25,p=1;break;case"ease-in":n=.42,c=0,h=1,p=1;break;case"ease-out":n=.42,c=0,h=.58,p=1;break;case"ease-in-out":n=0,c=0,h=.58,p=1;break;default:{var s=t[0].split("(");if(s[0]==="cubic-bezier"&&s[1].split(")")[0].split(",").length===4){var v=s[1].split(")")[0].split(",").map(function(N){return parseFloat(N)}),w=OBe(v,4);n=w[0],c=w[1],h=w[2],p=w[3]}}}var T=HG(n,h),I=HG(c,p),O=BBe(n,h),D=function(N){return N>1?1:N<0?0:N},B=function(N){for(var G=N>1?1:N,U=G,V=0;V<8;++V){var X=T(U)-G,Y=O(U);if(Math.abs(X-G)<rA||Y<rA)return I(U);U=D(U-X/Y)}return I(U)};return B.isStepper=!1,B},VBe=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.stiff,r=t===void 0?100:t,n=e.damping,c=n===void 0?8:n,h=e.dt,p=h===void 0?17:h,s=function(v,w,T){var I=-(v-w)*r,O=T*c,D=T+(I-O)*p/1e3,B=T*p/1e3+v;return Math.abs(B-w)<rA&&Math.abs(D)<rA?[w,0]:[B,D]};return s.isStepper=!0,s.dt=p,s},UBe=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0];if(typeof n=="string")switch(n){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return WG(n);case"spring":return VBe();default:if(n.split("(")[0]==="cubic-bezier")return WG(n)}return typeof n=="function"?n:null};function Cw(e){"@babel/helpers - typeof";return Cw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cw(e)}function qG(e){return HBe(e)||GBe(e)||_te(e)||$Be()}function $Be(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function HBe(e){if(Array.isArray(e))return eD(e)}function ZG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Ro(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZG(Object(r),!0).forEach(function(n){QR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function QR(e,t,r){return t=WBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WBe(e){var t=qBe(e,"string");return Cw(t)==="symbol"?t:String(t)}function qBe(e,t){if(Cw(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Cw(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ZBe(e,t){return YBe(e)||XBe(e,t)||_te(e,t)||KBe()}function KBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _te(e,t){if(e){if(typeof e=="string")return eD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eD(e,t)}}function eD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function XBe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function YBe(e){if(Array.isArray(e))return e}var nA=function(e,t,r){return e+(t-e)*r},tD=function(e){var t=e.from,r=e.to;return t!==r},JBe=function e(t,r,n){var c=Cb(function(h,p){if(tD(p)){var s=t(p.from,p.to,p.velocity),v=ZBe(s,2),w=v[0],T=v[1];return Ro(Ro({},p),{},{from:w,velocity:T})}return p},r);return n<1?Cb(function(h,p){return tD(p)?Ro(Ro({},p),{},{velocity:nA(p.velocity,c[h].velocity,n),from:nA(p.from,c[h].from,n)}):p},r):e(t,c,n-1)};const QBe=function(e,t,r,n,c){var h=CBe(e,t),p=h.reduce(function(G,U){return Ro(Ro({},G),{},QR({},U,[e[U],t[U]]))},{}),s=h.reduce(function(G,U){return Ro(Ro({},G),{},QR({},U,{from:e[U],velocity:0,to:t[U]}))},{}),v=-1,w,T,I=function(){return null},O=function(){return Cb(function(G,U){return U.from},s)},D=function(){return!Object.values(s).filter(tD).length},B=function(G){w||(w=G);var U=G-w,V=U/r.dt;s=JBe(r,s,V),c(Ro(Ro(Ro({},e),t),O())),w=G,D()||(v=requestAnimationFrame(I))},N=function(G){T||(T=G);var U=(G-T)/n,V=Cb(function(Y,ne){return nA.apply(void 0,qG(ne).concat([r(U)]))},p);if(c(Ro(Ro(Ro({},e),t),V)),U<1)v=requestAnimationFrame(I);else{var X=Cb(function(Y,ne){return nA.apply(void 0,qG(ne).concat([r(1)]))},p);c(Ro(Ro(Ro({},e),t),X))}};return I=r.isStepper?B:N,function(){return requestAnimationFrame(I),function(){cancelAnimationFrame(v)}}};function M_(e){"@babel/helpers - typeof";return M_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M_(e)}var e4e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function t4e(e,t){if(e==null)return{};var r=r4e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function r4e(e,t){if(e==null)return{};var r={},n=Object.keys(e),c,h;for(h=0;h<n.length;h++)c=n[h],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function KM(e){return o4e(e)||s4e(e)||i4e(e)||n4e()}function n4e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i4e(e,t){if(e){if(typeof e=="string")return rD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rD(e,t)}}function s4e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function o4e(e){if(Array.isArray(e))return rD(e)}function rD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function KG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function sc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KG(Object(r),!0).forEach(function(n){sb(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sb(e,t,r){return t=vte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a4e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l4e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vte(n.key),n)}}function c4e(e,t,r){return t&&l4e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function vte(e){var t=u4e(e,"string");return M_(t)==="symbol"?t:String(t)}function u4e(e,t){if(M_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(M_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function h4e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nD(e,t)}function nD(e,t){return nD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},nD(e,t)}function d4e(e){var t=f4e();return function(){var r=iA(e),n;if(t){var c=iA(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return iD(this,n)}}function iD(e,t){if(t&&(M_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sD(e)}function sD(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f4e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function iA(e){return iA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},iA(e)}var Dh=function(e){h4e(r,e);var t=d4e(r);function r(n,c){var h;a4e(this,r),h=t.call(this,n,c);var p=h.props,s=p.isActive,v=p.attributeName,w=p.from,T=p.to,I=p.steps,O=p.children,D=p.duration;if(h.handleStyleChange=h.handleStyleChange.bind(sD(h)),h.changeStyle=h.changeStyle.bind(sD(h)),!s||D<=0)return h.state={style:{}},typeof O=="function"&&(h.state={style:T}),iD(h);if(I&&I.length)h.state={style:I[0].style};else if(w){if(typeof O=="function")return h.state={style:w},iD(h);h.state={style:v?sb({},v,w):w}}else h.state={style:{}};return h}return c4e(r,[{key:"componentDidMount",value:function(){var n=this.props,c=n.isActive,h=n.canBegin;this.mounted=!0,!(!c||!h)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(n){var c=this.props,h=c.isActive,p=c.canBegin,s=c.attributeName,v=c.shouldReAnimate,w=c.to,T=c.from,I=this.state.style;if(p){if(!h){var O={style:s?sb({},s,w):w};this.state&&I&&(s&&I[s]!==w||!s&&I!==w)&&this.setState(O);return}if(!(vBe(n.to,w)&&n.canBegin&&n.isActive)){var D=!n.canBegin||!n.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var B=D||v?T:n.to;if(this.state&&I){var N={style:s?sb({},s,B):B};(s&&I[s]!==B||!s&&I!==B)&&this.setState(N)}this.runAnimation(sc(sc({},this.props),{},{from:B,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var n=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),n&&n()}},{key:"handleStyleChange",value:function(n){this.changeStyle(n)}},{key:"changeStyle",value:function(n){this.mounted&&this.setState({style:n})}},{key:"runJSAnimation",value:function(n){var c=this,h=n.from,p=n.to,s=n.duration,v=n.easing,w=n.begin,T=n.onAnimationEnd,I=n.onAnimationStart,O=QBe(h,p,UBe(v),s,this.changeStyle),D=function(){c.stopJSAnimation=O()};this.manager.start([I,w,D,s,T])}},{key:"runStepAnimation",value:function(n){var c=this,h=n.steps,p=n.begin,s=n.onAnimationStart,v=h[0],w=v.style,T=v.duration,I=T===void 0?0:T,O=function(D,B,N){if(N===0)return D;var G=B.duration,U=B.easing,V=U===void 0?"ease":U,X=B.style,Y=B.properties,ne=B.onAnimationEnd,ae=N>0?h[N-1]:B,le=Y||Object.keys(X);if(typeof V=="function"||V==="spring")return[].concat(KM(D),[c.runJSAnimation.bind(c,{from:ae.style,to:X,duration:G,easing:V}),G]);var ge=GG(le,G,V),je=sc(sc(sc({},ae.style),X),{},{transition:ge});return[].concat(KM(D),[je,G,ne]).filter(IBe)};return this.manager.start([s].concat(KM(h.reduce(O,[w,Math.max(I,p)])),[n.onAnimationEnd]))}},{key:"runAnimation",value:function(n){this.manager||(this.manager=ABe());var c=n.begin,h=n.duration,p=n.attributeName,s=n.to,v=n.easing,w=n.onAnimationStart,T=n.onAnimationEnd,I=n.steps,O=n.children,D=this.manager;if(this.unSubscribe=D.subscribe(this.handleStyleChange),typeof v=="function"||typeof O=="function"||v==="spring"){this.runJSAnimation(n);return}if(I.length>1){this.runStepAnimation(n);return}var B=p?sb({},p,s):s,N=GG(Object.keys(B),h,v);D.start([w,c,sc(sc({},B),{},{transition:N}),h,T])}},{key:"render",value:function(){var n=this.props,c=n.children;n.begin;var h=n.duration;n.attributeName,n.easing;var p=n.isActive;n.steps,n.from,n.to,n.canBegin,n.onAnimationEnd,n.shouldReAnimate,n.onAnimationReStart;var s=t4e(n,e4e),v=Z.Children.count(c),w=this.state.style;if(typeof c=="function")return c(w);if(!p||v===0||h<=0)return c;var T=function(I){var O=I.props,D=O.style,B=D===void 0?{}:D,N=O.className,G=Z.cloneElement(I,sc(sc({},s),{},{style:sc(sc({},B),w),className:N}));return G};return v===1?T(Z.Children.only(c)):Ne.createElement("div",null,Z.Children.map(c,function(I){return T(I)}))}}]),r}(Z.PureComponent);Dh.displayName="Animate";Dh.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Dh.propTypes={from:Ii.oneOfType([Ii.object,Ii.string]),to:Ii.oneOfType([Ii.object,Ii.string]),attributeName:Ii.string,duration:Ii.number,begin:Ii.number,easing:Ii.oneOfType([Ii.string,Ii.func]),steps:Ii.arrayOf(Ii.shape({duration:Ii.number.isRequired,style:Ii.object.isRequired,easing:Ii.oneOfType([Ii.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Ii.func]),properties:Ii.arrayOf("string"),onAnimationEnd:Ii.func})),children:Ii.oneOfType([Ii.node,Ii.func]),isActive:Ii.bool,canBegin:Ii.bool,onAnimationEnd:Ii.func,shouldReAnimate:Ii.bool,onAnimationStart:Ii.func,onAnimationReStart:Ii.func};function Iw(e){"@babel/helpers - typeof";return Iw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Iw(e)}function sA(){return sA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},sA.apply(this,arguments)}function p4e(e,t){return _4e(e)||y4e(e,t)||g4e(e,t)||m4e()}function m4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g4e(e,t){if(e){if(typeof e=="string")return XG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return XG(e,t)}}function XG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y4e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function _4e(e){if(Array.isArray(e))return e}function YG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function JG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YG(Object(r),!0).forEach(function(n){v4e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function v4e(e,t,r){return t=x4e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x4e(e){var t=b4e(e,"string");return Iw(t)=="symbol"?t:t+""}function b4e(e,t){if(Iw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Iw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var QG=function(e,t,r,n,c){var h=Math.min(Math.abs(r)/2,Math.abs(n)/2),p=n>=0?1:-1,s=r>=0?1:-1,v=n>=0&&r>=0||n<0&&r<0?1:0,w;if(h>0&&c instanceof Array){for(var T=[0,0,0,0],I=0,O=4;I<O;I++)T[I]=c[I]>h?h:c[I];w="M".concat(e,",").concat(t+p*T[0]),T[0]>0&&(w+="A ".concat(T[0],",").concat(T[0],",0,0,").concat(v,",").concat(e+s*T[0],",").concat(t)),w+="L ".concat(e+r-s*T[1],",").concat(t),T[1]>0&&(w+="A ".concat(T[1],",").concat(T[1],",0,0,").concat(v,`,
        `).concat(e+r,",").concat(t+p*T[1])),w+="L ".concat(e+r,",").concat(t+n-p*T[2]),T[2]>0&&(w+="A ".concat(T[2],",").concat(T[2],",0,0,").concat(v,`,
        `).concat(e+r-s*T[2],",").concat(t+n)),w+="L ".concat(e+s*T[3],",").concat(t+n),T[3]>0&&(w+="A ".concat(T[3],",").concat(T[3],",0,0,").concat(v,`,
        `).concat(e,",").concat(t+n-p*T[3])),w+="Z"}else if(h>0&&c===+c&&c>0){var D=Math.min(h,c);w="M ".concat(e,",").concat(t+p*D,`
            A `).concat(D,",").concat(D,",0,0,").concat(v,",").concat(e+s*D,",").concat(t,`
            L `).concat(e+r-s*D,",").concat(t,`
            A `).concat(D,",").concat(D,",0,0,").concat(v,",").concat(e+r,",").concat(t+p*D,`
            L `).concat(e+r,",").concat(t+n-p*D,`
            A `).concat(D,",").concat(D,",0,0,").concat(v,",").concat(e+r-s*D,",").concat(t+n,`
            L `).concat(e+s*D,",").concat(t+n,`
            A `).concat(D,",").concat(D,",0,0,").concat(v,",").concat(e,",").concat(t+n-p*D," Z")}else w="M ".concat(e,",").concat(t," h ").concat(r," v ").concat(n," h ").concat(-r," Z");return w},w4e=function(e,t){if(!e||!t)return!1;var r=e.x,n=e.y,c=t.x,h=t.y,p=t.width,s=t.height;if(Math.abs(p)>0&&Math.abs(s)>0){var v=Math.min(c,c+p),w=Math.max(c,c+p),T=Math.min(h,h+s),I=Math.max(h,h+s);return r>=v&&r<=w&&n>=T&&n<=I}return!1},S4e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Qz=function(e){var t=JG(JG({},S4e),e),r=Z.useRef(),n=Z.useState(-1),c=p4e(n,2),h=c[0],p=c[1];Z.useEffect(function(){if(r.current&&r.current.getTotalLength)try{var X=r.current.getTotalLength();X&&p(X)}catch{}},[]);var s=t.x,v=t.y,w=t.width,T=t.height,I=t.radius,O=t.className,D=t.animationEasing,B=t.animationDuration,N=t.animationBegin,G=t.isAnimationActive,U=t.isUpdateAnimationActive;if(s!==+s||v!==+v||w!==+w||T!==+T||w===0||T===0)return null;var V=Wn("recharts-rectangle",O);return U?Ne.createElement(Dh,{canBegin:h>0,from:{width:w,height:T,x:s,y:v},to:{width:w,height:T,x:s,y:v},duration:B,animationEasing:D,isActive:U},function(X){var Y=X.width,ne=X.height,ae=X.x,le=X.y;return Ne.createElement(Dh,{canBegin:h>0,from:"0px ".concat(h===-1?1:h,"px"),to:"".concat(h,"px 0px"),attributeName:"strokeDasharray",begin:N,duration:B,isActive:G,easing:D},Ne.createElement("path",sA({},Sn(t,!0),{className:V,d:QG(ae,le,Y,ne,I),ref:r})))}):Ne.createElement("path",sA({},Sn(t,!0),{className:V,d:QG(s,v,w,T,I)}))},T4e=["points","className","baseLinePoints","connectNulls"];function Uy(){return Uy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Uy.apply(this,arguments)}function E4e(e,t){if(e==null)return{};var r=A4e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function A4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function eH(e){return I4e(e)||C4e(e)||P4e(e)||k4e()}function k4e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P4e(e,t){if(e){if(typeof e=="string")return oD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oD(e,t)}}function C4e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function I4e(e){if(Array.isArray(e))return oD(e)}function oD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var tH=function(e){return e&&e.x===+e.x&&e.y===+e.y},M4e=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=[[]];return e.forEach(function(r){tH(r)?t[t.length-1].push(r):t[t.length-1].length>0&&t.push([])}),tH(e[0])&&t[t.length-1].push(e[0]),t[t.length-1].length<=0&&(t=t.slice(0,-1)),t},Ib=function(e,t){var r=M4e(e);t&&(r=[r.reduce(function(c,h){return[].concat(eH(c),eH(h))},[])]);var n=r.map(function(c){return c.reduce(function(h,p,s){return"".concat(h).concat(s===0?"M":"L").concat(p.x,",").concat(p.y)},"")}).join("");return r.length===1?"".concat(n,"Z"):n},O4e=function(e,t,r){var n=Ib(e,r);return"".concat(n.slice(-1)==="Z"?n.slice(0,-1):n,"L").concat(Ib(t.reverse(),r).slice(1))},j4e=function(e){var t=e.points,r=e.className,n=e.baseLinePoints,c=e.connectNulls,h=E4e(e,T4e);if(!t||!t.length)return null;var p=Wn("recharts-polygon",r);if(n&&n.length){var s=h.stroke&&h.stroke!=="none",v=O4e(t,n,c);return Ne.createElement("g",{className:p},Ne.createElement("path",Uy({},Sn(h,!0),{fill:v.slice(-1)==="Z"?h.fill:"none",stroke:"none",d:v})),s?Ne.createElement("path",Uy({},Sn(h,!0),{fill:"none",d:Ib(t,c)})):null,s?Ne.createElement("path",Uy({},Sn(h,!0),{fill:"none",d:Ib(n,c)})):null)}var w=Ib(t,c);return Ne.createElement("path",Uy({},Sn(h,!0),{fill:w.slice(-1)==="Z"?h.fill:"none",className:p,d:w}))};function aD(){return aD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},aD.apply(this,arguments)}var eN=function(e){var t=e.cx,r=e.cy,n=e.r,c=e.className,h=Wn("recharts-dot",c);return t===+t&&r===+r&&n===+n?Z.createElement("circle",aD({},Sn(e,!1),AE(e),{className:h,cx:t,cy:r,r:n})):null};function Mw(e){"@babel/helpers - typeof";return Mw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mw(e)}var R4e=["x","y","top","left","width","height","className"];function lD(){return lD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lD.apply(this,arguments)}function rH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function D4e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rH(Object(r),!0).forEach(function(n){L4e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function L4e(e,t,r){return t=z4e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function z4e(e){var t=N4e(e,"string");return Mw(t)=="symbol"?t:t+""}function N4e(e,t){if(Mw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Mw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function F4e(e,t){if(e==null)return{};var r=B4e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function B4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var V4e=function(e,t,r,n,c,h){return"M".concat(e,",").concat(c,"v").concat(n,"M").concat(h,",").concat(t,"h").concat(r)},U4e=function(e){var t=e.x,r=t===void 0?0:t,n=e.y,c=n===void 0?0:n,h=e.top,p=h===void 0?0:h,s=e.left,v=s===void 0?0:s,w=e.width,T=w===void 0?0:w,I=e.height,O=I===void 0?0:I,D=e.className,B=F4e(e,R4e),N=D4e({x:r,y:c,top:p,left:v,width:T,height:O},B);return!fr(r)||!fr(c)||!fr(T)||!fr(O)||!fr(p)||!fr(v)?null:Ne.createElement("path",lD({},Sn(N,!0),{className:Wn("recharts-cross",D),d:V4e(r,c,T,O,p,v)}))},$4e=iP,G4e=Mee,H4e=Ou;function W4e(e,t){return e&&e.length?$4e(e,H4e(t),G4e):void 0}var q4e=W4e;const Z4e=ki(q4e);var K4e=iP,X4e=Ou,Y4e=Oee;function J4e(e,t){return e&&e.length?K4e(e,X4e(t),Y4e):void 0}var Q4e=J4e;const e6e=ki(Q4e);var t6e=["cx","cy","angle","ticks","axisLine"],r6e=["ticks","tick","angle","tickFormatter","stroke"];function O_(e){"@babel/helpers - typeof";return O_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O_(e)}function Mb(){return Mb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mb.apply(this,arguments)}function nH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function zp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nH(Object(r),!0).forEach(function(n){hP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iH(e,t){if(e==null)return{};var r=n6e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function n6e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function i6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,bte(n.key),n)}}function s6e(e,t,r){return t&&sH(e.prototype,t),r&&sH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o6e(e,t,r){return t=oA(t),a6e(e,xte()?Reflect.construct(t,r||[],oA(e).constructor):t.apply(e,r))}function a6e(e,t){if(t&&(O_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return l6e(e)}function l6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xte=function(){return!!e})()}function oA(e){return oA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},oA(e)}function c6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cD(e,t)}function cD(e,t){return cD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},cD(e,t)}function hP(e,t,r){return t=bte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bte(e){var t=u6e(e,"string");return O_(t)=="symbol"?t:t+""}function u6e(e,t){if(O_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(O_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var dP=function(e){function t(){return i6e(this,t),o6e(this,t,arguments)}return c6e(t,e),s6e(t,[{key:"getTickValueCoord",value:function(r){var n=r.coordinate,c=this.props,h=c.angle,p=c.cx,s=c.cy;return es(p,s,n,h)}},{key:"getTickTextAnchor",value:function(){var r=this.props.orientation,n;switch(r){case"left":n="end";break;case"right":n="start";break;default:n="middle";break}return n}},{key:"getViewBox",value:function(){var r=this.props,n=r.cx,c=r.cy,h=r.angle,p=r.ticks,s=Z4e(p,function(w){return w.coordinate||0}),v=e6e(p,function(w){return w.coordinate||0});return{cx:n,cy:c,startAngle:h,endAngle:h,innerRadius:v.coordinate||0,outerRadius:s.coordinate||0}}},{key:"renderAxisLine",value:function(){var r=this.props,n=r.cx,c=r.cy,h=r.angle,p=r.ticks,s=r.axisLine,v=iH(r,t6e),w=p.reduce(function(D,B){return[Math.min(D[0],B.coordinate),Math.max(D[1],B.coordinate)]},[1/0,-1/0]),T=es(n,c,w[0],h),I=es(n,c,w[1],h),O=zp(zp(zp({},Sn(v,!1)),{},{fill:"none"},Sn(s,!1)),{},{x1:T.x,y1:T.y,x2:I.x,y2:I.y});return Ne.createElement("line",Mb({className:"recharts-polar-radius-axis-line"},O))}},{key:"renderTicks",value:function(){var r=this,n=this.props,c=n.ticks,h=n.tick,p=n.angle,s=n.tickFormatter,v=n.stroke,w=iH(n,r6e),T=this.getTickTextAnchor(),I=Sn(w,!1),O=Sn(h,!1),D=c.map(function(B,N){var G=r.getTickValueCoord(B),U=zp(zp(zp(zp({textAnchor:T,transform:"rotate(".concat(90-p,", ").concat(G.x,", ").concat(G.y,")")},I),{},{stroke:"none",fill:v},O),{},{index:N},G),{},{payload:B});return Ne.createElement(Li,Mb({className:Wn("recharts-polar-radius-axis-tick",ote(h)),key:"tick-".concat(B.coordinate)},Tm(r.props,B,N)),t.renderTickItem(h,U,s?s(B.value,N):B.value))});return Ne.createElement(Li,{className:"recharts-polar-radius-axis-ticks"},D)}},{key:"render",value:function(){var r=this.props,n=r.ticks,c=r.axisLine,h=r.tick;return!n||!n.length?null:Ne.createElement(Li,{className:Wn("recharts-polar-radius-axis",this.props.className)},c&&this.renderAxisLine(),h&&this.renderTicks(),_o.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(r,n,c){var h;return Ne.isValidElement(r)?h=Ne.cloneElement(r,n):Cn(r)?h=r(n):h=Ne.createElement(Em,Mb({},n,{className:"recharts-polar-radius-axis-tick-value"}),c),h}}])}(Z.PureComponent);hP(dP,"displayName","PolarRadiusAxis");hP(dP,"axisType","radiusAxis");hP(dP,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function j_(e){"@babel/helpers - typeof";return j_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j_(e)}function Zp(){return Zp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Zp.apply(this,arguments)}function oH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Np(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oH(Object(r),!0).forEach(function(n){fP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function h6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function aH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ste(n.key),n)}}function d6e(e,t,r){return t&&aH(e.prototype,t),r&&aH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function f6e(e,t,r){return t=aA(t),p6e(e,wte()?Reflect.construct(t,r||[],aA(e).constructor):t.apply(e,r))}function p6e(e,t){if(t&&(j_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m6e(e)}function m6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wte=function(){return!!e})()}function aA(e){return aA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},aA(e)}function g6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uD(e,t)}function uD(e,t){return uD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},uD(e,t)}function fP(e,t,r){return t=Ste(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ste(e){var t=y6e(e,"string");return j_(t)=="symbol"?t:t+""}function y6e(e,t){if(j_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(j_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var _6e=Math.PI/180,lH=1e-5,pP=function(e){function t(){return h6e(this,t),f6e(this,t,arguments)}return g6e(t,e),d6e(t,[{key:"getTickLineCoord",value:function(r){var n=this.props,c=n.cx,h=n.cy,p=n.radius,s=n.orientation,v=n.tickSize,w=v||8,T=es(c,h,p,r.coordinate),I=es(c,h,p+(s==="inner"?-1:1)*w,r.coordinate);return{x1:T.x,y1:T.y,x2:I.x,y2:I.y}}},{key:"getTickTextAnchor",value:function(r){var n=this.props.orientation,c=Math.cos(-r.coordinate*_6e),h;return c>lH?h=n==="outer"?"start":"end":c<-lH?h=n==="outer"?"end":"start":h="middle",h}},{key:"renderAxisLine",value:function(){var r=this.props,n=r.cx,c=r.cy,h=r.radius,p=r.axisLine,s=r.axisLineType,v=Np(Np({},Sn(this.props,!1)),{},{fill:"none"},Sn(p,!1));if(s==="circle")return Ne.createElement(eN,Zp({className:"recharts-polar-angle-axis-line"},v,{cx:n,cy:c,r:h}));var w=this.props.ticks,T=w.map(function(I){return es(n,c,h,I.coordinate)});return Ne.createElement(j4e,Zp({className:"recharts-polar-angle-axis-line"},v,{points:T}))}},{key:"renderTicks",value:function(){var r=this,n=this.props,c=n.ticks,h=n.tick,p=n.tickLine,s=n.tickFormatter,v=n.stroke,w=Sn(this.props,!1),T=Sn(h,!1),I=Np(Np({},w),{},{fill:"none"},Sn(p,!1)),O=c.map(function(D,B){var N=r.getTickLineCoord(D),G=r.getTickTextAnchor(D),U=Np(Np(Np({textAnchor:G},w),{},{stroke:"none",fill:v},T),{},{index:B,payload:D,x:N.x2,y:N.y2});return Ne.createElement(Li,Zp({className:Wn("recharts-polar-angle-axis-tick",ote(h)),key:"tick-".concat(D.coordinate)},Tm(r.props,D,B)),p&&Ne.createElement("line",Zp({className:"recharts-polar-angle-axis-tick-line"},I,N)),h&&t.renderTickItem(h,U,s?s(D.value,B):D.value))});return Ne.createElement(Li,{className:"recharts-polar-angle-axis-ticks"},O)}},{key:"render",value:function(){var r=this.props,n=r.ticks,c=r.radius,h=r.axisLine;return c<=0||!n||!n.length?null:Ne.createElement(Li,{className:Wn("recharts-polar-angle-axis",this.props.className)},h&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(r,n,c){var h;return Ne.isValidElement(r)?h=Ne.cloneElement(r,n):Cn(r)?h=r(n):h=Ne.createElement(Em,Zp({},n,{className:"recharts-polar-angle-axis-tick-value"}),c),h}}])}(Z.PureComponent);fP(pP,"displayName","PolarAngleAxis");fP(pP,"axisType","angleAxis");fP(pP,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var v6e=EQ,x6e=v6e(Object.getPrototypeOf,Object),b6e=x6e,w6e=Fh,S6e=b6e,T6e=Bh,E6e="[object Object]",A6e=Function.prototype,k6e=Object.prototype,Tte=A6e.toString,P6e=k6e.hasOwnProperty,C6e=Tte.call(Object);function I6e(e){if(!T6e(e)||w6e(e)!=E6e)return!1;var t=S6e(e);if(t===null)return!0;var r=P6e.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Tte.call(r)==C6e}var M6e=I6e;const O6e=ki(M6e);var j6e=Fh,R6e=Bh,D6e="[object Boolean]";function L6e(e){return e===!0||e===!1||R6e(e)&&j6e(e)==D6e}var z6e=L6e;const N6e=ki(z6e);function Ow(e){"@babel/helpers - typeof";return Ow=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ow(e)}function lA(){return lA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lA.apply(this,arguments)}function F6e(e,t){return $6e(e)||U6e(e,t)||V6e(e,t)||B6e()}function B6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V6e(e,t){if(e){if(typeof e=="string")return cH(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cH(e,t)}}function cH(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function U6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function $6e(e){if(Array.isArray(e))return e}function uH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function hH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uH(Object(r),!0).forEach(function(n){G6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function G6e(e,t,r){return t=H6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H6e(e){var t=W6e(e,"string");return Ow(t)=="symbol"?t:t+""}function W6e(e,t){if(Ow(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ow(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var dH=function(e,t,r,n,c){var h=r-n,p;return p="M ".concat(e,",").concat(t),p+="L ".concat(e+r,",").concat(t),p+="L ".concat(e+r-h/2,",").concat(t+c),p+="L ".concat(e+r-h/2-n,",").concat(t+c),p+="L ".concat(e,",").concat(t," Z"),p},q6e={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Z6e=function(e){var t=hH(hH({},q6e),e),r=Z.useRef(),n=Z.useState(-1),c=F6e(n,2),h=c[0],p=c[1];Z.useEffect(function(){if(r.current&&r.current.getTotalLength)try{var V=r.current.getTotalLength();V&&p(V)}catch{}},[]);var s=t.x,v=t.y,w=t.upperWidth,T=t.lowerWidth,I=t.height,O=t.className,D=t.animationEasing,B=t.animationDuration,N=t.animationBegin,G=t.isUpdateAnimationActive;if(s!==+s||v!==+v||w!==+w||T!==+T||I!==+I||w===0&&T===0||I===0)return null;var U=Wn("recharts-trapezoid",O);return G?Ne.createElement(Dh,{canBegin:h>0,from:{upperWidth:0,lowerWidth:0,height:I,x:s,y:v},to:{upperWidth:w,lowerWidth:T,height:I,x:s,y:v},duration:B,animationEasing:D,isActive:G},function(V){var X=V.upperWidth,Y=V.lowerWidth,ne=V.height,ae=V.x,le=V.y;return Ne.createElement(Dh,{canBegin:h>0,from:"0px ".concat(h===-1?1:h,"px"),to:"".concat(h,"px 0px"),attributeName:"strokeDasharray",begin:N,duration:B,easing:D},Ne.createElement("path",lA({},Sn(t,!0),{className:U,d:dH(ae,le,X,Y,ne),ref:r})))}):Ne.createElement("g",null,Ne.createElement("path",lA({},Sn(t,!0),{className:U,d:dH(s,v,w,T,I)})))},K6e=["option","shapeType","propTransformer","activeClassName","isActive"];function jw(e){"@babel/helpers - typeof";return jw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jw(e)}function X6e(e,t){if(e==null)return{};var r=Y6e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Y6e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function fH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function cA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fH(Object(r),!0).forEach(function(n){J6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function J6e(e,t,r){return t=Q6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q6e(e){var t=eVe(e,"string");return jw(t)=="symbol"?t:t+""}function eVe(e,t){if(jw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function tVe(e,t){return cA(cA({},t),e)}function rVe(e,t){return e==="symbols"}function pH(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ne.createElement(Qz,r);case"trapezoid":return Ne.createElement(Z6e,r);case"sector":return Ne.createElement(cte,r);case"symbols":if(rVe(t))return Ne.createElement(vz,r);break;default:return null}}function nVe(e){return Z.isValidElement(e)?e.props:e}function Ete(e){var t=e.option,r=e.shapeType,n=e.propTransformer,c=n===void 0?tVe:n,h=e.activeClassName,p=h===void 0?"recharts-active-shape":h,s=e.isActive,v=X6e(e,K6e),w;if(Z.isValidElement(t))w=Z.cloneElement(t,cA(cA({},v),nVe(t)));else if(Cn(t))w=t(v);else if(O6e(t)&&!N6e(t)){var T=c(t,v);w=Ne.createElement(pH,{shapeType:r,elementProps:T})}else{var I=v;w=Ne.createElement(pH,{shapeType:r,elementProps:I})}return s?Ne.createElement(Li,{className:p},w):w}function mP(e,t){return t!=null&&"trapezoids"in e.props}function gP(e,t){return t!=null&&"sectors"in e.props}function Rw(e,t){return t!=null&&"points"in e.props}function iVe(e,t){var r,n,c=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,h=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return c&&h}function sVe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function oVe(e,t){var r=e.x===t.x,n=e.y===t.y,c=e.z===t.z;return r&&n&&c}function aVe(e,t){var r;return mP(e,t)?r=iVe:gP(e,t)?r=sVe:Rw(e,t)&&(r=oVe),r}function lVe(e,t){var r;return mP(e,t)?r="trapezoids":gP(e,t)?r="sectors":Rw(e,t)&&(r="points"),r}function cVe(e,t){if(mP(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(gP(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return Rw(e,t)?t.payload:{}}function uVe(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,c=lVe(r,t),h=cVe(r,t),p=n.filter(function(v,w){var T=aP(h,v),I=r.props[c].filter(function(B){var N=aVe(r,t);return N(B,t)}),O=r.props[c].indexOf(I[I.length-1]),D=w===O;return T&&D}),s=n.indexOf(p[p.length-1]);return s}var j2;function R_(e){"@babel/helpers - typeof";return R_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R_(e)}function $y(){return $y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$y.apply(this,arguments)}function mH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Ji(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mH(Object(r),!0).forEach(function(n){Ml(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hVe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kte(n.key),n)}}function dVe(e,t,r){return t&&gH(e.prototype,t),r&&gH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function fVe(e,t,r){return t=uA(t),pVe(e,Ate()?Reflect.construct(t,r||[],uA(e).constructor):t.apply(e,r))}function pVe(e,t){if(t&&(R_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mVe(e)}function mVe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ate(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ate=function(){return!!e})()}function uA(e){return uA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uA(e)}function gVe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hD(e,t)}function hD(e,t){return hD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},hD(e,t)}function Ml(e,t,r){return t=kte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kte(e){var t=yVe(e,"string");return R_(t)=="symbol"?t:t+""}function yVe(e,t){if(R_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(R_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Uh=function(e){function t(r){var n;return hVe(this,t),n=fVe(this,t,[r]),Ml(n,"pieRef",null),Ml(n,"sectorRefs",[]),Ml(n,"id",o1("recharts-pie-")),Ml(n,"handleAnimationEnd",function(){var c=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Cn(c)&&c()}),Ml(n,"handleAnimationStart",function(){var c=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Cn(c)&&c()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return gVe(t,e),dVe(t,[{key:"isActiveIndex",value:function(r){var n=this.props.activeIndex;return Array.isArray(n)?n.indexOf(r)!==-1:r===n}},{key:"hasActiveIndex",value:function(){var r=this.props.activeIndex;return Array.isArray(r)?r.length!==0:r||r===0}},{key:"renderLabels",value:function(r){var n=this.props.isAnimationActive;if(n&&!this.state.isAnimationFinished)return null;var c=this.props,h=c.label,p=c.labelLine,s=c.dataKey,v=c.valueKey,w=Sn(this.props,!1),T=Sn(h,!1),I=Sn(p,!1),O=h&&h.offsetRadius||20,D=r.map(function(B,N){var G=(B.startAngle+B.endAngle)/2,U=es(B.cx,B.cy,B.outerRadius+O,G),V=Ji(Ji(Ji(Ji({},w),B),{},{stroke:"none"},T),{},{index:N,textAnchor:t.getTextAnchor(U.x,B.cx)},U),X=Ji(Ji(Ji(Ji({},w),B),{},{fill:"none",stroke:B.fill},I),{},{index:N,points:[es(B.cx,B.cy,B.outerRadius,G),U]}),Y=s;return ni(s)&&ni(v)?Y="value":ni(s)&&(Y=v),Ne.createElement(Li,{key:"label-".concat(B.startAngle,"-").concat(B.endAngle,"-").concat(B.midAngle,"-").concat(N)},p&&t.renderLabelLineItem(p,X,"line"),t.renderLabelItem(h,V,Jo(B,Y)))});return Ne.createElement(Li,{className:"recharts-pie-labels"},D)}},{key:"renderSectorsStatically",value:function(r){var n=this,c=this.props,h=c.activeShape,p=c.blendStroke,s=c.inactiveShape;return r.map(function(v,w){if(v?.startAngle===0&&v?.endAngle===0&&r.length!==1)return null;var T=n.isActiveIndex(w),I=s&&n.hasActiveIndex()?s:null,O=T?h:I,D=Ji(Ji({},v),{},{stroke:p?v.fill:v.stroke,tabIndex:-1});return Ne.createElement(Li,$y({ref:function(B){B&&!n.sectorRefs.includes(B)&&n.sectorRefs.push(B)},tabIndex:-1,className:"recharts-pie-sector"},Tm(n.props,v,w),{key:"sector-".concat(v?.startAngle,"-").concat(v?.endAngle,"-").concat(v.midAngle,"-").concat(w)}),Ne.createElement(Ete,$y({option:O,isActive:T,shapeType:"sector"},D)))})}},{key:"renderSectorsWithAnimation",value:function(){var r=this,n=this.props,c=n.sectors,h=n.isAnimationActive,p=n.animationBegin,s=n.animationDuration,v=n.animationEasing,w=n.animationId,T=this.state,I=T.prevSectors,O=T.prevIsAnimationActive;return Ne.createElement(Dh,{begin:p,duration:s,isActive:h,easing:v,from:{t:0},to:{t:1},key:"pie-".concat(w,"-").concat(O),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(D){var B=D.t,N=[],G=c&&c[0],U=G.startAngle;return c.forEach(function(V,X){var Y=I&&I[X],ne=X>0?fl(V,"paddingAngle",0):0;if(Y){var ae=Wd(Y.endAngle-Y.startAngle,V.endAngle-V.startAngle),le=Ji(Ji({},V),{},{startAngle:U+ne,endAngle:U+ae(B)+ne});N.push(le),U=le.endAngle}else{var ge=V.endAngle,je=V.startAngle,ze=Wd(0,ge-je),Pe=ze(B),Ke=Ji(Ji({},V),{},{startAngle:U+ne,endAngle:U+Pe+ne});N.push(Ke),U=Ke.endAngle}}),Ne.createElement(Li,null,r.renderSectorsStatically(N))})}},{key:"attachKeyboardHandlers",value:function(r){var n=this;r.onkeydown=function(c){if(!c.altKey)switch(c.key){case"ArrowLeft":{var h=++n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[h].focus(),n.setState({sectorToFocus:h});break}case"ArrowRight":{var p=--n.state.sectorToFocus<0?n.sectorRefs.length-1:n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[p].focus(),n.setState({sectorToFocus:p});break}case"Escape":{n.sectorRefs[n.state.sectorToFocus].blur(),n.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var r=this.props,n=r.sectors,c=r.isAnimationActive,h=this.state.prevSectors;return c&&n&&n.length&&(!h||!aP(h,n))?this.renderSectorsWithAnimation():this.renderSectorsStatically(n)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var r=this,n=this.props,c=n.hide,h=n.sectors,p=n.className,s=n.label,v=n.cx,w=n.cy,T=n.innerRadius,I=n.outerRadius,O=n.isAnimationActive,D=this.state.isAnimationFinished;if(c||!h||!h.length||!fr(v)||!fr(w)||!fr(T)||!fr(I))return null;var B=Wn("recharts-pie",p);return Ne.createElement(Li,{tabIndex:this.props.rootTabIndex,className:B,ref:function(N){r.pieRef=N}},this.renderSectors(),s&&this.renderLabels(h),_o.renderCallByParent(this.props,null,!1),(!O||D)&&ff.renderCallByParent(this.props,h,!1))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return n.prevIsAnimationActive!==r.isAnimationActive?{prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,curSectors:r.sectors,prevSectors:[],isAnimationFinished:!0}:r.isAnimationActive&&r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curSectors:r.sectors,prevSectors:n.curSectors,isAnimationFinished:!0}:r.sectors!==n.curSectors?{curSectors:r.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(r,n){return r>n?"start":r<n?"end":"middle"}},{key:"renderLabelLineItem",value:function(r,n,c){if(Ne.isValidElement(r))return Ne.cloneElement(r,n);if(Cn(r))return r(n);var h=Wn("recharts-pie-label-line",typeof r!="boolean"?r.className:"");return Ne.createElement(XR,$y({},n,{key:c,type:"linear",className:h}))}},{key:"renderLabelItem",value:function(r,n,c){if(Ne.isValidElement(r))return Ne.cloneElement(r,n);var h=c;if(Cn(r)&&(h=r(n),Ne.isValidElement(h)))return h;var p=Wn("recharts-pie-label-text",typeof r!="boolean"&&!Cn(r)?r.className:"");return Ne.createElement(Em,$y({},n,{alignmentBaseline:"middle",className:p}),h)}}])}(Z.PureComponent);j2=Uh;Ml(Uh,"displayName","Pie");Ml(Uh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!gv.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Ml(Uh,"parseDeltaAngle",function(e,t){var r=ya(t-e),n=Math.min(Math.abs(t-e),360);return r*n});Ml(Uh,"getRealPieData",function(e){var t=e.data,r=e.children,n=Sn(e,!1),c=Ll(r,l1);return t&&t.length?t.map(function(h,p){return Ji(Ji(Ji({payload:h},n),h),c&&c[p]&&c[p].props)}):c&&c.length?c.map(function(h){return Ji(Ji({},n),h.props)}):[]});Ml(Uh,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,c=t.width,h=t.height,p=ste(c,h),s=n+_a(e.cx,c,c/2),v=r+_a(e.cy,h,h/2),w=_a(e.innerRadius,p,0),T=_a(e.outerRadius,p,p*.8),I=e.maxRadius||Math.sqrt(c*c+h*h)/2;return{cx:s,cy:v,innerRadius:w,outerRadius:T,maxRadius:I}});Ml(Uh,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Ji(Ji({},t.type.defaultProps),t.props):t.props,c=j2.getRealPieData(n);if(!c||!c.length)return null;var h=n.cornerRadius,p=n.startAngle,s=n.endAngle,v=n.paddingAngle,w=n.dataKey,T=n.nameKey,I=n.valueKey,O=n.tooltipType,D=Math.abs(n.minAngle),B=j2.parseCoordinateOfPie(n,r),N=j2.parseDeltaAngle(p,s),G=Math.abs(N),U=w;ni(w)&&ni(I)?(_c(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),U="value"):ni(w)&&(_c(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),U=I);var V=c.filter(function(ge){return Jo(ge,U,0)!==0}).length,X=(G>=360?V:V-1)*v,Y=G-V*D-X,ne=c.reduce(function(ge,je){var ze=Jo(je,U,0);return ge+(fr(ze)?ze:0)},0),ae;if(ne>0){var le;ae=c.map(function(ge,je){var ze=Jo(ge,U,0),Pe=Jo(ge,T,je),Ke=(fr(ze)?ze:0)/ne,Ye;je?Ye=le.endAngle+ya(N)*v*(ze!==0?1:0):Ye=p;var Oe=Ye+ya(N)*((ze!==0?D:0)+Ke*Y),tt=(Ye+Oe)/2,We=(B.innerRadius+B.outerRadius)/2,lt=[{name:Pe,value:ze,payload:ge,dataKey:U,type:O}],rt=es(B.cx,B.cy,We,tt);return le=Ji(Ji(Ji({percent:Ke,cornerRadius:h,name:Pe,tooltipPayload:lt,midAngle:tt,middleRadius:We,tooltipPosition:rt},ge),B),{},{value:Jo(ge,U),startAngle:Ye,endAngle:Oe,payload:ge,paddingAngle:ya(N)*v}),le})}return Ji(Ji({},B),{},{sectors:ae,data:c})});var _Ve=Math.ceil,vVe=Math.max;function xVe(e,t,r,n){for(var c=-1,h=vVe(_Ve((t-e)/(r||1)),0),p=Array(h);h--;)p[n?h:++c]=e,e+=r;return p}var bVe=xVe,wVe=GQ,yH=1/0,SVe=17976931348623157e292;function TVe(e){if(!e)return e===0?e:0;if(e=wVe(e),e===yH||e===-yH){var t=e<0?-1:1;return t*SVe}return e===e?e:0}var Pte=TVe,EVe=bVe,AVe=Yk,XM=Pte;function kVe(e){return function(t,r,n){return n&&typeof n!="number"&&AVe(t,r,n)&&(r=n=void 0),t=XM(t),r===void 0?(r=t,t=0):r=XM(r),n=n===void 0?t<r?1:-1:XM(n),EVe(t,r,n,e)}}var PVe=kVe,CVe=PVe,IVe=CVe(),MVe=IVe;const hA=ki(MVe);function Dw(e){"@babel/helpers - typeof";return Dw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dw(e)}function _H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function vH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_H(Object(r),!0).forEach(function(n){Cte(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_H(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Cte(e,t,r){return t=OVe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OVe(e){var t=jVe(e,"string");return Dw(t)=="symbol"?t:t+""}function jVe(e,t){if(Dw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Dw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var RVe=["Webkit","Moz","O","ms"],DVe=function(e,t){var r=e.replace(/(\w)/,function(c){return c.toUpperCase()}),n=RVe.reduce(function(c,h){return vH(vH({},c),{},Cte({},h+r,t))},{});return n[e]=t,n};function D_(e){"@babel/helpers - typeof";return D_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D_(e)}function dA(){return dA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dA.apply(this,arguments)}function xH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function YM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xH(Object(r),!0).forEach(function(n){il(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LVe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Mte(n.key),n)}}function zVe(e,t,r){return t&&bH(e.prototype,t),r&&bH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function NVe(e,t,r){return t=fA(t),FVe(e,Ite()?Reflect.construct(t,r||[],fA(e).constructor):t.apply(e,r))}function FVe(e,t){if(t&&(D_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BVe(e)}function BVe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ite(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ite=function(){return!!e})()}function fA(e){return fA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fA(e)}function VVe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dD(e,t)}function dD(e,t){return dD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},dD(e,t)}function il(e,t,r){return t=Mte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mte(e){var t=UVe(e,"string");return D_(t)=="symbol"?t:t+""}function UVe(e,t){if(D_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(D_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var $Ve=function(e){var t=e.data,r=e.startIndex,n=e.endIndex,c=e.x,h=e.width,p=e.travellerWidth;if(!t||!t.length)return{};var s=t.length,v=Pb().domain(hA(0,s)).range([c,c+h-p]),w=v.domain().map(function(T){return v(T)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:v(r),endX:v(n),scale:v,scaleValues:w}},wH=function(e){return e.changedTouches&&!!e.changedTouches.length},L_=function(e){function t(r){var n;return LVe(this,t),n=NVe(this,t,[r]),il(n,"handleDrag",function(c){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(c):n.state.isSlideMoving&&n.handleSlideDrag(c)}),il(n,"handleTouchMove",function(c){c.changedTouches!=null&&c.changedTouches.length>0&&n.handleDrag(c.changedTouches[0])}),il(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var c=n.props,h=c.endIndex,p=c.onDragEnd,s=c.startIndex;p?.({endIndex:h,startIndex:s})}),n.detachDragEndListener()}),il(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),il(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),il(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),il(n,"handleSlideDragStart",function(c){var h=wH(c)?c.changedTouches[0]:c;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:h.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return VVe(t,e),zVe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(r){var n=r.startX,c=r.endX,h=this.state.scaleValues,p=this.props,s=p.gap,v=p.data,w=v.length-1,T=Math.min(n,c),I=Math.max(n,c),O=t.getIndexInRange(h,T),D=t.getIndexInRange(h,I);return{startIndex:O-O%s,endIndex:D===w?w:D-D%s}}},{key:"getTextOfTick",value:function(r){var n=this.props,c=n.data,h=n.tickFormatter,p=n.dataKey,s=Jo(c[r],p,r);return Cn(h)?h(s,r):s}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(r){var n=this.state,c=n.slideMoveStartX,h=n.startX,p=n.endX,s=this.props,v=s.x,w=s.width,T=s.travellerWidth,I=s.startIndex,O=s.endIndex,D=s.onChange,B=r.pageX-c;B>0?B=Math.min(B,v+w-T-p,v+w-T-h):B<0&&(B=Math.max(B,v-h,v-p));var N=this.getIndex({startX:h+B,endX:p+B});(N.startIndex!==I||N.endIndex!==O)&&D&&D(N),this.setState({startX:h+B,endX:p+B,slideMoveStartX:r.pageX})}},{key:"handleTravellerDragStart",value:function(r,n){var c=wH(n)?n.changedTouches[0]:n;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:r,brushMoveStartX:c.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(r){var n=this.state,c=n.brushMoveStartX,h=n.movingTravellerId,p=n.endX,s=n.startX,v=this.state[h],w=this.props,T=w.x,I=w.width,O=w.travellerWidth,D=w.onChange,B=w.gap,N=w.data,G={startX:this.state.startX,endX:this.state.endX},U=r.pageX-c;U>0?U=Math.min(U,T+I-O-v):U<0&&(U=Math.max(U,T-v)),G[h]=v+U;var V=this.getIndex(G),X=V.startIndex,Y=V.endIndex,ne=function(){var ae=N.length-1;return h==="startX"&&(p>s?X%B===0:Y%B===0)||p<s&&Y===ae||h==="endX"&&(p>s?Y%B===0:X%B===0)||p>s&&Y===ae};this.setState(il(il({},h,v+U),"brushMoveStartX",r.pageX),function(){D&&ne()&&D(V)})}},{key:"handleTravellerMoveKeyboard",value:function(r,n){var c=this,h=this.state,p=h.scaleValues,s=h.startX,v=h.endX,w=this.state[n],T=p.indexOf(w);if(T!==-1){var I=T+r;if(!(I===-1||I>=p.length)){var O=p[I];n==="startX"&&O>=v||n==="endX"&&O<=s||this.setState(il({},n,O),function(){c.props.onChange(c.getIndex({startX:c.state.startX,endX:c.state.endX}))})}}}},{key:"renderBackground",value:function(){var r=this.props,n=r.x,c=r.y,h=r.width,p=r.height,s=r.fill,v=r.stroke;return Ne.createElement("rect",{stroke:v,fill:s,x:n,y:c,width:h,height:p})}},{key:"renderPanorama",value:function(){var r=this.props,n=r.x,c=r.y,h=r.width,p=r.height,s=r.data,v=r.children,w=r.padding,T=Z.Children.only(v);return T?Ne.cloneElement(T,{x:n,y:c,width:h,height:p,margin:w,compact:!0,data:s}):null}},{key:"renderTravellerLayer",value:function(r,n){var c,h,p=this,s=this.props,v=s.y,w=s.travellerWidth,T=s.height,I=s.traveller,O=s.ariaLabel,D=s.data,B=s.startIndex,N=s.endIndex,G=Math.max(r,this.props.x),U=YM(YM({},Sn(this.props,!1)),{},{x:G,y:v,width:w,height:T}),V=O||"Min value: ".concat((c=D[B])===null||c===void 0?void 0:c.name,", Max value: ").concat((h=D[N])===null||h===void 0?void 0:h.name);return Ne.createElement(Li,{tabIndex:0,role:"slider","aria-label":V,"aria-valuenow":r,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[n],onTouchStart:this.travellerDragStartHandlers[n],onKeyDown:function(X){["ArrowLeft","ArrowRight"].includes(X.key)&&(X.preventDefault(),X.stopPropagation(),p.handleTravellerMoveKeyboard(X.key==="ArrowRight"?1:-1,n))},onFocus:function(){p.setState({isTravellerFocused:!0})},onBlur:function(){p.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(I,U))}},{key:"renderSlide",value:function(r,n){var c=this.props,h=c.y,p=c.height,s=c.stroke,v=c.travellerWidth,w=Math.min(r,n)+v,T=Math.max(Math.abs(n-r)-v,0);return Ne.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:s,fillOpacity:.2,x:w,y:h,width:T,height:p})}},{key:"renderText",value:function(){var r=this.props,n=r.startIndex,c=r.endIndex,h=r.y,p=r.height,s=r.travellerWidth,v=r.stroke,w=this.state,T=w.startX,I=w.endX,O=5,D={pointerEvents:"none",fill:v};return Ne.createElement(Li,{className:"recharts-brush-texts"},Ne.createElement(Em,dA({textAnchor:"end",verticalAnchor:"middle",x:Math.min(T,I)-O,y:h+p/2},D),this.getTextOfTick(n)),Ne.createElement(Em,dA({textAnchor:"start",verticalAnchor:"middle",x:Math.max(T,I)+s+O,y:h+p/2},D),this.getTextOfTick(c)))}},{key:"render",value:function(){var r=this.props,n=r.data,c=r.className,h=r.children,p=r.x,s=r.y,v=r.width,w=r.height,T=r.alwaysShowText,I=this.state,O=I.startX,D=I.endX,B=I.isTextActive,N=I.isSlideMoving,G=I.isTravellerMoving,U=I.isTravellerFocused;if(!n||!n.length||!fr(p)||!fr(s)||!fr(v)||!fr(w)||v<=0||w<=0)return null;var V=Wn("recharts-brush",c),X=Ne.Children.count(h)===1,Y=DVe("userSelect","none");return Ne.createElement(Li,{className:V,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:Y},this.renderBackground(),X&&this.renderPanorama(),this.renderSlide(O,D),this.renderTravellerLayer(O,"startX"),this.renderTravellerLayer(D,"endX"),(B||N||G||U||T)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(r){var n=r.x,c=r.y,h=r.width,p=r.height,s=r.stroke,v=Math.floor(c+p/2)-1;return Ne.createElement(Ne.Fragment,null,Ne.createElement("rect",{x:n,y:c,width:h,height:p,fill:s,stroke:"none"}),Ne.createElement("line",{x1:n+1,y1:v,x2:n+h-1,y2:v,fill:"none",stroke:"#fff"}),Ne.createElement("line",{x1:n+1,y1:v+2,x2:n+h-1,y2:v+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(r,n){var c;return Ne.isValidElement(r)?c=Ne.cloneElement(r,n):Cn(r)?c=r(n):c=t.renderDefaultTraveller(n),c}},{key:"getDerivedStateFromProps",value:function(r,n){var c=r.data,h=r.width,p=r.x,s=r.travellerWidth,v=r.updateId,w=r.startIndex,T=r.endIndex;if(c!==n.prevData||v!==n.prevUpdateId)return YM({prevData:c,prevTravellerWidth:s,prevUpdateId:v,prevX:p,prevWidth:h},c&&c.length?$Ve({data:c,width:h,x:p,travellerWidth:s,startIndex:w,endIndex:T}):{scale:null,scaleValues:null});if(n.scale&&(h!==n.prevWidth||p!==n.prevX||s!==n.prevTravellerWidth)){n.scale.range([p,p+h-s]);var I=n.scale.domain().map(function(O){return n.scale(O)});return{prevData:c,prevTravellerWidth:s,prevUpdateId:v,prevX:p,prevWidth:h,startX:n.scale(r.startIndex),endX:n.scale(r.endIndex),scaleValues:I}}return null}},{key:"getIndexInRange",value:function(r,n){for(var c=r.length,h=0,p=c-1;p-h>1;){var s=Math.floor((h+p)/2);r[s]>n?p=s:h=s}return n>=r[p]?p:h}}])}(Z.PureComponent);il(L_,"displayName","Brush");il(L_,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var GVe=Az;function HVe(e,t){var r;return GVe(e,function(n,c,h){return r=t(n,c,h),!r}),!!r}var WVe=HVe,qVe=yQ,ZVe=Ou,KVe=WVe,XVe=Ka,YVe=Yk;function JVe(e,t,r){var n=XVe(e)?qVe:KVe;return r&&YVe(e,t,r)&&(t=void 0),n(e,ZVe(t))}var QVe=JVe;const eUe=ki(QVe);var Au=function(e,t){var r=e.alwaysShow,n=e.ifOverflow;return r&&(n="extendDomain"),n===t},SH=FQ;function tUe(e,t,r){t=="__proto__"&&SH?SH(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var rUe=tUe,nUe=rUe,iUe=zQ,sUe=Ou;function oUe(e,t){var r={};return t=sUe(t),iUe(e,function(n,c,h){nUe(r,c,t(n,c,h))}),r}var aUe=oUe;const lUe=ki(aUe);function cUe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var uUe=cUe,hUe=Az;function dUe(e,t){var r=!0;return hUe(e,function(n,c,h){return r=!!t(n,c,h),r}),r}var fUe=dUe,pUe=uUe,mUe=fUe,gUe=Ou,yUe=Ka,_Ue=Yk;function vUe(e,t,r){var n=yUe(e)?pUe:mUe;return r&&_Ue(e,t,r)&&(t=void 0),n(e,gUe(t))}var xUe=vUe;const Ote=ki(xUe);var bUe=["x","y"];function Lw(e){"@babel/helpers - typeof";return Lw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lw(e)}function fD(){return fD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fD.apply(this,arguments)}function TH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Xx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TH(Object(r),!0).forEach(function(n){wUe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wUe(e,t,r){return t=SUe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SUe(e){var t=TUe(e,"string");return Lw(t)=="symbol"?t:t+""}function TUe(e,t){if(Lw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Lw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function EUe(e,t){if(e==null)return{};var r=AUe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function AUe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function kUe(e,t){var r=e.x,n=e.y,c=EUe(e,bUe),h="".concat(r),p=parseInt(h,10),s="".concat(n),v=parseInt(s,10),w="".concat(t.height||c.height),T=parseInt(w,10),I="".concat(t.width||c.width),O=parseInt(I,10);return Xx(Xx(Xx(Xx(Xx({},t),c),p?{x:p}:{}),v?{y:v}:{}),{},{height:T,width:O,name:t.name,radius:t.radius})}function EH(e){return Ne.createElement(Ete,fD({shapeType:"rectangle",propTransformer:kUe,activeClassName:"recharts-active-bar"},e))}var PUe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(r,n){if(typeof e=="number")return e;var c=fr(r)||W2e(r);return c?e(r,n):(c||km(),t)}},CUe=["value","background"],jte;function z_(e){"@babel/helpers - typeof";return z_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z_(e)}function IUe(e,t){if(e==null)return{};var r=MUe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function MUe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function pA(){return pA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pA.apply(this,arguments)}function AH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Ns(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?AH(Object(r),!0).forEach(function(n){tf(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):AH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Dte(n.key),n)}}function jUe(e,t,r){return t&&kH(e.prototype,t),r&&kH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function RUe(e,t,r){return t=mA(t),DUe(e,Rte()?Reflect.construct(t,r||[],mA(e).constructor):t.apply(e,r))}function DUe(e,t){if(t&&(z_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LUe(e)}function LUe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Rte=function(){return!!e})()}function mA(e){return mA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mA(e)}function zUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pD(e,t)}function pD(e,t){return pD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},pD(e,t)}function tf(e,t,r){return t=Dte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dte(e){var t=NUe(e,"string");return z_(t)=="symbol"?t:t+""}function NUe(e,t){if(z_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(z_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Lh=function(e){function t(){var r;OUe(this,t);for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];return r=RUe(this,t,[].concat(c)),tf(r,"state",{isAnimationFinished:!1}),tf(r,"id",o1("recharts-bar-")),tf(r,"handleAnimationEnd",function(){var p=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),p&&p()}),tf(r,"handleAnimationStart",function(){var p=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),p&&p()}),r}return zUe(t,e),jUe(t,[{key:"renderRectanglesStatically",value:function(r){var n=this,c=this.props,h=c.shape,p=c.dataKey,s=c.activeIndex,v=c.activeBar,w=Sn(this.props,!1);return r&&r.map(function(T,I){var O=I===s,D=O?v:h,B=Ns(Ns(Ns({},w),T),{},{isActive:O,option:D,index:I,dataKey:p,onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd});return Ne.createElement(Li,pA({className:"recharts-bar-rectangle"},Tm(n.props,T,I),{key:"rectangle-".concat(T?.x,"-").concat(T?.y,"-").concat(T?.value,"-").concat(I)}),Ne.createElement(EH,B))})}},{key:"renderRectanglesWithAnimation",value:function(){var r=this,n=this.props,c=n.data,h=n.layout,p=n.isAnimationActive,s=n.animationBegin,v=n.animationDuration,w=n.animationEasing,T=n.animationId,I=this.state.prevData;return Ne.createElement(Dh,{begin:s,duration:v,isActive:p,easing:w,from:{t:0},to:{t:1},key:"bar-".concat(T),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(O){var D=O.t,B=c.map(function(N,G){var U=I&&I[G];if(U){var V=Wd(U.x,N.x),X=Wd(U.y,N.y),Y=Wd(U.width,N.width),ne=Wd(U.height,N.height);return Ns(Ns({},N),{},{x:V(D),y:X(D),width:Y(D),height:ne(D)})}if(h==="horizontal"){var ae=Wd(0,N.height),le=ae(D);return Ns(Ns({},N),{},{y:N.y+N.height-le,height:le})}var ge=Wd(0,N.width),je=ge(D);return Ns(Ns({},N),{},{width:je})});return Ne.createElement(Li,null,r.renderRectanglesStatically(B))})}},{key:"renderRectangles",value:function(){var r=this.props,n=r.data,c=r.isAnimationActive,h=this.state.prevData;return c&&n&&n.length&&(!h||!aP(h,n))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(n)}},{key:"renderBackground",value:function(){var r=this,n=this.props,c=n.data,h=n.dataKey,p=n.activeIndex,s=Sn(this.props.background,!1);return c.map(function(v,w){v.value;var T=v.background,I=IUe(v,CUe);if(!T)return null;var O=Ns(Ns(Ns(Ns(Ns({},I),{},{fill:"#eee"},T),s),Tm(r.props,v,w)),{},{onAnimationStart:r.handleAnimationStart,onAnimationEnd:r.handleAnimationEnd,dataKey:h,index:w,className:"recharts-bar-background-rectangle"});return Ne.createElement(EH,pA({key:"background-bar-".concat(w),option:r.props.background,isActive:w===p},O))})}},{key:"renderErrorBar",value:function(r,n){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var c=this.props,h=c.data,p=c.xAxis,s=c.yAxis,v=c.layout,w=c.children,T=Ll(w,uP);if(!T)return null;var I=v==="vertical"?h[0].height/2:h[0].width/2,O=function(B,N){var G=Array.isArray(B.value)?B.value[1]:B.value;return{x:B.x,y:B.y,value:G,errorVal:Jo(B,N)}},D={clipPath:r?"url(#clipPath-".concat(n,")"):null};return Ne.createElement(Li,D,T.map(function(B){return Ne.cloneElement(B,{key:"error-bar-".concat(n,"-").concat(B.props.dataKey),data:h,xAxis:p,yAxis:s,layout:v,offset:I,dataPointFormatter:O})}))}},{key:"render",value:function(){var r=this.props,n=r.hide,c=r.data,h=r.className,p=r.xAxis,s=r.yAxis,v=r.left,w=r.top,T=r.width,I=r.height,O=r.isAnimationActive,D=r.background,B=r.id;if(n||!c||!c.length)return null;var N=this.state.isAnimationFinished,G=Wn("recharts-bar",h),U=p&&p.allowDataOverflow,V=s&&s.allowDataOverflow,X=U||V,Y=ni(B)?this.id:B;return Ne.createElement(Li,{className:G},U||V?Ne.createElement("defs",null,Ne.createElement("clipPath",{id:"clipPath-".concat(Y)},Ne.createElement("rect",{x:U?v:v-T/2,y:V?w:w-I/2,width:U?T:T*2,height:V?I:I*2}))):null,Ne.createElement(Li,{className:"recharts-bar-rectangles",clipPath:X?"url(#clipPath-".concat(Y,")"):null},D?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(X,Y),(!O||N)&&ff.renderCallByParent(this.props,c))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curData:r.data,prevData:n.curData}:r.data!==n.curData?{curData:r.data}:null}}])}(Z.PureComponent);jte=Lh;tf(Lh,"displayName","Bar");tf(Lh,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!gv.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});tf(Lh,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,c=e.bandSize,h=e.xAxis,p=e.yAxis,s=e.xAxisTicks,v=e.yAxisTicks,w=e.stackedData,T=e.dataStartIndex,I=e.displayedData,O=e.offset,D=_Fe(n,r);if(!D)return null;var B=t.layout,N=r.type.defaultProps,G=N!==void 0?Ns(Ns({},N),r.props):r.props,U=G.dataKey,V=G.children,X=G.minPointSize,Y=B==="horizontal"?p:h,ne=w?Y.scale.domain():null,ae=EFe({numericAxis:Y}),le=Ll(V,l1),ge=I.map(function(je,ze){var Pe,Ke,Ye,Oe,tt,We;w?Pe=vFe(w[T+ze],ne):(Pe=Jo(je,U),Array.isArray(Pe)||(Pe=[ae,Pe]));var lt=PUe(X,jte.defaultProps.minPointSize)(Pe[1],ze);if(B==="horizontal"){var rt,ht=[p.scale(Pe[0]),p.scale(Pe[1])],vt=ht[0],mt=ht[1];Ke=gG({axis:h,ticks:s,bandSize:c,offset:D.offset,entry:je,index:ze}),Ye=(rt=mt??vt)!==null&&rt!==void 0?rt:void 0,Oe=D.size;var ct=vt-mt;if(tt=Number.isNaN(ct)?0:ct,We={x:Ke,y:p.y,width:Oe,height:p.height},Math.abs(lt)>0&&Math.abs(tt)<Math.abs(lt)){var Ut=ya(tt||lt)*(Math.abs(lt)-Math.abs(tt));Ye-=Ut,tt+=Ut}}else{var xr=[h.scale(Pe[0]),h.scale(Pe[1])],tn=xr[0],Er=xr[1];if(Ke=tn,Ye=gG({axis:p,ticks:v,bandSize:c,offset:D.offset,entry:je,index:ze}),Oe=Er-tn,tt=D.size,We={x:h.x,y:Ye,width:h.width,height:tt},Math.abs(lt)>0&&Math.abs(Oe)<Math.abs(lt)){var Ft=ya(Oe||lt)*(Math.abs(lt)-Math.abs(Oe));Oe+=Ft}}return Ns(Ns(Ns({},je),{},{x:Ke,y:Ye,width:Oe,height:tt,value:w?Pe:Pe[1],payload:je,background:We},le&&le[ze]&&le[ze].props),{},{tooltipPayload:[nte(r,je)],tooltipPosition:{x:Ke+Oe/2,y:Ye+tt/2}})});return Ns({data:ge,layout:B},O)});function zw(e){"@babel/helpers - typeof";return zw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zw(e)}function FUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Lte(n.key),n)}}function BUe(e,t,r){return t&&PH(e.prototype,t),r&&PH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function CH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function fc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CH(Object(r),!0).forEach(function(n){yP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yP(e,t,r){return t=Lte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Lte(e){var t=VUe(e,"string");return zw(t)=="symbol"?t:t+""}function VUe(e,t){if(zw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(zw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var UUe=function(e,t,r,n,c){var h=e.width,p=e.height,s=e.layout,v=e.children,w=Object.keys(t),T={left:r.left,leftMirror:r.left,right:h-r.right,rightMirror:h-r.right,top:r.top,topMirror:r.top,bottom:p-r.bottom,bottomMirror:p-r.bottom},I=!!ol(v,Lh);return w.reduce(function(O,D){var B=t[D],N=B.orientation,G=B.domain,U=B.padding,V=U===void 0?{}:U,X=B.mirror,Y=B.reversed,ne="".concat(N).concat(X?"Mirror":""),ae,le,ge,je,ze;if(B.type==="number"&&(B.padding==="gap"||B.padding==="no-gap")){var Pe=G[1]-G[0],Ke=1/0,Ye=B.categoricalDomain.sort(K2e);if(Ye.forEach(function(Ut,xr){xr>0&&(Ke=Math.min((Ut||0)-(Ye[xr-1]||0),Ke))}),Number.isFinite(Ke)){var Oe=Ke/Pe,tt=B.layout==="vertical"?r.height:r.width;if(B.padding==="gap"&&(ae=Oe*tt/2),B.padding==="no-gap"){var We=_a(e.barCategoryGap,Oe*tt),lt=Oe*tt/2;ae=lt-We-(lt-We)/tt*We}}}n==="xAxis"?le=[r.left+(V.left||0)+(ae||0),r.left+r.width-(V.right||0)-(ae||0)]:n==="yAxis"?le=s==="horizontal"?[r.top+r.height-(V.bottom||0),r.top+(V.top||0)]:[r.top+(V.top||0)+(ae||0),r.top+r.height-(V.bottom||0)-(ae||0)]:le=B.range,Y&&(le=[le[1],le[0]]);var rt=Qee(B,c,I),ht=rt.scale,vt=rt.realScaleType;ht.domain(G).range(le),ete(ht);var mt=tte(ht,fc(fc({},B),{},{realScaleType:vt}));n==="xAxis"?(ze=N==="top"&&!X||N==="bottom"&&X,ge=r.left,je=T[ne]-ze*B.height):n==="yAxis"&&(ze=N==="left"&&!X||N==="right"&&X,ge=T[ne]-ze*B.width,je=r.top);var ct=fc(fc(fc({},B),mt),{},{realScaleType:vt,x:ge,y:je,scale:ht,width:n==="xAxis"?r.width:B.width,height:n==="yAxis"?r.height:B.height});return ct.bandSize=QE(ct,mt),!B.hide&&n==="xAxis"?T[ne]+=(ze?-1:1)*ct.height:B.hide||(T[ne]+=(ze?-1:1)*ct.width),fc(fc({},O),{},yP({},D,ct))},{})},zte=function(e,t){var r=e.x,n=e.y,c=t.x,h=t.y;return{x:Math.min(r,c),y:Math.min(n,h),width:Math.abs(c-r),height:Math.abs(h-n)}},$Ue=function(e){var t=e.x1,r=e.y1,n=e.x2,c=e.y2;return zte({x:t,y:r},{x:n,y:c})},Nte=function(){function e(t){FUe(this,e),this.scale=t}return BUe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.bandAware,c=r.position;if(t!==void 0){if(c)switch(c){case"start":return this.scale(t);case"middle":{var h=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+h}case"end":{var p=this.bandwidth?this.bandwidth():0;return this.scale(t)+p}default:return this.scale(t)}if(n){var s=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+s}return this.scale(t)}}},{key:"isInRange",value:function(t){var r=this.range(),n=r[0],c=r[r.length-1];return n<=c?t>=n&&t<=c:t>=c&&t<=n}}],[{key:"create",value:function(t){return new e(t)}}])}();yP(Nte,"EPS",1e-4);var tN=function(e){var t=Object.keys(e).reduce(function(r,n){return fc(fc({},r),{},yP({},n,Nte.create(e[n])))},{});return fc(fc({},t),{},{apply:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=n.bandAware,h=n.position;return lUe(r,function(p,s){return t[s].apply(p,{bandAware:c,position:h})})},isInRange:function(r){return Ote(r,function(n,c){return t[c].isInRange(n)})}})};function GUe(e){return(e%180+180)%180}var HUe=function(e){var t=e.width,r=e.height,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=GUe(n),h=c*Math.PI/180,p=Math.atan(r/t),s=h>p&&h<Math.PI-p?r/Math.sin(h):t/Math.cos(h);return Math.abs(s)},WUe=Ou,qUe=a1,ZUe=Kk;function KUe(e){return function(t,r,n){var c=Object(t);if(!qUe(t)){var h=WUe(r);t=ZUe(t),r=function(s){return h(c[s],s,c)}}var p=e(t,r,n);return p>-1?c[h?t[p]:p]:void 0}}var XUe=KUe,YUe=Pte;function JUe(e){var t=YUe(e),r=t%1;return t===t?r?t-r:t:0}var QUe=JUe,e8e=MQ,t8e=Ou,r8e=QUe,n8e=Math.max;function i8e(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var c=r==null?0:r8e(r);return c<0&&(c=n8e(n+c,0)),e8e(e,t8e(t),c)}var s8e=i8e,o8e=XUe,a8e=s8e,l8e=o8e(a8e),c8e=l8e;const u8e=ki(c8e);var h8e=JTe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),rN=Z.createContext(void 0),nN=Z.createContext(void 0),Fte=Z.createContext(void 0),Bte=Z.createContext({}),Vte=Z.createContext(void 0),Ute=Z.createContext(0),$te=Z.createContext(0),IH=function(e){var t=e.state,r=t.xAxisMap,n=t.yAxisMap,c=t.offset,h=e.clipPathId,p=e.children,s=e.width,v=e.height,w=h8e(c);return Ne.createElement(rN.Provider,{value:r},Ne.createElement(nN.Provider,{value:n},Ne.createElement(Bte.Provider,{value:c},Ne.createElement(Fte.Provider,{value:w},Ne.createElement(Vte.Provider,{value:h},Ne.createElement(Ute.Provider,{value:v},Ne.createElement($te.Provider,{value:s},p)))))))},d8e=function(){return Z.useContext(Vte)},Gte=function(e){var t=Z.useContext(rN);t==null&&km();var r=t[e];return r==null&&km(),r},f8e=function(){var e=Z.useContext(rN);return Yd(e)},p8e=function(){var e=Z.useContext(nN),t=u8e(e,function(r){return Ote(r.domain,Number.isFinite)});return t||Yd(e)},Hte=function(e){var t=Z.useContext(nN);t==null&&km();var r=t[e];return r==null&&km(),r},m8e=function(){var e=Z.useContext(Fte);return e},g8e=function(){return Z.useContext(Bte)},iN=function(){return Z.useContext($te)},sN=function(){return Z.useContext(Ute)};function N_(e){"@babel/helpers - typeof";return N_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N_(e)}function y8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qte(n.key),n)}}function v8e(e,t,r){return t&&_8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function x8e(e,t,r){return t=gA(t),b8e(e,Wte()?Reflect.construct(t,r||[],gA(e).constructor):t.apply(e,r))}function b8e(e,t){if(t&&(N_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return w8e(e)}function w8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Wte=function(){return!!e})()}function gA(e){return gA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gA(e)}function S8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mD(e,t)}function mD(e,t){return mD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},mD(e,t)}function MH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function OH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MH(Object(r),!0).forEach(function(n){oN(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oN(e,t,r){return t=qte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qte(e){var t=T8e(e,"string");return N_(t)=="symbol"?t:t+""}function T8e(e,t){if(N_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(N_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function E8e(e,t){return C8e(e)||P8e(e,t)||k8e(e,t)||A8e()}function A8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k8e(e,t){if(e){if(typeof e=="string")return jH(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jH(e,t)}}function jH(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function C8e(e){if(Array.isArray(e))return e}function gD(){return gD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gD.apply(this,arguments)}var I8e=function(e,t){var r;return Ne.isValidElement(e)?r=Ne.cloneElement(e,t):Cn(e)?r=e(t):r=Ne.createElement("line",gD({},t,{className:"recharts-reference-line-line"})),r},M8e=function(e,t,r,n,c,h,p,s,v){var w=c.x,T=c.y,I=c.width,O=c.height;if(r){var D=v.y,B=e.y.apply(D,{position:h});if(Au(v,"discard")&&!e.y.isInRange(B))return null;var N=[{x:w+I,y:B},{x:w,y:B}];return s==="left"?N.reverse():N}if(t){var G=v.x,U=e.x.apply(G,{position:h});if(Au(v,"discard")&&!e.x.isInRange(U))return null;var V=[{x:U,y:T+O},{x:U,y:T}];return p==="top"?V.reverse():V}if(n){var X=v.segment,Y=X.map(function(ne){return e.apply(ne,{position:h})});return Au(v,"discard")&&eUe(Y,function(ne){return!e.isInRange(ne)})?null:Y}return null};function O8e(e){var t=e.x,r=e.y,n=e.segment,c=e.xAxisId,h=e.yAxisId,p=e.shape,s=e.className,v=e.alwaysShow,w=d8e(),T=Gte(c),I=Hte(h),O=m8e();if(!w||!O)return null;_c(v===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var D=tN({x:T.scale,y:I.scale}),B=io(t),N=io(r),G=n&&n.length===2,U=M8e(D,B,N,G,O,e.position,T.orientation,I.orientation,e);if(!U)return null;var V=E8e(U,2),X=V[0],Y=X.x,ne=X.y,ae=V[1],le=ae.x,ge=ae.y,je=Au(e,"hidden")?"url(#".concat(w,")"):void 0,ze=OH(OH({clipPath:je},Sn(e,!0)),{},{x1:Y,y1:ne,x2:le,y2:ge});return Ne.createElement(Li,{className:Wn("recharts-reference-line",s)},I8e(p,ze),_o.renderCallByParent(e,$Ue({x1:Y,y1:ne,x2:le,y2:ge})))}var aN=function(e){function t(){return y8e(this,t),x8e(this,t,arguments)}return S8e(t,e),v8e(t,[{key:"render",value:function(){return Ne.createElement(O8e,this.props)}}])}(Ne.Component);oN(aN,"displayName","ReferenceLine");oN(aN,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function yD(){return yD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yD.apply(this,arguments)}function F_(e){"@babel/helpers - typeof";return F_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F_(e)}function RH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function DH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RH(Object(r),!0).forEach(function(n){_P(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function j8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Kte(n.key),n)}}function D8e(e,t,r){return t&&R8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function L8e(e,t,r){return t=yA(t),z8e(e,Zte()?Reflect.construct(t,r||[],yA(e).constructor):t.apply(e,r))}function z8e(e,t){if(t&&(F_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return N8e(e)}function N8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zte=function(){return!!e})()}function yA(e){return yA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yA(e)}function F8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_D(e,t)}function _D(e,t){return _D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},_D(e,t)}function _P(e,t,r){return t=Kte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kte(e){var t=B8e(e,"string");return F_(t)=="symbol"?t:t+""}function B8e(e,t){if(F_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(F_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var V8e=function(e){var t=e.x,r=e.y,n=e.xAxis,c=e.yAxis,h=tN({x:n.scale,y:c.scale}),p=h.apply({x:t,y:r},{bandAware:!0});return Au(e,"discard")&&!h.isInRange(p)?null:p},vP=function(e){function t(){return j8e(this,t),L8e(this,t,arguments)}return F8e(t,e),D8e(t,[{key:"render",value:function(){var r=this.props,n=r.x,c=r.y,h=r.r,p=r.alwaysShow,s=r.clipPathId,v=io(n),w=io(c);if(_c(p===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!v||!w)return null;var T=V8e(this.props);if(!T)return null;var I=T.x,O=T.y,D=this.props,B=D.shape,N=D.className,G=Au(this.props,"hidden")?"url(#".concat(s,")"):void 0,U=DH(DH({clipPath:G},Sn(this.props,!0)),{},{cx:I,cy:O});return Ne.createElement(Li,{className:Wn("recharts-reference-dot",N)},t.renderDot(B,U),_o.renderCallByParent(this.props,{x:I-h,y:O-h,width:2*h,height:2*h}))}}])}(Ne.Component);_P(vP,"displayName","ReferenceDot");_P(vP,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});_P(vP,"renderDot",function(e,t){var r;return Ne.isValidElement(e)?r=Ne.cloneElement(e,t):Cn(e)?r=e(t):r=Ne.createElement(eN,yD({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function vD(){return vD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},vD.apply(this,arguments)}function B_(e){"@babel/helpers - typeof";return B_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B_(e)}function LH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function zH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LH(Object(r),!0).forEach(function(n){xP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function U8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Yte(n.key),n)}}function G8e(e,t,r){return t&&$8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function H8e(e,t,r){return t=_A(t),W8e(e,Xte()?Reflect.construct(t,r||[],_A(e).constructor):t.apply(e,r))}function W8e(e,t){if(t&&(B_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return q8e(e)}function q8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xte=function(){return!!e})()}function _A(e){return _A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_A(e)}function Z8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xD(e,t)}function xD(e,t){return xD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},xD(e,t)}function xP(e,t,r){return t=Yte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Yte(e){var t=K8e(e,"string");return B_(t)=="symbol"?t:t+""}function K8e(e,t){if(B_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(B_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var X8e=function(e,t,r,n,c){var h=c.x1,p=c.x2,s=c.y1,v=c.y2,w=c.xAxis,T=c.yAxis;if(!w||!T)return null;var I=tN({x:w.scale,y:T.scale}),O={x:e?I.x.apply(h,{position:"start"}):I.x.rangeMin,y:r?I.y.apply(s,{position:"start"}):I.y.rangeMin},D={x:t?I.x.apply(p,{position:"end"}):I.x.rangeMax,y:n?I.y.apply(v,{position:"end"}):I.y.rangeMax};return Au(c,"discard")&&(!I.isInRange(O)||!I.isInRange(D))?null:zte(O,D)},bP=function(e){function t(){return U8e(this,t),H8e(this,t,arguments)}return Z8e(t,e),G8e(t,[{key:"render",value:function(){var r=this.props,n=r.x1,c=r.x2,h=r.y1,p=r.y2,s=r.className,v=r.alwaysShow,w=r.clipPathId;_c(v===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var T=io(n),I=io(c),O=io(h),D=io(p),B=this.props.shape;if(!T&&!I&&!O&&!D&&!B)return null;var N=X8e(T,I,O,D,this.props);if(!N&&!B)return null;var G=Au(this.props,"hidden")?"url(#".concat(w,")"):void 0;return Ne.createElement(Li,{className:Wn("recharts-reference-area",s)},t.renderRect(B,zH(zH({clipPath:G},Sn(this.props,!0)),N)),_o.renderCallByParent(this.props,N))}}])}(Ne.Component);xP(bP,"displayName","ReferenceArea");xP(bP,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});xP(bP,"renderRect",function(e,t){var r;return Ne.isValidElement(e)?r=Ne.cloneElement(e,t):Cn(e)?r=e(t):r=Ne.createElement(Qz,vD({},t,{className:"recharts-reference-area-rect"})),r});function Jte(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],c=0;c<e.length;c+=t)n.push(e[c]);return n}function Y8e(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return HUe(n,r)}function J8e(e,t,r){var n=r==="width",c=e.x,h=e.y,p=e.width,s=e.height;return t===1?{start:n?c:h,end:n?c+p:h+s}:{start:n?c+p:h+s,end:n?c:h}}function vA(e,t,r,n,c){if(e*t<e*n||e*t>e*c)return!1;var h=r();return e*(t-e*h/2-n)>=0&&e*(t+e*h/2-c)<=0}function Q8e(e,t){return Jte(e,t+1)}function e$e(e,t,r,n,c){for(var h=(n||[]).slice(),p=t.start,s=t.end,v=0,w=1,T=p,I=function(){var D=n?.[v];if(D===void 0)return{v:Jte(n,w)};var B=v,N,G=function(){return N===void 0&&(N=r(D,B)),N},U=D.coordinate,V=v===0||vA(e,U,G,T,s);V||(v=0,T=p,w+=1),V&&(T=U+e*(G()/2+c),v+=w)},O;w<=h.length;)if(O=I(),O)return O.v;return[]}function Nw(e){"@babel/helpers - typeof";return Nw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nw(e)}function NH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Ko(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NH(Object(r),!0).forEach(function(n){t$e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function t$e(e,t,r){return t=r$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function r$e(e){var t=n$e(e,"string");return Nw(t)=="symbol"?t:t+""}function n$e(e,t){if(Nw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Nw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function i$e(e,t,r,n,c){for(var h=(n||[]).slice(),p=h.length,s=t.start,v=t.end,w=function(I){var O=h[I],D,B=function(){return D===void 0&&(D=r(O,I)),D};if(I===p-1){var N=e*(O.coordinate+e*B()/2-v);h[I]=O=Ko(Ko({},O),{},{tickCoord:N>0?O.coordinate-N*e:O.coordinate})}else h[I]=O=Ko(Ko({},O),{},{tickCoord:O.coordinate});var G=vA(e,O.tickCoord,B,s,v);G&&(v=O.tickCoord-e*(B()/2+c),h[I]=Ko(Ko({},O),{},{isShow:!0}))},T=p-1;T>=0;T--)w(T);return h}function s$e(e,t,r,n,c,h){var p=(n||[]).slice(),s=p.length,v=t.start,w=t.end;if(h){var T=n[s-1],I=r(T,s-1),O=e*(T.coordinate+e*I/2-w);p[s-1]=T=Ko(Ko({},T),{},{tickCoord:O>0?T.coordinate-O*e:T.coordinate});var D=vA(e,T.tickCoord,function(){return I},v,w);D&&(w=T.tickCoord-e*(I/2+c),p[s-1]=Ko(Ko({},T),{},{isShow:!0}))}for(var B=h?s-1:s,N=function(U){var V=p[U],X,Y=function(){return X===void 0&&(X=r(V,U)),X};if(U===0){var ne=e*(V.coordinate-e*Y()/2-v);p[U]=V=Ko(Ko({},V),{},{tickCoord:ne<0?V.coordinate-ne*e:V.coordinate})}else p[U]=V=Ko(Ko({},V),{},{tickCoord:V.coordinate});var ae=vA(e,V.tickCoord,Y,v,w);ae&&(v=V.tickCoord+e*(Y()/2+c),p[U]=Ko(Ko({},V),{},{isShow:!0}))},G=0;G<B;G++)N(G);return p}function lN(e,t,r){var n=e.tick,c=e.ticks,h=e.viewBox,p=e.minTickGap,s=e.orientation,v=e.interval,w=e.tickFormatter,T=e.unit,I=e.angle;if(!c||!c.length||!n)return[];if(fr(v)||gv.isSsr)return Q8e(c,typeof v=="number"&&fr(v)?v:0);var O=[],D=s==="top"||s==="bottom"?"width":"height",B=T&&D==="width"?kb(T,{fontSize:t,letterSpacing:r}):{width:0,height:0},N=function(V,X){var Y=Cn(w)?w(V.value,X):V.value;return D==="width"?Y8e(kb(Y,{fontSize:t,letterSpacing:r}),B,I):kb(Y,{fontSize:t,letterSpacing:r})[D]},G=c.length>=2?ya(c[1].coordinate-c[0].coordinate):1,U=J8e(h,G,D);return v==="equidistantPreserveStart"?e$e(G,U,N,c,p):(v==="preserveStart"||v==="preserveStartEnd"?O=s$e(G,U,N,c,p,v==="preserveStartEnd"):O=i$e(G,U,N,c,p),O.filter(function(V){return V.isShow}))}var o$e=["viewBox"],a$e=["viewBox"],l$e=["ticks"];function V_(e){"@babel/helpers - typeof";return V_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V_(e)}function Gy(){return Gy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Gy.apply(this,arguments)}function FH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Ys(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FH(Object(r),!0).forEach(function(n){cN(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JM(e,t){if(e==null)return{};var r=c$e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function c$e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function u$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ere(n.key),n)}}function h$e(e,t,r){return t&&BH(e.prototype,t),r&&BH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d$e(e,t,r){return t=xA(t),f$e(e,Qte()?Reflect.construct(t,r||[],xA(e).constructor):t.apply(e,r))}function f$e(e,t){if(t&&(V_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return p$e(e)}function p$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Qte=function(){return!!e})()}function xA(e){return xA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xA(e)}function m$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bD(e,t)}function bD(e,t){return bD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},bD(e,t)}function cN(e,t,r){return t=ere(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ere(e){var t=g$e(e,"string");return V_(t)=="symbol"?t:t+""}function g$e(e,t){if(V_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(V_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var xv=function(e){function t(r){var n;return u$e(this,t),n=d$e(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return m$e(t,e),h$e(t,[{key:"shouldComponentUpdate",value:function(r,n){var c=r.viewBox,h=JM(r,o$e),p=this.props,s=p.viewBox,v=JM(p,a$e);return!s_(c,s)||!s_(h,v)||!s_(n,this.state)}},{key:"componentDidMount",value:function(){var r=this.layerReference;if(r){var n=r.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];n&&this.setState({fontSize:window.getComputedStyle(n).fontSize,letterSpacing:window.getComputedStyle(n).letterSpacing})}}},{key:"getTickLineCoord",value:function(r){var n=this.props,c=n.x,h=n.y,p=n.width,s=n.height,v=n.orientation,w=n.tickSize,T=n.mirror,I=n.tickMargin,O,D,B,N,G,U,V=T?-1:1,X=r.tickSize||w,Y=fr(r.tickCoord)?r.tickCoord:r.coordinate;switch(v){case"top":O=D=r.coordinate,N=h+ +!T*s,B=N-V*X,U=B-V*I,G=Y;break;case"left":B=N=r.coordinate,D=c+ +!T*p,O=D-V*X,G=O-V*I,U=Y;break;case"right":B=N=r.coordinate,D=c+ +T*p,O=D+V*X,G=O+V*I,U=Y;break;default:O=D=r.coordinate,N=h+ +T*s,B=N+V*X,U=B+V*I,G=Y;break}return{line:{x1:O,y1:B,x2:D,y2:N},tick:{x:G,y:U}}}},{key:"getTickTextAnchor",value:function(){var r=this.props,n=r.orientation,c=r.mirror,h;switch(n){case"left":h=c?"start":"end";break;case"right":h=c?"end":"start";break;default:h="middle";break}return h}},{key:"getTickVerticalAnchor",value:function(){var r=this.props,n=r.orientation,c=r.mirror,h="end";switch(n){case"left":case"right":h="middle";break;case"top":h=c?"start":"end";break;default:h=c?"end":"start";break}return h}},{key:"renderAxisLine",value:function(){var r=this.props,n=r.x,c=r.y,h=r.width,p=r.height,s=r.orientation,v=r.mirror,w=r.axisLine,T=Ys(Ys(Ys({},Sn(this.props,!1)),Sn(w,!1)),{},{fill:"none"});if(s==="top"||s==="bottom"){var I=+(s==="top"&&!v||s==="bottom"&&v);T=Ys(Ys({},T),{},{x1:n,y1:c+I*p,x2:n+h,y2:c+I*p})}else{var O=+(s==="left"&&!v||s==="right"&&v);T=Ys(Ys({},T),{},{x1:n+O*h,y1:c,x2:n+O*h,y2:c+p})}return Ne.createElement("line",Gy({},T,{className:Wn("recharts-cartesian-axis-line",fl(w,"className"))}))}},{key:"renderTicks",value:function(r,n,c){var h=this,p=this.props,s=p.tickLine,v=p.stroke,w=p.tick,T=p.tickFormatter,I=p.unit,O=lN(Ys(Ys({},this.props),{},{ticks:r}),n,c),D=this.getTickTextAnchor(),B=this.getTickVerticalAnchor(),N=Sn(this.props,!1),G=Sn(w,!1),U=Ys(Ys({},N),{},{fill:"none"},Sn(s,!1)),V=O.map(function(X,Y){var ne=h.getTickLineCoord(X),ae=ne.line,le=ne.tick,ge=Ys(Ys(Ys(Ys({textAnchor:D,verticalAnchor:B},N),{},{stroke:"none",fill:v},G),le),{},{index:Y,payload:X,visibleTicksCount:O.length,tickFormatter:T});return Ne.createElement(Li,Gy({className:"recharts-cartesian-axis-tick",key:"tick-".concat(X.value,"-").concat(X.coordinate,"-").concat(X.tickCoord)},Tm(h.props,X,Y)),s&&Ne.createElement("line",Gy({},U,ae,{className:Wn("recharts-cartesian-axis-tick-line",fl(s,"className"))})),w&&t.renderTickItem(w,ge,"".concat(Cn(T)?T(X.value,Y):X.value).concat(I||"")))});return Ne.createElement("g",{className:"recharts-cartesian-axis-ticks"},V)}},{key:"render",value:function(){var r=this,n=this.props,c=n.axisLine,h=n.width,p=n.height,s=n.ticksGenerator,v=n.className,w=n.hide;if(w)return null;var T=this.props,I=T.ticks,O=JM(T,l$e),D=I;return Cn(s)&&(D=I&&I.length>0?s(this.props):s(O)),h<=0||p<=0||!D||!D.length?null:Ne.createElement(Li,{className:Wn("recharts-cartesian-axis",v),ref:function(B){r.layerReference=B}},c&&this.renderAxisLine(),this.renderTicks(D,this.state.fontSize,this.state.letterSpacing),_o.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(r,n,c){var h,p=Wn(n.className,"recharts-cartesian-axis-tick-value");return Ne.isValidElement(r)?h=Ne.cloneElement(r,Ys(Ys({},n),{},{className:p})):Cn(r)?h=r(Ys(Ys({},n),{},{className:p})):h=Ne.createElement(Em,Gy({},n,{className:"recharts-cartesian-axis-tick-value"}),c),h}}])}(Z.Component);cN(xv,"displayName","CartesianAxis");cN(xv,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var y$e=["x1","y1","x2","y2","key"],_$e=["offset"];function Pm(e){"@babel/helpers - typeof";return Pm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pm(e)}function VH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Yo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VH(Object(r),!0).forEach(function(n){v$e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function v$e(e,t,r){return t=x$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x$e(e){var t=b$e(e,"string");return Pm(t)=="symbol"?t:t+""}function b$e(e,t){if(Pm(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Pm(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function im(){return im=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},im.apply(this,arguments)}function UH(e,t){if(e==null)return{};var r=w$e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function w$e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var S$e=function(e){var t=e.fill;if(!t||t==="none")return null;var r=e.fillOpacity,n=e.x,c=e.y,h=e.width,p=e.height,s=e.ry;return Ne.createElement("rect",{x:n,y:c,ry:s,width:h,height:p,stroke:"none",fill:t,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function tre(e,t){var r;if(Ne.isValidElement(e))r=Ne.cloneElement(e,t);else if(Cn(e))r=e(t);else{var n=t.x1,c=t.y1,h=t.x2,p=t.y2,s=t.key,v=UH(t,y$e),w=Sn(v,!1);w.offset;var T=UH(w,_$e);r=Ne.createElement("line",im({},T,{x1:n,y1:c,x2:h,y2:p,fill:"none",key:s}))}return r}function T$e(e){var t=e.x,r=e.width,n=e.horizontal,c=n===void 0?!0:n,h=e.horizontalPoints;if(!c||!h||!h.length)return null;var p=h.map(function(s,v){var w=Yo(Yo({},e),{},{x1:t,y1:s,x2:t+r,y2:s,key:"line-".concat(v),index:v});return tre(c,w)});return Ne.createElement("g",{className:"recharts-cartesian-grid-horizontal"},p)}function E$e(e){var t=e.y,r=e.height,n=e.vertical,c=n===void 0?!0:n,h=e.verticalPoints;if(!c||!h||!h.length)return null;var p=h.map(function(s,v){var w=Yo(Yo({},e),{},{x1:s,y1:t,x2:s,y2:t+r,key:"line-".concat(v),index:v});return tre(c,w)});return Ne.createElement("g",{className:"recharts-cartesian-grid-vertical"},p)}function A$e(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,c=e.y,h=e.width,p=e.height,s=e.horizontalPoints,v=e.horizontal,w=v===void 0?!0:v;if(!w||!t||!t.length)return null;var T=s.map(function(O){return Math.round(O+c-c)}).sort(function(O,D){return O-D});c!==T[0]&&T.unshift(0);var I=T.map(function(O,D){var B=!T[D+1],N=B?c+p-O:T[D+1]-O;if(N<=0)return null;var G=D%t.length;return Ne.createElement("rect",{key:"react-".concat(D),y:O,x:n,height:N,width:h,stroke:"none",fill:t[G],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ne.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},I)}function k$e(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,c=e.fillOpacity,h=e.x,p=e.y,s=e.width,v=e.height,w=e.verticalPoints;if(!r||!n||!n.length)return null;var T=w.map(function(O){return Math.round(O+h-h)}).sort(function(O,D){return O-D});h!==T[0]&&T.unshift(0);var I=T.map(function(O,D){var B=!T[D+1],N=B?h+s-O:T[D+1]-O;if(N<=0)return null;var G=D%n.length;return Ne.createElement("rect",{key:"react-".concat(D),x:O,y:p,width:N,height:v,stroke:"none",fill:n[G],fillOpacity:c,className:"recharts-cartesian-grid-bg"})});return Ne.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},I)}var P$e=function(e,t){var r=e.xAxis,n=e.width,c=e.height,h=e.offset;return Jee(lN(Yo(Yo(Yo({},xv.defaultProps),r),{},{ticks:_h(r,!0),viewBox:{x:0,y:0,width:n,height:c}})),h.left,h.left+h.width,t)},C$e=function(e,t){var r=e.yAxis,n=e.width,c=e.height,h=e.offset;return Jee(lN(Yo(Yo(Yo({},xv.defaultProps),r),{},{ticks:_h(r,!0),viewBox:{x:0,y:0,width:n,height:c}})),h.top,h.top+h.height,t)},by={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function uN(e){var t,r,n,c,h,p,s=iN(),v=sN(),w=g8e(),T=Yo(Yo({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:by.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:by.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:by.horizontal,horizontalFill:(c=e.horizontalFill)!==null&&c!==void 0?c:by.horizontalFill,vertical:(h=e.vertical)!==null&&h!==void 0?h:by.vertical,verticalFill:(p=e.verticalFill)!==null&&p!==void 0?p:by.verticalFill,x:fr(e.x)?e.x:w.left,y:fr(e.y)?e.y:w.top,width:fr(e.width)?e.width:w.width,height:fr(e.height)?e.height:w.height}),I=T.x,O=T.y,D=T.width,B=T.height,N=T.syncWithTicks,G=T.horizontalValues,U=T.verticalValues,V=f8e(),X=p8e();if(!fr(D)||D<=0||!fr(B)||B<=0||!fr(I)||I!==+I||!fr(O)||O!==+O)return null;var Y=T.verticalCoordinatesGenerator||P$e,ne=T.horizontalCoordinatesGenerator||C$e,ae=T.horizontalPoints,le=T.verticalPoints;if((!ae||!ae.length)&&Cn(ne)){var ge=G&&G.length,je=ne({yAxis:X?Yo(Yo({},X),{},{ticks:ge?G:X.ticks}):void 0,width:s,height:v,offset:w},ge?!0:N);_c(Array.isArray(je),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Pm(je),"]")),Array.isArray(je)&&(ae=je)}if((!le||!le.length)&&Cn(Y)){var ze=U&&U.length,Pe=Y({xAxis:V?Yo(Yo({},V),{},{ticks:ze?U:V.ticks}):void 0,width:s,height:v,offset:w},ze?!0:N);_c(Array.isArray(Pe),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Pm(Pe),"]")),Array.isArray(Pe)&&(le=Pe)}return Ne.createElement("g",{className:"recharts-cartesian-grid"},Ne.createElement(S$e,{fill:T.fill,fillOpacity:T.fillOpacity,x:T.x,y:T.y,width:T.width,height:T.height,ry:T.ry}),Ne.createElement(T$e,im({},T,{offset:w,horizontalPoints:ae,xAxis:V,yAxis:X})),Ne.createElement(E$e,im({},T,{offset:w,verticalPoints:le,xAxis:V,yAxis:X})),Ne.createElement(A$e,im({},T,{horizontalPoints:ae})),Ne.createElement(k$e,im({},T,{verticalPoints:le})))}uN.displayName="CartesianGrid";function U_(e){"@babel/helpers - typeof";return U_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U_(e)}function I$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M$e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ire(n.key),n)}}function O$e(e,t,r){return t&&M$e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function j$e(e,t,r){return t=bA(t),R$e(e,rre()?Reflect.construct(t,r||[],bA(e).constructor):t.apply(e,r))}function R$e(e,t){if(t&&(U_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return D$e(e)}function D$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rre(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rre=function(){return!!e})()}function bA(e){return bA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bA(e)}function L$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wD(e,t)}function wD(e,t){return wD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},wD(e,t)}function nre(e,t,r){return t=ire(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ire(e){var t=z$e(e,"string");return U_(t)=="symbol"?t:t+""}function z$e(e,t){if(U_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(U_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function SD(){return SD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},SD.apply(this,arguments)}function N$e(e){var t=e.xAxisId,r=iN(),n=sN(),c=Gte(t);return c==null?null:Z.createElement(xv,SD({},c,{className:Wn("recharts-".concat(c.axisType," ").concat(c.axisType),c.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(h){return _h(h,!0)}}))}var $_=function(e){function t(){return I$e(this,t),j$e(this,t,arguments)}return L$e(t,e),O$e(t,[{key:"render",value:function(){return Z.createElement(N$e,this.props)}}])}(Z.Component);nre($_,"displayName","XAxis");nre($_,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function G_(e){"@babel/helpers - typeof";return G_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G_(e)}function F$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B$e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,are(n.key),n)}}function V$e(e,t,r){return t&&B$e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function U$e(e,t,r){return t=wA(t),$$e(e,sre()?Reflect.construct(t,r||[],wA(e).constructor):t.apply(e,r))}function $$e(e,t){if(t&&(G_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return G$e(e)}function G$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sre(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sre=function(){return!!e})()}function wA(e){return wA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wA(e)}function H$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TD(e,t)}function TD(e,t){return TD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},TD(e,t)}function ore(e,t,r){return t=are(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function are(e){var t=W$e(e,"string");return G_(t)=="symbol"?t:t+""}function W$e(e,t){if(G_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(G_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function ED(){return ED=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ED.apply(this,arguments)}var q$e=function(e){var t=e.yAxisId,r=iN(),n=sN(),c=Hte(t);return c==null?null:Z.createElement(xv,ED({},c,{className:Wn("recharts-".concat(c.axisType," ").concat(c.axisType),c.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(h){return _h(h,!0)}}))},H_=function(e){function t(){return F$e(this,t),U$e(this,t,arguments)}return H$e(t,e),V$e(t,[{key:"render",value:function(){return Z.createElement(q$e,this.props)}}])}(Z.Component);ore(H_,"displayName","YAxis");ore(H_,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function $H(e){return Y$e(e)||X$e(e)||K$e(e)||Z$e()}function Z$e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K$e(e,t){if(e){if(typeof e=="string")return AD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return AD(e,t)}}function X$e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Y$e(e){if(Array.isArray(e))return AD(e)}function AD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var kD=function(e,t,r,n,c){var h=Ll(e,aN),p=Ll(e,vP),s=[].concat($H(h),$H(p)),v=Ll(e,bP),w="".concat(n,"Id"),T=n[0],I=t;if(s.length&&(I=s.reduce(function(B,N){if(N.props[w]===r&&Au(N.props,"extendDomain")&&fr(N.props[T])){var G=N.props[T];return[Math.min(B[0],G),Math.max(B[1],G)]}return B},I)),v.length){var O="".concat(T,"1"),D="".concat(T,"2");I=v.reduce(function(B,N){if(N.props[w]===r&&Au(N.props,"extendDomain")&&fr(N.props[O])&&fr(N.props[D])){var G=N.props[O],U=N.props[D];return[Math.min(B[0],G,U),Math.max(B[1],G,U)]}return B},I)}return c&&c.length&&(I=c.reduce(function(B,N){return fr(N)?[Math.min(B[0],N),Math.max(B[1],N)]:B},I)),I},lre={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function c(v,w,T){this.fn=v,this.context=w,this.once=T||!1}function h(v,w,T,I,O){if(typeof T!="function")throw new TypeError("The listener must be a function");var D=new c(T,I||v,O),B=r?r+w:w;return v._events[B]?v._events[B].fn?v._events[B]=[v._events[B],D]:v._events[B].push(D):(v._events[B]=D,v._eventsCount++),v}function p(v,w){--v._eventsCount===0?v._events=new n:delete v._events[w]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var v=[],w,T;if(this._eventsCount===0)return v;for(T in w=this._events)t.call(w,T)&&v.push(r?T.slice(1):T);return Object.getOwnPropertySymbols?v.concat(Object.getOwnPropertySymbols(w)):v},s.prototype.listeners=function(v){var w=r?r+v:v,T=this._events[w];if(!T)return[];if(T.fn)return[T.fn];for(var I=0,O=T.length,D=new Array(O);I<O;I++)D[I]=T[I].fn;return D},s.prototype.listenerCount=function(v){var w=r?r+v:v,T=this._events[w];return T?T.fn?1:T.length:0},s.prototype.emit=function(v,w,T,I,O,D){var B=r?r+v:v;if(!this._events[B])return!1;var N=this._events[B],G=arguments.length,U,V;if(N.fn){switch(N.once&&this.removeListener(v,N.fn,void 0,!0),G){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,w),!0;case 3:return N.fn.call(N.context,w,T),!0;case 4:return N.fn.call(N.context,w,T,I),!0;case 5:return N.fn.call(N.context,w,T,I,O),!0;case 6:return N.fn.call(N.context,w,T,I,O,D),!0}for(V=1,U=new Array(G-1);V<G;V++)U[V-1]=arguments[V];N.fn.apply(N.context,U)}else{var X=N.length,Y;for(V=0;V<X;V++)switch(N[V].once&&this.removeListener(v,N[V].fn,void 0,!0),G){case 1:N[V].fn.call(N[V].context);break;case 2:N[V].fn.call(N[V].context,w);break;case 3:N[V].fn.call(N[V].context,w,T);break;case 4:N[V].fn.call(N[V].context,w,T,I);break;default:if(!U)for(Y=1,U=new Array(G-1);Y<G;Y++)U[Y-1]=arguments[Y];N[V].fn.apply(N[V].context,U)}}return!0},s.prototype.on=function(v,w,T){return h(this,v,w,T,!1)},s.prototype.once=function(v,w,T){return h(this,v,w,T,!0)},s.prototype.removeListener=function(v,w,T,I){var O=r?r+v:v;if(!this._events[O])return this;if(!w)return p(this,O),this;var D=this._events[O];if(D.fn)D.fn===w&&(!I||D.once)&&(!T||D.context===T)&&p(this,O);else{for(var B=0,N=[],G=D.length;B<G;B++)(D[B].fn!==w||I&&!D[B].once||T&&D[B].context!==T)&&N.push(D[B]);N.length?this._events[O]=N.length===1?N[0]:N:p(this,O)}return this},s.prototype.removeAllListeners=function(v){var w;return v?(w=r?r+v:v,this._events[w]&&p(this,w)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(lre);var J$e=lre.exports;const Q$e=ki(J$e);var QM=new Q$e,eO="recharts.syncMouseEvents";function Fw(e){"@babel/helpers - typeof";return Fw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fw(e)}function eGe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tGe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cre(n.key),n)}}function rGe(e,t,r){return t&&tGe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function tO(e,t,r){return t=cre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cre(e){var t=nGe(e,"string");return Fw(t)=="symbol"?t:t+""}function nGe(e,t){if(Fw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Fw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var iGe=function(){function e(){eGe(this,e),tO(this,"activeIndex",0),tO(this,"coordinateList",[]),tO(this,"layout","horizontal")}return rGe(e,[{key:"setDetails",value:function(t){var r,n=t.coordinateList,c=n===void 0?null:n,h=t.container,p=h===void 0?null:h,s=t.layout,v=s===void 0?null:s,w=t.offset,T=w===void 0?null:w,I=t.mouseHandlerCallback,O=I===void 0?null:I;this.coordinateList=(r=c??this.coordinateList)!==null&&r!==void 0?r:[],this.container=p??this.container,this.layout=v??this.layout,this.offset=T??this.offset,this.mouseHandlerCallback=O??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(t){if(this.coordinateList.length!==0)switch(t.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(t){this.activeIndex=t}},{key:"spoofMouse",value:function(){var t,r;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var n=this.container.getBoundingClientRect(),c=n.x,h=n.y,p=n.height,s=this.coordinateList[this.activeIndex].coordinate,v=((t=window)===null||t===void 0?void 0:t.scrollX)||0,w=((r=window)===null||r===void 0?void 0:r.scrollY)||0,T=c+s+v,I=h+this.offset.top+p/2+w;this.mouseHandlerCallback({pageX:T,pageY:I})}}}])}();function sGe(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e?.[0],c=e?.[1];if(n&&c&&fr(n)&&fr(c))return!0}return!1}function oGe(e,t,r,n){var c=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-c:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-c,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function ure(e){var t=e.cx,r=e.cy,n=e.radius,c=e.startAngle,h=e.endAngle,p=es(t,r,n,c),s=es(t,r,n,h);return{points:[p,s],cx:t,cy:r,radius:n,startAngle:c,endAngle:h}}function aGe(e,t,r){var n,c,h,p;if(e==="horizontal")n=t.x,h=n,c=r.top,p=r.top+r.height;else if(e==="vertical")c=t.y,p=c,n=r.left,h=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var s=t.cx,v=t.cy,w=t.innerRadius,T=t.outerRadius,I=t.angle,O=es(s,v,w,I),D=es(s,v,T,I);n=O.x,c=O.y,h=D.x,p=D.y}else return ure(t);return[{x:n,y:c},{x:h,y:p}]}function Bw(e){"@babel/helpers - typeof";return Bw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bw(e)}function GH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function a2(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?GH(Object(r),!0).forEach(function(n){lGe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):GH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lGe(e,t,r){return t=cGe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cGe(e){var t=uGe(e,"string");return Bw(t)=="symbol"?t:t+""}function uGe(e,t){if(Bw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Bw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hGe(e){var t,r,n=e.element,c=e.tooltipEventType,h=e.isActive,p=e.activeCoordinate,s=e.activePayload,v=e.offset,w=e.activeTooltipIndex,T=e.tooltipAxisBandSize,I=e.layout,O=e.chartName,D=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!D||!h||!p||O!=="ScatterChart"&&c!=="axis")return null;var B,N=XR;if(O==="ScatterChart")B=p,N=U4e;else if(O==="BarChart")B=oGe(I,p,v,T),N=Qz;else if(I==="radial"){var G=ure(p),U=G.cx,V=G.cy,X=G.radius,Y=G.startAngle,ne=G.endAngle;B={cx:U,cy:V,startAngle:Y,endAngle:ne,innerRadius:X,outerRadius:X},N=cte}else B={points:aGe(I,p,v)},N=XR;var ae=a2(a2(a2(a2({stroke:"#ccc",pointerEvents:"none"},v),B),Sn(D,!1)),{},{payload:s,payloadIndex:w,className:Wn("recharts-tooltip-cursor",D.className)});return Z.isValidElement(D)?Z.cloneElement(D,ae):Z.createElement(N,ae)}var dGe=["item"],fGe=["children","className","width","height","style","compact","title","desc"];function W_(e){"@babel/helpers - typeof";return W_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W_(e)}function Hy(){return Hy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Hy.apply(this,arguments)}function HH(e,t){return gGe(e)||mGe(e,t)||dre(e,t)||pGe()}function pGe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mGe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,s=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(s.push(n.value),s.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return s}}function gGe(e){if(Array.isArray(e))return e}function WH(e,t){if(e==null)return{};var r=yGe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function yGe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function _Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vGe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fre(n.key),n)}}function xGe(e,t,r){return t&&vGe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function bGe(e,t,r){return t=SA(t),wGe(e,hre()?Reflect.construct(t,r||[],SA(e).constructor):t.apply(e,r))}function wGe(e,t){if(t&&(W_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return SGe(e)}function SGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hre(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hre=function(){return!!e})()}function SA(e){return SA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},SA(e)}function TGe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PD(e,t)}function PD(e,t){return PD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},PD(e,t)}function q_(e){return kGe(e)||AGe(e)||dre(e)||EGe()}function EGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dre(e,t){if(e){if(typeof e=="string")return CD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return CD(e,t)}}function AGe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function kGe(e){if(Array.isArray(e))return CD(e)}function CD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Gt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qH(Object(r),!0).forEach(function(n){dn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dn(e,t,r){return t=fre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fre(e){var t=PGe(e,"string");return W_(t)=="symbol"?t:t+""}function PGe(e,t){if(W_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(W_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var CGe={xAxis:["bottom","top"],yAxis:["left","right"]},IGe={width:"100%",height:"100%"},pre={x:0,y:0};function l2(e){return e}var MGe=function(e,t){return t==="horizontal"?e.x:t==="vertical"?e.y:t==="centric"?e.angle:e.radius},OGe=function(e,t,r,n){var c=t.find(function(w){return w&&w.index===r});if(c){if(e==="horizontal")return{x:c.coordinate,y:n.y};if(e==="vertical")return{x:n.x,y:c.coordinate};if(e==="centric"){var h=c.coordinate,p=n.radius;return Gt(Gt(Gt({},n),es(n.cx,n.cy,p,h)),{},{angle:h,radius:p})}var s=c.coordinate,v=n.angle;return Gt(Gt(Gt({},n),es(n.cx,n.cy,s,v)),{},{angle:v,radius:s})}return pre},wP=function(e,t){var r=t.graphicalItems,n=t.dataStartIndex,c=t.dataEndIndex,h=(r??[]).reduce(function(p,s){var v=s.props.data;return v&&v.length?[].concat(q_(p),q_(v)):p},[]);return h.length>0?h:e&&e.length&&fr(n)&&fr(c)?e.slice(n,c+1):[]};function mre(e){return e==="number"?[0,"auto"]:void 0}var ID=function(e,t,r,n){var c=e.graphicalItems,h=e.tooltipAxis,p=wP(t,e);return r<0||!c||!c.length||r>=p.length?null:c.reduce(function(s,v){var w,T=(w=v.props.data)!==null&&w!==void 0?w:t;T&&e.dataStartIndex+e.dataEndIndex!==0&&e.dataEndIndex-e.dataStartIndex>=r&&(T=T.slice(e.dataStartIndex,e.dataEndIndex+1));var I;if(h.dataKey&&!h.allowDuplicatedCategory){var O=T===void 0?p:T;I=sR(O,h.dataKey,n)}else I=T&&T[r]||p[r];return I?[].concat(q_(s),[nte(v,I)]):s},[])},ZH=function(e,t,r,n){var c=n||{x:e.chartX,y:e.chartY},h=MGe(c,r),p=e.orderedTooltipTicks,s=e.tooltipAxis,v=e.tooltipTicks,w=dFe(h,p,v,s);if(w>=0&&v){var T=v[w]&&v[w].value,I=ID(e,t,w,T),O=OGe(r,p,w,c);return{activeTooltipIndex:w,activeLabel:T,activePayload:I,activeCoordinate:O}}return null},jGe=function(e,t){var r=t.axes,n=t.graphicalItems,c=t.axisType,h=t.axisIdKey,p=t.stackGroups,s=t.dataStartIndex,v=t.dataEndIndex,w=e.layout,T=e.children,I=e.stackOffset,O=Yee(w,c);return r.reduce(function(D,B){var N,G=B.type.defaultProps!==void 0?Gt(Gt({},B.type.defaultProps),B.props):B.props,U=G.type,V=G.dataKey,X=G.allowDataOverflow,Y=G.allowDuplicatedCategory,ne=G.scale,ae=G.ticks,le=G.includeHidden,ge=G[h];if(D[ge])return D;var je=wP(e.data,{graphicalItems:n.filter(function(mt){var ct,Ut=h in mt.props?mt.props[h]:(ct=mt.type.defaultProps)===null||ct===void 0?void 0:ct[h];return Ut===ge}),dataStartIndex:s,dataEndIndex:v}),ze=je.length,Pe,Ke,Ye;sGe(G.domain,X,U)&&(Pe=HR(G.domain,null,X),O&&(U==="number"||ne!=="auto")&&(Ye=O2(je,V,"category")));var Oe=mre(U);if(!Pe||Pe.length===0){var tt,We=(tt=G.domain)!==null&&tt!==void 0?tt:Oe;if(V){if(Pe=O2(je,V,U),U==="category"&&O){var lt=Z2e(Pe);Y&&lt?(Ke=Pe,Pe=hA(0,ze)):Y||(Pe=vG(We,Pe,B).reduce(function(mt,ct){return mt.indexOf(ct)>=0?mt:[].concat(q_(mt),[ct])},[]))}else if(U==="category")Y?Pe=Pe.filter(function(mt){return mt!==""&&!ni(mt)}):Pe=vG(We,Pe,B).reduce(function(mt,ct){return mt.indexOf(ct)>=0||ct===""||ni(ct)?mt:[].concat(q_(mt),[ct])},[]);else if(U==="number"){var rt=yFe(je,n.filter(function(mt){var ct,Ut,xr=h in mt.props?mt.props[h]:(ct=mt.type.defaultProps)===null||ct===void 0?void 0:ct[h],tn="hide"in mt.props?mt.props.hide:(Ut=mt.type.defaultProps)===null||Ut===void 0?void 0:Ut.hide;return xr===ge&&(le||!tn)}),V,c,w);rt&&(Pe=rt)}O&&(U==="number"||ne!=="auto")&&(Ye=O2(je,V,"category"))}else O?Pe=hA(0,ze):p&&p[ge]&&p[ge].hasStack&&U==="number"?Pe=I==="expand"?[0,1]:rte(p[ge].stackGroups,s,v):Pe=Xee(je,n.filter(function(mt){var ct=h in mt.props?mt.props[h]:mt.type.defaultProps[h],Ut="hide"in mt.props?mt.props.hide:mt.type.defaultProps.hide;return ct===ge&&(le||!Ut)}),U,w,!0);if(U==="number")Pe=kD(T,Pe,ge,c,ae),We&&(Pe=HR(We,Pe,X));else if(U==="category"&&We){var ht=We,vt=Pe.every(function(mt){return ht.indexOf(mt)>=0});vt&&(Pe=ht)}}return Gt(Gt({},D),{},dn({},ge,Gt(Gt({},G),{},{axisType:c,domain:Pe,categoricalDomain:Ye,duplicateDomain:Ke,originalDomain:(N=G.domain)!==null&&N!==void 0?N:Oe,isCategorical:O,layout:w})))},{})},RGe=function(e,t){var r=t.graphicalItems,n=t.Axis,c=t.axisType,h=t.axisIdKey,p=t.stackGroups,s=t.dataStartIndex,v=t.dataEndIndex,w=e.layout,T=e.children,I=wP(e.data,{graphicalItems:r,dataStartIndex:s,dataEndIndex:v}),O=I.length,D=Yee(w,c),B=-1;return r.reduce(function(N,G){var U=G.type.defaultProps!==void 0?Gt(Gt({},G.type.defaultProps),G.props):G.props,V=U[h],X=mre("number");if(!N[V]){B++;var Y;return D?Y=hA(0,O):p&&p[V]&&p[V].hasStack?(Y=rte(p[V].stackGroups,s,v),Y=kD(T,Y,V,c)):(Y=HR(X,Xee(I,r.filter(function(ne){var ae,le,ge=h in ne.props?ne.props[h]:(ae=ne.type.defaultProps)===null||ae===void 0?void 0:ae[h],je="hide"in ne.props?ne.props.hide:(le=ne.type.defaultProps)===null||le===void 0?void 0:le.hide;return ge===V&&!je}),"number",w),n.defaultProps.allowDataOverflow),Y=kD(T,Y,V,c)),Gt(Gt({},N),{},dn({},V,Gt(Gt({axisType:c},n.defaultProps),{},{hide:!0,orientation:fl(CGe,"".concat(c,".").concat(B%2),null),domain:Y,originalDomain:X,isCategorical:D,layout:w})))}return N},{})},DGe=function(e,t){var r=t.axisType,n=r===void 0?"xAxis":r,c=t.AxisComp,h=t.graphicalItems,p=t.stackGroups,s=t.dataStartIndex,v=t.dataEndIndex,w=e.children,T="".concat(n,"Id"),I=Ll(w,c),O={};return I&&I.length?O=jGe(e,{axes:I,graphicalItems:h,axisType:n,axisIdKey:T,stackGroups:p,dataStartIndex:s,dataEndIndex:v}):h&&h.length&&(O=RGe(e,{Axis:c,graphicalItems:h,axisType:n,axisIdKey:T,stackGroups:p,dataStartIndex:s,dataEndIndex:v})),O},LGe=function(e){var t=Yd(e),r=_h(t,!1,!0);return{tooltipTicks:r,orderedTooltipTicks:kz(r,function(n){return n.coordinate}),tooltipAxis:t,tooltipAxisBandSize:QE(t,r)}},KH=function(e){var t=e.children,r=e.defaultShowTooltip,n=ol(t,L_),c=0,h=0;return e.data&&e.data.length!==0&&(h=e.data.length-1),n&&n.props&&(n.props.startIndex>=0&&(c=n.props.startIndex),n.props.endIndex>=0&&(h=n.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:c,dataEndIndex:h,activeTooltipIndex:-1,isTooltipActive:!!r}},zGe=function(e){return!e||!e.length?!1:e.some(function(t){var r=xh(t&&t.type);return r&&r.indexOf("Bar")>=0})},XH=function(e){return e==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:e==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:e==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},NGe=function(e,t){var r=e.props,n=e.graphicalItems,c=e.xAxisMap,h=c===void 0?{}:c,p=e.yAxisMap,s=p===void 0?{}:p,v=r.width,w=r.height,T=r.children,I=r.margin||{},O=ol(T,L_),D=ol(T,o_),B=Object.keys(s).reduce(function(Y,ne){var ae=s[ne],le=ae.orientation;return!ae.mirror&&!ae.hide?Gt(Gt({},Y),{},dn({},le,Y[le]+ae.width)):Y},{left:I.left||0,right:I.right||0}),N=Object.keys(h).reduce(function(Y,ne){var ae=h[ne],le=ae.orientation;return!ae.mirror&&!ae.hide?Gt(Gt({},Y),{},dn({},le,fl(Y,"".concat(le))+ae.height)):Y},{top:I.top||0,bottom:I.bottom||0}),G=Gt(Gt({},N),B),U=G.bottom;O&&(G.bottom+=O.props.height||L_.defaultProps.height),D&&t&&(G=mFe(G,n,r,t));var V=v-G.left-G.right,X=w-G.top-G.bottom;return Gt(Gt({brushBottom:U},G),{},{width:Math.max(V,0),height:Math.max(X,0)})},FGe=function(e,t){if(t==="xAxis")return e[t].width;if(t==="yAxis")return e[t].height},gre=function(e){var t=e.chartName,r=e.GraphicalChild,n=e.defaultTooltipEventType,c=n===void 0?"axis":n,h=e.validateTooltipEventTypes,p=h===void 0?["axis"]:h,s=e.axisComponents,v=e.legendContent,w=e.formatAxisMap,T=e.defaultProps,I=function(N,G){var U=G.graphicalItems,V=G.stackGroups,X=G.offset,Y=G.updateId,ne=G.dataStartIndex,ae=G.dataEndIndex,le=N.barSize,ge=N.layout,je=N.barGap,ze=N.barCategoryGap,Pe=N.maxBarSize,Ke=XH(ge),Ye=Ke.numericAxisName,Oe=Ke.cateAxisName,tt=zGe(U),We=[];return U.forEach(function(lt,rt){var ht=wP(N.data,{graphicalItems:[lt],dataStartIndex:ne,dataEndIndex:ae}),vt=lt.type.defaultProps!==void 0?Gt(Gt({},lt.type.defaultProps),lt.props):lt.props,mt=vt.dataKey,ct=vt.maxBarSize,Ut=vt["".concat(Ye,"Id")],xr=vt["".concat(Oe,"Id")],tn={},Er=s.reduce(function(ks,Wi){var Bi=G["".concat(Wi.axisType,"Map")],wo=vt["".concat(Wi.axisType,"Id")];Bi&&Bi[wo]||Wi.axisType==="zAxis"||km();var vs=Bi[wo];return Gt(Gt({},ks),{},dn(dn({},Wi.axisType,vs),"".concat(Wi.axisType,"Ticks"),_h(vs)))},tn),Ft=Er[Oe],br=Er["".concat(Oe,"Ticks")],Yt=V&&V[Ut]&&V[Ut].hasStack&&AFe(lt,V[Ut].stackGroups),Qt=xh(lt.type).indexOf("Bar")>=0,Sr=QE(Ft,br),Vt=[],Nn=tt&&fFe({barSize:le,stackGroups:V,totalSize:FGe(Er,Oe)});if(Qt){var Jr,Kr,Mn=ni(ct)?Pe:ct,Fi=(Jr=(Kr=QE(Ft,br,!0))!==null&&Kr!==void 0?Kr:Mn)!==null&&Jr!==void 0?Jr:0;Vt=pFe({barGap:je,barCategoryGap:ze,bandSize:Fi!==Sr?Fi:Sr,sizeList:Nn[xr],maxBarSize:Mn}),Fi!==Sr&&(Vt=Vt.map(function(ks){return Gt(Gt({},ks),{},{position:Gt(Gt({},ks.position),{},{offset:ks.position.offset-Fi/2})})}))}var Us=lt&&lt.type&&lt.type.getComposedData;Us&&We.push({props:Gt(Gt({},Us(Gt(Gt({},Er),{},{displayedData:ht,props:N,dataKey:mt,item:lt,bandSize:Sr,barPosition:Vt,offset:X,stackedData:Yt,layout:ge,dataStartIndex:ne,dataEndIndex:ae}))),{},dn(dn(dn({key:lt.key||"item-".concat(rt)},Ye,Er[Ye]),Oe,Er[Oe]),"animationId",Y)),childIndex:aEe(lt,N.children),item:lt})}),We},O=function(N,G){var U=N.props,V=N.dataStartIndex,X=N.dataEndIndex,Y=N.updateId;if(!h8({props:U}))return null;var ne=U.children,ae=U.layout,le=U.stackOffset,ge=U.data,je=U.reverseStackOrder,ze=XH(ae),Pe=ze.numericAxisName,Ke=ze.cateAxisName,Ye=Ll(ne,r),Oe=TFe(ge,Ye,"".concat(Pe,"Id"),"".concat(Ke,"Id"),le,je),tt=s.reduce(function(vt,mt){var ct="".concat(mt.axisType,"Map");return Gt(Gt({},vt),{},dn({},ct,DGe(U,Gt(Gt({},mt),{},{graphicalItems:Ye,stackGroups:mt.axisType===Pe&&Oe,dataStartIndex:V,dataEndIndex:X}))))},{}),We=NGe(Gt(Gt({},tt),{},{props:U,graphicalItems:Ye}),G?.legendBBox);Object.keys(tt).forEach(function(vt){tt[vt]=w(U,tt[vt],We,vt.replace("Map",""),t)});var lt=tt["".concat(Ke,"Map")],rt=LGe(lt),ht=I(U,Gt(Gt({},tt),{},{dataStartIndex:V,dataEndIndex:X,updateId:Y,graphicalItems:Ye,stackGroups:Oe,offset:We}));return Gt(Gt({formattedGraphicalItems:ht,graphicalItems:Ye,offset:We,stackGroups:Oe},rt),tt)},D=function(N){function G(U){var V,X,Y;return _Ge(this,G),Y=bGe(this,G,[U]),dn(Y,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),dn(Y,"accessibilityManager",new iGe),dn(Y,"handleLegendBBoxUpdate",function(ne){if(ne){var ae=Y.state,le=ae.dataStartIndex,ge=ae.dataEndIndex,je=ae.updateId;Y.setState(Gt({legendBBox:ne},O({props:Y.props,dataStartIndex:le,dataEndIndex:ge,updateId:je},Gt(Gt({},Y.state),{},{legendBBox:ne}))))}}),dn(Y,"handleReceiveSyncEvent",function(ne,ae,le){if(Y.props.syncId===ne){if(le===Y.eventEmitterSymbol&&typeof Y.props.syncMethod!="function")return;Y.applySyncEvent(ae)}}),dn(Y,"handleBrushChange",function(ne){var ae=ne.startIndex,le=ne.endIndex;if(ae!==Y.state.dataStartIndex||le!==Y.state.dataEndIndex){var ge=Y.state.updateId;Y.setState(function(){return Gt({dataStartIndex:ae,dataEndIndex:le},O({props:Y.props,dataStartIndex:ae,dataEndIndex:le,updateId:ge},Y.state))}),Y.triggerSyncEvent({dataStartIndex:ae,dataEndIndex:le})}}),dn(Y,"handleMouseEnter",function(ne){var ae=Y.getMouseInfo(ne);if(ae){var le=Gt(Gt({},ae),{},{isTooltipActive:!0});Y.setState(le),Y.triggerSyncEvent(le);var ge=Y.props.onMouseEnter;Cn(ge)&&ge(le,ne)}}),dn(Y,"triggeredAfterMouseMove",function(ne){var ae=Y.getMouseInfo(ne),le=ae?Gt(Gt({},ae),{},{isTooltipActive:!0}):{isTooltipActive:!1};Y.setState(le),Y.triggerSyncEvent(le);var ge=Y.props.onMouseMove;Cn(ge)&&ge(le,ne)}),dn(Y,"handleItemMouseEnter",function(ne){Y.setState(function(){return{isTooltipActive:!0,activeItem:ne,activePayload:ne.tooltipPayload,activeCoordinate:ne.tooltipPosition||{x:ne.cx,y:ne.cy}}})}),dn(Y,"handleItemMouseLeave",function(){Y.setState(function(){return{isTooltipActive:!1}})}),dn(Y,"handleMouseMove",function(ne){ne.persist(),Y.throttleTriggeredAfterMouseMove(ne)}),dn(Y,"handleMouseLeave",function(ne){Y.throttleTriggeredAfterMouseMove.cancel();var ae={isTooltipActive:!1};Y.setState(ae),Y.triggerSyncEvent(ae);var le=Y.props.onMouseLeave;Cn(le)&&le(ae,ne)}),dn(Y,"handleOuterEvent",function(ne){var ae=oEe(ne),le=fl(Y.props,"".concat(ae));if(ae&&Cn(le)){var ge,je;/.*touch.*/i.test(ae)?je=Y.getMouseInfo(ne.changedTouches[0]):je=Y.getMouseInfo(ne),le((ge=je)!==null&&ge!==void 0?ge:{},ne)}}),dn(Y,"handleClick",function(ne){var ae=Y.getMouseInfo(ne);if(ae){var le=Gt(Gt({},ae),{},{isTooltipActive:!0});Y.setState(le),Y.triggerSyncEvent(le);var ge=Y.props.onClick;Cn(ge)&&ge(le,ne)}}),dn(Y,"handleMouseDown",function(ne){var ae=Y.props.onMouseDown;if(Cn(ae)){var le=Y.getMouseInfo(ne);ae(le,ne)}}),dn(Y,"handleMouseUp",function(ne){var ae=Y.props.onMouseUp;if(Cn(ae)){var le=Y.getMouseInfo(ne);ae(le,ne)}}),dn(Y,"handleTouchMove",function(ne){ne.changedTouches!=null&&ne.changedTouches.length>0&&Y.throttleTriggeredAfterMouseMove(ne.changedTouches[0])}),dn(Y,"handleTouchStart",function(ne){ne.changedTouches!=null&&ne.changedTouches.length>0&&Y.handleMouseDown(ne.changedTouches[0])}),dn(Y,"handleTouchEnd",function(ne){ne.changedTouches!=null&&ne.changedTouches.length>0&&Y.handleMouseUp(ne.changedTouches[0])}),dn(Y,"handleDoubleClick",function(ne){var ae=Y.props.onDoubleClick;if(Cn(ae)){var le=Y.getMouseInfo(ne);ae(le,ne)}}),dn(Y,"handleContextMenu",function(ne){var ae=Y.props.onContextMenu;if(Cn(ae)){var le=Y.getMouseInfo(ne);ae(le,ne)}}),dn(Y,"triggerSyncEvent",function(ne){Y.props.syncId!==void 0&&QM.emit(eO,Y.props.syncId,ne,Y.eventEmitterSymbol)}),dn(Y,"applySyncEvent",function(ne){var ae=Y.props,le=ae.layout,ge=ae.syncMethod,je=Y.state.updateId,ze=ne.dataStartIndex,Pe=ne.dataEndIndex;if(ne.dataStartIndex!==void 0||ne.dataEndIndex!==void 0)Y.setState(Gt({dataStartIndex:ze,dataEndIndex:Pe},O({props:Y.props,dataStartIndex:ze,dataEndIndex:Pe,updateId:je},Y.state)));else if(ne.activeTooltipIndex!==void 0){var Ke=ne.chartX,Ye=ne.chartY,Oe=ne.activeTooltipIndex,tt=Y.state,We=tt.offset,lt=tt.tooltipTicks;if(!We)return;if(typeof ge=="function")Oe=ge(lt,ne);else if(ge==="value"){Oe=-1;for(var rt=0;rt<lt.length;rt++)if(lt[rt].value===ne.activeLabel){Oe=rt;break}}var ht=Gt(Gt({},We),{},{x:We.left,y:We.top}),vt=Math.min(Ke,ht.x+ht.width),mt=Math.min(Ye,ht.y+ht.height),ct=lt[Oe]&&lt[Oe].value,Ut=ID(Y.state,Y.props.data,Oe),xr=lt[Oe]?{x:le==="horizontal"?lt[Oe].coordinate:vt,y:le==="horizontal"?mt:lt[Oe].coordinate}:pre;Y.setState(Gt(Gt({},ne),{},{activeLabel:ct,activeCoordinate:xr,activePayload:Ut,activeTooltipIndex:Oe}))}else Y.setState(ne)}),dn(Y,"renderCursor",function(ne){var ae,le=Y.state,ge=le.isTooltipActive,je=le.activeCoordinate,ze=le.activePayload,Pe=le.offset,Ke=le.activeTooltipIndex,Ye=le.tooltipAxisBandSize,Oe=Y.getTooltipEventType(),tt=(ae=ne.props.active)!==null&&ae!==void 0?ae:ge,We=Y.props.layout,lt=ne.key||"_recharts-cursor";return Ne.createElement(hGe,{key:lt,activeCoordinate:je,activePayload:ze,activeTooltipIndex:Ke,chartName:t,element:ne,isActive:tt,layout:We,offset:Pe,tooltipAxisBandSize:Ye,tooltipEventType:Oe})}),dn(Y,"renderPolarAxis",function(ne,ae,le){var ge=fl(ne,"type.axisType"),je=fl(Y.state,"".concat(ge,"Map")),ze=ne.type.defaultProps,Pe=ze!==void 0?Gt(Gt({},ze),ne.props):ne.props,Ke=je&&je[Pe["".concat(ge,"Id")]];return Z.cloneElement(ne,Gt(Gt({},Ke),{},{className:Wn(ge,Ke.className),key:ne.key||"".concat(ae,"-").concat(le),ticks:_h(Ke,!0)}))}),dn(Y,"renderPolarGrid",function(ne){var ae=ne.props,le=ae.radialLines,ge=ae.polarAngles,je=ae.polarRadius,ze=Y.state,Pe=ze.radiusAxisMap,Ke=ze.angleAxisMap,Ye=Yd(Pe),Oe=Yd(Ke),tt=Oe.cx,We=Oe.cy,lt=Oe.innerRadius,rt=Oe.outerRadius;return Z.cloneElement(ne,{polarAngles:Array.isArray(ge)?ge:_h(Oe,!0).map(function(ht){return ht.coordinate}),polarRadius:Array.isArray(je)?je:_h(Ye,!0).map(function(ht){return ht.coordinate}),cx:tt,cy:We,innerRadius:lt,outerRadius:rt,key:ne.key||"polar-grid",radialLines:le})}),dn(Y,"renderLegend",function(){var ne=Y.state.formattedGraphicalItems,ae=Y.props,le=ae.children,ge=ae.width,je=ae.height,ze=Y.props.margin||{},Pe=ge-(ze.left||0)-(ze.right||0),Ke=Zee({children:le,formattedGraphicalItems:ne,legendWidth:Pe,legendContent:v});if(!Ke)return null;var Ye=Ke.item,Oe=WH(Ke,dGe);return Z.cloneElement(Ye,Gt(Gt({},Oe),{},{chartWidth:ge,chartHeight:je,margin:ze,onBBoxUpdate:Y.handleLegendBBoxUpdate}))}),dn(Y,"renderTooltip",function(){var ne,ae=Y.props,le=ae.children,ge=ae.accessibilityLayer,je=ol(le,Na);if(!je)return null;var ze=Y.state,Pe=ze.isTooltipActive,Ke=ze.activeCoordinate,Ye=ze.activePayload,Oe=ze.activeLabel,tt=ze.offset,We=(ne=je.props.active)!==null&&ne!==void 0?ne:Pe;return Z.cloneElement(je,{viewBox:Gt(Gt({},tt),{},{x:tt.left,y:tt.top}),active:We,label:Oe,payload:We?Ye:[],coordinate:Ke,accessibilityLayer:ge})}),dn(Y,"renderBrush",function(ne){var ae=Y.props,le=ae.margin,ge=ae.data,je=Y.state,ze=je.offset,Pe=je.dataStartIndex,Ke=je.dataEndIndex,Ye=je.updateId;return Z.cloneElement(ne,{key:ne.key||"_recharts-brush",onChange:n2(Y.handleBrushChange,ne.props.onChange),data:ge,x:fr(ne.props.x)?ne.props.x:ze.left,y:fr(ne.props.y)?ne.props.y:ze.top+ze.height+ze.brushBottom-(le.bottom||0),width:fr(ne.props.width)?ne.props.width:ze.width,startIndex:Pe,endIndex:Ke,updateId:"brush-".concat(Ye)})}),dn(Y,"renderReferenceElement",function(ne,ae,le){if(!ne)return null;var ge=Y,je=ge.clipPathId,ze=Y.state,Pe=ze.xAxisMap,Ke=ze.yAxisMap,Ye=ze.offset,Oe=ne.type.defaultProps||{},tt=ne.props,We=tt.xAxisId,lt=We===void 0?Oe.xAxisId:We,rt=tt.yAxisId,ht=rt===void 0?Oe.yAxisId:rt;return Z.cloneElement(ne,{key:ne.key||"".concat(ae,"-").concat(le),xAxis:Pe[lt],yAxis:Ke[ht],viewBox:{x:Ye.left,y:Ye.top,width:Ye.width,height:Ye.height},clipPathId:je})}),dn(Y,"renderActivePoints",function(ne){var ae=ne.item,le=ne.activePoint,ge=ne.basePoint,je=ne.childIndex,ze=ne.isRange,Pe=[],Ke=ae.props.key,Ye=ae.item.type.defaultProps!==void 0?Gt(Gt({},ae.item.type.defaultProps),ae.item.props):ae.item.props,Oe=Ye.activeDot,tt=Ye.dataKey,We=Gt(Gt({index:je,dataKey:tt,cx:le.x,cy:le.y,r:4,fill:Jz(ae.item),strokeWidth:2,stroke:"#fff",payload:le.payload,value:le.value},Sn(Oe,!1)),AE(Oe));return Pe.push(G.renderActiveDot(Oe,We,"".concat(Ke,"-activePoint-").concat(je))),ge?Pe.push(G.renderActiveDot(Oe,Gt(Gt({},We),{},{cx:ge.x,cy:ge.y}),"".concat(Ke,"-basePoint-").concat(je))):ze&&Pe.push(null),Pe}),dn(Y,"renderGraphicChild",function(ne,ae,le){var ge=Y.filterFormatItem(ne,ae,le);if(!ge)return null;var je=Y.getTooltipEventType(),ze=Y.state,Pe=ze.isTooltipActive,Ke=ze.tooltipAxis,Ye=ze.activeTooltipIndex,Oe=ze.activeLabel,tt=Y.props.children,We=ol(tt,Na),lt=ge.props,rt=lt.points,ht=lt.isRange,vt=lt.baseLine,mt=ge.item.type.defaultProps!==void 0?Gt(Gt({},ge.item.type.defaultProps),ge.item.props):ge.item.props,ct=mt.activeDot,Ut=mt.hide,xr=mt.activeBar,tn=mt.activeShape,Er=!!(!Ut&&Pe&&We&&(ct||xr||tn)),Ft={};je!=="axis"&&We&&We.props.trigger==="click"?Ft={onClick:n2(Y.handleItemMouseEnter,ne.props.onClick)}:je!=="axis"&&(Ft={onMouseLeave:n2(Y.handleItemMouseLeave,ne.props.onMouseLeave),onMouseEnter:n2(Y.handleItemMouseEnter,ne.props.onMouseEnter)});var br=Z.cloneElement(ne,Gt(Gt({},ge.props),Ft));function Yt(Bi){return typeof Ke.dataKey=="function"?Ke.dataKey(Bi.payload):null}if(Er)if(Ye>=0){var Qt,Sr;if(Ke.dataKey&&!Ke.allowDuplicatedCategory){var Vt=typeof Ke.dataKey=="function"?Yt:"payload.".concat(Ke.dataKey.toString());Qt=sR(rt,Vt,Oe),Sr=ht&&vt&&sR(vt,Vt,Oe)}else Qt=rt?.[Ye],Sr=ht&&vt&&vt[Ye];if(tn||xr){var Nn=ne.props.activeIndex!==void 0?ne.props.activeIndex:Ye;return[Z.cloneElement(ne,Gt(Gt(Gt({},ge.props),Ft),{},{activeIndex:Nn})),null,null]}if(!ni(Qt))return[br].concat(q_(Y.renderActivePoints({item:ge,activePoint:Qt,basePoint:Sr,childIndex:Ye,isRange:ht})))}else{var Jr,Kr=(Jr=Y.getItemByXY(Y.state.activeCoordinate))!==null&&Jr!==void 0?Jr:{graphicalItem:br},Mn=Kr.graphicalItem,Fi=Mn.item,Us=Fi===void 0?ne:Fi,ks=Mn.childIndex,Wi=Gt(Gt(Gt({},ge.props),Ft),{},{activeIndex:ks});return[Z.cloneElement(Us,Wi),null,null]}return ht?[br,null,null]:[br,null]}),dn(Y,"renderCustomized",function(ne,ae,le){return Z.cloneElement(ne,Gt(Gt({key:"recharts-customized-".concat(le)},Y.props),Y.state))}),dn(Y,"renderMap",{CartesianGrid:{handler:l2,once:!0},ReferenceArea:{handler:Y.renderReferenceElement},ReferenceLine:{handler:l2},ReferenceDot:{handler:Y.renderReferenceElement},XAxis:{handler:l2},YAxis:{handler:l2},Brush:{handler:Y.renderBrush,once:!0},Bar:{handler:Y.renderGraphicChild},Line:{handler:Y.renderGraphicChild},Area:{handler:Y.renderGraphicChild},Radar:{handler:Y.renderGraphicChild},RadialBar:{handler:Y.renderGraphicChild},Scatter:{handler:Y.renderGraphicChild},Pie:{handler:Y.renderGraphicChild},Funnel:{handler:Y.renderGraphicChild},Tooltip:{handler:Y.renderCursor,once:!0},PolarGrid:{handler:Y.renderPolarGrid,once:!0},PolarAngleAxis:{handler:Y.renderPolarAxis},PolarRadiusAxis:{handler:Y.renderPolarAxis},Customized:{handler:Y.renderCustomized}}),Y.clipPathId="".concat((V=U.id)!==null&&V!==void 0?V:o1("recharts"),"-clip"),Y.throttleTriggeredAfterMouseMove=HQ(Y.triggeredAfterMouseMove,(X=U.throttleDelay)!==null&&X!==void 0?X:1e3/60),Y.state={},Y}return TGe(G,N),xGe(G,[{key:"componentDidMount",value:function(){var U,V;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(U=this.props.margin.left)!==null&&U!==void 0?U:0,top:(V=this.props.margin.top)!==null&&V!==void 0?V:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var U=this.props,V=U.children,X=U.data,Y=U.height,ne=U.layout,ae=ol(V,Na);if(ae){var le=ae.props.defaultIndex;if(!(typeof le!="number"||le<0||le>this.state.tooltipTicks.length-1)){var ge=this.state.tooltipTicks[le]&&this.state.tooltipTicks[le].value,je=ID(this.state,X,le,ge),ze=this.state.tooltipTicks[le].coordinate,Pe=(this.state.offset.top+Y)/2,Ke=ne==="horizontal",Ye=Ke?{x:ze,y:Pe}:{y:ze,x:Pe},Oe=this.state.formattedGraphicalItems.find(function(We){var lt=We.item;return lt.type.name==="Scatter"});Oe&&(Ye=Gt(Gt({},Ye),Oe.props.points[le].tooltipPosition),je=Oe.props.points[le].tooltipPayload);var tt={activeTooltipIndex:le,isTooltipActive:!0,activeLabel:ge,activePayload:je,activeCoordinate:Ye};this.setState(tt),this.renderCursor(ae),this.accessibilityManager.setIndex(le)}}}},{key:"getSnapshotBeforeUpdate",value:function(U,V){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==V.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==U.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==U.margin){var X,Y;this.accessibilityManager.setDetails({offset:{left:(X=this.props.margin.left)!==null&&X!==void 0?X:0,top:(Y=this.props.margin.top)!==null&&Y!==void 0?Y:0}})}return null}},{key:"componentDidUpdate",value:function(U){aR([ol(U.children,Na)],[ol(this.props.children,Na)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var U=ol(this.props.children,Na);if(U&&typeof U.props.shared=="boolean"){var V=U.props.shared?"axis":"item";return p.indexOf(V)>=0?V:c}return c}},{key:"getMouseInfo",value:function(U){if(!this.container)return null;var V=this.container,X=V.getBoundingClientRect(),Y=jDe(X),ne={chartX:Math.round(U.pageX-Y.left),chartY:Math.round(U.pageY-Y.top)},ae=X.width/V.offsetWidth||1,le=this.inRange(ne.chartX,ne.chartY,ae);if(!le)return null;var ge=this.state,je=ge.xAxisMap,ze=ge.yAxisMap,Pe=this.getTooltipEventType(),Ke=ZH(this.state,this.props.data,this.props.layout,le);if(Pe!=="axis"&&je&&ze){var Ye=Yd(je).scale,Oe=Yd(ze).scale,tt=Ye&&Ye.invert?Ye.invert(ne.chartX):null,We=Oe&&Oe.invert?Oe.invert(ne.chartY):null;return Gt(Gt({},ne),{},{xValue:tt,yValue:We},Ke)}return Ke?Gt(Gt({},ne),Ke):null}},{key:"inRange",value:function(U,V){var X=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,Y=this.props.layout,ne=U/X,ae=V/X;if(Y==="horizontal"||Y==="vertical"){var le=this.state.offset,ge=ne>=le.left&&ne<=le.left+le.width&&ae>=le.top&&ae<=le.top+le.height;return ge?{x:ne,y:ae}:null}var je=this.state,ze=je.angleAxisMap,Pe=je.radiusAxisMap;if(ze&&Pe){var Ke=Yd(ze);return wG({x:ne,y:ae},Ke)}return null}},{key:"parseEventsOfWrapper",value:function(){var U=this.props.children,V=this.getTooltipEventType(),X=ol(U,Na),Y={};X&&V==="axis"&&(X.props.trigger==="click"?Y={onClick:this.handleClick}:Y={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var ne=AE(this.props,this.handleOuterEvent);return Gt(Gt({},ne),Y)}},{key:"addListener",value:function(){QM.on(eO,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){QM.removeListener(eO,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(U,V,X){for(var Y=this.state.formattedGraphicalItems,ne=0,ae=Y.length;ne<ae;ne++){var le=Y[ne];if(le.item===U||le.props.key===U.key||V===xh(le.item.type)&&X===le.childIndex)return le}return null}},{key:"renderClipPath",value:function(){var U=this.clipPathId,V=this.state.offset,X=V.left,Y=V.top,ne=V.height,ae=V.width;return Ne.createElement("defs",null,Ne.createElement("clipPath",{id:U},Ne.createElement("rect",{x:X,y:Y,height:ne,width:ae})))}},{key:"getXScales",value:function(){var U=this.state.xAxisMap;return U?Object.entries(U).reduce(function(V,X){var Y=HH(X,2),ne=Y[0],ae=Y[1];return Gt(Gt({},V),{},dn({},ne,ae.scale))},{}):null}},{key:"getYScales",value:function(){var U=this.state.yAxisMap;return U?Object.entries(U).reduce(function(V,X){var Y=HH(X,2),ne=Y[0],ae=Y[1];return Gt(Gt({},V),{},dn({},ne,ae.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(U){var V;return(V=this.state.xAxisMap)===null||V===void 0||(V=V[U])===null||V===void 0?void 0:V.scale}},{key:"getYScaleByAxisId",value:function(U){var V;return(V=this.state.yAxisMap)===null||V===void 0||(V=V[U])===null||V===void 0?void 0:V.scale}},{key:"getItemByXY",value:function(U){var V=this.state,X=V.formattedGraphicalItems,Y=V.activeItem;if(X&&X.length)for(var ne=0,ae=X.length;ne<ae;ne++){var le=X[ne],ge=le.props,je=le.item,ze=je.type.defaultProps!==void 0?Gt(Gt({},je.type.defaultProps),je.props):je.props,Pe=xh(je.type);if(Pe==="Bar"){var Ke=(ge.data||[]).find(function(We){return w4e(U,We)});if(Ke)return{graphicalItem:le,payload:Ke}}else if(Pe==="RadialBar"){var Ye=(ge.data||[]).find(function(We){return wG(U,We)});if(Ye)return{graphicalItem:le,payload:Ye}}else if(mP(le,Y)||gP(le,Y)||Rw(le,Y)){var Oe=uVe({graphicalItem:le,activeTooltipItem:Y,itemData:ze.data}),tt=ze.activeIndex===void 0?Oe:ze.activeIndex;return{graphicalItem:Gt(Gt({},le),{},{childIndex:tt}),payload:Rw(le,Y)?ze.data[Oe]:le.props.data[Oe]}}}return null}},{key:"render",value:function(){var U=this;if(!h8(this))return null;var V=this.props,X=V.children,Y=V.className,ne=V.width,ae=V.height,le=V.style,ge=V.compact,je=V.title,ze=V.desc,Pe=WH(V,fGe),Ke=Sn(Pe,!1);if(ge)return Ne.createElement(IH,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ne.createElement(cR,Hy({},Ke,{width:ne,height:ae,title:je,desc:ze}),this.renderClipPath(),f8(X,this.renderMap)));if(this.props.accessibilityLayer){var Ye,Oe;Ke.tabIndex=(Ye=this.props.tabIndex)!==null&&Ye!==void 0?Ye:0,Ke.role=(Oe=this.props.role)!==null&&Oe!==void 0?Oe:"application",Ke.onKeyDown=function(We){U.accessibilityManager.keyboardEvent(We)},Ke.onFocus=function(){U.accessibilityManager.focus()}}var tt=this.parseEventsOfWrapper();return Ne.createElement(IH,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ne.createElement("div",Hy({className:Wn("recharts-wrapper",Y),style:Gt({position:"relative",cursor:"default",width:ne,height:ae},le)},tt,{ref:function(We){U.container=We}}),Ne.createElement(cR,Hy({},Ke,{width:ne,height:ae,title:je,desc:ze,style:IGe}),this.renderClipPath(),f8(X,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(Z.Component);dn(D,"displayName",t),dn(D,"defaultProps",Gt({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},T)),dn(D,"getDerivedStateFromProps",function(N,G){var U=N.dataKey,V=N.data,X=N.children,Y=N.width,ne=N.height,ae=N.layout,le=N.stackOffset,ge=N.margin,je=G.dataStartIndex,ze=G.dataEndIndex;if(G.updateId===void 0){var Pe=KH(N);return Gt(Gt(Gt({},Pe),{},{updateId:0},O(Gt(Gt({props:N},Pe),{},{updateId:0}),G)),{},{prevDataKey:U,prevData:V,prevWidth:Y,prevHeight:ne,prevLayout:ae,prevStackOffset:le,prevMargin:ge,prevChildren:X})}if(U!==G.prevDataKey||V!==G.prevData||Y!==G.prevWidth||ne!==G.prevHeight||ae!==G.prevLayout||le!==G.prevStackOffset||!s_(ge,G.prevMargin)){var Ke=KH(N),Ye={chartX:G.chartX,chartY:G.chartY,isTooltipActive:G.isTooltipActive},Oe=Gt(Gt({},ZH(G,V,ae)),{},{updateId:G.updateId+1}),tt=Gt(Gt(Gt({},Ke),Ye),Oe);return Gt(Gt(Gt({},tt),O(Gt({props:N},tt),G)),{},{prevDataKey:U,prevData:V,prevWidth:Y,prevHeight:ne,prevLayout:ae,prevStackOffset:le,prevMargin:ge,prevChildren:X})}if(!aR(X,G.prevChildren)){var We,lt,rt,ht,vt=ol(X,L_),mt=vt&&(We=(lt=vt.props)===null||lt===void 0?void 0:lt.startIndex)!==null&&We!==void 0?We:je,ct=vt&&(rt=(ht=vt.props)===null||ht===void 0?void 0:ht.endIndex)!==null&&rt!==void 0?rt:ze,Ut=mt!==je||ct!==ze,xr=!ni(V),tn=xr&&!Ut?G.updateId:G.updateId+1;return Gt(Gt({updateId:tn},O(Gt(Gt({props:N},G),{},{updateId:tn,dataStartIndex:mt,dataEndIndex:ct}),G)),{},{prevChildren:X,dataStartIndex:mt,dataEndIndex:ct})}return null}),dn(D,"renderActiveDot",function(N,G,U){var V;return Z.isValidElement(N)?V=Z.cloneElement(N,G):Cn(N)?V=N(G):V=Ne.createElement(eN,G),Ne.createElement(Li,{className:"recharts-active-dot",key:U},V)});var B=Z.forwardRef(function(N,G){return Ne.createElement(D,Hy({},N,{ref:G}))});return B.displayName=D.displayName,B},MD=gre({chartName:"BarChart",GraphicalChild:Lh,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:$_},{axisType:"yAxis",AxisComp:H_}],formatAxisMap:UUe}),OD=gre({chartName:"PieChart",GraphicalChild:Uh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:pP},{axisType:"radiusAxis",AxisComp:dP}],formatAxisMap:LFe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const BGe=({className:e})=>{const{filteredPreschools:t,searchFilters:r}=_s(),[n,c]=Z.useState(!1),h=Z.useMemo(()=>{const w=t.filter(V=>V.latitud&&V.longitud),T=w.length,I=w.reduce((V,X)=>V+(X.antal_barn||0),0),O=w.filter(V=>V.huvudman==="Kommunal").length,D=w.filter(V=>V.huvudman==="Enskild").length,B=w.filter(V=>V.andel_med_förskollärarexamen).reduce((V,X)=>V+(X.andel_med_förskollärarexamen||0),0)/w.filter(V=>V.andel_med_förskollärarexamen).length||0,N=w.filter(V=>V.personaltäthet).reduce((V,X)=>V+(X.personaltäthet||0),0)/w.filter(V=>V.personaltäthet).length||0,G=w.filter(V=>V.google_rating).reduce((V,X)=>V+(X.google_rating||0),0)/w.filter(V=>V.google_rating).length||0,U=w.filter(V=>V.google_rating).length;return{totalPreschools:T,totalChildren:I,kommunalCount:O,enskildCount:D,avgTeacherEducation:B,avgStaffDensity:N,avgRating:G,ratedCount:U,preschools:w}},[t]),p=()=>r.kommuner&&r.kommuner.length>0?`Statistik för ${r.kommuner.length===1?r.kommuner[0]:`${r.kommuner.length} kommuner`}`:r.nearbyMode?"Statistik för närområdet":r.query?`Statistik för "${r.query}"`:"Statistik för alla förskolor",s=[{name:"Kommunal",value:h.kommunalCount,color:"hsl(210, 85%, 60%)"},{name:"Fristående",value:h.enskildCount,color:"hsl(25, 85%, 60%)"}],v=Z.useMemo(()=>{const w=[{name:"90-100%",min:90,max:100,count:0},{name:"80-89%",min:80,max:89,count:0},{name:"70-79%",min:70,max:79,count:0},{name:"60-69%",min:60,max:69,count:0},{name:"<60%",min:0,max:59,count:0}];return h.preschools.forEach(T=>{if(T.andel_med_förskollärarexamen){const I=w.find(O=>T.andel_med_förskollärarexamen>=O.min&&T.andel_med_förskollärarexamen<=O.max);I&&I.count++}}),w.filter(T=>T.count>0)},[h.preschools]);return n?P.jsx(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`absolute bottom-4 left-4 z-30 w-96 max-h-[calc(100vh-2rem)] ${e}`,children:P.jsxs(kn,{className:"glass-card border-0 shadow-lg h-full flex flex-col",children:[P.jsx(r_,{className:"pb-4",children:P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{children:[P.jsx(n_,{className:"text-lg font-heading font-semibold text-foreground",children:p()}),P.jsx("p",{className:"text-sm text-muted-foreground",children:"Översikt och jämförelser"})]}),P.jsx(Hr,{onClick:()=>c(!1),variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:P.jsx(Zw,{className:"h-3 w-3"})})]})}),P.jsx(Pl,{className:"flex-1 overflow-hidden",children:P.jsxs(Z3,{defaultValue:"overview",className:"h-full flex flex-col",children:[P.jsxs(_k,{className:"grid w-full grid-cols-3",children:[P.jsx(Su,{value:"overview",children:"Översikt"}),P.jsx(Su,{value:"quality",children:"Kvalitet"}),P.jsx(Su,{value:"distribution",children:"Fördelning"})]}),P.jsxs("div",{className:"flex-1 overflow-y-auto mt-4",children:[P.jsxs(Tu,{value:"overview",className:"space-y-4 mt-0",children:[P.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[P.jsx(kn,{className:"bg-gradient-to-br from-bubble-kommunal/10 to-bubble-kommunal/5 border-bubble-kommunal/20",children:P.jsx(Pl,{className:"p-3",children:P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(am,{className:"h-4 w-4 text-bubble-kommunal"}),P.jsxs("div",{children:[P.jsx("p",{className:"text-xs text-muted-foreground",children:"Förskolor"}),P.jsx("p",{className:"text-lg font-bold text-bubble-kommunal",children:h.totalPreschools})]})]})})}),P.jsx(kn,{className:"bg-gradient-to-br from-bubble-enskild/10 to-bubble-enskild/5 border-bubble-enskild/20",children:P.jsx(Pl,{className:"p-3",children:P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(Rm,{className:"h-4 w-4 text-bubble-enskild"}),P.jsxs("div",{children:[P.jsx("p",{className:"text-xs text-muted-foreground",children:"Barn totalt"}),P.jsx("p",{className:"text-lg font-bold text-bubble-enskild",children:h.totalChildren})]})]})})}),h.avgRating>0&&P.jsx(kn,{className:"bg-gradient-to-br from-bubble-high-rating/10 to-bubble-high-rating/5 border-bubble-high-rating/20",children:P.jsx(Pl,{className:"p-3",children:P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(ba,{className:"h-4 w-4 text-bubble-high-rating"}),P.jsxs("div",{children:[P.jsx("p",{className:"text-xs text-muted-foreground",children:"Snittbetyg"}),P.jsx("p",{className:"text-lg font-bold text-bubble-high-rating",children:h.avgRating.toFixed(1)})]})]})})}),h.avgTeacherEducation>0&&P.jsx(kn,{className:"bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20",children:P.jsx(Pl,{className:"p-3",children:P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(Kq,{className:"h-4 w-4 text-primary"}),P.jsxs("div",{children:[P.jsx("p",{className:"text-xs text-muted-foreground",children:"Förskollärare"}),P.jsxs("p",{className:"text-lg font-bold text-primary",children:[Math.round(h.avgTeacherEducation),"%"]})]})]})})})]}),P.jsxs("div",{className:"space-y-2",children:[P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-sm text-muted-foreground",children:"Kommunal vs Fristående"}),P.jsxs("div",{className:"flex gap-1",children:[P.jsxs(an,{variant:"outline",className:"text-xs bg-bubble-kommunal/10 text-bubble-kommunal border-bubble-kommunal/20",children:[h.kommunalCount," kommunal"]}),P.jsxs(an,{variant:"outline",className:"text-xs bg-bubble-enskild/10 text-bubble-enskild border-bubble-enskild/20",children:[h.enskildCount," fristående"]})]})]}),h.avgStaffDensity>0&&P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-sm text-muted-foreground",children:"Snitt personaltäthet"}),P.jsxs("span",{className:"text-sm font-medium",children:[h.avgStaffDensity.toFixed(1)," barn/personal"]})]}),h.ratedCount>0&&P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-sm text-muted-foreground",children:"Förskolor med betyg"}),P.jsxs("span",{className:"text-sm font-medium",children:[h.ratedCount," av ",h.totalPreschools]})]})]})]}),P.jsxs(Tu,{value:"quality",className:"space-y-4 mt-0",children:[v.length>0&&P.jsxs(kn,{children:[P.jsx(r_,{className:"pb-2",children:P.jsx(n_,{className:"text-sm",children:"Fördelning förskollärare med examen"})}),P.jsx(Pl,{children:P.jsx(Ab,{width:"100%",height:200,children:P.jsxs(MD,{data:v,children:[P.jsx(uN,{strokeDasharray:"3 3",opacity:.3}),P.jsx($_,{dataKey:"name",fontSize:10}),P.jsx(H_,{fontSize:10}),P.jsx(Na,{}),P.jsx(Lh,{dataKey:"count",fill:"hsl(130, 70%, 60%)",radius:[2,2,0,0]})]})})})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsx("h4",{className:"font-medium text-sm",children:"Kvalitetsinsikter"}),h.avgTeacherEducation>=80&&P.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-bubble-high-rating/10 border border-bubble-high-rating/20",children:[P.jsx(jm,{className:"h-4 w-4 text-bubble-high-rating mt-0.5"}),P.jsxs("div",{children:[P.jsx("p",{className:"text-sm font-medium text-bubble-high-rating",children:"Hög kvalitet"}),P.jsxs("p",{className:"text-xs text-muted-foreground",children:["Området har en hög andel förskollärare med examen (",Math.round(h.avgTeacherEducation),"%)."]})]})]}),h.avgRating>=4.5&&P.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-yellow-50 border border-yellow-200",children:[P.jsx(ba,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),P.jsxs("div",{children:[P.jsx("p",{className:"text-sm font-medium text-yellow-700",children:"Högt betyg"}),P.jsxs("p",{className:"text-xs text-muted-foreground",children:["Förskolor i området har utmärkta betyg (",h.avgRating.toFixed(1),"/5)."]})]})]})]})]}),P.jsx(Tu,{value:"distribution",className:"space-y-4 mt-0",children:s.some(w=>w.value>0)&&P.jsxs(kn,{children:[P.jsx(r_,{className:"pb-2",children:P.jsx(n_,{className:"text-sm",children:"Kommunal vs Fristående"})}),P.jsxs(Pl,{children:[P.jsx(Ab,{width:"100%",height:200,children:P.jsxs(OD,{children:[P.jsx(OD,{data:s,dataKey:"value",cx:"50%",cy:"50%",outerRadius:80,children:s.map((w,T)=>P.jsx(l1,{fill:w.color},`cell-${T}`))}),P.jsx(Na,{})]})}),P.jsx("div",{className:"flex justify-center gap-4 mt-2",children:s.map(w=>P.jsxs("div",{className:"flex items-center gap-1",children:[P.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:w.color}}),P.jsxs("span",{className:"text-xs text-muted-foreground",children:[w.name," (",w.value,")"]})]},w.name))})]})]})})]})]})})]})}):P.jsx(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`absolute bottom-4 left-4 z-30 ${e}`,children:P.jsx(kn,{className:"glass-card border-0 shadow-lg hover-lift-subtle cursor-pointer",onClick:()=>c(!0),children:P.jsx(Pl,{className:"p-4",children:P.jsxs("div",{className:"flex items-center gap-3",children:[P.jsx(Ah,{className:"h-5 w-5 text-primary"}),P.jsxs("div",{children:[P.jsx("h3",{className:"font-heading font-semibold text-sm text-foreground",children:p()}),P.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.totalPreschools," förskolor • ",h.totalChildren," barn"]})]}),P.jsx(HA,{className:"h-4 w-4 text-muted-foreground ml-auto"})]})})})})},hN=Z.forwardRef(({className:e,type:t,...r},n)=>P.jsx("input",{type:t,className:ln("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));hN.displayName="Input";var VGe="Separator",YH="horizontal",UGe=["horizontal","vertical"],yre=Z.forwardRef((e,t)=>{const{decorative:r,orientation:n=YH,...c}=e,h=$Ge(n)?n:YH,p=r?{role:"none"}:{"aria-orientation":h==="vertical"?h:void 0,role:"separator"};return P.jsx(fn.div,{"data-orientation":h,...p,...c,ref:t})});yre.displayName=VGe;function $Ge(e){return UGe.includes(e)}var _re=yre;const Wp=Z.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},c)=>P.jsx(_re,{ref:c,decorative:r,orientation:t,className:ln("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));Wp.displayName=_re.displayName;const GGe=()=>{const e=Z.useRef(new Map),[t,r]=Z.useState(!1),n=30*60*1e3,c=Z.useCallback(async s=>{const v=Date.now(),w=e.current.get(s);if(w&&v<w.expiry)return w.data;r(!0);try{const{data:T,error:I}=await gn.from("preschool_images").select("image_url").eq("preschool_id",s).eq("image_type","google_places").order("created_at");if(I)return console.error("Error fetching images:",I),[];const O=T?.map(D=>D.image_url)||[];return e.current.set(s,{data:O,timestamp:v,expiry:v+n}),O}catch(T){return console.error("Error in image cache:",T),[]}finally{r(!1)}},[]),h=Z.useCallback(async s=>{const v=s.map(w=>c(w));await Promise.allSettled(v)},[c]),p=Z.useCallback(()=>{e.current.clear()},[]);return{getImages:c,preloadImages:h,clearCache:p,isLoading:t}},HGe=({preschoolId:e,preschoolName:t,streetViewPanoId:r,lat:n,lng:c})=>{const[h,p]=Z.useState([]),[s,v]=Z.useState(0),[w,T]=Z.useState(!1),[I,O]=Z.useState(!0),{getImages:D}=GGe();Z.useEffect(()=>{(async()=>{O(!0);try{const X=[...await D(e)];if(r&&n&&c){const Y=`https://maps.googleapis.com/maps/api/streetview?size=800x600&location=${n},${c}&fov=90&pitch=0&key=demo`;X.push(Y)}p(X)}catch(X){console.error("Error loading images:",X)}finally{O(!1)}})()},[e,r,n,c,D]);const B=()=>{v(X=>(X+1)%h.length)},N=()=>{v(X=>(X-1+h.length)%h.length)},G=()=>{T(!0)},U=()=>{T(!1)},V=()=>{if(n&&c){const X=`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${n},${c}`;window.open(X,"_blank")}};return I?P.jsxs("div",{className:"space-y-2",children:[P.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[P.jsx(qa,{className:"h-4 w-4"}),"Bilder"]}),P.jsx("div",{className:"w-full h-48 bg-muted rounded-lg animate-pulse flex items-center justify-center",children:P.jsx("span",{className:"text-sm text-muted-foreground",children:"Laddar bilder..."})})]}):h.length===0?P.jsxs("div",{className:"space-y-2",children:[P.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[P.jsx(qa,{className:"h-4 w-4"}),"Bilder"]}),P.jsx("div",{className:"w-full h-32 bg-muted/30 rounded-lg flex items-center justify-center",children:P.jsx("span",{className:"text-sm text-muted-foreground",children:"Inga bilder tillgängliga"})})]}):P.jsxs(P.Fragment,{children:[P.jsxs("div",{className:"space-y-2",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[P.jsx(qa,{className:"h-4 w-4"}),"Bilder"]}),h.length>1&&P.jsxs(an,{variant:"secondary",className:"text-xs",children:[s+1," / ",h.length]})]}),P.jsxs("div",{className:"relative group",children:[P.jsx("div",{className:"w-full h-48 bg-muted rounded-lg overflow-hidden cursor-pointer",onClick:G,children:P.jsx("img",{src:h[s],alt:`${t} - Bild ${s+1}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",onError:X=>{console.error("Failed to load image:",h[s]),X.currentTarget.src="/placeholder.svg"}})}),h.length>1&&P.jsxs(P.Fragment,{children:[P.jsx(Hr,{variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white hover:bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity",onClick:X=>{X.stopPropagation(),N()},children:P.jsx(tj,{className:"h-4 w-4"})}),P.jsx(Hr,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white hover:bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity",onClick:X=>{X.stopPropagation(),B()},children:P.jsx(rj,{className:"h-4 w-4"})})]}),r&&s===h.length-1&&P.jsxs(Hr,{variant:"ghost",size:"sm",className:"absolute bottom-2 right-2 bg-black/50 text-white hover:bg-black/70 text-xs",onClick:X=>{X.stopPropagation(),V()},children:[P.jsx($ce,{className:"h-3 w-3 mr-1"}),"Street View"]})]}),h.length>1&&P.jsx("div",{className:"flex gap-1 overflow-x-auto",children:h.map((X,Y)=>P.jsx("button",{className:`flex-shrink-0 w-12 h-12 rounded border-2 overflow-hidden transition-all ${Y===s?"border-primary":"border-transparent hover:border-muted-foreground/50"}`,onClick:()=>v(Y),children:P.jsx("img",{src:X,alt:`Thumbnail ${Y+1}`,className:"w-full h-full object-cover",onError:ne=>{ne.currentTarget.src="/placeholder.svg"}})},Y))})]}),P.jsx(Tc,{children:w&&P.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center",onClick:U,children:P.jsxs(Fr.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:"relative max-w-6xl max-h-[90vh] w-full h-full flex items-center justify-center",onClick:X=>X.stopPropagation(),children:[P.jsx("img",{src:h[s],alt:`${t} - Fullscreen`,className:"max-w-full max-h-full object-contain"}),P.jsx(Hr,{variant:"ghost",size:"sm",className:"absolute top-4 right-4 text-white hover:bg-white/20",onClick:U,children:P.jsx(Qo,{className:"h-6 w-6"})}),h.length>1&&P.jsxs(P.Fragment,{children:[P.jsx(Hr,{variant:"ghost",size:"sm",className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20",onClick:N,children:P.jsx(tj,{className:"h-8 w-8"})}),P.jsx(Hr,{variant:"ghost",size:"sm",className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20",onClick:B,children:P.jsx(rj,{className:"h-8 w-8"})})]}),P.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white text-sm",children:[s+1," / ",h.length]})]})})})]})},WGe=({reviews:e,rating:t,reviewsCount:r})=>{const[n,c]=Z.useState(!1),[h,p]=Z.useState(null),s=Z.useMemo(()=>{if(!e)return[];try{return typeof e=="string"?JSON.parse(e):e}catch(B){return console.error("Error parsing reviews:",B),[]}},[e]),v=Z.useMemo(()=>{if(!s.length)return[];let B=s;return h!==null&&(B=B.filter(N=>N.rating===h)),B.sort((N,G)=>G.time-N.time)},[s,h]),w=n?v:v.slice(0,3),T=Z.useMemo(()=>{if(!s.length)return{};const B={};return s.forEach(N=>{B[N.rating]=(B[N.rating]||0)+1}),B},[s]),I=Z.useMemo(()=>s.length?s.reduce((B,N)=>B+N.rating,0)/s.length:t||0,[s,t]),O=B=>B.replace("a day ago","för en dag sedan").replace("days ago","dagar sedan").replace("a week ago","för en vecka sedan").replace("weeks ago","veckor sedan").replace("a month ago","för en månad sedan").replace("months ago","månader sedan").replace("a year ago","för ett år sedan").replace("years ago","år sedan"),D=(B,N="sm")=>{const G=N==="sm"?"h-3 w-3":"h-4 w-4";return P.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(U=>P.jsx(ba,{className:`${G} ${U<=B?"fill-yellow-400 text-yellow-400":"text-muted-foreground/30"}`},U))})};return!s.length&&!t?P.jsxs("div",{className:"space-y-2",children:[P.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[P.jsx(_6,{className:"h-4 w-4"}),"Recensioner"]}),P.jsx("div",{className:"bg-muted/30 rounded-lg p-3 text-center",children:P.jsx("p",{className:"text-sm text-muted-foreground",children:"Inga recensioner tillgängliga"})})]}):P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[P.jsx(_6,{className:"h-4 w-4"}),"Recensioner"]}),s.length>0&&P.jsxs(an,{variant:"secondary",className:"text-xs",children:[v.length," av ",s.length]})]}),(t||I>0)&&P.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[D(I,"md"),P.jsx("span",{className:"font-semibold text-lg",children:I.toFixed(1)})]}),r&&P.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",r," recensioner)"]})]}),Object.keys(T).length>0&&P.jsx("div",{className:"space-y-1",children:[5,4,3,2,1].map(B=>{const N=T[B]||0,G=s.length>0?N/s.length*100:0;return P.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[P.jsx("span",{className:"w-3 text-muted-foreground",children:B}),P.jsx(ba,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),P.jsx("div",{className:"flex-1 bg-muted rounded-full h-1.5",children:P.jsx("div",{className:"bg-yellow-400 h-1.5 rounded-full transition-all duration-300",style:{width:`${G}%`}})}),P.jsx("span",{className:"w-6 text-muted-foreground",children:N})]},B)})})]}),s.length>0&&P.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[P.jsxs(Hr,{variant:h===null?"default":"outline",size:"sm",onClick:()=>p(null),className:"flex-shrink-0",children:[P.jsx(Gce,{className:"h-3 w-3 mr-1"}),"Alla"]}),[5,4,3,2,1].map(B=>{const N=T[B]||0;return N===0?null:P.jsxs(Hr,{variant:h===B?"default":"outline",size:"sm",onClick:()=>p(B),className:"flex-shrink-0",children:[B," ",P.jsx(ba,{className:"h-3 w-3 ml-1 fill-current"}),P.jsxs("span",{className:"ml-1 text-xs",children:["(",N,")"]})]},B)})]}),v.length>0&&P.jsxs("div",{className:"space-y-3",children:[P.jsx(Tc,{children:w.map((B,N)=>P.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:N*.1},className:"bg-muted/20 rounded-lg p-3 space-y-2",children:[P.jsxs("div",{className:"flex items-start justify-between",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[B.profile_photo_url&&P.jsx("img",{src:B.profile_photo_url,alt:B.author_name,className:"w-6 h-6 rounded-full",onError:G=>{G.currentTarget.style.display="none"}}),P.jsxs("div",{children:[P.jsx("p",{className:"font-medium text-sm",children:B.author_name}),P.jsx("p",{className:"text-xs text-muted-foreground",children:O(B.relative_time_description)})]})]}),D(B.rating)]}),P.jsx("p",{className:"text-sm leading-relaxed",children:B.text}),P.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[P.jsx(eue,{className:"h-3 w-3"}),P.jsx("span",{children:"Hjälpsam"})]})]},`${B.author_name}-${B.time}`))}),v.length>3&&P.jsxs(Hr,{variant:"outline",size:"sm",onClick:()=>c(!n),className:"w-full",children:[n?"Visa färre":`Visa alla ${v.length} recensioner`,P.jsx(jm,{className:"h-3 w-3 ml-1"})]})]}),v.length===0&&h!==null&&P.jsx("div",{className:"bg-muted/30 rounded-lg p-3 text-center",children:P.jsxs("p",{className:"text-sm text-muted-foreground",children:["Inga recensioner med ",h," stjärnor"]})})]})},qGe=()=>{const[e,t]=Z.useState({totalPreschools:0,enrichedPreschools:0,coveragePercentage:0,recentlyUpdated:0,needingUpdate:0}),[r,n]=Z.useState(!0),[c,h]=Z.useState(new Map),p=Z.useCallback(async I=>{if(c.has(I))return c.get(I)||null;try{const{data:O,error:D}=await gn.from("preschool_google_data").select("*").eq("preschool_id",I).maybeSingle();return D?(console.error("Error fetching Google data:",D),null):(O&&(c.set(I,O),h(new Map(c))),O)}catch(O){return console.error("Error in getGoogleData:",O),null}},[c]),s=Z.useCallback(async I=>{try{const O=I.filter(G=>!c.has(G));if(O.length===0)return;const{data:D,error:B}=await gn.from("preschool_google_data").select("*").in("preschool_id",O);if(B){console.error("Error preloading Google data:",B);return}const N=new Map(c);D?.forEach(G=>{N.set(G.preschool_id,G)}),h(N)}catch(O){console.error("Error in preloadGoogleData:",O)}},[c]),v=Z.useCallback(async()=>{n(!0);try{const{count:I}=await gn.from("Förskolor").select("*",{count:"exact",head:!0}).not("Latitud","is",null),{count:O}=await gn.from("preschool_google_data").select("*",{count:"exact",head:!0}),D=new Date;D.setDate(D.getDate()-7);const{count:B}=await gn.from("preschool_google_data").select("*",{count:"exact",head:!0}).gte("last_updated",D.toISOString()),N=new Date;N.setDate(N.getDate()-30);const{count:G}=await gn.from("preschool_google_data").select("*",{count:"exact",head:!0}).lt("last_updated",N.toISOString()),U=I||0,V=O||0,X=U>0?Math.round(V/U*100):0;t({totalPreschools:U,enrichedPreschools:V,coveragePercentage:X,recentlyUpdated:B||0,needingUpdate:(G||0)+(U-V)})}catch(I){console.error("Error refreshing stats:",I)}finally{n(!1)}},[]),w=Z.useCallback(async I=>{try{if(I&&I.length>0)for(const O of I.slice(0,10)){const{data:D}=await gn.from("Förskolor").select('id, "Namn", "Adress", "Latitud", "Longitud"').eq("id",O).single();D&&await gn.functions.invoke("google-places-enricher",{body:{preschoolId:D.id,lat:D.Latitud,lng:D.Longitud,address:D.Adress,name:D.Namn}})}else await gn.functions.invoke("google-places-enricher",{body:{batch:!0}});h(new Map),await v()}catch(O){console.error("Error triggering enrichment:",O)}},[v]),T=Z.useCallback(()=>{h(new Map)},[]);return Z.useEffect(()=>{v()},[v]),{stats:e,isLoading:r,getGoogleData:p,preloadGoogleData:s,refreshStats:v,triggerEnrichment:w,clearCache:T}},vre=({preschool:e,onBack:t,nationalAverage:r})=>{const[n,c]=Z.useState(null),{getGoogleData:h}=qGe();Z.useEffect(()=>{(async()=>{const T=await h(e.id);c(T)})()},[e.id,h]);const p=T=>{switch(T){case"Kommunal":return{label:"Kommunal förskola",color:"bg-blue-500/10 text-blue-700 border-blue-200",icon:P.jsx(am,{className:"h-3 w-3"})};case"Enskild":return{label:"Fristående förskola",color:"bg-green-500/10 text-green-700 border-green-200",icon:P.jsx(am,{className:"h-3 w-3"})};default:return{label:T,color:"bg-gray-500/10 text-gray-700 border-gray-200",icon:P.jsx(am,{className:"h-3 w-3"})}}},s=T=>T?T>=80?"Utmärkt":T>=65?"Bra":T>=50?"Medel":"Under medel":"Ingen data",v=T=>T?P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(I=>P.jsx(ba,{className:`h-4 w-4 ${I<=T?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},I))}),P.jsx("span",{className:"font-medium",children:T.toFixed(1)}),e.google_reviews_count&&P.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",e.google_reviews_count," recensioner)"]})]}):null,w=p(e.huvudman);return P.jsx(Fr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"absolute right-4 top-4 z-30 w-80 max-h-[calc(100vh-2rem)]",children:P.jsxs(kn,{className:"glass-card border-0 shadow-lg h-full flex flex-col",children:[P.jsx(r_,{className:"p-4 border-b border-border/20",children:P.jsxs("div",{className:"flex items-center gap-3",children:[P.jsx(Hr,{onClick:t,variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:P.jsx(Lce,{className:"h-4 w-4"})}),P.jsxs("div",{className:"flex-1 min-w-0",children:[P.jsx(n_,{className:"text-lg font-heading truncate",children:e.namn}),P.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[P.jsx(qa,{className:"h-3 w-3"}),P.jsx("span",{children:e.kommun})]})]})]})}),P.jsxs(Pl,{className:"p-4 flex-1 overflow-y-auto space-y-4",children:[P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs(an,{className:w.color,children:[w.icon,P.jsx("span",{className:"ml-1",children:w.label})]}),(n?.google_rating||e.google_rating)&&P.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[P.jsx(ba,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),P.jsx("span",{className:"font-medium",children:(n?.google_rating||e.google_rating)?.toFixed(1)})]})]}),e.adress&&P.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[P.jsx(qa,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),P.jsx("span",{children:e.adress})]})]}),P.jsx(Wp,{}),(n?.google_rating||e.google_rating)&&P.jsxs("div",{className:"space-y-2",children:[P.jsx("h4",{className:"font-medium text-sm",children:"Betyg"}),v(n?.google_rating||e.google_rating),r&&(n?.google_rating||e.google_rating)>r.avgRating&&P.jsxs("p",{className:"text-xs text-green-600",children:["Över riksgenomsnittet (",r.avgRating.toFixed(1),")"]})]}),e.antal_barn&&P.jsxs("div",{className:"space-y-2",children:[P.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[P.jsx(e9,{className:"h-4 w-4"}),"Barn och personal"]}),P.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Antal barn:"}),P.jsx("span",{className:"font-medium",children:e.antal_barn})]}),e.antal_barngrupper&&P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Barngrupper:"}),P.jsx("span",{className:"font-medium",children:e.antal_barngrupper})]}),e.personaltäthet&&P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{className:"text-muted-foreground",children:"Personaltäthet:"}),P.jsxs("span",{className:"font-medium",children:[e.personaltäthet.toFixed(1)," barn/tjänst"]})]})]})]}),e.andel_med_förskollärarexamen&&P.jsxs("div",{className:"space-y-2",children:[P.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[P.jsx(BL,{className:"h-4 w-4"}),"Kvalitet"]}),P.jsxs("div",{className:"space-y-2",children:[P.jsxs("div",{className:"flex justify-between text-sm",children:[P.jsx("span",{className:"text-muted-foreground",children:"Förskollärare:"}),P.jsxs("span",{className:"font-medium",children:[Math.round(e.andel_med_förskollärarexamen),"%"]})]}),P.jsx("div",{className:"flex-1 bg-muted rounded-full h-2",children:P.jsx("div",{className:"bg-gradient-primary h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,e.andel_med_förskollärarexamen)}%`}})}),P.jsxs("p",{className:"text-xs text-muted-foreground",children:["Kvalitetsnivå: ",s(e.andel_med_förskollärarexamen)]}),r&&e.andel_med_förskollärarexamen>r.avgTeacherExam&&P.jsxs("p",{className:"text-xs text-green-600",children:["Över riksgenomsnittet (",r.avgTeacherExam,"%)"]})]})]}),(n?.contact_phone||n?.website_url||e.contact_phone||e.website_url)&&P.jsxs(P.Fragment,{children:[P.jsx(Wp,{}),P.jsxs("div",{className:"space-y-2",children:[P.jsx("h4",{className:"font-medium text-sm",children:"Kontakt"}),P.jsxs("div",{className:"space-y-2",children:[(n?.contact_phone||e.contact_phone)&&P.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[P.jsx(Yce,{className:"h-4 w-4 text-muted-foreground"}),P.jsx("a",{href:`tel:${n?.contact_phone||e.contact_phone}`,className:"text-primary hover:underline",children:n?.contact_phone||e.contact_phone})]}),(n?.website_url||e.website_url)&&P.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[P.jsx(Zq,{className:"h-4 w-4 text-muted-foreground"}),P.jsx("a",{href:n?.website_url||e.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline truncate",children:"Webbsida"})]})]})]})]}),(n?.opening_hours||e.opening_hours)&&P.jsxs(P.Fragment,{children:[P.jsx(Wp,{}),P.jsxs("div",{className:"space-y-2",children:[P.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[P.jsx(VL,{className:"h-4 w-4"}),"Öppettider"]}),P.jsx("div",{className:"text-sm",children:typeof(n?.opening_hours||e.opening_hours)=="object"?P.jsx("div",{className:"space-y-1",children:Object.entries(n?.opening_hours||e.opening_hours).map(([T,I])=>P.jsxs("div",{className:"flex justify-between",children:[P.jsxs("span",{className:"text-muted-foreground capitalize",children:[T,":"]}),P.jsx("span",{children:I})]},T))}):P.jsx("p",{className:"text-muted-foreground",children:n?.opening_hours||e.opening_hours})})]})]}),P.jsx(Wp,{}),P.jsx(HGe,{preschoolId:e.id,preschoolName:e.namn,streetViewPanoId:n?.street_view_pano_id,lat:e.latitud,lng:e.longitud}),P.jsx(Wp,{}),P.jsx(WGe,{reviews:n?.reviews,rating:n?.google_rating||e.google_rating,reviewsCount:n?.google_reviews_count||e.google_reviews_count}),P.jsx(Wp,{}),P.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2",children:[P.jsx("h4",{className:"font-medium text-sm",children:"Sammanfattning"}),P.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[P.jsxs("div",{className:"flex flex-col",children:[P.jsx("span",{className:"text-muted-foreground",children:"Typ"}),P.jsx("span",{className:"font-medium",children:e.huvudman})]}),P.jsxs("div",{className:"flex flex-col",children:[P.jsx("span",{className:"text-muted-foreground",children:"Barn"}),P.jsx("span",{className:"font-medium",children:e.antal_barn||"Ej angivet"})]}),P.jsxs("div",{className:"flex flex-col",children:[P.jsx("span",{className:"text-muted-foreground",children:"Betyg"}),P.jsx("span",{className:"font-medium",children:n?.google_rating||e.google_rating?`${(n?.google_rating||e.google_rating).toFixed(1)} ⭐`:"Inget betyg"})]}),P.jsxs("div",{className:"flex flex-col",children:[P.jsx("span",{className:"text-muted-foreground",children:"Kvalitet"}),P.jsx("span",{className:"font-medium",children:e.andel_med_förskollärarexamen?s(e.andel_med_förskollärarexamen):"Ingen data"})]})]})]})]})]})})},ZGe=Object.freeze(Object.defineProperty({__proto__:null,PreschoolDetailsPanel:vre},Symbol.toStringTag,{value:"Module"})),xre=Z.memo(({preschool:e,index:t,onPreschoolClick:r,onFavorite:n,onCompare:c,onShowDetails:h,isFavorite:p,isInComparison:s,comparisonFull:v})=>{const w=Z.useCallback(I=>{if(!I)return null;const O=I>=4.5?"text-green-600":I>=4?"text-yellow-600":"text-orange-600";return P.jsxs("div",{className:`flex items-center gap-1 ${O}`,children:[P.jsx(ba,{className:"h-3 w-3 fill-current"}),P.jsx("span",{className:"text-xs font-medium",children:I.toFixed(1)})]})},[]),T=Z.useCallback(I=>I==="Kommunal"?"bg-blue-500/10 text-blue-700 border-blue-200":"bg-green-500/10 text-green-700 border-green-200",[]);return P.jsx(Fr.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:Math.min(t*.01,.2)},layout:!0,children:P.jsx(kn,{className:"hover-lift-subtle cursor-pointer border border-border/30 bg-background/50 relative transition-all duration-200",children:P.jsx(Pl,{className:"p-3",children:P.jsxs("div",{className:"space-y-2",children:[P.jsxs("div",{className:"flex items-start justify-between gap-2",children:[P.jsxs("div",{className:"flex-1 min-w-0",children:[P.jsx("h4",{className:"font-medium text-sm text-foreground truncate hover:text-primary cursor-pointer transition-colors duration-200",onClick:()=>r(e),title:e.namn,children:e.namn}),P.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[P.jsx(qa,{className:"h-3 w-3 text-muted-foreground"}),P.jsx("span",{className:"text-xs text-muted-foreground truncate",children:e.kommun})]})]}),w(e.google_rating)]}),P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(an,{variant:"outline",className:`text-xs px-1.5 py-0.5 ${T(e.huvudman)}`,children:e.huvudman==="Enskild"?"Fristående":e.huvudman}),e.antal_barn&&P.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[P.jsx(e9,{className:"h-3 w-3"}),P.jsx("span",{className:"text-xs",children:e.antal_barn})]})]}),P.jsxs("div",{className:"flex items-center gap-1",children:[P.jsx(Hr,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-primary/10 transition-colors duration-200",onClick:I=>n(e.id,I),children:P.jsx(Xq,{className:`h-3 w-3 transition-colors duration-200 ${p?"fill-red-500 text-red-500":""}`})}),P.jsx(Hr,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-primary/10 transition-colors duration-200",onClick:I=>c(e.id,I),disabled:v&&!s,children:P.jsx(Dce,{className:`h-3 w-3 transition-colors duration-200 ${s?"fill-blue-500 text-blue-500":""}`})}),P.jsx(Hr,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-primary/10 transition-colors duration-200",onClick:()=>h(e),children:P.jsx($L,{className:"h-3 w-3"})})]})]}),e.andel_med_förskollärarexamen&&P.jsxs("div",{className:"flex items-center gap-1",children:[P.jsx("div",{className:"flex-1 bg-muted rounded-full h-1.5",children:P.jsx("div",{className:"bg-gradient-primary h-1.5 rounded-full transition-all duration-500",style:{width:`${Math.min(100,e.andel_med_förskollärarexamen)}%`}})}),P.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(e.andel_med_förskollärarexamen),"% förskollärare"]})]})]})})})})});xre.displayName="PreschoolListItem";const bre=Z.memo(({items:e,onPreschoolClick:t,onFavorite:r,onCompare:n,onShowDetails:c,favorites:h,comparison:p})=>{const s=Z.useRef(null),[v,w]=Z.useState({start:0,end:20}),T=120,I=5;Z.useEffect(()=>{const N=s.current;if(!N)return;const G=()=>{const U=N.scrollTop,V=N.clientHeight,X=Math.max(0,Math.floor(U/T)-I),Y=Math.min(e.length,Math.ceil((U+V)/T)+I);w({start:X,end:Y})};return N.addEventListener("scroll",G,{passive:!0}),G(),()=>N.removeEventListener("scroll",G)},[e.length]);const O=e.slice(v.start,v.end),D=v.start*T,B=e.length*T;return P.jsx("div",{ref:s,className:"overflow-y-auto max-h-[calc(100vh-16rem)] relative",children:P.jsx("div",{style:{height:B,position:"relative"},children:P.jsx("div",{style:{transform:`translateY(${D}px)`},children:P.jsx("div",{className:"space-y-2 p-2",children:O.map((N,G)=>P.jsx(xre,{preschool:N,index:v.start+G,onPreschoolClick:t,onFavorite:r,onCompare:n,onShowDetails:c,isFavorite:h.has(N.id),isInComparison:p.has(N.id),comparisonFull:p.size>=3},N.id))})})})})});bre.displayName="VirtualizedList";const KGe=({className:e})=>{const{filteredPreschools:t,visiblePreschools:r,searchFilters:n,setSelectedPreschool:c,setMapCenter:h,setMapZoom:p,preschools:s,listContext:v,setListContext:w}=_s(),[T,I]=Z.useState(!1),[O,D]=Z.useState(null),[B,N]=Z.useState(""),[G,U]=Z.useState("rating"),[V,X]=Z.useState(new Set),[Y,ne]=Z.useState(new Set),[ae,le]=Z.useState(!0),ge=U3(B,300);Z.useEffect(()=>{console.log(`👁️ Viewport visibility changed - viewportOnly: ${ae}, visible count: ${r.length}`)},[ae,r.length]);const je=Z.useMemo(()=>(console.log(`📊 List data source update - viewportOnly: ${ae}, visible: ${r.length}, filtered: ${t.length}`),ae?r:t),[ae,r,t]),ze=Z.useMemo(()=>{const lt=performance.now();let rt=[...je].filter(vt=>vt.latitud&&vt.longitud);if(ge){const vt=ge.toLowerCase();rt=rt.filter(mt=>mt.namn.toLowerCase().includes(vt)||mt.kommun.toLowerCase().includes(vt)||mt.adress?.toLowerCase().includes(vt))}rt.sort((vt,mt)=>{switch(G){case"rating":return(mt.google_rating||0)-(vt.google_rating||0);case"name":return vt.namn.localeCompare(mt.namn);case"children":return(mt.antal_barn||0)-(vt.antal_barn||0);case"quality":return(mt.andel_med_förskollärarexamen||0)-(vt.andel_med_förskollärarexamen||0);default:return 0}});const ht=performance.now();return console.log(`🔄 List processed: ${rt.length} items (from ${je.length} source) - viewport: ${ae} - search: "${ge}" - sort: ${G}`),ht-lt>10&&console.log(`⚠️ List processing took ${ht-lt}ms for ${rt.length} items`),rt},[je,ge,G]),Pe=Z.useCallback(lt=>{lt.longitud&&lt.latitud&&(c(lt),h([lt.longitud,lt.latitud]),p(15))},[c,h,p]),Ke=Z.useCallback((lt,rt)=>{rt.stopPropagation(),X(ht=>{const vt=new Set(ht);return vt.has(lt)?vt.delete(lt):vt.add(lt),vt})},[]),Ye=Z.useCallback((lt,rt)=>{rt.stopPropagation(),ne(ht=>{const vt=new Set(ht);return vt.has(lt)?vt.delete(lt):vt.size<3&&vt.add(lt),vt})},[]),Oe=()=>ae?"Synliga på kartan":n.kommuner&&n.kommuner.length>0?`Förskolor i ${n.kommuner.join(", ")}`:n.nearbyMode?"Närliggande förskolor":n.query?`Sökresultat för "${n.query}"`:"Alla förskolor",tt=()=>{const lt=ze.length,rt=je.length,ht=t.length;return B?ae?`${lt} träffar på kartan (av ${rt} synliga)`:`${lt} sökträffar (av ${ht} filtrerade)`:ae?`${lt} synliga på kartan (av ${ht} totalt)`:`${lt} förskolor`},We=Z.useMemo(()=>{if(s.length===0)return;const lt=s.filter(mt=>mt.antal_barn).map(mt=>mt.antal_barn),rt=s.filter(mt=>mt.personaltäthet).map(mt=>mt.personaltäthet),ht=s.filter(mt=>mt.andel_med_förskollärarexamen).map(mt=>mt.andel_med_förskollärarexamen),vt=s.filter(mt=>mt.google_rating).map(mt=>mt.google_rating);return{avgChildren:lt.length>0?Math.round(lt.reduce((mt,ct)=>mt+ct,0)/lt.length):0,avgStaff:rt.length>0?rt.reduce((mt,ct)=>mt+ct,0)/rt.length:0,avgTeacherExam:ht.length>0?Math.round(ht.reduce((mt,ct)=>mt+ct,0)/ht.length):0,avgRating:vt.length>0?vt.reduce((mt,ct)=>mt+ct,0)/vt.length:0}},[s]);return O?P.jsx(vre,{preschool:O,onBack:()=>D(null),nationalAverage:We}):P.jsx(Fr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:`absolute right-4 top-4 z-30 w-80 max-h-[calc(100vh-2rem)] ${e}`,children:P.jsxs(kn,{className:"glass-card border-0 shadow-lg h-full flex flex-col",children:[P.jsxs("div",{className:"p-4 border-b border-border/20",children:[P.jsxs("div",{className:"flex items-center justify-between mb-3",children:[P.jsxs("div",{children:[P.jsx("h3",{className:"font-heading font-semibold text-sm text-foreground",children:Oe()}),P.jsx("p",{className:"text-xs text-muted-foreground",children:tt()})]}),P.jsx(Hr,{onClick:()=>I(!T),variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:T?P.jsx(Zw,{className:"h-3 w-3"}):P.jsx(HA,{className:"h-3 w-3"})})]}),!T&&P.jsxs("div",{className:"space-y-2",children:[P.jsx(hN,{placeholder:"Sök i listan...",value:B,onChange:lt=>N(lt.target.value),className:"h-8 text-xs"}),P.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[P.jsxs("select",{value:G,onChange:lt=>U(lt.target.value),className:"text-xs p-1 rounded border bg-background",children:[P.jsx("option",{value:"rating",children:"Betyg"}),P.jsx("option",{value:"name",children:"Namn"}),P.jsx("option",{value:"children",children:"Antal barn"}),P.jsx("option",{value:"quality",children:"Kvalitet"})]}),P.jsx(Hr,{size:"sm",variant:ae?"default":"outline",onClick:()=>le(!ae),className:"text-xs h-6 px-2",children:ae?"Endast karta":"Alla"}),Y.size>0&&P.jsxs(an,{variant:"secondary",className:"text-xs",children:["Jämför (",Y.size,")"]})]})]})]}),P.jsx(Tc,{children:!T&&P.jsx(Fr.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"flex-1 overflow-hidden",children:ze.length>0?P.jsx(bre,{items:ze,onPreschoolClick:Pe,onFavorite:Ke,onCompare:Ye,onShowDetails:D,favorites:V,comparison:Y}):P.jsx("div",{className:"text-center py-8",children:P.jsx("p",{className:"text-muted-foreground text-sm",children:B?"Inga förskolor matchar sökningen.":ae?"Inga förskolor synliga i kartvy.":"Inga förskolor hittades med de valda filtren."})})})})]})})},XGe=()=>{const{selectedPreschool:e}=_s();Z.useEffect(()=>{if(e){const r=`Förskola vald: ${e.namn} i ${e.kommun}`;t(r)}},[e]);const t=r=>{const n=document.createElement("div");n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","true"),n.className="sr-only",n.textContent=r,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},1e3)};return Z.useEffect(()=>{const r=document.createElement("div");r.className="skip-links",r.innerHTML=`
      <a href="#main-content" class="skip-link">Hoppa till huvudinnehåll</a>
      <a href="#search-filters" class="skip-link">Hoppa till sökfilter</a>
      <a href="#map" class="skip-link">Hoppa till karta</a>
    `;const n=document.createElement("style");return n.textContent=`
      .skip-links {
        position: fixed;
        top: -100px;
        left: 0;
        z-index: 9999;
      }
      
      .skip-link {
        position: absolute;
        left: -10000px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
        background: var(--primary);
        color: var(--primary-foreground);
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 4px;
        font-weight: 500;
      }
      
      .skip-link:focus {
        position: static;
        left: auto;
        width: auto;
        height: auto;
        overflow: visible;
        margin: 8px;
        outline: 2px solid var(--ring);
        outline-offset: 2px;
      }
      
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    `,document.head.appendChild(n),document.body.prepend(r),()=>{document.body.contains(r)&&document.body.removeChild(r),document.head.contains(n)&&document.head.removeChild(n)}},[]),Z.useEffect(()=>{const r=n=>{if(n.key==="Escape"){const c=new CustomEvent("closeAllPanels");document.dispatchEvent(c)}if(n.key==="f"&&n.ctrlKey){n.preventDefault();const c=document.querySelector('input[placeholder*="kommun"]');c&&c.focus()}};return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[]),null},YGe=({className:e})=>{const{searchFilters:t,clearSpecificFilter:r,clearFilters:n}=_s(),c=()=>{const s=[];return t.kommuner&&t.kommuner.length>0&&t.kommuner.forEach(v=>{s.push({key:`kommun-${v}`,label:v,value:v})}),t.huvudman&&t.huvudman!=="alla"&&s.push({key:"huvudman",label:t.huvudman==="Enskild"?"Fristående":t.huvudman,value:t.huvudman}),t.query&&s.push({key:"query",label:`Sökning: "${t.query}"`,value:t.query}),t.nearbyMode&&s.push({key:"nearby",label:`Närområde (${t.radius?Math.round(t.radius/1e3):2} km)`,value:"nearby"}),t.maxChildren&&t.maxChildren<200&&s.push({key:"maxChildren",label:`Max ${t.maxChildren} barn`,value:t.maxChildren}),t.minPersonaltäthet&&s.push({key:"minPersonaltäthet",label:`Personal ≥ ${t.minPersonaltäthet}`,value:t.minPersonaltäthet}),t.minExamen&&s.push({key:"minExamen",label:`Examen ≥ ${t.minExamen}%`,value:t.minExamen}),s},h=(s,v)=>{if(s.startsWith("kommun-")){const w=v,T=t.kommuner?.filter(I=>I!==w);T&&T.length>0?(r("kommuner"),setTimeout(()=>{_s.getState().setSearchFilters({kommuner:T})},0)):r("kommuner")}else r(s==="nearby"?"nearbyMode":s)},p=c();return p.length===0?null:P.jsxs("div",{className:`flex flex-wrap items-center gap-1 ${e}`,children:[p.map(s=>P.jsxs(an,{variant:"secondary",className:"flex items-center gap-1 pr-1 pl-2 py-1",children:[P.jsx("span",{className:"text-xs",children:s.label}),P.jsx(Hr,{size:"sm",variant:"ghost",onClick:()=>h(s.key,s.value),className:"h-3 w-3 p-0 hover:bg-destructive/20 ml-1",title:`Ta bort filter: ${s.label}`,children:P.jsx(Qo,{className:"h-2 w-2"})})]},s.key)),p.length>1&&P.jsx(Hr,{size:"sm",variant:"ghost",onClick:n,className:"h-6 px-2 text-xs text-muted-foreground hover:text-destructive ml-1",children:"Rensa alla"})]})},JH=["Ale","Alingsås","Alvesta","Aneby","Arboga","Arjeplog","Arvidsjaur","Arvika","Askersund","Avesta","Bengtsfors","Berg","Bjurholm","Bjuv","Boden","Bollebygd","Bollnäs","Borgholm","Borlänge","Borås","Botkyrka","Boxholm","Bromölla","Bräcke","Burlöv","Båstad","Dals-Ed","Danderyd","Degerfors","Dorotea","Eda","Ekerö","Eksjö","Emmaboda","Enköping","Eskilstuna","Eslöv","Essunga","Fagersta","Falkenberg","Falköping","Falun","Filipstad","Finspång","Flen","Forshaga","Färgelanda","Gagnef","Gislaved","Gnesta","Gnosjö","Gotland","Grums","Grästorp","Gullspång","Gällivare","Gävle","Göteborg","Götene","Habo","Hagfors","Hallsberg","Hallstahammar","Halmstad","Hammarö","Haninge","Haparanda","Heby","Hedemora","Helsingborg","Herrljunga","Hjo","Hofors","Huddinge","Hudiksvall","Hultsfred","Hylte","Håbo","Hällefors","Härjedalen","Härnösand","Härryda","Hässleholm","Höganäs","Högsby","Hörby","Höör","Jokkmokk","Järfälla","Jönköping","Kalix","Kalmar","Karlsborg","Karlshamn","Karlskoga","Karlskrona","Karlstad","Katrineholm","Kil","Kinda","Kiruna","Klippan","Knivsta","Kramfors","Kristianstad","Kristinehamn","Krokom","Kumla","Kungsbacka","Kungsör","Kungälv","Kävlinge","Köping","Laholm","Landskrona","Laxå","Lekeberg","Leksand","Lerum","Lessebo","Lidingö","Lidköping","Lilla Edet","Lindesberg","Linköping","Ljungby","Ljusdal","Ljusnarsberg","Lomma","Ludvika","Luleå","Lund","Lycksele","Lysekil","Malmö","Malung-Sälen","Malå","Mariefred","Markaryd","Mariestad","Mark","Mellerud","Mjölby","Mora","Motala","Mullsjö","Munkedal","Munkfors","Mölndal","Mönsterås","Mörbylånga","Nacka","Nora","Norberg","Nordanstig","Nordmaling","Norrköping","Norrtälje","Norsjö","Nybro","Nykvarn","Nyköping","Nynäshamn","Nässjö","Ockelbo","Olofström","Orsa","Orust","Osby","Oskarshamn","Ovanåker","Oxelösund","Pajala","Partille","Perstorp","Piteå","Ragunda","Robertsfors","Ronneby","Rättvik","Sala","Salem","Sandviken","Sigtuna","Simrishamn","Sjöbo","Skara","Skellefteå","Skinnskatteberg","Skurup","Skövde","Smedjebacken","Sollefteå","Sollentuna","Solna","Sorsele","Sotenäs","Staffanstorp","Stenungsund","Stockholm","Storfors","Storuman","Strängnäs","Strömstad","Strömsund","Sundbyberg","Sundsvall","Sunne","Surahammar","Svalöv","Svedala","Svenljunga","Säffle","Säter","Sävsjö","Söderhamn","Söderköping","Södertälje","Sölvesborg","Tanum","Tibro","Tidaholm","Tierp","Timrå","Tingsryd","Tjörn","Tomelilla","Torsby","Torsås","Tranemo","Tranås","Trelleborg","Trollhättan","Trosa","Tyresö","Täby","Töreboda","Uddevalla","Ulricehamn","Umeå","Upplands Väsby","Upplands-Bro","Uppsala","Uppvidinge","Vadstena","Vaggeryd","Valdemarsvik","Vallentuna","Vansbro","Vara","Varberg","Vaxholm","Vellinge","Vetlanda","Vilhelmina","Vimmerby","Vindeln","Vingåker","Vårgårda","Vänersborg","Vännäs","Värmdö","Värnamo","Västervik","Västerås","Växjö","Ydre","Ystad","Åmål","Ånge","Åre","Årjäng","Åsele","Åstorp","Åtvidaberg","Älmhult","Älvdalen","Älvkarleby","Älvsbyn","Ängelholm","Öckerö","Ödeshög","Örebro","Örkelljunga","Örnsköldsvik","Östersund","Österåker","Östhammar","Östra Göinge","Överkalix","Övertorneå"].sort();function zh(e){return Array.isArray?Array.isArray(e):Tre(e)==="[object Array]"}function JGe(e){if(typeof e=="string")return e;let t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function QGe(e){return e==null?"":JGe(e)}function gu(e){return typeof e=="string"}function wre(e){return typeof e=="number"}function eHe(e){return e===!0||e===!1||tHe(e)&&Tre(e)=="[object Boolean]"}function Sre(e){return typeof e=="object"}function tHe(e){return Sre(e)&&e!==null}function ll(e){return e!=null}function rO(e){return!e.trim().length}function Tre(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const rHe="Incorrect 'index' type",nHe=e=>`Invalid value for key ${e}`,iHe=e=>`Pattern length exceeds max of ${e}.`,sHe=e=>`Missing ${e} property in key`,oHe=e=>`Property 'weight' in key '${e}' must be a positive integer`,QH=Object.prototype.hasOwnProperty;class aHe{constructor(t){this._keys=[],this._keyMap={};let r=0;t.forEach(n=>{let c=Ere(n);this._keys.push(c),this._keyMap[c.id]=c,r+=c.weight}),this._keys.forEach(n=>{n.weight/=r})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ere(e){let t=null,r=null,n=null,c=1,h=null;if(gu(e)||zh(e))n=e,t=e7(e),r=jD(e);else{if(!QH.call(e,"name"))throw new Error(sHe("name"));const p=e.name;if(n=p,QH.call(e,"weight")&&(c=e.weight,c<=0))throw new Error(oHe(p));t=e7(p),r=jD(p),h=e.getFn}return{path:t,id:r,weight:c,src:n,getFn:h}}function e7(e){return zh(e)?e:e.split(".")}function jD(e){return zh(e)?e.join("."):e}function lHe(e,t){let r=[],n=!1;const c=(h,p,s)=>{if(ll(h))if(!p[s])r.push(h);else{let v=p[s];const w=h[v];if(!ll(w))return;if(s===p.length-1&&(gu(w)||wre(w)||eHe(w)))r.push(QGe(w));else if(zh(w)){n=!0;for(let T=0,I=w.length;T<I;T+=1)c(w[T],p,s+1)}else p.length&&c(w,p,s+1)}};return c(e,gu(t)?t.split("."):t,0),n?r:r[0]}const cHe={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},uHe={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},hHe={location:0,threshold:.6,distance:100},dHe={useExtendedSearch:!1,getFn:lHe,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var wn={...uHe,...cHe,...hHe,...dHe};const fHe=/[^ ]+/g;function pHe(e=1,t=3){const r=new Map,n=Math.pow(10,t);return{get(c){const h=c.match(fHe).length;if(r.has(h))return r.get(h);const p=1/Math.pow(h,.5*e),s=parseFloat(Math.round(p*n)/n);return r.set(h,s),s},clear(){r.clear()}}}class dN{constructor({getFn:t=wn.getFn,fieldNormWeight:r=wn.fieldNormWeight}={}){this.norm=pHe(r,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((r,n)=>{this._keysMap[r.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,gu(this.docs[0])?this.docs.forEach((t,r)=>{this._addString(t,r)}):this.docs.forEach((t,r)=>{this._addObject(t,r)}),this.norm.clear())}add(t){const r=this.size();gu(t)?this._addString(t,r):this._addObject(t,r)}removeAt(t){this.records.splice(t,1);for(let r=t,n=this.size();r<n;r+=1)this.records[r].i-=1}getValueForItemAtKeyId(t,r){return t[this._keysMap[r]]}size(){return this.records.length}_addString(t,r){if(!ll(t)||rO(t))return;let n={v:t,i:r,n:this.norm.get(t)};this.records.push(n)}_addObject(t,r){let n={i:r,$:{}};this.keys.forEach((c,h)=>{let p=c.getFn?c.getFn(t):this.getFn(t,c.path);if(ll(p)){if(zh(p)){let s=[];const v=[{nestedArrIndex:-1,value:p}];for(;v.length;){const{nestedArrIndex:w,value:T}=v.pop();if(ll(T))if(gu(T)&&!rO(T)){let I={v:T,i:w,n:this.norm.get(T)};s.push(I)}else zh(T)&&T.forEach((I,O)=>{v.push({nestedArrIndex:O,value:I})})}n.$[h]=s}else if(gu(p)&&!rO(p)){let s={v:p,n:this.norm.get(p)};n.$[h]=s}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function Are(e,t,{getFn:r=wn.getFn,fieldNormWeight:n=wn.fieldNormWeight}={}){const c=new dN({getFn:r,fieldNormWeight:n});return c.setKeys(e.map(Ere)),c.setSources(t),c.create(),c}function mHe(e,{getFn:t=wn.getFn,fieldNormWeight:r=wn.fieldNormWeight}={}){const{keys:n,records:c}=e,h=new dN({getFn:t,fieldNormWeight:r});return h.setKeys(n),h.setIndexRecords(c),h}function c2(e,{errors:t=0,currentLocation:r=0,expectedLocation:n=0,distance:c=wn.distance,ignoreLocation:h=wn.ignoreLocation}={}){const p=t/e.length;if(h)return p;const s=Math.abs(n-r);return c?p+s/c:s?1:p}function gHe(e=[],t=wn.minMatchCharLength){let r=[],n=-1,c=-1,h=0;for(let p=e.length;h<p;h+=1){let s=e[h];s&&n===-1?n=h:!s&&n!==-1&&(c=h-1,c-n+1>=t&&r.push([n,c]),n=-1)}return e[h-1]&&h-n>=t&&r.push([n,h-1]),r}const Kp=32;function yHe(e,t,r,{location:n=wn.location,distance:c=wn.distance,threshold:h=wn.threshold,findAllMatches:p=wn.findAllMatches,minMatchCharLength:s=wn.minMatchCharLength,includeMatches:v=wn.includeMatches,ignoreLocation:w=wn.ignoreLocation}={}){if(t.length>Kp)throw new Error(iHe(Kp));const T=t.length,I=e.length,O=Math.max(0,Math.min(n,I));let D=h,B=O;const N=s>1||v,G=N?Array(I):[];let U;for(;(U=e.indexOf(t,B))>-1;){let le=c2(t,{currentLocation:U,expectedLocation:O,distance:c,ignoreLocation:w});if(D=Math.min(le,D),B=U+T,N){let ge=0;for(;ge<T;)G[U+ge]=1,ge+=1}}B=-1;let V=[],X=1,Y=T+I;const ne=1<<T-1;for(let le=0;le<T;le+=1){let ge=0,je=Y;for(;ge<je;)c2(t,{errors:le,currentLocation:O+je,expectedLocation:O,distance:c,ignoreLocation:w})<=D?ge=je:Y=je,je=Math.floor((Y-ge)/2+ge);Y=je;let ze=Math.max(1,O-je+1),Pe=p?I:Math.min(O+je,I)+T,Ke=Array(Pe+2);Ke[Pe+1]=(1<<le)-1;for(let Ye=Pe;Ye>=ze;Ye-=1){let Oe=Ye-1,tt=r[e.charAt(Oe)];if(N&&(G[Oe]=+!!tt),Ke[Ye]=(Ke[Ye+1]<<1|1)&tt,le&&(Ke[Ye]|=(V[Ye+1]|V[Ye])<<1|1|V[Ye+1]),Ke[Ye]&ne&&(X=c2(t,{errors:le,currentLocation:Oe,expectedLocation:O,distance:c,ignoreLocation:w}),X<=D)){if(D=X,B=Oe,B<=O)break;ze=Math.max(1,2*O-B)}}if(c2(t,{errors:le+1,currentLocation:O,expectedLocation:O,distance:c,ignoreLocation:w})>D)break;V=Ke}const ae={isMatch:B>=0,score:Math.max(.001,X)};if(N){const le=gHe(G,s);le.length?v&&(ae.indices=le):ae.isMatch=!1}return ae}function _He(e){let t={};for(let r=0,n=e.length;r<n;r+=1){const c=e.charAt(r);t[c]=(t[c]||0)|1<<n-r-1}return t}const TA=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class kre{constructor(t,{location:r=wn.location,threshold:n=wn.threshold,distance:c=wn.distance,includeMatches:h=wn.includeMatches,findAllMatches:p=wn.findAllMatches,minMatchCharLength:s=wn.minMatchCharLength,isCaseSensitive:v=wn.isCaseSensitive,ignoreDiacritics:w=wn.ignoreDiacritics,ignoreLocation:T=wn.ignoreLocation}={}){if(this.options={location:r,threshold:n,distance:c,includeMatches:h,findAllMatches:p,minMatchCharLength:s,isCaseSensitive:v,ignoreDiacritics:w,ignoreLocation:T},t=v?t:t.toLowerCase(),t=w?TA(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;const I=(D,B)=>{this.chunks.push({pattern:D,alphabet:_He(D),startIndex:B})},O=this.pattern.length;if(O>Kp){let D=0;const B=O%Kp,N=O-B;for(;D<N;)I(this.pattern.substr(D,Kp),D),D+=Kp;if(B){const G=O-Kp;I(this.pattern.substr(G),G)}}else I(this.pattern,0)}searchIn(t){const{isCaseSensitive:r,ignoreDiacritics:n,includeMatches:c}=this.options;if(t=r?t:t.toLowerCase(),t=n?TA(t):t,this.pattern===t){let N={isMatch:!0,score:0};return c&&(N.indices=[[0,t.length-1]]),N}const{location:h,distance:p,threshold:s,findAllMatches:v,minMatchCharLength:w,ignoreLocation:T}=this.options;let I=[],O=0,D=!1;this.chunks.forEach(({pattern:N,alphabet:G,startIndex:U})=>{const{isMatch:V,score:X,indices:Y}=yHe(t,N,G,{location:h+U,distance:p,threshold:s,findAllMatches:v,minMatchCharLength:w,includeMatches:c,ignoreLocation:T});V&&(D=!0),O+=X,V&&Y&&(I=[...I,...Y])});let B={isMatch:D,score:D?O/this.chunks.length:1};return D&&c&&(B.indices=I),B}}class If{constructor(t){this.pattern=t}static isMultiMatch(t){return t7(t,this.multiRegex)}static isSingleMatch(t){return t7(t,this.singleRegex)}search(){}}function t7(e,t){const r=e.match(t);return r?r[1]:null}class vHe extends If{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const r=t===this.pattern;return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class xHe extends If{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const r=t.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class bHe extends If{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const r=t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class wHe extends If{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const r=!t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class SHe extends If{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const r=t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class THe extends If{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const r=!t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class Pre extends If{constructor(t,{location:r=wn.location,threshold:n=wn.threshold,distance:c=wn.distance,includeMatches:h=wn.includeMatches,findAllMatches:p=wn.findAllMatches,minMatchCharLength:s=wn.minMatchCharLength,isCaseSensitive:v=wn.isCaseSensitive,ignoreDiacritics:w=wn.ignoreDiacritics,ignoreLocation:T=wn.ignoreLocation}={}){super(t),this._bitapSearch=new kre(t,{location:r,threshold:n,distance:c,includeMatches:h,findAllMatches:p,minMatchCharLength:s,isCaseSensitive:v,ignoreDiacritics:w,ignoreLocation:T})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class Cre extends If{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let r=0,n;const c=[],h=this.pattern.length;for(;(n=t.indexOf(this.pattern,r))>-1;)r=n+h,c.push([n,r-1]);const p=!!c.length;return{isMatch:p,score:p?0:1,indices:c}}}const RD=[vHe,Cre,bHe,wHe,THe,SHe,xHe,Pre],r7=RD.length,EHe=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,AHe="|";function kHe(e,t={}){return e.split(AHe).map(r=>{let n=r.trim().split(EHe).filter(h=>h&&!!h.trim()),c=[];for(let h=0,p=n.length;h<p;h+=1){const s=n[h];let v=!1,w=-1;for(;!v&&++w<r7;){const T=RD[w];let I=T.isMultiMatch(s);I&&(c.push(new T(I,t)),v=!0)}if(!v)for(w=-1;++w<r7;){const T=RD[w];let I=T.isSingleMatch(s);if(I){c.push(new T(I,t));break}}}return c})}const PHe=new Set([Pre.type,Cre.type]);class CHe{constructor(t,{isCaseSensitive:r=wn.isCaseSensitive,ignoreDiacritics:n=wn.ignoreDiacritics,includeMatches:c=wn.includeMatches,minMatchCharLength:h=wn.minMatchCharLength,ignoreLocation:p=wn.ignoreLocation,findAllMatches:s=wn.findAllMatches,location:v=wn.location,threshold:w=wn.threshold,distance:T=wn.distance}={}){this.query=null,this.options={isCaseSensitive:r,ignoreDiacritics:n,includeMatches:c,minMatchCharLength:h,findAllMatches:s,ignoreLocation:p,location:v,threshold:w,distance:T},t=r?t:t.toLowerCase(),t=n?TA(t):t,this.pattern=t,this.query=kHe(this.pattern,this.options)}static condition(t,r){return r.useExtendedSearch}searchIn(t){const r=this.query;if(!r)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:c,ignoreDiacritics:h}=this.options;t=c?t:t.toLowerCase(),t=h?TA(t):t;let p=0,s=[],v=0;for(let w=0,T=r.length;w<T;w+=1){const I=r[w];s.length=0,p=0;for(let O=0,D=I.length;O<D;O+=1){const B=I[O],{isMatch:N,indices:G,score:U}=B.search(t);if(N){if(p+=1,v+=U,n){const V=B.constructor.type;PHe.has(V)?s=[...s,...G]:s.push(G)}}else{v=0,p=0,s.length=0;break}}if(p){let O={isMatch:!0,score:v/p};return n&&(O.indices=s),O}}return{isMatch:!1,score:1}}}const DD=[];function IHe(...e){DD.push(...e)}function LD(e,t){for(let r=0,n=DD.length;r<n;r+=1){let c=DD[r];if(c.condition(e,t))return new c(e,t)}return new kre(e,t)}const EA={AND:"$and",OR:"$or"},zD={PATH:"$path",PATTERN:"$val"},ND=e=>!!(e[EA.AND]||e[EA.OR]),MHe=e=>!!e[zD.PATH],OHe=e=>!zh(e)&&Sre(e)&&!ND(e),n7=e=>({[EA.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function Ire(e,t,{auto:r=!0}={}){const n=c=>{let h=Object.keys(c);const p=MHe(c);if(!p&&h.length>1&&!ND(c))return n(n7(c));if(OHe(c)){const v=p?c[zD.PATH]:h[0],w=p?c[zD.PATTERN]:c[v];if(!gu(w))throw new Error(nHe(v));const T={keyId:jD(v),pattern:w};return r&&(T.searcher=LD(w,t)),T}let s={children:[],operator:h[0]};return h.forEach(v=>{const w=c[v];zh(w)&&w.forEach(T=>{s.children.push(n(T))})}),s};return ND(e)||(e=n7(e)),n(e)}function jHe(e,{ignoreFieldNorm:t=wn.ignoreFieldNorm}){e.forEach(r=>{let n=1;r.matches.forEach(({key:c,norm:h,score:p})=>{const s=c?c.weight:null;n*=Math.pow(p===0&&s?Number.EPSILON:p,(s||1)*(t?1:h))}),r.score=n})}function RHe(e,t){const r=e.matches;t.matches=[],ll(r)&&r.forEach(n=>{if(!ll(n.indices)||!n.indices.length)return;const{indices:c,value:h}=n;let p={indices:c,value:h};n.key&&(p.key=n.key.src),n.idx>-1&&(p.refIndex=n.idx),t.matches.push(p)})}function DHe(e,t){t.score=e.score}function LHe(e,t,{includeMatches:r=wn.includeMatches,includeScore:n=wn.includeScore}={}){const c=[];return r&&c.push(RHe),n&&c.push(DHe),e.map(h=>{const{idx:p}=h,s={item:t[p],refIndex:p};return c.length&&c.forEach(v=>{v(h,s)}),s})}class Cm{constructor(t,r={},n){this.options={...wn,...r},this.options.useExtendedSearch,this._keyStore=new aHe(this.options.keys),this.setCollection(t,n)}setCollection(t,r){if(this._docs=t,r&&!(r instanceof dN))throw new Error(rHe);this._myIndex=r||Are(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){ll(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const r=[];for(let n=0,c=this._docs.length;n<c;n+=1){const h=this._docs[n];t(h,n)&&(this.removeAt(n),n-=1,c-=1,r.push(h))}return r}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:r=-1}={}){const{includeMatches:n,includeScore:c,shouldSort:h,sortFn:p,ignoreFieldNorm:s}=this.options;let v=gu(t)?gu(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return jHe(v,{ignoreFieldNorm:s}),h&&v.sort(p),wre(r)&&r>-1&&(v=v.slice(0,r)),LHe(v,this._docs,{includeMatches:n,includeScore:c})}_searchStringList(t){const r=LD(t,this.options),{records:n}=this._myIndex,c=[];return n.forEach(({v:h,i:p,n:s})=>{if(!ll(h))return;const{isMatch:v,score:w,indices:T}=r.searchIn(h);v&&c.push({item:h,idx:p,matches:[{score:w,value:h,norm:s,indices:T}]})}),c}_searchLogical(t){const r=Ire(t,this.options),n=(s,v,w)=>{if(!s.children){const{keyId:I,searcher:O}=s,D=this._findMatches({key:this._keyStore.get(I),value:this._myIndex.getValueForItemAtKeyId(v,I),searcher:O});return D&&D.length?[{idx:w,item:v,matches:D}]:[]}const T=[];for(let I=0,O=s.children.length;I<O;I+=1){const D=s.children[I],B=n(D,v,w);if(B.length)T.push(...B);else if(s.operator===EA.AND)return[]}return T},c=this._myIndex.records,h={},p=[];return c.forEach(({$:s,i:v})=>{if(ll(s)){let w=n(r,s,v);w.length&&(h[v]||(h[v]={idx:v,item:s,matches:[]},p.push(h[v])),w.forEach(({matches:T})=>{h[v].matches.push(...T)}))}}),p}_searchObjectList(t){const r=LD(t,this.options),{keys:n,records:c}=this._myIndex,h=[];return c.forEach(({$:p,i:s})=>{if(!ll(p))return;let v=[];n.forEach((w,T)=>{v.push(...this._findMatches({key:w,value:p[T],searcher:r}))}),v.length&&h.push({idx:s,item:p,matches:v})}),h}_findMatches({key:t,value:r,searcher:n}){if(!ll(r))return[];let c=[];if(zh(r))r.forEach(({v:h,i:p,n:s})=>{if(!ll(h))return;const{isMatch:v,score:w,indices:T}=n.searchIn(h);v&&c.push({score:w,key:t,value:h,idx:p,norm:s,indices:T})});else{const{v:h,n:p}=r,{isMatch:s,score:v,indices:w}=n.searchIn(h);s&&c.push({score:v,key:t,value:h,norm:p,indices:w})}return c}}Cm.version="7.1.0";Cm.createIndex=Are;Cm.parseIndex=mHe;Cm.config=wn;Cm.parseQuery=Ire;IHe(CHe);const zHe=({className:e})=>{const{preschools:t,searchFilters:r,setSearchFilters:n,clearFilters:c,setMapCenter:h,setMapZoom:p,filteredPreschools:s}=_s(),[v,w]=Z.useState(""),[T,I]=Z.useState(!1),[O,D]=Z.useState(!1),[B,N]=Z.useState(!1),[G,U]=Z.useState([]),[V,X]=Z.useState([]),[Y,ne]=Z.useState(-1),[ae,le]=Z.useState(!1),[ge,je]=Z.useState(null),ze=Z.useRef(null),Pe=Z.useRef(null);U3(v,200),Z.useEffect(()=>{const ct=localStorage.getItem("preschool-recent-searches");if(ct)try{X(JSON.parse(ct))}catch(Ut){console.error("Error loading recent searches:",Ut)}},[]);const Ke=Z.useMemo(()=>new Cm(t,{keys:["namn","adress"],threshold:.3,includeScore:!0}),[t]),Ye=Z.useMemo(()=>new Cm(JH.map(ct=>({name:ct})),{keys:["name"],threshold:.3,includeScore:!0}),[]),Oe=Z.useCallback(ct=>{if(!ct||ct.length<2){U(V.slice(0,5)),N(V.length>0);return}const Ut=[],xr=Ke.search(ct).slice(0,8).map(Ft=>({id:`preschool-${Ft.item.id}`,type:"preschool",title:Ft.item.namn,subtitle:`${Ft.item.kommun} • ${Ft.item.huvudman||"Okänd huvudman"}`,coordinates:Ft.item.longitud&&Ft.item.latitud?[Ft.item.longitud,Ft.item.latitud]:void 0,preschoolId:Ft.item.id}));Ut.push(...xr);const tn=Ye.search(ct).slice(0,5).map(Ft=>{const br=Ft.item.name,Yt=t.filter(Qt=>Qt.kommun===br).length;return{id:`kommun-${br}`,type:"kommun",title:br,subtitle:`${Yt} förskolor`,count:Yt,coordinates:NHe(br)}});if(Ut.push(...tn),ct.length>3){const Ft=t.filter(br=>br.adress&&br.adress.toLowerCase().includes(ct.toLowerCase())&&br.latitud&&br.longitud).slice(0,3).map(br=>({id:`address-${br.id}`,type:"area",title:br.adress,subtitle:`${br.kommun} • ${br.namn}`,coordinates:[br.longitud,br.latitud],preschoolId:br.id}));Ut.push(...Ft)}const Er=Ut.slice(0,ae?Ut.length:10);U(Er),N(Er.length>0)},[Ke,Ye,t,V,ae]);Z.useEffect(()=>{Oe(v),v.trim()&&n({query:v})},[v,Oe,n]);const tt=Z.useCallback(ct=>{w(ct.title),N(!1),ne(-1);const Ut=[ct,...V.filter(xr=>xr.id!==ct.id)].slice(0,10);if(X(Ut),localStorage.setItem("preschool-recent-searches",JSON.stringify(Ut)),ct.type==="kommun"){const xr=r.kommuner||[];xr.includes(ct.title)||n({kommuner:[...xr,ct.title]})}else ct.type==="preschool"&&ct.preschoolId?(n({query:ct.title}),ct.coordinates&&(h(ct.coordinates),p(15))):ct.type==="area"&&(n({query:ct.title}),ct.coordinates&&(h(ct.coordinates),p(13)));window.innerWidth<768&&I(!1),ze.current?.blur()},[V,r.kommuner,n,h,p]),We=Z.useCallback(ct=>{if(!(!B||G.length===0))switch(ct.key){case"ArrowDown":ct.preventDefault(),ne(Ut=>Math.min(Ut+1,G.length-1));break;case"ArrowUp":ct.preventDefault(),ne(Ut=>Math.max(Ut-1,-1));break;case"Enter":ct.preventDefault(),Y>=0&&G[Y]&&tt(G[Y]);break;case"Escape":N(!1),ne(-1);break}},[B,G,Y,tt]),lt=Z.useCallback(()=>{D(!0),navigator.geolocation.getCurrentPosition(ct=>{const{latitude:Ut,longitude:xr}=ct.coords,tn=[xr,Ut];je({lat:Ut,lng:xr}),h(tn),p(12),n({radius:2e3,center:tn,nearbyMode:!0}),D(!1)},ct=>{console.error("Error getting location:",ct),D(!1),alert("Kunde inte hämta din position. Kontrollera att du tillåter platsåtkomst.")})},[h,p,n]),rt=Z.useCallback(()=>{w(""),N(!1),U([]),c(),je(null),ne(-1),le(!1)},[c]),ht=Z.useMemo(()=>Object.keys(r).some(ct=>{const Ut=r[ct];return Ut!=null&&(Array.isArray(Ut)||typeof Ut=="string"?Ut.length>0:typeof Ut=="boolean"?Ut:!0)}),[r]),vt=Z.useMemo(()=>Object.keys(r).filter(ct=>{const Ut=r[ct];return Array.isArray(Ut)?Ut.length>0:typeof Ut=="string"?Ut.trim().length>0:typeof Ut=="boolean"?Ut:typeof Ut=="number"||typeof Ut=="object"&&Ut!==null}).length,[r]);Z.useEffect(()=>{const ct=Ut=>{Pe.current&&!Pe.current.contains(Ut.target)&&ze.current&&!ze.current.contains(Ut.target)&&(N(!1),ne(-1))};return document.addEventListener("mousedown",ct),()=>document.removeEventListener("mousedown",ct)},[]);const mt=ct=>{switch(ct){case"preschool":return P.jsx(am,{className:"w-4 h-4 text-blue-500"});case"kommun":return P.jsx(qa,{className:"w-4 h-4 text-green-500"});case"area":return P.jsx(qa,{className:"w-4 h-4 text-orange-500"});case"recent":return P.jsx(VL,{className:"w-4 h-4 text-gray-500"});default:return P.jsx(tb,{className:"w-4 h-4 text-gray-500"})}};return T?P.jsx(Fr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`absolute left-4 top-4 z-30 w-96 ${e}`,layout:!0,transition:{layout:{duration:.3,ease:"easeInOut"}},children:P.jsx(kn,{className:"glass-search border-0 shadow-xl backdrop-blur-lg bg-white/85 border-white/40",children:P.jsxs("div",{className:"p-5",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx(tb,{className:"h-5 w-5 text-primary"}),P.jsx("h3",{className:"font-heading font-semibold text-base",children:"Sök förskolor"}),ht&&P.jsx(an,{variant:"secondary",className:"h-5",children:vt})]}),P.jsx(Hr,{onClick:()=>I(!1),variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:P.jsx(HA,{className:"h-3 w-3"})})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"relative",children:[P.jsx(tb,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),P.jsx(hN,{ref:ze,type:"text",placeholder:"Sök förskola, kommun eller adress...",value:v,onChange:ct=>w(ct.target.value),onFocus:()=>{N(!0),Oe(v)},onKeyDown:We,className:"pl-10 pr-10 border-0 focus:ring-2 focus:ring-primary/20 bg-white/90"}),v&&P.jsx(Hr,{size:"sm",variant:"ghost",onClick:rt,className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-muted/50",children:P.jsx(Qo,{className:"h-3 w-3"})}),P.jsx(Tc,{children:B&&G.length>0&&P.jsxs(Fr.div,{ref:Pe,initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute top-full left-0 right-0 mt-1 bg-white/98 backdrop-blur-md border border-border/50 rounded-md shadow-lg z-50 max-h-80 overflow-y-auto",children:[!v.trim()&&V.length>0&&P.jsx("div",{className:"px-3 py-2 text-xs font-medium text-muted-foreground border-b border-border/30",children:"Senaste sökningar"}),G.map((ct,Ut)=>P.jsx(Fr.div,{onClick:()=>tt(ct),className:`p-3 cursor-pointer text-sm hover:bg-accent/50 transition-colors border-b border-border/50 last:border-b-0 ${Y===Ut?"bg-accent/70":""}`,initial:{opacity:0},animate:{opacity:1},transition:{delay:Ut*.02},whileHover:{scale:1.01},children:P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[mt(ct.type),P.jsxs("div",{className:"flex-1 min-w-0",children:[P.jsx("div",{className:"font-medium text-foreground truncate",children:ct.title}),ct.subtitle&&P.jsx("div",{className:"text-xs text-muted-foreground truncate",children:ct.subtitle})]})]}),ct.count&&P.jsx(an,{variant:"secondary",className:"text-xs h-4 px-1 ml-2",children:ct.count})]})},ct.id)),!ae&&G.length>=10&&P.jsx("div",{className:"p-2 text-center text-xs text-blue-600 cursor-pointer hover:bg-gray-100",onClick:()=>le(!0),children:"Visa fler resultat..."})]})})]}),P.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[P.jsxs("div",{children:[P.jsxs("label",{className:"text-xs text-muted-foreground mb-1 block",children:["Kommuner ",r.kommuner&&r.kommuner.length>0&&P.jsxs("span",{className:"text-primary",children:["(",r.kommuner.length,")"]})]}),P.jsxs("div",{className:"space-y-2",children:[r.kommuner&&r.kommuner.length>0&&P.jsx("div",{className:"flex flex-wrap gap-1",children:r.kommuner.map(ct=>P.jsxs(an,{variant:"secondary",className:"flex items-center gap-1 pr-1 pl-2 py-1 text-xs",children:[P.jsx("span",{children:ct}),P.jsx(Hr,{size:"sm",variant:"ghost",onClick:()=>{const Ut=r.kommuner?.filter(xr=>xr!==ct);n({...r,kommuner:Ut?.length?Ut:void 0})},className:"h-3 w-3 p-0 hover:bg-destructive/20",children:P.jsx(Qo,{className:"h-2 w-2"})})]},ct))}),P.jsxs(rR,{value:"add",onValueChange:ct=>{if(ct!=="add"&&ct!=="all"){const Ut=r.kommuner||[];Ut.includes(ct)||n({...r,kommuner:[...Ut,ct]})}else ct==="all"&&n({...r,kommuner:void 0})},children:[P.jsx(SE,{className:"h-8 text-xs",children:P.jsx(nR,{placeholder:"+ Lägg till kommun"})}),P.jsxs(TE,{className:"max-h-60 overflow-y-auto",children:[P.jsx(fu,{value:"all",children:"Rensa alla kommuner"}),JH.map(ct=>P.jsxs(fu,{value:ct,className:"text-xs",disabled:r.kommuner?.includes(ct),children:[ct," (",t.filter(Ut=>Ut.kommun===ct).length,")"]},ct))]})]})]})]}),P.jsxs("div",{children:[P.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Huvudman"}),P.jsxs(rR,{value:r.huvudman||"all",onValueChange:ct=>{n({...r,huvudman:ct==="all"?void 0:ct})},children:[P.jsx(SE,{className:"h-8 text-xs",children:P.jsx(nR,{placeholder:"Välj typ"})}),P.jsxs(TE,{children:[P.jsx(fu,{value:"all",children:"Alla typer"}),P.jsx(fu,{value:"Kommunal",children:"Kommunal"}),P.jsx(fu,{value:"Enskild",children:"Fristående"})]})]})]})]}),P.jsxs(Hr,{onClick:lt,variant:ge?"default":"outline",size:"sm",className:"w-full hover-scale transition-all duration-200 font-medium backdrop-blur-sm",disabled:O,children:[O?P.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-current border-t-transparent rounded-full mr-2"}):ge?P.jsx(Qce,{className:"w-4 h-4 mr-2"}):P.jsx(nj,{className:"w-4 h-4 mr-2"}),O?"Hämtar position...":ge?"Position aktiv":"🎯 Nära mig"]}),P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("div",{className:"text-xs text-muted-foreground",children:ht?`${s.length.toLocaleString()} av ${t.length.toLocaleString()} förskolor`:`${t.length.toLocaleString()} förskolor totalt`}),ht&&P.jsxs(Hr,{size:"sm",variant:"ghost",onClick:rt,className:"h-6 px-2 text-xs text-muted-foreground hover:text-destructive",children:[P.jsx(Qo,{className:"h-3 w-3 mr-1"}),"Rensa allt"]})]})]})]})})}):P.jsx(Fr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`absolute left-4 top-4 z-30 ${e}`,children:P.jsx(kn,{className:"glass-search border-0 shadow-lg card-hover backdrop-blur-lg bg-white/80",children:P.jsxs("div",{className:"p-3",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsxs(Hr,{onClick:()=>I(!0),variant:"ghost",size:"sm",className:"h-8 px-2 hover-scale transition-all duration-200 font-heading",children:[P.jsx(tb,{className:"h-4 w-4 mr-1 text-primary"}),P.jsx("span",{className:"font-medium text-base",children:"Sök förskolor"}),ht&&P.jsx(an,{variant:"secondary",className:"h-4 px-1 text-xs ml-1",children:vt}),P.jsx(Zw,{className:"h-4 w-4 ml-1"})]}),ht&&P.jsx(Hr,{onClick:rt,variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-destructive/10",title:"Rensa alla filter",children:P.jsx(Qo,{className:"h-3 w-3 text-muted-foreground hover:text-destructive"})})]}),ht&&P.jsx("div",{className:"pt-2 border-t border-border/50 mt-2",children:P.jsx(YGe,{})})]})})})};function NHe(e){return{Stockholm:[18.0686,59.3293],Göteborg:[11.9746,57.7089],Malmö:[13.0034,55.605],Uppsala:[17.6389,59.8585],Västerås:[16.5554,59.6099],Örebro:[15.2066,59.2741],Linköping:[15.6214,58.4108],Helsingborg:[12.6945,56.0465],Jönköping:[14.1618,57.7826],Norrköping:[16.1926,58.5877],Lund:[13.191,55.7047],Umeå:[20.263,63.8258],Gävle:[17.1414,60.6749],Borås:[12.9401,57.721],Eskilstuna:[16.5077,59.3706],Södertälje:[17.6253,59.1955],Karlstad:[13.5034,59.3793],Växjö:[14.8059,56.8777],Halmstad:[12.858,56.6745],Sundsvall:[17.3063,62.3908],Luleå:[22.1567,65.5848],Trollhättan:[12.2886,58.2837],Östersund:[14.6357,63.1792],Borlänge:[15.4357,60.4858],Falun:[15.6356,60.6066],Skövde:[13.8454,58.3914],Karlskrona:[15.5866,56.1612],Kristianstad:[14.1591,56.0294],Kalmar:[16.3614,56.6634],Kungälv:[11.9746,57.8737],Partille:[11.9989,57.7396],Mölndal:[12.0134,57.6554],Lerum:[12.2691,57.7706]}[e]||null}const nO=768;function Mre(){const[e,t]=Z.useState(void 0);return Z.useEffect(()=>{const r=window.matchMedia(`(max-width: ${nO-1}px)`),n=()=>{t(window.innerWidth<nO)};return r.addEventListener("change",n),t(window.innerWidth<nO),()=>r.removeEventListener("change",n)},[]),!!e}const FHe=()=>{const e=Mre(),{filteredPreschools:t,selectedPreschool:r,setSelectedPreschool:n}=_s(),[c,h]=Z.useState(0),[p,s]=Z.useState(!1),v=Z.useRef(null),w=UK(0);if(!e||(Z.useEffect(()=>{if(t.length>0&&!p){const G=setTimeout(()=>s(!0),2e3);return()=>clearTimeout(G)}},[t.length,p]),t.length===0))return null;const T=t[c],I=hM(w,[-300,0,300],[.8,1,.8]),O=hM(w,[-300,0,300],[.3,1,.3]),D=(G,U)=>{U.offset.x>100&&c>0?(h(c-1),n(t[c-1])):U.offset.x<-100&&c<t.length-1&&(h(c+1),n(t[c+1])),w.set(0)},B=()=>{c>0&&(h(c-1),n(t[c-1]))},N=()=>{c<t.length-1&&(h(c+1),n(t[c+1]))};return Z.useEffect(()=>{if(r){const G=t.findIndex(U=>U.id===r.id);G>=0&&G!==c&&h(G)}},[r,t,c]),!T||!p?null:P.jsxs(P.Fragment,{children:[P.jsx(Fr.button,{onClick:()=>s(!p),className:"fixed bottom-20 right-4 z-50 md:hidden bg-primary/90 text-primary-foreground p-3 rounded-full shadow-lg",whileHover:{scale:1.05},whileTap:{scale:.95},initial:{scale:0},animate:{scale:1},transition:{delay:1,duration:.3},children:P.jsx(nj,{className:"w-5 h-5"})}),P.jsxs(Fr.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},className:"fixed bottom-20 left-4 right-4 z-40 md:hidden",children:[P.jsx("div",{ref:v,className:"relative",children:P.jsx(Fr.div,{drag:"x",dragConstraints:v,dragElastic:.1,onDragEnd:D,style:{x:w,scale:I,opacity:O},className:"cursor-grab active:cursor-grabbing",children:P.jsxs(kn,{className:"bg-white/95 backdrop-blur-sm border border-border/50 shadow-lg p-4",children:[P.jsxs("div",{className:"flex items-center justify-between mb-3",children:[P.jsxs("div",{className:"flex items-center space-x-2",children:[P.jsx(Fr.button,{onClick:B,disabled:c===0,className:"p-2 rounded-full bg-primary/10 disabled:opacity-30 disabled:cursor-not-allowed",whileTap:{scale:.9},children:P.jsx(tj,{className:"w-4 h-4"})}),P.jsxs("span",{className:"text-xs text-muted-foreground font-medium",children:[c+1," av ",t.length]}),P.jsx(Fr.button,{onClick:N,disabled:c===t.length-1,className:"p-2 rounded-full bg-primary/10 disabled:opacity-30 disabled:cursor-not-allowed",whileTap:{scale:.9},children:P.jsx(rj,{className:"w-4 h-4"})})]}),P.jsx("button",{onClick:()=>s(!1),className:"text-muted-foreground hover:text-foreground p-1",children:"✕"})]}),P.jsx("div",{className:"flex justify-center space-x-1 mb-4",children:Array.from({length:Math.min(5,t.length)},(G,U)=>{let V;return t.length<=5?V=U:V=Math.max(0,Math.min(t.length-5,c-2))+U,P.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-all duration-200 ${V===c?"bg-primary w-4":"bg-border"}`},V)})}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{children:[P.jsx("h3",{className:"font-semibold text-foreground line-clamp-2",children:T.namn}),P.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[P.jsx(qa,{className:"w-3 h-3 text-muted-foreground"}),P.jsx("span",{className:"text-sm text-muted-foreground line-clamp-1",children:T.kommun}),T.huvudman&&P.jsx(an,{variant:"outline",className:"text-xs",children:T.huvudman==="Kommunal"?"Kommunal":"Fristående"})]})]}),P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{className:"flex items-center space-x-4",children:[T.google_rating&&T.google_rating>0&&P.jsxs("div",{className:"flex items-center space-x-1",children:[P.jsx(ba,{className:"w-4 h-4 text-yellow-500 fill-current"}),P.jsx("span",{className:"text-sm font-medium",children:T.google_rating.toFixed(1)})]}),T.antal_barn&&T.antal_barn>0&&P.jsxs("div",{className:"flex items-center space-x-1",children:[P.jsx(Rm,{className:"w-4 h-4 text-blue-500"}),P.jsx("span",{className:"text-sm text-muted-foreground",children:T.antal_barn})]}),T.personal_andel_forskollararexamen&&P.jsxs(an,{variant:"secondary",className:"text-xs",children:[Math.round(T.personal_andel_forskollararexamen*100),"% lärare"]})]}),P.jsx("div",{className:"text-xs text-muted-foreground",children:"👆 Swipa"})]})]}),P.jsx(Fr.div,{className:"absolute inset-0 pointer-events-none rounded-lg",style:{background:hM(w,[-300,-100,0,100,300],["linear-gradient(90deg, rgba(34,197,94,0.1) 0%, transparent 100%)","linear-gradient(90deg, rgba(34,197,94,0.05) 0%, transparent 100%)","transparent","linear-gradient(270deg, rgba(59,130,246,0.05) 0%, transparent 100%)","linear-gradient(270deg, rgba(59,130,246,0.1) 0%, transparent 100%)"])}})]})})}),P.jsxs(Fr.div,{initial:{opacity:1},animate:{opacity:0},transition:{delay:4,duration:2},className:"absolute -top-16 left-1/2 transform -translate-x-1/2 bg-black/80 text-white px-3 py-2 rounded-full text-xs whitespace-nowrap flex items-center space-x-2",children:[P.jsx(nj,{className:"w-3 h-3"}),P.jsx("span",{children:"Swipa för att bläddra mellan förskolor"})]})]})]})},BHe=()=>{const{preschools:e,visiblePreschools:t,filteredPreschools:r}=_s(),[n,c]=Z.useState({renderTime:0,frameRate:0,memoryUsage:0,visibleElements:0,loadTime:0,cacheHitRate:0}),[h,p]=Z.useState(!1),[s,v]=Z.useState(!1);Z.useEffect(()=>{const T=I=>{I.ctrlKey&&I.shiftKey&&I.key==="P"&&(v(!s),console.log("🔧 Performance Dashboard toggled:",!s))};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[s]),Z.useEffect(()=>{const T=()=>{const O=performance.now(),D=performance.now();t.length*.1;const B=performance.now()-D,N=(e.length*.5+t.length*.8)/1024;c({renderTime:B,frameRate:Math.max(30,60-t.length*.01),memoryUsage:N,visibleElements:t.length,loadTime:O,cacheHitRate:Math.min(95,70+t.length/e.length*25)})};T();const I=setInterval(T,1e3);return()=>clearInterval(I)},[e.length,t.length,r.length]);const w=(()=>{let T=100;return n.renderTime>16&&(T-=20),n.frameRate<30&&(T-=30),n.memoryUsage>50&&(T-=15),n.visibleElements>1e3&&(T-=10),n.cacheHitRate<80&&(T-=15),T>=90?{grade:"A+",color:"text-green-600 bg-green-100",description:"Utmärkt prestanda"}:T>=80?{grade:"A",color:"text-green-600 bg-green-100",description:"Mycket bra prestanda"}:T>=70?{grade:"B",color:"text-blue-600 bg-blue-100",description:"Bra prestanda"}:T>=60?{grade:"C",color:"text-yellow-600 bg-yellow-100",description:"Godkänd prestanda"}:T>=50?{grade:"D",color:"text-orange-600 bg-orange-100",description:"Sämre prestanda"}:{grade:"F",color:"text-red-600 bg-red-100",description:"Dålig prestanda"}})();return s?P.jsxs("div",{className:"fixed top-4 right-4 z-50",children:[P.jsx(Fr.button,{onClick:()=>p(!h),className:"bg-black/80 text-white p-2 rounded-lg hover:bg-black/90 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},title:"Performance Dashboard (Ctrl+Shift+P to toggle in production)",children:P.jsx(iE,{className:"w-4 h-4"})}),P.jsx(Tc,{children:h&&P.jsx(Fr.div,{initial:{opacity:0,scale:.9,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-20},className:"absolute top-12 right-0 w-80",children:P.jsx(kn,{className:"p-4 bg-white/95 backdrop-blur-sm border border-border/50 shadow-xl",children:P.jsxs("div",{className:"space-y-4",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{className:"flex items-center space-x-2",children:[P.jsx(iE,{className:"w-5 h-5 text-primary"}),P.jsx("h3",{className:"font-semibold",children:"Prestanda"}),P.jsx(an,{variant:"outline",className:"text-xs",children:"PROD"})]}),P.jsx(an,{className:w.color,children:w.grade})]}),P.jsx("p",{className:"text-xs text-muted-foreground",children:w.description}),P.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[P.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[P.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[P.jsx(sue,{className:"w-3 h-3 text-yellow-500"}),P.jsx("span",{className:"text-xs font-medium",children:"Render"})]}),P.jsxs("div",{className:"text-sm font-bold",children:[n.renderTime.toFixed(1),"ms"]}),P.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.frameRate.toFixed(0)," FPS"]})]}),P.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[P.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[P.jsx(UL,{className:"w-3 h-3 text-blue-500"}),P.jsx("span",{className:"text-xs font-medium",children:"Minne"})]}),P.jsxs("div",{className:"text-sm font-bold",children:[n.memoryUsage.toFixed(1),"MB"]}),P.jsxs("div",{className:"text-xs text-muted-foreground",children:["~",Math.round(n.memoryUsage*1.2),"MB max"]})]}),P.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[P.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[P.jsx($L,{className:"w-3 h-3 text-green-500"}),P.jsx("span",{className:"text-xs font-medium",children:"Synliga"})]}),P.jsx("div",{className:"text-sm font-bold",children:n.visibleElements.toLocaleString()}),P.jsxs("div",{className:"text-xs text-muted-foreground",children:["av ",e.length.toLocaleString()]})]}),P.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[P.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[P.jsx(jm,{className:"w-3 h-3 text-purple-500"}),P.jsx("span",{className:"text-xs font-medium",children:"Cache"})]}),P.jsxs("div",{className:"text-sm font-bold",children:[n.cacheHitRate.toFixed(0),"%"]}),P.jsx("div",{className:"text-xs text-muted-foreground",children:"Träffar"})]})]}),P.jsxs("div",{className:"space-y-2",children:[P.jsx("h4",{className:"text-xs font-medium text-muted-foreground",children:"Optimeringar"}),P.jsxs("div",{className:"flex items-center justify-between text-xs",children:[P.jsx("span",{children:"Viewport Culling"}),P.jsx(an,{variant:n.visibleElements<e.length?"default":"secondary",children:n.visibleElements<e.length?"Aktiv":"Inaktiv"})]}),P.jsxs("div",{className:"flex items-center justify-between text-xs",children:[P.jsx("span",{children:"LOD System"}),P.jsx(an,{variant:"default",children:"Aktiv"})]}),P.jsxs("div",{className:"flex items-center justify-between text-xs",children:[P.jsx("span",{children:"Clustering"}),P.jsx(an,{variant:n.visibleElements>100?"default":"secondary",children:n.visibleElements>100?"Aktiv":"Inaktiv"})]}),P.jsxs("div",{className:"flex items-center justify-between text-xs",children:[P.jsx("span",{children:"Progressive Loading"}),P.jsx(an,{variant:"default",children:"Aktiv"})]})]}),n.frameRate<30&&P.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-2 rounded text-xs",children:[P.jsxs("div",{className:"flex items-center space-x-1 text-yellow-700",children:[P.jsx(VL,{className:"w-3 h-3"}),P.jsx("span",{className:"font-medium",children:"Prestandavarning"})]}),P.jsx("p",{className:"mt-1 text-yellow-600",children:"Zooma ut eller aktivera clustering för bättre prestanda"})]}),P.jsxs("div",{className:"border-t pt-3 space-y-1 text-xs text-muted-foreground",children:[P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{children:"Totalt förskolor:"}),P.jsx("span",{children:e.length.toLocaleString()})]}),P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{children:"Filtrerade:"}),P.jsx("span",{children:r.length.toLocaleString()})]}),P.jsxs("div",{className:"flex justify-between",children:[P.jsx("span",{children:"I viewport:"}),P.jsx("span",{children:t.length.toLocaleString()})]})]}),P.jsx("div",{className:"bg-blue-50 border border-blue-200 p-2 rounded text-xs",children:P.jsxs("p",{className:"text-blue-600",children:["💡 Tryck ",P.jsx("kbd",{className:"bg-blue-100 px-1 rounded",children:"Ctrl+Shift+P"})," för att togglela denna dashboard"]})})]})})})})]}):null},VHe=({isOpen:e,onClose:t})=>{const{filteredPreschools:r,searchTerm:n,selectedCommune:c}=_s(),[h,p]=Z.useState("overview"),s=Z.useMemo(()=>c?{type:"kommun",name:c,title:`Statistik för ${c}`}:n&&n.trim()?{type:"search",name:n.trim(),title:`Statistik för "${n.trim()}"`}:{type:"national",name:"Sverige",title:"Riksstatistik för förskolor"},[c,n]),v=Z.useMemo(()=>{if(r.length===0)return null;const G=r.length,U=r.filter(Ye=>Ye.antal_barn&&Ye.antal_barn>0),V=U.reduce((Ye,Oe)=>Ye+(Oe.antal_barn||0),0),X=r.filter(Ye=>Ye.antal_barngrupper&&Ye.antal_barngrupper>0),Y=X.reduce((Ye,Oe)=>Ye+(Oe.antal_barngrupper||0),0),ne=U.length>0?V/U.length:0,ae=Y>0?V/Y:0,le=r.filter(Ye=>Ye.personaltäthet&&Ye.personaltäthet>0),ge=le.length>0?le.reduce((Ye,Oe)=>Ye+(Oe.personaltäthet||0),0)/le.length:0,je=r.filter(Ye=>Ye.andel_med_förskollärarexamen!=null&&Ye.andel_med_förskollärarexamen>=0),ze=je.length>0?je.reduce((Ye,Oe)=>Ye+(Oe.andel_med_förskollärarexamen||0),0)/je.length:0,Pe=r.filter(Ye=>Ye.google_rating&&Ye.google_rating>0),Ke=Pe.length>0?Pe.reduce((Ye,Oe)=>Ye+(Oe.google_rating||0),0)/Pe.length:0;return{totalPreschools:G,totalChildren:V,avgChildrenPerPreschool:Math.round(ne*10)/10,avgChildrenPerGroup:Math.round(ae*10)/10,avgStaffDensity:Math.round(ge*10)/10,avgTeacherRatio:Math.round(ze*10)/10,avgRating:Math.round(Ke*10)/10,validRatings:Pe.length,validChildren:U.length,validGroups:X.length,validStaff:le.length,validTeachers:je.length}},[r]),w={avgChildrenPerPreschool:55.1,avgChildrenPerGroup:16.8,avgStaffDensity:5.1,avgTeacherRatio:40.8,avgRating:4.1},T=Z.useMemo(()=>v?[{label:"Barn per förskola",current:v.avgChildrenPerPreschool,national:w.avgChildrenPerPreschool,unit:"barn",trend:v.avgChildrenPerPreschool>w.avgChildrenPerPreschool?"up":v.avgChildrenPerPreschool<w.avgChildrenPerPreschool?"down":"stable",description:"Genomsnittligt antal barn per förskola"},{label:"Barn per grupp",current:v.avgChildrenPerGroup,national:w.avgChildrenPerGroup,unit:"barn",trend:v.avgChildrenPerGroup>w.avgChildrenPerGroup?"up":v.avgChildrenPerGroup<w.avgChildrenPerGroup?"down":"stable",description:"Genomsnittlig barngruppsstorlek"},{label:"Personaltäthet",current:v.avgStaffDensity,national:w.avgStaffDensity,unit:"barn/personal",trend:v.avgStaffDensity<w.avgStaffDensity?"up":v.avgStaffDensity>w.avgStaffDensity?"down":"stable",description:"Antal barn per personal (lägre är bättre)"},{label:"Förskollärare",current:v.avgTeacherRatio,national:w.avgTeacherRatio,unit:"%",trend:v.avgTeacherRatio>w.avgTeacherRatio?"up":v.avgTeacherRatio<w.avgTeacherRatio?"down":"stable",description:"Andel personal med förskollärarexamen"},{label:"Google Betyg",current:v.avgRating,national:w.avgRating,unit:"/5",trend:v.avgRating>w.avgRating?"up":v.avgRating<w.avgRating?"down":"stable",description:`Genomsnittligt Google-betyg (${v.validRatings} förskolor)`}]:[],[v,w]),I=Z.useMemo(()=>{if(!v)return[];const G=[{range:"Små (1-20)",min:1,max:20,count:0},{range:"Medel (21-50)",min:21,max:50,count:0},{range:"Stora (51-100)",min:51,max:100,count:0},{range:"Mycket stora (>100)",min:101,max:9999,count:0}];return r.forEach(U=>{U.antal_barn&&G.forEach(V=>{U.antal_barn>=V.min&&U.antal_barn<=V.max&&V.count++})}),G},[r]),O=Z.useMemo(()=>{const G={Kommunal:0,Privat:0,Kooperativ:0,Övrigt:0};return r.forEach(U=>{if(!U.huvudman||U.huvudman.trim()===""){G.Övrigt++;return}const V=U.huvudman.toLowerCase().trim();V.includes("kommun")||V.includes("kommun")?G.Kommunal++:V.includes("privat")||V.includes("aktiebolag")||V.includes("ab")||V.includes("enskild")||V.includes("stiftelse")||V.includes("företag")?G.Privat++:V.includes("kooperativ")||V.includes("ekonomisk förening")||V.includes("föräldra")||V.includes("kooperativ")?G.Kooperativ++:G.Övrigt++}),Object.entries(G).filter(([U,V])=>V>0).map(([U,V])=>({name:U,value:V}))},[r]),D=G=>{switch(G){case"up":return P.jsx(zce,{className:"w-4 h-4 text-green-500"});case"down":return P.jsx(Rce,{className:"w-4 h-4 text-red-500"});default:return P.jsx(Yq,{className:"w-4 h-4 text-gray-500"})}},B=(G,U,V)=>{if(!G||!U||G===0||U===0)return"Ingen data";const X=Math.abs(G-U),Y=U>0?X/U*100:0,ne=G>U;return Y<1?"≈ rikssnitt":`${ne?"+":"-"}${X.toFixed(1)}${V} (${Y.toFixed(0)}%)`},N=["hsl(142, 76%, 36%)","hsl(200, 85%, 45%)","hsl(35, 100%, 55%)","hsl(215, 20%, 65%)"];return!e||!v?null:P.jsx(Tc,{children:P.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",onClick:t,children:P.jsx(Fr.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.3},className:"fixed left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[95vw] max-w-6xl max-h-[95vh] overflow-hidden md:w-[90vw] md:max-h-[90vh]",onClick:G=>G.stopPropagation(),children:P.jsxs(kn,{className:"h-full bg-white/95 backdrop-blur-sm border border-border/50 shadow-xl",children:[P.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border/30",children:[P.jsxs("div",{className:"flex items-center space-x-3",children:[P.jsx(Ah,{className:"w-6 h-6 text-primary"}),P.jsxs("div",{children:[P.jsx("h2",{className:"text-2xl font-bold",children:s.title}),P.jsxs("p",{className:"text-sm text-muted-foreground",children:["Visar data för ",v.totalPreschools.toLocaleString()," förskolor"]})]})]}),P.jsx(Hr,{variant:"ghost",size:"sm",onClick:t,children:P.jsx(Qo,{className:"w-5 h-5"})})]}),P.jsx("div",{className:"flex-1 overflow-auto",children:P.jsxs(Z3,{value:h,onValueChange:p,className:"w-full",children:[P.jsxs(_k,{className:"grid w-full grid-cols-3 mx-6 mt-6",children:[P.jsx(Su,{value:"overview",children:"📊 Översikt"}),P.jsx(Su,{value:"comparison",children:"📈 Jämförelse"}),P.jsx(Su,{value:"distribution",children:"📋 Fördelning"})]}),P.jsxs(Tu,{value:"overview",className:"p-6 space-y-6",children:[P.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[P.jsxs(kn,{className:"p-4",children:[P.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[P.jsx(am,{className:"w-4 h-4 text-blue-500"}),P.jsx("span",{className:"text-sm font-medium",children:"Förskolor"})]}),P.jsx("div",{className:"text-2xl font-bold",children:v.totalPreschools.toLocaleString()}),P.jsx("div",{className:"text-xs text-muted-foreground",children:"st"})]}),P.jsxs(kn,{className:"p-4",children:[P.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[P.jsx(Rm,{className:"w-4 h-4 text-green-500"}),P.jsx("span",{className:"text-sm font-medium",children:"Totalt barn"})]}),P.jsx("div",{className:"text-2xl font-bold",children:v.totalChildren.toLocaleString()}),P.jsx("div",{className:"text-xs text-muted-foreground",children:"barn"})]}),P.jsxs(kn,{className:"p-4",children:[P.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[P.jsx(jm,{className:"w-4 h-4 text-orange-500"}),P.jsx("span",{className:"text-sm font-medium",children:"⌀ Barn/förskola"})]}),P.jsx("div",{className:"text-2xl font-bold",children:v.avgChildrenPerPreschool.toFixed(1)}),P.jsx("div",{className:"text-xs text-muted-foreground",children:"barn"})]}),P.jsxs(kn,{className:"p-4",children:[P.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[P.jsx(ba,{className:"w-4 h-4 text-yellow-500"}),P.jsx("span",{className:"text-sm font-medium",children:"⌀ Betyg"})]}),P.jsx("div",{className:"text-2xl font-bold",children:v.avgRating>0?v.avgRating.toFixed(1):"N/A"}),P.jsx("div",{className:"text-xs text-muted-foreground",children:"/5.0"})]})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsx("h3",{className:"text-lg font-semibold",children:"Nyckeltal vs Rikssnitt"}),T.slice(0,3).map((G,U)=>P.jsx(kn,{className:"p-4",children:P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{className:"flex items-center space-x-3",children:[D(G.trend),P.jsxs("div",{children:[P.jsx("div",{className:"font-medium",children:G.label}),P.jsx("div",{className:"text-sm text-muted-foreground",children:G.description})]})]}),P.jsxs("div",{className:"text-right",children:[P.jsxs("div",{className:"text-2xl font-bold",children:[G.current.toFixed(1),G.unit]}),P.jsxs("div",{className:"text-sm text-muted-foreground",children:["Rikssnitt: ",G.national.toFixed(1),G.unit]}),P.jsx(an,{variant:"outline",className:"text-xs mt-1",children:B(G.current,G.national,G.unit)})]})]})},U))]})]}),P.jsxs(Tu,{value:"comparison",className:"p-6 space-y-6",children:[P.jsx("h3",{className:"text-lg font-semibold",children:"Detaljerad Jämförelse med Rikssnitt"}),T.map((G,U)=>P.jsxs(kn,{className:"p-6",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsxs("div",{className:"flex items-center space-x-3",children:[D(G.trend),P.jsxs("div",{children:[P.jsx("h4",{className:"text-lg font-semibold",children:G.label}),P.jsx("p",{className:"text-sm text-muted-foreground",children:G.description})]})]}),P.jsx(an,{variant:G.trend==="up"?"default":G.trend==="down"?"destructive":"secondary",children:B(G.current,G.national,G.unit)})]}),P.jsx("div",{className:"h-16",children:P.jsx(Ab,{width:"100%",height:"100%",children:P.jsxs(MD,{data:[{name:s.name,value:G.current},{name:"Rikssnitt",value:G.national}],margin:{top:5,right:30,left:20,bottom:5},children:[P.jsx($_,{dataKey:"name"}),P.jsx(H_,{}),P.jsx(Na,{formatter:V=>[`${Number(V).toFixed(1)}${G.unit}`,""]}),P.jsx(Lh,{dataKey:"value",fill:G.trend==="up"?"#22c55e":G.trend==="down"?"#ef4444":"#94a3b8",radius:4})]})})})]},U))]}),P.jsxs(Tu,{value:"distribution",className:"p-6 space-y-6",children:[P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[P.jsxs(kn,{className:"p-6",children:[P.jsx("h3",{className:"text-lg font-semibold mb-4",children:"📏 Förskolor per Storlek"}),P.jsx("div",{className:"h-64",children:P.jsx(Ab,{width:"100%",height:"100%",children:P.jsxs(MD,{data:I,children:[P.jsx(uN,{strokeDasharray:"3 3"}),P.jsx($_,{dataKey:"range"}),P.jsx(H_,{}),P.jsx(Na,{}),P.jsx(Lh,{dataKey:"count",fill:"hsl(142, 76%, 36%)",radius:4})]})})})]}),P.jsxs(kn,{className:"p-6",children:[P.jsx("h3",{className:"text-lg font-semibold mb-4",children:"🏢 Huvudmansfördelning"}),P.jsx("div",{className:"h-64",children:P.jsx(Ab,{width:"100%",height:"100%",children:P.jsxs(OD,{children:[P.jsx(Uh,{data:O,cx:"50%",cy:"50%",labelLine:!1,label:({name:G,percent:U})=>`${G} ${(U*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:O.map((G,U)=>P.jsx(l1,{fill:N[U%N.length]},`cell-${U}`))}),P.jsx(Na,{})]})})}),P.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:O.map((G,U)=>P.jsxs("div",{className:"flex items-center space-x-2",children:[P.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:N[U%N.length]}}),P.jsxs("span",{className:"text-sm",children:[G.name,": ",G.value]})]},G.name))})]})]}),P.jsxs(kn,{className:"p-6",children:[P.jsx("h3",{className:"text-lg font-semibold mb-4",children:"📋 Sammanfattning av urval"}),P.jsx("div",{className:"overflow-x-auto",children:P.jsx("table",{className:"w-full text-sm",children:P.jsxs("tbody",{className:"space-y-2",children:[P.jsxs("tr",{children:[P.jsx("td",{className:"font-medium",children:"Sammanhang:"}),P.jsx("td",{children:s.title})]}),P.jsxs("tr",{children:[P.jsx("td",{className:"font-medium",children:"Antal förskolor:"}),P.jsxs("td",{children:[v.totalPreschools.toLocaleString()," st"]})]}),P.jsxs("tr",{children:[P.jsx("td",{className:"font-medium",children:"Totalt antal barn:"}),P.jsxs("td",{children:[v.totalChildren.toLocaleString()," barn"]})]}),P.jsxs("tr",{children:[P.jsx("td",{className:"font-medium",children:"Genomsnittlig förskolestorlek:"}),P.jsxs("td",{children:[v.avgChildrenPerPreschool.toFixed(1)," barn/förskola"]})]}),P.jsxs("tr",{children:[P.jsx("td",{className:"font-medium",children:"Förskolor med betyg:"}),P.jsxs("td",{children:[v.validRatings," st (",(v.validRatings/v.totalPreschools*100).toFixed(1),"%)"]})]})]})})})]})]})]})})]})})})})},UHe=()=>{const{performanceMode:e,setPerformanceMode:t}=_s(),r=Z.useRef(null);Z.useEffect(()=>{const p=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),s="ontouchstart"in window,v=window.innerWidth<768;(p||s||v)&&(e==="high"&&t("medium"),n(),c(),h())},[]);const n=()=>{let p=document.querySelector('meta[name="viewport"]');p||(p=document.createElement("meta"),p.setAttribute("name","viewport"),document.head.appendChild(p)),p.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no");let s=document.querySelector('meta[name="theme-color"]');s||(s=document.createElement("meta"),s.setAttribute("name","theme-color"),s.setAttribute("content","#1f2937"),document.head.appendChild(s));let v=document.querySelector('meta[name="mobile-web-app-capable"]');v||(v=document.createElement("meta"),v.setAttribute("name","mobile-web-app-capable"),v.setAttribute("content","yes"),document.head.appendChild(v))},c=()=>{const p=document.createElement("style");p.textContent=`
      @media (max-width: 768px) {
        .mapboxgl-ctrl button {
          min-width: 44px !important;
          min-height: 44px !important;
        }
        
        .mapboxgl-popup-close-button {
          width: 30px !important;
          height: 30px !important;
          font-size: 16px !important;
        }
        
        /* Larger touch targets for UI elements */
        button, .clickable {
          min-height: 44px;
          min-width: 44px;
        }
        
        /* Improved scrolling on mobile */
        .overflow-y-auto {
          -webkit-overflow-scrolling: touch;
          overflow-scrolling: touch;
        }
        
        /* Prevent text selection on mobile */
        .map-container, .mapboxgl-map {
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: transparent;
        }
        
        /* Better mobile panels */
        .mobile-panel {
          position: fixed !important;
          bottom: 0 !important;
          left: 0 !important;
          right: 0 !important;
          top: auto !important;
          transform: none !important;
          border-radius: 16px 16px 0 0 !important;
          max-height: 70vh !important;
        }
      }
    `,document.head.appendChild(p)},h=()=>{let p=0;const s=v=>{const w=Date.now();w-p<=300&&v.preventDefault(),p=w};return document.addEventListener("touchend",s,{passive:!1}),()=>{document.removeEventListener("touchend",s)}};return Z.useEffect(()=>{const p=w=>{w.touches.length===1&&(r.current={x:w.touches[0].clientX,y:w.touches[0].clientY,time:Date.now()})},s=w=>{w.touches.length>1&&w.preventDefault()},v=w=>{if(r.current&&w.changedTouches.length===1){const T={x:w.changedTouches[0].clientX,y:w.changedTouches[0].clientY,time:Date.now()},I=T.x-r.current.x,O=T.y-r.current.y,D=T.time-r.current.time;if(Math.sqrt(I*I+O*O)>50&&D<300){const B=Math.atan2(O,I)*180/Math.PI;Math.abs(B)<45?document.dispatchEvent(new CustomEvent("swipeRight")):Math.abs(B)>135?document.dispatchEvent(new CustomEvent("swipeLeft")):B>45&&B<135?document.dispatchEvent(new CustomEvent("swipeDown")):B<-45&&B>-135&&document.dispatchEvent(new CustomEvent("swipeUp"))}}r.current=null};return document.addEventListener("touchstart",p,{passive:!0}),document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("touchend",v,{passive:!0}),()=>{document.removeEventListener("touchstart",p),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",v)}},[]),null},$He=()=>{const{preschools:e,setPreschools:t,updatePreschool:r,setLoading:n}=_s(),c=Z.useCallback(s=>{const v={id:s.new.id,namn:s.new.Namn,kommun:s.new.Kommun,adress:s.new.Adress||"",latitud:s.new.Latitud||0,longitud:s.new.Longitud||0,antal_barn:s.new["Antal barn"],huvudman:s.new.Huvudman,personaltäthet:s.new.Personaltäthet,andel_med_förskollärarexamen:s.new["Andel med förskollärarexamen"],antal_barngrupper:s.new["Antal barngrupper"]};t([...e,v]),fh.success(`Ny förskola tillagd: ${v.namn}`)},[e,t]),h=Z.useCallback(s=>{const v={id:s.new.id,namn:s.new.Namn,kommun:s.new.Kommun,adress:s.new.Adress||"",latitud:s.new.Latitud||0,longitud:s.new.Longitud||0,antal_barn:s.new["Antal barn"],huvudman:s.new.Huvudman,personaltäthet:s.new.Personaltäthet,andel_med_förskollärarexamen:s.new["Andel med förskollärarexamen"],antal_barngrupper:s.new["Antal barngrupper"]},w={lat:s.old?.Latitud,lng:s.old?.Longitud},T={lat:s.new.Latitud,lng:s.new.Longitud};(w.lat===null||w.lat===0)&&T.lat!==null&&T.lat!==0?fh.success(`Koordinater tillagda för ${v.namn}!`):w.lat!==T.lat||w.lng!==T.lng?fh.info(`Koordinater uppdaterade för ${v.namn}`):fh.info(`Förskola uppdaterad: ${v.namn}`),r(v)},[r]),p=Z.useCallback(s=>{const v=s.old.id,w=e.filter(T=>T.id!==v);t(w),fh.error(`Förskola borttagen: ${s.old.Namn}`)},[e,t]);return Z.useEffect(()=>{const s=gn.channel("preschool_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"Förskolor"},c).on("postgres_changes",{event:"UPDATE",schema:"public",table:"Förskolor"},h).on("postgres_changes",{event:"DELETE",schema:"public",table:"Förskolor"},p).subscribe(),v=gn.channel("google_data_changes").on("postgres_changes",{event:"*",schema:"public",table:"preschool_google_data"},T=>{if(console.log("Google data update received:",T),T.eventType==="INSERT"||T.eventType==="UPDATE"){const I=T.new?.preschool_id;if(I){const O=_s.getState().preschools.map(D=>D.id===I?{...D,google_rating:T.new?.google_rating,google_reviews_count:T.new?.google_reviews_count,google_reviews:T.new?.reviews,contact_phone:T.new?.contact_phone,website_url:T.new?.website_url,opening_hours:T.new?.opening_hours}:D);t(O)}}}).subscribe(),w=gn.channel("image_changes").on("postgres_changes",{event:"*",schema:"public",table:"preschool_images"},T=>{console.log("Image update received:",T),fh.info("Nya bilder tillgängliga")}).subscribe();return()=>{gn.removeChannel(s),gn.removeChannel(v),gn.removeChannel(w)}},[c,h,p]),{}},GHe=()=>{const e=Z.useRef(!1),t=Z.useRef(),r=Z.useCallback(async()=>{if(!e.current){e.current=!0;try{const{data:h}=await gn.from("preschool_google_data").select("preschool_id"),p=h?.map(v=>v.preschool_id)||[],{data:s}=await gn.from("Förskolor").select('id, "Namn", "Adress", "Latitud", "Longitud"').not("Latitud","is",null).not("Longitud","is",null).not("id","in",p.length>0?p:["00000000-0000-0000-0000-000000000000"]).limit(8);if(s&&s.length>0)for(const v of s)try{await gn.functions.invoke("google-places-enricher",{body:{preschoolId:v.id,lat:v.Latitud,lng:v.Longitud,address:v.Adress,name:v.Namn}}),await new Promise(w=>setTimeout(w,3e3))}catch(w){console.error(`Silent enrichment error for ${v.id}:`,w)}}catch(h){console.error("Background enrichment error:",h)}finally{e.current=!1,t.current=setTimeout(()=>{r()},10*60*1e3)}}},[]),n=Z.useCallback(()=>{t.current=setTimeout(()=>{r()},3e4)},[r]),c=Z.useCallback(()=>{t.current&&clearTimeout(t.current),e.current=!1},[]);return Z.useEffect(()=>()=>{c()},[c]),{startBackgroundEnrichment:n,stopBackgroundEnrichment:c,isRunning:e.current}},HHe=()=>{const[e,t]=Z.useState(!0),[r,n]=Z.useState(null),{setPreschools:c,setLoading:h}=_s(),{startBackgroundEnrichment:p}=GHe();$He();const s=async()=>{try{t(!0),h(!0),n(null);const{data:v,error:w}=await gn.from("Förskolor").select(`
          id,
          "Namn",
          "Kommun", 
          "Adress",
          "Latitud",
          "Longitud",
          "Antal barn",
          "Huvudman",
          "Personaltäthet",
          "Andel med förskollärarexamen",
          "Antal barngrupper",
          preschool_google_data (
            google_rating,
            google_reviews_count,
            reviews,
            contact_phone,
            website_url,
            opening_hours
          )
        `);if(w)throw w;const T=(v||[]).map(O=>({id:O.id,namn:O.Namn,kommun:O.Kommun,adress:O.Adress||"",latitud:O.Latitud!==null?O.Latitud:null,longitud:O.Longitud!==null?O.Longitud:null,antal_barn:O["Antal barn"],huvudman:O.Huvudman,personaltäthet:O.Personaltäthet,andel_med_förskollärarexamen:O["Andel med förskollärarexamen"],antal_barngrupper:O["Antal barngrupper"],google_rating:O.preschool_google_data?.[0]?.google_rating,google_reviews_count:O.preschool_google_data?.[0]?.google_reviews_count,google_reviews:O.preschool_google_data?.[0]?.reviews,contact_phone:O.preschool_google_data?.[0]?.contact_phone,website_url:O.preschool_google_data?.[0]?.website_url,opening_hours:O.preschool_google_data?.[0]?.opening_hours})),I=T.filter(O=>O.latitud===null||O.longitud===null||O.latitud===0||O.longitud===0);if(I.length>0){console.log(`Found ${I.length} preschools needing geocoding. Triggering background processing...`);const O=I.map(D=>({id:D.id,Namn:D.namn,Adress:D.adress,Kommun:D.kommun,Latitud:D.latitud,Longitud:D.longitud}));gn.functions.invoke("geocoding-service",{body:{preschools:O.slice(0,25)}}).then(D=>{console.log("Geocoding service response:",D)}).catch(D=>{console.error("Geocoding service error:",D)})}console.log(`🗺️ Setting ${T.length} preschools in store for map display`),c(T),console.log(`✅ Successfully loaded and displayed ${T.length} preschools on map`),p()}catch(v){console.error("Error fetching preschools:",v),n(v instanceof Error?v.message:"An error occurred")}finally{t(!1),h(!1)}};return Z.useEffect(()=>{console.log("🚀 Starting immediate preschool data fetch during loading animation..."),s()},[]),{isLoading:e,error:r,refetch:s}},WHe="/assets/preschool-icon-DeZlZPNS.jpg";Z.lazy(()=>tv(()=>Promise.resolve().then(()=>ZGe)).then(e=>({default:e.PreschoolDetailsPanel})));const qHe=()=>{const{isLoading:e,error:t}=HHe(),{searchBoxCollapsed:r,setSearchBoxCollapsed:n}=_s(),{selectedPreschools:c,setIsOpen:h}=Tk(),p=Mre(),[s,v]=Z.useState(!0),[w,T]=Z.useState(!1),[I,O]=Z.useState(!1),[D,B]=Z.useState(!1),N=()=>{v(!1),T(!0)};Z.useEffect(()=>{const U=setTimeout(()=>{s&&(console.warn("Loading animation timeout - showing main content as fallback"),N())},5e3);return()=>clearTimeout(U)},[s]);const G=r;return t?P.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-secondary/20",children:P.jsxs("div",{className:"text-center",children:[P.jsx("h1",{className:"text-2xl font-bold text-destructive mb-2",children:"Ett fel uppstod"}),P.jsx("p",{className:"text-muted-foreground",children:t})]})}):P.jsx(Sxe,{children:P.jsxs(mX,{children:[P.jsx(XGe,{}),P.jsx(UHe,{}),s&&P.jsx(vM,{fallback:P.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background",children:P.jsxs("div",{className:"text-center",children:[P.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Laddar Sveriges Förskolor..."}),P.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto"})]})}),children:P.jsx(Hwe,{onComplete:N})}),P.jsxs(Fr.div,{className:"min-h-screen bg-gradient-to-br from-background via-background to-secondary/10",id:"main-content",initial:{opacity:0},animate:{opacity:s?0:1},transition:{delay:0,duration:.6,ease:"easeOut"},children:[P.jsx(Fr.header,{initial:{opacity:0,y:-15},animate:{opacity:s?0:1,y:0},transition:{delay:0,duration:.4,ease:"easeOut"},className:"relative z-40 bg-white border-b border-border/10",children:P.jsx("div",{className:"container mx-auto px-6 md:px-8 py-4 md:py-6",children:P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{className:"flex items-center space-x-3 md:space-x-5",children:[P.jsx(Fr.img,{src:WHe,alt:"Sveriges Förskolor",className:"w-10 h-10 md:w-14 md:h-14 rounded-2xl shadow-lg hover-lift",whileHover:{scale:1.05},transition:{duration:.2}}),P.jsxs("div",{children:[P.jsx("h1",{className:"text-xl md:text-4xl font-bold text-gradient font-heading leading-tight",children:"Förskolor i Sverige"}),P.jsx("p",{className:"text-sm md:text-base text-muted-foreground font-medium mt-1 md:mt-2 hidden sm:block",children:"Hitta och jämför förskolor – i hela landet"})]})]}),P.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[P.jsxs(Hr,{variant:"outline",size:"lg",className:"items-center gap-3 glass-effect hover-glow-subtle relative border-0 font-semibold",onClick:()=>B(!0),children:[P.jsx(Ah,{className:"w-5 h-5"}),"Statistik"]}),P.jsxs(Hr,{variant:"outline",size:"lg",className:"items-center gap-3 glass-effect hover-glow-subtle relative border-0 font-semibold",onClick:()=>h(!0),children:[P.jsx(Hce,{className:"w-5 h-5"}),"Jämför",c.length>0&&P.jsx(an,{variant:"secondary",className:"absolute -top-2 -right-2 h-6 w-6 p-0 text-sm flex items-center justify-center bg-primary text-primary-foreground",children:c.length})]})]})]})})}),P.jsxs("div",{className:`relative ${p?"pb-16":""}`,children:[!p&&P.jsx(Fr.div,{initial:{opacity:0,x:-20,scale:.95},animate:{opacity:s?0:1,x:0,scale:1},transition:{delay:0,duration:.3,ease:"easeOut"},className:"absolute left-6 top-6 z-30",children:P.jsx(vM,{children:P.jsx(zU,{children:P.jsx(zHe,{})})})}),P.jsx(Fr.div,{initial:{opacity:0,x:20,scale:.95},animate:{opacity:s?0:1,x:0,scale:1},transition:{delay:.1,duration:.3,ease:"easeOut"},children:P.jsx(vM,{children:P.jsx(zU,{children:P.jsx(KGe,{})})})}),P.jsx(Fr.div,{className:`${p?"h-[calc(100vh-64px)]":"h-screen"}`,initial:{opacity:0},animate:{opacity:s?0:1},transition:{delay:.2,duration:.4,ease:"easeOut"},children:P.jsxs(Wwe,{isMapVisible:w,children:[P.jsx(bxe,{className:"w-full h-full"}),P.jsx(Vwe,{}),P.jsx(Uwe,{})]})}),G&&P.jsx("button",{onClick:()=>n(!1),className:"absolute top-4 left-4 z-50 bg-card/95 backdrop-blur-lg shadow-nordic border-border/50 rounded-lg px-3 py-2 text-sm font-medium hover:bg-accent transition-colors",children:"🔍 Sök förskolor"}),P.jsx(Bwe,{isOpen:I,onClose:()=>O(!1)}),P.jsx(Zwe,{}),P.jsx(l1e,{}),P.jsx(VHe,{isOpen:D,onClose:()=>B(!1)}),P.jsx(BGe,{}),P.jsx(BHe,{}),p&&P.jsx(m1e,{}),p&&P.jsx(Fr.div,{initial:{opacity:0,y:15},animate:{opacity:s?0:1,y:0},transition:{delay:.3,duration:.3},className:"fixed bottom-20 left-4 z-40 md:hidden",children:P.jsx(Hr,{variant:"outline",size:"sm",className:"glass-effect hover-glow-subtle border-0 p-3 rounded-full shadow-lg",onClick:()=>B(!0),children:P.jsx(Ah,{className:"w-5 h-5"})})}),P.jsx(FHe,{}),P.jsx(Fr.div,{initial:{opacity:0,y:15,scale:.9},animate:{opacity:s?0:1,y:0,scale:1},transition:{delay:.4,duration:.3,ease:"easeOut"},className:"fixed bottom-6 right-6 z-40",children:P.jsx(qwe,{onClick:()=>O(!0),variant:"outline",size:"lg",className:"glass-effect hover-glow-subtle border-0 p-4 rounded-2xl shadow-nordic",children:P.jsx(GL,{className:"w-6 h-6"})})}),e&&!s&&P.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-background/80 backdrop-blur-lg flex items-center justify-center z-50",children:P.jsxs("div",{className:"text-center",children:[P.jsx(Fr.div,{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4",animate:{rotate:360},transition:{duration:.8,repeat:1/0,ease:"linear"}}),P.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Laddar Sveriges förskolor..."}),P.jsx("p",{className:"text-muted-foreground",children:"Hämtar data från Supabase-databasen"})]})})]})]})]})})},ZHe=()=>{const e=sZ();return Z.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),P.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:P.jsxs("div",{className:"text-center",children:[P.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),P.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),P.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},KHe=new Tfe,XHe=()=>P.jsx(Afe,{client:KHe,children:P.jsxs(efe,{children:[P.jsx(Vue,{}),P.jsx(mhe,{}),P.jsx(fpe,{basename:"/sweden-preschool-spotlight",children:P.jsxs(upe,{children:[P.jsx(fj,{path:"/",element:P.jsx(qHe,{})}),P.jsx(fj,{path:"*",element:P.jsx(ZHe,{})})]})})]})});vq(document.getElementById("root")).render(P.jsx(XHe,{}));
