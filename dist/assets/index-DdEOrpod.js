var Coe=Object.defineProperty;var L5=e=>{throw TypeError(e)};var Ioe=(e,t,r)=>t in e?Coe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ny=(e,t,r)=>Ioe(e,typeof t!="symbol"?t+"":t,r),aM=(e,t,r)=>t.has(e)||L5("Cannot "+r);var qt=(e,t,r)=>(aM(e,t,"read from private field"),r?r.call(e):t.get(e)),bi=(e,t,r)=>t.has(e)?L5("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Fn=(e,t,r,n)=>(aM(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Gs=(e,t,r)=>(aM(e,t,"access private method"),r);var lT=(e,t,r,n)=>({set _(l){Fn(e,t,l,r)},get _(){return qt(e,t,n)}});function Moe(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const l in n)if(l!=="default"&&!(l in e)){const h=Object.getOwnPropertyDescriptor(n,l);h&&Object.defineProperty(e,l,h.get?h:{enumerable:!0,get:()=>n[l]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const h of l)if(h.type==="childList")for(const f of h.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function r(l){const h={};return l.integrity&&(h.integrity=l.integrity),l.referrerPolicy&&(h.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?h.credentials="include":l.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function n(l){if(l.ep)return;l.ep=!0;const h=r(l);fetch(l.href,h)}})();var Ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ooe(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var l=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,l.get?l:{enumerable:!0,get:function(){return e[n]}})}),r}var LH={exports:{}},mA={},jH={exports:{}},si={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zw=Symbol.for("react.element"),koe=Symbol.for("react.portal"),Roe=Symbol.for("react.fragment"),Doe=Symbol.for("react.strict_mode"),Loe=Symbol.for("react.profiler"),joe=Symbol.for("react.provider"),Noe=Symbol.for("react.context"),zoe=Symbol.for("react.forward_ref"),Foe=Symbol.for("react.suspense"),Boe=Symbol.for("react.memo"),$oe=Symbol.for("react.lazy"),j5=Symbol.iterator;function Voe(e){return e===null||typeof e!="object"?null:(e=j5&&e[j5]||e["@@iterator"],typeof e=="function"?e:null)}var NH={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},zH=Object.assign,FH={};function Y_(e,t,r){this.props=e,this.context=t,this.refs=FH,this.updater=r||NH}Y_.prototype.isReactComponent={};Y_.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Y_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function BH(){}BH.prototype=Y_.prototype;function xL(e,t,r){this.props=e,this.context=t,this.refs=FH,this.updater=r||NH}var bL=xL.prototype=new BH;bL.constructor=xL;zH(bL,Y_.prototype);bL.isPureReactComponent=!0;var N5=Array.isArray,$H=Object.prototype.hasOwnProperty,wL={current:null},VH={key:!0,ref:!0,__self:!0,__source:!0};function UH(e,t,r){var n,l={},h=null,f=null;if(t!=null)for(n in t.ref!==void 0&&(f=t.ref),t.key!==void 0&&(h=""+t.key),t)$H.call(t,n)&&!VH.hasOwnProperty(n)&&(l[n]=t[n]);var o=arguments.length-2;if(o===1)l.children=r;else if(1<o){for(var v=Array(o),b=0;b<o;b++)v[b]=arguments[b+2];l.children=v}if(e&&e.defaultProps)for(n in o=e.defaultProps,o)l[n]===void 0&&(l[n]=o[n]);return{$$typeof:zw,type:e,key:h,ref:f,props:l,_owner:wL.current}}function Uoe(e,t){return{$$typeof:zw,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function SL(e){return typeof e=="object"&&e!==null&&e.$$typeof===zw}function Goe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var z5=/\/+/g;function lM(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Goe(""+e.key):t.toString(36)}function iE(e,t,r,n,l){var h=typeof e;(h==="undefined"||h==="boolean")&&(e=null);var f=!1;if(e===null)f=!0;else switch(h){case"string":case"number":f=!0;break;case"object":switch(e.$$typeof){case zw:case koe:f=!0}}if(f)return f=e,l=l(f),e=n===""?"."+lM(f,0):n,N5(l)?(r="",e!=null&&(r=e.replace(z5,"$&/")+"/"),iE(l,t,r,"",function(b){return b})):l!=null&&(SL(l)&&(l=Uoe(l,r+(!l.key||f&&f.key===l.key?"":(""+l.key).replace(z5,"$&/")+"/")+e)),t.push(l)),1;if(f=0,n=n===""?".":n+":",N5(e))for(var o=0;o<e.length;o++){h=e[o];var v=n+lM(h,o);f+=iE(h,t,r,v,l)}else if(v=Voe(e),typeof v=="function")for(e=v.call(e),o=0;!(h=e.next()).done;)h=h.value,v=n+lM(h,o++),f+=iE(h,t,r,v,l);else if(h==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return f}function cT(e,t,r){if(e==null)return e;var n=[],l=0;return iE(e,n,"","",function(h){return t.call(r,h,l++)}),n}function Hoe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var wa={current:null},oE={transition:null},Woe={ReactCurrentDispatcher:wa,ReactCurrentBatchConfig:oE,ReactCurrentOwner:wL};function GH(){throw Error("act(...) is not supported in production builds of React.")}si.Children={map:cT,forEach:function(e,t,r){cT(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return cT(e,function(){t++}),t},toArray:function(e){return cT(e,function(t){return t})||[]},only:function(e){if(!SL(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};si.Component=Y_;si.Fragment=Roe;si.Profiler=Loe;si.PureComponent=xL;si.StrictMode=Doe;si.Suspense=Foe;si.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Woe;si.act=GH;si.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=zH({},e.props),l=e.key,h=e.ref,f=e._owner;if(t!=null){if(t.ref!==void 0&&(h=t.ref,f=wL.current),t.key!==void 0&&(l=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(v in t)$H.call(t,v)&&!VH.hasOwnProperty(v)&&(n[v]=t[v]===void 0&&o!==void 0?o[v]:t[v])}var v=arguments.length-2;if(v===1)n.children=r;else if(1<v){o=Array(v);for(var b=0;b<v;b++)o[b]=arguments[b+2];n.children=o}return{$$typeof:zw,type:e.type,key:l,ref:h,props:n,_owner:f}};si.createContext=function(e){return e={$$typeof:Noe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:joe,_context:e},e.Consumer=e};si.createElement=UH;si.createFactory=function(e){var t=UH.bind(null,e);return t.type=e,t};si.createRef=function(){return{current:null}};si.forwardRef=function(e){return{$$typeof:zoe,render:e}};si.isValidElement=SL;si.lazy=function(e){return{$$typeof:$oe,_payload:{_status:-1,_result:e},_init:Hoe}};si.memo=function(e,t){return{$$typeof:Boe,type:e,compare:t===void 0?null:t}};si.startTransition=function(e){var t=oE.transition;oE.transition={};try{e()}finally{oE.transition=t}};si.unstable_act=GH;si.useCallback=function(e,t){return wa.current.useCallback(e,t)};si.useContext=function(e){return wa.current.useContext(e)};si.useDebugValue=function(){};si.useDeferredValue=function(e){return wa.current.useDeferredValue(e)};si.useEffect=function(e,t){return wa.current.useEffect(e,t)};si.useId=function(){return wa.current.useId()};si.useImperativeHandle=function(e,t,r){return wa.current.useImperativeHandle(e,t,r)};si.useInsertionEffect=function(e,t){return wa.current.useInsertionEffect(e,t)};si.useLayoutEffect=function(e,t){return wa.current.useLayoutEffect(e,t)};si.useMemo=function(e,t){return wa.current.useMemo(e,t)};si.useReducer=function(e,t,r){return wa.current.useReducer(e,t,r)};si.useRef=function(e){return wa.current.useRef(e)};si.useState=function(e){return wa.current.useState(e)};si.useSyncExternalStore=function(e,t,r){return wa.current.useSyncExternalStore(e,t,r)};si.useTransition=function(){return wa.current.useTransition()};si.version="18.3.1";jH.exports=si;var K=jH.exports;const ze=Pi(K),TL=Moe({__proto__:null,default:ze},[K]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qoe=K,Zoe=Symbol.for("react.element"),Xoe=Symbol.for("react.fragment"),Koe=Object.prototype.hasOwnProperty,Yoe=qoe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Joe={key:!0,ref:!0,__self:!0,__source:!0};function HH(e,t,r){var n,l={},h=null,f=null;r!==void 0&&(h=""+r),t.key!==void 0&&(h=""+t.key),t.ref!==void 0&&(f=t.ref);for(n in t)Koe.call(t,n)&&!Joe.hasOwnProperty(n)&&(l[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)l[n]===void 0&&(l[n]=t[n]);return{$$typeof:Zoe,type:e,key:h,ref:f,props:l,_owner:Yoe.current}}mA.Fragment=Xoe;mA.jsx=HH;mA.jsxs=HH;LH.exports=mA;var M=LH.exports,WH={exports:{}},pl={},qH={exports:{}},ZH={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Ze,nt){var pt=Ze.length;Ze.push(nt);e:for(;0<pt;){var _t=pt-1>>>1,It=Ze[_t];if(0<l(It,nt))Ze[_t]=nt,Ze[pt]=It,pt=_t;else break e}}function r(Ze){return Ze.length===0?null:Ze[0]}function n(Ze){if(Ze.length===0)return null;var nt=Ze[0],pt=Ze.pop();if(pt!==nt){Ze[0]=pt;e:for(var _t=0,It=Ze.length,sr=It>>>1;_t<sr;){var Sr=2*(_t+1)-1,Kr=Ze[Sr],Er=Sr+1,Kt=Ze[Er];if(0>l(Kr,pt))Er<It&&0>l(Kt,Kr)?(Ze[_t]=Kt,Ze[Er]=pt,_t=Er):(Ze[_t]=Kr,Ze[Sr]=pt,_t=Sr);else if(Er<It&&0>l(Kt,pt))Ze[_t]=Kt,Ze[Er]=pt,_t=Er;else break e}}return nt}function l(Ze,nt){var pt=Ze.sortIndex-nt.sortIndex;return pt!==0?pt:Ze.id-nt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;e.unstable_now=function(){return h.now()}}else{var f=Date,o=f.now();e.unstable_now=function(){return f.now()-o}}var v=[],b=[],E=1,P=null,O=3,L=!1,B=!1,z=!1,$=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,G=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(Ze){for(var nt=r(b);nt!==null;){if(nt.callback===null)n(b);else if(nt.startTime<=Ze)n(b),nt.sortIndex=nt.expirationTime,t(v,nt);else break;nt=r(b)}}function ne(Ze){if(z=!1,Z(Ze),!B)if(r(v)!==null)B=!0,Je(Y);else{var nt=r(b);nt!==null&&it(ne,nt.startTime-Ze)}}function Y(Ze,nt){B=!1,z&&(z=!1,U(fe),fe=-1),L=!0;var pt=O;try{for(Z(nt),P=r(v);P!==null&&(!(P.expirationTime>nt)||Ze&&!Me());){var _t=P.callback;if(typeof _t=="function"){P.callback=null,O=P.priorityLevel;var It=_t(P.expirationTime<=nt);nt=e.unstable_now(),typeof It=="function"?P.callback=It:P===r(v)&&n(v),Z(nt)}else n(v);P=r(v)}if(P!==null)var sr=!0;else{var Sr=r(b);Sr!==null&&it(ne,Sr.startTime-nt),sr=!1}return sr}finally{P=null,O=pt,L=!1}}var ee=!1,le=null,fe=-1,Ce=5,Oe=-1;function Me(){return!(e.unstable_now()-Oe<Ce)}function Ke(){if(le!==null){var Ze=e.unstable_now();Oe=Ze;var nt=!0;try{nt=le(!0,Ze)}finally{nt?Ye():(ee=!1,le=null)}}else ee=!1}var Ye;if(typeof G=="function")Ye=function(){G(Ke)};else if(typeof MessageChannel<"u"){var Le=new MessageChannel,Qe=Le.port2;Le.port1.onmessage=Ke,Ye=function(){Qe.postMessage(null)}}else Ye=function(){$(Ke,0)};function Je(Ze){le=Ze,ee||(ee=!0,Ye())}function it(Ze,nt){fe=$(function(){Ze(e.unstable_now())},nt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ze){Ze.callback=null},e.unstable_continueExecution=function(){B||L||(B=!0,Je(Y))},e.unstable_forceFrameRate=function(Ze){0>Ze||125<Ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ce=0<Ze?Math.floor(1e3/Ze):5},e.unstable_getCurrentPriorityLevel=function(){return O},e.unstable_getFirstCallbackNode=function(){return r(v)},e.unstable_next=function(Ze){switch(O){case 1:case 2:case 3:var nt=3;break;default:nt=O}var pt=O;O=nt;try{return Ze()}finally{O=pt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ze,nt){switch(Ze){case 1:case 2:case 3:case 4:case 5:break;default:Ze=3}var pt=O;O=Ze;try{return nt()}finally{O=pt}},e.unstable_scheduleCallback=function(Ze,nt,pt){var _t=e.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?_t+pt:_t):pt=_t,Ze){case 1:var It=-1;break;case 2:It=250;break;case 5:It=1073741823;break;case 4:It=1e4;break;default:It=5e3}return It=pt+It,Ze={id:E++,callback:nt,priorityLevel:Ze,startTime:pt,expirationTime:It,sortIndex:-1},pt>_t?(Ze.sortIndex=pt,t(b,Ze),r(v)===null&&Ze===r(b)&&(z?(U(fe),fe=-1):z=!0,it(ne,pt-_t))):(Ze.sortIndex=It,t(v,Ze),B||L||(B=!0,Je(Y))),Ze},e.unstable_shouldYield=Me,e.unstable_wrapCallback=function(Ze){var nt=O;return function(){var pt=O;O=nt;try{return Ze.apply(this,arguments)}finally{O=pt}}}})(ZH);qH.exports=ZH;var Qoe=qH.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ese=K,fl=Qoe;function cr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var XH=new Set,Pb={};function Cm(e,t){d_(e,t),d_(e+"Capture",t)}function d_(e,t){for(Pb[e]=t,e=0;e<t.length;e++)XH.add(t[e])}var vh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qO=Object.prototype.hasOwnProperty,tse=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,F5={},B5={};function rse(e){return qO.call(B5,e)?!0:qO.call(F5,e)?!1:tse.test(e)?B5[e]=!0:(F5[e]=!0,!1)}function nse(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function ise(e,t,r,n){if(t===null||typeof t>"u"||nse(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Sa(e,t,r,n,l,h,f){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=l,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=h,this.removeEmptyString=f}var Ns={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ns[e]=new Sa(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ns[t]=new Sa(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ns[e]=new Sa(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ns[e]=new Sa(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ns[e]=new Sa(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ns[e]=new Sa(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ns[e]=new Sa(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ns[e]=new Sa(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ns[e]=new Sa(e,5,!1,e.toLowerCase(),null,!1,!1)});var EL=/[\-:]([a-z])/g;function AL(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(EL,AL);Ns[t]=new Sa(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(EL,AL);Ns[t]=new Sa(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(EL,AL);Ns[t]=new Sa(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ns[e]=new Sa(e,1,!1,e.toLowerCase(),null,!1,!1)});Ns.xlinkHref=new Sa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ns[e]=new Sa(e,1,!1,e.toLowerCase(),null,!0,!0)});function PL(e,t,r,n){var l=Ns.hasOwnProperty(t)?Ns[t]:null;(l!==null?l.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(ise(t,r,l,n)&&(r=null),n||l===null?rse(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):l.mustUseProperty?e[l.propertyName]=r===null?l.type===3?!1:"":r:(t=l.attributeName,n=l.attributeNamespace,r===null?e.removeAttribute(t):(l=l.type,r=l===3||l===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Dh=ese.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,uT=Symbol.for("react.element"),_y=Symbol.for("react.portal"),vy=Symbol.for("react.fragment"),CL=Symbol.for("react.strict_mode"),ZO=Symbol.for("react.profiler"),KH=Symbol.for("react.provider"),YH=Symbol.for("react.context"),IL=Symbol.for("react.forward_ref"),XO=Symbol.for("react.suspense"),KO=Symbol.for("react.suspense_list"),ML=Symbol.for("react.memo"),Fd=Symbol.for("react.lazy"),JH=Symbol.for("react.offscreen"),$5=Symbol.iterator;function wx(e){return e===null||typeof e!="object"?null:(e=$5&&e[$5]||e["@@iterator"],typeof e=="function"?e:null)}var _o=Object.assign,cM;function Wx(e){if(cM===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);cM=t&&t[1]||""}return`
`+cM+e}var uM=!1;function hM(e,t){if(!e||uM)return"";uM=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(b){var n=b}Reflect.construct(e,[],t)}else{try{t.call()}catch(b){n=b}e.call(t.prototype)}else{try{throw Error()}catch(b){n=b}e()}}catch(b){if(b&&n&&typeof b.stack=="string"){for(var l=b.stack.split(`
`),h=n.stack.split(`
`),f=l.length-1,o=h.length-1;1<=f&&0<=o&&l[f]!==h[o];)o--;for(;1<=f&&0<=o;f--,o--)if(l[f]!==h[o]){if(f!==1||o!==1)do if(f--,o--,0>o||l[f]!==h[o]){var v=`
`+l[f].replace(" at new "," at ");return e.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",e.displayName)),v}while(1<=f&&0<=o);break}}}finally{uM=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Wx(e):""}function ose(e){switch(e.tag){case 5:return Wx(e.type);case 16:return Wx("Lazy");case 13:return Wx("Suspense");case 19:return Wx("SuspenseList");case 0:case 2:case 15:return e=hM(e.type,!1),e;case 11:return e=hM(e.type.render,!1),e;case 1:return e=hM(e.type,!0),e;default:return""}}function YO(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case vy:return"Fragment";case _y:return"Portal";case ZO:return"Profiler";case CL:return"StrictMode";case XO:return"Suspense";case KO:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case YH:return(e.displayName||"Context")+".Consumer";case KH:return(e._context.displayName||"Context")+".Provider";case IL:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ML:return t=e.displayName||null,t!==null?t:YO(e.type)||"Memo";case Fd:t=e._payload,e=e._init;try{return YO(e(t))}catch{}}return null}function sse(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return YO(t);case 8:return t===CL?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function mf(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function QH(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ase(e){var t=QH(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var l=r.get,h=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return l.call(this)},set:function(f){n=""+f,h.call(this,f)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(f){n=""+f},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function hT(e){e._valueTracker||(e._valueTracker=ase(e))}function eW(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=QH(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function PE(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function JO(e,t){var r=t.checked;return _o({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function V5(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=mf(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function tW(e,t){t=t.checked,t!=null&&PL(e,"checked",t,!1)}function QO(e,t){tW(e,t);var r=mf(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?ek(e,t.type,r):t.hasOwnProperty("defaultValue")&&ek(e,t.type,mf(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function U5(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function ek(e,t,r){(t!=="number"||PE(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var qx=Array.isArray;function By(e,t,r,n){if(e=e.options,t){t={};for(var l=0;l<r.length;l++)t["$"+r[l]]=!0;for(r=0;r<e.length;r++)l=t.hasOwnProperty("$"+e[r].value),e[r].selected!==l&&(e[r].selected=l),l&&n&&(e[r].defaultSelected=!0)}else{for(r=""+mf(r),t=null,l=0;l<e.length;l++){if(e[l].value===r){e[l].selected=!0,n&&(e[l].defaultSelected=!0);return}t!==null||e[l].disabled||(t=e[l])}t!==null&&(t.selected=!0)}}function tk(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(cr(91));return _o({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function G5(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(cr(92));if(qx(r)){if(1<r.length)throw Error(cr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:mf(r)}}function rW(e,t){var r=mf(t.value),n=mf(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function H5(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function nW(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rk(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?nW(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var dT,iW=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,l){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,l)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(dT=dT||document.createElement("div"),dT.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=dT.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Cb(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var tb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lse=["Webkit","ms","Moz","O"];Object.keys(tb).forEach(function(e){lse.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),tb[t]=tb[e]})});function oW(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||tb.hasOwnProperty(e)&&tb[e]?(""+t).trim():t+"px"}function sW(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,l=oW(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,l):e[r]=l}}var cse=_o({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function nk(e,t){if(t){if(cse[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(cr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(cr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(cr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(cr(62))}}function ik(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ok=null;function OL(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var sk=null,$y=null,Vy=null;function W5(e){if(e=$w(e)){if(typeof sk!="function")throw Error(cr(280));var t=e.stateNode;t&&(t=xA(t),sk(e.stateNode,e.type,t))}}function aW(e){$y?Vy?Vy.push(e):Vy=[e]:$y=e}function lW(){if($y){var e=$y,t=Vy;if(Vy=$y=null,W5(e),t)for(e=0;e<t.length;e++)W5(t[e])}}function cW(e,t){return e(t)}function uW(){}var dM=!1;function hW(e,t,r){if(dM)return e(t,r);dM=!0;try{return cW(e,t,r)}finally{dM=!1,($y!==null||Vy!==null)&&(uW(),lW())}}function Ib(e,t){var r=e.stateNode;if(r===null)return null;var n=xA(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(cr(231,t,typeof r));return r}var ak=!1;if(vh)try{var Sx={};Object.defineProperty(Sx,"passive",{get:function(){ak=!0}}),window.addEventListener("test",Sx,Sx),window.removeEventListener("test",Sx,Sx)}catch{ak=!1}function use(e,t,r,n,l,h,f,o,v){var b=Array.prototype.slice.call(arguments,3);try{t.apply(r,b)}catch(E){this.onError(E)}}var rb=!1,CE=null,IE=!1,lk=null,hse={onError:function(e){rb=!0,CE=e}};function dse(e,t,r,n,l,h,f,o,v){rb=!1,CE=null,use.apply(hse,arguments)}function fse(e,t,r,n,l,h,f,o,v){if(dse.apply(this,arguments),rb){if(rb){var b=CE;rb=!1,CE=null}else throw Error(cr(198));IE||(IE=!0,lk=b)}}function Im(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function dW(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function q5(e){if(Im(e)!==e)throw Error(cr(188))}function pse(e){var t=e.alternate;if(!t){if(t=Im(e),t===null)throw Error(cr(188));return t!==e?null:e}for(var r=e,n=t;;){var l=r.return;if(l===null)break;var h=l.alternate;if(h===null){if(n=l.return,n!==null){r=n;continue}break}if(l.child===h.child){for(h=l.child;h;){if(h===r)return q5(l),e;if(h===n)return q5(l),t;h=h.sibling}throw Error(cr(188))}if(r.return!==n.return)r=l,n=h;else{for(var f=!1,o=l.child;o;){if(o===r){f=!0,r=l,n=h;break}if(o===n){f=!0,n=l,r=h;break}o=o.sibling}if(!f){for(o=h.child;o;){if(o===r){f=!0,r=h,n=l;break}if(o===n){f=!0,n=h,r=l;break}o=o.sibling}if(!f)throw Error(cr(189))}}if(r.alternate!==n)throw Error(cr(190))}if(r.tag!==3)throw Error(cr(188));return r.stateNode.current===r?e:t}function fW(e){return e=pse(e),e!==null?pW(e):null}function pW(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=pW(e);if(t!==null)return t;e=e.sibling}return null}var mW=fl.unstable_scheduleCallback,Z5=fl.unstable_cancelCallback,mse=fl.unstable_shouldYield,gse=fl.unstable_requestPaint,Do=fl.unstable_now,yse=fl.unstable_getCurrentPriorityLevel,kL=fl.unstable_ImmediatePriority,gW=fl.unstable_UserBlockingPriority,ME=fl.unstable_NormalPriority,_se=fl.unstable_LowPriority,yW=fl.unstable_IdlePriority,gA=null,mu=null;function vse(e){if(mu&&typeof mu.onCommitFiberRoot=="function")try{mu.onCommitFiberRoot(gA,e,void 0,(e.current.flags&128)===128)}catch{}}var vc=Math.clz32?Math.clz32:wse,xse=Math.log,bse=Math.LN2;function wse(e){return e>>>=0,e===0?32:31-(xse(e)/bse|0)|0}var fT=64,pT=4194304;function Zx(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function OE(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,l=e.suspendedLanes,h=e.pingedLanes,f=r&268435455;if(f!==0){var o=f&~l;o!==0?n=Zx(o):(h&=f,h!==0&&(n=Zx(h)))}else f=r&~l,f!==0?n=Zx(f):h!==0&&(n=Zx(h));if(n===0)return 0;if(t!==0&&t!==n&&!(t&l)&&(l=n&-n,h=t&-t,l>=h||l===16&&(h&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-vc(t),l=1<<r,n|=e[r],t&=~l;return n}function Sse(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Tse(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,l=e.expirationTimes,h=e.pendingLanes;0<h;){var f=31-vc(h),o=1<<f,v=l[f];v===-1?(!(o&r)||o&n)&&(l[f]=Sse(o,t)):v<=t&&(e.expiredLanes|=o),h&=~o}}function ck(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function _W(){var e=fT;return fT<<=1,!(fT&4194240)&&(fT=64),e}function fM(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Fw(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-vc(t),e[t]=r}function Ese(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var l=31-vc(r),h=1<<l;t[l]=0,n[l]=-1,e[l]=-1,r&=~h}}function RL(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-vc(r),l=1<<n;l&t|e[n]&t&&(e[n]|=t),r&=~l}}var ji=0;function vW(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var xW,DL,bW,wW,SW,uk=!1,mT=[],nf=null,of=null,sf=null,Mb=new Map,Ob=new Map,Gd=[],Ase="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function X5(e,t){switch(e){case"focusin":case"focusout":nf=null;break;case"dragenter":case"dragleave":of=null;break;case"mouseover":case"mouseout":sf=null;break;case"pointerover":case"pointerout":Mb.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ob.delete(t.pointerId)}}function Tx(e,t,r,n,l,h){return e===null||e.nativeEvent!==h?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:h,targetContainers:[l]},t!==null&&(t=$w(t),t!==null&&DL(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,l!==null&&t.indexOf(l)===-1&&t.push(l),e)}function Pse(e,t,r,n,l){switch(t){case"focusin":return nf=Tx(nf,e,t,r,n,l),!0;case"dragenter":return of=Tx(of,e,t,r,n,l),!0;case"mouseover":return sf=Tx(sf,e,t,r,n,l),!0;case"pointerover":var h=l.pointerId;return Mb.set(h,Tx(Mb.get(h)||null,e,t,r,n,l)),!0;case"gotpointercapture":return h=l.pointerId,Ob.set(h,Tx(Ob.get(h)||null,e,t,r,n,l)),!0}return!1}function TW(e){var t=Gp(e.target);if(t!==null){var r=Im(t);if(r!==null){if(t=r.tag,t===13){if(t=dW(r),t!==null){e.blockedOn=t,SW(e.priority,function(){bW(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function sE(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=hk(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);ok=n,r.target.dispatchEvent(n),ok=null}else return t=$w(r),t!==null&&DL(t),e.blockedOn=r,!1;t.shift()}return!0}function K5(e,t,r){sE(e)&&r.delete(t)}function Cse(){uk=!1,nf!==null&&sE(nf)&&(nf=null),of!==null&&sE(of)&&(of=null),sf!==null&&sE(sf)&&(sf=null),Mb.forEach(K5),Ob.forEach(K5)}function Ex(e,t){e.blockedOn===t&&(e.blockedOn=null,uk||(uk=!0,fl.unstable_scheduleCallback(fl.unstable_NormalPriority,Cse)))}function kb(e){function t(l){return Ex(l,e)}if(0<mT.length){Ex(mT[0],e);for(var r=1;r<mT.length;r++){var n=mT[r];n.blockedOn===e&&(n.blockedOn=null)}}for(nf!==null&&Ex(nf,e),of!==null&&Ex(of,e),sf!==null&&Ex(sf,e),Mb.forEach(t),Ob.forEach(t),r=0;r<Gd.length;r++)n=Gd[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Gd.length&&(r=Gd[0],r.blockedOn===null);)TW(r),r.blockedOn===null&&Gd.shift()}var Uy=Dh.ReactCurrentBatchConfig,kE=!0;function Ise(e,t,r,n){var l=ji,h=Uy.transition;Uy.transition=null;try{ji=1,LL(e,t,r,n)}finally{ji=l,Uy.transition=h}}function Mse(e,t,r,n){var l=ji,h=Uy.transition;Uy.transition=null;try{ji=4,LL(e,t,r,n)}finally{ji=l,Uy.transition=h}}function LL(e,t,r,n){if(kE){var l=hk(e,t,r,n);if(l===null)SM(e,t,n,RE,r),X5(e,n);else if(Pse(l,e,t,r,n))n.stopPropagation();else if(X5(e,n),t&4&&-1<Ase.indexOf(e)){for(;l!==null;){var h=$w(l);if(h!==null&&xW(h),h=hk(e,t,r,n),h===null&&SM(e,t,n,RE,r),h===l)break;l=h}l!==null&&n.stopPropagation()}else SM(e,t,n,null,r)}}var RE=null;function hk(e,t,r,n){if(RE=null,e=OL(n),e=Gp(e),e!==null)if(t=Im(e),t===null)e=null;else if(r=t.tag,r===13){if(e=dW(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return RE=e,null}function EW(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yse()){case kL:return 1;case gW:return 4;case ME:case _se:return 16;case yW:return 536870912;default:return 16}default:return 16}}var Qd=null,jL=null,aE=null;function AW(){if(aE)return aE;var e,t=jL,r=t.length,n,l="value"in Qd?Qd.value:Qd.textContent,h=l.length;for(e=0;e<r&&t[e]===l[e];e++);var f=r-e;for(n=1;n<=f&&t[r-n]===l[h-n];n++);return aE=l.slice(e,1<n?1-n:void 0)}function lE(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function gT(){return!0}function Y5(){return!1}function ml(e){function t(r,n,l,h,f){this._reactName=r,this._targetInst=l,this.type=n,this.nativeEvent=h,this.target=f,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(r=e[o],this[o]=r?r(h):h[o]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?gT:Y5,this.isPropagationStopped=Y5,this}return _o(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=gT)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=gT)},persist:function(){},isPersistent:gT}),t}var J_={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},NL=ml(J_),Bw=_o({},J_,{view:0,detail:0}),Ose=ml(Bw),pM,mM,Ax,yA=_o({},Bw,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zL,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ax&&(Ax&&e.type==="mousemove"?(pM=e.screenX-Ax.screenX,mM=e.screenY-Ax.screenY):mM=pM=0,Ax=e),pM)},movementY:function(e){return"movementY"in e?e.movementY:mM}}),J5=ml(yA),kse=_o({},yA,{dataTransfer:0}),Rse=ml(kse),Dse=_o({},Bw,{relatedTarget:0}),gM=ml(Dse),Lse=_o({},J_,{animationName:0,elapsedTime:0,pseudoElement:0}),jse=ml(Lse),Nse=_o({},J_,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),zse=ml(Nse),Fse=_o({},J_,{data:0}),Q5=ml(Fse),Bse={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$se={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Vse={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Use(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Vse[e])?!!t[e]:!1}function zL(){return Use}var Gse=_o({},Bw,{key:function(e){if(e.key){var t=Bse[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=lE(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?$se[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zL,charCode:function(e){return e.type==="keypress"?lE(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?lE(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Hse=ml(Gse),Wse=_o({},yA,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),e4=ml(Wse),qse=_o({},Bw,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zL}),Zse=ml(qse),Xse=_o({},J_,{propertyName:0,elapsedTime:0,pseudoElement:0}),Kse=ml(Xse),Yse=_o({},yA,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Jse=ml(Yse),Qse=[9,13,27,32],FL=vh&&"CompositionEvent"in window,nb=null;vh&&"documentMode"in document&&(nb=document.documentMode);var eae=vh&&"TextEvent"in window&&!nb,PW=vh&&(!FL||nb&&8<nb&&11>=nb),t4=" ",r4=!1;function CW(e,t){switch(e){case"keyup":return Qse.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function IW(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var xy=!1;function tae(e,t){switch(e){case"compositionend":return IW(t);case"keypress":return t.which!==32?null:(r4=!0,t4);case"textInput":return e=t.data,e===t4&&r4?null:e;default:return null}}function rae(e,t){if(xy)return e==="compositionend"||!FL&&CW(e,t)?(e=AW(),aE=jL=Qd=null,xy=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return PW&&t.locale!=="ko"?null:t.data;default:return null}}var nae={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function n4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!nae[e.type]:t==="textarea"}function MW(e,t,r,n){aW(n),t=DE(t,"onChange"),0<t.length&&(r=new NL("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var ib=null,Rb=null;function iae(e){$W(e,0)}function _A(e){var t=Sy(e);if(eW(t))return e}function oae(e,t){if(e==="change")return t}var OW=!1;if(vh){var yM;if(vh){var _M="oninput"in document;if(!_M){var i4=document.createElement("div");i4.setAttribute("oninput","return;"),_M=typeof i4.oninput=="function"}yM=_M}else yM=!1;OW=yM&&(!document.documentMode||9<document.documentMode)}function o4(){ib&&(ib.detachEvent("onpropertychange",kW),Rb=ib=null)}function kW(e){if(e.propertyName==="value"&&_A(Rb)){var t=[];MW(t,Rb,e,OL(e)),hW(iae,t)}}function sae(e,t,r){e==="focusin"?(o4(),ib=t,Rb=r,ib.attachEvent("onpropertychange",kW)):e==="focusout"&&o4()}function aae(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return _A(Rb)}function lae(e,t){if(e==="click")return _A(t)}function cae(e,t){if(e==="input"||e==="change")return _A(t)}function uae(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var wc=typeof Object.is=="function"?Object.is:uae;function Db(e,t){if(wc(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var l=r[n];if(!qO.call(t,l)||!wc(e[l],t[l]))return!1}return!0}function s4(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function a4(e,t){var r=s4(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=s4(r)}}function RW(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?RW(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function DW(){for(var e=window,t=PE();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=PE(e.document)}return t}function BL(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function hae(e){var t=DW(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&RW(r.ownerDocument.documentElement,r)){if(n!==null&&BL(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var l=r.textContent.length,h=Math.min(n.start,l);n=n.end===void 0?h:Math.min(n.end,l),!e.extend&&h>n&&(l=n,n=h,h=l),l=a4(r,h);var f=a4(r,n);l&&f&&(e.rangeCount!==1||e.anchorNode!==l.node||e.anchorOffset!==l.offset||e.focusNode!==f.node||e.focusOffset!==f.offset)&&(t=t.createRange(),t.setStart(l.node,l.offset),e.removeAllRanges(),h>n?(e.addRange(t),e.extend(f.node,f.offset)):(t.setEnd(f.node,f.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var dae=vh&&"documentMode"in document&&11>=document.documentMode,by=null,dk=null,ob=null,fk=!1;function l4(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;fk||by==null||by!==PE(n)||(n=by,"selectionStart"in n&&BL(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ob&&Db(ob,n)||(ob=n,n=DE(dk,"onSelect"),0<n.length&&(t=new NL("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=by)))}function yT(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var wy={animationend:yT("Animation","AnimationEnd"),animationiteration:yT("Animation","AnimationIteration"),animationstart:yT("Animation","AnimationStart"),transitionend:yT("Transition","TransitionEnd")},vM={},LW={};vh&&(LW=document.createElement("div").style,"AnimationEvent"in window||(delete wy.animationend.animation,delete wy.animationiteration.animation,delete wy.animationstart.animation),"TransitionEvent"in window||delete wy.transitionend.transition);function vA(e){if(vM[e])return vM[e];if(!wy[e])return e;var t=wy[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in LW)return vM[e]=t[r];return e}var jW=vA("animationend"),NW=vA("animationiteration"),zW=vA("animationstart"),FW=vA("transitionend"),BW=new Map,c4="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xf(e,t){BW.set(e,t),Cm(t,[e])}for(var xM=0;xM<c4.length;xM++){var bM=c4[xM],fae=bM.toLowerCase(),pae=bM[0].toUpperCase()+bM.slice(1);xf(fae,"on"+pae)}xf(jW,"onAnimationEnd");xf(NW,"onAnimationIteration");xf(zW,"onAnimationStart");xf("dblclick","onDoubleClick");xf("focusin","onFocus");xf("focusout","onBlur");xf(FW,"onTransitionEnd");d_("onMouseEnter",["mouseout","mouseover"]);d_("onMouseLeave",["mouseout","mouseover"]);d_("onPointerEnter",["pointerout","pointerover"]);d_("onPointerLeave",["pointerout","pointerover"]);Cm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Cm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Cm("onBeforeInput",["compositionend","keypress","textInput","paste"]);Cm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Cm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Cm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xx="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mae=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xx));function u4(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,fse(n,t,void 0,e),e.currentTarget=null}function $W(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],l=n.event;n=n.listeners;e:{var h=void 0;if(t)for(var f=n.length-1;0<=f;f--){var o=n[f],v=o.instance,b=o.currentTarget;if(o=o.listener,v!==h&&l.isPropagationStopped())break e;u4(l,o,b),h=v}else for(f=0;f<n.length;f++){if(o=n[f],v=o.instance,b=o.currentTarget,o=o.listener,v!==h&&l.isPropagationStopped())break e;u4(l,o,b),h=v}}}if(IE)throw e=lk,IE=!1,lk=null,e}function no(e,t){var r=t[_k];r===void 0&&(r=t[_k]=new Set);var n=e+"__bubble";r.has(n)||(VW(t,e,2,!1),r.add(n))}function wM(e,t,r){var n=0;t&&(n|=4),VW(r,e,n,t)}var _T="_reactListening"+Math.random().toString(36).slice(2);function Lb(e){if(!e[_T]){e[_T]=!0,XH.forEach(function(r){r!=="selectionchange"&&(mae.has(r)||wM(r,!1,e),wM(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[_T]||(t[_T]=!0,wM("selectionchange",!1,t))}}function VW(e,t,r,n){switch(EW(t)){case 1:var l=Ise;break;case 4:l=Mse;break;default:l=LL}r=l.bind(null,t,r,e),l=void 0,!ak||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(l=!0),n?l!==void 0?e.addEventListener(t,r,{capture:!0,passive:l}):e.addEventListener(t,r,!0):l!==void 0?e.addEventListener(t,r,{passive:l}):e.addEventListener(t,r,!1)}function SM(e,t,r,n,l){var h=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var f=n.tag;if(f===3||f===4){var o=n.stateNode.containerInfo;if(o===l||o.nodeType===8&&o.parentNode===l)break;if(f===4)for(f=n.return;f!==null;){var v=f.tag;if((v===3||v===4)&&(v=f.stateNode.containerInfo,v===l||v.nodeType===8&&v.parentNode===l))return;f=f.return}for(;o!==null;){if(f=Gp(o),f===null)return;if(v=f.tag,v===5||v===6){n=h=f;continue e}o=o.parentNode}}n=n.return}hW(function(){var b=h,E=OL(r),P=[];e:{var O=BW.get(e);if(O!==void 0){var L=NL,B=e;switch(e){case"keypress":if(lE(r)===0)break e;case"keydown":case"keyup":L=Hse;break;case"focusin":B="focus",L=gM;break;case"focusout":B="blur",L=gM;break;case"beforeblur":case"afterblur":L=gM;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L=J5;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L=Rse;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L=Zse;break;case jW:case NW:case zW:L=jse;break;case FW:L=Kse;break;case"scroll":L=Ose;break;case"wheel":L=Jse;break;case"copy":case"cut":case"paste":L=zse;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L=e4}var z=(t&4)!==0,$=!z&&e==="scroll",U=z?O!==null?O+"Capture":null:O;z=[];for(var G=b,Z;G!==null;){Z=G;var ne=Z.stateNode;if(Z.tag===5&&ne!==null&&(Z=ne,U!==null&&(ne=Ib(G,U),ne!=null&&z.push(jb(G,ne,Z)))),$)break;G=G.return}0<z.length&&(O=new L(O,B,null,r,E),P.push({event:O,listeners:z}))}}if(!(t&7)){e:{if(O=e==="mouseover"||e==="pointerover",L=e==="mouseout"||e==="pointerout",O&&r!==ok&&(B=r.relatedTarget||r.fromElement)&&(Gp(B)||B[xh]))break e;if((L||O)&&(O=E.window===E?E:(O=E.ownerDocument)?O.defaultView||O.parentWindow:window,L?(B=r.relatedTarget||r.toElement,L=b,B=B?Gp(B):null,B!==null&&($=Im(B),B!==$||B.tag!==5&&B.tag!==6)&&(B=null)):(L=null,B=b),L!==B)){if(z=J5,ne="onMouseLeave",U="onMouseEnter",G="mouse",(e==="pointerout"||e==="pointerover")&&(z=e4,ne="onPointerLeave",U="onPointerEnter",G="pointer"),$=L==null?O:Sy(L),Z=B==null?O:Sy(B),O=new z(ne,G+"leave",L,r,E),O.target=$,O.relatedTarget=Z,ne=null,Gp(E)===b&&(z=new z(U,G+"enter",B,r,E),z.target=Z,z.relatedTarget=$,ne=z),$=ne,L&&B)t:{for(z=L,U=B,G=0,Z=z;Z;Z=iy(Z))G++;for(Z=0,ne=U;ne;ne=iy(ne))Z++;for(;0<G-Z;)z=iy(z),G--;for(;0<Z-G;)U=iy(U),Z--;for(;G--;){if(z===U||U!==null&&z===U.alternate)break t;z=iy(z),U=iy(U)}z=null}else z=null;L!==null&&h4(P,O,L,z,!1),B!==null&&$!==null&&h4(P,$,B,z,!0)}}e:{if(O=b?Sy(b):window,L=O.nodeName&&O.nodeName.toLowerCase(),L==="select"||L==="input"&&O.type==="file")var Y=oae;else if(n4(O))if(OW)Y=cae;else{Y=aae;var ee=sae}else(L=O.nodeName)&&L.toLowerCase()==="input"&&(O.type==="checkbox"||O.type==="radio")&&(Y=lae);if(Y&&(Y=Y(e,b))){MW(P,Y,r,E);break e}ee&&ee(e,O,b),e==="focusout"&&(ee=O._wrapperState)&&ee.controlled&&O.type==="number"&&ek(O,"number",O.value)}switch(ee=b?Sy(b):window,e){case"focusin":(n4(ee)||ee.contentEditable==="true")&&(by=ee,dk=b,ob=null);break;case"focusout":ob=dk=by=null;break;case"mousedown":fk=!0;break;case"contextmenu":case"mouseup":case"dragend":fk=!1,l4(P,r,E);break;case"selectionchange":if(dae)break;case"keydown":case"keyup":l4(P,r,E)}var le;if(FL)e:{switch(e){case"compositionstart":var fe="onCompositionStart";break e;case"compositionend":fe="onCompositionEnd";break e;case"compositionupdate":fe="onCompositionUpdate";break e}fe=void 0}else xy?CW(e,r)&&(fe="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(fe="onCompositionStart");fe&&(PW&&r.locale!=="ko"&&(xy||fe!=="onCompositionStart"?fe==="onCompositionEnd"&&xy&&(le=AW()):(Qd=E,jL="value"in Qd?Qd.value:Qd.textContent,xy=!0)),ee=DE(b,fe),0<ee.length&&(fe=new Q5(fe,e,null,r,E),P.push({event:fe,listeners:ee}),le?fe.data=le:(le=IW(r),le!==null&&(fe.data=le)))),(le=eae?tae(e,r):rae(e,r))&&(b=DE(b,"onBeforeInput"),0<b.length&&(E=new Q5("onBeforeInput","beforeinput",null,r,E),P.push({event:E,listeners:b}),E.data=le))}$W(P,t)})}function jb(e,t,r){return{instance:e,listener:t,currentTarget:r}}function DE(e,t){for(var r=t+"Capture",n=[];e!==null;){var l=e,h=l.stateNode;l.tag===5&&h!==null&&(l=h,h=Ib(e,r),h!=null&&n.unshift(jb(e,h,l)),h=Ib(e,t),h!=null&&n.push(jb(e,h,l))),e=e.return}return n}function iy(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function h4(e,t,r,n,l){for(var h=t._reactName,f=[];r!==null&&r!==n;){var o=r,v=o.alternate,b=o.stateNode;if(v!==null&&v===n)break;o.tag===5&&b!==null&&(o=b,l?(v=Ib(r,h),v!=null&&f.unshift(jb(r,v,o))):l||(v=Ib(r,h),v!=null&&f.push(jb(r,v,o)))),r=r.return}f.length!==0&&e.push({event:t,listeners:f})}var gae=/\r\n?/g,yae=/\u0000|\uFFFD/g;function d4(e){return(typeof e=="string"?e:""+e).replace(gae,`
`).replace(yae,"")}function vT(e,t,r){if(t=d4(t),d4(e)!==t&&r)throw Error(cr(425))}function LE(){}var pk=null,mk=null;function gk(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var yk=typeof setTimeout=="function"?setTimeout:void 0,_ae=typeof clearTimeout=="function"?clearTimeout:void 0,f4=typeof Promise=="function"?Promise:void 0,vae=typeof queueMicrotask=="function"?queueMicrotask:typeof f4<"u"?function(e){return f4.resolve(null).then(e).catch(xae)}:yk;function xae(e){setTimeout(function(){throw e})}function TM(e,t){var r=t,n=0;do{var l=r.nextSibling;if(e.removeChild(r),l&&l.nodeType===8)if(r=l.data,r==="/$"){if(n===0){e.removeChild(l),kb(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=l}while(r);kb(t)}function af(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function p4(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Q_=Math.random().toString(36).slice(2),hu="__reactFiber$"+Q_,Nb="__reactProps$"+Q_,xh="__reactContainer$"+Q_,_k="__reactEvents$"+Q_,bae="__reactListeners$"+Q_,wae="__reactHandles$"+Q_;function Gp(e){var t=e[hu];if(t)return t;for(var r=e.parentNode;r;){if(t=r[xh]||r[hu]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=p4(e);e!==null;){if(r=e[hu])return r;e=p4(e)}return t}e=r,r=e.parentNode}return null}function $w(e){return e=e[hu]||e[xh],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Sy(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(cr(33))}function xA(e){return e[Nb]||null}var vk=[],Ty=-1;function bf(e){return{current:e}}function so(e){0>Ty||(e.current=vk[Ty],vk[Ty]=null,Ty--)}function Ji(e,t){Ty++,vk[Ty]=e.current,e.current=t}var gf={},Js=bf(gf),Va=bf(!1),hm=gf;function f_(e,t){var r=e.type.contextTypes;if(!r)return gf;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var l={},h;for(h in r)l[h]=t[h];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=l),l}function Ua(e){return e=e.childContextTypes,e!=null}function jE(){so(Va),so(Js)}function m4(e,t,r){if(Js.current!==gf)throw Error(cr(168));Ji(Js,t),Ji(Va,r)}function UW(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var l in n)if(!(l in t))throw Error(cr(108,sse(e)||"Unknown",l));return _o({},r,n)}function NE(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||gf,hm=Js.current,Ji(Js,e),Ji(Va,Va.current),!0}function g4(e,t,r){var n=e.stateNode;if(!n)throw Error(cr(169));r?(e=UW(e,t,hm),n.__reactInternalMemoizedMergedChildContext=e,so(Va),so(Js),Ji(Js,e)):so(Va),Ji(Va,r)}var lh=null,bA=!1,EM=!1;function GW(e){lh===null?lh=[e]:lh.push(e)}function Sae(e){bA=!0,GW(e)}function wf(){if(!EM&&lh!==null){EM=!0;var e=0,t=ji;try{var r=lh;for(ji=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}lh=null,bA=!1}catch(l){throw lh!==null&&(lh=lh.slice(e+1)),mW(kL,wf),l}finally{ji=t,EM=!1}}return null}var Ey=[],Ay=0,zE=null,FE=0,Ol=[],kl=0,dm=null,hh=1,dh="";function Dp(e,t){Ey[Ay++]=FE,Ey[Ay++]=zE,zE=e,FE=t}function HW(e,t,r){Ol[kl++]=hh,Ol[kl++]=dh,Ol[kl++]=dm,dm=e;var n=hh;e=dh;var l=32-vc(n)-1;n&=~(1<<l),r+=1;var h=32-vc(t)+l;if(30<h){var f=l-l%5;h=(n&(1<<f)-1).toString(32),n>>=f,l-=f,hh=1<<32-vc(t)+l|r<<l|n,dh=h+e}else hh=1<<h|r<<l|n,dh=e}function $L(e){e.return!==null&&(Dp(e,1),HW(e,1,0))}function VL(e){for(;e===zE;)zE=Ey[--Ay],Ey[Ay]=null,FE=Ey[--Ay],Ey[Ay]=null;for(;e===dm;)dm=Ol[--kl],Ol[kl]=null,dh=Ol[--kl],Ol[kl]=null,hh=Ol[--kl],Ol[kl]=null}var ul=null,cl=null,co=!1,yc=null;function WW(e,t){var r=Dl(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function y4(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,ul=e,cl=af(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,ul=e,cl=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=dm!==null?{id:hh,overflow:dh}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Dl(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,ul=e,cl=null,!0):!1;default:return!1}}function xk(e){return(e.mode&1)!==0&&(e.flags&128)===0}function bk(e){if(co){var t=cl;if(t){var r=t;if(!y4(e,t)){if(xk(e))throw Error(cr(418));t=af(r.nextSibling);var n=ul;t&&y4(e,t)?WW(n,r):(e.flags=e.flags&-4097|2,co=!1,ul=e)}}else{if(xk(e))throw Error(cr(418));e.flags=e.flags&-4097|2,co=!1,ul=e}}}function _4(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;ul=e}function xT(e){if(e!==ul)return!1;if(!co)return _4(e),co=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!gk(e.type,e.memoizedProps)),t&&(t=cl)){if(xk(e))throw qW(),Error(cr(418));for(;t;)WW(e,t),t=af(t.nextSibling)}if(_4(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(cr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){cl=af(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}cl=null}}else cl=ul?af(e.stateNode.nextSibling):null;return!0}function qW(){for(var e=cl;e;)e=af(e.nextSibling)}function p_(){cl=ul=null,co=!1}function UL(e){yc===null?yc=[e]:yc.push(e)}var Tae=Dh.ReactCurrentBatchConfig;function Px(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(cr(309));var n=r.stateNode}if(!n)throw Error(cr(147,e));var l=n,h=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===h?t.ref:(t=function(f){var o=l.refs;f===null?delete o[h]:o[h]=f},t._stringRef=h,t)}if(typeof e!="string")throw Error(cr(284));if(!r._owner)throw Error(cr(290,e))}return e}function bT(e,t){throw e=Object.prototype.toString.call(t),Error(cr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function v4(e){var t=e._init;return t(e._payload)}function ZW(e){function t(U,G){if(e){var Z=U.deletions;Z===null?(U.deletions=[G],U.flags|=16):Z.push(G)}}function r(U,G){if(!e)return null;for(;G!==null;)t(U,G),G=G.sibling;return null}function n(U,G){for(U=new Map;G!==null;)G.key!==null?U.set(G.key,G):U.set(G.index,G),G=G.sibling;return U}function l(U,G){return U=hf(U,G),U.index=0,U.sibling=null,U}function h(U,G,Z){return U.index=Z,e?(Z=U.alternate,Z!==null?(Z=Z.index,Z<G?(U.flags|=2,G):Z):(U.flags|=2,G)):(U.flags|=1048576,G)}function f(U){return e&&U.alternate===null&&(U.flags|=2),U}function o(U,G,Z,ne){return G===null||G.tag!==6?(G=kM(Z,U.mode,ne),G.return=U,G):(G=l(G,Z),G.return=U,G)}function v(U,G,Z,ne){var Y=Z.type;return Y===vy?E(U,G,Z.props.children,ne,Z.key):G!==null&&(G.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===Fd&&v4(Y)===G.type)?(ne=l(G,Z.props),ne.ref=Px(U,G,Z),ne.return=U,ne):(ne=mE(Z.type,Z.key,Z.props,null,U.mode,ne),ne.ref=Px(U,G,Z),ne.return=U,ne)}function b(U,G,Z,ne){return G===null||G.tag!==4||G.stateNode.containerInfo!==Z.containerInfo||G.stateNode.implementation!==Z.implementation?(G=RM(Z,U.mode,ne),G.return=U,G):(G=l(G,Z.children||[]),G.return=U,G)}function E(U,G,Z,ne,Y){return G===null||G.tag!==7?(G=om(Z,U.mode,ne,Y),G.return=U,G):(G=l(G,Z),G.return=U,G)}function P(U,G,Z){if(typeof G=="string"&&G!==""||typeof G=="number")return G=kM(""+G,U.mode,Z),G.return=U,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case uT:return Z=mE(G.type,G.key,G.props,null,U.mode,Z),Z.ref=Px(U,null,G),Z.return=U,Z;case _y:return G=RM(G,U.mode,Z),G.return=U,G;case Fd:var ne=G._init;return P(U,ne(G._payload),Z)}if(qx(G)||wx(G))return G=om(G,U.mode,Z,null),G.return=U,G;bT(U,G)}return null}function O(U,G,Z,ne){var Y=G!==null?G.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return Y!==null?null:o(U,G,""+Z,ne);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case uT:return Z.key===Y?v(U,G,Z,ne):null;case _y:return Z.key===Y?b(U,G,Z,ne):null;case Fd:return Y=Z._init,O(U,G,Y(Z._payload),ne)}if(qx(Z)||wx(Z))return Y!==null?null:E(U,G,Z,ne,null);bT(U,Z)}return null}function L(U,G,Z,ne,Y){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return U=U.get(Z)||null,o(G,U,""+ne,Y);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case uT:return U=U.get(ne.key===null?Z:ne.key)||null,v(G,U,ne,Y);case _y:return U=U.get(ne.key===null?Z:ne.key)||null,b(G,U,ne,Y);case Fd:var ee=ne._init;return L(U,G,Z,ee(ne._payload),Y)}if(qx(ne)||wx(ne))return U=U.get(Z)||null,E(G,U,ne,Y,null);bT(G,ne)}return null}function B(U,G,Z,ne){for(var Y=null,ee=null,le=G,fe=G=0,Ce=null;le!==null&&fe<Z.length;fe++){le.index>fe?(Ce=le,le=null):Ce=le.sibling;var Oe=O(U,le,Z[fe],ne);if(Oe===null){le===null&&(le=Ce);break}e&&le&&Oe.alternate===null&&t(U,le),G=h(Oe,G,fe),ee===null?Y=Oe:ee.sibling=Oe,ee=Oe,le=Ce}if(fe===Z.length)return r(U,le),co&&Dp(U,fe),Y;if(le===null){for(;fe<Z.length;fe++)le=P(U,Z[fe],ne),le!==null&&(G=h(le,G,fe),ee===null?Y=le:ee.sibling=le,ee=le);return co&&Dp(U,fe),Y}for(le=n(U,le);fe<Z.length;fe++)Ce=L(le,U,fe,Z[fe],ne),Ce!==null&&(e&&Ce.alternate!==null&&le.delete(Ce.key===null?fe:Ce.key),G=h(Ce,G,fe),ee===null?Y=Ce:ee.sibling=Ce,ee=Ce);return e&&le.forEach(function(Me){return t(U,Me)}),co&&Dp(U,fe),Y}function z(U,G,Z,ne){var Y=wx(Z);if(typeof Y!="function")throw Error(cr(150));if(Z=Y.call(Z),Z==null)throw Error(cr(151));for(var ee=Y=null,le=G,fe=G=0,Ce=null,Oe=Z.next();le!==null&&!Oe.done;fe++,Oe=Z.next()){le.index>fe?(Ce=le,le=null):Ce=le.sibling;var Me=O(U,le,Oe.value,ne);if(Me===null){le===null&&(le=Ce);break}e&&le&&Me.alternate===null&&t(U,le),G=h(Me,G,fe),ee===null?Y=Me:ee.sibling=Me,ee=Me,le=Ce}if(Oe.done)return r(U,le),co&&Dp(U,fe),Y;if(le===null){for(;!Oe.done;fe++,Oe=Z.next())Oe=P(U,Oe.value,ne),Oe!==null&&(G=h(Oe,G,fe),ee===null?Y=Oe:ee.sibling=Oe,ee=Oe);return co&&Dp(U,fe),Y}for(le=n(U,le);!Oe.done;fe++,Oe=Z.next())Oe=L(le,U,fe,Oe.value,ne),Oe!==null&&(e&&Oe.alternate!==null&&le.delete(Oe.key===null?fe:Oe.key),G=h(Oe,G,fe),ee===null?Y=Oe:ee.sibling=Oe,ee=Oe);return e&&le.forEach(function(Ke){return t(U,Ke)}),co&&Dp(U,fe),Y}function $(U,G,Z,ne){if(typeof Z=="object"&&Z!==null&&Z.type===vy&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case uT:e:{for(var Y=Z.key,ee=G;ee!==null;){if(ee.key===Y){if(Y=Z.type,Y===vy){if(ee.tag===7){r(U,ee.sibling),G=l(ee,Z.props.children),G.return=U,U=G;break e}}else if(ee.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===Fd&&v4(Y)===ee.type){r(U,ee.sibling),G=l(ee,Z.props),G.ref=Px(U,ee,Z),G.return=U,U=G;break e}r(U,ee);break}else t(U,ee);ee=ee.sibling}Z.type===vy?(G=om(Z.props.children,U.mode,ne,Z.key),G.return=U,U=G):(ne=mE(Z.type,Z.key,Z.props,null,U.mode,ne),ne.ref=Px(U,G,Z),ne.return=U,U=ne)}return f(U);case _y:e:{for(ee=Z.key;G!==null;){if(G.key===ee)if(G.tag===4&&G.stateNode.containerInfo===Z.containerInfo&&G.stateNode.implementation===Z.implementation){r(U,G.sibling),G=l(G,Z.children||[]),G.return=U,U=G;break e}else{r(U,G);break}else t(U,G);G=G.sibling}G=RM(Z,U.mode,ne),G.return=U,U=G}return f(U);case Fd:return ee=Z._init,$(U,G,ee(Z._payload),ne)}if(qx(Z))return B(U,G,Z,ne);if(wx(Z))return z(U,G,Z,ne);bT(U,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,G!==null&&G.tag===6?(r(U,G.sibling),G=l(G,Z),G.return=U,U=G):(r(U,G),G=kM(Z,U.mode,ne),G.return=U,U=G),f(U)):r(U,G)}return $}var m_=ZW(!0),XW=ZW(!1),BE=bf(null),$E=null,Py=null,GL=null;function HL(){GL=Py=$E=null}function WL(e){var t=BE.current;so(BE),e._currentValue=t}function wk(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Gy(e,t){$E=e,GL=Py=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Fa=!0),e.firstContext=null)}function Fl(e){var t=e._currentValue;if(GL!==e)if(e={context:e,memoizedValue:t,next:null},Py===null){if($E===null)throw Error(cr(308));Py=e,$E.dependencies={lanes:0,firstContext:e}}else Py=Py.next=e;return t}var Hp=null;function qL(e){Hp===null?Hp=[e]:Hp.push(e)}function KW(e,t,r,n){var l=t.interleaved;return l===null?(r.next=r,qL(t)):(r.next=l.next,l.next=r),t.interleaved=r,bh(e,n)}function bh(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Bd=!1;function ZL(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function YW(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function gh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function lf(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,_i&2){var l=n.pending;return l===null?t.next=t:(t.next=l.next,l.next=t),n.pending=t,bh(e,r)}return l=n.interleaved,l===null?(t.next=t,qL(n)):(t.next=l.next,l.next=t),n.interleaved=t,bh(e,r)}function cE(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,RL(e,r)}}function x4(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var l=null,h=null;if(r=r.firstBaseUpdate,r!==null){do{var f={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};h===null?l=h=f:h=h.next=f,r=r.next}while(r!==null);h===null?l=h=t:h=h.next=t}else l=h=t;r={baseState:n.baseState,firstBaseUpdate:l,lastBaseUpdate:h,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function VE(e,t,r,n){var l=e.updateQueue;Bd=!1;var h=l.firstBaseUpdate,f=l.lastBaseUpdate,o=l.shared.pending;if(o!==null){l.shared.pending=null;var v=o,b=v.next;v.next=null,f===null?h=b:f.next=b,f=v;var E=e.alternate;E!==null&&(E=E.updateQueue,o=E.lastBaseUpdate,o!==f&&(o===null?E.firstBaseUpdate=b:o.next=b,E.lastBaseUpdate=v))}if(h!==null){var P=l.baseState;f=0,E=b=v=null,o=h;do{var O=o.lane,L=o.eventTime;if((n&O)===O){E!==null&&(E=E.next={eventTime:L,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var B=e,z=o;switch(O=t,L=r,z.tag){case 1:if(B=z.payload,typeof B=="function"){P=B.call(L,P,O);break e}P=B;break e;case 3:B.flags=B.flags&-65537|128;case 0:if(B=z.payload,O=typeof B=="function"?B.call(L,P,O):B,O==null)break e;P=_o({},P,O);break e;case 2:Bd=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,O=l.effects,O===null?l.effects=[o]:O.push(o))}else L={eventTime:L,lane:O,tag:o.tag,payload:o.payload,callback:o.callback,next:null},E===null?(b=E=L,v=P):E=E.next=L,f|=O;if(o=o.next,o===null){if(o=l.shared.pending,o===null)break;O=o,o=O.next,O.next=null,l.lastBaseUpdate=O,l.shared.pending=null}}while(!0);if(E===null&&(v=P),l.baseState=v,l.firstBaseUpdate=b,l.lastBaseUpdate=E,t=l.shared.interleaved,t!==null){l=t;do f|=l.lane,l=l.next;while(l!==t)}else h===null&&(l.shared.lanes=0);pm|=f,e.lanes=f,e.memoizedState=P}}function b4(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],l=n.callback;if(l!==null){if(n.callback=null,n=r,typeof l!="function")throw Error(cr(191,l));l.call(n)}}}var Vw={},gu=bf(Vw),zb=bf(Vw),Fb=bf(Vw);function Wp(e){if(e===Vw)throw Error(cr(174));return e}function XL(e,t){switch(Ji(Fb,t),Ji(zb,e),Ji(gu,Vw),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:rk(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=rk(t,e)}so(gu),Ji(gu,t)}function g_(){so(gu),so(zb),so(Fb)}function JW(e){Wp(Fb.current);var t=Wp(gu.current),r=rk(t,e.type);t!==r&&(Ji(zb,e),Ji(gu,r))}function KL(e){zb.current===e&&(so(gu),so(zb))}var mo=bf(0);function UE(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var AM=[];function YL(){for(var e=0;e<AM.length;e++)AM[e]._workInProgressVersionPrimary=null;AM.length=0}var uE=Dh.ReactCurrentDispatcher,PM=Dh.ReactCurrentBatchConfig,fm=0,yo=null,is=null,vs=null,GE=!1,sb=!1,Bb=0,Eae=0;function Hs(){throw Error(cr(321))}function JL(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!wc(e[r],t[r]))return!1;return!0}function QL(e,t,r,n,l,h){if(fm=h,yo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,uE.current=e===null||e.memoizedState===null?Iae:Mae,e=r(n,l),sb){h=0;do{if(sb=!1,Bb=0,25<=h)throw Error(cr(301));h+=1,vs=is=null,t.updateQueue=null,uE.current=Oae,e=r(n,l)}while(sb)}if(uE.current=HE,t=is!==null&&is.next!==null,fm=0,vs=is=yo=null,GE=!1,t)throw Error(cr(300));return e}function ej(){var e=Bb!==0;return Bb=0,e}function su(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vs===null?yo.memoizedState=vs=e:vs=vs.next=e,vs}function Bl(){if(is===null){var e=yo.alternate;e=e!==null?e.memoizedState:null}else e=is.next;var t=vs===null?yo.memoizedState:vs.next;if(t!==null)vs=t,is=e;else{if(e===null)throw Error(cr(310));is=e,e={memoizedState:is.memoizedState,baseState:is.baseState,baseQueue:is.baseQueue,queue:is.queue,next:null},vs===null?yo.memoizedState=vs=e:vs=vs.next=e}return vs}function $b(e,t){return typeof t=="function"?t(e):t}function CM(e){var t=Bl(),r=t.queue;if(r===null)throw Error(cr(311));r.lastRenderedReducer=e;var n=is,l=n.baseQueue,h=r.pending;if(h!==null){if(l!==null){var f=l.next;l.next=h.next,h.next=f}n.baseQueue=l=h,r.pending=null}if(l!==null){h=l.next,n=n.baseState;var o=f=null,v=null,b=h;do{var E=b.lane;if((fm&E)===E)v!==null&&(v=v.next={lane:0,action:b.action,hasEagerState:b.hasEagerState,eagerState:b.eagerState,next:null}),n=b.hasEagerState?b.eagerState:e(n,b.action);else{var P={lane:E,action:b.action,hasEagerState:b.hasEagerState,eagerState:b.eagerState,next:null};v===null?(o=v=P,f=n):v=v.next=P,yo.lanes|=E,pm|=E}b=b.next}while(b!==null&&b!==h);v===null?f=n:v.next=o,wc(n,t.memoizedState)||(Fa=!0),t.memoizedState=n,t.baseState=f,t.baseQueue=v,r.lastRenderedState=n}if(e=r.interleaved,e!==null){l=e;do h=l.lane,yo.lanes|=h,pm|=h,l=l.next;while(l!==e)}else l===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function IM(e){var t=Bl(),r=t.queue;if(r===null)throw Error(cr(311));r.lastRenderedReducer=e;var n=r.dispatch,l=r.pending,h=t.memoizedState;if(l!==null){r.pending=null;var f=l=l.next;do h=e(h,f.action),f=f.next;while(f!==l);wc(h,t.memoizedState)||(Fa=!0),t.memoizedState=h,t.baseQueue===null&&(t.baseState=h),r.lastRenderedState=h}return[h,n]}function QW(){}function eq(e,t){var r=yo,n=Bl(),l=t(),h=!wc(n.memoizedState,l);if(h&&(n.memoizedState=l,Fa=!0),n=n.queue,tj(nq.bind(null,r,n,e),[e]),n.getSnapshot!==t||h||vs!==null&&vs.memoizedState.tag&1){if(r.flags|=2048,Vb(9,rq.bind(null,r,n,l,t),void 0,null),bs===null)throw Error(cr(349));fm&30||tq(r,t,l)}return l}function tq(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=yo.updateQueue,t===null?(t={lastEffect:null,stores:null},yo.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function rq(e,t,r,n){t.value=r,t.getSnapshot=n,iq(t)&&oq(e)}function nq(e,t,r){return r(function(){iq(t)&&oq(e)})}function iq(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!wc(e,r)}catch{return!0}}function oq(e){var t=bh(e,1);t!==null&&xc(t,e,1,-1)}function w4(e){var t=su();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$b,lastRenderedState:e},t.queue=e,e=e.dispatch=Cae.bind(null,yo,e),[t.memoizedState,e]}function Vb(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=yo.updateQueue,t===null?(t={lastEffect:null,stores:null},yo.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function sq(){return Bl().memoizedState}function hE(e,t,r,n){var l=su();yo.flags|=e,l.memoizedState=Vb(1|t,r,void 0,n===void 0?null:n)}function wA(e,t,r,n){var l=Bl();n=n===void 0?null:n;var h=void 0;if(is!==null){var f=is.memoizedState;if(h=f.destroy,n!==null&&JL(n,f.deps)){l.memoizedState=Vb(t,r,h,n);return}}yo.flags|=e,l.memoizedState=Vb(1|t,r,h,n)}function S4(e,t){return hE(8390656,8,e,t)}function tj(e,t){return wA(2048,8,e,t)}function aq(e,t){return wA(4,2,e,t)}function lq(e,t){return wA(4,4,e,t)}function cq(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function uq(e,t,r){return r=r!=null?r.concat([e]):null,wA(4,4,cq.bind(null,t,e),r)}function rj(){}function hq(e,t){var r=Bl();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&JL(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function dq(e,t){var r=Bl();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&JL(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function fq(e,t,r){return fm&21?(wc(r,t)||(r=_W(),yo.lanes|=r,pm|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Fa=!0),e.memoizedState=r)}function Aae(e,t){var r=ji;ji=r!==0&&4>r?r:4,e(!0);var n=PM.transition;PM.transition={};try{e(!1),t()}finally{ji=r,PM.transition=n}}function pq(){return Bl().memoizedState}function Pae(e,t,r){var n=uf(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},mq(e))gq(t,r);else if(r=KW(e,t,r,n),r!==null){var l=xa();xc(r,e,n,l),yq(r,t,n)}}function Cae(e,t,r){var n=uf(e),l={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(mq(e))gq(t,l);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=t.lastRenderedReducer,h!==null))try{var f=t.lastRenderedState,o=h(f,r);if(l.hasEagerState=!0,l.eagerState=o,wc(o,f)){var v=t.interleaved;v===null?(l.next=l,qL(t)):(l.next=v.next,v.next=l),t.interleaved=l;return}}catch{}finally{}r=KW(e,t,l,n),r!==null&&(l=xa(),xc(r,e,n,l),yq(r,t,n))}}function mq(e){var t=e.alternate;return e===yo||t!==null&&t===yo}function gq(e,t){sb=GE=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function yq(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,RL(e,r)}}var HE={readContext:Fl,useCallback:Hs,useContext:Hs,useEffect:Hs,useImperativeHandle:Hs,useInsertionEffect:Hs,useLayoutEffect:Hs,useMemo:Hs,useReducer:Hs,useRef:Hs,useState:Hs,useDebugValue:Hs,useDeferredValue:Hs,useTransition:Hs,useMutableSource:Hs,useSyncExternalStore:Hs,useId:Hs,unstable_isNewReconciler:!1},Iae={readContext:Fl,useCallback:function(e,t){return su().memoizedState=[e,t===void 0?null:t],e},useContext:Fl,useEffect:S4,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,hE(4194308,4,cq.bind(null,t,e),r)},useLayoutEffect:function(e,t){return hE(4194308,4,e,t)},useInsertionEffect:function(e,t){return hE(4,2,e,t)},useMemo:function(e,t){var r=su();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=su();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Pae.bind(null,yo,e),[n.memoizedState,e]},useRef:function(e){var t=su();return e={current:e},t.memoizedState=e},useState:w4,useDebugValue:rj,useDeferredValue:function(e){return su().memoizedState=e},useTransition:function(){var e=w4(!1),t=e[0];return e=Aae.bind(null,e[1]),su().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=yo,l=su();if(co){if(r===void 0)throw Error(cr(407));r=r()}else{if(r=t(),bs===null)throw Error(cr(349));fm&30||tq(n,t,r)}l.memoizedState=r;var h={value:r,getSnapshot:t};return l.queue=h,S4(nq.bind(null,n,h,e),[e]),n.flags|=2048,Vb(9,rq.bind(null,n,h,r,t),void 0,null),r},useId:function(){var e=su(),t=bs.identifierPrefix;if(co){var r=dh,n=hh;r=(n&~(1<<32-vc(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=Bb++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Eae++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Mae={readContext:Fl,useCallback:hq,useContext:Fl,useEffect:tj,useImperativeHandle:uq,useInsertionEffect:aq,useLayoutEffect:lq,useMemo:dq,useReducer:CM,useRef:sq,useState:function(){return CM($b)},useDebugValue:rj,useDeferredValue:function(e){var t=Bl();return fq(t,is.memoizedState,e)},useTransition:function(){var e=CM($b)[0],t=Bl().memoizedState;return[e,t]},useMutableSource:QW,useSyncExternalStore:eq,useId:pq,unstable_isNewReconciler:!1},Oae={readContext:Fl,useCallback:hq,useContext:Fl,useEffect:tj,useImperativeHandle:uq,useInsertionEffect:aq,useLayoutEffect:lq,useMemo:dq,useReducer:IM,useRef:sq,useState:function(){return IM($b)},useDebugValue:rj,useDeferredValue:function(e){var t=Bl();return is===null?t.memoizedState=e:fq(t,is.memoizedState,e)},useTransition:function(){var e=IM($b)[0],t=Bl().memoizedState;return[e,t]},useMutableSource:QW,useSyncExternalStore:eq,useId:pq,unstable_isNewReconciler:!1};function uc(e,t){if(e&&e.defaultProps){t=_o({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function Sk(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:_o({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var SA={isMounted:function(e){return(e=e._reactInternals)?Im(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=xa(),l=uf(e),h=gh(n,l);h.payload=t,r!=null&&(h.callback=r),t=lf(e,h,l),t!==null&&(xc(t,e,l,n),cE(t,e,l))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=xa(),l=uf(e),h=gh(n,l);h.tag=1,h.payload=t,r!=null&&(h.callback=r),t=lf(e,h,l),t!==null&&(xc(t,e,l,n),cE(t,e,l))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=xa(),n=uf(e),l=gh(r,n);l.tag=2,t!=null&&(l.callback=t),t=lf(e,l,n),t!==null&&(xc(t,e,n,r),cE(t,e,n))}};function T4(e,t,r,n,l,h,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,h,f):t.prototype&&t.prototype.isPureReactComponent?!Db(r,n)||!Db(l,h):!0}function _q(e,t,r){var n=!1,l=gf,h=t.contextType;return typeof h=="object"&&h!==null?h=Fl(h):(l=Ua(t)?hm:Js.current,n=t.contextTypes,h=(n=n!=null)?f_(e,l):gf),t=new t(r,h),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=SA,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=l,e.__reactInternalMemoizedMaskedChildContext=h),t}function E4(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&SA.enqueueReplaceState(t,t.state,null)}function Tk(e,t,r,n){var l=e.stateNode;l.props=r,l.state=e.memoizedState,l.refs={},ZL(e);var h=t.contextType;typeof h=="object"&&h!==null?l.context=Fl(h):(h=Ua(t)?hm:Js.current,l.context=f_(e,h)),l.state=e.memoizedState,h=t.getDerivedStateFromProps,typeof h=="function"&&(Sk(e,t,h,r),l.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof l.getSnapshotBeforeUpdate=="function"||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(t=l.state,typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount(),t!==l.state&&SA.enqueueReplaceState(l,l.state,null),VE(e,r,l,n),l.state=e.memoizedState),typeof l.componentDidMount=="function"&&(e.flags|=4194308)}function y_(e,t){try{var r="",n=t;do r+=ose(n),n=n.return;while(n);var l=r}catch(h){l=`
Error generating stack: `+h.message+`
`+h.stack}return{value:e,source:t,stack:l,digest:null}}function MM(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function Ek(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var kae=typeof WeakMap=="function"?WeakMap:Map;function vq(e,t,r){r=gh(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){qE||(qE=!0,Lk=n),Ek(e,t)},r}function xq(e,t,r){r=gh(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var l=t.value;r.payload=function(){return n(l)},r.callback=function(){Ek(e,t)}}var h=e.stateNode;return h!==null&&typeof h.componentDidCatch=="function"&&(r.callback=function(){Ek(e,t),typeof n!="function"&&(cf===null?cf=new Set([this]):cf.add(this));var f=t.stack;this.componentDidCatch(t.value,{componentStack:f!==null?f:""})}),r}function A4(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new kae;var l=new Set;n.set(t,l)}else l=n.get(t),l===void 0&&(l=new Set,n.set(t,l));l.has(r)||(l.add(r),e=Wae.bind(null,e,t,r),t.then(e,e))}function P4(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function C4(e,t,r,n,l){return e.mode&1?(e.flags|=65536,e.lanes=l,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=gh(-1,1),t.tag=2,lf(r,t,1))),r.lanes|=1),e)}var Rae=Dh.ReactCurrentOwner,Fa=!1;function pa(e,t,r,n){t.child=e===null?XW(t,null,r,n):m_(t,e.child,r,n)}function I4(e,t,r,n,l){r=r.render;var h=t.ref;return Gy(t,l),n=QL(e,t,r,n,h,l),r=ej(),e!==null&&!Fa?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~l,wh(e,t,l)):(co&&r&&$L(t),t.flags|=1,pa(e,t,n,l),t.child)}function M4(e,t,r,n,l){if(e===null){var h=r.type;return typeof h=="function"&&!uj(h)&&h.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=h,bq(e,t,h,n,l)):(e=mE(r.type,null,n,t,t.mode,l),e.ref=t.ref,e.return=t,t.child=e)}if(h=e.child,!(e.lanes&l)){var f=h.memoizedProps;if(r=r.compare,r=r!==null?r:Db,r(f,n)&&e.ref===t.ref)return wh(e,t,l)}return t.flags|=1,e=hf(h,n),e.ref=t.ref,e.return=t,t.child=e}function bq(e,t,r,n,l){if(e!==null){var h=e.memoizedProps;if(Db(h,n)&&e.ref===t.ref)if(Fa=!1,t.pendingProps=n=h,(e.lanes&l)!==0)e.flags&131072&&(Fa=!0);else return t.lanes=e.lanes,wh(e,t,l)}return Ak(e,t,r,n,l)}function wq(e,t,r){var n=t.pendingProps,l=n.children,h=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ji(Iy,ol),ol|=r;else{if(!(r&1073741824))return e=h!==null?h.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ji(Iy,ol),ol|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=h!==null?h.baseLanes:r,Ji(Iy,ol),ol|=n}else h!==null?(n=h.baseLanes|r,t.memoizedState=null):n=r,Ji(Iy,ol),ol|=n;return pa(e,t,l,r),t.child}function Sq(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Ak(e,t,r,n,l){var h=Ua(r)?hm:Js.current;return h=f_(t,h),Gy(t,l),r=QL(e,t,r,n,h,l),n=ej(),e!==null&&!Fa?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~l,wh(e,t,l)):(co&&n&&$L(t),t.flags|=1,pa(e,t,r,l),t.child)}function O4(e,t,r,n,l){if(Ua(r)){var h=!0;NE(t)}else h=!1;if(Gy(t,l),t.stateNode===null)dE(e,t),_q(t,r,n),Tk(t,r,n,l),n=!0;else if(e===null){var f=t.stateNode,o=t.memoizedProps;f.props=o;var v=f.context,b=r.contextType;typeof b=="object"&&b!==null?b=Fl(b):(b=Ua(r)?hm:Js.current,b=f_(t,b));var E=r.getDerivedStateFromProps,P=typeof E=="function"||typeof f.getSnapshotBeforeUpdate=="function";P||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(o!==n||v!==b)&&E4(t,f,n,b),Bd=!1;var O=t.memoizedState;f.state=O,VE(t,n,f,l),v=t.memoizedState,o!==n||O!==v||Va.current||Bd?(typeof E=="function"&&(Sk(t,r,E,n),v=t.memoizedState),(o=Bd||T4(t,r,o,n,O,v,b))?(P||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(t.flags|=4194308)):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=v),f.props=n,f.state=v,f.context=b,n=o):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{f=t.stateNode,YW(e,t),o=t.memoizedProps,b=t.type===t.elementType?o:uc(t.type,o),f.props=b,P=t.pendingProps,O=f.context,v=r.contextType,typeof v=="object"&&v!==null?v=Fl(v):(v=Ua(r)?hm:Js.current,v=f_(t,v));var L=r.getDerivedStateFromProps;(E=typeof L=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(o!==P||O!==v)&&E4(t,f,n,v),Bd=!1,O=t.memoizedState,f.state=O,VE(t,n,f,l);var B=t.memoizedState;o!==P||O!==B||Va.current||Bd?(typeof L=="function"&&(Sk(t,r,L,n),B=t.memoizedState),(b=Bd||T4(t,r,b,n,O,B,v)||!1)?(E||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(n,B,v),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(n,B,v)),typeof f.componentDidUpdate=="function"&&(t.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof f.componentDidUpdate!="function"||o===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=B),f.props=n,f.state=B,f.context=v,n=b):(typeof f.componentDidUpdate!="function"||o===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),n=!1)}return Pk(e,t,r,n,h,l)}function Pk(e,t,r,n,l,h){Sq(e,t);var f=(t.flags&128)!==0;if(!n&&!f)return l&&g4(t,r,!1),wh(e,t,h);n=t.stateNode,Rae.current=t;var o=f&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&f?(t.child=m_(t,e.child,null,h),t.child=m_(t,null,o,h)):pa(e,t,o,h),t.memoizedState=n.state,l&&g4(t,r,!0),t.child}function Tq(e){var t=e.stateNode;t.pendingContext?m4(e,t.pendingContext,t.pendingContext!==t.context):t.context&&m4(e,t.context,!1),XL(e,t.containerInfo)}function k4(e,t,r,n,l){return p_(),UL(l),t.flags|=256,pa(e,t,r,n),t.child}var Ck={dehydrated:null,treeContext:null,retryLane:0};function Ik(e){return{baseLanes:e,cachePool:null,transitions:null}}function Eq(e,t,r){var n=t.pendingProps,l=mo.current,h=!1,f=(t.flags&128)!==0,o;if((o=f)||(o=e!==null&&e.memoizedState===null?!1:(l&2)!==0),o?(h=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(l|=1),Ji(mo,l&1),e===null)return bk(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(f=n.children,e=n.fallback,h?(n=t.mode,h=t.child,f={mode:"hidden",children:f},!(n&1)&&h!==null?(h.childLanes=0,h.pendingProps=f):h=AA(f,n,0,null),e=om(e,n,r,null),h.return=t,e.return=t,h.sibling=e,t.child=h,t.child.memoizedState=Ik(r),t.memoizedState=Ck,e):nj(t,f));if(l=e.memoizedState,l!==null&&(o=l.dehydrated,o!==null))return Dae(e,t,f,n,o,l,r);if(h){h=n.fallback,f=t.mode,l=e.child,o=l.sibling;var v={mode:"hidden",children:n.children};return!(f&1)&&t.child!==l?(n=t.child,n.childLanes=0,n.pendingProps=v,t.deletions=null):(n=hf(l,v),n.subtreeFlags=l.subtreeFlags&14680064),o!==null?h=hf(o,h):(h=om(h,f,r,null),h.flags|=2),h.return=t,n.return=t,n.sibling=h,t.child=n,n=h,h=t.child,f=e.child.memoizedState,f=f===null?Ik(r):{baseLanes:f.baseLanes|r,cachePool:null,transitions:f.transitions},h.memoizedState=f,h.childLanes=e.childLanes&~r,t.memoizedState=Ck,n}return h=e.child,e=h.sibling,n=hf(h,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function nj(e,t){return t=AA({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function wT(e,t,r,n){return n!==null&&UL(n),m_(t,e.child,null,r),e=nj(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Dae(e,t,r,n,l,h,f){if(r)return t.flags&256?(t.flags&=-257,n=MM(Error(cr(422))),wT(e,t,f,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(h=n.fallback,l=t.mode,n=AA({mode:"visible",children:n.children},l,0,null),h=om(h,l,f,null),h.flags|=2,n.return=t,h.return=t,n.sibling=h,t.child=n,t.mode&1&&m_(t,e.child,null,f),t.child.memoizedState=Ik(f),t.memoizedState=Ck,h);if(!(t.mode&1))return wT(e,t,f,null);if(l.data==="$!"){if(n=l.nextSibling&&l.nextSibling.dataset,n)var o=n.dgst;return n=o,h=Error(cr(419)),n=MM(h,n,void 0),wT(e,t,f,n)}if(o=(f&e.childLanes)!==0,Fa||o){if(n=bs,n!==null){switch(f&-f){case 4:l=2;break;case 16:l=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:l=32;break;case 536870912:l=268435456;break;default:l=0}l=l&(n.suspendedLanes|f)?0:l,l!==0&&l!==h.retryLane&&(h.retryLane=l,bh(e,l),xc(n,e,l,-1))}return cj(),n=MM(Error(cr(421))),wT(e,t,f,n)}return l.data==="$?"?(t.flags|=128,t.child=e.child,t=qae.bind(null,e),l._reactRetry=t,null):(e=h.treeContext,cl=af(l.nextSibling),ul=t,co=!0,yc=null,e!==null&&(Ol[kl++]=hh,Ol[kl++]=dh,Ol[kl++]=dm,hh=e.id,dh=e.overflow,dm=t),t=nj(t,n.children),t.flags|=4096,t)}function R4(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),wk(e.return,t,r)}function OM(e,t,r,n,l){var h=e.memoizedState;h===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:l}:(h.isBackwards=t,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=r,h.tailMode=l)}function Aq(e,t,r){var n=t.pendingProps,l=n.revealOrder,h=n.tail;if(pa(e,t,n.children,r),n=mo.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&R4(e,r,t);else if(e.tag===19)R4(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Ji(mo,n),!(t.mode&1))t.memoizedState=null;else switch(l){case"forwards":for(r=t.child,l=null;r!==null;)e=r.alternate,e!==null&&UE(e)===null&&(l=r),r=r.sibling;r=l,r===null?(l=t.child,t.child=null):(l=r.sibling,r.sibling=null),OM(t,!1,l,r,h);break;case"backwards":for(r=null,l=t.child,t.child=null;l!==null;){if(e=l.alternate,e!==null&&UE(e)===null){t.child=l;break}e=l.sibling,l.sibling=r,r=l,l=e}OM(t,!0,r,null,h);break;case"together":OM(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function dE(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function wh(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),pm|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(cr(153));if(t.child!==null){for(e=t.child,r=hf(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=hf(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Lae(e,t,r){switch(t.tag){case 3:Tq(t),p_();break;case 5:JW(t);break;case 1:Ua(t.type)&&NE(t);break;case 4:XL(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,l=t.memoizedProps.value;Ji(BE,n._currentValue),n._currentValue=l;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Ji(mo,mo.current&1),t.flags|=128,null):r&t.child.childLanes?Eq(e,t,r):(Ji(mo,mo.current&1),e=wh(e,t,r),e!==null?e.sibling:null);Ji(mo,mo.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return Aq(e,t,r);t.flags|=128}if(l=t.memoizedState,l!==null&&(l.rendering=null,l.tail=null,l.lastEffect=null),Ji(mo,mo.current),n)break;return null;case 22:case 23:return t.lanes=0,wq(e,t,r)}return wh(e,t,r)}var Pq,Mk,Cq,Iq;Pq=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Mk=function(){};Cq=function(e,t,r,n){var l=e.memoizedProps;if(l!==n){e=t.stateNode,Wp(gu.current);var h=null;switch(r){case"input":l=JO(e,l),n=JO(e,n),h=[];break;case"select":l=_o({},l,{value:void 0}),n=_o({},n,{value:void 0}),h=[];break;case"textarea":l=tk(e,l),n=tk(e,n),h=[];break;default:typeof l.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=LE)}nk(r,n);var f;r=null;for(b in l)if(!n.hasOwnProperty(b)&&l.hasOwnProperty(b)&&l[b]!=null)if(b==="style"){var o=l[b];for(f in o)o.hasOwnProperty(f)&&(r||(r={}),r[f]="")}else b!=="dangerouslySetInnerHTML"&&b!=="children"&&b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(Pb.hasOwnProperty(b)?h||(h=[]):(h=h||[]).push(b,null));for(b in n){var v=n[b];if(o=l?.[b],n.hasOwnProperty(b)&&v!==o&&(v!=null||o!=null))if(b==="style")if(o){for(f in o)!o.hasOwnProperty(f)||v&&v.hasOwnProperty(f)||(r||(r={}),r[f]="");for(f in v)v.hasOwnProperty(f)&&o[f]!==v[f]&&(r||(r={}),r[f]=v[f])}else r||(h||(h=[]),h.push(b,r)),r=v;else b==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,o=o?o.__html:void 0,v!=null&&o!==v&&(h=h||[]).push(b,v)):b==="children"?typeof v!="string"&&typeof v!="number"||(h=h||[]).push(b,""+v):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&(Pb.hasOwnProperty(b)?(v!=null&&b==="onScroll"&&no("scroll",e),h||o===v||(h=[])):(h=h||[]).push(b,v))}r&&(h=h||[]).push("style",r);var b=h;(t.updateQueue=b)&&(t.flags|=4)}};Iq=function(e,t,r,n){r!==n&&(t.flags|=4)};function Cx(e,t){if(!co)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Ws(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var l=e.child;l!==null;)r|=l.lanes|l.childLanes,n|=l.subtreeFlags&14680064,n|=l.flags&14680064,l.return=e,l=l.sibling;else for(l=e.child;l!==null;)r|=l.lanes|l.childLanes,n|=l.subtreeFlags,n|=l.flags,l.return=e,l=l.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function jae(e,t,r){var n=t.pendingProps;switch(VL(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ws(t),null;case 1:return Ua(t.type)&&jE(),Ws(t),null;case 3:return n=t.stateNode,g_(),so(Va),so(Js),YL(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(xT(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,yc!==null&&(zk(yc),yc=null))),Mk(e,t),Ws(t),null;case 5:KL(t);var l=Wp(Fb.current);if(r=t.type,e!==null&&t.stateNode!=null)Cq(e,t,r,n,l),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(cr(166));return Ws(t),null}if(e=Wp(gu.current),xT(t)){n=t.stateNode,r=t.type;var h=t.memoizedProps;switch(n[hu]=t,n[Nb]=h,e=(t.mode&1)!==0,r){case"dialog":no("cancel",n),no("close",n);break;case"iframe":case"object":case"embed":no("load",n);break;case"video":case"audio":for(l=0;l<Xx.length;l++)no(Xx[l],n);break;case"source":no("error",n);break;case"img":case"image":case"link":no("error",n),no("load",n);break;case"details":no("toggle",n);break;case"input":V5(n,h),no("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!h.multiple},no("invalid",n);break;case"textarea":G5(n,h),no("invalid",n)}nk(r,h),l=null;for(var f in h)if(h.hasOwnProperty(f)){var o=h[f];f==="children"?typeof o=="string"?n.textContent!==o&&(h.suppressHydrationWarning!==!0&&vT(n.textContent,o,e),l=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(h.suppressHydrationWarning!==!0&&vT(n.textContent,o,e),l=["children",""+o]):Pb.hasOwnProperty(f)&&o!=null&&f==="onScroll"&&no("scroll",n)}switch(r){case"input":hT(n),U5(n,h,!0);break;case"textarea":hT(n),H5(n);break;case"select":case"option":break;default:typeof h.onClick=="function"&&(n.onclick=LE)}n=l,t.updateQueue=n,n!==null&&(t.flags|=4)}else{f=l.nodeType===9?l:l.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=nW(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=f.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=f.createElement(r,{is:n.is}):(e=f.createElement(r),r==="select"&&(f=e,n.multiple?f.multiple=!0:n.size&&(f.size=n.size))):e=f.createElementNS(e,r),e[hu]=t,e[Nb]=n,Pq(e,t,!1,!1),t.stateNode=e;e:{switch(f=ik(r,n),r){case"dialog":no("cancel",e),no("close",e),l=n;break;case"iframe":case"object":case"embed":no("load",e),l=n;break;case"video":case"audio":for(l=0;l<Xx.length;l++)no(Xx[l],e);l=n;break;case"source":no("error",e),l=n;break;case"img":case"image":case"link":no("error",e),no("load",e),l=n;break;case"details":no("toggle",e),l=n;break;case"input":V5(e,n),l=JO(e,n),no("invalid",e);break;case"option":l=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},l=_o({},n,{value:void 0}),no("invalid",e);break;case"textarea":G5(e,n),l=tk(e,n),no("invalid",e);break;default:l=n}nk(r,l),o=l;for(h in o)if(o.hasOwnProperty(h)){var v=o[h];h==="style"?sW(e,v):h==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&iW(e,v)):h==="children"?typeof v=="string"?(r!=="textarea"||v!=="")&&Cb(e,v):typeof v=="number"&&Cb(e,""+v):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(Pb.hasOwnProperty(h)?v!=null&&h==="onScroll"&&no("scroll",e):v!=null&&PL(e,h,v,f))}switch(r){case"input":hT(e),U5(e,n,!1);break;case"textarea":hT(e),H5(e);break;case"option":n.value!=null&&e.setAttribute("value",""+mf(n.value));break;case"select":e.multiple=!!n.multiple,h=n.value,h!=null?By(e,!!n.multiple,h,!1):n.defaultValue!=null&&By(e,!!n.multiple,n.defaultValue,!0);break;default:typeof l.onClick=="function"&&(e.onclick=LE)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ws(t),null;case 6:if(e&&t.stateNode!=null)Iq(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(cr(166));if(r=Wp(Fb.current),Wp(gu.current),xT(t)){if(n=t.stateNode,r=t.memoizedProps,n[hu]=t,(h=n.nodeValue!==r)&&(e=ul,e!==null))switch(e.tag){case 3:vT(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&vT(n.nodeValue,r,(e.mode&1)!==0)}h&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[hu]=t,t.stateNode=n}return Ws(t),null;case 13:if(so(mo),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(co&&cl!==null&&t.mode&1&&!(t.flags&128))qW(),p_(),t.flags|=98560,h=!1;else if(h=xT(t),n!==null&&n.dehydrated!==null){if(e===null){if(!h)throw Error(cr(318));if(h=t.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(cr(317));h[hu]=t}else p_(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ws(t),h=!1}else yc!==null&&(zk(yc),yc=null),h=!0;if(!h)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||mo.current&1?ss===0&&(ss=3):cj())),t.updateQueue!==null&&(t.flags|=4),Ws(t),null);case 4:return g_(),Mk(e,t),e===null&&Lb(t.stateNode.containerInfo),Ws(t),null;case 10:return WL(t.type._context),Ws(t),null;case 17:return Ua(t.type)&&jE(),Ws(t),null;case 19:if(so(mo),h=t.memoizedState,h===null)return Ws(t),null;if(n=(t.flags&128)!==0,f=h.rendering,f===null)if(n)Cx(h,!1);else{if(ss!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(f=UE(e),f!==null){for(t.flags|=128,Cx(h,!1),n=f.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)h=r,e=n,h.flags&=14680066,f=h.alternate,f===null?(h.childLanes=0,h.lanes=e,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=f.childLanes,h.lanes=f.lanes,h.child=f.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=f.memoizedProps,h.memoizedState=f.memoizedState,h.updateQueue=f.updateQueue,h.type=f.type,e=f.dependencies,h.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Ji(mo,mo.current&1|2),t.child}e=e.sibling}h.tail!==null&&Do()>__&&(t.flags|=128,n=!0,Cx(h,!1),t.lanes=4194304)}else{if(!n)if(e=UE(f),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Cx(h,!0),h.tail===null&&h.tailMode==="hidden"&&!f.alternate&&!co)return Ws(t),null}else 2*Do()-h.renderingStartTime>__&&r!==1073741824&&(t.flags|=128,n=!0,Cx(h,!1),t.lanes=4194304);h.isBackwards?(f.sibling=t.child,t.child=f):(r=h.last,r!==null?r.sibling=f:t.child=f,h.last=f)}return h.tail!==null?(t=h.tail,h.rendering=t,h.tail=t.sibling,h.renderingStartTime=Do(),t.sibling=null,r=mo.current,Ji(mo,n?r&1|2:r&1),t):(Ws(t),null);case 22:case 23:return lj(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?ol&1073741824&&(Ws(t),t.subtreeFlags&6&&(t.flags|=8192)):Ws(t),null;case 24:return null;case 25:return null}throw Error(cr(156,t.tag))}function Nae(e,t){switch(VL(t),t.tag){case 1:return Ua(t.type)&&jE(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return g_(),so(Va),so(Js),YL(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return KL(t),null;case 13:if(so(mo),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(cr(340));p_()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return so(mo),null;case 4:return g_(),null;case 10:return WL(t.type._context),null;case 22:case 23:return lj(),null;case 24:return null;default:return null}}var ST=!1,Zs=!1,zae=typeof WeakSet=="function"?WeakSet:Set,Rr=null;function Cy(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Co(e,t,n)}else r.current=null}function Ok(e,t,r){try{r()}catch(n){Co(e,t,n)}}var D4=!1;function Fae(e,t){if(pk=kE,e=DW(),BL(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var l=n.anchorOffset,h=n.focusNode;n=n.focusOffset;try{r.nodeType,h.nodeType}catch{r=null;break e}var f=0,o=-1,v=-1,b=0,E=0,P=e,O=null;t:for(;;){for(var L;P!==r||l!==0&&P.nodeType!==3||(o=f+l),P!==h||n!==0&&P.nodeType!==3||(v=f+n),P.nodeType===3&&(f+=P.nodeValue.length),(L=P.firstChild)!==null;)O=P,P=L;for(;;){if(P===e)break t;if(O===r&&++b===l&&(o=f),O===h&&++E===n&&(v=f),(L=P.nextSibling)!==null)break;P=O,O=P.parentNode}P=L}r=o===-1||v===-1?null:{start:o,end:v}}else r=null}r=r||{start:0,end:0}}else r=null;for(mk={focusedElem:e,selectionRange:r},kE=!1,Rr=t;Rr!==null;)if(t=Rr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Rr=e;else for(;Rr!==null;){t=Rr;try{var B=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var z=B.memoizedProps,$=B.memoizedState,U=t.stateNode,G=U.getSnapshotBeforeUpdate(t.elementType===t.type?z:uc(t.type,z),$);U.__reactInternalSnapshotBeforeUpdate=G}break;case 3:var Z=t.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(cr(163))}}catch(ne){Co(t,t.return,ne)}if(e=t.sibling,e!==null){e.return=t.return,Rr=e;break}Rr=t.return}return B=D4,D4=!1,B}function ab(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var l=n=n.next;do{if((l.tag&e)===e){var h=l.destroy;l.destroy=void 0,h!==void 0&&Ok(t,r,h)}l=l.next}while(l!==n)}}function TA(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function kk(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function Mq(e){var t=e.alternate;t!==null&&(e.alternate=null,Mq(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[hu],delete t[Nb],delete t[_k],delete t[bae],delete t[wae])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Oq(e){return e.tag===5||e.tag===3||e.tag===4}function L4(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Oq(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Rk(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=LE));else if(n!==4&&(e=e.child,e!==null))for(Rk(e,t,r),e=e.sibling;e!==null;)Rk(e,t,r),e=e.sibling}function Dk(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(Dk(e,t,r),e=e.sibling;e!==null;)Dk(e,t,r),e=e.sibling}var Rs=null,pc=!1;function Od(e,t,r){for(r=r.child;r!==null;)kq(e,t,r),r=r.sibling}function kq(e,t,r){if(mu&&typeof mu.onCommitFiberUnmount=="function")try{mu.onCommitFiberUnmount(gA,r)}catch{}switch(r.tag){case 5:Zs||Cy(r,t);case 6:var n=Rs,l=pc;Rs=null,Od(e,t,r),Rs=n,pc=l,Rs!==null&&(pc?(e=Rs,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Rs.removeChild(r.stateNode));break;case 18:Rs!==null&&(pc?(e=Rs,r=r.stateNode,e.nodeType===8?TM(e.parentNode,r):e.nodeType===1&&TM(e,r),kb(e)):TM(Rs,r.stateNode));break;case 4:n=Rs,l=pc,Rs=r.stateNode.containerInfo,pc=!0,Od(e,t,r),Rs=n,pc=l;break;case 0:case 11:case 14:case 15:if(!Zs&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){l=n=n.next;do{var h=l,f=h.destroy;h=h.tag,f!==void 0&&(h&2||h&4)&&Ok(r,t,f),l=l.next}while(l!==n)}Od(e,t,r);break;case 1:if(!Zs&&(Cy(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(o){Co(r,t,o)}Od(e,t,r);break;case 21:Od(e,t,r);break;case 22:r.mode&1?(Zs=(n=Zs)||r.memoizedState!==null,Od(e,t,r),Zs=n):Od(e,t,r);break;default:Od(e,t,r)}}function j4(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new zae),t.forEach(function(n){var l=Zae.bind(null,e,n);r.has(n)||(r.add(n),n.then(l,l))})}}function ic(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var l=r[n];try{var h=e,f=t,o=f;e:for(;o!==null;){switch(o.tag){case 5:Rs=o.stateNode,pc=!1;break e;case 3:Rs=o.stateNode.containerInfo,pc=!0;break e;case 4:Rs=o.stateNode.containerInfo,pc=!0;break e}o=o.return}if(Rs===null)throw Error(cr(160));kq(h,f,l),Rs=null,pc=!1;var v=l.alternate;v!==null&&(v.return=null),l.return=null}catch(b){Co(l,t,b)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Rq(t,e),t=t.sibling}function Rq(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ic(t,e),ou(e),n&4){try{ab(3,e,e.return),TA(3,e)}catch(z){Co(e,e.return,z)}try{ab(5,e,e.return)}catch(z){Co(e,e.return,z)}}break;case 1:ic(t,e),ou(e),n&512&&r!==null&&Cy(r,r.return);break;case 5:if(ic(t,e),ou(e),n&512&&r!==null&&Cy(r,r.return),e.flags&32){var l=e.stateNode;try{Cb(l,"")}catch(z){Co(e,e.return,z)}}if(n&4&&(l=e.stateNode,l!=null)){var h=e.memoizedProps,f=r!==null?r.memoizedProps:h,o=e.type,v=e.updateQueue;if(e.updateQueue=null,v!==null)try{o==="input"&&h.type==="radio"&&h.name!=null&&tW(l,h),ik(o,f);var b=ik(o,h);for(f=0;f<v.length;f+=2){var E=v[f],P=v[f+1];E==="style"?sW(l,P):E==="dangerouslySetInnerHTML"?iW(l,P):E==="children"?Cb(l,P):PL(l,E,P,b)}switch(o){case"input":QO(l,h);break;case"textarea":rW(l,h);break;case"select":var O=l._wrapperState.wasMultiple;l._wrapperState.wasMultiple=!!h.multiple;var L=h.value;L!=null?By(l,!!h.multiple,L,!1):O!==!!h.multiple&&(h.defaultValue!=null?By(l,!!h.multiple,h.defaultValue,!0):By(l,!!h.multiple,h.multiple?[]:"",!1))}l[Nb]=h}catch(z){Co(e,e.return,z)}}break;case 6:if(ic(t,e),ou(e),n&4){if(e.stateNode===null)throw Error(cr(162));l=e.stateNode,h=e.memoizedProps;try{l.nodeValue=h}catch(z){Co(e,e.return,z)}}break;case 3:if(ic(t,e),ou(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{kb(t.containerInfo)}catch(z){Co(e,e.return,z)}break;case 4:ic(t,e),ou(e);break;case 13:ic(t,e),ou(e),l=e.child,l.flags&8192&&(h=l.memoizedState!==null,l.stateNode.isHidden=h,!h||l.alternate!==null&&l.alternate.memoizedState!==null||(sj=Do())),n&4&&j4(e);break;case 22:if(E=r!==null&&r.memoizedState!==null,e.mode&1?(Zs=(b=Zs)||E,ic(t,e),Zs=b):ic(t,e),ou(e),n&8192){if(b=e.memoizedState!==null,(e.stateNode.isHidden=b)&&!E&&e.mode&1)for(Rr=e,E=e.child;E!==null;){for(P=Rr=E;Rr!==null;){switch(O=Rr,L=O.child,O.tag){case 0:case 11:case 14:case 15:ab(4,O,O.return);break;case 1:Cy(O,O.return);var B=O.stateNode;if(typeof B.componentWillUnmount=="function"){n=O,r=O.return;try{t=n,B.props=t.memoizedProps,B.state=t.memoizedState,B.componentWillUnmount()}catch(z){Co(n,r,z)}}break;case 5:Cy(O,O.return);break;case 22:if(O.memoizedState!==null){z4(P);continue}}L!==null?(L.return=O,Rr=L):z4(P)}E=E.sibling}e:for(E=null,P=e;;){if(P.tag===5){if(E===null){E=P;try{l=P.stateNode,b?(h=l.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none"):(o=P.stateNode,v=P.memoizedProps.style,f=v!=null&&v.hasOwnProperty("display")?v.display:null,o.style.display=oW("display",f))}catch(z){Co(e,e.return,z)}}}else if(P.tag===6){if(E===null)try{P.stateNode.nodeValue=b?"":P.memoizedProps}catch(z){Co(e,e.return,z)}}else if((P.tag!==22&&P.tag!==23||P.memoizedState===null||P===e)&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===e)break e;for(;P.sibling===null;){if(P.return===null||P.return===e)break e;E===P&&(E=null),P=P.return}E===P&&(E=null),P.sibling.return=P.return,P=P.sibling}}break;case 19:ic(t,e),ou(e),n&4&&j4(e);break;case 21:break;default:ic(t,e),ou(e)}}function ou(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(Oq(r)){var n=r;break e}r=r.return}throw Error(cr(160))}switch(n.tag){case 5:var l=n.stateNode;n.flags&32&&(Cb(l,""),n.flags&=-33);var h=L4(e);Dk(e,h,l);break;case 3:case 4:var f=n.stateNode.containerInfo,o=L4(e);Rk(e,o,f);break;default:throw Error(cr(161))}}catch(v){Co(e,e.return,v)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Bae(e,t,r){Rr=e,Dq(e)}function Dq(e,t,r){for(var n=(e.mode&1)!==0;Rr!==null;){var l=Rr,h=l.child;if(l.tag===22&&n){var f=l.memoizedState!==null||ST;if(!f){var o=l.alternate,v=o!==null&&o.memoizedState!==null||Zs;o=ST;var b=Zs;if(ST=f,(Zs=v)&&!b)for(Rr=l;Rr!==null;)f=Rr,v=f.child,f.tag===22&&f.memoizedState!==null?F4(l):v!==null?(v.return=f,Rr=v):F4(l);for(;h!==null;)Rr=h,Dq(h),h=h.sibling;Rr=l,ST=o,Zs=b}N4(e)}else l.subtreeFlags&8772&&h!==null?(h.return=l,Rr=h):N4(e)}}function N4(e){for(;Rr!==null;){var t=Rr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Zs||TA(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Zs)if(r===null)n.componentDidMount();else{var l=t.elementType===t.type?r.memoizedProps:uc(t.type,r.memoizedProps);n.componentDidUpdate(l,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var h=t.updateQueue;h!==null&&b4(t,h,n);break;case 3:var f=t.updateQueue;if(f!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}b4(t,f,r)}break;case 5:var o=t.stateNode;if(r===null&&t.flags&4){r=o;var v=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&r.focus();break;case"img":v.src&&(r.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var b=t.alternate;if(b!==null){var E=b.memoizedState;if(E!==null){var P=E.dehydrated;P!==null&&kb(P)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(cr(163))}Zs||t.flags&512&&kk(t)}catch(O){Co(t,t.return,O)}}if(t===e){Rr=null;break}if(r=t.sibling,r!==null){r.return=t.return,Rr=r;break}Rr=t.return}}function z4(e){for(;Rr!==null;){var t=Rr;if(t===e){Rr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Rr=r;break}Rr=t.return}}function F4(e){for(;Rr!==null;){var t=Rr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{TA(4,t)}catch(v){Co(t,r,v)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var l=t.return;try{n.componentDidMount()}catch(v){Co(t,l,v)}}var h=t.return;try{kk(t)}catch(v){Co(t,h,v)}break;case 5:var f=t.return;try{kk(t)}catch(v){Co(t,f,v)}}}catch(v){Co(t,t.return,v)}if(t===e){Rr=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Rr=o;break}Rr=t.return}}var $ae=Math.ceil,WE=Dh.ReactCurrentDispatcher,ij=Dh.ReactCurrentOwner,jl=Dh.ReactCurrentBatchConfig,_i=0,bs=null,Ho=null,js=0,ol=0,Iy=bf(0),ss=0,Ub=null,pm=0,EA=0,oj=0,lb=null,Na=null,sj=0,__=1/0,oh=null,qE=!1,Lk=null,cf=null,TT=!1,ef=null,ZE=0,cb=0,jk=null,fE=-1,pE=0;function xa(){return _i&6?Do():fE!==-1?fE:fE=Do()}function uf(e){return e.mode&1?_i&2&&js!==0?js&-js:Tae.transition!==null?(pE===0&&(pE=_W()),pE):(e=ji,e!==0||(e=window.event,e=e===void 0?16:EW(e.type)),e):1}function xc(e,t,r,n){if(50<cb)throw cb=0,jk=null,Error(cr(185));Fw(e,r,n),(!(_i&2)||e!==bs)&&(e===bs&&(!(_i&2)&&(EA|=r),ss===4&&Hd(e,js)),Ga(e,n),r===1&&_i===0&&!(t.mode&1)&&(__=Do()+500,bA&&wf()))}function Ga(e,t){var r=e.callbackNode;Tse(e,t);var n=OE(e,e===bs?js:0);if(n===0)r!==null&&Z5(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&Z5(r),t===1)e.tag===0?Sae(B4.bind(null,e)):GW(B4.bind(null,e)),vae(function(){!(_i&6)&&wf()}),r=null;else{switch(vW(n)){case 1:r=kL;break;case 4:r=gW;break;case 16:r=ME;break;case 536870912:r=yW;break;default:r=ME}r=Vq(r,Lq.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function Lq(e,t){if(fE=-1,pE=0,_i&6)throw Error(cr(327));var r=e.callbackNode;if(Hy()&&e.callbackNode!==r)return null;var n=OE(e,e===bs?js:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=XE(e,n);else{t=n;var l=_i;_i|=2;var h=Nq();(bs!==e||js!==t)&&(oh=null,__=Do()+500,im(e,t));do try{Gae();break}catch(o){jq(e,o)}while(!0);HL(),WE.current=h,_i=l,Ho!==null?t=0:(bs=null,js=0,t=ss)}if(t!==0){if(t===2&&(l=ck(e),l!==0&&(n=l,t=Nk(e,l))),t===1)throw r=Ub,im(e,0),Hd(e,n),Ga(e,Do()),r;if(t===6)Hd(e,n);else{if(l=e.current.alternate,!(n&30)&&!Vae(l)&&(t=XE(e,n),t===2&&(h=ck(e),h!==0&&(n=h,t=Nk(e,h))),t===1))throw r=Ub,im(e,0),Hd(e,n),Ga(e,Do()),r;switch(e.finishedWork=l,e.finishedLanes=n,t){case 0:case 1:throw Error(cr(345));case 2:Lp(e,Na,oh);break;case 3:if(Hd(e,n),(n&130023424)===n&&(t=sj+500-Do(),10<t)){if(OE(e,0)!==0)break;if(l=e.suspendedLanes,(l&n)!==n){xa(),e.pingedLanes|=e.suspendedLanes&l;break}e.timeoutHandle=yk(Lp.bind(null,e,Na,oh),t);break}Lp(e,Na,oh);break;case 4:if(Hd(e,n),(n&4194240)===n)break;for(t=e.eventTimes,l=-1;0<n;){var f=31-vc(n);h=1<<f,f=t[f],f>l&&(l=f),n&=~h}if(n=l,n=Do()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*$ae(n/1960))-n,10<n){e.timeoutHandle=yk(Lp.bind(null,e,Na,oh),n);break}Lp(e,Na,oh);break;case 5:Lp(e,Na,oh);break;default:throw Error(cr(329))}}}return Ga(e,Do()),e.callbackNode===r?Lq.bind(null,e):null}function Nk(e,t){var r=lb;return e.current.memoizedState.isDehydrated&&(im(e,t).flags|=256),e=XE(e,t),e!==2&&(t=Na,Na=r,t!==null&&zk(t)),e}function zk(e){Na===null?Na=e:Na.push.apply(Na,e)}function Vae(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var l=r[n],h=l.getSnapshot;l=l.value;try{if(!wc(h(),l))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Hd(e,t){for(t&=~oj,t&=~EA,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-vc(t),n=1<<r;e[r]=-1,t&=~n}}function B4(e){if(_i&6)throw Error(cr(327));Hy();var t=OE(e,0);if(!(t&1))return Ga(e,Do()),null;var r=XE(e,t);if(e.tag!==0&&r===2){var n=ck(e);n!==0&&(t=n,r=Nk(e,n))}if(r===1)throw r=Ub,im(e,0),Hd(e,t),Ga(e,Do()),r;if(r===6)throw Error(cr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Lp(e,Na,oh),Ga(e,Do()),null}function aj(e,t){var r=_i;_i|=1;try{return e(t)}finally{_i=r,_i===0&&(__=Do()+500,bA&&wf())}}function mm(e){ef!==null&&ef.tag===0&&!(_i&6)&&Hy();var t=_i;_i|=1;var r=jl.transition,n=ji;try{if(jl.transition=null,ji=1,e)return e()}finally{ji=n,jl.transition=r,_i=t,!(_i&6)&&wf()}}function lj(){ol=Iy.current,so(Iy)}function im(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,_ae(r)),Ho!==null)for(r=Ho.return;r!==null;){var n=r;switch(VL(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&jE();break;case 3:g_(),so(Va),so(Js),YL();break;case 5:KL(n);break;case 4:g_();break;case 13:so(mo);break;case 19:so(mo);break;case 10:WL(n.type._context);break;case 22:case 23:lj()}r=r.return}if(bs=e,Ho=e=hf(e.current,null),js=ol=t,ss=0,Ub=null,oj=EA=pm=0,Na=lb=null,Hp!==null){for(t=0;t<Hp.length;t++)if(r=Hp[t],n=r.interleaved,n!==null){r.interleaved=null;var l=n.next,h=r.pending;if(h!==null){var f=h.next;h.next=l,n.next=f}r.pending=n}Hp=null}return e}function jq(e,t){do{var r=Ho;try{if(HL(),uE.current=HE,GE){for(var n=yo.memoizedState;n!==null;){var l=n.queue;l!==null&&(l.pending=null),n=n.next}GE=!1}if(fm=0,vs=is=yo=null,sb=!1,Bb=0,ij.current=null,r===null||r.return===null){ss=1,Ub=t,Ho=null;break}e:{var h=e,f=r.return,o=r,v=t;if(t=js,o.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var b=v,E=o,P=E.tag;if(!(E.mode&1)&&(P===0||P===11||P===15)){var O=E.alternate;O?(E.updateQueue=O.updateQueue,E.memoizedState=O.memoizedState,E.lanes=O.lanes):(E.updateQueue=null,E.memoizedState=null)}var L=P4(f);if(L!==null){L.flags&=-257,C4(L,f,o,h,t),L.mode&1&&A4(h,b,t),t=L,v=b;var B=t.updateQueue;if(B===null){var z=new Set;z.add(v),t.updateQueue=z}else B.add(v);break e}else{if(!(t&1)){A4(h,b,t),cj();break e}v=Error(cr(426))}}else if(co&&o.mode&1){var $=P4(f);if($!==null){!($.flags&65536)&&($.flags|=256),C4($,f,o,h,t),UL(y_(v,o));break e}}h=v=y_(v,o),ss!==4&&(ss=2),lb===null?lb=[h]:lb.push(h),h=f;do{switch(h.tag){case 3:h.flags|=65536,t&=-t,h.lanes|=t;var U=vq(h,v,t);x4(h,U);break e;case 1:o=v;var G=h.type,Z=h.stateNode;if(!(h.flags&128)&&(typeof G.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(cf===null||!cf.has(Z)))){h.flags|=65536,t&=-t,h.lanes|=t;var ne=xq(h,o,t);x4(h,ne);break e}}h=h.return}while(h!==null)}Fq(r)}catch(Y){t=Y,Ho===r&&r!==null&&(Ho=r=r.return);continue}break}while(!0)}function Nq(){var e=WE.current;return WE.current=HE,e===null?HE:e}function cj(){(ss===0||ss===3||ss===2)&&(ss=4),bs===null||!(pm&268435455)&&!(EA&268435455)||Hd(bs,js)}function XE(e,t){var r=_i;_i|=2;var n=Nq();(bs!==e||js!==t)&&(oh=null,im(e,t));do try{Uae();break}catch(l){jq(e,l)}while(!0);if(HL(),_i=r,WE.current=n,Ho!==null)throw Error(cr(261));return bs=null,js=0,ss}function Uae(){for(;Ho!==null;)zq(Ho)}function Gae(){for(;Ho!==null&&!mse();)zq(Ho)}function zq(e){var t=$q(e.alternate,e,ol);e.memoizedProps=e.pendingProps,t===null?Fq(e):Ho=t,ij.current=null}function Fq(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Nae(r,t),r!==null){r.flags&=32767,Ho=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ss=6,Ho=null;return}}else if(r=jae(r,t,ol),r!==null){Ho=r;return}if(t=t.sibling,t!==null){Ho=t;return}Ho=t=e}while(t!==null);ss===0&&(ss=5)}function Lp(e,t,r){var n=ji,l=jl.transition;try{jl.transition=null,ji=1,Hae(e,t,r,n)}finally{jl.transition=l,ji=n}return null}function Hae(e,t,r,n){do Hy();while(ef!==null);if(_i&6)throw Error(cr(327));r=e.finishedWork;var l=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(cr(177));e.callbackNode=null,e.callbackPriority=0;var h=r.lanes|r.childLanes;if(Ese(e,h),e===bs&&(Ho=bs=null,js=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||TT||(TT=!0,Vq(ME,function(){return Hy(),null})),h=(r.flags&15990)!==0,r.subtreeFlags&15990||h){h=jl.transition,jl.transition=null;var f=ji;ji=1;var o=_i;_i|=4,ij.current=null,Fae(e,r),Rq(r,e),hae(mk),kE=!!pk,mk=pk=null,e.current=r,Bae(r),gse(),_i=o,ji=f,jl.transition=h}else e.current=r;if(TT&&(TT=!1,ef=e,ZE=l),h=e.pendingLanes,h===0&&(cf=null),vse(r.stateNode),Ga(e,Do()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)l=t[r],n(l.value,{componentStack:l.stack,digest:l.digest});if(qE)throw qE=!1,e=Lk,Lk=null,e;return ZE&1&&e.tag!==0&&Hy(),h=e.pendingLanes,h&1?e===jk?cb++:(cb=0,jk=e):cb=0,wf(),null}function Hy(){if(ef!==null){var e=vW(ZE),t=jl.transition,r=ji;try{if(jl.transition=null,ji=16>e?16:e,ef===null)var n=!1;else{if(e=ef,ef=null,ZE=0,_i&6)throw Error(cr(331));var l=_i;for(_i|=4,Rr=e.current;Rr!==null;){var h=Rr,f=h.child;if(Rr.flags&16){var o=h.deletions;if(o!==null){for(var v=0;v<o.length;v++){var b=o[v];for(Rr=b;Rr!==null;){var E=Rr;switch(E.tag){case 0:case 11:case 15:ab(8,E,h)}var P=E.child;if(P!==null)P.return=E,Rr=P;else for(;Rr!==null;){E=Rr;var O=E.sibling,L=E.return;if(Mq(E),E===b){Rr=null;break}if(O!==null){O.return=L,Rr=O;break}Rr=L}}}var B=h.alternate;if(B!==null){var z=B.child;if(z!==null){B.child=null;do{var $=z.sibling;z.sibling=null,z=$}while(z!==null)}}Rr=h}}if(h.subtreeFlags&2064&&f!==null)f.return=h,Rr=f;else e:for(;Rr!==null;){if(h=Rr,h.flags&2048)switch(h.tag){case 0:case 11:case 15:ab(9,h,h.return)}var U=h.sibling;if(U!==null){U.return=h.return,Rr=U;break e}Rr=h.return}}var G=e.current;for(Rr=G;Rr!==null;){f=Rr;var Z=f.child;if(f.subtreeFlags&2064&&Z!==null)Z.return=f,Rr=Z;else e:for(f=G;Rr!==null;){if(o=Rr,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:TA(9,o)}}catch(Y){Co(o,o.return,Y)}if(o===f){Rr=null;break e}var ne=o.sibling;if(ne!==null){ne.return=o.return,Rr=ne;break e}Rr=o.return}}if(_i=l,wf(),mu&&typeof mu.onPostCommitFiberRoot=="function")try{mu.onPostCommitFiberRoot(gA,e)}catch{}n=!0}return n}finally{ji=r,jl.transition=t}}return!1}function $4(e,t,r){t=y_(r,t),t=vq(e,t,1),e=lf(e,t,1),t=xa(),e!==null&&(Fw(e,1,t),Ga(e,t))}function Co(e,t,r){if(e.tag===3)$4(e,e,r);else for(;t!==null;){if(t.tag===3){$4(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(cf===null||!cf.has(n))){e=y_(r,e),e=xq(t,e,1),t=lf(t,e,1),e=xa(),t!==null&&(Fw(t,1,e),Ga(t,e));break}}t=t.return}}function Wae(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=xa(),e.pingedLanes|=e.suspendedLanes&r,bs===e&&(js&r)===r&&(ss===4||ss===3&&(js&130023424)===js&&500>Do()-sj?im(e,0):oj|=r),Ga(e,t)}function Bq(e,t){t===0&&(e.mode&1?(t=pT,pT<<=1,!(pT&130023424)&&(pT=4194304)):t=1);var r=xa();e=bh(e,t),e!==null&&(Fw(e,t,r),Ga(e,r))}function qae(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),Bq(e,r)}function Zae(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,l=e.memoizedState;l!==null&&(r=l.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(cr(314))}n!==null&&n.delete(t),Bq(e,r)}var $q;$q=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Va.current)Fa=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Fa=!1,Lae(e,t,r);Fa=!!(e.flags&131072)}else Fa=!1,co&&t.flags&1048576&&HW(t,FE,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;dE(e,t),e=t.pendingProps;var l=f_(t,Js.current);Gy(t,r),l=QL(null,t,n,e,l,r);var h=ej();return t.flags|=1,typeof l=="object"&&l!==null&&typeof l.render=="function"&&l.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ua(n)?(h=!0,NE(t)):h=!1,t.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,ZL(t),l.updater=SA,t.stateNode=l,l._reactInternals=t,Tk(t,n,e,r),t=Pk(null,t,n,!0,h,r)):(t.tag=0,co&&h&&$L(t),pa(null,t,l,r),t=t.child),t;case 16:n=t.elementType;e:{switch(dE(e,t),e=t.pendingProps,l=n._init,n=l(n._payload),t.type=n,l=t.tag=Kae(n),e=uc(n,e),l){case 0:t=Ak(null,t,n,e,r);break e;case 1:t=O4(null,t,n,e,r);break e;case 11:t=I4(null,t,n,e,r);break e;case 14:t=M4(null,t,n,uc(n.type,e),r);break e}throw Error(cr(306,n,""))}return t;case 0:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:uc(n,l),Ak(e,t,n,l,r);case 1:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:uc(n,l),O4(e,t,n,l,r);case 3:e:{if(Tq(t),e===null)throw Error(cr(387));n=t.pendingProps,h=t.memoizedState,l=h.element,YW(e,t),VE(t,n,null,r);var f=t.memoizedState;if(n=f.element,h.isDehydrated)if(h={element:n,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},t.updateQueue.baseState=h,t.memoizedState=h,t.flags&256){l=y_(Error(cr(423)),t),t=k4(e,t,n,r,l);break e}else if(n!==l){l=y_(Error(cr(424)),t),t=k4(e,t,n,r,l);break e}else for(cl=af(t.stateNode.containerInfo.firstChild),ul=t,co=!0,yc=null,r=XW(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(p_(),n===l){t=wh(e,t,r);break e}pa(e,t,n,r)}t=t.child}return t;case 5:return JW(t),e===null&&bk(t),n=t.type,l=t.pendingProps,h=e!==null?e.memoizedProps:null,f=l.children,gk(n,l)?f=null:h!==null&&gk(n,h)&&(t.flags|=32),Sq(e,t),pa(e,t,f,r),t.child;case 6:return e===null&&bk(t),null;case 13:return Eq(e,t,r);case 4:return XL(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=m_(t,null,n,r):pa(e,t,n,r),t.child;case 11:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:uc(n,l),I4(e,t,n,l,r);case 7:return pa(e,t,t.pendingProps,r),t.child;case 8:return pa(e,t,t.pendingProps.children,r),t.child;case 12:return pa(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,l=t.pendingProps,h=t.memoizedProps,f=l.value,Ji(BE,n._currentValue),n._currentValue=f,h!==null)if(wc(h.value,f)){if(h.children===l.children&&!Va.current){t=wh(e,t,r);break e}}else for(h=t.child,h!==null&&(h.return=t);h!==null;){var o=h.dependencies;if(o!==null){f=h.child;for(var v=o.firstContext;v!==null;){if(v.context===n){if(h.tag===1){v=gh(-1,r&-r),v.tag=2;var b=h.updateQueue;if(b!==null){b=b.shared;var E=b.pending;E===null?v.next=v:(v.next=E.next,E.next=v),b.pending=v}}h.lanes|=r,v=h.alternate,v!==null&&(v.lanes|=r),wk(h.return,r,t),o.lanes|=r;break}v=v.next}}else if(h.tag===10)f=h.type===t.type?null:h.child;else if(h.tag===18){if(f=h.return,f===null)throw Error(cr(341));f.lanes|=r,o=f.alternate,o!==null&&(o.lanes|=r),wk(f,r,t),f=h.sibling}else f=h.child;if(f!==null)f.return=h;else for(f=h;f!==null;){if(f===t){f=null;break}if(h=f.sibling,h!==null){h.return=f.return,f=h;break}f=f.return}h=f}pa(e,t,l.children,r),t=t.child}return t;case 9:return l=t.type,n=t.pendingProps.children,Gy(t,r),l=Fl(l),n=n(l),t.flags|=1,pa(e,t,n,r),t.child;case 14:return n=t.type,l=uc(n,t.pendingProps),l=uc(n.type,l),M4(e,t,n,l,r);case 15:return bq(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:uc(n,l),dE(e,t),t.tag=1,Ua(n)?(e=!0,NE(t)):e=!1,Gy(t,r),_q(t,n,l),Tk(t,n,l,r),Pk(null,t,n,!0,e,r);case 19:return Aq(e,t,r);case 22:return wq(e,t,r)}throw Error(cr(156,t.tag))};function Vq(e,t){return mW(e,t)}function Xae(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dl(e,t,r,n){return new Xae(e,t,r,n)}function uj(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Kae(e){if(typeof e=="function")return uj(e)?1:0;if(e!=null){if(e=e.$$typeof,e===IL)return 11;if(e===ML)return 14}return 2}function hf(e,t){var r=e.alternate;return r===null?(r=Dl(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function mE(e,t,r,n,l,h){var f=2;if(n=e,typeof e=="function")uj(e)&&(f=1);else if(typeof e=="string")f=5;else e:switch(e){case vy:return om(r.children,l,h,t);case CL:f=8,l|=8;break;case ZO:return e=Dl(12,r,t,l|2),e.elementType=ZO,e.lanes=h,e;case XO:return e=Dl(13,r,t,l),e.elementType=XO,e.lanes=h,e;case KO:return e=Dl(19,r,t,l),e.elementType=KO,e.lanes=h,e;case JH:return AA(r,l,h,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case KH:f=10;break e;case YH:f=9;break e;case IL:f=11;break e;case ML:f=14;break e;case Fd:f=16,n=null;break e}throw Error(cr(130,e==null?e:typeof e,""))}return t=Dl(f,r,t,l),t.elementType=e,t.type=n,t.lanes=h,t}function om(e,t,r,n){return e=Dl(7,e,n,t),e.lanes=r,e}function AA(e,t,r,n){return e=Dl(22,e,n,t),e.elementType=JH,e.lanes=r,e.stateNode={isHidden:!1},e}function kM(e,t,r){return e=Dl(6,e,null,t),e.lanes=r,e}function RM(e,t,r){return t=Dl(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Yae(e,t,r,n,l){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fM(0),this.expirationTimes=fM(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fM(0),this.identifierPrefix=n,this.onRecoverableError=l,this.mutableSourceEagerHydrationData=null}function hj(e,t,r,n,l,h,f,o,v){return e=new Yae(e,t,r,o,v),t===1?(t=1,h===!0&&(t|=8)):t=0,h=Dl(3,null,null,t),e.current=h,h.stateNode=e,h.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},ZL(h),e}function Jae(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_y,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function Uq(e){if(!e)return gf;e=e._reactInternals;e:{if(Im(e)!==e||e.tag!==1)throw Error(cr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ua(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(cr(171))}if(e.tag===1){var r=e.type;if(Ua(r))return UW(e,r,t)}return t}function Gq(e,t,r,n,l,h,f,o,v){return e=hj(r,n,!0,e,l,h,f,o,v),e.context=Uq(null),r=e.current,n=xa(),l=uf(r),h=gh(n,l),h.callback=t??null,lf(r,h,l),e.current.lanes=l,Fw(e,l,n),Ga(e,n),e}function PA(e,t,r,n){var l=t.current,h=xa(),f=uf(l);return r=Uq(r),t.context===null?t.context=r:t.pendingContext=r,t=gh(h,f),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=lf(l,t,f),e!==null&&(xc(e,l,f,h),cE(e,l,f)),f}function KE(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function V4(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function dj(e,t){V4(e,t),(e=e.alternate)&&V4(e,t)}function Qae(){return null}var Hq=typeof reportError=="function"?reportError:function(e){console.error(e)};function fj(e){this._internalRoot=e}CA.prototype.render=fj.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(cr(409));PA(e,t,null,null)};CA.prototype.unmount=fj.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;mm(function(){PA(null,e,null,null)}),t[xh]=null}};function CA(e){this._internalRoot=e}CA.prototype.unstable_scheduleHydration=function(e){if(e){var t=wW();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Gd.length&&t!==0&&t<Gd[r].priority;r++);Gd.splice(r,0,e),r===0&&TW(e)}};function pj(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function IA(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function U4(){}function ele(e,t,r,n,l){if(l){if(typeof n=="function"){var h=n;n=function(){var b=KE(f);h.call(b)}}var f=Gq(t,n,e,0,null,!1,!1,"",U4);return e._reactRootContainer=f,e[xh]=f.current,Lb(e.nodeType===8?e.parentNode:e),mm(),f}for(;l=e.lastChild;)e.removeChild(l);if(typeof n=="function"){var o=n;n=function(){var b=KE(v);o.call(b)}}var v=hj(e,0,!1,null,null,!1,!1,"",U4);return e._reactRootContainer=v,e[xh]=v.current,Lb(e.nodeType===8?e.parentNode:e),mm(function(){PA(t,v,r,n)}),v}function MA(e,t,r,n,l){var h=r._reactRootContainer;if(h){var f=h;if(typeof l=="function"){var o=l;l=function(){var v=KE(f);o.call(v)}}PA(t,f,e,l)}else f=ele(r,t,e,l,n);return KE(f)}xW=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Zx(t.pendingLanes);r!==0&&(RL(t,r|1),Ga(t,Do()),!(_i&6)&&(__=Do()+500,wf()))}break;case 13:mm(function(){var n=bh(e,1);if(n!==null){var l=xa();xc(n,e,1,l)}}),dj(e,1)}};DL=function(e){if(e.tag===13){var t=bh(e,134217728);if(t!==null){var r=xa();xc(t,e,134217728,r)}dj(e,134217728)}};bW=function(e){if(e.tag===13){var t=uf(e),r=bh(e,t);if(r!==null){var n=xa();xc(r,e,t,n)}dj(e,t)}};wW=function(){return ji};SW=function(e,t){var r=ji;try{return ji=e,t()}finally{ji=r}};sk=function(e,t,r){switch(t){case"input":if(QO(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var l=xA(n);if(!l)throw Error(cr(90));eW(n),QO(n,l)}}}break;case"textarea":rW(e,r);break;case"select":t=r.value,t!=null&&By(e,!!r.multiple,t,!1)}};cW=aj;uW=mm;var tle={usingClientEntryPoint:!1,Events:[$w,Sy,xA,aW,lW,aj]},Ix={findFiberByHostInstance:Gp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},rle={bundleType:Ix.bundleType,version:Ix.version,rendererPackageName:Ix.rendererPackageName,rendererConfig:Ix.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Dh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=fW(e),e===null?null:e.stateNode},findFiberByHostInstance:Ix.findFiberByHostInstance||Qae,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ET=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ET.isDisabled&&ET.supportsFiber)try{gA=ET.inject(rle),mu=ET}catch{}}pl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tle;pl.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!pj(t))throw Error(cr(200));return Jae(e,t,null,r)};pl.createRoot=function(e,t){if(!pj(e))throw Error(cr(299));var r=!1,n="",l=Hq;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(l=t.onRecoverableError)),t=hj(e,1,!1,null,null,r,!1,n,l),e[xh]=t.current,Lb(e.nodeType===8?e.parentNode:e),new fj(t)};pl.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(cr(188)):(e=Object.keys(e).join(","),Error(cr(268,e)));return e=fW(t),e=e===null?null:e.stateNode,e};pl.flushSync=function(e){return mm(e)};pl.hydrate=function(e,t,r){if(!IA(t))throw Error(cr(200));return MA(null,e,t,!0,r)};pl.hydrateRoot=function(e,t,r){if(!pj(e))throw Error(cr(405));var n=r!=null&&r.hydratedSources||null,l=!1,h="",f=Hq;if(r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(f=r.onRecoverableError)),t=Gq(t,null,e,1,r??null,l,!1,h,f),e[xh]=t.current,Lb(e),n)for(e=0;e<n.length;e++)r=n[e],l=r._getVersion,l=l(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,l]:t.mutableSourceEagerHydrationData.push(r,l);return new CA(t)};pl.render=function(e,t,r){if(!IA(t))throw Error(cr(200));return MA(null,e,t,!1,r)};pl.unmountComponentAtNode=function(e){if(!IA(e))throw Error(cr(40));return e._reactRootContainer?(mm(function(){MA(null,null,e,!1,function(){e._reactRootContainer=null,e[xh]=null})}),!0):!1};pl.unstable_batchedUpdates=aj;pl.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!IA(r))throw Error(cr(200));if(e==null||e._reactInternals===void 0)throw Error(cr(38));return MA(e,t,r,!1,n)};pl.version="18.3.1-next-f1338f8080-20240426";function Wq(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Wq)}catch(e){console.error(e)}}Wq(),WH.exports=pl;var Mm=WH.exports;const qq=Pi(Mm);var Zq,G4=Mm;Zq=G4.createRoot,G4.hydrateRoot;const nle=1,ile=1e6;let DM=0;function ole(){return DM=(DM+1)%Number.MAX_SAFE_INTEGER,DM.toString()}const LM=new Map,H4=e=>{if(LM.has(e))return;const t=setTimeout(()=>{LM.delete(e),ub({type:"REMOVE_TOAST",toastId:e})},ile);LM.set(e,t)},sle=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,nle)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?H4(r):e.toasts.forEach(n=>{H4(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},gE=[];let yE={toasts:[]};function ub(e){yE=sle(yE,e),gE.forEach(t=>{t(yE)})}function Fk({...e}){const t=ole(),r=l=>ub({type:"UPDATE_TOAST",toast:{...l,id:t}}),n=()=>ub({type:"DISMISS_TOAST",toastId:t});return ub({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:l=>{l||n()}}}),{id:t,dismiss:n,update:r}}function mj(){const[e,t]=K.useState(yE);return K.useEffect(()=>(gE.push(t),()=>{const r=gE.indexOf(t);r>-1&&gE.splice(r,1)}),[e]),{...e,toast:Fk,dismiss:r=>ub({type:"DISMISS_TOAST",toastId:r})}}function Xr(e,t,{checkForDefaultPrevented:r=!0}={}){return function(l){if(e?.(l),r===!1||!l.defaultPrevented)return t?.(l)}}function W4(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Xq(...e){return t=>{let r=!1;const n=e.map(l=>{const h=W4(l,t);return!r&&typeof h=="function"&&(r=!0),h});if(r)return()=>{for(let l=0;l<n.length;l++){const h=n[l];typeof h=="function"?h():W4(e[l],null)}}}}function mi(...e){return K.useCallback(Xq(...e),e)}function ale(e,t){const r=K.createContext(t),n=h=>{const{children:f,...o}=h,v=K.useMemo(()=>o,Object.values(o));return M.jsx(r.Provider,{value:v,children:f})};n.displayName=e+"Provider";function l(h){const f=K.useContext(r);if(f)return f;if(t!==void 0)return t;throw new Error(`\`${h}\` must be used within \`${e}\``)}return[n,l]}function Ec(e,t=[]){let r=[];function n(h,f){const o=K.createContext(f),v=r.length;r=[...r,f];const b=P=>{const{scope:O,children:L,...B}=P,z=O?.[e]?.[v]||o,$=K.useMemo(()=>B,Object.values(B));return M.jsx(z.Provider,{value:$,children:L})};b.displayName=h+"Provider";function E(P,O){const L=O?.[e]?.[v]||o,B=K.useContext(L);if(B)return B;if(f!==void 0)return f;throw new Error(`\`${P}\` must be used within \`${h}\``)}return[b,E]}const l=()=>{const h=r.map(f=>K.createContext(f));return function(o){const v=o?.[e]||h;return K.useMemo(()=>({[`__scope${e}`]:{...o,[e]:v}}),[o,v])}};return l.scopeName=e,[n,lle(l,...t)]}function lle(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(h){const f=n.reduce((o,{useScope:v,scopeName:b})=>{const P=v(h)[`__scope${b}`];return{...o,...P}},{});return K.useMemo(()=>({[`__scope${t.scopeName}`]:f}),[f])}};return r.scopeName=t.scopeName,r}function v_(e){const t=ule(e),r=K.forwardRef((n,l)=>{const{children:h,...f}=n,o=K.Children.toArray(h),v=o.find(dle);if(v){const b=v.props.children,E=o.map(P=>P===v?K.Children.count(b)>1?K.Children.only(null):K.isValidElement(b)?b.props.children:null:P);return M.jsx(t,{...f,ref:l,children:K.isValidElement(b)?K.cloneElement(b,void 0,E):null})}return M.jsx(t,{...f,ref:l,children:h})});return r.displayName=`${e}.Slot`,r}var cle=v_("Slot");function ule(e){const t=K.forwardRef((r,n)=>{const{children:l,...h}=r;if(K.isValidElement(l)){const f=ple(l),o=fle(h,l.props);return l.type!==K.Fragment&&(o.ref=n?Xq(n,f):f),K.cloneElement(l,o)}return K.Children.count(l)>1?K.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Kq=Symbol("radix.slottable");function hle(e){const t=({children:r})=>M.jsx(M.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=Kq,t}function dle(e){return K.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Kq}function fle(e,t){const r={...t};for(const n in t){const l=e[n],h=t[n];/^on[A-Z]/.test(n)?l&&h?r[n]=(...o)=>{const v=h(...o);return l(...o),v}:l&&(r[n]=l):n==="style"?r[n]={...l,...h}:n==="className"&&(r[n]=[l,h].filter(Boolean).join(" "))}return{...e,...r}}function ple(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function gj(e){const t=e+"CollectionProvider",[r,n]=Ec(t),[l,h]=r(t,{collectionRef:{current:null},itemMap:new Map}),f=z=>{const{scope:$,children:U}=z,G=ze.useRef(null),Z=ze.useRef(new Map).current;return M.jsx(l,{scope:$,itemMap:Z,collectionRef:G,children:U})};f.displayName=t;const o=e+"CollectionSlot",v=v_(o),b=ze.forwardRef((z,$)=>{const{scope:U,children:G}=z,Z=h(o,U),ne=mi($,Z.collectionRef);return M.jsx(v,{ref:ne,children:G})});b.displayName=o;const E=e+"CollectionItemSlot",P="data-radix-collection-item",O=v_(E),L=ze.forwardRef((z,$)=>{const{scope:U,children:G,...Z}=z,ne=ze.useRef(null),Y=mi($,ne),ee=h(E,U);return ze.useEffect(()=>(ee.itemMap.set(ne,{ref:ne,...Z}),()=>void ee.itemMap.delete(ne))),M.jsx(O,{[P]:"",ref:Y,children:G})});L.displayName=E;function B(z){const $=h(e+"CollectionConsumer",z);return ze.useCallback(()=>{const G=$.collectionRef.current;if(!G)return[];const Z=Array.from(G.querySelectorAll(`[${P}]`));return Array.from($.itemMap.values()).sort((ee,le)=>Z.indexOf(ee.ref.current)-Z.indexOf(le.ref.current))},[$.collectionRef,$.itemMap])}return[{Provider:f,Slot:b,ItemSlot:L},B,n]}var mle=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],pn=mle.reduce((e,t)=>{const r=v_(`Primitive.${t}`),n=K.forwardRef((l,h)=>{const{asChild:f,...o}=l,v=f?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),M.jsx(v,{...o,ref:h})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function Yq(e,t){e&&Mm.flushSync(()=>e.dispatchEvent(t))}function os(e){const t=K.useRef(e);return K.useEffect(()=>{t.current=e}),K.useMemo(()=>(...r)=>t.current?.(...r),[])}function gle(e,t=globalThis?.document){const r=os(e);K.useEffect(()=>{const n=l=>{l.key==="Escape"&&r(l)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var yle="DismissableLayer",Bk="dismissableLayer.update",_le="dismissableLayer.pointerDownOutside",vle="dismissableLayer.focusOutside",q4,Jq=K.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Uw=K.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:l,onFocusOutside:h,onInteractOutside:f,onDismiss:o,...v}=e,b=K.useContext(Jq),[E,P]=K.useState(null),O=E?.ownerDocument??globalThis?.document,[,L]=K.useState({}),B=mi(t,le=>P(le)),z=Array.from(b.layers),[$]=[...b.layersWithOutsidePointerEventsDisabled].slice(-1),U=z.indexOf($),G=E?z.indexOf(E):-1,Z=b.layersWithOutsidePointerEventsDisabled.size>0,ne=G>=U,Y=ble(le=>{const fe=le.target,Ce=[...b.branches].some(Oe=>Oe.contains(fe));!ne||Ce||(l?.(le),f?.(le),le.defaultPrevented||o?.())},O),ee=wle(le=>{const fe=le.target;[...b.branches].some(Oe=>Oe.contains(fe))||(h?.(le),f?.(le),le.defaultPrevented||o?.())},O);return gle(le=>{G===b.layers.size-1&&(n?.(le),!le.defaultPrevented&&o&&(le.preventDefault(),o()))},O),K.useEffect(()=>{if(E)return r&&(b.layersWithOutsidePointerEventsDisabled.size===0&&(q4=O.body.style.pointerEvents,O.body.style.pointerEvents="none"),b.layersWithOutsidePointerEventsDisabled.add(E)),b.layers.add(E),Z4(),()=>{r&&b.layersWithOutsidePointerEventsDisabled.size===1&&(O.body.style.pointerEvents=q4)}},[E,O,r,b]),K.useEffect(()=>()=>{E&&(b.layers.delete(E),b.layersWithOutsidePointerEventsDisabled.delete(E),Z4())},[E,b]),K.useEffect(()=>{const le=()=>L({});return document.addEventListener(Bk,le),()=>document.removeEventListener(Bk,le)},[]),M.jsx(pn.div,{...v,ref:B,style:{pointerEvents:Z?ne?"auto":"none":void 0,...e.style},onFocusCapture:Xr(e.onFocusCapture,ee.onFocusCapture),onBlurCapture:Xr(e.onBlurCapture,ee.onBlurCapture),onPointerDownCapture:Xr(e.onPointerDownCapture,Y.onPointerDownCapture)})});Uw.displayName=yle;var xle="DismissableLayerBranch",Qq=K.forwardRef((e,t)=>{const r=K.useContext(Jq),n=K.useRef(null),l=mi(t,n);return K.useEffect(()=>{const h=n.current;if(h)return r.branches.add(h),()=>{r.branches.delete(h)}},[r.branches]),M.jsx(pn.div,{...e,ref:l})});Qq.displayName=xle;function ble(e,t=globalThis?.document){const r=os(e),n=K.useRef(!1),l=K.useRef(()=>{});return K.useEffect(()=>{const h=o=>{if(o.target&&!n.current){let v=function(){e7(_le,r,b,{discrete:!0})};const b={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",l.current),l.current=v,t.addEventListener("click",l.current,{once:!0})):v()}else t.removeEventListener("click",l.current);n.current=!1},f=window.setTimeout(()=>{t.addEventListener("pointerdown",h)},0);return()=>{window.clearTimeout(f),t.removeEventListener("pointerdown",h),t.removeEventListener("click",l.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function wle(e,t=globalThis?.document){const r=os(e),n=K.useRef(!1);return K.useEffect(()=>{const l=h=>{h.target&&!n.current&&e7(vle,r,{originalEvent:h},{discrete:!1})};return t.addEventListener("focusin",l),()=>t.removeEventListener("focusin",l)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function Z4(){const e=new CustomEvent(Bk);document.dispatchEvent(e)}function e7(e,t,r,{discrete:n}){const l=r.originalEvent.target,h=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&l.addEventListener(e,t,{once:!0}),n?Yq(l,h):l.dispatchEvent(h)}var Sle=Uw,Tle=Qq,ws=globalThis?.document?K.useLayoutEffect:()=>{},Ele="Portal",OA=K.forwardRef((e,t)=>{const{container:r,...n}=e,[l,h]=K.useState(!1);ws(()=>h(!0),[]);const f=r||l&&globalThis?.document?.body;return f?qq.createPortal(M.jsx(pn.div,{...n,ref:t}),f):null});OA.displayName=Ele;function Ale(e,t){return K.useReducer((r,n)=>t[r][n]??r,e)}var Ac=e=>{const{present:t,children:r}=e,n=Ple(t),l=typeof r=="function"?r({present:n.isPresent}):K.Children.only(r),h=mi(n.ref,Cle(l));return typeof r=="function"||n.isPresent?K.cloneElement(l,{ref:h}):null};Ac.displayName="Presence";function Ple(e){const[t,r]=K.useState(),n=K.useRef(null),l=K.useRef(e),h=K.useRef("none"),f=e?"mounted":"unmounted",[o,v]=Ale(f,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return K.useEffect(()=>{const b=AT(n.current);h.current=o==="mounted"?b:"none"},[o]),ws(()=>{const b=n.current,E=l.current;if(E!==e){const O=h.current,L=AT(b);e?v("MOUNT"):L==="none"||b?.display==="none"?v("UNMOUNT"):v(E&&O!==L?"ANIMATION_OUT":"UNMOUNT"),l.current=e}},[e,v]),ws(()=>{if(t){let b;const E=t.ownerDocument.defaultView??window,P=L=>{const z=AT(n.current).includes(CSS.escape(L.animationName));if(L.target===t&&z&&(v("ANIMATION_END"),!l.current)){const $=t.style.animationFillMode;t.style.animationFillMode="forwards",b=E.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=$)})}},O=L=>{L.target===t&&(h.current=AT(n.current))};return t.addEventListener("animationstart",O),t.addEventListener("animationcancel",P),t.addEventListener("animationend",P),()=>{E.clearTimeout(b),t.removeEventListener("animationstart",O),t.removeEventListener("animationcancel",P),t.removeEventListener("animationend",P)}}else v("ANIMATION_END")},[t,v]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:K.useCallback(b=>{n.current=b?getComputedStyle(b):null,r(b)},[])}}function AT(e){return e?.animationName||"none"}function Cle(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Ile=TL[" useInsertionEffect ".trim().toString()]||ws;function gm({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[l,h,f]=Mle({defaultProp:t,onChange:r}),o=e!==void 0,v=o?e:l;{const E=K.useRef(e!==void 0);K.useEffect(()=>{const P=E.current;P!==o&&console.warn(`${n} is changing from ${P?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),E.current=o},[o,n])}const b=K.useCallback(E=>{if(o){const P=Ole(E)?E(e):E;P!==e&&f.current?.(P)}else h(E)},[o,e,h,f]);return[v,b]}function Mle({defaultProp:e,onChange:t}){const[r,n]=K.useState(e),l=K.useRef(r),h=K.useRef(t);return Ile(()=>{h.current=t},[t]),K.useEffect(()=>{l.current!==r&&(h.current?.(r),l.current=r)},[r,l]),[r,n,h]}function Ole(e){return typeof e=="function"}var t7=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),kle="VisuallyHidden",kA=K.forwardRef((e,t)=>M.jsx(pn.span,{...e,ref:t,style:{...t7,...e.style}}));kA.displayName=kle;var Rle=kA,yj="ToastProvider",[_j,Dle,Lle]=gj("Toast"),[r7,LGe]=Ec("Toast",[Lle]),[jle,RA]=r7(yj),n7=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:l="right",swipeThreshold:h=50,children:f}=e,[o,v]=K.useState(null),[b,E]=K.useState(0),P=K.useRef(!1),O=K.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${yj}\`. Expected non-empty \`string\`.`),M.jsx(_j.Provider,{scope:t,children:M.jsx(jle,{scope:t,label:r,duration:n,swipeDirection:l,swipeThreshold:h,toastCount:b,viewport:o,onViewportChange:v,onToastAdd:K.useCallback(()=>E(L=>L+1),[]),onToastRemove:K.useCallback(()=>E(L=>L-1),[]),isFocusedToastEscapeKeyDownRef:P,isClosePausedRef:O,children:f})})};n7.displayName=yj;var i7="ToastViewport",Nle=["F8"],$k="toast.viewportPause",Vk="toast.viewportResume",o7=K.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=Nle,label:l="Notifications ({hotkey})",...h}=e,f=RA(i7,r),o=Dle(r),v=K.useRef(null),b=K.useRef(null),E=K.useRef(null),P=K.useRef(null),O=mi(t,P,f.onViewportChange),L=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),B=f.toastCount>0;K.useEffect(()=>{const $=U=>{n.length!==0&&n.every(Z=>U[Z]||U.code===Z)&&P.current?.focus()};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[n]),K.useEffect(()=>{const $=v.current,U=P.current;if(B&&$&&U){const G=()=>{if(!f.isClosePausedRef.current){const ee=new CustomEvent($k);U.dispatchEvent(ee),f.isClosePausedRef.current=!0}},Z=()=>{if(f.isClosePausedRef.current){const ee=new CustomEvent(Vk);U.dispatchEvent(ee),f.isClosePausedRef.current=!1}},ne=ee=>{!$.contains(ee.relatedTarget)&&Z()},Y=()=>{$.contains(document.activeElement)||Z()};return $.addEventListener("focusin",G),$.addEventListener("focusout",ne),$.addEventListener("pointermove",G),$.addEventListener("pointerleave",Y),window.addEventListener("blur",G),window.addEventListener("focus",Z),()=>{$.removeEventListener("focusin",G),$.removeEventListener("focusout",ne),$.removeEventListener("pointermove",G),$.removeEventListener("pointerleave",Y),window.removeEventListener("blur",G),window.removeEventListener("focus",Z)}}},[B,f.isClosePausedRef]);const z=K.useCallback(({tabbingDirection:$})=>{const G=o().map(Z=>{const ne=Z.ref.current,Y=[ne,...Kle(ne)];return $==="forwards"?Y:Y.reverse()});return($==="forwards"?G.reverse():G).flat()},[o]);return K.useEffect(()=>{const $=P.current;if($){const U=G=>{const Z=G.altKey||G.ctrlKey||G.metaKey;if(G.key==="Tab"&&!Z){const Y=document.activeElement,ee=G.shiftKey;if(G.target===$&&ee){b.current?.focus();return}const Ce=z({tabbingDirection:ee?"backwards":"forwards"}),Oe=Ce.findIndex(Me=>Me===Y);jM(Ce.slice(Oe+1))?G.preventDefault():ee?b.current?.focus():E.current?.focus()}};return $.addEventListener("keydown",U),()=>$.removeEventListener("keydown",U)}},[o,z]),M.jsxs(Tle,{ref:v,role:"region","aria-label":l.replace("{hotkey}",L),tabIndex:-1,style:{pointerEvents:B?void 0:"none"},children:[B&&M.jsx(Uk,{ref:b,onFocusFromOutsideViewport:()=>{const $=z({tabbingDirection:"forwards"});jM($)}}),M.jsx(_j.Slot,{scope:r,children:M.jsx(pn.ol,{tabIndex:-1,...h,ref:O})}),B&&M.jsx(Uk,{ref:E,onFocusFromOutsideViewport:()=>{const $=z({tabbingDirection:"backwards"});jM($)}})]})});o7.displayName=i7;var s7="ToastFocusProxy",Uk=K.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...l}=e,h=RA(s7,r);return M.jsx(kA,{tabIndex:0,...l,ref:t,style:{position:"fixed"},onFocus:f=>{const o=f.relatedTarget;!h.viewport?.contains(o)&&n()}})});Uk.displayName=s7;var Gw="Toast",zle="toast.swipeStart",Fle="toast.swipeMove",Ble="toast.swipeCancel",$le="toast.swipeEnd",a7=K.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:l,onOpenChange:h,...f}=e,[o,v]=gm({prop:n,defaultProp:l??!0,onChange:h,caller:Gw});return M.jsx(Ac,{present:r||o,children:M.jsx(Gle,{open:o,...f,ref:t,onClose:()=>v(!1),onPause:os(e.onPause),onResume:os(e.onResume),onSwipeStart:Xr(e.onSwipeStart,b=>{b.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Xr(e.onSwipeMove,b=>{const{x:E,y:P}=b.detail.delta;b.currentTarget.setAttribute("data-swipe","move"),b.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${E}px`),b.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${P}px`)}),onSwipeCancel:Xr(e.onSwipeCancel,b=>{b.currentTarget.setAttribute("data-swipe","cancel"),b.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),b.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),b.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),b.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Xr(e.onSwipeEnd,b=>{const{x:E,y:P}=b.detail.delta;b.currentTarget.setAttribute("data-swipe","end"),b.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),b.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),b.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${E}px`),b.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${P}px`),v(!1)})})})});a7.displayName=Gw;var[Vle,Ule]=r7(Gw,{onClose(){}}),Gle=K.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:l,open:h,onClose:f,onEscapeKeyDown:o,onPause:v,onResume:b,onSwipeStart:E,onSwipeMove:P,onSwipeCancel:O,onSwipeEnd:L,...B}=e,z=RA(Gw,r),[$,U]=K.useState(null),G=mi(t,Le=>U(Le)),Z=K.useRef(null),ne=K.useRef(null),Y=l||z.duration,ee=K.useRef(0),le=K.useRef(Y),fe=K.useRef(0),{onToastAdd:Ce,onToastRemove:Oe}=z,Me=os(()=>{$?.contains(document.activeElement)&&z.viewport?.focus(),f()}),Ke=K.useCallback(Le=>{!Le||Le===1/0||(window.clearTimeout(fe.current),ee.current=new Date().getTime(),fe.current=window.setTimeout(Me,Le))},[Me]);K.useEffect(()=>{const Le=z.viewport;if(Le){const Qe=()=>{Ke(le.current),b?.()},Je=()=>{const it=new Date().getTime()-ee.current;le.current=le.current-it,window.clearTimeout(fe.current),v?.()};return Le.addEventListener($k,Je),Le.addEventListener(Vk,Qe),()=>{Le.removeEventListener($k,Je),Le.removeEventListener(Vk,Qe)}}},[z.viewport,Y,v,b,Ke]),K.useEffect(()=>{h&&!z.isClosePausedRef.current&&Ke(Y)},[h,Y,z.isClosePausedRef,Ke]),K.useEffect(()=>(Ce(),()=>Oe()),[Ce,Oe]);const Ye=K.useMemo(()=>$?p7($):null,[$]);return z.viewport?M.jsxs(M.Fragment,{children:[Ye&&M.jsx(Hle,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite",children:Ye}),M.jsx(Vle,{scope:r,onClose:Me,children:Mm.createPortal(M.jsx(_j.ItemSlot,{scope:r,children:M.jsx(Sle,{asChild:!0,onEscapeKeyDown:Xr(o,()=>{z.isFocusedToastEscapeKeyDownRef.current||Me(),z.isFocusedToastEscapeKeyDownRef.current=!1}),children:M.jsx(pn.li,{tabIndex:0,"data-state":h?"open":"closed","data-swipe-direction":z.swipeDirection,...B,ref:G,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Xr(e.onKeyDown,Le=>{Le.key==="Escape"&&(o?.(Le.nativeEvent),Le.nativeEvent.defaultPrevented||(z.isFocusedToastEscapeKeyDownRef.current=!0,Me()))}),onPointerDown:Xr(e.onPointerDown,Le=>{Le.button===0&&(Z.current={x:Le.clientX,y:Le.clientY})}),onPointerMove:Xr(e.onPointerMove,Le=>{if(!Z.current)return;const Qe=Le.clientX-Z.current.x,Je=Le.clientY-Z.current.y,it=!!ne.current,Ze=["left","right"].includes(z.swipeDirection),nt=["left","up"].includes(z.swipeDirection)?Math.min:Math.max,pt=Ze?nt(0,Qe):0,_t=Ze?0:nt(0,Je),It=Le.pointerType==="touch"?10:2,sr={x:pt,y:_t},Sr={originalEvent:Le,delta:sr};it?(ne.current=sr,PT(Fle,P,Sr,{discrete:!1})):X4(sr,z.swipeDirection,It)?(ne.current=sr,PT(zle,E,Sr,{discrete:!1}),Le.target.setPointerCapture(Le.pointerId)):(Math.abs(Qe)>It||Math.abs(Je)>It)&&(Z.current=null)}),onPointerUp:Xr(e.onPointerUp,Le=>{const Qe=ne.current,Je=Le.target;if(Je.hasPointerCapture(Le.pointerId)&&Je.releasePointerCapture(Le.pointerId),ne.current=null,Z.current=null,Qe){const it=Le.currentTarget,Ze={originalEvent:Le,delta:Qe};X4(Qe,z.swipeDirection,z.swipeThreshold)?PT($le,L,Ze,{discrete:!0}):PT(Ble,O,Ze,{discrete:!0}),it.addEventListener("click",nt=>nt.preventDefault(),{once:!0})}})})})}),z.viewport)})]}):null}),Hle=e=>{const{__scopeToast:t,children:r,...n}=e,l=RA(Gw,t),[h,f]=K.useState(!1),[o,v]=K.useState(!1);return Zle(()=>f(!0)),K.useEffect(()=>{const b=window.setTimeout(()=>v(!0),1e3);return()=>window.clearTimeout(b)},[]),o?null:M.jsx(OA,{asChild:!0,children:M.jsx(kA,{...n,children:h&&M.jsxs(M.Fragment,{children:[l.label," ",r]})})})},Wle="ToastTitle",l7=K.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return M.jsx(pn.div,{...n,ref:t})});l7.displayName=Wle;var qle="ToastDescription",c7=K.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return M.jsx(pn.div,{...n,ref:t})});c7.displayName=qle;var u7="ToastAction",h7=K.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?M.jsx(f7,{altText:r,asChild:!0,children:M.jsx(vj,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${u7}\`. Expected non-empty \`string\`.`),null)});h7.displayName=u7;var d7="ToastClose",vj=K.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,l=Ule(d7,r);return M.jsx(f7,{asChild:!0,children:M.jsx(pn.button,{type:"button",...n,ref:t,onClick:Xr(e.onClick,l.onClose)})})});vj.displayName=d7;var f7=K.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...l}=e;return M.jsx(pn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...l,ref:t})});function p7(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),Xle(n)){const l=n.ariaHidden||n.hidden||n.style.display==="none",h=n.dataset.radixToastAnnounceExclude==="";if(!l)if(h){const f=n.dataset.radixToastAnnounceAlt;f&&t.push(f)}else t.push(...p7(n))}}),t}function PT(e,t,r,{discrete:n}){const l=r.originalEvent.currentTarget,h=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&l.addEventListener(e,t,{once:!0}),n?Yq(l,h):l.dispatchEvent(h)}var X4=(e,t,r=0)=>{const n=Math.abs(e.x),l=Math.abs(e.y),h=n>l;return t==="left"||t==="right"?h&&n>r:!h&&l>r};function Zle(e=()=>{}){const t=os(e);ws(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function Xle(e){return e.nodeType===e.ELEMENT_NODE}function Kle(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const l=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||l?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function jM(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var Yle=n7,m7=o7,g7=a7,y7=l7,_7=c7,v7=h7,x7=vj;function b7(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var l=e.length;for(t=0;t<l;t++)e[t]&&(r=b7(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function qn(){for(var e,t,r=0,n="",l=arguments.length;r<l;r++)(e=arguments[r])&&(t=b7(e))&&(n&&(n+=" "),n+=t);return n}const K4=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,Y4=qn,ev=(e,t)=>r=>{var n;if(t?.variants==null)return Y4(e,r?.class,r?.className);const{variants:l,defaultVariants:h}=t,f=Object.keys(l).map(b=>{const E=r?.[b],P=h?.[b];if(E===null)return null;const O=K4(E)||K4(P);return l[b][O]}),o=r&&Object.entries(r).reduce((b,E)=>{let[P,O]=E;return O===void 0||(b[P]=O),b},{}),v=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((b,E)=>{let{class:P,className:O,...L}=E;return Object.entries(L).every(B=>{let[z,$]=B;return Array.isArray($)?$.includes({...h,...o}[z]):{...h,...o}[z]===$})?[...b,P,O]:b},[]);return Y4(e,f,v,r?.class,r?.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jle=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),w7=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qle={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ece=K.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:l="",children:h,iconNode:f,...o},v)=>K.createElement("svg",{ref:v,...Qle,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:w7("lucide",l),...o},[...f.map(([b,E])=>K.createElement(b,E)),...Array.isArray(h)?h:[h]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=(e,t)=>{const r=K.forwardRef(({className:n,...l},h)=>K.createElement(ece,{ref:h,iconNode:t,className:w7(`lucide-${Jle(e)}`,n),...l}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YE=tn("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tce=tn("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rce=tn("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nce=tn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ice=tn("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xj=tn("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sm=tn("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oce=tn("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sh=tn("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sce=tn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DA=tn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gk=tn("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hk=tn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bj=tn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ace=tn("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lce=tn("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cce=tn("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wj=tn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sj=tn("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uce=tn("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tj=tn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hce=tn("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dce=tn("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S7=tn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T7=tn("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fce=tn("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E7=tn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pce=tn("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mce=tn("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=tn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gce=tn("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yce=tn("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J4=tn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A7=tn("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q4=tn("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ce=tn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P7=tn("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $d=tn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vce=tn("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wk=tn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e$=tn("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ej=tn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C7=tn("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=tn("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xce=tn("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bce=tn("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Om=tn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wce=tn("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I7=tn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const km=tn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sce=tn("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tce=tn("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $l=tn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ece=tn("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Aj="-",Ace=e=>{const t=Cce(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:f=>{const o=f.split(Aj);return o[0]===""&&o.length!==1&&o.shift(),M7(o,t)||Pce(f)},getConflictingClassGroupIds:(f,o)=>{const v=r[f]||[];return o&&n[f]?[...v,...n[f]]:v}}},M7=(e,t)=>{if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),l=n?M7(e.slice(1),n):void 0;if(l)return l;if(t.validators.length===0)return;const h=e.join(Aj);return t.validators.find(({validator:f})=>f(h))?.classGroupId},t$=/^\[(.+)\]$/,Pce=e=>{if(t$.test(e)){const t=t$.exec(e)[1],r=t?.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},Cce=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return Mce(Object.entries(e.classGroups),r).forEach(([h,f])=>{qk(f,n,h,t)}),n},qk=(e,t,r,n)=>{e.forEach(l=>{if(typeof l=="string"){const h=l===""?t:r$(t,l);h.classGroupId=r;return}if(typeof l=="function"){if(Ice(l)){qk(l(n),t,r,n);return}t.validators.push({validator:l,classGroupId:r});return}Object.entries(l).forEach(([h,f])=>{qk(f,r$(t,h),r,n)})})},r$=(e,t)=>{let r=e;return t.split(Aj).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},Ice=e=>e.isThemeGetter,Mce=(e,t)=>t?e.map(([r,n])=>{const l=n.map(h=>typeof h=="string"?t+h:typeof h=="object"?Object.fromEntries(Object.entries(h).map(([f,o])=>[t+f,o])):h);return[r,l]}):e,Oce=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const l=(h,f)=>{r.set(h,f),t++,t>e&&(t=0,n=r,r=new Map)};return{get(h){let f=r.get(h);if(f!==void 0)return f;if((f=n.get(h))!==void 0)return l(h,f),f},set(h,f){r.has(h)?r.set(h,f):l(h,f)}}},O7="!",kce=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,l=t[0],h=t.length,f=o=>{const v=[];let b=0,E=0,P;for(let $=0;$<o.length;$++){let U=o[$];if(b===0){if(U===l&&(n||o.slice($,$+h)===t)){v.push(o.slice(E,$)),E=$+h;continue}if(U==="/"){P=$;continue}}U==="["?b++:U==="]"&&b--}const O=v.length===0?o:o.substring(E),L=O.startsWith(O7),B=L?O.substring(1):O,z=P&&P>E?P-E:void 0;return{modifiers:v,hasImportantModifier:L,baseClassName:B,maybePostfixModifierPosition:z}};return r?o=>r({className:o,parseClassName:f}):f},Rce=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},Dce=e=>({cache:Oce(e.cacheSize),parseClassName:kce(e),...Ace(e)}),Lce=/\s+/,jce=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:l}=t,h=[],f=e.trim().split(Lce);let o="";for(let v=f.length-1;v>=0;v-=1){const b=f[v],{modifiers:E,hasImportantModifier:P,baseClassName:O,maybePostfixModifierPosition:L}=r(b);let B=!!L,z=n(B?O.substring(0,L):O);if(!z){if(!B){o=b+(o.length>0?" "+o:o);continue}if(z=n(O),!z){o=b+(o.length>0?" "+o:o);continue}B=!1}const $=Rce(E).join(":"),U=P?$+O7:$,G=U+z;if(h.includes(G))continue;h.push(G);const Z=l(z,B);for(let ne=0;ne<Z.length;++ne){const Y=Z[ne];h.push(U+Y)}o=b+(o.length>0?" "+o:o)}return o};function Nce(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=k7(t))&&(n&&(n+=" "),n+=r);return n}const k7=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=k7(e[n]))&&(r&&(r+=" "),r+=t);return r};function zce(e,...t){let r,n,l,h=f;function f(v){const b=t.reduce((E,P)=>P(E),e());return r=Dce(b),n=r.cache.get,l=r.cache.set,h=o,o(v)}function o(v){const b=n(v);if(b)return b;const E=jce(v,r);return l(v,E),E}return function(){return h(Nce.apply(null,arguments))}}const ro=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},R7=/^\[(?:([a-z-]+):)?(.+)\]$/i,Fce=/^\d+\/\d+$/,Bce=new Set(["px","full","screen"]),$ce=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Vce=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Uce=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Gce=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Hce=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,th=e=>Wy(e)||Bce.has(e)||Fce.test(e),kd=e=>tv(e,"length",Qce),Wy=e=>!!e&&!Number.isNaN(Number(e)),NM=e=>tv(e,"number",Wy),Mx=e=>!!e&&Number.isInteger(Number(e)),Wce=e=>e.endsWith("%")&&Wy(e.slice(0,-1)),Wn=e=>R7.test(e),Rd=e=>$ce.test(e),qce=new Set(["length","size","percentage"]),Zce=e=>tv(e,qce,D7),Xce=e=>tv(e,"position",D7),Kce=new Set(["image","url"]),Yce=e=>tv(e,Kce,tue),Jce=e=>tv(e,"",eue),Ox=()=>!0,tv=(e,t,r)=>{const n=R7.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},Qce=e=>Vce.test(e)&&!Uce.test(e),D7=()=>!1,eue=e=>Gce.test(e),tue=e=>Hce.test(e),rue=()=>{const e=ro("colors"),t=ro("spacing"),r=ro("blur"),n=ro("brightness"),l=ro("borderColor"),h=ro("borderRadius"),f=ro("borderSpacing"),o=ro("borderWidth"),v=ro("contrast"),b=ro("grayscale"),E=ro("hueRotate"),P=ro("invert"),O=ro("gap"),L=ro("gradientColorStops"),B=ro("gradientColorStopPositions"),z=ro("inset"),$=ro("margin"),U=ro("opacity"),G=ro("padding"),Z=ro("saturate"),ne=ro("scale"),Y=ro("sepia"),ee=ro("skew"),le=ro("space"),fe=ro("translate"),Ce=()=>["auto","contain","none"],Oe=()=>["auto","hidden","clip","visible","scroll"],Me=()=>["auto",Wn,t],Ke=()=>[Wn,t],Ye=()=>["",th,kd],Le=()=>["auto",Wy,Wn],Qe=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Je=()=>["solid","dashed","dotted","double","none"],it=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ze=()=>["start","end","center","between","around","evenly","stretch"],nt=()=>["","0",Wn],pt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],_t=()=>[Wy,Wn];return{cacheSize:500,separator:":",theme:{colors:[Ox],spacing:[th,kd],blur:["none","",Rd,Wn],brightness:_t(),borderColor:[e],borderRadius:["none","","full",Rd,Wn],borderSpacing:Ke(),borderWidth:Ye(),contrast:_t(),grayscale:nt(),hueRotate:_t(),invert:nt(),gap:Ke(),gradientColorStops:[e],gradientColorStopPositions:[Wce,kd],inset:Me(),margin:Me(),opacity:_t(),padding:Ke(),saturate:_t(),scale:_t(),sepia:nt(),skew:_t(),space:Ke(),translate:Ke()},classGroups:{aspect:[{aspect:["auto","square","video",Wn]}],container:["container"],columns:[{columns:[Rd]}],"break-after":[{"break-after":pt()}],"break-before":[{"break-before":pt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Qe(),Wn]}],overflow:[{overflow:Oe()}],"overflow-x":[{"overflow-x":Oe()}],"overflow-y":[{"overflow-y":Oe()}],overscroll:[{overscroll:Ce()}],"overscroll-x":[{"overscroll-x":Ce()}],"overscroll-y":[{"overscroll-y":Ce()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[z]}],"inset-x":[{"inset-x":[z]}],"inset-y":[{"inset-y":[z]}],start:[{start:[z]}],end:[{end:[z]}],top:[{top:[z]}],right:[{right:[z]}],bottom:[{bottom:[z]}],left:[{left:[z]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Mx,Wn]}],basis:[{basis:Me()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Wn]}],grow:[{grow:nt()}],shrink:[{shrink:nt()}],order:[{order:["first","last","none",Mx,Wn]}],"grid-cols":[{"grid-cols":[Ox]}],"col-start-end":[{col:["auto",{span:["full",Mx,Wn]},Wn]}],"col-start":[{"col-start":Le()}],"col-end":[{"col-end":Le()}],"grid-rows":[{"grid-rows":[Ox]}],"row-start-end":[{row:["auto",{span:[Mx,Wn]},Wn]}],"row-start":[{"row-start":Le()}],"row-end":[{"row-end":Le()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Wn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Wn]}],gap:[{gap:[O]}],"gap-x":[{"gap-x":[O]}],"gap-y":[{"gap-y":[O]}],"justify-content":[{justify:["normal",...Ze()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ze(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ze(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[G]}],px:[{px:[G]}],py:[{py:[G]}],ps:[{ps:[G]}],pe:[{pe:[G]}],pt:[{pt:[G]}],pr:[{pr:[G]}],pb:[{pb:[G]}],pl:[{pl:[G]}],m:[{m:[$]}],mx:[{mx:[$]}],my:[{my:[$]}],ms:[{ms:[$]}],me:[{me:[$]}],mt:[{mt:[$]}],mr:[{mr:[$]}],mb:[{mb:[$]}],ml:[{ml:[$]}],"space-x":[{"space-x":[le]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[le]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Wn,t]}],"min-w":[{"min-w":[Wn,t,"min","max","fit"]}],"max-w":[{"max-w":[Wn,t,"none","full","min","max","fit","prose",{screen:[Rd]},Rd]}],h:[{h:[Wn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Wn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Wn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Wn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Rd,kd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",NM]}],"font-family":[{font:[Ox]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Wn]}],"line-clamp":[{"line-clamp":["none",Wy,NM]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",th,Wn]}],"list-image":[{"list-image":["none",Wn]}],"list-style-type":[{list:["none","disc","decimal",Wn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[U]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[U]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Je(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",th,kd]}],"underline-offset":[{"underline-offset":["auto",th,Wn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ke()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Wn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Wn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[U]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Qe(),Xce]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Zce]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Yce]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[B]}],"gradient-via-pos":[{via:[B]}],"gradient-to-pos":[{to:[B]}],"gradient-from":[{from:[L]}],"gradient-via":[{via:[L]}],"gradient-to":[{to:[L]}],rounded:[{rounded:[h]}],"rounded-s":[{"rounded-s":[h]}],"rounded-e":[{"rounded-e":[h]}],"rounded-t":[{"rounded-t":[h]}],"rounded-r":[{"rounded-r":[h]}],"rounded-b":[{"rounded-b":[h]}],"rounded-l":[{"rounded-l":[h]}],"rounded-ss":[{"rounded-ss":[h]}],"rounded-se":[{"rounded-se":[h]}],"rounded-ee":[{"rounded-ee":[h]}],"rounded-es":[{"rounded-es":[h]}],"rounded-tl":[{"rounded-tl":[h]}],"rounded-tr":[{"rounded-tr":[h]}],"rounded-br":[{"rounded-br":[h]}],"rounded-bl":[{"rounded-bl":[h]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[U]}],"border-style":[{border:[...Je(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[U]}],"divide-style":[{divide:Je()}],"border-color":[{border:[l]}],"border-color-x":[{"border-x":[l]}],"border-color-y":[{"border-y":[l]}],"border-color-s":[{"border-s":[l]}],"border-color-e":[{"border-e":[l]}],"border-color-t":[{"border-t":[l]}],"border-color-r":[{"border-r":[l]}],"border-color-b":[{"border-b":[l]}],"border-color-l":[{"border-l":[l]}],"divide-color":[{divide:[l]}],"outline-style":[{outline:["",...Je()]}],"outline-offset":[{"outline-offset":[th,Wn]}],"outline-w":[{outline:[th,kd]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Ye()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[U]}],"ring-offset-w":[{"ring-offset":[th,kd]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Rd,Jce]}],"shadow-color":[{shadow:[Ox]}],opacity:[{opacity:[U]}],"mix-blend":[{"mix-blend":[...it(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":it()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[v]}],"drop-shadow":[{"drop-shadow":["","none",Rd,Wn]}],grayscale:[{grayscale:[b]}],"hue-rotate":[{"hue-rotate":[E]}],invert:[{invert:[P]}],saturate:[{saturate:[Z]}],sepia:[{sepia:[Y]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[v]}],"backdrop-grayscale":[{"backdrop-grayscale":[b]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[E]}],"backdrop-invert":[{"backdrop-invert":[P]}],"backdrop-opacity":[{"backdrop-opacity":[U]}],"backdrop-saturate":[{"backdrop-saturate":[Z]}],"backdrop-sepia":[{"backdrop-sepia":[Y]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[f]}],"border-spacing-x":[{"border-spacing-x":[f]}],"border-spacing-y":[{"border-spacing-y":[f]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Wn]}],duration:[{duration:_t()}],ease:[{ease:["linear","in","out","in-out",Wn]}],delay:[{delay:_t()}],animate:[{animate:["none","spin","ping","pulse","bounce",Wn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ne]}],"scale-x":[{"scale-x":[ne]}],"scale-y":[{"scale-y":[ne]}],rotate:[{rotate:[Mx,Wn]}],"translate-x":[{"translate-x":[fe]}],"translate-y":[{"translate-y":[fe]}],"skew-x":[{"skew-x":[ee]}],"skew-y":[{"skew-y":[ee]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Wn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Wn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ke()}],"scroll-mx":[{"scroll-mx":Ke()}],"scroll-my":[{"scroll-my":Ke()}],"scroll-ms":[{"scroll-ms":Ke()}],"scroll-me":[{"scroll-me":Ke()}],"scroll-mt":[{"scroll-mt":Ke()}],"scroll-mr":[{"scroll-mr":Ke()}],"scroll-mb":[{"scroll-mb":Ke()}],"scroll-ml":[{"scroll-ml":Ke()}],"scroll-p":[{"scroll-p":Ke()}],"scroll-px":[{"scroll-px":Ke()}],"scroll-py":[{"scroll-py":Ke()}],"scroll-ps":[{"scroll-ps":Ke()}],"scroll-pe":[{"scroll-pe":Ke()}],"scroll-pt":[{"scroll-pt":Ke()}],"scroll-pr":[{"scroll-pr":Ke()}],"scroll-pb":[{"scroll-pb":Ke()}],"scroll-pl":[{"scroll-pl":Ke()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Wn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[th,kd,NM]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},nue=zce(rue);function ln(...e){return nue(qn(e))}const iue=Yle,L7=K.forwardRef(({className:e,...t},r)=>M.jsx(m7,{ref:r,className:ln("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));L7.displayName=m7.displayName;const oue=ev("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),j7=K.forwardRef(({className:e,variant:t,...r},n)=>M.jsx(g7,{ref:n,className:ln(oue({variant:t}),e),...r}));j7.displayName=g7.displayName;const sue=K.forwardRef(({className:e,...t},r)=>M.jsx(v7,{ref:r,className:ln("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));sue.displayName=v7.displayName;const N7=K.forwardRef(({className:e,...t},r)=>M.jsx(x7,{ref:r,className:ln("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:M.jsx($l,{className:"h-4 w-4"})}));N7.displayName=x7.displayName;const z7=K.forwardRef(({className:e,...t},r)=>M.jsx(y7,{ref:r,className:ln("text-sm font-semibold",e),...t}));z7.displayName=y7.displayName;const F7=K.forwardRef(({className:e,...t},r)=>M.jsx(_7,{ref:r,className:ln("text-sm opacity-90",e),...t}));F7.displayName=_7.displayName;function aue(){const{toasts:e}=mj();return M.jsxs(iue,{children:[e.map(function({id:t,title:r,description:n,action:l,...h}){return M.jsxs(j7,{...h,children:[M.jsxs("div",{className:"grid gap-1",children:[r&&M.jsx(z7,{children:r}),n&&M.jsx(F7,{children:n})]}),l,M.jsx(N7,{})]},t)}),M.jsx(L7,{})]})}var lue=e=>{switch(e){case"success":return hue;case"info":return fue;case"warning":return due;case"error":return pue;default:return null}},cue=Array(12).fill(0),uue=({visible:e,className:t})=>ze.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},ze.createElement("div",{className:"sonner-spinner"},cue.map((r,n)=>ze.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),hue=ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ze.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),due=ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ze.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),fue=ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ze.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),pue=ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ze.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),mue=ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ze.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ze.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),gue=()=>{let[e,t]=ze.useState(document.hidden);return ze.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},Zk=1,yue=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...n}=e,l=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:Zk++,h=this.toasts.find(o=>o.id===l),f=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(l)&&this.dismissedToasts.delete(l),h?this.toasts=this.toasts.map(o=>o.id===l?(this.publish({...o,...e,id:l,title:r}),{...o,...e,id:l,dismissible:f,title:r}):o):this.addToast({title:r,...n,dismissible:f,id:l}),l},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let n=e instanceof Promise?e:e(),l=r!==void 0,h,f=n.then(async v=>{if(h=["resolve",v],ze.isValidElement(v))l=!1,this.create({id:r,type:"default",message:v});else if(vue(v)&&!v.ok){l=!1;let b=typeof t.error=="function"?await t.error(`HTTP error! status: ${v.status}`):t.error,E=typeof t.description=="function"?await t.description(`HTTP error! status: ${v.status}`):t.description;this.create({id:r,type:"error",message:b,description:E})}else if(t.success!==void 0){l=!1;let b=typeof t.success=="function"?await t.success(v):t.success,E=typeof t.description=="function"?await t.description(v):t.description;this.create({id:r,type:"success",message:b,description:E})}}).catch(async v=>{if(h=["reject",v],t.error!==void 0){l=!1;let b=typeof t.error=="function"?await t.error(v):t.error,E=typeof t.description=="function"?await t.description(v):t.description;this.create({id:r,type:"error",message:b,description:E})}}).finally(()=>{var v;l&&(this.dismiss(r),r=void 0),(v=t.finally)==null||v.call(t)}),o=()=>new Promise((v,b)=>f.then(()=>h[0]==="reject"?b(h[1]):v(h[1])).catch(b));return typeof r!="string"&&typeof r!="number"?{unwrap:o}:Object.assign(r,{unwrap:o})},this.custom=(e,t)=>{let r=t?.id||Zk++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},La=new yue,_ue=(e,t)=>{let r=t?.id||Zk++;return La.addToast({title:e,...t,id:r}),r},vue=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",xue=_ue,bue=()=>La.toasts,wue=()=>La.getActiveToasts(),ch=Object.assign(xue,{success:La.success,info:La.info,warning:La.warning,error:La.error,custom:La.custom,message:La.message,promise:La.promise,dismiss:La.dismiss,loading:La.loading},{getHistory:bue,getToasts:wue});function Sue(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}Sue(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function CT(e){return e.label!==void 0}var Tue=3,Eue="32px",Aue="16px",n$=4e3,Pue=356,Cue=14,Iue=20,Mue=200;function oc(...e){return e.filter(Boolean).join(" ")}function Oue(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var kue=e=>{var t,r,n,l,h,f,o,v,b,E,P;let{invert:O,toast:L,unstyled:B,interacting:z,setHeights:$,visibleToasts:U,heights:G,index:Z,toasts:ne,expanded:Y,removeToast:ee,defaultRichColors:le,closeButton:fe,style:Ce,cancelButtonStyle:Oe,actionButtonStyle:Me,className:Ke="",descriptionClassName:Ye="",duration:Le,position:Qe,gap:Je,loadingIcon:it,expandByDefault:Ze,classNames:nt,icons:pt,closeButtonAriaLabel:_t="Close toast",pauseWhenPageIsHidden:It}=e,[sr,Sr]=ze.useState(null),[Kr,Er]=ze.useState(null),[Kt,Pr]=ze.useState(!1),[Qt,nr]=ze.useState(!1),[xr,Ft]=ze.useState(!1),[Pn,Hr]=ze.useState(!1),[Yr,kn]=ze.useState(!1),[Si,jo]=ze.useState(0),[No,ho]=ze.useState(0),Ci=ze.useRef(L.duration||Le||n$),vo=ze.useRef(null),fo=ze.useRef(null),Ta=Z===0,Za=Z+1<=U,Ii=L.type,xo=L.dismissible!==!1,Ou=L.className||"",Xa=L.descriptionClassName||"",Ka=ze.useMemo(()=>G.findIndex(ut=>ut.toastId===L.id)||0,[G,L.id]),Mo=ze.useMemo(()=>{var ut;return(ut=L.closeButton)!=null?ut:fe},[L.closeButton,fe]),cs=ze.useMemo(()=>L.duration||Le||n$,[L.duration,Le]),Ea=ze.useRef(0),us=ze.useRef(0),Ya=ze.useRef(0),Ts=ze.useRef(null),[Mc,Kn]=Qe.split("-"),Oc=ze.useMemo(()=>G.reduce((ut,Zn,Mi)=>Mi>=Ka?ut:ut+Zn.height,0),[G,Ka]),kc=gue(),Es=L.invert||O,Wl=Ii==="loading";us.current=ze.useMemo(()=>Ka*Je+Oc,[Ka,Oc]),ze.useEffect(()=>{Ci.current=cs},[cs]),ze.useEffect(()=>{Pr(!0)},[]),ze.useEffect(()=>{let ut=fo.current;if(ut){let Zn=ut.getBoundingClientRect().height;return ho(Zn),$(Mi=>[{toastId:L.id,height:Zn,position:L.position},...Mi]),()=>$(Mi=>Mi.filter(qo=>qo.toastId!==L.id))}},[$,L.id]),ze.useLayoutEffect(()=>{if(!Kt)return;let ut=fo.current,Zn=ut.style.height;ut.style.height="auto";let Mi=ut.getBoundingClientRect().height;ut.style.height=Zn,ho(Mi),$(qo=>qo.find(Br=>Br.toastId===L.id)?qo.map(Br=>Br.toastId===L.id?{...Br,height:Mi}:Br):[{toastId:L.id,height:Mi,position:L.position},...qo])},[Kt,L.title,L.description,$,L.id]);let Aa=ze.useCallback(()=>{nr(!0),jo(us.current),$(ut=>ut.filter(Zn=>Zn.toastId!==L.id)),setTimeout(()=>{ee(L)},Mue)},[L,ee,$,us]);ze.useEffect(()=>{if(L.promise&&Ii==="loading"||L.duration===1/0||L.type==="loading")return;let ut;return Y||z||It&&kc?(()=>{if(Ya.current<Ea.current){let Zn=new Date().getTime()-Ea.current;Ci.current=Ci.current-Zn}Ya.current=new Date().getTime()})():Ci.current!==1/0&&(Ea.current=new Date().getTime(),ut=setTimeout(()=>{var Zn;(Zn=L.onAutoClose)==null||Zn.call(L,L),Aa()},Ci.current)),()=>clearTimeout(ut)},[Y,z,L,Ii,It,kc,Aa]),ze.useEffect(()=>{L.delete&&Aa()},[Aa,L.delete]);function Rc(){var ut,Zn,Mi;return pt!=null&&pt.loading?ze.createElement("div",{className:oc(nt?.loader,(ut=L?.classNames)==null?void 0:ut.loader,"sonner-loader"),"data-visible":Ii==="loading"},pt.loading):it?ze.createElement("div",{className:oc(nt?.loader,(Zn=L?.classNames)==null?void 0:Zn.loader,"sonner-loader"),"data-visible":Ii==="loading"},it):ze.createElement(uue,{className:oc(nt?.loader,(Mi=L?.classNames)==null?void 0:Mi.loader),visible:Ii==="loading"})}return ze.createElement("li",{tabIndex:0,ref:fo,className:oc(Ke,Ou,nt?.toast,(t=L?.classNames)==null?void 0:t.toast,nt?.default,nt?.[Ii],(r=L?.classNames)==null?void 0:r[Ii]),"data-sonner-toast":"","data-rich-colors":(n=L.richColors)!=null?n:le,"data-styled":!(L.jsx||L.unstyled||B),"data-mounted":Kt,"data-promise":!!L.promise,"data-swiped":Yr,"data-removed":Qt,"data-visible":Za,"data-y-position":Mc,"data-x-position":Kn,"data-index":Z,"data-front":Ta,"data-swiping":xr,"data-dismissible":xo,"data-type":Ii,"data-invert":Es,"data-swipe-out":Pn,"data-swipe-direction":Kr,"data-expanded":!!(Y||Ze&&Kt),style:{"--index":Z,"--toasts-before":Z,"--z-index":ne.length-Z,"--offset":`${Qt?Si:us.current}px`,"--initial-height":Ze?"auto":`${No}px`,...Ce,...L.style},onDragEnd:()=>{Ft(!1),Sr(null),Ts.current=null},onPointerDown:ut=>{Wl||!xo||(vo.current=new Date,jo(us.current),ut.target.setPointerCapture(ut.pointerId),ut.target.tagName!=="BUTTON"&&(Ft(!0),Ts.current={x:ut.clientX,y:ut.clientY}))},onPointerUp:()=>{var ut,Zn,Mi,qo;if(Pn||!xo)return;Ts.current=null;let Br=Number(((ut=fo.current)==null?void 0:ut.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Ge=Number(((Zn=fo.current)==null?void 0:Zn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),se=new Date().getTime()-((Mi=vo.current)==null?void 0:Mi.getTime()),ce=sr==="x"?Br:Ge,ye=Math.abs(ce)/se;if(Math.abs(ce)>=Iue||ye>.11){jo(us.current),(qo=L.onDismiss)==null||qo.call(L,L),Er(sr==="x"?Br>0?"right":"left":Ge>0?"down":"up"),Aa(),Hr(!0),kn(!1);return}Ft(!1),Sr(null)},onPointerMove:ut=>{var Zn,Mi,qo,Br;if(!Ts.current||!xo||((Zn=window.getSelection())==null?void 0:Zn.toString().length)>0)return;let Ge=ut.clientY-Ts.current.y,se=ut.clientX-Ts.current.x,ce=(Mi=e.swipeDirections)!=null?Mi:Oue(Qe);!sr&&(Math.abs(se)>1||Math.abs(Ge)>1)&&Sr(Math.abs(se)>Math.abs(Ge)?"x":"y");let ye={x:0,y:0};sr==="y"?(ce.includes("top")||ce.includes("bottom"))&&(ce.includes("top")&&Ge<0||ce.includes("bottom")&&Ge>0)&&(ye.y=Ge):sr==="x"&&(ce.includes("left")||ce.includes("right"))&&(ce.includes("left")&&se<0||ce.includes("right")&&se>0)&&(ye.x=se),(Math.abs(ye.x)>0||Math.abs(ye.y)>0)&&kn(!0),(qo=fo.current)==null||qo.style.setProperty("--swipe-amount-x",`${ye.x}px`),(Br=fo.current)==null||Br.style.setProperty("--swipe-amount-y",`${ye.y}px`)}},Mo&&!L.jsx?ze.createElement("button",{"aria-label":_t,"data-disabled":Wl,"data-close-button":!0,onClick:Wl||!xo?()=>{}:()=>{var ut;Aa(),(ut=L.onDismiss)==null||ut.call(L,L)},className:oc(nt?.closeButton,(l=L?.classNames)==null?void 0:l.closeButton)},(h=pt?.close)!=null?h:mue):null,L.jsx||K.isValidElement(L.title)?L.jsx?L.jsx:typeof L.title=="function"?L.title():L.title:ze.createElement(ze.Fragment,null,Ii||L.icon||L.promise?ze.createElement("div",{"data-icon":"",className:oc(nt?.icon,(f=L?.classNames)==null?void 0:f.icon)},L.promise||L.type==="loading"&&!L.icon?L.icon||Rc():null,L.type!=="loading"?L.icon||pt?.[Ii]||lue(Ii):null):null,ze.createElement("div",{"data-content":"",className:oc(nt?.content,(o=L?.classNames)==null?void 0:o.content)},ze.createElement("div",{"data-title":"",className:oc(nt?.title,(v=L?.classNames)==null?void 0:v.title)},typeof L.title=="function"?L.title():L.title),L.description?ze.createElement("div",{"data-description":"",className:oc(Ye,Xa,nt?.description,(b=L?.classNames)==null?void 0:b.description)},typeof L.description=="function"?L.description():L.description):null),K.isValidElement(L.cancel)?L.cancel:L.cancel&&CT(L.cancel)?ze.createElement("button",{"data-button":!0,"data-cancel":!0,style:L.cancelButtonStyle||Oe,onClick:ut=>{var Zn,Mi;CT(L.cancel)&&xo&&((Mi=(Zn=L.cancel).onClick)==null||Mi.call(Zn,ut),Aa())},className:oc(nt?.cancelButton,(E=L?.classNames)==null?void 0:E.cancelButton)},L.cancel.label):null,K.isValidElement(L.action)?L.action:L.action&&CT(L.action)?ze.createElement("button",{"data-button":!0,"data-action":!0,style:L.actionButtonStyle||Me,onClick:ut=>{var Zn,Mi;CT(L.action)&&((Mi=(Zn=L.action).onClick)==null||Mi.call(Zn,ut),!ut.defaultPrevented&&Aa())},className:oc(nt?.actionButton,(P=L?.classNames)==null?void 0:P.actionButton)},L.action.label):null))};function i$(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Rue(e,t){let r={};return[e,t].forEach((n,l)=>{let h=l===1,f=h?"--mobile-offset":"--offset",o=h?Aue:Eue;function v(b){["top","right","bottom","left"].forEach(E=>{r[`${f}-${E}`]=typeof b=="number"?`${b}px`:b})}typeof n=="number"||typeof n=="string"?v(n):typeof n=="object"?["top","right","bottom","left"].forEach(b=>{n[b]===void 0?r[`${f}-${b}`]=o:r[`${f}-${b}`]=typeof n[b]=="number"?`${n[b]}px`:n[b]}):v(o)}),r}var Due=K.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:l=["altKey","KeyT"],expand:h,closeButton:f,className:o,offset:v,mobileOffset:b,theme:E="light",richColors:P,duration:O,style:L,visibleToasts:B=Tue,toastOptions:z,dir:$=i$(),gap:U=Cue,loadingIcon:G,icons:Z,containerAriaLabel:ne="Notifications",pauseWhenPageIsHidden:Y}=e,[ee,le]=ze.useState([]),fe=ze.useMemo(()=>Array.from(new Set([n].concat(ee.filter(It=>It.position).map(It=>It.position)))),[ee,n]),[Ce,Oe]=ze.useState([]),[Me,Ke]=ze.useState(!1),[Ye,Le]=ze.useState(!1),[Qe,Je]=ze.useState(E!=="system"?E:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),it=ze.useRef(null),Ze=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),nt=ze.useRef(null),pt=ze.useRef(!1),_t=ze.useCallback(It=>{le(sr=>{var Sr;return(Sr=sr.find(Kr=>Kr.id===It.id))!=null&&Sr.delete||La.dismiss(It.id),sr.filter(({id:Kr})=>Kr!==It.id)})},[]);return ze.useEffect(()=>La.subscribe(It=>{if(It.dismiss){le(sr=>sr.map(Sr=>Sr.id===It.id?{...Sr,delete:!0}:Sr));return}setTimeout(()=>{qq.flushSync(()=>{le(sr=>{let Sr=sr.findIndex(Kr=>Kr.id===It.id);return Sr!==-1?[...sr.slice(0,Sr),{...sr[Sr],...It},...sr.slice(Sr+1)]:[It,...sr]})})})}),[]),ze.useEffect(()=>{if(E!=="system"){Je(E);return}if(E==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Je("dark"):Je("light")),typeof window>"u")return;let It=window.matchMedia("(prefers-color-scheme: dark)");try{It.addEventListener("change",({matches:sr})=>{Je(sr?"dark":"light")})}catch{It.addListener(({matches:Sr})=>{try{Je(Sr?"dark":"light")}catch(Kr){console.error(Kr)}})}},[E]),ze.useEffect(()=>{ee.length<=1&&Ke(!1)},[ee]),ze.useEffect(()=>{let It=sr=>{var Sr,Kr;l.every(Er=>sr[Er]||sr.code===Er)&&(Ke(!0),(Sr=it.current)==null||Sr.focus()),sr.code==="Escape"&&(document.activeElement===it.current||(Kr=it.current)!=null&&Kr.contains(document.activeElement))&&Ke(!1)};return document.addEventListener("keydown",It),()=>document.removeEventListener("keydown",It)},[l]),ze.useEffect(()=>{if(it.current)return()=>{nt.current&&(nt.current.focus({preventScroll:!0}),nt.current=null,pt.current=!1)}},[it.current]),ze.createElement("section",{ref:t,"aria-label":`${ne} ${Ze}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},fe.map((It,sr)=>{var Sr;let[Kr,Er]=It.split("-");return ee.length?ze.createElement("ol",{key:It,dir:$==="auto"?i$():$,tabIndex:-1,ref:it,className:o,"data-sonner-toaster":!0,"data-theme":Qe,"data-y-position":Kr,"data-lifted":Me&&ee.length>1&&!h,"data-x-position":Er,style:{"--front-toast-height":`${((Sr=Ce[0])==null?void 0:Sr.height)||0}px`,"--width":`${Pue}px`,"--gap":`${U}px`,...L,...Rue(v,b)},onBlur:Kt=>{pt.current&&!Kt.currentTarget.contains(Kt.relatedTarget)&&(pt.current=!1,nt.current&&(nt.current.focus({preventScroll:!0}),nt.current=null))},onFocus:Kt=>{Kt.target instanceof HTMLElement&&Kt.target.dataset.dismissible==="false"||pt.current||(pt.current=!0,nt.current=Kt.relatedTarget)},onMouseEnter:()=>Ke(!0),onMouseMove:()=>Ke(!0),onMouseLeave:()=>{Ye||Ke(!1)},onDragEnd:()=>Ke(!1),onPointerDown:Kt=>{Kt.target instanceof HTMLElement&&Kt.target.dataset.dismissible==="false"||Le(!0)},onPointerUp:()=>Le(!1)},ee.filter(Kt=>!Kt.position&&sr===0||Kt.position===It).map((Kt,Pr)=>{var Qt,nr;return ze.createElement(kue,{key:Kt.id,icons:Z,index:Pr,toast:Kt,defaultRichColors:P,duration:(Qt=z?.duration)!=null?Qt:O,className:z?.className,descriptionClassName:z?.descriptionClassName,invert:r,visibleToasts:B,closeButton:(nr=z?.closeButton)!=null?nr:f,interacting:Ye,position:It,style:z?.style,unstyled:z?.unstyled,classNames:z?.classNames,cancelButtonStyle:z?.cancelButtonStyle,actionButtonStyle:z?.actionButtonStyle,removeToast:_t,toasts:ee.filter(xr=>xr.position==Kt.position),heights:Ce.filter(xr=>xr.position==Kt.position),setHeights:Oe,expandByDefault:h,gap:U,loadingIcon:G,expanded:Me,pauseWhenPageIsHidden:Y,swipeDirections:e.swipeDirections})})):null}))});const Lue=({...e})=>M.jsx(Due,{theme:"light",className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e});var jue=TL[" useId ".trim().toString()]||(()=>{}),Nue=0;function df(e){const[t,r]=K.useState(jue());return ws(()=>{r(n=>n??String(Nue++))},[e]),t?`radix-${t}`:""}const zue=["top","right","bottom","left"],yf=Math.min,al=Math.max,JE=Math.round,IT=Math.floor,yu=e=>({x:e,y:e}),Fue={left:"right",right:"left",bottom:"top",top:"bottom"},Bue={start:"end",end:"start"};function Xk(e,t,r){return al(e,yf(t,r))}function Th(e,t){return typeof e=="function"?e(t):e}function Eh(e){return e.split("-")[0]}function rv(e){return e.split("-")[1]}function Pj(e){return e==="x"?"y":"x"}function Cj(e){return e==="y"?"height":"width"}const $ue=new Set(["top","bottom"]);function fu(e){return $ue.has(Eh(e))?"y":"x"}function Ij(e){return Pj(fu(e))}function Vue(e,t,r){r===void 0&&(r=!1);const n=rv(e),l=Ij(e),h=Cj(l);let f=l==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[h]>t.floating[h]&&(f=QE(f)),[f,QE(f)]}function Uue(e){const t=QE(e);return[Kk(e),t,Kk(t)]}function Kk(e){return e.replace(/start|end/g,t=>Bue[t])}const o$=["left","right"],s$=["right","left"],Gue=["top","bottom"],Hue=["bottom","top"];function Wue(e,t,r){switch(e){case"top":case"bottom":return r?t?s$:o$:t?o$:s$;case"left":case"right":return t?Gue:Hue;default:return[]}}function que(e,t,r,n){const l=rv(e);let h=Wue(Eh(e),r==="start",n);return l&&(h=h.map(f=>f+"-"+l),t&&(h=h.concat(h.map(Kk)))),h}function QE(e){return e.replace(/left|right|bottom|top/g,t=>Fue[t])}function Zue(e){return{top:0,right:0,bottom:0,left:0,...e}}function B7(e){return typeof e!="number"?Zue(e):{top:e,right:e,bottom:e,left:e}}function e2(e){const{x:t,y:r,width:n,height:l}=e;return{width:n,height:l,top:r,left:t,right:t+n,bottom:r+l,x:t,y:r}}function a$(e,t,r){let{reference:n,floating:l}=e;const h=fu(t),f=Ij(t),o=Cj(f),v=Eh(t),b=h==="y",E=n.x+n.width/2-l.width/2,P=n.y+n.height/2-l.height/2,O=n[o]/2-l[o]/2;let L;switch(v){case"top":L={x:E,y:n.y-l.height};break;case"bottom":L={x:E,y:n.y+n.height};break;case"right":L={x:n.x+n.width,y:P};break;case"left":L={x:n.x-l.width,y:P};break;default:L={x:n.x,y:n.y}}switch(rv(t)){case"start":L[f]-=O*(r&&b?-1:1);break;case"end":L[f]+=O*(r&&b?-1:1);break}return L}const Xue=async(e,t,r)=>{const{placement:n="bottom",strategy:l="absolute",middleware:h=[],platform:f}=r,o=h.filter(Boolean),v=await(f.isRTL==null?void 0:f.isRTL(t));let b=await f.getElementRects({reference:e,floating:t,strategy:l}),{x:E,y:P}=a$(b,n,v),O=n,L={},B=0;for(let z=0;z<o.length;z++){const{name:$,fn:U}=o[z],{x:G,y:Z,data:ne,reset:Y}=await U({x:E,y:P,initialPlacement:n,placement:O,strategy:l,middlewareData:L,rects:b,platform:f,elements:{reference:e,floating:t}});E=G??E,P=Z??P,L={...L,[$]:{...L[$],...ne}},Y&&B<=50&&(B++,typeof Y=="object"&&(Y.placement&&(O=Y.placement),Y.rects&&(b=Y.rects===!0?await f.getElementRects({reference:e,floating:t,strategy:l}):Y.rects),{x:E,y:P}=a$(b,O,v)),z=-1)}return{x:E,y:P,placement:O,strategy:l,middlewareData:L}};async function Gb(e,t){var r;t===void 0&&(t={});const{x:n,y:l,platform:h,rects:f,elements:o,strategy:v}=e,{boundary:b="clippingAncestors",rootBoundary:E="viewport",elementContext:P="floating",altBoundary:O=!1,padding:L=0}=Th(t,e),B=B7(L),$=o[O?P==="floating"?"reference":"floating":P],U=e2(await h.getClippingRect({element:(r=await(h.isElement==null?void 0:h.isElement($)))==null||r?$:$.contextElement||await(h.getDocumentElement==null?void 0:h.getDocumentElement(o.floating)),boundary:b,rootBoundary:E,strategy:v})),G=P==="floating"?{x:n,y:l,width:f.floating.width,height:f.floating.height}:f.reference,Z=await(h.getOffsetParent==null?void 0:h.getOffsetParent(o.floating)),ne=await(h.isElement==null?void 0:h.isElement(Z))?await(h.getScale==null?void 0:h.getScale(Z))||{x:1,y:1}:{x:1,y:1},Y=e2(h.convertOffsetParentRelativeRectToViewportRelativeRect?await h.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:G,offsetParent:Z,strategy:v}):G);return{top:(U.top-Y.top+B.top)/ne.y,bottom:(Y.bottom-U.bottom+B.bottom)/ne.y,left:(U.left-Y.left+B.left)/ne.x,right:(Y.right-U.right+B.right)/ne.x}}const Kue=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:l,rects:h,platform:f,elements:o,middlewareData:v}=t,{element:b,padding:E=0}=Th(e,t)||{};if(b==null)return{};const P=B7(E),O={x:r,y:n},L=Ij(l),B=Cj(L),z=await f.getDimensions(b),$=L==="y",U=$?"top":"left",G=$?"bottom":"right",Z=$?"clientHeight":"clientWidth",ne=h.reference[B]+h.reference[L]-O[L]-h.floating[B],Y=O[L]-h.reference[L],ee=await(f.getOffsetParent==null?void 0:f.getOffsetParent(b));let le=ee?ee[Z]:0;(!le||!await(f.isElement==null?void 0:f.isElement(ee)))&&(le=o.floating[Z]||h.floating[B]);const fe=ne/2-Y/2,Ce=le/2-z[B]/2-1,Oe=yf(P[U],Ce),Me=yf(P[G],Ce),Ke=Oe,Ye=le-z[B]-Me,Le=le/2-z[B]/2+fe,Qe=Xk(Ke,Le,Ye),Je=!v.arrow&&rv(l)!=null&&Le!==Qe&&h.reference[B]/2-(Le<Ke?Oe:Me)-z[B]/2<0,it=Je?Le<Ke?Le-Ke:Le-Ye:0;return{[L]:O[L]+it,data:{[L]:Qe,centerOffset:Le-Qe-it,...Je&&{alignmentOffset:it}},reset:Je}}}),Yue=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:l,middlewareData:h,rects:f,initialPlacement:o,platform:v,elements:b}=t,{mainAxis:E=!0,crossAxis:P=!0,fallbackPlacements:O,fallbackStrategy:L="bestFit",fallbackAxisSideDirection:B="none",flipAlignment:z=!0,...$}=Th(e,t);if((r=h.arrow)!=null&&r.alignmentOffset)return{};const U=Eh(l),G=fu(o),Z=Eh(o)===o,ne=await(v.isRTL==null?void 0:v.isRTL(b.floating)),Y=O||(Z||!z?[QE(o)]:Uue(o)),ee=B!=="none";!O&&ee&&Y.push(...que(o,z,B,ne));const le=[o,...Y],fe=await Gb(t,$),Ce=[];let Oe=((n=h.flip)==null?void 0:n.overflows)||[];if(E&&Ce.push(fe[U]),P){const Le=Vue(l,f,ne);Ce.push(fe[Le[0]],fe[Le[1]])}if(Oe=[...Oe,{placement:l,overflows:Ce}],!Ce.every(Le=>Le<=0)){var Me,Ke;const Le=(((Me=h.flip)==null?void 0:Me.index)||0)+1,Qe=le[Le];if(Qe&&(!(P==="alignment"?G!==fu(Qe):!1)||Oe.every(Ze=>fu(Ze.placement)===G?Ze.overflows[0]>0:!0)))return{data:{index:Le,overflows:Oe},reset:{placement:Qe}};let Je=(Ke=Oe.filter(it=>it.overflows[0]<=0).sort((it,Ze)=>it.overflows[1]-Ze.overflows[1])[0])==null?void 0:Ke.placement;if(!Je)switch(L){case"bestFit":{var Ye;const it=(Ye=Oe.filter(Ze=>{if(ee){const nt=fu(Ze.placement);return nt===G||nt==="y"}return!0}).map(Ze=>[Ze.placement,Ze.overflows.filter(nt=>nt>0).reduce((nt,pt)=>nt+pt,0)]).sort((Ze,nt)=>Ze[1]-nt[1])[0])==null?void 0:Ye[0];it&&(Je=it);break}case"initialPlacement":Je=o;break}if(l!==Je)return{reset:{placement:Je}}}return{}}}};function l$(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function c$(e){return zue.some(t=>e[t]>=0)}const Jue=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...l}=Th(e,t);switch(n){case"referenceHidden":{const h=await Gb(t,{...l,elementContext:"reference"}),f=l$(h,r.reference);return{data:{referenceHiddenOffsets:f,referenceHidden:c$(f)}}}case"escaped":{const h=await Gb(t,{...l,altBoundary:!0}),f=l$(h,r.floating);return{data:{escapedOffsets:f,escaped:c$(f)}}}default:return{}}}}},$7=new Set(["left","top"]);async function Que(e,t){const{placement:r,platform:n,elements:l}=e,h=await(n.isRTL==null?void 0:n.isRTL(l.floating)),f=Eh(r),o=rv(r),v=fu(r)==="y",b=$7.has(f)?-1:1,E=h&&v?-1:1,P=Th(t,e);let{mainAxis:O,crossAxis:L,alignmentAxis:B}=typeof P=="number"?{mainAxis:P,crossAxis:0,alignmentAxis:null}:{mainAxis:P.mainAxis||0,crossAxis:P.crossAxis||0,alignmentAxis:P.alignmentAxis};return o&&typeof B=="number"&&(L=o==="end"?B*-1:B),v?{x:L*E,y:O*b}:{x:O*b,y:L*E}}const ehe=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:l,y:h,placement:f,middlewareData:o}=t,v=await Que(t,e);return f===((r=o.offset)==null?void 0:r.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:l+v.x,y:h+v.y,data:{...v,placement:f}}}}},the=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:l}=t,{mainAxis:h=!0,crossAxis:f=!1,limiter:o={fn:$=>{let{x:U,y:G}=$;return{x:U,y:G}}},...v}=Th(e,t),b={x:r,y:n},E=await Gb(t,v),P=fu(Eh(l)),O=Pj(P);let L=b[O],B=b[P];if(h){const $=O==="y"?"top":"left",U=O==="y"?"bottom":"right",G=L+E[$],Z=L-E[U];L=Xk(G,L,Z)}if(f){const $=P==="y"?"top":"left",U=P==="y"?"bottom":"right",G=B+E[$],Z=B-E[U];B=Xk(G,B,Z)}const z=o.fn({...t,[O]:L,[P]:B});return{...z,data:{x:z.x-r,y:z.y-n,enabled:{[O]:h,[P]:f}}}}}},rhe=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:l,rects:h,middlewareData:f}=t,{offset:o=0,mainAxis:v=!0,crossAxis:b=!0}=Th(e,t),E={x:r,y:n},P=fu(l),O=Pj(P);let L=E[O],B=E[P];const z=Th(o,t),$=typeof z=="number"?{mainAxis:z,crossAxis:0}:{mainAxis:0,crossAxis:0,...z};if(v){const Z=O==="y"?"height":"width",ne=h.reference[O]-h.floating[Z]+$.mainAxis,Y=h.reference[O]+h.reference[Z]-$.mainAxis;L<ne?L=ne:L>Y&&(L=Y)}if(b){var U,G;const Z=O==="y"?"width":"height",ne=$7.has(Eh(l)),Y=h.reference[P]-h.floating[Z]+(ne&&((U=f.offset)==null?void 0:U[P])||0)+(ne?0:$.crossAxis),ee=h.reference[P]+h.reference[Z]+(ne?0:((G=f.offset)==null?void 0:G[P])||0)-(ne?$.crossAxis:0);B<Y?B=Y:B>ee&&(B=ee)}return{[O]:L,[P]:B}}}},nhe=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:l,rects:h,platform:f,elements:o}=t,{apply:v=()=>{},...b}=Th(e,t),E=await Gb(t,b),P=Eh(l),O=rv(l),L=fu(l)==="y",{width:B,height:z}=h.floating;let $,U;P==="top"||P==="bottom"?($=P,U=O===(await(f.isRTL==null?void 0:f.isRTL(o.floating))?"start":"end")?"left":"right"):(U=P,$=O==="end"?"top":"bottom");const G=z-E.top-E.bottom,Z=B-E.left-E.right,ne=yf(z-E[$],G),Y=yf(B-E[U],Z),ee=!t.middlewareData.shift;let le=ne,fe=Y;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(fe=Z),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(le=G),ee&&!O){const Oe=al(E.left,0),Me=al(E.right,0),Ke=al(E.top,0),Ye=al(E.bottom,0);L?fe=B-2*(Oe!==0||Me!==0?Oe+Me:al(E.left,E.right)):le=z-2*(Ke!==0||Ye!==0?Ke+Ye:al(E.top,E.bottom))}await v({...t,availableWidth:fe,availableHeight:le});const Ce=await f.getDimensions(o.floating);return B!==Ce.width||z!==Ce.height?{reset:{rects:!0}}:{}}}};function LA(){return typeof window<"u"}function nv(e){return V7(e)?(e.nodeName||"").toLowerCase():"#document"}function hl(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Pu(e){var t;return(t=(V7(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function V7(e){return LA()?e instanceof Node||e instanceof hl(e).Node:!1}function Sc(e){return LA()?e instanceof Element||e instanceof hl(e).Element:!1}function Eu(e){return LA()?e instanceof HTMLElement||e instanceof hl(e).HTMLElement:!1}function u$(e){return!LA()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof hl(e).ShadowRoot}const ihe=new Set(["inline","contents"]);function Hw(e){const{overflow:t,overflowX:r,overflowY:n,display:l}=Tc(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!ihe.has(l)}const ohe=new Set(["table","td","th"]);function she(e){return ohe.has(nv(e))}const ahe=[":popover-open",":modal"];function jA(e){return ahe.some(t=>{try{return e.matches(t)}catch{return!1}})}const lhe=["transform","translate","scale","rotate","perspective"],che=["transform","translate","scale","rotate","perspective","filter"],uhe=["paint","layout","strict","content"];function Mj(e){const t=Oj(),r=Sc(e)?Tc(e):e;return lhe.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||che.some(n=>(r.willChange||"").includes(n))||uhe.some(n=>(r.contain||"").includes(n))}function hhe(e){let t=_f(e);for(;Eu(t)&&!x_(t);){if(Mj(t))return t;if(jA(t))return null;t=_f(t)}return null}function Oj(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const dhe=new Set(["html","body","#document"]);function x_(e){return dhe.has(nv(e))}function Tc(e){return hl(e).getComputedStyle(e)}function NA(e){return Sc(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function _f(e){if(nv(e)==="html")return e;const t=e.assignedSlot||e.parentNode||u$(e)&&e.host||Pu(e);return u$(t)?t.host:t}function U7(e){const t=_f(e);return x_(t)?e.ownerDocument?e.ownerDocument.body:e.body:Eu(t)&&Hw(t)?t:U7(t)}function Hb(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const l=U7(e),h=l===((n=e.ownerDocument)==null?void 0:n.body),f=hl(l);if(h){const o=Yk(f);return t.concat(f,f.visualViewport||[],Hw(l)?l:[],o&&r?Hb(o):[])}return t.concat(l,Hb(l,[],r))}function Yk(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function G7(e){const t=Tc(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const l=Eu(e),h=l?e.offsetWidth:r,f=l?e.offsetHeight:n,o=JE(r)!==h||JE(n)!==f;return o&&(r=h,n=f),{width:r,height:n,$:o}}function kj(e){return Sc(e)?e:e.contextElement}function qy(e){const t=kj(e);if(!Eu(t))return yu(1);const r=t.getBoundingClientRect(),{width:n,height:l,$:h}=G7(t);let f=(h?JE(r.width):r.width)/n,o=(h?JE(r.height):r.height)/l;return(!f||!Number.isFinite(f))&&(f=1),(!o||!Number.isFinite(o))&&(o=1),{x:f,y:o}}const fhe=yu(0);function H7(e){const t=hl(e);return!Oj()||!t.visualViewport?fhe:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function phe(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==hl(e)?!1:t}function ym(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const l=e.getBoundingClientRect(),h=kj(e);let f=yu(1);t&&(n?Sc(n)&&(f=qy(n)):f=qy(e));const o=phe(h,r,n)?H7(h):yu(0);let v=(l.left+o.x)/f.x,b=(l.top+o.y)/f.y,E=l.width/f.x,P=l.height/f.y;if(h){const O=hl(h),L=n&&Sc(n)?hl(n):n;let B=O,z=Yk(B);for(;z&&n&&L!==B;){const $=qy(z),U=z.getBoundingClientRect(),G=Tc(z),Z=U.left+(z.clientLeft+parseFloat(G.paddingLeft))*$.x,ne=U.top+(z.clientTop+parseFloat(G.paddingTop))*$.y;v*=$.x,b*=$.y,E*=$.x,P*=$.y,v+=Z,b+=ne,B=hl(z),z=Yk(B)}}return e2({width:E,height:P,x:v,y:b})}function zA(e,t){const r=NA(e).scrollLeft;return t?t.left+r:ym(Pu(e)).left+r}function W7(e,t){const r=e.getBoundingClientRect(),n=r.left+t.scrollLeft-zA(e,r),l=r.top+t.scrollTop;return{x:n,y:l}}function mhe(e){let{elements:t,rect:r,offsetParent:n,strategy:l}=e;const h=l==="fixed",f=Pu(n),o=t?jA(t.floating):!1;if(n===f||o&&h)return r;let v={scrollLeft:0,scrollTop:0},b=yu(1);const E=yu(0),P=Eu(n);if((P||!P&&!h)&&((nv(n)!=="body"||Hw(f))&&(v=NA(n)),Eu(n))){const L=ym(n);b=qy(n),E.x=L.x+n.clientLeft,E.y=L.y+n.clientTop}const O=f&&!P&&!h?W7(f,v):yu(0);return{width:r.width*b.x,height:r.height*b.y,x:r.x*b.x-v.scrollLeft*b.x+E.x+O.x,y:r.y*b.y-v.scrollTop*b.y+E.y+O.y}}function ghe(e){return Array.from(e.getClientRects())}function yhe(e){const t=Pu(e),r=NA(e),n=e.ownerDocument.body,l=al(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),h=al(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let f=-r.scrollLeft+zA(e);const o=-r.scrollTop;return Tc(n).direction==="rtl"&&(f+=al(t.clientWidth,n.clientWidth)-l),{width:l,height:h,x:f,y:o}}const h$=25;function _he(e,t){const r=hl(e),n=Pu(e),l=r.visualViewport;let h=n.clientWidth,f=n.clientHeight,o=0,v=0;if(l){h=l.width,f=l.height;const E=Oj();(!E||E&&t==="fixed")&&(o=l.offsetLeft,v=l.offsetTop)}const b=zA(n);if(b<=0){const E=n.ownerDocument,P=E.body,O=getComputedStyle(P),L=E.compatMode==="CSS1Compat"&&parseFloat(O.marginLeft)+parseFloat(O.marginRight)||0,B=Math.abs(n.clientWidth-P.clientWidth-L);B<=h$&&(h-=B)}else b<=h$&&(h+=b);return{width:h,height:f,x:o,y:v}}const vhe=new Set(["absolute","fixed"]);function xhe(e,t){const r=ym(e,!0,t==="fixed"),n=r.top+e.clientTop,l=r.left+e.clientLeft,h=Eu(e)?qy(e):yu(1),f=e.clientWidth*h.x,o=e.clientHeight*h.y,v=l*h.x,b=n*h.y;return{width:f,height:o,x:v,y:b}}function d$(e,t,r){let n;if(t==="viewport")n=_he(e,r);else if(t==="document")n=yhe(Pu(e));else if(Sc(t))n=xhe(t,r);else{const l=H7(e);n={x:t.x-l.x,y:t.y-l.y,width:t.width,height:t.height}}return e2(n)}function q7(e,t){const r=_f(e);return r===t||!Sc(r)||x_(r)?!1:Tc(r).position==="fixed"||q7(r,t)}function bhe(e,t){const r=t.get(e);if(r)return r;let n=Hb(e,[],!1).filter(o=>Sc(o)&&nv(o)!=="body"),l=null;const h=Tc(e).position==="fixed";let f=h?_f(e):e;for(;Sc(f)&&!x_(f);){const o=Tc(f),v=Mj(f);!v&&o.position==="fixed"&&(l=null),(h?!v&&!l:!v&&o.position==="static"&&!!l&&vhe.has(l.position)||Hw(f)&&!v&&q7(e,f))?n=n.filter(E=>E!==f):l=o,f=_f(f)}return t.set(e,n),n}function whe(e){let{element:t,boundary:r,rootBoundary:n,strategy:l}=e;const f=[...r==="clippingAncestors"?jA(t)?[]:bhe(t,this._c):[].concat(r),n],o=f[0],v=f.reduce((b,E)=>{const P=d$(t,E,l);return b.top=al(P.top,b.top),b.right=yf(P.right,b.right),b.bottom=yf(P.bottom,b.bottom),b.left=al(P.left,b.left),b},d$(t,o,l));return{width:v.right-v.left,height:v.bottom-v.top,x:v.left,y:v.top}}function She(e){const{width:t,height:r}=G7(e);return{width:t,height:r}}function The(e,t,r){const n=Eu(t),l=Pu(t),h=r==="fixed",f=ym(e,!0,h,t);let o={scrollLeft:0,scrollTop:0};const v=yu(0);function b(){v.x=zA(l)}if(n||!n&&!h)if((nv(t)!=="body"||Hw(l))&&(o=NA(t)),n){const L=ym(t,!0,h,t);v.x=L.x+t.clientLeft,v.y=L.y+t.clientTop}else l&&b();h&&!n&&l&&b();const E=l&&!n&&!h?W7(l,o):yu(0),P=f.left+o.scrollLeft-v.x-E.x,O=f.top+o.scrollTop-v.y-E.y;return{x:P,y:O,width:f.width,height:f.height}}function zM(e){return Tc(e).position==="static"}function f$(e,t){if(!Eu(e)||Tc(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Pu(e)===r&&(r=r.ownerDocument.body),r}function Z7(e,t){const r=hl(e);if(jA(e))return r;if(!Eu(e)){let l=_f(e);for(;l&&!x_(l);){if(Sc(l)&&!zM(l))return l;l=_f(l)}return r}let n=f$(e,t);for(;n&&she(n)&&zM(n);)n=f$(n,t);return n&&x_(n)&&zM(n)&&!Mj(n)?r:n||hhe(e)||r}const Ehe=async function(e){const t=this.getOffsetParent||Z7,r=this.getDimensions,n=await r(e.floating);return{reference:The(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function Ahe(e){return Tc(e).direction==="rtl"}const Phe={convertOffsetParentRelativeRectToViewportRelativeRect:mhe,getDocumentElement:Pu,getClippingRect:whe,getOffsetParent:Z7,getElementRects:Ehe,getClientRects:ghe,getDimensions:She,getScale:qy,isElement:Sc,isRTL:Ahe};function X7(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Che(e,t){let r=null,n;const l=Pu(e);function h(){var o;clearTimeout(n),(o=r)==null||o.disconnect(),r=null}function f(o,v){o===void 0&&(o=!1),v===void 0&&(v=1),h();const b=e.getBoundingClientRect(),{left:E,top:P,width:O,height:L}=b;if(o||t(),!O||!L)return;const B=IT(P),z=IT(l.clientWidth-(E+O)),$=IT(l.clientHeight-(P+L)),U=IT(E),Z={rootMargin:-B+"px "+-z+"px "+-$+"px "+-U+"px",threshold:al(0,yf(1,v))||1};let ne=!0;function Y(ee){const le=ee[0].intersectionRatio;if(le!==v){if(!ne)return f();le?f(!1,le):n=setTimeout(()=>{f(!1,1e-7)},1e3)}le===1&&!X7(b,e.getBoundingClientRect())&&f(),ne=!1}try{r=new IntersectionObserver(Y,{...Z,root:l.ownerDocument})}catch{r=new IntersectionObserver(Y,Z)}r.observe(e)}return f(!0),h}function Ihe(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:l=!0,ancestorResize:h=!0,elementResize:f=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:v=!1}=n,b=kj(e),E=l||h?[...b?Hb(b):[],...Hb(t)]:[];E.forEach(U=>{l&&U.addEventListener("scroll",r,{passive:!0}),h&&U.addEventListener("resize",r)});const P=b&&o?Che(b,r):null;let O=-1,L=null;f&&(L=new ResizeObserver(U=>{let[G]=U;G&&G.target===b&&L&&(L.unobserve(t),cancelAnimationFrame(O),O=requestAnimationFrame(()=>{var Z;(Z=L)==null||Z.observe(t)})),r()}),b&&!v&&L.observe(b),L.observe(t));let B,z=v?ym(e):null;v&&$();function $(){const U=ym(e);z&&!X7(z,U)&&r(),z=U,B=requestAnimationFrame($)}return r(),()=>{var U;E.forEach(G=>{l&&G.removeEventListener("scroll",r),h&&G.removeEventListener("resize",r)}),P?.(),(U=L)==null||U.disconnect(),L=null,v&&cancelAnimationFrame(B)}}const Mhe=ehe,Ohe=the,khe=Yue,Rhe=nhe,Dhe=Jue,p$=Kue,Lhe=rhe,jhe=(e,t,r)=>{const n=new Map,l={platform:Phe,...r},h={...l.platform,_c:n};return Xue(e,t,{...l,platform:h})};var Nhe=typeof document<"u",zhe=function(){},_E=Nhe?K.useLayoutEffect:zhe;function t2(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,l;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!t2(e[n],t[n]))return!1;return!0}if(l=Object.keys(e),r=l.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,l[n]))return!1;for(n=r;n--!==0;){const h=l[n];if(!(h==="_owner"&&e.$$typeof)&&!t2(e[h],t[h]))return!1}return!0}return e!==e&&t!==t}function K7(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function m$(e,t){const r=K7(e);return Math.round(t*r)/r}function FM(e){const t=K.useRef(e);return _E(()=>{t.current=e}),t}function Fhe(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:l,elements:{reference:h,floating:f}={},transform:o=!0,whileElementsMounted:v,open:b}=e,[E,P]=K.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[O,L]=K.useState(n);t2(O,n)||L(n);const[B,z]=K.useState(null),[$,U]=K.useState(null),G=K.useCallback(Ze=>{Ze!==ee.current&&(ee.current=Ze,z(Ze))},[]),Z=K.useCallback(Ze=>{Ze!==le.current&&(le.current=Ze,U(Ze))},[]),ne=h||B,Y=f||$,ee=K.useRef(null),le=K.useRef(null),fe=K.useRef(E),Ce=v!=null,Oe=FM(v),Me=FM(l),Ke=FM(b),Ye=K.useCallback(()=>{if(!ee.current||!le.current)return;const Ze={placement:t,strategy:r,middleware:O};Me.current&&(Ze.platform=Me.current),jhe(ee.current,le.current,Ze).then(nt=>{const pt={...nt,isPositioned:Ke.current!==!1};Le.current&&!t2(fe.current,pt)&&(fe.current=pt,Mm.flushSync(()=>{P(pt)}))})},[O,t,r,Me,Ke]);_E(()=>{b===!1&&fe.current.isPositioned&&(fe.current.isPositioned=!1,P(Ze=>({...Ze,isPositioned:!1})))},[b]);const Le=K.useRef(!1);_E(()=>(Le.current=!0,()=>{Le.current=!1}),[]),_E(()=>{if(ne&&(ee.current=ne),Y&&(le.current=Y),ne&&Y){if(Oe.current)return Oe.current(ne,Y,Ye);Ye()}},[ne,Y,Ye,Oe,Ce]);const Qe=K.useMemo(()=>({reference:ee,floating:le,setReference:G,setFloating:Z}),[G,Z]),Je=K.useMemo(()=>({reference:ne,floating:Y}),[ne,Y]),it=K.useMemo(()=>{const Ze={position:r,left:0,top:0};if(!Je.floating)return Ze;const nt=m$(Je.floating,E.x),pt=m$(Je.floating,E.y);return o?{...Ze,transform:"translate("+nt+"px, "+pt+"px)",...K7(Je.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:nt,top:pt}},[r,o,Je.floating,E.x,E.y]);return K.useMemo(()=>({...E,update:Ye,refs:Qe,elements:Je,floatingStyles:it}),[E,Ye,Qe,Je,it])}const Bhe=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:l}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?p$({element:n.current,padding:l}).fn(r):{}:n?p$({element:n,padding:l}).fn(r):{}}}},$he=(e,t)=>({...Mhe(e),options:[e,t]}),Vhe=(e,t)=>({...Ohe(e),options:[e,t]}),Uhe=(e,t)=>({...Lhe(e),options:[e,t]}),Ghe=(e,t)=>({...khe(e),options:[e,t]}),Hhe=(e,t)=>({...Rhe(e),options:[e,t]}),Whe=(e,t)=>({...Dhe(e),options:[e,t]}),qhe=(e,t)=>({...Bhe(e),options:[e,t]});var Zhe="Arrow",Y7=K.forwardRef((e,t)=>{const{children:r,width:n=10,height:l=5,...h}=e;return M.jsx(pn.svg,{...h,ref:t,width:n,height:l,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:M.jsx("polygon",{points:"0,0 30,0 15,10"})})});Y7.displayName=Zhe;var Xhe=Y7;function J7(e){const[t,r]=K.useState(void 0);return ws(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(l=>{if(!Array.isArray(l)||!l.length)return;const h=l[0];let f,o;if("borderBoxSize"in h){const v=h.borderBoxSize,b=Array.isArray(v)?v[0]:v;f=b.inlineSize,o=b.blockSize}else f=e.offsetWidth,o=e.offsetHeight;r({width:f,height:o})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var Rj="Popper",[Q7,FA]=Ec(Rj),[Khe,e9]=Q7(Rj),t9=e=>{const{__scopePopper:t,children:r}=e,[n,l]=K.useState(null);return M.jsx(Khe,{scope:t,anchor:n,onAnchorChange:l,children:r})};t9.displayName=Rj;var r9="PopperAnchor",n9=K.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...l}=e,h=e9(r9,r),f=K.useRef(null),o=mi(t,f),v=K.useRef(null);return K.useEffect(()=>{const b=v.current;v.current=n?.current||f.current,b!==v.current&&h.onAnchorChange(v.current)}),n?null:M.jsx(pn.div,{...l,ref:o})});n9.displayName=r9;var Dj="PopperContent",[Yhe,Jhe]=Q7(Dj),i9=K.forwardRef((e,t)=>{const{__scopePopper:r,side:n="bottom",sideOffset:l=0,align:h="center",alignOffset:f=0,arrowPadding:o=0,avoidCollisions:v=!0,collisionBoundary:b=[],collisionPadding:E=0,sticky:P="partial",hideWhenDetached:O=!1,updatePositionStrategy:L="optimized",onPlaced:B,...z}=e,$=e9(Dj,r),[U,G]=K.useState(null),Z=mi(t,Kt=>G(Kt)),[ne,Y]=K.useState(null),ee=J7(ne),le=ee?.width??0,fe=ee?.height??0,Ce=n+(h!=="center"?"-"+h:""),Oe=typeof E=="number"?E:{top:0,right:0,bottom:0,left:0,...E},Me=Array.isArray(b)?b:[b],Ke=Me.length>0,Ye={padding:Oe,boundary:Me.filter(ede),altBoundary:Ke},{refs:Le,floatingStyles:Qe,placement:Je,isPositioned:it,middlewareData:Ze}=Fhe({strategy:"fixed",placement:Ce,whileElementsMounted:(...Kt)=>Ihe(...Kt,{animationFrame:L==="always"}),elements:{reference:$.anchor},middleware:[$he({mainAxis:l+fe,alignmentAxis:f}),v&&Vhe({mainAxis:!0,crossAxis:!1,limiter:P==="partial"?Uhe():void 0,...Ye}),v&&Ghe({...Ye}),Hhe({...Ye,apply:({elements:Kt,rects:Pr,availableWidth:Qt,availableHeight:nr})=>{const{width:xr,height:Ft}=Pr.reference,Pn=Kt.floating.style;Pn.setProperty("--radix-popper-available-width",`${Qt}px`),Pn.setProperty("--radix-popper-available-height",`${nr}px`),Pn.setProperty("--radix-popper-anchor-width",`${xr}px`),Pn.setProperty("--radix-popper-anchor-height",`${Ft}px`)}}),ne&&qhe({element:ne,padding:o}),tde({arrowWidth:le,arrowHeight:fe}),O&&Whe({strategy:"referenceHidden",...Ye})]}),[nt,pt]=a9(Je),_t=os(B);ws(()=>{it&&_t?.()},[it,_t]);const It=Ze.arrow?.x,sr=Ze.arrow?.y,Sr=Ze.arrow?.centerOffset!==0,[Kr,Er]=K.useState();return ws(()=>{U&&Er(window.getComputedStyle(U).zIndex)},[U]),M.jsx("div",{ref:Le.setFloating,"data-radix-popper-content-wrapper":"",style:{...Qe,transform:it?Qe.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Kr,"--radix-popper-transform-origin":[Ze.transformOrigin?.x,Ze.transformOrigin?.y].join(" "),...Ze.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:M.jsx(Yhe,{scope:r,placedSide:nt,onArrowChange:Y,arrowX:It,arrowY:sr,shouldHideArrow:Sr,children:M.jsx(pn.div,{"data-side":nt,"data-align":pt,...z,ref:Z,style:{...z.style,animation:it?void 0:"none"}})})})});i9.displayName=Dj;var o9="PopperArrow",Qhe={top:"bottom",right:"left",bottom:"top",left:"right"},s9=K.forwardRef(function(t,r){const{__scopePopper:n,...l}=t,h=Jhe(o9,n),f=Qhe[h.placedSide];return M.jsx("span",{ref:h.onArrowChange,style:{position:"absolute",left:h.arrowX,top:h.arrowY,[f]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[h.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[h.placedSide],visibility:h.shouldHideArrow?"hidden":void 0},children:M.jsx(Xhe,{...l,ref:r,style:{...l.style,display:"block"}})})});s9.displayName=o9;function ede(e){return e!==null}var tde=e=>({name:"transformOrigin",options:e,fn(t){const{placement:r,rects:n,middlewareData:l}=t,f=l.arrow?.centerOffset!==0,o=f?0:e.arrowWidth,v=f?0:e.arrowHeight,[b,E]=a9(r),P={start:"0%",center:"50%",end:"100%"}[E],O=(l.arrow?.x??0)+o/2,L=(l.arrow?.y??0)+v/2;let B="",z="";return b==="bottom"?(B=f?P:`${O}px`,z=`${-v}px`):b==="top"?(B=f?P:`${O}px`,z=`${n.floating.height+v}px`):b==="right"?(B=`${-v}px`,z=f?P:`${L}px`):b==="left"&&(B=`${n.floating.width+v}px`,z=f?P:`${L}px`),{data:{x:B,y:z}}}});function a9(e){const[t,r="center"]=e.split("-");return[t,r]}var rde=t9,l9=n9,c9=i9,u9=s9,[BA,jGe]=Ec("Tooltip",[FA]),Lj=FA(),h9="TooltipProvider",nde=700,g$="tooltip.open",[ide,d9]=BA(h9),f9=e=>{const{__scopeTooltip:t,delayDuration:r=nde,skipDelayDuration:n=300,disableHoverableContent:l=!1,children:h}=e,f=K.useRef(!0),o=K.useRef(!1),v=K.useRef(0);return K.useEffect(()=>{const b=v.current;return()=>window.clearTimeout(b)},[]),M.jsx(ide,{scope:t,isOpenDelayedRef:f,delayDuration:r,onOpen:K.useCallback(()=>{window.clearTimeout(v.current),f.current=!1},[]),onClose:K.useCallback(()=>{window.clearTimeout(v.current),v.current=window.setTimeout(()=>f.current=!0,n)},[n]),isPointerInTransitRef:o,onPointerInTransitChange:K.useCallback(b=>{o.current=b},[]),disableHoverableContent:l,children:h})};f9.displayName=h9;var p9="Tooltip",[NGe,$A]=BA(p9),Jk="TooltipTrigger",ode=K.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,l=$A(Jk,r),h=d9(Jk,r),f=Lj(r),o=K.useRef(null),v=mi(t,o,l.onTriggerChange),b=K.useRef(!1),E=K.useRef(!1),P=K.useCallback(()=>b.current=!1,[]);return K.useEffect(()=>()=>document.removeEventListener("pointerup",P),[P]),M.jsx(l9,{asChild:!0,...f,children:M.jsx(pn.button,{"aria-describedby":l.open?l.contentId:void 0,"data-state":l.stateAttribute,...n,ref:v,onPointerMove:Xr(e.onPointerMove,O=>{O.pointerType!=="touch"&&!E.current&&!h.isPointerInTransitRef.current&&(l.onTriggerEnter(),E.current=!0)}),onPointerLeave:Xr(e.onPointerLeave,()=>{l.onTriggerLeave(),E.current=!1}),onPointerDown:Xr(e.onPointerDown,()=>{l.open&&l.onClose(),b.current=!0,document.addEventListener("pointerup",P,{once:!0})}),onFocus:Xr(e.onFocus,()=>{b.current||l.onOpen()}),onBlur:Xr(e.onBlur,l.onClose),onClick:Xr(e.onClick,l.onClose)})})});ode.displayName=Jk;var sde="TooltipPortal",[zGe,ade]=BA(sde,{forceMount:void 0}),b_="TooltipContent",m9=K.forwardRef((e,t)=>{const r=ade(b_,e.__scopeTooltip),{forceMount:n=r.forceMount,side:l="top",...h}=e,f=$A(b_,e.__scopeTooltip);return M.jsx(Ac,{present:n||f.open,children:f.disableHoverableContent?M.jsx(g9,{side:l,...h,ref:t}):M.jsx(lde,{side:l,...h,ref:t})})}),lde=K.forwardRef((e,t)=>{const r=$A(b_,e.__scopeTooltip),n=d9(b_,e.__scopeTooltip),l=K.useRef(null),h=mi(t,l),[f,o]=K.useState(null),{trigger:v,onClose:b}=r,E=l.current,{onPointerInTransitChange:P}=n,O=K.useCallback(()=>{o(null),P(!1)},[P]),L=K.useCallback((B,z)=>{const $=B.currentTarget,U={x:B.clientX,y:B.clientY},G=fde(U,$.getBoundingClientRect()),Z=pde(U,G),ne=mde(z.getBoundingClientRect()),Y=yde([...Z,...ne]);o(Y),P(!0)},[P]);return K.useEffect(()=>()=>O(),[O]),K.useEffect(()=>{if(v&&E){const B=$=>L($,E),z=$=>L($,v);return v.addEventListener("pointerleave",B),E.addEventListener("pointerleave",z),()=>{v.removeEventListener("pointerleave",B),E.removeEventListener("pointerleave",z)}}},[v,E,L,O]),K.useEffect(()=>{if(f){const B=z=>{const $=z.target,U={x:z.clientX,y:z.clientY},G=v?.contains($)||E?.contains($),Z=!gde(U,f);G?O():Z&&(O(),b())};return document.addEventListener("pointermove",B),()=>document.removeEventListener("pointermove",B)}},[v,E,f,b,O]),M.jsx(g9,{...e,ref:h})}),[cde,ude]=BA(p9,{isInside:!1}),hde=hle("TooltipContent"),g9=K.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":l,onEscapeKeyDown:h,onPointerDownOutside:f,...o}=e,v=$A(b_,r),b=Lj(r),{onClose:E}=v;return K.useEffect(()=>(document.addEventListener(g$,E),()=>document.removeEventListener(g$,E)),[E]),K.useEffect(()=>{if(v.trigger){const P=O=>{O.target?.contains(v.trigger)&&E()};return window.addEventListener("scroll",P,{capture:!0}),()=>window.removeEventListener("scroll",P,{capture:!0})}},[v.trigger,E]),M.jsx(Uw,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:h,onPointerDownOutside:f,onFocusOutside:P=>P.preventDefault(),onDismiss:E,children:M.jsxs(c9,{"data-state":v.stateAttribute,...b,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[M.jsx(hde,{children:n}),M.jsx(cde,{scope:r,isInside:!0,children:M.jsx(Rle,{id:v.contentId,role:"tooltip",children:l||n})})]})})});m9.displayName=b_;var y9="TooltipArrow",dde=K.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,l=Lj(r);return ude(y9,r).isInside?null:M.jsx(u9,{...l,...n,ref:t})});dde.displayName=y9;function fde(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),l=Math.abs(t.right-e.x),h=Math.abs(t.left-e.x);switch(Math.min(r,n,l,h)){case h:return"left";case l:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function pde(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function mde(e){const{top:t,right:r,bottom:n,left:l}=e;return[{x:l,y:t},{x:r,y:t},{x:r,y:n},{x:l,y:n}]}function gde(e,t){const{x:r,y:n}=e;let l=!1;for(let h=0,f=t.length-1;h<t.length;f=h++){const o=t[h],v=t[f],b=o.x,E=o.y,P=v.x,O=v.y;E>n!=O>n&&r<(P-b)*(n-E)/(O-E)+b&&(l=!l)}return l}function yde(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),_de(t)}function _de(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const l=e[n];for(;t.length>=2;){const h=t[t.length-1],f=t[t.length-2];if((h.x-f.x)*(l.y-f.y)>=(h.y-f.y)*(l.x-f.x))t.pop();else break}t.push(l)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const l=e[n];for(;r.length>=2;){const h=r[r.length-1],f=r[r.length-2];if((h.x-f.x)*(l.y-f.y)>=(h.y-f.y)*(l.x-f.x))r.pop();else break}r.push(l)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var vde=f9,_9=m9;const xde=vde,bde=K.forwardRef(({className:e,sideOffset:t=4,...r},n)=>M.jsx(_9,{ref:n,sideOffset:t,className:ln("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));bde.displayName=_9.displayName;var VA=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},UA=typeof window>"u"||"Deno"in globalThis;function hc(){}function wde(e,t){return typeof e=="function"?e(t):e}function Sde(e){return typeof e=="number"&&e>=0&&e!==1/0}function Tde(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Qk(e,t){return typeof e=="function"?e(t):e}function Ede(e,t){return typeof e=="function"?e(t):e}function y$(e,t){const{type:r="all",exact:n,fetchStatus:l,predicate:h,queryKey:f,stale:o}=e;if(f){if(n){if(t.queryHash!==jj(f,t.options))return!1}else if(!qb(t.queryKey,f))return!1}if(r!=="all"){const v=t.isActive();if(r==="active"&&!v||r==="inactive"&&v)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||l&&l!==t.state.fetchStatus||h&&!h(t))}function _$(e,t){const{exact:r,status:n,predicate:l,mutationKey:h}=e;if(h){if(!t.options.mutationKey)return!1;if(r){if(Wb(t.options.mutationKey)!==Wb(h))return!1}else if(!qb(t.options.mutationKey,h))return!1}return!(n&&t.state.status!==n||l&&!l(t))}function jj(e,t){return(t?.queryKeyHashFn||Wb)(e)}function Wb(e){return JSON.stringify(e,(t,r)=>eR(r)?Object.keys(r).sort().reduce((n,l)=>(n[l]=r[l],n),{}):r)}function qb(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>qb(e[r],t[r])):!1}function v9(e,t){if(e===t)return e;const r=v$(e)&&v$(t);if(r||eR(e)&&eR(t)){const n=r?e:Object.keys(e),l=n.length,h=r?t:Object.keys(t),f=h.length,o=r?[]:{},v=new Set(n);let b=0;for(let E=0;E<f;E++){const P=r?E:h[E];(!r&&v.has(P)||r)&&e[P]===void 0&&t[P]===void 0?(o[P]=void 0,b++):(o[P]=v9(e[P],t[P]),o[P]===e[P]&&e[P]!==void 0&&b++)}return l===f&&b===l?e:o}return t}function v$(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function eR(e){if(!x$(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!x$(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function x$(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ade(e){return new Promise(t=>{setTimeout(t,e)})}function Pde(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?v9(e,t):t}function Cde(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function Ide(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var Nj=Symbol();function x9(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===Nj?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var Qp,Zd,n_,PH,Mde=(PH=class extends VA{constructor(){super();bi(this,Qp);bi(this,Zd);bi(this,n_);Fn(this,n_,t=>{if(!UA&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){qt(this,Zd)||this.setEventListener(qt(this,n_))}onUnsubscribe(){var t;this.hasListeners()||((t=qt(this,Zd))==null||t.call(this),Fn(this,Zd,void 0))}setEventListener(t){var r;Fn(this,n_,t),(r=qt(this,Zd))==null||r.call(this),Fn(this,Zd,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){qt(this,Qp)!==t&&(Fn(this,Qp,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){return typeof qt(this,Qp)=="boolean"?qt(this,Qp):globalThis.document?.visibilityState!=="hidden"}},Qp=new WeakMap,Zd=new WeakMap,n_=new WeakMap,PH),b9=new Mde,i_,Xd,o_,CH,Ode=(CH=class extends VA{constructor(){super();bi(this,i_,!0);bi(this,Xd);bi(this,o_);Fn(this,o_,t=>{if(!UA&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){qt(this,Xd)||this.setEventListener(qt(this,o_))}onUnsubscribe(){var t;this.hasListeners()||((t=qt(this,Xd))==null||t.call(this),Fn(this,Xd,void 0))}setEventListener(t){var r;Fn(this,o_,t),(r=qt(this,Xd))==null||r.call(this),Fn(this,Xd,t(this.setOnline.bind(this)))}setOnline(t){qt(this,i_)!==t&&(Fn(this,i_,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return qt(this,i_)}},i_=new WeakMap,Xd=new WeakMap,o_=new WeakMap,CH),r2=new Ode;function kde(){let e,t;const r=new Promise((l,h)=>{e=l,t=h});r.status="pending",r.catch(()=>{});function n(l){Object.assign(r,l),delete r.resolve,delete r.reject}return r.resolve=l=>{n({status:"fulfilled",value:l}),e(l)},r.reject=l=>{n({status:"rejected",reason:l}),t(l)},r}function Rde(e){return Math.min(1e3*2**e,3e4)}function w9(e){return(e??"online")==="online"?r2.isOnline():!0}var S9=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function T9(e){let t=!1,r=0,n;const l=kde(),h=()=>l.status!=="pending",f=z=>{h()||(O(new S9(z)),e.abort?.())},o=()=>{t=!0},v=()=>{t=!1},b=()=>b9.isFocused()&&(e.networkMode==="always"||r2.isOnline())&&e.canRun(),E=()=>w9(e.networkMode)&&e.canRun(),P=z=>{h()||(n?.(),l.resolve(z))},O=z=>{h()||(n?.(),l.reject(z))},L=()=>new Promise(z=>{n=$=>{(h()||b())&&z($)},e.onPause?.()}).then(()=>{n=void 0,h()||e.onContinue?.()}),B=()=>{if(h())return;let z;const $=r===0?e.initialPromise:void 0;try{z=$??e.fn()}catch(U){z=Promise.reject(U)}Promise.resolve(z).then(P).catch(U=>{if(h())return;const G=e.retry??(UA?0:3),Z=e.retryDelay??Rde,ne=typeof Z=="function"?Z(r,U):Z,Y=G===!0||typeof G=="number"&&r<G||typeof G=="function"&&G(r,U);if(t||!Y){O(U);return}r++,e.onFail?.(r,U),Ade(ne).then(()=>b()?void 0:L()).then(()=>{t?O(U):B()})})};return{promise:l,status:()=>l.status,cancel:f,continue:()=>(n?.(),l),cancelRetry:o,continueRetry:v,canStart:E,start:()=>(E()?B():L().then(B),l)}}var Dde=e=>setTimeout(e,0);function Lde(){let e=[],t=0,r=o=>{o()},n=o=>{o()},l=Dde;const h=o=>{t?e.push(o):l(()=>{r(o)})},f=()=>{const o=e;e=[],o.length&&l(()=>{n(()=>{o.forEach(v=>{r(v)})})})};return{batch:o=>{let v;t++;try{v=o()}finally{t--,t||f()}return v},batchCalls:o=>(...v)=>{h(()=>{o(...v)})},schedule:h,setNotifyFunction:o=>{r=o},setBatchNotifyFunction:o=>{n=o},setScheduler:o=>{l=o}}}var ma=Lde(),em,IH,E9=(IH=class{constructor(){bi(this,em)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Sde(this.gcTime)&&Fn(this,em,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(UA?1/0:5*60*1e3))}clearGcTimeout(){qt(this,em)&&(clearTimeout(qt(this,em)),Fn(this,em,void 0))}},em=new WeakMap,IH),s_,a_,Il,tm,ys,jw,rm,dc,nh,MH,jde=(MH=class extends E9{constructor(t){super();bi(this,dc);bi(this,s_);bi(this,a_);bi(this,Il);bi(this,tm);bi(this,ys);bi(this,jw);bi(this,rm);Fn(this,rm,!1),Fn(this,jw,t.defaultOptions),this.setOptions(t.options),this.observers=[],Fn(this,tm,t.client),Fn(this,Il,qt(this,tm).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Fn(this,s_,zde(this.options)),this.state=t.state??qt(this,s_),this.scheduleGc()}get meta(){return this.options.meta}get promise(){return qt(this,ys)?.promise}setOptions(t){this.options={...qt(this,jw),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&qt(this,Il).remove(this)}setData(t,r){const n=Pde(this.state.data,t,this.options);return Gs(this,dc,nh).call(this,{data:n,type:"success",dataUpdatedAt:r?.updatedAt,manual:r?.manual}),n}setState(t,r){Gs(this,dc,nh).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){const r=qt(this,ys)?.promise;return qt(this,ys)?.cancel(t),r?r.then(hc).catch(hc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(qt(this,s_))}isActive(){return this.observers.some(t=>Ede(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Nj||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Qk(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Tde(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(r=>r.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),qt(this,ys)?.continue()}onOnline(){this.observers.find(r=>r.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),qt(this,ys)?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),qt(this,Il).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(qt(this,ys)&&(qt(this,rm)?qt(this,ys).cancel({revert:!0}):qt(this,ys).cancelRetry()),this.scheduleGc()),qt(this,Il).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Gs(this,dc,nh).call(this,{type:"invalidate"})}async fetch(t,r){if(this.state.fetchStatus!=="idle"&&qt(this,ys)?.status()!=="rejected"){if(this.state.data!==void 0&&r?.cancelRefetch)this.cancel({silent:!0});else if(qt(this,ys))return qt(this,ys).continueRetry(),qt(this,ys).promise}if(t&&this.setOptions(t),!this.options.queryFn){const v=this.observers.find(b=>b.options.queryFn);v&&this.setOptions(v.options)}const n=new AbortController,l=v=>{Object.defineProperty(v,"signal",{enumerable:!0,get:()=>(Fn(this,rm,!0),n.signal)})},h=()=>{const v=x9(this.options,r),E=(()=>{const P={client:qt(this,tm),queryKey:this.queryKey,meta:this.meta};return l(P),P})();return Fn(this,rm,!1),this.options.persister?this.options.persister(v,E,this):v(E)},o=(()=>{const v={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:qt(this,tm),state:this.state,fetchFn:h};return l(v),v})();this.options.behavior?.onFetch(o,this),Fn(this,a_,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==o.fetchOptions?.meta)&&Gs(this,dc,nh).call(this,{type:"fetch",meta:o.fetchOptions?.meta}),Fn(this,ys,T9({initialPromise:r?.initialPromise,fn:o.fetchFn,abort:n.abort.bind(n),onFail:(v,b)=>{Gs(this,dc,nh).call(this,{type:"failed",failureCount:v,error:b})},onPause:()=>{Gs(this,dc,nh).call(this,{type:"pause"})},onContinue:()=>{Gs(this,dc,nh).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0}));try{const v=await qt(this,ys).start();if(v===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(v),qt(this,Il).config.onSuccess?.(v,this),qt(this,Il).config.onSettled?.(v,this.state.error,this),v}catch(v){if(v instanceof S9){if(v.silent)return qt(this,ys).promise;if(v.revert){if(this.setState({...qt(this,a_),fetchStatus:"idle"}),this.state.data===void 0)throw v;return this.state.data}}throw Gs(this,dc,nh).call(this,{type:"error",error:v}),qt(this,Il).config.onError?.(v,this),qt(this,Il).config.onSettled?.(this.state.data,v,this),v}finally{this.scheduleGc()}}},s_=new WeakMap,a_=new WeakMap,Il=new WeakMap,tm=new WeakMap,ys=new WeakMap,jw=new WeakMap,rm=new WeakMap,dc=new WeakSet,nh=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...Nde(n.data,this.options),fetchMeta:t.meta??null};case"success":const l={...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Fn(this,a_,t.manual?l:void 0),l;case"error":const h=t.error;return{...n,error:h,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:h,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),ma.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),qt(this,Il).notify({query:this,type:"updated",action:t})})},MH);function Nde(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:w9(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function zde(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var lu,OH,Fde=(OH=class extends VA{constructor(t={}){super();bi(this,lu);this.config=t,Fn(this,lu,new Map)}build(t,r,n){const l=r.queryKey,h=r.queryHash??jj(l,r);let f=this.get(h);return f||(f=new jde({client:t,queryKey:l,queryHash:h,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(l)}),this.add(f)),f}add(t){qt(this,lu).has(t.queryHash)||(qt(this,lu).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=qt(this,lu).get(t.queryHash);r&&(t.destroy(),r===t&&qt(this,lu).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){ma.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return qt(this,lu).get(t)}getAll(){return[...qt(this,lu).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>y$(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>y$(t,n)):r}notify(t){ma.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){ma.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){ma.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},lu=new WeakMap,OH),cu,fa,nm,uu,Ld,kH,Bde=(kH=class extends E9{constructor(t){super();bi(this,uu);bi(this,cu);bi(this,fa);bi(this,nm);this.mutationId=t.mutationId,Fn(this,fa,t.mutationCache),Fn(this,cu,[]),this.state=t.state||$de(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){qt(this,cu).includes(t)||(qt(this,cu).push(t),this.clearGcTimeout(),qt(this,fa).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Fn(this,cu,qt(this,cu).filter(r=>r!==t)),this.scheduleGc(),qt(this,fa).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){qt(this,cu).length||(this.state.status==="pending"?this.scheduleGc():qt(this,fa).remove(this))}continue(){return qt(this,nm)?.continue()??this.execute(this.state.variables)}async execute(t){const r=()=>{Gs(this,uu,Ld).call(this,{type:"continue"})};Fn(this,nm,T9({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(h,f)=>{Gs(this,uu,Ld).call(this,{type:"failed",failureCount:h,error:f})},onPause:()=>{Gs(this,uu,Ld).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>qt(this,fa).canRun(this)}));const n=this.state.status==="pending",l=!qt(this,nm).canStart();try{if(n)r();else{Gs(this,uu,Ld).call(this,{type:"pending",variables:t,isPaused:l}),await qt(this,fa).config.onMutate?.(t,this);const f=await this.options.onMutate?.(t);f!==this.state.context&&Gs(this,uu,Ld).call(this,{type:"pending",context:f,variables:t,isPaused:l})}const h=await qt(this,nm).start();return await qt(this,fa).config.onSuccess?.(h,t,this.state.context,this),await this.options.onSuccess?.(h,t,this.state.context),await qt(this,fa).config.onSettled?.(h,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(h,null,t,this.state.context),Gs(this,uu,Ld).call(this,{type:"success",data:h}),h}catch(h){try{throw await qt(this,fa).config.onError?.(h,t,this.state.context,this),await this.options.onError?.(h,t,this.state.context),await qt(this,fa).config.onSettled?.(void 0,h,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,h,t,this.state.context),h}finally{Gs(this,uu,Ld).call(this,{type:"error",error:h})}}finally{qt(this,fa).runNext(this)}}},cu=new WeakMap,fa=new WeakMap,nm=new WeakMap,uu=new WeakSet,Ld=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),ma.batch(()=>{qt(this,cu).forEach(n=>{n.onMutationUpdate(t)}),qt(this,fa).notify({mutation:this,type:"updated",action:t})})},kH);function $de(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var uh,fc,Nw,RH,Vde=(RH=class extends VA{constructor(t={}){super();bi(this,uh);bi(this,fc);bi(this,Nw);this.config=t,Fn(this,uh,new Set),Fn(this,fc,new Map),Fn(this,Nw,0)}build(t,r,n){const l=new Bde({mutationCache:this,mutationId:++lT(this,Nw)._,options:t.defaultMutationOptions(r),state:n});return this.add(l),l}add(t){qt(this,uh).add(t);const r=MT(t);if(typeof r=="string"){const n=qt(this,fc).get(r);n?n.push(t):qt(this,fc).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(qt(this,uh).delete(t)){const r=MT(t);if(typeof r=="string"){const n=qt(this,fc).get(r);if(n)if(n.length>1){const l=n.indexOf(t);l!==-1&&n.splice(l,1)}else n[0]===t&&qt(this,fc).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=MT(t);if(typeof r=="string"){const l=qt(this,fc).get(r)?.find(h=>h.state.status==="pending");return!l||l===t}else return!0}runNext(t){const r=MT(t);return typeof r=="string"?qt(this,fc).get(r)?.find(l=>l!==t&&l.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ma.batch(()=>{qt(this,uh).forEach(t=>{this.notify({type:"removed",mutation:t})}),qt(this,uh).clear(),qt(this,fc).clear()})}getAll(){return Array.from(qt(this,uh))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>_$(r,n))}findAll(t={}){return this.getAll().filter(r=>_$(t,r))}notify(t){ma.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return ma.batch(()=>Promise.all(t.map(r=>r.continue().catch(hc))))}},uh=new WeakMap,fc=new WeakMap,Nw=new WeakMap,RH);function MT(e){return e.options.scope?.id}function b$(e){return{onFetch:(t,r)=>{const n=t.options,l=t.fetchOptions?.meta?.fetchMore?.direction,h=t.state.data?.pages||[],f=t.state.data?.pageParams||[];let o={pages:[],pageParams:[]},v=0;const b=async()=>{let E=!1;const P=B=>{Object.defineProperty(B,"signal",{enumerable:!0,get:()=>(t.signal.aborted?E=!0:t.signal.addEventListener("abort",()=>{E=!0}),t.signal)})},O=x9(t.options,t.fetchOptions),L=async(B,z,$)=>{if(E)return Promise.reject();if(z==null&&B.pages.length)return Promise.resolve(B);const G=(()=>{const ee={client:t.client,queryKey:t.queryKey,pageParam:z,direction:$?"backward":"forward",meta:t.options.meta};return P(ee),ee})(),Z=await O(G),{maxPages:ne}=t.options,Y=$?Ide:Cde;return{pages:Y(B.pages,Z,ne),pageParams:Y(B.pageParams,z,ne)}};if(l&&h.length){const B=l==="backward",z=B?Ude:w$,$={pages:h,pageParams:f},U=z(n,$);o=await L($,U,B)}else{const B=e??h.length;do{const z=v===0?f[0]??n.initialPageParam:w$(n,o);if(v>0&&z==null)break;o=await L(o,z),v++}while(v<B)}return o};t.options.persister?t.fetchFn=()=>t.options.persister?.(b,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r):t.fetchFn=b}}}function w$(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function Ude(e,{pages:t,pageParams:r}){return t.length>0?e.getPreviousPageParam?.(t[0],t,r[0],r):void 0}var Ao,Kd,Yd,l_,c_,Jd,u_,h_,DH,Gde=(DH=class{constructor(e={}){bi(this,Ao);bi(this,Kd);bi(this,Yd);bi(this,l_);bi(this,c_);bi(this,Jd);bi(this,u_);bi(this,h_);Fn(this,Ao,e.queryCache||new Fde),Fn(this,Kd,e.mutationCache||new Vde),Fn(this,Yd,e.defaultOptions||{}),Fn(this,l_,new Map),Fn(this,c_,new Map),Fn(this,Jd,0)}mount(){lT(this,Jd)._++,qt(this,Jd)===1&&(Fn(this,u_,b9.subscribe(async e=>{e&&(await this.resumePausedMutations(),qt(this,Ao).onFocus())})),Fn(this,h_,r2.subscribe(async e=>{e&&(await this.resumePausedMutations(),qt(this,Ao).onOnline())})))}unmount(){var e,t;lT(this,Jd)._--,qt(this,Jd)===0&&((e=qt(this,u_))==null||e.call(this),Fn(this,u_,void 0),(t=qt(this,h_))==null||t.call(this),Fn(this,h_,void 0))}isFetching(e){return qt(this,Ao).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return qt(this,Kd).findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return qt(this,Ao).get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=qt(this,Ao).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(Qk(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return qt(this,Ao).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),h=qt(this,Ao).get(n.queryHash)?.state.data,f=wde(t,h);if(f!==void 0)return qt(this,Ao).build(this,n).setData(f,{...r,manual:!0})}setQueriesData(e,t,r){return ma.batch(()=>qt(this,Ao).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return qt(this,Ao).get(t.queryHash)?.state}removeQueries(e){const t=qt(this,Ao);ma.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=qt(this,Ao);return ma.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=ma.batch(()=>qt(this,Ao).findAll(e).map(l=>l.cancel(r)));return Promise.all(n).then(hc).catch(hc)}invalidateQueries(e,t={}){return ma.batch(()=>(qt(this,Ao).findAll(e).forEach(r=>{r.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=ma.batch(()=>qt(this,Ao).findAll(e).filter(l=>!l.isDisabled()&&!l.isStatic()).map(l=>{let h=l.fetch(void 0,r);return r.throwOnError||(h=h.catch(hc)),l.state.fetchStatus==="paused"?Promise.resolve():h}));return Promise.all(n).then(hc)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=qt(this,Ao).build(this,t);return r.isStaleByTime(Qk(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(hc).catch(hc)}fetchInfiniteQuery(e){return e.behavior=b$(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(hc).catch(hc)}ensureInfiniteQueryData(e){return e.behavior=b$(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return r2.isOnline()?qt(this,Kd).resumePausedMutations():Promise.resolve()}getQueryCache(){return qt(this,Ao)}getMutationCache(){return qt(this,Kd)}getDefaultOptions(){return qt(this,Yd)}setDefaultOptions(e){Fn(this,Yd,e)}setQueryDefaults(e,t){qt(this,l_).set(Wb(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...qt(this,l_).values()],r={};return t.forEach(n=>{qb(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){qt(this,c_).set(Wb(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...qt(this,c_).values()],r={};return t.forEach(n=>{qb(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...qt(this,Yd).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=jj(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Nj&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...qt(this,Yd).mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){qt(this,Ao).clear(),qt(this,Kd).clear()}},Ao=new WeakMap,Kd=new WeakMap,Yd=new WeakMap,l_=new WeakMap,c_=new WeakMap,Jd=new WeakMap,u_=new WeakMap,h_=new WeakMap,DH),Hde=K.createContext(void 0),Wde=({client:e,children:t})=>(K.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),M.jsx(Hde.Provider,{value:e,children:t}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function n2(){return n2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n2.apply(this,arguments)}var tf;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(tf||(tf={}));const S$="popstate";function qde(e){e===void 0&&(e={});function t(n,l){let{pathname:h,search:f,hash:o}=n.location;return tR("",{pathname:h,search:f,hash:o},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function r(n,l){return typeof l=="string"?l:P9(l)}return Xde(t,r,null,e)}function Wa(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function A9(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Zde(){return Math.random().toString(36).substr(2,8)}function T$(e,t){return{usr:e.state,key:e.key,idx:t}}function tR(e,t,r,n){return r===void 0&&(r=null),n2({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?GA(t):t,{state:r,key:t&&t.key||n||Zde()})}function P9(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function GA(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Xde(e,t,r,n){n===void 0&&(n={});let{window:l=document.defaultView,v5Compat:h=!1}=n,f=l.history,o=tf.Pop,v=null,b=E();b==null&&(b=0,f.replaceState(n2({},f.state,{idx:b}),""));function E(){return(f.state||{idx:null}).idx}function P(){o=tf.Pop;let $=E(),U=$==null?null:$-b;b=$,v&&v({action:o,location:z.location,delta:U})}function O($,U){o=tf.Push;let G=tR(z.location,$,U);b=E()+1;let Z=T$(G,b),ne=z.createHref(G);try{f.pushState(Z,"",ne)}catch(Y){if(Y instanceof DOMException&&Y.name==="DataCloneError")throw Y;l.location.assign(ne)}h&&v&&v({action:o,location:z.location,delta:1})}function L($,U){o=tf.Replace;let G=tR(z.location,$,U);b=E();let Z=T$(G,b),ne=z.createHref(G);f.replaceState(Z,"",ne),h&&v&&v({action:o,location:z.location,delta:0})}function B($){let U=l.location.origin!=="null"?l.location.origin:l.location.href,G=typeof $=="string"?$:P9($);return G=G.replace(/ $/,"%20"),Wa(U,"No window.location.(origin|href) available to create URL for href: "+G),new URL(G,U)}let z={get action(){return o},get location(){return e(l,f)},listen($){if(v)throw new Error("A history only accepts one active listener");return l.addEventListener(S$,P),v=$,()=>{l.removeEventListener(S$,P),v=null}},createHref($){return t(l,$)},createURL:B,encodeLocation($){let U=B($);return{pathname:U.pathname,search:U.search,hash:U.hash}},push:O,replace:L,go($){return f.go($)}};return z}var E$;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(E$||(E$={}));function Kde(e,t,r){return r===void 0&&(r="/"),Yde(e,t,r)}function Yde(e,t,r,n){let l=typeof t=="string"?GA(t):t,h=M9(l.pathname||"/",r);if(h==null)return null;let f=C9(e);Jde(f);let o=null;for(let v=0;o==null&&v<f.length;++v){let b=ufe(h);o=afe(f[v],b)}return o}function C9(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let l=(h,f,o)=>{let v={relativePath:o===void 0?h.path||"":o,caseSensitive:h.caseSensitive===!0,childrenIndex:f,route:h};v.relativePath.startsWith("/")&&(Wa(v.relativePath.startsWith(n),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(n.length));let b=Zy([n,v.relativePath]),E=r.concat(v);h.children&&h.children.length>0&&(Wa(h.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+b+'".')),C9(h.children,t,E,b)),!(h.path==null&&!h.index)&&t.push({path:b,score:ofe(b,h.index),routesMeta:E})};return e.forEach((h,f)=>{var o;if(h.path===""||!((o=h.path)!=null&&o.includes("?")))l(h,f);else for(let v of I9(h.path))l(h,f,v)}),t}function I9(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,l=r.endsWith("?"),h=r.replace(/\?$/,"");if(n.length===0)return l?[h,""]:[h];let f=I9(n.join("/")),o=[];return o.push(...f.map(v=>v===""?h:[h,v].join("/"))),l&&o.push(...f),o.map(v=>e.startsWith("/")&&v===""?"/":v)}function Jde(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:sfe(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Qde=/^:[\w-]+$/,efe=3,tfe=2,rfe=1,nfe=10,ife=-2,A$=e=>e==="*";function ofe(e,t){let r=e.split("/"),n=r.length;return r.some(A$)&&(n+=ife),t&&(n+=tfe),r.filter(l=>!A$(l)).reduce((l,h)=>l+(Qde.test(h)?efe:h===""?rfe:nfe),n)}function sfe(e,t){return e.length===t.length&&e.slice(0,-1).every((n,l)=>n===t[l])?e[e.length-1]-t[t.length-1]:0}function afe(e,t,r){let{routesMeta:n}=e,l={},h="/",f=[];for(let o=0;o<n.length;++o){let v=n[o],b=o===n.length-1,E=h==="/"?t:t.slice(h.length)||"/",P=lfe({path:v.relativePath,caseSensitive:v.caseSensitive,end:b},E),O=v.route;if(!P)return null;Object.assign(l,P.params),f.push({params:l,pathname:Zy([h,P.pathname]),pathnameBase:hfe(Zy([h,P.pathnameBase])),route:O}),P.pathnameBase!=="/"&&(h=Zy([h,P.pathnameBase]))}return f}function lfe(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=cfe(e.path,e.caseSensitive,e.end),l=t.match(r);if(!l)return null;let h=l[0],f=h.replace(/(.)\/+$/,"$1"),o=l.slice(1);return{params:n.reduce((b,E,P)=>{let{paramName:O,isOptional:L}=E;if(O==="*"){let z=o[P]||"";f=h.slice(0,h.length-z.length).replace(/(.)\/+$/,"$1")}const B=o[P];return L&&!B?b[O]=void 0:b[O]=(B||"").replace(/%2F/g,"/"),b},{}),pathname:h,pathnameBase:f,pattern:e}}function cfe(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),A9(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],l="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,o,v)=>(n.push({paramName:o,isOptional:v!=null}),v?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),l+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?l+="\\/*$":e!==""&&e!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,t?void 0:"i"),n]}function ufe(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return A9(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function M9(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}const Zy=e=>e.join("/").replace(/\/\/+/g,"/"),hfe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/");function dfe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const O9=["post","put","patch","delete"];new Set(O9);const ffe=["get",...O9];new Set(ffe);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function i2(){return i2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i2.apply(this,arguments)}const pfe=K.createContext(null),mfe=K.createContext(null),k9=K.createContext(null),HA=K.createContext(null),WA=K.createContext({outlet:null,matches:[],isDataRoute:!1}),R9=K.createContext(null);function zj(){return K.useContext(HA)!=null}function D9(){return zj()||Wa(!1),K.useContext(HA).location}function gfe(e,t){return yfe(e,t)}function yfe(e,t,r,n){zj()||Wa(!1);let{navigator:l}=K.useContext(k9),{matches:h}=K.useContext(WA),f=h[h.length-1],o=f?f.params:{};f&&f.pathname;let v=f?f.pathnameBase:"/";f&&f.route;let b=D9(),E;if(t){var P;let $=typeof t=="string"?GA(t):t;v==="/"||(P=$.pathname)!=null&&P.startsWith(v)||Wa(!1),E=$}else E=b;let O=E.pathname||"/",L=O;if(v!=="/"){let $=v.replace(/^\//,"").split("/");L="/"+O.replace(/^\//,"").split("/").slice($.length).join("/")}let B=Kde(e,{pathname:L}),z=wfe(B&&B.map($=>Object.assign({},$,{params:Object.assign({},o,$.params),pathname:Zy([v,l.encodeLocation?l.encodeLocation($.pathname).pathname:$.pathname]),pathnameBase:$.pathnameBase==="/"?v:Zy([v,l.encodeLocation?l.encodeLocation($.pathnameBase).pathname:$.pathnameBase])})),h,r,n);return t&&z?K.createElement(HA.Provider,{value:{location:i2({pathname:"/",search:"",hash:"",state:null,key:"default"},E),navigationType:tf.Pop}},z):z}function _fe(){let e=Afe(),t=dfe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,l={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return K.createElement(K.Fragment,null,K.createElement("h2",null,"Unexpected Application Error!"),K.createElement("h3",{style:{fontStyle:"italic"}},t),r?K.createElement("pre",{style:l},r):null,null)}const vfe=K.createElement(_fe,null);class xfe extends K.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?K.createElement(WA.Provider,{value:this.props.routeContext},K.createElement(R9.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function bfe(e){let{routeContext:t,match:r,children:n}=e,l=K.useContext(pfe);return l&&l.static&&l.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=r.route.id),K.createElement(WA.Provider,{value:t},n)}function wfe(e,t,r,n){var l;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var h;if(!r)return null;if(r.errors)e=r.matches;else if((h=n)!=null&&h.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let f=e,o=(l=r)==null?void 0:l.errors;if(o!=null){let E=f.findIndex(P=>P.route.id&&o?.[P.route.id]!==void 0);E>=0||Wa(!1),f=f.slice(0,Math.min(f.length,E+1))}let v=!1,b=-1;if(r&&n&&n.v7_partialHydration)for(let E=0;E<f.length;E++){let P=f[E];if((P.route.HydrateFallback||P.route.hydrateFallbackElement)&&(b=E),P.route.id){let{loaderData:O,errors:L}=r,B=P.route.loader&&O[P.route.id]===void 0&&(!L||L[P.route.id]===void 0);if(P.route.lazy||B){v=!0,b>=0?f=f.slice(0,b+1):f=[f[0]];break}}}return f.reduceRight((E,P,O)=>{let L,B=!1,z=null,$=null;r&&(L=o&&P.route.id?o[P.route.id]:void 0,z=P.route.errorElement||vfe,v&&(b<0&&O===0?(Pfe("route-fallback"),B=!0,$=null):b===O&&(B=!0,$=P.route.hydrateFallbackElement||null)));let U=t.concat(f.slice(0,O+1)),G=()=>{let Z;return L?Z=z:B?Z=$:P.route.Component?Z=K.createElement(P.route.Component,null):P.route.element?Z=P.route.element:Z=E,K.createElement(bfe,{match:P,routeContext:{outlet:E,matches:U,isDataRoute:r!=null},children:Z})};return r&&(P.route.ErrorBoundary||P.route.errorElement||O===0)?K.createElement(xfe,{location:r.location,revalidation:r.revalidation,component:z,error:L,children:G(),routeContext:{outlet:null,matches:U,isDataRoute:!0}}):G()},null)}var L9=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(L9||{});function Sfe(e){let t=K.useContext(mfe);return t||Wa(!1),t}function Tfe(e){let t=K.useContext(WA);return t||Wa(!1),t}function Efe(e){let t=Tfe(),r=t.matches[t.matches.length-1];return r.route.id||Wa(!1),r.route.id}function Afe(){var e;let t=K.useContext(R9),r=Sfe(L9.UseRouteError),n=Efe();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}const P$={};function Pfe(e,t,r){P$[e]||(P$[e]=!0)}function Cfe(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function rR(e){Wa(!1)}function Ife(e){let{basename:t="/",children:r=null,location:n,navigationType:l=tf.Pop,navigator:h,static:f=!1,future:o}=e;zj()&&Wa(!1);let v=t.replace(/^\/*/,"/"),b=K.useMemo(()=>({basename:v,navigator:h,static:f,future:i2({v7_relativeSplatPath:!1},o)}),[v,o,h,f]);typeof n=="string"&&(n=GA(n));let{pathname:E="/",search:P="",hash:O="",state:L=null,key:B="default"}=n,z=K.useMemo(()=>{let $=M9(E,v);return $==null?null:{location:{pathname:$,search:P,hash:O,state:L,key:B},navigationType:l}},[v,E,P,O,L,B,l]);return z==null?null:K.createElement(k9.Provider,{value:b},K.createElement(HA.Provider,{children:r,value:z}))}function Mfe(e){let{children:t,location:r}=e;return gfe(nR(t),r)}new Promise(()=>{});function nR(e,t){t===void 0&&(t=[]);let r=[];return K.Children.forEach(e,(n,l)=>{if(!K.isValidElement(n))return;let h=[...t,l];if(n.type===K.Fragment){r.push.apply(r,nR(n.props.children,h));return}n.type!==rR&&Wa(!1),!n.props.index||!n.props.children||Wa(!1);let f={id:n.props.id||h.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(f.children=nR(n.props.children,h)),r.push(f)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Ofe="6";try{window.__reactRouterVersion=Ofe}catch{}const kfe="startTransition",C$=TL[kfe];function Rfe(e){let{basename:t,children:r,future:n,window:l}=e,h=K.useRef();h.current==null&&(h.current=qde({window:l,v5Compat:!0}));let f=h.current,[o,v]=K.useState({action:f.action,location:f.location}),{v7_startTransition:b}=n||{},E=K.useCallback(P=>{b&&C$?C$(()=>v(P)):v(P)},[v,b]);return K.useLayoutEffect(()=>f.listen(E),[f,E]),K.useEffect(()=>Cfe(n),[n]),K.createElement(Ife,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:f,future:n})}var I$;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(I$||(I$={}));var M$;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(M$||(M$={}));const Dfe="modulepreload",Lfe=function(e){return"/sweden-preschool-spotlight/"+e},O$={},iv=function(t,r,n){let l=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),o=f?.nonce||f?.getAttribute("nonce");l=Promise.allSettled(r.map(v=>{if(v=Lfe(v),v in O$)return;O$[v]=!0;const b=v.endsWith(".css"),E=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${E}`))return;const P=document.createElement("link");if(P.rel=b?"stylesheet":Dfe,b||(P.as="script"),P.crossOrigin="",P.href=v,o&&P.setAttribute("nonce",o),document.head.appendChild(P),b)return new Promise((O,L)=>{P.addEventListener("load",O),P.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${v}`)))})}))}function h(f){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=f,window.dispatchEvent(o),!o.defaultPrevented)throw f}return l.then(f=>{for(const o of f||[])o.status==="rejected"&&h(o.reason);return t().catch(h)})};var j9={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Ls,function(){var r,n,l;function h(o,v){if(!r)r=v;else if(!n)n=v;else{var b="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",E={};r(E),l=v(E),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([b],{type:"text/javascript"})))}}h(["exports"],function(o){var v=1e-6,b=typeof Float32Array<"u"?Float32Array:Array;function E(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=a*y-p*d;return _?(c[0]=y*(_=1/_),c[1]=-d*_,c[2]=-p*_,c[3]=a*_,c):null}function P(){var c=new b(9);return b!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function O(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=i[4],S=i[5],A=i[6],C=i[7],R=i[8];return c[0]=_*R-S*C,c[1]=p*C-d*R,c[2]=d*S-p*_,c[3]=S*A-y*R,c[4]=a*R-p*A,c[5]=p*y-a*S,c[6]=y*C-_*A,c[7]=d*A-a*C,c[8]=a*_-d*y,c}function L(c,i,a){var d=i[0],p=i[1],y=i[2],_=i[3],S=i[4],A=i[5],C=i[6],R=i[7],D=i[8],j=a[0],H=a[1],W=a[2],J=a[3],te=a[4],ae=a[5],de=a[6],he=a[7],me=a[8];return c[0]=j*d+H*_+W*C,c[1]=j*p+H*S+W*R,c[2]=j*y+H*A+W*D,c[3]=J*d+te*_+ae*C,c[4]=J*p+te*S+ae*R,c[5]=J*y+te*A+ae*D,c[6]=de*d+he*_+me*C,c[7]=de*p+he*S+me*R,c[8]=de*y+he*A+me*D,c}function B(){var c=new b(16);return b!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c}function z(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function $(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=i[4],S=i[5],A=i[6],C=i[7],R=i[8],D=i[9],j=i[10],H=i[11],W=i[12],J=i[13],te=i[14],ae=i[15],de=a*S-d*_,he=a*A-p*_,me=a*C-y*_,ke=d*A-p*S,Ee=d*C-y*S,Pe=p*C-y*A,Ne=R*J-D*W,Be=R*te-j*W,ct=R*ae-H*W,Ue=D*te-j*J,dt=D*ae-H*J,Ct=j*ae-H*te,mt=de*Ct-he*dt+me*Ue+ke*ct-Ee*Be+Pe*Ne;return mt?(c[0]=(S*Ct-A*dt+C*Ue)*(mt=1/mt),c[1]=(p*dt-d*Ct-y*Ue)*mt,c[2]=(J*Pe-te*Ee+ae*ke)*mt,c[3]=(j*Ee-D*Pe-H*ke)*mt,c[4]=(A*ct-_*Ct-C*Be)*mt,c[5]=(a*Ct-p*ct+y*Be)*mt,c[6]=(te*me-W*Pe-ae*he)*mt,c[7]=(R*Pe-j*me+H*he)*mt,c[8]=(_*dt-S*ct+C*Ne)*mt,c[9]=(d*ct-a*dt-y*Ne)*mt,c[10]=(W*Ee-J*me+ae*de)*mt,c[11]=(D*me-R*Ee-H*de)*mt,c[12]=(S*Be-_*Ue-A*Ne)*mt,c[13]=(a*Ue-d*Be+p*Ne)*mt,c[14]=(J*he-W*ke-te*de)*mt,c[15]=(R*ke-D*he+j*de)*mt,c):null}function U(c,i,a){var d=i[0],p=i[1],y=i[2],_=i[3],S=i[4],A=i[5],C=i[6],R=i[7],D=i[8],j=i[9],H=i[10],W=i[11],J=i[12],te=i[13],ae=i[14],de=i[15],he=a[0],me=a[1],ke=a[2],Ee=a[3];return c[0]=he*d+me*S+ke*D+Ee*J,c[1]=he*p+me*A+ke*j+Ee*te,c[2]=he*y+me*C+ke*H+Ee*ae,c[3]=he*_+me*R+ke*W+Ee*de,c[4]=(he=a[4])*d+(me=a[5])*S+(ke=a[6])*D+(Ee=a[7])*J,c[5]=he*p+me*A+ke*j+Ee*te,c[6]=he*y+me*C+ke*H+Ee*ae,c[7]=he*_+me*R+ke*W+Ee*de,c[8]=(he=a[8])*d+(me=a[9])*S+(ke=a[10])*D+(Ee=a[11])*J,c[9]=he*p+me*A+ke*j+Ee*te,c[10]=he*y+me*C+ke*H+Ee*ae,c[11]=he*_+me*R+ke*W+Ee*de,c[12]=(he=a[12])*d+(me=a[13])*S+(ke=a[14])*D+(Ee=a[15])*J,c[13]=he*p+me*A+ke*j+Ee*te,c[14]=he*y+me*C+ke*H+Ee*ae,c[15]=he*_+me*R+ke*W+Ee*de,c}function G(c,i,a){var d,p,y,_,S,A,C,R,D,j,H,W,J=a[0],te=a[1],ae=a[2];return i===c?(c[12]=i[0]*J+i[4]*te+i[8]*ae+i[12],c[13]=i[1]*J+i[5]*te+i[9]*ae+i[13],c[14]=i[2]*J+i[6]*te+i[10]*ae+i[14],c[15]=i[3]*J+i[7]*te+i[11]*ae+i[15]):(p=i[1],y=i[2],_=i[3],S=i[4],A=i[5],C=i[6],R=i[7],D=i[8],j=i[9],H=i[10],W=i[11],c[0]=d=i[0],c[1]=p,c[2]=y,c[3]=_,c[4]=S,c[5]=A,c[6]=C,c[7]=R,c[8]=D,c[9]=j,c[10]=H,c[11]=W,c[12]=d*J+S*te+D*ae+i[12],c[13]=p*J+A*te+j*ae+i[13],c[14]=y*J+C*te+H*ae+i[14],c[15]=_*J+R*te+W*ae+i[15]),c}function Z(c,i,a){var d=a[0],p=a[1],y=a[2];return c[0]=i[0]*d,c[1]=i[1]*d,c[2]=i[2]*d,c[3]=i[3]*d,c[4]=i[4]*p,c[5]=i[5]*p,c[6]=i[6]*p,c[7]=i[7]*p,c[8]=i[8]*y,c[9]=i[9]*y,c[10]=i[10]*y,c[11]=i[11]*y,c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15],c}function ne(c,i,a){var d=Math.sin(a),p=Math.cos(a),y=i[4],_=i[5],S=i[6],A=i[7],C=i[8],R=i[9],D=i[10],j=i[11];return i!==c&&(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[4]=y*p+C*d,c[5]=_*p+R*d,c[6]=S*p+D*d,c[7]=A*p+j*d,c[8]=C*p-y*d,c[9]=R*p-_*d,c[10]=D*p-S*d,c[11]=j*p-A*d,c}function Y(c,i,a){var d=Math.sin(a),p=Math.cos(a),y=i[0],_=i[1],S=i[2],A=i[3],C=i[8],R=i[9],D=i[10],j=i[11];return i!==c&&(c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=y*p-C*d,c[1]=_*p-R*d,c[2]=S*p-D*d,c[3]=A*p-j*d,c[8]=y*d+C*p,c[9]=_*d+R*p,c[10]=S*d+D*p,c[11]=A*d+j*p,c}function ee(c,i,a){var d=Math.sin(a),p=Math.cos(a),y=i[0],_=i[1],S=i[2],A=i[3],C=i[4],R=i[5],D=i[6],j=i[7];return i!==c&&(c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=y*p+C*d,c[1]=_*p+R*d,c[2]=S*p+D*d,c[3]=A*p+j*d,c[4]=C*p-y*d,c[5]=R*p-_*d,c[6]=D*p-S*d,c[7]=j*p-A*d,c}function le(c,i){return c[0]=i[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=i[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=i[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function fe(c,i,a){var d,p,y,_=a[0],S=a[1],A=a[2],C=Math.hypot(_,S,A);return C<v?null:(_*=C=1/C,S*=C,A*=C,d=Math.sin(i),p=Math.cos(i),c[0]=_*_*(y=1-p)+p,c[1]=S*_*y+A*d,c[2]=A*_*y-S*d,c[3]=0,c[4]=_*S*y-A*d,c[5]=S*S*y+p,c[6]=A*S*y+_*d,c[7]=0,c[8]=_*A*y+S*d,c[9]=S*A*y-_*d,c[10]=A*A*y+p,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}function Ce(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=a+a,S=d+d,A=p+p,C=a*_,R=d*_,D=d*S,j=p*_,H=p*S,W=p*A,J=y*_,te=y*S,ae=y*A;return c[0]=1-D-W,c[1]=R+ae,c[2]=j-te,c[3]=0,c[4]=R-ae,c[5]=1-C-W,c[6]=H+J,c[7]=0,c[8]=j+te,c[9]=H-J,c[10]=1-C-D,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}Math.hypot||(Math.hypot=function(){for(var c=0,i=arguments.length;i--;)c+=arguments[i]*arguments[i];return Math.sqrt(c)});var Oe=U;function Me(){var c=new b(3);return b!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Ke(c){var i=new b(3);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i}function Ye(c){return Math.hypot(c[0],c[1],c[2])}function Le(c,i,a){var d=new b(3);return d[0]=c,d[1]=i,d[2]=a,d}function Qe(c,i,a,d){return c[0]=i,c[1]=a,c[2]=d,c}function Je(c,i,a){return c[0]=i[0]+a[0],c[1]=i[1]+a[1],c[2]=i[2]+a[2],c}function it(c,i,a){return c[0]=i[0]-a[0],c[1]=i[1]-a[1],c[2]=i[2]-a[2],c}function Ze(c,i,a){return c[0]=i[0]*a[0],c[1]=i[1]*a[1],c[2]=i[2]*a[2],c}function nt(c,i,a){return c[0]=Math.min(i[0],a[0]),c[1]=Math.min(i[1],a[1]),c[2]=Math.min(i[2],a[2]),c}function pt(c,i,a){return c[0]=Math.max(i[0],a[0]),c[1]=Math.max(i[1],a[1]),c[2]=Math.max(i[2],a[2]),c}function _t(c,i,a){return c[0]=i[0]*a,c[1]=i[1]*a,c[2]=i[2]*a,c}function It(c,i,a,d){return c[0]=i[0]+a[0]*d,c[1]=i[1]+a[1]*d,c[2]=i[2]+a[2]*d,c}function sr(c,i){var a=i[0]-c[0],d=i[1]-c[1],p=i[2]-c[2];return a*a+d*d+p*p}function Sr(c){var i=c[0],a=c[1],d=c[2];return i*i+a*a+d*d}function Kr(c,i){return c[0]=-i[0],c[1]=-i[1],c[2]=-i[2],c}function Er(c,i){var a=i[0],d=i[1],p=i[2],y=a*a+d*d+p*p;return y>0&&(y=1/Math.sqrt(y)),c[0]=i[0]*y,c[1]=i[1]*y,c[2]=i[2]*y,c}function Kt(c,i){return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]}function Pr(c,i,a){var d=i[0],p=i[1],y=i[2],_=a[0],S=a[1],A=a[2];return c[0]=p*A-y*S,c[1]=y*_-d*A,c[2]=d*S-p*_,c}function Qt(c,i,a,d){var p=i[0],y=i[1],_=i[2];return c[0]=p+d*(a[0]-p),c[1]=y+d*(a[1]-y),c[2]=_+d*(a[2]-_),c}function nr(c,i,a){var d=i[0],p=i[1],y=i[2],_=a[3]*d+a[7]*p+a[11]*y+a[15];return c[0]=(a[0]*d+a[4]*p+a[8]*y+a[12])/(_=_||1),c[1]=(a[1]*d+a[5]*p+a[9]*y+a[13])/_,c[2]=(a[2]*d+a[6]*p+a[10]*y+a[14])/_,c}function xr(c,i,a){var d=i[0],p=i[1],y=i[2];return c[0]=d*a[0]+p*a[3]+y*a[6],c[1]=d*a[1]+p*a[4]+y*a[7],c[2]=d*a[2]+p*a[5]+y*a[8],c}function Ft(c,i,a){var d=a[0],p=a[1],y=a[2],_=i[0],S=i[1],A=i[2],C=p*A-y*S,R=y*_-d*A,D=d*S-p*_,j=p*D-y*R,H=y*C-d*D,W=d*R-p*C,J=2*a[3];return R*=J,D*=J,H*=2,W*=2,c[0]=_+(C*=J)+(j*=2),c[1]=S+R+H,c[2]=A+D+W,c}function Pn(c){return c[0]=0,c[1]=0,c[2]=0,c}function Hr(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]}var Yr=it,kn=Ze,Si=Ye;function jo(){var c=new b(4);return b!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),c}function No(c,i,a){return c[0]=i[0]*a,c[1]=i[1]*a,c[2]=i[2]*a,c[3]=i[3]*a,c}function ho(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=a*a+d*d+p*p+y*y;return _>0&&(_=1/Math.sqrt(_)),c[0]=a*_,c[1]=d*_,c[2]=p*_,c[3]=y*_,c}function Ci(c,i,a){var d=i[0],p=i[1],y=i[2],_=i[3];return c[0]=a[0]*d+a[4]*p+a[8]*y+a[12]*_,c[1]=a[1]*d+a[5]*p+a[9]*y+a[13]*_,c[2]=a[2]*d+a[6]*p+a[10]*y+a[14]*_,c[3]=a[3]*d+a[7]*p+a[11]*y+a[15]*_,c}function vo(){var c=new b(4);return b!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function fo(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function Ta(c,i,a){a*=.5;var d=i[0],p=i[1],y=i[2],_=i[3],S=Math.sin(a),A=Math.cos(a);return c[0]=d*A+_*S,c[1]=p*A+y*S,c[2]=y*A-p*S,c[3]=_*A-d*S,c}function Za(c,i,a){a*=.5;var d=i[0],p=i[1],y=i[2],_=i[3],S=Math.sin(a),A=Math.cos(a);return c[0]=d*A-y*S,c[1]=p*A+_*S,c[2]=y*A+d*S,c[3]=_*A-p*S,c}Me(),jo();var Ii,xo,Ou,Xa=ho,Ka=(Ii=Me(),xo=Le(1,0,0),Ou=Le(0,1,0),function(c,i,a){var d=Kt(i,a);return d<-.999999?(Pr(Ii,xo,i),Si(Ii)<1e-6&&Pr(Ii,Ou,i),Er(Ii,Ii),function(p,y,_){_*=.5;var S=Math.sin(_);p[0]=S*y[0],p[1]=S*y[1],p[2]=S*y[2],p[3]=Math.cos(_)}(c,Ii,Math.PI),c):d>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(Pr(Ii,i,a),c[0]=Ii[0],c[1]=Ii[1],c[2]=Ii[2],c[3]=1+d,Xa(c,c))});function Mo(){var c=new b(2);return b!=Float32Array&&(c[0]=0,c[1]=0),c}function cs(c,i){var a=new b(2);return a[0]=c,a[1]=i,a}function Ea(c,i,a){return c[0]=i[0]+a[0],c[1]=i[1]+a[1],c}function us(c,i,a){return c[0]=i[0]-a[0],c[1]=i[1]-a[1],c}function Ya(c,i,a){return c[0]=i[0]*a,c[1]=i[1]*a,c}function Ts(c){return Math.hypot(c[0],c[1])}function Mc(c,i){var a=i[0],d=i[1],p=a*a+d*d;return p>0&&(p=1/Math.sqrt(p)),c[0]=i[0]*p,c[1]=i[1]*p,c}function Kn(c,i){return c[0]*i[0]+c[1]*i[1]}vo(),vo(),P();var Oc,kc,Es=us;function Wl(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}Mo();var Aa=function(){if(kc)return Oc;function c(i,a,d,p){this.cx=3*i,this.bx=3*(d-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=d,this.p2y=p}return kc=1,Oc=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,a){if(a===void 0&&(a=1e-6),i<0)return 0;if(i>1)return 1;for(var d=i,p=0;p<8;p++){var y=this.sampleCurveX(d)-i;if(Math.abs(y)<a)return d;var _=this.sampleCurveDerivativeX(d);if(Math.abs(_)<1e-6)break;d-=y/_}var S=0,A=1;for(d=i,p=0;p<20&&(y=this.sampleCurveX(d),!(Math.abs(y-i)<a));p++)i>y?S=d:A=d,d=.5*(A-S)+S;return d},solve:function(i,a){return this.sampleCurveY(this.solveCurveX(i,a))}},Oc}(),Rc=Wl(Aa);function ut(c,i){this.x=c,this.y=i}function Zn(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(!Zn(c[a],i[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const a in c)if(!Zn(c[a],i[a]))return!1;return!0}return c===i}ut.prototype={clone(){return new ut(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,i){return this.clone()._rotateAround(c,i)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){const i=c.x-this.x,a=c.y-this.y;return i*i+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,i){return Math.atan2(this.x*i-this.y*c,this.x*c+this.y*i)},_matMult(c){const i=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=i,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){const c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){const i=Math.cos(c),a=Math.sin(c),d=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=d,this},_rotateAround(c,i){const a=Math.cos(c),d=Math.sin(c),p=i.y+d*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-d*(this.y-i.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ut},ut.convert=function(c){if(c instanceof ut)return c;if(Array.isArray(c))return new ut(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new ut(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};const Mi=Math.PI/180,qo=180/Math.PI;function Br(c){return c*Mi}function Ge(c){return c*qo}const se=[[0,0],[1,0],[1,1],[0,1]];function ce(c){if(c<=0)return 0;if(c>=1)return 1;const i=c*c,a=i*c;return 4*(c<.5?a:3*(c-i)+a-.75)}function ye(c,i,a,d){const p=new Rc(c,i,a,d);return function(y){return p.solve(y)}}const Re=ye(.25,.1,.25,1);function xe(c,i,a){return Math.min(a,Math.max(i,c))}function Fe(c,i,a){return(a=xe((a-c)/(i-c),0,1))*a*(3-2*a)}function rt(c,i,a){const d=a-i,p=((c-i)%d+d)%d+i;return p===i?a:p}function $e(c,i,a){if(!c.length)return a(null,[]);let d=c.length;const p=new Array(c.length);let y=null;c.forEach((_,S)=>{i(_,(A,C)=>{A&&(y=A),p[S]=C,--d==0&&a(y,p)})})}function et(c,...i){for(const a of i)for(const d in a)c[d]=a[d];return c}let Ot=1;function gt(){return Ot++}function ar(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function yr(c,i){c.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function br(c,i,a){const d={};for(const p in c)d[p]=i.call(this,c[p],p,c);return d}function Gr(c,i,a){const d={};for(const p in c)i.call(this,c[p],p,c)&&(d[p]=c[p]);return d}function Nr(c){return Array.isArray(c)?c.map(Nr):typeof c=="object"&&c?br(c,Nr):c}function Wr(c,i){for(let a=0;a<c.length;a++)if(i.indexOf(c[a])>=0)return!0;return!1}const Vn={};function qr(c){Vn[c]||(typeof console<"u"&&console.warn(c),Vn[c]=!0)}function Ti(c,i,a){return(a.y-c.y)*(i.x-c.x)>(i.y-c.y)*(a.x-c.x)}function eo(c){let i=0;for(let a,d,p=0,y=c.length,_=y-1;p<y;_=p++)a=c[p],d=c[_],i+=(d.x-a.x)*(a.y+d.y);return i}function Ui([c,i,a]){const d=Br(i+90),p=Br(a);return{x:c*Math.cos(d)*Math.sin(p),y:c*Math.sin(d)*Math.sin(p),z:c*Math.cos(p),azimuthal:i,polar:a}}function jn(c){return(typeof self<"u"||c!==void 0)&&typeof WorkerGlobalScope<"u"&&(c!==void 0?c:self)instanceof WorkerGlobalScope}function mn(c){const i={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,d,p,y)=>{const _=p||y;return i[d]=!_||_.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let vi=null;function fi(c,i){return[c[4*i],c[4*i+1],c[4*i+2],c[4*i+3]]}function li(c,i,a,d){for(;i<a;){const p=i+a>>1;c[p]<d?i=p+1:a=p}return i}function bo(c,i,a,d){for(;i<a;){const p=i+a>>1;c[p]<=d?i=p+1:a=p}return i}function As(c){return c>0?1/(1.001-c):1+c}function Zo(c){return c>0?1-1/(1.001-c):-c}function Of(c,i,a){return(c-i.min)*(a.max-a.min)/(i.max-i.min)+a.min}const Oo={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Oo.API_URL)return null;try{const c=new URL(Oo.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Dc(c){return Oo.API_URL_REGEX.test(c)}function zm(c){return Oo.API_SPRITE_REGEX.test(c)}let kf,Rf,Fm,Bm,ku,Df;function $m(){return kf==null&&(kf=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),kf}const Ja={now:()=>Bm!==void 0?Bm:performance.now(),setNow(c){Bm=c},restoreNow(){Bm=void 0},frame(c){const i=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(c,i=0){const{width:a,height:d}=c;ku||(ku=document.createElement("canvas"));const p=ku.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(a>ku.width||d>ku.height)&&(ku.width=a,ku.height=d),p.clearRect(-i,-i,a+2*i,d+2*i),p.drawImage(c,0,0,a,d),p.getImageData(-i,-i,a+2*i,d+2*i)},resolveURL:c=>(Rf||(Rf=document.createElement("a")),Rf.href=c,Rf.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Fm==null&&(Fm=window.matchMedia("(prefers-reduced-motion: reduce)")),Fm.matches)},hasCanvasFingerprintNoise(){if(Df!==void 0)return Df;if(!$m())return Df=!1,!1;const c=new OffscreenCanvas(85,1),i=c.getContext("2d",{willReadFrequently:!0});let a=0;for(let p=0;p<c.width;++p)i.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,i.fillRect(p,0,1,1);const d=i.getImageData(0,0,c.width,c.height);a=0;for(let p=0;p<d.data.length;++p)if(p%4!=3&&a++!==d.data[p])return Df=!0,!0;return Df=!1,!1}};function Qs(c,i){const a=c.indexOf("?");if(a<0)return`${c}?${new URLSearchParams(i).toString()}`;const d=new URLSearchParams(c.slice(a));for(const p in i)d.set(p,i[p]);return`${c.slice(0,a)}?${d.toString()}`}function Pa(c,i={persistentParams:[]}){const a=c.indexOf("?");if(a<0)return c;const d=new URLSearchParams,p=new URLSearchParams(c.slice(a));for(const _ of i.persistentParams){const S=p.get(_);S&&d.set(_,S)}const y=d.toString();return`${c.slice(0,a)}${y.length>0?`?${y}`:""}`}const ql="mapbox-tiles";let Qa=500,Zl=50;const Lf=["language","worldview","jobid"];let gl,jf;function Ru(){try{return caches}catch{}}function Fh(){const c=Ru();c&&gl==null&&(gl=c.open(ql))}let Tv=1/0;const Ev={supported:!1,testSupport:function(c){!Nf&&Du&&(Bh?u1(c):Ps=c)}};let Ps,Du,Nf=!1,Bh=!1;const c1=typeof self<"u"?self:{};function u1(c){const i=c.createTexture();c.bindTexture(c.TEXTURE_2D,i);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Du),c.isContextLost())return;Ev.supported=!0}catch{}c.deleteTexture(i),Nf=!0}c1.document&&(Du=c1.document.createElement("img"),Du.onload=function(){Ps&&u1(Ps),Ps=null,Bh=!0},Du.onerror=function(){Nf=!0,Ps=null},Du.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const zf={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(zf);class nn extends Error{constructor(i,a,d){a===401&&Dc(d)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Vm=jn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,$h=function(c,i){if(!(/^file:/.test(a=c.url)||/^file:/.test(Vm())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,p){const y=new AbortController,_=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Vm(),referrerPolicy:d.referrerPolicy,signal:y.signal});let S=!1,A=!1;const C=(R=_.url).indexOf("sku=")>0&&Dc(R);var R;d.type==="json"&&_.headers.set("Accept","application/json");const D=(H,W,J)=>{if(A)return;if(H&&H.message!=="SecurityError"&&qr(H.toString()),W&&J)return j(W);const te=Date.now();fetch(_).then(ae=>{if(ae.ok){const de=C?ae.clone():null;return j(ae,de,te)}return p(new nn(ae.statusText,ae.status,d.url))}).catch(ae=>{ae.name!=="AbortError"&&p(new Error(`${ae.message} ${d.url}`))})},j=(H,W,J)=>{(d.type==="arrayBuffer"?H.arrayBuffer():d.type==="json"?H.json():H.text()).then(te=>{A||(W&&J&&function(ae,de,he){if(Fh(),gl==null)return;const me=mn(de.headers.get("Cache-Control")||"");if(me["no-store"])return;const ke={status:de.status,statusText:de.statusText,headers:new Headers};de.headers.forEach((Ne,Be)=>ke.headers.set(Be,Ne)),me["max-age"]&&ke.headers.set("Expires",new Date(he+1e3*me["max-age"]).toUTCString());const Ee=ke.headers.get("Expires");if(!Ee||new Date(Ee).getTime()-he<42e4)return;let Pe=Pa(ae.url,{persistentParams:Lf});if(de.status===206){const Ne=ae.headers.get("Range");if(!Ne)return;ke.status=200,Pe=Qs(Pe,{range:Ne})}(function(Ne,Be){if(jf===void 0)try{new Response(new ReadableStream),jf=!0}catch{jf=!1}jf?Be(Ne.body):Ne.blob().then(Be).catch(ct=>qr(ct.message))})(de,Ne=>{const Be=new Response((ct=de.status)!==200&&ct!==404&&[101,103,204,205,304].includes(ct)?null:Ne,ke);var ct;Fh(),gl?.then(Ue=>Ue.put(Pe,Be)).catch(Ue=>qr(Ue.message))})}(_,W,J),S=!0,p(null,te,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(te=>{A||p(new Error(te.message))})};return C?function(H,W){if(Fh(),gl==null)return W(null);gl.then(J=>{let te=Pa(H.url,{persistentParams:Lf});const ae=H.headers.get("Range");ae&&(te=Qs(te,{range:ae})),J.match(te).then(de=>{const he=function(me){if(!me)return!1;const ke=new Date(me.headers.get("Expires")||0),Ee=mn(me.headers.get("Cache-Control")||"");return Number(ke)>Date.now()&&!Ee["no-cache"]}(de);J.delete(te).catch(W),he&&J.put(te,de.clone()).catch(W),W(null,de,he)}).catch(W)}).catch(W)}(_,D):D(null,null),{cancel:()=>{A=!0,S||y.abort()}}}(c,i);if(jn(self)&&self.worker.actor)return self.worker.actor.send("getResource",c,i,void 0,!0)}var a;return function(d,p){const y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const _ in d.headers)y.setRequestHeader(_,d.headers[_]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let _=y.response;if(d.type==="json")try{_=JSON.parse(y.response)}catch(S){return p(S)}p(null,_,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else p(new nn(y.statusText,y.status,d.url))},y.send(d.body),{cancel:()=>y.abort()}}(c,i)},Ff=function(c,i){return $h(et(c,{type:"arrayBuffer"}),i)};function dC(c){const i=document.createElement("a");return i.href=c,i.protocol===location.protocol&&i.host===location.host}const Bf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Lu,Lc;Lu=[],Lc=0;const $f=function(c,i){if(Ev.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Lc>=Oo.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:c,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Lu.push(y),y}Lc++;let a=!1;const d=()=>{if(!a)for(a=!0,Lc--;Lu.length&&Lc<Oo.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Lu.shift(),{requestParameters:_,callback:S,cancelled:A}=y;A||(y.cancel=$f(_,S).cancel)}},p=Ff(c,(y,_,S,A)=>{d(),y?i(y):_&&(self.createImageBitmap?function(C,R){const D=new Blob([new Uint8Array(C)],{type:"image/png"});createImageBitmap(D).then(j=>{R(null,j)}).catch(j=>{R(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(C,R)=>i(C,R,S,A)):function(C,R){const D=new Image;D.onload=()=>{R(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame(()=>{D.src=Bf})},D.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Blob([new Uint8Array(C)],{type:"image/png"});D.src=C.byteLength?URL.createObjectURL(j):Bf}(_,(C,R)=>i(C,R,S,A)))});return{cancel:()=>{p.cancel(),d()}}};var h1,Um,d1,Vh={exports:{}},ju={exports:{}},f1={exports:{}},Vf=function(){if(d1)return Vh.exports;d1=1;var c=(h1||(h1=1,ju.exports=function(a,d){var p,y,_,S,A,C,R,D;for(y=a.length-(p=3&a.length),_=d,A=3432918353,C=461845907,D=0;D<y;)R=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,_=27492+(65535&(S=5*(65535&(_=(_^=R=(65535&(R=(R=(65535&R)*A+(((R>>>16)*A&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(R=0,p){case 3:R^=(255&a.charCodeAt(D+2))<<16;case 2:R^=(255&a.charCodeAt(D+1))<<8;case 1:_^=R=(65535&(R=(R=(65535&(R^=255&a.charCodeAt(D)))*A+(((R>>>16)*A&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295}return _^=a.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),ju.exports),i=(Um||(Um=1,f1.exports=function(a,d){for(var p,y=a.length,_=d^y,S=0;y>=4;)p=1540483477*(65535&(p=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:_^=(255&a.charCodeAt(S+2))<<16;case 2:_^=(255&a.charCodeAt(S+1))<<8;case 1:_=1540483477*(65535&(_^=255&a.charCodeAt(S)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),f1.exports);return Vh.exports=c,Vh.exports.murmur3=c,Vh.exports.murmur2=i,Vh.exports}(),Uh=Wl(Vf);class Xl{constructor(i,...a){et(this,a[0]||{}),this.type=i}}class ea extends Xl{constructor(i,a={}){super("error",et({error:i},a))}}function Av(c,i,a){a[c]&&a[c].indexOf(i)!==-1||(a[c]=a[c]||[],a[c].push(i))}function Pv(c,i,a){if(a&&a[c]){const d=a[c].indexOf(i);d!==-1&&a[c].splice(d,1)}}class Nu{on(i,a){return this._listeners=this._listeners||{},Av(i,a,this._listeners),this}off(i,a){return Pv(i,a,this._listeners),Pv(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Av(i,a,this._oneTimeListeners),this):new Promise(d=>{this.once(i,d)})}fire(i,a){const d=typeof i=="string"?new Xl(i,a):i,p=d.type;if(this.listens(p)){d.target=this;const y=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const A of y)A.call(this,d);const _=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const A of _)Pv(p,A,this._oneTimeListeners),A.call(this,d);const S=this._eventedParent;S&&(et(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(d))}else d instanceof ea&&console.error(d.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}class zs{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new zs(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[a,d]=i.split("");return new zs({name:a,iconsetId:d})}static isEqual(i,a){return i.name===a.name&&i.iconsetId===a.iconsetId}toString(){return zs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Cv,Gm={},Iv=function(){if(Cv)return Gm;Cv=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(y){return(y=Math.round(y))<0?0:y>255?255:y}function a(y){return i(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function d(y){return(_=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:_>1?1:_;var _}function p(y,_,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?y+(_-y)*S*6:2*S<1?_:3*S<2?y+(_-y)*(2/3-S)*6:y}try{Gm.parseCSSColor=function(y){var _,S=y.replace(/ /g,"").toLowerCase();if(S in c)return c[S].slice();if(S[0]==="#")return S.length===4?(_=parseInt(S.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:S.length===7&&(_=parseInt(S.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var A=S.indexOf("("),C=S.indexOf(")");if(A!==-1&&C+1===S.length){var R=S.substr(0,A),D=S.substr(A+1,C-(A+1)).split(","),j=1;switch(R){case"rgba":if(D.length!==4)return null;j=d(D.pop());case"rgb":return D.length!==3?null:[a(D[0]),a(D[1]),a(D[2]),j];case"hsla":if(D.length!==4)return null;j=d(D.pop());case"hsl":if(D.length!==3)return null;var H=(parseFloat(D[0])%360+360)%360/360,W=d(D[1]),J=d(D[2]),te=J<=.5?J*(W+1):J+W-J*W,ae=2*J-te;return[i(255*p(ae,te,H+1/3)),i(255*p(ae,te,H)),i(255*p(ae,te,H-1/3)),j];default:return null}}return null}}catch{}return Gm}();class Sn{constructor(i,a,d,p=1){this.r=i,this.g=a,this.b=d,this.a=p}static parse(i){if(!i)return;if(i instanceof Sn)return i;if(typeof i!="string")return;const a=Iv.parseCSSColor(i);return a?new Sn(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[i,a,d,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*a)},${Math.round(255*d)},${p})`}toNonPremultipliedRenderColor(i){const{r:a,g:d,b:p,a:y}=this;return new Gh(i,a,d,p,y)}toPremultipliedRenderColor(i){const{r:a,g:d,b:p,a:y}=this;return new p1(i,a*y,d*y,p*y,y)}clone(){return new Sn(this.r,this.g,this.b,this.a)}}class Uf{constructor(i,a,d,p,y,_=!1){if(this.premultiplied=!1,this.premultiplied=_,i){const S=i.image.height,A=S*S;this.premultiplied?(a=y===0?0:a/y*(S-1),d=y===0?0:d/y*(S-1),p=y===0?0:p/y*(S-1)):(a*=S-1,d*=S-1,p*=S-1);const C=Math.floor(a),R=Math.floor(d),D=Math.floor(p),j=Math.ceil(a),H=Math.ceil(d),W=Math.ceil(p),J=a-C,te=d-R,ae=p-D,de=i.image.data,he=4*(C+R*A+D*S),me=4*(C+R*A+W*S),ke=4*(C+H*A+D*S),Ee=4*(C+H*A+W*S),Pe=4*(j+R*A+D*S),Ne=4*(j+R*A+W*S),Be=4*(j+H*A+D*S),ct=4*(j+H*A+W*S);if(he<0||ct>=de.length)throw new Error("out of range");this.r=lr(lr(lr(de[he],de[me],ae),lr(de[ke],de[Ee],ae),te),lr(lr(de[Pe],de[Ne],ae),lr(de[Be],de[ct],ae),te),J)/255*(this.premultiplied?y:1),this.g=lr(lr(lr(de[he+1],de[me+1],ae),lr(de[ke+1],de[Ee+1],ae),te),lr(lr(de[Pe+1],de[Ne+1],ae),lr(de[Be+1],de[ct+1],ae),te),J)/255*(this.premultiplied?y:1),this.b=lr(lr(lr(de[he+2],de[me+2],ae),lr(de[ke+2],de[Ee+2],ae),te),lr(lr(de[Pe+2],de[Ne+2],ae),lr(de[Be+2],de[ct+2],ae),te),J)/255*(this.premultiplied?y:1),this.a=y}else this.r=a,this.g=d,this.b=p,this.a=y}toArray(){const{r:i,g:a,b:d,a:p}=this;return[255*i,255*a,255*d,p]}toHslaArray(){let{r:i,g:a,b:d,a:p}=this;if(this.premultiplied){if(p===0)return[0,0,0,0];i/=p,a/=p,d/=p}const y=Math.min(Math.max(i,0),1),_=Math.min(Math.max(a,0),1),S=Math.min(Math.max(d,0),1),A=Math.min(y,_,S),C=Math.max(y,_,S),R=(A+C)/2;if(A===C)return[0,0,100*R,p];const D=C-A,j=R>.5?D/(2-C-A):D/(C+A);let H=0;return C===y?H=(_-S)/D+(_<S?6:0):C===_?H=(S-y)/D+2:C===S&&(H=(y-_)/D+4),H*=60,[Math.min(Math.max(H,0),360),Math.min(Math.max(100*j,0),100),Math.min(Math.max(100*R,0),100),p]}toArray01(){const{r:i,g:a,b:d,a:p}=this;return[i,a,d,p]}toArray01Scaled(i){const{r:a,g:d,b:p}=this;return[a*i,d*i,p*i]}toArray01Linear(){const{r:i,g:a,b:d,a:p}=this;return[Math.pow(i,2.2),Math.pow(a,2.2),Math.pow(d,2.2),p]}}class Gh extends Uf{constructor(i,a,d,p,y){super(i,a,d,p,y,!1)}}class p1 extends Uf{constructor(i,a,d,p,y){super(i,a,d,p,y,!0)}}function lr(c,i,a){return c*(1-a)+i*a}function m1(c,i,a){return c.map((d,p)=>lr(d,i[p],a))}Sn.black=new Sn(0,0,0,1),Sn.white=new Sn(1,1,1,1),Sn.transparent=new Sn(0,0,0,0),Sn.red=new Sn(1,0,0,1),Sn.blue=new Sn(0,0,1,1);var Gf=Object.freeze({__proto__:null,array:m1,color:function(c,i,a){return new Sn(lr(c.r,i.r,a),lr(c.g,i.g,a),lr(c.b,i.b,a),lr(c.a,i.a,a))},number:lr});function zu(c,...i){for(const a of i)for(const d in a)c[d]=a[d];return c}class ta extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class Mv{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[d,p]of a)this.bindings[d]=p}concat(i){return new Mv(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Hh={kind:"null"},ir={kind:"number"},vn={kind:"string"},xn={kind:"boolean"},Fs={kind:"color"},Kl={kind:"object"},Tn={kind:"value"},Hm={kind:"collator"},Hf={kind:"formatted"},Wf={kind:"resolvedImage"};function Xo(c,i){return{kind:"array",itemType:c,N:i}}function Gi(c){if(c.kind==="array"){const i=Gi(c.itemType);return typeof c.N=="number"?`array<${i}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${i}>`}return c.kind}const fC=[Hh,ir,vn,xn,Fs,Hf,Kl,Xo(Tn),Wf];function Wh(c,i){if(i.kind==="error")return null;if(c.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Wh(c.itemType,i.itemType))&&(typeof c.N!="number"||c.N===i.N))return null}else{if(c.kind===i.kind)return null;if(c.kind==="value"){for(const a of fC)if(!Wh(a,i))return null}}return`Expected ${Gi(c)} but found ${Gi(i)} instead.`}function jc(c,i){return i.some(a=>a.kind===c.kind)}function qf(c,i){return i.some(a=>a==="null"?c===null:a==="array"?Array.isArray(c):a==="object"?c&&!Array.isArray(c)&&typeof c=="object":a===typeof c)}function Wm(c,i){return c.kind==="array"&&i.kind==="array"?c.N===i.N&&Wm(c.itemType,i.itemType):c.kind===i.kind}class Zf{constructor(i,a,d){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qm{constructor(i,a,d,p,y){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=d,this.fontStack=p,this.textColor=y}}class hs{constructor(i){this.sections=i}static fromString(i){return new hs([new qm(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof hs?i:hs.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){const p=a.image.getPrimary().id.toString();i.push(["image",p]);continue}i.push(a.text);const d={};a.fontStack&&(d["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(d["font-scale"]=a.scale),a.textColor&&(d["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(d)}return i}}class Yl{constructor(i,a={}){if(this.id=zs.from(i),this.options=Object.assign({},a),a.transform){const{a:d,b:p,c:y,d:_,e:S,f:A}=a.transform;this.options.transform=new DOMMatrix([d,p,y,_,S,A])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:i,b:a,c:d,d:p,e:y,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:i,b:a,c:d,d:p,e:y,f:_}})}static parse(i){let a,d,p,y;try{({name:a,iconsetId:d,params:p,transform:y}=JSON.parse(i)||{})}catch{return null}if(!a)return null;const{a:_,b:S,c:A,d:C,e:R,f:D}=y||{};return new Yl({name:a,iconsetId:d},{params:p,transform:new DOMMatrix([_,S,A,C,R,D])})}scaleSelf(i,a){return this.options.transform.scaleSelf(i,a),this}}class Cs{constructor(i,a,d,p,y=!1){this.primaryId=zs.from(i),this.primaryOptions=a,d&&(this.secondaryId=zs.from(d)),this.secondaryOptions=p,this.available=y}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Yl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Yl(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?Cs.build({name:i}):i}static build(i,a,d,p){return!i||typeof i=="object"&&!("name"in i)?null:new Cs(i,d,a,p)}}function Fu(c,i,a,d){return typeof c=="number"&&c>=0&&c<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[c,i,a,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[c,i,a,d]:[c,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Mr(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Sn||c instanceof Zf||c instanceof hs||c instanceof Cs)return!0;if(Array.isArray(c)){for(const i of c)if(!Mr(i))return!1;return!0}if(typeof c=="object"){for(const i in c)if(!Mr(c[i]))return!1;return!0}return!1}function Ht(c){if(c===null)return Hh;if(typeof c=="string")return vn;if(typeof c=="boolean")return xn;if(typeof c=="number")return ir;if(c instanceof Sn)return Fs;if(c instanceof Zf)return Hm;if(c instanceof hs)return Hf;if(c instanceof Cs)return Wf;if(Array.isArray(c)){const i=c.length;let a;for(const d of c){const p=Ht(d);if(a){if(a===p)continue;a=Tn;break}a=p}return Xo(a||Tn,i)}return Kl}function Ca(c){const i=typeof c;return c===null?"":i==="string"||i==="number"||i==="boolean"?String(c):c instanceof hs||c instanceof Cs||c instanceof Sn?c.toString():JSON.stringify(c)}class mr{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(i.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Mr(i[1]))return a.error("invalid value");const d=i[1];let p=Ht(d);const y=a.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new mr(p,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Sn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof hs?this.value.serialize():this.value}}class Bi{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Xf={string:vn,number:ir,boolean:xn,object:Kl};class ur{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let d,p=1;const y=i[0];if(y==="array"){let S,A;if(i.length>2){const C=i[1];if(typeof C!="string"||!(C in Xf)||C==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);S=Xf[C],p++}else S=Tn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);A=i[2],p++}d=Xo(S,A)}else d=Xf[y];const _=[];for(;p<i.length;p++){const S=a.parse(i[p],p,Tn);if(!S)return null;_.push(S)}return new ur(d,_)}evaluate(i){for(let a=0;a<this.args.length;a++){const d=this.args[a].evaluate(i);if(!Wh(this.type,Ht(d)))return d;if(a===this.args.length-1)throw new Bi(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Gi(Ht(d))} but was expected to be of type ${Gi(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if(i.kind==="array"){const d=i.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){a.push(d.kind);const p=i.N;(typeof p=="number"||this.args.length>1)&&a.push(p)}}return a.concat(this.args.map(d=>d.serialize()))}}class qh{constructor(i){this.type=Hf,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return a.error("First argument must be an image or text section.");const p=[];let y=!1;for(let _=1;_<=i.length-1;++_){const S=i[_];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;let A=null;if(S["font-scale"]&&(A=a.parseObjectValue(S["font-scale"],_,"font-scale",ir),!A))return null;let C=null;if(S["text-font"]&&(C=a.parseObjectValue(S["text-font"],_,"text-font",Xo(vn)),!C))return null;let R=null;if(S["text-color"]&&(R=a.parseObjectValue(S["text-color"],_,"text-color",Fs),!R))return null;const D=p[p.length-1];D.scale=A,D.font=C,D.textColor=R}else{const A=a.parse(i[_],_,Tn);if(!A)return null;const C=A.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:A,scale:null,font:null,textColor:null})}}return new qh(p)}evaluate(i){return new hs(this.sections.map(a=>{const d=a.content.evaluate(i);return Wm(Ht(d),Wf)?new qm("",d,null,null,null):new qm(Ca(d),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const d={};a.scale&&(d["font-scale"]=a.scale.serialize()),a.font&&(d["text-font"]=a.font.serialize()),a.textColor&&(d["text-color"]=a.textColor.serialize()),i.push(d)}return i}}class Zh{constructor(i,a,d,p){this._imageWarnHistory={},this.type=Wf,this.namePrimary=i,this.nameSecondary=a,d&&(this.paramsPrimary=d.params,this.iconsetIdPrimary=d.iconset?d.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(i,a){if(i.length<2)return a.error("Expected two or more arguments.");let d=1;const p=[];function y(){if(d<i.length){const S=a.parse(i[d],d++,vn);return S?(p.push({image:S,options:{}}),!0):(a.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(d<i.length){const A=i[d];if((S=A)===null||typeof S!="object"||Array.isArray(S))return!0;const C=A.params,R=A.iconset,D=a.concat(d);if(!C&&!R)return d++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const j={},H=D.concat(void 0,"params");for(const W in C){if(!W)return H.error("Image parameter name should be non-empty"),!1;const J=H.concat(void 0,W).parse(C[W],void 0,Fs,void 0,{typeAnnotation:"coerce"});if(!J)return!1;j[W]=J}p[p.length-1].options.params=j}if(R){if(typeof R!="object"||R.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!R.id)return D.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=R}return d++,!0}var S;return!0}for(let S=0;S<2;S++)if(!y()||!_())return;return new Zh(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(i,a){const d={};if(a){for(const p in a)if(a[p])try{d[p]=a[p].evaluate(i)}catch{continue}if(Object.keys(d).length!==0)return{params:d}}}evaluate(i){const a={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},d=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,p=Cs.build(a,d,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(p&&i.availableImages){const y=p.getPrimary().id;if(p.available=i.availableImages.some(_=>zs.isEqual(_,y)),p.available){const _=p.getSecondary()?p.getSecondary().id:null;_&&(p.available=i.availableImages.some(S=>zs.isEqual(S,_)))}}return p}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&i(this.paramsPrimary[a]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&i(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(i,a){const d={};if(a&&(d.iconset={id:a}),i){d.params={};for(const p in i)i[p]&&(d.params[p]=i[p].serialize())}return Object.keys(d).length>0?d:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&i.push(a)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&i.push(a)}return i}}function Nc(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const g1={"to-boolean":xn,"to-color":Fs,"to-number":ir,"to-string":vn};class Ia{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const d=i[0],p=[];let y=Hh;if(d==="to-array"){if(!Array.isArray(i[1]))return null;const _=i[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);y=Xo(a.expectedType.itemType,_)}else{if(!(_>0&&Mr(i[1][0])))return null;y=Xo(Ht(i[1][0]),_)}for(let S=0;S<_;S++){const A=i[1][S];let C;if(Nc(A)==="array")C=a.parse(A,void 0,y.itemType);else{const R=Nc(A);if(R!==y.itemType.kind)return a.error(`Expected ${y.itemType.kind} but found ${R}.`);C=a.registry.literal.parse(["literal",A===void 0?null:A],a)}if(!C)return null;p.push(C)}}else{if((d==="to-boolean"||d==="to-string")&&i.length!==2)return a.error("Expected one argument.");y=g1[d];for(let _=1;_<i.length;_++){const S=a.parse(i[_],_,Tn);if(!S)return null;p.push(S)}}return new Ia(y,p)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let a,d;for(const p of this.args){if(a=p.evaluate(i),d=null,a instanceof Sn)return a;if(typeof a=="string"){const y=i.parseColor(a);if(y)return y}else if(Array.isArray(a)&&(d=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Fu(a[0],a[1],a[2],a[3]),!d))return new Sn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Bi(d||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const d of this.args){if(a=d.evaluate(i),a===null)return 0;const p=Number(a);if(!isNaN(p))return p}throw new Bi(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?hs.fromString(Ca(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Cs.build(Ca(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(a=>a.evaluate(i)):Ca(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new qh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Zh(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}const ds=["Unknown","Point","LineString","Polygon"];class Kf{constructor(i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ds[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:d,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*a-i[0])+this.featureDistanceData.bearing[1]*(p*a-i[1])}return 0}parseColor(i){let a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=Sn.parse(i)),a}getConfig(i){return this.options?this.options.get(i):null}}class wo{constructor(i,a,d,p,y){this.name=i,this.type=a,this._evaluate=d,this.args=p,this._overloadIndex=y}evaluate(i){if(!this._evaluate){const a=wo.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const d=i[0],p=wo.definitions[d];if(!p)return a.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,S=[];let A=null,C=-1;for(const[R,D]of _){if(Array.isArray(R)&&R.length!==i.length-1)continue;S.push(R),C++,A=new sg(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const j=[];let H=!1;for(let W=1;W<i.length;W++){const J=i[W],te=Array.isArray(R)?R[W-1]:R.type,ae=A.parse(J,1+j.length,te);if(!ae){H=!0;break}j.push(ae)}if(!H)if(Array.isArray(R)&&R.length!==j.length)A.error(`Expected ${R.length} arguments, but found ${j.length} instead.`);else{for(let W=0;W<j.length;W++){const J=Array.isArray(R)?R[W]:R.type,te=j[W];A.concat(W+1).checkSubtype(J,te.type)}if(A.errors.length===0)return new wo(d,y,D,j,C)}}if(S.length===1)a.errors.push(...A.errors);else{const R=(S.length?S:_.map(([j])=>j)).map(Ov).join(" | "),D=[];for(let j=1;j<i.length;j++){const H=a.parse(i[j],1+D.length);if(!H)return null;D.push(Gi(H.type))}a.error(`Expected arguments of type ${R}, but found (${D.join(", ")}) instead.`)}return null}static register(i,a){wo.definitions=a;for(const d in a)i[d]=wo}}function Ov(c){return Array.isArray(c)?`(${c.map(Gi).join(", ")})`:`(${Gi(c.type)}...)`}class yl{constructor(i,a,d){this.type=Hm,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(i.length!==2)return a.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return a.error("Collator options argument must be an object.");const p=d["case-sensitive"]===void 0?a.parse(!1,1,xn):a.parseObjectValue(d["case-sensitive"],1,"case-sensitive",xn);if(!p)return null;const y=d["diacritic-sensitive"]===void 0?a.parse(!1,1,xn):a.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",xn);if(!y)return null;let _=null;return d.locale&&(_=a.parseObjectValue(d.locale,1,"locale",vn),!_)?null:new yl(p,y,_)}evaluate(i){return new Zf(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function Ko(c,i,a=0,d=c.length-1,p=pC){for(;d>a;){if(d-a>600){const A=d-a+1,C=i-a+1,R=Math.log(A),D=.5*Math.exp(2*R/3),j=.5*Math.sqrt(R*D*(A-D)/A)*(C-A/2<0?-1:1);Ko(c,i,Math.max(a,Math.floor(i-C*D/A+j)),Math.min(d,Math.floor(i+(A-C)*D/A+j)),p)}const y=c[i];let _=a,S=d;for(Yf(c,a,i),p(c[d],y)>0&&Yf(c,a,d);_<S;){for(Yf(c,_,S),_++,S--;p(c[_],y)<0;)_++;for(;p(c[S],y)>0;)S--}p(c[a],y)===0?Yf(c,a,S):(S++,Yf(c,S,d)),S<=i&&(a=S+1),i<=S&&(d=S-1)}}function Yf(c,i,a){const d=c[i];c[i]=c[a],c[a]=d}function pC(c,i){return c<i?-1:c>i?1:0}function mC(c){let i=0;for(let a,d,p=0,y=c.length,_=y-1;p<y;_=p++)a=c[p],d=c[_],i+=(d.x-a.x)*(a.y+d.y);return i}function zc(c,i){c[0]=Math.min(c[0],i[0]),c[1]=Math.min(c[1],i[1]),c[2]=Math.max(c[2],i[0]),c[3]=Math.max(c[3],i[1])}function Xh(c,i){return!(c[0]<=i[0]||c[2]>=i[2]||c[1]<=i[1]||c[3]>=i[3])}function Bu(c,i,a){const d=c[0]-i[0],p=c[1]-i[1],y=c[0]-a[0],_=c[1]-a[1];return d*_-y*p==0&&d*y<=0&&p*_<=0}function Kh(c,i,a=!1){let d=!1;for(let S=0,A=i.length;S<A;S++){const C=i[S];for(let R=0,D=C.length,j=D-1;R<D;j=R++){const H=C[j],W=C[R];if(Bu(c,H,W))return a;(y=H)[1]>(p=c)[1]!=(_=W)[1]>p[1]&&p[0]<(_[0]-y[0])*(p[1]-y[1])/(_[1]-y[1])+y[0]&&(d=!d)}}var p,y,_;return d}function y1(c,i,a,d){const p=d[0]-a[0],y=d[1]-a[1],_=(c[0]-a[0])*y-p*(c[1]-a[1]),S=(i[0]-a[0])*y-p*(i[1]-a[1]);return _>0&&S<0||_<0&&S>0}function Zm(c,i,a,d){return(p=[d[0]-a[0],d[1]-a[1]])[0]*(y=[i[0]-c[0],i[1]-c[1]])[1]-p[1]*y[0]!=0&&!(!y1(c,i,a,d)||!y1(a,d,c,i));var p,y}function kv(c){const i=new ut(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new ut(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const d of c[0])i.x>d.x&&(i.x=d.x),i.y>d.y&&(i.y=d.y),a.x<d.x&&(a.x=d.x),a.y<d.y&&(a.y=d.y);return{min:i,max:a}}const Fc=8192;function gC(c,i){const a=(180+c[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(a*p*Fc),Math.round(d*p*Fc)]}function _1(c,i){for(let a=0;a<i.length;a++)if(Kh(c,i[a]))return!0;return!1}function yC(c,i,a){for(const d of a)for(let p=0,y=d.length,_=y-1;p<y;_=p++)if(Zm(c,i,d[_],d[p]))return!0;return!1}function v1(c,i){for(let a=0;a<c.length;++a)if(!Kh(c[a],i))return!1;for(let a=0;a<c.length-1;++a)if(yC(c[a],c[a+1],i))return!1;return!0}function x1(c,i){for(let a=0;a<i.length;a++)if(v1(c,i[a]))return!0;return!1}function Rv(c,i,a){const d=[];for(let p=0;p<c.length;p++){const y=[];for(let _=0;_<c[p].length;_++){const S=gC(c[p][_],a);zc(i,S),y.push(S)}d.push(y)}return d}function Bc(c,i,a){const d=[];for(let p=0;p<c.length;p++){const y=Rv(c[p],i,a);d.push(y)}return d}function b1(c,i,a,d){if(c[0]<a[0]||c[0]>a[2]){const p=.5*d;let y=c[0]-a[0]>p?-d:a[0]-c[0]>p?d:0;y===0&&(y=c[0]-a[2]>p?-d:a[2]-c[0]>p?d:0),c[0]+=y}zc(i,c)}function w1(c,i,a,d){const p=Math.pow(2,d.z)*Fc,y=[d.x*Fc,d.y*Fc],_=[];if(!c)return _;for(const S of c)for(const A of S){const C=[A.x+y[0],A.y+y[1]];b1(C,i,a,p),_.push(C)}return _}function Xm(c,i,a,d){const p=Math.pow(2,d.z)*Fc,y=[d.x*Fc,d.y*Fc],_=[];if(!c)return _;for(const A of c){const C=[];for(const R of A){const D=[R.x+y[0],R.y+y[1]];zc(i,D),C.push(D)}_.push(C)}if(i[2]-i[0]<=p/2){(S=i)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const A of _)for(const C of A)b1(C,i,a,p)}var S;return _}class $c{constructor(i,a){this.type=xn,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Mr(i[1])){const d=i[1];if(d.type==="FeatureCollection")for(let p=0;p<d.features.length;++p){const y=d.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new $c(d,d.features[p].geometry)}else if(d.type==="Feature"){const p=d.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new $c(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new $c(d,d)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(a,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const S=Rv(d.coordinates,y,_),A=w1(a.geometry(),p,y,_);if(!Xh(p,y))return!1;for(const C of A)if(!Kh(C,S))return!1}if(d.type==="MultiPolygon"){const S=Bc(d.coordinates,y,_),A=w1(a.geometry(),p,y,_);if(!Xh(p,y))return!1;for(const C of A)if(!_1(C,S))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(a,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const S=Rv(d.coordinates,y,_),A=Xm(a.geometry(),p,y,_);if(!Xh(p,y))return!1;for(const C of A)if(!v1(C,S))return!1}if(d.type==="MultiPolygon"){const S=Bc(d.coordinates,y,_),A=Xm(a.geometry(),p,y,_);if(!Xh(p,y))return!1;for(const C of A)if(!x1(C,S))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Jf={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ma=1/298.257223563,Dv=Ma*(2-Ma),Yh=Math.PI/180;class Jh{static fromTile(i,a,d){const p=Math.PI*(1-2*(i+.5)/Math.pow(2,a)),y=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Yh;return new Jh(y,d)}static get units(){return Jf}constructor(i,a){if(i===void 0)throw new Error("No latitude given.");if(a&&!Jf[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Jf).join(", ")}`);const d=6378.137*Yh*(a?Jf[a]:1),p=Math.cos(i*Yh),y=1/(1-Dv*(1-p*p)),_=Math.sqrt(y);this.kx=d*_*p,this.ky=d*_*y*(1-Dv)}distance(i,a){const d=ra(i[0]-a[0])*this.kx,p=(i[1]-a[1])*this.ky;return Math.sqrt(d*d+p*p)}bearing(i,a){const d=ra(a[0]-i[0])*this.kx;return Math.atan2(d,(a[1]-i[1])*this.ky)/Yh}destination(i,a,d){const p=d*Yh;return this.offset(i,Math.sin(p)*a,Math.cos(p)*a)}offset(i,a,d){return[i[0]+a/this.kx,i[1]+d/this.ky]}lineDistance(i){let a=0;for(let d=0;d<i.length-1;d++)a+=this.distance(i[d],i[d+1]);return a}area(i){let a=0;for(let d=0;d<i.length;d++){const p=i[d];for(let y=0,_=p.length,S=_-1;y<_;S=y++)a+=ra(p[y][0]-p[S][0])*(p[y][1]+p[S][1])*(d?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(i,a){let d=0;if(a<=0)return i[0];for(let p=0;p<i.length-1;p++){const y=i[p],_=i[p+1],S=this.distance(y,_);if(d+=S,d>a)return Km(y,_,(a-(d-S))/S)}return i[i.length-1]}pointToSegmentDistance(i,a,d){let[p,y]=a,_=ra(d[0]-p)*this.kx,S=(d[1]-y)*this.ky;if(_!==0||S!==0){const A=(ra(i[0]-p)*this.kx*_+(i[1]-y)*this.ky*S)/(_*_+S*S);A>1?(p=d[0],y=d[1]):A>0&&(p+=_/this.kx*A,y+=S/this.ky*A)}return _=ra(i[0]-p)*this.kx,S=(i[1]-y)*this.ky,Math.sqrt(_*_+S*S)}pointOnLine(i,a){let d=1/0,p=i[0][0],y=i[0][1],_=0,S=0;for(let A=0;A<i.length-1;A++){let C=i[A][0],R=i[A][1],D=ra(i[A+1][0]-C)*this.kx,j=(i[A+1][1]-R)*this.ky,H=0;D===0&&j===0||(H=(ra(a[0]-C)*this.kx*D+(a[1]-R)*this.ky*j)/(D*D+j*j),H>1?(C=i[A+1][0],R=i[A+1][1]):H>0&&(C+=D/this.kx*H,R+=j/this.ky*H)),D=ra(a[0]-C)*this.kx,j=(a[1]-R)*this.ky;const W=D*D+j*j;W<d&&(d=W,p=C,y=R,_=A,S=H)}return{point:[p,y],index:_,t:Math.max(0,Math.min(1,S))}}lineSlice(i,a,d){let p=this.pointOnLine(d,i),y=this.pointOnLine(d,a);if(p.index>y.index||p.index===y.index&&p.t>y.t){const C=p;p=y,y=C}const _=[p.point],S=p.index+1,A=y.index;!Lv(d[S],_[0])&&S<=A&&_.push(d[S]);for(let C=S+1;C<=A;C++)_.push(d[C]);return Lv(d[A],y.point)||_.push(y.point),_}lineSliceAlong(i,a,d){let p=0;const y=[];for(let _=0;_<d.length-1;_++){const S=d[_],A=d[_+1],C=this.distance(S,A);if(p+=C,p>i&&y.length===0&&y.push(Km(S,A,(i-(p-C))/C)),p>=a)return y.push(Km(S,A,(a-(p-C))/C)),y;p>i&&y.push(A)}return y}bufferPoint(i,a){const d=a/this.ky,p=a/this.kx;return[i[0]-p,i[1]-d,i[0]+p,i[1]+d]}bufferBBox(i,a){const d=a/this.ky,p=a/this.kx;return[i[0]-p,i[1]-d,i[2]+p,i[3]+d]}insideBBox(i,a){return ra(i[0]-a[0])>=0&&ra(i[0]-a[2])<=0&&i[1]>=a[1]&&i[1]<=a[3]}}function Lv(c,i){return c[0]===i[0]&&c[1]===i[1]}function Km(c,i,a){const d=ra(i[0]-c[0]);return[c[0]+d*a,c[1]+(i[1]-c[1])*a]}function ra(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Ym{constructor(i=[],a=(d,p)=>d<p?-1:d>p?1:0){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:d}=this,p=a[i];for(;i>0;){const y=i-1>>1,_=a[y];if(d(p,_)>=0)break;a[i]=_,i=y}a[i]=p}_down(i){const{data:a,compare:d}=this,p=this.length>>1,y=a[i];for(;i<p;){let _=1+(i<<1);const S=_+1;if(S<this.length&&d(a[S],a[_])<0&&(_=S),d(a[_],y)>=0)break;a[i]=a[_],i=_}a[i]=y}}var Lt=8192;function jv(c,i){return i.dist-c.dist}const Jm=100,Qm=50;function Qf(c){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==c.length)return!1;for(let a=0;a<i.length;a++)if(i[a]!==c[a])return!1;return!0}function $u(c){return c[1]-c[0]+1}function Oa(c,i){const a=c[1]>=c[0]&&c[1]<i;return a||console.warn("Distance Expression: Index is out of range"),a}function eg(c,i){if(c[0]>c[1])return[null,null];const a=$u(c);if(i){if(a===2)return[c,null];const d=Math.floor(a/2);return[[c[0],c[0]+d],[c[0]+d,c[1]]]}{if(a===1)return[c,null];const d=Math.floor(a/2)-1;return[[c[0],c[0]+d],[c[0]+d+1,c[1]]]}}function Vc(c,i){const a=[1/0,1/0,-1/0,-1/0];if(!Oa(i,c.length))return a;for(let d=i[0];d<=i[1];++d)zc(a,c[d]);return a}function ep(c){const i=[1/0,1/0,-1/0,-1/0];for(let a=0;a<c.length;++a)for(let d=0;d<c[a].length;++d)zc(i,c[a][d]);return i}function el(c,i,a){if(Qf(c)||Qf(i))return NaN;let d=0,p=0;return c[2]<i[0]&&(d=i[0]-c[2]),c[0]>i[2]&&(d=c[0]-i[2]),c[1]>i[3]&&(p=c[1]-i[3]),c[3]<i[1]&&(p=i[1]-c[3]),a.distance([0,0],[d,p])}function Jr(c){return 360*c-180}function _C(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Nv(c,i){const a=Math.pow(2,i.z),d=(c.y/Lt+i.y)/a;return[Jr((c.x/Lt+i.x)/a),_C(d)]}function vC(c,i){const a=[];for(let d=0;d<c.length;++d)a.push(Nv(c[d],i));return a}function zv(c,i,a){const d=a.pointOnLine(i,c).point;return a.distance(c,d)}function S1(c,i,a,d,p){const y=a.slice(d[0],d[1]+1);let _=1/0;for(let S=i[0];S<=i[1];++S)if((_=Math.min(_,zv(c[S],y,p)))===0)return 0;return _}function ai(c,i,a,d,p){const y=Math.min(p.pointToSegmentDistance(c,a,d),p.pointToSegmentDistance(i,a,d)),_=Math.min(p.pointToSegmentDistance(a,c,i),p.pointToSegmentDistance(d,c,i));return Math.min(y,_)}function xC(c,i,a,d,p){if(!Oa(i,c.length)||!Oa(d,a.length))return NaN;let y=1/0;for(let _=i[0];_<i[1];++_)for(let S=d[0];S<d[1];++S){if(Zm(c[_],c[_+1],a[S],a[S+1]))return 0;y=Math.min(y,ai(c[_],c[_+1],a[S],a[S+1],p))}return y}function bC(c,i,a,d,p){if(!Oa(i,c.length)||!Oa(d,a.length))return NaN;let y=1/0;for(let _=i[0];_<=i[1];++_)for(let S=d[0];S<=d[1];++S)if((y=Math.min(y,p.distance(c[_],a[S])))===0)return y;return y}function wC(c,i,a){if(Kh(c,i,!0))return 0;let d=1/0;for(const p of i){const y=p.length;if(y<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[y-1]&&(d=Math.min(d,a.pointToSegmentDistance(c,p[y-1],p[0])))===0||(d=Math.min(d,zv(c,p,a)))===0)return d}return d}function SC(c,i,a,d){if(!Oa(i,c.length))return NaN;for(let y=i[0];y<=i[1];++y)if(Kh(c[y],a,!0))return 0;let p=1/0;for(let y=i[0];y<i[1];++y)for(const _ of a)for(let S=0,A=_.length,C=A-1;S<A;C=S++){if(Zm(c[y],c[y+1],_[C],_[S]))return 0;p=Math.min(p,ai(c[y],c[y+1],_[C],_[S],d))}return p}function T1(c,i){for(const a of c)for(let d=0;d<=a.length-1;++d)if(Kh(a[d],i,!0))return!0;return!1}function TC(c,i,a,d=1/0){const p=ep(c),y=ep(i);if(d!==1/0&&el(p,y,a)>=d)return d;if(Xh(p,y)){if(T1(c,i))return 0}else if(T1(i,c))return 0;let _=d;for(const S of c)for(let A=0,C=S.length,R=C-1;A<C;R=A++)for(const D of i)for(let j=0,H=D.length,W=H-1;j<H;W=j++){if(Zm(S[R],S[A],D[W],D[j]))return 0;_=Math.min(_,ai(S[R],S[A],D[W],D[j],a))}return _}function tg(c,i,a,d,p,y,_){if(y===null||_===null)return;const S=el(Vc(d,y),Vc(p,_),a);S<i&&c.push({dist:S,range1:y,range2:_})}function EC(c,i,a,d,p=1/0){let y=Math.min(d.distance(c[0],a[0][0]),p);if(y===0)return y;const _=new Ym([{dist:0,range1:[0,c.length-1],range2:[0,0]}],jv),S=i?Qm:Jm,A=ep(a);for(;_.length;){const C=_.pop();if(C.dist>=y)continue;const R=C.range1;if($u(R)<=S){if(!Oa(R,c.length))return NaN;if(i){const D=SC(c,R,a,d);if((y=Math.min(y,D))===0)return y}else for(let D=R[0];D<=R[1];++D){const j=wC(c[D],a,d);if((y=Math.min(y,j))===0)return y}}else{const D=eg(R,i);if(D[0]!==null){const j=el(Vc(c,D[0]),A,d);j<y&&_.push({dist:j,range1:D[0],range2:[0,0]})}if(D[1]!==null){const j=el(Vc(c,D[1]),A,d);j<y&&_.push({dist:j,range1:D[1],range2:[0,0]})}}}return y}function E1(c,i,a,d,p,y=1/0){let _=Math.min(y,p.distance(c[0],a[0]));if(_===0)return _;const S=new Ym([{dist:0,range1:[0,c.length-1],range2:[0,a.length-1]}],jv),A=i?Qm:Jm,C=d?Qm:Jm;for(;S.length;){const R=S.pop();if(R.dist>=_)continue;const D=R.range1,j=R.range2;if($u(D)<=A&&$u(j)<=C){if(!Oa(D,c.length)||!Oa(j,a.length))return NaN;if(i&&d?_=Math.min(_,xC(c,D,a,j,p)):i||d?i&&!d?_=Math.min(_,S1(a,j,c,D,p)):!i&&d&&(_=Math.min(_,S1(c,D,a,j,p))):_=Math.min(_,bC(c,D,a,j,p)),_===0)return _}else{const H=eg(D,i),W=eg(j,d);tg(S,_,p,c,a,H[0],W[0]),tg(S,_,p,c,a,H[0],W[1]),tg(S,_,p,c,a,H[1],W[0]),tg(S,_,p,c,a,H[1],W[1])}}return _}function Fv(c,i,a,d,p=1/0){let y=p;const _=Vc(c,[0,c.length-1]);for(const S of a)if(!(y!==1/0&&el(_,Vc(S,[0,S.length-1]),d)>=y)&&(y=Math.min(y,E1(c,i,S,!0,d,y)),y===0))return y;return y}function rg(c,i,a,d,p=1/0){let y=p;const _=Vc(c,[0,c.length-1]);for(const S of a){if(y!==1/0&&el(_,ep(S),d)>=y)continue;const A=EC(c,i,S,d,y);if(isNaN(A))return A;if((y=Math.min(y,A))===0)return y}return y}function Bv(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Vu{constructor(i,a){this.type=ir,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(Mr(i[1])){const d=i[1];if(d.type==="FeatureCollection"){for(let p=0;p<d.features.length;++p)if(Bv(d.features[p].geometry.type))return new Vu(d,d.features[p].geometry)}else if(d.type==="Feature"){if(Bv(d.geometry.type))return new Vu(d,d.geometry)}else if(Bv(d.type))return new Vu(d,d)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const a=i.geometry(),d=i.canonicalID();if(a!=null&&d!=null){if(i.geometryType()==="Point")return function(p,y,_){const S=[];for(const C of p)for(const R of C)S.push(Nv(R,y));const A=new Jh(S[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?E1(S,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",A):_.type==="MultiLineString"?Fv(S,!1,_.coordinates,A):_.type==="Polygon"||_.type==="MultiPolygon"?rg(S,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,A):null}(a,d,this.geometries);if(i.geometryType()==="LineString")return function(p,y,_){const S=[];for(const C of p){const R=[];for(const D of C)R.push(Nv(D,y));S.push(R)}const A=new Jh(S[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Fv(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,A);if(_.type==="MultiLineString"){let C=1/0;for(let R=0;R<_.coordinates.length;R++){const D=Fv(_.coordinates[R],!0,S,A,C);if(isNaN(D))return D;if((C=Math.min(C,D))===0)return C}return C}if(_.type==="Polygon"||_.type==="MultiPolygon"){let C=1/0;for(let R=0;R<S.length;R++){const D=rg(S[R],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,A,C);if(isNaN(D))return D;if((C=Math.min(C,D))===0)return C}return C}return null}(a,d,this.geometries);if(i.geometryType()==="Polygon")return function(p,y,_){const S=[];for(const C of function(R,D){const j=R.length;if(j<=1)return[R];const H=[];let W,J;for(let te=0;te<j;te++){const ae=mC(R[te]);ae!==0&&(R[te].area=Math.abs(ae),J===void 0&&(J=ae<0),J===ae<0?(W&&H.push(W),W=[R[te]]):W.push(R[te]))}return W&&H.push(W),H}(p)){const R=[];for(let D=0;D<C.length;++D)R.push(vC(C[D],y));S.push(R)}const A=new Jh(S[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return rg(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,A);if(_.type==="MultiLineString"){let C=1/0;for(let R=0;R<_.coordinates.length;R++){const D=rg(_.coordinates[R],!0,S,A,C);if(isNaN(D))return D;if((C=Math.min(C,D))===0)return C}return C}return _.type==="Polygon"||_.type==="MultiPolygon"?function(C,R,D){let j=1/0;for(const H of C)for(const W of R){const J=TC(H,W,D,j);if(isNaN(J))return J;if((j=Math.min(j,J))===0)return j}return j}(_.type==="Polygon"?[_.coordinates]:_.coordinates,S,A):null}(a,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Qh(c){if(c instanceof wo&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof $c||c instanceof Vu)return!1;if(c instanceof td)return c.featureConstant;let i=!0;return c.eachChild(a=>{i&&!Qh(a)&&(i=!1)}),i}function ng(c){if(c instanceof wo&&c.name==="feature-state")return!1;let i=!0;return c.eachChild(a=>{i&&!ng(a)&&(i=!1)}),i}function ig(c){if(c instanceof td)return new Set([c.key]);let i=new Set;return c.eachChild(a=>{i=new Set([...i,...ig(a)])}),i}function ed(c,i){if(c instanceof wo&&i.indexOf(c.name)>=0)return!1;let a=!0;return c.eachChild(d=>{a&&!ed(d,i)&&(a=!1)}),a}function A1(c,i,a){return[c,i,a].filter(Boolean).join("")}function $v(c,i){switch(c){case"string":return Ca(i);case"number":return+i;case"boolean":return!!i;case"color":return Sn.parse(i);case"formatted":return hs.fromString(Ca(i));case"resolvedImage":return Cs.build(Ca(i))}return i}function P1(c,i,a,d){return d!==void 0&&(c=d*Math.round(c/d)),i!==void 0&&c<i&&(c=i),a!==void 0&&c>a&&(c=a),c}class td{constructor(i,a,d,p=!1){this.type=i,this.key=a,this.scope=d,this.featureConstant=p}static parse(i,a){let d=a.expectedType;if(d==null&&(d=Tn),i.length<2||i.length>3)return a.error("Invalid number of arguments for 'config' expression.");const p=a.parse(i[1],1);if(!(p instanceof mr))return a.error("Key name of 'config' expression must be a string literal.");let y,_=!0;const S=Ca(p.value);if(i.length>=3){const A=a.parse(i[2],2);if(!(A instanceof mr))return a.error("Scope of 'config' expression must be a string literal.");y=Ca(A.value)}if(a.options){const A=A1(S,y,a._scope),C=a.options.get(A);C&&(_=Qh(C.value||C.default))}return new td(d,S,y,_)}evaluate(i){const a=A1(this.key,this.scope,i.scope),d=i.getConfig(a);if(!d)return null;const{type:p,value:y,values:_,minValue:S,maxValue:A,stepValue:C}=d,R=d.default.evaluate(i);let D=R;if(y){const j=i.scope;i.scope=(j||"").split("").slice(1).join(""),D=y.evaluate(i),i.scope=j}return p&&(D=$v(p,D)),D===void 0||S===void 0&&A===void 0&&C===void 0||(typeof D=="number"?D=P1(D,S,A,C):Array.isArray(D)&&(D=D.map(j=>typeof j=="number"?P1(j,S,A,C):j))),y!==void 0&&D!==void 0&&_&&!_.includes(D)&&(D=R,p&&(D=$v(p,D))),(p&&p!==this.type||D!==void 0&&!Wm(Ht(D),this.type))&&(D=$v(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class og{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const d=i[1];return a.scope.has(d)?new og(d,a.scope.get(d)):a.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class sg{constructor(i,a=[],d,p=new Mv,y=[],_,S){this.registry=i,this.path=a,this.key=a.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=p,this.errors=y,this.expectedType=d,this._scope=_,this.options=S}parse(i,a,d,p,y={}){return a||d?this.concat(a,null,d,p)._parse(i,y):this._parse(i,y)}parseObjectValue(i,a,d,p,y,_={}){return this.concat(a,d,p,y)._parse(i,_)}_parse(i,a){function d(p,y,_){return _==="assert"?new ur(y,[p]):_==="coerce"?new Ia(y,[p]):p}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(p){let y=p.parse(i,this);if(!y)return null;if(this.expectedType){const _=this.expectedType,S=y.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||S.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(_,S))return null}else y=d(y,_,a.typeAnnotation||"coerce");else y=d(y,_,a.typeAnnotation||"assert")}if(!(y instanceof mr)&&y.type.kind!=="resolvedImage"&&Vv(y)){const _=new Kf(this._scope,this.options);try{y=new mr(y.type,y.evaluate(_))}catch(S){return this.error(S.message),null}}return y}return Ia.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,d,p){let y=typeof i=="number"?this.path.concat(i):this.path;y=typeof a=="string"?y.concat(a):y;const _=p?this.scope.concat(p):this.scope;return new sg(this.registry,y,d||null,_,this.errors,this._scope,this.options)}error(i,...a){const d=`${this.key}${a.map(p=>`[${p}]`).join("")}`;this.errors.push(new ta(d,i))}checkSubtype(i,a){const d=Wh(i,a);return d&&this.error(d),d}}function Vv(c){if(c instanceof og)return Vv(c.boundExpression);if(c instanceof wo&&c.name==="error"||c instanceof yl||c instanceof $c||c instanceof Vu||c instanceof td)return!1;const i=c instanceof Ia||c instanceof ur;let a=!0;return c.eachChild(d=>{a=i?a&&Vv(d):a&&d instanceof mr}),!!a&&Qh(c)&&ed(c,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ag(c,i){const a=c.length-1;let d,p,y=0,_=a,S=0;for(;y<=_;)if(S=Math.floor((y+_)/2),d=c[S],p=c[S+1],d<=i){if(S===a||i<p)return S;y=S+1}else{if(!(d>i))throw new Bi("Input is not a number.");_=S-1}return 0}class tp{constructor(i,a,d){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const d=a.parse(i[1],1,ir);if(!d)return null;const p=[];let y=null;a.expectedType&&a.expectedType.kind!=="value"&&(y=a.expectedType);for(let _=1;_<i.length;_+=2){const S=_===1?-1/0:i[_],A=i[_+1],C=_,R=_+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(p.length&&p[p.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const D=a.parse(A,R,y);if(!D)return null;y=y||D.type,p.push([S,D])}return new tp(y,d,p)}evaluate(i){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(i);const p=this.input.evaluate(i);if(p<=a[0])return d[0].evaluate(i);const y=a.length;return p>=a[y-1]?d[y-1].evaluate(i):d[ag(a,p)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}const C1=.95047,I1=1.08883,M1=4/29,rd=6/29,O1=3*rd*rd,Uv=rd*rd*rd,AC=Math.PI/180,k1=180/Math.PI;function Gv(c){return c>Uv?Math.pow(c,1/3):c/O1+M1}function Hv(c){return c>rd?c*c*c:O1*(c-M1)}function Wv(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function lg(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function qv(c){const i=lg(c.r),a=lg(c.g),d=lg(c.b),p=Gv((.4124564*i+.3575761*a+.1804375*d)/C1),y=Gv((.2126729*i+.7151522*a+.072175*d)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-Gv((.0193339*i+.119192*a+.9503041*d)/I1)),alpha:c.a}}function Uu(c){let i=(c.l+16)/116,a=isNaN(c.a)?i:i+c.a/500,d=isNaN(c.b)?i:i-c.b/200;return i=1*Hv(i),a=C1*Hv(a),d=I1*Hv(d),new Sn(Wv(3.2404542*a-1.5371385*i-.4985314*d),Wv(-.969266*a+1.8760108*i+.041556*d),Wv(.0556434*a-.2040259*i+1.0572252*d),c.alpha)}function R1(c,i,a){const d=i-c;return c+a*(d>180||d<-180?d-360*Math.round(d/360):d)}const nd={forward:qv,reverse:Uu,interpolate:function(c,i,a){return{l:lr(c.l,i.l,a),a:lr(c.a,i.a,a),b:lr(c.b,i.b,a),alpha:lr(c.alpha,i.alpha,a)}}},rp={forward:function(c){const{l:i,a,b:d}=qv(c),p=Math.atan2(d,a)*k1;return{h:p<0?p+360:p,c:Math.sqrt(a*a+d*d),l:i,alpha:c.a}},reverse:function(c){const i=c.h*AC,a=c.c;return Uu({l:c.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:c.alpha})},interpolate:function(c,i,a){return{h:R1(c.h,i.h,a),c:lr(c.c,i.c,a),l:lr(c.l,i.l,a),alpha:lr(c.alpha,i.alpha,a)}}};var cg=Object.freeze({__proto__:null,hcl:rp,lab:nd});class Is{constructor(i,a,d,p,y){this.type=i,this.operator=a,this.interpolation=d,this.input=p,this.labels=[],this.outputs=[];for(const[_,S]of y)this.labels.push(_),this.outputs.push(S)}static interpolationFactor(i,a,d,p){let y=0;if(i.name==="exponential")y=Zv(a,i.base,d,p);else if(i.name==="linear")y=Zv(a,1,d,p);else if(i.name==="cubic-bezier"){const _=i.controlPoints;y=new Rc(_[0],_[1],_[2],_[3]).solve(Zv(a,1,d,p))}return y}static parse(i,a){let[d,p,y,..._]=i;if(!Array.isArray(p)||p.length===0)return a.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const C=p[1];if(typeof C!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:C}}else{if(p[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const C=p.slice(1);if(C.length!==4||C.some(R=>typeof R!="number"||R<0||R>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:C}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(y=a.parse(y,2,ir),!y)return null;const S=[];let A=null;d==="interpolate-hcl"||d==="interpolate-lab"?A=Fs:a.expectedType&&a.expectedType.kind!=="value"&&(A=a.expectedType);for(let C=0;C<_.length;C+=2){const R=_[C],D=_[C+1],j=C+3,H=C+4;if(typeof R!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(S.length&&S[S.length-1][0]>=R)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const W=a.parse(D,H,A);if(!W)return null;A=A||W.type,S.push([R,W])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new Is(A,d,p,y,S):a.error(`Type ${Gi(A)} is not interpolatable.`)}evaluate(i){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(i);const p=this.input.evaluate(i);if(p<=a[0])return d[0].evaluate(i);const y=a.length;if(p>=a[y-1])return d[y-1].evaluate(i);const _=ag(a,p),S=Is.interpolationFactor(this.interpolation,p,a[_],a[_+1]),A=d[_].evaluate(i),C=d[_+1].evaluate(i);return this.operator==="interpolate"?Gf[this.type.kind.toLowerCase()](A,C,S):this.operator==="interpolate-hcl"?rp.reverse(rp.interpolate(rp.forward(A),rp.forward(C),S)):nd.reverse(nd.interpolate(nd.forward(A),nd.forward(C),S))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,i,this.input.serialize()];for(let d=0;d<this.labels.length;d++)a.push(this.labels[d],this.outputs[d].serialize());return a}}function Zv(c,i,a,d){const p=d-a,y=c-a;return p===0?0:i===1?y/p:(Math.pow(i,y)-1)/(Math.pow(i,p)-1)}class ug{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let d=null;const p=a.expectedType;p&&p.kind!=="value"&&(d=p);const y=[];for(const S of i.slice(1)){const A=a.parse(S,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!A)return null;d=d||A.type,y.push(A)}const _=p&&y.some(S=>Wh(p,S.type));return new ug(_?Tn:d,y)}evaluate(i){let a,d=null,p=0;for(const y of this.args){if(p++,d=y.evaluate(i),d&&d instanceof Cs&&!d.available&&(a||(a=d),d=null,p===this.args.length))return a;if(d!==null)break}return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class np{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let y=1;y<i.length-1;y+=2){const _=i[y];if(typeof _!="string")return a.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",y);const S=a.parse(i[y+1],y+1);if(!S)return null;d.push([_,S])}const p=a.parse(i[i.length-1],i.length-1,a.expectedType,d);return p?new np(d,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,d]of this.bindings)i.push(a,d.serialize());return i.push(this.result.serialize()),i}}class hg{constructor(i,a,d){this.type=i,this.index=a,this.input=d}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,ir),p=a.parse(i[2],2,Xo(a.expectedType||Tn));return d&&p?new hg(p.type.itemType,d,p):null}evaluate(i){const a=this.index.evaluate(i),d=this.input.evaluate(i);if(a<0)throw new Bi(`Array index out of bounds: ${a} < 0.`);if(a>=d.length)throw new Bi(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a!==Math.floor(a))throw new Bi(`Array index must be an integer, but found ${a} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return d[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Xv{constructor(i,a,d){this.type=i,this.index=a,this.input=d}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,ir),p=a.parse(i[2],2,Xo(a.expectedType||Tn));return d&&p?new Xv(p.type.itemType,d,p):null}evaluate(i){const a=this.index.evaluate(i),d=this.input.evaluate(i);if(a<0)throw new Bi(`Array index out of bounds: ${a} < 0.`);if(a>d.length-1)throw new Bi(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a===Math.floor(a))return d[a];const p=Math.floor(a),y=Math.ceil(a),_=d[p],S=d[y];if(typeof _!="number"||typeof S!="number")throw new Bi(`Cannot interpolate between non-number values at index ${a}.`);const A=a-p;return _*(1-A)+S*A}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Kv{constructor(i,a){this.type=xn,this.needle=i,this.haystack=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Tn),p=a.parse(i[2],2,Tn);return d&&p?jc(d.type,[xn,vn,ir,Hh,Tn])?new Kv(d,p):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(d.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(d==null)return!1;if(!qf(a,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(Ht(a))} instead.`);if(!qf(d,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${Gi(Ht(d))} instead.`);return d.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class dg{constructor(i,a,d){this.type=ir,this.needle=i,this.haystack=a,this.fromIndex=d}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Tn),p=a.parse(i[2],2,Tn);if(!d||!p)return null;if(!jc(d.type,[xn,vn,ir,Hh,Tn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(d.type)} instead`);if(i.length===4){const y=a.parse(i[3],3,ir);return y?new dg(d,p,y):null}return new dg(d,p)}evaluate(i){const a=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!qf(a,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(Ht(a))} instead.`);if(!qf(d,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${Gi(Ht(d))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(i);return d.indexOf(a,p)}return d.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fg{constructor(i,a,d,p,y,_){this.inputType=i,this.type=a,this.input=d,this.cases=p,this.outputs=y,this.otherwise=_}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let d,p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);const y={},_=[];for(let C=2;C<i.length-1;C+=2){let R=i[C];const D=i[C+1];Array.isArray(R)||(R=[R]);const j=a.concat(C);if(R.length===0)return j.error("Expected at least one branch label.");for(const W of R){if(typeof W!="number"&&typeof W!="string")return j.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return j.error("Numeric branch labels must be integer values.");if(d){if(j.checkSubtype(d,Ht(W)))return null}else d=Ht(W);if(y[String(W)]!==void 0)return j.error("Branch labels must be unique.");y[String(W)]=_.length}const H=a.parse(D,C,p);if(!H)return null;p=p||H.type,_.push(H)}const S=a.parse(i[1],1,Tn);if(!S)return null;const A=a.parse(i[i.length-1],i.length-1,p);return A?S.type.kind!=="value"&&a.concat(1).checkSubtype(d,S.type)?null:new fg(d,p,S,y,_,A):null}evaluate(i){const a=this.input.evaluate(i);return(Wm(Ht(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),d=[],p={};for(const _ of a){const S=p[this.cases[_]];S===void 0?(p[this.cases[_]]=d.length,d.push([this.cases[_],[_]])):d[S][1].push(_)}const y=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,S]of d)i.push(S.length===1?y(S[0]):S.map(y)),i.push(this.outputs[_].serialize());return i.push(this.otherwise.serialize()),i}}class pg{constructor(i,a,d){this.type=i,this.branches=a,this.otherwise=d}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const p=[];for(let _=1;_<i.length-1;_+=2){const S=a.parse(i[_],_,xn);if(!S)return null;const A=a.parse(i[_+1],_+1,d);if(!A)return null;p.push([S,A]),d=d||A.type}const y=a.parse(i[i.length-1],i.length-1,d);return y?new pg(d,p,y):null}evaluate(i){for(const[a,d]of this.branches)if(a.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,d]of this.branches)i(a),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class Gu{constructor(i,a,d,p){this.type=i,this.input=a,this.beginIndex=d,this.endIndex=p}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Tn),p=a.parse(i[2],2,ir);if(!d||!p)return null;if(!jc(d.type,[Xo(Tn),vn,Tn]))return a.error(`Expected first argument to be of type array or string, but found ${Gi(d.type)} instead`);if(i.length===4){const y=a.parse(i[3],3,ir);return y?new Gu(d.type,d,p,y):null}return new Gu(d.type,d,p)}evaluate(i){const a=this.input.evaluate(i),d=this.beginIndex.evaluate(i);if(!qf(a,["string","array"]))throw new Bi(`Expected first argument to be of type array or string, but found ${Gi(Ht(a))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(i);return a.slice(d,p)}return a.slice(d)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Yv{constructor(i,a){this.type=Xo(vn),this.str=i,this.delimiter=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,vn),p=a.parse(i[2],2,vn);return d&&p?new Yv(d,p):void 0}evaluate(i){const a=this.str.evaluate(i),d=this.delimiter.evaluate(i);return a.split(d)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Jv(c,i){return c==="=="||c==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function D1(c,i,a,d){return d.compare(i,a)===0}function id(c,i,a){const d=c!=="=="&&c!=="!=";return class N9{constructor(y,_,S){this.type=xn,this.lhs=y,this.rhs=_,this.collator=S,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");const S=y[0];let A=_.parse(y[1],1,Tn);if(!A)return null;if(!Jv(S,A.type))return _.concat(1).error(`"${S}" comparisons are not supported for type '${Gi(A.type)}'.`);let C=_.parse(y[2],2,Tn);if(!C)return null;if(!Jv(S,C.type))return _.concat(2).error(`"${S}" comparisons are not supported for type '${Gi(C.type)}'.`);if(A.type.kind!==C.type.kind&&A.type.kind!=="value"&&C.type.kind!=="value")return _.error(`Cannot compare types '${Gi(A.type)}' and '${Gi(C.type)}'.`);d&&(A.type.kind==="value"&&C.type.kind!=="value"?A=new ur(C.type,[A]):A.type.kind!=="value"&&C.type.kind==="value"&&(C=new ur(A.type,[C])));let R=null;if(y.length===4){if(A.type.kind!=="string"&&C.type.kind!=="string"&&A.type.kind!=="value"&&C.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(R=_.parse(y[3],3,Hm),!R)return null}return new N9(A,C,R)}evaluate(y){const _=this.lhs.evaluate(y),S=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const A=Ht(_),C=Ht(S);if(A.kind!==C.kind||A.kind!=="string"&&A.kind!=="number")throw new Bi(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${A.kind}, ${C.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const A=Ht(_),C=Ht(S);if(A.kind!=="string"||C.kind!=="string")return i(y,_,S)}return this.collator?a(y,_,S,this.collator.evaluate(y)):i(y,_,S)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[c];return this.eachChild(_=>{y.push(_.serialize())}),y}}}const L1=id("==",function(c,i,a){return i===a},D1),j1=id("!=",function(c,i,a){return i!==a},function(c,i,a,d){return!D1(0,i,a,d)}),PC=id("<",function(c,i,a){return i<a},function(c,i,a,d){return d.compare(i,a)<0}),CC=id(">",function(c,i,a){return i>a},function(c,i,a,d){return d.compare(i,a)>0}),IC=id("<=",function(c,i,a){return i<=a},function(c,i,a,d){return d.compare(i,a)<=0}),mg=id(">=",function(c,i,a){return i>=a},function(c,i,a,d){return d.compare(i,a)>=0});class Qv{constructor(i,a,d,p,y,_){this.type=vn,this.number=i,this.locale=a,this.currency=d,this.unit=p,this.minFractionDigits=y,this.maxFractionDigits=_}static parse(i,a){if(i.length!==3)return a.error("Expected two arguments.");const d=a.parse(i[1],1,ir);if(!d)return null;const p=i[2];if(typeof p!="object"||Array.isArray(p))return a.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=a.parseObjectValue(p.locale,2,"locale",vn),!y))return null;let _=null;if(p.currency&&(_=a.parseObjectValue(p.currency,2,"currency",vn),!_))return null;let S=null;if(p.unit&&(S=a.parseObjectValue(p.unit,2,"unit",vn),!S))return null;let A=null;if(p["min-fraction-digits"]&&(A=a.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",ir),!A))return null;let C=null;return p["max-fraction-digits"]&&(C=a.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",ir),!C)?null:new Qv(d,y,_,S,A,C)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class e0{constructor(i){this.type=ir,this.input=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=a.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Gi(d.type)} instead.`):new e0(d):null}evaluate(i){const a=this.input.evaluate(i);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Bi(`Expected value to be of type string or array, but found ${Gi(Ht(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}function N1(c){return function(){c=1831565813+(c|=0)|0;let i=Math.imul(c^c>>>15,1|c);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const od={"==":L1,"!=":j1,">":CC,"<":PC,">=":mg,"<=":IC,array:ur,at:hg,"at-interpolated":Xv,boolean:ur,case:pg,coalesce:ug,collator:yl,format:qh,image:Zh,in:Kv,"index-of":dg,interpolate:Is,"interpolate-hcl":Is,"interpolate-lab":Is,length:e0,let:np,literal:mr,match:fg,number:ur,"number-format":Qv,object:ur,slice:Gu,step:tp,string:ur,"to-boolean":Ia,"to-color":Ia,"to-number":Ia,"to-string":Ia,var:og,within:$c,distance:Vu,config:td,split:Yv};function t0(c,[i,a,d,p]){i=i.evaluate(c),a=a.evaluate(c),d=d.evaluate(c);const y=p?p.evaluate(c):1,_=Fu(i,a,d,y);if(_)throw new Bi(_);return new Sn(i/255,a/255,d/255,y)}function z1(c,[i,a,d,p]){i=i.evaluate(c),a=a.evaluate(c),d=d.evaluate(c);const y=p?p.evaluate(c):1,_=function(C,R,D,j){return typeof C=="number"&&C>=0&&C<=360?typeof R=="number"&&R>=0&&R<=100&&typeof D=="number"&&D>=0&&D<=100?j===void 0||typeof j=="number"&&j>=0&&j<=1?null:`Invalid hsla value [${[C,R,D,j].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof j=="number"?[C,R,D,j]:[C,R,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof j=="number"?[C,R,D,j]:[C,R,D]).join(", ")}]: 'h' must be between 0 and 360.`}(i,a,d,y);if(_)throw new Bi(_);const S=`hsla(${i}, ${a}%, ${d}%, ${y})`,A=Sn.parse(S);if(!A)throw new Bi(`Failed to parse HSLA color: ${S}`);return A}function F1(c,i){return c in i}function gg(c,i){const a=i[c];return a===void 0?null:a}function Uc(c){return{type:c}}function r0(c){return{result:"success",value:c}}function Gc(c){return{result:"error",value:c}}function Hc(c,i){return!!c&&!!c.parameters&&c.parameters.indexOf(i)>-1}function yg(c){return c["property-type"]==="data-driven"}function B1(c){return Hc(c.expression,"measure-light")}function $1(c){return Hc(c.expression,"zoom")}function _g(c){return!!c.expression&&c.expression.interpolated}function vg(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function V1(c){return c}function n0(c,i){const a=i.type==="color",d=c.stops&&typeof c.stops[0][0]=="object",p=d||!(d||c.property!==void 0),y=c.type||(_g(i)?"exponential":"interval");if(a&&((c=zu({},c)).stops&&(c.stops=c.stops.map(C=>[C[0],Sn.parse(C[1])])),c.default=Sn.parse(c.default?c.default:i.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!cg[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let _,S,A;if(y==="exponential")_=G1;else if(y==="interval")_=U1;else if(y==="categorical"){_=i0,S=Object.create(null);for(const C of c.stops)S[C[0]]=C[1];A=typeof c.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);_=Wc}if(d){const C={},R=[];for(let H=0;H<c.stops.length;H++){const W=c.stops[H],J=W[0].zoom;C[J]===void 0&&(C[J]={zoom:J,type:c.type,property:c.property,default:c.default,stops:[]},R.push(J)),C[J].stops.push([W[0].value,W[1]])}const D=[];for(const H of R)D.push([C[H].zoom,n0(C[H],i)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Is.interpolationFactor.bind(void 0,j),zoomStops:D.map(H=>H[0]),evaluate:({zoom:H},W)=>G1({stops:D,base:c.base},i,H).evaluate(H,W)}}if(p){const C=y==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Is.interpolationFactor.bind(void 0,C),zoomStops:c.stops.map(R=>R[0]),evaluate:({zoom:R})=>_(c,i,R,S,A)}}return{kind:"source",evaluate(C,R){const D=R&&R.properties?R.properties[c.property]:void 0;return D===void 0?Hu(c.default,i.default):_(c,i,D,S,A)}}}function Hu(c,i,a){return c!==void 0?c:i!==void 0?i:a!==void 0?a:void 0}function i0(c,i,a,d,p){return Hu(typeof a===p?d[a]:void 0,c.default,i.default)}function U1(c,i,a){if(Nc(a)!=="number")return Hu(c.default,i.default);const d=c.stops.length;if(d===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[d-1][0])return c.stops[d-1][1];const p=ag(c.stops.map(y=>y[0]),a);return c.stops[p][1]}function G1(c,i,a){const d=c.base!==void 0?c.base:1;if(Nc(a)!=="number")return Hu(c.default,i.default);const p=c.stops.length;if(p===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[p-1][0])return c.stops[p-1][1];const y=ag(c.stops.map(R=>R[0]),a),_=function(R,D,j,H){const W=H-j,J=R-j;return W===0?0:D===1?J/W:(Math.pow(D,J)-1)/(Math.pow(D,W)-1)}(a,d,c.stops[y][0],c.stops[y+1][0]),S=c.stops[y][1],A=c.stops[y+1][1];let C=Gf[i.type]||V1;if(c.colorSpace&&c.colorSpace!=="rgb"){const R=cg[c.colorSpace];C=(D,j)=>R.reverse(R.interpolate(R.forward(D),R.forward(j),_))}return typeof S.evaluate=="function"?{evaluate(...R){const D=S.evaluate.apply(void 0,R),j=A.evaluate.apply(void 0,R);if(D!==void 0&&j!==void 0)return C(D,j,_)}}:C(S,A,_)}function Wc(c,i,a){return i.type==="color"?a=Sn.parse(a):i.type==="formatted"?a=hs.fromString(a.toString()):i.type==="resolvedImage"?a=Cs.build(a.toString()):Nc(a)===i.type||i.type==="enum"&&i.values[a]||(a=void 0),Hu(a,c.default,i.default)}wo.register(od,{error:[{kind:"error"},[vn],(c,[i])=>{throw new Bi(i.evaluate(c))}],typeof:[vn,[Tn],(c,[i])=>Gi(Ht(i.evaluate(c)))],"to-rgba":[Xo(ir,4),[Fs],(c,[i])=>i.evaluate(c).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Xo(ir,4),[Fs],(c,[i])=>i.evaluate(c).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Fs,[ir,ir,ir],t0],rgba:[Fs,[ir,ir,ir,ir],t0],hsl:[Fs,[ir,ir,ir],z1],hsla:[Fs,[ir,ir,ir,ir],z1],has:{type:xn,overloads:[[[vn],(c,[i])=>F1(i.evaluate(c),c.properties())],[[vn,Kl],(c,[i,a])=>F1(i.evaluate(c),a.evaluate(c))]]},get:{type:Tn,overloads:[[[vn],(c,[i])=>gg(i.evaluate(c),c.properties())],[[vn,Kl],(c,[i,a])=>gg(i.evaluate(c),a.evaluate(c))]]},"feature-state":[Tn,[vn],(c,[i])=>gg(i.evaluate(c),c.featureState||{})],properties:[Kl,[],c=>c.properties()],"geometry-type":[vn,[],c=>c.geometryType()],worldview:[vn,[],c=>c.globals.worldview||""],id:[Tn,[],c=>c.id()],zoom:[ir,[],c=>c.globals.zoom],pitch:[ir,[],c=>c.globals.pitch||0],"distance-from-center":[ir,[],c=>c.distanceFromCenter()],"measure-light":[ir,[vn],(c,[i])=>c.measureLight(i.evaluate(c))],"heatmap-density":[ir,[],c=>c.globals.heatmapDensity||0],"line-progress":[ir,[],c=>c.globals.lineProgress||0],"raster-value":[ir,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[ir,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[ir,[],c=>c.globals.skyRadialProgress||0],accumulated:[Tn,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[ir,Uc(ir),(c,i)=>{let a=0;for(const d of i)a+=d.evaluate(c);return a}],"*":[ir,Uc(ir),(c,i)=>{let a=1;for(const d of i)a*=d.evaluate(c);return a}],"-":{type:ir,overloads:[[[ir,ir],(c,[i,a])=>i.evaluate(c)-a.evaluate(c)],[[ir],(c,[i])=>-i.evaluate(c)]]},"/":[ir,[ir,ir],(c,[i,a])=>i.evaluate(c)/a.evaluate(c)],"%":[ir,[ir,ir],(c,[i,a])=>i.evaluate(c)%a.evaluate(c)],ln2:[ir,[],()=>Math.LN2],pi:[ir,[],()=>Math.PI],e:[ir,[],()=>Math.E],"^":[ir,[ir,ir],(c,[i,a])=>Math.pow(i.evaluate(c),a.evaluate(c))],sqrt:[ir,[ir],(c,[i])=>Math.sqrt(i.evaluate(c))],log10:[ir,[ir],(c,[i])=>Math.log(i.evaluate(c))/Math.LN10],ln:[ir,[ir],(c,[i])=>Math.log(i.evaluate(c))],log2:[ir,[ir],(c,[i])=>Math.log(i.evaluate(c))/Math.LN2],sin:[ir,[ir],(c,[i])=>Math.sin(i.evaluate(c))],cos:[ir,[ir],(c,[i])=>Math.cos(i.evaluate(c))],tan:[ir,[ir],(c,[i])=>Math.tan(i.evaluate(c))],asin:[ir,[ir],(c,[i])=>Math.asin(i.evaluate(c))],acos:[ir,[ir],(c,[i])=>Math.acos(i.evaluate(c))],atan:[ir,[ir],(c,[i])=>Math.atan(i.evaluate(c))],min:[ir,Uc(ir),(c,i)=>Math.min(...i.map(a=>a.evaluate(c)))],max:[ir,Uc(ir),(c,i)=>Math.max(...i.map(a=>a.evaluate(c)))],abs:[ir,[ir],(c,[i])=>Math.abs(i.evaluate(c))],round:[ir,[ir],(c,[i])=>{const a=i.evaluate(c);return a<0?-Math.round(-a):Math.round(a)}],floor:[ir,[ir],(c,[i])=>Math.floor(i.evaluate(c))],ceil:[ir,[ir],(c,[i])=>Math.ceil(i.evaluate(c))],"filter-==":[xn,[vn,Tn],(c,[i,a])=>c.properties()[i.value]===a.value],"filter-id-==":[xn,[Tn],(c,[i])=>c.id()===i.value],"filter-type-==":[xn,[vn],(c,[i])=>c.geometryType()===i.value],"filter-<":[xn,[vn,Tn],(c,[i,a])=>{const d=c.properties()[i.value],p=a.value;return typeof d==typeof p&&d<p}],"filter-id-<":[xn,[Tn],(c,[i])=>{const a=c.id(),d=i.value;return typeof a==typeof d&&a<d}],"filter->":[xn,[vn,Tn],(c,[i,a])=>{const d=c.properties()[i.value],p=a.value;return typeof d==typeof p&&d>p}],"filter-id->":[xn,[Tn],(c,[i])=>{const a=c.id(),d=i.value;return typeof a==typeof d&&a>d}],"filter-<=":[xn,[vn,Tn],(c,[i,a])=>{const d=c.properties()[i.value],p=a.value;return typeof d==typeof p&&d<=p}],"filter-id-<=":[xn,[Tn],(c,[i])=>{const a=c.id(),d=i.value;return typeof a==typeof d&&a<=d}],"filter->=":[xn,[vn,Tn],(c,[i,a])=>{const d=c.properties()[i.value],p=a.value;return typeof d==typeof p&&d>=p}],"filter-id->=":[xn,[Tn],(c,[i])=>{const a=c.id(),d=i.value;return typeof a==typeof d&&a>=d}],"filter-has":[xn,[Tn],(c,[i])=>i.value in c.properties()],"filter-has-id":[xn,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[xn,[Xo(vn)],(c,[i])=>i.value.indexOf(c.geometryType())>=0],"filter-id-in":[xn,[Xo(Tn)],(c,[i])=>i.value.indexOf(c.id())>=0],"filter-in-small":[xn,[vn,Xo(Tn)],(c,[i,a])=>a.value.indexOf(c.properties()[i.value])>=0],"filter-in-large":[xn,[vn,Xo(Tn)],(c,[i,a])=>function(d,p,y,_){for(;y<=_;){const S=y+_>>1;if(p[S]===d)return!0;p[S]>d?_=S-1:y=S+1}return!1}(c.properties()[i.value],a.value,0,a.value.length-1)],all:{type:xn,overloads:[[[xn,xn],(c,[i,a])=>i.evaluate(c)&&a.evaluate(c)],[Uc(xn),(c,i)=>{for(const a of i)if(!a.evaluate(c))return!1;return!0}]]},any:{type:xn,overloads:[[[xn,xn],(c,[i,a])=>i.evaluate(c)||a.evaluate(c)],[Uc(xn),(c,i)=>{for(const a of i)if(a.evaluate(c))return!0;return!1}]]},"!":[xn,[xn],(c,[i])=>!i.evaluate(c)],"is-supported-script":[xn,[vn],(c,[i])=>{const a=c.globals&&c.globals.isSupportedScript;return!a||a(i.evaluate(c))}],upcase:[vn,[vn],(c,[i])=>i.evaluate(c).toUpperCase()],downcase:[vn,[vn],(c,[i])=>i.evaluate(c).toLowerCase()],concat:[vn,Uc(Tn),(c,i)=>i.map(a=>Ca(a.evaluate(c))).join("")],"resolved-locale":[vn,[Hm],(c,[i])=>i.evaluate(c).resolvedLocale()],random:[ir,[ir,ir,Tn],(c,i)=>{const[a,d,p]=i.map(_=>_.evaluate(c));if(a>d||a===d)return a;let y;if(typeof p=="string")y=function(_){let S=0;if(_.length===0)return S;for(let A=0;A<_.length;A++)S=(S<<5)-S+_.charCodeAt(A),S|=0;return S}(p);else{if(typeof p!="number")throw new Bi(`Invalid seed input: ${p}`);y=p}return a+N1(y)()*(d-a)}]});class o0{constructor(i,a,d,p){this.expression=i,this._warningHistory={},this._evaluator=new Kf(d,p),this._defaultValue=a?function(y){return y.type==="color"&&(vg(y.default)||Array.isArray(y.default))?new Sn(0,0,0,0):y.type==="color"?Sn.parse(y.default)||null:y.default===void 0?null:y.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=ig(i)}evaluateWithoutErrorHandling(i,a,d,p,y,_,S,A){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=d,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,d,p,y,_,S,A){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=d||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new Bi(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${C.message}`)),this._defaultValue}}}function s0(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in od}function Wu(c,i,a,d){const p=new sg(od,[],i?function(_){const S={color:Fs,string:vn,number:ir,enum:vn,boolean:xn,formatted:Hf,resolvedImage:Wf};return _.type==="array"?Xo(S[_.value]||Tn,_.length):S[_.type]}(i):void 0,void 0,void 0,a,d),y=p.parse(c,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?r0(new o0(y,i,a,d)):Gc(p.errors)}class xg{constructor(i,a,d,p){this.kind=i,this._styleExpression=a,this.isLightConstant=d,this.isLineProgressConstant=p,this.isStateDependent=i!=="constant"&&!ng(a.expression),this.configDependencies=ig(a.expression)}evaluateWithoutErrorHandling(i,a,d,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,d,p,y,_)}evaluate(i,a,d,p,y,_){return this._styleExpression.evaluate(i,a,d,p,y,_)}}class qc{constructor(i,a,d,p,y,_){this.kind=i,this.zoomStops=d,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!ng(a.expression),this.isLightConstant=y,this.isLineProgressConstant=_,this.configDependencies=ig(a.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,a,d,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,d,p,y,_)}evaluate(i,a,d,p,y,_){return this._styleExpression.evaluate(i,a,d,p,y,_)}interpolationFactor(i,a,d){return this.interpolationType?Is.interpolationFactor(this.interpolationType,i,a,d):0}}function a0(c,i,a,d){if((c=Wu(c,i,a,d)).result==="error")return c;const p=c.value.expression,y=Qh(p);if(!y&&!yg(i))return Gc([new ta("","data expressions not supported")]);const _=ed(p,["zoom","pitch","distance-from-center"]);if(!_&&!$1(i))return Gc([new ta("","zoom expressions not supported")]);const S=ed(p,["measure-light"]);if(!S&&!B1(i))return Gc([new ta("","measure-light expression not supported")]);const A=ed(p,["line-progress"]);if(!A&&!function(D){return Hc(D.expression,"line-progress")}(i))return Gc([new ta("","line-progress expression not supported")]);const C=i.expression&&i.expression.relaxZoomRestriction,R=ip(p);return R||_||C?R instanceof ta?Gc([R]):R instanceof Is&&!_g(i)?Gc([new ta("",'"interpolate" expressions cannot be used with this property')]):r0(R?new qc(y&&A?"camera":"composite",c.value,R.labels,R instanceof Is?R.interpolation:void 0,S,A):new xg(y&&A?"constant":"source",c.value,S,A)):Gc([new ta("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class qu{constructor(i,a){this._parameters=i,this._specification=a,zu(this,n0(this._parameters,this._specification))}static deserialize(i){return new qu(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ip(c){let i=null;if(c instanceof np)i=ip(c.result);else if(c instanceof ug){for(const a of c.args)if(i=ip(a),i)break}else(c instanceof tp||c instanceof Is)&&c.input instanceof wo&&c.input.name==="zoom"&&(i=c);return i instanceof ta||c.eachChild(a=>{const d=ip(a);d instanceof ta?i=d:i&&d&&i!==d&&(i=new ta("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var l0,H1,c0=function(){if(H1)return l0;H1=1,l0=i;var c=3;function i(a,d,p){var y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(d=_[1])+2*(p=_[2]);for(var S=0;S<this.d*this.d;S++){var A=_[c+S],C=_[c+S+1];y.push(A===C?null:_.subarray(A,C))}var R=_[c+y.length+1];this.keys=_.subarray(_[c+y.length],R),this.bboxes=_.subarray(R),this.insert=this._insertReadonly}else{this.d=d+2*p;for(var D=0;D<this.d*this.d;D++)y.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=a,this.padding=p,this.scale=d/a,this.uid=0;var j=p/d*a;this.min=-j,this.max=a+j}return i.prototype.insert=function(a,d,p,y,_){this._forEachCell(d,p,y,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(_)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(a,d,p,y,_,S){this.cells[_].push(S)},i.prototype.query=function(a,d,p,y,_){var S=this.min,A=this.max;if(a<=S&&d<=S&&A<=p&&A<=y&&!_)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(a,d,p,y,this._queryCell,C,{},_),C},i.prototype._queryCell=function(a,d,p,y,_,S,A,C){var R=this.cells[_];if(R!==null)for(var D=this.keys,j=this.bboxes,H=0;H<R.length;H++){var W=R[H];if(A[W]===void 0){var J=4*W;(C?C(j[J+0],j[J+1],j[J+2],j[J+3]):a<=j[J+2]&&d<=j[J+3]&&p>=j[J+0]&&y>=j[J+1])?(A[W]=!0,S.push(D[W])):A[W]=!1}}},i.prototype._forEachCell=function(a,d,p,y,_,S,A,C){for(var R=this._convertToCellCoord(a),D=this._convertToCellCoord(d),j=this._convertToCellCoord(p),H=this._convertToCellCoord(y),W=R;W<=j;W++)for(var J=D;J<=H;J++){var te=this.d*J+W;if((!C||C(this._convertFromCellCoord(W),this._convertFromCellCoord(J),this._convertFromCellCoord(W+1),this._convertFromCellCoord(J+1)))&&_.call(this,a,d,p,y,te,S,A,C))return}},i.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},i.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,d=c+this.cells.length+1+1,p=0,y=0;y<this.cells.length;y++)p+=this.cells[y].length;var _=new Int32Array(d+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var S=d,A=0;A<a.length;A++){var C=a[A];_[c+A]=S,_.set(C,S),S+=C.length}return _[c+a.length]=S,_.set(this.keys,S),_[c+a.length+1]=S+=this.keys.length,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer},l0}(),Zc=Wl(c0);const op={};function Wt(c,i,a={}){Object.defineProperty(c,"_classRegistryKey",{value:i,writable:!1}),op[i]={klass:c,omit:a.omit||[]}}Wt(Object,"Object"),Zc.serialize=function(c,i){const a=c.toArrayBuffer();return i&&i.add(a),{buffer:a}},Zc.deserialize=function(c){return new Zc(c.buffer)},Object.defineProperty(Zc,"name",{value:"Grid"}),Wt(Zc,"Grid"),delete ut.prototype.constructor,typeof DOMMatrix<"u"&&Wt(DOMMatrix,"DOMMatrix"),Wt(Sn,"Color"),Wt(Error,"Error"),Wt(hs,"Formatted"),Wt(qm,"FormattedSection"),Wt(nn,"AJAXError"),Wt(Cs,"ResolvedImage"),Wt(qu,"StylePropertyFunction"),Wt(o0,"StyleExpression",{omit:["_evaluator"]}),Wt(zs,"ImageId"),Wt(Yl,"ImageVariant"),Wt(qc,"ZoomDependentExpression"),Wt(xg,"ZoomConstantExpression"),Wt(wo,"CompoundExpression",{omit:["_evaluate"]});for(const c in od)op[od[c]._classRegistryKey]||Wt(od[c],`Expression${c}`);function bg(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function sp(c){return self.ImageBitmap&&c instanceof ImageBitmap}function Jl(c,i){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(bg(c)||sp(c))return i&&i.add(c),c;if(ArrayBuffer.isView(c))return i&&i.add(c.buffer),c;if(c instanceof ImageData)return i&&i.add(c.data.buffer),c;if(Array.isArray(c)){const a=[];for(const d of c)a.push(Jl(d,i));return a}if(c instanceof Map){const a={$name:"Map",entries:[]};for(const[d,p]of c.entries())a.entries.push(Jl(d),Jl(p,i));return a}if(c instanceof Set){const a={$name:"Set"};let d=0;for(const p of c.values())a[++d]=Jl(p);return a}if(c instanceof DOMMatrix){const a={$name:"DOMMatrix"},d=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const p of d)a[p]=c[p];return a}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const a=c.constructor,d=a._classRegistryKey;if(!d)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const p=a.serialize?a.serialize(c,i):{};if(!a.serialize){for(const y in c)c.hasOwnProperty(y)&&(op[d].omit.indexOf(y)>=0||(p[y]=Jl(c[y],i)));c instanceof Error&&(p.message=c.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(p.$name=d),p}throw new Error("can't serialize object of type "+typeof c)}function Ms(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||bg(c)||sp(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Ms);if(typeof c=="object"){const i=c.$name||"Object";if(i==="Map"){const p=c.entries||[],y=new Map;for(let _=0;_<p.length;_+=2)y.set(Ms(p[_]),Ms(p[_+1]));return y}if(i==="Set"){const p=new Set;for(const y of Object.keys(c))y!=="$name"&&p.add(Ms(c[y]));return p}if(i==="DOMMatrix"){let p;return p=c.is2D?[c.a,c.b,c.c,c.d,c.e,c.f]:[c.m11,c.m12,c.m13,c.m14,c.m21,c.m22,c.m23,c.m24,c.m31,c.m32,c.m33,c.m34,c.m41,c.m42,c.m43,c.m44],new DOMMatrix(p)}if(i==="BigInt")return BigInt(c.value);const{klass:a}=op[i];if(!a)throw new Error(`Can't deserialize unregistered class "${i}".`);if(a.deserialize)return a.deserialize(c);const d=Object.create(a.prototype);for(const p of Object.keys(c))p!=="$name"&&(d[p]=Ms(c[p]));return d}throw new Error("can't deserialize object of type "+typeof c)}const dr={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function u0(c){for(const i of c)if(wg(i.charCodeAt(0)))return!0;return!1}function MC(c){for(const i of c)if(!OC(i.charCodeAt(0)))return!1;return!0}function OC(c){return!(dr.Arabic(c)||dr["Arabic Supplement"](c)||dr["Arabic Extended-A"](c)||dr["Arabic Presentation Forms-A"](c)||dr["Arabic Presentation Forms-B"](c))}function wg(c){return!(c!==746&&c!==747&&(c<4352||!(dr["Bopomofo Extended"](c)||dr.Bopomofo(c)||dr["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||dr["CJK Compatibility Ideographs"](c)||dr["CJK Compatibility"](c)||dr["CJK Radicals Supplement"](c)||dr["CJK Strokes"](c)||!(!dr["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||dr["CJK Unified Ideographs Extension A"](c)||dr["CJK Unified Ideographs"](c)||dr["Enclosed CJK Letters and Months"](c)||dr["Hangul Compatibility Jamo"](c)||dr["Hangul Jamo Extended-A"](c)||dr["Hangul Jamo Extended-B"](c)||dr["Hangul Jamo"](c)||dr["Hangul Syllables"](c)||dr.Hiragana(c)||dr["Ideographic Description Characters"](c)||dr.Kanbun(c)||dr["Kangxi Radicals"](c)||dr["Katakana Phonetic Extensions"](c)||dr.Katakana(c)&&c!==12540||!(!dr["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!dr["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||dr["Unified Canadian Aboriginal Syllabics"](c)||dr["Unified Canadian Aboriginal Syllabics Extended"](c)||dr["Vertical Forms"](c)||dr["Yijing Hexagram Symbols"](c)||dr["Yi Syllables"](c)||dr["Yi Radicals"](c))))}function Sg(c){return!(wg(c)||function(i){return!!(dr["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||dr["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||dr["Letterlike Symbols"](i)||dr["Number Forms"](i)||dr["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||dr["Control Pictures"](i)&&i!==9251||dr["Optical Character Recognition"](i)||dr["Enclosed Alphanumerics"](i)||dr["Geometric Shapes"](i)||dr["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||dr["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||dr["CJK Symbols and Punctuation"](i)||dr.Katakana(i)||dr["Private Use Area"](i)||dr["CJK Compatibility Forms"](i)||dr["Small Form Variants"](i)||dr["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(c))}function W1(c){return dr.Arabic(c)||dr["Arabic Supplement"](c)||dr["Arabic Extended-A"](c)||dr["Arabic Presentation Forms-A"](c)||dr["Arabic Presentation Forms-B"](c)}function Tg(c){return c>=1424&&c<=2303||dr["Arabic Presentation Forms-A"](c)||dr["Arabic Presentation Forms-B"](c)}function kC(c,i){return!(!i&&Tg(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||dr.Khmer(c))}function RC(c){for(const i of c)if(Tg(i.charCodeAt(0)))return!0;return!1}const Bs={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let h0=null,fs=Bs.unavailable,Xc=null;const q1=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(fs=Bs.error),h0&&h0(c)};function d0(){f0.fire(new Xl("pluginStateChange",{pluginStatus:fs,pluginURL:Xc}))}const f0=new Nu,p0=function(){return fs},Z1=function(){if(fs!==Bs.deferred||!Xc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fs=Bs.loading,d0(),Xc&&Ff({url:Xc},c=>{c?q1(c):(fs=Bs.loaded,d0())})},_l={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fs===Bs.loaded||_l.applyArabicShaping!=null,isLoading:()=>fs===Bs.loading,setState(c){fs=c.pluginStatus,Xc=c.pluginURL},isParsing:()=>fs===Bs.parsing,isParsed:()=>fs===Bs.parsed,getPluginURL:()=>Xc};class Rn{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(a,d){for(const p of a)if(!kC(p.charCodeAt(0),d))return!1;return!0}(i,_l.isLoaded())}}class ap{constructor(i,a,d,p){this.property=i,this.value=a,this.expression=function(y,_,S,A){if(vg(y))return new qu(y,_);if(s0(y)||Array.isArray(y)&&y.length>0){const C=a0(y,_,S,A);if(C.result==="error")throw new Error(C.value.map(R=>`${R.key}: ${R.message}`).join(", "));return C.value}{let C=y;return typeof y=="string"&&_.type==="color"&&(C=Sn.parse(y)),{kind:"constant",configDependencies:new Set,evaluate:()=>C}}}(a===void 0?i.specification.default:a,i.specification,d,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,a,d){return this.property.possiblyEvaluate(this,i,a,d)}}class Eg{constructor(i,a,d){this.property=i,this.value=new ap(i,void 0,a,d)}transitioned(i,a){return new X1(this.property,this.value,a,et({},i.transition,this.transition),i.now)}untransitioned(){return new X1(this.property,this.value,null,{},0)}}class lp{constructor(i,a,d){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(i){return Nr(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Eg(this._values[i].property,this._scope,this._options)),this._values[i].value=new ap(this._values[i].property,a===null?void 0:Nr(a),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,a){a&&(this._options=a);const d=this._properties.properties;if(i)for(const p in i){const y=i[p];if(p.endsWith("-transition")){const _=p.slice(0,-11);d[_]&&this.setTransition(_,y)}else d.hasOwnProperty(p)&&this.setValue(p,y)}}getTransition(i){return Nr(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Eg(this._values[i].property)),this._values[i].transition=Nr(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(i[a]=d);const p=this.getTransition(a);p!==void 0&&(i[`${a}-transition`]=p)}return i}transitioned(i,a){const d=new K1(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].transitioned(i,a._values[p]);return d}untransitioned(){const i=new K1(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class X1{constructor(i,a,d,p,y){const _=p.delay||0,S=p.duration||0;y=y||0,this.property=i,this.value=a,this.begin=y+_,this.end=this.begin+S,i.specification.transition&&(p.delay||p.duration)&&(this.prior=d)}possiblyEvaluate(i,a,d){const p=i.now||0,y=this.value.possiblyEvaluate(i,a,d),_=this.prior;if(_){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return _.possiblyEvaluate(i,a,d);{const S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(i,a,d),y,ce(S))}}return y}}class K1{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,d){const p=new tl(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(i,a,d);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Kc{constructor(i,a,d){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(i){return Nr(this._values[i].value)}setValue(i,a){this._values[i]=new ap(this._values[i].property,a===null?void 0:Nr(a),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(i[a]=d)}return i}possiblyEvaluate(i,a,d){const p=new tl(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(i,a,d);return p}}class Zu{constructor(i,a,d){this.property=i,this.value=a,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,a,d,p){return this.property.evaluate(this.value,this.parameters,i,a,d,p)}}class tl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Mt{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,d){const p=Gf[this.specification.type];return p?p(i,a,d):i}}class Bt{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,d,p){return new Zu(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(a,null,{},d,p)}:i.expression,a)}interpolate(i,a,d){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new Zu(this,{kind:"constant",value:void 0},i.parameters);const p=Gf[this.specification.type];return p?new Zu(this,{kind:"constant",value:p(i.value.value,a.value.value,d)},i.parameters):i}evaluate(i,a,d,p,y,_){return i.kind==="constant"?i.value:i.evaluate(a,d,p,y,_)}}class sd{constructor(i){this.specification=i}possiblyEvaluate(i,a,d,p){return!!i.expression.evaluate(a,null,{},d,p)}interpolate(){return!1}}class xi{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new Rn(0,{});for(const d in i){const p=i[d];p.specification.overridable&&this.overridableProperties.push(d);const y=this.defaultPropertyValues[d]=new ap(p,void 0),_=this.defaultTransitionablePropertyValues[d]=new Eg(p);this.defaultTransitioningPropertyValues[d]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=y.possiblyEvaluate(a)}}}Wt(Bt,"DataDrivenProperty"),Wt(Mt,"DataConstantProperty"),Wt(sd,"ColorRampProperty");var Ve=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Y1(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function cp(c){if(Array.isArray(c))return c.map(cp);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const i={};for(const a in c)i[a]=cp(c[a]);return i}return Y1(c)}function up(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const i of c.slice(1))if(!up(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function ad(c,i="",a=null,d="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};up(c)||(c=Pg(c));const p=c;let y=!0;try{y=function(R){if(!ld(R))return R;let D=cp(R);return Ag(D),D=m0(D),D}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let _=null,S=null;if(d!=="background"&&d!=="sky"&&d!=="slot"){S=Ve[`filter_${d}`];const R=Wu(y,S,i,a);if(R.result==="error")throw new Error(R.value.map(D=>`${D.key}: ${D.message}`).join(", "));_=(D,j,H)=>R.value.evaluate(D,j,{},H)}let A=null,C=null;if(y!==p){const R=Wu(p,S,i,a);if(R.result==="error")throw new Error(R.value.map(D=>`${D.key}: ${D.message}`).join(", "));A=(D,j,H,W,J)=>R.value.evaluate(D,j,{},H,void 0,void 0,W,J),C=!Qh(R.value.expression)}return{filter:_,dynamicFilter:A||void 0,needGeometry:g0(y),needFeature:!!C}}function m0(c){if(!Array.isArray(c))return c;const i=function(a){if(vl.has(a[0])){for(let d=1;d<a.length;d++)if(ld(a[d]))return!0}return a}(c);return i===!0?i:i.map(a=>m0(a))}function Ag(c){let i=!1;const a=[];if(c[0]==="case"){for(let d=1;d<c.length-1;d+=2)i=i||ld(c[d]),a.push(c[d+1]);a.push(c[c.length-1])}else if(c[0]==="match"){i=i||ld(c[1]);for(let d=2;d<c.length-1;d+=2)a.push(c[d+1]);a.push(c[c.length-1])}else if(c[0]==="step"){i=i||ld(c[1]);for(let d=1;d<c.length-1;d+=2)a.push(c[d+1])}i&&(c.length=0,c.push("any",...a));for(let d=1;d<c.length;d++)Ag(c[d])}function ld(c){if(!Array.isArray(c))return!1;if((i=c[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let a=1;a<c.length;a++)if(ld(c[a]))return!0;return!1}const vl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function DC(c,i){return c<i?-1:c>i?1:0}function g0(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let i=1;i<c.length;i++)if(g0(c[i]))return!0;return!1}function Pg(c){if(!c)return!0;const i=c[0];return c.length<=1?i!=="any":i==="=="?y0(c[1],c[2],"=="):i==="!="?Cg(y0(c[1],c[2],"==")):i==="<"||i===">"||i==="<="||i===">="?y0(c[1],c[2],i):i==="any"?(a=c.slice(1),["any"].concat(a.map(Pg))):i==="all"?["all"].concat(c.slice(1).map(Pg)):i==="none"?["all"].concat(c.slice(1).map(Pg).map(Cg)):i==="in"?J1(c[1],c.slice(2)):i==="!in"?Cg(J1(c[1],c.slice(2))):i==="has"?Q1(c[1]):i!=="!has"||Cg(Q1(c[1]));var a}function y0(c,i,a){switch(c){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,c,i]}}function J1(c,i){if(i.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",c,["literal",i.sort(DC)]]:["filter-in-small",c,["literal",i]]}}function Q1(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Cg(c){return["!",c]}const hp="";function cd(c,i){return i?`${c}${hp}${i}`:c}const eS="-transition",LC=new Set(["fill","line","background","hillshade","raster"]);class Yo extends Nu{constructor(i,a,d,p,y){if(super(),this.id=i.id,this.fqid=cd(this.id,d),this.type=i.type,this.scope=d,this.lut=p,this.options=y,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const _=Wu(this.filter,Ve[`filter_${i.type}`]);_.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,..._.value.configDependencies]))}if(i.slot&&(this.slot=i.slot),a.layout&&(this._unevaluatedLayout=new Kc(a.layout,this.scope,y),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new lp(a.paint,this.scope,y);for(const _ in i.paint)this.setPaintProperty(_,i.paint[_]);for(const _ in i.layout)this.setLayoutProperty(_,i.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tl(a.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&LC.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a){if(this.type==="custom"&&i==="visibility")return void(this.visibility=a);const d=this._unevaluatedLayout;d._properties.properties[i]&&(d.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),i==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(eS)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a){const d=this._transitionablePaint,p=d._properties.properties;if(i.endsWith(eS)){const D=i.slice(0,-11);return p[D]&&d.setTransition(D,a||void 0),!1}if(!p[i])return!1;const y=d._values[i],_=y.value.isDataDriven(),S=y.value;d.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const A=d._values[i].value,C=A.isDataDriven(),R=i.endsWith("pattern")||i==="line-dasharray";return C||_||R||this._handleOverridablePaintPropertyUpdate(i,S,A)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,a,d){return null}_handleOverridablePaintPropertyUpdate(i,a,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){return Gr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof Zu&&yg(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=ad(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,a,d,p,y,_,S,A,C){}}const jC={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dp{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ei{constructor(){this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&a.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qr(c,i=1){let a=0,d=0;return{members:c.map(p=>{const y=jC[p.type].BYTES_PER_ELEMENT,_=a=_0(a,Math.max(i,y)),S=p.components||1;return d=Math.max(d,y),a+=y*S,{name:p.name,type:p.type,components:S,offset:_}}),size:_0(a,Math.max(d,i)),alignment:i}}function _0(c,i){return Math.ceil(c/i)*i}class Os extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const d=this.length;return this.resize(d+1),this.emplace(d,i,a)}emplace(i,a,d){const p=2*i;return this.int16[p+0]=a,this.int16[p+1]=d,i}}Os.prototype.bytesPerElement=4,Wt(Os,"StructArrayLayout2i4");class ud extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=3*i;return this.int16[y+0]=a,this.int16[y+1]=d,this.int16[y+2]=p,i}}ud.prototype.bytesPerElement=6,Wt(ud,"StructArrayLayout3i6");class hd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,p)}emplace(i,a,d,p,y){const _=4*i;return this.int16[_+0]=a,this.int16[_+1]=d,this.int16[_+2]=p,this.int16[_+3]=y,i}}hd.prototype.bytesPerElement=8,Wt(hd,"StructArrayLayout4i8");class Xu extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}Xu.prototype.bytesPerElement=4,Wt(Xu,"StructArrayLayout1f4");class v0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=4*i,_=2*i;return this.int16[y+0]=a,this.int16[y+1]=d,this.float32[_+1]=p,i}}v0.prototype.bytesPerElement=8,Wt(v0,"StructArrayLayout2i1f8");class x0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=4*i;return this.int16[y+0]=a,this.int16[y+1]=d,this.int16[y+2]=p,i}}x0.prototype.bytesPerElement=8,Wt(x0,"StructArrayLayout3i8");class Ig extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,p,y)}emplace(i,a,d,p,y,_){const S=5*i;return this.int16[S+0]=a,this.int16[S+1]=d,this.int16[S+2]=p,this.int16[S+3]=y,this.int16[S+4]=_,i}}Ig.prototype.bytesPerElement=10,Wt(Ig,"StructArrayLayout5i10");class Mg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,d,p,y,_,S)}emplace(i,a,d,p,y,_,S,A){const C=6*i,R=12*i,D=3*i;return this.int16[C+0]=a,this.int16[C+1]=d,this.uint8[R+4]=p,this.uint8[R+5]=y,this.uint8[R+6]=_,this.uint8[R+7]=S,this.float32[D+2]=A,i}}Mg.prototype.bytesPerElement=12,Wt(Mg,"StructArrayLayout2i4ub1f12");class na extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=3*i;return this.float32[y+0]=a,this.float32[y+1]=d,this.float32[y+2]=p,i}}na.prototype.bytesPerElement=12,Wt(na,"StructArrayLayout3f12");class Yc extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,p,y)}emplace(i,a,d,p,y,_){const S=6*i,A=3*i;return this.uint16[S+0]=a,this.uint16[S+1]=d,this.uint16[S+2]=p,this.uint16[S+3]=y,this.float32[A+2]=_,i}}Yc.prototype.bytesPerElement=12,Wt(Yc,"StructArrayLayout4ui1f12");class dd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,p)}emplace(i,a,d,p,y){const _=4*i;return this.uint16[_+0]=a,this.uint16[_+1]=d,this.uint16[_+2]=p,this.uint16[_+3]=y,i}}dd.prototype.bytesPerElement=8,Wt(dd,"StructArrayLayout4ui8");class Og extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,d,p,y,_)}emplace(i,a,d,p,y,_,S){const A=6*i;return this.int16[A+0]=a,this.int16[A+1]=d,this.int16[A+2]=p,this.int16[A+3]=y,this.int16[A+4]=_,this.int16[A+5]=S,i}}Og.prototype.bytesPerElement=12,Wt(Og,"StructArrayLayout6i12");class kg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S,A,C,R,D,j){const H=this.length;return this.resize(H+1),this.emplace(H,i,a,d,p,y,_,S,A,C,R,D,j)}emplace(i,a,d,p,y,_,S,A,C,R,D,j,H){const W=12*i;return this.int16[W+0]=a,this.int16[W+1]=d,this.int16[W+2]=p,this.int16[W+3]=y,this.uint16[W+4]=_,this.uint16[W+5]=S,this.uint16[W+6]=A,this.uint16[W+7]=C,this.int16[W+8]=R,this.int16[W+9]=D,this.int16[W+10]=j,this.int16[W+11]=H,i}}kg.prototype.bytesPerElement=24,Wt(kg,"StructArrayLayout4i4ui4i24");class fd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,d,p,y,_)}emplace(i,a,d,p,y,_,S){const A=10*i,C=5*i;return this.int16[A+0]=a,this.int16[A+1]=d,this.int16[A+2]=p,this.float32[C+2]=y,this.float32[C+3]=_,this.float32[C+4]=S,i}}fd.prototype.bytesPerElement=20,Wt(fd,"StructArrayLayout3i3f20");class Jc extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,p)}emplace(i,a,d,p,y){const _=4*i;return this.float32[_+0]=a,this.float32[_+1]=d,this.float32[_+2]=p,this.float32[_+3]=y,i}}Jc.prototype.bytesPerElement=16,Wt(Jc,"StructArrayLayout4f16");class b0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}b0.prototype.bytesPerElement=4,Wt(b0,"StructArrayLayout1ul4");class xl extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const d=this.length;return this.resize(d+1),this.emplace(d,i,a)}emplace(i,a,d){const p=2*i;return this.uint16[p+0]=a,this.uint16[p+1]=d,i}}xl.prototype.bytesPerElement=4,Wt(xl,"StructArrayLayout2ui4");class w0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S,A,C,R,D,j,H){const W=this.length;return this.resize(W+1),this.emplace(W,i,a,d,p,y,_,S,A,C,R,D,j,H)}emplace(i,a,d,p,y,_,S,A,C,R,D,j,H,W){const J=20*i,te=10*i;return this.int16[J+0]=a,this.int16[J+1]=d,this.int16[J+2]=p,this.int16[J+3]=y,this.int16[J+4]=_,this.float32[te+3]=S,this.float32[te+4]=A,this.float32[te+5]=C,this.float32[te+6]=R,this.int16[J+14]=D,this.uint32[te+8]=j,this.uint16[J+18]=H,this.uint16[J+19]=W,i}}w0.prototype.bytesPerElement=40,Wt(w0,"StructArrayLayout5i4f1i1ul2ui40");class Rg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,d,p,y,_,S)}emplace(i,a,d,p,y,_,S,A){const C=8*i;return this.int16[C+0]=a,this.int16[C+1]=d,this.int16[C+2]=p,this.int16[C+4]=y,this.int16[C+5]=_,this.int16[C+6]=S,this.int16[C+7]=A,i}}Rg.prototype.bytesPerElement=16,Wt(Rg,"StructArrayLayout3i2i2i16");class pd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,p,y)}emplace(i,a,d,p,y,_){const S=4*i,A=8*i;return this.float32[S+0]=a,this.float32[S+1]=d,this.float32[S+2]=p,this.int16[A+6]=y,this.int16[A+7]=_,i}}pd.prototype.bytesPerElement=16,Wt(pd,"StructArrayLayout2f1f2i16");class md extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,d,p,y,_)}emplace(i,a,d,p,y,_,S){const A=20*i,C=5*i;return this.uint8[A+0]=a,this.uint8[A+1]=d,this.float32[C+1]=p,this.float32[C+2]=y,this.float32[C+3]=_,this.float32[C+4]=S,i}}md.prototype.bytesPerElement=20,Wt(md,"StructArrayLayout2ub4f20");class ii extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=3*i;return this.uint16[y+0]=a,this.uint16[y+1]=d,this.uint16[y+2]=p,i}}ii.prototype.bytesPerElement=6,Wt(ii,"StructArrayLayout3ui6");class gd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te,ae,de,he,me,ke){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te,ae,de,he,me,ke)}emplace(i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te,ae,de,he,me,ke,Ee){const Pe=30*i,Ne=15*i,Be=60*i;return this.int16[Pe+0]=a,this.int16[Pe+1]=d,this.int16[Pe+2]=p,this.float32[Ne+2]=y,this.float32[Ne+3]=_,this.uint16[Pe+8]=S,this.uint16[Pe+9]=A,this.uint32[Ne+5]=C,this.uint32[Ne+6]=R,this.uint32[Ne+7]=D,this.uint16[Pe+16]=j,this.uint16[Pe+17]=H,this.uint16[Pe+18]=W,this.float32[Ne+10]=J,this.float32[Ne+11]=te,this.uint8[Be+48]=ae,this.uint8[Be+49]=de,this.uint8[Be+50]=he,this.uint32[Ne+13]=me,this.int16[Pe+28]=ke,this.uint8[Be+58]=Ee,i}}gd.prototype.bytesPerElement=60,Wt(gd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class S0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te,ae,de,he,me,ke,Ee,Pe,Ne,Be,ct,Ue,dt,Ct,mt,wt,At,at){const St=this.length;return this.resize(St+1),this.emplace(St,i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te,ae,de,he,me,ke,Ee,Pe,Ne,Be,ct,Ue,dt,Ct,mt,wt,At,at)}emplace(i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te,ae,de,he,me,ke,Ee,Pe,Ne,Be,ct,Ue,dt,Ct,mt,wt,At,at,St){const He=20*i,lt=40*i,kt=80*i;return this.float32[He+0]=a,this.float32[He+1]=d,this.int16[lt+4]=p,this.int16[lt+5]=y,this.int16[lt+6]=_,this.int16[lt+7]=S,this.int16[lt+8]=A,this.int16[lt+9]=C,this.int16[lt+10]=R,this.int16[lt+11]=D,this.int16[lt+12]=j,this.uint16[lt+13]=H,this.uint16[lt+14]=W,this.uint16[lt+15]=J,this.uint16[lt+16]=te,this.uint16[lt+17]=ae,this.uint16[lt+18]=de,this.uint16[lt+19]=he,this.uint16[lt+20]=me,this.uint16[lt+21]=ke,this.uint16[lt+22]=Ee,this.uint16[lt+23]=Pe,this.uint16[lt+24]=Ne,this.uint16[lt+25]=Be,this.uint16[lt+26]=ct,this.uint16[lt+27]=Ue,this.uint32[He+14]=dt,this.float32[He+15]=Ct,this.float32[He+16]=mt,this.float32[He+17]=wt,this.float32[He+18]=At,this.uint8[kt+76]=at,this.uint16[lt+39]=St,i}}S0.prototype.bytesPerElement=80,Wt(S0,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class T0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,d,p,y,_)}emplace(i,a,d,p,y,_,S){const A=6*i;return this.float32[A+0]=a,this.float32[A+1]=d,this.float32[A+2]=p,this.float32[A+3]=y,this.float32[A+4]=_,this.float32[A+5]=S,i}}T0.prototype.bytesPerElement=24,Wt(T0,"StructArrayLayout6f24");class Ku extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,p,y)}emplace(i,a,d,p,y,_){const S=5*i;return this.float32[S+0]=a,this.float32[S+1]=d,this.float32[S+2]=p,this.float32[S+3]=y,this.float32[S+4]=_,i}}Ku.prototype.bytesPerElement=20,Wt(Ku,"StructArrayLayout5f20");class E0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,d,p,y,_,S)}emplace(i,a,d,p,y,_,S,A){const C=7*i;return this.float32[C+0]=a,this.float32[C+1]=d,this.float32[C+2]=p,this.float32[C+3]=y,this.float32[C+4]=_,this.float32[C+5]=S,this.float32[C+6]=A,i}}E0.prototype.bytesPerElement=28,Wt(E0,"StructArrayLayout7f28");class fp extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S,A,C,R,D){const j=this.length;return this.resize(j+1),this.emplace(j,i,a,d,p,y,_,S,A,C,R,D)}emplace(i,a,d,p,y,_,S,A,C,R,D,j){const H=11*i;return this.float32[H+0]=a,this.float32[H+1]=d,this.float32[H+2]=p,this.float32[H+3]=y,this.float32[H+4]=_,this.float32[H+5]=S,this.float32[H+6]=A,this.float32[H+7]=C,this.float32[H+8]=R,this.float32[H+9]=D,this.float32[H+10]=j,i}}fp.prototype.bytesPerElement=44,Wt(fp,"StructArrayLayout11f44");class A0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S,A,C){const R=this.length;return this.resize(R+1),this.emplace(R,i,a,d,p,y,_,S,A,C)}emplace(i,a,d,p,y,_,S,A,C,R){const D=9*i;return this.float32[D+0]=a,this.float32[D+1]=d,this.float32[D+2]=p,this.float32[D+3]=y,this.float32[D+4]=_,this.float32[D+5]=S,this.float32[D+6]=A,this.float32[D+7]=C,this.float32[D+8]=R,i}}A0.prototype.bytesPerElement=36,Wt(A0,"StructArrayLayout9f36");class Qc extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const d=this.length;return this.resize(d+1),this.emplace(d,i,a)}emplace(i,a,d){const p=2*i;return this.float32[p+0]=a,this.float32[p+1]=d,i}}Qc.prototype.bytesPerElement=8,Wt(Qc,"StructArrayLayout2f8");class P0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,p)}emplace(i,a,d,p,y){const _=6*i;return this.uint32[3*i+0]=a,this.uint16[_+2]=d,this.uint16[_+3]=p,this.uint16[_+4]=y,i}}P0.prototype.bytesPerElement=12,Wt(P0,"StructArrayLayout1ul3ui12");class C0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}C0.prototype.bytesPerElement=2,Wt(C0,"StructArrayLayout1ui2");class Dg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te){const ae=this.length;return this.resize(ae+1),this.emplace(ae,i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te)}emplace(i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te,ae){const de=16*i;return this.float32[de+0]=a,this.float32[de+1]=d,this.float32[de+2]=p,this.float32[de+3]=y,this.float32[de+4]=_,this.float32[de+5]=S,this.float32[de+6]=A,this.float32[de+7]=C,this.float32[de+8]=R,this.float32[de+9]=D,this.float32[de+10]=j,this.float32[de+11]=H,this.float32[de+12]=W,this.float32[de+13]=J,this.float32[de+14]=te,this.float32[de+15]=ae,i}}Dg.prototype.bytesPerElement=64,Wt(Dg,"StructArrayLayout16f64");class yd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,a,d,p,y,_,S)}emplace(i,a,d,p,y,_,S,A){const C=10*i,R=5*i;return this.uint16[C+0]=a,this.uint16[C+1]=d,this.uint16[C+2]=p,this.uint16[C+3]=y,this.float32[R+2]=_,this.float32[R+3]=S,this.float32[R+4]=A,i}}yd.prototype.bytesPerElement=20,Wt(yd,"StructArrayLayout4ui3f20");class I0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.int16[1*i+0]=a,i}}I0.prototype.bytesPerElement=2,Wt(I0,"StructArrayLayout1i2");class Lg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint8[1*i+0]=a,i}}Lg.prototype.bytesPerElement=1,Wt(Lg,"StructArrayLayout1ub1");class M0 extends dp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}M0.prototype.size=40;class tS extends w0{get(i){return new M0(this,i)}}Wt(tS,"CollisionBoxArray");class jg extends dp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}jg.prototype.size=60;class pp extends gd{get(i){return new jg(this,i)}}Wt(pp,"PlacedSymbolArray");class O0 extends dp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}O0.prototype.size=80;class rS extends S0{get(i){return new O0(this,i)}}Wt(rS,"SymbolInstanceArray");class k0 extends Xu{getoffsetX(i){return this.float32[1*i+0]}}Wt(k0,"GlyphOffsetArray");class nS extends Os{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Wt(nS,"SymbolLineVertexArray");class Ng extends dp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ng.prototype.size=12;class iS extends P0{get(i){return new Ng(this,i)}}Wt(iS,"FeatureIndexArray");class oS extends xl{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Wt(oS,"FillExtrusionCentroidArray");class sS extends dp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}sS.prototype.size=6;class aS extends ud{get(i){return new sS(this,i)}}Wt(aS,"FillExtrusionWallArray");const lS=Qr([{name:"a_pos",components:2,type:"Int16"}],4),NC=Qr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),zC=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ci{constructor(i=[]){this.segments=i}_prepareSegment(i,a,d,p){let y=this.segments[this.segments.length-1];return i>ci.MAX_VERTEX_ARRAY_LENGTH&&qr(`Max vertices per segment is ${ci.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!y||y.vertexLength+i>ci.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:a,primitiveOffset:d,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}prepareSegment(i,a,d,p){return this._prepareSegment(i,a.length,d.length,p)}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,d,p){return new ci([{vertexOffset:i,primitiveOffset:a,vertexLength:d,primitiveLength:p,vaos:{},sortKey:0}])}}function cS(c,i){return 256*(c=xe(Math.floor(c),0,255))+xe(Math.floor(i),0,255)}ci.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wt(ci,"SegmentVector");const FC=Qr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),R0=Qr([{name:"a_pattern_b",components:4,type:"Uint16"}]),BC=Qr([{name:"a_dash",components:4,type:"Uint16"}]);class mp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,a,d,p){this.ids.push(gp(i)),this.positions.push(a,d,p)}eachPosition(i,a){const d=gp(i);let p=0,y=this.ids.length-1;for(;p<y;){const _=p+y>>1;this.ids[_]>=d?y=_:p=_+1}for(;this.ids[p]===d;)a(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(i,a){const d=new Float64Array(i.ids),p=new Uint32Array(i.positions);return D0(d,p,0,d.length-1),a&&(a.add(d.buffer),a.add(p.buffer)),{ids:d,positions:p}}static deserialize(i){const a=new mp;let d;a.ids=i.ids,a.positions=i.positions;for(const p of a.ids)p!==d&&a.uniqueIds.push(p),d=p;return a.indexed=!0,a}}function gp(c){const i=+c;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:Uh(String(c))}function D0(c,i,a,d){for(;a<d;){const p=c[a+d>>1];let y=a-1,_=d+1;for(;;){do y++;while(c[y]<p);do _--;while(c[_]>p);if(y>=_)break;zg(c,y,_),zg(i,3*y,3*_),zg(i,3*y+1,3*_+1),zg(i,3*y+2,3*_+2)}_-a<d-_?(D0(c,i,a,_),a=_+1):(D0(c,i,_+1,d),d=_)}}function zg(c,i,a){const d=c[i];c[i]=c[a],c[a]=d}Wt(mp,"FeaturePositionMap");class ka{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}set(i,a,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Fg extends ka{constructor(i){super(i),this.current=0}set(i,a,d){this.fetchUniformLocation(i,a)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class Ri extends ka{constructor(i){super(i),this.current=0}set(i,a,d){this.fetchUniformLocation(i,a)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class bl extends ka{constructor(i){super(i),this.current=[0,0]}set(i,a,d){this.fetchUniformLocation(i,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class _d extends ka{constructor(i){super(i),this.current=[0,0,0]}set(i,a,d){this.fetchUniformLocation(i,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class yp extends ka{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,d){this.fetchUniformLocation(i,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class L0 extends ka{constructor(i){super(i),this.current=Sn.transparent.toPremultipliedRenderColor(null)}set(i,a,d){this.fetchUniformLocation(i,a)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const uS=new Float32Array(16);class _p extends ka{constructor(i){super(i),this.current=uS}set(i,a,d){if(this.fetchUniformLocation(i,a)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let p=1;p<16;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const $C=new Float32Array(9),hS=new Float32Array(4);class j0 extends ka{constructor(i){super(i),this.current=hS}set(i,a,d){if(this.fetchUniformLocation(i,a)){for(let p=0;p<4;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function N0(c){return[cS(255*c.r,255*c.g),cS(255*c.b,255*c.a)]}class vp{constructor(i,a,d,p){this.value=i,this.uniformNames=a.map(y=>`u_${y}`),this.type=d,this.context=p}setUniform(i,a,d,p,y){const _=p.constantOr(this.value);a.set(i,y,_ instanceof Sn?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(i,a){return this.type==="color"?new L0(i):new Ri(i)}}class vd{constructor(i,a){this.uniformNames=a.map(d=>`u_${d}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,a){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(i,a,d,p,y){let _=null;y!=="u_pattern"&&y!=="u_dash"||(_=this.pattern),y==="u_pattern_b"&&(_=this.patternTransition),y==="u_pixel_ratio"&&(_=this.pixelRatio),_&&a.set(i,y,_)}getBinding(i,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new yp(i):new Ri(i)}}class Ql{constructor(i,a,d,p){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=a.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(i,a,d,p,y,_,S,A){const C=this.paintVertexArray.length,R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Rn(0,{brightness:_,worldview:A}),a,{},y,p,S):this.expression.kind==="constant"&&this.expression.value,D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Rn(0,{brightness:_,worldview:A}),a,{},y,p,S):this.lutExpression.value)==="none";this.paintVertexArray.resize(i),this._setPaintValue(C,i,R,D?null:this.context.lut)}updatePaintArray(i,a,d,p,y,_,S,A){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:S,worldview:A},d,p,void 0,y):this.expression.kind==="constant"&&this.expression.value,R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Rn(0,{brightness:S,worldview:A}),d,p,void 0,y):this.lutExpression.value)==="none";this._setPaintValue(i,a,C,R?null:this.context.lut)}_setPaintValue(i,a,d,p){if(this.type==="color"){const y=N0(d.toPremultipliedRenderColor(p));for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,y[0],y[1])}else{for(let y=i;y<a;y++)this.paintVertexArray.emplace(y,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ra{constructor(i,a,d,p,y,_){this.expression=i,this.uniformNames=a.map(S=>`u_${S}_t`),this.type=d,this.useIntegerZoom=p,this.context=y,this.maxValue=0,this.paintVertexAttributes=a.map(S=>({name:`a_${S}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(i,a,d,p,y,_,S,A){const C=this.expression.evaluate(new Rn(this.context.zoom,{brightness:_,worldview:A}),a,{},y,p,S),R=this.expression.evaluate(new Rn(this.context.zoom+1,{brightness:_,worldview:A}),a,{},y,p,S),D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Rn(0,{brightness:_,worldview:A}),a,{},y,p,S):this.lutExpression.value)==="none",j=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(j,i,C,R,D?null:this.context.lut)}updatePaintArray(i,a,d,p,y,_,S,A){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:S,worldview:A},d,p,void 0,y),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S,worldview:A},d,p,void 0,y),D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Rn(0,{brightness:S,worldview:A}),d,p,void 0,y):this.lutExpression.value)==="none";this._setPaintValue(i,a,C,R,D?null:this.context.lut)}_setPaintValue(i,a,d,p,y){if(this.type==="color"){const _=N0(d.toPremultipliedRenderColor(y)),S=N0(d.toPremultipliedRenderColor(y));for(let A=i;A<a;A++)this.paintVertexArray.emplace(A,_[0],_[1],S[0],S[1])}else{for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,d,p);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,d,p,y){const _=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,S=xe(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);a.set(i,y,S)}getBinding(i,a){return new Ri(i)}}class ia{constructor(i,a,d,p,y){this.expression=i,this.layerId=y,this.paintVertexAttributes=(d==="array"?BC:FC).members;for(let _=0;_<a.length;++_);this.paintVertexArray=new p,this.paintTransitionVertexArray=new dd}populatePaintArray(i,a,d,p){const y=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(y,i,a.patterns&&a.patterns[this.layerId],d)}updatePaintArray(i,a,d,p,y,_,S){this._setPaintValues(i,a,d.patterns&&d.patterns[this.layerId],_)}_setPaintValues(i,a,d,p){if(!p||!d)return;const y=p[d[0]],_=p[d[1]];if(y){if(y){const{tl:S,br:A,pixelRatio:C}=y;for(let R=i;R<a;R++)this.paintVertexArray.emplace(R,S[0],S[1],A[0],A[1],C)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:S,br:A}=_;for(let C=i;C<a;C++)this.paintTransitionVertexArray.emplace(C,S[0],S[1],A[0],A[1])}}}upload(i){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,R0.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class ps{constructor(i,a,d=()=>!0){this.binders={},this._buffers=[],this.context=a;const p=[];for(const y in i.paint._values){const _=i.paint.get(y);if(y.endsWith("-use-theme")||!d(y)||!(_ instanceof Zu&&yg(_.property.specification)))continue;const S=UC(y,i.type),A=_.value,C=_.property.specification.type,R=!!_.property.useIntegerZoom,D=y==="line-dasharray"||y.endsWith("pattern"),j=i.paint.get(`${y}-use-theme`),H=y==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||j&&j.value.kind!=="constant";if(A.kind!=="constant"||H)if(A.kind==="source"||H||D){const W=dS(y,C,"source");this.binders[y]=D?new ia(A,S,C,W,i.id):new Ql(A,S,C,W),p.push(`/a_${y}`)}else{const W=dS(y,C,"composite");this.binders[y]=new Ra(A,S,C,R,a,W),p.push(`/z_${y}`)}else this.binders[y]=D?new vd(A.value,S):new vp(A.value,S,C,a),p.push(`/u_${y}`);j&&(this.binders[y].lutExpression=j.value)}this.cacheKey=p.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof Ql||a instanceof Ra?a.maxValue:0}populatePaintArrays(i,a,d,p,y,_,S,A){for(const C in this.binders){const R=this.binders[C];R.context=this.context,(R instanceof Ql||R instanceof Ra||R instanceof ia)&&R.populatePaintArray(i,a,d,p,y,_,S,A)}}setConstantPatternPositions(i,a){for(const d in this.binders){const p=this.binders[d];p instanceof vd&&p.setConstantPatternPositions(i,a)}}getPatternTransitionVertexBuffer(i){const a=this.binders[i];return a instanceof ia?a.paintTransitionVertexBuffer:null}updatePaintArrays(i,a,d,p,y,_,S,A,C,R){let D=!1;const j=Object.keys(i),H=j.length!==0&&!A,W=H?j:a.uniqueIds;this.context.lut=y.lut;for(const J in this.binders){const te=this.binders[J];if(te.context=this.context,(te instanceof Ql||te instanceof Ra||te instanceof ia)&&te.expression&&te.expression.kind&&te.expression.kind!=="constant"&&(te.expression.isStateDependent===!0||te.expression.isLightConstant===!1)){const ae=y.paint.get(J);te.expression=ae.value;for(const de of W){const he=i[de.toString()];a.eachPosition(de,(me,ke,Ee)=>{const Pe=p.feature(me);te.updatePaintArray(ke,Ee,Pe,he,_,S,C,R)})}if(!H)for(const de of d.uniqueIds){const he=i[de.toString()];d.eachPosition(de,(me,ke,Ee)=>{const Pe=p.feature(me);te.updatePaintArray(ke,Ee,Pe,he,_,S,C,R)})}D=!0}}return D}defines(){const i=[];for(const a in this.binders){const d=this.binders[a];(d instanceof vp||d instanceof vd)&&i.push(...d.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return i}getBinderAttributes(){const i=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof Ql||d instanceof Ra||d instanceof ia)for(let p=0;p<d.paintVertexAttributes.length;p++)i.push(d.paintVertexAttributes[p].name);if(d instanceof ia)for(let p=0;p<R0.members.length;p++)i.push(R0.members[p].name)}return i}getBinderUniforms(){const i=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof vp||d instanceof vd||d instanceof Ra)for(const p of d.uniformNames)i.push(p)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof vp||p instanceof vd||p instanceof Ra)for(const y of p.uniformNames)a.push({name:y,property:d,binding:p.getBinding(i,y)})}return a}setUniforms(i,a,d,p,y){for(const{name:_,property:S,binding:A}of d)this.binders[S].setUniform(i,A,y,p.get(S),_)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Ql||a instanceof Ra||a instanceof ia)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof ia&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(i){for(const a in this.binders){const d=this.binders[a];(d instanceof Ql||d instanceof Ra||d instanceof ia)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof Ql||a instanceof Ra||a instanceof ia)&&a.destroy()}}}class oa{constructor(i,a,d=()=>!0){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new ps(p,a,d);this.needsUpload=!1,this._featureMap=new mp,this._featureMapWithoutIds=new mp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,a,d,p,y,_,S,A,C){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(i,a,p,y,_,S,A,C);a.id!==void 0?this._featureMap.add(a.id,d,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,d,p,y,_,S,A){for(const C of d)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,a,C,p,y,_,S||0,A)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const VC={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function UC(c,i){return VC[c]||[c.replace(`${i}-`,"").replace(/-/g,"_")]}const GC={"line-pattern":{source:Yc,composite:Yc},"fill-pattern":{source:Yc,composite:Yc},"fill-extrusion-pattern":{source:Yc,composite:Yc},"line-dasharray":{source:dd,composite:dd}},HC={color:{source:Qc,composite:Jc},number:{source:Xu,composite:Qc}};function dS(c,i,a){const d=GC[c];return d&&d[a]||HC[i][a]}Wt(vp,"ConstantBinder"),Wt(vd,"PatternConstantBinder"),Wt(Ql,"SourceExpressionBinder"),Wt(ia,"PatternCompositeBinder"),Wt(Ra,"CompositeExpressionBinder"),Wt(ps,"ProgramConfiguration",{omit:["_buffers"]}),Wt(oa,"ProgramConfigurationSet");const Jo=Lt/Math.PI/2,fS=5,m=6,s=16383,u=64,g=[u,32,16],x=-Jo,w=Jo;function T(c,i,a,d=Jo){return a=Br(a),[c*Math.sin(a)*d,-i*d,c*Math.cos(a)*d]}function I(c,i,a){return T(Math.cos(Br(c)),Math.sin(Br(c)),i,a)}const k=63710088e-1,N=2*Math.PI*k;class F{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new F(rt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,d=this.lat*a,p=i.lat*a,y=Math.sin(d)*Math.sin(p)+Math.cos(d)*Math.cos(p)*Math.cos((i.lng-this.lng)*a);return k*Math.acos(Math.min(y,1))}toBounds(i=0){const a=360*i/40075017,d=a/Math.cos(Math.PI/180*this.lat);return new q({lng:this.lng-d,lat:this.lat-a},{lng:this.lng+d,lat:this.lat+a})}toEcef(i){return I(this.lat,this.lng,Jo+i*Jo/k)}static convert(i){if(i instanceof F)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new F(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new F(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class q{constructor(i,a){if(i)if(a)this.setSouthWest(i).setNorthEast(a);else if(i.length===4){const d=i;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{const d=i;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(i){return this._ne=i instanceof F?new F(i.lng,i.lat):F.convert(i),this}setSouthWest(i){return this._sw=i instanceof F?new F(i.lng,i.lat):F.convert(i),this}extend(i){const a=this._sw,d=this._ne;let p,y;if(i instanceof F)p=i,y=i;else{if(!(i instanceof q))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(q.convert(i)):this.extend(F.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(F.convert(i)):this;if(p=i._sw,y=i._ne,!p||!y)return this}return a||d?(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new F(p.lng,p.lat),this._ne=new F(y.lng,y.lat)),this}getCenter(){return new F((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new F(this.getWest(),this.getNorth())}getSouthEast(){return new F(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:d}=F.convert(i);let p=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(i){if(i)return i instanceof q?i:new q(i)}}const V=0,X=25.5;function re(c){return N*Math.cos(c*Math.PI/180)}function Q(c){return(180+c)/360}function oe(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function ie(c,i){return c/re(i)}function ue(c){return 360*c-180}function pe(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function ge(c,i){return c*re(pe(i))}const be=85.051129;function Ae(c){return Math.cos(Br(xe(c,-be,be)))}function Ie(c,i){const a=xe(i,V,X),d=Math.pow(2,a);return Ae(c)*N/(512*d)}function we(c){return 1/Math.cos(c*Math.PI/180)}function Se(c,i=0){const a=Math.exp(Math.PI*(1-(c.y+i/Lt)/(1<<c.z)*2));return 80150034*a/(a*a+1)/Lt/(1<<c.z)}class Te{constructor(i,a,d=0){this.x=+i,this.y=+a,this.z=+d}static fromLngLat(i,a=0){const d=F.convert(i);return new Te(Q(d.lng),oe(d.lat),ie(a,d.lat))}toLngLat(){return new F(ue(this.x),pe(this.y))}toAltitude(){return ge(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/N*we(pe(this.y))}}function We(c,i,a,d,p,y,_,S,A){const C=(i+d)/2,R=(a+p)/2,D=new ut(C,R);S(D),function(j,H,W,J,te,ae){const de=W-te,he=J-ae;return Math.abs((J-H)*de-(W-j)*he)/Math.hypot(de,he)}(D.x,D.y,y.x,y.y,_.x,_.y)>=A?(We(c,i,a,C,R,y,D,S,A),We(c,C,R,d,p,D,_,S,A)):c.push(_)}function je(c,i,a){let d=c[0],p=d.x,y=d.y;i(d);const _=[d];for(let S=1;S<c.length;S++){const A=c[S],{x:C,y:R}=A;i(A),We(_,p,y,C,R,d,A,i,a),p=C,y=R,d=A}return _}function ht(c,i,a,d){if(d(i,a)){const p=i.add(a)._mult(.5);ht(c,i,p,d),ht(c,p,a,d)}else c.push(a)}function tt(c,i){let a=c[0];const d=[a];for(let p=1;p<c.length;p++){const y=c[p];ht(d,a,y,i),a=y}return d}const ft=Math.pow(2,14)-1,Pt=-ft-1;function qe(c,i){const a=Math.round(c.x*i),d=Math.round(c.y*i);return c.x=xe(a,Pt,ft),c.y=xe(d,Pt,ft),(a<c.x||a>c.x+1||d<c.y||d>c.y+1)&&qr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function De(c,i,a){const d=c.loadGeometry(),p=c.extent,y=Lt/p;if(i&&a&&a.projection.isReprojectedInTileSpace){const _=1<<i.z,{scale:S,x:A,y:C,projection:R}=a,D=j=>{const H=ue((i.x+j.x/p)/_),W=pe((i.y+j.y/p)/_),J=R.project(H,W);j.x=(J.x*S-A)*p,j.y=(J.y*S-C)*p};for(let j=0;j<d.length;j++)if(c.type!==1)d[j]=je(d[j],D,1);else{const H=[];for(const W of d[j])W.x<0||W.x>=p||W.y<0||W.y>=p||(D(W),H.push(W));d[j]=H}}for(const _ of d)for(const S of _)qe(S,y);return d}function st(c,i){return{type:c.type,id:c.id,properties:c.properties,geometry:i?De(c):[]}}class Xe{constructor(i,a,d,p,y){this.properties={},this.extent=d,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=p,this._values=y,i.readFields(yt,this,a)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos,d=[];let p,y=1,_=0,S=0,A=0;for(;i.pos<a;){if(_<=0){const C=i.readVarint();y=7&C,_=C>>3}if(_--,y===1||y===2)S+=i.readSVarint(),A+=i.readSVarint(),y===1&&(p&&d.push(p),p=[]),p&&p.push(new ut(S,A));else{if(y!==7)throw new Error(`unknown command ${y}`);p&&p.push(p[0].clone())}}return p&&d.push(p),d}bbox(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos;let d=1,p=0,y=0,_=0,S=1/0,A=-1/0,C=1/0,R=-1/0;for(;i.pos<a;){if(p<=0){const D=i.readVarint();d=7&D,p=D>>3}if(p--,d===1||d===2)y+=i.readSVarint(),_+=i.readSVarint(),y<S&&(S=y),y>A&&(A=y),_<C&&(C=_),_>R&&(R=_);else if(d!==7)throw new Error(`unknown command ${d}`)}return[S,C,A,R]}toGeoJSON(i,a,d){const p=this.extent*Math.pow(2,d),y=this.extent*i,_=this.extent*a,S=this.loadGeometry();function A(j){return[360*(j.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(j.y+_)/p)*Math.PI))-90]}function C(j){return j.map(A)}let R;if(this.type===1){const j=[];for(const W of S)j.push(W[0]);const H=C(j);R=j.length===1?{type:"Point",coordinates:H[0]}:{type:"MultiPoint",coordinates:H}}else if(this.type===2){const j=S.map(C);R=j.length===1?{type:"LineString",coordinates:j[0]}:{type:"MultiLineString",coordinates:j}}else{if(this.type!==3)throw new Error("unknown feature type");{const j=function(W){const J=W.length;if(J<=1)return[W];const te=[];let ae,de;for(let he=0;he<J;he++){const me=vt(W[he]);me!==0&&(de===void 0&&(de=me<0),de===me<0?(ae&&te.push(ae),ae=[W[he]]):ae&&ae.push(W[he]))}return ae&&te.push(ae),te}(S),H=[];for(const W of j)H.push(W.map(C));R=H.length===1?{type:"Polygon",coordinates:H[0]}:{type:"MultiPolygon",coordinates:H}}}const D={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function yt(c,i,a){c===1?i.id=a.readVarint():c===2?function(d,p){const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=p._keys[d.readVarint()],S=p._values[d.readVarint()];p.properties[_]=S}}(a,i):c===3?i.type=a.readVarint():c===4&&(i._geometry=a.pos)}function vt(c){let i=0;for(let a,d,p=0,y=c.length,_=y-1;p<y;_=p++)a=c[p],d=c[_],i+=(d.x-a.x)*(a.y+d.y);return i}Xe.types=["Unknown","Point","LineString","Polygon"];class bt{constructor(i,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Dt,this,a),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const a=this._pbf.readVarint()+this._pbf.pos;return new Xe(this._pbf,a,this.extent,this._keys,this._values)}}function Dt(c,i,a){c===15?i.version=a.readVarint():c===1?i.name=a.readString():c===5?i.extent=a.readVarint():c===2?i._features.push(a.pos):c===3?i._keys.push(a.readString()):c===4&&i._values.push(function(d){let p=null;const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=d.readVarint()>>3;p=_===1?d.readString():_===2?d.readFloat():_===3?d.readDouble():_===4?d.readVarint64():_===5?d.readVarint():_===6?d.readSVarint():_===7?d.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(a))}class Jt{constructor(i,a){this.layers=i.readFields(or,{},a)}}function or(c,i,a){if(c===3){const d=new bt(a,a.readVarint()+a.pos);d.length&&(i[d.name]=d)}}const $t="3d_elevation_id",rr="level";class er{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,a){return this._valid&&i(a(this._geometry)),this}require(i,a,d){return this.get(i,!0,a,d)}optional(i,a,d){return this.get(i,!1,a,d)}success(){return this._valid}get(i,a,d,p){const y=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&y!==void 0&&!Number.isNaN(y)?d(p?p(y):y):a&&(this._valid=!1),this}}class _r{constructor(i,a){this.featureFunc=i,this.vertexFunc=a}parseFeature(i,a,d){return this.featureFunc(i,a,d)}parseVertex(i,a,d){return this.vertexFunc(i,a,d)}}const Ar=new _r((c,i,a)=>c.reset(i).require($t,d=>{a.id=d}).optional("fixed_height_relative",d=>{a.constantHeight=d},on.decodeRelativeHeight).geometry(d=>{a.bounds=d},kv).success(),(c,i,a)=>c.reset(i).require($t,d=>{a.id=d}).require("elevation_idx",d=>{a.idx=d}).require("extent",d=>{a.extent=d}).require("height_relative",d=>{a.height=d},on.decodeRelativeHeight).geometry(d=>{a.position=d},on.getPoint).success()),zr=new _r((c,i,a)=>c.reset(i).require($t,d=>{a.id=d}).optional("fixed_height",d=>{a.constantHeight=d},on.decodeMetricHeight).geometry(d=>{a.bounds=d},kv).success(),(c,i,a)=>c.reset(i).require($t,d=>{a.id=d}).require("elevation_idx",d=>{a.idx=d}).require("extent",d=>{a.extent=d}).require("height",d=>{a.height=d},on.decodeMetricHeight).geometry(d=>{a.position=d},on.getPoint).success());class on{static getPoint(i){return cs(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static parse(i){const a=[],d=[],p=i.length,y=new er;for(let S=0;S<p;S++){const A=i.feature(S),C=A.properties.version,R=(_=C)?_==="1.0.1"?zr:void 0:Ar;if(R===void 0){qr(`Unknown elevation feature version number ${C||"(unknown)"}`);continue}const D=A.properties.hasOwnProperty("type")?A.properties.type:void 0;if(D){if(Xe.types[A.type]==="Point"&&D==="curve_point"){const j={};R.parseVertex(y,A,j)&&a.push(j)}else if(Xe.types[A.type]==="Polygon"&&D==="curve_meta"){const j={};R.parseFeature(y,A,j)&&d.push(j)}}}var _;return{vertices:a,features:d}}}class wr{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,d){const p=Kn(a,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1])/p;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,!0}}class sn{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,d){const p=Kt(a,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/p;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,d[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(i,a,d){if(function(H,W){var J=H[0],te=H[1],ae=H[2],de=W[0],he=W[1],me=W[2];return Math.abs(J-de)<=v*Math.max(1,Math.abs(J),Math.abs(de))&&Math.abs(te-he)<=v*Math.max(1,Math.abs(te),Math.abs(he))&&Math.abs(ae-me)<=v*Math.max(1,Math.abs(ae),Math.abs(me))}(this.pos,i)||a===0)return d[0]=d[1]=d[2]=0,!1;const[p,y,_]=this.dir,S=this.pos[0]-i[0],A=this.pos[1]-i[1],C=this.pos[2]-i[2],R=p*p+y*y+_*_,D=2*(S*p+A*y+C*_),j=D*D-4*R*(S*S+A*A+C*C-a*a);if(j<0){const H=Math.max(-D/2,0),W=S+p*H,J=A+y*H,te=C+_*H,ae=Math.hypot(W,J,te);return d[0]=W*a/ae,d[1]=J*a/ae,d[2]=te*a/ae,!1}{const H=(-D-Math.sqrt(j))/(2*R);if(H<0){const W=Math.hypot(S,A,C);return d[0]=S*a/W,d[1]=A*a/W,d[2]=C*a/W,!1}return d[0]=S+p*H,d[1]=A+y*H,d[2]=C+_*H,!0}}}class un{constructor(i,a,d,p,y){this.TL=i,this.TR=a,this.BR=d,this.BL=p,this.horizon=y}static fromInvProjectionMatrix(i,a,d){const p=[-1,1,1],y=[1,1,1],_=[1,-1,1],S=[-1,-1,1],A=nr(p,p,i),C=nr(y,y,i),R=nr(_,_,i),D=nr(S,S,i);return new un(A,C,R,D,a/d)}}function Bn(c,i,a){let d=1/0,p=-1/0;const y=[];for(const _ of c){Yr(y,_,i);const S=Kt(y,a);d=Math.min(d,S),p=Math.max(p,S)}return[d,p]}function Lr(c,i){let a=!0;for(let d=0;d<c.planes.length;d++){const p=c.planes[d];let y=0;for(let _=0;_<i.length;_++)y+=Kt(p,i[_])+p[3]>=0;if(y===0)return 0;y!==i.length&&(a=!1)}return a?2:1}function an(c,i){for(const a of c.projections){const d=Bn(i,c.points[0],a.axis);if(a.projection[1]<d[0]||a.projection[0]>d[1])return 0}return 1}function cn(c,i){let a=0;const d=[0,0,0,0];for(let _=0;_<c.length;_++)d[0]=c[_][0],d[1]=c[_][1],d[2]=c[_][2],d[3]=1,(p=d)[0]*(y=i)[0]+p[1]*y[1]+p[2]*y[2]+p[3]*y[3]>=0&&a++;var p,y;return a}class gn{constructor(i,a){this.points=i||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=Fr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Yr([],this.points[2],this.points[3]),Yr([],this.points[0],this.points[3]),Yr([],this.points[4],this.points[0]),Yr([],this.points[5],this.points[1]),Yr([],this.points[6],this.points[2]),Yr([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const p=[0,-d[2],d[1]],y=[d[2],0,-d[0]];this.projections.push({axis:p,projection:Bn(this.points,this.points[0],p)}),this.projections.push({axis:y,projection:Bn(this.points,this.points[0],y)})}}static fromInvProjectionMatrix(i,a,d,p){const y=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const R=Ci([],C,i),D=1/R[3]/a*y;return(j=R)[0]=(H=R)[0]*(W=[D,D,p?1/R[3]:D,D])[0],j[1]=H[1]*W[1],j[2]=H[2]*W[2],j[3]=H[3]*W[3],j;var j,H,W}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const R=Er([],Pr([],Yr([],_[C[0]],_[C[1]]),Yr([],_[C[2]],_[C[1]]))),D=-Kt(R,_[C[1]]);return R.concat(D)}),A=[];for(let C=0;C<_.length;C++)A.push([_[C][0],_[C][1],_[C][2]]);return new gn(A,S)}intersectsPrecise(i,a,d){for(let p=0;p<a.length;p++)if(!cn(i,a[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!cn(i,this.planes[p]))return 0;for(const p of d)for(const y of this.frustumEdges){const _=Pr([],p,y),S=Ye(_);if(S===0)continue;_t(_,_,1/S);const A=Bn(this.points,this.points[0],_),C=Bn(i,this.points[0],_);if(A[0]>C[1]||C[0]>A[1])return 0}return 1}containsPoint(i){for(const a of this.planes){const d=a[3];if(Kt([a[0],a[1],a[2]],i)+d<0)return!1}return!0}}class Fr{static fromPoints(i){const a=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const p of i)nt(a,a,p),pt(d,d,p);return new Fr(a,d)}static fromTileIdAndHeight(i,a,d){const p=1<<i.canonical.z,y=i.canonical.x,_=i.canonical.y;return new Fr([y/p,_/p,a],[(y+1)/p,(_+1)/p,d])}static applyTransform(i,a){const d=i.getCorners();for(let p=0;p<d.length;++p)nr(d[p],d[p],a);return Fr.fromPoints(d)}static applyTransformFast(i,a){const d=[a[12],a[13],a[14]],p=[...d];for(let y=0;y<3;y++)for(let _=0;_<3;_++){const S=a[4*_+y],A=S*i.min[_],C=S*i.max[_];d[y]+=Math.min(A,C),p[y]+=Math.max(A,C)}return new Fr(d,p)}static projectAabbCorners(i,a){const d=i.getCorners();for(let p=0;p<d.length;++p)nr(d[p],d[p],a);return d}constructor(i,a){this.min=i,this.max=a,this.center=_t([],Je([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],d=Ke(this.min),p=Ke(this.max);for(let y=0;y<a.length;y++)d[y]=a[y]?this.min[y]:this.center[y],p[y]=a[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new Fr(d,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?Lr(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?Lr(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,a){return a||this.intersects(i)?an(i,this.getCorners()):0}intersectsPreciseFlat(i,a){return a||this.intersectsFlat(i)?an(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let a=0;a<3;++a)if(this.min[a]>i.max[a]||i.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i.min[a]),this.max[a]=Math.max(this.max[a],i.max[a])}encapsulatePoint(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i[a]),this.max[a]=Math.max(this.max[a],i[a])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}Wt(Fr,"Aabb");class Mn{constructor(i,a){this.feature=i,this.metersToTile=a,this.index=0}get(){const i=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,d=a[1],p=-a[0],y=(i.extent+1)*this.metersToTile;return[new ut(Math.trunc(i.position[0]+d*y),Math.trunc(i.position[1]+p*y)),new ut(Math.trunc(i.position[0]-d*y),Math.trunc(i.position[1]-p*y))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class hn{constructor(i,a,d,p,y,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=i,this.heightRange={min:d,max:d},this.safeArea=a,this.constantHeight=d,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=y,this.edges=this.edges.filter(S=>{return S.a<this.vertices.length&&S.b<this.vertices.length&&!((A=this.vertices[S.a].position)[0]===(C=this.vertices[S.b].position)[0]&&A[1]===C[1]);var A,C}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const S of this.vertices)this.vertexProps.push({dir:cs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,S.height),this.heightRange.max=Math.max(this.heightRange.max,S.height);for(const S of this.edges){const A=this.vertices[S.a].position,C=this.vertices[S.b].position,R=us(Mo(),C,A),D=Ts(R),j=Ya(Mo(),R,1/D);this.edgeProps.push({vec:R,dir:j,len:D});const H=this.vertexProps[S.a].dir,W=this.vertexProps[S.b].dir;Ea(H,H,j),Ea(W,W,j)}for(const S of this.vertexProps)S.dir[0]===0&&S.dir[1]===0||Mc(S.dir,S.dir);this.tessellate(_)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(i);if(a==null)return 0;const[d,p]=a;return lr(this.vertices[this.edges[d].a].height,this.vertices[this.edges[d].b].height,p)}computeSlopeNormal(i,a){const d=this.getClosestEdge(i);if(!d)return Le(0,0,1);const p=d[0],y=this.edges[p],_=this.edgeProps[p].vec,S=Le(_[0],_[1],(this.vertices[y.b].height-this.vertices[y.a].height)*a),A=Le(S[1],-S[0],0);Pr(A,A,S);const C=Ye(A);return C>0?_t(A,A,1/C):Le(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let a=0,d=Number.POSITIVE_INFINITY,p=0;const y=cs(i.x,i.y);for(let _=0;_<this.edges.length;_++){const S=this.edges[_],A=this.edgeProps[_].dir,C=new wr(y,this.edgeProps[_].dir),R=this.vertices[S.a].position,D=this.vertices[S.b].position,j=Mo(),H=Mo(),W=C.intersectsPlane(R,this.vertexProps[S.a].dir,j),J=C.intersectsPlane(D,this.vertexProps[S.b].dir,H);if(!W||!J)continue;const te=us(Mo(),H,j),ae=us(Mo(),y,j),de=Kn(te,te),he=de>0?Kn(ae,te)/de:0,me=xe(he,0,1),ke=Math.abs((he-me)*this.edgeProps[_].len),Ee=us(Mo(),y,R),Pe=ke+Math.abs(Kn(Ee,cs(A[1],-A[0])));Pe<d&&(a=_,d=Pe,p=me)}return[a,p]}tessellate(i){for(let a=this.edges.length-1;a>=0;--a){const d=this.edges[a].a,p=this.edges[a].b,{position:y,height:_,extent:S}=this.vertices[d],{position:A,height:C,extent:R}=this.vertices[p],D=this.vertexProps[d].dir,j=this.vertexProps[p].dir,H=Le(y[0]/i,y[1]/i,_),W=Le(A[0]/i,A[1]/i,C),J=Le(D[1],-D[0],0);_t(J,J,S);const te=Le(j[1],-j[0],0);if(_t(te,te,R),this.distSqLines(Le(H[0]+.5*J[0],H[1]+.5*J[1],H[2]+.5*J[2]),Le(W[0]-.5*te[0],W[1]-.5*te[1],W[2]-.5*te[2]),Le(H[0]-.5*J[0],H[1]-.5*J[1],H[2]-.5*J[2]),Le(W[0]+.5*te[0],W[1]+.5*te[1],W[2]+.5*te[2]))<=.0025000000000000005)continue;const ae=this.vertices.length,de=Ea(Mo(),y,A);this.vertices.push({position:Ya(de,de,.5),height:.5*(_+C),extent:.5*(S+R)});const he=Ea(Mo(),D,j);this.vertexProps.push({dir:Mc(he,he)}),this.edges.splice(a,1),this.edgeProps.splice(a,1),this.edges.push({a:d,b:ae}),this.edges.push({a:ae,b:p});const me=us(Mo(),this.vertices[ae].position,y),ke=Ts(me),Ee={vec:me,dir:Ya(Mo(),me,1/ke),len:ke};this.edgeProps.push(Ee),this.edgeProps.push(Ee)}}distSqLines(i,a,d,p){const y=it(Me(),a,i),_=it(Me(),p,d),S=it(Me(),i,d),A=Kt(y,y),C=Kt(y,_),R=Kt(y,S),D=Kt(_,_),j=Kt(_,S),H=A*D-C*C;if(H===0){const te=Kt(S,_)/Kt(_,_);return sr(Qt(Me(),d,p,te),i)}const W=(C*j-R*D)/H,J=(A*j-C*R)/H;return sr(Qt(Me(),i,a,W),Qt(Me(),d,p,J))}}class ui{static parseFrom(i,a){const d=on.parse(i);if(!d)return[];let{vertices:p,features:y}=d;const _=1/Se(a);y.sort((R,D)=>R.id-D.id),p.sort((R,D)=>R.id-D.id||R.idx-D.idx),p=p.filter((R,D,j)=>D===j.findIndex(H=>H.id===R.id&&H.idx===R.idx));const S=new Array;let A=0;const C=p.length;for(const R of y){if(R.constantHeight){S.push(new hn(R.id,R.bounds,R.constantHeight));continue}for(;A!==C&&p[A].id<R.id;)A++;if(A===C||p[A].id!==R.id)continue;const D=new Array,j=new Array,H=A;for(;A!==C&&p[A].id===R.id;){const W=p[A];if(D.push({position:W.position,height:W.height,extent:W.extent}),A!==H&&p[A-1].idx===W.idx-1){const J=A-H;j.push({a:J-1,b:J})}A++}S.push(new hn(R.id,R.bounds,void 0,D,j,_))}return S}static getElevationFeature(i,a){if(!a)return;const d=+i.properties[$t];return Number.isNaN(d)?void 0:a.find(p=>p.id===d)}}class rn{constructor(i,a){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(a)||(this.zScale=Math.pow(2,a.z-i.z),this.xOffset=(i.x*this.zScale-a.x)*Lt,this.yOffset=(i.y*this.zScale-a.y)*Lt)}constantElevation(i,a){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,a)}pointElevation(i,a,d){const p=this.constantElevation(a,d);return p??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(i),d))}computeBiasedHeight(i,a){return a<=0?i:i+a*Fe(0,a,i>=0?i:Math.abs(.5*i))}}Wt(hn,"ElevationFeature");class yn{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Os,this.indexArray=new ii,this.segments=new ci,this.programConfigurations=new oa(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Xu),this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,d,p){const y=this.layers[0],_=[];let S=null;y.type==="circle"&&(S=y.layout.get("circle-sort-key"));for(const{feature:C,id:R,index:D,sourceLayerIndex:j}of i){const H=this.layers[0]._featureFilter.needGeometry,W=st(C,H);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom,{worldview:this.worldview}),W,d))continue;const J=S?S.evaluate(W,{},d):void 0,te={id:R,properties:C.properties,type:C.type,sourceLayerIndex:j,index:D,geometry:H?W.geometry:De(C,d,p),patterns:{},sortKey:J};_.push(te)}S&&_.sort((C,R)=>C.sortKey-R.sortKey);let A=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Og,A=p.projection);for(const C of _){const{geometry:R,index:D,sourceLayerIndex:j}=C,H=i[D].feature;this.addFeature(C,R,D,a.availableImages,d,A,a.brightness,a.elevationFeatures),a.featureIndex.insert(H,R,D,j,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,a,d,p,y,_,S){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,lS.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,zC.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,NC.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,a,d,p,y,_,S,A){let C;this.elevationMode!=="none"&&(C=ui.getElevationFeature(i,A));for(const R of a)for(const D of R){const j=D.x,H=D.y;if(j<0||j>=Lt||H<0||H>=Lt)continue;if(_){const te=_.projectTilePoint(j,H,y),ae=_.upVector(y,j,H);this.addGlobeExtVertex(te,ae),this.addGlobeExtVertex(te,ae),this.addGlobeExtVertex(te,ae),this.addGlobeExtVertex(te,ae)}const W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),J=W.vertexLength;if(this.addCircleVertex(j,H,-1,-1),this.addCircleVertex(j,H,1,-1),this.addCircleVertex(j,H,1,1),this.addCircleVertex(j,H,-1,1),this.elevationMode!=="none"){const te=C?C.pointElevation(new ut(j,H)):0;this.hasElevation=this.hasElevation||te!==0;for(let ae=0;ae<4;ae++)this.elevatedLayoutVertexArray.emplaceBack(te)}this.indexArray.emplaceBack(J,J+1,J+2),this.indexArray.emplaceBack(J,J+2,J+3),W.vertexLength+=4,W.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{},p,y,S,void 0,this.worldview)}addCircleVertex(i,a,d,p){this.layoutVertexArray.emplaceBack(2*i+(d+1)/2,2*a+(p+1)/2)}addGlobeExtVertex(i,a){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function Nn(c,i){for(let a=0;a<c.length;a++)if(Fo(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(Fo(c,i[a]))return!0;return!!So(c,i)}function Di(c,i,a){return!!Fo(c,i)||!!zo(i,c,a)}function Oi(c,i){if(c.length===1)return Da(i,c[0]);for(let a=0;a<i.length;a++){const d=i[a];for(let p=0;p<d.length;p++)if(Fo(c,d[p]))return!0}for(let a=0;a<c.length;a++)if(Da(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(So(c,i[a]))return!0;return!1}function zi(c,i,a){if(c.length>1){if(So(c,i))return!0;for(let d=0;d<i.length;d++)if(zo(i[d],c,a))return!0}for(let d=0;d<c.length;d++)if(zo(c[d],i,a))return!0;return!1}function So(c,i){if(c.length===0||i.length===0)return!1;for(let a=0;a<c.length-1;a++){const d=c[a],p=c[a+1];for(let y=0;y<i.length-1;y++)if(rl(d,p,i[y],i[y+1]))return!0}return!1}function rl(c,i,a,d){return Ti(c,a,d)!==Ti(i,a,d)&&Ti(c,i,a)!==Ti(c,i,d)}function ms(c,i,a){return(c.x-a.x)*(i.y-a.y)-(c.y-a.y)*(i.x-a.x)}function $s(c,i,a,d){const p=ms(c,i,d),y=ms(c,i,a);if(Math.sign(p)===Math.sign(y))return;const _=ms(a,d,c),S=_+y-p;return Math.sign(_)!==Math.sign(S)?[_/(_-S),y/(y-p)]:void 0}function zo(c,i,a){const d=a*a;if(i.length===1)return c.distSqr(i[0])<d;for(let p=1;p<i.length;p++)if(sa(c,i[p-1],i[p])<d)return!0;return!1}function sa(c,i,a){const d=i.distSqr(a);if(d===0)return c.distSqr(i);const p=((c.x-i.x)*(a.x-i.x)+(c.y-i.y)*(a.y-i.y))/d;return c.distSqr(p<0?i:p>1?a:a.sub(i)._mult(p)._add(i))}function Da(c,i){let a,d,p,y=!1;for(let _=0;_<c.length;_++){a=c[_];for(let S=0,A=a.length-1;S<a.length;A=S++)d=a[S],p=a[A],d.y>i.y!=p.y>i.y&&i.x<(p.x-d.x)*(i.y-d.y)/(p.y-d.y)+d.x&&(y=!y)}return y}function Fo(c,i){let a=!1;for(let d=0,p=c.length-1;d<c.length;p=d++){const y=c[d],_=c[p];y.y>i.y!=_.y>i.y&&i.x<(_.x-y.x)*(i.y-y.y)/(_.y-y.y)+y.x&&(a=!a)}return a}function Ei(c,i,a,d,p){for(const _ of c)if(i<=_.x&&a<=_.y&&d>=_.x&&p>=_.y)return!0;const y=[new ut(i,a),new ut(i,p),new ut(d,p),new ut(d,a)];if(c.length>2){for(const _ of y)if(Fo(c,_))return!0}for(let _=0;_<c.length-1;_++)if(gi(c[_],c[_+1],y))return!0;return!1}function gi(c,i,a){const d=a[0],p=a[2];if(c.x<d.x&&i.x<d.x||c.x>p.x&&i.x>p.x||c.y<d.y&&i.y<d.y||c.y>p.y&&i.y>p.y)return!1;const y=Ti(c,i,a[0]);return y!==Ti(c,i,a[1])||y!==Ti(c,i,a[2])||y!==Ti(c,i,a[3])}function Un(c,i,a,d,p,y){let _=i.y-c.y,S=c.x-i.x;if(y=y||0){const A=_*_+S*S;if(A===0)return!0;const C=Math.sqrt(A);_/=C,S/=C}return!((a.x-c.x)*_+(a.y-c.y)*S-y<0||(d.x-c.x)*_+(d.y-c.y)*S-y<0||(p.x-c.x)*_+(p.y-c.y)*S-y<0)}function Hi(c,i,a,d,p,y,_){return!(Un(c,i,d,p,y,_)||Un(i,a,d,p,y,_)||Un(a,c,d,p,y,_)||Un(d,p,c,i,a,_)||Un(p,y,c,i,a,_)||Un(y,d,c,i,a,_))}function To(c,i,a){const d=i.paint.get(c).value;return d.kind==="constant"?d.value:a.programConfigurations.get(i.id).getMaxValue(c)}function Ai(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function aa(c,i,a,d,p){if(!i[0]&&!i[1])return c;const y=ut.convert(i)._mult(p);a==="viewport"&&y._rotate(-d);const _=[];for(let S=0;S<c.length;S++)_.push(c[S].sub(y));return _}function Yu(c,i,a,d){const p=ut.convert(c)._mult(d);return i==="viewport"&&p._rotate(-a),p}let eu,xd;function bd(c,i,a){var d=2*Math.PI*6378137/256/Math.pow(2,a);return[c*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}Wt(yn,"CircleBucket",{omit:["layers"]});class la{constructor(i,a,d){this.z=i,this.x=a,this.y=d,this.key=ca(0,i,i,a,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const a=this.z-i.z;return i.z===0||i.z<this.z&&i.x===this.x>>a&&i.y===this.y>>a}url(i,a){const d=function(y,_,S){var A=bd(256*y,256*(_=Math.pow(2,S)-_-1),S),C=bd(256*(y+1),256*(_+1),S);return A[0]+","+A[1]+","+C[0]+","+C[1]}(this.x,this.y,this.z),p=function(y,_,S){let A,C="";for(let R=y;R>0;R--)A=1<<R-1,C+=(_&A?1:0)+(S&A?2:0);return C}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class wl{constructor(i,a){this.wrap=i,this.canonical=a,this.key=ca(i,a.z,a.z,a.x,a.y)}}class Wi{constructor(i,a,d,p,y){this.overscaledZ=i,this.wrap=a,this.canonical=new la(d,+p,+y),this.key=a===0&&i===d?this.canonical.key:ca(a,i,d,p,y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new Wi(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wi(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return ca(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-i;return ca(this.wrap*+a,i,i,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new Wi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,d=2*this.canonical.x,p=2*this.canonical.y;return[new Wi(a,this.wrap,a,d,p),new Wi(a,this.wrap,a,d+1,p),new Wi(a,this.wrap,a,d,p+1),new Wi(a,this.wrap,a,d+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Wi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Wi(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ca(c,i,a,d,p){const y=1<<Math.min(a,22);let _=y*(p%y)+d%y;return c&&a<22&&(_+=y*y*((c<0?-2*c-1:2*c)%(1<<2*(22-a)))),16*(32*_+a)+(i-a)}const Ju=[c=>{let i=c.canonical.x-1,a=c.wrap;return i<0&&(i=(1<<c.canonical.z)-1,a--),new Wi(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>{let i=c.canonical.x+1,a=c.wrap;return i===1<<c.canonical.z&&(i=0,a++),new Wi(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>new Wi(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new Wi(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];Wt(la,"CanonicalTileID"),Wt(Wi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const tre=Qr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pS}=tre,rre=Qr([{name:"a_pos_3",components:3,type:"Int16"}]);var W3=Qr([{name:"a_pos",type:"Int16",components:2}]);function mS(c){return c*Jo/k}const nre=[new Fr([x,x,x],[w,w,w]),new Fr([x,x,x],[0,0,w]),new Fr([0,x,x],[w,0,w]),new Fr([x,0,x],[0,w,w]),new Fr([0,0,x],[w,w,w])];function q3(c,i,a,d=!0){const p=_t([],c._camera.position,c.worldSize),y=[i,a,1,1];Ci(y,y,c.pixelMatrixInverse),No(y,y,1/y[3]);const _=Er([],Yr([],y,p)),S=c.globeMatrix,A=[S[12],S[13],S[14]],C=Yr([],A,p),R=Ye(C),D=Er([],C),j=c.worldSize/(2*Math.PI),H=Kt(D,_),W=Math.asin(j/R);if(W<Math.acos(H)){if(!d)return null;const ct=[],Ue=[];_t(ct,_,R/H),Er(Ue,Yr(Ue,ct,C)),Er(_,Je(_,C,_t(_,Ue,Math.tan(W)*R)))}const J=[];new sn(p,_).closestPointOnSphere(A,j,J);const te=Er([],fi(S,0)),ae=Er([],fi(S,1)),de=Er([],fi(S,2)),he=Kt(te,J),me=Kt(ae,J),ke=Kt(de,J),Ee=Ge(Math.asin(-me/j));let Pe=Ge(Math.atan2(he,ke));Pe=c.center.lng+function(ct,Ue){const dt=(Ue-ct+180)%360-180;return dt<-180?dt+360:dt}(c.center.lng,Pe);const Ne=Q(Pe),Be=xe(oe(Ee),0,1);return new Te(Ne,Be)}class ire{constructor(i,a,d){this.a=Yr([],i,d),this.b=Yr([],a,d),this.center=d;const p=Er([],this.a),y=Er([],this.b);this.angle=Math.acos(Kt(p,y))}}function WC(c,i){if(c.angle===0)return null;let a;return a=c.a[i]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[i]/c.a[i]/Math.sin(c.angle)-1/Math.tan(c.angle)),a<0||a>1?null:function(d,p,y,_){const S=Math.sin(y);return d*(Math.sin((1-_)*y)/S)+p*(Math.sin(_*y)/S)}(c.a[i],c.b[i],c.angle,xe(a,0,1))+c.center[i]}function tu(c){if(c.z<=1)return nre[c.z+2*c.y+c.x];const i=qC(gS(c));return Fr.fromPoints(i)}function Qu(c,i,a){return _t(c,c,1-a),It(c,c,i,a)}function Z3(c,i,a){for(const d of c)nr(d,d,i),_t(d,d,a)}function X3(c,i,a,d){const p=i/c.worldSize,y=c.globeMatrix;if(a.z<=1){const Be=tu(a).getCorners();return Z3(Be,y,p),Fr.fromPoints(Be)}const _=gS(a,d),S=qC(_,Jo+mS(c._tileCoverLift));Z3(S,y,p);const A=Number.MAX_VALUE,C=[-A,-A,-A],R=[A,A,A];if(_.contains(c.center)){for(const Ue of S)nt(R,R,Ue),pt(C,C,Ue);C[2]=0;const Be=c.point,ct=[Be.x*p,Be.y*p,0];return nt(R,R,ct),pt(C,C,ct),new Fr(R,C)}if(c._tileCoverLift>0){for(const Be of S)nt(R,R,Be),pt(C,C,Be);return new Fr(R,C)}const D=[y[12]*p,y[13]*p,y[14]*p],j=_.getCenter(),H=xe(c.center.lat,-be,be),W=xe(j.lat,-be,be),J=Q(c.center.lng),te=oe(H);let ae=J-Q(j.lng);const de=te-oe(W);ae>.5?ae-=1:ae<-.5&&(ae+=1);let he=0;Math.abs(ae)>Math.abs(de)?he=ae>=0?1:3:(he=de>=0?0:2,It(D,D,[y[4]*p,y[5]*p,y[6]*p],-Math.sin(Br(de>=0?_.getSouth():_.getNorth()))*Jo));const me=S[he],ke=S[(he+1)%4],Ee=new ire(me,ke,D),Pe=[WC(Ee,0)||me[0],WC(Ee,1)||me[1],WC(Ee,2)||me[2]],Ne=wd(c.zoom);if(Ne>0){const Be=function({x:Ue,y:dt,z:Ct},mt,wt,At,at){const St=1/(1<<Ct);let He=Ue*St,lt=He+St,kt=dt*St,Tt=kt+St,tr=0;const Zt=(He+lt)/2-At;return Zt>.5?tr=-1:Zt<-.5&&(tr=1),He=((He+tr)*mt-(At*=mt))*wt+At,lt=((lt+tr)*mt-At)*wt+At,kt=(kt*mt-(at*=mt))*wt+at,Tt=(Tt*mt-at)*wt+at,[[He,Tt,0],[lt,Tt,0],[lt,kt,0],[He,kt,0]]}(a,i,c._pixelsPerMercatorPixel,J,te);for(let Ue=0;Ue<S.length;Ue++)Qu(S[Ue],Be[Ue],Ne);const ct=Je([],Be[he],Be[(he+1)%4]);_t(ct,ct,.5),Qu(Pe,ct,Ne)}for(const Be of S)nt(R,R,Be),pt(C,C,Be);return R[2]=Math.min(me[2],ke[2]),nt(R,R,Pe),pt(C,C,Pe),new Fr(R,C)}function gS({x:c,y:i,z:a},d=!1){const p=1/(1<<a),y=new F(ue(c*p),i===(1<<a)-1&&d?-90:pe((i+1)*p)),_=new F(ue((c+1)*p),i===0&&d?90:pe(i*p));return new q(y,_)}function qC(c,i=Jo){const a=Br(c.getNorth()),d=Br(c.getSouth()),p=Math.cos(a),y=Math.cos(d),_=Math.sin(a),S=Math.sin(d),A=c.getWest(),C=c.getEast();return[T(y,S,A,i),T(y,S,C,i),T(p,_,C,i),T(p,_,A,i)]}function z0(c,i,a,d){const p=1<<a.z,y=(c/Lt+a.x)/p;return I(pe((i/Lt+a.y)/p),ue(y),d)}function yS({min:c,max:i}){return s/Math.max(i[0]-c[0],i[1]-c[1],i[2]-c[2])}const K3=new Float64Array(16);function _S(c){const i=yS(c),a=le(K3,[i,i,i]);return G(a,a,Kr([],c.min))}function ZC(c){const i=(d=c.min,(a=K3)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=d[0],a[13]=d[1],a[14]=d[2],a[15]=1,a);var a,d;const p=1/yS(c);return Z(i,i,[p,p,p])}function XC(c){const i=Lt/(2*Math.PI);return c/(2*Math.PI)/i}function Y3(c,i){return Lt/(512*Math.pow(2,c))*yS(tu(i))}function J3(c,i,a,d,p){const y=XC(a),_=[c,i,-a/(2*Math.PI)],S=z(new Float64Array(16));return G(S,S,_),Z(S,S,[y,y,y]),ne(S,S,Br(-p)),Y(S,S,Br(-d)),S}function wd(c){return Fe(fS,m,c)}function Q3(c,i){const a=I(i.lat,i.lng),d=function(W){const J=I(W._center.lat,W._center.lng);let te=Pr([],Le(0,1,0),J);const ae=fe([],-W.angle,J);te=nr(te,te,ae),fe(ae,-W._pitch,te);const de=Er([],J);return _t(de,de,mS(W.cameraToCenterDistance/W.pixelsPerMeter)),nr(de,de,ae),Je([],J,de)}(c);return _=(p=it([],d,a))[0],S=p[1],A=p[2],C=(y=a)[0],R=y[1],D=y[2],H=(j=Math.sqrt(_*_+S*S+A*A)*Math.sqrt(C*C+R*R+D*D))&&Kt(p,y)/j,Math.acos(Math.min(Math.max(H,-1),1));var p,y,_,S,A,C,R,D,j,H}function KC(c,i){return Q3(c,i)>Math.PI/2*1.01}const ez=Br(85),ore=Math.cos(ez),sre=Math.sin(ez),are=B(),tz=c=>{const i=[];return c.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function rz(c,i,a,d,p,y,_,S,A){if(y&&c.queryGeometry.isAboveHorizon)return!1;y&&(A*=c.pixelToTileUnitsFactor);const C=c.tileID.canonical,R=a.projection.upVectorScale(C,a.center.lat,a.worldSize).metersToTile;for(const D of i)for(const j of D){const H=j.add(S),W=p&&a.elevation?a.elevation.exaggeration()*p.getElevationAt(H.x,H.y,!0):0,J=a.projection.projectTilePoint(H.x,H.y,C);if(W>0){const he=a.projection.upVector(C,H.x,H.y);J.x+=he[0]*R*W,J.y+=he[1]*R*W,J.z+=he[2]*R*W}const te=y?H:lre(J.x,J.y,J.z,d),ae=y?c.tilespaceRays.map(he=>ure(he,W)):c.queryGeometry.screenGeometry,de=Ci([],[J.x,J.y,J.z,1],d);if(!_&&y?A*=de[3]/a.cameraToCenterDistance:_&&!y&&(A*=a.cameraToCenterDistance/de[3]),y){const he=pe((j.y/Lt+C.y)/(1<<C.z));A/=a.projection.pixelsPerMeter(he,1)/ie(1,he)}if(Di(ae,te,A))return!0}return!1}function lre(c,i,a,d){const p=Ci([],[c,i,a,1],d);return new ut(p[0]/p[3],p[1]/p[3])}const nz=Le(0,0,0),cre=Le(0,0,1);function ure(c,i){const a=Me();return nz[2]=i,c.intersectsPlane(nz,cre,a),new ut(a[0],a[1])}class iz extends yn{}let oz,sz,az,lz;function cz(c,{width:i,height:a},d,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*a*d)throw new RangeError("mismatched image size")}else p=new Uint8Array(i*a*d);return c.width=i,c.height=a,c.data=p,c}function uz(c,i,a){const{width:d,height:p}=i;d===c.width&&p===c.height||(YC(c,i,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,d),height:Math.min(c.height,p)},a,null),c.width=d,c.height=p,c.data=i.data)}function YC(c,i,a,d,p,y,_,S){if(p.width===0||p.height===0)return i;if(p.width>c.width||p.height>c.height||a.x>c.width-p.width||a.y>c.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||d.x>i.width-p.width||d.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const A=c.data,C=i.data,R=y===4&&S;for(let D=0;D<p.height;D++){const j=((a.y+D)*c.width+a.x)*y,H=((d.y+D)*i.width+d.x)*y;if(R)for(let W=0;W<p.width;W++){const J=j+W*y+3,te=H+W*y;C[te+0]=255,C[te+1]=255,C[te+2]=255,C[te+3]=A[J]}else if(_)for(let W=0;W<p.width;W++){const J=j+W*y,te=H+W*y,ae=new Sn(A[J+0]/255,A[J+1]/255,A[J+2]/255,A[J+3]).toNonPremultipliedRenderColor(_).toArray();C[te+0]=ae[0],C[te+1]=ae[1],C[te+2]=ae[2],C[te+3]=ae[3]}else for(let W=0;W<p.width*y;W++)C[H+W]=A[j+W]}return i}Wt(iz,"HeatmapBucket",{omit:["layers"]});class Sd{constructor(i,a){cz(this,i,1,a)}resize(i){uz(this,new Sd(i),1)}clone(){return new Sd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,d,p,y){YC(i,a,d,p,y,1,null)}}class Bo{constructor(i,a){cz(this,i,4,a)}resize(i){uz(this,new Bo(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,d,p,y,_,S){YC(i,a,d,p,y,4,_,S)}}class hz{constructor(i,a){this.width=i.width,this.height=i.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function F0(c){const i={},a=c.resolution||256,d=c.clips?c.clips.length:1,p=c.image||new Bo({width:a,height:d}),y=(_,S,A)=>{i[c.evaluationKey]=A;const C=c.expression.evaluate(i),R=C?C.toNonPremultipliedRenderColor(null):null;R&&(p.data[_+S+0]=Math.floor(255*R.r),p.data[_+S+1]=Math.floor(255*R.g),p.data[_+S+2]=Math.floor(255*R.b),p.data[_+S+3]=Math.floor(255*R.a))};if(c.clips)for(let _=0,S=0;_<d;++_,S+=4*a)for(let A=0,C=0;A<a;A++,C+=4){const R=A/(a-1),{start:D,end:j}=c.clips[_];y(S,C,D*(1-R)+j*R)}else for(let _=0,S=0;_<a;_++,S+=4)y(0,S,_/(a-1));return p}Wt(Sd,"AlphaImage"),Wt(Bo,"RGBAImage");const hre=Qr([{name:"a_pos",components:2,type:"Int16"}],4),dre=Qr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),fre=Qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),pre=Qr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Bg(c,i,a=2){const d=i&&i.length,p=d?i[0]*a:c.length;let y=dz(c,0,p,a,!0);const _=[];if(!y||y.next===y.prev)return _;let S,A,C;if(d&&(y=function(R,D,j,H){const W=[];for(let J=0,te=D.length;J<te;J++){const ae=dz(R,D[J]*H,J<te-1?D[J+1]*H:R.length,H,!1);ae===ae.next&&(ae.steiner=!0),W.push(wre(ae))}W.sort(vre);for(let J=0;J<W.length;J++)j=xre(W[J],j);return j}(c,i,y,a)),c.length>80*a){S=c[0],A=c[1];let R=S,D=A;for(let j=a;j<p;j+=a){const H=c[j],W=c[j+1];H<S&&(S=H),W<A&&(A=W),H>R&&(R=H),W>D&&(D=W)}C=Math.max(R-S,D-A),C=C!==0?32767/C:0}return B0(y,_,a,S,A,C,0),_}function dz(c,i,a,d,p){let y;if(p===function(_,S,A,C){let R=0;for(let D=S,j=A-C;D<A;D+=C)R+=(_[j]-_[D])*(_[D+1]+_[j+1]),j=D;return R}(c,i,a,d)>0)for(let _=i;_<a;_+=d)y=gz(_/d|0,c[_],c[_+1],y);else for(let _=a-d;_>=i;_-=d)y=gz(_/d|0,c[_],c[_+1],y);return y&&$g(y,y.next)&&(U0(y),y=y.next),y}function xp(c,i){if(!c)return c;i||(i=c);let a,d=c;do if(a=!1,d.steiner||!$g(d,d.next)&&po(d.prev,d,d.next)!==0)d=d.next;else{if(U0(d),d=i=d.prev,d===d.next)break;a=!0}while(a||d!==i);return i}function B0(c,i,a,d,p,y,_){if(!c)return;!_&&y&&function(A,C,R,D){let j=A;do j.z===0&&(j.z=JC(j.x,j.y,C,R,D)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==A);j.prevZ.nextZ=null,j.prevZ=null,function(H){let W,J=1;do{let te,ae=H;H=null;let de=null;for(W=0;ae;){W++;let he=ae,me=0;for(let Ee=0;Ee<J&&(me++,he=he.nextZ,he);Ee++);let ke=J;for(;me>0||ke>0&&he;)me!==0&&(ke===0||!he||ae.z<=he.z)?(te=ae,ae=ae.nextZ,me--):(te=he,he=he.nextZ,ke--),de?de.nextZ=te:H=te,te.prevZ=de,de=te;ae=he}de.nextZ=null,J*=2}while(W>1)}(j)}(c,d,p,y);let S=c;for(;c.prev!==c.next;){const A=c.prev,C=c.next;if(y?gre(c,d,p,y):mre(c))i.push(A.i,c.i,C.i),U0(c),c=C.next,S=C.next;else if((c=C)===S){_?_===1?B0(c=yre(xp(c),i),i,a,d,p,y,2):_===2&&_re(c,i,a,d,p,y):B0(xp(c),i,a,d,p,y,1);break}}}function mre(c){const i=c.prev,a=c,d=c.next;if(po(i,a,d)>=0)return!1;const p=i.x,y=a.x,_=d.x,S=i.y,A=a.y,C=d.y,R=Math.min(p,y,_),D=Math.min(S,A,C),j=Math.max(p,y,_),H=Math.max(S,A,C);let W=d.next;for(;W!==i;){if(W.x>=R&&W.x<=j&&W.y>=D&&W.y<=H&&$0(p,S,y,A,_,C,W.x,W.y)&&po(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function gre(c,i,a,d){const p=c.prev,y=c,_=c.next;if(po(p,y,_)>=0)return!1;const S=p.x,A=y.x,C=_.x,R=p.y,D=y.y,j=_.y,H=Math.min(S,A,C),W=Math.min(R,D,j),J=Math.max(S,A,C),te=Math.max(R,D,j),ae=JC(H,W,i,a,d),de=JC(J,te,i,a,d);let he=c.prevZ,me=c.nextZ;for(;he&&he.z>=ae&&me&&me.z<=de;){if(he.x>=H&&he.x<=J&&he.y>=W&&he.y<=te&&he!==p&&he!==_&&$0(S,R,A,D,C,j,he.x,he.y)&&po(he.prev,he,he.next)>=0||(he=he.prevZ,me.x>=H&&me.x<=J&&me.y>=W&&me.y<=te&&me!==p&&me!==_&&$0(S,R,A,D,C,j,me.x,me.y)&&po(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;he&&he.z>=ae;){if(he.x>=H&&he.x<=J&&he.y>=W&&he.y<=te&&he!==p&&he!==_&&$0(S,R,A,D,C,j,he.x,he.y)&&po(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;me&&me.z<=de;){if(me.x>=H&&me.x<=J&&me.y>=W&&me.y<=te&&me!==p&&me!==_&&$0(S,R,A,D,C,j,me.x,me.y)&&po(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function yre(c,i){let a=c;do{const d=a.prev,p=a.next.next;!$g(d,p)&&pz(d,a,a.next,p)&&V0(d,p)&&V0(p,d)&&(i.push(d.i,a.i,p.i),U0(a),U0(a.next),a=c=p),a=a.next}while(a!==c);return xp(a)}function _re(c,i,a,d,p,y){let _=c;do{let S=_.next.next;for(;S!==_.prev;){if(_.i!==S.i&&Sre(_,S)){let A=mz(_,S);return _=xp(_,_.next),A=xp(A,A.next),B0(_,i,a,d,p,y,0),void B0(A,i,a,d,p,y,0)}S=S.next}_=_.next}while(_!==c)}function vre(c,i){let a=c.x-i.x;return a===0&&(a=c.y-i.y,a===0)&&(a=(c.next.y-c.y)/(c.next.x-c.x)-(i.next.y-i.y)/(i.next.x-i.x)),a}function xre(c,i){const a=function(p,y){let _=y;const S=p.x,A=p.y;let C,R=-1/0;if($g(p,_))return _;do{if($g(p,_.next))return _.next;if(A<=_.y&&A>=_.next.y&&_.next.y!==_.y){const J=_.x+(A-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(J<=S&&J>R&&(R=J,C=_.x<_.next.x?_:_.next,J===S))return C}_=_.next}while(_!==y);if(!C)return null;const D=C,j=C.x,H=C.y;let W=1/0;_=C;do{if(S>=_.x&&_.x>=j&&S!==_.x&&fz(A<H?S:R,A,j,H,A<H?R:S,A,_.x,_.y)){const J=Math.abs(A-_.y)/(S-_.x);V0(_,p)&&(J<W||J===W&&(_.x>C.x||_.x===C.x&&bre(C,_)))&&(C=_,W=J)}_=_.next}while(_!==D);return C}(c,i);if(!a)return i;const d=mz(a,c);return xp(d,d.next),xp(a,a.next)}function bre(c,i){return po(c.prev,c,i.prev)<0&&po(i.next,c,c.next)<0}function JC(c,i,a,d,p){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-a)*p|0)|c<<8))|c<<4))|c<<2))|c<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-d)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function wre(c){let i=c,a=c;do(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next;while(i!==c);return a}function fz(c,i,a,d,p,y,_,S){return(p-_)*(i-S)>=(c-_)*(y-S)&&(c-_)*(d-S)>=(a-_)*(i-S)&&(a-_)*(y-S)>=(p-_)*(d-S)}function $0(c,i,a,d,p,y,_,S){return!(c===_&&i===S)&&fz(c,i,a,d,p,y,_,S)}function Sre(c,i){return c.next.i!==i.i&&c.prev.i!==i.i&&!function(a,d){let p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==d.i&&p.next.i!==d.i&&pz(p,p.next,a,d))return!0;p=p.next}while(p!==a);return!1}(c,i)&&(V0(c,i)&&V0(i,c)&&function(a,d){let p=a,y=!1;const _=(a.x+d.x)/2,S=(a.y+d.y)/2;do p.y>S!=p.next.y>S&&p.next.y!==p.y&&_<(p.next.x-p.x)*(S-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==a);return y}(c,i)&&(po(c.prev,c,i.prev)||po(c,i.prev,i))||$g(c,i)&&po(c.prev,c,c.next)>0&&po(i.prev,i,i.next)>0)}function po(c,i,a){return(i.y-c.y)*(a.x-i.x)-(i.x-c.x)*(a.y-i.y)}function $g(c,i){return c.x===i.x&&c.y===i.y}function pz(c,i,a,d){const p=xS(po(c,i,a)),y=xS(po(c,i,d)),_=xS(po(a,d,c)),S=xS(po(a,d,i));return p!==y&&_!==S||!(p!==0||!vS(c,a,i))||!(y!==0||!vS(c,d,i))||!(_!==0||!vS(a,c,d))||!(S!==0||!vS(a,i,d))}function vS(c,i,a){return i.x<=Math.max(c.x,a.x)&&i.x>=Math.min(c.x,a.x)&&i.y<=Math.max(c.y,a.y)&&i.y>=Math.min(c.y,a.y)}function xS(c){return c>0?1:c<0?-1:0}function V0(c,i){return po(c.prev,c,c.next)<0?po(c,i,c.next)>=0&&po(c,c.prev,i)>=0:po(c,i,c.prev)<0||po(c,c.next,i)<0}function mz(c,i){const a=QC(c.i,c.x,c.y),d=QC(i.i,i.x,i.y),p=c.next,y=i.prev;return c.next=i,i.prev=c,a.next=p,p.prev=a,d.next=a,a.prev=d,y.next=d,d.prev=y,d}function gz(c,i,a,d){const p=QC(c,i,a);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function U0(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function QC(c,i,a){return{i:c,x:i,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function G0(c,i){const a=c.length;if(a<=1)return[c];const d=[];let p,y;for(let _=0;_<a;_++){const S=eo(c[_]);S!==0&&(c[_].area=Math.abs(S),y===void 0&&(y=S<0),y===S<0?(p&&d.push(p),p=[c[_]]):p.push(c[_]))}if(p&&d.push(p),i>1)for(let _=0;_<d.length;_++)d[_].length<=i||(Ko(d[_],i,1,d[_].length-1,Tre),d[_]=d[_].slice(0,i));return d}function Tre(c,i){return i.area-c.area}function yz(c,i,a=1){if(!c)return null;const d=typeof c=="string"?Cs.from(c).getPrimary():c.getPrimary(),p=typeof c=="string"?null:c.getSecondary();for(const y of[d,p]){if(!y)continue;const _=y.id.toString();i.has(_)||i.set(_,[]),y.scaleSelf(a),i.get(_).push(y)}return{primary:d.toString(),secondary:p?p.toString():null}}function eI(c,i,a,d){const p=d.patternDependencies;let y=!1;for(const _ of i){const S=_.paint.get(`${c}-pattern`);S.isConstant()||(y=!0),yz(S.constantOr(null),p,a)&&(y=!0)}return y}function tI(c,i,a,d,p,y){const _=y.patternDependencies;for(const S of i){const A=S.paint.get(`${c}-pattern`).value;if(A.kind!=="constant"){let C=A.evaluate({zoom:d},a,{},y.availableImages);C=C&&C.name?C.name:C;const R=yz(C,_,p);if(!R)continue;const{primary:D,secondary:j}=R;D&&(a.patterns[S.id]=[D,j].filter(Boolean))}}return a}class _z{constructor(){this.polygons=new Map}add(i,...a){this.polygons.has(i)?this.polygons.get(i).push(...a):this.polygons.set(i,a)}merge(i){for(const[a,d]of i.polygons)this.add(a,...d)}}class bp{constructor(){this.portals=[]}static evaluate(i){if(i.length===0)return new bp;let a=[];for(const C of i)a.push(...C.portals);if(a.length===0)return new bp;const d=(C,R)=>C<=0&&R<=0||C>=Lt&&R>=Lt;for(const C of a){const R=C.va,D=C.vb;(d(R.x,D.x)||d(R.y,D.y))&&(C.type="border")}const p=a.filter(C=>C.type!=="unevaluated"),y=a.filter(C=>C.type==="unevaluated");if(y.length===0)return new bp;y.sort((C,R)=>C.hash===R.hash?C.isTunnel===R.isTunnel?0:C.isTunnel?-1:1:C.hash<R.hash?1:-1),a=p.concat(y);let _=p.length,S=_,A=_;do if(S++,S===a.length||a[_].hash!==a[S].hash){if(S-_==2){A<_&&(a[A]=a[_],a[_]=null);const C=a[A],R=a[S-1];C.type=C.isTunnel!==R.isTunnel?"tunnel":"polygon",C.connection={a:C.connection.a,b:R.connection.a},A++}_=S}while(_!==a.length);return a.splice(A),a.sort((C,R)=>C.hash<R.hash?1:-1),{portals:a}}}Wt(bp,"ElevationPortalGraph"),Wt(_z,"ElevationPolygons");class Ere{constructor(i,a,d){this.outPositions=i,this.outNormals=a,this.outIndices=d,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(i,a,d){let p=i[2];d!=null&&(p*=d);const y=this.getVec3Bits(i)<<96n|this.getVec3Bits(a),_=this.vertexLookup.get(y);if(_!=null)return _;const S=this.outPositions.length;this.vertexLookup.set(y,S);const A=Math.trunc(16384*a[0]),C=Math.trunc(16384*a[1]),R=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(i[0],i[1],p),this.outNormals.emplaceBack(A,C,R),S}addTriangle(i,a,d){this.outIndices.emplaceBack(i,a,d)}addTriangles(i,a,d){if(i.length===0)return;const p=d.length===1,y=Me(),_=Me();for(let S=0;S<i.length;S+=3){const A=a[i[S+0]],C=a[i[S+1]],R=a[i[S+2]],D=p?d[0]:d[i[S+1]],j=p?d[0]:d[i[S+2]];Qe(y,A.x,A.y,p?d[0]:d[i[S+0]]);const H=this.addVertex(y,_);Qe(y,C.x,C.y,D);const W=this.addVertex(y,_);Qe(y,R.x,R.y,j);const J=this.addVertex(y,_);this.outIndices.emplaceBack(H,W,J)}}addQuad(i,a,d,p,y,_){const S=this.addVertex(i,y,_),A=this.addVertex(a,y,_),C=this.addVertex(d,y,_),R=this.addVertex(p,y,_);this.addTriangle(S,A,C),this.addTriangle(C,R,S)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(i){return this.view.setFloat32(0,i),BigInt(this.view.getUint32(0))}getVec3Bits(i){return this.getBits(i[0])<<64n|this.getBits(i[1])<<32n|this.getBits(i[2])}}class ua{constructor(i,a,d,p){this.unevaluatedPortals=new bp,this.portalPolygons=new _z,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new v0,this.vertexNormals=new x0,this.indexArray=new ii,this.tileToMeters=Se(i),this.bridgeProgramConfigurations=new oa(a,{zoom:d,lut:p},y=>y!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new oa(a,{zoom:d,lut:p},y=>y!=="fill-bridge-guard-rail-color")}addVertices(i,a){const d=this.unevalVertices.length;for(let p=0;p<i.length;p++)this.unevalVertices.push(i[p]),this.unevalHeights.push(a[p]);return d}addTriangles(i,a,d){const p=d?this.unevalTunnelTriangles:this.unevalTriangles;for(const y of i)p.push(y+a)}addRenderableRing(i,a,d,p,y,_){const S=[new ut(y.min.x,y.min.y),new ut(y.max.x,y.min.y),new ut(y.max.x,y.max.y),new ut(y.min.x,y.max.y)];for(let A=0;A<d-1;A++){const C=a+A,R=C+1,D=this.unevalVertices[C],j=this.unevalVertices[R];if(!(D.x>=y.min.x&&D.x<=y.max.x&&D.y>=y.min.y&&D.y<=y.max.y||j.x>=y.min.x&&j.x<=y.max.x&&j.y>=y.min.y&&j.y<=y.max.y||gi(D,j,S))||this.isOnBorder(D.x,j.x)||this.isOnBorder(D.y,j.y))continue;const H=ua.computeEdgeHash(this.unevalVertices[C],this.unevalVertices[R]);let W,J=this.vertexHashLookup.get(ua.computePosHash(D));J!=null?W=J.next:(J=this.vertexHashLookup.get(ua.computePosHash(j)),W=J!=null?J.prev:H),this.unevalEdges.push({polygonIdx:i,a:C,b:R,hash:H,portalHash:W,isTunnel:p,type:"unevaluated",featureInfo:_})}}addPortalCandidates(i,a,d,p,y){if(a.length===0)return;this.portalPolygons.add(i,{geometry:a,zLevel:y});const _=a[0];this.vertexHashLookup.clear();let S=ua.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let A=0;A<_.length-1;A++){const C=_[A+0],R=_[A+1],D=cs(R.x-C.x,R.y-C.y),j=Ts(D);if(j===0)continue;let H="unevaluated";const W=p.pointElevation(C),J=p.pointElevation(R);Math.abs(W)<.01&&Math.abs(J)<.01?H="entrance":(this.isOnBorder(C.x,R.x)||this.isOnBorder(C.y,R.y))&&(H="border");const te=ua.computeEdgeHash(C,R);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:C,vb:R,vab:D,length:j,hash:te,isTunnel:d,type:H});const ae=ua.computePosHash(C);this.vertexHashLookup.set(ae,{prev:S,next:te}),S=te}}construct(i){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),d=j=>{j.primitiveLength=this.indexArray.length-j.primitiveOffset},p=new Ere(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const y=a(),_=a(),S=a(),A=(j,H)=>{j.sort((J,te)=>J.type===H&&te.type!==H?-1:J.type!==H&&te.type===H?1:0);const W=j.findIndex(J=>J.type!==H);return W>=0?W:j.length};let C=0;this.unevalEdges.length>0&&(C=A(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters)),d(S);const R=a(),D=a();if(this.unevalEdges.length>0){const j=this.unevalEdges.splice(C),H=A(j,"tunnel")+C;this.unevalEdges.push(...j),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:H})}d(R),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),d(D),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),d(_),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),d(y),this.maskSegments=ci.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=ci.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=ci.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.renderableTunnelSegments=ci.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.shadowCasterSegments=ci.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength)}update(i,a,d,p,y,_,S,A){this.bridgeProgramConfigurations.updatePaintArrays(i,a,y,d,p,_,S,A),this.tunnelProgramConfigurations.updatePaintArrays(i,a,y,d,p,_,S,A)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,fre.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,pre.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,a,d,p,y){const _=(S,A)=>{for(let C=0;C<A.length-1;C++){const R=A[C].featureIndex,D=A[C+1].vertexStart,j=i.feature(R);S.populatePaintArrays(D,j,R,{},d,a,p,void 0,y)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,a,d,p,y){const _=new Map;for(let S=p;S<y;S++){const A=d[S],C=A.a,R=A.b,D=ua.computePosHash(i[C]),j=ua.computePosHash(i[R]);let H=_.get(D);H||(H={},_.set(D,H));let W=_.get(j);W||(W={},_.set(j,W)),a[C]<=0&&a[R]<=0||(H.to=R,W.from=C)}return _}isTerminalVertex(i,a){const d=ua.computePosHash(this.unevalVertices[i]),p=a.get(d);return!p||!p.from||!p.to}constructBridgeStructures(i,a,d,p,y,_){i.clearVertexLookup();const S=this.computeVertexConnections(a,d,p,y.min,y.max),A=1/_,C=.5*A,R=(wt,At)=>Qe(wt,a[At].x,a[At].y,d[At]*A),D=Me(),j=Me(),H=Me(),W=Me(),J=Me(),te=(wt,At)=>{const at=S.get(ua.computePosHash(a[At])),St=at.from,He=at.to;if(!St||!He)return;R(D,St),R(j,At),R(H,He),Pn(W),Hr(D,j)||(Yr(J,j,D),Er(W,J)),Hr(H,j)||(Yr(J,H,j),Je(W,W,Er(J,J)));const lt=Si(W);return lt>0?_t(wt,W,1/lt):void 0};let ae=Number.POSITIVE_INFINITY;this.sortSubarray(p,y.min,y.max,(wt,At)=>wt.featureInfo.featureIndex-At.featureInfo.featureIndex);const de=Me(),he=Me(),me=Me(),ke=Me(),Ee=Me(),Pe=Me(),Ne=Me(),Be=Me(),ct=Me(),Ue=[Me(),Me(),Me(),Me()],dt=[Me(),Me(),Me(),Me()],Ct=[{coord:new ut(0,0),height:0},{coord:new ut(0,0),height:0}],mt=(wt,At)=>wt>At;for(let wt=y.min;wt<y.max;wt++){const At=p[wt];if(!At.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Ct,a,d,At,mt))continue;const[at,St]=Ct;if(Qe(de,at.coord.x,at.coord.y,A*at.height),Qe(he,St.coord.x,St.coord.y,A*St.height),Hr(de,he))continue;Yr(me,he,de),Er(me,me);const He=te(Be,At.a)||me,lt=te(ct,At.b)||me;Qe(ke,He[1],-He[0],0),Er(ke,ke),Qe(Ee,lt[1],-lt[0],0),Er(Ee,Ee),Pr(Be,ke,He),Er(Pe,Be),Pr(Be,Ee,lt),Er(Ne,Be),Je(Ue[0],de,_t(Be,Yr(Be,ke,Pe),C)),Je(Ue[1],de,_t(Be,Je(Be,ke,Pe),C)),Je(Ue[2],de,_t(Be,Pe,C)),Ue[3]=de,Je(dt[0],he,_t(Be,Yr(Be,Ee,Ne),C)),Je(dt[1],he,_t(Be,Je(Be,Ee,Ne),C)),Je(dt[2],he,_t(Be,Ne,C)),dt[3]=he,ae=this.addFeatureSection(At.featureInfo.featureIndex,ae,this.bridgeFeatureSections,i);const kt=i.addVertex(Ue[0],ke,_),Tt=i.addVertex(Ue[1],ke,_),tr=i.addVertex(dt[0],Ee,_),Zt=i.addVertex(dt[1],Ee,_);i.addTriangle(kt,Tt,tr),i.addTriangle(Tt,Zt,tr);const xt=i.addVertex(Ue[1],Pe,_),Et=i.addVertex(Ue[2],Pe,_),Yt=i.addVertex(dt[1],Ne,_),Vt=i.addVertex(dt[2],Ne,_);i.addTriangle(xt,Et,Yt),i.addTriangle(Et,Vt,Yt),Kr(ke,ke),Kr(Ee,Ee);const jt=i.addVertex(Ue[2],ke,_),Gt=i.addVertex(Ue[3],ke,_),hr=i.addVertex(dt[2],Ee,_),vr=i.addVertex(dt[3],Ee,_);i.addTriangle(jt,Gt,hr),i.addTriangle(Gt,vr,hr);const Cr=this.isTerminalVertex(At.a,S),Tr=this.isTerminalVertex(At.b,S);at.height<.01&&Cr&&i.addQuad(Ue[3],Ue[2],Ue[1],Ue[0],Kr(He,He),_),St.height<.01&&Tr&&i.addQuad(dt[0],dt[1],dt[2],dt[3],lt,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,a,d,p,y,_){i.clearVertexLookup();let S=Number.POSITIVE_INFINITY;const A=(ae,de)=>ae.featureInfo.featureIndex-de.featureInfo.featureIndex;this.sortSubarray(p,y.min,y.max,A),this.sortSubarray(p,_.min,_.max,A);const C=ae=>Er(ae,ae),R=[{coord:new ut(0,0),height:0},{coord:new ut(0,0),height:0}],D=(ae,de)=>ae<de,j=Me(),H=Me(),W=Me(),J=Me(),te=Me();for(let ae=y.min;ae<y.max;ae++){if(!this.prepareEdgePoints(R,a,d,p[ae],D))continue;const[de,he]=R,me=C(Qe(te,-(he.coord.y-de.coord.y),he.coord.x-de.coord.x,0));S=this.addFeatureSection(p[ae].featureInfo.featureIndex,S,this.tunnelFeatureSections,i),i.addQuad(Qe(j,de.coord.x,de.coord.y,de.height),Qe(H,he.coord.x,he.coord.y,he.height),Qe(W,he.coord.x,he.coord.y,p[ae].isTunnel?-.1:0),Qe(J,de.coord.x,de.coord.y,p[ae].isTunnel?-.1:0),me)}for(let ae=_.min;ae<_.max;ae++){const de=p[ae];de.isTunnel&&([de.a,de.b]=[de.b,de.a]);const he=a[de.a],me=a[de.b],ke=C(Qe(te,-(me.y-he.y),me.x-he.x,0));S=this.addFeatureSection(de.featureInfo.featureIndex,S,this.tunnelFeatureSections,i),i.addQuad(Qe(j,me.x,me.y,0),Qe(H,he.x,he.y,0),Qe(W,he.x,he.y,d[de.a]+4),Qe(J,me.x,me.y,d[de.b]+4),ke),i.addQuad(Qe(j,he.x,he.y,0),Qe(H,me.x,me.y,0),Qe(W,me.x,me.y,d[de.b]+4),Qe(J,he.x,he.y,d[de.a]+4),ke)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,a,d,p){i.coord.x=a,i.coord.y=d,i.height=p}prepareEdgePoints(i,a,d,p,y){let _=a[p.a].x,S=a[p.a].y,A=a[p.b].x,C=a[p.b].y,R=d[p.a],D=d[p.b];const j=y(R,0),H=y(D,0);if(j&&H)return this.setElevatedPoint(i[0],_,S,R),this.setElevatedPoint(i[1],A,C,D),!0;if(!j&&!H)return!1;if(j){if(!H){const W=D/(D-R);A=lr(A,_,W),C=lr(C,S,W),D=lr(D,R,W)}}else{const W=R/(R-D);_=lr(_,A,W),S=lr(S,C,W),R=lr(R,D,W)}return this.setElevatedPoint(i[0],_,S,R),this.setElevatedPoint(i[1],A,C,D),!0}prepareEdges(i,a){if(a.length===0)return;a.sort((S,A)=>S.hash===A.hash?A.polygonIdx-S.polygonIdx:A.hash>S.hash?1:-1);let d=0,p=0,y=0,_=a[d].polygonIdx;do p++,(p===a.length||a[d].hash!==a[p].hash)&&((p-d==1||a[p-1].polygonIdx!==_)&&(y<d&&(a[y]=a[d],a[d]=null),a[y].type="none",y++),d=p,d!==a.length&&(_=a[d].polygonIdx));while(d!==a.length);if(a.splice(y),a.length!==0&&i.length!==0){a.sort((C,R)=>C.portalHash<R.portalHash?1:-1);let S=0,A=0;for(;S!==a.length&&A!==i.length;){const C=a[S],R=i[A];C.portalHash>R.hash?S++:R.hash>C.portalHash?A++:(C.type=R.type,S++)}}}isOnBorder(i,a){return i<=0&&a<=0||i>=Lt&&a>=Lt}addFeatureSection(i,a,d,p){return i!==a&&(a=i,d.push({featureIndex:i,vertexStart:p.getVertexCount()}),p.clearVertexLookup()),a}sortSubarray(i,a,d,p){const y=i.slice(a,d);y.sort(p),i.splice(a,y.length,...y)}static computeEdgeHash(i,a){return(i.y===a.y&&i.x>a.x||i.y>a.y)&&([i,a]=[a,i]),BigInt(ua.computePosHash(i))<<32n|BigInt(ua.computePosHash(a))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}var vz,xz={exports:{}},bz=(vz||(vz=1,function(c,i){(function(a){function d(_e,ve){return _e>ve?1:_e<ve?-1:0}var p=function(_e,ve){_e===void 0&&(_e=d),ve===void 0&&(ve=!1),this._compare=_e,this._root=null,this._size=0,this._noDuplicates=!!ve},y={size:{configurable:!0}};function _(_e,ve,ot,Rt,zt){var Nt=zt-Rt;if(Nt>0){var Xt=Rt+Math.floor(Nt/2),gr={key:ve[Xt],data:ot[Xt],parent:_e};return gr.left=_(gr,ve,ot,Rt,Xt),gr.right=_(gr,ve,ot,Xt+1,zt),gr}return null}function S(_e,ve,ot,Rt,zt){if(!(ot>=Rt)){for(var Nt=_e[ot+Rt>>1],Xt=ot-1,gr=Rt+1;;){do Xt++;while(zt(_e[Xt],Nt)<0);do gr--;while(zt(_e[gr],Nt)>0);if(Xt>=gr)break;var Vr=_e[Xt];_e[Xt]=_e[gr],_e[gr]=Vr,Vr=ve[Xt],ve[Xt]=ve[gr],ve[gr]=Vr}S(_e,ve,ot,gr,zt),S(_e,ve,gr+1,Rt,zt)}}p.prototype.rotateLeft=function(_e){var ve=_e.right;ve&&(_e.right=ve.left,ve.left&&(ve.left.parent=_e),ve.parent=_e.parent),_e.parent?_e===_e.parent.left?_e.parent.left=ve:_e.parent.right=ve:this._root=ve,ve&&(ve.left=_e),_e.parent=ve},p.prototype.rotateRight=function(_e){var ve=_e.left;ve&&(_e.left=ve.right,ve.right&&(ve.right.parent=_e),ve.parent=_e.parent),_e.parent?_e===_e.parent.left?_e.parent.left=ve:_e.parent.right=ve:this._root=ve,ve&&(ve.right=_e),_e.parent=ve},p.prototype._splay=function(_e){for(;_e.parent;){var ve=_e.parent;ve.parent?ve.left===_e&&ve.parent.left===ve?(this.rotateRight(ve.parent),this.rotateRight(ve)):ve.right===_e&&ve.parent.right===ve?(this.rotateLeft(ve.parent),this.rotateLeft(ve)):ve.left===_e&&ve.parent.right===ve?(this.rotateRight(ve),this.rotateLeft(ve)):(this.rotateLeft(ve),this.rotateRight(ve)):ve.left===_e?this.rotateRight(ve):this.rotateLeft(ve)}},p.prototype.splay=function(_e){for(var ve,ot,Rt,zt,Nt;_e.parent;)(ot=(ve=_e.parent).parent)&&ot.parent?((Rt=ot.parent).left===ot?Rt.left=_e:Rt.right=_e,_e.parent=Rt):(_e.parent=null,this._root=_e),zt=_e.left,Nt=_e.right,_e===ve.left?(ot&&(ot.left===ve?(ve.right?(ot.left=ve.right,ot.left.parent=ot):ot.left=null,ve.right=ot,ot.parent=ve):(zt?(ot.right=zt,zt.parent=ot):ot.right=null,_e.left=ot,ot.parent=_e)),Nt?(ve.left=Nt,Nt.parent=ve):ve.left=null,_e.right=ve,ve.parent=_e):(ot&&(ot.right===ve?(ve.left?(ot.right=ve.left,ot.right.parent=ot):ot.right=null,ve.left=ot,ot.parent=ve):(Nt?(ot.left=Nt,Nt.parent=ot):ot.left=null,_e.right=ot,ot.parent=_e)),zt?(ve.right=zt,zt.parent=ve):ve.right=null,_e.left=ve,ve.parent=_e)},p.prototype.replace=function(_e,ve){_e.parent?_e===_e.parent.left?_e.parent.left=ve:_e.parent.right=ve:this._root=ve,ve&&(ve.parent=_e.parent)},p.prototype.minNode=function(_e){if(_e===void 0&&(_e=this._root),_e)for(;_e.left;)_e=_e.left;return _e},p.prototype.maxNode=function(_e){if(_e===void 0&&(_e=this._root),_e)for(;_e.right;)_e=_e.right;return _e},p.prototype.insert=function(_e,ve){var ot=this._root,Rt=null,zt=this._compare;if(this._noDuplicates)for(;ot;){if(Rt=ot,zt(ot.key,_e)===0)return;ot=zt(ot.key,_e)<0?ot.right:ot.left}else for(;ot;)Rt=ot,ot=zt(ot.key,_e)<0?ot.right:ot.left;return ot={key:_e,data:ve,left:null,right:null,parent:Rt},Rt?zt(Rt.key,ot.key)<0?Rt.right=ot:Rt.left=ot:this._root=ot,this.splay(ot),this._size++,ot},p.prototype.find=function(_e){for(var ve=this._root,ot=this._compare;ve;){var Rt=ot(ve.key,_e);if(Rt<0)ve=ve.right;else{if(!(Rt>0))return ve;ve=ve.left}}return null},p.prototype.contains=function(_e){for(var ve=this._root,ot=this._compare;ve;){var Rt=ot(_e,ve.key);if(Rt===0)return!0;ve=Rt<0?ve.left:ve.right}return!1},p.prototype.remove=function(_e){var ve=this.find(_e);if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var ot=this.minNode(ve.right);ot.parent!==ve&&(this.replace(ot,ot.right),ot.right=ve.right,ot.right.parent=ot),this.replace(ve,ot),ot.left=ve.left,ot.left.parent=ot}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},p.prototype.removeNode=function(_e){if(!_e)return!1;if(this.splay(_e),_e.left)if(_e.right){var ve=this.minNode(_e.right);ve.parent!==_e&&(this.replace(ve,ve.right),ve.right=_e.right,ve.right.parent=ve),this.replace(_e,ve),ve.left=_e.left,ve.left.parent=ve}else this.replace(_e,_e.left);else this.replace(_e,_e.right);return this._size--,!0},p.prototype.erase=function(_e){var ve=this.find(_e);if(ve){this.splay(ve);var ot=ve.left,Rt=ve.right,zt=null;ot&&(ot.parent=null,zt=this.maxNode(ot),this.splay(zt),this._root=zt),Rt&&(ot?zt.right=Rt:this._root=Rt,Rt.parent=zt),this._size--}},p.prototype.pop=function(){var _e=this._root,ve=null;if(_e){for(;_e.left;)_e=_e.left;ve={key:_e.key,data:_e.data},this.remove(_e.key)}return ve},p.prototype.next=function(_e){var ve=_e;if(ve)if(ve.right)for(ve=ve.right;ve&&ve.left;)ve=ve.left;else for(ve=_e.parent;ve&&ve.right===_e;)_e=ve,ve=ve.parent;return ve},p.prototype.prev=function(_e){var ve=_e;if(ve)if(ve.left)for(ve=ve.left;ve&&ve.right;)ve=ve.right;else for(ve=_e.parent;ve&&ve.left===_e;)_e=ve,ve=ve.parent;return ve},p.prototype.forEach=function(_e){for(var ve=this._root,ot=[],Rt=!1,zt=0;!Rt;)ve?(ot.push(ve),ve=ve.left):ot.length>0?(_e(ve=ot.pop(),zt++),ve=ve.right):Rt=!0;return this},p.prototype.range=function(_e,ve,ot,Rt){for(var zt=[],Nt=this._compare,Xt=this._root;zt.length!==0||Xt;)if(Xt)zt.push(Xt),Xt=Xt.left;else{if(Nt((Xt=zt.pop()).key,ve)>0)break;if(Nt(Xt.key,_e)>=0&&ot.call(Rt,Xt))return this;Xt=Xt.right}return this},p.prototype.keys=function(){for(var _e=this._root,ve=[],ot=[],Rt=!1;!Rt;)_e?(ve.push(_e),_e=_e.left):ve.length>0?(_e=ve.pop(),ot.push(_e.key),_e=_e.right):Rt=!0;return ot},p.prototype.values=function(){for(var _e=this._root,ve=[],ot=[],Rt=!1;!Rt;)_e?(ve.push(_e),_e=_e.left):ve.length>0?(_e=ve.pop(),ot.push(_e.data),_e=_e.right):Rt=!0;return ot},p.prototype.at=function(_e){for(var ve=this._root,ot=[],Rt=!1,zt=0;!Rt;)if(ve)ot.push(ve),ve=ve.left;else if(ot.length>0){if(ve=ot.pop(),zt===_e)return ve;zt++,ve=ve.right}else Rt=!0;return null},p.prototype.load=function(_e,ve,ot){if(_e===void 0&&(_e=[]),ve===void 0&&(ve=[]),ot===void 0&&(ot=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Rt=_e.length;return ot&&S(_e,ve,0,Rt-1,this._compare),this._root=_(null,_e,ve,0,Rt),this._size=Rt,this},p.prototype.min=function(){var _e=this.minNode(this._root);return _e?_e.key:null},p.prototype.max=function(){var _e=this.maxNode(this._root);return _e?_e.key:null},p.prototype.isEmpty=function(){return this._root===null},y.size.get=function(){return this._size},p.createTree=function(_e,ve,ot,Rt,zt){return new p(ot,zt).load(_e,ve,Rt)},Object.defineProperties(p.prototype,y);var A=0,C=1,R=2,D=3,j=0,H=1,W=2,J=3;function te(_e,ve,ot){ve===null?(_e.inOut=!1,_e.otherInOut=!0):(_e.isSubject===ve.isSubject?(_e.inOut=!ve.inOut,_e.otherInOut=ve.otherInOut):(_e.inOut=!ve.otherInOut,_e.otherInOut=ve.isVertical()?!ve.inOut:ve.inOut),ve&&(_e.prevInResult=!ae(ve,ot)||ve.isVertical()?ve.prevInResult:ve));var Rt=ae(_e,ot);_e.resultTransition=Rt?function(zt,Nt){var Xt,gr=!zt.inOut,Vr=!zt.otherInOut;switch(Nt){case j:Xt=gr&&Vr;break;case H:Xt=gr||Vr;break;case J:Xt=gr^Vr;break;case W:Xt=zt.isSubject?gr&&!Vr:Vr&&!gr}return Xt?1:-1}(_e,ot):0}function ae(_e,ve){switch(_e.type){case A:switch(ve){case j:return!_e.otherInOut;case H:return _e.otherInOut;case W:return _e.isSubject&&_e.otherInOut||!_e.isSubject&&!_e.otherInOut;case J:return!0}break;case R:return ve===j||ve===H;case D:return ve===W;case C:return!1}return!1}var de=function(_e,ve,ot,Rt,zt){this.left=ve,this.point=_e,this.otherEvent=ot,this.isSubject=Rt,this.type=zt||A,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},he={inResult:{configurable:!0}};function me(_e,ve){return _e[0]===ve[0]&&_e[1]===ve[1]}de.prototype.isBelow=function(_e){var ve=this.point,ot=this.otherEvent.point;return this.left?(ve[0]-_e[0])*(ot[1]-_e[1])-(ot[0]-_e[0])*(ve[1]-_e[1])>0:(ot[0]-_e[0])*(ve[1]-_e[1])-(ve[0]-_e[0])*(ot[1]-_e[1])>0},de.prototype.isAbove=function(_e){return!this.isBelow(_e)},de.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},he.inResult.get=function(){return this.resultTransition!==0},de.prototype.clone=function(){var _e=new de(this.point,this.left,this.otherEvent,this.isSubject,this.type);return _e.contourId=this.contourId,_e.resultTransition=this.resultTransition,_e.prevInResult=this.prevInResult,_e.isExteriorRing=this.isExteriorRing,_e.inOut=this.inOut,_e.otherInOut=this.otherInOut,_e},Object.defineProperties(de.prototype,he);var ke=11102230246251565e-32,Ee=134217729,Pe=(3+8*ke)*ke;function Ne(_e,ve,ot,Rt,zt){var Nt,Xt,gr,Vr,Ur=ve[0],Or=Rt[0],Dn=0,pi=0;Or>Ur==Or>-Ur?(Nt=Ur,Ur=ve[++Dn]):(Nt=Or,Or=Rt[++pi]);var Ir=0;if(Dn<_e&&pi<ot)for(Or>Ur==Or>-Ur?(gr=Nt-((Xt=Ur+Nt)-Ur),Ur=ve[++Dn]):(gr=Nt-((Xt=Or+Nt)-Or),Or=Rt[++pi]),Nt=Xt,gr!==0&&(zt[Ir++]=gr);Dn<_e&&pi<ot;)Or>Ur==Or>-Ur?(gr=Nt-((Xt=Nt+Ur)-(Vr=Xt-Nt))+(Ur-Vr),Ur=ve[++Dn]):(gr=Nt-((Xt=Nt+Or)-(Vr=Xt-Nt))+(Or-Vr),Or=Rt[++pi]),Nt=Xt,gr!==0&&(zt[Ir++]=gr);for(;Dn<_e;)gr=Nt-((Xt=Nt+Ur)-(Vr=Xt-Nt))+(Ur-Vr),Ur=ve[++Dn],Nt=Xt,gr!==0&&(zt[Ir++]=gr);for(;pi<ot;)gr=Nt-((Xt=Nt+Or)-(Vr=Xt-Nt))+(Or-Vr),Or=Rt[++pi],Nt=Xt,gr!==0&&(zt[Ir++]=gr);return Nt===0&&Ir!==0||(zt[Ir++]=Nt),Ir}function Be(_e){return new Float64Array(_e)}var ct=33306690738754716e-32,Ue=22204460492503146e-32,dt=11093356479670487e-47,Ct=Be(4),mt=Be(8),wt=Be(12),At=Be(16),at=Be(4);function St(_e,ve,ot){var Rt=function(zt,Nt,Xt,gr,Vr,Ur){var Or=(Nt-Ur)*(Xt-Vr),Dn=(zt-Vr)*(gr-Ur),pi=Or-Dn;if(Or===0||Dn===0||Or>0!=Dn>0)return pi;var Ir=Math.abs(Or+Dn);return Math.abs(pi)>=ct*Ir?pi:-function(ti,Gn,En,hi,Jn,Hn,Xn){var On,kr,Ln,di,fr,en,Qn,yi,ri,qi,zn,$i,Vs,$o,ko,Us,iu,Zi,lo=ti-Jn,Vo=En-Jn,gs=Gn-Hn,Qo=hi-Hn;Ct[0]=(ko=(yi=lo-(Qn=(en=Ee*lo)-(en-lo)))*(qi=Qo-(ri=(en=Ee*Qo)-(en-Qo)))-(($o=lo*Qo)-Qn*ri-yi*ri-Qn*qi))-((zn=ko-(iu=(yi=gs-(Qn=(en=Ee*gs)-(en-gs)))*(qi=Vo-(ri=(en=Ee*Vo)-(en-Vo)))-((Us=gs*Vo)-Qn*ri-yi*ri-Qn*qi)))+(fr=ko-zn))+(fr-iu),Ct[1]=(Vs=$o-(($i=$o+zn)-(fr=$i-$o))+(zn-fr))-((zn=Vs-Us)+(fr=Vs-zn))+(fr-Us),Ct[2]=$i-((Zi=$i+zn)-(fr=Zi-$i))+(zn-fr),Ct[3]=Zi;var Md=function(RGe,R5){for(var D5=R5[0],sM=1;sM<4;sM++)D5+=R5[sM];return D5}(0,Ct),bx=Ue*Xn;if(Md>=bx||-Md>=bx||(On=ti-(lo+(fr=ti-lo))+(fr-Jn),Ln=En-(Vo+(fr=En-Vo))+(fr-Jn),kr=Gn-(gs+(fr=Gn-gs))+(fr-Hn),di=hi-(Qo+(fr=hi-Qo))+(fr-Hn),On===0&&kr===0&&Ln===0&&di===0)||(bx=dt*Xn+Pe*Math.abs(Md),(Md+=lo*di+Qo*On-(gs*Ln+Vo*kr))>=bx||-Md>=bx))return Md;at[0]=(ko=(yi=On-(Qn=(en=Ee*On)-(en-On)))*(qi=Qo-(ri=(en=Ee*Qo)-(en-Qo)))-(($o=On*Qo)-Qn*ri-yi*ri-Qn*qi))-((zn=ko-(iu=(yi=kr-(Qn=(en=Ee*kr)-(en-kr)))*(qi=Vo-(ri=(en=Ee*Vo)-(en-Vo)))-((Us=kr*Vo)-Qn*ri-yi*ri-Qn*qi)))+(fr=ko-zn))+(fr-iu),at[1]=(Vs=$o-(($i=$o+zn)-(fr=$i-$o))+(zn-fr))-((zn=Vs-Us)+(fr=Vs-zn))+(fr-Us),at[2]=$i-((Zi=$i+zn)-(fr=Zi-$i))+(zn-fr),at[3]=Zi;var Eoe=Ne(4,Ct,4,at,mt);at[0]=(ko=(yi=lo-(Qn=(en=Ee*lo)-(en-lo)))*(qi=di-(ri=(en=Ee*di)-(en-di)))-(($o=lo*di)-Qn*ri-yi*ri-Qn*qi))-((zn=ko-(iu=(yi=gs-(Qn=(en=Ee*gs)-(en-gs)))*(qi=Ln-(ri=(en=Ee*Ln)-(en-Ln)))-((Us=gs*Ln)-Qn*ri-yi*ri-Qn*qi)))+(fr=ko-zn))+(fr-iu),at[1]=(Vs=$o-(($i=$o+zn)-(fr=$i-$o))+(zn-fr))-((zn=Vs-Us)+(fr=Vs-zn))+(fr-Us),at[2]=$i-((Zi=$i+zn)-(fr=Zi-$i))+(zn-fr),at[3]=Zi;var Aoe=Ne(Eoe,mt,4,at,wt);at[0]=(ko=(yi=On-(Qn=(en=Ee*On)-(en-On)))*(qi=di-(ri=(en=Ee*di)-(en-di)))-(($o=On*di)-Qn*ri-yi*ri-Qn*qi))-((zn=ko-(iu=(yi=kr-(Qn=(en=Ee*kr)-(en-kr)))*(qi=Ln-(ri=(en=Ee*Ln)-(en-Ln)))-((Us=kr*Ln)-Qn*ri-yi*ri-Qn*qi)))+(fr=ko-zn))+(fr-iu),at[1]=(Vs=$o-(($i=$o+zn)-(fr=$i-$o))+(zn-fr))-((zn=Vs-Us)+(fr=Vs-zn))+(fr-Us),at[2]=$i-((Zi=$i+zn)-(fr=Zi-$i))+(zn-fr),at[3]=Zi;var Poe=Ne(Aoe,wt,4,at,At);return At[Poe-1]}(zt,Nt,Xt,gr,Vr,Ur,Ir)}(_e[0],_e[1],ve[0],ve[1],ot[0],ot[1]);return Rt>0?-1:Rt<0?1:0}function He(_e,ve){var ot=_e.point,Rt=ve.point;return ot[0]>Rt[0]?1:ot[0]<Rt[0]?-1:ot[1]!==Rt[1]?ot[1]>Rt[1]?1:-1:function(zt,Nt,Xt,gr){return zt.left!==Nt.left?zt.left?1:-1:St(Xt,zt.otherEvent.point,Nt.otherEvent.point)!==0?zt.isBelow(Nt.otherEvent.point)?-1:1:!zt.isSubject&&Nt.isSubject?1:-1}(_e,ve,ot)}function lt(_e,ve,ot){var Rt=new de(ve,!1,_e,_e.isSubject),zt=new de(ve,!0,_e.otherEvent,_e.isSubject);return me(_e.point,_e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",_e),Rt.contourId=zt.contourId=_e.contourId,He(zt,_e.otherEvent)>0&&(_e.otherEvent.left=!0,zt.left=!1),_e.otherEvent.otherEvent=zt,_e.otherEvent=Rt,ot.push(zt),ot.push(Rt),ot}function kt(_e,ve){return _e[0]*ve[1]-_e[1]*ve[0]}function Tt(_e,ve){return _e[0]*ve[0]+_e[1]*ve[1]}function tr(_e,ve,ot){var Rt=function(Vr,Ur,Or,Dn,pi){var Ir=[Ur[0]-Vr[0],Ur[1]-Vr[1]],ti=[Dn[0]-Or[0],Dn[1]-Or[1]];function Gn(en,Qn,yi){return[en[0]+Qn*yi[0],en[1]+Qn*yi[1]]}var En=[Or[0]-Vr[0],Or[1]-Vr[1]],hi=kt(Ir,ti),Jn=hi*hi,Hn=Tt(Ir,Ir);if(Jn>0){var Xn=kt(En,ti)/hi;if(Xn<0||Xn>1)return null;var On=kt(En,Ir)/hi;return On<0||On>1?null:Xn===0||Xn===1?[Gn(Vr,Xn,Ir)]:On===0||On===1?[Gn(Or,On,ti)]:[Gn(Vr,Xn,Ir)]}if((Jn=(hi=kt(En,Ir))*hi)>0)return null;var kr=Tt(Ir,En)/Hn,Ln=kr+Tt(Ir,ti)/Hn,di=Math.min(kr,Ln),fr=Math.max(kr,Ln);return di<=1&&fr>=0?di===1?[Gn(Vr,di>0?di:0,Ir)]:fr===0?[Gn(Vr,fr<1?fr:1,Ir)]:[Gn(Vr,di>0?di:0,Ir),Gn(Vr,fr<1?fr:1,Ir)]:null}(_e.point,_e.otherEvent.point,ve.point,ve.otherEvent.point),zt=Rt?Rt.length:0;if(zt===0||zt===1&&(me(_e.point,ve.point)||me(_e.otherEvent.point,ve.otherEvent.point))||zt===2&&_e.isSubject===ve.isSubject)return 0;if(zt===1)return me(_e.point,Rt[0])||me(_e.otherEvent.point,Rt[0])||lt(_e,Rt[0],ot),me(ve.point,Rt[0])||me(ve.otherEvent.point,Rt[0])||lt(ve,Rt[0],ot),1;var Nt=[],Xt=!1,gr=!1;return me(_e.point,ve.point)?Xt=!0:He(_e,ve)===1?Nt.push(ve,_e):Nt.push(_e,ve),me(_e.otherEvent.point,ve.otherEvent.point)?gr=!0:He(_e.otherEvent,ve.otherEvent)===1?Nt.push(ve.otherEvent,_e.otherEvent):Nt.push(_e.otherEvent,ve.otherEvent),Xt&&gr||Xt?(ve.type=C,_e.type=ve.inOut===_e.inOut?R:D,Xt&&!gr&&lt(Nt[1].otherEvent,Nt[0].point,ot),2):gr?(lt(Nt[0],Nt[1].point,ot),3):Nt[0]!==Nt[3].otherEvent?(lt(Nt[0],Nt[1].point,ot),lt(Nt[1],Nt[2].point,ot),3):(lt(Nt[0],Nt[1].point,ot),lt(Nt[3].otherEvent,Nt[2].point,ot),3)}function Zt(_e,ve){if(_e===ve)return 0;if(St(_e.point,_e.otherEvent.point,ve.point)!==0||St(_e.point,_e.otherEvent.point,ve.otherEvent.point)!==0)return me(_e.point,ve.point)?_e.isBelow(ve.otherEvent.point)?-1:1:_e.point[0]===ve.point[0]?_e.point[1]<ve.point[1]?-1:1:He(_e,ve)===1?ve.isAbove(_e.point)?-1:1:_e.isBelow(ve.point)?-1:1;if(_e.isSubject!==ve.isSubject)return _e.isSubject?-1:1;var ot=_e.point,Rt=ve.point;return ot[0]===Rt[0]&&ot[1]===Rt[1]?(ot=_e.otherEvent.point)[0]===(Rt=ve.otherEvent.point)[0]&&ot[1]===Rt[1]?0:_e.contourId>ve.contourId?1:-1:He(_e,ve)===1?1:-1}var xt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Et(_e,ve,ot,Rt){var zt,Nt=_e+1,Xt=ve[_e].point,gr=ve.length;for(Nt<gr&&(zt=ve[Nt].point);Nt<gr&&zt[0]===Xt[0]&&zt[1]===Xt[1];){if(!ot[Nt])return Nt;++Nt<gr&&(zt=ve[Nt].point)}for(Nt=_e-1;ot[Nt]&&Nt>Rt;)Nt--;return Nt}xt.prototype.isExterior=function(){return this.holeOf==null};var Yt=jt,Vt=jt;function jt(_e,ve){if(!(this instanceof jt))return new jt(_e,ve);if(this.data=_e||[],this.length=this.data.length,this.compare=ve||Gt,this.length>0)for(var ot=(this.length>>1)-1;ot>=0;ot--)this._down(ot)}function Gt(_e,ve){return _e<ve?-1:_e>ve?1:0}jt.prototype={push:function(_e){this.data.push(_e),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var _e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),_e}},peek:function(){return this.data[0]},_up:function(_e){for(var ve=this.data,ot=this.compare,Rt=ve[_e];_e>0;){var zt=_e-1>>1,Nt=ve[zt];if(ot(Rt,Nt)>=0)break;ve[_e]=Nt,_e=zt}ve[_e]=Rt},_down:function(_e){for(var ve=this.data,ot=this.compare,Rt=this.length>>1,zt=ve[_e];_e<Rt;){var Nt=1+(_e<<1),Xt=Nt+1,gr=ve[Nt];if(Xt<this.length&&ot(ve[Xt],gr)<0&&(Nt=Xt,gr=ve[Xt]),ot(gr,zt)>=0)break;ve[_e]=gr,_e=Nt}ve[_e]=zt}},Yt.default=Vt;var hr=Math.max,vr=Math.min,Cr=0;function Tr(_e,ve,ot,Rt,zt,Nt){var Xt,gr,Vr,Ur,Or,Dn;for(Xt=0,gr=_e.length-1;Xt<gr;Xt++)if(Ur=_e[Xt+1],Or=new de(Vr=_e[Xt],!1,void 0,ve),Dn=new de(Ur,!1,Or,ve),Or.otherEvent=Dn,Vr[0]!==Ur[0]||Vr[1]!==Ur[1]){Or.contourId=Dn.contourId=ot,Nt||(Or.isExteriorRing=!1,Dn.isExteriorRing=!1),He(Or,Dn)>0?Dn.left=!0:Or.left=!0;var pi=Vr[0],Ir=Vr[1];zt[0]=vr(zt[0],pi),zt[1]=vr(zt[1],Ir),zt[2]=hr(zt[2],pi),zt[3]=hr(zt[3],Ir),Rt.push(Or),Rt.push(Dn)}}var Zr=[];function jr(_e,ve,ot){typeof _e[0][0][0]=="number"&&(_e=[_e]),typeof ve[0][0][0]=="number"&&(ve=[ve]);var Rt=function(Ir,ti,Gn){var En=null;return Ir.length*ti.length==0&&(Gn===j?En=Zr:Gn===W?En=Ir:Gn!==H&&Gn!==J||(En=Ir.length===0?ti:Ir)),En}(_e,ve,ot);if(Rt)return Rt===Zr?null:Rt;var zt=[1/0,1/0,-1/0,-1/0],Nt=[1/0,1/0,-1/0,-1/0],Xt=function(Ir,ti,Gn,En,hi){var Jn,Hn,Xn,On,kr,Ln,di=new Yt(null,He);for(Xn=0,On=Ir.length;Xn<On;Xn++)for(kr=0,Ln=(Jn=Ir[Xn]).length;kr<Ln;kr++)(Hn=kr===0)&&Cr++,Tr(Jn[kr],!0,Cr,di,Gn,Hn);for(Xn=0,On=ti.length;Xn<On;Xn++)for(kr=0,Ln=(Jn=ti[Xn]).length;kr<Ln;kr++)Hn=kr===0,hi===W&&(Hn=!1),Hn&&Cr++,Tr(Jn[kr],!1,Cr,di,En,Hn);return di}(_e,ve,zt,Nt,ot);if(Rt=function(Ir,ti,Gn,En,hi){var Jn=null;return(Gn[0]>En[2]||En[0]>Gn[2]||Gn[1]>En[3]||En[1]>Gn[3])&&(hi===j?Jn=Zr:hi===W?Jn=Ir:hi!==H&&hi!==J||(Jn=Ir.concat(ti))),Jn}(_e,ve,zt,Nt,ot))return Rt===Zr?null:Rt;for(var gr=function(Ir){var ti,Gn,En=function(Xn){var On,kr,Ln,di,fr=[];for(kr=0,Ln=Xn.length;kr<Ln;kr++)((On=Xn[kr]).left&&On.inResult||!On.left&&On.otherEvent.inResult)&&fr.push(On);for(var en=!1;!en;)for(en=!0,kr=0,Ln=fr.length;kr<Ln;kr++)kr+1<Ln&&He(fr[kr],fr[kr+1])===1&&(di=fr[kr],fr[kr]=fr[kr+1],fr[kr+1]=di,en=!1);for(kr=0,Ln=fr.length;kr<Ln;kr++)(On=fr[kr]).otherPos=kr;for(kr=0,Ln=fr.length;kr<Ln;kr++)(On=fr[kr]).left||(di=On.otherPos,On.otherPos=On.otherEvent.otherPos,On.otherEvent.otherPos=di);return fr}(Ir),hi={},Jn=[],Hn=function(){if(!hi[ti]){var Xn=Jn.length,On=function(fr,en,Qn){var yi=new xt;if(fr.prevInResult!=null){var ri=fr.prevInResult,qi=ri.outputContourId;if(ri.resultTransition>0){var zn=en[qi];if(zn.holeOf!=null){var $i=zn.holeOf;en[$i].holeIds.push(Qn),yi.holeOf=$i,yi.depth=en[qi].depth}else en[qi].holeIds.push(Qn),yi.holeOf=qi,yi.depth=en[qi].depth+1}else yi.holeOf=null,yi.depth=en[qi].depth}else yi.holeOf=null,yi.depth=0;return yi}(En[ti],Jn,Xn),kr=function(fr){hi[fr]=!0,fr<En.length&&En[fr]&&(En[fr].outputContourId=Xn)},Ln=ti,di=ti;for(On.points.push(En[ti].point);kr(Ln),kr(Ln=En[Ln].otherPos),On.points.push(En[Ln].point),!((Ln=Et(Ln,En,hi,di))==di||Ln>=En.length)&&En[Ln];);Jn.push(On)}};for(ti=0,Gn=En.length;ti<Gn;ti++)Hn();return Jn}(function(Ir,ti,Gn,En,hi,Jn){for(var Hn,Xn,On,kr=new p(Zt),Ln=[],di=Math.min(En[2],hi[2]);Ir.length!==0;){var fr=Ir.pop();if(Ln.push(fr),Jn===j&&fr.point[0]>di||Jn===W&&fr.point[0]>En[2])break;if(fr.left){Xn=Hn=kr.insert(fr),Hn=Hn!==(On=kr.minNode())?kr.prev(Hn):null,Xn=kr.next(Xn);var en=Hn?Hn.key:null;if(te(fr,en,Jn),Xn&&tr(fr,Xn.key,Ir)===2&&(te(fr,en,Jn),te(Xn.key,fr,Jn)),Hn&&tr(Hn.key,fr,Ir)===2){var Qn=Hn;te(en,(Qn=Qn!==On?kr.prev(Qn):null)?Qn.key:null,Jn),te(fr,en,Jn)}}else Xn=Hn=kr.find(fr=fr.otherEvent),Hn&&Xn&&(Hn=Hn!==On?kr.prev(Hn):null,Xn=kr.next(Xn),kr.remove(fr),Xn&&Hn&&tr(Hn.key,Xn.key,Ir))}return Ln}(Xt,0,0,zt,Nt,ot)),Vr=[],Ur=0;Ur<gr.length;Ur++){var Or=gr[Ur];if(Or.isExterior()){for(var Dn=[Or.points],pi=0;pi<Or.holeIds.length;pi++)Dn.push(gr[Or.holeIds[pi]].points);Vr.push(Dn)}}return Vr}var Yn={UNION:H,DIFFERENCE:W,INTERSECTION:j,XOR:J};a.diff=function(_e,ve){return jr(_e,ve,W)},a.intersection=function(_e,ve){return jr(_e,ve,j)},a.operations=Yn,a.union=function(_e,ve){return jr(_e,ve,H)},a.xor=function(_e,ve){return jr(_e,ve,J)},Object.defineProperty(a,"__esModule",{value:!0})})(i)}(0,xz.exports)),xz.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function bS(c,i,a,d){const p=[],y=d===0?(_,S,A,C,R,D)=>{_.push(new ut(D,A+(D-S)/(C-S)*(R-A)))}:(_,S,A,C,R,D)=>{_.push(new ut(S+(D-A)/(R-A)*(C-S),D))};for(const _ of c){const S=[];for(const A of _){if(A.length<=2)continue;const C=[];for(let j=0;j<A.length-1;j++){const H=A[j].x,W=A[j].y,J=A[j+1].x,te=A[j+1].y,ae=d===0?H:W,de=d===0?J:te;ae<i?de>i&&y(C,H,W,J,te,i):ae>a?de<a&&y(C,H,W,J,te,a):C.push(A[j]),de<i&&ae>=i&&y(C,H,W,J,te,i),de>a&&ae<=a&&y(C,H,W,J,te,a)}let R=A[A.length-1];const D=d===0?R.x:R.y;D>=i&&D<=a&&C.push(R),C.length&&(R=C[C.length-1],C[0].x===R.x&&C[0].y===R.y||C.push(C[0]),S.push(C))}S.length&&p.push(S)}return p}function Are(c,i){const a=rI(c),d=rI([i]),p=bz.intersection(a,d);return p==null?[]:wz(p)}function Pre(c,i){let d=rI(c,65536);for(;i.valid();i.next()){const[p,y]=i.get(),_=p.x*65536,S=p.y*65536,A=y.x*65536,C=y.y*65536,R=A-_,D=C-S,j=Math.hypot(R,D),H=Math.trunc(D/j*3),W=-Math.trunc(R/j*3);d=bz.diff(d,[[[_,S],[A,C],[A+H,C+W],[_+H,S+W],[_,S]]])}return wz(d,1/65536)}function rI(c,i=1){return[c.map(a=>a.map(d=>[d.x*i,d.y*i]))]}function wz(c,i=1){return c.map(a=>a.map((d,p)=>{const y=d.map(_=>new ut(_[0]*i,_[1]*i).round());return p>0&&y.reverse(),y}))}class nI{constructor(i,a){this.layoutVertexArray=new Os,this.indexArray=new ii,this.lineIndexArray=new xl,this.triangleSegments=new ci,this.lineSegments=new ci,this.programConfigurations=new oa(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new Xu)}update(i,a,d,p,y,_,S,A){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,S,A)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hre.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,dre.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,a,d,p,y,_,S){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,a,d,p,y,_,void 0,S)}}class iI{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new nI(i,!1),this.elevationBufferData=new nI(i,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,d,p){this.hasPattern=eI("fill",this.layers,this.pixelRatio,a);const y=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:S,id:A,index:C,sourceLayerIndex:R}of i){const D=this.layers[0]._featureFilter.needGeometry,j=st(S,D);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom,{worldview:this.worldview}),j,d))continue;const H=y?y.evaluate(j,{},d,a.availableImages):void 0,W={id:A,properties:S.properties,type:S.type,sourceLayerIndex:R,index:C,geometry:D?j.geometry:De(S,d,p),patterns:{},sortKey:H};_.push(W)}y&&_.sort((S,A)=>S.sortKey-A.sortKey);for(const S of _){const{geometry:A,index:C,sourceLayerIndex:R}=S;if(this.hasPattern){const D=tI("fill",this.layers,S,this.zoom,this.pixelRatio,a);this.patternFeatures.push(D)}else this.addFeature(S,A,C,d,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(i[C].feature,A,C,R,this.index)}}update(i,a,d,p,y,_,S){this.bufferData.update(i,a,d,p,y,_,S,this.worldview),this.elevationBufferData.update(i,a,d,p,y,_,S,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,a,d,p,y,_,S,this.worldview)}addFeatures(i,a,d,p,y,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,d,p,_,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,a,d,p,y,_=[],S,A){const C=G0(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,C,p,d,A):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(i,d,y,_,p,S,this.worldview),this.elevationBufferData.populatePaintArrays(i,d,y,_,p,S,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(i,a,d,p,y){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(a,d,p,y,this.worldview))}addElevatedRoadFeature(i,a,d,p,y){const _=new Array,S=ui.getElevationFeature(i,y);if(!S)return void this.addGeometry(a,this.bufferData);{const C=this.clipPolygonsToTile(a,1);C.length>0&&_.push({polygons:C,elevationFeature:S,elevationTileID:d})}const A={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},d),featureIndex:p};for(const C of _)if(C.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ua(C.elevationTileID,this.layers,this.zoom,this.lut));const D=C.elevationFeature.isTunnel();let j=0;i.properties.hasOwnProperty(rr)&&(j=+i.properties[rr]);for(const H of C.polygons)this.elevatedStructures.addPortalCandidates(C.elevationFeature.id,H,D,C.elevationFeature,j)}C.elevationFeature.constantHeight==null&&(C.polygons=this.prepareElevatedPolygons(C.polygons,C.elevationFeature,C.elevationTileID));const R=new rn(d,C.elevationTileID);this.addElevatedGeometry(C.polygons,R,C.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p,A)}}addElevatedGeometry(i,a,d,p,y,_){const S={elevation:d,elevationSampler:a,bias:p,index:y,featureInfo:_},[A,C]=this.addGeometry(i,this.elevationBufferData,S);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:A,max:C}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,A),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,C))}addGeometry(i,a,d){let p=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,_=null;d&&(_=d.elevationSampler.constantElevation(d.elevation,d.bias),_!=null&&(p=_,y=_));const S=(A,C,R)=>{if(d!=null)if(C.push(A),_!=null)a.elevatedLayoutVertexArray.emplaceBack(_),R.push(_);else{const D=d.elevationSampler.pointElevation(A,d.elevation,d.bias);a.elevatedLayoutVertexArray.emplaceBack(D),R.push(D),p=Math.min(p,D),y=Math.max(y,D)}};for(const A of i){let C=0;for(const he of A)C+=he.length;const R=a.triangleSegments.prepareSegment(C,a.layoutVertexArray,a.indexArray),D=R.vertexLength,j=[],H=[],W=[],J=[],te=[],ae=a.layoutVertexArray.length;for(const he of A){if(he.length===0)continue;he!==A[0]&&H.push(j.length/2);const me=a.lineSegments.prepareSegment(he.length,a.layoutVertexArray,a.lineIndexArray),ke=me.vertexLength;d&&te.push(a.layoutVertexArray.length-ae),S(he[0],W,J),a.layoutVertexArray.emplaceBack(he[0].x,he[0].y),a.lineIndexArray.emplaceBack(ke+he.length-1,ke),j.push(he[0].x),j.push(he[0].y);for(let Ee=1;Ee<he.length;Ee++)S(he[Ee],W,J),a.layoutVertexArray.emplaceBack(he[Ee].x,he[Ee].y),a.lineIndexArray.emplaceBack(ke+Ee-1,ke+Ee),j.push(he[Ee].x),j.push(he[Ee].y);me.vertexLength+=he.length,me.primitiveLength+=he.length}const de=Bg(j,H);for(let he=0;he<de.length;he+=3)a.indexArray.emplaceBack(D+de[he],D+de[he+1],D+de[he+2]);if(de.length>0&&d&&this.elevationMode==="hd-road-base"){const he=d.elevation.isTunnel(),me=d.elevation.safeArea,ke=this.elevatedStructures.addVertices(W,J);this.elevatedStructures.addTriangles(de,ke,he);const Ee=te.length;if(Ee>0){for(let Pe=0;Pe<Ee-1;Pe++)this.elevatedStructures.addRenderableRing(d.index,te[Pe]+ke,te[Pe+1]-te[Pe],he,me,d.featureInfo);this.elevatedStructures.addRenderableRing(d.index,te[Ee-1]+ke,W.length-te[Ee-1],he,me,d.featureInfo)}}R.vertexLength+=C,R.primitiveLength+=de.length/3}return[p,y]}prepareElevatedPolygons(i,a,d){const p=1/Se(d),y=[];for(const _ of i){const S=Pre(_,new Mn(a,p));y.push(...S)}return y}clipPolygonsToTile(i,a){const d=-a,p=-a,y=Lt+a,_=Lt+a;let S=0;const A=[],C=[];for(;S<i.length;S++){const j=i[S],H=kv(j);(H.min.x>=d&&H.max.x<=y&&H.min.y>=p&&H.max.y<=_?A:C).push(j)}if(A.length===i.length)return i;const R=[new ut(d,p),new ut(y,p),new ut(y,_),new ut(d,_),new ut(d,p)],D=A;for(const j of C)D.push(...Are(j,R));return D}}let Sz,Tz,Ez,Az;Wt(iI,"FillBucket",{omit:["layers","patternFeatures"]}),Wt(nI,"FillBufferData"),Wt(ua,"ElevatedStructures");class wS{constructor(i,a,d,p){if(this.triangleCount=a.length/3,this.min=new ut(0,0),this.max=new ut(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[y,_]=[i[0].clone(),i[0].clone()];for(let D=1;D<i.length;++D){const j=i[D];y.x=Math.min(y.x,j.x),y.y=Math.min(y.y,j.y),_.x=Math.max(_.x,j.x),_.y=Math.max(_.y,j.y)}if(p){const D=Math.ceil(Math.max(_.x-y.x,_.y-y.y)/p);d=Math.max(d,D)}if(d===0)return;this.min=y,this.max=_;const S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);const A=Math.max(S.x,S.y)/d;this.cellsX=Math.max(1,Math.ceil(S.x/A)),this.cellsY=Math.max(1,Math.ceil(S.y/A)),this.xScale=1/A,this.yScale=1/A;const C=[];for(let D=0;D<this.triangleCount;D++){const j=i[a[3*D+0]].sub(this.min),H=i[a[3*D+1]].sub(this.min),W=i[a[3*D+2]].sub(this.min),J=ru(Math.floor(Math.min(j.x,H.x,W.x)),this.xScale,this.cellsX),te=ru(Math.floor(Math.max(j.x,H.x,W.x)),this.xScale,this.cellsX),ae=ru(Math.floor(Math.min(j.y,H.y,W.y)),this.yScale,this.cellsY),de=ru(Math.floor(Math.max(j.y,H.y,W.y)),this.yScale,this.cellsY),he=new ut(0,0),me=new ut(0,0),ke=new ut(0,0),Ee=new ut(0,0);for(let Pe=ae;Pe<=de;++Pe){he.y=me.y=Pe*A,ke.y=Ee.y=(Pe+1)*A;for(let Ne=J;Ne<=te;++Ne)he.x=ke.x=Ne*A,me.x=Ee.x=(Ne+1)*A,(Hi(j,H,W,he,me,Ee)||Hi(j,H,W,he,Ee,ke))&&C.push({cellIdx:Pe*this.cellsX+Ne,triIdx:D})}}if(C.length===0)return;C.sort((D,j)=>D.cellIdx-j.cellIdx||D.triIdx-j.triIdx);let R=0;for(;R<C.length;){const D=C[R].cellIdx,j={start:this.payload.length,len:0};for(;R<C.length&&C[R].cellIdx===D;)++j.len,this.payload.push(C[R++].triIdx);this.cells[D]=j}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,a){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const d=ru(i.x-this.min.x,this.xScale,this.cellsX),p=ru(i.y-this.min.y,this.yScale,this.cellsY),y=this.cells[p*this.cellsX+d];if(y){this._lazyInitLookup();for(let _=0;_<y.len;_++){const S=this.payload[y.start+_],A=Math.floor(S/8),C=1<<S%8;if(!(this.lookup[A]&C)&&(this.lookup[A]|=C,a.push(S),a.length===this.triangleCount))return}}}query(i,a,d){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>a.x||i.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const p=ru(i.x-this.min.x,this.xScale,this.cellsX),y=ru(a.x-this.min.x,this.xScale,this.cellsX),_=ru(i.y-this.min.y,this.yScale,this.cellsY),S=ru(a.y-this.min.y,this.yScale,this.cellsY);for(let A=_;A<=S;A++)for(let C=p;C<=y;C++){const R=this.cells[A*this.cellsX+C];if(R)for(let D=0;D<R.len;D++){const j=this.payload[R.start+D],H=Math.floor(j/8),W=1<<j%8;if(!(this.lookup[H]&W)&&(this.lookup[H]|=W,d.push(j),d.length===this.triangleCount))return}}}}function ru(c,i,a){return Math.max(0,Math.min(a-1,Math.floor(c*i)))}Wt(wS,"TriangleGridIndex");class Pz{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=i.worldview}updateFootprints(i,a){for(const d of this.footprints)a.push({footprint:d,id:i})}populate(i,a,d,p){const y=[];for(const{feature:_,id:S,index:A,sourceLayerIndex:C}of i){const R=this.layers[0]._featureFilter.needGeometry,D=st(_,R);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom,{worldview:this.worldview}),D,d))continue;const j={id:S,properties:_.properties,type:_.type,sourceLayerIndex:C,index:A,geometry:R?D.geometry:De(_,d,p),patterns:{}};y.push(j)}for(const _ of y){const{geometry:S,index:A,sourceLayerIndex:C}=_;this.addFeature(_,S,A,d,{},a.availableImages,a.brightness),a.featureIndex.insert(i[A].feature,S,A,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,a,d,p,y,_,S){}destroy(){}addFeature(i,a,d,p,y,_=[],S){for(const A of G0(a,2)){const C=[],R=[],D=[],j=new ut(1/0,1/0),H=new ut(-1/0,-1/0);for(const te of A)if(te.length!==0){te!==A[0]&&D.push(R.length/2);for(let ae=0;ae<te.length;ae++)R.push(te[ae].x),R.push(te[ae].y),C.push(te[ae]),j.x=Math.min(j.x,te[ae].x),j.y=Math.min(j.y,te[ae].y),H.x=Math.max(H.x,te[ae].x),H.y=Math.max(H.y,te[ae].y)}const W=Bg(R,D),J=new wS(C,W,8,256);this.footprints.push({vertices:C,indices:W,grid:J,min:j,max:H})}}}Wt(Pz,"ClipBucket",{omit:["layers"]});const Cre=Qr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ire=Qr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Mre=Qr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ore=Qr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),kre=Qr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Rre=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Dre}=Cre,H0=Number.MAX_SAFE_INTEGER,Cz=H0-1;function Iz(c,i,a,d){return c.order<i||c.order===H0||!(c.clipMask&a)||function(p,y){return y.length!==0&&y.find(_=>_===p)===void 0}(d,c.clipScope)}function SS(c,i){return c.x-i.x||c.y-i.y}function Mz(c,i){return SS(c.min,i.min)===0&&SS(c.max,i.max)===0}function oI(c,i){return!(c.min.x>i.max.x||c.max.x<i.min.x||c.min.y>i.max.y||c.max.y<i.min.y)}function TS(c,i){if(c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(c[a].sourceId!==i[a].sourceId||!Mz(c[a],i[a])||c[a].order!==i[a].order||c[a].clipMask!==i[a].clipMask||!Zn(c[a].clipScope,i[a].clipScope))return!1;return!0}function Oz(c,i,a){const d=1/Lt,p=1/(1<<a.canonical.z),y=(i.x*d+a.canonical.x)*p+a.wrap,_=(i.y*d+a.canonical.y)*p;return{min:new ut((c.x*d+a.canonical.x)*p+a.wrap,(c.y*d+a.canonical.y)*p),max:new ut(y,_)}}function Lre(c,i,a){const d=1<<a.canonical.z,p=((i.x-a.wrap)*d-a.canonical.x)*Lt,y=(i.y*d-a.canonical.y)*Lt;return{min:new ut(((c.x-a.wrap)*d-a.canonical.x)*Lt,(c.y*d-a.canonical.y)*Lt),max:new ut(p,y)}}function sI(c,i,a,d,p,y,_){const S=c.indices,A=c.vertices,C=[];for(let R=d;R<d+p;R+=3){const D=i[a[R+0]+y],j=i[a[R+1]+y],H=i[a[R+2]+y],W=Math.min(D.x,j.x,H.x),J=Math.max(D.x,j.x,H.x),te=Math.min(D.y,j.y,H.y),ae=Math.max(D.y,j.y,H.y);C.length=0,c.grid.query(new ut(W,te),new ut(J,ae),C);for(let de=0;de<C.length;de++){const he=C[de];if(Hi(A[S[3*he+0]],A[S[3*he+1]],A[S[3*he+2]],D,j,H,_))return!0}}return!1}function kz(c,i,a,d){if(!c||!a)return!1;let p=c.vertices;if(!i.canonical.equals(d.canonical)||i.wrap!==d.wrap){if(a.vertices.length<c.vertices.length)return kz(a,d,c,i);const y=i.canonical,_=d.canonical,S=Math.pow(2,_.z-y.z);p=c.vertices.map(A=>new ut((A.x+y.x*Lt)*S-_.x*Lt,(A.y+y.y*Lt)*S-_.y*Lt))}return sI(a,p,c.indices,0,c.indices.length,0,0)}function Rz(c,i,a,d){const p=Math.pow(2,d.z-a.z);return new ut((c+a.x*Lt)*p-d.x*Lt,(i+a.y*Lt)*p-d.y*Lt)}function aI(c,i){const a=[];i.grid.queryPoint(c,a);const d=i.indices,p=i.vertices;for(let y=0;y<a.length;y++){const _=a[y];if(Fo([p[d[3*_+0]],p[d[3*_+1]],p[d[3*_+2]]],c))return!0}return!1}const lI=[new ut(0,0),new ut(Lt,0),new ut(Lt,Lt),new ut(0,Lt)];function Dz(c,i){const a=[];let d=[];if(!i||c.length<2)return[c];if(c.length===2)return gi(c[0],c[1],lI)?[c]:[];for(let p=0;p<c.length+2;p++){const y=c[p%c.length],_=c[(p+1)%c.length],S=gi(p===0?c[c.length-1]:c[(p-1)%c.length],y,lI),A=gi(y,_,lI),C=S||A;C&&d.push(y),C&&A||d.length>0&&(d.length>1&&a.push(d),d=[])}return d.length>1&&a.push(d),a}const cI=Xe.types,jre=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Nre=["fill-extrusion-flood-light-ground-radius"],zre=Math.pow(2,13),Fre=Math.pow(2,15)-1,Lz=new ut(0,1),Td=2147483648;function W0(c,i,a,d,p,y,_,S){c.emplaceBack((i<<1)+_,(a<<1)+y,(Math.floor(d*zre)<<1)+p,Math.round(S))}function q0(c,i,a){c.emplaceBack(i.x*Lt,i.y*Lt,a?1:0)}function ES(c,i,a,d,p,y){c.emplaceBack(i.x,i.y,(a.x<<1)+d,(a.y<<1)+p,y)}function Z0(c,i,a){c.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class jz{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Nz{constructor(){this.centroidXY=new ut(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ut(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ut(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new ut(this.max.x-this.min.x,this.max.y-this.min.y)}}class zz{constructor(){this.acc=new ut(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,a){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=a.x,i.min.y=i.max.y=a.y)}appendEdge(i,a,d){this.accCount++,this.acc._add(a);let p=!!this.borders;a.x<i.min.x?(i.min.x=a.x,p=!0):a.x>i.max.x&&(i.max.x=a.x,p=!0),a.y<i.min.y?(i.min.y=a.y,p=!0):a.y>i.max.y&&(i.max.y=a.y,p=!0),((a.x===0||a.x===Lt)&&a.x===d.x)!=((a.y===0||a.y===Lt)&&a.y===d.y)&&this.processBorderOverlap(a,d),p&&this.checkBorderIntersection(a,d)}checkBorderIntersection(i,a){a.x<0!=i.x<0&&this.addBorderIntersection(0,lr(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>Lt!=i.x>Lt&&this.addBorderIntersection(1,lr(a.y,i.y,(Lt-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,lr(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>Lt!=i.y>Lt&&this.addBorderIntersection(3,lr(a.x,i.x,(Lt-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[i];a<d[0]&&(d[0]=a),a>d[1]&&(d[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const d=i.x===0?0:1;this.addBorderIntersection(d,a.y),this.addBorderIntersection(d,i.y)}else{const d=i.y===0?2:3;this.addBorderIntersection(d,a.x),this.addBorderIntersection(d,i.x)}}centroid(){return this.accCount===0?new ut(0,0):new ut(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0):0}}function Fz(c,i){const a=c.add(i)._unit(),d=xe(c.x*a.x+c.y*a.y,-1,1);var p,y,_;return p=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(p)))/4*Fre*((y=c).x*(_=i).y-y.y*_.x<0?-1:1)}const Bre=[c=>c.x<0,c=>c.x>Lt,c=>c.y<0,c=>c.y>Lt];function $re(c,i,a,d){const p=[4];if(d===0)return p;a._mult(d);const y=c.sub(a),_=i.sub(a),S=[c,i,y,_];for(let A=0;A<4;A++)for(const C of S)if(Bre[A](C)){p.push(A);break}return p}class uI{constructor(i){this.vertexArray=new Ig,this.indexArray=new ii,this.programConfigurations=new oa(i.layers,{zoom:i.zoom,lut:i.lut},a=>Nre.includes(a)),this._segments=new ci,this.hiddenByLandmarkVertexArray=new Lg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ci}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,a,d,p=!1){const y=i.length;if(y>2){let _=Math.max(0,this._segments.get().length-1);const S=this._segments._prepareSegment(4*y,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let A;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const C=i[0],R=i[1];A=Fz(C.sub(i[y-1])._perp()._unit(),R.sub(C)._perp()._unit())}for(let C=0;C<y;C++){const R=C===y-1?0:C+1,D=i[C],j=i[R],H=i[R===y-1?0:R+1],W=j.sub(D)._perp()._unit(),J=Fz(W,H.sub(j)._perp()._unit()),te=A,ae=J;if(hI(D,j,a)||p&&Vz(D,a)&&Vz(j,a)){A=J;continue}const de=S.vertexLength;ES(this.vertexArray,D,j,1,1,te),ES(this.vertexArray,D,j,1,0,te),ES(this.vertexArray,D,j,0,1,ae),ES(this.vertexArray,D,j,0,0,ae),S.vertexLength+=4;const he=$re(D,j,W,d);for(const me of he)this._segmentToGroundQuads[_].push({id:de,region:me}),this._segmentToRegionTriCounts[_][me]+=2,S.primitiveLength+=2;A=J}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),a=i.length;for(let d=0;d<a;d++)this._segmentToGroundQuads[d].sort((p,y)=>p.region-y.region);for(let d=0;d<a;d++){const p=this._segmentToGroundQuads[d],y=i[d],_=this._segmentToRegionTriCounts[d];_.reduce((A,C)=>A+C,0);let S=0;for(let A=0;A<=4;A++){const C=_[A];if(C!==0){let R=this.regionSegments[A];R||(R=this.regionSegments[A]=new ci);const D={vertexOffset:y.vertexOffset,primitiveOffset:y.primitiveOffset+S,vertexLength:y.vertexLength,primitiveLength:C};R.get().push(D)}S+=C}for(let A=0;A<p.length;A++){const C=p[A].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,a,d,p,y,_,S){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,a,d,p,y,_,void 0,S)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Ire.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,a,d,p,y,_,S,A){this.hasData()&&this.programConfigurations.updatePaintArrays(i,a,d,p,y,_,S,A)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&Td))}updateHiddenByLandmarkRange(i,a,d){if(!this.hasData())return;const p=a+i;if(a!==0){for(let y=i;y<p;++y)this.hiddenByLandmarkVertexArray.emplace(y,d?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,kre.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const a=this.regionSegments[i];a&&a.destroy()}}}}class AS{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ii,this.footprintVertices=new Os,this.footprintSegments=[],this.layoutVertexArray=new hd,this.centroidVertexArray=new oS,this.wallVertexArray=new aS,this.indexArray=new ii,this.programConfigurations=new oa(i.layers,{zoom:i.zoom,lut:i.lut},a=>jre.includes(a)),this.segments=new ci,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new uI(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,d,p){this.features=[],this.hasPattern=eI("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Se(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:y,id:_,index:S,sourceLayerIndex:A}of i){const C=this.layers[0]._featureFilter.needGeometry,R=st(y,C);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom,{worldview:this.worldview}),R,d))continue;const D={id:_,sourceLayerIndex:A,index:S,geometry:C?R.geometry:De(y,d,p),properties:y.properties,type:y.type,patterns:{}},j=this.layoutVertexArray.length,H=cI[D.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:y.id,feature:tI("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const W of D.geometry)for(const J of Dz(W,H))this.addFeature(y.id,D,[J],S,d,{},a.availableImages,p,a.brightness);else this.addFeature(y.id,D,D.geometry,S,d,{},a.availableImages,p,a.brightness);a.featureIndex.insert(y,D.geometry,S,A,this.index,j)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,a,d,p,y,_){for(const{featureId:S,feature:A}of this.features){const C=cI[A.type]==="Polygon",{geometry:R}=A;if(this.wallMode)for(const D of R)for(const j of Dz(D,C))this.addFeature(S,A,[j],A.index,a,d,p,y,_);else this.addFeature(S,A,R,A.index,a,d,p,y,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,a,d,p,y,_,S){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,S,this.worldview),this.groundEffect.update(i,a,y,d,p,_,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Dre),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,Ore.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,Rre.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Mre.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,d,p,y,_,S,A,C){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,D=[new ut(0,0),new ut(Lt,Lt)],j=A.projection,H=j.name==="globe",W=this.wallMode||cI[a.type]==="Polygon",J=new zz;J.centroidDataIndex=this.centroidData.length;const te=new Nz;te.buildingId=i,a.properties&&a.properties.hasOwnProperty("building_id")&&(te.buildingId=a.properties.building_id);const ae=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},y)<=0,de=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},y);let he;if(te.height=de,te.vertexArrayOffset=this.layoutVertexArray.length,te.groundVertexArrayOffset=this.groundEffect.vertexArray.length,H&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Og),this.wallMode){if(H)return void qr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(d.length!==1)return;he=function(Ue){const dt=Ue[0].x===Ue[Ue.length-1].x&&Ue[0].y===Ue[Ue.length-1].y;(function(Et){let Yt=0;const Vt=Et.length;for(let jt=0;jt<Vt;jt++)Yt+=(Et[(jt+1)%Vt].x-Et[jt].x)*(Et[(jt+1)%Vt].y+Et[jt].y);return Yt>=0})(Ue)||(Ue=Ue.reverse());const mt={geometry:[],joinNormals:[],indices:[]},wt=[],At=[],at=[];let St=Ue.length;for(;St>=2&&Ue[St-1].equals(Ue[St-2]);)St--;if(St<(dt?3:2))return mt;let He,lt,kt,Tt,tr,Zt=0;for(;Zt<St-1&&Ue[Zt].equals(Ue[Zt+1]);)Zt++;dt&&(He=Ue[St-2],tr=Ue[Zt].sub(He)._unit()._perp());for(let Et=Zt;Et<St;Et++){if(kt=Et===St-1?dt?Ue[Zt+1]:void 0:Ue[Et+1],kt&&Ue[Et].equals(kt))continue;tr&&(Tt=tr),He&&(lt=He),He=Ue[Et],tr=kt?kt.sub(He)._unit()._perp():Tt,Tt=Tt||tr;let Yt=Tt.add(tr);Yt.x===0&&Yt.y===0||Yt._unit();const Vt=Yt.x*tr.x+Yt.y*tr.y,jt=Vt!==0?1/Vt:1/0,Gt=Tt.x*tr.y-Tt.y*tr.x>0;let hr="miter";const vr=2;hr==="miter"&&jt>vr&&(hr="bevel"),hr==="bevel"&&(jt>100&&(hr="flipbevel"),jt<vr&&(hr="miter"));const Cr=(Tr,Zr,jr,Yn)=>{const _e=new ut(Tr.x,Tr.y),ve=new ut(Tr.x,Tr.y);_e.x+=Zr.x*Yn,_e.y+=Zr.y*Yn,ve.x-=Zr.x*Math.max(jr,1),ve.y-=Zr.y*Math.max(jr,1),at.push(Zr),wt.push(_e),At.push(ve)};if(hr==="miter")Yt._mult(jt),Cr(He,Yt,0,0);else if(hr==="flipbevel")Yt=tr.mult(-1),Cr(He,Yt,0,0),Cr(He,Yt.mult(-1),0,0);else{const Tr=-Math.sqrt(jt*jt-1),Zr=Gt?Tr:0,jr=Gt?0:Tr;lt&&Cr(He,Tt,Zr,jr),kt&&Cr(He,tr,Zr,jr)}}mt.geometry=[...wt,...At.reverse(),wt[0]],mt.joinNormals=[...at,...at.reverse(),at[at.length-1]];const xt=mt.geometry.length-1;for(let Et=0;Et<xt/2;Et++)if(Et+1<xt/2){let Yt=Et,Vt=Et+1,jt=xt-1-Et,Gt=xt-2-Et;Yt=Yt===0?xt-1:Yt-1,Vt=Vt===0?xt-1:Vt-1,jt=jt===0?xt-1:jt-1,Gt=Gt===0?xt-1:Gt-1,mt.indices.push(jt),mt.indices.push(Vt),mt.indices.push(Yt),mt.indices.push(jt),mt.indices.push(Gt),mt.indices.push(Vt)}return mt}(d[0]),d=[he.geometry]}const me=(Ue,dt)=>Ue<(dt.length-1)/2||Ue===dt.length-1,ke=this.wallMode?[d]:G0(d,500);for(let Ue=ke.length-1;Ue>=0;Ue--){const dt=ke[Ue];(dt.length===0||(Ee=dt[0]).every(Ct=>Ct.x<=0)||Ee.every(Ct=>Ct.x>=Lt)||Ee.every(Ct=>Ct.y<=0)||Ee.every(Ct=>Ct.y>=Lt))&&ke.splice(Ue,1)}var Ee;let Pe;if(H)Pe=Wz(ke,D,y);else{Pe=[];for(const Ue of ke)Pe.push({polygon:Ue,bounds:D})}const Ne=W?this.edgeRadius:0,Be=Ne>0&&this.zoom<17,ct=(Ue,dt)=>{if(Ue.length===0)return!1;const Ct=Ue[Ue.length-1];return dt.x===Ct.x&&dt.y===Ct.y};for(const{polygon:Ue,bounds:dt}of Pe){let Ct=0,mt=0;for(const St of Ue)W&&!St[0].equals(St[St.length-1])&&St.push(St[0]),mt+=W?St.length-1:St.length;const wt=this.segments.prepareSegment((W?5:4)*mt,this.layoutVertexArray,this.indexArray);te.footprintSegIdx<0&&(te.footprintSegIdx=this.footprintSegments.length),te.polygonSegIdx<0&&(te.polygonSegIdx=this.polygonSegments.length);const At={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},at=new jz;if(at.vertexOffset=this.footprintVertices.length,at.indexOffset=3*this.footprintIndices.length,at.ringIndices=[],W){const St=[],He=[];Ct=wt.vertexLength;for(let kt=0;kt<Ue.length;kt++){const Tt=Ue[kt];Tt.length&&kt!==0&&He.push(St.length/2);const tr=[];let Zt,xt;Zt=Tt[1].sub(Tt[0])._perp()._unit(),at.ringIndices.push(Tt.length-1);for(let Et=1;Et<Tt.length;Et++){const Yt=Tt[Et],Vt=Tt[Et===Tt.length-1?1:Et+1],jt=Yt.clone();if(Ne){xt=Vt.sub(Yt)._perp()._unit();const Gt=Zt.add(xt)._unit(),hr=Ne*Math.min(4,1/(Zt.x*Gt.x+Zt.y*Gt.y));jt.x+=hr*Gt.x,jt.y+=hr*Gt.y,jt.x=Math.round(jt.x),jt.y=Math.round(jt.y),Zt=xt}if(!ae||Ne!==0&&!Be||ct(tr,jt)||tr.push(jt),W0(this.layoutVertexArray,jt.x,jt.y,0,0,1,1,0),this.wallMode){const Gt=me(Et,Tt);q0(this.wallVertexArray,he.joinNormals[Et],!Gt)}wt.vertexLength++,this.footprintVertices.emplaceBack(Yt.x,Yt.y),St.push(Yt.x,Yt.y),H&&Z0(this.layoutVertexExtArray,j.projectTilePoint(jt.x,jt.y,y),j.upVector(y,jt.x,jt.y))}ae&&(Ne===0||Be)&&(tr.length!==0&&ct(tr,tr[0])&&tr.pop(),this.groundEffect.addData(tr,dt,R))}const lt=this.wallMode?he.indices:Bg(St,He);for(let kt=0;kt<lt.length;kt+=3)this.footprintIndices.emplaceBack(at.vertexOffset+lt[kt+0],at.vertexOffset+lt[kt+1],at.vertexOffset+lt[kt+2]),this.indexArray.emplaceBack(Ct+lt[kt],Ct+lt[kt+2],Ct+lt[kt+1]),wt.primitiveLength++;at.indexCount+=lt.length,at.vertexCount+=this.footprintVertices.length-at.vertexOffset}for(let St=0;St<Ue.length;St++){const He=Ue[St];J.startRing(te,He[0]);let lt=He.length>4&&Uz(He[He.length-2],He[0],He[1]),kt=Ne?Vre(He[He.length-2],He[0],He[1],Ne):0;const Tt=[];let tr,Zt,xt;Zt=He[1].sub(He[0])._perp()._unit();let Et=!0;for(let Yt=1,Vt=0;Yt<He.length;Yt++){let jt=He[Yt-1],Gt=He[Yt];const hr=He[Yt===He.length-1?1:Yt+1];if(J.appendEdge(te,Gt,jt),hI(Gt,jt,dt)){Ne&&(Zt=hr.sub(Gt)._perp()._unit(),Et=!Et);continue}const vr=Gt.sub(jt)._perp(),Cr=vr.x/(Math.abs(vr.x)+Math.abs(vr.y)),Tr=vr.y>0?1:0,Zr=jt.dist(Gt);if(Vt+Zr>32768&&(Vt=0),Ne){xt=hr.sub(Gt)._perp()._unit();let ve=$z(jt,Gt,hr,Bz(Zt,xt),Ne);isNaN(ve)&&(ve=0);const ot=Gt.sub(jt)._unit();jt=jt.add(ot.mult(kt))._round(),Gt=Gt.add(ot.mult(-ve))._round(),kt=ve,Zt=xt,ae&&this.zoom>=17&&(ct(Tt,jt)||Tt.push(jt),ct(Tt,Gt)||Tt.push(Gt))}const jr=wt.vertexLength,Yn=He.length>4&&Uz(jt,Gt,hr);let _e=Gz(Vt,lt,Et);if(W0(this.layoutVertexArray,jt.x,jt.y,Cr,Tr,0,0,_e),W0(this.layoutVertexArray,jt.x,jt.y,Cr,Tr,0,1,_e),this.wallMode){const ve=me(Yt-1,He),ot=he.joinNormals[Yt-1];q0(this.wallVertexArray,ot,ve),q0(this.wallVertexArray,ot,ve)}if(Vt+=Zr,_e=Gz(Vt,Yn,!Et),lt=Yn,W0(this.layoutVertexArray,Gt.x,Gt.y,Cr,Tr,0,0,_e),W0(this.layoutVertexArray,Gt.x,Gt.y,Cr,Tr,0,1,_e),this.wallMode){const ve=me(Yt,He),ot=he.joinNormals[Yt];q0(this.wallVertexArray,ot,ve),q0(this.wallVertexArray,ot,ve)}if(wt.vertexLength+=4,this.indexArray.emplaceBack(jr+0,jr+1,jr+2),this.indexArray.emplaceBack(jr+1,jr+3,jr+2),wt.primitiveLength+=2,Ne){const ve=Ct+(Yt===1?He.length-2:Yt-2),ot=Yt===1?Ct:ve+1;if(this.indexArray.emplaceBack(jr+1,ve,jr+3),this.indexArray.emplaceBack(ve,ot,jr+3),wt.primitiveLength+=2,tr===void 0&&(tr=jr),!hI(hr,He[Yt],dt)){const Rt=Yt===He.length-1?tr:wt.vertexLength;this.indexArray.emplaceBack(jr+2,jr+3,Rt),this.indexArray.emplaceBack(jr+3,Rt+1,Rt),this.indexArray.emplaceBack(jr+3,ot,Rt+1),wt.primitiveLength+=3}Et=!Et}if(H){const ve=this.layoutVertexExtArray,ot=j.projectTilePoint(jt.x,jt.y,y),Rt=j.projectTilePoint(Gt.x,Gt.y,y),zt=j.upVector(y,jt.x,jt.y),Nt=j.upVector(y,Gt.x,Gt.y);Z0(ve,ot,zt),Z0(ve,ot,zt),Z0(ve,Rt,Nt),Z0(ve,Rt,Nt)}}W&&(Ct+=He.length-1),ae&&Ne&&this.zoom>=17&&(Tt.length!==0&&ct(Tt,Tt[0])&&Tt.pop(),this.groundEffect.addData(Tt,dt,R,Ne>0))}this.footprintSegments.push(at),At.triangleCount=this.indexArray.length-At.triangleArrayOffset,this.polygonSegments.push(At),++te.footprintSegLen,++te.polygonSegLen}if(te.vertexCount=this.layoutVertexArray.length-te.vertexArrayOffset,te.groundVertexCount=this.groundEffect.vertexArray.length-te.groundVertexArrayOffset,te.vertexCount!==0){if(te.centroidXY=J.borders?Lz:this.encodeCentroid(J,te),this.centroidData.push(te),J.borders){this.featuresOnBorder.push(J);const Ue=this.featuresOnBorder.length-1;for(let dt=0;dt<J.borders.length;dt++)J.borders[dt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[dt].push(Ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,_,S,y,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,p,_,S,y,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,de)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((a,d)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[d].borders[i][0])}splitToSubtiles(){const i=[];for(let S=0;S<this.centroidData.length;S++){const A=this.centroidData[S],C=+(A.min.y+A.max.y>Lt),R=2*C+(+(A.min.x+A.max.x>Lt)^C);for(let D=0;D<A.polygonSegLen;D++){const j=A.polygonSegIdx+D;i.push({centroidIdx:S,subtile:R,polygonSegmentIdx:j,triangleSegmentIdx:this.polygonSegments[j].triangleSegIdx})}}const a=new ii;i.sort((S,A)=>S.triangleSegmentIdx===A.triangleSegmentIdx?S.subtile-A.subtile:S.triangleSegmentIdx-A.triangleSegmentIdx);let d=0,p=0,y=0;for(const S of i){if(S.triangleSegmentIdx!==d)break;y++}const _=i.length;for(;p!==i.length;){d=i[p].triangleSegmentIdx;let S=0,A=p,C=p;for(let R=A;R<y&&i[R].subtile===S;R++)C++;for(;A!==y;){const R=i[A];S=R.subtile;const D=this.centroidData[R.centroidIdx].min.clone(),j=this.centroidData[R.centroidIdx].max.clone(),H={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let W=A;W<C;W++){const J=i[W],te=this.polygonSegments[J.polygonSegmentIdx],ae=this.centroidData[J.centroidIdx].min,de=this.centroidData[J.centroidIdx].max,he=this.indexArray.uint16;for(let me=te.triangleArrayOffset;me<te.triangleArrayOffset+te.triangleCount;me++)a.emplaceBack(he[3*me],he[3*me+1],he[3*me+2]);H.primitiveLength+=te.triangleCount,D.x=Math.min(D.x,ae.x),D.y=Math.min(D.y,ae.y),j.x=Math.max(j.x,de.x),j.y=Math.max(j.y,de.y)}H.primitiveLength>0&&this.triangleSubSegments.push({segment:H,min:D,max:j}),A=C;for(let W=A;W<y&&i[W].subtile===i[A].subtile;W++)C++}p=y;for(let R=p;R<_&&i[R].triangleSegmentIdx===i[p].triangleSegmentIdx;R++)y++}a._trim(),this.indexArray=a}getVisibleSegments(i,a,d){const p=new ci;if(this.wallMode){for(const J of this.triangleSubSegments)p.segments.push(J.segment);return p}let y=0,_=0;const S=1<<i.canonical.z;if(a){const J=a.getMinMaxForTile(i);J&&(y=J.min,_=J.max)}_+=this.maxHeight;const A=i.toUnwrapped();let C;const R=[A.canonical.x/S+A.wrap,A.canonical.y/S],D=[(A.canonical.x+1)/S+A.wrap,(A.canonical.y+1)/S],j=(J,te,ae)=>[J[0]*(1-ae[0])+te[0]*ae[0],J[1]*(1-ae[1])+te[1]*ae[1]],H=[],W=[];for(const J of this.triangleSubSegments){H[0]=J.min.x/Lt,H[1]=J.min.y/Lt,W[0]=J.max.x/Lt,W[1]=J.max.y/Lt;const te=j(R,D,H),ae=j(R,D,W);if(new Fr([te[0],te[1],y],[ae[0],ae[1],_]).intersectsPrecise(d)===0){C&&(p.segments.push(C),C=void 0);continue}const de=J.segment;C&&C.vertexOffset!==de.vertexOffset&&(p.segments.push(C),C=void 0),C?(C.vertexLength+=de.vertexLength,C.primitiveLength+=de.primitiveLength):C={vertexOffset:de.vertexOffset,primitiveLength:de.primitiveLength,vertexLength:de.vertexLength,primitiveOffset:de.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&p.segments.push(C),p}encodeCentroid(i,a){const d=i.centroid(),p=a.span(),y=Math.min(7,Math.round(p.x*this.tileToMeter/10)),_=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new ut(xe(d.x,1,Lt-1)<<3|y,xe(d.y,1,Lt-1)<<3|_)}encodeBorderCentroid(i){if(!i.borders)return new ut(0,0);const a=i.borders,d=Number.MAX_VALUE;if(a[0][0]!==d||a[1][0]!==d){const p=a[0][0]!==d?0:1;return new ut(6|(a[0][0]!==d?0:65528),(a[p][0]+a[p][1])/2<<3|6)}{const p=a[2][0]!==d?2:3;return new ut((a[p][0]+a[p][1])/2<<3|6,6|(a[2][0]!==d?0:65528))}}showCentroid(i){const a=this.centroidData[i.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const a=i.vertexArrayOffset,d=i.vertexCount+i.vertexArrayOffset,p=i.flags&Td?Lz:i.centroidXY,y=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==p.y||y!==p.x){for(let _=a;_<d;++_)this.centroidVertexArray.emplace(_,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,a,d){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const p=a.getReplacementRegionsForTile(i.toUnwrapped());if(TS(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const y=[];for(const _ of this.activeReplacements){if(_.order<d)continue;const S=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));if(_.footprint.buildingId){const A=_.footprint.buildingId;for(const C of this.centroidData)C.buildingId===A&&(C.flags|=Td)}else for(const A of this.centroidData)if(!(A.flags&Td||_.min.x>A.max.x||A.min.x>_.max.x||_.min.y>A.max.y||A.min.y>_.max.y))for(let C=0;C<A.footprintSegLen;C++){const R=this.footprintSegments[A.footprintSegIdx+C];if(y.length=0,Ure(this.footprintVertices,R.vertexOffset,R.vertexCount,_.footprintTileId.canonical,i.canonical,y),sI(_.footprint,y,this.footprintIndices.uint16,R.indexOffset,R.indexCount,-R.vertexOffset,-S)){A.flags|=Td;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,a,d){let p=!1;for(let y=0;y<d.footprintSegLen;y++){const _=this.footprintSegments[d.footprintSegIdx+y];let S=0;for(const A of _.ringIndices){for(let C=S,R=A+S-1;C<A+S;R=C++){const D=this.footprintVertices.int16[2*(C+_.vertexOffset)+0],j=this.footprintVertices.int16[2*(C+_.vertexOffset)+1],H=this.footprintVertices.int16[2*(R+_.vertexOffset)+1];j>a!=H>a&&i<(this.footprintVertices.int16[2*(R+_.vertexOffset)+0]-D)*(a-j)/(H-j)+D&&(p=!p)}S=A}}return p}getHeightAtTileCoord(i,a){let d=Number.NEGATIVE_INFINITY,p=!0;const y=4*(i+Lt)*Lt+(a+Lt);if(this.partLookup.hasOwnProperty(y)){const _=this.partLookup[y];return _?{height:_.height,hidden:!!(_.flags&Td)}:void 0}for(const _ of this.centroidData)i>_.max.x||_.min.x>i||a>_.max.y||_.min.y>a||_.height<=d||this.footprintContainsPoint(i,a,_)&&(d=_.height,this.partLookup[y]=_,p=!!(_.flags&Td));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:p};this.partLookup[y]=void 0}}function Bz(c,i){const a=c.add(i)._unit();return c.x*a.x+c.y*a.y}function Vre(c,i,a,d){const p=i.sub(c)._perp()._unit(),y=a.sub(i)._perp()._unit();return $z(c,i,a,Bz(p,y),d)}function $z(c,i,a,d,p){const y=Math.sqrt(1-d*d);return Math.min(c.dist(i)/3,i.dist(a)/3,p*y/d)}function hI(c,i,a){return c.x<a[0].x&&i.x<a[0].x||c.x>a[1].x&&i.x>a[1].x||c.y<a[0].y&&i.y<a[0].y||c.y>a[1].y&&i.y>a[1].y}function Vz(c,i){return c.x<i[0].x||c.x>i[1].x||c.y<i[0].y||c.y>i[1].y}function Uz(c,i,a){if(c.x<0||c.x>=Lt||i.x<0||i.x>=Lt||a.x<0||a.x>=Lt)return!1;const d=a.sub(i),p=d.perp(),y=c.sub(i);return(d.x*y.x+d.y*y.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(y.x*y.x+y.y*y.y))>-.866&&p.x*y.x+p.y*y.y<0}function Gz(c,i,a){const d=i?2|c:-3&c;return a?1|d:-2&d}function Hz(){const c=Math.PI/32,i=Math.tan(c),a=k;return a*Math.sqrt(1+2*i*i)-a}function Wz(c,i,a){const d=1<<a.z,p=ue(a.x/d),y=ue((a.x+1)/d),_=pe(a.y/d),S=pe((a.y+1)/d);return function(A,C,R,D,j=0,H){const W=[];if(!A.length||!R||!D)return W;const J=(Ee,Pe)=>{for(const Ne of Ee)W.push({polygon:Ne,bounds:Pe})},te=Math.ceil(Math.log2(R)),ae=Math.ceil(Math.log2(D)),de=te-ae,he=[];for(let Ee=0;Ee<Math.abs(de);Ee++)he.push(de>0?0:1);for(let Ee=0;Ee<Math.min(te,ae);Ee++)he.push(0),he.push(1);let me=A;if(me=bS(me,C[0].y-j,C[1].y+j,1),me=bS(me,C[0].x-j,C[1].x+j,0),!me.length)return W;const ke=[];for(he.length?ke.push({polygons:me,bounds:C,depth:0}):J(me,C);ke.length;){const Ee=ke.pop(),Pe=Ee.depth,Ne=he[Pe],Be=Ee.bounds[0],ct=Ee.bounds[1],Ue=Ne===0?Be.x:Be.y,dt=Ne===0?ct.x:ct.y,Ct=H?H(Ne,Ue,dt):.5*(Ue+dt),mt=bS(Ee.polygons,Ue-j,Ct+j,Ne),wt=bS(Ee.polygons,Ct-j,dt+j,Ne);if(mt.length){const At=[Be,new ut(Ne===0?Ct:ct.x,Ne===1?Ct:ct.y)];he.length>Pe+1?ke.push({polygons:mt,bounds:At,depth:Pe+1}):J(mt,At)}if(wt.length){const At=[new ut(Ne===0?Ct:Be.x,Ne===1?Ct:Be.y),ct];he.length>Pe+1?ke.push({polygons:wt,bounds:At,depth:Pe+1}):J(wt,At)}}return W}(c,i,Math.ceil((y-p)/11.25),Math.ceil((_-S)/11.25),1,(A,C,R)=>{if(A===0)return .5*(C+R);{const D=pe((a.y+C/Lt)/d);return(oe(.5*(pe((a.y+R/Lt)/d)+D))*d-a.y)*Lt}})}function Ure(c,i,a,d,p,y){const _=Math.pow(2,d.z-p.z);for(let S=0;S<a;S++){let A=c.int16[2*(S+i)+0],C=c.int16[2*(S+i)+1];A=(A+p.x*Lt)*_-d.x*Lt,C=(C+p.y*Lt)*_-d.y*Lt,y.push(new ut(A,C))}}let qz,Zz;Wt(AS,"FillExtrusionBucket",{omit:["layers","features"]}),Wt(Nz,"PartData"),Wt(jz,"FootprintSegment"),Wt(zz,"BorderCentroidData"),Wt(uI,"GroundEffect");class wp extends ut{constructor(i,a,d){super(i,a),this.z=d}}class Xz extends wp{constructor(i,a,d,p){super(i,a,d),this.w=p}}function Kz(c,i,a,d){const p=a==="x"?"y":"x",y=(d-c[a])/(i[a]-c[a]);c[p]=Math.round(c[p]+(i[p]-c[p])*y),c[a]=d,c.hasOwnProperty("z")&&(c.z=lr(c.z,i.z,y)),c.hasOwnProperty("w")&&(c.w=lr(c.w,i.w,y))}function Yz(c,i,a,d){const p=a,y=d;for(const _ of["x","y"]){let S=c,A=i;S[_]>=A[_]&&(S=i,A=c),S[_]<p&&A[_]>p&&Kz(S,A,_,p),S[_]<y&&A[_]>y&&Kz(A,S,_,y)}}function PS(c,i,a,d,p,y){const _=[];for(let S=0;S<c.length;S++){const A=c[S];let C;const R=_.length;let D=0;for(let j=0;j<A.length-1;j++){let H=A[j],W=A[j+1],J=0;const te=D;let ae,de;y&&(J=Math.hypot(W.x-H.x,W.y-H.y),D+=J,ae=H,de=W),H.x<i&&W.x<i||(H.x<i?H=new ut(i,H.y+(i-H.x)/(W.x-H.x)*(W.y-H.y))._round():W.x<i&&(W=new ut(i,H.y+(i-H.x)/(W.x-H.x)*(W.y-H.y))._round()),H.y<a&&W.y<a||(H.y<a?H=new ut(H.x+(a-H.y)/(W.y-H.y)*(W.x-H.x),a)._round():W.y<a&&(W=new ut(H.x+(a-H.y)/(W.y-H.y)*(W.x-H.x),a)._round()),H.x>=d&&W.x>=d||(H.x>=d?H=new ut(d,H.y+(d-H.x)/(W.x-H.x)*(W.y-H.y))._round():W.x>=d&&(W=new ut(d,H.y+(d-H.x)/(W.x-H.x)*(W.y-H.y))._round()),H.y>=p&&W.y>=p||(H.y>=p?H=new ut(H.x+(p-H.y)/(W.y-H.y)*(W.x-H.x),p)._round():W.y>=p&&(W=new ut(H.x+(p-H.y)/(W.y-H.y)*(W.x-H.x),p)._round()),C&&H.equals(C[C.length-1])||(C=[H],_.push(C),y&&y.push({progress:{min:te+Jz(ae,de,H)*J,max:1},parentIndex:S,prevPoint:ae,nextPoint:de})),C.push(W),y&&(y[y.length-1].progress.max=te+Jz(ae,de,W)*J,y[y.length-1].nextPoint=de)))))}if(y&&D>0)for(let j=R;j<_.length;j++)y[j].progress.min/=D,y[j].progress.max/=D}return _}function Gre(c,i,a,d,p){if(c.length<2)return void d.push(c);const y=[];for(;i.valid();){const[C,R]=i.get();for(let D=0;D<c.length-1;D++){const j=c[D],H=c[D+1],W=$s(j,H,C,R);if(W){const[J]=W,te=new ut(lr(j.x,H.x,J),lr(j.y,H.y,J));y.push({t:D+J,distance:0,point:te})}}i.next()}if(y.length===0)return void d.push(c);y.sort((C,R)=>C.t-R.t);let _=0,S=0,A=[];for(d.push(A);_!==c.length;){if(S===y.length){for(;_!==c.length;)A.length!==0&&A[A.length-1].equals(c[_])||A.push(c[_]),_++;break}y[S].t<=_?(A.length!==0&&A[A.length-1].equals(y[S].point)||A.push(y[S].point),Math.trunc(y[S].t),S++):(A.length!==0&&A[A.length-1].equals(c[_])||A.push(c[_]),_++)}}function Jz(c,i,a){return c.x!==i.x?(a.x-c.x)/(i.x-c.x):c.y!==i.y?(a.y-c.y)/(i.y-c.y):0}function X0(c,i){return c.x*i.x+c.y*i.y}function Qz(c,i){if(c.length===1){let a=0;const d=i[a++];let p;for(;!p||d.equals(p);)if(p=i[a++],!p)return 1/0;for(;a<i.length;a++){const y=i[a],_=c[0],S=p.sub(d),A=y.sub(d),C=_.sub(d),R=X0(S,S),D=X0(S,A),j=X0(A,A),H=X0(C,S),W=X0(C,A),J=R*j-D*D,te=(j*H-D*W)/J,ae=(R*W-D*H)/J,de=d.z*(1-te-ae)+p.z*te+y.z*ae;if(isFinite(de))return de}return 1/0}{let a=1/0;for(const d of i)a=Math.min(a,d.z);return a}}function eF(c,i,a,d,p,y,_,S){const A=_*p.getElevationAt(c,i,!0,!0),C=y[0]!==0,R=C?y[1]===0?_*(y[0]/7-450):_*function(D,j,H){const W=Math.floor(j[0]/8),J=Math.floor(j[1]/8),te=10*(j[0]-8*W),ae=10*(j[1]-8*J),de=D.getElevationAt(W,J,!0,!0),he=D.getMeterToDEM(H),me=Math.floor(.5*(te*he-1)),ke=Math.floor(.5*(ae*he-1)),Ee=D.tileCoordToPixel(W,J),Pe=2*me+1,Ne=2*ke+1,Be=function(wt,At,at,St,He){return[wt.getElevationAtPixel(At,at,!0),wt.getElevationAtPixel(At+He,at,!0),wt.getElevationAtPixel(At,at+He,!0),wt.getElevationAtPixel(At+St,at+He,!0)]}(D,Ee.x-me,Ee.y-ke,Pe,Ne),ct=Math.abs(Be[0]-Be[1]),Ue=Math.abs(Be[2]-Be[3]),dt=Math.abs(Be[0]-Be[2])+Math.abs(Be[1]-Be[3]),Ct=Math.min(.25,.5*he*(ct+Ue)/Pe),mt=Math.min(.25,.5*he*dt/Ne);return de+Math.max(Ct*te,mt*ae)}(p,y,S):A;return{base:A+(a===0?-1:a),top:C?Math.max(R+d,A+a+2):A+d}}class Hre{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Wre{constructor(){this.tasks={},this.taskQueue=[],yr(["process"],this),this.invoker=new Hre(this.process),this.nextId=0}add(i,a){const d=this.nextId++,p=function({type:y,isSymbolTile:_,zoom:S}){return S=S||0,y==="message"?0:y!=="maybePrepare"||_?y!=="parseTile"||_?y==="parseTile"&&_?300-S:y==="maybePrepare"&&_?400-S:500:200-S:100-S}(a);if(p===0){try{i()}finally{}return null}return this.tasks[d]={fn:i,metadata:a,priority:p,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let p=0;p<this.taskQueue.length;p++){const y=this.tasks[this.taskQueue[p]];y.priority<a&&(a=y.priority,i=p)}if(i===null)return null;const d=this.taskQueue[i];return this.taskQueue.splice(i,1),d}remove(){this.invoker.remove()}}class tF{constructor(i,a,d){this.target=i,this.parent=a,this.mapId=d,this.callbacks={},this.cancelCallbacks={},yr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Wre}send(i,a,d,p,y=!1,_){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=_,this.callbacks[S]=d);const A=new Set;return this.target.postMessage({id:S,type:i,hasCallback:!!d,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:Jl(a,A)},A),{cancel:()=>{d&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(i){const a=i.data;if(!a)return;const d=a.id;if(d&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const p=this.cancelCallbacks[d];delete this.cancelCallbacks[d],p&&p.cancel()}else if(a.mustQueue||jn(self)){const p=this.callbacks[d],y=this.scheduler.add(()=>this.processTask(d,a),p&&p.metadata||{type:"message"});y&&(this.cancelCallbacks[d]=y)}else this.processTask(d,a)}processTask(i,a){if(delete this.cancelCallbacks[i],a.type==="<response>"){const d=this.callbacks[i];delete this.callbacks[i],d&&(a.error?d(Ms(a.error)):d(null,Ms(a.data)))}else{const d=new Set,p=a.hasCallback?(_,S)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?Jl(_):null,data:Jl(S,d)},d)}:()=>{},y=Ms(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,y,p);else if(this.parent.getWorkerSource){const _=a.type.split("."),{source:S,scope:A}=y;this.parent.getWorkerSource(a.sourceMapId,_[0],S,A)[_[1]](y,p)}else p(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var K0={workerUrl:"",workerClass:null,workerParams:void 0};const dI="mapboxgl_preloaded_worker_pool";class Sp{constructor(){this.active={}}acquire(i,a=Sp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(K0.workerClass!=null?new K0.workerClass:new self.Worker(K0.workerUrl,K0.workerParams));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[dI]}numActive(){return Object.keys(this.active).length}}Sp.workerCount=2;class Vg{constructor(i,a,d="Worker",p=Sp.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=gt();const y=this.workerPool.acquire(this.id,p);for(let _=0;_<y.length;_++){const S=new Vg.Actor(y[_],a,this.id);S.name=`${d} ${_}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,d){$e(this.actors,(p,y)=>{p.send(i,a,y)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Y0,fI;function CS(){return Y0||(Y0=new Sp),Y0}Vg.Actor=tF;class qre{constructor(i){this.module=i}createIntArray(i){const a=new Int32Array(i),d=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heap32.set(a,d/a.BYTES_PER_ELEMENT),d}createFloatArray(i){const a=new Float32Array(i),d=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heapF32.set(a,d/a.BYTES_PER_ELEMENT),d}createStringBuffer(i){const a=this.module.malloc(i.length+1);for(let d=0;d<i.length;++d)this.module.heapU8[a+d]=i.charCodeAt(d);return this.module.heapU8[a+i.length]=0,a}readStringBuffer(i){let a="";for(;this.module.heapU8[i]!==0;)a+=String.fromCharCode(this.module.heapU8[i]),++i;return a}setStyle(i){const a=i.entranceColorRgb,d=i.facadeGlazingColorRgb,p=i.roofColorRgb,y=i.wallColorRgb,_=i.normalScale;this.module.setStyle(a[0],a[1],a[2],d[0],d[1],d[2],p[0],p[1],p[2],y[0],y[1],y[2],_[0],_[1],_[2],i.tileToMeters)}setAOOptions(i,a){this.module.setAOOptions(i?1:0,a)}setMetricOptions(i,a){this.module.setMetricOptions(i?1:0,a)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,a){this.module.setFacadeOptions(i,a?1:0)}setFauxFacadeOptions(i,a,d){this.module.setFauxFacadeOptions(i?1:0,a?1:0,d)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,a){for(const S of i){const A=this.createStringBuffer(S.roofType),C=[0],R=[];for(const H of S.coordinates)if(Array.isArray(H)){for(const W of H)R.push(W.x),R.push(W.y);C.push(R.length)}const D=this.createIntArray(C),j=this.createFloatArray(R);this.module.addFeature(S.id,S.sourceId,S.minHeight,S.height,A,S.roofType.length,j,D,C.length-1),this.module.free(A),this.module.free(D),this.module.free(j)}for(const S of a){let A;A=S.entrances?JSON.parse(S.entrances):[];const C=this.createFloatArray(A),R=[];for(const j of S.coordinates)R.push(j.x),R.push(j.y);const D=this.createFloatArray(R);this.module.addFacade(S.sourceId,S.crossPerc,S.distanceToRoad,C,A.length,D,R.length),this.module.free(C),this.module.free(D)}if(!this.module.generateMesh()){const S=this.module.getLastError();return this.readStringBuffer(S)}const d=this.module.getMeshCount(),p=new Array(d);for(let S=0;S<d;S++){const A=this.module.getPositionsPtr(S),C=this.module.getPositionsLength(S),R=new Float32Array(this.module.heapF32.buffer,A,C),D=this.module.getNormalsPtr(S),j=this.module.getNormalsLength(S),H=new Float32Array(this.module.heapF32.buffer,D,j),W=this.module.getColorsPtr(S),J=this.module.getColorsLength(S),te=new Uint8Array(this.module.heapU8.buffer,W,J),ae=this.module.getAOPtr(S),de=this.module.getAOLength(S),he=new Float32Array(this.module.heapF32.buffer,ae,de),me=this.module.getUVPtr(S),ke=this.module.getUVLength(S),Ee=new Float32Array(this.module.heapF32.buffer,me,ke),Pe=this.module.getFauxFacadePtr(S),Ne=this.module.getFauxFacadeLength(S),Be=new Uint8Array(this.module.heapU8.buffer,Pe,Ne),ct=this.module.getIndicesPtr(S),Ue=this.module.getIndicesLength(S),dt=new Int32Array(this.module.heap32.buffer,ct,Ue),Ct=this.module.getBuildingPart(S),mt=this.readStringBuffer(Ct);p[S]={positions:R,normals:H,colors:te,ao:he,uv:Ee,isFauxFacade:Be,indices:dt,buildingPart:mt}}const y=this.module.getRingCount(),_=[];for(let S=0;S<y;S++){const A=this.module.getRingPtr(S),C=this.module.getRingLength(S),R=new Float32Array(this.module.heapF32.buffer,A,C);_.push(R)}return{meshes:p,modifiedPolygonRings:_}}}let J0,pI,ec,Ug,mI,Gg=null,Hg=null,rF=null,IS=null;function nF(){return jn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:pI||Oo.DRACO_URL}function iF(){if(jn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ug)return Ug;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ug=WebAssembly.validate(c)?Oo.MESHOPT_SIMD_URL:Oo.MESHOPT_URL,Ug}function Zre(){return IS}const MS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Xre={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Q0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function oF(c,i,a){const d=a.json.bufferViews.length,p=a.buffers.length;i.bufferView=d,a.json.bufferViews[d]={buffer:p,byteLength:c.byteLength},a.buffers[p]=c}const gI="KHR_draco_mesh_compression";function Kre(c,i){const a=c.extensions&&c.extensions[gI];if(!a)return;const d=new ec.Decoder,p=cF(i,a.bufferView),y=new ec.Mesh;if(!d.DecodeArrayToMesh(p,p.byteLength,y))throw new Error("Failed to decode Draco mesh");const _=i.json.accessors[c.indices],S=MS[_.componentType],A=_.count*S.BYTES_PER_ELEMENT,C=ec._malloc(A);S===Uint16Array?d.GetTrianglesUInt16Array(y,A,C):d.GetTrianglesUInt32Array(y,A,C),oF(ec.memory.buffer.slice(C,C+A),_,i),ec._free(C);for(const R of Object.keys(a.attributes)){const D=d.GetAttributeByUniqueId(y,a.attributes[R]),j=i.json.accessors[c.attributes[R]],H=Xre[j.componentType],W=j.count*Q0[j.type]*MS[j.componentType].BYTES_PER_ELEMENT,J=ec._malloc(W);d.GetAttributeDataArrayForAllPoints(y,D,ec[H],W,J),oF(ec.memory.buffer.slice(J,J+W),j,i),ec._free(J)}d.destroy(),y.destroy(),delete c.extensions[gI]}const OS="EXT_meshopt_compression";function Yre(c,i){if(!c.extensions||!c.extensions[OS])return;const a=c.extensions[OS],d=new Uint8Array(i.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),p=new Uint8Array(a.count*a.byteStride);mI.decodeGltfBuffer(p,a.count,a.byteStride,d,a.mode,a.filter),c.buffer=i.buffers.length,c.byteOffset=0,i.buffers[c.buffer]=p.buffer,delete c.extensions[OS]}const sF=1179937895,aF=new TextDecoder("utf8");function lF(c,i){return new URL(c,i).href}function Jre(c,i,a,d){return fetch(lF(c.uri,d)).then(p=>p.arrayBuffer()).then(p=>{i.buffers[a]=p})}function cF(c,i){const a=c.json.bufferViews[i];return new Uint8Array(c.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function Qre(c,i,a,d){if(c.uri){const p=lF(c.uri,d);return fetch(p).then(y=>y.blob()).then(y=>createImageBitmap(y)).then(y=>{i.images[a]=y})}if(c.bufferView!==void 0){const p=cF(i,c.bufferView),y=new Blob([p],{type:c.mimeType});return createImageBitmap(y).then(_=>{i.images[a]=_})}}function uF(c,i=0,a){const d={json:null,images:[],buffers:[]};if(new Uint32Array(c,i,1)[0]===sF){const R=new Uint32Array(c,i);let D=2;const j=(R[D++]>>2)-3,H=R[D++]>>2;if(D++,d.json=JSON.parse(aF.decode(R.subarray(D,D+H))),D+=H,D<j){const W=R[D++];D++;const J=i+(D<<2);d.buffers[0]=c.slice(J,J+W)}}else d.json=JSON.parse(aF.decode(new Uint8Array(c,i)));const{buffers:p,images:y,meshes:_,extensionsUsed:S,bufferViews:A}=d.json;let C=Promise.resolve();if(p){const R=[];for(let D=0;D<p.length;D++){const j=p[D];j.uri?R.push(Jre(j,d,D,a)):d.buffers[D]||(d.buffers[D]=null)}C=Promise.all(R)}return C.then(()=>{const R=[],D=S&&S.includes(gI),j=S&&S.includes(OS);if(D&&R.push(function(){if(!ec)return J0??(J0=function(H){let W,J=null;function te(){W=new Uint8Array(J.buffer)}function ae(){throw new Error("Unexpected Draco error.")}const de={a:{a:ae,d:function(he,me,ke){return W.copyWithin(he,me,me+ke)},c:function(he){const me=W.length,ke=Math.max(he>>>0,Math.ceil(1.2*me)),Ee=Math.ceil((ke-me)/65536);try{return J.grow(Ee),te(),!0}catch{return!1}},b:ae}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(H,de):H.then(he=>he.arrayBuffer()).then(he=>WebAssembly.instantiate(he,de))).then(he=>{const{Rb:me,Qb:ke,P:Ee,T:Pe,X:Ne,Ja:Be,La:ct,Qa:Ue,Va:dt,Wa:Ct,eb:mt,jb:wt,f:At,e:at,yb:St,zb:He,Ab:lt,Bb:kt,Db:Tt,Gb:tr}=he.instance.exports;J=at;const Zt=(()=>{let xt=0,Et=0,Yt=0,Vt=0;return jt=>{Yt&&(me(Vt),me(xt),Et+=Yt,Yt=xt=0),xt||(Et+=128,xt=ke(Et));const Gt=jt.length+7&-8;let hr=xt;Gt>=Et&&(Yt=Gt,hr=Vt=ke(Gt));for(let vr=0;vr<jt.length;vr++)W[hr+vr]=jt[vr];return hr}})();return te(),At(),{memory:at,_free:me,_malloc:ke,Mesh:class{constructor(){this.ptr=Ee()}destroy(){Pe(this.ptr)}},Decoder:class{constructor(){this.ptr=Be()}destroy(){wt(this.ptr)}DecodeArrayToMesh(xt,Et,Yt){const Vt=Zt(xt),jt=ct(this.ptr,Vt,Et,Yt.ptr);return!!Ne(jt)}GetAttributeByUniqueId(xt,Et){return{ptr:Ue(this.ptr,xt.ptr,Et)}}GetTrianglesUInt16Array(xt,Et,Yt){dt(this.ptr,xt.ptr,Et,Yt)}GetTrianglesUInt32Array(xt,Et,Yt){Ct(this.ptr,xt.ptr,Et,Yt)}GetAttributeDataArrayForAllPoints(xt,Et,Yt,Vt,jt){mt(this.ptr,xt.ptr,Et.ptr,Yt,Vt,jt)}},DT_INT8:St(),DT_UINT8:He(),DT_INT16:lt(),DT_UINT16:kt(),DT_UINT32:Tt(),DT_FLOAT32:tr()}})}(fetch(nF())),J0.then(H=>{ec=H,J0=void 0}))}()),j&&R.push(function(){if(mI)return;const H=function(W){let J;const te=WebAssembly.instantiateStreaming(W,{}).then(he=>{J=he.instance,J.exports.__wasm_call_ctors()}),ae={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},de={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:te,supported:!0,decodeGltfBuffer(he,me,ke,Ee,Pe,Ne){(function(Be,ct,Ue,dt,Ct,mt,wt){const At=Be.exports.sbrk,at=dt+3&-4,St=At(at*Ct),He=At(mt.length),lt=new Uint8Array(Be.exports.memory.buffer);lt.set(mt,He);const kt=ct(St,dt,Ct,He,mt.length);if(kt===0&&wt&&wt(St,at,Ct),Ue.set(lt.subarray(St,St+dt*Ct)),At(St-At(0)),kt!==0)throw new Error(`Malformed buffer data: ${kt}`)})(J,J.exports[de[Pe]],he,me,ke,Ee,J.exports[ae[Ne]])}}}(fetch(iF()));return H.ready.then(()=>{mI=H})}()),y)for(let H=0;H<y.length;H++)R.push(Qre(y[H],d,H,a));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(D&&_)for(const{primitives:H}of _)for(const W of H)Kre(W,d);if(j&&_&&A)for(const H of A)Yre(H,d);return d})})}function yI(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function _I(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class vI{constructor(i,a,d,p){this.context=i,this.format=d,this.useMipmap=p&&p.useMipmap,this.texture=i.gl.createTexture(),this.update(a,{premultiply:p&&p.premultiply})}update(i,a){const d=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,p=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:y}=this,{gl:_}=y,{x:S,y:A}=a&&a.position?a.position:{x:0,y:0},C=S+d,R=A+p;!this.size||this.size[0]===C&&this.size[1]===R||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!a||a.premultiply!==!1));const D=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&C>0&&R>0){const j=this.useMipmap?Math.floor(Math.log2(Math.max(C,R)))+1:1;_.texStorage2D(_.TEXTURE_2D,j,this.format,C,R),this.size=[C,R]}if(this.size)if(D)_.texSubImage2D(_.TEXTURE_2D,0,S,A,yI(this.format),_I(this.format),i);else{const j=i.data;j&&_.texSubImage2D(_.TEXTURE_2D,0,S,A,d,p,yI(this.format),_I(this.format),j)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(i,a,d=!1){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),i!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap&&!d?i===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),a!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,a),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(i,a,d,p,y){const{context:_}=this,{gl:S}=_;S.bindTexture(S.TEXTURE_2D,this.texture),a!==this.magFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,a),this.magFilter=a),i!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,this.useMipmap?i===S.NEAREST?S.NEAREST_MIPMAP_NEAREST:S.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),d!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,d),this.wrapS=d),p!==this.wrapT&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,p),this.wrapT=p),y!==this.compareMode&&(y?(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_FUNC,y)):S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.NONE),this.compareMode=y)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class ex{constructor(i,a){this.context=i,this.texture=a}bind(i,a){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,i),this.minFilter=i),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrapS=a)}}const ene=Qr([{name:"a_pos_3f",components:3,type:"Float32"}]),tne=Qr([{name:"a_color_3f",components:3,type:"Float32"}]),rne=Qr([{name:"a_color_4f",components:4,type:"Float32"}]),nne=Qr([{name:"a_uv_2f",components:2,type:"Float32"}]),ine=Qr([{name:"a_normal_3f",components:3,type:"Float32"}]),one=Qr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),sne=Qr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function hF(c,i){const a=kS(c.projection,c.zoom,c.width,c.height),d=function(y,_,S,A,C){const R=new F(S.lng-180*Ed,S.lat),D=new F(S.lng+180*Ed,S.lat),j=y.project(R.lng,R.lat),H=y.project(D.lng,D.lat),W=-Math.atan2(H.y-j.y,H.x-j.x),J=Te.fromLngLat(S);J.y=xe(J.y,-1+Ed,1-Ed);const te=J.toLngLat(),ae=y.project(te.lng,te.lat),de=Te.fromLngLat(te);de.x+=Ed;const he=de.toLngLat(),me=y.project(he.lng,he.lat),ke=fF(me.x-ae.x,me.y-ae.y,W),Ee=Te.fromLngLat(te);Ee.y+=Ed;const Pe=Ee.toLngLat(),Ne=y.project(Pe.lng,Pe.lat),Be=fF(Ne.x-ae.x,Ne.y-ae.y,W),ct=Math.abs(ke.x)/Math.abs(Be.y),Ue=z([]);ee(Ue,Ue,-W*(1-(C?0:A)));const dt=z([]);return Z(dt,dt,[1,1-(1-ct)*A,1]),dt[4]=-Be.x/Be.y*A,ee(dt,dt,W),U(dt,Ue,dt),dt}(c.projection,0,c.center,a,i),p=dF(c);return Z(d,d,[p,p,1]),d}function dF(c){const i=c.projection,a=kS(c.projection,c.zoom,c.width,c.height),d=xI(i,c.center),p=xI(i,F.convert(i.center));return Math.pow(2,d*a+(1-a)*p)}function kS(c,i,a,d,p=1/0){const y=c.range;if(!y)return 0;const _=Math.min(p,Math.max(a,d)),S=Math.log(_/1024)/Math.LN2;return Fe(y[0]+S,y[1]+S,i)}const Ed=1/4e4;function xI(c,i){const a=xe(i.lat,-be,be),d=new F(i.lng-180*Ed,a),p=new F(i.lng+180*Ed,a),y=c.project(d.lng,a),_=c.project(p.lng,a),S=Te.fromLngLat(d),A=Te.fromLngLat(p),C=_.x-y.x,R=_.y-y.y,D=A.x-S.x,j=A.y-S.y,H=Math.sqrt((D*D+j*j)/(C*C+R*R));return Math.log(H)/Math.LN2}function fF(c,i,a){const d=Math.cos(a),p=Math.sin(a);return{x:c*d-i*p,y:c*p+i*d}}function pF(c,i,a){z(c),ee(c,c,Br(i[2])),ne(c,c,Br(i[0])),Y(c,c,Br(i[1])),Z(c,c,a),U(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function RS(c,i,a,d,p,y,_,S){const A=[a[0]-i[0],a[1]-i[1],0],C=[d[0]-i[0],d[1]-i[1],0];if(Ye(A)<1e-12||Ye(C)<1e-12)return fo(c);const R=Pr([],A,C);Er(R,R),it(C,d,i),A[2]=(y-p)*S,C[2]=(_-p)*S;const D=A;return Pr(D,A,C),Er(D,D),Ka(c,R,D)}function bI(c,i,a=!1){const d=wd(i.zoom),p=function(y,_,S){const A=_.worldSize,C=[y[12],y[13],y[14]],R=pe(C[1]/A),D=ue(C[0]/A),j=z([]),H=ie(1,R)*A,W=ie(1,0)*A*Ie(R,_.zoom),J=1/XC(A);let te=W*J;if(S){const me=kS(_.projection,_.zoom,_.width,_.height,1024);te=J*_.projection.pixelSpaceConversion(_.center.lat,A,me)}const ae=I(R,D);Je(ae,ae,_t([],Er([],ae),H*te*C[2]));const de=function(me){const ke=[me[0],me[1],me[2]];let Ee=[0,1,0];const Pe=Pr([],Ee,ke);return Pr(Ee,ke,Pe),Sr(Ee)===0&&(Ee=[0,1,0],Pr(Pe,ke,Ee)),Er(Pe,Pe),Er(Ee,Ee),Er(ke,ke),[Pe[0],Pe[1],Pe[2],0,Ee[0],Ee[1],Ee[2],0,ke[0],ke[1],ke[2],0,me[0],me[1],me[2],1]}(ae);Z(j,j,[te,te,te*H]),G(j,j,[-C[0],-C[1],-C[2]]);const he=U([],_.globeMatrix,de);return U(he,he,j),U(he,he,y),he}(c,i,a);if(d>0){const y=function(_,S){const A=S.worldSize,C=ie(1,0)*A*Ie(S.center.lat,S.zoom)/XC(A),R=ie(1,S.center.lat)*A,D=z([]);return Y(D,D,Br(S.center.lng)),ne(D,D,Br(S.center.lat)),G(D,D,[0,0,Jo]),Z(D,D,[C,C,C*R]),G(D,D,[S.point.x-.5*A,S.point.y-.5*A,0]),U(D,D,_),U(D,S.globeMatrix,D)}(c,i);return function(_,S,A){const C=(W,J,te)=>{const ae=Ye(W),de=Ye(J),he=Qu(W,J,te);return _t(he,he,1/Ye(he)*lr(ae,de,te))},R=C([_[0],_[1],_[2]],[S[0],S[1],S[2]],A),D=C([_[4],_[5],_[6]],[S[4],S[5],S[6]],A),j=C([_[8],_[9],_[10]],[S[8],S[9],S[10]],A),H=Qu([_[12],_[13],_[14]],[S[12],S[13],S[14]],A);return[R[0],R[1],R[2],0,D[0],D[1],D[2],0,j[0],j[1],j[2],0,H[0],H[1],H[2],1]}(p,y,d)}return p}function mF(c,i,a,d){const p=Fr.projectAabbCorners(d,a);let y=Number.MAX_VALUE,_=-1;for(let C=0;C<p.length;++C){const R=p[C];R[0]=(.5*R[0]+.5)*i.width,R[1]=(.5-.5*R[1])*i.height,R[2]<y&&(_=C,y=R[2])}const S=C=>new ut(p[C][0],p[C][1]);let A;switch(_){case 0:case 6:A=[S(1),S(5),S(4),S(7),S(3),S(2),S(1)];break;case 1:case 7:A=[S(0),S(4),S(5),S(6),S(2),S(3),S(0)];break;case 3:case 5:A=[S(1),S(0),S(4),S(7),S(6),S(2),S(1)];break;default:A=[S(1),S(5),S(6),S(7),S(3),S(0),S(1)]}if(Nn(c,A))return y}const Tp=64,Wg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function gF(c,i,a,d,p,y,_,S,A,C=!1){const R=a.zoom,D=a.project(d),j=Ie(d.lat,R),H=1/j;z(c),G(c,c,[D.x+_[0]*H,D.y+_[1]*H,_[2]]);let W=1,J=1;const te=a.worldSize;if(C){if(a.projection.name==="mercator"){let me=0;a.elevation&&(me=a.elevation.getAtPointOrZero(new Te(D.x/te,D.y/te),0));const ke=Ci([],[D.x,D.y,me,1],a.projMatrix)[3]/a.cameraToCenterDistance;W=ke,J=ke*Ie(a.center.lat,R)}else if(a.projection.name==="globe"){const me=bI(c,a),ke=[0,0,0,1];Ci(ke,ke,U([],a.projMatrix,me));const Ee=ke[3]/a.cameraToCenterDistance,Pe=wd(R),Ne=a.projection.pixelsPerMeter(d.lat,te)*Ie(d.lat,R),Be=a.projection.pixelsPerMeter(a.center.lat,te)*Ie(a.center.lat,R);W=Ee/lr(Ne,Ae(a.center.lat),Pe),J=Ee*j/Ne,W*=Be,J*=Be}}else W=H;Z(c,c,[W,W,J]);const ae=[...c],de=i.orientation,he=[];if(pF(he,[de[0]+p[0],de[1]+p[1],de[2]+p[2]],y),U(c,ae,he),S&&a.elevation){let me=0;const ke=[];if(A&&a.elevation){me=function(Pe,Ne,Be,ct,Ue){const dt=Ne.elevation;if(!dt)return 0;const Ct=Fr.projectAabbCorners(Be,ct),mt=ie(1,Ue.lat)*Ne.worldSize,wt=function(Et,Yt){const Vt=[0,0,1],jt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Gt of jt){const hr=Et[Gt.corners[0]],vr=Et[Gt.corners[1]],Cr=Et[Gt.corners[2]],Tr=[vr[0]-hr[0],vr[1]-hr[1],Yt*(vr[2]-hr[2])],Zr=Pr(Tr,Tr,[Cr[0]-hr[0],Cr[1]-hr[1],Yt*(Cr[2]-hr[2])]);Er(Zr,Zr),Gt.dotProductWithUp=Kt(Zr,Vt)}return jt.sort((Gt,hr)=>Gt.dotProductWithUp-hr.dotProductWithUp),jt[0].corners}(Ct,mt),At=Ct[wt[0]],at=Ct[wt[1]],St=Ct[wt[2]],He=Ct[wt[3]],lt=dt.getAtPointOrZero(new Te(At[0]/Ne.worldSize,At[1]/Ne.worldSize),0),kt=dt.getAtPointOrZero(new Te(at[0]/Ne.worldSize,at[1]/Ne.worldSize),0),Tt=dt.getAtPointOrZero(new Te(St[0]/Ne.worldSize,St[1]/Ne.worldSize),0),tr=dt.getAtPointOrZero(new Te(He[0]/Ne.worldSize,He[1]/Ne.worldSize),0),Zt=(lt+tr)/2,xt=(kt+Tt)/2;return Zt>xt?kt<Tt?RS(Pe,at,He,At,kt,tr,lt,mt):RS(Pe,St,At,He,Tt,lt,tr,mt):lt<tr?RS(Pe,At,at,St,lt,kt,Tt,mt):RS(Pe,He,St,at,tr,Tt,kt,mt),Math.max(Zt,xt)}(ke,a,i.aabb,c,d);const Ee=U([],Ce([],ke),he);U(c,ae,Ee)}else me=a.elevation.getAtPointOrZero(new Te(D.x/te,D.y/te),0);me!==0&&(c[14]+=me)}}function tx(c,i,a=!1){c.uploaded||(c.gfxTexture=new vI(i,c.image,a?i.gl.R8:i.gl.RGBA8,{useMipmap:c.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function ane(c,i,a){c.indexBuffer=i.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=i.createVertexBuffer(c.vertexArray,ene.members,!1,!0),c.normalArray&&(c.normalBuffer=i.createVertexBuffer(c.normalArray,ine.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=i.createVertexBuffer(c.texcoordArray,nne.members,!1,!0)),c.colorArray&&(c.colorBuffer=i.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?tne:rne).members,!1,!0)),c.featureArray&&(c.pbrBuffer=i.createVertexBuffer(c.featureArray,sne.members,!0)),c.segments=ci.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const d=c.material;d.pbrMetallicRoughness.baseColorTexture&&tx(d.pbrMetallicRoughness.baseColorTexture,i),d.pbrMetallicRoughness.metallicRoughnessTexture&&tx(d.pbrMetallicRoughness.metallicRoughnessTexture,i),d.normalTexture&&tx(d.normalTexture,i),d.occlusionTexture&&tx(d.occlusionTexture,i,a),d.emissionTexture&&tx(d.emissionTexture,i)}function wI(c,i,a){if(c.meshes)for(const d of c.meshes)ane(d,i,a);if(c.children)for(const d of c.children)wI(d,i,a)}function DS(c){if(c.meshes)for(const i of c.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(c.children)for(const i of c.children)DS(i)}function SI(c){if(c.meshes)for(const a of c.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((i=a.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(c.children)for(const a of c.children)SI(a)}function Ep(c,i){const a=c.json.bufferViews[i.bufferView],d=MS[i.componentType];return new d(c.buffers[a.buffer],(i.byteOffset||0)+(a.byteOffset||0),i.count*(a.byteStride&&a.byteStride!==Q0[i.type]*d.BYTES_PER_ELEMENT?a.byteStride/d.BYTES_PER_ELEMENT:Q0[i.type]))}function TI(c,i,a,d){const p=MS[i.componentType],y=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),_=c.json.bufferViews[i.bufferView],S=_.byteStride?_.byteStride/p.BYTES_PER_ELEMENT:Q0[i.type],A=a.float32,C=A.length/a.capacity;for(let R=0,D=0;R<i.count*S;R+=S,D+=C)for(let j=0;j<C;j++)A[D+j]=d[R+j]*y;a._trim()}function lne(c,i,a){const d=c.indices,p=c.attributes,y={};y.indexArray=new ii;const _=i.json.accessors[d],S=_.count/3;y.indexArray.reserve(S);const A=Ep(i,_);for(let j=0;j<S;j++)y.indexArray.emplaceBack(A[3*j],A[3*j+1],A[3*j+2]);y.indexArray._trim(),y.vertexArray=new na;const C=i.json.accessors[p.POSITION];y.vertexArray.reserve(C.count);const R=Ep(i,C);for(let j=0;j<C.count;j++)y.vertexArray.emplaceBack(R[3*j],R[3*j+1],R[3*j+2]);if(y.vertexArray._trim(),y.aabb=new Fr(C.min,C.max),y.centroid=function(j,H){const W=[0,0,0],J=j.length;if(J>0){for(let te=0;te<J;te++){const ae=3*j[te];W[0]+=H[ae],W[1]+=H[ae+1],W[2]+=H[ae+2]}W[0]/=J,W[1]/=J,W[2]/=J}return W}(A,R),p.COLOR_0!==void 0){const j=i.json.accessors[p.COLOR_0],H=Q0[j.type],W=Ep(i,j);y.colorArray=H===3?new na:new Jc,y.colorArray.resize(j.count),TI(i,j,y.colorArray,W)}if(p.NORMAL!==void 0){y.normalArray=new na;const j=i.json.accessors[p.NORMAL];y.normalArray.resize(j.count);const H=Ep(i,j);TI(i,j,y.normalArray,H)}if(p.TEXCOORD_0!==void 0&&a.length>0){y.texcoordArray=new Qc;const j=i.json.accessors[p.TEXCOORD_0];y.texcoordArray.resize(j.count);const H=Ep(i,j);TI(i,j,y.texcoordArray,H)}if(p._FEATURE_ID_RGBA4444!==void 0){const j=i.json.accessors[p._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(y.featureData=Ep(i,j))}p._FEATURE_RGBA4444!==void 0&&(y.featureData=new Uint32Array(Ep(i,i.json.accessors[p._FEATURE_RGBA4444]).buffer));const D=c.material;return y.material=function(j,H){const{emissiveFactor:W=[0,0,0],alphaMode:J="OPAQUE",alphaCutoff:te=.5,normalTexture:ae,occlusionTexture:de,emissiveTexture:he,doubleSided:me}=j,{baseColorFactor:ke=[1,1,1,1],metallicFactor:Ee=1,roughnessFactor:Pe=1,baseColorTexture:Ne,metallicRoughnessTexture:Be}=j.pbrMetallicRoughness||{},ct=de?H[de.index]:void 0;if(de&&de.extensions&&de.extensions.KHR_texture_transform&&ct){const Ue=de.extensions.KHR_texture_transform;ct.offsetScale=[Ue.offset[0],Ue.offset[1],Ue.scale[0],Ue.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Sn(...ke),metallicFactor:Ee,roughnessFactor:Pe,baseColorTexture:Ne?H[Ne.index]:void 0,metallicRoughnessTexture:Be?H[Be.index]:void 0},doubleSided:me,emissiveFactor:new Sn(...W),alphaMode:J,alphaCutoff:te,normalTexture:ae?H[ae.index]:void 0,occlusionTexture:ct,emissionTexture:he?H[he.index]:void 0,defined:j.defined===void 0}}(D!==void 0?i.json.materials[D]:{defined:!1},a),y}function yF(c,i,a){const{matrix:d,rotation:p,translation:y,scale:_,mesh:S,extras:A,children:C}=c,R={};if(R.matrix=d||function(D,j,H,W){var J=j[0],te=j[1],ae=j[2],de=j[3],he=J+J,me=te+te,ke=ae+ae,Ee=J*he,Pe=J*me,Ne=J*ke,Be=te*me,ct=te*ke,Ue=ae*ke,dt=de*he,Ct=de*me,mt=de*ke,wt=W[0],At=W[1],at=W[2];return D[0]=(1-(Be+Ue))*wt,D[1]=(Pe+mt)*wt,D[2]=(Ne-Ct)*wt,D[3]=0,D[4]=(Pe-mt)*At,D[5]=(1-(Ee+Ue))*At,D[6]=(ct+dt)*At,D[7]=0,D[8]=(Ne+Ct)*at,D[9]=(ct-dt)*at,D[10]=(1-(Ee+Be))*at,D[11]=0,D[12]=H[0],D[13]=H[1],D[14]=H[2],D[15]=1,D}([],p||[0,0,0,1],y||[0,0,0],_||[1,1,1]),S!==void 0){R.meshes=a[S];const D=R.anchor=[0,0];for(const j of R.meshes){const{min:H,max:W}=j.aabb;D[0]+=H[0]+W[0],D[1]+=H[1]+W[1]}D[0]=Math.floor(D[0]/R.meshes.length/2),D[1]=Math.floor(D[1]/R.meshes.length/2)}if(A&&(A.id&&(R.id=A.id),A.lights&&(R.lights=function(D){if(!D.length)return[];const j=function(ae){const de=atob(ae),he=new Uint8Array(de.length);for(let me=0;me<de.length;me++)he[me]=de.codePointAt(me);return he}(D),H=[],W=j.length/24,J=new Uint16Array(j.buffer),te=new Float32Array(j.buffer);for(let ae=0;ae<W;ae++){const de=J[2*ae*6]/30,he=J[2*ae*6+1]/30,me=J[2*ae*6+10]/100,ke=te[6*ae+1],Ee=te[6*ae+2],Pe=te[6*ae+3],Ne=te[6*ae+4],Be=Pe-ke,ct=Ne-Ee,Ue=Math.hypot(Be,ct);H.push({pos:[ke+.5*Be,Ee+.5*ct,he],normal:[ct/Ue,-Be/Ue,0],width:Ue,height:de,depth:me,points:[ke,Ee,Pe,Ne]})}return H}(A.lights))),C){const D=[];for(const j of C)D.push(yF(i.json.nodes[j],i,a));R.children=D}return R}function cne(c){if(c.vertices.length===0||c.indices.length===0)return null;const i=new wS(c.vertices,c.indices,8,256),[a,d]=[i.min.clone(),i.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:i,min:a,max:d}}function une(c){if(!c.extras||!c.extras.ground)return null;const i=c.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const a=i[0];if(!a||!Array.isArray(a)||a.length===0)return null;const d=[];for(const _ of a){if(!Array.isArray(_)||_.length!==2)continue;const S=_[0],A=_[1];typeof S=="number"&&typeof A=="number"&&d.push(new ut(S,A))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let p=0;for(let _=0;_<d.length;_++){const S=d[_],A=d[(_+1)%d.length],C=d[(_+2)%d.length];p+=(S.x-A.x)*(C.y-A.y)-(C.x-A.x)*(S.y-A.y)}p>0&&d.reverse();const y=Bg(d.flatMap(_=>[_.x,_.y]),[]);return y.length===0?null:{vertices:d,indices:y}}function hne(c,i){const a=[],d=[];let p=0;const y=[];for(const _ of c){p=a.length;const S=_.vertexArray.float32,A=_.indexArray.uint16;for(let C=0;C<_.vertexArray.length;C++)y[0]=S[3*C+0],y[1]=S[3*C+1],y[2]=S[3*C+2],nr(y,y,i),a.push(new ut(y[0],y[1]));for(let C=0;C<3*_.indexArray.length;C++)d.push(A[C]+p)}if(d.length%3!=0)return null;for(let _=0;_<d.length;_+=3){const S=a[d[_+0]],A=a[d[_+1]],C=a[d[_+2]];(S.x-A.x)*(C.y-A.y)-(C.x-A.x)*(S.y-A.y)>0&&([d[_+1],d[_+2]]=[d[_+2],d[_+1]])}return{vertices:a,indices:d}}function _F(c){const i=function(A,C){const R=[],D=WebGL2RenderingContext;if(A.json.textures)for(const j of A.json.textures){const H={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};j.sampler!==void 0&&Object.assign(H,A.json.samplers[j.sampler]),R.push({image:C[j.source],sampler:H,uploaded:!1})}return R}(c,c.images),a=function(A,C){const R=[];for(const D of A.json.meshes){const j=[];for(const H of D.primitives)j.push(lne(H,A,C));R.push(j)}return R}(c,i),{scenes:d,scene:p,nodes:y}=c.json,_=d?d[p||0].nodes:y,S=[];for(const A of _)S.push(yF(y[A],c,a));return function(A,C,R){const D={},j=new Set;for(let H=0;H<A.length;H++){const W=R[C[H]];if(!W.extras)continue;const J=W.extras["mapbox:footprint:version"],te=W.extras["mapbox:footprint:id"];(J||te)&&j.add(H),J==="1.0.0"&&te&&(D[te]=H)}for(let H=0;H<A.length;H++){if(j.has(H))continue;const W=A[H],J=R[C[H]];if(!J.extras)continue;let te=null;W.id in D&&(te=hne(A[D[W.id]].meshes,W.matrix)),te||(te=une(J)),te&&(W.footprint=cne(te))}if(j.size>0){const H=Array.from(j.values()).sort((W,J)=>W-J);for(let W=H.length-1;W>=0;W--)A.splice(H[W],1)}}(S,_,c.json.nodes),S}function dne(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const i=c.vertexArray.float32,a=c.aabb.min[0]-1,d=c.aabb.min[1]-1,p=Tp/(c.aabb.max[0]-a+2),y=Tp/(c.aabb.max[1]-d+2);for(let _=0;_<i.length;_+=3){const S=i[_+2],A=(i[_+0]-a)*p|0,C=(i[_+1]-d)*y|0;S>c.heightmap[C*Tp+A]&&(c.heightmap[C*Tp+A]=S)}}function vF(c,i,a,d,p){a.reserve(a.length+4*c.length),d.reserve(d.length+10*c.length),p.reserve(p.length+10*c.length);let y=d.length;for(const _ of c){const S=Math.min(10,Math.max(4,1.3*_.height))*i,A=[-_.normal[1],_.normal[0],0],C=Math.min(.29,.1*_.width/_.depth),R=_.width-2*_.depth*i*(C+.01),D=It([],_.pos,A,R/2),j=It([],_.pos,A,-R/2),H=[D[0],D[1],D[2]+_.height],W=[j[0],j[1],j[2]+_.height],J=It([],_.normal,A,C);_t(J,J,S);const te=It([],_.normal,A,-C);_t(te,te,S),Je(J,D,J),Je(te,j,te),D[2]+=.1,j[2]+=.1,d.emplaceBack(J[0],J[1],J[2]),d.emplaceBack(te[0],te[1],te[2]),d.emplaceBack(D[0],D[1],D[2]),d.emplaceBack(j[0],j[1],j[2]),d.emplaceBack(H[0],H[1],H[2]),d.emplaceBack(W[0],W[1],W[2]),d.emplaceBack(D[0],D[1],D[2]),d.emplaceBack(j[0],j[1],j[2]),d.emplaceBack(J[0],J[1],J[2]),d.emplaceBack(te[0],te[1],te[2]);const ae=R/S/2;p.emplaceBack(-ae-C,-1,ae,.8),p.emplaceBack(ae+C,-1,ae,.8),p.emplaceBack(-ae,0,ae,1.3),p.emplaceBack(ae,0,ae,1.3),p.emplaceBack(ae+C,-.8,ae,.7),p.emplaceBack(ae+C,-.8,ae,.7),p.emplaceBack(0,0,ae,1.3),p.emplaceBack(0,0,ae,1.3),p.emplaceBack(ae+C,-1.2,ae,.8),p.emplaceBack(ae+C,-1.2,ae,.8),a.emplaceBack(6+y,4+y,8+y),a.emplaceBack(7+y,9+y,5+y),a.emplaceBack(0+y,1+y,2+y),a.emplaceBack(1+y,3+y,2+y),y+=10}}function fne(c,i){const a={};a.indexArray=new ii,a.vertexArray=new na,a.colorArray=new Jc,vF(c,i,a.indexArray,a.vertexArray,a.colorArray);const d={defined:!0};d.emissiveFactor=Sn.black;const p={};return p.baseColorFactor=Sn.white,d.pbrMetallicRoughness=p,a.material=d,a.aabb=new Fr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const xF=Qr([{name:"a_pos_3f",components:3,type:"Float32"}]),pne=Qr([{name:"a_normal_3",components:3,type:"Int16"}]),bF=Qr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),mne=Qr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),wF=Xe.types,EI=32767;function gne(c,i){const a=Lt+i;for(const d of c)for(const p of d)if(p.x<-i||p.x>a||p.y<-i||p.y>a)return!1;return!0}class SF{constructor(i){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.layoutVertexArray=new na,this.layoutNormalArray=new ud,this.layoutColorArray=new xl,this.indexArray=new ii,this.indexArrayForConflation=new ii,this.entranceBloom={layoutVertexArray:new na,layoutVertexBuffer:null,layoutAttenuationArray:new Jc,layoutAttenuationBuffer:null,layoutColorArray:new xl,layoutColorBuffer:null,indexArray:new ii,indexArrayForConflation:new ii,indexBuffer:null,segmentsBucket:new ci},this.programConfigurations=new oa(i.layers,{zoom:i.zoom,lut:i.lut}),this.segmentsBucket=new ci,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection,this.groundEffect=new uI(i)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(i,a){for(const d of this.footprints)a.push({footprint:d,id:i})}prepare(){return function(){if(IS!=null||rF!=null)return null;if(Hg!=null)return Hg;const i=fetch(Oo.BUILDING_GEN_URL);return Hg=function(a){let d,p,y,_;function S(){d=new Uint8Array(_.buffer),p=new Int32Array(_.buffer),y=new Float32Array(_.buffer)}function A(){throw new Error("Unexpected BuildingGen error.")}const C=()=>{},R={a:{a:A,f:function(D){const j=d.length,H=Math.max(D>>>0,Math.ceil(1.2*j)),W=Math.ceil((H-j)/65536);try{return _.grow(W),S(),!0}catch{return!1}},g:A,b:C,c:C,d:C,e:C}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,R):a.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,R))).then(D=>{const j=D.instance.exports;return(0,j.g)(),_=j.f,S(),new qre({setStyle:j.h,setAOOptions:j.i,setMetricOptions:j.j,setStructuralOptions:j.k,setFacadeOptions:j.l,setFauxFacadeOptions:j.m,setFacadeClassifierOptions:j.n,addFeature:j.o,addFacade:j.p,generateMesh:j.q,getLastError:j.r,getMeshCount:j.s,getPositionsPtr:j.t,getPositionsLength:j.u,getNormalsPtr:j.v,getNormalsLength:j.w,getColorsPtr:j.x,getColorsLength:j.y,getAOPtr:j.z,getAOLength:j.A,getUVPtr:j.B,getUVLength:j.C,getFauxFacadePtr:j.D,getFauxFacadeLength:j.E,getIndicesPtr:j.F,getIndicesLength:j.G,getBuildingPart:j.H,getRingCount:j.I,getRingPtr:j.J,getRingLength:j.K,free:j.L,malloc:j.M,heapU8:d,heap32:p,heapF32:y})})}(i).then(a=>(Hg=null,IS=a,IS)).catch(a=>{qr("Could not load building-gen"),Hg=null,rF=a}),Hg}()}populate(i,a,d,p){const y=Zre();if(!y)return;const _=Se(d);this.tileToMeter=_,this.brightness=a.brightness,y.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,_],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:_,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),y.setAOOptions(!1,.3),y.setMetricOptions(!1,16),y.setStructuralOptions(!0),y.setFacadeOptions(4,!0),y.setFauxFacadeOptions(!1,!1,1),y.setFacadeClassifierOptions(3);const S=new Map;for(const{feature:A}of i){if(wF[A.type]!=="LineString")continue;const C=this.layers[0]._featureFilter.needGeometry,R=st(A,C);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),R,d))continue;const D=C?R.geometry:De(A,d,p),j=[];for(const te of D)for(const ae of te)j.push({x:ae.x,y:ae.y});const H={coordinates:j,crossPerc:A.properties.cross_perc,distanceToRoad:A.properties.distance_to_road,entrances:A.properties.entrances,sourceId:0},W=A.properties.source_id;let J=S.get(W);J||(J=[],S.set(W,J)),J.push(H)}this.maxHeight=0;for(const{feature:A,index:C}of i){if(wF[A.type]==="LineString")continue;const R=this.layers[0]._featureFilter.needGeometry,D=st(A,R);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),D,d))continue;const j=R?D.geometry:De(A,d,p),H=G0(j,500);if(!gne(j,163))continue;const W=this.layers[0],J=W.layout.get("building-base").evaluate(A,{},d),te=W.layout.get("building-height").evaluate(A,{},d),ae=W.layout.get("building-roof-shape").evaluate(A,{},d),de=W.paint.get("building-ambient-occlusion-intensity"),he=W.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(ae==="flat")continue;const me=A.properties.source_id;let ke;ke=S.has(me)?S.get(me):[];const Ee=[],Pe=new ut(1/0,1/0),Ne=new ut(-1/0,-1/0);for(const xt of H)if(xt.length>0){const Et=[];for(const Yt of xt){const Vt=[];for(let jt=Yt.length-1;jt>=0;jt--){const Gt=Yt[jt];Vt.push({x:Gt.x,y:Gt.y}),Pe.x=Math.min(Pe.x,Gt.x),Pe.y=Math.min(Pe.y,Gt.y),Ne.x=Math.max(Ne.x,Gt.x),Ne.y=Math.max(Ne.y,Gt.y)}Et.push(Vt)}Ee.push({id:A.id,height:te,minHeight:J,sourceId:0,roofType:ae,coordinates:Et})}const Be=y.generateMesh(Ee,ke);if(typeof Be=="string"||Be.meshes.length===0||Be.modifiedPolygonRings.length===0)continue;let ct=0;for(const xt of Be.meshes)ct+=xt.positions.length/3;const Ue=this.segmentsBucket.prepareSegment(ct,this.layoutVertexArray,this.indexArray),dt=[];let Ct=null,mt=0,wt=-1;const At=this.indexArray.length;let at=0;for(const xt of Be.meshes){const Et=this.layoutVertexArray.length;if(xt.buildingPart==="entrance"){const Vt=new Array;for(let vr=0;vr<xt.indices.length;vr+=12){const Cr=xt.positions[vr+0],Tr=xt.positions[vr+1],Zr=xt.positions[vr+3],jr=xt.positions[vr+4],Yn=xt.positions[vr+2],_e=xt.positions[vr+8]-Yn,ve=1,ot=Zr-Cr,Rt=jr-Tr,zt=Math.hypot(ot,Rt);Vt.push({pos:[Cr+.5*ot,Tr+.5*Rt,Yn],normal:[Rt/zt,-ot/zt,0],width:zt,height:_e,depth:ve,points:[Cr,Tr,Zr,jr]})}const jt=this.entranceBloom.segmentsBucket.prepareSegment(10*Vt.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),Gt=this.entranceBloom.layoutVertexArray.length;mt=this.entranceBloom.indexArray.length,vF(Vt,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const hr=this.entranceBloom.layoutVertexArray.length-Gt;wt=this.entranceBloom.indexArray.length-mt;for(let vr=0;vr<hr;vr++)this.entranceBloom.layoutColorArray.emplaceBack(65535,65535);jt.vertexLength+=hr,jt.primitiveLength+=wt,Ct={part:xt.buildingPart,vertexOffset:Gt,vertexLength:hr}}for(let Vt=0;Vt<xt.positions.length;Vt+=3)at=Math.max(at,xt.positions[Vt+2]),this.layoutVertexArray.emplaceBack(xt.positions[Vt],xt.positions[Vt+1],xt.positions[Vt+2]);for(let Vt=0;Vt<xt.normals.length;Vt+=3)this.layoutNormalArray.emplaceBack(xt.normals[Vt+0]*EI,xt.normals[Vt+1]*EI,xt.normals[Vt+2]*EI);for(let Vt=0;Vt<xt.ao.length;Vt++)this.layoutAOArray.push(xt.ao[Vt]);for(let Vt=0;Vt<xt.colors.length;Vt+=3){const jt=1+(xt.ao[Vt/3]-1)*de;this.layoutColorArray.emplaceBack(xt.colors[Vt]*jt<<8|xt.colors[Vt+1]*jt,xt.colors[Vt+2]*jt<<8)}const Yt=Ue.vertexLength;for(let Vt=0;Vt<xt.indices.length;Vt+=3)this.indexArray.emplaceBack(Yt+xt.indices[Vt],Yt+xt.indices[Vt+1],Yt+xt.indices[Vt+2]);Ue.vertexLength+=xt.positions.length/3,Ue.primitiveLength+=xt.indices.length/3,(xt.buildingPart==="roof"||xt.buildingPart==="wall"||xt.buildingPart==="facade_glazing"||xt.buildingPart==="entrance")&&dt.push({part:xt.buildingPart,vertexOffset:Et,vertexLength:xt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,at),this.buildingFeatures.push({feature:D,segment:Ue,parts:dt,buildingBloom:Ct});const St=this.indexArray.length-At,He=[],lt=[],kt=new ut(1/0,1/0),Tt=new ut(-1/0,-1/0),tr=this.groundEffect.vertexArray.length;for(const xt of Be.modifiedPolygonRings){const Et=[],Yt=new ut(1/0,1/0),Vt=new ut(-1/0,-1/0);for(let jt=0;jt<xt.length;jt+=2){const Gt=xt.length-jt-2;Yt.x=Math.min(Yt.x,xt[Gt]),Yt.y=Math.min(Yt.y,xt[Gt+1]),Vt.x=Math.max(Vt.x,xt[Gt]),Vt.y=Math.max(Vt.y,xt[Gt+1]);const hr=new ut(xt[Gt],xt[Gt+1]);Et.push(hr),He.push(hr.x,hr.y),lt.push(hr.clone())}kt.x=Math.min(kt.x,Yt.x),kt.y=Math.min(kt.y,Yt.y),Tt.x=Math.max(Tt.x,Vt.x),Tt.y=Math.max(Tt.y,Vt.y),this.groundEffect.addData(Et,[Yt,Vt],he)}const Zt=this.groundEffect.vertexArray.length-tr;(Pe.x<0||Ne.x>Lt||Pe.y<0||Ne.y>Lt)&&this.featuresOnBorder.push({featureId:A.id,footprintIndex:this.footprints.length});{const xt=Bg(He,null,2),Et=new wS(lt,xt,8,256);let Yt=A.id;A.properties&&A.properties.hasOwnProperty("building_id")&&(Yt=A.properties.building_id),this.footprints.push({vertices:lt,indices:xt,grid:Et,min:kt,max:Tt,buildingId:Yt,hiddenFlags:0,indicesOffset:At,indicesLength:St,bloomIndicesOffset:mt,bloomIndicesLength:wt,groundEffectVertexOffset:tr,groundEffectVertexLength:Zt,segment:Ue,height:at})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,C,{},a.availableImages,d,a.brightness),this.groundEffect.addPaintPropertiesData(A,C,{},a.availableImages,d,a.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(i,a,d,p,y,_,S){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,S),this.groundEffect.update(i,a,y,d,p,_,S)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,xF.members),this.layoutNormalBuffer=i.createVertexBuffer(this.layoutNormalArray,pne.members),this.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(this.entranceBloom.layoutVertexArray,xF.members),this.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,mne.members),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(i,a,d=!0){let p=!1;const y=d?a:0,_=0|(d?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const S of i){const A=this.footprints[S],C=A.hiddenFlags&_|y;A.hiddenFlags!==C&&(A.hiddenFlags=C,p=!0,this.groundEffect.updateHiddenByLandmarkRange(A.groundEffectVertexOffset,A.groundEffectVertexLength,A.hiddenFlags!==0))}return p&&(this.indexArrayForConflationUploaded=!1),p}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),!this.indexArrayForConflationUploaded&&this.indexArray.length!==0){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const a of this.footprints){const d=a.indicesOffset+a.indicesLength;if(a.hiddenFlags!==0){for(let y=a.indicesOffset;y<d;y++)this.indexArrayForConflation.uint16[3*y+0]=0,this.indexArrayForConflation.uint16[3*y+1]=0,this.indexArrayForConflation.uint16[3*y+2]=0;const p=a.bloomIndicesOffset+a.bloomIndicesLength;for(let y=a.bloomIndicesOffset;y<p;y++)this.entranceBloom.indexArrayForConflation.uint16[3*y+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*y+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*y+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=i.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=i.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(i){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=i.createVertexBuffer(this.layoutColorArray,bF.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=i.createVertexBuffer(this.entranceBloom.layoutColorArray,bF.members,!0)}evaluate(i){const a=i.paint.get("building-ambient-occlusion-intensity");for(const d of this.buildingFeatures){const p=d.feature;p.properties["building-part"]="roof";const y=i.paint.get("building-color").evaluate(p,{},this.canonical),_=i.paint.get("building-emissive-strength").evaluate(p,{},this.canonical);p.properties["building-part"]="wall";const S=i.paint.get("building-color").evaluate(p,{},this.canonical),A=i.paint.get("building-emissive-strength").evaluate(p,{},this.canonical);p.properties["building-part"]="window";const C=i.paint.get("building-color").evaluate(p,{},this.canonical),R=i.paint.get("building-emissive-strength").evaluate(p,{},this.canonical);p.properties["building-part"]="door";const D=i.paint.get("building-color").evaluate(p,{},this.canonical),j=i.paint.get("building-emissive-strength").evaluate(p,{},this.canonical);for(const W of d.parts){let J,te=y;W.part==="roof"?(te=y,J=_):W.part==="wall"?(te=S,J=A):W.part==="facade_glazing"?(te=C,J=R):W.part==="entrance"&&(te=D,J=j),J=xe(J,0,1);for(let ae=0;ae<W.vertexLength;ae++){const de=W.vertexOffset+ae,he=1+(this.layoutAOArray[de]-1)*a;this.layoutColorArray.emplace(de,te.r*he*255<<8|te.g*he*255,te.b*he*255<<8|255*J)}}const H=d.buildingBloom;if(H)for(let W=0;W<H.vertexLength;W++)this.bloomGeometry.layoutColorArray.emplace(H.vertexOffset+W,255*D.r<<8|255*D.g,255*D.b<<8|51*j)}}needsEvaluation(i,a){const d=i.transform.projectionOptions,p=i.style.getBrightness();return!(this.uploaded&&d.name===this.projection.name&&this.brightness===p||(this.projection=d,this.brightness=p,0))}updateReplacement(i,a,d){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const p=a.getReplacementRegionsForTile(i.toUnwrapped());if(TS(this.activeReplacements,p))return;this.activeReplacements=p;for(const _ of this.footprints)_.hiddenFlags&=-2;const y=[];for(const _ of this.activeReplacements){if(_.order<=Cz)continue;const S=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));for(const A of this.footprints)A.min.x>_.max.x||A.max.x<_.min.x||A.min.y>_.max.y||A.max.y<_.min.y||(y.length=0,yne(A.vertices,0,A.vertices.length,_.footprintTileId.canonical,i.canonical,y),sI(_.footprint,y,A.indices,0,A.indices.length,0,-S)&&(A.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(i,a){let d=Number.NEGATIVE_INFINITY,p=!0;const y=4*(i+Lt)*Lt+(a+Lt);if(this.footprintLookup.hasOwnProperty(y)){const S=this.footprintLookup[y];return S?{height:S.height,hidden:S.hiddenFlags!==0}:void 0}const _=new ut(i,a);for(const S of this.footprints)i>S.max.x||S.min.x>i||a>S.max.y||S.min.y>a||S.height<=d||aI(_,S)&&(d=S.height,this.footprintLookup[y]=S,p=S.hiddenFlags!==0);if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:p};this.footprintLookup[y]=void 0}}function yne(c,i,a,d,p,y){const _=Math.pow(2,d.z-p.z);for(let S=0;S<a;S++){let A=c[S+i].x,C=c[S+i].y;A=(A+p.x*Lt)*_-d.x*Lt,C=(C+p.y*Lt)*_-d.y*Lt,y.push(new ut(A,C))}}let TF,EF;Wt(SF,"BuildingBucket",{omit:["layers"]});const _ne=Qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),vne=Qr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:xne}=_ne,bne=Qr([{name:"a_packed",components:3,type:"Float32"}]),{members:wne}=bne,Sne=Qr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Tne}=Sne;class AF{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new Sd({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const d=this.getKey(i,a);return this.positions[d]}trim(){const i=this.width,a=this.height=ar(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,d){const p=[];let y=i.length%2==1?-i[i.length-1]*d:0,_=i[0]*d,S=!0;p.push({left:y,right:_,isDash:S,zeroLength:i[0]===0});let A=i[0];for(let C=1;C<i.length;C++){S=!S;const R=i[C];y=A*d,A+=R,_=A*d,p.push({left:y,right:_,isDash:S,zeroLength:R===0})}return p}addRoundDash(i,a,d){const p=a/2;for(let y=-d;y<=d;y++){const _=this.width*(this.nextRow+d+y);let S=0,A=i[S];for(let C=0;C<this.width;C++){C/A.right>1&&(A=i[++S]);const R=Math.abs(C-A.left),D=Math.abs(C-A.right),j=Math.min(R,D);let H;const W=y/d*(p+1);if(A.isDash){const J=p-Math.abs(W);H=Math.sqrt(j*j+J*J)}else H=p-Math.sqrt(j*j+W*W);this.image.data[_+C]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(i,a){for(let A=i.length-1;A>=0;--A){const C=i[A],R=i[A+1];C.zeroLength?i.splice(A,1):R&&R.isDash===C.isDash&&(R.left=C.left,i.splice(A,1))}const d=i[0],p=i[i.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const y=this.width*this.nextRow;let _=0,S=i[_];for(let A=0;A<this.width;A++){A/S.right>1&&(S=i[++_]);const C=Math.abs(A-S.left),R=Math.abs(A-S.right),D=Math.min(C,R);this.image.data[y+A]=Math.max(0,Math.min(255,(S.isDash?D:-D)+a+128))}}addDash(i,a){const d=this.getKey(i,a);if(this.positions[d])return this.positions[d];const p=a==="round",y=p?7:0,_=2*y+1;if(this.nextRow+_>this.height)return qr("LineAtlas out of space"),null;i.length===0&&i.push(1);let S=0;for(let R=0;R<i.length;R++)i[R]<0&&(qr("Negative value is found in line dasharray, replacing values with 0"),i[R]=0),S+=i[R];if(S!==0){const R=this.width/S,D=this.getDashRanges(i,this.width,R);p?this.addRoundDash(D,R,y):this.addRegularDash(D,a==="square"?.5*R:0)}const A=this.nextRow+y;this.nextRow+=_;const C={tl:[A,y],br:[S,0]};return this.positions[d]=C,C}}Wt(AF,"LineAtlas");const Ene=Xe.types,Ane=Math.cos(Math.PI/180*37.5),Pne=Math.cos(Math.PI/180*5);class AI{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Mg,this.layoutVertexArray2=new na,this.patternVertexArray=new na,this.indexArray=new ii,this.programConfigurations=new oa(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new ci,this.maxLineLength=0,this.zOffsetVertexArray=new na,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:Lt/64,this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,d,p){this.hasPattern=eI("line",this.layers,this.pixelRatio,a);const y=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Se(d);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const j=this.layers[0].layout.get("line-z-offset"),H=j.isConstant()&&!j.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&H?"none":"offset",this.elevationType==="offset"&&_==="none"&&qr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&S!==void 0;const A=[];for(const{feature:j,id:H,index:W,sourceLayerIndex:J}of i){const te=this.layers[0]._featureFilter.needGeometry,ae=st(j,te);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom,{worldview:this.worldview}),ae,d))continue;const de=y?y.evaluate(ae,{},d):void 0,he={id:H,properties:j.properties,type:j.type,sourceLayerIndex:J,index:W,geometry:te?ae.geometry:De(j,d,p),patterns:{},sortKey:de};A.push(he)}y&&A.sort((j,H)=>j.sortKey-H.sortKey);const{lineAtlas:C,featureIndex:R}=a,D=this.addConstantDashes(C);for(const j of A){const{geometry:H,index:W,sourceLayerIndex:J}=j;if(D&&this.addFeatureDashes(j,C),this.hasPattern){const te=tI("line",this.layers,j,this.zoom,this.pixelRatio,a);this.patternFeatures.push(te)}else this.addFeature(j,H,W,d,C.positions,a.availableImages,a.brightness,a.elevationFeatures);R.insert(i[W].feature,H,W,J,this.index)}}addConstantDashes(i){let a=!1;for(const d of this.layers){const p=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(p.kind!=="constant"||y.kind!=="constant")a=!0;else{const _=y.value,S=p.value;if(!S)continue;i.addDash(S,_)}}return a}addFeatureDashes(i,a){const d=this.zoom;for(const p of this.layers){const y=p.paint.get("line-dasharray").value,_=p.layout.get("line-cap").value;if(y.kind==="constant"&&_.kind==="constant")continue;let S,A;if(y.kind==="constant"){if(S=y.value,!S)continue}else S=y.evaluate({zoom:d},i);A=_.kind==="constant"?_.value:_.evaluate({zoom:d},i),a.addDash(S,A),i.patterns[p.id]=[a.getKey(S,A)]}}update(i,a,d,p,y,_,S,A){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,S,A)}addFeatures(i,a,d,p,y,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,d,p,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,wne)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,Tne)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,vne.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,xne),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,a,d,p,y,_,S,A){const C=this.layers[0].layout,R=C.get("line-join").evaluate(i,{}),D=C.get("line-cap").evaluate(i,{}),j=C.get("line-miter-limit"),H=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i,this.zOffsetValue=C.get("line-z-offset").value;const W=this.layers[0].paint.get("line-width").value;if(W.kind!=="constant"&&W.isLineProgressConstant===!1&&(this.variableWidthValue=W),this.elevationType==="road"){const J=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,a,p,A,R,D,j,H)){const[te,ae]=this.clipRuntimeLinesToTile(a,1);for(let de=0;de<te.length;de++){const he=te[de],me=ae[de],ke={progress:{min:me.progress.min,max:me.progress.max},nextDir:this.computeSegNextDir(me,he),prevDir:this.computeSegPrevDir(me,he)};this.addLine(he,i,p,R,D,j,H,ke)}this.fillNonElevatedRoadSegment(J)}}else for(const J of a)this.addLine(J,i,p,R,D,j,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,y,_,p,S,void 0,this.worldview)}computeSegNextDir(i,a){return i.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(i,a){return a[1].sub(i.prevPoint).unit()}clipLinesToTile(i,a){return PS(i,-a,-a,Lt+a,Lt+a)}clipRuntimeLinesToTile(i,a){const d=[];return[PS(i,-a,-a,Lt+a,Lt+a,d),d]}addElevatedRoadFeature(i,a,d,p,y,_,S,A){const C=[],R=ui.getElevationFeature(i,p);if(R){const D=this.clipLinesToTile(a,1),j=this.prepareElevatedLines(D,R,d);for(const H of j)C.push({geometry:H,elevation:R,elevationTileID:d,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(C.length===0)return!1;for(const D of C){const j=this.layoutVertexArray.length;this.addLine(D.geometry,i,d,y,_,S,A);const H=new rn(d,D.elevationTileID);if(D.elevation)for(let W=j;W<this.layoutVertexArray.length;W++){const J=new ut(this.layoutVertexArray.int16[6*W]>>1,this.layoutVertexArray.int16[6*W+1]>>1),te=H.pointElevation(J,D.elevation,.05);this.updateHeightRange(te),this.zOffsetVertexArray.emplaceBack(te,0,0)}else this.fillNonElevatedRoadSegment(j)}return!0}prepareElevatedLines(i,a,d){if(a.constantHeight!=null)return i;const p=[],y=1/Se(d);for(const _ of i)Gre(_,new Mn(a,y),0,p);return p}fillNonElevatedRoadSegment(i){for(let a=i;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,a,d,p,y,_,S,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const C=p==="none";this.patternJoinNone=this.hasPattern&&C,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const R=A&&A.progress.min>0,D=A&&A.progress.max<1;if(this.lineClips){let Ne={min:this.lineClips.start,max:this.lineClips.end},Be=1;if(A){const dt=this.lineClips.end-this.lineClips.start;Ne=function(Ct,mt,wt){return{min:Of(Ct.min,mt,wt),max:Of(Ct.max,mt,wt)}}(A.progress,{min:0,max:1},Ne),dt>0&&(Be=(Ne.max-Ne.min)/dt)}const ct=+a.properties.mapbox_clip_feature_len,Ue=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(ct)||Number.isNaN(Ue)){for(let Ct=0;Ct<i.length-1;Ct++)this.totalDistance+=i[Ct].dist(i[Ct+1]);const dt=this.totalDistance/(Ne.max-Ne.min);this.totalFeatureLength=Number.isFinite(dt)?dt:0,this.lineClips.start=Ne.min,this.lineClips.end=Ne.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ct,this.distance=Ue*Be,this.lineClips.start=Ne.min,this.lineClips.end=Ne.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const j=Ene[a.type]==="Polygon";let H=i.length;for(;H>=2&&i[H-1].equals(i[H-2]);)H--;let W=0;for(;W<H-1&&i[W].equals(i[W+1]);)W++;if(H<(j?3:2))return;p==="bevel"&&(_=1.05);const J=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray);let te,ae,de,he,me,ke,Ee,Pe;A&&A.prevDir&&(ke=A.prevDir.perp()),A&&A.nextDir&&(Ee=A.nextDir.perp()),this.e1=this.e2=-1,j&&(te=i[H-2],me=i[W].sub(te)._unit()._perp());for(let Ne=W;Ne<H;Ne++){if(de=Ne===H-1?j?i[W+1]:void 0:i[Ne+1],de&&i[Ne].equals(de))continue;me&&(he=me),te&&(ae=te),te=i[Ne],Pe=this.evaluateLineProgressFeatures(ae?ae.dist(te):0),me=de?de.sub(te)._unit()._perp():he,he=he||me;const Be=ae&&de;let ct=Be?p:j||C?"butt":y;const Ue=he.x*me.x+he.y*me.y;if(C){const He=function(lt){if(lt.patternJoinNone){const kt=lt.segmentPoints.length/2,Tt=lt.lineSoFar-lt.segmentStart;for(let tr=0;tr<kt;++tr){const Zt=lt.segmentPoints[2*tr+1],xt=Math.round(lt.segmentPoints[2*tr])+.5+.25*Zt;lt.patternVertexArray.emplaceBack(xt,Tt,lt.segmentStart),lt.patternVertexArray.emplaceBack(xt,Tt,lt.segmentStart)}lt.segmentPoints.length=0}lt.e1=lt.e2=-1};if(Be&&Ue<Pne){this.updateDistance(ae,te),this.addCurrentVertex(te,he,1,1,J,Pe),He(this),this.addCurrentVertex(te,me,-1,-1,J,Pe);continue}if(ae){if(!de){this.updateDistance(ae,te),this.addCurrentVertex(te,he,1,1,J,Pe),He(this);continue}ct="miter"}}let dt=he.add(me);dt.x===0&&dt.y===0||dt._unit();const Ct=dt.x*me.x+dt.y*me.y,mt=Ct!==0?1/Ct:1/0,wt=2*Math.sqrt(2-2*Ct),At=Ct<Ane&&ae&&de,at=he.x*me.y-he.y*me.x>0,St=this.overscaling<=16?15*Lt/(512*this.overscaling):0;if(Be&&ct==="round"){if(mt<S)ct="miter";else if(mt<=2){const He=PI(te,-10,Lt+10);ct=this.elevationType==="offset"&&(He||this.hasCrossSlope)?"miter":"fakeround"}}if(ct==="miter"&&mt>_&&(ct="bevel"),ct==="bevel"&&(mt>2&&(ct="flipbevel"),mt<_&&(ct="miter")),ae&&!(ct==="miter"&&At)&&this.updateDistance(ae,te),ct==="miter")if(At){const He=te.dist(ae);if(He>2*St){const kt=te.sub(te.sub(ae)._mult(St/He)._round());this.updateDistance(ae,kt),this.addCurrentVertex(kt,he,0,0,J,Pe),ae=kt}this.updateDistance(ae,te),dt._mult(mt),this.addCurrentVertex(te,dt,0,0,J,Pe);const lt=te.dist(de);if(lt>2*St){const kt=te.add(de.sub(te)._mult(St/lt)._round());this.updateDistance(te,kt),this.addCurrentVertex(kt,me,0,0,J,Pe),te=kt}}else dt._mult(mt),this.addCurrentVertex(te,dt,0,0,J,Pe);else if(ct==="flipbevel"){if(mt>100)dt=me.mult(-1);else{const He=mt*he.add(me).mag()/he.sub(me).mag();dt._perp()._mult(He*(at?-1:1))}this.addCurrentVertex(te,dt,0,0,J,Pe),this.addCurrentVertex(te,dt.mult(-1),0,0,J,Pe)}else if(ct==="bevel"||ct==="fakeround"){Pe!=null&&ae&&this.addCurrentVertex(te,Ee||he,-1,-1,J,Pe);const He=te.dist(ae)<=2*St&&ct!=="bevel",lt=dt.mult(at?1:-1);lt._mult(mt);const kt=me.mult(at?-1:1),Tt=he.mult(at?-1:1),tr=this.evaluateLineProgressFeatures(this.distance);if(Pe==null&&(this.addHalfVertex(te,lt.x,lt.y,!1,!at,0,J,tr),He||this.addHalfVertex(te,lt.x+2*Tt.x,lt.y+2*Tt.y,!1,at,0,J,tr)),ct==="fakeround"){const Zt=Math.round(180*wt/Math.PI/20);this.addHalfVertex(te,Tt.x,Tt.y,!1,at,0,J,tr);for(let xt=0;xt<Zt;xt++){let Et=xt/Zt;if(Et!==.5){const Vt=Et-.5;Et+=Et*Vt*(Et-1)*((1.0904+Ue*(Ue*(3.55645-1.43519*Ue)-3.2452))*Vt*Vt+(.848013+Ue*(.215638*Ue-1.06021)))}const Yt=kt.sub(Tt)._mult(Et)._add(Tt)._unit();this.addHalfVertex(te,Yt.x,Yt.y,!1,at,0,J,tr)}this.addHalfVertex(te,kt.x,kt.y,!1,at,0,J,tr)}He||Pe!=null||this.addHalfVertex(te,lt.x+2*kt.x,lt.y+2*kt.y,!1,at,0,J,tr),Pe!=null&&de&&this.addCurrentVertex(te,ke||me,1,1,J,Pe)}else if(ct==="butt")this.addCurrentVertex(te,dt,0,0,J,Pe);else if(ct==="square"){if(!ae){const He=R?0:-1;this.addCurrentVertex(te,dt,He,He,J,Pe)}if(this.addCurrentVertex(te,dt,0,0,J,Pe),ae){const He=D?0:1;this.addCurrentVertex(te,dt,He,He,J,Pe)}}else if(ct==="round"){if(ae){const He=!Be&&Ee?Ee:he;this.addCurrentVertex(te,He,0,0,J,Pe),!Be&&D||this.addCurrentVertex(te,He,1,1,J,Pe,!0)}if(de){const He=!Be&&ke?ke:me;!Be&&R||this.addCurrentVertex(te,He,-1,-1,J,Pe,!0),this.addCurrentVertex(te,He,0,0,J,Pe)}}}}addVerticesTo(i,a,d,p,y,_,S,A,C,R){const D=(a.w-i.w)/this.tessellationStep|0;let j=0;const H=this.scaledDistance;if(D>1){this.lineSoFar=i.w;const J=(a.x-i.x)/D,te=(a.y-i.y)/D,ae=(a.z-i.z)/D,de=(a.w-i.w)/D;for(let he=1;he<D;++he){i.x+=J,i.y+=te,i.z+=ae,this.lineSoFar+=de,j+=de;const me=this.evaluateLineProgressFeatures(this.prevDistance+j);this.scaledDistance=(this.prevDistance+j)/this.totalDistance,this.addHalfVertex(i,d,p,R,!1,S,C,me),this.addHalfVertex(i,y,_,R,!0,-A,C,me)}}this.lineSoFar=a.w,this.scaledDistance=H;const W=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,d,p,R,!1,S,C,W),this.addHalfVertex(a,y,_,R,!0,-A,C,W)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):qr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(i,a,d,p,y,_,S=!1){const A=a.x+a.y*d,C=a.y-a.x*d,R=a.y*p-a.x,D=-a.y-a.x*p;if(_!=null){const j=this.elevationType==="offset",H=-10,W=Lt+10,J=_.zOffset,te=new Xz(i.x,i.y,J,this.lineSoFar),ae=!!j&&PI(i,H,W),de=this.lineSoFar,he=this.distance;if(this.currentVertex)if(ae){const me=this.currentVertexIsOutside,ke=this.currentVertex,Ee=new Xz(i.x,i.y,J,this.lineSoFar);if(Yz(ke,Ee,H,W),!PI(Ee,H,W)){if(me){this.e1=this.e2=-1,this.distance-=ke.dist(te),this.lineSoFar=ke.w;const Pe=this.evaluateLineProgressFeatures(ke.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ke,A,C,S,!1,d,y,Pe),this.addHalfVertex(ke,R,D,S,!0,-p,y,Pe),this.prevDistance=this.distance}this.distance=this.prevDistance+ke.dist(Ee),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ke,Ee,A,C,R,D,d,p,y,S),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const me=this.currentVertex;if(this.currentVertexIsOutside){Yz(me,te,H,W),this.e1=this.e2=-1,this.distance-=me.dist(te),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=me.w;const ke=this.evaluateLineProgressFeatures(me.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(me,A,C,S,!1,d,y,ke),this.addHalfVertex(me,R,D,S,!0,-p,y,ke),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(me,te,A,C,R,D,d,p,y,S)}else ae||(this.addHalfVertex(i,A,C,S,!1,d,y,_),this.addHalfVertex(i,R,D,S,!0,-p,y,_));this.currentVertex=te,this.currentVertexIsOutside=ae,this.lineSoFar=de}else this.addHalfVertex(i,A,C,S,!1,d,y,_),this.addHalfVertex(i,R,D,S,!0,-p,y,_)}addHalfVertex({x:i,y:a},d,p,y,_,S,A,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((i<<1)+(y?1:0),(a<<1)+(_?1:0),Math.round(63*d)+128,Math.round(63*p)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=lr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const R=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),A.primitiveLength++),_?this.e2=R:this.e1=R,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,a){this.prevDistance=this.distance,this.distance+=i.dist(a),this.updateScaledDistance()}}function PI(c,i,a){return c.x<i||c.x>a||c.y<i||c.y>a}let PF,CF;function IF(c,i,a){return i*(Lt/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}Wt(AI,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const MF=(c,i,a)=>(1-a)*c+a*i;function OF(c,i){return 1/IF(c,1,i.tileZoom)}function kF(c,i,a,d){return c.translatePosMatrix(d||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const RF=c=>{const i=[];DF(c)&&i.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const a=c.paint.get("line-trim-offset");a[0]===0&&a[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const d=c.layout.get("line-join").constantOr("miter")==="none",p=!!c.paint.get("line-pattern").constantOr(1);return d&&p&&i.push("LINE_JOIN_NONE"),i};function DF(c){const i=c.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}let CI;const LF=()=>CI||(CI={layout:PF||(PF=new xi({"line-cap":new Bt(Ve.layout_line["line-cap"]),"line-join":new Bt(Ve.layout_line["line-join"]),"line-miter-limit":new Mt(Ve.layout_line["line-miter-limit"]),"line-round-limit":new Mt(Ve.layout_line["line-round-limit"]),"line-sort-key":new Bt(Ve.layout_line["line-sort-key"]),"line-z-offset":new Bt(Ve.layout_line["line-z-offset"]),"line-elevation-reference":new Mt(Ve.layout_line["line-elevation-reference"]),"line-cross-slope":new Mt(Ve.layout_line["line-cross-slope"]),visibility:new Mt(Ve.layout_line.visibility),"line-width-unit":new Mt(Ve.layout_line["line-width-unit"])})),paint:CF||(CF=new xi({"line-opacity":new Bt(Ve.paint_line["line-opacity"]),"line-color":new Bt(Ve.paint_line["line-color"]),"line-translate":new Mt(Ve.paint_line["line-translate"]),"line-translate-anchor":new Mt(Ve.paint_line["line-translate-anchor"]),"line-width":new Bt(Ve.paint_line["line-width"]),"line-gap-width":new Bt(Ve.paint_line["line-gap-width"]),"line-offset":new Bt(Ve.paint_line["line-offset"]),"line-blur":new Bt(Ve.paint_line["line-blur"]),"line-dasharray":new Bt(Ve.paint_line["line-dasharray"]),"line-pattern":new Bt(Ve.paint_line["line-pattern"]),"line-pattern-cross-fade":new Mt(Ve.paint_line["line-pattern-cross-fade"]),"line-gradient":new sd(Ve.paint_line["line-gradient"]),"line-trim-offset":new Mt(Ve.paint_line["line-trim-offset"]),"line-trim-fade-range":new Mt(Ve.paint_line["line-trim-fade-range"]),"line-trim-color":new Mt(Ve.paint_line["line-trim-color"]),"line-emissive-strength":new Mt(Ve.paint_line["line-emissive-strength"]),"line-border-width":new Bt(Ve.paint_line["line-border-width"]),"line-border-color":new Bt(Ve.paint_line["line-border-color"]),"line-occlusion-opacity":new Mt(Ve.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},CI);class Cne extends Bt{possiblyEvaluate(i,a){return a=new Rn(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(i,a)}evaluate(i,a,d,p){return a=et({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(i,a,d,p)}}let rx;function jF(c,i){return i>0?i+2*c:c}const Ine=Qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Mne=Qr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),One=Qr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kne=Qr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Rne=Qr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Dne=Qr([{name:"a_texb",components:2,type:"Uint16"}]),Lne=Qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),jne=Qr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const NF=Qr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Nne=Qr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qr([{name:"triangle",components:3,type:"Uint16"}]),Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Qr([{type:"Float32",name:"offsetX"}]),Qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Eo=24;function zne(c,i,a){return c.sections.forEach(d=>{d.text=function(p,y,_){const S=y.layout.get("text-transform").evaluate(_,{});return S==="uppercase"?p=p.toLocaleUpperCase():S==="lowercase"&&(p=p.toLocaleLowerCase()),_l.applyArabicShaping&&(p=_l.applyArabicShaping(p)),p}(d.text,i,a)}),c}const nx={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Fne(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function Bne(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}const II=4294967296,zF=1/II,FF=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let LS=class{constructor(c=new Uint8Array(16)){this.buf=ArrayBuffer.isView(c)?c:new Uint8Array(c),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(c,i,a=this.length){for(;this.pos<a;){const d=this.readVarint(),p=d>>3,y=this.pos;this.type=7&d,c(p,i,this),this.pos===y&&this.skip(d)}return i}readMessage(c,i){return this.readFields(c,i,this.readVarint()+this.pos)}readFixed32(){const c=this.dataView.getUint32(this.pos,!0);return this.pos+=4,c}readSFixed32(){const c=this.dataView.getInt32(this.pos,!0);return this.pos+=4,c}readFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*II;return this.pos+=8,c}readSFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*II;return this.pos+=8,c}readFloat(){const c=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,c}readDouble(){const c=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,c}readVarint(c){const i=this.buf;let a,d;return d=i[this.pos++],a=127&d,d<128?a:(d=i[this.pos++],a|=(127&d)<<7,d<128?a:(d=i[this.pos++],a|=(127&d)<<14,d<128?a:(d=i[this.pos++],a|=(127&d)<<21,d<128?a:(d=i[this.pos],a|=(15&d)<<28,function(p,y,_){const S=_.buf;let A,C;if(C=S[_.pos++],A=(112&C)>>4,C<128||(C=S[_.pos++],A|=(127&C)<<3,C<128)||(C=S[_.pos++],A|=(127&C)<<10,C<128)||(C=S[_.pos++],A|=(127&C)<<17,C<128)||(C=S[_.pos++],A|=(127&C)<<24,C<128)||(C=S[_.pos++],A|=(1&C)<<31,C<128))return qg(p,A,y);throw new Error("Expected varint not more than 10 bytes")}(a,c,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const c=this.readVarint();return c%2==1?(c+1)/-2:c/2}readBoolean(){return!!this.readVarint()}readString(){const c=this.readVarint()+this.pos,i=this.pos;return this.pos=c,c-i>=12&&FF?FF.decode(this.buf.subarray(i,c)):function(a,d,p){let y="",_=d;for(;_<p;){const S=a[_];let A,C,R,D=null,j=S>239?4:S>223?3:S>191?2:1;if(_+j>p)break;j===1?S<128&&(D=S):j===2?(A=a[_+1],(192&A)==128&&(D=(31&S)<<6|63&A,D<=127&&(D=null))):j===3?(A=a[_+1],C=a[_+2],(192&A)==128&&(192&C)==128&&(D=(15&S)<<12|(63&A)<<6|63&C,(D<=2047||D>=55296&&D<=57343)&&(D=null))):j===4&&(A=a[_+1],C=a[_+2],R=a[_+3],(192&A)==128&&(192&C)==128&&(192&R)==128&&(D=(15&S)<<18|(63&A)<<12|(63&C)<<6|63&R,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,j=1):D>65535&&(D-=65536,y+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),y+=String.fromCharCode(D),_+=j}return y}(this.buf,i,c)}readBytes(){const c=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,c);return this.pos=c,i}readPackedVarint(c=[],i){const a=this.readPackedEnd();for(;this.pos<a;)c.push(this.readVarint(i));return c}readPackedSVarint(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSVarint());return c}readPackedBoolean(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readBoolean());return c}readPackedFloat(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFloat());return c}readPackedDouble(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readDouble());return c}readPackedFixed32(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFixed32());return c}readPackedSFixed32(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSFixed32());return c}readPackedFixed64(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFixed64());return c}readPackedSFixed64(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSFixed64());return c}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(c){const i=7&c;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(c,i){this.writeVarint(c<<3|i)}realloc(c){let i=this.length||16;for(;i<this.pos+c;)i*=2;if(i!==this.length){const a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeSFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*zF),!0),this.pos+=8}writeSFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*zF),!0),this.pos+=8}writeVarint(c){(c=+c||0)>268435455||c<0?function(i,a){let d,p;if(i>=0?(d=i%4294967296|0,p=i/4294967296|0):(d=~(-i%4294967296),p=~(-i/4294967296),4294967295^d?d=d+1|0:(d=0,p=p+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(y,_,S){S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,S.buf[S.pos]=127&(y>>>=7)}(d,0,a),function(y,_){const S=(7&y)<<4;_.buf[_.pos++]|=S|((y>>>=3)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y)))))}(p,a)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))}writeSVarint(c){this.writeVarint(c<0?2*-c-1:2*c)}writeBoolean(c){this.writeVarint(+c)}writeString(c){c=String(c),this.realloc(4*c.length),this.pos++;const i=this.pos;this.pos=function(d,p,y){for(let _,S,A=0;A<p.length;A++){if(_=p.charCodeAt(A),_>55295&&_<57344){if(!S){_>56319||A+1===p.length?(d[y++]=239,d[y++]=191,d[y++]=189):S=_;continue}if(_<56320){d[y++]=239,d[y++]=191,d[y++]=189,S=_;continue}_=S-55296<<10|_-56320|65536,S=null}else S&&(d[y++]=239,d[y++]=191,d[y++]=189,S=null);_<128?d[y++]=_:(_<2048?d[y++]=_>>6|192:(_<65536?d[y++]=_>>12|224:(d[y++]=_>>18|240,d[y++]=_>>12&63|128),d[y++]=_>>6&63|128),d[y++]=63&_|128)}return y}(this.buf,c,this.pos);const a=this.pos-i;a>=128&&BF(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeFloat(c){this.realloc(4),this.dataView.setFloat32(this.pos,c,!0),this.pos+=4}writeDouble(c){this.realloc(8),this.dataView.setFloat64(this.pos,c,!0),this.pos+=8}writeBytes(c){const i=c.length;this.writeVarint(i),this.realloc(i);for(let a=0;a<i;a++)this.buf[this.pos++]=c[a]}writeRawMessage(c,i){this.pos++;const a=this.pos;c(i,this);const d=this.pos-a;d>=128&&BF(a,d,this),this.pos=a-1,this.writeVarint(d),this.pos+=d}writeMessage(c,i,a){this.writeTag(c,2),this.writeRawMessage(i,a)}writePackedVarint(c,i){i.length&&this.writeMessage(c,$ne,i)}writePackedSVarint(c,i){i.length&&this.writeMessage(c,Vne,i)}writePackedBoolean(c,i){i.length&&this.writeMessage(c,Hne,i)}writePackedFloat(c,i){i.length&&this.writeMessage(c,Une,i)}writePackedDouble(c,i){i.length&&this.writeMessage(c,Gne,i)}writePackedFixed32(c,i){i.length&&this.writeMessage(c,Wne,i)}writePackedSFixed32(c,i){i.length&&this.writeMessage(c,qne,i)}writePackedFixed64(c,i){i.length&&this.writeMessage(c,Zne,i)}writePackedSFixed64(c,i){i.length&&this.writeMessage(c,Xne,i)}writeBytesField(c,i){this.writeTag(c,2),this.writeBytes(i)}writeFixed32Field(c,i){this.writeTag(c,5),this.writeFixed32(i)}writeSFixed32Field(c,i){this.writeTag(c,5),this.writeSFixed32(i)}writeFixed64Field(c,i){this.writeTag(c,1),this.writeFixed64(i)}writeSFixed64Field(c,i){this.writeTag(c,1),this.writeSFixed64(i)}writeVarintField(c,i){this.writeTag(c,0),this.writeVarint(i)}writeSVarintField(c,i){this.writeTag(c,0),this.writeSVarint(i)}writeStringField(c,i){this.writeTag(c,2),this.writeString(i)}writeFloatField(c,i){this.writeTag(c,5),this.writeFloat(i)}writeDoubleField(c,i){this.writeTag(c,1),this.writeDouble(i)}writeBooleanField(c,i){this.writeVarintField(c,+i)}};function qg(c,i,a){return a?4294967296*i+(c>>>0):4294967296*(i>>>0)+(c>>>0)}function BF(c,i,a){const d=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(d);for(let p=a.pos-1;p>=c;p--)a.buf[p+d]=a.buf[p]}function $ne(c,i){for(let a=0;a<c.length;a++)i.writeVarint(c[a])}function Vne(c,i){for(let a=0;a<c.length;a++)i.writeSVarint(c[a])}function Une(c,i){for(let a=0;a<c.length;a++)i.writeFloat(c[a])}function Gne(c,i){for(let a=0;a<c.length;a++)i.writeDouble(c[a])}function Hne(c,i){for(let a=0;a<c.length;a++)i.writeBoolean(c[a])}function Wne(c,i){for(let a=0;a<c.length;a++)i.writeFixed32(c[a])}function qne(c,i){for(let a=0;a<c.length;a++)i.writeSFixed32(c[a])}function Zne(c,i){for(let a=0;a<c.length;a++)i.writeFixed64(c[a])}function Xne(c,i){for(let a=0;a<c.length;a++)i.writeSFixed64(c[a])}const MI=3;function Kne(c,i,a){i.glyphs=[],c===1&&a.readMessage(Yne,i)}function Yne(c,i,a){if(c===3){const{id:d,bitmap:p,width:y,height:_,left:S,top:A,advance:C}=a.readMessage(Jne,{});i.glyphs.push({id:d,bitmap:new Sd({width:y+2*MI,height:_+2*MI},p),metrics:{width:y,height:_,left:S,top:A,advance:C}})}else c===4?i.ascender=a.readSVarint():c===5&&(i.descender=a.readSVarint())}function Jne(c,i,a){c===1?i.id=a.readVarint():c===2?i.bitmap=a.readBytes():c===3?i.width=a.readVarint():c===4?i.height=a.readVarint():c===5?i.left=a.readSVarint():c===6?i.top=a.readSVarint():c===7&&(i.advance=a.readVarint())}const $F=MI,ha={horizontal:1,vertical:2,horizontalOnly:3};class ix{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,a){const d=new ix;return d.scale=i||1,d.fontStack=a,d}static forImage(i){const a=new ix;return a.image=i,a}}class Zg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a,d){const p=new Zg;for(let y=0;y<i.sections.length;y++){const _=i.sections[y];_.image?p.addImageSection(_,d):p.addTextSection(_,a)}return p}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(a,d){let p="";for(let y=0;y<a.length;y++){const _=a.charCodeAt(y+1)||null,S=a.charCodeAt(y-1)||null;p+=!d&&(_&&Sg(_)&&!nx[a[y+1]]||S&&Sg(S)&&!nx[a[y-1]])||!nx[a[y]]?a[y]:nx[a[y]]}return p}(this.text,i)}trim(){let i=0;for(let d=0;d<this.text.length&&jS[this.text.charCodeAt(d)];d++)i++;let a=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&jS[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const d=new Zg;return d.text=this.text.substring(i,a),d.sectionIndex=this.sectionIndex.slice(i,a),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(ix.forText(i.scale,i.fontStack||a));const d=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(d)}addImageSection(i,a){const d=i.image?i.image.getPrimary():null;if(!d)return void qr("Can't add FormattedSection with an empty image.");d.scaleSelf(a);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(ix.forImage(d)),this.sectionIndex.push(this.sections.length-1)):qr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function OI(c,i,a,d,p,y,_,S,A,C,R,D,j,H,W,J=1){const te=Zg.fromFeature(c,p,J);D===ha.vertical&&te.verticalizePunctuation(j);let ae=[];const de=function(Pe,Ne,Be,ct,Ue,dt){if(!Pe)return[];const Ct=[],mt=function(St,He,lt,kt,Tt,tr){let Zt=0;for(let xt=0;xt<St.length();xt++){const Et=St.getSection(xt);Zt+=VF(St.getCodePoint(xt),Et,kt,Tt,He,tr)}return Zt/Math.max(1,Math.ceil(Zt/lt))}(Pe,Ne,Be,ct,Ue,dt),wt=Pe.text.indexOf("​")>=0;let At=0;for(let St=0;St<Pe.length();St++){const He=Pe.getSection(St),lt=Pe.getCodePoint(St);if(jS[lt]||(At+=VF(lt,He,ct,Ue,Ne,dt)),St<Pe.length()-1){const kt=!((at=lt)<11904||!(dr["Bopomofo Extended"](at)||dr.Bopomofo(at)||dr["CJK Compatibility Forms"](at)||dr["CJK Compatibility Ideographs"](at)||dr["CJK Compatibility"](at)||dr["CJK Radicals Supplement"](at)||dr["CJK Strokes"](at)||dr["CJK Symbols and Punctuation"](at)||dr["CJK Unified Ideographs Extension A"](at)||dr["CJK Unified Ideographs"](at)||dr["Enclosed CJK Letters and Months"](at)||dr["Halfwidth and Fullwidth Forms"](at)||dr.Hiragana(at)||dr["Ideographic Description Characters"](at)||dr["Kangxi Radicals"](at)||dr["Katakana Phonetic Extensions"](at)||dr.Katakana(at)||dr["Vertical Forms"](at)||dr["Yi Radicals"](at)||dr["Yi Syllables"](at)));(Qne[lt]||kt||He.image)&&Ct.push(GF(St+1,At,mt,Ct,eie(lt,Pe.getCodePoint(St+1),kt&&wt),!1))}}var at;return HF(GF(Pe.length(),At,mt,Ct,0,!0))}(te,C,y,i,d,H),{processBidirectionalText:he,processStyledBidirectionalText:me}=_l;if(he&&te.sections.length===1){const Pe=he(te.toString(),de);for(const Ne of Pe){const Be=new Zg;Be.text=Ne,Be.sections=te.sections;for(let ct=0;ct<Ne.length;ct++)Be.sectionIndex.push(0);ae.push(Be)}}else if(me){const Pe=me(te.text,te.sectionIndex,de);for(const Ne of Pe){const Be=new Zg;Be.text=Ne[0],Be.sectionIndex=Ne[1],Be.sections=te.sections,ae.push(Be)}}else ae=function(Pe,Ne){const Be=[],ct=Pe.text;let Ue=0;for(const dt of Ne)Be.push(Pe.substring(Ue,dt)),Ue=dt;return Ue<ct.length&&Be.push(Pe.substring(Ue,ct.length)),Be}(te,de);const ke=[],Ee={positionedLines:ke,text:te.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Pe,Ne,Be,ct,Ue,dt,Ct,mt,wt,At,at,St){let He=0,lt=0,kt=0;const Tt=mt==="right"?1:mt==="left"?0:.5;let tr=!1;for(const jt of Ue){const Gt=jt.getSections();for(const hr of Gt){if(hr.image)continue;const vr=Ne[hr.fontStack];if(vr&&(tr=vr.ascender!==void 0&&vr.descender!==void 0,!tr))break}if(!tr)break}let Zt=0;for(const jt of Ue){jt.trim();const Gt=jt.getMaxScale(),hr=(Gt-1)*Eo,vr={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[Zt]=vr;const Cr=vr.positionedGlyphs;let Tr=0;if(!jt.length()){lt+=dt,++Zt;continue}let Zr=0,jr=0;for(let _e=0;_e<jt.length();_e++){const ve=jt.getSection(_e),ot=jt.getSectionIndex(_e),Rt=jt.getCodePoint(_e);let zt=ve.scale,Nt=null,Xt=null,gr=null,Vr=Eo,Ur=0,Or=wt;Or===ha.vertical&&((xt=Rt)===12312||xt===12313||xt===12316||xt===12540||xt===12448)&&(Or=ha.horizontal);const Dn=!(Or===ha.horizontal||!at&&!wg(Rt)||at&&(jS[Rt]||W1(Rt)));if(ve.image){const pi=ct.get(ve.image.toString());if(!pi)continue;gr=ve.image,Pe.iconsInText=Pe.iconsInText||!0,Xt=pi.paddedRect;const Ir=pi.displaySize;zt=zt*Eo/St,Nt={width:Ir[0],height:Ir[1],left:0,top:-$F,advance:Dn?Ir[1]:Ir[0],localGlyph:!1},Ur=tr?-Nt.height*zt:Gt*Eo-17-Ir[1]*zt,Vr=Nt.advance;const ti=(Dn?Ir[0]:Ir[1])*zt-Eo*Gt;ti>0&&ti>Tr&&(Tr=ti)}else{const pi=Be[ve.fontStack];if(!pi)continue;pi[Rt]&&(Xt=pi[Rt]);const Ir=Ne[ve.fontStack];if(!Ir)continue;const ti=Ir.glyphs[Rt];if(!ti)continue;if(Nt=ti.metrics,Vr=Rt!==8203?Eo:0,tr){const Gn=Ir.ascender!==void 0?Math.abs(Ir.ascender):0,En=Ir.descender!==void 0?Math.abs(Ir.descender):0,hi=(Gn+En)*zt;Zr<hi&&(Zr=hi,jr=(Gn-En)/2*zt),Ur=-Gn*zt}else Ur=(Gt-zt)*Eo-17}Dn?(Pe.verticalizable=!0,Cr.push({glyph:Rt,image:gr,x:He,y:lt+Ur,vertical:Dn,scale:zt,localGlyph:Nt.localGlyph,fontStack:ve.fontStack,sectionIndex:ot,metrics:Nt,rect:Xt}),He+=Vr*zt+At):(Cr.push({glyph:Rt,image:gr,x:He,y:lt+Ur,vertical:Dn,scale:zt,localGlyph:Nt.localGlyph,fontStack:ve.fontStack,sectionIndex:ot,metrics:Nt,rect:Xt}),He+=Nt.advance*zt+At)}Cr.length!==0&&(kt=Math.max(He-At,kt),tr?WF(Cr,Tt,Tr,jr,dt*Gt/2):WF(Cr,Tt,Tr,0,dt/2)),He=0;const Yn=dt*Gt+Tr;vr.lineOffset=Math.max(Tr,hr),lt+=Yn,++Zt}var xt;const Et=lt,{horizontalAlign:Yt,verticalAlign:Vt}=kI(Ct);(function(jt,Gt,hr,vr,Cr,Tr){const Zr=(Gt-hr)*Cr,jr=-Tr*vr;for(const Yn of jt)for(const _e of Yn.positionedGlyphs)_e.x+=Zr,_e.y+=jr})(Pe.positionedLines,Tt,Yt,Vt,kt,Et),Pe.top+=-Vt*Et,Pe.bottom=Pe.top+Et,Pe.left+=-Yt*kt,Pe.right=Pe.left+kt,Pe.hasBaseline=tr}(Ee,i,a,d,ae,_,S,A,D,C,j,W),!function(Pe){for(const Ne of Pe)if(Ne.positionedGlyphs.length!==0)return!1;return!0}(ke))return Ee}const jS={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qne={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function VF(c,i,a,d,p,y){if(i.image){const _=d.get(i.image.toString());return _?_.displaySize[0]*i.scale*Eo/y+p:0}{const _=a[i.fontStack],S=_&&_.glyphs[c];return S?S.metrics.advance*i.scale+p:0}}function UF(c,i,a,d){const p=Math.pow(c-i,2);return d?c<i?p/2:2*p:p+Math.abs(a)*a}function eie(c,i,a){let d=0;return c===10&&(d-=1e4),a&&(d+=150),c!==40&&c!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function GF(c,i,a,d,p,y){let _=null,S=UF(i,a,p,y);for(const A of d){const C=UF(i-A.x,a,p,y)+A.badness;C<=S&&(_=A,S=C)}return{index:c,x:i,priorBreak:_,badness:S}}function HF(c){return c?HF(c.priorBreak).concat(c.index):[]}function kI(c){let i=.5,a=.5;switch(c){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function WF(c,i,a,d,p){if(!(i||a||d||p))return;const y=c.length-1,_=c[y],S=(_.x+_.metrics.advance*_.scale)*i;for(let A=0;A<=y;A++)c[A].x-=S,c[A].y+=a+d+p}function qF(c){return c.imagePrimary!==void 0&&c.top!==void 0&&c.bottom!==void 0&&c.left!==void 0&&c.right!==void 0}function tie(c,i,a,d){const{horizontalAlign:p,verticalAlign:y}=kI(d),_=a[0]-c.displaySize[0]*p,S=a[1]-c.displaySize[1]*y;return{imagePrimary:c,imageSecondary:i,top:S,bottom:S+c.displaySize[1],left:_,right:_+c.displaySize[0]}}function ZF(c,i,a,d,p,y){const _=c.imagePrimary;let S;if(_.content){const te=_.content,ae=_.pixelRatio||1;S=[te[0]/ae,te[1]/ae,_.displaySize[0]-te[2]/ae,_.displaySize[1]-te[3]/ae]}const A=i.left*y,C=i.right*y;let R,D,j,H;a==="width"||a==="both"?(H=p[0]+A-d[3],D=p[0]+C+d[1]):(H=p[0]+(A+C-_.displaySize[0])/2,D=H+_.displaySize[0]);const W=i.top*y,J=i.bottom*y;return a==="height"||a==="both"?(R=p[1]+W-d[0],j=p[1]+J+d[2]):(R=p[1]+(W+J-_.displaySize[1])/2,j=R+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:R,right:D,bottom:j,left:H,collisionPadding:S}}function XF(c){return!c.imagePrimary.stretchX}function KF(c){return!c.imagePrimary.stretchY}function YF(c){return{width:c.right-c.left,height:c.bottom-c.top}}const nu=128;function JF(c,i,a){const{expression:d}=i;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new Rn(c+1,{worldview:a}))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:y}=d;let _=0;for(;_<p.length&&p[_]<=c;)_++;_=Math.max(0,_-1);let S=_;for(;S<p.length&&p[S]<c+1;)S++;S=Math.min(p.length-1,S);const A=p[_],C=p[S];return d.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:C,interpolationType:y}:{kind:"camera",minZoom:A,maxZoom:C,minSize:d.evaluate(new Rn(A,{worldview:a})),maxSize:d.evaluate(new Rn(C,{worldview:a})),interpolationType:y}}}function RI(c,{uSize:i,uSizeT:a},{lowerSize:d,upperSize:p}){return c.kind==="source"?d/nu:c.kind==="composite"?lr(d/nu,p/nu,a):i}function ox(c,i,a=1){let d=0,p=0;if(c.kind==="constant")p=c.layoutSize*a;else if(c.kind!=="source"){const{interpolationType:y,minZoom:_,maxZoom:S}=c,A=y?xe(Is.interpolationFactor(y,i,_,S),0,1):0;c.kind==="camera"?p=lr(c.minSize,c.maxSize,A)*a:d=A*a}return{uSizeT:d,uSize:p}}class eh extends ut{constructor(i,a,d,p,y){super(i,a),this.angle=p,this.z=d,y!==void 0&&(this.segment=y)}clone(){return new eh(this.x,this.y,this.z,this.angle,this.segment)}}function QF(c,i,a,d,p){if(i.segment===void 0)return!0;let y=i,_=i.segment+1,S=0;for(;S>-a/2;){if(_--,_<0)return!1;S-=c[_].dist(y),y=c[_]}S+=c[_].dist(c[_+1]),_++;const A=[];let C=0;for(;S<a/2;){const R=c[_],D=c[_+1];if(!D)return!1;let j=c[_-1].angleTo(R)-R.angleTo(D);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:S,angleDelta:j}),C+=j;S-A[0].distance>d;)C-=A.shift().angleDelta;if(C>p)return!1;_++,S+=R.dist(D)}return!0}function eB(c){let i=0;for(let a=0;a<c.length-1;a++)i+=c[a].dist(c[a+1]);return i}function tB(c,i,a){return c?.6*i*a:0}function rB(c,i){return Math.max(c?c.right-c.left:0,i?i.right-i.left:0)}function rie(c,i,a,d,p,y){const _=tB(a,p,y),S=rB(a,d)*y;let A=0;const C=eB(c)/2;for(let R=0;R<c.length-1;R++){const D=c[R],j=c[R+1],H=D.dist(j);if(A+H>C){const W=(C-A)/H,J=lr(D.x,j.x,W),te=lr(D.y,j.y,W),ae=new eh(J,te,0,j.angleTo(D),R);return!_||QF(c,ae,S,_,i)?ae:void 0}A+=H}}function nie(c,i,a,d,p,y,_,S,A){const C=tB(d,y,_),R=rB(d,p),D=R*_,j=c[0].x===0||c[0].x===A||c[0].y===0||c[0].y===A;return i-D<i/4&&(i=D+i/4),nB(c,j?i/2*S%i:(R/2+2*y)*_*S%i,i,C,a,D,j,!1,A)}function nB(c,i,a,d,p,y,_,S,A){const C=y/2,R=eB(c);let D=0,j=i-a,H=[];for(let W=0;W<c.length-1;W++){const J=c[W],te=c[W+1],ae=J.dist(te),de=te.angleTo(J);for(;j+a<D+ae;){j+=a;const he=(j-D)/ae,me=lr(J.x,te.x,he),ke=lr(J.y,te.y,he);if(me>=0&&me<A&&ke>=0&&ke<A&&j-C>=0&&j+C<=R){const Ee=new eh(me,ke,0,de,W);d&&!QF(c,Ee,y,d,p)||H.push(Ee)}}D+=ae}return S||H.length||_||(H=nB(c,D/2,a,d,p,y,_,!0,A)),H}function iB(c){let i=0,a=0;for(const _ of c)i+=_.w*_.h,a=Math.max(a,_.w);c.sort((_,S)=>S.h-_.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let p=0,y=0;for(const _ of c)for(let S=d.length-1;S>=0;S--){const A=d[S];if(!(_.w>A.w||_.h>A.h)){if(_.x=A.x,_.y=A.y,y=Math.max(y,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===A.w&&_.h===A.h){const C=d.pop();C&&S<d.length&&(d[S]=C)}else _.h===A.h?(A.x+=_.w,A.w-=_.w):_.w===A.w?(A.y+=_.h,A.h-=_.h):(d.push({x:A.x+_.w,y:A.y,w:A.w-_.w,h:_.h}),A.y+=_.h,A.h-=_.h);break}}return{w:p,h:y,fill:i/(p*y)||0}}Wt(eh,"Anchor");const Ap=1;class sx{static getImagePositionScale(i,a,d){if(a&&i&&i.options&&i.options.transform){const p=i.options.transform;return{x:p.a,y:p.d}}return{x:d,y:d}}constructor(i,a,d,p){this.paddedRect=i;const{pixelRatio:y,version:_,stretchX:S,stretchY:A,content:C,sdf:R,usvg:D}=a;this.pixelRatio=y,this.stretchX=S,this.stretchY=A,this.content=C,this.version=_,this.padding=d,this.sdf=R,this.usvg=D,this.scale=sx.getImagePositionScale(p,D,y)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function DI(c,i,a){const d=Yl.parse(c),p=function(y,_,S=[1,1]){return{x:0,y:0,w:(y.data?y.data.width:y.width*S[0])+2*_,h:(y.data?y.data.height:y.height*S[1])+2*_}}(i,a,[d.options.transform.a,d.options.transform.d]);return{bin:p,imagePosition:new sx(p,i,a,d),imageVariant:d}}class oB{constructor(i,a,d){const p=new Map,y=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(i,p,Ap,_),this.addImages(a,y,2,_);const{w:S,h:A}=iB(_),C=new Bo({width:S||1,height:A||1});for(const[R,D]of i.entries()){const j=p.get(R).paddedRect;Bo.copy(D.data,C,{x:0,y:0},{x:j.x+Ap,y:j.y+Ap},D.data,d,D.sdf)}for(const[R,D]of a.entries()){const j=y.get(R),H=j.paddedRect;let W=j.padding;const J=H.x+W,te=H.y+W,ae=D.data.width,de=D.data.height;W=W>1?W-1:W,Bo.copy(D.data,C,{x:0,y:0},{x:J,y:te},D.data,d),Bo.copy(D.data,C,{x:0,y:de-W},{x:J,y:te-W},{width:ae,height:W},d),Bo.copy(D.data,C,{x:0,y:0},{x:J,y:te+de},{width:ae,height:W},d),Bo.copy(D.data,C,{x:ae-W,y:0},{x:J-W,y:te},{width:W,height:de},d),Bo.copy(D.data,C,{x:0,y:0},{x:J+ae,y:te},{width:W,height:de},d),Bo.copy(D.data,C,{x:ae-W,y:de-W},{x:J-W,y:te-W},{width:W,height:W},d),Bo.copy(D.data,C,{x:0,y:de-W},{x:J+ae,y:te-W},{width:W,height:W},d),Bo.copy(D.data,C,{x:0,y:0},{x:J+ae,y:te+de},{width:W,height:W},d),Bo.copy(D.data,C,{x:ae-W,y:0},{x:J-W,y:te+de},{width:W,height:W},d)}this.lut=d,this.image=C,this.iconPositions=p,this.patternPositions=y}addImages(i,a,d,p){for(const[y,_]of i.entries()){const{bin:S,imagePosition:A,imageVariant:C}=DI(y,_,d);a.set(y,A),p.push(S),_.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(i,a,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>i.hasImage(p,d)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const p of i.getUpdatedImages(d)){for(const y of this.iconPositions.keys()){const _=Yl.parse(y);if(zs.isEqual(_.id,p)){const S=i.getImage(p,d);this.patchUpdatedImage(this.iconPositions.get(y),S,a)}}for(const y of this.patternPositions.keys()){const _=Yl.parse(y);if(zs.isEqual(_.id,p)){const S=i.getImage(p,d);this.patchUpdatedImage(this.patternPositions.get(y),S,a)}}}}patchUpdatedImage(i,a,d){if(!i||!a||i.version===a.version)return;i.version=a.version;const[p,y]=i.tl,_=i.sdf;if(this.lut||_){const S={width:a.data.width,height:a.data.height},A=new Bo(S);Bo.copy(a.data,A,{x:0,y:0},{x:0,y:0},S,this.lut,_),d.update(A,{position:{x:p,y}})}else d.update(a.data,{position:{x:p,y}})}}Wt(sx,"ImagePosition"),Wt(oB,"ImageAtlas");const ax=1e20;function sB(c,i,a,d,p,y,_,S,A){for(let C=i;C<i+d;C++)aB(c,a*y+C,y,p,_,S,A);for(let C=a;C<a+p;C++)aB(c,C*y+i,1,d,_,S,A)}function aB(c,i,a,d,p,y,_){y[0]=0,_[0]=-ax,_[1]=ax,p[0]=c[i];for(let S=1,A=0,C=0;S<d;S++){p[S]=c[i+S*a];const R=S*S;do{const D=y[A];C=(p[S]-p[D]+R-D*D)/(S-D)/2}while(C<=_[A]&&--A>-1);A++,y[A]=S,_[A]=C,_[A+1]=ax}for(let S=0,A=0;S<d;S++){for(;_[A+1]<S;)A++;const C=y[A],R=S-C;c[i+S*a]=p[C]+R*R}}const tc=2,LI={none:0,ideographs:1,all:2};class Xg{constructor(i,a,d){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=d,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,a){const d=[],p=this.url||Oo.GLYPHS_URL;for(const y in i)for(const _ of i[y])d.push({stack:y,id:_});$e(d,({stack:y,id:_},S)=>{let A=this.entries[y];A||(A=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=A.glyphs[_];if(C!==void 0)return void S(null,{stack:y,id:_,glyph:C});if(C=this._tinySDF(A,y,_),C)return A.glyphs[_]=C,void S(null,{stack:y,id:_,glyph:C});const R=Math.floor(_/256);if(256*R>65535)return qr("glyphs > 65535 not supported"),void S(null,{stack:y,id:_,glyph:C});if(A.ranges[R])return void S(null,{stack:y,id:_,glyph:C});let D=A.requests[R];D||(D=A.requests[R]=[],Xg.loadGlyphRange(y,R,p,this.requestManager,(j,H)=>{if(H){A.ascender=H.ascender,A.descender=H.descender;for(const W in H.glyphs)this._doesCharSupportLocalGlyph(+W)||(A.glyphs[+W]=H.glyphs[+W]);A.ranges[R]=!0}for(const W of D)W(j,H);delete A.requests[R]})),D.push((j,H)=>{j?S(j):H&&S(null,{stack:y,id:_,glyph:H.glyphs[_]||null})})},(y,_)=>{if(y)a(y);else if(_){const S={};for(const{stack:A,id:C,glyph:R}of _)S[A]===void 0&&(S[A]={}),S[A].glyphs===void 0&&(S[A].glyphs={}),S[A].glyphs[C]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},S[A].ascender=this.entries[A].ascender,S[A].descender=this.entries[A].descender;a(null,S)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==LI.none&&(this.localGlyphMode===LI.all?!!this.localFontFamily:!!this.localFontFamily&&(dr["CJK Unified Ideographs"](i)||dr["Hangul Syllables"](i)||dr.Hiragana(i)||dr.Katakana(i)||dr["CJK Symbols and Punctuation"](i)||dr["CJK Unified Ideographs Extension A"](i)||dr["CJK Unified Ideographs Extension B"](i)||dr.Osage(i)))}_tinySDF(i,a,d){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let y=i.tinySDF;if(!y){let J="400";/bold/i.test(a)?J="900":/medium/i.test(a)?J="500":/light/i.test(a)&&(J="200"),y=i.tinySDF=new Xg.TinySDF({fontFamily:p,fontWeight:J,fontSize:24*tc,buffer:3*tc,radius:8*tc}),y.fontWeight=J}if(this.localGlyphs[y.fontWeight][d])return this.localGlyphs[y.fontWeight][d];const _=String.fromCodePoint(d),{data:S,width:A,height:C,glyphWidth:R,glyphHeight:D,glyphLeft:j,glyphTop:H,glyphAdvance:W}=y.draw(_);return this.localGlyphs[y.fontWeight][d]={id:d,bitmap:new Sd({width:A,height:C},S),metrics:{width:R/tc,height:D/tc,left:j/tc,top:H/tc-27,advance:W/tc,localGlyph:!0}}}}Xg.loadGlyphRange=function(c,i,a,d,p){const y=256*i,_=y+255,S=d.transformRequest(d.normalizeGlyphsURL(a).replace("{fontstack}",c).replace("{range}",`${y}-${_}`),zf.Glyphs);Ff(S,(A,C)=>{if(A)p(A);else if(C){const R={},D=function(j){return new LS(j).readFields(Kne,{})}(C);for(const j of D.glyphs)R[j.id]=j;p(null,{glyphs:R,ascender:D.ascender,descender:D.descender})}})},Xg.TinySDF=class{constructor({fontSize:c=24,buffer:i=3,radius:a=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:_="normal"}={}){this.buffer=i,this.cutoff=d,this.radius=a;const S=this.size=c+4*i,A=this._createCanvas(S),C=this.ctx=A.getContext("2d",{willReadFrequently:!0});C.font=`${_} ${y} ${c}px ${p}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(c){const i=document.createElement("canvas");return i.width=i.height=c,i}draw(c){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(c),_=Math.ceil(a),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),A=Math.min(this.size-this.buffer,_+Math.ceil(d)),C=S+2*this.buffer,R=A+2*this.buffer,D=Math.max(C*R,0),j=new Uint8ClampedArray(D),H={data:j,width:C,height:R,glyphWidth:S,glyphHeight:A,glyphTop:_,glyphLeft:0,glyphAdvance:i};if(S===0||A===0)return H;const{ctx:W,buffer:J,gridInner:te,gridOuter:ae}=this;W.clearRect(J,J,S,A),W.fillText(c,J,J+_);const de=W.getImageData(J,J,S,A);ae.fill(ax,0,D),te.fill(0,0,D);for(let he=0;he<A;he++)for(let me=0;me<S;me++){const ke=de.data[4*(he*S+me)+3]/255;if(ke===0)continue;const Ee=(he+J)*C+me+J;if(ke===1)ae[Ee]=0,te[Ee]=ax;else{const Pe=.5-ke;ae[Ee]=Pe>0?Pe*Pe:0,te[Ee]=Pe<0?Pe*Pe:0}}sB(ae,0,0,C,R,C,this.f,this.v,this.z),sB(te,J,J,S,A,C,this.f,this.v,this.z);for(let he=0;he<D;he++){const me=Math.sqrt(ae[he])-Math.sqrt(te[he]);j[he]=Math.round(255-255*(me/this.radius+this.cutoff))}return H}};const Ad=Ap;function lB(c,i){return c+i[1]-i[0]}function cB(c,i,a,d,p=1){const y=[],_=c.imagePrimary,S=_.pixelRatio,A=_.paddedRect.w-2*Ad,C=_.paddedRect.h-2*Ad,R=(c.right-c.left)*p,D=(c.bottom-c.top)*p,j=_.stretchX||[[0,A]],H=_.stretchY||[[0,C]],W=j.reduce(lB,0),J=H.reduce(lB,0),te=A-W,ae=C-J;let de=0,he=W,me=0,ke=J,Ee=0,Pe=te,Ne=0,Be=ae;if(_.content&&d){const Ue=_.content;de=NS(j,0,Ue[0]),me=NS(H,0,Ue[1]),he=NS(j,Ue[0],Ue[2]),ke=NS(H,Ue[1],Ue[3]),Ee=Ue[0]-de,Ne=Ue[1]-me,Pe=Ue[2]-Ue[0]-he,Be=Ue[3]-Ue[1]-ke}const ct=(Ue,dt,Ct,mt)=>{const wt=zS(Ue.stretch-de,he,R,c.left*p),At=FS(Ue.fixed-Ee,Pe,Ue.stretch,W),at=zS(dt.stretch-me,ke,D,c.top*p),St=FS(dt.fixed-Ne,Be,dt.stretch,J),He=zS(Ct.stretch-de,he,R,c.left*p),lt=FS(Ct.fixed-Ee,Pe,Ct.stretch,W),kt=zS(mt.stretch-me,ke,D,c.top*p),Tt=FS(mt.fixed-Ne,Be,mt.stretch,J),tr=new ut(wt,at),Zt=new ut(He,at),xt=new ut(He,kt),Et=new ut(wt,kt),Yt=new ut(At/S,St/S),Vt=new ut(lt/S,Tt/S),jt=i*Math.PI/180;if(jt){const Zr=Math.sin(jt),jr=Math.cos(jt),Yn=[jr,-Zr,Zr,jr];tr._matMult(Yn),Zt._matMult(Yn),Et._matMult(Yn),xt._matMult(Yn)}const Gt=Ue.stretch+Ue.fixed,hr=Ct.stretch+Ct.fixed,vr=dt.stretch+dt.fixed,Cr=mt.stretch+mt.fixed,Tr=c.imageSecondary;return{tl:tr,tr:Zt,bl:Et,br:xt,texPrimary:{x:_.paddedRect.x+Ad+Gt,y:_.paddedRect.y+Ad+vr,w:hr-Gt,h:Cr-vr},texSecondary:Tr?{x:Tr.paddedRect.x+Ad+Gt,y:Tr.paddedRect.y+Ad+vr,w:hr-Gt,h:Cr-vr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yt,pixelOffsetBR:Vt,minFontScaleX:Pe/S/R,minFontScaleY:Be/S/D,isSDF:a}};if(d&&(_.stretchX||_.stretchY)){const Ue=uB(j,te,W),dt=uB(H,ae,J);for(let Ct=0;Ct<Ue.length-1;Ct++){const mt=Ue[Ct],wt=Ue[Ct+1];for(let At=0;At<dt.length-1;At++)y.push(ct(mt,dt[At],wt,dt[At+1]))}}else y.push(ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:C+1}));return y}function NS(c,i,a){let d=0;for(const p of c)d+=Math.max(i,Math.min(a,p[1]))-Math.max(i,Math.min(a,p[0]));return d}function uB(c,i,a){const d=[{fixed:-Ad,stretch:0}];for(const[p,y]of c){const _=d[d.length-1];d.push({fixed:p-_.stretch,stretch:_.stretch}),d.push({fixed:p-_.stretch,stretch:_.stretch+(y-p)})}return d.push({fixed:i+Ad,stretch:a}),d}function zS(c,i,a,d){return c/i*a+d}function FS(c,i,a,d){return c-i*a/d}function iie(c,i,a,d){const p=i+c.positionedLines[d].lineOffset;return d===0?a+p/2:a+(p+(i+c.positionedLines[d-1].lineOffset))/2}function oie(c,i=1,a=!1){let d=1/0,p=1/0,y=-1/0,_=-1/0;const S=c[0];for(let H=0;H<S.length;H++){const W=S[H];(!H||W.x<d)&&(d=W.x),(!H||W.y<p)&&(p=W.y),(!H||W.x>y)&&(y=W.x),(!H||W.y>_)&&(_=W.y)}const A=Math.min(y-d,_-p);let C=A/2;const R=new Ym([],sie);if(A===0)return new ut(d,p);for(let H=d;H<y;H+=A)for(let W=p;W<_;W+=A)R.push(new Kg(H+C,W+C,C,c));let D=function(H){let W=0,J=0,te=0;const ae=H[0];for(let de=0,he=ae.length,me=he-1;de<he;me=de++){const ke=ae[de],Ee=ae[me],Pe=ke.x*Ee.y-Ee.x*ke.y;J+=(ke.x+Ee.x)*Pe,te+=(ke.y+Ee.y)*Pe,W+=3*Pe}return new Kg(J/W,te/W,0,H)}(c),j=R.length;for(;R.length;){const H=R.pop();(H.d>D.d||!D.d)&&(D=H,a&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,j)),H.max-D.d<=i||(C=H.h/2,R.push(new Kg(H.p.x-C,H.p.y-C,C,c)),R.push(new Kg(H.p.x+C,H.p.y-C,C,c)),R.push(new Kg(H.p.x-C,H.p.y+C,C,c)),R.push(new Kg(H.p.x+C,H.p.y+C,C,c)),j+=4)}return a&&(console.log(`num probes: ${j}`),console.log(`best distance: ${D.d}`)),D.p}function sie(c,i){return i.max-c.max}class Kg{constructor(i,a,d,p){this.p=new ut(i,a),this.h=d,this.d=function(y,_){let S=!1,A=1/0;for(let C=0;C<_.length;C++){const R=_[C];for(let D=0,j=R.length,H=j-1;D<j;H=D++){const W=R[D],J=R[H];W.y>y.y!=J.y>y.y&&y.x<(J.x-W.x)*(y.y-W.y)/(J.y-W.y)+W.x&&(S=!S),A=Math.min(A,sa(y,W,J))}}return(S?1:-1)*Math.sqrt(A)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const aie=Object.keys,jI=Number.POSITIVE_INFINITY,lie=Math.sqrt(2);function hB(c,[i,a]){let d=0,p=0;if(a===jI){i<0&&(i=0);const y=i/lie;switch(c){case"top-right":case"top-left":p=y-7;break;case"bottom-right":case"bottom-left":p=7-y;break;case"bottom":p=7-i;break;case"top":p=i-7}switch(c){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=i;break;case"right":d=-i}}else{switch(i=Math.abs(i),a=Math.abs(a),c){case"top-right":case"top-left":case"top":p=a-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-a}switch(c){case"top-right":case"bottom-right":case"right":d=-i;break;case"top-left":case"bottom-left":case"left":d=i}}return[d,p]}function BS(c,i,a,d,p,y,_,S,A){if(!i||!i.usvg)return;const C=YF(d),R=YF(p),D=y!=="both"&&y!=="width"||!XF(d)?1:R.width/C.width,j=y!=="both"&&y!=="height"||!KF(d)?1:R.height/C.height;a.scaleSelf(D,j);const H=a.toString();_.set(H,a),S.set(H,i);const{imagePosition:W}=DI(H,i,Ap);A.set(H,W)}function dB(c,i,a,d,p,y,_,S,A){if(!c)return;const C=function(R,D,j,H,W,J){if(R.kind==="camera")return R.maxSize;if(R.kind==="composite"){const te=D.possiblyEvaluate(new Rn(R.maxZoom,{worldview:J}),j).evaluate(W,{},j),ae=D.possiblyEvaluate(new Rn(R.minZoom,{worldview:J}),j).evaluate(W,{},j);return Math.max(te,ae)}return D.possiblyEvaluate(new Rn(H,{worldview:J})).evaluate(W,{},j)}(i,a,d,p,y,A);return c.scaleSelf(C*S*_)}function fB(c,i,a,d,p,y,_,S,A){return{iconPrimary:dB(c.getPrimary(),i,a,d,p,y,_,S,A),iconSecondary:dB(c.getSecondary(),i,a,d,p,y,_,S,A)}}function cie(c,i,a){if(!i)return;const d=a.get(c.toString()),p=a.get(i.toString());p&&(d.paddedRect.w===p.paddedRect.w&&d.paddedRect.h===p.paddedRect.h||qr(`Mismatch in icon variant sizes: ${c.toString()} and ${i.toString()}`),d.usvg!==p.usvg&&qr(`Mismatch in icon variant image types: ${c.id} and ${i.id}`))}function pB(c,i,a,d){if(!c)return;const p=i.get(a.toString());if(c.imagePrimary=p,d){const y=i.get(d.toString());c.imageSecondary=y}}function uie(c,i){for(const a in c.horizontal)mB(c.horizontal[a],i);mB(c.vertical,i)}function mB(c,i){if(c){for(const a of c.positionedLines)for(const d of a.positionedGlyphs)if(d.image!==null){const p=d.image.toString();d.rect=i.get(p).paddedRect}}}function NI(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function hie(c,i,a,d,p,y,_,S,A){const C=zI(y.horizontal)||y.vertical,R=a.get("icon-text-fit-padding").evaluate(d,{},p);let D,j=i;return i&&A!=="none"&&(c.allowVerticalPlacement&&y.vertical&&(D=ZF(i,y.vertical,A,R,S,_)),C&&(j=ZF(i,C,A,R,S,_))),{defaultShapedIcon:j,verticallyShapedIcon:D}}function die(c,i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te,ae,de,he){let me=_.textMaxSize.evaluate(i,{},j);me===void 0?me=S*_.textScaleFactor:me*=_.textScaleFactor;const ke=c.layers[0].layout,Ee=zI(a.horizontal)||a.vertical,Pe=H.name==="globe",Ne=Eo,Be=c.tilePixelRatio*me/Ne,ct=(At=c.overscaling,c.zoom>18&&At>2&&(At>>=1),Math.max(Lt/(512*At),1)*ke.get("symbol-spacing")),Ue=ke.get("text-padding")*c.tilePixelRatio,dt=ke.get("icon-padding")*c.tilePixelRatio,Ct=Br(ke.get("text-max-angle")),mt=ke.get("icon-rotation-alignment")==="map"&&he!=="point",wt=ct/2;var At;c.hasAnyIconTextFit===!1&&te!=="none"&&(c.hasAnyIconTextFit=!0);const at=i.properties?+i.properties[$t]:null,St=at&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(at):65535,He=(lt,kt,Tt)=>{if(kt.x<0||kt.x>=Lt||kt.y<0||kt.y>=Lt)return;let tr=null;if(Pe){const{x:Zt,y:xt,z:Et}=H.projectTilePoint(kt.x,kt.y,Tt);tr={anchor:new eh(Zt,xt,Et,0,void 0),up:H.upVector(Tt,kt.x,kt.y)}}(function(Zt,xt,Et,Yt,Vt,jt,Gt,hr,vr,Cr,Tr,Zr,jr,Yn,_e,ve,ot,Rt,zt,Nt,Xt,gr,Vr,Ur,Or,Dn,pi,Ir,ti){const Gn=Zt.addToLineVertexArray(xt,Yt);let En,hi,Jn,Hn,Xn,On,kr,Ln=0,di=0,fr=0,en=0,Qn=-1,yi=-1;const ri={};let qi=Uh("");const zn=Et?Et.anchor:xt,$i=Ir!=="none";let Vs=0,$o=0;if(vr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Zi=vr.layout.get("text-offset").evaluate(Xt,{},Or);Vs=Zi[0]*Eo,$o=Zi[1]*Eo}else Vs=vr.layout.get("text-radial-offset").evaluate(Xt,{},Or)*Eo,$o=jI;if(Zt.allowVerticalPlacement&&Vt.vertical){const Zi=Vt.vertical;if(_e)On=FI(Zi),hr&&(kr=FI(hr));else{const lo=vr.layout.get("text-rotate").evaluate(Xt,{},Or)+90;Jn=$S(Cr,zn,xt,Tr,Zr,jr,Zi,Yn,lo,ve),hr&&(Hn=$S(Cr,zn,xt,Tr,Zr,jr,hr,Rt,lo))}}if(jt){const Zi=Zt.iconSizeData,lo=vr.layout.get("icon-rotate").evaluate(Xt,{},Or),Vo=cB(jt,lo,Vr,$i,gr.iconScaleFactor),gs=hr?cB(hr,lo,Vr,$i,gr.iconScaleFactor):void 0;hi=$S(Cr,zn,xt,Tr,Zr,jr,jt,Rt,lo,null),Ln=4*Vo.length;let Qo=null;Zi.kind==="source"?(Qo=[nu*vr.layout.get("icon-size").evaluate(Xt,{},Or)*gr.iconScaleFactor],Qo[0]>Pd&&qr(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${lx}. Reduce your "icon-size".`)):Zi.kind==="composite"&&(Qo=[nu*gr.compositeIconSizes[0].evaluate(Xt,{},Or)*gr.iconScaleFactor,nu*gr.compositeIconSizes[1].evaluate(Xt,{},Or)*gr.iconScaleFactor],(Qo[0]>Pd||Qo[1]>Pd)&&qr(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${lx}. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,Vo,Qo,Nt,zt,Xt,void 0,Et,xt,Gn.lineStartIndex,Gn.lineLength,-1,Ur,Or,Dn,pi),Qn=Zt.icon.placedSymbolArray.length-1,gs&&(di=4*gs.length,Zt.addSymbols(Zt.icon,gs,Qo,Nt,zt,Xt,ha.vertical,Et,xt,Gn.lineStartIndex,Gn.lineLength,-1,Ur,Or,Dn,pi),yi=Zt.icon.placedSymbolArray.length-1)}for(const Zi in Vt.horizontal){const lo=Zi,Vo=Vt.horizontal[lo];En||(qi=Uh(Vo.text),_e?Xn=FI(Vo):En=$S(Cr,zn,xt,Tr,Zr,jr,Vo,Yn,vr.layout.get("text-rotate").evaluate(Xt,{},Or),ve));const gs=Vo.positionedLines.length===1;if(fr+=gB(Zt,Et,xt,Vo,Gt,vr,_e,Xt,ve,Gn,Vt.vertical?ha.horizontal:ha.horizontalOnly,gs?aie(Vt.horizontal):[lo],ri,Qn,gr,Ur,Or,Dn),gs)break}Vt.vertical&&(en+=gB(Zt,Et,xt,Vt.vertical,Gt,vr,_e,Xt,ve,Gn,ha.vertical,["vertical"],ri,yi,gr,Ur,Or,Dn));let ko=-1;const Us=(Zi,lo)=>Zi?Math.max(Zi,lo):lo;ko=Us(Xn,ko),ko=Us(On,ko),ko=Us(kr,ko);const iu=ko>-1?1:0;Zt.glyphOffsetArray.length>=65535&&qr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xt.sortKey!==void 0&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,Xt.sortKey),Zt.symbolInstances.emplaceBack(xt.x,xt.y,zn.x,zn.y,zn.z,ri.right>=0?ri.right:-1,ri.center>=0?ri.center:-1,ri.left>=0?ri.left:-1,ri.vertical>=0?ri.vertical:-1,Qn,yi,qi,En!==void 0?En:Zt.collisionBoxArray.length,En!==void 0?En+1:Zt.collisionBoxArray.length,Jn!==void 0?Jn:Zt.collisionBoxArray.length,Jn!==void 0?Jn+1:Zt.collisionBoxArray.length,hi!==void 0?hi:Zt.collisionBoxArray.length,hi!==void 0?hi+1:Zt.collisionBoxArray.length,Hn||Zt.collisionBoxArray.length,Hn?Hn+1:Zt.collisionBoxArray.length,Tr,fr,en,Ln,di,iu,0,Vs,$o,ko,0,$i?1:0,ti)})(c,kt,tr,lt,a,d,y,p,c.layers[0],c.collisionBoxArray,i.index,i.sourceLayerIndex,c.index,Ue,de,C,0,dt,mt,ae,i,_,R,D,j,W,J,te,St)};if(he==="line")for(const lt of PS(i.geometry,0,0,Lt,Lt)){const kt=nie(lt,ct,Ct,a.vertical||Ee,d,Ne,Be,c.overscaling,Lt);for(const Tt of kt)Ee&&fie(c,Ee.text,wt,Tt)||He(lt,Tt,j)}else if(he==="line-center"){for(const lt of i.geometry)if(lt.length>1){const kt=rie(lt,Ct,a.vertical||Ee,d,Ne,Be);kt&&He(lt,kt,j)}}else if(i.type==="Polygon")for(const lt of G0(i.geometry,0)){const kt=oie(lt,16);He(lt[0],new eh(kt.x,kt.y,0,0,void 0),j)}else if(i.type==="LineString")for(const lt of i.geometry)He(lt,new eh(lt[0].x,lt[0].y,0,0,void 0),j);else if(i.type==="Point")for(const lt of i.geometry)for(const kt of lt)He([kt],new eh(kt.x,kt.y,0,0,void 0),j)}const lx=255,Pd=lx*nu;function gB(c,i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te,ae){const de=function(ke,Ee,Pe,Ne,Be,ct,Ue,dt){const Ct=[];if(Ee.positionedLines.length===0)return Ct;const mt=Ne.layout.get("text-rotate").evaluate(ct,{})*Math.PI/180,wt=function(lt){const kt=lt[0],Tt=lt[1],tr=kt*Tt;return tr>0?[kt,-Tt]:tr<0?[-kt,Tt]:kt===0?[Tt,kt]:[Tt,-kt]}(Pe);let At=Math.abs(Ee.top-Ee.bottom);for(const lt of Ee.positionedLines)At-=lt.lineOffset;const at=Ee.positionedLines.length,St=At/at;let He=Ee.top-Pe[1];for(let lt=0;lt<at;++lt){const kt=Ee.positionedLines[lt];He=iie(Ee,St,He,lt);for(const Tt of kt.positionedGlyphs){if(!Tt.rect)continue;const tr=Tt.rect||{};let Zt=$F+1,xt=!0,Et=1,Yt=0;if(Tt.image){const Xt=Ue.get(Tt.image.toString());if(!Xt)continue;if(Xt.sdf){qr("SDF images are not supported in formatted text and will be ignored.");continue}xt=!1,Et=Xt.pixelRatio,Zt=Ap/Et}const Vt=(Be||dt)&&Tt.vertical,jt=Tt.metrics.advance*Tt.scale/2,Gt=Tt.metrics,hr=Tt.rect;if(hr===null)continue;dt&&Ee.verticalizable&&(Yt=Tt.image?jt-Tt.metrics.width*Tt.scale/2:0);const vr=Be?[Tt.x+jt,Tt.y]:[0,0];let Cr=[0,0],Tr=[0,0],Zr=!1;Be||(Vt?(Tr=[Tt.x+jt+wt[0],Tt.y+wt[1]-Yt],Zr=!0):Cr=[Tt.x+jt+Pe[0],Tt.y+Pe[1]-Yt]);const jr=hr.w*Tt.scale/(Et*(Tt.localGlyph?tc:1)),Yn=hr.h*Tt.scale/(Et*(Tt.localGlyph?tc:1));let _e,ve,ot,Rt;if(Vt){const Xt=Tt.y-He,gr=new ut(-jt,jt-Xt),Vr=-Math.PI/2,Ur=new ut(...Tr);_e=new ut(-jt+Cr[0],Cr[1]),_e._rotateAround(Vr,gr)._add(Ur),_e.x+=-Xt+jt,_e.y-=(Gt.left-Zt)*Tt.scale;const Or=Tt.image?Gt.advance*Tt.scale:Eo*Tt.scale,Dn=String.fromCodePoint(Tt.glyph);Fne(Dn)?_e.x+=(1-Zt)*Tt.scale:Bne(Dn)?_e.x+=Or-Gt.height*Tt.scale+(-Zt-1)*Tt.scale:_e.x+=Tt.image||Gt.width+2*Zt===hr.w&&Gt.height+2*Zt===hr.h?(Or-Yn)/2:(Or-(Gt.height+2*Zt)*Tt.scale)/2,ve=new ut(_e.x,_e.y-jr),ot=new ut(_e.x+Yn,_e.y),Rt=new ut(_e.x+Yn,_e.y-jr)}else{const Xt=(Gt.left-Zt)*Tt.scale-jt+Cr[0],gr=(-Gt.top-Zt)*Tt.scale+Cr[1],Vr=Xt+jr,Ur=gr+Yn;_e=new ut(Xt,gr),ve=new ut(Vr,gr),ot=new ut(Xt,Ur),Rt=new ut(Vr,Ur)}if(mt){let Xt;Xt=Be?new ut(0,0):Zr?new ut(wt[0],wt[1]):new ut(Pe[0],Pe[1]),_e._rotateAround(mt,Xt),ve._rotateAround(mt,Xt),ot._rotateAround(mt,Xt),Rt._rotateAround(mt,Xt)}const zt=new ut(0,0),Nt=new ut(0,0);Ct.push({tl:_e,tr:ve,bl:ot,br:Rt,texPrimary:tr,texSecondary:void 0,writingMode:Ee.writingMode,glyphOffset:vr,sectionIndex:Tt.sectionIndex,isSDF:xt,pixelOffsetTL:zt,pixelOffsetBR:Nt,minFontScaleX:0,minFontScaleY:0})}}return Ct}(0,d,A,y,_,S,p,c.allowVerticalPlacement),he=c.textSizeData;let me=null;he.kind==="source"?(me=[nu*y.layout.get("text-size").evaluate(S,{},te)*W.textScaleFactor],me[0]>Pd&&qr(`${c.layerIds[0]}: Value for "text-size" is >= ${lx}. Reduce your "text-size".`)):he.kind==="composite"&&(me=[nu*W.compositeTextSizes[0].evaluate(S,{},te)*W.textScaleFactor,nu*W.compositeTextSizes[1].evaluate(S,{},te)*W.textScaleFactor],(me[0]>Pd||me[1]>Pd)&&qr(`${c.layerIds[0]}: Value for "text-size" is >= ${lx}. Reduce your "text-size".`)),c.addSymbols(c.text,de,me,A,_,S,R,i,a,C.lineStartIndex,C.lineLength,H,J,te,ae,!1);for(const ke of D)j[ke]=c.text.placedSymbolArray.length-1;return 4*de.length}function zI(c){for(const i in c)return c[i];return null}function $S(c,i,a,d,p,y,_,S,A,C){let R=_.top,D=_.bottom,j=_.left,H=_.right;if(qF(_)&&_.collisionPadding){const W=_.collisionPadding;j-=W[0],R-=W[1],H+=W[2],D+=W[3]}if(A){const W=new ut(j,R),J=new ut(H,R),te=new ut(j,D),ae=new ut(H,D),de=Br(A);let he=new ut(0,0);C&&(he=new ut(C[0],C[1])),W._rotateAround(de,he),J._rotateAround(de,he),te._rotateAround(de,he),ae._rotateAround(de,he),j=Math.min(W.x,J.x,te.x,ae.x),H=Math.max(W.x,J.x,te.x,ae.x),R=Math.min(W.y,J.y,te.y,ae.y),D=Math.max(W.y,J.y,te.y,ae.y)}return c.emplaceBack(i.x,i.y,i.z,a.x,a.y,j,R,H,D,S,d,p,y),c.length-1}function FI(c){qF(c)&&c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const i=c.bottom-c.top;return i>0?Math.max(10,i):null}function fie(c,i,a,d){const p=c.compareText;if(i in p){const y=p[i];for(let _=y.length-1;_>=0;_--)if(d.dist(y[_])<a)return!0}else p[i]=[];return p[i].push(d),!1}function yB(c,i){const a=c.fovAboveCenter,d=c.elevation?c.elevation.getMinElevationBelowMSL()*i:0,p=(c._camera.position[2]*c.worldSize-d)/Math.cos(c._pitch),y=Math.sin(a)*p/Math.sin(Math.max(Math.PI/2-c._pitch-a,.01));let _=Math.sin(c._pitch)*y+p;const S=p*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let A=Math.max(c.zoom-17,0);c.isOrthographic&&(A/=10),_*=1+A}return Math.min(1.01*_,S)}function cx(c,i){if(!i.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:i};const a=Math.pow(2,-c.z),d=c.x*a,p=(c.x+1)*a,y=c.y*a,_=(c.y+1)*a,S=ue(d),A=ue(p),C=pe(y),R=pe(_),D=i.project(S,C),j=i.project(A,C),H=i.project(A,R),W=i.project(S,R);let J=Math.min(D.x,j.x,H.x,W.x),te=Math.min(D.y,j.y,H.y,W.y),ae=Math.max(D.x,j.x,H.x,W.x),de=Math.max(D.y,j.y,H.y,W.y);const he=a/16;function me(Ee,Pe,Ne,Be,ct,Ue){const dt=(Ne+ct)/2,Ct=(Be+Ue)/2,mt=i.project(ue(dt),pe(Ct)),wt=Math.max(0,J-mt.x,te-mt.y,mt.x-ae,mt.y-de);J=Math.min(J,mt.x),ae=Math.max(ae,mt.x),te=Math.min(te,mt.y),de=Math.max(de,mt.y),wt>he&&(me(Ee,mt,Ne,Be,dt,Ct),me(mt,Pe,dt,Ct,ct,Ue))}me(D,j,d,y,p,y),me(j,H,p,y,p,_),me(H,W,p,_,d,_),me(W,D,d,_,d,y),J-=he,te-=he,ae+=he,de+=he;const ke=1/Math.max(ae-J,de-te);return{scale:ke,x:J*ke,y:te*ke,x2:ae*ke,y2:de*ke,projection:i}}function _B(c,{x:i,y:a},d=0){return new ut(((i-d)*c.scale-c.x)*Lt,(a*c.scale-c.y)*Lt)}const pie=z(new Float32Array(16));class Cd{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new F(0,0)}projectTilePoint(i,a,d){return{x:i,y:a,z:0}}locationPoint(i,a,d,p=!0){return i._coordinatePoint(i.locationCoordinate(a,d),p)}pixelsPerMeter(i,a){return ie(1,i)*a}pixelSpaceConversion(i,a,d){return 1}farthestPixelDistance(i){return yB(i,i.pixelsPerMeter)}pointCoordinate(i,a,d,p){const y=i.horizonLineFromTop(!1),_=new ut(a,Math.max(y,d));return i.rayIntersectionCoordinate(i.pointRayIntersection(_,p))}pointCoordinate3D(i,a,d){const p=new ut(a,d);if(i.elevation)return i.elevation.pointCoordinate(p);{const y=this.pointCoordinate(i,p.x,p.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(i,a){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,a.x,a.y);const d=i.horizonLineFromTop();return a.y<d}createInversionMatrix(i,a){return pie}createTileMatrix(i,a,d){let p,y,_;const S=d.canonical,A=z(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=cx(S,this);p=1,y=C.x+d.wrap*C.scale,_=C.y,Z(A,A,[p/C.scale,p/C.scale,i.pixelsPerMeter/a])}else p=a/i.zoomScale(S.z),y=(S.x+Math.pow(2,S.z)*d.wrap)*p,_=S.y*p;return G(A,A,[y,_,0]),Z(A,A,[p/Lt,p/Lt,1]),A}upVector(i,a,d){return[0,0,1]}upVectorScale(i,a,d){return{metersToTile:1}}}class mie extends Cd{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,d]=this.parallels=i.parallels||[29.5,45.5],p=Math.sin(Br(a));this.n=(p+Math.sin(Br(d)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:d,c:p,r0:y}=this,_=Br(i-this.center[0]),S=Br(a),A=Math.sqrt(p-2*d*Math.sin(S))/d;return{x:A*Math.sin(_*d),y:A*Math.cos(_*d)-y,z:0}}unproject(i,a){const{n:d,c:p,r0:y}=this,_=y+a;let S=Math.atan2(i,Math.abs(_))*Math.sign(_);_*d<0&&(S-=Math.PI*Math.sign(i)*Math.sign(_));const A=Br(this.center[0])*d;S=rt(S,-Math.PI-A,Math.PI-A);const C=xe(Ge(S/d)+this.center[0],-180,180),R=Math.asin(xe((p-(i*i+_*_)*d*d)/(2*d),-1,1)),D=xe(Ge(R),-be,be);return new F(C,D)}}const ux=1.340264,hx=-.081106,dx=893e-6,fx=.003796,VS=Math.sqrt(3)/2;class gie extends Cd{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const d=Math.asin(VS*Math.sin(a)),p=d*d,y=p*p*p;return{x:.5*(i*Math.cos(d)/(VS*(ux+3*hx*p+y*(7*dx+9*fx*p)))/Math.PI+.5),y:1-.5*(d*(ux+hx*p+y*(dx+fx*p))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,p=d*d,y=p*p*p;for(let R,D,j,H=0;H<12&&(D=d*(ux+hx*p+y*(dx+fx*p))-a,j=ux+3*hx*p+y*(7*dx+9*fx*p),R=D/j,d=xe(d-R,-Math.PI/3,Math.PI/3),p=d*d,y=p*p*p,!(Math.abs(R)<1e-12));++H);const _=VS*i*(ux+3*hx*p+y*(7*dx+9*fx*p))/Math.cos(d),S=Math.asin(Math.sin(d)/VS),A=xe(180*_/Math.PI,-180,180),C=xe(180*S/Math.PI,-be,be);return new F(A,C)}}class yie extends Cd{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const d=360*(i-.5),p=xe(360*(.5-a),-be,be);return new F(d,p)}}const Yg=Math.PI/2;function US(c){return Math.tan((Yg+c)/2)}class _ie extends Cd{constructor(i){super(i),this.center=i.center||[0,30];const[a,d]=this.parallels=i.parallels||[30,30];let p=Br(a),y=Br(d);this.southernCenter=p+y<0,this.southernCenter&&(p=-p,y=-y);const _=Math.cos(p),S=US(p);this.n=p===y?Math.sin(p):Math.log(_/Math.cos(y))/Math.log(US(y)/S),this.f=_*Math.pow(US(p),this.n)/this.n}project(i,a){a=Br(a),this.southernCenter&&(a=-a),i=Br(i-this.center[0]);const d=1e-6,{n:p,f:y}=this;y>0?a<-Yg+d&&(a=-Yg+d):a>Yg-d&&(a=Yg-d);const _=y/Math.pow(US(a),p);let S=_*Math.sin(p*i),A=y-_*Math.cos(p*i);return S=.5*(S/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:S,y:this.southernCenter?A:1-A,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:d,f:p}=this,y=p-a,_=Math.sign(y),S=Math.sign(d)*Math.sqrt(i*i+y*y);let A=Math.atan2(i,Math.abs(y))*_;y*d<0&&(A-=Math.PI*Math.sign(i)*_);const C=xe(Ge(A/d)+this.center[0],-180,180),R=xe(Ge(2*Math.atan(Math.pow(p/S,1/d))-Yg),-be,be);return new F(C,this.southernCenter?-R:R)}}class vB extends Cd{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:Q(i),y:oe(a),z:0}}unproject(i,a){const d=ue(i),p=pe(a);return new F(d,p)}}const xB=Br(be);class vie extends Cd{project(i,a){const d=(a=Br(a))*a,p=d*d;return{x:.5*((i=Br(i))*(.8707-.131979*d+p*(p*(.003971*d-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+d*(.015085+p*(.028874*d-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,p=25,y=0,_=d*d;do{_=d*d;const C=_*_;y=(d*(1.007226+_*(.015085+C*(.028874*_-.044475-.005916*C)))-a)/(1.007226+_*(.045255+C*(.259866*_-.311325-.005916*11*C))),d=xe(d-y,-xB,xB)}while(Math.abs(y)>1e-6&&--p>0);_=d*d;const S=xe(Ge(i/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),A=Ge(d);return new F(S,A)}}const bB=Br(be);class xie extends Cd{project(i,a){a=Br(a),i=Br(i);const d=Math.cos(a),p=2/Math.PI,y=Math.acos(d*Math.cos(i/2)),_=Math.sin(y)/y,S=.5*(i*p+2*d*Math.sin(i/2)/_)||0,A=.5*(a+Math.sin(a)/_)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(i,a){let d=i=(2*i-.5)*Math.PI,p=a=(2*(1-a)-1)*Math.PI,y=25;const _=1e-6;let S=0,A=0;do{const C=Math.cos(p),R=Math.sin(p),D=2*R*C,j=R*R,H=C*C,W=Math.cos(d/2),J=Math.sin(d/2),te=2*W*J,ae=J*J,de=1-H*W*W,he=de?1/de:0,me=de?Math.acos(C*W)*Math.sqrt(1/de):0,ke=.5*(2*me*C*J+2*d/Math.PI)-i,Ee=.5*(me*R+p)-a,Pe=.5*he*(H*ae+me*C*W*j)+1/Math.PI,Ne=he*(te*D/4-me*R*J),Be=.125*he*(D*J-me*R*H*te),ct=.5*he*(j*W+me*ae*C)+.5,Ue=Ne*Be-ct*Pe;S=(Ee*Ne-ke*ct)/Ue,A=(ke*Be-Ee*Pe)/Ue,d=xe(d-S,-Math.PI,Math.PI),p=xe(p-A,-bB,bB)}while((Math.abs(S)>_||Math.abs(A)>_)&&--y>0);return new F(Ge(d),Ge(p))}}class wB extends Cd{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Br(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:d,cosPhi:p}=this;return{x:Br(i)*p*d+.5,y:-Math.sin(Br(a))/p*d+.5,z:0}}unproject(i,a){const{scale:d,cosPhi:p}=this,y=-(a-.5)/d,_=xe(Ge((i-.5)/d)/p,-180,180),S=Math.asin(xe(y*p,-1,1)),A=xe(Ge(S),-be,be);return new F(_,A)}}class bie extends vB{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,a,d){const p=z0(i,a,d);return nr(p,p,_S(tu(d))),{x:p[0],y:p[1],z:p[2]}}locationPoint(i,a,d){const p=I(a.lat,a.lng),y=Er([],p),_=d?i._centerAltitude+d:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude;It(p,p,y,ie(1,0)*Lt*_);const S=z(new Float64Array(16));return U(S,i.pixelMatrix,i.globeMatrix),nr(p,p,S),new ut(p[0],p[1])}pixelsPerMeter(i,a){return ie(1,0)*a}pixelSpaceConversion(i,a,d){const p=ie(1,i)*a,y=lr(ie(1,45)*a,p,d);return this.pixelsPerMeter(i,a)/y}createTileMatrix(i,a,d){const p=ZC(tu(d.canonical));return U(new Float64Array(16),i.globeMatrix,p)}createInversionMatrix(i,a){const{center:d}=i,p=_S(tu(a));return Y(p,p,Br(d.lng)),ne(p,p,Br(d.lat)),Z(p,p,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(i,a,d,p){return q3(i,a,d,!0)||new Te(0,0)}pointCoordinate3D(i,a,d){const p=this.pointCoordinate(i,a,d,0);return[p.x,p.y,p.z]}isPointAboveHorizon(i,a){return!q3(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=function(p,y){const _=p.cameraToCenterDistance,S=p._centerAltitude*y,A=p._camera,C=p._camera.forward(),R=Je([],_t([],C,-_),[0,0,S]),D=p.worldSize/(2*Math.PI),j=[0,0,-D],H=p.width/p.height,W=Math.tan(p.fovAboveCenter),J=_t([],A.up(),W),te=_t([],A.right(),W*H),ae=Er([],Je([],Je([],C,J),te)),de=[];let he;if(new sn(R,ae).closestPointOnSphere(j,D,de)){const me=Je([],de,j),ke=Yr([],me,R);he=Math.cos(p.fovAboveCenter)*Ye(ke)}else{const me=Yr([],R,j),ke=Yr([],j,R);Er(ke,ke);const Ee=Ye(me)-D;he=Math.sqrt(Ee*(Ee+2*D));const Pe=Math.acos(he/(D+Ee))-Math.acos(Kt(C,ke));he*=Math.cos(Pe)}return 1.01*he}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),d=wd(i.zoom);if(d>0){const p=yB(i,ie(1,i.center.lat)*i.worldSize),y=i.worldSize/(2*Math.PI),_=Math.max(i.width,i.height)/i.worldSize*Math.PI;return lr(a,p+y*(1-Math.cos(_)),Math.pow(d,10))}return a}upVector(i,a,d){return z0(a,d,i,1)}upVectorScale(i){return{metersToTile:mS(yS(tu(i)))}}}function SB(c){const i=c.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(c.name){case"mercator":return new vB(c);case"equirectangular":return new yie(c);case"naturalEarth":return new vie(c);case"equalEarth":return new gie(c);case"winkelTripel":return new xie(c);case"albers":return a?new wB(c):new mie(c);case"lambertConformalConic":return a?new wB(c):new _ie(c);case"globe":return new bie(c)}throw new Error(`Invalid projection name: ${c.name}`)}const wie=Xe.types,Sie=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function GS(c,i,a,d,p,y,_,S,A,C,R,D,j){const H=S?Math.min(Pd,Math.round(S[0])):0,W=S?Math.min(Pd,Math.round(S[1])):0;c.emplaceBack(i,a,Math.round(32*d),Math.round(32*p),y,_,(H<<1)+(A?1:0),W,16*C,16*R,256*D,256*j)}function HS(c,i,a){c.emplaceBack(i,a)}function WS(c,i,a,d,p,y,_){c.emplaceBack(i,a,d,p,y,_)}const qS=(c,i,a,d)=>{for(let p=0;p<i;p++)c.emplaceBack(a[0],a[1],a[2],d[0],d[1],d[2])};function ZS(c,i,a,d,p){c.emplaceBack(i,a,d,p),c.emplaceBack(i,a,d,p),c.emplaceBack(i,a,d,p),c.emplaceBack(i,a,d,p)}function Tie(c){for(const i of c.sections)if(RC(i.text))return!0;return!1}class BI{constructor(i){this.layoutVertexArray=new kg,this.indexArray=new ii,this.programConfigurations=i,this.segments=new ci,this.dynamicLayoutVertexArray=new Jc,this.opacityVertexArray=new b0,this.placedSymbolArray=new pp,this.iconTransitioningVertexArray=new xl,this.globeExtVertexArray=new fd,this.zOffsetVertexArray=new Xu,this.orientationVertexArray=new T0}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(i,a,d,p,y){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ine.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,One.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Sie,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,Dne.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Mne.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||y)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,kne.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,Rne.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Wt(BI,"SymbolBuffers");class $I{constructor(i,a,d){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new d,this.segments=new ci,this.collisionVertexArray=new md,this.collisionVertexArrayExt=new Jc}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Lne.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,jne.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Wt($I,"CollisionBuffers");class XS{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=z([]),this.placementViewportMatrix=z([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.textSizeData=JF(this.zoom,a["text-size"],this.worldview),this.iconSizeData=JF(this.zoom,a["icon-size"],this.worldview);const d=this.layers[0].layout,p=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(_=>ha[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new BI(new oa(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new BI(new oa(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new k0,this.lineVertexArray=new nS,this.symbolInstances=new rS}calculateGlyphDependencies(i,a,d,p,y){for(const _ of i){const S=_.codePointAt(0);if(S===void 0)break;if(a[S]=!0,p&&y&&S<=65535){const A=nx[_];A&&(a[A.charCodeAt(0)]=!0)}}}updateFootprints(i,a){}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!TS(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(i,a,d,p){const y=this.layers[0],_=y.layout,S=this.projection.name==="globe",A=_.get("text-font"),C=_.get("text-field"),R=_.get("icon-image"),[D,j]=_.get("icon-size-scale-range"),H=xe(a.scaleFactor||1,D,j),W=(C.value.kind!=="constant"||C.value.value instanceof hs&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),J=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,te=_.get("symbol-sort-key");if(this.features=[],!W&&!J)return;const ae=a.iconDependencies,de=a.glyphDependencies,he=a.availableImages,me=new Rn(this.zoom,{worldview:this.worldview});for(const{feature:ke,id:Ee,index:Pe,sourceLayerIndex:Ne}of i){const Be=y._featureFilter.needGeometry,ct=st(ke,Be);if(!y._featureFilter.filter(me,ct,d))continue;if(Be||(ct.geometry=De(ke,d,p)),S&&ke.type!==1&&d.z<=5){const wt=ct.geometry,At=.98078528056,at=(St,He)=>Kt(z0(St.x,St.y,d,1),z0(He.x,He.y,d,1))<At;for(let St=0;St<wt.length;St++)wt[St]=tt(wt[St],at)}let Ue,dt;if(W){const wt=y.getValueAndResolveTokens("text-field",ct,d,he),At=hs.factory(wt);Tie(At)&&(this.hasRTLText=!0),(!this.hasRTLText||p0()==="unavailable"||this.hasRTLText&&_l.isParsed())&&(Ue=zne(At,y,ct))}if(J){const wt=y.getValueAndResolveTokens("icon-image",ct,d,he);dt=typeof wt=="string"?Cs.build(wt):wt}if(!Ue&&!dt)continue;const Ct=this.sortFeaturesByKey?te.evaluate(ct,{},d):void 0,mt={id:Ee,text:Ue,icon:dt,index:Pe,sourceLayerIndex:Ne,geometry:ct.geometry,properties:ke.properties,type:wie[ke.type],sortKey:Ct};if(this.features.push(mt),dt){const wt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:At,iconSecondary:at}=fB(dt,this.iconSizeData,wt["icon-size"],d,this.zoom,mt,this.pixelRatio,H,this.worldview),St=At.id.toString();if(ae.has(St)?ae.get(St).push(At):ae.set(St,[At]),at){this.hasAnySecondaryIcon=!0;const He=at.id.toString();ae.has(He)?ae.get(He).push(at):ae.set(He,[at])}}if(Ue){const wt=A.evaluate(ct,{},d).join(","),At=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ha.vertical)>=0;for(const at of Ue.sections)if(at.image){const St=at.image.getPrimary().scaleSelf(this.pixelRatio),He=St.id.toString(),lt=ae.get(He)||[];lt.push(St),ae.set(He,lt)}else{const St=u0(Ue.toString()),He=at.fontStack||wt,lt=de[He]=de[He]||{};this.calculateGlyphDependencies(at.text,lt,At,this.allowVerticalPlacement,St)}}}if(_.get("symbol-placement")==="line"&&(this.features=function(ke){const Ee={},Pe={},Ne=[];let Be=0;function ct(mt){Ne.push(ke[mt]),Be++}function Ue(mt,wt,At){const at=Pe[mt];return delete Pe[mt],Pe[wt]=at,Ne[at].geometry[0].pop(),Ne[at].geometry[0]=Ne[at].geometry[0].concat(At[0]),at}function dt(mt,wt,At){const at=Ee[wt];return delete Ee[wt],Ee[mt]=at,Ne[at].geometry[0].shift(),Ne[at].geometry[0]=At[0].concat(Ne[at].geometry[0]),at}function Ct(mt,wt,At){const at=At?wt[0][wt[0].length-1]:wt[0][0];return`${mt}:${at.x}:${at.y}`}for(let mt=0;mt<ke.length;mt++){const wt=ke[mt],At=wt.geometry,at=wt.text?wt.text.toString():null;if(!at){ct(mt);continue}const St=Ct(at,At),He=Ct(at,At,!0);if(St in Pe&&He in Ee&&Pe[St]!==Ee[He]){const lt=dt(St,He,At),kt=Ue(St,He,Ne[lt].geometry);delete Ee[St],delete Pe[He],Pe[Ct(at,Ne[kt].geometry,!0)]=kt,Ne[lt].geometry=null}else St in Pe?Ue(St,He,At):He in Ee?dt(St,He,At):(ct(mt),Ee[St]=Be-1,Pe[He]=Be-1)}return Ne.filter(mt=>mt.geometry)}(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ke of a.elevationFeatures)this.elevationFeatureIdToIndex.set(ke.id,this.elevationFeatures.length),this.elevationFeatures.push(ke)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ke,Ee)=>ke.sortKey-Ee.sortKey)}update(i,a,d,p,y,_,S){this.text.programConfigurations.updatePaintArrays(i,a,y,d,p,_,S,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,a,y,d,p,_,S,this.worldview)}updateRoadElevation(i){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const d=Se(i),p=1/d;let y=!1,_=!1;for(let S=0;S<this.symbolInstances.length;S++){const A=this.symbolInstances.get(S),C=Le(1,0,0),R=Le(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:j,numIconVertices:H,numVerticalIconVertices:W}=A,J=D>0||j>0,te=H>0,ae=this.elevationFeatures[A.elevationFeatureIndex];if(ae){const de=new ut(A.tileAnchorX,A.tileAnchorY),he=.075+ae.pointElevation(de);A.zOffset!==he&&(a=!0,A.zOffset=he);const me=ae.computeSlopeNormal(de,p),ke=Ka(vo(),Le(0,0,1),me);Ft(C,C,ke),Ft(R,R,ke),C[2]*=d,R[2]*=d,C[0]===1&&C[1]===0&&C[2]===0&&R[0]===0&&R[1]===1&&R[2]===0||(y=y||J,_=_||te)}if(J&&(qS(this.text.orientationVertexArray,D,C,R),qS(this.text.orientationVertexArray,j,C,R)),te){const{placedIconSymbolIndex:de,verticalPlacedIconSymbolIndex:he}=A;de>=0&&qS(this.icon.orientationVertexArray,H,C,R),he>=0&&qS(this.icon.orientationVertexArray,W,C,R)}}y||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(y,_,S)=>{d+=_,d>y.length&&y.resize(d);for(let A=-_;A<0;A++)y.emplace(A+d,S)},a=(y,_,S)=>{p+=_,p>y.length&&y.resize(p);for(let A=-_;A<0;A++)y.emplace(A+p,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,p=0;for(let y=0;y<this.symbolInstances.length;y++){const _=this.symbolInstances.get(y),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:A,numIconVertices:C}=_,R=_.zOffset,D=C>0;if((S>0||A>0)&&(i(this.text.zOffsetVertexArray,S,R),i(this.text.zOffsetVertexArray,A,R)),D){const{placedIconSymbolIndex:j,verticalPlacedIconSymbolIndex:H}=_;j>=0&&a(this.icon.zOffsetVertexArray,C,R),H>=0&&a(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=SB(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const d=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:p,y}of a)this.lineVertexArray.emplaceBack(p,y);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,a,d,p,y,_,S,A,C,R,D,j,H,W,J,te){const ae=i.indexArray,de=i.layoutVertexArray,he=i.globeExtVertexArray,me=i.segments.prepareSegment(4*a.length,de,ae,this.canOverlap?_.sortKey:void 0),ke=this.glyphOffsetArray.length,Ee=me.vertexLength,Pe=this.allowVerticalPlacement&&S===ha.vertical?Math.PI/2:0,Ne=_.text&&_.text.sections;for(let ct=0;ct<a.length;ct++){const{tl:Ue,tr:dt,bl:Ct,br:mt,texPrimary:wt,texSecondary:At,pixelOffsetTL:at,pixelOffsetBR:St,minFontScaleX:He,minFontScaleY:lt,glyphOffset:kt,isSDF:Tt,sectionIndex:tr}=a[ct],Zt=me.vertexLength,xt=kt[1];if(GS(de,C.x,C.y,Ue.x,xt+Ue.y,wt.x,wt.y,d,Tt,at.x,at.y,He,lt),GS(de,C.x,C.y,dt.x,xt+dt.y,wt.x+wt.w,wt.y,d,Tt,St.x,at.y,He,lt),GS(de,C.x,C.y,Ct.x,xt+Ct.y,wt.x,wt.y+wt.h,d,Tt,at.x,St.y,He,lt),GS(de,C.x,C.y,mt.x,xt+mt.y,wt.x+wt.w,wt.y+wt.h,d,Tt,St.x,St.y,He,lt),A){const{x:Et,y:Yt,z:Vt}=A.anchor,[jt,Gt,hr]=A.up;WS(he,Et,Yt,Vt,jt,Gt,hr),WS(he,Et,Yt,Vt,jt,Gt,hr),WS(he,Et,Yt,Vt,jt,Gt,hr),WS(he,Et,Yt,Vt,jt,Gt,hr),ZS(i.dynamicLayoutVertexArray,Et,Yt,Vt,Pe)}else ZS(i.dynamicLayoutVertexArray,C.x,C.y,C.z,Pe);if(te){const Et=At||wt;HS(i.iconTransitioningVertexArray,Et.x,Et.y),HS(i.iconTransitioningVertexArray,Et.x+Et.w,Et.y),HS(i.iconTransitioningVertexArray,Et.x,Et.y+Et.h),HS(i.iconTransitioningVertexArray,Et.x+Et.w,Et.y+Et.h)}ae.emplaceBack(Zt,Zt+1,Zt+2),ae.emplaceBack(Zt+1,Zt+2,Zt+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),ct!==a.length-1&&tr===a[ct+1].sectionIndex||i.programConfigurations.populatePaintArrays(de.length,_,_.index,{},H,W,J,Ne&&Ne[tr],this.worldview)}const Be=A?A.anchor:C;i.placedSymbolArray.emplaceBack(Be.x,Be.y,Be.z,C.x,C.y,ke,this.glyphOffsetArray.length-ke,Ee,R,D,C.segment,d?d[0]:0,d?d[1]:0,p[0],p[1],S,0,0,0,j,0)}_commitLayoutVertex(i,a,d,p,y,_,S){i.emplaceBack(a,d,p,y,_,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(i,a,d,p,y,_,S){const A=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),C=A.vertexLength,R=S.tileAnchorX,D=S.tileAnchorY;for(let H=0;H<4;H++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,a,i.padding,S.zOffset),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,R,D,new ut(i.x1,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,R,D,new ut(i.x2,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,R,D,new ut(i.x2,i.y2)),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,R,D,new ut(i.x1,i.y2)),A.vertexLength+=4;const j=d.indexArray;j.emplaceBack(C,C+1),j.emplaceBack(C+1,C+2),j.emplaceBack(C+2,C+3),j.emplaceBack(C+3,C),A.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,d,p,y,_){for(let S=p;S<y;S++){const A=d.get(S),C=this.getSymbolInstanceTextSize(i,_,a,S);this._addCollisionDebugVertices(A,C,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(i,a,d,p,y,_){for(let S=p;S<y;S++){const A=d.get(S),C=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._addCollisionDebugVertices(A,C,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}generateCollisionDebugBuffers(i,a,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $I(Rg,NF.members,xl),this.iconCollisionBox=new $I(Rg,NF.members,xl);const p=ox(this.iconSizeData,i),y=ox(this.textSizeData,i,d);for(let _=0;_<this.symbolInstances.length;_++){const S=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(y,i,a,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(y,i,a,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(p,i,a,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(p,i,a,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(i,a,d,p){const y=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:p),_=RI(this.textSizeData,i,y)/Eo;return this.tilePixelRatio*_}getSymbolInstanceIconSize(i,a,d){const p=this.icon.placedSymbolArray.get(d),y=RI(this.iconSizeData,i,p);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(i,a,d,p){i.emplaceBack(a,-d,-d,p),i.emplaceBack(a,d,-d,p),i.emplaceBack(a,d,d,p),i.emplaceBack(a,-d,d,p)}_updateTextDebugCollisionBoxes(i,a,d,p,y,_,S){for(let A=p;A<y;A++){const C=d.get(A),R=this.getSymbolInstanceTextSize(i,_,a,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,C.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(i,a,d,p,y,_,S){for(let A=p;A<y;A++){const C=d.get(A),R=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,C.padding,_.zOffset)}}updateCollisionDebugBuffers(i,a,d,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=ox(this.iconSizeData,i,p),_=ox(this.textSizeData,i,d);for(let S=0;S<this.symbolInstances.length;S++){const A=this.symbolInstances.get(S);this._updateTextDebugCollisionBoxes(_,i,a,A.textBoxStartIndex,A.textBoxEndIndex,A,d),this._updateTextDebugCollisionBoxes(_,i,a,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,d),this._updateIconDebugCollisionBoxes(y,i,a,A.iconBoxStartIndex,A.iconBoxEndIndex,A,p),this._updateIconDebugCollisionBoxes(y,i,a,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,d,p,y,_,S,A,C){const R={};if(a<d){const{x1:D,y1:j,x2:H,y2:W,padding:J,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:me,featureIndex:ke}=i.get(a);R.textBox={x1:D,y1:j,x2:H,y2:W,padding:J,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:me},R.textFeatureIndex=ke}if(p<y){const{x1:D,y1:j,x2:H,y2:W,padding:J,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:me,featureIndex:ke}=i.get(p);R.verticalTextBox={x1:D,y1:j,x2:H,y2:W,padding:J,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:me},R.verticalTextFeatureIndex=ke}if(_<S){const{x1:D,y1:j,x2:H,y2:W,padding:J,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:me,featureIndex:ke}=i.get(_);R.iconBox={x1:D,y1:j,x2:H,y2:W,padding:J,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:me},R.iconFeatureIndex=ke}if(A<C){const{x1:D,y1:j,x2:H,y2:W,padding:J,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:me,featureIndex:ke}=i.get(A);R.verticalIconBox={x1:D,y1:j,x2:H,y2:W,padding:J,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:me},R.verticalIconFeatureIndex=ke}return R}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const d=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,a){const d=i.placedSymbolArray.get(a),p=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<p;y+=4)i.indexArray.emplaceBack(y,y+1,y+2),i.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(i),d=Math.cos(i),p=[],y=[],_=[];for(let S=0;S<this.symbolInstances.length;++S){_.push(S);const A=this.symbolInstances.get(S);p.push(0|Math.round(a*A.tileAnchorX+d*A.tileAnchorY)),y.push(A.featureIndex)}return _.sort((S,A)=>p[S]-p[A]||y[A]-y[S]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,a){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===a?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const d=this.symbolInstances.get(a);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:C}=d;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),_>=0&&_!==y&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let TB,EB,VI;Wt(XS,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),XS.addDynamicAttributes=ZS;class AB{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Hh,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wt(AB,"FormatSectionOverride",{omit:["defaultValue"]});const UI=()=>VI||(VI={layout:TB||(TB=new xi({"symbol-placement":new Mt(Ve.layout_symbol["symbol-placement"]),"symbol-spacing":new Mt(Ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mt(Ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bt(Ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mt(Ve.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Mt(Ve.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Mt(Ve.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Mt(Ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mt(Ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mt(Ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mt(Ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bt(Ve.layout_symbol["icon-size"]),"icon-size-scale-range":new Mt(Ve.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Bt(Ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bt(Ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bt(Ve.layout_symbol["icon-image"]),"icon-rotate":new Bt(Ve.layout_symbol["icon-rotate"]),"icon-padding":new Mt(Ve.layout_symbol["icon-padding"]),"icon-keep-upright":new Mt(Ve.layout_symbol["icon-keep-upright"]),"icon-offset":new Bt(Ve.layout_symbol["icon-offset"]),"icon-anchor":new Bt(Ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mt(Ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mt(Ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mt(Ve.layout_symbol["text-rotation-alignment"]),"text-field":new Bt(Ve.layout_symbol["text-field"]),"text-font":new Bt(Ve.layout_symbol["text-font"]),"text-size":new Bt(Ve.layout_symbol["text-size"]),"text-size-scale-range":new Mt(Ve.layout_symbol["text-size-scale-range"]),"text-max-width":new Bt(Ve.layout_symbol["text-max-width"]),"text-line-height":new Bt(Ve.layout_symbol["text-line-height"]),"text-letter-spacing":new Bt(Ve.layout_symbol["text-letter-spacing"]),"text-justify":new Bt(Ve.layout_symbol["text-justify"]),"text-radial-offset":new Bt(Ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mt(Ve.layout_symbol["text-variable-anchor"]),"text-anchor":new Bt(Ve.layout_symbol["text-anchor"]),"text-max-angle":new Mt(Ve.layout_symbol["text-max-angle"]),"text-writing-mode":new Mt(Ve.layout_symbol["text-writing-mode"]),"text-rotate":new Bt(Ve.layout_symbol["text-rotate"]),"text-padding":new Mt(Ve.layout_symbol["text-padding"]),"text-keep-upright":new Mt(Ve.layout_symbol["text-keep-upright"]),"text-transform":new Bt(Ve.layout_symbol["text-transform"]),"text-offset":new Bt(Ve.layout_symbol["text-offset"]),"text-allow-overlap":new Mt(Ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mt(Ve.layout_symbol["text-ignore-placement"]),"text-optional":new Mt(Ve.layout_symbol["text-optional"]),visibility:new Mt(Ve.layout_symbol.visibility)})),paint:EB||(EB=new xi({"icon-opacity":new Bt(Ve.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Bt(Ve.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Bt(Ve.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Bt(Ve.paint_symbol["text-emissive-strength"]),"icon-color":new Bt(Ve.paint_symbol["icon-color"]),"icon-halo-color":new Bt(Ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bt(Ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bt(Ve.paint_symbol["icon-halo-blur"]),"icon-translate":new Mt(Ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mt(Ve.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Mt(Ve.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Bt(Ve.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Bt(Ve.paint_symbol["text-occlusion-opacity"]),"text-color":new Bt(Ve.paint_symbol["text-color"],{runtimeType:Fs,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Bt(Ve.paint_symbol["text-halo-color"]),"text-halo-width":new Bt(Ve.paint_symbol["text-halo-width"]),"text-halo-blur":new Bt(Ve.paint_symbol["text-halo-blur"]),"text-translate":new Mt(Ve.paint_symbol["text-translate"]),"text-translate-anchor":new Mt(Ve.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Mt(Ve.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Mt(Ve.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Mt(Ve.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Mt(Ve.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Bt(Ve.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},VI);class KS extends Yo{constructor(i,a,d,p){super(i,UI(),a,d,p),this._colorAdjustmentMatrix=z([]),this.hasInitialOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,a){super.recalculate(i,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const p=[];for(const y of d)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,a,d,p){return this._saturation===i&&this._contrast===a&&this._brightnessMin===d&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(y,_,S,A){y=Zo(y),_=As(_);const C=B(),R=y/3,D=1-2*R,j=[D,R,R,0,R,D,R,0,R,R,D,0,0,0,0,1],H=.5-.5*_,W=A-S;return U(C,[W,0,0,0,0,W,0,0,0,0,W,0,S,S,S,1],[_,0,0,0,0,_,0,0,0,0,_,0,H,H,H,1]),U(C,C,j),C}(i,a,d,p),this._saturation=i,this._contrast=a,this._brightnessMin=d,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,a,d,p){const y=this.layout.get(i).evaluate(a,{},d,p),_=this._unevaluatedLayout._values[i];return _.isDataDriven()||s0(_.value)||!y?y:function(S,A){return A.replace(/{([^{}]+)}/g,(C,R)=>R in S?String(S[R]):"")}(a.properties,y)}createBucket(i){return new XS(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of UI().paint.overridableProperties){if(!KS.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),d=new AB(a),p=new o0(d,a.property.specification,this.scope,this.options);let y=null;y=a.value.kind==="constant"||a.value.kind==="source"?new xg("source",p):new qc("composite",p,a.value.zoomStops,a.value.interpolationType),this.paint._values[i]=new Zu(a.property,y,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,d){return!(!this.layout||a.isDataDriven()||d.isDataDriven())&&KS.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const d=i.get("text-field"),p=UI().paint.properties[a];let y=!1;const _=S=>{for(const A of S)if(p.overrides&&p.overrides.hasOverride(A))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof hs)_(d.value.value.sections);else if(d.value.kind==="source"){const S=C=>{y||(C instanceof mr&&Ht(C.value)===Hf?_(C.value.sections):C instanceof qh?_(C.sections):C.eachChild(S))},A=d.value;A._styleExpression&&S(A._styleExpression.expression)}return y}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,a,d){return{config:new ps(this,{zoom:a,lut:d}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let PB,CB,IB,MB;var GI=Qr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function YS(c,i,a,d,p,y,_,S){const A=[c,i,1,a,d,1,p,y,1],C=[_,S,1],R=O([],A),[D,j,H]=xr(C,C,R);return L(A,A,[D,0,0,0,j,0,0,0,H])}function OB(c,i,a,d,p,y,_,S){const A=function(C,R,D,j,H,W,J,te){const ae=YS(0,0,1,0,1,1,0,1),de=YS(C,R,D,j,H,W,J,te);return L(de,de,O([],ae))}(c,i,a,d,p,y,_,S);return[A[2]/A[8]/Lt,A[5]/A[8]/Lt]}function JS(c){return[c[0],Math.min(Math.max(c[1],-be),be)]}class kB extends Nu{constructor(i,a,d,p){super(),this.id=i,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=a,this._dirty=!1}load(i,a){if(this._loaded=a||!1,this.fire(new Xl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=$f(this.map._requestManager.transformRequest(this.url,zf.Image),(d,p)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new ea(d)):p&&(this.image=p instanceof HTMLImageElement?Ja.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ex(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Xl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ex||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=i[0][1],d=i[0][1];for(const y of i)y[1]>d&&(d=y[1]),y[1]<a&&(a=y[1]);const p=(d+a)/2;if(p>be?this.onNorthPole=!0:p<-be&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const y=i.map(Te.fromLngLat);this.tileID=function(_){let S=1/0,A=1/0,C=-1/0,R=-1/0;for(const J of _)S=Math.min(S,J.x),A=Math.min(A,J.y),C=Math.max(C,J.x),R=Math.max(R,J.y);const D=Math.max(C-S,R-A),j=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),H=Math.pow(2,j);let W=Math.floor((S+C)/2*H);return W>1&&(W-=1),new la(j,W,Math.floor((A+R)/2*H))}(y),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Xl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof ex||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const ae in this.tiles){const de=this.tiles[ae];de.state!=="loaded"&&(de.state="loaded",de.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=cx(new la(0,0,0),this.map.transform.projection),d=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ae){const de=ae[1].x-ae[0].x,he=ae[1].y-ae[0].y,me=ae[2].x-ae[1].x,ke=ae[2].y-ae[1].y,Ee=ae[3].x-ae[2].x,Pe=ae[3].y-ae[2].y,Ne=ae[0].x-ae[3].x,Be=ae[0].y-ae[3].y,ct=de*ke-me*he,Ue=me*Pe-Ee*ke,dt=Ee*Be-Ne*Pe,Ct=Ne*he-de*Be;return ct>0&&Ue>0&&dt>0&&Ct>0||ct<0&&Ue<0&&dt<0&&Ct<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=cx(this.tileID,this.map.transform.projection),[y,_,S,A]=this.coordinates.map(ae=>{const de=p.projection.project(ae[0],ae[1]);return _B(p,de)._round()});this.perspectiveTransform=OB(y.x,y.y,_.x,_.y,S.x,S.y,A.x,A.y);const C=this._boundsArray=new hd;C.emplaceBack(y.x,y.y,0,0),C.emplaceBack(_.x,_.y,Lt,0),C.emplaceBack(A.x,A.y,0,Lt),C.emplaceBack(S.x,S.y,Lt,Lt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(C,GI.members),this.boundsSegments=ci.simpleSegment(0,0,4,2);const R=[],D=[JS((j=this.coordinates)[0]),JS(j[1]),JS(j[2]),JS(j[3])];var j;const[H,W,J,te]=function(ae){let de=ae[0][0],he=de,me=ae[0][1],ke=me;for(let Ee=1;Ee<ae.length;Ee++)ae[Ee][0]<de?de=ae[Ee][0]:ae[Ee][0]>he&&(he=ae[Ee][0]),ae[Ee][1]<me?me=ae[Ee][1]:ae[Ee][1]>ke&&(ke=ae[Ee][1]);return[de,me,he-de,ke-me]}(D);{const ae=new hd,[de,he,me,ke]=function(at){let St=at[0].x,He=St,lt=at[0].y,kt=lt;for(let Tt=1;Tt<at.length;Tt++)at[Tt].x<St?St=at[Tt].x:at[Tt].x>He&&(He=at[Tt].x),at[Tt].y<lt?lt=at[Tt].y:at[Tt].y>kt&&(kt=at[Tt].y);return[St,lt,He-St,kt-lt]}(d),Ee=at=>[(at.x-de)/me,(at.y-he)/ke],[Pe,Ne,Be,ct]=d.map(Ee),Ue=function(at,St,He,lt,kt,Tt,tr,Zt){const xt=YS(0,0,1,0,1,1,0,1);return L(xt,xt,O([],YS(at,St,He,lt,kt,Tt,tr,Zt)))}(Pe[0],Pe[1],Ne[0],Ne[1],Be[0],Be[1],ct[0],ct[1]);this.elevatedGlobePerspectiveTransform=OB(Pe[0],Pe[1],Ne[0],Ne[1],Be[0],Be[1],ct[0],ct[1]);const dt=(at,St)=>{R.push(at.lng);const He=Math.round((at.lng-H)/J*Lt),lt=Math.round((at.lat-W)/te*Lt),kt=Ee(St),Tt=xr([],[kt[0],kt[1],1],Ue),tr=Math.round(Tt[0]/Tt[2]*Lt),Zt=Math.round(Tt[1]/Tt[2]*Lt);ae.emplaceBack(He,lt,tr,Zt)},Ct=d[3].x-d[0].x,mt=d[3].y-d[0].y,wt=d[2].x-d[1].x,At=d[2].y-d[1].y;for(let at=0;at<65;at++){const St=at/64,He=[d[0].x+St*Ct,d[0].y+St*mt],lt=[d[1].x+St*wt,d[1].y+St*At],kt=lt[0]-He[0],Tt=lt[1]-He[1];for(let tr=0;tr<65;tr++){const Zt=tr/64,xt={x:He[0]+kt*Zt,y:He[1]+Tt*Zt};dt(a.projection.unproject(xt.x,xt.y),xt)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(ae,GI.members)}{this.maxLongitudeTriangleSize=0;let ae=[],de=new ii;const he=(me,ke,Ee)=>{de.emplaceBack(me,ke,Ee);const Pe=R[me],Ne=R[ke],Be=R[Ee],ct=Math.min(Math.min(Pe,Ne),Be),Ue=Math.max(Math.max(Pe,Ne),Be)-ct;Ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ue),ae.push(ct+Ue/2)};for(let me=0;me<64;me++)for(let ke=0;ke<64;ke++){const Ee=65*me+ke,Pe=Ee+1,Ne=Ee+65,Be=Ne+1;he(Ee,Ne,Pe),he(Pe,Ne,Be)}[ae,de]=function(me,ke){const Ee=Array.from({length:me.length},(Be,ct)=>ct);Ee.sort((Be,ct)=>me[Be]-me[ct]);const Pe=[],Ne=new ii;for(let Be=0;Be<Ee.length;Be++){const ct=Ee[Be];Pe.push(me[ct]);const Ue=3*ct,dt=Ue+1;Ne.emplaceBack(ke.uint16[Ue],ke.uint16[dt],ke.uint16[dt+1])}return[Pe,Ne]}(ae,de),this.elevatedGlobeTrianglesCenterLongitudes=ae,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(de)}this.elevatedGlobeSegments=ci.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,J/Lt,0,te/Lt,0,0,W,H,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const a=this.map.painter.context,d=a.gl;!this._dirty||this.texture instanceof ex||(this.texture?this.texture.update(this.image):(this.texture=new vI(a,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(a)}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let p=(y=i+180)+360*Math.round((d[0]-y)/360);var y;const _=new ci,S=(D,j)=>{_.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:a.segments[0].vertexLength,primitiveLength:j,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-p)<=A){const D=bo(d,0,d.length,p+A);return D===d.length||S(D,li(d,D+1,d.length,p+360-A)-D),_}p<d[0]&&(p+=360);const C=li(d,0,d.length,p-A);if(C===d.length)return S(0,d.length),_;S(0,C-0);const R=bo(d,C+1,d.length,p+A);return R!==d.length&&S(R,d.length-R),_}}const Eie=(Math.pow(256,2)-1)/16907520;class RB extends Yo{constructor(i,a,d,p){super(i,{layout:IB||(IB=new xi({visibility:new Mt(Ve.layout_raster.visibility)})),paint:MB||(MB=new xi({"raster-opacity":new Mt(Ve.paint_raster["raster-opacity"]),"raster-color":new sd(Ve.paint_raster["raster-color"]),"raster-color-mix":new Mt(Ve.paint_raster["raster-color-mix"]),"raster-color-range":new Mt(Ve.paint_raster["raster-color-range"]),"raster-hue-rotate":new Mt(Ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mt(Ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mt(Ve.paint_raster["raster-brightness-max"]),"raster-saturation":new Mt(Ve.paint_raster["raster-saturation"]),"raster-contrast":new Mt(Ve.paint_raster["raster-contrast"]),"raster-resampling":new Mt(Ve.paint_raster["raster-resampling"]),"raster-fade-duration":new Mt(Ve.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Mt(Ve.paint_raster["raster-emissive-strength"]),"raster-array-band":new Mt(Ve.paint_raster["raster-array-band"]),"raster-elevation":new Mt(Ve.paint_raster["raster-elevation"]),"raster-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},a,d,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof kB&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[d,p]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(p)||d===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=F0({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,p])}}let DB,LB,jB,NB,zB;class FB extends Yo{constructor(i,a,d,p){super(i,{layout:DB||(DB=new xi({visibility:new Mt(Ve["layout_raster-particle"].visibility)})),paint:LB||(LB=new xi({"raster-particle-array-band":new Mt(Ve["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Mt(Ve["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new sd(Ve["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Mt(Ve["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Mt(Ve["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Mt(Ve["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Mt(Ve["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Mt(Ve["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},a,d,p),this._updateColorRamp(),this.lastInvalidatedAt=Ja.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=F0({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ja.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Aie extends Yo{constructor(i,a){super(i,{},a,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function HI(c,i,a){const d=[0,0,1],p=fo([]);return Za(p,p,a?-Br(c)+Math.PI:Br(c)),Ta(p,p,-Br(i)),Ft(d,d,p),Er(d,d)}const BB={None:0,Model:1,Symbol:2,FillExtrusion:4};class QS{constructor(i,a,d,p){this.message=(i?`${i}: `:"")+d,p&&(this.identifier=p),a!=null&&a.__line__&&(this.line=a.__line__)}}function WI(c,i){const a=c.indexOf("://")===-1;try{return new URL(c,a&&i?"http://example.com":void 0),!0}catch{return!1}}class $B{constructor(i,a){this.feature=i,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class VB{constructor(){this.instancedDataArray=new Dg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class qI{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs}updateFootprints(i,a){}populate(i,a,d,p){this.tileToMeter=Se(d);const y=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:S,index:A,sourceLayerIndex:C}of i){const R=S??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),D=st(_,y);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom,{worldview:this.worldview}),D,d))continue;const j={id:R,sourceLayerIndex:C,index:A,geometry:y?D.geometry:De(_,d,p),properties:_.properties,type:_.type,patterns:{}},H=this.addFeature(j,j.geometry,D);H&&a.featureIndex.insert(_,j.geometry,A,C,this.index,this.instancesPerModel[H].instancedDataArray.length,Lt/32)}this.lookup=null}update(i,a,d,p){for(const y in this.instancesPerModel){const _=this.instancesPerModel[y];for(const S in i)_.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(_.features[_.idToFeaturesIndex[S]],i[S],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];for(const p of d.features){const y=this.layers[0],_=p.feature,S=this.canonical,A=y.paint.get("model-rotation").evaluate(_,{},S),C=y.paint.get("model-scale").evaluate(_,{},S),R=y.paint.get("model-translation").evaluate(_,{},S);Hr(p.rotation,A)&&Hr(p.scale,C)&&Hr(p.translation,R)||(this.evaluate(p,p.featureStates,d,!0),i=!0)}}return i}updateReplacement(i,a,d,p){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const y=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(TS(this.activeReplacements,y))return!1;this.activeReplacements=y;let _=!1;for(const S in this.instancesPerModel){const A=this.instancesPerModel[S],C=A.instancedDataArray;for(const R of A.features){const D=R.instancedDataOffset,j=R.instancedDataCount;for(let H=0;H<j;H++){const W=16*(H+D);let J=C.float32[W+0];const te=J>Lt;J=te?J-Lt:J;const ae=Math.floor(J),de=C.float32[W+1];let he=!1;for(const me of this.activeReplacements)if(!Iz(me,d,BB.Model,p)&&!(me.min.x>ae||ae>me.max.x||me.min.y>de||de>me.max.y)&&(he=aI(Rz(ae,de,i.canonical,me.footprintTileId.canonical),me.footprint),he))break;C.float32[W]=he?J+Lt:J,_=_||he!==te}}}return _}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=i.createVertexBuffer(d.instancedDataArray,one.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)i.removeModel(a,"",!0)}addFeature(i,a,d){const p=this.layers[0],y=p.layout.get("model-id").evaluate(d,{},this.canonical);if(!y)return qr(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),y;(WI(y,!1)||this.styleDefinedModelURLs[y]!==void 0)&&(this.modelUris.includes(y)||this.modelUris.push(y)),this.instancesPerModel[y]||(this.instancesPerModel[y]=new VB);const _=this.instancesPerModel[y],S=_.instancedDataArray,A=new $B(d,S.length);for(const C of a)for(const R of C){if(R.x<0||R.x>=Lt||R.y<0||R.y>=Lt)continue;const D=(this.lookupDim-1)/Lt,j=this.lookupDim*(R.y*D|0)+R.x*D|0;if(this.lookup){if(this.lookup[j]!==0)continue;this.lookup[j]=1}this.instanceCount++;const H=S.length;S.resize(H+1),_.instancesEvaluatedElevation.push(0),S.float32[16*H]=R.x,S.float32[16*H+1]=R.y}return A.instancedDataCount=_.instancedDataArray.length-A.instancedDataOffset,A.instancedDataCount>0&&(i.id&&(_.idToFeaturesIndex[i.id]=_.features.length),_.features.push(A),this.evaluate(A,{},_,!1)),y}getModelUris(){return this.modelUris}evaluate(i,a,d,p){const y=this.layers[0],_=i.feature,S=this.canonical,A=i.rotation=y.paint.get("model-rotation").evaluate(_,a,S),C=i.scale=y.paint.get("model-scale").evaluate(_,a,S),R=i.translation=y.paint.get("model-translation").evaluate(_,a,S),D=y.paint.get("model-color").evaluate(_,a,S);D.a=y.paint.get("model-color-mix-intensity").evaluate(_,a,S);const j=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),pF(j,A,C);const H=Math.round(100*D.a)+D.b/1.05;for(let W=0;W<i.instancedDataCount;++W){const J=i.instancedDataOffset+W,te=16*J,ae=d.instancedDataArray.float32;let de=0;p&&(de=ae[te+6]-d.instancesEvaluatedElevation[J]);const he=0|ae[te+1];ae[te]=(0|ae[te])+D.r/1.05,ae[te+1]=he+D.g/1.05,ae[te+2]=H,ae[te+3]=1/(S.z>10?this.tileToMeter:Se(S,he)),ae[te+4]=R[0],ae[te+5]=R[1],ae[te+6]=R[2]+de,ae[te+7]=j[0],ae[te+8]=j[1],ae[te+9]=j[2],ae[te+10]=j[4],ae[te+11]=j[5],ae[te+12]=j[6],ae[te+13]=j[8],ae[te+14]=j[9],ae[te+15]=j[10],d.instancesEvaluatedElevation[J]=R[2]}}}let UB,GB;Wt(qI,"ModelBucket",{omit:["layers"]}),Wt(VB,"PerModelAttributes"),Wt($B,"ModelFeature");class Jg{constructor(i,a,d){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=d}static create(i,a,d){const p=d||i.findDEMTileFor(a);if(!p||!p.dem)return;const y=p.dem,_=p.tileID,S=1<<a.canonical.z-_.canonical.z;return new Jg(p,y.dim/Lt/S,[(a.canonical.x/S-_.canonical.x)*y.dim,(a.canonical.y/S-_.canonical.y)*y.dim])}tileCoordToPixel(i,a){const d=a*this._scale+this._offset[1];return new ut(Math.floor(i*this._scale+this._offset[0]),Math.floor(d))}getElevationAt(i,a,d,p){const y=i*this._scale+this._offset[0],_=a*this._scale+this._offset[1],S=Math.floor(y),A=Math.floor(_),C=this._dem;return p=!!p,d?lr(lr(C.get(S,A,p),C.get(S,A+1,p),_-A),lr(C.get(S+1,A,p),C.get(S+1,A+1,p),_-A),y-S):C.get(S,A,p)}getElevationAtPixel(i,a,d){return this._dem.get(i,a,!!d)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*ie(1,i)*this._dem.stride}}const ZI=new Float32Array(262144),Pp=new Uint8Array(262144);function HB(c){let i=0;if(c.meshes)for(const a of c.meshes)i=Math.max(i,a.aabb.max[2]);if(c.children)for(const a of c.children)i=Math.max(i,HB(a));return i}function WB(c,i,a){if(c.meshes)for(const d of c.meshes){if(d.aabb.min[0]===1/0)continue;const p=Fr.applyTransform(d.aabb,c.matrix);a.insert(i,p.min[0],p.min[1],p.max[0],p.max[1])}if(c.children)for(const d of c.children)WB(d,i,a)}const qB=["","wall","door","roof","window","lamp","logo"];class ZB{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:HB(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Fr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const a=new Fr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==i&&(d.transformedAabb=Fr.applyTransformFast(d.aabb,this.node.matrix),a.encapsulate(d.transformedAabb)),i++;this.aabb=a}return this.aabb}}class eT{constructor(i,a,d,p,y,_,S,A){this.id=d,this.layers=i,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=Wg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=Wg.HasMapboxMeshFeatures),y&&(this.modelTraits|=Wg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=A,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const C of a)this.nodesInfo.push(new ZB(C)),WB(C,S.featureIndexArray.length,S.grid),S.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,S.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(i,a){for(const d of this.getNodesInfo()){const p=d.node;p.footprint&&a.push({footprint:p.footprint,id:i})}}update(i){const a=Object.keys(i).length!==0;if(a&&!this.stateDependentLayers.length)return;const d=a?this.stateDependentLayers:this.layers;if(!Zn(i,this.states))for(const p of d)this.evaluate(p,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const d of a){const p=d.node;this.uploaded?this.updatePbrBuffer(p):wI(p,i,!0)}for(const d of a)DS(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let a=!1;if(!i.meshes)return a;for(const d of i.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),a=!0);return a}needsReEvaluation(i,a,d){const p=i.transform.projectionOptions,y=i.style.getBrightness(),_=this.brightness!==y;if(!this.uploaded||this.dirty||p.name!==this.projection.name||px(d.paint.get("model-color").value,_)||px(d.paint.get("model-color-mix-intensity").value,_)||px(d.paint.get("model-roughness").value,_)||px(d.paint.get("model-emissive-strength").value,_)||px(d.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=p,this.brightness=y;const S=this.getNodesInfo();for(const A of S)A.state=null;return!0}return!1}evaluateTransform(i,a){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const d=this.getNodesInfo(),p=this.id.canonical;for(const y of d){const _=y.feature;y.evaluatedTranslation=a.paint.get("model-translation").evaluate(_,{},p),y.evaluatedScale=a.paint.get("model-scale").evaluate(_,{},p)}}evaluate(i,a){const d=this.getNodesInfo();for(const p of d){if(!p.node.meshes)continue;const y=p.feature,_=a&&a[y.id];if(Zn(_,p.state))continue;p.state=structuredClone(_);const S=p.node.meshes&&p.node.meshes[0].featureData,A=p.evaluatedColor[2],C=p.evaluatedRMEA[2],R=this.id.canonical;if(p.hasTranslucentParts=!1,S){for(let D=0;D<qB.length;D++){const j=qB[D];j.length&&(y.properties.part=j);const H=i.paint.get("model-color").evaluate(y,_,R).toPremultipliedRenderColor(null),W=i.paint.get("model-color-mix-intensity").evaluate(y,_,R);p.evaluatedColor[D]=[H.r,H.g,H.b,W],p.evaluatedRMEA[D][0]=i.paint.get("model-roughness").evaluate(y,_,R),p.evaluatedRMEA[D][2]=i.paint.get("model-emissive-strength").evaluate(y,_,R),p.evaluatedRMEA[D][3]=H.a,p.emissionHeightBasedParams[D]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(y,_,R),!p.hasTranslucentParts&&H.a<1&&(p.hasTranslucentParts=!0)}delete y.properties.part,Cie(p,A!==p.evaluatedColor[2]||C!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(y,_,R);p.evaluatedTranslation=i.paint.get("model-translation").evaluate(y,_,R),p.evaluatedScale=i.paint.get("model-scale").evaluate(y,_,R),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,a,d,p){const y=i.findDEMTileFor(d);if(y&&(y.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(y.dem&&y.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=y.tileID.overscaledZ;const _=Jg.create(i,d,y);if(!_)return;this.modelTraits&Wg.HasMapboxMeshFeatures&&this.updateDEM(i,_,d,p);for(const S of this.getNodesInfo()){const A=S.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const C=A.footprint.vertices;let R=_.getElevationAt(C[0].x,C[0].y,!0,!0);for(let D=1;D<C.length;D++)R=Math.min(R,_.getElevationAt(C[D].x,C[D].y,!0,!0));A.elevation=R}}this.terrainTile=y.tileID.canonical,this.terrainExaggeration=a}}updateDEM(i,a,d,p){let y=a._dem._modifiedForSources[p];if(y===void 0&&(a._dem._modifiedForSources[p]=[],y=a._dem._modifiedForSources[p]),y.includes(d.canonical))return;const _=a._dem.dim;y.push(d.canonical);let S=!1;for(const A of this.getNodesInfo()){const C=A.node;if(!C.footprint||!C.footprint.grid)continue;const R=C.footprint.grid,D=a.tileCoordToPixel(R.min.x,R.min.y),j=a.tileCoordToPixel(R.max.x,R.max.y),H=Math.min(Math.min(_-j.y,D.x),Math.min(D.y,_-j.x));if(H<0)continue;const W=xe(H,2,5);let J=Math.max(0,D.x-W),te=Math.max(0,D.y-W),ae=Math.min(j.x+W,_-1),de=Math.min(j.y+W,_-1);for(let Ee=te;Ee<=de;++Ee)for(let Pe=J;Pe<=ae;++Pe)Pp[Ee*_+Pe]=255;let he=0,me=0;for(let Ee=0;Ee<R.cellsY;++Ee)for(let Pe=0;Pe<R.cellsX;++Pe){if(!R.cells[Ee*R.cellsX+Pe])continue;const Ne=a.tileCoordToPixel(R.min.x+Pe/R.xScale,R.min.y+Ee/R.yScale),Be=a.tileCoordToPixel(R.min.x+(Pe+1)/R.xScale,R.min.y+(Ee+1)/R.yScale);for(let ct=Ne.y;ct<=Math.min(Be.y+1,_-1);++ct)for(let Ue=Ne.x;Ue<=Math.min(Be.x+1,_-1);++Ue)Pp[ct*_+Ue]===255&&(Pp[ct*_+Ue]=0,he+=a.getElevationAtPixel(Ue,ct),me++)}const ke=he/me;J=Math.max(1,D.x-W),te=Math.max(1,D.y-W),ae=Math.min(j.x+W,_-2),de=Math.min(j.y+W,_-2),S=!0;for(let Ee=te;Ee<=de;++Ee)for(let Pe=J;Pe<=ae;++Pe)Pp[Ee*_+Pe]===0&&(ZI[Ee*_+Pe]=a._dem.set(Pe,Ee,ke));for(let Ee=1;Ee<W;++Ee){J=Math.max(1,D.x-Ee),te=Math.max(1,D.y-Ee),ae=Math.min(j.x+Ee,_-2),de=Math.min(j.y+Ee,_-2);for(let Pe=te;Pe<=de;++Pe)for(let Ne=J;Ne<=ae;++Ne){const Be=Pe*_+Ne;if(Pp[Be]===255){let ct=0,Ue=0,dt=-1,Ct=-1;for(let mt=-1;mt<=1;++mt)for(let wt=-1;wt<=1;++wt){const At=(Pe+mt)*_+Ne+wt;if(Pp[At]>=Ee)continue;const at=ZI[At],St=Math.abs(at);St>Ue&&(ct=at,Ue=St,dt=wt,Ct=mt)}if(Ue>.1){const mt=1-(Ee+.5*Math.abs(dt*Ct))/W;let wt=a._dem.get(Ne,Pe)+ct*mt;const At=a._dem.get(Ne+dt,Pe+Ct),at=a._dem.get(Ne-dt,Pe-Ct,!0);(wt-At)*(wt-at)>0&&(wt=(At+at)/2),ZI[Be]=a._dem.set(Ne,Pe,wt),Pp[Be]=Ee}}}}}S&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=Ja.now())}setFilter(i){this.filter=i?ad(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new Rn(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const a of i)DS(a.node),SI(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(i.toUnwrapped());for(const p of this.getNodesInfo()){const y=p.node.footprint;p.hiddenByReplacement=!!y&&!d.find(_=>_.footprint===y)}}getHeightAtTileCoord(i,a){const d=[],p=[0,0,0],y=z([]);for(const _ of this.getNodesInfo()){const S=_.node.meshes[0],A=S.transformedAabb;if(i<A.min[0]||a<A.min[1]||i>A.max[0]||a>A.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};$(y,_.node.matrix),p[0]=i,p[1]=a,nr(p,p,y);const C=(p[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*Tp|0,R=Math.min(63,(p[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*Tp|0)*Tp+Math.min(63,C),D=S.heightmap[R];if(!(D<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:D,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new ut(i,a),new ut(i,a),d),d.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function px(c,i){return c instanceof xg&&!c.isLightConstant&&i}function Pie(c,i,a,d,p,y,_,S){let A=(61440&i|(61440&i)>>4)>>8,C=(3840&i|(3840&i)>>4)>>4,R=240&i|(240&i)>>4;a[3]>0&&(A=lr(A,255*a[0],a[3]),C=lr(C,255*a[1],a[3]),R=lr(R,255*a[2],a[3]));const D=A<<8|C,j=R<<8|Math.floor(255*d[3]),H=function(Ee){const Pe=xe(Ee,0,2);return Math.min(Math.round(.5*Pe*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],W=xe(p[0],0,1),J=xe(p[1],0,1),te=xe(p[2],0,1),ae=xe(p[3],0,1);let de,he,me,ke;if(W!==J&&_!==y&&J!==W){const Ee=_-y;he=1/(Ee*(J-W)),me=-(y+Ee*W)/(Ee*(J-W));const Pe=xe(p[4],-1,1);ke=Math.pow(10,Pe),de=255*te<<8|255*ae}else de=65535,he=0,me=1,ke=1;if(c.emplaceBack(D,j,H,de,he,me,ke),S){const Ee=S.length;S.clear();for(let Pe=0;Pe<Ee;Pe++)S.emplaceBack(D,j,H,de,he,me,ke)}}function Cie(c,i,a){const d=c.node;let p=0;const y=a&Wg.HasMeshoptCompression;for(const _ of d.meshes){if(d.lights&&d.lightMeshIndex===p||!_.featureData)continue;_.featureArray=new yd,_.featureArray.reserve(_.featureData.length);let S=i;for(const A of _.featureData){const C=y?65535&A:A>>16&65535,R=y?A>>16&65535:65535&A,D=(15&R)<8?15&R:0,j=c.evaluatedRMEA[D],H=c.evaluatedColor[D],W=c.emissionHeightBasedParams[D];let J;if(S&&D===2&&d.lights&&(J=new yd,J.resize(10*d.lights.length)),Pie(_.featureArray,C,H,j,W,_.aabb.min[2],_.aabb.max[2],J),J&&S){S=!1;const te=d.meshes[d.lightMeshIndex];te.featureArray=J,te.featureArray._trim()}}_.featureArray._trim(),p++}}function XB(c,i,a,d){const p=1<<c.z;i.lat=pe((d/Lt+c.y)/p),i.lng=ue((a/Lt+c.x)/p)}function Iie(c,i,a,d){const p=c.getNodesInfo()[i];if(!p||p.hiddenByReplacement||!p.node.meshes)return;let y=Number.MAX_VALUE;const _=p.node,S=a.tile,A=d.calculatePosMatrix(S.tileID.toUnwrapped(),d.worldSize),C=p.evaluatedScale;let R=0;d.elevation&&_.elevation&&(R=_.elevation*d.elevation.exaggeration()),G(A,A,[(_.anchor?_.anchor[0]:0)*(C[0]-1),(_.anchor?_.anchor[1]:0)*(C[1]-1),R]),Z(A,A,C);const D=a.queryGeometry,j=D.isPointQuery()?D.screenBounds:D.screenGeometry,H=function(J){const te=U([],A,J.matrix);U(te,d.expandedFarZProjMatrix,te);for(let ae=0;ae<J.meshes.length;++ae){const de=J.meshes[ae];if(ae===J.lightMeshIndex)continue;const he=mF(j,d,te,de.aabb);he!=null&&(y=Math.min(he,y))}if(J.children)for(const ae of J.children)H(ae)};if(H(_),y===Number.MAX_VALUE)return;const W=new F(0,0);return XB(S.tileID.canonical,W,p.node.anchor[0],p.node.anchor[1]),{intersectionZ:y,position:W,feature:p.feature}}Wt(eT,"Tiled3dModelBucket",{omit:["layers"]}),Wt(ZB,"Tiled3dModelFeature");const Mie={circle:class extends Yo{constructor(c,i,a,d){super(c,{layout:eu||(eu=new xi({"circle-sort-key":new Bt(Ve.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Mt(Ve.layout_circle["circle-elevation-reference"]),visibility:new Mt(Ve.layout_circle.visibility)})),paint:xd||(xd=new xi({"circle-radius":new Bt(Ve.paint_circle["circle-radius"]),"circle-color":new Bt(Ve.paint_circle["circle-color"]),"circle-blur":new Bt(Ve.paint_circle["circle-blur"]),"circle-opacity":new Bt(Ve.paint_circle["circle-opacity"]),"circle-translate":new Mt(Ve.paint_circle["circle-translate"]),"circle-translate-anchor":new Mt(Ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mt(Ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mt(Ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bt(Ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bt(Ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bt(Ve.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Mt(Ve.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}createBucket(c){return new yn(c)}queryRadius(c){const i=c;return To("circle-radius",this,i)+To("circle-stroke-width",this,i)+Ai(this.paint.get("circle-translate"))}queryIntersectsFeature(c,i,a,d,p,y,_,S){const A=Yu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,c.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return rz(c,d,y,_,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,i,a){const d=tz(this);return{config:new ps(this,{zoom:i,lut:a}),defines:d,overrideFog:!1}}is3D(c){return!c&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Yo{createBucket(c){return new iz(c)}constructor(c,i,a,d){super(c,{layout:oz||(oz=new xi({visibility:new Mt(Ve.layout_heatmap.visibility)})),paint:sz||(sz=new xi({"heatmap-radius":new Bt(Ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bt(Ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mt(Ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new sd(Ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mt(Ve.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=F0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(c){return To("heatmap-radius",this,c)}queryIntersectsFeature(c,i,a,d,p,y,_,S){const A=this.paint.get("heatmap-radius").evaluate(i,a);return rz(c,d,y,_,S,!0,!0,new ut(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,i,a){return c==="heatmap"?{config:new ps(this,{zoom:i,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Yo{constructor(c,i,a,d){super(c,{layout:az||(az=new xi({visibility:new Mt(Ve.layout_hillshade.visibility)})),paint:lz||(lz=new xi({"hillshade-illumination-direction":new Mt(Ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mt(Ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mt(Ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mt(Ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mt(Ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mt(Ve.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Mt(Ve.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}},fill:class extends Yo{constructor(c,i,a,d){super(c,{layout:Sz||(Sz=new xi({"fill-sort-key":new Bt(Ve.layout_fill["fill-sort-key"]),visibility:new Mt(Ve.layout_fill.visibility),"fill-elevation-reference":new Mt(Ve.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Bt(Ve.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Tz||(Tz=new xi({"fill-antialias":new Mt(Ve.paint_fill["fill-antialias"]),"fill-opacity":new Bt(Ve.paint_fill["fill-opacity"]),"fill-color":new Bt(Ve.paint_fill["fill-color"]),"fill-outline-color":new Bt(Ve.paint_fill["fill-outline-color"]),"fill-translate":new Mt(Ve.paint_fill["fill-translate"]),"fill-translate-anchor":new Mt(Ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bt(Ve.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Mt(Ve.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Mt(Ve.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Bt(Ve.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Bt(Ve.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Bt(Ve.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}getProgramIds(){const c=this.paint.get("fill-pattern"),i=c&&c.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(c,i,a){return{config:new ps(this,{zoom:i,lut:a}),overrideFog:!1}}recalculate(c,i){super.recalculate(c,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new iI(c)}queryRadius(){return Ai(this.paint.get("fill-translate"))}queryIntersectsFeature(c,i,a,d,p,y){return!c.queryGeometry.isAboveHorizon&&Oi(aa(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,c.pixelToTileUnitsFactor),d)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?i&&!c:i}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Yo{constructor(c,i,a,d){super(c,{layout:qz||(qz=new xi({visibility:new Mt(Ve["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Mt(Ve["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Zz||(Zz=new xi({"fill-extrusion-opacity":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bt(Ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bt(Ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Bt(Ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bt(Ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Bt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Bt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Bt(Ve["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Bt(Ve["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Mt(Ve["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new AS(c)}queryRadius(){return Ai(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,i,a,d,p,y,_,S,A){const C=Yu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,c.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(i,a),D=this.paint.get("fill-extrusion-base").evaluate(i,a),j=[0,0],H=S&&y.elevation,W=y.elevation?y.elevation.exaggeration():1,J=c.tile.getBucket(this);if(H&&J instanceof AS){const me=J.centroidVertexArray,ke=A+1;ke<me.length&&(j[0]=me.geta_centroid_pos0(ke),j[1]=me.geta_centroid_pos1(ke))}if(j[0]===0&&j[1]===1)return!1;y.projection.name==="globe"&&(d=Wz([d],[new ut(0,0),new ut(Lt,Lt)],c.tileID.canonical).map(me=>me.polygon).flat());const te=H?S:null,[ae,de]=function(me,ke,Ee,Pe,Ne,Be,ct,Ue,dt,Ct,mt){return me.projection.name==="globe"?function(wt,At,at,St,He,lt,kt,Tt,tr,Zt,xt){const Et=[],Yt=[],Vt=wt.projection.upVectorScale(xt,wt.center.lat,wt.worldSize).metersToTile,jt=[0,0,0,1],Gt=[0,0,0,1],hr=(Cr,Tr,Zr,jr)=>{Cr[0]=Tr,Cr[1]=Zr,Cr[2]=jr,Cr[3]=1},vr=Hz();at>0&&(at+=vr),St+=vr;for(const Cr of At){const Tr=[],Zr=[];for(const jr of Cr){const Yn=jr.x+He.x,_e=jr.y+He.y,ve=wt.projection.projectTilePoint(Yn,_e,xt),ot=wt.projection.upVector(xt,jr.x,jr.y);let Rt=at,zt=St;if(kt){const Nt=eF(Yn,_e,at,St,kt,Tt,tr,Zt);Rt+=Nt.base,zt+=Nt.top}at!==0?hr(jt,ve.x+ot[0]*Vt*Rt,ve.y+ot[1]*Vt*Rt,ve.z+ot[2]*Vt*Rt):hr(jt,ve.x,ve.y,ve.z),hr(Gt,ve.x+ot[0]*Vt*zt,ve.y+ot[1]*Vt*zt,ve.z+ot[2]*Vt*zt),nr(jt,jt,lt),nr(Gt,Gt,lt),Tr.push(new wp(jt[0],jt[1],jt[2])),Zr.push(new wp(Gt[0],Gt[1],Gt[2]))}Et.push(Tr),Yt.push(Zr)}return[Et,Yt]}(me,ke,Ee,Pe,Ne,Be,ct,Ue,dt,Ct,mt):ct?function(wt,At,at,St,He,lt,kt,Tt,tr){const Zt=[],xt=[],Et=[0,0,0,1];for(const Yt of wt){const Vt=[],jt=[];for(const Gt of Yt){const hr=Gt.x+St.x,vr=Gt.y+St.y,Cr=eF(hr,vr,At,at,lt,kt,Tt,tr);Et[0]=hr,Et[1]=vr,Et[2]=Cr.base,Et[3]=1,Ci(Et,Et,He),Et[3]=Math.max(Et[3],1e-5);const Tr=new wp(Et[0]/Et[3],Et[1]/Et[3],Et[2]/Et[3]);Et[0]=hr,Et[1]=vr,Et[2]=Cr.top,Et[3]=1,Ci(Et,Et,He),Et[3]=Math.max(Et[3],1e-5);const Zr=new wp(Et[0]/Et[3],Et[1]/Et[3],Et[2]/Et[3]);Vt.push(Tr),jt.push(Zr)}Zt.push(Vt),xt.push(jt)}return[Zt,xt]}(ke,Ee,Pe,Ne,Be,ct,Ue,dt,Ct):function(wt,At,at,St,He){const lt=[],kt=[],Tt=He[8]*At,tr=He[9]*At,Zt=He[10]*At,xt=He[11]*At,Et=He[8]*at,Yt=He[9]*at,Vt=He[10]*at,jt=He[11]*at;for(const Gt of wt){const hr=[],vr=[];for(const Cr of Gt){const Tr=Cr.x+St.x,Zr=Cr.y+St.y,jr=He[0]*Tr+He[4]*Zr+He[12],Yn=He[1]*Tr+He[5]*Zr+He[13],_e=He[2]*Tr+He[6]*Zr+He[14],ve=He[3]*Tr+He[7]*Zr+He[15],ot=jr+Tt,Rt=Yn+tr,zt=_e+Zt,Nt=Math.max(ve+xt,1e-5),Xt=jr+Et,gr=Yn+Yt,Vr=_e+Vt,Ur=Math.max(ve+jt,1e-5);hr.push(new wp(ot/Nt,Rt/Nt,zt/Nt)),vr.push(new wp(Xt/Ur,gr/Ur,Vr/Ur))}lt.push(hr),kt.push(vr)}return[lt,kt]}(ke,Ee,Pe,Ne,Be)}(y,d,D,R,C,_,te,j,W,y.center.lat,c.tileID.canonical),he=c.queryGeometry;return function(me,ke,Ee){let Pe=1/0;Oi(Ee,ke)&&(Pe=Qz(Ee,ke[0]));for(let Ne=0;Ne<ke.length;Ne++){const Be=ke[Ne],ct=me[Ne];for(let Ue=0;Ue<Be.length-1;Ue++){const dt=Be[Ue],Ct=[dt,Be[Ue+1],ct[Ue+1],ct[Ue],dt];Nn(Ee,Ct)&&(Pe=Math.min(Pe,Qz(Ee,Ct)))}}return Pe!==1/0&&Pe}(ae,de,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends Yo{constructor(c,i,a,d){super(c,{layout:TF||(TF=new xi({visibility:new Mt(Ve.layout_building.visibility),"building-facade":new Bt(Ve.layout_building["building-facade"]),"building-facade-floors":new Bt(Ve.layout_building["building-facade-floors"]),"building-facade-window":new Bt(Ve.layout_building["building-facade-window"]),"building-roof-shape":new Bt(Ve.layout_building["building-roof-shape"]),"building-height":new Bt(Ve.layout_building["building-height"]),"building-base":new Bt(Ve.layout_building["building-base"])})),paint:EF||(EF=new xi({"building-opacity":new Mt(Ve.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Mt(Ve.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Mt(Ve.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Mt(Ve.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Mt(Ve.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Mt(Ve.paint_building["building-vertical-scale"]),"building-cast-shadows":new Mt(Ve.paint_building["building-cast-shadows"]),"building-color":new Bt(Ve.paint_building["building-color"]),"building-emissive-strength":new Bt(Ve.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Mt(Ve.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Mt(Ve.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new SF(c)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(c){return!0}},line:class extends Yo{constructor(c,i,a,d){const p=LF();super(c,p,i,a,d),p.layout&&(this.layout=new tl(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof tp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,i){super.recalculate(c,i),this.paint._values["line-floorwidth"]=(()=>{if(rx)return rx;const a=LF();return rx=new Cne(a.paint.properties["line-width"].specification),rx.useIntegerZoom=!0,rx})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new AI(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,i,a){const d=RF(this);return{config:new ps(this,{zoom:i,lut:a}),defines:d,overrideFog:!1}}queryRadius(c){const i=c,a=jF(To("line-width",this,i),To("line-gap-width",this,i)),d=To("line-offset",this,i);return a/2+Math.abs(d)+Ai(this.paint.get("line-translate"))}queryIntersectsFeature(c,i,a,d,p,y){if(c.queryGeometry.isAboveHorizon)return!1;const _=aa(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,c.pixelToTileUnitsFactor),S=c.pixelToTileUnitsFactor/2*jF(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),A=this.paint.get("line-offset").evaluate(i,a);return A&&(d=function(C,R){const D=[],j=new ut(0,0);for(let H=0;H<C.length;H++){const W=C[H],J=[];for(let te=0;te<W.length;te++){const ae=W[te],de=W[te+1],he=te===0?j:ae.sub(W[te-1])._unit()._perp(),me=te===W.length-1?j:de.sub(ae)._unit()._perp(),ke=he._add(me)._unit();ke._mult(1/(ke.x*me.x+ke.y*me.y)),J.push(ke._mult(R)._add(ae))}D.push(J)}return D}(d,A*c.pixelToTileUnitsFactor)),function(C,R,D){for(let j=0;j<R.length;j++){const H=R[j];if(C.length>=3){for(let W=0;W<H.length;W++)if(Fo(C,H[W]))return!0}if(zi(C,H,D))return!0}return!1}(_,d,S)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:KS,background:class extends Yo{constructor(c,i,a,d){super(c,{layout:PB||(PB=new xi({visibility:new Mt(Ve.layout_background.visibility)})),paint:CB||(CB=new xi({"background-pitch-alignment":new Mt(Ve.paint_background["background-pitch-alignment"]),"background-color":new Mt(Ve.paint_background["background-color"]),"background-pattern":new Mt(Ve.paint_background["background-pattern"]),"background-opacity":new Mt(Ve.paint_background["background-opacity"]),"background-emissive-strength":new Mt(Ve.paint_background["background-emissive-strength"]),"background-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:RB,"raster-particle":FB,sky:class extends Yo{constructor(c,i,a,d){super(c,{layout:jB||(jB=new xi({visibility:new Mt(Ve.layout_sky.visibility)})),paint:NB||(NB=new xi({"sky-type":new Mt(Ve.paint_sky["sky-type"]),"sky-atmosphere-sun":new Mt(Ve.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Mt(Ve.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Mt(Ve.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Mt(Ve.paint_sky["sky-gradient-radius"]),"sky-gradient":new sd(Ve.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Mt(Ve.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Mt(Ve.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Mt(Ve.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=F0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(c,i){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),p=!d,y=c.style.light,_=y.properties.get("position");return p&&y.properties.get("anchor")==="viewport"&&qr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?HI(_.azimuthal,90-_.polar,i):HI(d[0],90-d[1],i)}const a=this.paint.get("sky-gradient-center");return HI(a[0],90-a[1],i)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends Yo{constructor(c,i,a,d){super(c,{paint:zB||(zB=new xi({}))},i,null)}},model:class extends Yo{constructor(c,i,a,d){super(c,{layout:UB||(UB=new xi({visibility:new Mt(Ve.layout_model.visibility),"model-id":new Bt(Ve.layout_model["model-id"])})),paint:GB||(GB=new xi({"model-opacity":new Bt(Ve.paint_model["model-opacity"]),"model-rotation":new Bt(Ve.paint_model["model-rotation"]),"model-scale":new Bt(Ve.paint_model["model-scale"]),"model-translation":new Bt(Ve.paint_model["model-translation"]),"model-color":new Bt(Ve.paint_model["model-color"]),"model-color-mix-intensity":new Bt(Ve.paint_model["model-color-mix-intensity"]),"model-type":new Mt(Ve.paint_model["model-type"]),"model-cast-shadows":new Mt(Ve.paint_model["model-cast-shadows"]),"model-receive-shadows":new Mt(Ve.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Mt(Ve.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Bt(Ve.paint_model["model-emissive-strength"]),"model-roughness":new Bt(Ve.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Bt(Ve.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Mt(Ve.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Mt(Ve.paint_model["model-front-cutoff"]),"model-color-use-theme":new Bt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new qI(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof eT?Lt-1:0}queryIntersectsFeature(c,i,a,d,p,y){if(!this.modelManager)return!1;const _=this.modelManager,S=c.tile.getBucket(this);if(!(S&&S instanceof qI))return!1;for(const A in S.instancesPerModel){const C=S.instancesPerModel[A],R=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(R)){const D=C.features[C.idToFeaturesIndex[R]],j=_.getModel(A,this.scope);if(!j)return!1;let H=B();const W=new F(0,0),J=S.canonical;let te=Number.MAX_VALUE;for(let ae=0;ae<D.instancedDataCount;++ae){const de=16*(D.instancedDataOffset+ae),he=C.instancedDataArray.float32,me=[he[de+4],he[de+5],he[de+6]];XB(J,W,he[de],0|he[de+1]),gF(H,j,y,W,D.rotation,D.scale,me,!1,!1,!1),y.projection.name==="globe"&&(H=bI(H,y));const ke=U([],y.projMatrix,H),Ee=c.queryGeometry,Pe=mF(Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry,y,ke,j.aabb);Pe!=null&&(te=Math.min(Pe,te))}return te!==Number.MAX_VALUE&&te}}return!1}_handleOverridablePaintPropertyUpdate(c,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const i=this._transitionablePaint._values[c];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof qc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Yo{constructor(c,i,a,d){super(c,{layout:Ez||(Ez=new xi({"clip-layer-types":new Mt(Ve.layout_clip["clip-layer-types"]),"clip-layer-scope":new Mt(Ve.layout_clip["clip-layer-scope"])})),paint:Az||(Az=new xi({}))},i,a,d)}recalculate(c,i){super.recalculate(c,i)}createBucket(c){return new Pz(c)}is3D(c){return!0}}},XI=new Sn(0,0,0),KI={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},YI={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},tT={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Oie={PAINT_ORDER_FILL_AND_STROKE:1},mx={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},KB={MASK_TYPE_LUMINANCE:1};function kie(c,i,a){c===1&&i.icons.push(function(d,p){return function(y){if(y.usvg_tree.height||(y.usvg_tree.height=y.usvg_tree.width),!y.metadata)return y;const{metadata:_}=y;if(_.content_area){const{content_area:S}=_;S.top==null&&(S.top=S.left),S.width==null&&(S.width=y.usvg_tree.width),S.height==null&&(S.height=S.width)}return _.stretch_x&&_.stretch_x.length&&YB(_,"x"),_.stretch_y&&_.stretch_y.length&&YB(_,"y"),y}(d.readFields(Rie,{name:void 0},p))}(a,a.readVarint()+a.pos))}function YB(c,i){const a=[],d=c[`stretch_${i}`];let p=null;for(let y=0;y<d.length;y++)p===null?p=a.length===0?d[0]:a[a.length-1][1]+d[y]:(a.push([p,p+d[y]]),p=null);c[`stretch_${i}_areas`]=a}function Rie(c,i,a){c===1?i.name=a.readString():c===2?i.metadata=function(d,p){return d.readFields(Die,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(a,a.readVarint()+a.pos):c===3&&(i.usvg_tree=function(d,p){return d.readFields(Nie,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(a,a.readVarint()+a.pos),i.data="usvg_tree")}function Die(c,i,a){c===1?i.stretch_x=a.readPackedVarint():c===2?i.stretch_y=a.readPackedVarint():c===3?i.content_area=function(d,p){return d.readFields(Lie,{left:0},p)}(a,a.readVarint()+a.pos):c===4&&i.variables.push(function(d,p){return d.readFields(jie,{name:void 0},p)}(a,a.readVarint()+a.pos))}function Lie(c,i,a){c===1?i.left=a.readVarint():c===2?i.width=a.readVarint():c===3?i.top=a.readVarint():c===4&&(i.height=a.readVarint())}function jie(c,i,a){c===1?i.name=a.readString():c===2&&(i.rgb_color=iT(a.readVarint()),i.value="rgb_color")}function Nie(c,i,a){c===1?i.width=i.height=a.readVarint():c===2?i.height=a.readVarint():c===3?i.children.push(rT(a,a.readVarint()+a.pos)):c===4?i.linear_gradients.push(function(d,p){return d.readFields(Gie,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(a,a.readVarint()+a.pos)):c===5?i.radial_gradients.push(function(d,p){return d.readFields(Wie,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(a,a.readVarint()+a.pos)):c===7?i.clip_paths.push(function(d,p){return d.readFields(qie,{children:[]},p)}(a,a.readVarint()+a.pos)):c===8&&i.masks.push(function(d,p){const y=d.readFields(Zie,{left:0,width:20,mask_type:KB.MASK_TYPE_LUMINANCE,children:[]},p);return y.height==null&&(y.height=y.width),y.top==null&&(y.top=y.left),y}(a,a.readVarint()+a.pos))}function rT(c,i){return c.readFields(zie,{},i)}function zie(c,i,a){c===1?(i.group=function(d,p){return d.readFields(Fie,{opacity:255,children:[]},p)}(a,a.readVarint()+a.pos),i.node="group"):c===2&&(i.path=function(d,p){return d.readFields($ie,{paint_order:1,commands:[],step:1,diffs:[],rule:KI.PATH_RULE_NON_ZERO},p)}(a,a.readVarint()+a.pos),i.node="path")}function Fie(c,i,a){c===1?i.transform=nT(a,a.readVarint()+a.pos):c===2?i.opacity=a.readVarint():c===5?i.clip_path_idx=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(rT(a,a.readVarint()+a.pos))}function nT(c,i){return c.readFields(Bie,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function Bie(c,i,a){c===1?i.sx=a.readFloat():c===2?i.ky=a.readFloat():c===3?i.kx=a.readFloat():c===4?i.sy=a.readFloat():c===5?i.tx=a.readFloat():c===6&&(i.ty=a.readFloat())}function $ie(c,i,a){c===1?i.fill=function(d,p){return d.readFields(Vie,{rgb_color:XI,paint:"rgb_color",opacity:255},p)}(a,a.readVarint()+a.pos):c===2?i.stroke=function(d,p){return d.readFields(Uie,{rgb_color:XI,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(a,a.readVarint()+a.pos):c===3?i.paint_order=a.readVarint():c===5?a.readPackedVarint(i.commands):c===6?i.step=a.readFloat():c===7?a.readPackedSVarint(i.diffs):c===8&&(i.rule=a.readVarint())}function Vie(c,i,a){c===1?(i.rgb_color=iT(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5&&(i.opacity=a.readVarint())}function iT(c){return new Sn((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function Uie(c,i,a){c===1?(i.rgb_color=iT(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5?a.readPackedFloat(i.dasharray):c===6?i.dashoffset=a.readFloat():c===7?i.miterlimit=a.readFloat():c===8?i.opacity=a.readVarint():c===9?i.width=a.readFloat():c===10?i.linecap=a.readVarint():c===11&&(i.linejoin=a.readVarint())}function Gie(c,i,a){c===1?i.transform=nT(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(JB(a,a.readVarint()+a.pos)):c===4?i.x1=a.readFloat():c===5?i.y1=a.readFloat():c===6?i.x2=a.readFloat():c===7&&(i.y2=a.readFloat())}function JB(c,i){return c.readFields(Hie,{offset:0,opacity:255,rgb_color:XI},i)}function Hie(c,i,a){c===1?i.offset=a.readFloat():c===2?i.opacity=a.readVarint():c===3&&(i.rgb_color=iT(a.readVarint()))}function Wie(c,i,a){c===1?i.transform=nT(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(JB(a,a.readVarint()+a.pos)):c===4?i.cx=a.readFloat():c===5?i.cy=a.readFloat():c===6?i.r=a.readFloat():c===7?i.fx=a.readFloat():c===8?i.fy=a.readFloat():c===9&&(i.fr=a.readFloat())}function qie(c,i,a){c===1?i.transform=nT(a,a.readVarint()+a.pos):c===2?i.clip_path_idx=a.readVarint():c===3&&i.children.push(rT(a,a.readVarint()+a.pos))}function Zie(c,i,a){c===1?i.left=i.top=a.readFloat():c===2?i.width=i.height=a.readFloat():c===3?i.top=a.readFloat():c===4?i.height=a.readFloat():c===5?i.mask_type=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(rT(a,a.readVarint()+a.pos))}class Xie{static calculate(i={},a=[]){const d=new Map,p=new Map;if(Object.keys(i).length===0)return d;a.forEach(y=>{p.set(y.name,y.rgb_color||new Sn(0,0,0))});for(const[y,_]of Object.entries(i))p.has(y)?d.set(p.get(y).toString(),_):console.warn(`Ignoring unknown image variable "${y}"`);return d}}function Qg(c,i=255,a){const d=i/255,p=c.toString(),y=a.has(p)?a.get(p).clone():c.clone();return y.a*=d,y.toString()}function gx(c,i){if(!$m()){const a=document.createElement("canvas");return a.width=c,a.height=i,a}return new OffscreenCanvas(c,i)}function Kie(c,i){const a=Xie.calculate(i.params,c.metadata?c.metadata.variables:[]),d=c.usvg_tree,p=d.width,y=d.height,_=i.transform?i.transform:new DOMMatrix,S=Math.max(1,Math.round(p*_.a)),A=Math.max(1,Math.round(y*_.d)),C=new DOMMatrix([S/p,0,0,A/y,0,0]),R=gx(S,A).getContext("2d");return JI(R,C,d,d,a),R.getImageData(0,0,S,A)}function JI(c,i,a,d,p){for(const y of d.children)QB(c,i,a,y,p)}function QB(c,i,a,d,p){d.group?(c.save(),function(y,_,S,A,C){const R=A.mask_idx!=null?S.masks[A.mask_idx]:null,D=A.clip_path_idx!=null?S.clip_paths[A.clip_path_idx]:null;if(A.transform&&(_=ey(A.transform).preMultiplySelf(_)),!function(W,J,te){return W.opacity!==255||J||te}(A,D!=null,R!=null))return void JI(y,_,S,A,C);const j=gx(y.canvas.width,y.canvas.height),H=j.getContext("2d");JI(H,_,S,A,C),D&&s5(H,_,S,D),R&&a5(H,_,S,R,C),y.globalAlpha=A.opacity/255,y.drawImage(j,0,0)}(c,i,a,d.group,p),c.restore()):d.path&&(c.save(),function(y,_,S,A,C){y.setTransform(_),A.paint_order===Oie.PAINT_ORDER_FILL_AND_STROKE?(e5(y,S,A,C),r5(y,S,A,C)):(r5(y,S,A,C),e5(y,S,A,C))}(c,i,a,d.path,p),c.restore())}function e5(c,i,a,d){const p=a.fill;if(!p)return;const y=p.opacity/255;switch(c.save(),c.beginPath(),l5(a,c),p.paint){case"rgb_color":c.fillStyle=Qg(p.rgb_color,p.opacity,d);break;case"linear_gradient_idx":{const _=i.linear_gradients[p.linear_gradient_idx];_.transform&&c.setTransform(ey(_.transform).preMultiplySelf(c.getTransform())),c.fillStyle=n5(c,_,y,d);break}case"radial_gradient_idx":{const _=i.radial_gradients[p.radial_gradient_idx];_.transform&&c.setTransform(ey(_.transform).preMultiplySelf(c.getTransform())),c.fillStyle=i5(c,_,y,d)}}c.fill(t5(a)),c.restore()}function t5(c){return c.rule===KI.PATH_RULE_NON_ZERO?"nonzero":c.rule===KI.PATH_RULE_EVEN_ODD?"evenodd":void 0}function r5(c,i,a,d){const p=a.stroke;if(!p)return;const y=c5(a);c.lineWidth=p.width,c.miterLimit=p.miterlimit,c.setLineDash(p.dasharray),c.lineDashOffset=p.dashoffset;const _=p.opacity/255;switch(p.paint){case"rgb_color":c.strokeStyle=Qg(p.rgb_color,p.opacity,d);break;case"linear_gradient_idx":c.strokeStyle=n5(c,i.linear_gradients[p.linear_gradient_idx],_,d,!0);break;case"radial_gradient_idx":c.strokeStyle=i5(c,i.radial_gradients[p.radial_gradient_idx],_,d,!0)}switch(p.linejoin){case tT.LINE_JOIN_MITER_CLIP:case tT.LINE_JOIN_MITER:c.lineJoin="miter";break;case tT.LINE_JOIN_ROUND:c.lineJoin="round";break;case tT.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(p.linecap){case YI.LINE_CAP_BUTT:c.lineCap="butt";break;case YI.LINE_CAP_ROUND:c.lineCap="round";break;case YI.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(y)}function n5(c,i,a,d,p=!1){if(i.stops.length===1){const j=i.stops[0];return Qg(j.rgb_color,j.opacity*a,d)}const{x1:y,y1:_,x2:S,y2:A}=i;let C=new DOMPoint(y,_),R=new DOMPoint(S,A);if(p){const j=ey(i.transform);C=j.transformPoint(C),R=j.transformPoint(R)}const D=c.createLinearGradient(C.x,C.y,R.x,R.y);for(const j of i.stops)D.addColorStop(j.offset,Qg(j.rgb_color,j.opacity*a,d));return D}function i5(c,i,a,d,p=!1){if(i.stops.length===1){const ae=i.stops[0];return Qg(ae.rgb_color,ae.opacity*a,d)}const y=ey(i.transform),{fx:_,fy:S,fr:A,cx:C,cy:R,r:D}=i;let j=new DOMPoint(_,S),H=new DOMPoint(C,R),W=A,J=D;if(p){j=y.transformPoint(j),H=y.transformPoint(H);const ae=(y.a+y.d)/2;W=A*ae,J=i.r*ae}const te=c.createRadialGradient(j.x,j.y,W,H.x,H.y,J);for(const ae of i.stops)te.addColorStop(ae.offset,Qg(ae.rgb_color,ae.opacity*a,d));return te}function o5(c,i,a,d){const p=d.transform?ey(d.transform).preMultiplySelf(i):i,y=gx(c.canvas.width,c.canvas.height),_=y.getContext("2d");for(const A of d.children)if(A.group)o5(_,p,a,A.group);else if(A.path){const C=A.path,R=new Path2D;R.addPath(c5(C),p),_.fill(R,t5(C))}const S=d.clip_path_idx!=null?a.clip_paths[d.clip_path_idx]:null;S&&s5(_,p,a,S),c.globalCompositeOperation="source-over",c.drawImage(y,0,0)}function s5(c,i,a,d){const p=gx(c.canvas.width,c.canvas.height);o5(p.getContext("2d"),i,a,d),c.globalCompositeOperation="destination-in",c.drawImage(p,0,0)}function a5(c,i,a,d,p){if(d.children.length===0)return;const y=d.mask_idx!=null?a.masks[d.mask_idx]:null;y&&a5(c,i,a,y,p);const _=c.canvas.width,S=c.canvas.height,A=gx(_,S),C=A.getContext("2d"),R=d.width,D=d.height,j=d.left,H=d.top,W=new Path2D,J=new Path2D;J.rect(j,H,R,D),W.addPath(J,i),C.clip(W);for(const de of d.children)QB(C,i,a,de,p);const te=C.getImageData(0,0,_,S),ae=te.data;if(d.mask_type===KB.MASK_TYPE_LUMINANCE)for(let de=0;de<ae.length;de+=4)ae[de+3]=ae[de+3]/255*(.2126*ae[de]+.7152*ae[de+1]+.0722*ae[de+2]);C.putImageData(te,0,0),c.globalCompositeOperation="destination-in",c.drawImage(A,0,0)}function ey(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function l5(c,i){const a=c.step;let d=c.diffs[0]*a,p=c.diffs[1]*a;i.moveTo(d,p);for(let y=0,_=2;y<c.commands.length;y++)switch(c.commands[y]){case mx.PATH_COMMAND_MOVE:d+=c.diffs[_++]*a,p+=c.diffs[_++]*a,i.moveTo(d,p);break;case mx.PATH_COMMAND_LINE:d+=c.diffs[_++]*a,p+=c.diffs[_++]*a,i.lineTo(d,p);break;case mx.PATH_COMMAND_QUAD:{const S=d+c.diffs[_++]*a,A=p+c.diffs[_++]*a;d=S+c.diffs[_++]*a,p=A+c.diffs[_++]*a,i.quadraticCurveTo(S,A,d,p);break}case mx.PATH_COMMAND_CUBIC:{const S=d+c.diffs[_++]*a,A=p+c.diffs[_++]*a,C=S+c.diffs[_++]*a,R=A+c.diffs[_++]*a;d=C+c.diffs[_++]*a,p=R+c.diffs[_++]*a,i.bezierCurveTo(S,A,C,R,d,p);break}case mx.PATH_COMMAND_CLOSE:i.closePath()}return i}function c5(c){return l5(c,new Path2D)}class oT{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const a=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,a),a}put(i,a){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,a)}delete(i){this.cache.delete(i)}}Wt(oT,"LRUCache");class QI{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new Bo(i,i.data)}getFromCache(i,a,d){return this.cacheMap.has(d)||this.cacheMap.set(d,new oT(150)),this.cacheMap.get(d).get(cd(i.toString(),a))}setInCache(i,a,d,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new oT(150));const y=this.cacheDependenciesMap.get(p),_=cd(i.id.toString(),d);y.get(_)||y.set(_,new Set);const S=this.cacheMap.get(p),A=i.toString();y.get(_).add(A),S.put(cd(i.toString(),d),a)}removeImagesFromCacheByIds(i,a,d=0){if(!this.cacheMap.has(d)||!this.cacheDependenciesMap.has(d))return;const p=this.cacheMap.get(d),y=this.cacheDependenciesMap.get(d);for(const _ of i){const S=cd(_.toString(),a);if(y.has(S)){for(const A of y.get(S))p.delete(A);y.delete(S)}}}rasterize(i,a,d,p,y=Kie){const _=this.getFromCache(i,d,p);if(_)return _.clone();const S=y(a.icon,i.options),A=QI._getImage(S);return this.setInCache(i,A,d,p),A.clone()}}class u5{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const d=this.toIdx(i,a);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function h5(c,i,a,d){let p=0,y=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(d[_])<1e-15){if(a[_]<c[_]||a[_]>i[_])return null}else{const S=1/d[_];let A=(c[_]-a[_])*S,C=(i[_]-a[_])*S;if(A>C){const R=A;A=C,C=R}if(A>p&&(p=A),C<y&&(y=C),p>y)return null}return p}function d5(c,i,a,d,p,y,_,S,A,C,R){const D=d-c,j=p-i,H=y-a,W=_-c,J=S-i,te=A-a,ae=R[1]*te-R[2]*J,de=R[2]*W-R[0]*te,he=R[0]*J-R[1]*W,me=D*ae+j*de+H*he;if(Math.abs(me)<1e-15)return null;const ke=1/me,Ee=C[0]-c,Pe=C[1]-i,Ne=C[2]-a,Be=(Ee*ae+Pe*de+Ne*he)*ke;if(Be<0||Be>1)return null;const ct=Pe*H-Ne*j,Ue=Ne*D-Ee*H,dt=Ee*j-Pe*D,Ct=(R[0]*ct+R[1]*Ue+R[2]*dt)*ke;return Ct<0||Be+Ct>1?null:(W*ct+J*Ue+te*dt)*ke}function f5(c,i,a){return(c-i)/(a-i)}function p5(c,i,a,d,p,y,_,S,A){const C=1<<a,R=y-d,D=_-p,j=(c+1)/C*R+d,H=(i+0)/C*D+p,W=(i+1)/C*D+p;S[0]=(c+0)/C*R+d,S[1]=H,A[0]=j,A[1]=W}class m5{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(y){const _=Math.ceil(Math.log2(y.dim/8)),S=[];let A=Math.ceil(Math.pow(2,_));const C=1/A,R=(H,W,J,te,ae)=>{const de=te?1:0,he=(H+1)*J-de,me=W*J,ke=(W+1)*J-de;ae[0]=H*J,ae[1]=me,ae[2]=he,ae[3]=ke};let D=new u5(A);const j=[];for(let H=0;H<A*A;H++){R(H%A,Math.floor(H/A),C,!1,j);const W=Id(j[0],j[1],y),J=Id(j[2],j[1],y),te=Id(j[2],j[3],y),ae=Id(j[0],j[3],y);D.minimums.push(Math.min(W,J,te,ae)),D.maximums.push(Math.max(W,J,te,ae)),D.leaves.push(1)}for(S.push(D),A/=2;A>=1;A/=2){const H=S[S.length-1];D=new u5(A);for(let W=0;W<A*A;W++){R(W%A,Math.floor(W/A),2,!0,j);const J=H.getElevation(j[0],j[1]),te=H.getElevation(j[2],j[1]),ae=H.getElevation(j[2],j[3]),de=H.getElevation(j[0],j[3]),he=H.isLeaf(j[0],j[1]),me=H.isLeaf(j[2],j[1]),ke=H.isLeaf(j[2],j[3]),Ee=H.isLeaf(j[0],j[3]),Pe=Math.min(J.min,te.min,ae.min,de.min),Ne=Math.max(J.max,te.max,ae.max,de.max),Be=he&&me&&ke&&Ee;D.maximums.push(Ne),D.minimums.push(Pe),D.leaves.push(Ne-Pe<=5&&Be?1:0)}S.push(D)}return S}(this.dem),d=a.length-1,p=a[d];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(a,0,0,d,0)}raycastRoot(i,a,d,p,y,_,S=1){return h5([i,a,-100],[d,p,this.maximums[0]*S],y,_)}raycast(i,a,d,p,y,_,S=1){if(!this.nodeCount)return null;const A=this.raycastRoot(i,a,d,p,y,_,S);if(A==null)return null;const C=[],R=[],D=[],j=[],H=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:W,t:J,nodex:te,nodey:ae,depth:de}=H.pop();if(this.leaves[W]){p5(te,ae,de,i,a,d,p,D,j);const me=1<<de,ke=(te+0)/me,Ee=(te+1)/me,Pe=(ae+0)/me,Ne=(ae+1)/me,Be=Id(ke,Pe,this.dem)*S,ct=Id(Ee,Pe,this.dem)*S,Ue=Id(Ee,Ne,this.dem)*S,dt=Id(ke,Ne,this.dem)*S,Ct=d5(D[0],D[1],Be,j[0],D[1],ct,j[0],j[1],Ue,y,_),mt=d5(j[0],j[1],Ue,D[0],j[1],dt,D[0],D[1],Be,y,_),wt=Math.min(Ct!==null?Ct:Number.MAX_VALUE,mt!==null?mt:Number.MAX_VALUE);if(wt!==Number.MAX_VALUE)return wt;{const At=It([],y,_,J);if(g5(Be,ct,dt,Ue,f5(At[0],D[0],j[0]),f5(At[1],D[1],j[1]))>=At[2])return J}continue}let he=0;for(let me=0;me<this._siblingOffset.length;me++){p5((te<<1)+this._siblingOffset[me][0],(ae<<1)+this._siblingOffset[me][1],de+1,i,a,d,p,D,j),D[2]=-100,j[2]=this.maximums[this.childOffsets[W]+me]*S;const ke=h5(D,j,y,_);if(ke!=null){const Ee=ke;C[me]=Ee;let Pe=!1;for(let Ne=0;Ne<he&&!Pe;Ne++)Ee>=C[R[Ne]]&&(R.splice(Ne,0,me),Pe=!0);Pe||(R[he]=me),he++}}for(let me=0;me<he;me++){const ke=R[me];H.push({idx:this.childOffsets[W]+ke,t:C[ke],nodex:(te<<1)+this._siblingOffset[ke][0],nodey:(ae<<1)+this._siblingOffset[ke][1],depth:de+1})}}return null}_addNode(i,a,d){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,d,p,y){if(i[p].isLeaf(a,d)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const _=p-1,S=i[_];let A=0,C=0;for(let R=0;R<this._siblingOffset.length;R++){const D=2*a+this._siblingOffset[R][0],j=2*d+this._siblingOffset[R][1],H=S.getElevation(D,j),W=S.isLeaf(D,j),J=this._addNode(H.min,H.max,W);W&&(A|=1<<R),C||(C=J)}for(let R=0;R<this._siblingOffset.length;R++)A&1<<R||this._construct(i,2*a+this._siblingOffset[R][0],2*d+this._siblingOffset[R][1],_,C+R)}}function g5(c,i,a,d,p,y){return lr(lr(c,a,y),lr(i,d,y),p)}function Id(c,i,a){const d=a.dim,p=xe(c*d-.5,0,d-1),y=xe(i*d-.5,0,d-1),_=Math.floor(p),S=Math.floor(y),A=Math.min(_+1,d-1),C=Math.min(S+1,d-1);return g5(a.get(_,S),a.get(A,S),a.get(_,C),a.get(A,C),p-_,y-S)}const Yie={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Jie(c,i,a){return(256*c*256+256*i+a)/10-1e4}function Qie(c,i,a){return 256*c+i+a/256-32768}class sT{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,d,p=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void qr(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const y=this.dim=a.height-2,_=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let A=0;A<y;A++)_[this._idx(-1,A)]=_[this._idx(0,A)],_[this._idx(y,A)]=_[this._idx(y-1,A)],_[this._idx(A,-1)]=_[this._idx(A,0)],_[this._idx(A,y)]=_[this._idx(A,y-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(y,-1)]=_[this._idx(y-1,0)],_[this._idx(-1,y)]=_[this._idx(0,y-1)],_[this._idx(y,y)]=_[this._idx(y-1,y-1)]}const S=d==="terrarium"?Qie:Jie;for(let A=0;A<_.length;++A){const C=4*A;this.floatView[A]=S(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=Ja.now()}_buildQuadTree(){this._tree=new m5(this)}get(i,a,d=!1){d&&(i=xe(i,-1,this.dim),a=xe(a,-1,this.dim));const p=this._idx(i,a);return this.floatView[p]}set(i,a,d){const p=this._idx(i,a),y=this.floatView[p];return this.floatView[p]=d,d-y}static getUnpackVector(i){return Yie[i]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}static pack(i,a){const d=[0,0,0,0],p=sT.getUnpackVector(a);let y=Math.floor((i+p[3])/p[2]);return d[2]=y%256,y=Math.floor(y/256),d[1]=y%256,y=Math.floor(y/256),d[0]=y,d}getPixels(){return new hz({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=a*this.dim,y=a*this.dim+this.dim,_=d*this.dim,S=d*this.dim+this.dim;switch(a){case-1:p=y-1;break;case 1:y=p+1}switch(d){case-1:_=S-1;break;case 1:S=_+1}const A=-a*this.dim,C=-d*this.dim;for(let R=_;R<S;R++)for(let D=p;D<y;D++){const j=4*this._idx(D,R),H=4*this._idx(D+A,R+C);this.pixels[j+0]=i.pixels[H+0],this.pixels[j+1]=i.pixels[H+1],this.pixels[j+2]=i.pixels[H+2],this.pixels[j+3]=i.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function eoe(c,i,a){c===1?i.headerLength=a.readFixed32():c===2?i.x=a.readVarint():c===3?i.y=a.readVarint():c===4?i.z=a.readVarint():c===5&&i.layers.push(function(d,p){return d.readFields(ooe,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(a,a.readVarint()+a.pos))}function toe(c,i,a){c===1?(i.delta_filter=function(d,p){return d.readFields(roe,{blockSize:0},p)}(a,a.readVarint()+a.pos),i.filter="delta_filter"):c===2?(a.readVarint(),i.filter="zigzag_filter"):c===3?(a.readVarint(),i.filter="bitshuffle_filter"):c===4&&(a.readVarint(),i.filter="byteshuffle_filter")}function roe(c,i,a){c===1&&(i.blockSize=a.readVarint())}function noe(c,i,a){c===1?(a.readVarint(),i.codec="gzip_data"):c===2?(a.readVarint(),i.codec="jpeg_image"):c===3?(a.readVarint(),i.codec="webp_image"):c===4&&(a.readVarint(),i.codec="png_image")}function ioe(c,i,a){let d=0,p=0;c===1?i.firstByte=a.readFixed64():c===2?i.lastByte=a.readFixed64():c===3?i.filters.push(function(y,_){return y.readFields(toe,{},_)}(a,a.readVarint()+a.pos)):c===4?i.codec=function(y,_){return y.readFields(noe,{},_)}(a,a.readVarint()+a.pos):c===5?p=a.readFloat():c===6?d=a.readFloat():c===7?i.bands.push(a.readString()):c===8?i.offset=a.readDouble():c===9&&(i.scale=a.readDouble()),i.offset===0&&(i.offset=p),i.scale===0&&(i.scale=d)}function ooe(c,i,a){c===1?i.version=a.readVarint():c===2?i.name=a.readString():c===3?i.units=a.readString():c===4?i.tileSize=a.readVarint():c===5?i.buffer=a.readVarint():c===6?i.pixelFormat=a.readVarint():c===7&&i.dataIndex.push(function(d,p){return d.readFields(ioe,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(a,a.readVarint()+a.pos))}function soe(c,i,a){if(c===2)(function(d,p,y){d.readFields(aoe,y,p)})(a,a.readVarint()+a.pos,i);else if(c===3)throw new Error("Not implemented")}function aoe(c,i,a){if(c===1){let d=0;const p=a.readVarint()+a.pos;for(;a.pos<p;)i[d++]=a.readVarint()}}function loe(c,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let a=i[3];for(let d=2;d>=1;d--){const p=d===1?1:0,y=d===2?1:0;for(let _=0;_<i[0];_++){const S=i[1]*_;for(let A=p;A<i[1];A++){const C=i[2]*(A+S);for(let R=y;R<i[2];R++){const D=i[3]*(R+C);for(let j=0;j<i[3];j++){const H=D+j;c[H]+=c[H-a]}}}}a*=i[d]}return c}function coe(c){for(let i=0,a=c.length;i<a;i++)c[i]=c[i]>>>1^-(1&c[i]);return c}function uoe(c,i){switch(i){case"uint32":return c;case"uint16":for(let a=0;a<c.length;a+=2){const d=c[a],p=c[a+1];c[a]=(240&d)>>4|(61440&d)>>8|(240&p)<<4|61440&p,c[a+1]=15&d|(3840&d)>>4|(15&p)<<8|(3840&p)<<4}return c;case"uint8":for(let a=0;a<c.length;a+=4){const d=c[a],p=c[a+1],y=c[a+2],_=c[a+3];c[a+0]=(192&d)>>6|(192&p)>>4|(192&y)>>2|192&_,c[a+1]=(48&d)>>4|(48&p)>>2|48&y|(48&_)<<2,c[a+2]=(12&d)>>2|12&p|(12&y)<<2|(12&_)<<4,c[a+3]=3&d|(3&p)<<2|(3&y)<<4|(3&_)<<6}return c;default:throw new Error(`Invalid pixel format, "${i}"`)}}Wt(sT,"DEMData"),Wt(m5,"DemMinMaxQuadTree",{omit:["dem"]});var nl=Uint8Array,yx=Uint16Array,hoe=Int32Array,y5=new nl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_5=new nl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),doe=new nl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),v5=function(c,i){for(var a=new yx(31),d=0;d<31;++d)a[d]=i+=1<<c[d-1];var p=new hoe(a[30]);for(d=1;d<30;++d)for(var y=a[d];y<a[d+1];++y)p[y]=y-a[d]<<5|d;return{b:a,r:p}},x5=v5(y5,2),b5=x5.b,foe=x5.r;b5[28]=258,foe[258]=28;for(var poe=v5(_5,0).b,w5=new yx(32768),to=0;to<32768;++to){var ty=(43690&to)>>1|(21845&to)<<1;w5[to]=((65280&(ty=(61680&(ty=(52428&ty)>>2|(13107&ty)<<2))>>4|(3855&ty)<<4))>>8|(255&ty)<<8)>>1}var _x=function(c,i,a){for(var d=c.length,p=0,y=new yx(i);p<d;++p)c[p]&&++y[c[p]-1];var _,S=new yx(i);for(p=1;p<i;++p)S[p]=S[p-1]+y[p-1]<<1;_=new yx(1<<i);var A=15-i;for(p=0;p<d;++p)if(c[p])for(var C=p<<4|c[p],R=i-c[p],D=S[c[p]-1]++<<R,j=D|(1<<R)-1;D<=j;++D)_[w5[D]>>A]=C;return _},vx=new nl(288);for(to=0;to<144;++to)vx[to]=8;for(to=144;to<256;++to)vx[to]=9;for(to=256;to<280;++to)vx[to]=7;for(to=280;to<288;++to)vx[to]=8;var S5=new nl(32);for(to=0;to<32;++to)S5[to]=5;var moe=_x(vx,9),goe=_x(S5,5),eM=function(c){for(var i=c[0],a=1;a<c.length;++a)c[a]>i&&(i=c[a]);return i},rc=function(c,i,a){var d=i/8|0;return(c[d]|c[d+1]<<8)>>(7&i)&a},tM=function(c,i){var a=i/8|0;return(c[a]|c[a+1]<<8|c[a+2]<<16)>>(7&i)},yoe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],nc=function(c,i,a){var d=new Error(i||yoe[c]);if(d.code=c,Error.captureStackTrace&&Error.captureStackTrace(d,nc),!a)throw d;return d},_oe=new nl(0),voe=typeof TextDecoder<"u"&&new TextDecoder;try{voe.decode(_oe,{stream:!0})}catch{}const xoe={gzip_data:"gzip"};class Sl extends Error{constructor(i){super(i),this.name="MRTError"}}const boe={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},T5={uint32:1,uint16:2,uint8:4},woe={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let rM;class aT{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const a=this.layers[i];if(!a)throw new Sl(`Layer '${i}' not found`);return a}getHeaderLength(i){const a=new Uint8Array(i),d=new DataView(i);if(a[0]!==13)throw new Sl("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(i){const a=new Uint8Array(i),d=this.getHeaderLength(i);if(a.length<d)throw new Sl(`Expected header with length >= ${d} but got buffer of length ${a.length}`);const p=new rM(a.subarray(0,d)).readFields(eoe,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Sl(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const y of p.layers)this.layers[y.name]=new E5(y,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const a=[],d=this.getLayer(i.layerName);for(let p of i.blockIndices){const y=d.dataIndex[p],_=y.firstByte-i.firstByte,S=y.lastByte-i.firstByte;if(d._blocksInProgress.has(p))continue;const A={layerName:d.name,firstByte:_,lastByte:S,pixelFormat:d.pixelFormat,blockIndex:p,blockShape:[y.bands.length].concat(d.bandShape),buffer:d.buffer,codec:y.codec.codec,filters:y.filters.map(C=>C.filter)};d._blocksInProgress.add(p),a.push(A)}return new A5(a,()=>{a.forEach(p=>d._blocksInProgress.delete(p.blockIndex))},(p,y)=>{if(a.forEach(_=>d._blocksInProgress.delete(_.blockIndex)),p)throw p;y.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class E5{constructor({version:i,name:a,units:d,tileSize:p,pixelFormat:y,buffer:_,dataIndex:S},A){if(this.version=i,this.version!==1)throw new Sl(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=a,this.units=d,this.tileSize=p,this.buffer=_,this.pixelFormat=boe[y],this.dataIndex=S,this.bandShape=[p+2*_,p+2*_,T5[this.pixelFormat]],this._decodedBlocks=new oT(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return T5[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const a=i.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,i.data)}getBlockForBand(i){let a=0;switch(typeof i){case"string":for(const[d,p]of this.dataIndex.entries()){for(const[y,_]of p.bands.entries())if(_===i)return{bandIndex:a+y,blockIndex:d,blockBandIndex:y};a+=p.bands.length}break;case"number":for(const[d,p]of this.dataIndex.entries()){if(i>=a&&i<a+p.bands.length)return{bandIndex:i,blockIndex:d,blockBandIndex:i-a};a+=p.bands.length}break;default:throw new Sl(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let a=1/0,d=-1/0;const p=[],y=new Set;for(const _ of i){const{blockIndex:S}=this.getBlockForBand(_);if(S<0)throw new Sl(`Invalid band: ${JSON.stringify(_)}`);const A=this.dataIndex[S];p.includes(S)||p.push(S),y.add(S),a=Math.min(a,A.firstByte),d=Math.max(d,A.lastByte)}if(y.size>this.cacheSize)throw new Sl(`Number of blocks to decode (${y.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:d,blockIndices:p}}hasBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0}hasDataForBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(i){const{blockIndex:a,blockBandIndex:d}=this.getBlockForBand(i);if(a<0)throw new Sl(`Band not found: ${JSON.stringify(i)}`);const p=this._decodedBlocks.get(a.toString());if(!p)throw new Sl(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const y=this.dataIndex[a],_=this.bandShape.reduce((C,R)=>C*R,1),S=d*_,A=p.subarray(S,S+_);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:y.offset,scale:y.scale}}}aT.setPbf=function(c){rM=c};class A5{constructor(i,a,d){this.tasks=i,this._onCancel=a,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,a){this._finalized||(this._onComplete(i,a),this._finalized=!0)}}aT.performDecoding=function(c,i){const a=new Uint8Array(c);return Promise.all(i.tasks.map(d=>{const{layerName:p,firstByte:y,lastByte:_,pixelFormat:S,blockShape:A,blockIndex:C,filters:R,codec:D}=d,j=a.subarray(y,_+1),H=new Uint32Array(A[0]*A[1]*A[2]);let W;if(D!=="gzip_data")throw new Sl(`Unhandled codec: ${D}`);return W=function(J,te){if(!globalThis.DecompressionStream&&te==="gzip_data")return Promise.resolve(((me=function(Pe){Pe[0]==31&&Pe[1]==139&&Pe[2]==8||nc(6,"invalid gzip data");var Ne=Pe[3],Be=10;4&Ne&&(Be+=2+(Pe[10]|Pe[11]<<8));for(var ct=(Ne>>3&1)+(Ne>>4&1);ct>0;ct-=!Pe[Be++]);return Be+(2&Ne)}(he=J))+8>he.length&&nc(6,"invalid gzip data"),function(Pe,Ne,Be,ct){var Ue=Pe.length;if(!Ue||Ne.f&&!Ne.l)return Be||new nl(0);var dt=!Be,Ct=dt||Ne.i!=2,mt=Ne.i;dt&&(Be=new nl(3*Ue));var wt,At,at=function(hi){var Jn=Be.length;if(hi>Jn){var Hn=new nl(Math.max(2*Jn,hi));Hn.set(Be),Be=Hn}},St=Ne.f||0,He=Ne.p||0,lt=Ne.b||0,kt=Ne.l,Tt=Ne.d,tr=Ne.m,Zt=Ne.n,xt=8*Ue;do{if(!kt){St=rc(Pe,He,1);var Et=rc(Pe,He+1,3);if(He+=3,!Et){var Yt=Pe[(_e=4+((He+7)/8|0))-4]|Pe[_e-3]<<8,Vt=_e+Yt;if(Vt>Ue){mt&&nc(0);break}Ct&&at(lt+Yt),Be.set(Pe.subarray(_e,Vt),lt),Ne.b=lt+=Yt,Ne.p=He=8*Vt,Ne.f=St;continue}if(Et==1)kt=moe,Tt=goe,tr=9,Zt=5;else if(Et==2){var jt=rc(Pe,He,31)+257,Gt=rc(Pe,He+10,15)+4,hr=jt+rc(Pe,He+5,31)+1;He+=14;for(var vr=new nl(hr),Cr=new nl(19),Tr=0;Tr<Gt;++Tr)Cr[doe[Tr]]=rc(Pe,He+3*Tr,7);He+=3*Gt;var Zr=eM(Cr),jr=(1<<Zr)-1,Yn=_x(Cr,Zr);for(Tr=0;Tr<hr;){var _e,ve=Yn[rc(Pe,He,jr)];if(He+=15&ve,(_e=ve>>4)<16)vr[Tr++]=_e;else{var ot=0,Rt=0;for(_e==16?(Rt=3+rc(Pe,He,3),He+=2,ot=vr[Tr-1]):_e==17?(Rt=3+rc(Pe,He,7),He+=3):_e==18&&(Rt=11+rc(Pe,He,127),He+=7);Rt--;)vr[Tr++]=ot}}var zt=vr.subarray(0,jt),Nt=vr.subarray(jt);tr=eM(zt),Zt=eM(Nt),kt=_x(zt,tr),Tt=_x(Nt,Zt)}else nc(1);if(He>xt){mt&&nc(0);break}}Ct&&at(lt+131072);for(var Xt=(1<<tr)-1,gr=(1<<Zt)-1,Vr=He;;Vr=He){var Ur=(ot=kt[tM(Pe,He)&Xt])>>4;if((He+=15&ot)>xt){mt&&nc(0);break}if(ot||nc(2),Ur<256)Be[lt++]=Ur;else{if(Ur==256){Vr=He,kt=null;break}var Or=Ur-254;Ur>264&&(Or=rc(Pe,He,(1<<(Ir=y5[Tr=Ur-257]))-1)+b5[Tr],He+=Ir);var Dn=Tt[tM(Pe,He)&gr],pi=Dn>>4;if(Dn||nc(3),He+=15&Dn,Nt=poe[pi],pi>3){var Ir=_5[pi];Nt+=tM(Pe,He)&(1<<Ir)-1,He+=Ir}if(He>xt){mt&&nc(0);break}Ct&&at(lt+131072);var ti=lt+Or;if(lt<Nt){var Gn=0-Nt,En=Math.min(Nt,ti);for(Gn+lt<0&&nc(3);lt<En;++lt)Be[lt]=(void 0)[Gn+lt]}for(;lt<ti;++lt)Be[lt]=Be[lt-Nt]}}Ne.l=kt,Ne.p=Vr,Ne.b=lt,Ne.f=St,kt&&(St=1,Ne.m=tr,Ne.d=Tt,Ne.n=Zt)}while(!St);return lt!=Be.length&&dt?(wt=Be,((At=lt)==null||At>wt.length)&&(At=wt.length),new nl(wt.subarray(0,At))):Be.subarray(0,lt)}(he.subarray(me,-8),{i:2},new nl(((ae=he)[(de=ae.length)-4]|ae[de-3]<<8|ae[de-2]<<16|ae[de-1]<<24)>>>0))));var ae,de,he,me;const ke=xoe[te];if(!ke)throw new Error(`Unhandled codec: ${te}`);const Ee=new globalThis.DecompressionStream(ke);return new Response(new Blob([J]).stream().pipeThrough(Ee)).arrayBuffer().then(Pe=>new Uint8Array(Pe))}(j,D).then(J=>(function(te,ae){te.readFields(soe,ae)}(new rM(J),H),new woe[S](H.buffer))),W.then(J=>{for(let te=R.length-1;te>=0;te--)switch(R[te]){case"delta_filter":loe(J,A);break;case"zigzag_filter":coe(J);break;case"bitshuffle_filter":uoe(J,S);break;default:throw new Sl(`Unhandled filter "${R[te]}"`)}return{layerName:p,blockIndex:C,data:J}}).catch(J=>{throw J})}))},Wt(A5,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Wt(aT,"MapboxRasterTile"),Wt(E5,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class P5{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const d=i[a];this._stringToNumber[d]=a,this._numberToString[a]=d}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const Soe=["id","tile","layer","source","sourceLayer","state"];class ry{constructor(i,a,d,p,y){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=d,this._y=p,this.properties=i.properties,this.id=y}clone(){const i=new ry(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of Soe)this[a]!==void 0&&(i[a]=this[a]);return i}}class C5{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Zc(Lt,16,0),this.featureIndexArray=new iS,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,a,d,p,y,_=0,S=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,p,y,_);const C=this.grid;for(let R=0;R<a.length;R++){const D=a[R],j=[1/0,1/0,-1/0,-1/0];for(let H=0;H<D.length;H++){const W=D[H];j[0]=Math.min(j[0],W.x),j[1]=Math.min(j[1],W.y),j[2]=Math.max(j[2],W.x),j[3]=Math.max(j[3],W.y)}S!==0&&(j[0]-=S,j[1]-=S,j[2]+=S,j[3]+=S),j[0]<Lt&&j[1]<Lt&&j[2]>=0&&j[3]>=0&&C.insert(A,j[0],j[1],j[2],j[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Jt(new LS(this.rawTileData)).layers,this.sourceLayerCoder=new P5(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a){const{tilespaceGeometry:d,transform:p,tileTransform:y,pixelPosMatrix:_,availableImages:S,worldview:A}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const C=d.bufferedTilespaceBounds,R=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(W,J,te,ae)=>Ei(d.bufferedTilespaceGeometry,W,J,te,ae));R.sort(Toe);let D=null;p.elevation&&R.length>0&&(D=Jg.create(p.elevation,this.tileID));const j={};let H;for(let W=0;W<R.length;W++){const J=R[W];if(J===H)continue;H=J;const te=this.featureIndexArray.get(J);let ae=null;this.is3DTile?this.loadMatchingModelFeature(j,te,i,d,p,A):this.loadMatchingFeature(j,te,i,S,A,(de,he,me,ke=0)=>(ae||(ae=De(de,this.tileID.canonical,y)),he.queryIntersectsFeature(d,de,me,ae,this.z,p,_,D,ke)))}return j}loadMatchingFeature(i,a,d,p,y,_){const{featureIndex:S,bucketIndex:A,sourceLayerIndex:C,layoutVertexArrayOffset:R}=a,D=this.bucketLayerIDs[A],j=d.layers,H=Object.keys(j);if(H.length&&!Wr(H,D))return;const W=d.sourceCache,J=this.sourceLayerCoder.decode(C),te=this.vtLayers[J].feature(S),ae=this.getId(te,J);for(let de=0;de<D.length;de++){const he=D[de];if(!j[he])continue;const{styleLayer:me,targets:ke}=j[he];let Ee={};ae!==void 0&&(Ee=W.getFeatureState(me.sourceLayer,ae));const Pe=!_||_(te,me,Ee,R);if(!Pe)continue;const Ne=new ry(te,this.z,this.x,this.y,ae);Ne.tile=this.tileID.canonical,Ne.state=Ee;let Be=this.serializedLayersCache.get(he);Be||(Be=me.serialize(),Be.id=he,this.serializedLayersCache.set(he,Be)),Ne.source=Be.source,Ne.sourceLayer=Be["source-layer"],Ne.layer=et({},Be),Ne.layer.paint=I5(Be.paint,me.paint,te,Ee,p),Ne.layer.layout=I5(Be.layout,me.layout,te,Ee,p);let ct=!1;for(const Ue of ke){this.updateFeatureProperties(Ne,Ue);const{filter:dt}=Ue;if(dt){if(te.properties=Ne.properties,dt.needGeometry){const Ct=st(te,!0);if(!dt.filter(new Rn(this.tileID.overscaledZ,{worldview:y}),Ct,this.tileID.canonical))continue}else if(!dt.filter(new Rn(this.tileID.overscaledZ,{worldview:y}),te))continue}ct=!0,Ue.targetId&&this.addFeatureVariant(Ne,Ue)}ct&&this.appendToResult(i,he,S,Ne,Pe)}}loadMatchingModelFeature(i,a,d,p,y,_){const{featureIndex:S,bucketIndex:A}=a,C=this.bucketLayerIDs[A],R=d.layers,D=Object.keys(R);if(!D.length||Wr(D,C))for(let j=0;j<C.length;j++){const H=C[j],{styleLayer:W,targets:J}=R[H];if(W.type!=="model")continue;const te=p.tile,ae=te.getBucket(W);if(!(ae&&ae instanceof eT))continue;const de=Iie(ae,S,p,y);if(!de)continue;const{z:he,x:me,y:ke}=te.tileID.canonical,{feature:Ee,intersectionZ:Pe,position:Ne}=de;let Be={};Ee.id!==void 0&&(Be=d.sourceCache.getFeatureState(W.sourceLayer,Ee.id));const ct=new ry({},he,me,ke,Ee.id);ct.tile=this.tileID.canonical,ct.state=Be,ct.properties=Ee.properties,ct.geometry={type:"Point",coordinates:[Ne.lng,Ne.lat]};let Ue=this.serializedLayersCache.get(H);Ue||(Ue=W.serialize(),Ue.id=H,this.serializedLayersCache.set(H,Ue)),ct.source=Ue.source,ct.sourceLayer=Ue["source-layer"],ct.layer=et({},Ue);let dt=!1;for(const Ct of J){this.updateFeatureProperties(ct,Ct);const{filter:mt}=Ct;if(mt){if(Ee.properties=ct.properties,mt.needGeometry){if(!mt.filter(new Rn(this.tileID.overscaledZ,{worldview:_}),Ee,this.tileID.canonical))continue}else if(!mt.filter(new Rn(this.tileID.overscaledZ,{worldview:_}),Ee))continue}dt=!0,Ct.targetId&&this.addFeatureVariant(ct,Ct)}dt&&this.appendToResult(i,H,S,ct,Pe)}}updateFeatureProperties(i,a,d){if(a.properties){const p={};for(const y in a.properties){const _=a.properties[y].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,d);_!=null&&(p[y]=_)}i.properties=p}}addFeatureVariant(i,a,d){const p={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(p.properties=i.properties),i.variants=i.variants||{},i.variants[a.targetId]=i.variants[a.targetId]||[],i.variants[a.targetId].push(p)}appendToResult(i,a,d,p,y){let _=i[a];_===void 0&&(_=i[a]=[]),_.push({featureIndex:d,feature:p,intersectionZ:y})}lookupSymbolFeatures(i,a,d,p,y,_){const S={};this.loadVTLayers();for(const A of i)this.loadMatchingFeature(S,{bucketIndex:a,sourceLayerIndex:d,featureIndex:A,layoutVertexArrayOffset:0},p,y,_);return S}loadFeature(i){const{featureIndex:a,sourceLayerIndex:d}=i;this.loadVTLayers();const p=this.sourceLayerCoder.decode(d),y=this.vtFeatures[p];if(y[a])return y[a];const _=this.vtLayers[p].feature(a);return y[a]=_,_}hasLayer(i){for(const a of this.bucketLayerIDs)for(const d of a)if(i===d)return!0;return!1}getId(i,a){let d=i.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const y=Wu(p);if(y.result!=="success"){const _=y.value.map(S=>`${S.key}: ${S.message}`).join(", ");return void qr(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=y.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Kf),d=this.promoteIdExpression.evaluate({zoom:0},i)}else d=i.properties[p];typeof d=="boolean"&&(d=Number(d))}return d}}function I5(c,i,a,d,p){return br(c,(y,_)=>{const S=i instanceof tl?i.get(_):null;return S&&S.evaluate?S.evaluate(a,d,void 0,p):S})}function Toe(c,i){return i-c}Wt(C5,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const M5=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class nM{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,d]=new Uint8Array(i,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=d>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const y=M5[15&d];if(!y)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(i,2,1),[S]=new Uint32Array(i,4,1);return new nM(S,_,y,i)}constructor(i,a=64,d=Float64Array,p){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=d,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const y=M5.indexOf(this.ArrayType),_=2*i*this.ArrayType.BYTES_PER_ELEMENT,S=i*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-S%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${d}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+A,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+_+S+A),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+A,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=i)}add(i,a){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=i,this.coords[this._pos++]=a,d}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return iM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,a,d,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:_,nodeSize:S}=this,A=[0,y.length-1,0],C=[];for(;A.length;){const R=A.pop()||0,D=A.pop()||0,j=A.pop()||0;if(D-j<=S){for(let te=j;te<=D;te++){const ae=_[2*te],de=_[2*te+1];ae>=i&&ae<=d&&de>=a&&de<=p&&C.push(y[te])}continue}const H=j+D>>1,W=_[2*H],J=_[2*H+1];W>=i&&W<=d&&J>=a&&J<=p&&C.push(y[H]),(R===0?i<=W:a<=J)&&(A.push(j),A.push(H-1),A.push(1-R)),(R===0?d>=W:p>=J)&&(A.push(H+1),A.push(D),A.push(1-R))}return C}within(i,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:_}=this,S=[0,p.length-1,0],A=[],C=d*d;for(;S.length;){const R=S.pop()||0,D=S.pop()||0,j=S.pop()||0;if(D-j<=_){for(let te=j;te<=D;te++)k5(y[2*te],y[2*te+1],i,a)<=C&&A.push(p[te]);continue}const H=j+D>>1,W=y[2*H],J=y[2*H+1];k5(W,J,i,a)<=C&&A.push(p[H]),(R===0?i-d<=W:a-d<=J)&&(S.push(j),S.push(H-1),S.push(1-R)),(R===0?i+d>=W:a+d>=J)&&(S.push(H+1),S.push(D),S.push(1-R))}return A}}function iM(c,i,a,d,p,y){if(p-d<=a)return;const _=d+p>>1;O5(c,i,_,d,p,y),iM(c,i,a,d,_-1,1-y),iM(c,i,a,_+1,p,1-y)}function O5(c,i,a,d,p,y){for(;p>d;){if(p-d>600){const C=p-d+1,R=a-d+1,D=Math.log(C),j=.5*Math.exp(2*D/3),H=.5*Math.sqrt(D*j*(C-j)/C)*(R-C/2<0?-1:1);O5(c,i,a,Math.max(d,Math.floor(a-R*j/C+H)),Math.min(p,Math.floor(a+(C-R)*j/C+H)),y)}const _=i[2*a+y];let S=d,A=p;for(xx(c,i,d,a),i[2*p+y]>_&&xx(c,i,d,p);S<A;){for(xx(c,i,S,A),S++,A--;i[2*S+y]<_;)S++;for(;i[2*A+y]>_;)A--}i[2*d+y]===_?xx(c,i,d,A):(A++,xx(c,i,A,p)),A<=a&&(d=A+1),a<=A&&(p=A-1)}}function xx(c,i,a,d){oM(c,a,d),oM(i,2*a,2*d),oM(i,2*a+1,2*d+1)}function oM(c,i,a){const d=c[i];c[i]=c[a],c[a]=d}function k5(c,i,a,d){const p=c-a,y=i-d;return p*p+y*y}o.$=wo,o.A=Xl,o.B=Yl,o.C=cd,o.D=Vg,o.E=Nu,o.F=2,o.G=sx,o.H=iB,o.I=zs,o.J=Nc,o.K=class extends QS{},o.L=zu,o.M=Y1,o.N=_g,o.O=yg,o.P=ut,o.Q=$1,o.R=zf,o.S=s0,o.T=vI,o.U=cp,o.V=QS,o.W=a0,o.X=Wu,o.Y=ng,o.Z=ed,o._=Qh,o.a=function(c){return Oo.API_CDN_URL_REGEX.test(c)},o.a$=gt,o.a0=Iv,o.a1=up,o.a2=vg,o.a3=B1,o.a4=function(c){const i=c.value;let a=[];if(!i)return a;const d=Nc(i);return d!=="string"?(a=a.concat([new QS(c.key,i,`string expected, "${d}" found`)]),a):(WI(i,!0)||(a=a.concat([new QS(c.key,i,`invalid url "${i}"`)])),a)},o.a5=Ve,o.a6=lp,o.a7=xi,o.a8=Mt,o.a9=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return Ui(c.expression.evaluate(i))}interpolate(c,i,a){return{x:lr(c.x,i.x,a),y:lr(c.y,i.y,a),z:lr(c.z,i.z,a),azimuthal:lr(c.azimuthal,i.azimuthal,a),polar:lr(c.polar,i.polar,a)}}},o.aA=Ci,o.aB=Jo,o.aC=Fo,o.aD=Q,o.aE=je,o.aF=function(c,i){const a={};for(let d=0;d<i.length;d++){const p=i[d];p in c&&(a[p]=c[p])}return a},o.aG=q,o.aH=oe,o.aI=class{constructor(c){this.entries={},this.scheduler=c}request(c,i,a,d){const p=this.entries[c]=this.entries[c]||{callbacks:[]};if(p.result){const[y,_]=p.result;return this.scheduler?this.scheduler.add(()=>{d(y,_)},i):d(y,_),()=>{}}return p.callbacks.push(d),p.cancel||(p.cancel=a((y,_)=>{p.result=[y,_];for(const S of p.callbacks)this.scheduler?this.scheduler.add(()=>{S(y,_)},i):S(y,_);setTimeout(()=>delete this.entries[c],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(y=>y!==d),p.callbacks.length||(p.cancel(),delete this.entries[c]))}}},o.aJ=function(c,i,a){const d=JSON.stringify(c.request);return c.data&&(this.deduped.entries[d]={result:[null,c.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},p=>{const y=Ff(c.request,(_,S,A,C)=>{_?p(_):S&&p(null,{vectorTile:a?void 0:new Jt(new LS(S)),rawData:S,cacheControl:A,expires:C})});return()=>{y.cancel(),p()}},i)},o.aK=function(c){Tv++,Tv>Zl&&(c.getActor().send("enforceCacheSizeLimit",Qa),Tv=0)},o.aL=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},o.aM=Wi,o.aN=RB,o.aO=FB,o.aP=kB,o.aQ=function(c,i){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let d=0;d<c.length;d++){const p=document.createElement("source");dC(c[d])||(a.crossOrigin="Anonymous"),p.src=c[d],a.appendChild(p)}return{cancel:()=>{}}},o.aR=ex,o.aS=function(c){return fetch(c).then(i=>i.arrayBuffer()).then(i=>uF(i,0,c))},o.aT=_F,o.aU=class{constructor(c,i,a,d){this.id=c,this.position=i!=null?new F(i[0],i[1]):new F(0,0),this.orientation=a??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new Fr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,i){if(U(c.matrix,i,c.matrix),c.meshes)for(const a of c.meshes){const d=Fr.applyTransformFast(a.aabb,c.matrix);this.aabb.encapsulate(d)}if(c.children)for(const a of c.children)this._applyTransformations(a,c.matrix)}computeBoundsAndApplyParent(){const c=z([]);for(const i of this.nodes)this._applyTransformations(i,c)}computeModelMatrix(c,i,a,d,p,y,_=!1){gF(this.matrix,this,c.transform,this.position,i,a,d,p,y,_)}upload(c){if(!this.uploaded){for(const i of this.nodes)wI(i,c);for(const i of this.nodes)DS(i);this.uploaded=!0}}destroy(){for(const c of this.nodes)SI(c)}},o.aV=yr,o.aW=cx,o.aX=ue,o.aY=pe,o.aZ=hd,o.a_=ii,o.aa=Rn,o.ab=qc,o.ac=Te,o.ad=nr,o.ae=Ye,o.af=Fe,o.ag=tl,o.ah=wd,o.ai=lr,o.aj=Lt,o.ak=m1,o.al=Br,o.am=Sn,o.an=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return function([a,d]){const p=Ui([1,a,d]);return{x:p.x,y:p.y,z:p.z}}(c.expression.evaluate(i))}interpolate(c,i,a){return{x:lr(c.x,i.x,a),y:lr(c.y,i.y,a),z:lr(c.z,i.z,a)}}},o.ao=function(c,i,a=0,d=!0){const p=new ut(a,a),y=c.sub(p),_=i.add(p),S=[y,new ut(_.x,y.y),_,new ut(y.x,_.y)];return d&&S.push(y.clone()),S},o.ap=function(c,i){const a=[];for(let d=0;d<c.length;d++){const p=rt(d-1,-1,c.length-1),y=rt(d+1,-1,c.length-1),_=c[d],S=c[y],A=c[p].sub(_).unit(),C=S.sub(_).unit(),R=C.angleWithSep(A.x,A.y),D=A.add(C).unit().mult(-1*i/Math.sin(R/2));a.push(_.add(D))}return a},o.aq=_B,o.ar=Ei,o.as=function(c,i,a=0){return Le(((i.x-a)*c.scale-c.x)*Lt,(i.y*c.scale-c.y)*Lt,ge(i.z,i.y))},o.at=Yr,o.au=Er,o.av=sn,o.aw=IF,o.ax=function(c){let i=1/0,a=1/0,d=-1/0,p=-1/0;for(const y of c)i=Math.min(i,y.x),a=Math.min(a,y.y),d=Math.max(d,y.x),p=Math.max(p,y.y);return{min:new ut(i,a),max:new ut(d,p)}},o.ay=xe,o.az=U,o.b=function(c){return Oo.API_FONTS_REGEX.test(c)},o.b$=NI,o.b0=tS,o.b1=XS,o.b2=function(){_l.isLoading()||_l.isLoaded()||p0()!=="deferred"||Z1()},o.b3=ad,o.b4=st,o.b5=ry,o.b6=mn,o.b7=AI,o.b8=iI,o.b9=De,o.bA=function(c,i){const{x:a,y:d}=c.point,p=J3(a,d,c.worldSize/c._pixelsPerMercatorPixel,0,0);return U(p,p,ZC(tu(i)))},o.bB=E,o.bC=Pn,o.bD=function(c,i){return Math.hypot(i[0]-c[0],i[1]-c[1],i[2]-c[2])},o.bE=It,o.bF=Pr,o.bG=Kt,o.bH=ox,o.bI=ha,o.bJ=RI,o.bK=function(c,i,a,d,p){const y=5*i+2;c.float32[y+0]=a,c.float32[y+1]=d,c.float32[y+2]=p},o.bL=ZS,o.bM=cs,o.bN=Ya,o.bO=Ea,o.bP=Es,o.bQ=rt,o.bR=function(c,i,a,d){var p=new b(4);return p[0]=c,p[1]=i,p[2]=a,p[3]=d,p},o.bS=PS,o.bT=Nn,o.bU=Eo,o.bV=Iz,o.bW=BB,o.bX=Rz,o.bY=aI,o.bZ=kI,o.b_=hB,o.ba=Os,o.bb=C0,o.bc=W3,o.bd=ci,o.be=Bg,o.bf=GI,o.bg=function(c,i){const a=wd(i.zoom);if(a===0)return tu(c);const d=gS(c),p=qC(d),y=Q(d.getWest())*i.worldSize,_=Q(d.getEast())*i.worldSize,S=oe(d.getNorth())*i.worldSize,A=oe(d.getSouth())*i.worldSize,C=[y,S,0],R=[_,S,0],D=[y,A,0],j=[_,A,0],H=$([],i.globeMatrix);return nr(C,C,H),nr(R,R,H),nr(D,D,H),nr(j,j,H),p[0]=Qu(p[0],D,a),p[1]=Qu(p[1],j,a),p[2]=Qu(p[2],R,a),p[3]=Qu(p[3],C,a),Fr.fromPoints(p)},o.bh=_S,o.bi=$,o.bj=z0,o.bk=Qu,o.bl=ud,o.bm=rre,o.bn=le,o.bo=G,o.bp=aT,o.bq=LS,o.br=Ff,o.bs=function(c,i){const a=[];for(const d in c)d in i||a.push(d);return a},o.bt=$e,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=Zn,o.bw=function(c){var i=new b(16);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=c[3],i[4]=c[4],i[5]=c[5],i[6]=c[6],i[7]=c[7],i[8]=c[8],i[9]=c[9],i[10]=c[10],i[11]=c[11],i[12]=c[12],i[13]=c[13],i[14]=c[14],i[15]=c[15],i},o.bx=z,o.by=ee,o.bz=B,o.c=zm,o.c$=45,o.c0=nM,o.c1=_t,o.c2=Si,o.c3=fo,o.c4=function(c,i,a){a*=.5;var d=i[0],p=i[1],y=i[2],_=i[3],S=Math.sin(a),A=Math.cos(a);return c[0]=d*A+p*S,c[1]=p*A-d*S,c[2]=y*A+_*S,c[3]=_*A-y*S,c},o.c5=Ta,o.c6=fi,o.c7=function(c,i){return c[0]=-i[0],c[1]=-i[1],c[2]=-i[2],c[3]=i[3],c},o.c8=Ce,o.c9=function(c,i,a,d,p){var y,_=1/Math.tan(i/2);return c[0]=_/a,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=_,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,p!=null&&p!==1/0?(c[10]=(p+d)*(y=1/(d-p)),c[14]=2*p*d*y):(c[10]=-1,c[14]=-2*d),c},o.cA=la,o.cB=X3,o.cC=function(c,i,a,d,p,y,_,S,A){if(A.name==="globe")return X3(c,i,new la(a,d,p),!1);const C=cx({z:a,x:d,y:p},A);return new Fr([(y+C.x/C.scale)*i,i*(C.y/C.scale),_],[(y+C.x2/C.scale)*i,i*(C.y2/C.scale),S])},o.cD=function(c,i,a){return c[0]=Math.min(i[0],a[0]),c[1]=Math.min(i[1],a[1]),c[2]=Math.min(i[2],a[2]),c[3]=Math.min(i[3],a[3]),c},o.cE=function(c,i,a){return c[0]=Math.max(i[0],a[0]),c[1]=Math.max(i[1],a[1]),c[2]=Math.max(i[2],a[2]),c[3]=Math.max(i[3],a[3]),c},o.cF=function(c){const i=Math.round((c+45+360)%360/90)%4;return se[i]},o.cG=be,o.cH=No,o.cI=m,o.cJ=function(c){const i=z(new Float64Array(16));U(i,c.pixelMatrix,c.globeMatrix);const a=[0,x,0],d=[0,w,0];return nr(a,a,i),nr(d,d,i),[a[0]>0&&a[0]<=c.width&&a[1]>0&&a[1]<=c.height&&!KC(c,new F(c.center.lat,90)),d[0]>0&&d[0]<=c.width&&d[1]>0&&d[1]<=c.height&&!KC(c,new F(c.center.lat,-90))]},o.cK=function(c,i){const{scale:a}=c.tileTransform,d=a*Lt/(c.tileSize*Math.pow(2,i.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return function(p,y,_){var S=y[1],A=y[2],C=y[3],R=_[0],D=_[1];return p[0]=y[0]*R,p[1]=S*R,p[2]=A*D,p[3]=C*D,p}(new Float32Array(4),i.inverseAdjustmentMatrix,[d,d])},o.cL=kS,o.cM=Oe,o.cN=hF,o.cO=function(c){const i=hF(c,!0);return E([],[i[0],i[1],i[4],i[5]])},o.cP=Z,o.cQ=un,o.cR=ne,o.cS=function(c){const{x:i,y:a}=c.point,{lng:d,lat:p}=c._center;return J3(i,a,c.worldSize,d,p)},o.cT=Ze,o.cU=Ge,o.cV=ca,o.cW=gi,o.cX=fS,o.cY=function(c,i,a){let d=0;for(let p=0;p<2;++p)c[p]>0&&(d+=(c[p]-0)*(c[p]-0)),i[p]<0&&(d+=(0-i[p])*(0-i[p]));return d},o.cZ=function(c){return c*c*c*c*c},o.c_=re,o.ca=function(c,i,a,d,p,y,_){var S=1/(i-a),A=1/(d-p),C=1/(y-_);return c[0]=-2*S,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*A,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*C,c[11]=0,c[12]=(i+a)*S,c[13]=(p+d)*A,c[14]=(_+y)*C,c[15]=1,c},o.cb=ie,o.cc=function(c,i,a){c[4*i+0]=a[0],c[4*i+1]=a[1],c[4*i+2]=a[2],c[4*i+3]=a[3]},o.cd=Fg,o.ce=_d,o.cf=Ri,o.cg=bl,o.ch=_p,o.ci=F,o.cj=SB,o.ck=function(){var c=new b(4);return b!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},o.cl=function(c,i,a){var d=i[0],p=i[1],y=i[2],_=i[3],S=Math.sin(a),A=Math.cos(a);return c[0]=d*A+y*S,c[1]=p*A+_*S,c[2]=d*-S+y*A,c[3]=p*-S+_*A,c},o.cm=function(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]&&c[3]===i[3]},o.cn=Hr,o.co=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},o.cp=Xa,o.cq=Ft,o.cr=wl,o.cs=3,o.ct=2,o.cu=7,o.cv=6,o.cw=Qt,o.cx=Me,o.cy=gn,o.cz=dF,o.d=function(c){return Oo.API_TILEJSON_REGEX.test(c)},o.d$=(c,i,a,d,p,y,_,S,A,C)=>{const R=c.transform,D=R.calculatePixelsToTileUnitsMatrix(i),j=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",H=R.pitch<15?MF(.07,.7,xe((14-R.zoom)/5,0,1)):.07;return{u_matrix:kF(c,i,a,d),u_pixels_to_tile_units:D,u_device_pixel_ratio:y,u_width_scale:_,u_floor_width_scale:S,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:DF(a)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:OF(i,c.transform),u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(j?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:H,u_tile_to_meter:Se(i.tileID.canonical,0),u_ground_shadow_factor:C}},o.d0=yp,o.d1=function(c,i,a){const d=Math.sqrt(c*c+i*i+a*a),p=d>0?Math.acos(a/d)*qo:0;let y=c!==0||i!==0?Math.atan2(-i,-c)*qo+90:0;return y<0&&(y+=360),[d,y,p]},o.d2=Le,o.d3=Ui,o.d4=Se,o.d5=Je,o.d6=Fr,o.d7=it,o.d8=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},o.d9=WI,o.dA=gS,o.dB=function(c){const i=be-5;c=xe(c,-i,i)/i*90;const a=Math.pow(Math.abs(Math.sin(Br(c))),3);return Math.round(a*(g.length-1))},o.dC=function(c,i,a,d){const p=i.getNorth(),y=i.getSouth(),_=i.getWest(),S=i.getEast(),A=1<<c.z,C=S-_,R=p-y,D=C/u,j=-R/g[a],H=[0,D,0,j,0,0,p,_,0];if(c.z>0){const W=180/d;L(H,H,[W/C+1,0,0,0,W/R+1,0,-.5*W/D,.5*W/j,1])}return H[2]=A,H[5]=c.x,H[8]=c.y,H},o.dD=tu,o.dE=function(c,i,a){const d=z(new Float64Array(16)),p=(i/(1<<c)-.5)*Math.PI*2;return Y(d,a.globeMatrix,p),Float32Array.from(d)},o.dF=class{isDataAvailableAtPoint(c){const i=this._source();if(this.isUsingMockSource()||!i||c.y<0||c.y>1)return!1;const a=i.getSource().maxzoom,d=1<<a,p=Math.floor(c.x),y=Math.floor((c.x-p)*d),_=Math.floor(c.y*d),S=this.findDEMTileFor(new Wi(a,p,a,y,_));return!(!S||!S.dem)}getAtPointOrZero(c,i=0){return this.getAtPoint(c,i)||0}getAtPoint(c,i,a=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const d=this._source();if(!d||c.y<0||c.y>1)return i;const p=d.getSource().maxzoom,y=1<<p,_=Math.floor(c.x),S=c.x-_,A=new Wi(p,_,p,Math.floor(S*y),Math.floor(c.y*y)),C=this.findDEMTileFor(A);if(!C||!C.dem)return i;const R=C.dem,D=1<<C.tileID.canonical.z,j=(S*D-C.tileID.canonical.x)*R.dim,H=(c.y*D-C.tileID.canonical.y)*R.dim,W=Math.floor(j),J=Math.floor(H);return(a?this.exaggeration():1)*lr(lr(R.get(W,J),R.get(W,J+1),H-J),lr(R.get(W+1,J),R.get(W+1,J+1),H-J),j-W)}getAtTileOffset(c,i,a){const d=1<<c.canonical.z;return this.getAtPointOrZero(new Te(c.wrap+(c.canonical.x+i/Lt)/d,(c.canonical.y+a/Lt)/d))}getAtTileOffsetFunc(c,i,a,d){return p=>{const y=this.getAtTileOffset(c,p.x,p.y),_=d.upVector(c.canonical,p.x,p.y);return _t(_,_,y*d.upVectorScale(c.canonical,i,a).metersToTile),_}}getForTilePoints(c,i,a,d){if(this.isUsingMockSource())return!1;const p=Jg.create(this,c,d);return!!p&&(i.forEach(y=>{y[2]=this.exaggeration()*p.getElevationAt(y[0],y[1],a)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(c);if(!i||!i.dem)return null;const a=i.dem.tree,d=i.tileID,p=1<<c.canonical.z-d.canonical.z;let y=c.canonical.x/p-d.canonical.x,_=c.canonical.y/p-d.canonical.y,S=0;for(let A=0;A<c.canonical.z-d.canonical.z&&!a.leaves[S];A++){y*=2,_*=2;const C=2*Math.floor(_)+Math.floor(y);S=a.childOffsets[S]+C,y%=1,_%=1}return{min:this.exaggeration()*a.minimums[S],max:this.exaggeration()*a.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let i=!1,a=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const p of c){const y=this.getMinMaxForTile(p.tileID);y&&(a=Math.min(a,y.min),d=Math.max(d,y.max),i=!0)}return i?{min:a,max:d}:null}},o.dG=hz,o.dH=mS,o.dI=function(c,i){return[Math.pow(c[0],2.2)*i,Math.pow(c[1],2.2)*i,Math.pow(c[2],2.2)*i]},o.dJ=P,o.dK=function(c,i){var a=Math.sin(i),d=Math.cos(i);return c[0]=d,c[1]=a,c[2]=0,c[3]=-a,c[4]=d,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},o.dL=xr,o.dM=Y3,o.dN=As,o.dO=Zo,o.dP=256,o.dQ=function(c,i){const a=[0,0,0];return nr(a,a,_S(tu(i.canonical))),nr(a,a,c),a},o.dR=c=>({u_matrix:new _p(c),u_texsize:new bl(c),u_pixels_to_tile_units:new j0(c),u_device_pixel_ratio:new Ri(c),u_width_scale:new Ri(c),u_floor_width_scale:new Ri(c),u_image:new Fg(c),u_units_to_pixels:new bl(c),u_tile_units_to_pixels:new Ri(c),u_alpha_discard_threshold:new Ri(c),u_trim_offset:new bl(c),u_trim_fade_range:new bl(c),u_trim_color:new yp(c),u_emissive_strength:new Ri(c),u_zbias_factor:new Ri(c),u_tile_to_meter:new Ri(c),u_ground_shadow_factor:new _d(c),u_pattern_transition:new Ri(c)}),o.dS=c=>({u_matrix:new _p(c),u_pixels_to_tile_units:new j0(c),u_device_pixel_ratio:new Ri(c),u_width_scale:new Ri(c),u_floor_width_scale:new Ri(c),u_units_to_pixels:new bl(c),u_dash_image:new Fg(c),u_gradient_image:new Fg(c),u_image_height:new Ri(c),u_texsize:new bl(c),u_tile_units_to_pixels:new Ri(c),u_alpha_discard_threshold:new Ri(c),u_trim_offset:new bl(c),u_trim_fade_range:new bl(c),u_trim_color:new yp(c),u_emissive_strength:new Ri(c),u_zbias_factor:new Ri(c),u_tile_to_meter:new Ri(c),u_ground_shadow_factor:new _d(c)}),o.dT=c=>({u_camera_to_center_distance:new Ri(c),u_extrude_scale:new j0(c),u_device_pixel_ratio:new Ri(c),u_matrix:new _p(c),u_inv_rot_matrix:new _p(c),u_merc_center:new bl(c),u_tile_id:new _d(c),u_zoom_transition:new Ri(c),u_up_dir:new _d(c),u_emissive_strength:new Ri(c)}),o.dU=pd,o.dV=Nne,o.dW=tz,o.dX=(c,i,a,d,p,y)=>{const _=c.transform,S=_.projection.name==="globe";let A;if(y.paint.get("circle-pitch-alignment")==="map")if(S){const R=Y3(_.zoom,i.canonical)*_._pixelsPerMercatorPixel;A=Float32Array.from([R,0,0,R])}else A=_.calculatePixelsToTileUnitsMatrix(a);else A=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(_.projection),u_matrix:c.translatePosMatrix(i.projMatrix,a,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ja.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:are,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:y.paint.get("circle-emissive-strength")};if(S){C.u_inv_rot_matrix=d,C.u_merc_center=p,C.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],C.u_zoom_transition=wd(_.zoom);const R=p[0]*Lt,D=p[1]*Lt;C.u_up_dir=_.projection.upVector(new la(0,0,0),R,D)}return C},o.dY=RF,o.dZ=Cs,o.d_=(c,i,a,d,p,y,_,S,A,C)=>{const R=c.transform,D=R.pitch<15?MF(.07,.7,xe((14-R.zoom)/5,0,1)):.07,j=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:kF(c,i,a,d),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:R.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:p,u_width_scale:y,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:OF(i,R),u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(j?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:Se(i.tileID.canonical,0),u_ground_shadow_factor:A,u_pattern_transition:C}},o.da=function(c,i){return c.readFields(kie,{icons:[]},i)},o.db=CS,o.dc=Xg,o.dd=LI,o.de=Vm,o.df=q1,o.dg=Pa,o.dh=Uh,o.di=Nr,o.dj=function(c){const i=c.indexOf(hp);return i>=0?c.slice(0,i):c},o.dk=function(c){return c.indexOf(hp)>=0},o.dl=function(c){const i=c.lastIndexOf(hp);return i>=0?c.slice(i+1):""},o.dm=function(c){const i=[],a=c.id;return a===void 0&&i.push({message:`layers.${a}: missing required property "id"`}),c.render===void 0&&i.push({message:`layers.${a}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},o.dn=function(c,i,a,d){return c.type==="custom"?new Aie(c,i):new Mie[c.type](c,i,a,d)},o.dp=Gr,o.dq=function(c){const i=c.indexOf(hp);return i>=0?c.slice(i+1):""},o.dr=class extends ry{constructor(c,i){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},o.ds=f0,o.dt=$h,o.du=function(c){return c({pluginStatus:fs,pluginURL:Xc}),f0.on("pluginStateChange",c),c},o.dv=L0,o.dw=class extends ka{constructor(c){super(c),this.current=$C}set(c,i,a){if(this.fetchUniformLocation(c,i)){for(let d=0;d<9;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},o.dx=ce,o.dy=function(c,i,a){const d=wd(a.zoom),p=c.style.map._antialias,y=c.terrain&&c.terrain.exaggeration()>0;return d===0&&!p&&!y},o.dz=function(c){const i=c.pixelsPerMeter,a=i/ie(1,c.center.lat),d=z(new Float64Array(16));return G(d,d,[c.point.x,c.point.y,0]),Z(d,d,[a,a,i]),Float32Array.from(d)},o.e=Oo,o.e$=p0,o.e0=ar,o.e1=F0,o.e2=ge,o.e3=Ju,o.e4=AS,o.e5=Hz,o.e6=Td,o.e7=450,o.e8=7,o.e9=Ie,o.eA=function(c,i,a,d,p,y,_,S,A,C,R,D,j,H,W,J){var te=new b(16);return te[0]=c,te[1]=i,te[2]=a,te[3]=d,te[4]=p,te[5]=y,te[6]=_,te[7]=S,te[8]=A,te[9]=C,te[10]=R,te[11]=D,te[12]=j,te[13]=H,te[14]=W,te[15]=J,te},o.eB=k,o.eC=A0,o.eD=fp,o.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ut(1/0,1/0),max:new ut(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,i=!1){const a=Oz(new ut(0,0),new ut(Lt,Lt),c),d=[];if(i&&!oI(a,this._globalClipBounds))return d;for(const p of this._activeRegions){if(p.hiddenByOverlap||!oI(a,p))continue;const y=Lre(p.min,p.max,c);d.push({min:y.min,max:y.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return d}setSources(c){this._setSources(c.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const a=[];for(const d of i.cache.getVisibleCoordinates()){const p=i.cache.getTile(d).buckets[i.layer];p&&p.updateFootprints(d.toUnwrapped(),a)}return a},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(c){const i=c.getFootprints();if(i.length===0)return;const a=c.getOrder(),d=c.getClipMask(),p=c.getClipScope();for(const y of i){if(!y.footprint)continue;const _=Oz(y.footprint.min,y.footprint.max,y.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:y.id,footprint:y.footprint,order:a,clipMask:d,clipScope:p})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,a)=>i.priority-a.priority||SS(i.min,a.min)||SS(i.max,a.max)||i.order-a.order||i.clipMask-a.clipMask||function(d,p){const y=(_,S)=>_+S;return d.length-p.length||d.reduce(y,"").localeCompare(p.reduce(y,""))}(i.clipScope,a.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let i=0;for(;!c&&i!==this._activeRegions.length;){const a=this._activeRegions[i],d=this._prevRegions[i];c=a.priority!==d.priority||!Mz(a,d)||a.order!==d.order||a.clipMask!==d.clipMask||!Zn(a.clipScope,d.clipScope),++i}}if(c){++this._updateTime;for(const a of this._activeRegions)a.order!==H0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const i=a=>{const d=this._activeRegions;if(a>=d.length)return a;const p=d[a].priority;for(;a<d.length&&d[a].priority===p;)++a;return a};if(this._sourceIds.length>1){let a=0,d=i(a);for(;a!==d;){let p=a;const y=a;for(;p!==d;){const _=this._activeRegions[p];_.hiddenByOverlap=!1;for(let S=0;S<y;S++){const A=this._activeRegions[S];if(!A.hiddenByOverlap&&_.order===H0&&oI(_,A)&&(_.hiddenByOverlap=kz(_.footprint,_.tileId,A.footprint,A.tileId),_.hiddenByOverlap))break}++p}a=d,d=i(a)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=c.length-1;i>=0;i--)this._addSource(c[i]);this._computeReplacement()}},o.eF=H0,o.eG=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,i){const a=new Os,d=new ii,p=[],y=c+1+2,_=i[0]+1,S=i[0]+1+(1+i.length),A=(C,R,D)=>{let j=C===y-1?C-2:C===0?C:C-1;return j+=D?24575:0,[j,R]};for(let C=0;C<y;++C)a.emplaceBack(...A(C,0,!0));for(let C=0;C<_;++C)for(let R=0;R<y;++R)a.emplaceBack(...A(R,C,(R===0||R===y-1)&&!0));for(let C=0;C<i.length;++C){const R=i[C];for(let D=0;D<y;++D)a.emplaceBack(...A(D,R,!0))}for(let C=0;C<i.length;++C){const R=d.length,D=i[C]+1+2,j=new ii;for(let J=0;J<D-1;J++){const te=J===D-2,ae=te?y*(S-i.length+C-J):y;for(let de=0;de<y-1;de++){const he=J*y+de;J===0||te||de===0||de===y-2?(j.emplaceBack(he+1,he,he+ae),j.emplaceBack(he+ae,he+ae+1,he+1)):(d.emplaceBack(he+1,he,he+ae),d.emplaceBack(he+ae,he+ae+1,he+1))}}const H=ci.simpleSegment(0,R,a.length,d.length-R);for(let J=0;J<j.uint16.length;J+=3)d.emplaceBack(j.uint16[J],j.uint16[J+1],j.uint16[J+2]);const W=ci.simpleSegment(0,R,a.length,d.length-R);p.push({withoutSkirts:H,withSkirts:W})}return{vertices:a,indices:d,segments:p}}_createGrid(c){const i=this._fillGridMeshWithLods(u,g);this._gridSegments=i.segments,this._gridBuffer=c.createVertexBuffer(i.vertices,W3.members),this._gridIndexBuffer=c.createIndexBuffer(i.indices,!0)}_createPoles(c){const i=new ii;for(let _=0;_<=u;_++)i.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=c.createIndexBuffer(i,!0);const a=new Ku,d=new Ku,p=new Ku,y=new Ku;this._poleSegments=[];for(let _=0,S=0;_<fS;_++){const A=360/(1<<_);a.emplaceBack(0,-Jo,0,.5,0),d.emplaceBack(0,-Jo,0,.5,1),p.emplaceBack(0,-Jo,0,.5,.5),y.emplaceBack(0,-Jo,0,.5,.5);for(let C=0;C<=u;C++){let R=C/u,D=0;const j=lr(0,A,R),[H,W,J]=T(ore,sre,j,Jo);a.emplaceBack(H,W,J,R,D),d.emplaceBack(H,W,J,R,1-D);const te=Br(j);R=.5+.5*Math.sin(te),D=.5+.5*Math.cos(te),p.emplaceBack(H,W,J,R,D),y.emplaceBack(H,W,J,R,1-D)}this._poleSegments.push(ci.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(a,pS,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(d,pS,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(p,pS,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(y,pS,!1)}getGridBuffers(c,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},o.eH=Cz,o.eI=ye,o.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eK=Re,o.eL=we,o.eM=function(c,i,a){return c[0]=i[0]/a[0],c[1]=i[1]/a[1],c[2]=i[2]/a[2],c},o.eN=kn,o.eO=I,o.eP=Sr,o.eQ=Qe,o.eR=function([c,i,a]){const d=Math.hypot(c,i,a),p=Math.atan2(c,a),y=.5*Math.PI-Math.acos(-i/d);return new F(Ge(p),Ge(y))},o.eS=ho,o.eT=xI,o.eU=function(c){const i=c.navigator?c.navigator.userAgent:null;return!!function(a){if(vi==null){const d=a.navigator?a.navigator.userAgent:null;vi=!!a.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return vi}(c)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eV=function(c,i){Qa=c,Zl=i},o.eW=KC,o.eX=Q3,o.eY=function(c){const i=[0,0,0],a=z(new Float64Array(16));return U(a,c.pixelMatrix,c.globeMatrix),nr(i,i,a),new ut(i[0],i[1])},o.eZ=function(){const c=Y0;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(dI),Y0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.e_=function(){CS().acquire(dI)},o.ea=function(c,i){if(c===i){var a=i[1],d=i[2],p=i[3],y=i[6],_=i[7],S=i[11];c[1]=i[4],c[2]=i[8],c[3]=i[12],c[4]=a,c[6]=i[9],c[7]=i[13],c[8]=d,c[9]=y,c[11]=i[14],c[12]=p,c[13]=_,c[14]=S}else c[0]=i[0],c[1]=i[4],c[2]=i[8],c[3]=i[12],c[4]=i[1],c[5]=i[5],c[6]=i[9],c[7]=i[13],c[8]=i[2],c[9]=i[6],c[10]=i[10],c[11]=i[14],c[12]=i[3],c[13]=i[7],c[14]=i[11],c[15]=i[15];return c},o.eb=Eie,o.ec=Qr,o.ed=I0,o.ee=256,o.ef=ZC,o.eg=na,o.eh=Y,o.ei=function(c,i){return c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[4],c[4]=i[5],c[5]=i[6],c[6]=i[8],c[7]=i[9],c[8]=i[10],c},o.ej=Ku,o.ek=E0,o.el=N1,o.em=function(c,i,a,d,p){return xe((c-i)/(a-i)*(p-d)+d,d,p)},o.en=Za,o.eo=function(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=i[4],S=i[5],A=i[6],C=i[7],R=i[8],D=R*_-S*C,j=-R*y+S*A,H=C*y-_*A,W=a*D+d*j+p*H;return W?(c[0]=D*(W=1/W),c[1]=(-R*d+p*C)*W,c[2]=(S*d-p*_)*W,c[3]=j*W,c[4]=(R*a-p*A)*W,c[5]=(-S*a+p*y)*W,c[6]=H*W,c[7]=(-C*a+d*A)*W,c[8]=(_*a-d*y)*W,c):null},o.ep=2,o.eq=Kr,o.er=bI,o.es=[1,1,1],o.et=class{constructor(c,i,a,d){this.context=c,this.format=d,this.size=a,this.texture=c.gl.createTexture();const[p,y,_]=this.size,{gl:S}=c;S.bindTexture(S.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),S.texImage3D(S.TEXTURE_3D,0,this.format,p,y,_,0,yI(this.format),_I(this.format),i.data)}bind(c,i){const{context:a}=this,{gl:d}=a;d.bindTexture(d.TEXTURE_3D,this.texture),c!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,c),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,c),this.minFilter=c),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},o.eu=Jg,o.ev=jo,o.ew=function(c,i,a,d){var p=i[0],y=i[1],_=i[2],S=i[3];return c[0]=p+d*(a[0]-p),c[1]=y+d*(a[1]-y),c[2]=_+d*(a[2]-_),c[3]=S+d*(a[3]-S),c},o.ex=Wg,o.ey=xl,o.ez=Qc,o.f=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(i,a)=>String.fromCharCode(+("0x"+a))))},o.f0=function(c,i,a=!1){if(fs===Bs.deferred||fs===Bs.loading||fs===Bs.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xc=Ja.resolveURL(c),fs=Bs.deferred,h0=i,d0(),a||Z1()},o.f1=function(c){Ug=Ja.resolveURL(c),Gg||(Gg=new Vg(CS(),new Nu)),Gg.broadcast("setMeshoptUrl",Ug)},o.f2=iF,o.f3=function(c){pI=Ja.resolveURL(c),Gg||(Gg=new Vg(CS(),new Nu)),Gg.broadcast("setDracoUrl",pI)},o.f4=nF,o.f5=K0,o.f6=function(c){const i=Ru();if(!i)return;const a=i.delete(ql);c&&a.then(()=>c()).catch(c)},o.f7=Sp,o.f8=Wt,o.f9=Sd,o.fa=tc,o.fb=P5,o.fc=C5,o.fd=AF,o.fe=$t,o.ff="hd_road_elevation",o.fg=ui,o.fh=br,o.fi=bp,o.fj=DI,o.fk=Ap,o.fl=function(c,i,a,d,p,y,_,S=1,A,C,R){c.createArrays(),c.tilePixelRatio=Lt/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const D=c.layers[0].layout,j=c.layers[0]._unevaluatedLayout._values,H={};H.scaleFactor=S,H.textSizeScaleRange=D.get("text-size-scale-range"),H.iconSizeScaleRange=D.get("icon-size-scale-range");const[W,J]=H.textSizeScaleRange,[te,ae]=H.iconSizeScaleRange;H.textScaleFactor=xe(H.scaleFactor,W,J),H.iconScaleFactor=xe(H.scaleFactor,te,ae);const de=j["text-size"],he=j["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:Be,maxZoom:ct}=c.textSizeData;H.compositeTextSizes=[de.possiblyEvaluate(new Rn(Be,{worldview:R}),y),de.possiblyEvaluate(new Rn(ct,{worldview:R}),y)]}if(c.iconSizeData.kind==="composite"){const{minZoom:Be,maxZoom:ct}=c.iconSizeData;H.compositeIconSizes=[he.possiblyEvaluate(new Rn(Be,{worldview:R}),y),he.possiblyEvaluate(new Rn(ct,{worldview:R}),y)]}H.layoutTextSize=de.possiblyEvaluate(new Rn(_+1,{worldview:R}),y),H.layoutIconSize=he.possiblyEvaluate(new Rn(_+1,{worldview:R}),y),H.textMaxSize=de.possiblyEvaluate(new Rn(18,{worldview:R}),y);const me=D.get("symbol-placement"),ke=D.get("text-rotation-alignment")==="map"&&me!=="point",Ee=D.get("text-size");let Pe=!1;const Ne=[];for(const Be of c.features){const ct=D.get("text-font").evaluate(Be,{},y).join(","),Ue=Ee.evaluate(Be,{},y)*H.textScaleFactor,dt=H.layoutTextSize.evaluate(Be,{},y)*H.textScaleFactor,Ct=H.layoutIconSize.evaluate(Be,{},y)*H.iconScaleFactor,mt={horizontal:{},vertical:void 0},wt=Be.text;let At,at=[0,0];if(wt){const Gt=wt.toString(),hr=D.get("text-letter-spacing").evaluate(Be,{},y)*Eo,vr=D.get("text-line-height").evaluate(Be,{},y)*Eo,Cr=MC(Gt)?hr:0,Tr=D.get("text-anchor").evaluate(Be,{},y),Zr=D.get("text-variable-anchor");if(!Zr){const ot=D.get("text-radial-offset").evaluate(Be,{},y);if(ot)at=hB(Tr,[ot*Eo,jI]);else{const Rt=D.get("text-offset").evaluate(Be,{},y);at=[Rt[0]*Eo,Rt[1]*Eo]}}let jr=ke?"center":D.get("text-justify").evaluate(Be,{},y);const Yn=me==="point",_e=Yn?D.get("text-max-width").evaluate(Be,{},y)*Eo:1/0,ve=ot=>{c.allowVerticalPlacement&&u0(Gt)&&(mt.vertical=OI(wt,i,a,p,ct,_e,vr,Tr,ot,Cr,at,ha.vertical,!0,dt,Ue,A))};if(!ke&&Zr){const ot=jr==="auto"?Zr.map(zt=>NI(zt)):[jr];let Rt=!1;for(let zt=0;zt<ot.length;zt++){const Nt=ot[zt];if(!mt.horizontal[Nt])if(Rt)mt.horizontal[Nt]=mt.horizontal[0];else{const Xt=OI(wt,i,a,p,ct,_e,vr,"center",Nt,Cr,at,ha.horizontal,!1,dt,Ue,A);Xt&&(mt.horizontal[Nt]=Xt,Rt=Xt.positionedLines.length===1)}}ve("left")}else{if(jr==="auto"&&(jr=NI(Tr)),Yn||D.get("text-writing-mode").indexOf("horizontal")>=0||!u0(Gt)){const ot=OI(wt,i,a,p,ct,_e,vr,Tr,jr,Cr,at,ha.horizontal,!1,dt,Ue,A);ot&&(mt.horizontal[jr]=ot)}ve(Yn?"left":jr)}}let St,He,lt,kt,Tt,tr,Zt=!1;const xt=D.get("icon-text-fit").evaluate(Be,{},y);if(Be.icon&&Be.icon.hasPrimary()){const Gt=fB(Be.icon,c.iconSizeData,j["icon-size"],y,c.zoom,Be,A,H.iconScaleFactor,R);St=Gt.iconPrimary,lt=Gt.iconSecondary;const hr=St.toString();if(He=d.get(hr),He&&(Tt=D.get("icon-offset").evaluate(Be,{},y),tr=D.get("icon-anchor").evaluate(Be,{},y),At=tie(p.get(hr),lt?p.get(lt.toString()):void 0,Tt,tr),Zt=He.sdf,c.sdfIcons===void 0?c.sdfIcons=He.sdf:c.sdfIcons!==He.sdf&&qr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==c.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0)),lt){const vr=lt.toString();kt=d.get(vr)}}Pe=Pe||!(!Be.icon||!Be.icon.hasSecondary());const Et=zI(mt.horizontal)||mt.vertical;c.iconsInText||(c.iconsInText=!!Et&&Et.iconsInText);const Yt=dt*H.textScaleFactor/Eo,{defaultShapedIcon:Vt,verticallyShapedIcon:jt}=hie(c,At,D,Be,y,mt,Yt,Tt,xt);xt!=="none"&&At&&(XF(At)||KF(At))&&(BS(0,He,St,At,Vt,xt,C,d,p),BS(0,kt,lt,At,Vt,xt,C,d,p),jt&&(BS(0,He,St,At,jt,xt,C,d,p),BS(0,kt,lt,At,jt,xt,C,d,p))),At=Vt,Ne.push({feature:Be,shapedTextOrientations:mt,shapedText:Et,shapedIcon:At,iconPrimary:St,iconSecondary:lt,iconOffset:Tt,iconAnchor:tr,verticallyShapedIcon:jt,layoutTextSize:dt,layoutIconSize:Ct,textOffset:at,isSDFIcon:Zt,iconTextFit:xt})}return{featureData:Ne,sizes:H,hasAnySecondaryIcon:Pe,textAlongLine:ke,symbolPlacement:me}},o.fm=oB,o.fn=function(c,i,a,d,p,y,_,S,A,C){const{featureData:R,hasAnySecondaryIcon:D,sizes:j,textAlongLine:H,symbolPlacement:W}=i;for(const J of R){const{shapedIcon:te,verticallyShapedIcon:ae,feature:de,shapedTextOrientations:he,shapedText:me,layoutTextSize:ke,textOffset:Ee,isSDFIcon:Pe,iconPrimary:Ne,iconSecondary:Be,iconTextFit:ct,iconOffset:Ue}=J;pB(te,C.iconPositions,Ne,Be),pB(ae,C.iconPositions,Ne,Be),uie(he,C.iconPositions),cie(Ne,Be,C.iconPositions),(me||te)&&die(c,de,he,te,ae,A,j,ke,0,Ee,Pe,d,p,_,S,D,ct,Ue,H,W)}a&&c.generateCollisionDebugBuffers(y,c.collisionBoxArray,j.textScaleFactor)},o.fo=Jt,o.fp=sT,o.fq=Xe,o.fr=function(c){let i=0;if(new Uint32Array(c,0,1)[0]!==sF){const a=new Uint32Array(c,0,7),[,,d,p,y,_]=a;i=a.byteLength+p+y+_+y,(d!==c.byteLength||i>=c.byteLength)&&qr("Invalid b3dm header information.")}return uF(c,i)},o.fs=function(c,i){const a=_F(c);for(const d of a){for(const p of d.meshes)dne(p);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(fne(d.lights,i)))}return a},o.ft=eT,o.fu=jn,o.fv=tF,o.fw=_l,o.fx=Bs,o.fy=function(c){Fh(),gl?.then(i=>{i.keys().then(a=>{for(let d=0;d<a.length-c;d++)i.delete(a[d]).catch(p=>qr(p.message))}).catch(a=>qr(a.message))}).catch(i=>qr(i.message))},o.g=function(c,i){return $h(et(c,{method:"GET"}),i)},o.h=et,o.i=function(c){return Oo.API_STYLE_REGEX.test(c)&&!zm(c)},o.j=function(c){return c.indexOf("mapbox:")===0},o.k=Dc,o.l=Ev,o.m=function(c){return decodeURIComponent(atob(c).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.n=function(c,i){return $h(et(c,{type:"json"}),i)},o.o=$f,o.p=function(c,i){return $h(et(c,{method:"POST"}),i)},o.q=Ja,o.r=Bo,o.s=function(c){try{const i=self[c];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=$m,o.u=function(){return function c(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},o.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},o.w=qr,o.x=function(){return fI||(fI=new Sp),fI},o.y=QI,o.z=ea}),h(["./shared"],function(o){function v(Ge){const se=Ge?Ge.url.toString():void 0;return se?performance.getEntriesByName(se):[]}function b(Ge){if(typeof Ge=="number"||typeof Ge=="boolean"||typeof Ge=="string"||Ge==null)return JSON.stringify(Ge);if(Array.isArray(Ge)){let ce="[";for(const ye of Ge)ce+=`${b(ye)},`;return`${ce}]`}let se="{";for(const ce of Object.keys(Ge).sort())se+=`${ce}:${b(Ge[ce])},`;return`${se}}`}function E(Ge){let se="";for(const ce of o.bu)se+=`/${b(Ge[ce])}`;return se}class P{constructor(se){this.keyCache={},this._layers={},this._layerConfigs={},se&&this.replace(se)}replace(se,ce){this._layerConfigs={},this._layers={},this.update(se,[],ce)}update(se,ce,ye){this._options=ye;for(const xe of se)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=o.dn(xe,this.scope,null,this._options)).compileFilter(ye),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of ce)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const Re=function(xe,Fe){const rt={};for(let et=0;et<xe.length;et++){const Ot=xe[et];let gt=Fe&&Fe[Ot.id];gt||(Ot.type==="symbol"?gt=Ot.id:(gt=E(Ot),Ot.type==="line"&&Ot.paint&&function yr(br){return typeof br=="string"&&br==="line-progress"||(Array.isArray(br)?br.some(yr):!(!br||typeof br!="object")&&Object.values(br).some(yr))}(Ot.paint["line-width"])&&(gt+=`/${b(Ot.paint["line-width"])}`))),Fe&&(Fe[Ot.id]=gt);let ar=rt[gt];ar||(ar=rt[gt]=[]),ar.push(Ot)}const $e=[];for(const et in rt)$e.push(rt[et]);return $e}(Object.values(this._layerConfigs),this.keyCache);for(const xe of Re){const Fe=xe.map(ar=>this._layers[ar.id]),rt=Fe[0];if(rt.visibility==="none")continue;const $e=rt.source||"";let et=this.familiesBySource[$e];et||(et=this.familiesBySource[$e]={});const Ot=rt.sourceLayer||"_geojsonTileLayer";let gt=et[Ot];gt||(gt=et[Ot]=[]),gt.push(Fe)}}}const O=1*o.fa;class L{constructor(se){const ce={},ye=[];for(const rt in se){const $e=se[rt],et=ce[rt]={};for(const Ot in $e.glyphs){const gt=$e.glyphs[+Ot];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const ar=gt.metrics.localGlyph?O:1,yr={x:0,y:0,w:gt.bitmap.width+2*ar,h:gt.bitmap.height+2*ar};ye.push(yr),et[Ot]=yr}}const{w:Re,h:xe}=o.H(ye),Fe=new o.f9({width:Re||1,height:xe||1});for(const rt in se){const $e=se[rt];for(const et in $e.glyphs){const Ot=$e.glyphs[+et];if(!Ot||Ot.bitmap.width===0||Ot.bitmap.height===0)continue;const gt=ce[rt][et],ar=Ot.metrics.localGlyph?O:1;o.f9.copy(Ot.bitmap,Fe,{x:0,y:0},{x:gt.x+ar,y:gt.y+ar},Ot.bitmap)}}this.image=Fe,this.positions=ce}}o.f8(L,"GlyphAtlas");class B{constructor(se){this.tileID=new o.aM(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.lut=se.lut,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.scope=se.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.request&&se.request.collectResourceTiming,this.promoteId=se.promoteId,this.isSymbolTile=se.isSymbolTile,this.tileTransform=o.aW(se.tileID.canonical,se.projection),this.projection=se.projection,this.worldview=se.worldview,this.localizableLayerIds=se.localizableLayerIds,this.brightness=se.brightness,this.extraShadowCaster=!!se.extraShadowCaster,this.tessellationStep=se.tessellationStep,this.scaleFactor=se.scaleFactor,this.worldview=se.worldview}parse(se,ce,ye,Re,xe,Fe){this.status="parsing",this.data=se,this.collisionBoxArray=new o.b0;const rt=new o.fb(Object.keys(se.layers).sort()),$e=new o.fc(this.tileID,this.promoteId);$e.bucketLayerIDs=[];const et={},Ot=new o.fd(256,256),gt={featureIndex:$e,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ot,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ar=[],yr=ce.familiesBySource[this.source];for(const Gr in yr){const Nr=se.layers[Gr];if(!Nr)continue;let Wr=!1,Vn=!1,qr=!1;for(const jn of yr[Gr])jn[0].type==="symbol"?Wr=!0:Vn=!0,jn[0].is3D()&&jn[0].type!=="model"&&(qr=!0);if(this.extraShadowCaster&&!qr||this.isSymbolTile===!0&&!Wr||this.isSymbolTile===!1&&!Vn)continue;Nr.version===1&&o.w(`Vector tile source "${this.source}" layer "${Gr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ti=rt.encode(Gr),eo=[];let Ui=!1;for(let jn=0,mn=0;jn<Nr.length;jn++){const vi=Nr.feature(jn),fi=$e.getId(vi,Gr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Gr)){const li=vi.properties?vi.properties.worldview:null;if(this.worldview&&typeof li=="string")if(li==="all")vi.properties.$localized=!0;else{if(!li.split(",").includes(this.worldview))continue;vi.properties.$localized=!0,vi.properties.worldview=this.worldview}}!Ui&&vi.properties&&vi.properties.hasOwnProperty(o.fe)&&(Ui=!0),eo.push({feature:vi,id:fi,index:mn,sourceLayerIndex:Ti}),mn++}Ui&&!gt.elevationFeatures&&se.layers.hasOwnProperty(o.ff)&&(gt.elevationFeatures=o.fg.parseFrom(se.layers[o.ff],this.canonical));for(const jn of yr[Gr]){const mn=jn[0];if(this.extraShadowCaster&&(!mn.is3D()||mn.type==="model")||this.isSymbolTile!==void 0&&mn.type==="symbol"!==this.isSymbolTile||mn.minzoom&&this.zoom<Math.floor(mn.minzoom)||mn.maxzoom&&this.zoom>=mn.maxzoom||mn.visibility==="none")continue;z(jn,this.zoom,gt.brightness,ye,this.worldview);const vi=et[mn.id]=mn.createBucket({index:$e.bucketLayerIDs.length,layers:jn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ti,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Re,worldview:this.worldview});$e.bucketLayerIDs.push(jn.map(li=>o.C(li.id,li.scope)));let fi=vi.prepare?vi.prepare():null;fi!=null?(fi=fi.then(()=>vi.populate(eo,gt,this.tileID.canonical,this.tileTransform)),ar.push(fi)):vi.populate(eo,gt,this.tileID.canonical,this.tileTransform)}}const br=()=>{let Gr,Nr,Wr,Vn,qr,Ti;Ot.trim();const eo={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ui=()=>{if(Gr)return this.status="done",Fe(Gr);if(this.extraShadowCaster)this.status="done",Fe(null,{buckets:Object.values(et).filter(mn=>!mn.isEmpty()),featureIndex:$e,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:gt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Nr&&Wr&&Vn){const mn=new L(Nr),vi=new Map;for(const[bo,As]of Wr.entries()){const{imagePosition:Zo}=o.fj(bo,As,o.fk);vi.set(bo,Zo)}const fi={};for(const bo in et){const As=et[bo];As instanceof o.b1&&(z(As.layers,this.zoom,gt.brightness,ye,this.worldview),fi[bo]=o.fl(As,Nr,mn.positions,Wr,vi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,qr,this.worldview))}const li={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(xe,Wr,qr,()=>{li.iconsPending=!1,jn(fi,mn,li)}),this.rasterizeIfNeeded(xe,Vn,Ti,()=>{li.patternsPending=!1,jn(fi,mn,li)})}},jn=(mn,vi,fi,li)=>{if(fi.iconsPending||fi.patternsPending)return;const bo=new o.fm(Wr,Vn,this.lut);for(const As in et){const Zo=et[As];if(As in mn)o.fn(Zo,mn[As],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Wr,bo);else if(Zo.hasPattern&&(Zo instanceof o.b7||Zo instanceof o.b8||Zo instanceof o.e4)){z(Zo.layers,this.zoom,gt.brightness,ye,this.worldview);const Of=Object.fromEntries(bo.patternPositions);Zo.addFeatures(gt,this.tileID.canonical,Of,ye,this.tileTransform,this.brightness)}}this.status="done",Fe(null,{buckets:Object.values(et).filter(As=>!As.isEmpty()),featureIndex:$e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vi.image,lineAtlas:Ot,imageAtlas:bo,brightness:gt.brightness})};if(!this.extraShadowCaster){const mn=o.fh(gt.glyphDependencies,li=>Object.keys(li).map(Number));Object.keys(mn).length?xe.send("getGlyphs",{uid:this.uid,stacks:mn},(li,bo)=>{Gr||(Gr=li,Nr=bo,Ui())},void 0,!1,eo):Nr={};const vi=Array.from(gt.iconDependencies.keys()).map(li=>o.I.parse(li));vi.length?xe.send("getImages",{images:vi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(li,bo)=>{Gr||(Gr=li,Wr=new Map,qr=this.updateImageMapAndGetImageTaskQueue(Wr,bo,gt.iconDependencies),Ui())},void 0,!1,eo):(Wr=new Map,qr=new Map);const fi=Array.from(gt.patternDependencies.keys()).map(li=>o.I.parse(li));fi.length?xe.send("getImages",{images:fi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(li,bo)=>{Gr||(Gr=li,Vn=new Map,Ti=this.updateImageMapAndGetImageTaskQueue(Vn,bo,gt.patternDependencies),Ui())},void 0,!1,eo):(Vn=new Map,Ti=new Map)}if(gt.elevationFeatures&&gt.elevationFeatures.length>0){const mn=[];for(const fi of Object.values(et))if(fi instanceof o.b8){const li=fi.getUnevaluatedPortalGraph();li&&mn.push(li)}const vi=o.fi.evaluate(mn);for(const fi of Object.values(et))if(fi instanceof o.b8){const li=se.layers[rt.decode(fi.sourceLayerIndex)];fi.setEvaluatedPortalGraph(vi,li,this.tileID.canonical,gt.availableImages,gt.brightness)}}Ui()};ar.length>0?Promise.allSettled(ar).then(br).catch(Fe):br()}rasterizeIfNeeded(se,ce,ye,Re){Array.from(ce.values()).some(xe=>xe.usvg)?this.rasterize(se,ce,ye,Re):Re()}updateImageMapAndGetImageTaskQueue(se,ce,ye){const Re=new Map;for(const xe of ce.keys()){const Fe=ye.get(xe)||[];for(const rt of Fe){const $e=rt.toString(),et=ce.get(rt.id.toString());et.usvg?Re.has($e)||(Re.set($e,rt),se.set($e,Object.assign({},et))):se.set($e,et)}}return Re}rasterize(se,ce,ye,Re){this.rasterizeTask=se.send("rasterizeImages",{scope:this.scope,tasks:ye},(xe,Fe)=>{if(!xe)for(const[rt,$e]of Fe.entries()){const et=Object.assign(ce.get(rt),{data:$e});ce.set(rt,et)}Re()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function z(Ge,se,ce,ye,Re){const xe=new o.aa(se,{brightness:ce,worldview:Re});for(const Fe of Ge)Fe.recalculate(xe,ye)}class $ extends o.E{constructor(se,ce,ye,Re,xe,Fe,rt){super(),this.actor=se,this.layerIndex=ce,this.availableImages=ye,this.availableModels=Re,this.loadVectorData=Fe||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(se.scheduler),this.isSpriteLoaded=xe,this.scheduler=se.scheduler,this.brightness=rt}loadTile(se,ce){const ye=se.uid,Re=se&&se.request,xe=Re&&Re.collectResourceTiming,Fe=this.loading[ye]=new B(se);Fe.abort=this.loadVectorData(se,(rt,$e)=>{const et=!this.loading[ye];if(delete this.loading[ye],Fe.cancelRasterize(),et||rt||!$e)return Fe.status="done",et||(this.loaded[ye]=Fe),ce(rt);const Ot=$e.rawData,gt={};$e.expires&&(gt.expires=$e.expires),$e.cacheControl&&(gt.cacheControl=$e.cacheControl),Fe.vectorTile=$e.vectorTile||new o.fo(new o.bq(Ot));const ar=()=>{Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(yr,br)=>{if(yr||!br)return ce(yr);const Gr={};if(xe){const Nr=v(Re);Nr.length>0&&(Gr.resourceTiming=JSON.parse(JSON.stringify(Nr)))}ce(null,o.h({rawTileData:Ot.slice(0)},br,gt,Gr))})};this.isSpriteLoaded?ar():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ar,{type:"parseTile",isSymbolTile:se.isSymbolTile,zoom:se.tileZoom}):ar()}),this.loaded=this.loaded||{},this.loaded[ye]=Fe})}reloadTile(se,ce){const ye=this.loaded,Re=se.uid;if(ye&&ye[Re]){const xe=ye[Re];xe.scaleFactor=se.scaleFactor,xe.showCollisionBoxes=se.showCollisionBoxes,xe.projection=se.projection,xe.brightness=se.brightness,xe.tileTransform=o.aW(se.tileID.canonical,se.projection),xe.extraShadowCaster=se.extraShadowCaster,xe.lut=se.lut,xe.worldview=se.worldview;const Fe=(rt,$e)=>{const et=xe.reloadCallback;et&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,et)),ce(rt,$e)};xe.status==="parsing"?xe.reloadCallback=Fe:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe):Fe())}else ce(null,void 0)}abortTile(se,ce){const ye=se.uid,Re=this.loading[ye];Re&&(Re.abort&&Re.abort(),delete this.loading[ye]),ce()}removeTile(se,ce){const ye=this.loaded,Re=se.uid;ye&&ye[Re]&&delete ye[Re],ce()}}class U{loadTile(se,ce){const{uid:ye,encoding:Re,rawImageData:xe,padding:Fe}=se,rt=ImageBitmap&&xe instanceof ImageBitmap?this.getImageData(xe,Fe):xe;ce(null,new o.fp(ye,rt,Re,Fe<1))}reloadTile(se,ce){ce(null,null)}abortTile(se,ce){ce()}removeTile(se,ce){ce()}getImageData(se,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const ye=this.offscreenCanvasContext.getImageData(-ce,-ce,se.width+2*ce,se.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}o.bp.setPbf(o.bq);class G{constructor(se){this._mrt=new o.bp(se.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=se.uid,this.tileID=se.tileID,this.source=se.source}parse(se,ce){const ye=this._mrt;this.status="parsing",this._entireBuffer=se;try{ye.parseHeader(se),this._isHeaderLoaded=!0;const Re=[];for(const xe in ye.layers){const Fe=ye.getLayer(xe),rt=Fe.getDataRange(Fe.getBandList()),$e=ye.createDecodingTask(rt),et=se.slice(rt.firstByte,rt.lastByte+1),Ot=o.bp.performDecoding(et,$e).then(gt=>$e.complete(null,gt)).catch(gt=>$e.complete(gt,null));Re.push(Ot)}Promise.allSettled(Re).then(()=>ce(null,ye)).catch(xe=>ce(xe))}catch(Re){ce(Re)}}}class Z{constructor(se){this.actor=se,this.loading={},this.loaded={}}loadTile(se,ce){const ye=se.uid,Re=se.request,xe=this.loading[ye]=new G(se),{cancel:Fe}=o.br(Re,(rt,$e,et,Ot)=>{const gt=!this.loading[ye];if(delete this.loading[ye],gt||rt||!$e)return xe.status="done",gt||(this.loaded[ye]=xe),ce(rt);xe.parse($e,(ar,yr)=>{if(ar||!yr)return ce(ar);ce(null,yr,et,Ot)}),this.loaded[ye]=xe});xe.abort=Fe}reloadTile(se,ce){ce(null,void 0)}abortTile(se,ce){const ye=se.uid,Re=this.loading[ye];Re&&(Re.abort&&Re.abort(),delete this.loading[ye]),ce()}removeTile(se,ce){const ye=se.uid;this.loaded[ye]&&delete this.loaded[ye],ce()}decodeRasterArray(se,ce){o.bp.performDecoding(se.buffer,se.task).then(ye=>ce(null,ye)).catch(ye=>ce(ye))}}const ne=o.fq.prototype.toGeoJSON;class Y{constructor(se){this._feature=se,this.extent=o.aj,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const ce of this._feature.geometry)se.push([new o.P(ce[0],ce[1])]);return se}{const se=[];for(const ce of this._feature.geometry){const ye=[];for(const Re of ce)ye.push(new o.P(Re[0],Re[1]));se.push(ye)}return se}}toGeoJSON(se,ce,ye){return ne.call(this,se,ce,ye)}}class ee{constructor(se,ce){this.name=se,this.extent=o.aj,this.length=ce.length,this._jsonFeatures=ce}feature(se){return new Y(this._jsonFeatures[se])}}class le{constructor(se){this.layers={},this.extent=o.aj;for(const ce of Object.keys(se))this.layers[ce]=new ee(ce,se[ce])}}const fe=64/4096,Ce=128;class Oe{constructor(){this.features=new Map}clear(){this.features.clear()}load(se=[],ce){for(const ye of se){const Re=ye.id;if(Re==null)continue;let xe=this.features.get(Re);xe&&this.updateCache(xe,ce),ye.geometry?(xe=Ke(ye),this.updateCache(xe,ce),this.features.set(Re,xe)):this.features.delete(Re),this.updateCache(xe,ce)}}updateCache(se,ce){for(const{canonical:ye,uid:Re}of Object.values(ce)){const{z:xe,x:Fe,y:rt}=ye;Me(se,Math.pow(2,xe),Fe,rt)&&delete ce[Re]}}getTile(se,ce,ye){const Re=Math.pow(2,se),xe=[];for(const Fe of this.features.values())Me(Fe,Re,ce,ye)&&xe.push(Je(Fe,Re,ce,ye));return{features:xe}}getFeatures(){return[...this.features.values()]}}function Me({minX:Ge,minY:se,maxX:ce,maxY:ye},Re,xe,Fe){return Ge<(xe+1+fe)/Re&&se<(Fe+1+fe)/Re&&ce>(xe-fe)/Re&&ye>(Fe-fe)/Re}function Ke(Ge){const{id:se,geometry:ce,properties:ye}=Ge;if(!ce)return;if(ce.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Re,coordinates:xe}=ce,Fe={id:se,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},rt=Fe.geometry;if(Re==="Point")Ye(xe,rt,Fe);else if(Re==="MultiPoint")for(const $e of xe)Ye($e,rt,Fe);else if(Re==="LineString")Fe.type=2,Le(xe,rt,Fe);else if(Re==="MultiLineString")Fe.type=2,Qe(xe,rt,Fe);else if(Re==="Polygon")Fe.type=3,Qe(xe,rt,Fe,!0);else{if(Re!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Fe.type=3;for(const $e of xe)Qe($e,rt,Fe,!0)}return Fe}function Ye([Ge,se],ce,ye){const Re=o.aD(Ge);let xe=o.aH(se);xe=xe<0?0:xe>1?1:xe,ce.push(Re,xe),ye.minX=Math.min(ye.minX,Re),ye.minY=Math.min(ye.minY,xe),ye.maxX=Math.max(ye.maxX,Re),ye.maxY=Math.max(ye.maxY,xe)}function Le(Ge,se,ce,ye=!1,Re=!1){const xe=[];for(const Fe of Ge)Ye(Fe,xe,ce);se.push(xe),ye&&function(Fe,rt){let $e=0;for(let et=0,Ot=Fe.length,gt=Ot-2;et<Ot;gt=et,et+=2)$e+=(Fe[et]-Fe[gt])*(Fe[et+1]+Fe[gt+1]);if($e>0===rt)for(let et=0,Ot=Fe.length;et<Ot/2;et+=2){const gt=Fe[et],ar=Fe[et+1];Fe[et]=Fe[Ot-2-et],Fe[et+1]=Fe[Ot-1-et],Fe[Ot-2-et]=gt,Fe[Ot-1-et]=ar}}(xe,Re)}function Qe(Ge,se,ce,ye=!1){for(let Re=0;Re<Ge.length;Re++)Le(Ge[Re],se,ce,ye,Re===0)}function Je(Ge,se,ce,ye){const{id:Re,type:xe,geometry:Fe,tags:rt}=Ge,$e=[];if(xe===1)(function(et,Ot,gt,ar,yr){for(let br=0;br<et.length;br+=2){const Gr=Math.round(o.aj*(et[br+0]*Ot-gt)),Nr=Math.round(o.aj*(et[br+1]*Ot-ar));yr.push([Gr,Nr])}})(Fe,se,ce,ye,$e);else for(const et of Fe)it(et,se,ce,ye,$e);return{id:Re,type:xe,geometry:$e,tags:rt}}function it(Ge,se,ce,ye,Re){const xe=-Ce,Fe=o.aj+Ce;let rt;for(let $e=0;$e<Ge.length-2;$e+=2){let et=Math.round(o.aj*(Ge[$e+0]*se-ce)),Ot=Math.round(o.aj*(Ge[$e+1]*se-ye)),gt=Math.round(o.aj*(Ge[$e+2]*se-ce)),ar=Math.round(o.aj*(Ge[$e+3]*se-ye));const yr=gt-et,br=ar-Ot;et<xe&&gt<xe||(et<xe?(Ot+=Math.round(br*((xe-et)/yr)),et=xe):gt<xe&&(ar=Ot+Math.round(br*((xe-et)/yr)),gt=xe),Ot<xe&&ar<xe||(Ot<xe?(et+=Math.round(yr*((xe-Ot)/br)),Ot=xe):ar<xe&&(gt=et+Math.round(yr*((xe-Ot)/br)),ar=xe),et>=Fe&&gt>=Fe||(et>=Fe?(Ot+=Math.round(br*((Fe-et)/yr)),et=Fe):gt>=Fe&&(ar=Ot+Math.round(br*((Fe-et)/yr)),gt=Fe),Ot>=Fe&&ar>=Fe||(Ot>=Fe?(et+=Math.round(yr*((Fe-Ot)/br)),Ot=Fe):ar>=Fe&&(gt=et+Math.round(yr*((Fe-Ot)/br)),ar=Fe),rt&&et===rt[rt.length-1][0]&&Ot===rt[rt.length-1][1]||(rt=[[et,Ot]],Re.push(rt)),rt.push([gt,ar])))))}}function Ze({name:Ge,features:se},ce){ce.writeStringField(1,Ge),ce.writeVarintField(5,o.aj);const ye=new Map,Re=new Map,xe={keys:ye,values:Re,feature:null};for(const Fe of se)xe.feature=Fe,ce.writeMessage(2,nt,xe);for(const Fe of ye.keys())ce.writeStringField(3,Fe);for(const Fe of Re.keys())ce.writeMessage(4,Sr,Fe)}function nt(Ge,se){const ce=Ge.feature;ce.id===void 0||isNaN(+ce.id)||se.writeVarintField(1,+ce.id),ce.tags&&se.writeMessage(2,pt,Ge),se.writeVarintField(3,ce.type),se.writeMessage(4,sr,ce)}function pt({keys:Ge,values:se,feature:ce},ye){for(const Re of Object.keys(ce.tags)){let xe=ce.tags[Re];if(xe===null)continue;let Fe=Ge.get(Re);Fe===void 0&&(Fe=Ge.size,Ge.set(Re,Fe)),ye.writeVarint(Fe);const rt=typeof xe;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(xe=JSON.stringify(xe));let $e=se.get(xe);$e===void 0&&($e=se.size,se.set(xe,$e)),ye.writeVarint($e)}}function _t(Ge,se){return(se<<3)+(7&Ge)}function It(Ge){return Ge<<1^Ge>>31}function sr(Ge,se){const{geometry:ce,type:ye}=Ge;let Re=0,xe=0;if(ye===1){se.writeVarint(_t(1,ce.length));for(const Fe of ce){const rt=Fe[0]-Re,$e=Fe[1]-xe;se.writeVarint(It(rt)),se.writeVarint(It($e)),Re+=rt,xe+=$e}}else for(const Fe of ce){se.writeVarint(_t(1,1));const rt=Fe.length-(ye===3?1:0);for(let $e=0;$e<rt;$e++){$e===1&&se.writeVarint(_t(2,rt-1));const et=Fe[$e][0]-Re,Ot=Fe[$e][1]-xe;se.writeVarint(It(et)),se.writeVarint(It(Ot)),Re+=et,xe+=Ot}ye===3&&se.writeVarint(_t(7,1))}}function Sr(Ge,se){const ce=typeof Ge;ce==="string"?se.writeStringField(1,Ge):ce==="boolean"?se.writeBooleanField(7,Ge):ce==="number"&&(Ge%1!=0?se.writeDoubleField(3,Ge):Ge<0?se.writeSVarintField(6,Ge):se.writeVarintField(5,Ge))}const Kr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ge=>Ge},Er=Math.fround||(Kt=new Float32Array(1),Ge=>(Kt[0]=+Ge,Kt[0]));var Kt;const Pr=3,Qt=5,nr=6;class xr{constructor(se){this.options=Object.assign(Object.create(Kr),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:ce,minZoom:ye,maxZoom:Re}=this.options;ce&&console.time("total time");const xe=`prepare ${se.length} points`;ce&&console.time(xe),this.points=se;const Fe=[];for(let $e=0;$e<se.length;$e++){const et=se[$e];if(!et.geometry)continue;const[Ot,gt]=et.geometry.coordinates,ar=Er(Hr(Ot)),yr=Er(Yr(gt));Fe.push(ar,yr,1/0,$e,-1,1),this.options.reduce&&Fe.push(0)}let rt=this.trees[Re+1]=this._createTree(Fe);ce&&console.timeEnd(xe);for(let $e=Re;$e>=ye;$e--){const et=+Date.now();rt=this.trees[$e]=this._createTree(this._cluster(rt,$e)),ce&&console.log("z%d: %d clusters in %dms",$e,rt.numItems,+Date.now()-et)}return ce&&console.timeEnd("total time"),this}getClusters(se,ce){let ye=((se[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,se[1]));let xe=se[2]===180?180:((se[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)ye=-180,xe=180;else if(ye>xe){const gt=this.getClusters([ye,Re,180,Fe],ce),ar=this.getClusters([-180,Re,xe,Fe],ce);return gt.concat(ar)}const rt=this.trees[this._limitZoom(ce)],$e=rt.range(Hr(ye),Yr(Fe),Hr(xe),Yr(Re)),et=rt.data,Ot=[];for(const gt of $e){const ar=this.stride*gt;Ot.push(et[ar+Qt]>1?Ft(et,ar,this.clusterProps):this.points[et[ar+Pr]])}return Ot}getChildren(se){const ce=this._getOriginId(se),ye=this._getOriginZoom(se),Re="No cluster with the specified id.",xe=this.trees[ye];if(!xe)throw new Error(Re);const Fe=xe.data;if(ce*this.stride>=Fe.length)throw new Error(Re);const rt=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),$e=xe.within(Fe[ce*this.stride],Fe[ce*this.stride+1],rt),et=[];for(const Ot of $e){const gt=Ot*this.stride;Fe[gt+4]===se&&et.push(Fe[gt+Qt]>1?Ft(Fe,gt,this.clusterProps):this.points[Fe[gt+Pr]])}if(et.length===0)throw new Error(Re);return et}getLeaves(se,ce,ye){const Re=[];return this._appendLeaves(Re,se,ce=ce||10,ye=ye||0,0),Re}getTile(se,ce,ye){const Re=this.trees[this._limitZoom(se)],xe=Math.pow(2,se),{extent:Fe,radius:rt}=this.options,$e=rt/Fe,et=(ye-$e)/xe,Ot=(ye+1+$e)/xe,gt={features:[]};return this._addTileFeatures(Re.range((ce-$e)/xe,et,(ce+1+$e)/xe,Ot),Re.data,ce,ye,xe,gt),ce===0&&this._addTileFeatures(Re.range(1-$e/xe,et,1,Ot),Re.data,xe,ye,xe,gt),ce===xe-1&&this._addTileFeatures(Re.range(0,et,$e/xe,Ot),Re.data,-1,ye,xe,gt),gt.features.length?gt:null}getClusterExpansionZoom(se){let ce=this._getOriginZoom(se)-1;for(;ce<=this.options.maxZoom;){const ye=this.getChildren(se);if(ce++,ye.length!==1)break;se=ye[0].properties.cluster_id}return ce}_appendLeaves(se,ce,ye,Re,xe){const Fe=this.getChildren(ce);for(const rt of Fe){const $e=rt.properties;if($e&&$e.cluster?xe+$e.point_count<=Re?xe+=$e.point_count:xe=this._appendLeaves(se,$e.cluster_id,ye,Re,xe):xe<Re?xe++:se.push(rt),se.length===ye)break}return xe}_createTree(se){const ce=new o.c0(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<se.length;ye+=this.stride)ce.add(se[ye],se[ye+1]);return ce.finish(),ce.data=se,ce}_addTileFeatures(se,ce,ye,Re,xe,Fe){for(const rt of se){const $e=rt*this.stride,et=ce[$e+Qt]>1;let Ot,gt,ar;if(et)Ot=Pn(ce,$e,this.clusterProps),gt=ce[$e],ar=ce[$e+1];else{const Gr=this.points[ce[$e+Pr]];Ot=Gr.properties;const[Nr,Wr]=Gr.geometry.coordinates;gt=Hr(Nr),ar=Yr(Wr)}const yr={type:1,geometry:[[Math.round(this.options.extent*(gt*xe-ye)),Math.round(this.options.extent*(ar*xe-Re))]],tags:Ot};let br;br=et||this.options.generateId?ce[$e+Pr]:this.points[ce[$e+Pr]].id,br!==void 0&&(yr.id=br),Fe.features.push(yr)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,ce){const{radius:ye,extent:Re,reduce:xe,minPoints:Fe}=this.options,rt=ye/(Re*Math.pow(2,ce)),$e=se.data,et=[],Ot=this.stride;for(let gt=0;gt<$e.length;gt+=Ot){if($e[gt+2]<=ce)continue;$e[gt+2]=ce;const ar=$e[gt],yr=$e[gt+1],br=se.within($e[gt],$e[gt+1],rt),Gr=$e[gt+Qt];let Nr=Gr;for(const Wr of br){const Vn=Wr*Ot;$e[Vn+2]>ce&&(Nr+=$e[Vn+Qt])}if(Nr>Gr&&Nr>=Fe){let Wr,Vn=ar*Gr,qr=yr*Gr,Ti=-1;const eo=(gt/Ot<<5)+(ce+1)+this.points.length;for(const Ui of br){const jn=Ui*Ot;if($e[jn+2]<=ce)continue;$e[jn+2]=ce;const mn=$e[jn+Qt];Vn+=$e[jn]*mn,qr+=$e[jn+1]*mn,$e[jn+4]=eo,xe&&(Wr||(Wr=this._map($e,gt,!0),Ti=this.clusterProps.length,this.clusterProps.push(Wr)),xe(Wr,this._map($e,jn)))}$e[gt+4]=eo,et.push(Vn/Nr,qr/Nr,1/0,eo,-1,Nr),xe&&et.push(Ti)}else{for(let Wr=0;Wr<Ot;Wr++)et.push($e[gt+Wr]);if(Nr>1)for(const Wr of br){const Vn=Wr*Ot;if(!($e[Vn+2]<=ce)){$e[Vn+2]=ce;for(let qr=0;qr<Ot;qr++)et.push($e[Vn+qr])}}}}return et}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,ce,ye){if(se[ce+Qt]>1){const Fe=this.clusterProps[se[ce+nr]];return ye?Object.assign({},Fe):Fe}const Re=this.points[se[ce+Pr]].properties,xe=this.options.map(Re);return ye&&xe===Re?Object.assign({},xe):xe}}function Ft(Ge,se,ce){return{type:"Feature",id:Ge[se+Pr],properties:Pn(Ge,se,ce),geometry:{type:"Point",coordinates:[(ye=Ge[se],360*(ye-.5)),kn(Ge[se+1])]}};var ye}function Pn(Ge,se,ce){const ye=Ge[se+Qt],Re=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,xe=Ge[se+nr],Fe=xe===-1?{}:Object.assign({},ce[xe]);return Object.assign(Fe,{cluster:!0,cluster_id:Ge[se+Pr],point_count:ye,point_count_abbreviated:Re})}function Hr(Ge){return Ge/360+.5}function Yr(Ge){const se=Math.sin(Ge*Math.PI/180),ce=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ce<0?0:ce>1?1:ce}function kn(Ge){const se=(180-360*Ge)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function Si(Ge,se,ce,ye){let Re=ye;const xe=se+(ce-se>>1);let Fe,rt=ce-se;const $e=Ge[se],et=Ge[se+1],Ot=Ge[ce],gt=Ge[ce+1];for(let ar=se+3;ar<ce;ar+=3){const yr=jo(Ge[ar],Ge[ar+1],$e,et,Ot,gt);if(yr>Re)Fe=ar,Re=yr;else if(yr===Re){const br=Math.abs(ar-xe);br<rt&&(Fe=ar,rt=br)}}Re>ye&&(Fe-se>3&&Si(Ge,se,Fe,ye),Ge[Fe+2]=Re,ce-Fe>3&&Si(Ge,Fe,ce,ye))}function jo(Ge,se,ce,ye,Re,xe){let Fe=Re-ce,rt=xe-ye;if(Fe!==0||rt!==0){const $e=((Ge-ce)*Fe+(se-ye)*rt)/(Fe*Fe+rt*rt);$e>1?(ce=Re,ye=xe):$e>0&&(ce+=Fe*$e,ye+=rt*$e)}return Fe=Ge-ce,rt=se-ye,Fe*Fe+rt*rt}function No(Ge,se,ce,ye){const Re={id:Ge??null,type:se,geometry:ce,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")ho(Re,ce);else if(se==="Polygon")ho(Re,ce[0]);else if(se==="MultiLineString")for(const xe of ce)ho(Re,xe);else if(se==="MultiPolygon")for(const xe of ce)ho(Re,xe[0]);return Re}function ho(Ge,se){for(let ce=0;ce<se.length;ce+=3)Ge.minX=Math.min(Ge.minX,se[ce]),Ge.minY=Math.min(Ge.minY,se[ce+1]),Ge.maxX=Math.max(Ge.maxX,se[ce]),Ge.maxY=Math.max(Ge.maxY,se[ce+1])}function Ci(Ge,se,ce,ye){if(!se.geometry)return;const Re=se.geometry.coordinates;if(Re&&Re.length===0)return;const xe=se.geometry.type,Fe=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let rt=[],$e=se.id;if(ce.promoteId?$e=se.properties[ce.promoteId]:ce.generateId&&($e=ye||0),xe==="Point")vo(Re,rt);else if(xe==="MultiPoint")for(const et of Re)vo(et,rt);else if(xe==="LineString")fo(Re,rt,Fe,!1);else if(xe==="MultiLineString"){if(ce.lineMetrics){for(const et of Re)rt=[],fo(et,rt,Fe,!1),Ge.push(No($e,"LineString",rt,se.properties));return}Ta(Re,rt,Fe,!1)}else if(xe==="Polygon")Ta(Re,rt,Fe,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const et of se.geometry.geometries)Ci(Ge,{id:$e,geometry:et,properties:se.properties},ce,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const et of Re){const Ot=[];Ta(et,Ot,Fe,!0),rt.push(Ot)}}Ge.push(No($e,xe,rt,se.properties))}function vo(Ge,se){se.push(Za(Ge[0]),Ii(Ge[1]),0)}function fo(Ge,se,ce,ye){let Re,xe,Fe=0;for(let $e=0;$e<Ge.length;$e++){const et=Za(Ge[$e][0]),Ot=Ii(Ge[$e][1]);se.push(et,Ot,0),$e>0&&(Fe+=ye?(Re*Ot-et*xe)/2:Math.sqrt(Math.pow(et-Re,2)+Math.pow(Ot-xe,2))),Re=et,xe=Ot}const rt=se.length-3;se[2]=1,Si(se,0,rt,ce),se[rt+2]=1,se.size=Math.abs(Fe),se.start=0,se.end=se.size}function Ta(Ge,se,ce,ye){for(let Re=0;Re<Ge.length;Re++){const xe=[];fo(Ge[Re],xe,ce,ye),se.push(xe)}}function Za(Ge){return Ge/360+.5}function Ii(Ge){const se=Math.sin(Ge*Math.PI/180),ce=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ce<0?0:ce>1?1:ce}function xo(Ge,se,ce,ye,Re,xe,Fe,rt){if(ye/=se,xe>=(ce/=se)&&Fe<ye)return Ge;if(Fe<ce||xe>=ye)return null;const $e=[];for(const et of Ge){const Ot=et.geometry;let gt=et.type;const ar=Re===0?et.minX:et.minY,yr=Re===0?et.maxX:et.maxY;if(ar>=ce&&yr<ye){$e.push(et);continue}if(yr<ce||ar>=ye)continue;let br=[];if(gt==="Point"||gt==="MultiPoint")Ou(Ot,br,ce,ye,Re);else if(gt==="LineString")Xa(Ot,br,ce,ye,Re,!1,rt.lineMetrics);else if(gt==="MultiLineString")Mo(Ot,br,ce,ye,Re,!1);else if(gt==="Polygon")Mo(Ot,br,ce,ye,Re,!0);else if(gt==="MultiPolygon")for(const Gr of Ot){const Nr=[];Mo(Gr,Nr,ce,ye,Re,!0),Nr.length&&br.push(Nr)}if(br.length){if(rt.lineMetrics&&gt==="LineString"){for(const Gr of br)$e.push(No(et.id,gt,Gr,et.tags));continue}gt!=="LineString"&&gt!=="MultiLineString"||(br.length===1?(gt="LineString",br=br[0]):gt="MultiLineString"),gt!=="Point"&&gt!=="MultiPoint"||(gt=br.length===3?"Point":"MultiPoint"),$e.push(No(et.id,gt,br,et.tags))}}return $e.length?$e:null}function Ou(Ge,se,ce,ye,Re){for(let xe=0;xe<Ge.length;xe+=3){const Fe=Ge[xe+Re];Fe>=ce&&Fe<=ye&&cs(se,Ge[xe],Ge[xe+1],Ge[xe+2])}}function Xa(Ge,se,ce,ye,Re,xe,Fe){let rt=Ka(Ge);const $e=Re===0?Ea:us;let et,Ot,gt=Ge.start;for(let Nr=0;Nr<Ge.length-3;Nr+=3){const Wr=Ge[Nr],Vn=Ge[Nr+1],qr=Ge[Nr+2],Ti=Ge[Nr+3],eo=Ge[Nr+4],Ui=Re===0?Wr:Vn,jn=Re===0?Ti:eo;let mn=!1;Fe&&(et=Math.sqrt(Math.pow(Wr-Ti,2)+Math.pow(Vn-eo,2))),Ui<ce?jn>ce&&(Ot=$e(rt,Wr,Vn,Ti,eo,ce),Fe&&(rt.start=gt+et*Ot)):Ui>ye?jn<ye&&(Ot=$e(rt,Wr,Vn,Ti,eo,ye),Fe&&(rt.start=gt+et*Ot)):cs(rt,Wr,Vn,qr),jn<ce&&Ui>=ce&&(Ot=$e(rt,Wr,Vn,Ti,eo,ce),mn=!0),jn>ye&&Ui<=ye&&(Ot=$e(rt,Wr,Vn,Ti,eo,ye),mn=!0),!xe&&mn&&(Fe&&(rt.end=gt+et*Ot),se.push(rt),rt=Ka(Ge)),Fe&&(gt+=et)}let ar=Ge.length-3;const yr=Ge[ar],br=Ge[ar+1],Gr=Re===0?yr:br;Gr>=ce&&Gr<=ye&&cs(rt,yr,br,Ge[ar+2]),ar=rt.length-3,xe&&ar>=3&&(rt[ar]!==rt[0]||rt[ar+1]!==rt[1])&&cs(rt,rt[0],rt[1],rt[2]),rt.length&&se.push(rt)}function Ka(Ge){const se=[];return se.size=Ge.size,se.start=Ge.start,se.end=Ge.end,se}function Mo(Ge,se,ce,ye,Re,xe){for(const Fe of Ge)Xa(Fe,se,ce,ye,Re,xe,!1)}function cs(Ge,se,ce,ye){Ge.push(se,ce,ye)}function Ea(Ge,se,ce,ye,Re,xe){const Fe=(xe-se)/(ye-se);return cs(Ge,xe,ce+(Re-ce)*Fe,1),Fe}function us(Ge,se,ce,ye,Re,xe){const Fe=(xe-ce)/(Re-ce);return cs(Ge,se+(ye-se)*Fe,xe,1),Fe}function Ya(Ge,se){const ce=[];for(let ye=0;ye<Ge.length;ye++){const Re=Ge[ye],xe=Re.type;let Fe;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Fe=Ts(Re.geometry,se);else if(xe==="MultiLineString"||xe==="Polygon"){Fe=[];for(const rt of Re.geometry)Fe.push(Ts(rt,se))}else if(xe==="MultiPolygon"){Fe=[];for(const rt of Re.geometry){const $e=[];for(const et of rt)$e.push(Ts(et,se));Fe.push($e)}}ce.push(No(Re.id,xe,Fe,Re.tags))}return ce}function Ts(Ge,se){const ce=[];ce.size=Ge.size,Ge.start!==void 0&&(ce.start=Ge.start,ce.end=Ge.end);for(let ye=0;ye<Ge.length;ye+=3)ce.push(Ge[ye]+se,Ge[ye+1],Ge[ye+2]);return ce}function Mc(Ge,se){if(Ge.transformed)return Ge;const ce=1<<Ge.z,ye=Ge.x,Re=Ge.y;for(const xe of Ge.features){const Fe=xe.geometry,rt=xe.type;if(xe.geometry=[],rt===1)for(let $e=0;$e<Fe.length;$e+=2)xe.geometry.push(Kn(Fe[$e],Fe[$e+1],se,ce,ye,Re));else for(let $e=0;$e<Fe.length;$e++){const et=[];for(let Ot=0;Ot<Fe[$e].length;Ot+=2)et.push(Kn(Fe[$e][Ot],Fe[$e][Ot+1],se,ce,ye,Re));xe.geometry.push(et)}}return Ge.transformed=!0,Ge}function Kn(Ge,se,ce,ye,Re,xe){return[Math.round(ce*(Ge*ye-Re)),Math.round(ce*(se*ye-xe))]}function Oc(Ge,se,ce,ye,Re){const xe=se===Re.maxZoom?0:Re.tolerance/((1<<se)*Re.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:Ge.length,source:null,x:ce,y:ye,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rt of Ge)kc(Fe,rt,xe,Re);return Fe}function kc(Ge,se,ce,ye){const Re=se.geometry,xe=se.type,Fe=[];if(Ge.minX=Math.min(Ge.minX,se.minX),Ge.minY=Math.min(Ge.minY,se.minY),Ge.maxX=Math.max(Ge.maxX,se.maxX),Ge.maxY=Math.max(Ge.maxY,se.maxY),xe==="Point"||xe==="MultiPoint")for(let rt=0;rt<Re.length;rt+=3)Fe.push(Re[rt],Re[rt+1]),Ge.numPoints++,Ge.numSimplified++;else if(xe==="LineString")Es(Fe,Re,Ge,ce,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let rt=0;rt<Re.length;rt++)Es(Fe,Re[rt],Ge,ce,xe==="Polygon",rt===0);else if(xe==="MultiPolygon")for(let rt=0;rt<Re.length;rt++){const $e=Re[rt];for(let et=0;et<$e.length;et++)Es(Fe,$e[et],Ge,ce,!0,et===0)}if(Fe.length){let rt=se.tags||null;if(xe==="LineString"&&ye.lineMetrics){rt={};for(const et in se.tags)rt[et]=se.tags[et];rt.mapbox_clip_start=Re.start/Re.size,rt.mapbox_clip_end=Re.end/Re.size}const $e={geometry:Fe,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:rt};se.id!==null&&($e.id=se.id),Ge.features.push($e)}}function Es(Ge,se,ce,ye,Re,xe){const Fe=ye*ye;if(ye>0&&se.size<(Re?Fe:ye))return void(ce.numPoints+=se.length/3);const rt=[];for(let $e=0;$e<se.length;$e+=3)(ye===0||se[$e+2]>Fe)&&(ce.numSimplified++,rt.push(se[$e],se[$e+1])),ce.numPoints++;Re&&function($e,et){let Ot=0;for(let gt=0,ar=$e.length,yr=ar-2;gt<ar;yr=gt,gt+=2)Ot+=($e[gt]-$e[yr])*($e[gt+1]+$e[yr+1]);if(Ot>0===et)for(let gt=0,ar=$e.length;gt<ar/2;gt+=2){const yr=$e[gt],br=$e[gt+1];$e[gt]=$e[ar-2-gt],$e[gt+1]=$e[ar-1-gt],$e[ar-2-gt]=yr,$e[ar-1-gt]=br}}(rt,xe),Ge.push(rt)}const Wl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Aa{constructor(se,ce){const ye=(ce=this.options=function(xe,Fe){for(const rt in Fe)xe[rt]=Fe[rt];return xe}(Object.create(Wl),ce)).debug;if(ye&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let Re=function(xe,Fe){const rt=[];if(xe.type==="FeatureCollection")for(let $e=0;$e<xe.features.length;$e++)Ci(rt,xe.features[$e],Fe,$e);else Ci(rt,xe.type==="Feature"?xe:{geometry:xe},Fe);return rt}(se,ce);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Re=function(xe,Fe){const rt=Fe.buffer/Fe.extent;let $e=xe;const et=xo(xe,1,-1-rt,rt,0,-1,2,Fe),Ot=xo(xe,1,1-rt,2+rt,0,-1,2,Fe);return(et||Ot)&&($e=xo(xe,1,-rt,1+rt,0,-1,2,Fe)||[],et&&($e=Ya(et,1).concat($e)),Ot&&($e=$e.concat(Ya(Ot,-1)))),$e}(Re,ce),Re.length&&this.splitTile(Re,0,0,0),ye&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,ce,ye,Re,xe,Fe,rt){const $e=[se,ce,ye,Re],et=this.options,Ot=et.debug;for(;$e.length;){Re=$e.pop(),ye=$e.pop(),ce=$e.pop(),se=$e.pop();const gt=1<<ce,ar=Rc(ce,ye,Re);let yr=this.tiles[ar];if(!yr&&(Ot>1&&console.time("creation"),yr=this.tiles[ar]=Oc(se,ce,ye,Re,et),this.tileCoords.push({z:ce,x:ye,y:Re}),Ot)){Ot>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ye,Re,yr.numFeatures,yr.numPoints,yr.numSimplified),console.timeEnd("creation"));const mn=`z${ce}`;this.stats[mn]=(this.stats[mn]||0)+1,this.total++}if(yr.source=se,xe==null){if(ce===et.indexMaxZoom||yr.numPoints<=et.indexMaxPoints)continue}else{if(ce===et.maxZoom||ce===xe)continue;if(xe!=null){const mn=xe-ce;if(ye!==Fe>>mn||Re!==rt>>mn)continue}}if(yr.source=null,se.length===0)continue;Ot>1&&console.time("clipping");const br=.5*et.buffer/et.extent,Gr=.5-br,Nr=.5+br,Wr=1+br;let Vn=null,qr=null,Ti=null,eo=null,Ui=xo(se,gt,ye-br,ye+Nr,0,yr.minX,yr.maxX,et),jn=xo(se,gt,ye+Gr,ye+Wr,0,yr.minX,yr.maxX,et);se=null,Ui&&(Vn=xo(Ui,gt,Re-br,Re+Nr,1,yr.minY,yr.maxY,et),qr=xo(Ui,gt,Re+Gr,Re+Wr,1,yr.minY,yr.maxY,et),Ui=null),jn&&(Ti=xo(jn,gt,Re-br,Re+Nr,1,yr.minY,yr.maxY,et),eo=xo(jn,gt,Re+Gr,Re+Wr,1,yr.minY,yr.maxY,et),jn=null),Ot>1&&console.timeEnd("clipping"),$e.push(Vn||[],ce+1,2*ye,2*Re),$e.push(qr||[],ce+1,2*ye,2*Re+1),$e.push(Ti||[],ce+1,2*ye+1,2*Re),$e.push(eo||[],ce+1,2*ye+1,2*Re+1)}}getTile(se,ce,ye){se=+se,ce=+ce,ye=+ye;const Re=this.options,{extent:xe,debug:Fe}=Re;if(se<0||se>24)return null;const rt=1<<se,$e=Rc(se,ce=ce+rt&rt-1,ye);if(this.tiles[$e])return Mc(this.tiles[$e],xe);Fe>1&&console.log("drilling down to z%d-%d-%d",se,ce,ye);let et,Ot=se,gt=ce,ar=ye;for(;!et&&Ot>0;)Ot--,gt>>=1,ar>>=1,et=this.tiles[Rc(Ot,gt,ar)];return et&&et.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",Ot,gt,ar),console.time("drilling down")),this.splitTile(et.source,Ot,gt,ar,se,ce,ye),Fe>1&&console.timeEnd("drilling down"),this.tiles[$e]?Mc(this.tiles[$e],xe):null):null}}function Rc(Ge,se,ce){return 32*((1<<Ge)*ce+se)+Ge}function ut(Ge,se){const ce=Ge.tileID.canonical;if(!this._geoJSONIndex)return void se(null,null);const ye=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!ye)return void se(null,null);const Re=et=>et.tags&&"3d_elevation_id"in et.tags&&"source"in et.tags&&et.tags.source==="elevation",xe=ye.features.filter(et=>Re(et));let Fe={_geojsonTileLayer:ye.features};xe.length>0&&(Fe={_geojsonTileLayer:ye.features.filter(et=>!Re(et)),hd_road_elevation:xe});const rt=new le(Fe),$e=function(et){const Ot=new o.bq;for(const gt of Object.keys(et))Ot.writeMessage(3,Ze,{name:gt,features:et[gt]});return Ot.finish()}(Fe).buffer;se(null,{vectorTile:rt,rawData:$e})}class Zn extends ${constructor(se,ce,ye,Re,xe,Fe,rt){super(se,ce,ye,Re,xe,ut,rt),Fe&&(this.loadGeoJSON=Fe),this._dynamicIndex=new Oe}loadData(se,ce){const ye=se&&se.request,Re=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(se,(xe,Fe)=>{if(xe||!Fe)return ce(xe);if(typeof Fe!="object")return ce(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{try{if(se.filter){const $e=o.X(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($e.result==="error")throw new Error($e.value.map(et=>`${et.key}: ${et.message}`).join(", "));Fe.features=Fe.features.filter(et=>$e.value.evaluate({zoom:0},et))}se.dynamic?(Fe.type==="Feature"&&(Fe={type:"FeatureCollection",features:[Fe]}),se.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Fe.features,this.loaded),se.cluster&&(Fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=se.cluster?new xr(function({superclusterOptions:$e,clusterProperties:et}){if(!et||!$e)return $e;const Ot={},gt={},ar={accumulated:null,zoom:0},yr={properties:null},br=Object.keys(et);for(const Gr of br){const[Nr,Wr]=et[Gr],Vn=o.X(Wr),qr=o.X(typeof Nr=="string"?[Nr,["accumulated"],["get",Gr]]:Nr);Ot[Gr]=Vn.value,gt[Gr]=qr.value}return $e.map=Gr=>{yr.properties=Gr;const Nr={};for(const Wr of br)Nr[Wr]=Ot[Wr].evaluate(ar,yr);return Nr},$e.reduce=(Gr,Nr)=>{yr.properties=Nr;for(const Wr of br)ar.accumulated=Gr[Wr],Gr[Wr]=gt[Wr].evaluate(ar,yr)},$e}(se)).load(Fe.features):se.dynamic?this._dynamicIndex:function($e,et){return new Aa($e,et)}(Fe,se.geojsonVtOptions)}catch($e){return ce($e)}const rt={};if(Re){const $e=v(ye);$e&&(rt.resourceTiming={},rt.resourceTiming[se.source]=JSON.parse(JSON.stringify($e)))}ce(null,rt)}})}reloadTile(se,ce){const ye=this.loaded;return ye&&ye[se.uid]?se.partial?ce(null,void 0):super.reloadTile(se,ce):this.loadTile(se,ce)}loadGeoJSON(se,ce){if(se.request)o.n(se.request,ce);else{if(typeof se.data!="string")return ce(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ce(null,JSON.parse(se.data))}catch{return ce(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(se,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(ye){ce(ye)}}getClusterChildren(se,ce){try{ce(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(ye){ce(ye)}}getClusterLeaves(se,ce){try{ce(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(ye){ce(ye)}}}class Mi{constructor(se,ce,ye){this.tileID=new o.aM(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=se.projection,this.brightness=ce,this.worldview=ye}parse(se,ce,ye,Re){this.status="parsing";const xe=new o.aM(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Fe=[],rt=ce.familiesBySource[ye.source],$e=new o.fc(xe,ye.promoteId);$e.bucketLayerIDs=[],$e.is3DTile=!0,o.fr(se).then(et=>{if(!et)return Re(new Error("Could not parse tile"));const Ot=et.json.extensionsUsed&&et.json.extensionsUsed.includes("MAPBOX_mesh_features")||et.json.asset.extras&&et.json.asset.extras.MAPBOX_mesh_features,gt=et.json.extensionsUsed&&et.json.extensionsUsed.includes("EXT_meshopt_compression"),ar=new o.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const yr in rt)for(const br of rt[yr]){const Gr=br[0];$e.bucketLayerIDs.push(br.map(Vn=>o.C(Vn.id,Vn.scope))),Gr.recalculate(ar,[]);const Nr=o.fs(et,1/o.d4(ye.tileID.canonical)),Wr=new o.ft(br,Nr,xe,Ot,gt,this.brightness,$e,this.worldview);Ot||(Wr.needsUpload=!0),Fe.push(Wr),Wr.evaluate(Gr)}this.status="done",Re(null,{buckets:Fe,featureIndex:$e,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(et=>Re(new Error(et.message)))}}class qo{constructor(se,ce,ye,Re,xe,Fe,rt,$e){this.actor=se,this.layerIndex=ce,this.availableImages=ye,this.availableModels=Re,this.brightness=rt,this.loading={},this.loaded={},this.worldview=$e}loadTile(se,ce){const ye=se.uid,Re=this.loading[ye]=new Mi(se,this.brightness,this.worldview);o.br(se.request,(xe,Fe)=>{const rt=!this.loading[ye];return delete this.loading[ye],rt||xe?(Re.status="done",rt||(this.loaded[ye]=Re),ce(xe)):Fe&&Fe.byteLength!==0?void Re.parse(Fe,this.layerIndex,se,($e,et)=>{Re.status="done",this.loaded=this.loaded||{},this.loaded[ye]=Re,$e||!et?ce($e):ce(null,et)}):(Re.status="done",this.loaded[ye]=Re,ce())})}reloadTile(se,ce){const ye=this.loaded,Re=se.uid;if(ye&&ye[Re]){const xe=ye[Re];xe.projection=se.projection,xe.brightness=se.brightness;const Fe=(rt,$e)=>{xe.reloadCallback&&(delete xe.reloadCallback,this.loadTile(se,ce)),ce(rt,$e)};xe.status==="parsing"?xe.reloadCallback=Fe:xe.status==="done"&&this.loadTile(se,ce)}}abortTile(se,ce){const ye=se.uid;this.loading[ye]&&delete this.loading[ye],ce()}removeTile(se,ce){const ye=this.loaded,Re=se.uid;ye&&ye[Re]&&delete ye[Re],ce()}}class Br{constructor(se){this.self=se,this.actor=new o.fv(se,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cj({name:"mercator"}),this.workerSourceTypes={vector:$,geojson:Zn,"raster-dem":U,"raster-array":Z,"batched-model":qo},this.workerSources={},this.self.registerWorkerSource=(ce,ye)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=ye},this.self.registerRTLTextPlugin=ce=>{if(o.fw.isParsed())throw new Error("RTL text plugin already registered.");o.fw.setState({pluginStatus:o.fx.parsed,pluginURL:o.fw.getPluginURL()}),o.fw.applyArabicShaping=ce.applyArabicShaping,o.fw.processBidirectionalText=ce.processBidirectionalText,o.fw.processStyledBidirectionalText=ce.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(se,ce,ye){delete this.layerIndexes[se],delete this.availableImages[se],delete this.availableModels[se],delete this.workerSources[se],ye()}checkIfReady(se,ce,ye){ye()}setReferrer(se,ce){this.referrer=ce}spriteLoaded(se,ce){this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={});const{scope:ye,isLoaded:Re}=ce;if(this.isSpriteLoaded[se][ye]=Re,this.workerSources[se]&&this.workerSources[se][ye])for(const xe in this.workerSources[se][ye]){const Fe=this.workerSources[se][ye][xe];for(const rt in Fe){const $e=Fe[rt];$e instanceof $&&($e.isSpriteLoaded=Re,$e.fire(new o.A("isSpriteLoaded")))}}}setImages(se,ce,ye){this.availableImages[se]||(this.availableImages[se]={});const{scope:Re,images:xe}=ce;if(this.availableImages[se][Re]=xe,this.workerSources[se]&&this.workerSources[se][Re]){for(const Fe in this.workerSources[se][Re]){const rt=this.workerSources[se][Re][Fe];for(const $e in rt)rt[$e].availableImages=xe}ye()}else ye()}setModels(se,{scope:ce,models:ye},Re){if(this.availableModels[se]||(this.availableModels[se]={}),this.availableModels[se][ce]=ye,this.workerSources[se]&&this.workerSources[se][ce]){for(const xe in this.workerSources[se][ce]){const Fe=this.workerSources[se][ce][xe];for(const rt in Fe)Fe[rt].availableModels=ye}Re()}else Re()}setProjection(se,ce){this.projections[se]=o.cj(ce)}setBrightness(se,ce,ye){this.brightness=ce,ye()}setWorldview(se,ce,ye){this.worldview=ce,ye()}setLayers(se,ce,ye){this.getLayerIndex(se,ce.scope).replace(ce.layers,ce.options),ye()}updateLayers(se,ce,ye){this.getLayerIndex(se,ce.scope).update(ce.layers,ce.removedIds,ce.options),ye()}loadTile(se,ce,ye){ce.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ce.type,ce.source,ce.scope).loadTile(ce,ye)}decodeRasterArray(se,ce,ye){this.getWorkerSource(se,ce.type,ce.source,ce.scope).decodeRasterArray(ce,ye)}reloadTile(se,ce,ye){ce.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ce.type,ce.source,ce.scope).reloadTile(ce,ye)}abortTile(se,ce,ye){this.getWorkerSource(se,ce.type,ce.source,ce.scope).abortTile(ce,ye)}removeTile(se,ce,ye){this.getWorkerSource(se,ce.type,ce.source,ce.scope).removeTile(ce,ye)}removeSource(se,ce,ye){if(!(this.workerSources[se]&&this.workerSources[se][ce.scope]&&this.workerSources[se][ce.scope][ce.type]&&this.workerSources[se][ce.scope][ce.type][ce.source]))return;const Re=this.workerSources[se][ce.scope][ce.type][ce.source];delete this.workerSources[se][ce.scope][ce.type][ce.source],Re.removeSource!==void 0?Re.removeSource(ce,ye):ye()}loadWorkerSource(se,ce,ye){try{this.self.importScripts(ce.url),ye()}catch(Re){ye(Re.toString())}}syncRTLPluginState(se,ce,ye){if(o.fw.isParsed())ye(null,!0);else if(o.fw.isParsing())this.rtlPluginParsingListeners.push(ye);else try{o.fw.setState(ce);const Re=o.fw.getPluginURL();!o.fw.isLoaded()||o.fw.isParsed()||o.fw.isParsing()||Re==null||(o.fw.setState({pluginStatus:o.fx.parsing,pluginURL:o.fw.getPluginURL()}),this.self.importScripts(Re),o.fw.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(Re){ye(Re.toString())}}setDracoUrl(se,ce){this.dracoUrl=ce}getAvailableImages(se,ce){this.availableImages[se]||(this.availableImages[se]={});let ye=this.availableImages[se][ce];return ye||(ye=[]),ye}getAvailableModels(se,ce){this.availableModels[se]||(this.availableModels[se]={});let ye=this.availableModels[se][ce];return ye||(ye={}),ye}getLayerIndex(se,ce){this.layerIndexes[se]||(this.layerIndexes[se]={});let ye=this.layerIndexes[se][ce];return ye||(ye=this.layerIndexes[se][ce]=new P,ye.scope=ce),ye}getWorkerSource(se,ce,ye,Re){const xe=this.workerSources;return xe[se]||(xe[se]={}),xe[se][Re]||(xe[se][Re]={}),xe[se][Re][ce]||(xe[se][Re][ce]={}),this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={}),xe[se][Re][ce][ye]||(xe[se][Re][ce][ye]=new this.workerSourceTypes[ce]({send:(Fe,rt,$e,et,Ot,gt)=>this.actor.send(Fe,rt,$e,se,Ot,gt),scheduler:this.actor.scheduler},this.getLayerIndex(se,Re),this.getAvailableImages(se,Re),this.getAvailableModels(se,Re),this.isSpriteLoaded[se][Re],void 0,this.brightness,this.worldview)),xe[se][Re][ce][ye]}rasterizeImagesWorker(se,ce,ye){const Re=new Map;for(const[xe,{image:Fe,imageVariant:rt}]of ce.tasks.entries()){const $e=this.imageRasterizer.rasterize(rt,Fe,ce.scope,se);Re.set(xe,$e)}ye(void 0,Re)}removeRasterizedImages(se,ce,ye){this.imageRasterizer.removeImagesFromCacheByIds(ce.imageIds,ce.scope,se),ye()}enforceCacheSizeLimit(se,ce){o.fy(ce)}getWorkerPerformanceMetrics(se,ce,ye){ye(void 0,void 0)}}return o.fu(self)&&(self.worker=new Br(self)),Br}),h(["./shared"],function(o){var v="3.14.0";const b={create:"create",load:"load",fullLoad:"fullLoad"},E={mark(m){performance.mark(m)},measure(m,s,u){performance.measure(m,s,u)}};function P(m){const s=m.name.split("?")[0];return o.a(s)&&s.includes("mapbox-gl.js")?"javascript":o.a(s)&&s.includes("mapbox-gl.css")?"css":o.b(s)?"fontRange":o.c(s)?"sprite":o.i(s)?"style":o.d(s)?"tilejson":"other"}var O,L={},B=function(){if(O)return L;function m(g){return!s(g)}function s(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,T,I=new Blob([""],{type:"text/javascript"}),k=URL.createObjectURL(I);try{T=new Worker(k),w=!0}catch{w=!1}return T&&T.terminate(),URL.revokeObjectURL(k),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var T=w.getContext("2d");if(!T)return!1;var I=T.getImageData(0,0,1,1);return I&&I.width===w.width}()?(u[x=g&&g.failIfMajorPerformanceCaveat]===void 0&&(u[x]=function(w){var T,I=function(k){var N=document.createElement("canvas"),F=Object.create(m.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=k,N.getContext("webgl2",F)}(w);if(!I)return!1;try{T=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!T||I.isContextLost())&&(I.shaderSource(T,"void main() {}"),I.compileShader(T),I.getShaderParameter(T,I.COMPILE_STATUS)===!0)}(x)),u[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}O=1,L.supported=m,L.notSupportedReason=s;var u={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},L}();function z(m,s,u){const g=document.createElement(m);return s!=null&&(g.className=s),u&&u.appendChild(g),g}function $(m,s,u){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(s))g.setAttributeNS(null,x,String(s[x]));return u&&u.appendChild(g),g}const U=typeof document<"u"?document.documentElement&&document.documentElement.style:null,G=U&&U.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Z;function ne(){U&&G&&(Z=U[G],U[G]="none")}function Y(){U&&G&&(U[G]=Z)}function ee(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",ee,!0)}function le(){window.addEventListener("click",ee,!0),window.setTimeout(()=>{window.removeEventListener("click",ee,!0)},0)}function fe(m,s){const u=m.getBoundingClientRect();return Me(m,u,s)}function Ce(m,s){const u=m.getBoundingClientRect(),g=[];for(let x=0;x<s.length;x++)g.push(Me(m,u,s[x]));return g}function Oe(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function Me(m,s,u){const g=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new o.P((u.clientX-s.left)*g,(u.clientY-s.top)*g)}const Ke="01",Ye="NO_ACCESS_TOKEN";class Le{constructor(s,u,g){this._transformRequestFn=s,this._customAccessToken=u,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const s=function(){let u="";for(let g=0;g<10;g++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ke,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}}normalizeStyleURL(s,u){if(!o.j(s))return s;const g=Je(s);return g.params.push(`sdk=js-${v}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeGlyphsURL(s,u){if(!o.j(s))return s;const g=Je(s);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeModelURL(s,u){if(!o.j(s))return s;const g=Je(s);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeSourceURL(s,u,g,x){if(!o.j(s))return s;const w=Je(s);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),g&&w.params.push(`language=${g}`),x&&w.params.push(`worldview=${x}`),this._makeAPIURL(w,this._customAccessToken||u)}normalizeIconsetURL(s,u){const g=Je(s);return o.j(s)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||u)):it(g)}normalizeSpriteURL(s,u,g,x){const w=Je(s);return o.j(s)?(w.path=`/styles/v1${w.path}/sprite${u}${g}`,this._makeAPIURL(w,this._customAccessToken||x)):(w.path+=`${u}${g}`,it(w))}normalizeTileURL(s,u,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!o.j(s))return s;const x=Je(s);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||g&&x.authority!=="raster"&&g===512?"@2x":""}${o.l.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${o.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${o.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${o.e.TILE_URL_VERSION}${x.path}`);const w=this._customAccessToken||function(T){for(const I of T){const k=I.match(/^access_token=(.*)$/);if(k)return k[1]}return null}(x.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,w)}canonicalizeTileURL(s,u){const g=Je(s);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return s;let x="mapbox://";g.path.match(/^\/raster\/v1\//)?x+=`raster/${g.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${g.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${g.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let w=g.params;return u&&(w=w.filter(T=>!T.match(/^access_token=/))),w.length&&(x+=`?${w.join("&")}`),x}canonicalizeTileset(s,u){const g=!!u&&o.j(u),x=[];for(const w of s.tiles||[])o.k(w)?x.push(this.canonicalizeTileURL(w,g)):x.push(w);return x}_makeAPIURL(s,u){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=Je(o.e.API_URL);if(s.protocol=x.protocol,s.authority=x.authority,s.protocol==="http"){const w=s.params.indexOf("secure");w>=0&&s.params.splice(w,1)}if(x.path!=="/"&&(s.path=`${x.path}${s.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return it(s);if(u=u||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return s.params=s.params.filter(w=>w.indexOf("access_token")===-1),s.params.push(`access_token=${u||""}`),it(s)}}const Qe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Je(m){const s=m.match(Qe);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function it(m){const s=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${s}`}const Ze="mapbox.eventData";function nt(m){if(!m)return null;const s=m.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(o.m(s[1]))}catch{return null}}class pt{constructor(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const u=nt(o.e.ACCESS_TOKEN);let g="";return g=u&&u.u?o.f(u.u):o.e.ACCESS_TOKEN||"",s?`${Ze}.${s}:${g}`:`${Ze}:${g}`}fetchEventData(){const s=o.s("localStorage"),u=this.getStorageKey(),g=this.getStorageKey("uuid");if(s)try{const x=localStorage.getItem(u);x&&(this.eventData=JSON.parse(x));const w=localStorage.getItem(g);w&&(this.anonId=w)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const s=o.s("localStorage"),u=this.getStorageKey(),g=this.getStorageKey("uuid"),x=this.anonId;if(s&&x)try{localStorage.setItem(g,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(u,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,u,g,x){if(!o.e.EVENTS_URL)return;const w=Je(o.e.EVENTS_URL);w.params.push(`access_token=${x||o.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(s).toISOString()},I=u?o.h(T,u):T,k={url:it(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=o.p(k,N=>{this.pendingRequest=null,g(N),this.saveEventData(),this.processRequests(x)})}queueRequest(s,u){this.queue.push(s),this.processRequests(u)}}const _t=new class extends pt{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,s){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(u=>o.j(u)||o.k(u))&&this.queueRequest(Date.now(),s)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=nt(o.e.ACCESS_TOKEN),u=s?s.u:o.e.ACCESS_TOKEN;let g=u!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),g=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),T=new Date(x),I=(x-this.eventData.lastSuccess)/864e5;g=g||I>=1||I<-1||w.getDate()!==T.getDate()}else g=!0;g?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ke,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=x,this.eventData.tokenU=u)},m):this.processRequests()}},It=_t.postTurnstileEvent.bind(_t),sr=new class extends pt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,s,u,g){this.skuToken=s,this.errorCb=g,o.e.EVENTS_URL&&(u||o.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(Ye)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:u}=this.queue.shift();s&&this.success[s]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ke,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},m))}remove(){this.errorCb=null}},Sr=sr.postMapLoadEvent.bind(sr),Kr=new class extends pt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let s=this.mapInstanceIdMap.get(m);return s||(s=o.u(),this.mapInstanceIdMap.set(m,s)),s}getEventId(m){const s=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,s+1),s}postStyleLoadEvent(m,s){const{map:u,style:g,importedStyles:x}=s;if(!o.e.EVENTS_URL||!m&&!o.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(u),T={mapInstanceId:w,eventId:this.getEventId(w),style:g};x.length&&(T.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:T},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:u}=this.queue.shift();this.postEvent(s,u,()=>{},m)}},Er=Kr.postStyleLoadEvent.bind(Kr),Kt=new class extends pt{constructor(){super("gljs.performance")}postPerformanceEvent(m,s){o.e.EVENTS_URL&&(m||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,performanceData:u}=this.queue.shift(),g=function(x){const w=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),I=function(X){const re={};if(X){for(const Q in X)if(Q!=="other")for(const oe of X[Q]){const ie=`${Q}ResolveRangeMin`,ue=`${Q}ResolveRangeMax`,pe=`${Q}RequestCount`,ge=`${Q}RequestCachedCount`;re[ie]=Math.min(re[ie]||1/0,oe.startTime),re[ue]=Math.max(re[ue]||-1/0,oe.responseEnd);const be=Ae=>{re[Ae]===void 0&&(re[Ae]=0),++re[Ae]};oe.transferSize!==void 0&&oe.transferSize===0&&be(ge),be(pe)}}return re}(function(X,re){const Q={};if(X)for(const oe of X){const ie=re(oe);Q[ie]===void 0&&(Q[ie]=[]),Q[ie].push(oe)}return Q}(w,P)),k=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=N?N.effectiveType:void 0,q={counters:[],metadata:[],attributes:[]},V=(X,re,Q)=>{Q!=null&&X.push({name:re,value:Q.toString()})};for(const X in I)V(q.counters,X,I[X]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(V(q.counters,"interactionRangeMin",x.interactionRange[0]),V(q.counters,"interactionRangeMax",x.interactionRange[1])),T)for(const X of Object.keys(b)){const re=b[X],Q=T.find(oe=>oe.name===re);Q&&V(q.counters,re,Q.startTime)}return V(q.counters,"visibilityHidden",x.visibilityHidden),V(q.attributes,"style",function(X){if(X)for(const re of X){const Q=re.name.split("?")[0];if(o.i(Q)){const oe=Q.split("/").slice(-2);if(oe.length===2)return`mapbox://styles/${oe[0]}/${oe[1]}`}}}(w)),V(q.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),V(q.attributes,"fogEnabled",x.fogEnabled?"true":"false"),V(q.attributes,"projection",x.projection),V(q.attributes,"zoom",x.zoom),V(q.metadata,"devicePixelRatio",k),V(q.metadata,"connectionEffectiveType",F),V(q.metadata,"navigatorUserAgent",navigator.userAgent),V(q.metadata,"screenWidth",window.screen.width),V(q.metadata,"screenHeight",window.screen.height),V(q.metadata,"windowWidth",window.innerWidth),V(q.metadata,"windowHeight",window.innerHeight),V(q.metadata,"mapWidth",x.width/k),V(q.metadata,"mapHeight",x.height/k),V(q.metadata,"webglRenderer",x.renderer),V(q.metadata,"webglVendor",x.vendor),V(q.metadata,"sdkVersion",v),V(q.metadata,"sdkIdentifier","mapbox-gl-js"),q}(u);for(const x of g.metadata);for(const x of g.counters);for(const x of g.attributes);this.postEvent(s,g,()=>{},m)}},Pr=Kt.postPerformanceEvent.bind(Kt),Qt=new class extends pt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,s,u,g){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const x=Je(o.e.API_URL+o.e.SESSION_PATH);x.params.push(`sku=${s||""}`),x.params.push(`access_token=${g||o.e.ACCESS_TOKEN||""}`);const w={url:it(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(w,T=>{this.pendingRequest=null,u(T),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,s,u,g){this.skuToken=s,this.errorCb=g,o.e.SESSION_PATH&&o.e.API_URL&&(u||o.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(Ye)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:u}=this.queue.shift();s&&this.success[s]||this.getSession(u,this.skuToken,g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},m)}remove(){this.errorCb=null}},nr=Qt.getSessionAPI.bind(Qt),xr=new Set;function Ft(m,s){s?xr.add(m):xr.delete(m)}class Pn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,u){this._updatedSourceCaches[s]=u,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const u=s.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(s.id),this.setDirty()}removeLayer(s){const u=s.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][s.id]=s,this._updatedLayers[u].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const u in this._updatedLayers)s[u]=s[u]||{},s[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)s[u]=s[u]||{},s[u].removedIds=Object.keys(this._removedLayers[u]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(s){return this._updatedImages[s]?Array.from(this._updatedImages[s].values()):[]}updateImage(s,u){this._updatedImages[u]=this._updatedImages[u]||new Set,this._updatedImages[u].add(o.I.toString(s)),this.setDirty()}resetUpdatedImages(s){this._updatedImages[s]&&this._updatedImages[s].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Hr(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class Yr extends o.E{constructor(s){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=s,s!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(s){this.loaded.set(s,!1),this.imageProviders.set(s,new Map),this.images.set(s,new Map),this.updatedImages.set(s,new Set),this.callbackDispatchedThisFrame.set(s,new Set),this.patterns.set(s,new Map),this.atlasImage.set(s,new o.r({width:1,height:1}))}removeScope(s){this.loaded.delete(s),this.imageProviders.delete(s),this.images.delete(s),this.updatedImages.delete(s),this.callbackDispatchedThisFrame.delete(s),this.patterns.delete(s),this.atlasImage.delete(s);const u=this.atlasTexture.get(s);u&&(u.destroy(),this.atlasTexture.delete(s))}addImageProvider(s,u){this.imageProviders.has(u)||this.imageProviders.set(u,new Map),this.imageProviders.get(u).set(s.id,s)}removeImageProvider(s,u){this.imageProviders.has(u)&&this.imageProviders.get(u).delete(s)}getPendingImageProviders(){const s=[];for(const u of this.imageProviders.values())for(const g of u.values())g.hasPendingRequests()&&s.push(g);return s}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const s of this.loaded.keys())if(!this.loaded.get(s))return!1;return!0}setLoaded(s,u){if(this.loaded.get(u)!==s&&(this.loaded.set(u,s),s)){for(const{ids:g,callback:x}of this.requestors)this._notify(g,u,x);this.requestors=[]}}hasImage(s,u){return!!this.getImage(s,u)}getImage(s,u){return this.images.get(u).get(s.toString())}addImage(s,u,g){this._validate(s,g)&&this.images.get(u).set(s.toString(),g)}_validate(s,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new o.z(new Error(`Image "${s.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new o.z(new Error(`Image "${s.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new o.z(new Error(`Image "${s.name}" has invalid "content" value`))),g=!1),g}_validateStretch(s,u){if(!s)return!0;let g=0;for(const x of s){if(x[0]<g||x[1]<x[0]||u<x[1])return!1;g=x[1]}return!0}_validateContent(s,u){return s?s.length!==4||!u.usvg&&(s[0]<0||u.data.width<s[0]||s[1]<0||u.data.height<s[1]||s[2]<0||u.data.width<s[2]||s[3]<0||u.data.height<s[3])?!1:!(s[2]<s[0]||s[3]<s[1]):!0}updateImage(s,u,g){const x=this.images.get(u).get(s.toString());g.version=x.version+1,this.images.get(u).set(s.toString(),g),this.updatedImages.get(u).add(s),this.removeFromImageRasterizerCache(s,u)}clearUpdatedImages(s){this.updatedImages.get(s).clear()}removeFromImageRasterizerCache(s,u){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[s],scope:u}):this.imageRasterizer.removeImagesFromCacheByIds([s],u))}removeImage(s,u){const g=this.images.get(u),x=g.get(s.toString());g.delete(s.toString()),this.patterns.get(u).delete(s.toString()),this.removeFromImageRasterizerCache(s,u),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(s){return Array.from(this.images.get(s).keys()).map(u=>o.I.from(u))}getImages(s,u,g){const x=[],w=[],T=this.imageProviders.get(u);for(const F of s){if(!F.iconsetId){x.push(F);continue}const q=T.get(F.iconsetId);q&&(this.getImage(F,u)?w.push(F):q.addPendingRequest(F))}if(x.length===0)return void this._notify(w,u,g);let I=!0;const k=!!this.loaded.get(u),N=this.images.get(u);if(!k)for(const F of x)N.has(F.toString())||(I=!1);k||I?this._notify(x,u,g):this.requestors.push({ids:x,scope:u,callback:g})}rasterizeImages(s,u){const g=new Map,{tasks:x,scope:w}=s;for(const[T,I]of x.entries()){const k=this.getImage(I.id,w);k&&g.set(T,{image:k,imageVariant:I})}this._rasterizeImages(w,g,u)}_rasterizeImages(s,u,g){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:u,scope:s},g);else{const x=new Map;for(const[w,{image:T,imageVariant:I}]of u.entries())x.set(w,this.imageRasterizer.rasterize(I,T,s,0));g(void 0,x)}}getUpdatedImages(s){return this.updatedImages.get(s)||new Set}_notify(s,u,g){const x=this.images.get(u),w=new Map;for(const T of s){if(!x.get(T.toString())){if(T.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:T.name}))}const I=x.get(T.toString());if(!I){o.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const k={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(k,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),w.set(o.I.toString(T),k)}g(null,w)}getPixelSize(s){const{width:u,height:g}=this.atlasImage.get(s);return{width:u,height:g}}getPattern(s,u,g){const x=s.toString(),w=this.patterns.get(u),T=w.get(x),I=this.getImage(s,u);if(!I)return null;if(T){if(T.position.version===I.version)return T.position;T.position.version=I.version}else{if(I.usvg&&!I.data){const k=this.getPatternInFlightId(x,u);if(this.patternsInFlight.has(k))return null;this.patternsInFlight.add(k);const N=new o.B(s).scaleSelf(o.q.devicePixelRatio),F=new Map([[N.toString(),{image:I,imageVariant:N}]]);return this._rasterizeImages(u,F,(q,V)=>this.storePatternImage(N,u,I,g,V)),null}this.storePattern(s,u,I)}return this._updatePatternAtlas(u,g),w.get(x).position}getPatternInFlightId(s,u){return o.C(s,u)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(s,u,g,x,w){const T=s.toString(),I=w?w.get(T):void 0;I&&(g.data=I,this.storePattern(s.id,u,g),this._updatePatternAtlas(u,x),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),u)))}storePattern(s,u,g){const x={w:g.data.width+2*o.F,h:g.data.height+2*o.F,x:0,y:0},w=new o.G(x,g,o.F);this.patterns.get(u).set(s.toString(),{bin:x,position:w})}destroyAtlasTextures(){for(const s of this.atlasTexture.values())s&&s.destroy();this.atlasTexture.clear()}bind(s,u){const g=s.gl;let x=this.atlasTexture.get(u);x?this.dirty&&(x.update(this.atlasImage.get(u)),this.dirty=!1):(x=new o.T(s,this.atlasImage.get(u),g.RGBA8),this.atlasTexture.set(u,x)),x.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,u){const g=this.patterns.get(s),x=Array.from(g.values()).map(({bin:N})=>N),{w,h:T}=o.H(x),I=this.atlasImage.get(s);I.resize({width:w||1,height:T||1});const k=this.images.get(s);for(const[N,{bin:F,position:q}]of g.entries()){let V=q.padding;const X=F.x+V,re=F.y+V,Q=k.get(N).data,oe=Q.width,ie=Q.height;V=V>1?V-1:V,o.r.copy(Q,I,{x:0,y:0},{x:X,y:re},{width:oe,height:ie},u),o.r.copy(Q,I,{x:0,y:ie-V},{x:X,y:re-V},{width:oe,height:V},u),o.r.copy(Q,I,{x:0,y:0},{x:X,y:re+ie},{width:oe,height:V},u),o.r.copy(Q,I,{x:oe-V,y:0},{x:X-V,y:re},{width:V,height:ie},u),o.r.copy(Q,I,{x:0,y:0},{x:X+oe,y:re},{width:V,height:ie},u),o.r.copy(Q,I,{x:oe-V,y:ie-V},{x:X-V,y:re-V},{width:V,height:V},u),o.r.copy(Q,I,{x:0,y:ie-V},{x:X+oe,y:re-V},{width:V,height:V},u),o.r.copy(Q,I,{x:0,y:0},{x:X+oe,y:re+ie},{width:V,height:V},u),o.r.copy(Q,I,{x:oe-V,y:0},{x:X-V,y:re+ie},{width:V,height:V},u)}this.dirty=!0}beginFrame(){for(const s of this.images.keys())this.callbackDispatchedThisFrame.set(s,new Set)}dispatchRenderCallbacks(s,u){const g=this.images.get(u);for(const x of s){if(this.callbackDispatchedThisFrame.get(u).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(u).add(x.toString());const w=g.get(x.toString());Hr(w)&&this.updateImage(x,u,w)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function kn(m){const s=m.key,u=m.value,g=m.valueSpec||{},x=m.objectElementValidators||{},w=m.style,T=m.styleSpec;let I=[];const k=o.J(u);if(k!=="object")return[new o.V(s,u,`object expected, ${k} found`)];for(const N in u){const F=N.split(".")[0];let q;x[F]?q=x[F]:g[F]?q=Kn:x["*"]?q=x["*"]:g["*"]&&(q=Kn),q?I=I.concat(q({key:(s&&`${s}.`)+N,value:u[N],valueSpec:g[F]||g["*"],style:w,styleSpec:T,object:u,objectKey:N},u)):I.push(new o.K(s,u[N],`unknown property "${N}"`))}for(const N in g)x[N]||g[N].required&&g[N].default===void 0&&u[N]===void 0&&I.push(new o.V(s,u,`missing required property "${N}"`));return I}function Si(m){const s=m.value,u=m.valueSpec,g=m.style,x=m.styleSpec,w=m.key,T=m.arrayElementValidator||Kn;if(o.J(s)!=="array")return[new o.V(w,s,`array expected, ${o.J(s)} found`)];if(u.length&&s.length!==u.length)return[new o.V(w,s,`array length ${u.length} expected, length ${s.length} found`)];if(u["min-length"]&&s.length<u["min-length"])return[new o.V(w,s,`array length at least ${u["min-length"]} expected, length ${s.length} found`)];let I={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};x.$version<7&&(I.function=u.function),o.J(u.value)==="object"&&(I=u.value);let k=[];for(let N=0;N<s.length;N++)k=k.concat(T({array:s,arrayIndex:N,value:s[N],valueSpec:I,style:g,styleSpec:x,key:`${w}[${N}]`},!0));return k}function jo(m){const s=m.key,u=m.value,g=m.valueSpec;let x=o.J(u);if(x==="number"&&u!=u&&(x="NaN"),x!=="number")return[new o.V(s,u,`number expected, ${x} found`)];if("minimum"in g){let w=g.minimum;if(o.J(g.minimum)==="array"&&(w=g.minimum[m.arrayIndex]),u<w)return[new o.V(s,u,`${u} is less than the minimum value ${w}`)]}if("maximum"in g){let w=g.maximum;if(o.J(g.maximum)==="array"&&(w=g.maximum[m.arrayIndex]),u>w)return[new o.V(s,u,`${u} is greater than the maximum value ${w}`)]}return[]}function No(m){const s=m.valueSpec,u=o.M(m.value.type);let g,x,w,T={};const I=u!=="categorical"&&m.value.property===void 0,k=!I,N=o.J(m.value.stops)==="array"&&o.J(m.value.stops[0])==="array"&&o.J(m.value.stops[0][0])==="object",F=kn({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(X){if(u==="identity")return[new o.V(X.key,X.value,'identity function may not have a "stops" property')];let re=[];const Q=X.value;return re=re.concat(Si({key:X.key,value:Q,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:q})),o.J(Q)==="array"&&Q.length===0&&re.push(new o.V(X.key,Q,"array must have at least one stop")),re},default:function(X){return Kn({key:X.key,value:X.value,valueSpec:s,style:X.style,styleSpec:X.styleSpec})}}});return u==="identity"&&I&&F.push(new o.V(m.key,m.value,'missing required property "property"')),u==="identity"||m.value.stops||F.push(new o.V(m.key,m.value,'missing required property "stops"')),u==="exponential"&&m.valueSpec.expression&&!o.N(m.valueSpec)&&F.push(new o.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(k&&!o.O(m.valueSpec)?F.push(new o.V(m.key,m.value,"property functions not supported")):I&&!o.Q(m.valueSpec)&&F.push(new o.V(m.key,m.value,"zoom functions not supported"))),u!=="categorical"&&!N||m.value.property!==void 0||F.push(new o.V(m.key,m.value,'"property" property is required')),F;function q(X){let re=[];const Q=X.value,oe=X.key;if(o.J(Q)!=="array")return[new o.V(oe,Q,`array expected, ${o.J(Q)} found`)];if(Q.length!==2)return[new o.V(oe,Q,`array length 2 expected, length ${Q.length} found`)];if(N){if(o.J(Q[0])!=="object")return[new o.V(oe,Q,`object expected, ${o.J(Q[0])} found`)];if(Q[0].zoom===void 0)return[new o.V(oe,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new o.V(oe,Q,"object stop key must have value")];const ie=o.M(Q[0].zoom);if(typeof ie!="number")return[new o.V(oe,Q[0].zoom,"stop zoom values must be numbers")];if(w&&w>ie)return[new o.V(oe,Q[0].zoom,"stop zoom values must appear in ascending order")];ie!==w&&(w=ie,x=void 0,T={}),re=re.concat(kn({key:`${oe}[0]`,value:Q[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:jo,value:V}}))}else re=re.concat(V({key:`${oe}[0]`,value:Q[0],style:X.style,styleSpec:X.styleSpec},Q));return o.S(o.U(Q[1]))?re.concat([new o.V(`${oe}[1]`,Q[1],"expressions are not allowed in function stops.")]):re.concat(Kn({key:`${oe}[1]`,value:Q[1],valueSpec:s,style:X.style,styleSpec:X.styleSpec}))}function V(X,re){const Q=o.J(X.value),oe=o.M(X.value),ie=X.value!==null?X.value:re;if(g){if(Q!==g)return[new o.V(X.key,ie,`${Q} stop domain type must match previous stop domain type ${g}`)]}else g=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean"&&typeof oe!="number"&&typeof oe!="string"&&typeof oe!="boolean")return[new o.V(X.key,ie,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&u!=="categorical"){let ue=`number expected, ${Q} found`;return o.O(s)&&u===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(X.key,ie,ue)]}return u!=="categorical"||Q!=="number"||typeof oe=="number"&&isFinite(oe)&&Math.floor(oe)===oe?u!=="categorical"&&Q==="number"&&typeof oe=="number"&&typeof x=="number"&&x!==void 0&&oe<x?[new o.V(X.key,ie,"stop domain values must appear in ascending order")]:(x=oe,u==="categorical"&&oe in T?[new o.V(X.key,ie,"stop domain values must be unique")]:(T[oe]=!0,[])):[new o.V(X.key,ie,`integer expected, found ${String(oe)}`)]}}function ho(m){const s=(m.expressionContext==="property"?o.W:o.X)(o.U(m.value),m.valueSpec);if(s.result==="error")return s.value.map(g=>new o.V(`${m.key}${g.key}`,m.value,g.message));const u=s.value.expression||s.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!u.outputDefined())return[new o.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!o.Y(u))return[new o.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return Ci(u,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!o.Z(u,["zoom","feature-state"]))return[new o.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!o._(u))return[new o.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ci(m,s){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const x of s.valueSpec.expression.parameters)u.delete(x);if(u.size===0)return[];const g=[];return m instanceof o.$&&u.has(m.name)?[new o.V(s.key,s.value,`["${m.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(m.eachChild(x=>{g.push(...Ci(x,s))}),g)}function vo(m){const s=m.key,u=m.value,g=m.valueSpec,x=[];return Array.isArray(g.values)?g.values.indexOf(o.M(u))===-1&&x.push(new o.V(s,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(o.M(u))===-1&&x.push(new o.V(s,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),x}function fo(m){return o.a1(o.U(m.value))?ho(o.L({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Ta(m)}function Ta(m){const s=m.value,u=m.key;if(o.J(s)!=="array")return[new o.V(u,s,`array expected, ${o.J(s)} found`)];const g=m.styleSpec;let x,w=[];if(s.length<1)return[new o.V(u,s,"filter array must have at least 1 element")];switch(w=w.concat(vo({key:`${u}[0]`,value:s[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),o.M(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&o.M(s[1])==="$type"&&w.push(new o.V(u,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&w.push(new o.V(u,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(x=o.J(s[1]),x!=="string"&&w.push(new o.V(`${u}[1]`,s[1],`string expected, ${x} found`)));for(let T=2;T<s.length;T++)x=o.J(s[T]),o.M(s[1])==="$type"?w=w.concat(vo({key:`${u}[${T}]`,value:s[T],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&w.push(new o.V(`${u}[${T}]`,s[T],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let T=1;T<s.length;T++)w=w.concat(Ta({key:`${u}[${T}]`,value:s[T],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":x=o.J(s[1]),s.length!==2?w.push(new o.V(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):x!=="string"&&w.push(new o.V(`${u}[1]`,s[1],`string expected, ${x} found`))}return w}function Za(m,s){const u=m.key,g=m.style,x=m.layer,w=m.styleSpec,T=m.value,I=m.objectKey,k=w[`${s}_${m.layerType}`];if(!k)return[];const N=I.match(/^(.*)-use-theme$/);if(s==="paint"&&N&&k[N[1]])return o.S(T)?[].concat(Kn({key:m.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:I})):Kn({key:u,value:T,valueSpec:{type:"string"},style:g,styleSpec:w});const F=I.match(/^(.*)-transition$/);if(s==="paint"&&F&&k[F[1]]&&k[F[1]].transition)return Kn({key:u,value:T,valueSpec:w.transition,style:g,styleSpec:w});const q=m.valueSpec||k[I];if(!q)return[new o.K(u,T,`unknown property "${I}"`)];let V;if(o.J(T)==="string"&&o.O(q)&&!q.tokens&&(V=/^{([^}]+)}$/.exec(T))){const re=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new o.V(u,T,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${re}.`)]}const X=[];if(m.layerType==="symbol")I!=="text-field"||!g||g.glyphs||g.imports||X.push(new o.V(u,T,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&o.a2(o.U(T))&&o.M(T.type)==="identity"&&X.push(new o.V(u,T,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&s==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&o.O(q)&&(o.a3(q)||o.Q(q))){const re=o.W(o.U(T),q),Q=re.value.expression||re.value._styleExpression.expression;Q&&!o.Z(Q,["measure-light"])&&(I==="model-emissive-strength"&&o._(Q)&&o.Y(Q)||X.push(new o.V(u,T,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return X.concat(Kn({key:m.key,value:T,valueSpec:q,style:g,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:I}))}function Ii(m){return Za(m,"paint")}function xo(m){return Za(m,"layout")}function Ou(m){let s=[];const u=m.value,g=m.key,x=m.style,w=m.styleSpec;u.type||u.ref||s.push(new o.V(g,u,'either "type" or "ref" is required'));let T=o.M(u.type);const I=o.M(u.ref);if(u.id){const k=o.M(u.id);for(let N=0;N<m.arrayIndex;N++){const F=x.layers[N];o.M(F.id)===k&&s.push(new o.V(g,u.id,`duplicate layer id "${u.id}", previously used at line ${F.id.__line__}`))}}if("ref"in u){let k;["type","source","source-layer","filter","layout"].forEach(N=>{N in u&&s.push(new o.V(g,u[N],`"${N}" is prohibited for ref layers`))}),x.layers.forEach(N=>{o.M(N.id)===I&&(k=N)}),k?k.ref?s.push(new o.V(g,u.ref,"ref cannot reference another ref layer")):T=o.M(k.type):typeof I=="string"&&s.push(new o.V(g,u.ref,`ref layer "${I}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(u.source){const k=x.sources&&x.sources[u.source],N=k&&o.M(k.type);k?N==="vector"&&T==="raster"?s.push(new o.V(g,u.source,`layer "${u.id}" requires a raster source`)):N==="raster"&&T!=="raster"?s.push(new o.V(g,u.source,`layer "${u.id}" requires a vector source`)):N!=="vector"||u["source-layer"]?N==="raster-dem"&&T!=="hillshade"?s.push(new o.V(g,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&u.paint&&(u.paint["line-gradient"]||u.paint["line-trim-offset"])&&N==="geojson"&&!k.lineMetrics?s.push(new o.V(g,u,`layer "${u.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&N!=="raster-array"&&s.push(new o.V(g,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):s.push(new o.V(g,u.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new o.V(g,u,`layer "${u.id}" must specify a "source-layer"`)):s.push(new o.V(g,u.source,`source "${u.source}" not found`))}else s.push(new o.V(g,u,'missing required property "source"'));return s=s.concat(kn({key:g,value:u,valueSpec:w.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Kn({key:`${g}.type`,value:u.type,valueSpec:w.layer.type,style:m.style,styleSpec:m.styleSpec,object:u,objectKey:"type"}),filter:k=>fo(o.L({layerType:T},k)),layout:k=>kn({layer:u,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":N=>xo(o.L({layerType:T},N))}}),paint:k=>kn({layer:u,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":N=>Ii(o.L({layerType:T,layer:u},N))}})}})),s}function Xa(m){const s=m.value,u=m.key,g=o.J(s);return g!=="string"?[new o.V(u,s,`string expected, ${g} found`)]:[]}const Ka={promoteId:function m({key:s,value:u}){if(o.J(u)==="string")return Xa({key:s,value:u});if(Array.isArray(u)){const g=[],x=o.U(u),w=o.X(x);return w.result==="error"&&w.value.forEach(T=>{g.push(new o.V(`${s}${T.key}`,null,`${T.message}`))}),o.Z(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new o.V(`${s}`,null,"promoteId expression should be only feature dependent")),g}{const g=[];for(const x in u)g.push(...m({key:`${s}.${x}`,value:u[x]}));return g}}};function Mo(m){const s=m.value,u=m.key,g=m.styleSpec,x=m.style;if(!s.type)return[new o.V(u,s,'"type" is required')];const w=o.M(s.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(s.url||s.tiles||T.push(new o.K(u,s,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(kn({key:u,value:s,valueSpec:g[`source_${w.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:Ka})),T;case"geojson":if(T=kn({key:u,value:s,valueSpec:g.source_geojson,style:x,styleSpec:g,objectElementValidators:Ka}),s.cluster)for(const I in s.clusterProperties){const[k,N]=s.clusterProperties[I],F=typeof k=="string"?[k,["accumulated"],["get",I]]:k;T.push(...ho({key:`${u}.${I}.map`,value:N,expressionContext:"cluster-map"})),T.push(...ho({key:`${u}.${I}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return T;case"video":return kn({key:u,value:s,valueSpec:g.source_video,style:x,styleSpec:g});case"image":return kn({key:u,value:s,valueSpec:g.source_image,style:x,styleSpec:g});case"canvas":return[new o.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vo({key:`${u}.type`,value:s.type,valueSpec:{values:cs(g)}})}}function cs(m){return m.source.reduce((s,u)=>{const g=m[u];return g.type.type==="enum"&&(s=s.concat(Object.keys(g.type.values))),s},[])}function Ea(m){const s=m.value,u=m.styleSpec,g=u.light,x=m.style;let w=[];const T=o.J(s);if(s===void 0)return w;if(T!=="object")return w=w.concat([new o.V("light",s,`object expected, ${T} found`)]),w;for(const I in s){const k=I.match(/^(.*)-transition$/),N=I.match(/^(.*)-use-theme$/);w=w.concat(N&&g[N[1]]?Kn({key:I,value:s[I],valueSpec:{type:"string"},style:x,styleSpec:u}):k&&g[k[1]]&&g[k[1]].transition?Kn({key:I,value:s[I],valueSpec:u.transition,style:x,styleSpec:u}):g[I]?Kn({key:I,value:s[I],valueSpec:g[I],style:x,styleSpec:u}):[new o.V(I,s[I],`unknown property "${I}"`)])}return w}function us(m){const s=m.value;let u=[];if(!s)return u;const g=o.J(s);if(g!=="object")return u=u.concat([new o.V("light-3d",s,`object expected, ${g} found`)]),u;const x=m.styleSpec,w=x["light-3d"],T=m.key,I=m.style,k=m.style.lights;for(const q of["type","id"])if(!(q in s))return u=u.concat([new o.V("light-3d",s,`missing property ${q} on light`)]),u;if(s.type&&k)for(let q=0;q<m.arrayIndex;q++){const V=o.M(s.type),X=k[q];o.M(X.type)===V&&u.push(new o.V(T,s.id,`duplicate light type "${s.type}", previously defined at line ${X.id.__line__}`))}const N=`properties_light_${s.type}`;if(!(N in x))return u=u.concat([new o.V("light-3d",s,`Invalid light type ${s.type}`)]),u;const F=x[N];for(const q in s)if(q==="properties"){const V=s[q],X=o.J(V);if(X!=="object")return u=u.concat([new o.V("properties",V,`object expected, ${X} found`)]),u;for(const re in V){const Q=re.match(/^(.*)-transition$/),oe=re.match(/^(.*)-use-theme$/);u=u.concat(oe&&F[oe[1]]?Kn({key:q,value:V[re],valueSpec:{type:"string"},style:I,styleSpec:x}):Q&&F[Q[1]]&&F[Q[1]].transition?Kn({key:q,value:s[q],valueSpec:x.transition,style:I,styleSpec:x}):F[re]?Kn({key:re,value:V[re],valueSpec:F[re],style:I,styleSpec:x}):[new o.K(m.key,V[re],`unknown property "${re}"`)])}}else u=u.concat(w[q]?Kn({key:q,value:s[q],valueSpec:w[q],style:I,styleSpec:x}):[new o.K(q,s[q],`unknown property "${q}"`)]);return u}function Ya(m){const s=m.value,u=m.key,g=m.style,x=m.styleSpec,w=x.terrain;let T=[];const I=o.J(s);if(s===void 0||I==="null")return T;if(I!=="object")return T=T.concat([new o.V("terrain",s,`object expected, ${I} found`)]),T;for(const k in s){const N=k.match(/^(.*)-transition$/),F=k.match(/^(.*)-use-theme$/);T=T.concat(F&&w[F[1]]?Kn({key:k,value:s[k],valueSpec:{type:"string"},style:g,styleSpec:x}):N&&w[N[1]]&&w[N[1]].transition?Kn({key:k,value:s[k],valueSpec:x.transition,style:g,styleSpec:x}):w[k]?Kn({key:k,value:s[k],valueSpec:w[k],style:g,styleSpec:x}):[new o.K(k,s[k],`unknown property "${k}"`)])}if(s.source){const k=g.sources&&g.sources[s.source],N=k&&o.M(k.type);k?N!=="raster-dem"&&T.push(new o.V(u,s.source,`terrain cannot be used with a source of type ${String(N)}, it only be used with a "raster-dem" source type`)):T.push(new o.V(u,s.source,`source "${s.source}" not found`))}else T.push(new o.V(u,s,'terrain is missing required property "source"'));return T}function Ts(m){const s=m.value,u=m.style,g=m.styleSpec,x=g.fog;let w=[];const T=o.J(s);if(s===void 0)return w;if(T!=="object")return w=w.concat([new o.V("fog",s,`object expected, ${T} found`)]),w;for(const I in s){const k=I.match(/^(.*)-transition$/),N=I.match(/^(.*)-use-theme$/);w=w.concat(N&&x[N[1]]?Kn({key:I,value:s[I],valueSpec:{type:"string"},style:u,styleSpec:g}):k&&x[k[1]]&&x[k[1]].transition?Kn({key:I,value:s[I],valueSpec:g.transition,style:u,styleSpec:g}):x[I]?Kn({key:I,value:s[I],valueSpec:x[I],style:u,styleSpec:g}):[new o.K(I,s[I],`unknown property "${I}"`)])}return w}const Mc={"*":()=>[],array:Si,boolean:function(m){const s=m.value,u=m.key,g=o.J(s);return g!=="boolean"?[new o.V(u,s,`boolean expected, ${g} found`)]:[]},number:jo,color:function(m){const s=m.key,u=m.value,g=o.J(u);return g!=="string"?[new o.V(s,u,`color expected, ${g} found`)]:o.a0.parseCSSColor(u)===null?[new o.V(s,u,`color expected, "${u}" found`)]:[]},enum:vo,filter:fo,function:No,layer:Ou,object:kn,source:Mo,model:o.a4,light:Ea,"light-3d":us,terrain:Ya,fog:Ts,string:Xa,formatted:function(m){return Xa(m).length===0?[]:ho(m)},resolvedImage:function(m){return Xa(m).length===0?[]:ho(m)},projection:function(m){const s=m.value,u=m.styleSpec,g=u.projection,x=m.style;let w=[];const T=o.J(s);if(T==="object")for(const I in s)w=w.concat(Kn({key:I,value:s[I],valueSpec:g[I],style:x,styleSpec:u}));else T!=="string"&&(w=w.concat([new o.V("projection",s,`object or string expected, ${T} found`)]));return w},import:function(m){const{value:s,styleSpec:u}=m,{data:g,...x}=s;Object.defineProperty(x,"__line__",{value:s.__line__,enumerable:!1});let w=kn(o.L({},m,{value:x,valueSpec:u.import}));return o.M(x.id)===""&&w.push(new o.V(`${m.key}.id`,x,"import id can't be an empty string")),g&&(w=w.concat(kc(g,u,{key:`${m.key}.data`}))),w},iconset:function(m){const s=m.value,u=m.key,g=m.styleSpec,x=m.style;if(!s.type)return[new o.V(u,s,'"type" is required')];const w=o.M(s.type);let T=[];if(T=T.concat(kn({key:u,value:s,valueSpec:g[`iconset_${w}`],style:x,styleSpec:g})),w==="source"&&s.source){const I=x.sources&&x.sources[s.source],k=I&&o.M(I.type);I?k!=="raster-array"&&T.push(new o.V(u,s.source,`iconset cannot be used with a source of type ${String(k)}, it only be used with a "raster-array" source type`)):T.push(new o.V(u,s.source,`source "${s.source}" not found`))}return T}};function Kn(m,s=!1){const u=m.value,g=m.valueSpec,x=m.styleSpec;if(g.expression&&o.a2(o.M(u)))return No(m);if(g.expression&&o.S(o.U(u)))return ho(m);if(g.type&&Mc[g.type]){const w=Mc[g.type](m);return s===!0&&w.length>0&&o.J(m.value)==="array"?ho(m):w}return kn(o.L({},m,{valueSpec:g.type?x[g.type]:g}))}function Oc(m){const s=m.value,u=m.key,g=Xa(m);return g.length||(s.indexOf("{fontstack}")===-1&&g.push(new o.V(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&g.push(new o.V(u,s,'"glyphs" url must include a "{range}" token'))),g}function kc(m,s=o.a5,u={}){return Kn({key:u.key||"",value:m,valueSpec:s.$root,styleSpec:s,style:m,objectElementValidators:{glyphs:Oc,"*":()=>[]}})}function Es(m,s=o.a5){return Re(kc(m,s))}const Wl=m=>Re(Mo(m)),Aa=m=>Re(Ea(m)),Rc=m=>Re(us(m)),ut=m=>Re(Ya(m)),Zn=m=>Re(Ts(m)),Mi=m=>Re(function(s){const u=s.value,g=s.style,x=s.styleSpec,w=x.snow;let T=[];const I=o.J(u);if(u===void 0)return T;if(I!=="object")return T=T.concat([new o.V("snow",u,`object expected, ${I} found`)]),T;for(const k in u){const N=k.match(/^(.*)-transition$/);T=T.concat(N&&w[N[1]]&&w[N[1]].transition?Kn({key:k,value:u[k],valueSpec:x.transition,style:g,styleSpec:x}):w[k]?Kn({key:k,value:u[k],valueSpec:w[k],style:g,styleSpec:x}):[new o.K(k,u[k],`unknown property "${k}"`)])}return T}(m)),qo=m=>Re(function(s){const u=s.value,g=s.style,x=s.styleSpec,w=x.rain;let T=[];const I=o.J(u);if(u===void 0)return T;if(I!=="object")return T=T.concat([new o.V("rain",u,`object expected, ${I} found`)]),T;for(const k in u){const N=k.match(/^(.*)-transition$/);T=T.concat(N&&w[N[1]]&&w[N[1]].transition?Kn({key:k,value:u[k],valueSpec:x.transition,style:g,styleSpec:x}):w[k]?Kn({key:k,value:u[k],valueSpec:w[k],style:g,styleSpec:x}):[new o.K(k,u[k],`unknown property "${k}"`)])}return T}(m)),Br=m=>Re(Ou(m)),Ge=m=>Re(fo(m)),se=m=>Re(Ii(m)),ce=m=>Re(xo(m)),ye=m=>Re(o.a4(m));function Re(m){return m.slice().sort((s,u)=>s.line&&u.line?s.line-u.line:0)}function xe(m,s){let u=!1;if(s&&s.length)for(const g of s)g instanceof o.K?o.w(g.message):(m.fire(new o.z(new Error(g.message))),u=!0);return u}let Fe;class rt extends o.E{constructor(s,u="flat"){super(),this._transitionable=new o.a6(Fe||(Fe=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(s,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,u,g={}){this._validate(Aa,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=u)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,g){return(!g||g.validate!==!1)&&xe(this,s.call(Es,o.h({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let $e=class extends o.E{constructor(m,s,u,g,x){super(),this.scope=u,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),u,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s,this.worldview=x}get(){return this._transitionable.serialize()}set(m,s){this._transitionable.setTransitionOrValue(m,s)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new o.aa(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const s=m.value.expression;if(!s)return null;let u=-1,g=-1,x=1;for(const w of s.zoomStops)x=s.evaluate(new o.aa(w,{worldview:this.worldview})),x>.01?(u=w,g=-1):g=w;return x<.01&&u>0&&g>u?[u,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof o.ab}};const et=45,Ot=65,gt=.05;function ar(m,s,u,g){const x=o.af(et,Ot,u),[w,T]=yr(m,g);let I=1-Math.min(1,Math.exp((s-w)/(T-w)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*x*m.alpha}function yr(m,s){const u=.5/Math.tan(.5*s);return[m.range[0]+u,m.range[1]+u]}function br(m,s,u,g,x){const w=o.ad([],[s,u,g],x.mercatorFogMatrix);return ar(m,o.ae(w),x.pitch,x._fov)}function Gr(m,s,u,g,x,w,T){const I=[[u,g,0],[x,g,0],[x,w,0],[u,w,0]];let k=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(const F of I){const q=o.ad([],F,s),V=o.ae(q);k=Math.min(k,V),N=Math.max(N,V)}return[ar(m,k,T.pitch,T._fov),ar(m,N,T.pitch,T._fov)]}class Nr extends o.E{constructor(s,u,g,x){super();const w=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(w,g,new Map(x)),this.set(s,x),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new o.ag(w),this.scope=g}get state(){const s=this._transform,u=s.projection.name==="globe",g=o.ah(s.zoom),x=this.properties.get("range"),w=[.5,3];return{range:u?[o.ai(w[0],x[0],g),o.ai(w[1],x[1],g)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,u,g={}){if(this._validate(Zn,s,g))return;const x=o.h({},s);for(const w of Object.keys(o.a5.fog))x[w]===void 0&&(x[w]=o.a5.fog[w].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(et,Ot,s))*u.a}getOpacityAtLatLng(s,u){return this._transform.projection.supportsFog?function(g,x,w){const T=o.ac.fromLngLat(x),I=w.elevation?w.elevation.getAtPointOrZero(T):0;return br(g,T.x,T.y,I,w)}(this.state,s,u):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Gr(this.state,u,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(s,u,g,x,w){return this._transform.projection.supportsFog?Gr(this.state,s,u,g,x,w,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?yr(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const g of u){const x=s.points[g];let w;if(x[2]>=0)w=x;else{const T=s.points[g-4];w=o.ak(T,x,T[2]/(T[2]-x[2]))}if(br(this.state,w[0],w[1],0,this._transform)>=gt)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,g){return(!g||g.validate!==!1)&&xe(this,s.call(Es,o.h({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Wr,Vn,qr,Ti,eo=class extends o.E{constructor(m,s,u,g){super();const x=Wr||(Wr=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(x,u,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(x),this.scope=u}get state(){const m=this.properties.get("opacity"),s=this.properties.get("color"),u=this.properties.get("direction"),g=o.al(u[0]),x=-Math.max(o.al(u[1]),.01),w=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(s.r,s.g,s.b,s.a*m),direction:w,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(m,s,u={}){if(this._validate(Mi,m,u))return;const g=o.h({},m);for(const x of Object.keys(o.a5.snow))g[x]===void 0&&(g[x]=o.a5.snow[x].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,s,u){return(!u||u.validate!==!1)&&xe(this,m.call(Es,o.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},Ui=class extends o.E{constructor(m,s,u,g){super();const x=Vn||(Vn=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(x,u,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(x),this.scope=u}get state(){const m=this.properties.get("opacity"),s=this.properties.get("color"),u=this.properties.get("direction"),g=o.al(u[0]),x=-Math.max(o.al(u[1]),.01),w=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(s.r,s.g,s.b,s.a*m),direction:w,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(m,s,u={}){if(this._validate(qo,m,u))return;const g=o.h({},m);for(const x of Object.keys(o.a5.rain))g[x]===void 0&&(g[x]=o.a5.rain[x].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,s,u){return(!u||u.validate!==!1)&&xe(this,m.call(Es,o.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class jn extends o.E{constructor(s,u,g,x){super(),this.scope=g,this._options=s,this.properties=new o.ag(u),this._transitionable=new o.a6(u,g,new Map(x)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,u){this._options=s,this._transitionable.setTransitionOrValue(s.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class mn{constructor(s,u,g){this.screenBounds=s,this.cameraPoint=g.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(s,u){let g,x;if(s instanceof o.P||typeof s[0]=="number"){const w=o.P.convert(s);g=[w],x=u.isPointAboveHorizon(w)}else{const w=o.P.convert(s[0]),T=o.P.convert(s[1]),I=w.add(T)._div(2);g=[w,T],x=o.ao(w,T).every(k=>u.isPointAboveHorizon(k))&&u.isPointAboveHorizon(I)}return new mn(g,x,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.ao(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(x[3]=this.cameraPoint)),o.ap(x,s)}bufferedCameraGeometryGlobe(s){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.ao(u,g,s),w=this.cameraPoint.clone();switch(3*((w.y>u.y)+(w.y>g.y))+((w.x>u.x)+(w.x>g.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(s,u,g,x=0){const w=s.queryPadding/u._pixelsPerMercatorPixel+1,T=g?this._bufferedCameraMercator(w,u):this._bufferedScreenMercator(w,u);let I=s.tileID.wrap+(T.unwrapped?x:0);const k=T.polygon.map(oe=>o.aq(s.tileTransform,oe,I));if(!o.ar(k,0,0,o.aj,o.aj))return;I=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const N=this.screenGeometryMercator.polygon.map(oe=>o.as(s.tileTransform,oe,I)),F=N.map(oe=>new o.P(oe[0],oe[1])),q=u.getFreeCameraOptions().position||new o.ac(0,0,0),V=o.as(s.tileTransform,q,I),X=N.map(oe=>{const ie=o.at(oe,oe,V);return o.au(ie,ie),new o.av(V,ie)}),re=o.aw(s,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:X,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(Q=o.ax(k),Q.min.x=o.ay(Q.min.x,0,o.aj),Q.min.y=o.ay(Q.min.y,0,o.aj),Q.max.x=o.ay(Q.max.x,0,o.aj),Q.max.y=o.ay(Q.max.y,0,o.aj),Q),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:re};var Q}_bufferedScreenMercator(s,u){const g=li(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),u):{polygon:this.bufferedScreenGeometry(s).map(w=>u.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(s,u){const g=li(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),u):{polygon:this.bufferedCameraGeometry(s).map(w=>u.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[g]=x,x}}_projectAndResample(s,u){const g=function(w,T){const I=o.az([],T.pixelMatrix,T.globeMatrix),k=[0,-o.aB,0,1],N=[0,o.aB,0,1],F=[0,0,0,1];o.aA(k,k,I),o.aA(N,N,I),o.aA(F,F,I);const q=new o.P(k[0]/k[3],k[1]/k[3]),V=new o.P(N[0]/N[3],N[1]/N[3]),X=o.aC(w,q)&&k[3]<F[3],re=o.aC(w,V)&&N[3]<F[3];if(!X&&!re)return null;const Q=function(Ie,we,Se){for(let Te=1;Te<Ie.length;Te++){const We=fi(we.pointCoordinate3D(Ie[Te-1]).x),je=fi(we.pointCoordinate3D(Ie[Te]).x);if(Se<0){if(We<je)return{idx:Te,t:-We/(je-1-We)}}else if(je<We)return{idx:Te,t:(1-We)/(je+1-We)}}return null}(w,T,X?-1:1);if(!Q)return null;const{idx:oe,t:ie}=Q;let ue=oe>1?vi(w.slice(0,oe),T):[],pe=oe<w.length?vi(w.slice(oe),T):[];ue=ue.map(Ie=>new o.P(fi(Ie.x),Ie.y)),pe=pe.map(Ie=>new o.P(fi(Ie.x),Ie.y));const ge=[...ue];ge.length===0&&ge.push(pe[pe.length-1]);const be=o.ai(ge[ge.length-1].y,(pe.length===0?ue[0]:pe[0]).y,ie);let Ae;return Ae=X?[new o.P(0,be),new o.P(0,0),new o.P(1,0),new o.P(1,be)]:[new o.P(1,be),new o.P(1,1),new o.P(0,1),new o.P(0,be)],ge.push(...Ae),pe.length===0?ge.push(ue[0]):ge.push(...pe),{polygon:ge.map(Ie=>new o.ac(Ie.x,Ie.y)),unwrapped:!1}}(s,u);if(g)return g;const x=function(w,T){let I=!1,k=-1/0,N=0;for(let q=0;q<w.length-1;q++)w[q].x>k&&(k=w[q].x,N=q);for(let q=0;q<w.length-1;q++){const V=(N+q)%(w.length-1),X=w[V],re=w[V+1];Math.abs(X.x-re.x)>.5&&(X.x<re.x?(X.x+=1,V===0&&(w[w.length-1].x+=1)):(re.x+=1,V+1===w.length-1&&(w[0].x+=1)),I=!0)}const F=o.aD(T.center.lng);return I&&F<Math.abs(F-1)&&w.forEach(q=>{q.x-=1}),{polygon:w,unwrapped:I}}(vi(s,u).map(w=>new o.P(fi(w.x),w.y)),u);return{polygon:x.polygon.map(w=>new o.ac(w.x,w.y)),unwrapped:x.unwrapped}}}function vi(m,s){return o.aE(m,u=>{const g=s.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function fi(m){return m<0?1+m%1:m%1}function li(m){return 100*m|0}function bo(m,s,u,g,x){const w=function(I,k){if(I)return x(I);if(k){if(m.url&&k.tiles&&m.tiles&&delete m.tiles,k.variants){if(!Array.isArray(k.variants))return x(new Error("variants must be an array"));for(const F of k.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return x(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){k=o.h(k,F);break}}}const N=o.aF(o.h({},k,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);N.tiles=s.canonicalizeTileset(N,m.url),x(null,N)}},T=function(I,k,N){if(!I)return null;if(!k&&!N)return I;N=N||I.worldview_default;const F=Object.values(I.language||{});if(F.length===0)return null;const q=Object.values(I.worldview||{});if(q.length===0)return null;const V=F.every(re=>re===k),X=q.every(re=>re===N);return V&&X?I:k in(I.language_options||{})||N in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(m.data,u,g);return T?o.q.frame(()=>w(null,T)):m.url?o.n(s.transformRequest(s.normalizeSourceURL(m.url,null,u,g),o.R.Source),w):o.q.frame(()=>{const{data:I,...k}=m;w(null,k)})}function As(m,s){const u=Math.pow(2,s.z),g=Math.floor(o.aD(m.getWest())*u),x=Math.floor(o.aH(m.getNorth())*u),w=Math.ceil(o.aD(m.getEast())*u),T=Math.ceil(o.aH(m.getSouth())*u);return s.x>=g&&s.x<w&&s.y>=x&&s.y<T}class Zo{constructor(s,u,g){this.bounds=s?o.aG.convert(this.validateBounds(s)):null,this.minzoom=u||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}addExtraBounds(s){if(s){this.extraBounds||(this.extraBounds=[]);for(const u of s)this.extraBounds.push(o.aG.convert(this.validateBounds(u)))}}contains(s){if(s.z>this.maxzoom||s.z<this.minzoom||this.bounds&&!As(this.bounds,s))return!1;if(!this.extraBounds)return!0;for(const u of this.extraBounds)if(As(u,s))return!0;return!1}static fromTileJSON(s){if(!s.bounds&&!s.extra_bounds)return null;const u=new Zo(s.bounds,s.minzoom,s.maxzoom);return u.addExtraBounds(s.extra_bounds),u}}class Of extends o.E{constructor(s,u,g,x){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.h(this,o.aF(u,["url","scheme","tileSize","promoteId"])),this._options=o.h({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new o.aI}load(s){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=bo(this._options,this.map._requestManager,u,g,(x,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new o.z(x));else if(w){if(o.h(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of w.vector_layers)this.vectorLayerIds.push(T.id),w.worldview&&w.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=Zo.fromTileJSON(w),It(w.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}s&&s(x)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}loadTile(s,u){const g=s.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(g),w=this.map._requestManager.transformRequest(x,o.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,I=T?{image:T.image.clone()}:null,k={request:w,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&o.j(g)&&(k.localizableLayerIds=this.localizableLayerIds),k.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=u:s.request=s.actor.send("reloadTile",k,N.bind(this));else if(s.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",k,N.bind(this),void 0,!0);else{const F=o.aJ.call({deduped:this._deduped},k,(q,V)=>{q||!V?N.call(this,q):(k.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},s.actor&&s.actor.send("loadTile",k,N.bind(this),void 0,!0))},!0);s.request={cancel:F}}function N(F,q){return delete s.request,s.aborted?u(null):F&&F.status!==404?u(F):(q&&q.resourceTiming&&(s.resourceTiming=q.resourceTiming),this.map._refreshExpiredTiles&&q&&s.setExpiryData(q),s.loadVectorData(q,this.map.painter),o.aK(this.dispatcher),u(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,u){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Oo extends o.E{constructor(s,u,g,x){super(),this.id=s,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.h({type:"raster"},u),o.h(this,o.aF(u,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const u=this.map.getWorldview();this._tileJSONRequest=bo(this._options,this.map._requestManager,null,u,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new o.z(g)):x&&(o.h(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map(w=>w.id)),this.tileBounds=Zo.fromTileJSON(x),It(x.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),s&&s(g)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,u){const g=o.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=o.o(this.map._requestManager.transformRequest(x,o.R.Tile),(w,T,I,k)=>(delete s.request,s.aborted?(s.state="unloaded",u(null)):w?(s.state="errored",u(w)):T?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:I,expires:k}),s.setTexture(T,this.map.painter),s.state="loaded",o.aK(this.dispatcher),void u(null)):u(null)))}abortTile(s,u){s.request&&(s.request.cancel(),delete s.request),u&&u()}unloadTile(s,u){s.texture&&s.texture instanceof o.T?(s.destroy(!0),s.texture&&s.texture instanceof o.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Dc extends Oo{constructor(s,u,g,x){super(s,u,g,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.h({type:"raster-array"},u)}triggerRepaint(s){const u=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);u&&u.enabled&&g&&u._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,u){const g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(g,o.R.Tile),w={request:x,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=x,s.actor||(s.actor=this.dispatcher.getActor());const T=(I,k,N,F)=>{if(delete s.request,s.aborted)return s.state="unloaded",u(null);if(I)return I.name==="AbortError"?void 0:(s.state="errored",u(I));if(this.map._refreshExpiredTiles&&k&&s.setExpiryData({cacheControl:N,expires:F}),this.partial)s.state="empty";else{if(!k)return u(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=k}u(null)};s.request=this.partial?s.fetchHeader(void 0,T.bind(this)):s.actor.send("loadTile",w,T.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,u){const g=s.texturePerLayer;if(s.flushAllQueues(),g.size){s.destroy(!0);for(const x of g.values())this.map.painter.saveTileTexture(x)}else s.destroy()}prepareTile(s,u,g,x){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBand(u,g,x,(w,T)=>{if(w)return s.state="errored",this.fire(new o.z(w)),void this.triggerRepaint(s);T&&(s._isHeaderLoaded=!0,s.setTexturePerLayer(g,T,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:w})=>w===s),g=u&&u.fields,x=g&&g.bands&&g.bands;return x?x[0]:0}getTextureDescriptor(s,u,g){if(!s)return;const x=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let w=null;u instanceof o.aN?w=u.paint.get("raster-array-band"):u instanceof o.aO&&(w=u.paint.get("raster-particle-array-band"));const T=w||this.getInitialBand(x);if(T==null)return;if(!s.textureDescriptorPerLayer.get(u.id))return void this.prepareTile(s,x,u.id,T);if(s.updateNeeded(u.id,T)&&!g)return;const I=s.textureDescriptorPerLayer.get(u.id);return Object.assign({},I,{texture:s.texturePerLayer.get(u.id)})}getImages(s,u){const g=new Map;for(const x of s)for(const w of u){const[T,I]=w.split("/"),k=x.getLayer(T);if(!k||!k.hasBand(I)||!k.hasDataForBand(I))continue;const{bytes:N,tileSize:F,buffer:q}=k.getBandView(I),V=F+2*q,X={data:new o.r({width:V,height:V},N),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(w,X)}return g}}const zm={vector:Of,raster:Oo,"raster-dem":class extends Oo{constructor(m,s,u,g){super(m,s,u,g),this.type="raster-dem",this.maxzoom=22,this._options=o.h({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,w){x&&(m.state="errored",s(x)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=o.o(this.map._requestManager.transformRequest(u,o.R.Tile),function(x,w,T,I){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(x)m.state="errored",s(x);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:T,expires:I});const k=ImageBitmap&&w instanceof ImageBitmap&&o.t(),N=1-(w.width-o.aL(w.width))/2;N<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const F=k?w:o.q.getImageData(w,N),q={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:N};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",q,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const s=m.canonical,u=Math.pow(2,s.z),g=(s.x-1+u)%u,x=s.x===0?m.wrap-1:m.wrap,w=(s.x+1+u)%u,T=s.x+1===u?m.wrap+1:m.wrap,I={};return I[new o.aM(m.overscaledZ,x,s.z,g,s.y).key]={backfilled:!1},I[new o.aM(m.overscaledZ,T,s.z,w,s.y).key]={backfilled:!1},s.y>0&&(I[new o.aM(m.overscaledZ,x,s.z,g,s.y-1).key]={backfilled:!1},I[new o.aM(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new o.aM(m.overscaledZ,T,s.z,w,s.y-1).key]={backfilled:!1}),s.y+1<u&&(I[new o.aM(m.overscaledZ,x,s.z,g,s.y+1).key]={backfilled:!1},I[new o.aM(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new o.aM(m.overscaledZ,T,s.z,w,s.y+1).key]={backfilled:!1}),I}},"raster-array":Dc,geojson:class extends o.E{constructor(m,s,u,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=s.data,this._options=o.h({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const x=o.aj/this.tileSize;this.workerOptions=o.h({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*x,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*x,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:o.aj,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*x,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const s=new Map;for(const u of this._data.features)s.set(u.id,u);for(const u of m.features)s.set(u.id,u);this._data.features=[...s.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterLeaves(m,s,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:s,offset:u},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const s=o.h({append:m},this.workerOptions);s.scope=this.scope;const u=this._data;typeof u=="string"?(s.request=this.map._requestManager.transformRequest(o.q.resolveURL(u),o.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,x)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new o.z(g));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new o.A("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=o.C(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,s){const u=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,x=g?{image:g.image.clone()}:null,w=this._partialReload,T={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:w,worldview:this.map.getWorldview()};m.request=this.actor.send(u,T,(I,k)=>w&&!k?(m.state="loaded",s(null)):(delete m.request,m.destroy(),m.aborted?s(null):I?s(I):(m.loadVectorData(k,this.map.painter,u==="reloadTile"),s(null))),void 0,u==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,s){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(m,s,u,g){super(m,s,u,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,o.R.Source).url);o.aQ(this.urls,(s,u)=>{this._loaded=!0,s?this.fire(new o.z(s)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,s=m.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(m,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(m,s,u,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){const m=[];for(const s in this._options.models){const u=this._options.models[s],g=o.aS(this.map._requestManager.transformRequest(u.uri,o.R.Model).url).then(x=>{if(!x)return;const w=o.aT(x),T=new o.aU(s,u.position,u.orientation,w);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(x=>{this.fire(new o.z(new Error(`Could not load model ${s} from ${u.uri}: ${x.message}`)))});m.push(g)}Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${s.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,s){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(m,s,u,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=bo(this._options,this.map._requestManager,s,u,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new o.z(g))):x&&(o.h(this,x),x.bounds&&(this.tileBounds=new Zo(x.bounds,this.minzoom,this.maxzoom)),It(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,s){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,o.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=s;else{if(m.buckets){const w=Object.values(m.buckets);for(const T of w)T.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,x.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,x.bind(this),void 0,!0);function x(w,T){return m.aborted?s(null):w&&w.status!==404?s(w):(this.map._refreshExpiredTiles&&T&&m.setExpiryData(T),m.loadModelData(T,this.map.painter),m.state="loaded",void s(null))}}serialize(){return o.h({},this._options)}},canvas:class extends o.aP{constructor(m,s,u,g){super(m,s,u,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new o.z(new o.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends o.E{constructor(m,s,u,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Zo(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),o.h(this,o.aF(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:s,y:u,z:g}=m.canonical;return this._implementation.hasTile({x:s,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,s){const{x:u,y:g,z:x}=m.tileID.canonical,w=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:u,y:g,z:x},{signal:w.signal})).then(function(T){return delete m.request,m.aborted?(m.state="unloaded",s(null)):T===void 0?(m.state="errored",s(null)):T===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",s(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(T)?(this.loadTileData(m,T),m.state="loaded",void s(null)):(m.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(T=>{T.name!=="AbortError"&&(m.state="errored",s(T))}),m.request.cancel=()=>w.abort()}loadTileData(m,s){m.setTexture(s,this.map.painter)}unloadTile(m,s){if(m.texture&&m.texture instanceof o.T?(m.destroy(!0),m.texture&&m.texture instanceof o.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:u,y:g,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:x})}s&&s()}abortTile(m,s){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=o.C(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},kf=function(m,s,u,g){const x=new zm[s.type](m,s,u,g);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return o.aV(["load","abort","unload","serialize","prepare"],x),x};function Rf(m,s,u=""){return`${u}:${s.id||""}:${s.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:x,importId:w}=g;return`featureset:${x}${w?`:import:${w}`:""}`}}(m.target)}`}function Fm(m,s,u,g=""){if(m.uniqueFeatureID){const x=Rf(m,s,g);if(u.has(x))return!0;u.add(x)}return!1}function Bm(m,s,u,g,x=!1){const w=s.sourceCache.transform,T=s.sourceCache.tilesIn(m,s.has3DLayers,x);T.sort($m);const I=[];for(const k of T){const N=k.tile.queryRenderedFeatures(s,k,u,g,w,x);Object.keys(N).length&&I.push({wrappedTileID:k.tile.tileID.wrapped().key,queryResults:N})}return I.length===0?{}:function(k){const N={},F={};for(const q of k){const V=q.queryResults,X=q.wrappedTileID,re=F[X]=F[X]||{};for(const Q in V){const oe=V[Q],ie=re[Q]=re[Q]||{},ue=N[Q]=N[Q]||[];for(const pe of oe)ie[pe.featureIndex]||(ie[pe.featureIndex]=!0,ue.push(pe))}}return N}(I)}function ku(m,s,u,g,x,w){const T={},I=g.queryRenderedSymbols(m),k=[];for(const N of Object.keys(I).map(Number))k.push(x[N]);k.sort($m);for(const N of k){const F=N.featureIndex.lookupSymbolFeatures(I[N.bucketInstanceId],N.bucketIndex,N.sourceLayerIndex,s,u,w);for(const q in F){const V=T[q]=T[q]||[],X=F[q];X.sort((re,Q)=>{const oe=N.featureSortOrder;if(oe){const ie=oe.indexOf(re.featureIndex);return oe.indexOf(Q.featureIndex)-ie}return Q.featureIndex-re.featureIndex});for(const re of X)V.push(re)}}return T}function Df(m,s){const u=m.getRenderableIds().map(w=>m.getTileByID(w)),g=[],x={};for(let w=0;w<u.length;w++){const T=u[w],I=T.tileID.canonical.key;x[I]||(x[I]=!0,T.querySourceFeatures(g,s))}return g}function $m(m,s){const u=m.tileID,g=s.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function Ja(m,s){const u={};if(!s)return u;for(const g of m){const x=g.layerIds.map(w=>s.getLayer(w)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>x.filter(T=>T.id===w)[0]));for(const w of x)u[w.fqid]=g}}return u}const Qs=32,Pa=33,ql=new Uint16Array(8184);for(let m=0;m<2046;m++){let s=m+2,u=0,g=0,x=0,w=0,T=0,I=0;for(1&s?x=w=T=Qs:u=g=I=Qs;(s>>=1)>1;){const N=u+x>>1,F=g+w>>1;1&s?(x=u,w=g,u=T,g=I):(u=x,g=w,x=T,w=I),T=N,I=F}const k=4*m;ql[k+0]=u,ql[k+1]=g,ql[k+2]=x,ql[k+3]=w}const Qa=new Uint16Array(2178),Zl=new Uint8Array(1089),Lf=new Uint16Array(1089);function gl(m){return m===0?-.03125:m===32?.03125:0}const jf={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class Ru{constructor(s,u,g,x,w,T){this.tileID=s,this.uid=o.a$(),this.uses=0,this.tileSize=u,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=T}registerFadeDuration(s){const u=s+this.timeAdded;u<o.q.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,u,g){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=Ja(s.buckets,u.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const w=this.buckets[x];if(w instanceof o.b1){if(this.hasSymbolBuckets=!0,!g)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const w=this.buckets[x];if(w instanceof o.b1&&w.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const x in this.buckets){const w=this.buckets[x],T=u.style.getOwnLayer(x);if(!T)continue;const I=T.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,I)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,u,g){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,Ja(s.buckets,u.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const x in this.buckets){const w=this.buckets[x];w.uploadPending()&&w.upload(s)}const u=s.gl,g=this.imageAtlas;g&&!g.uploaded&&(this.imageAtlasTexture=new o.T(s,g.image,u.RGBA8,{useMipmap:!!g.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(s,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(s,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(s,u,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,g),!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=u.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(u,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(s,u,g,x,w,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=function(k,N){const F=o.bn([],[.5*k.width,.5*-k.height,1]);return o.bo(F,F,[1,-1,0]),o.az(F,F,k.calculateProjMatrix(N.toUnwrapped())),Float32Array.from(F)}(w,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:u,pixelPosMatrix:I,transform:x,availableImages:g,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(s,u){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const x=g.loadVTLayers(),w=u?u.sourceLayer:"",T=x._geojsonTileLayer||x[w];if(!T)return;const I=o.b3(u&&u.filter),{z:k,x:N,y:F}=this.tileID.canonical,q={z:k,x:N,y:F};for(let V=0;V<T.length;V++){const X=T.feature(V);if(I.needGeometry){const oe=o.b4(X,!0);if(!I.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),oe,this.tileID.canonical))continue}else if(!I.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),X))continue;const re=g.getId(X,w),Q=new o.b5(X,k,N,F,re);Q.tile=q,s.push(Q)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const u=this.expirationTime;if(s.cacheControl){const g=o.b6(s.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const g=Date.now();let x=!1;if(this.expirationTime>g)x=!1;else if(u)if(this.expirationTime<u)x=!0;else{const w=this.expirationTime-u;w?this.expirationTime=g+Math.max(w,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}updateBuckets(s,u){if(!this.latestFeatureIndex||!s.style)return;const g=this.latestFeatureIndex.loadVTLayers(),x=s.style.listImages(),w=s.style.getBrightness();for(const T in this.buckets){if(!s.style.hasLayer(T))continue;const I=this.buckets[T],k=I.layers[0],N=k.sourceLayer||"_geojsonTileLayer",F=g[N],q=s.style.getLayerSourceCache(k);let V={};q&&(V=q._state.getState(N,void 0));const X=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},re=Object.keys(V).length>0&&!u;re&&!I.stateDependentLayers.length&&!u||I.update(V,F,x,X,re?I.stateDependentLayers:I.layers,u,w),(I instanceof o.b7||I instanceof o.b8)&&s._terrain&&s._terrain.enabled&&q&&I.uploadPending()&&s._terrain._clearRenderCacheForTile(q.id,this.tileID);const Q=s&&s.style&&s.style.getOwnLayer(T);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=o.q.now()+s}setTexture(s,u){const g=u.context,x=g.gl;this.texture=this.texture||u.getTileTexture(s.width),this.texture&&this.texture instanceof o.T?this.texture.update(s):(this.texture=new o.T(g,s,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(s,u){const g={};for(const x of u)g[x]=!0;this.dependencies[s]=g}hasDependency(s,u){for(const g of s){const x=this.dependencies[g];if(x){for(const w of u)if(x[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const g=o.b9(jf,this.tileID.canonical,this.tileTransform)[0],x=new o.ba,w=new o.bb;for(let T=0;T<g.length;T++){const{x:I,y:k}=g[T];x.emplaceBack(I,k),w.emplaceBack(T)}w.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(w),this._tileDebugBuffer=s.createVertexBuffer(x,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,x.length,w.length)}_makeTileBoundsBuffers(s,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const g=o.b9(jf,this.tileID.canonical,this.tileTransform)[0];let x,w;if(this.isRaster){const T=function(I,k){const N=o.aW(I,k),F=Math.pow(2,I.z);for(let oe=0;oe<Pa;oe++)for(let ie=0;ie<Pa;ie++){const ue=o.aX((I.x+(ie+gl(ie))/Qs)/F),pe=o.aY((I.y+(oe+gl(oe))/Qs)/F),ge=k.project(ue,pe),be=oe*Pa+ie;Qa[2*be+0]=Math.round((ge.x*N.scale-N.x)*o.aj),Qa[2*be+1]=Math.round((ge.y*N.scale-N.y)*o.aj)}Zl.fill(0),Lf.fill(0);for(let oe=2045;oe>=0;oe--){const ie=4*oe,ue=ql[ie+0],pe=ql[ie+1],ge=ql[ie+2],be=ql[ie+3],Ae=ue+ge>>1,Ie=pe+be>>1,we=Ae+Ie-pe,Se=Ie+ue-Ae,Te=pe*Pa+ue,We=be*Pa+ge,je=Ie*Pa+Ae,ht=Math.hypot((Qa[2*Te+0]+Qa[2*We+0])/2-Qa[2*je+0],(Qa[2*Te+1]+Qa[2*We+1])/2-Qa[2*je+1])>=16;Zl[je]=Zl[je]||(ht?1:0),oe<1022&&(Zl[je]=Zl[je]||Zl[(pe+Se>>1)*Pa+(ue+we>>1)]||Zl[(be+Se>>1)*Pa+(ge+we>>1)])}const q=new o.aZ,V=new o.a_;let X=0;function re(oe,ie){const ue=ie*Pa+oe;return Lf[ue]===0&&(q.emplaceBack(Qa[2*ue+0],Qa[2*ue+1],oe*o.aj/Qs,ie*o.aj/Qs),Lf[ue]=++X),Lf[ue]-1}function Q(oe,ie,ue,pe,ge,be){const Ae=oe+ue>>1,Ie=ie+pe>>1;if(Math.abs(oe-ge)+Math.abs(ie-be)>1&&Zl[Ie*Pa+Ae])Q(ge,be,oe,ie,Ae,Ie),Q(ue,pe,ge,be,Ae,Ie);else{const we=re(oe,ie),Se=re(ue,pe),Te=re(ge,be);V.emplaceBack(we,Se,Te)}}return Q(0,0,Qs,Qs,Qs,0),Q(Qs,Qs,0,0,0,Qs),{vertices:q,indices:V}}(this.tileID.canonical,u);x=T.vertices,w=T.indices}else{x=new o.aZ,w=new o.a_;for(const{x:I,y:k}of g)x.emplaceBack(I,k,0,0);const T=o.be(x.int16.subarray(0,4*x.length),void 0,4);for(let I=0;I<T.length;I+=3)w.emplaceBack(T[I],T[I+1],T[I+2])}this._tileBoundsBuffer=s.createVertexBuffer(x,o.bf.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(w),this._tileBoundsSegments=o.bd.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugBuffers(s,u){const g=u.projection;if(!g||g.name!=="globe"||u.freezeTileCoverage)return;const x=this.tileID.canonical,w=o.bg(x,u),T=o.bh(w),I=o.ah(u.zoom);let k;I>0&&(k=o.bi(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,x,u,T,k,I),this._makeGlobeTileDebugTextBuffer(s,x,u,T,k,I)}_globePoint(s,u,g,x,w,T,I){let k=o.bj(s,u,g);if(T){const N=1<<g.z,F=o.aD(x.center.lng),q=o.aH(x.center.lat),V=(g.x+.5)/N-F;let X=0;V>.5?X=-1:V<-.5&&(X=1);let re=(s/o.aj+g.x)/N+X,Q=(u/o.aj+g.y)/N;re=(re-F)*x._pixelsPerMercatorPixel+F,Q=(Q-q)*x._pixelsPerMercatorPixel+q;const oe=[re*x.worldSize,Q*x.worldSize,0];o.ad(oe,oe,T),k=o.bk(k,oe,I)}return o.ad(k,k,w)}_makeGlobeTileDebugBorderBuffer(s,u,g,x,w,T){const I=new o.ba,k=new o.bb,N=new o.bl,F=(V,X,re,Q,oe)=>{const ie=(re-V)/(oe-1),ue=(Q-X)/(oe-1),pe=I.length;for(let ge=0;ge<oe;ge++){const be=V+ge*ie,Ae=X+ge*ue;I.emplaceBack(be,Ae);const Ie=this._globePoint(be,Ae,u,g,x,w,T);N.emplaceBack(Ie[0],Ie[1],Ie[2]),k.emplaceBack(pe+ge)}},q=o.aj;F(0,0,q,0,16),F(q,0,q,q,16),F(q,q,0,q,16),F(0,q,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(k),this._tileDebugBuffer=s.createVertexBuffer(I,o.bc.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(N,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,I.length,k.length)}_makeGlobeTileDebugTextBuffer(s,u,g,x,w,T){const I=o.aj/4,k=new o.ba,N=new o.a_,F=new o.bl,q=25;N.reserve(32),k.reserve(q),F.reserve(q);const V=(X,re)=>q*X+re;for(let X=0;X<q;X++){const re=X*I;for(let Q=0;Q<q;Q++){const oe=Q*I;k.emplaceBack(oe,re);const ie=this._globePoint(oe,re,u,g,x,w,T);F.emplaceBack(ie[0],ie[1],ie[2])}}for(let X=0;X<4;X++)for(let re=0;re<4;re++){const Q=V(X,re),oe=V(X,re+1),ie=V(X+1,re),ue=V(X+1,re+1);N.emplaceBack(Q,oe,ie),N.emplaceBack(ie,oe,ue)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(N),this._tileDebugTextBuffer=s.createVertexBuffer(k,o.bc.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(F,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,q,32)}destroy(s=!1){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class Fh extends Ru{constructor(s,u,g,x,w){super(s,u,g,x,w),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexturePerLayer(s,u,g){const x=g.context,w=x.gl;let T=this.texturePerLayer.get(s)||g.getTileTexture(u.width);T&&T instanceof o.T?T.update(u,{premultiply:!1}):T=new o.T(x,u,w.RGBA8,{premultiply:!1}),this.texturePerLayer.has(s)||this.texturePerLayer.set(s,T)}flushQueues(s){const u=this._workQueuePerLayer.get(s)||[],g=this._fetchQueuePerLayer.get(s)||[];for(;u.length;)u.pop()();for(;g.length;)g.pop()()}flushAllQueues(){for(const s of this._workQueuePerLayer.keys()){const u=this._workQueuePerLayer.get(s)||[];for(;u.length;)u.pop()()}for(const s of this._fetchQueuePerLayer.keys()){const u=this._fetchQueuePerLayer.get(s)||[];for(;u.length;)u.pop()()}}fetchHeader(s=16384,u){const g=this._mrt=new o.bp(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=o.br(x,(w,T,I,k)=>{if(w)u(w);else try{const N=g.getHeaderLength(T);if(N>s)return void(this.request=this.fetchHeader(N,u));g.parseHeader(T),this._isHeaderLoaded=!0;let F=0;for(const q of Object.values(g.layers))F=Math.max(F,q.dataIndex[q.dataIndex.length-1].lastByte);T.byteLength>=F&&(this.entireBuffer=T),u(null,this.entireBuffer||T,I,k)}catch(N){u(N)}}),this.request}fetchBand(s,u,g,x){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void x(new Error("Tile header is not ready"));const T=this.actor;if(!T)return void x(new Error("Can't fetch tile band without an actor"));let I;const k=(V,X)=>{if(I.complete(V,X),V)return void x(V);this.updateTextureDescriptor(s,u,g);const re=this.textureDescriptorPerLayer.get(u);x(null,re&&re.img)},N=(V,X)=>{if(V)return x(V);const re=T.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:X,task:I},k,void 0,!0),Q=this._workQueuePerLayer.get(u)||[];Q.push(()=>{re&&re.cancel(),I.cancel()}),this._workQueuePerLayer.has(u)||this._workQueuePerLayer.set(u,Q)},F=w.getLayer(s);if(!F)return void x(new Error(`Unknown sourceLayer "${s}"`));if(F.hasDataForBand(g)){this.updateTextureDescriptor(s,u,g);const V=this.textureDescriptorPerLayer.get(u);return void x(null,V?V.img:null)}const q=F.getDataRange([g]);if(I=w.createDecodingTask(q),!I||I.tasks.length)if(this.flushQueues(u),this.entireBuffer)N(null,this.entireBuffer.slice(q.firstByte,q.lastByte+1));else{const V=Object.assign({},this.requestParams,{headers:{Range:`bytes=${q.firstByte}-${q.lastByte}`}}),X=o.br(V,N),re=this._fetchQueuePerLayer.get(u)||[];re.push(()=>{X.cancel(),I.cancel()}),this._fetchQueuePerLayer.has(u)||this._fetchQueuePerLayer.set(u,re)}else x(null)}updateNeeded(s,u){return(!this.textureDescriptorPerLayer.get(s)||this.textureDescriptorPerLayer.get(s).band!==u)&&this.state!=="errored"}updateTextureDescriptor(s,u,g){if(!this._mrt)return;const x=this._mrt.getLayer(s);if(!x||!x.hasBand(g)||!x.hasDataForBand(g))return;const{bytes:w,tileSize:T,buffer:I,offset:k,scale:N}=x.getBandView(g),F=T+2*I,q=new o.r({width:F,height:F},w),V=this.texturePerLayer.get(u);V&&V instanceof o.T&&V.update(q,{premultiply:!1}),this.textureDescriptorPerLayer.set(u,{layer:s,band:g,img:q,buffer:I,offset:k,tileSize:T,format:x.pixelFormat,mix:[N,256*N,65536*N,16777216*N]})}destroy(s=!1){if(super.destroy(s),delete this._mrt,!s)for(const u of this.texturePerLayer.values())u&&u instanceof o.T&&u.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Tv{constructor(s,u){this.max=s,this.onRemove=u,this.reset()}reset(){for(const s in this.data)for(const u of this.data[s])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(s,u,g){const x=s.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const w={value:u,timeout:void 0};if(g!==void 0&&(w.timeout=setTimeout(()=>{this.remove(s,w)},g)),this.data[x].push(w),this.order.push(x),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const u=this.data[s].shift();return u.timeout&&clearTimeout(u.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),u.value}getByKey(s){const u=this.data[s];return u?u[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,u){if(!this.has(s))return this;const g=s.wrapped().key,x=u===void 0?0:this.data[g].indexOf(u),w=this.data[g][x];return this.data[g].splice(x,1),w.timeout&&clearTimeout(w.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(w.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(s){const u=[];for(const g in this.data)for(const x of this.data[g])s(x.value)||u.push(x);for(const g of u)this.remove(g.value.tileID,g)}}class Ev{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,u,g){const x=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][x]=this.stateChanges[s][x]||{},o.h(this.stateChanges[s][x],g),this.deletedStates[s]===null){this.deletedStates[s]={};for(const w in this.state[s])w!==x&&(this.deletedStates[s][w]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][x]===null){this.deletedStates[s][x]={};for(const w in this.state[s][x])g[w]||(this.deletedStates[s][x][w]=null)}else for(const w in g)this.deletedStates[s]&&this.deletedStates[s][x]&&this.deletedStates[s][x][w]===null&&delete this.deletedStates[s][x][w]}removeFeatureState(s,u,g){if(this.deletedStates[s]===null)return;const x=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},g&&u!==void 0)this.deletedStates[s][x]!==null&&(this.deletedStates[s][x]=this.deletedStates[s][x]||{},this.deletedStates[s][x][g]=null);else if(u!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][x])for(g in this.deletedStates[s][x]={},this.stateChanges[s][x])this.deletedStates[s][x][g]=null;else this.deletedStates[s][x]=null;else this.deletedStates[s]=null}getState(s,u){const g=this.state[s]||{},x=this.stateChanges[s]||{},w=this.deletedStates[s];if(w===null)return{};if(u!==void 0){const I=String(u),k=o.h({},g[I],x[I]);if(w){const N=w[u];if(N===null)return{};for(const F in N)delete k[F]}return k}const T=o.h({},g,x);if(w)for(const I in w)delete T[I];return T}initializeTileState(s,u){s.refreshFeatureState(u)}coalesceChanges(s,u){const g={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const w={};for(const T in this.stateChanges[x])this.state[x][T]||(this.state[x][T]={}),o.h(this.state[x][T],this.stateChanges[x][T]),w[T]=this.state[x][T];g[x]=w}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const w={};if(this.deletedStates[x]===null)for(const T in this.state[x])w[T]={},this.state[x][T]={};else for(const T in this.deletedStates[x]){if(this.deletedStates[x][T]===null)this.state[x][T]={};else if(this.state[x][T])for(const I of Object.keys(this.deletedStates[x][T]))delete this.state[x][T][I];w[T]=this.state[x][T]}g[x]=g[x]||{},o.h(g[x],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const x in s)s[x].refreshFeatureState(u)}}class Ps extends o.E{constructor(s,u,g){super(),this.id=s,this._onlySymbols=g,u.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new Tv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ev,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,u){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,u)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const g=this._tiles[u];g.upload(s),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Du).map(s=>s.key)}getRenderableIds(s,u){const g=[];for(const x in this._tiles)this._isIdRenderable(+x,s,u)&&g.push(this._tiles[x]);return s?g.sort((x,w)=>{const T=x.tileID,I=w.tileID,k=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),N=new o.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-I.overscaledZ||N.y-k.y||N.x-k.x}).map(x=>x.tileID.key):g.map(x=>x.tileID).sort(Du).map(x=>x.key)}hasRenderableParent(s){const u=this.findLoadedParent(s,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(s,u,g){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(u||!this._tiles[s].holdingForFade())&&(g||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,u){const g=this._tiles[s];g&&(g.state!=="loading"&&(g.state=u),this._loadTile(g,this._tileLoaded.bind(this,g,s,u)))}_tileLoaded(s,u,g,x){if(x)if(s.state="errored",x.status!==404)this._source.fire(new o.z(x,{tile:s}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=o.q.now(),g==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(u,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const u=this.getRenderableIds();for(let x=0;x<u.length;x++){const w=u[x];if(s.neighboringTiles&&s.neighboringTiles[w]){const T=this.getTileByID(w);g(s,T),g(T,s)}}function g(x,w){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let T=w.tileID.canonical.x-x.tileID.canonical.x;const I=w.tileID.canonical.y-x.tileID.canonical.y,k=Math.pow(2,x.tileID.canonical.z),N=w.tileID.key;T===0&&I===0||Math.abs(I)>1||(Math.abs(T)>1&&(Math.abs(T+k)===1?T+=k:Math.abs(T-k)===1&&(T-=k)),w.dem&&x.dem&&(x.dem.backfillBorder(w.dem,T,I),x.neighboringTiles&&x.neighboringTiles[N]&&(x.neighboringTiles[N].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,u,g,x){for(const w in this._tiles){let T=this._tiles[w];if(x[w]||!T.hasData()||T.tileID.overscaledZ<=u||T.tileID.overscaledZ>g)continue;let I=T.tileID;for(;T&&T.tileID.overscaledZ>u+1;){const N=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[N.key],T&&T.hasData()&&(I=N)}let k=I;for(;k.overscaledZ>u;)if(k=k.scaledTo(k.overscaledZ-1),s[k.key]){x[I.key]=I;break}}}findLoadedParent(s,u){if(s.key in this._loadedParentTiles){const g=this._loadedParentTiles[s.key];return g&&g.tileID.overscaledZ>=u?g:null}for(let g=s.overscaledZ-1;g>=u;g--){const x=s.scaledTo(g),w=this._getLoadedTile(x);if(w)return w}}_getLoadedTile(s){const u=this._tiles[s.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,u){u=u||this._source.tileSize;const g=Math.ceil(s.width/u)+1,x=Math.ceil(s.height/u)+1,w=Math.floor(g*x*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(I)}handleWrapJump(s){const u=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,u){const g={};for(const x in this._tiles){const w=this._tiles[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+u),g[w.tileID.key]=w}this._tiles=g;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(s,u,g,x,w){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(s,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let I,k=this._source.maxzoom;const N=this.map&&this.map.painter?this.map.painter._terrain:null;if(N&&N.sourceCache===this&&N.attenuationRange()){const V=N.attenuationRange()[0],X=Math.floor(V)-Math.log2(N.getDemUpscale());k>X&&(k=X)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new o.aM(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y));else if(this.tileCoverLift!==0){const V=s.clone();V.tileCoverLift=this.tileCoverLift,I=V.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&s.projection.name==="globe"&&(I.push(new o.aM(1,0,1,0,0)),I.push(new o.aM(1,0,1,1,0)),I.push(new o.aM(1,0,1,0,1)),I.push(new o.aM(1,0,1,1,1)))}else if(I=s.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const V=this._source.hasTile.bind(this._source);I=I.filter(X=>V(X))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Nf(this._source.type)){const V=s.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),X=Math.min(V,this._source.maxzoom);if(T){const re=s.extendTileCover(I,X);for(const Q of re)I.push(Q)}else if(w){const re=s.extendTileCoverToNearPlane(I,this.transform.getFrustum(X),X);for(const Q of re)I.push(Q)}else if(this.castsShadows&&x){const re=s.extendTileCover(I,X,x);for(const Q of re)this._shadowCasterTiles[Q.key]=!0,I.push(Q)}}const F=this._updateRetainedTiles(I);if(Nf(this._source.type)&&I.length!==0){const V={},X={},re=Object.keys(F);for(const oe of re){const ie=F[oe],ue=this._tiles[oe];if(!ue||ue.fadeEndTime&&ue.fadeEndTime<=o.q.now())continue;const pe=this.findLoadedParent(ie,Math.max(ie.overscaledZ-Ps.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),V[pe.tileID.key]=pe.tileID),X[oe]=ie}const Q=I[I.length-1].overscaledZ;for(const oe in this._tiles){const ie=this._tiles[oe];if(F[oe]||!ie.hasData())continue;let ue=ie.tileID;for(;ue.overscaledZ>Q;){ue=ue.scaledTo(ue.overscaledZ-1);const pe=this._tiles[ue.key];if(pe&&pe.hasData()&&X[ue.key]){F[oe]=ie.tileID;break}}}for(const oe in V)F[oe]||(this._coveredTiles[oe]=!0,F[oe]=V[oe])}for(const V in F)this._tiles[V].clearFadeHold();const q=o.bs(this._tiles,F);for(const V of q){const X=this._tiles[V];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(+V)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const u={};if(s.length===0)return u;const g={},x=s.reduce((N,F)=>Math.min(N,F.overscaledZ),1/0),w=s[0].overscaledZ,T=Math.max(w-Ps.maxOverzooming,this._source.minzoom),I=Math.max(w+Ps.maxUnderzooming,this._source.minzoom),k={};for(const N of s){const F=this._addTile(N);u[N.key]=N,F.hasData()||x<this._source.maxzoom&&(k[N.key]=N)}this._retainLoadedChildren(k,x,I,u);for(const N of s){let F=this._tiles[N.key];if(F.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const V=N.children(this._source.maxzoom)[0],X=this.getTile(V);if(X&&X.hasData()){u[V.key]=V;continue}}else{const V=N.children(this._source.maxzoom);if(u[V[0].key]&&u[V[1].key]&&u[V[2].key]&&u[V[3].key])continue}let q=F.wasRequested();for(let V=N.overscaledZ-1;V>=T;--V){const X=N.scaledTo(V);if(g[X.key]||(g[X.key]=!0,F=this.getTile(X),!F&&q&&(F=this._addTile(X)),F&&(u[X.key]=X,q=F.wasRequested(),F.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const u=[];let g,x=this._tiles[s].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){g=this._loadedParentTiles[x.key];break}u.push(x.key);const w=x.scaledTo(x.overscaledZ-1);if(g=this._getLoadedTile(w),g)break;x=w}for(const w of u)this._loadedParentTiles[w]=g}}_addTile(s){let u=this._tiles[s.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),u;u=this._cache.getAndRemove(s),u&&(this._setTileReloadTimer(s.key,u),u.tileID=s,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,u)));const g=!!u;if(!g){const x=this.map?this.map.painter:null,w=this._source.tileSize*s.overscaleFactor();u=this._source.type==="raster-array"?new Fh(s,w,this.transform.tileZoom,x,this._isRaster):new Ru(s,w,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(u,this._tileLoaded.bind(this,u,s.key,u.state))}return u.uses++,this._tiles[s.key]=u,g||this._source.fire(new o.A("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(s,u){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const g=u.getExpiryTimeout();g&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},g))}_removeTile(s){const u=this._tiles[s];u&&(u.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,u,g){const x=[],w=this.transform;if(!w)return x;const T=w.projection.name==="globe",I=o.aD(w.center.lng);for(const k in this._tiles){const N=this._tiles[k];if(g&&N.clearQueryDebugViz(),N.holdingForFade())continue;let F;if(T){const q=N.tileID.canonical;if(q.z===0){const V=[Math.abs(o.ay(I,...Bh(q,-1))-I),Math.abs(o.ay(I,...Bh(q,1))-I)];F=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(o.ay(I,...Bh(q,-1))-I),Math.abs(o.ay(I,...Bh(q,0))-I),Math.abs(o.ay(I,...Bh(q,1))-I)];F=[V.indexOf(Math.min(...V))-1]}}else F=[0];for(const q of F){const V=s.containsTile(N,w,u,q);V&&x.push(V)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,u){const g=this.getRenderableIds(s,u).map(w=>this._tiles[w].tileID),x=this.transform.projection.name==="globe";for(const w of g)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=x?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return g}sortCoordinatesByDistance(s){const u=s.slice(),g=this.transform._camera.position,x=this.transform._camera.forward(),w={};for(const T of u){const I=1/(1<<T.canonical.z);w[T.key]=((T.canonical.x+.5)*I+T.wrap-g[0])*x[0]+((T.canonical.y+.5)*I-g[1])*x[1]-g[2]*x[2]}return u.sort((T,I)=>w[T.key]-w[I.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(Nf(this._source.type))for(const s in this._tiles){const u=this._tiles[s];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(s,u,g){this._state.updateState(s=s||"_geojsonTileLayer",u,g)}removeFeatureState(s,u,g){this._state.removeFeatureState(s=s||"_geojsonTileLayer",u,g)}getFeatureState(s,u){return this._state.getState(s=s||"_geojsonTileLayer",u)}setDependencies(s,u,g){const x=this._tiles[s];x&&x.setDependencies(u,g)}reloadTilesForDependencies(s,u){for(const g in this._tiles)this._tiles[g].hasDependency(s,u)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(s,u))}_preloadTiles(s,u){if(!this._sourceLoaded){const k=()=>{this._sourceLoaded&&(this._source.off("data",k),this._preloadTiles(s,u))};return void this._source.on("data",k)}const g=new Map,x=Array.isArray(s)?s:[s],w=this.map.painter.terrain,T=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const k of x){const N=k.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of N)g.set(F.key,F);this.usedForTerrain&&k.updateElevation(!1)}const I=Array.from(g.values());o.bt(I,(k,N)=>{const F=new Ru(k,this._source.tileSize*k.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,q=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),N(q,F)})},u)}}function Du(m,s){const u=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||g-u||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function Nf(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function Bh(m,s){const u=1<<m.z;return[m.x/u+s,(m.x+1)/u+s]}Ps.maxOverzooming=10,Ps.maxUnderzooming=3;class c1{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,u=!1;for(const g in this.style._mergedLayers){const x=this.style._mergedLayers[g];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:s,visibilityChanged:u});else if(x.type==="model"){const w=this.style.getLayerSource(x);w&&w.type==="batched-model"&&this.layers.push({layer:x,visible:s,visibilityChanged:u})}}}onNewFrame(s){this.layersGotHidden=!1;for(const u of this.layers){const g=u.layer;let x=!1;g.type==="fill-extrusion"?x=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="building"?x=!g.isHidden(s)&&g.paint.get("building-opacity")>0:g.type==="model"&&(x=!g.isHidden(s)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&u.visible,u.visible=x}}updateZOffset(s,u){this.currentBuildingBuckets=[];for(const x of this.layers){const w=x.layer,T=this.style.getLayerSourceCache(w);let I=1;w.type==="fill-extrusion"?I=x.visible?w.paint.get("fill-extrusion-vertical-scale"):0:w.type==="building"&&(I=x.visible?w.paint.get("building-vertical-scale"):0);let k=T?T.getTile(u):null;if(!k&&T)for(const N in T._tiles){const F=T._tiles[N];if(u.canonical.isChildOf(F.tileID.canonical)){k=F;break}}this.currentBuildingBuckets.push({bucket:k?k.getBucket(w):null,tileID:k?k.tileID:u,verticalScale:I})}s.hasAnyZOffset=!1;let g=!1;for(let x=0;x<s.symbolInstances.length;x++){const w=s.symbolInstances.get(x),T=w.zOffset,I=this._getHeightAtTileOffset(u,w.tileAnchorX,w.tileAnchorY);w.zOffset=I!==Number.NEGATIVE_INFINITY?I:T,g||T===w.zOffset||(g=!0),s.hasAnyZOffset||w.zOffset===0||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,u,g,x){let w=u,T=g;if(s.canonical.z!==x.canonical.z){const I=x.canonical,k=1/(1<<s.canonical.z-I.z);w=(u+s.canonical.x*o.aj)*k-I.x*o.aj|0,T=(g+s.canonical.y*o.aj)*k-I.y*o.aj|0}return{tileX:w,tileY:T}}_getHeightAtTileOffset(s,u,g){let x,w;for(let T=0;T<this.layers.length;++T){const I=this.layers[T].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:k,tileID:N,verticalScale:F}=this.currentBuildingBuckets[T];if(!k)continue;const{tileX:q,tileY:V}=this._mapCoordToOverlappingTile(s,u,g,N),X=k.getHeightAtTileCoord(q,V);X&&X.height!==void 0&&(X.hidden?x=X.height:w=Math.max(X.height*F,w||0))}if(w!==void 0)return w;for(let T=0;T<this.layers.length;++T){const I=this.layers[T];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:k,tileID:N}=this.currentBuildingBuckets[T];if(!k)continue;const{tileX:F,tileY:q}=this._mapCoordToOverlappingTile(s,u,g,N),V=k.getHeightAtTileCoord(F,q);if(V&&!V.hidden)return V.height===void 0&&x!==void 0?Math.min(V.maxHeight,x)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function u1(m,s){const u={};for(const g in m)g!=="ref"&&(u[g]=m[g]);return o.bu.forEach(g=>{g in s&&(u[g]=s[g])}),u}function zf(m){m=m.slice();const s=Object.create(null);for(let u=0;u<m.length;u++)s[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=u1(m[u],s[m[u].ref]));return m}const nn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Vm(m,s,u){u.push({command:nn.addSource,args:[m,s[m]]})}function $h(m,s,u){s.push({command:nn.removeSource,args:[m]}),u[m]=!0}function Ff(m,s,u,g){$h(m,u,g),Vm(m,s,u)}function dC(m,s,u){let g;for(g in m[u])if(m[u].hasOwnProperty(g)&&g!=="data"&&!o.bv(m[u][g],s[u][g]))return!1;for(g in s[u])if(s[u].hasOwnProperty(g)&&g!=="data"&&!o.bv(m[u][g],s[u][g]))return!1;return!0}function Bf(m,s,u,g,x,w){let T;for(T in s=s||{},m=m||{})m.hasOwnProperty(T)&&(o.bv(m[T],s[T])||u.push({command:w,args:[g,T,s[T],x]}));for(T in s)s.hasOwnProperty(T)&&!m.hasOwnProperty(T)&&(o.bv(m[T],s[T])||u.push({command:w,args:[g,T,s[T],x]}))}function Lu(m){return m.id}function Lc(m,s){return m[s.id]=s,m}function $f(m,s,u){const g=s.createTileMatrix(m,m.worldSize,u.toUnwrapped());return o.az(new Float32Array(16),m.projMatrix,g)}function h1(m,s,u){if(s.projection.name===u.projection.name)return m.projMatrix;const g=u.clone();return g.setProjection(s.projection),$f(g,s.getProjection(),m)}function Um(m,s,u){return s.name===u.projection.name?m.projMatrix:$f(u,s,m)}class d1{constructor(s,u){this.reset(s,u)}reset(s,u){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=o.ay(s,0,1);let u=1,g=this._distances[u];const x=s*this.paddedLength+this.padding;for(;g<x&&u<this._distances.length;)g=this._distances[++u];const w=u-1,T=this._distances[w],I=g-T,k=I>0?(x-T)/I:0;return this.points[w].mult(1-k).add(this.points[u].mult(k))}}class Vh{constructor(s,u,g){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(u/g);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,u,g,x,w){this._forEachCell(u,g,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(s,u,g,x){this._forEachCell(u-x,g-x,u+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(g),this.circles.push(x)}_insertBoxCell(s,u,g,x,w,T){this.boxCells[w].push(T)}_insertCircleCell(s,u,g,x,w,T){this.circleCells[w].push(T)}_query(s,u,g,x,w,T){if(g<0||s>this.width||x<0||u>this.height)return!w&&[];const I=[];if(s<=0&&u<=0&&this.width<=g&&this.height<=x){if(w)return!0;for(let k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const N=this.circles[3*k],F=this.circles[3*k+1],q=this.circles[3*k+2];I.push({key:this.circleKeys[k],x1:N-q,y1:F-q,x2:N+q,y2:F+q})}return T?I.filter(T):I}return this._forEachCell(s,u,g,x,this._queryCell,I,{hitTest:w,seenUids:{box:{},circle:{}}},T),w?I.length>0:I}_queryCircle(s,u,g,x,w){const T=s-g,I=s+g,k=u-g,N=u+g;if(I<0||T>this.width||N<0||k>this.height)return!x&&[];const F=[];return this._forEachCell(T,k,I,N,this._queryCellCircle,F,{hitTest:x,circle:{x:s,y:u,radius:g},seenUids:{box:{},circle:{}}},w),x?F.length>0:F}query(s,u,g,x,w){return this._query(s,u,g,x,!1,w)}hitTest(s,u,g,x,w){return this._query(s,u,g,x,!0,w)}hitTestCircle(s,u,g,x){return this._queryCircle(s,u,g,!0,x)}_queryCell(s,u,g,x,w,T,I,k){const N=I.seenUids,F=this.boxCells[w];if(F!==null){const V=this.bboxes;for(const X of F)if(!N.box[X]){N.box[X]=!0;const re=4*X;if(s<=V[re+2]&&u<=V[re+3]&&g>=V[re+0]&&x>=V[re+1]&&(!k||k(this.boxKeys[X]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[X],x1:V[re],y1:V[re+1],x2:V[re+2],y2:V[re+3]})}}}const q=this.circleCells[w];if(q!==null){const V=this.circles;for(const X of q)if(!N.circle[X]){N.circle[X]=!0;const re=3*X;if(this._circleAndRectCollide(V[re],V[re+1],V[re+2],s,u,g,x)&&(!k||k(this.circleKeys[X]))){if(I.hitTest)return T.push(!0),!0;{const Q=V[re],oe=V[re+1],ie=V[re+2];T.push({key:this.circleKeys[X],x1:Q-ie,y1:oe-ie,x2:Q+ie,y2:oe+ie})}}}}}_queryCellCircle(s,u,g,x,w,T,I,k){const N=I.circle,F=I.seenUids,q=this.boxCells[w];if(q!==null){const X=this.bboxes;for(const re of q)if(!F.box[re]){F.box[re]=!0;const Q=4*re;if(this._circleAndRectCollide(N.x,N.y,N.radius,X[Q+0],X[Q+1],X[Q+2],X[Q+3])&&(!k||k(this.boxKeys[re])))return T.push(!0),!0}}const V=this.circleCells[w];if(V!==null){const X=this.circles;for(const re of V)if(!F.circle[re]){F.circle[re]=!0;const Q=3*re;if(this._circlesCollide(X[Q],X[Q+1],X[Q+2],N.x,N.y,N.radius)&&(!k||k(this.circleKeys[re])))return T.push(!0),!0}}}_forEachCell(s,u,g,x,w,T,I,k){const N=this._convertToXCellCoord(s),F=this._convertToYCellCoord(u),q=this._convertToXCellCoord(g),V=this._convertToYCellCoord(x);for(let X=N;X<=q;X++)for(let re=F;re<=V;re++)if(w.call(this,s,u,g,x,this.xCellCount*re+X,T,I,k))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,u,g,x,w,T){const I=x-s,k=w-u,N=g+T;return N*N>I*I+k*k}_circleAndRectCollide(s,u,g,x,w,T,I){const k=(T-x)/2,N=Math.abs(s-(x+k));if(N>k+g)return!1;const F=(I-w)/2,q=Math.abs(u-(w+F));if(q>F+g)return!1;if(N<=k||q<=F)return!0;const V=N-k,X=q-F;return V*V+X*X<=g*g}}const ju={unknown:0,flipRequired:1,flipNotRequired:2},f1=Math.tan(85*Math.PI/180);function Vf(m,s,u,g,x,w,T){const I=o.bz();if(u)if(w.name==="globe"){const k=o.bA(x,s);o.az(I,I,k)}else{const k=o.bB([],T);I[0]=k[0],I[1]=k[1],I[4]=k[2],I[5]=k[3],g||o.by(I,I,x.angle)}else o.az(I,x.labelPlaneMatrix,m);return I}function Uh(m,s,u,g,x,w,T){const I=Vf(m,s,u,g,x,w,T);return w.name==="globe"&&u||(I[2]=I[6]=I[10]=I[14]=0),I}function Xl(m,s,u,g,x,w,T){if(u){if(w.name==="globe"){const I=Vf(m,s,u,g,x,w,T);return o.bi(I,I),o.az(I,m,I),I}{const I=o.bw(m),k=o.bx([]);return k[0]=T[0],k[1]=T[1],k[4]=T[2],k[5]=T[3],o.az(I,I,k),g||o.by(I,I,-x.angle),I}}return x.glCoordMatrix}function ea(m,s,u,g){const x=[m,s,u,1];u?o.aA(x,x,g):p1(x,x,g);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function Av(m,s){return Math.min(.5+m/s*.5,1.5)}function Pv(m,s){const u=m[0]/m[3],g=m[1]/m[3];return u>=-s[0]&&u<=s[0]&&g>=-s[1]&&g<=s[1]}function Nu(m,s,u,g,x,w,T,I,k,N){const F=u.transform,q=g?m.textSizeData:m.iconSizeData,V=o.bH(q,u.transform.zoom),X=F.projection.name==="globe",re=[256/u.width*2+1,256/u.height*2+1],Q=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Q.clear();let oe=null;X&&(oe=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const ie=m.lineVertexArray,ue=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,pe=u.transform.width/u.transform.height;let ge,be=!1;for(let Ae=0;Ae<ue.length;Ae++){const Ie=ue.get(Ae),{numGlyphs:we,writingMode:Se}=Ie;if(Se!==o.bI.vertical||be||ge===o.bI.horizontal||(be=!0),ge=Se,(Ie.hidden||Se===o.bI.vertical)&&!be){Gh(we,Q);continue}be=!1;const Te=new o.P(Ie.tileAnchorX,Ie.tileAnchorY);let{x:We,y:je,z:ht}=F.projection.projectTilePoint(Te.x,Te.y,N.canonical);if(k){const[Jt,or,$t]=k(Te);We+=Jt,je+=or,ht+=$t}const tt=[We,je,ht,1];if(o.aA(tt,tt,s),!Pv(tt,re)){Gh(we,Q);continue}const ft=tt[3],Pt=Av(u.transform.getCameraToCenterDistance(F.projection),ft),qe=o.bJ(q,V,Ie),De=T?qe/Pt:qe*Pt,st=ea(We,je,ht,x);if(st[3]<=0){Gh(we,Q);continue}let Xe={};const yt=o.al(m.layers[0].layout.get("text-max-angle")),vt=Math.cos(yt),bt=T?null:k,Dt=Gm(Ie,De,!1,I,s,x,w,m.glyphOffsetArray,ie,Q,oe,st,Te,Xe,pe,bt,F.projection,N,T,vt);be=Dt.useVertical,bt&&Dt.needsFlipping&&(Xe={}),(Dt.notEnoughRoom||be||Dt.needsFlipping&&Gm(Ie,De,!0,I,s,x,w,m.glyphOffsetArray,ie,Q,oe,st,Te,Xe,pe,bt,F.projection,N,T,vt).notEnoughRoom)&&Gh(we,Q)}g?(m.text.dynamicLayoutVertexBuffer.updateData(Q),oe&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(oe)):(m.icon.dynamicLayoutVertexBuffer.updateData(Q),oe&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(oe))}function zs(m,s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe){const{lineStartIndex:ie,glyphStartIndex:ue,segment:pe}=I,ge=ue+I.numGlyphs,be=ie+I.lineLength,Ae=s.getoffsetX(ue),Ie=s.getoffsetX(ge-1),we=Uf(m*Ae,u,g,x,w,T,pe,ie,be,k,N,F,q,V,!0,X,re,Q,oe);if(!we)return null;const Se=Uf(m*Ie,u,g,x,w,T,pe,ie,be,k,N,F,q,V,!0,X,re,Q,oe);return Se?{first:we,last:Se}:null}function Cv(m,s,u,g){return m===o.bI.horizontal&&Math.abs(g)>Math.abs(u)?{useVertical:!0}:m===o.bI.vertical?g>0?{needsFlipping:!0}:null:s!==ju.unknown&&function(x,w){return x===0||Math.abs(w/x)>f1}(u,g)?s===ju.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function Gm(m,s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe,ie,ue,pe){const ge=s/24,be=m.lineOffsetX*ge,Ae=m.lineOffsetY*ge,{lineStartIndex:Ie,glyphStartIndex:we,numGlyphs:Se,segment:Te,writingMode:We,flipState:je}=m,ht=Ie+m.lineLength,tt=ft=>{if(F){const[st,Xe,yt]=ft.up,vt=N.length;o.bK(F,vt+0,st,Xe,yt),o.bK(F,vt+1,st,Xe,yt),o.bK(F,vt+2,st,Xe,yt),o.bK(F,vt+3,st,Xe,yt)}const[Pt,qe,De]=ft.point;o.bL(N,Pt,qe,De,ft.angle)};if(Se>1){const ft=zs(ge,I,be,Ae,u,q,V,m,k,w,X,Q,!1,oe,ie,ue,pe);if(!ft)return{notEnoughRoom:!0};if(g&&!u){let[Pt,qe,De]=ft.first.point,[st,Xe,yt]=ft.last.point;[Pt,qe]=ea(Pt,qe,De,T),[st,Xe]=ea(st,Xe,yt,T);const vt=Cv(We,je,(st-Pt)*re,Xe-qe);if(m.flipState=vt&&vt.needsFlipping?ju.flipRequired:ju.flipNotRequired,vt)return vt}tt(ft.first);for(let Pt=we+1;Pt<we+Se-1;Pt++){const qe=Uf(ge*I.getoffsetX(Pt),be,Ae,u,q,V,Te,Ie,ht,k,w,X,Q,!1,!1,oe,ie,ue,pe);if(!qe)return N.length-=4*(Pt-we),{notEnoughRoom:!0};tt(qe)}tt(ft.last)}else{if(g&&!u){const Pt=ea(V.x,V.y,0,x),qe=Ie+Te+1,De=new o.P(k.getx(qe),k.gety(qe)),st=ea(De.x,De.y,0,x),Xe=st[3]>0?st:Sn(V,De,Pt,1,x,void 0,oe,ie.canonical),yt=Cv(We,je,(Xe[0]-Pt[0])*re,Xe[1]-Pt[1]);if(m.flipState=yt&&yt.needsFlipping?ju.flipRequired:ju.flipNotRequired,yt)return yt}const ft=Uf(ge*I.getoffsetX(we),be,Ae,u,q,V,Te,Ie,ht,k,w,X,Q,!1,!1,oe,ie,ue,pe);if(!ft)return{notEnoughRoom:!0};tt(ft)}return{}}function Iv(m,s,u,g,x){const{x:w,y:T,z:I}=g.projectTilePoint(m.x,m.y,s);if(!x)return ea(w,T,I,u);const[k,N,F]=x(m);return ea(w+k,T+N,I+F,u)}function Sn(m,s,u,g,x,w,T,I){const k=Iv(m.sub(s)._unit()._add(m),I,x,T,w);return o.at(k,u,k),o.au(k,k),o.bE(k,u,k,g)}function Uf(m,s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe,ie,ue){const pe=g?m-s:m+s;let ge=pe>0?1:-1,be=0;g&&(ge*=-1,be=Math.PI),ge<0&&(be+=Math.PI);let Ae=I+T+(ge>0?0:1)|0,Ie=x,we=x,Se=0,Te=0;const We=Math.abs(pe),je=[],ht=[];let tt=w,ft=tt,Pt=o.bC([]);const qe=()=>Sn(ft,tt,we,We-Se+1,F,V,Q,oe.canonical);for(;Se+Te<=We;){if(Ae+=ge,Ae<I||Ae>=k)return null;if(we=Ie,ft=tt,je.push(we),X&&ht.push(ft),tt=new o.P(N.getx(Ae),N.gety(Ae)),Ie=q[Ae],!Ie){const $t=Iv(tt,oe.canonical,F,Q,V);Ie=$t[3]>0?q[Ae]=$t:qe()}Se+=Te;const Jt=o.at([],Ie,we),or=o.bD(we,Ie);if(u&&or>0&&Te>0&&o.bG(Pt,Jt)/(Te*or)<ue)return null;Te=or,Pt=Jt}re&&V&&(q[Ae]&&(Ie=qe(),Te=o.bD(we,Ie),Pt=o.at([],Ie,we)),q[Ae]=Ie);const De=(We-Se)/Te,st=tt.sub(ft)._mult(De)._add(ft),Xe=o.bE([],we,Pt,De);let yt=[0,0,1],vt=Pt[0],bt=Pt[1];if(ie&&(yt=Q.upVector(oe.canonical,st.x,st.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const Jt=[yt[2],0,-yt[0]],or=o.bF([],yt,Jt);o.au(Jt,Jt),o.au(or,or),vt=o.bG(Pt,Jt),bt=o.bG(Pt,or)}if(u){const Jt=o.bF([],yt,Pt);o.au(Jt,Jt),o.bE(Xe,Xe,Jt,u*ge)}const Dt=be+Math.atan2(bt,vt);return je.push(Xe),X&&ht.push(st),{point:Xe,angle:Dt,path:je,tilePath:ht,up:yt}}function Gh(m,s){const u=s.length,g=u+4*m;s.resize(g),s.float32.fill(-1/0,4*u,4*g)}function p1(m,s,u){const g=s[0],x=s[1];return m[0]=u[0]*g+u[4]*x+u[12],m[1]=u[1]*g+u[5]*x+u[13],m[3]=u[3]*g+u[7]*x+u[15],m}const lr=100;class m1{constructor(s,u,g=new Vh(s.width+200,s.height+200,25),x=new Vh(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+lr,this.screenBottomBoundary=s.height+lr,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=u}placeCollisionBox(s,u,g,x,w,T,I,k,N,F,q){let V=g.projectedAnchorX,X=g.projectedAnchorY,re=g.projectedAnchorZ;const Q=g.tileAnchorX,oe=g.tileAnchorY,ie=g.elevation,ue=g.tileID,pe=s.getProjection();if(ie&&ue){const[ht,tt,ft]=pe.upVector(ue.canonical,g.tileAnchorX,g.tileAnchorY),Pt=pe.upVectorScale(ue.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=ht*ie*Pt,X+=tt*ie*Pt,re+=ft*ie*Pt}const ge=s.projection.name==="globe",be=s.projection.name==="globe"?o.ah(this.transform.zoom):0;if(ue&&ge&&be<1&&!T){const ht=1<<ue.canonical.z,tt=o.bM(Q,oe);o.bN(tt,tt,1/o.aj),o.bO(tt,tt,o.bM(ue.canonical.x,ue.canonical.y)),o.bN(tt,tt,1/ht),o.bP(tt,tt,o.bM(x[0],x[1])),tt[0]=o.bQ(tt[0],-.5,.5),o.bN(tt,tt,o.aj);const ft=o.bR(tt[0],tt[1],o.aj/(2*Math.PI),1);o.aA(ft,ft,w),V=o.ai(V,ft[0],be),X=o.ai(X,ft[1],be),re=o.ai(re,ft[2],be)}const Ae=this.projectAndGetPerspectiveRatio(F,V,X,re,g.tileID,pe.name==="globe"||!!ie||this.transform.pitch>0,pe),Ie=N*Ae.perspectiveRatio,we=(g.x1*u+I.x-g.padding)*Ie+Ae.point.x,Se=(g.y1*u+I.y-g.padding)*Ie+Ae.point.y,Te=(g.x2*u+I.x+g.padding)*Ie+Ae.point.x,We=(g.y2*u+I.y+g.padding)*Ie+Ae.point.y,je=Ae.perspectiveRatio<=.55||Ae.occluded;return!this.isInsideGrid(we,Se,Te,We)||!k&&this.grid.hitTest(we,Se,Te,We,q)||je?{box:[],offscreen:!1,occluded:Ae.occluded}:{box:[we,Se,Te,We],offscreen:this.isOffscreen(we,Se,Te,We),occluded:!1}}placeCollisionCircles(s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q){const oe=[],ie=this.transform.elevation,ue=s.getProjection(),pe=ie?ie.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,ue):null,ge=new o.P(g.tileAnchorX,g.tileAnchorY);let{x:be,y:Ae,z:Ie}=ue.projectTilePoint(ge.x,ge.y,Q.canonical);if(pe){const[yt,vt,bt]=pe(ge);be+=yt,Ae+=vt,Ie+=bt}const we=ue.name==="globe",Se=this.projectAndGetPerspectiveRatio(I,be,Ae,Ie,Q,we||!!ie||this.transform.pitch>0,ue),{perspectiveRatio:Te}=Se,We=(q?T/Te:T*Te)/o.bU,je=ea(be,Ae,Ie,k),ht=g.lineOffsetX*We,tt=g.lineOffsetY*We,ft=o.al(s.layers[0].layout.get("text-max-angle")),Pt=Math.cos(ft),qe=Se.signedDistanceFromCamera>0?zs(We,w,ht,tt,!1,je,ge,g,x,k,{},ie&&!q?pe:null,q&&!!ie,ue,Q,q,Pt):null;let De=!1,st=!1,Xe=!0;if(qe&&!Se.occluded){const yt=.5*X*Te+re,vt=new o.P(-100,-100),bt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Dt=new d1,{first:Jt,last:or}=qe,$t=Jt.path.length;let rr=[];for(let Ar=$t-1;Ar>=1;Ar--)rr.push(Jt.path[Ar]);for(let Ar=1;Ar<or.path.length;Ar++)rr.push(or.path[Ar]);const er=2.5*yt;N&&(rr=rr.map(([Ar,zr,on],wr)=>(pe&&!we&&(on=pe(wr<$t-1?Jt.tilePath[$t-1-wr]:or.tilePath[wr-$t+2])[2]),ea(Ar,zr,on,N))),rr.some(Ar=>Ar[3]<=0)&&(rr=[]));let _r=[];if(rr.length>0){let Ar=1/0,zr=-1/0,on=1/0,wr=-1/0;for(const sn of rr)Ar=Math.min(Ar,sn[0]),on=Math.min(on,sn[1]),zr=Math.max(zr,sn[0]),wr=Math.max(wr,sn[1]);zr>=vt.x&&Ar<=bt.x&&wr>=vt.y&&on<=bt.y&&(_r=[rr.map(sn=>new o.P(sn[0],sn[1]))],(Ar<vt.x||zr>bt.x||on<vt.y||wr>bt.y)&&(_r=o.bS(_r,vt.x,vt.y,bt.x,bt.y)))}for(const Ar of _r){Dt.reset(Ar,.25*yt);let zr=0;zr=Dt.length<=.5*yt?1:Math.ceil(Dt.paddedLength/er)+1;for(let on=0;on<zr;on++){const wr=on/Math.max(zr-1,1),sn=Dt.lerp(wr),un=sn.x+lr,Bn=sn.y+lr;oe.push(un,Bn,yt,0);const Lr=un-yt,an=Bn-yt,cn=un+yt,gn=Bn+yt;if(Xe=Xe&&this.isOffscreen(Lr,an,cn,gn),st=st||this.isInsideGrid(Lr,an,cn,gn),!u&&this.grid.hitTestCircle(un,Bn,yt,V)&&(De=!0,!F))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!F&&De||!st?[]:oe,offscreen:Xe,collisionDetected:De,occluded:Se.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let g=1/0,x=1/0,w=-1/0,T=-1/0;for(const F of s){const q=new o.P(F.x+lr,F.y+lr);g=Math.min(g,q.x),x=Math.min(x,q.y),w=Math.max(w,q.x),T=Math.max(T,q.y),u.push(q)}const I=this.grid.query(g,x,w,T).concat(this.ignoredGrid.query(g,x,w,T)),k={},N={};for(const F of I){const q=F.key;if(k[q.bucketInstanceId]===void 0&&(k[q.bucketInstanceId]={}),k[q.bucketInstanceId][q.featureIndex])continue;const V=[new o.P(F.x1,F.y1),new o.P(F.x2,F.y1),new o.P(F.x2,F.y2),new o.P(F.x1,F.y2)];o.bT(u,V)&&(k[q.bucketInstanceId][q.featureIndex]=!0,N[q.bucketInstanceId]===void 0&&(N[q.bucketInstanceId]=[]),N[q.bucketInstanceId].push(q.featureIndex))}return N}insertCollisionBox(s,u,g,x,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:w},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,u,g,x,w){const T=u?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:x,collisionGroupID:w};for(let k=0;k<s.length;k+=4)T.insertCircle(I,s[k],s[k+1],s[k+2])}projectAndGetPerspectiveRatio(s,u,g,x,w,T,I){const k=[u,g,x,1];let N=!1;x||this.transform.pitch>0?(o.aA(k,k,s),this.fogState&&w&&I.name!=="globe"&&(N=function(V,X,re,Q,oe,ie){const ue=ie.calculateFogTileMatrix(oe),pe=[X,re,Q];return o.ad(pe,pe,ue),ar(V,o.ae(pe),ie.pitch,ie._fov)}(this.fogState,u,g,x,w.toUnwrapped(),this.transform)>.9)):p1(k,k,s);const F=k[3];return{point:new o.P((k[0]/F+1)/2*this.transform.width+lr,(-k[1]/F+1)/2*this.transform.height+lr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/F*.5,1.5),signedDistanceFromCamera:F,occluded:T&&k[2]>F||N}}isOffscreen(s,u,g,x){return g<lr||s>=this.screenRightBoundary||x<lr||u>this.screenBottomBoundary}isInsideGrid(s,u,g,x){return g>=0&&s<this.gridRightBoundary&&x>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const s=o.bx([]);return o.bo(s,s,[-100,-100,0]),s}}class Gf{constructor(s,u,g,x){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):x&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class zu{constructor(s,u,g,x,w,T=!1){this.text=new Gf(s?s.text:null,u,g,w),this.icon=new Gf(s?s.icon:null,u,x,w),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ta{constructor(s,u,g,x=!1){this.text=s,this.icon=u,this.skipFade=g,this.clipped=x}}class Mv{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class Hh{constructor(s,u,g,x,w){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=w}}class ir{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[s]}}function vn(m,s,u,g,x){const{horizontalAlign:w,verticalAlign:T}=o.bZ(m),I=-(w-.5)*s,k=-(T-.5)*u,N=o.b_(m,g);return new o.P(I+N[0]*x,k+N[1]*x)}function xn(m,s,u,g,x){const w=new o.P(m,s);return u&&w._rotate(g?x:-x),w}class Fs{constructor(s,u,g,x,w,T){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new m1(this.transform,w),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ir(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,u,g,x,w=1){const T=g.getBucket(u),I=g.latestFeatureIndex;if(!T||!I||u.fqid!==T.layerIds[0])return;const k=T.layers[0].layout,N=T.layers[0].paint,F=g.collisionBoxArray,q=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),V=g.tileSize/o.aj,X=g.tileID.toUnwrapped();this.transform.setProjection(T.projection);const re=(Q=g.tileID,oe=T.getProjection(),ie=this.transform,oe.name===this.projection?ie.calculateProjMatrix(Q.toUnwrapped()):$f(ie,oe,Q));var Q,oe,ie;const ue=k.get("text-pitch-alignment")==="map",pe=k.get("text-rotation-alignment")==="map";u.compileFilter(u.options);const ge=u.dynamicFilter(),be=u.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(g),Ie=Uh(re,g.tileID.canonical,ue,pe,this.transform,T.getProjection(),Ae);let we=null;const Se=T.getProjection().createInversionMatrix(this.transform,g.tileID.canonical);if(ue){const De=Xl(re,g.tileID.canonical,ue,pe,this.transform,T.getProjection(),Ae);we=o.az([],this.transform.labelPlaneMatrix,De)}let Te=null;ge&&g.latestFeatureIndex&&(Te={unwrappedTileID:X,dynamicFilter:ge,dynamicFilterNeedsFeature:be}),this.retainedQueryData[T.bucketInstanceId]=new Hh(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,g.tileID);const[We,je]=T.layers[0].layout.get("text-size-scale-range"),ht=o.ay(w,We,je),[tt,ft]=k.get("icon-size-scale-range"),Pt=o.ay(w,tt,ft),qe={bucket:T,layout:k,paint:N,posMatrix:re,invMatrix:Se,mercatorCenter:[o.aD(this.transform.center.lng),o.aH(this.transform.center.lat)],textLabelPlaneMatrix:Ie,labelToScreenMatrix:we,clippingData:Te,scale:q,textPixelRatio:V,holdingForFade:g.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:o.bH(T.textSizeData,this.transform.zoom,ht),partiallyEvaluatedIconSize:o.bH(T.iconSizeData,this.transform.zoom,Pt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(x)for(const De of T.sortKeyRanges){const{sortKey:st,symbolInstanceStart:Xe,symbolInstanceEnd:yt}=De;s.push({sortKey:st,symbolInstanceStart:Xe,symbolInstanceEnd:yt,parameters:qe})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:qe})}attemptAnchorPlacement(s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe,ie,ue,pe,ge,be){const{textOffset0:Ae,textOffset1:Ie,crossTileID:we}=Q,Se=[Ae,Ie],Te=vn(s,T,I,Se,k),We=this.collisionIndex.placeCollisionBox(ie,k,u,g,x,w,xn(Te.x,Te.y,N,F,this.transform.angle),re,q,V,X.predicate);if(pe){const je=ie.getSymbolInstanceIconSize(be,this.transform.zoom,Q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ie,je,pe,g,x,w,xn(Te.x,Te.y,N,F,this.transform.angle),re,q,V,X.predicate).box.length===0)return}if(We.box.length>0){let je;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(je=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:Se,width:T,height:I,anchor:s,textScale:k,prevAnchor:je},this.markUsedJustification(ie,s,Q,ue),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ue,Q),this.placedOrientations[we]=ue),{shift:Te,placedGlyphBoxes:We}}}placeLayerBucketPart(s,u,g,x,w=1){const{bucket:T,layout:I,paint:k,posMatrix:N,textLabelPlaneMatrix:F,labelToScreenMatrix:q,clippingData:V,textPixelRatio:X,mercatorCenter:re,invMatrix:Q,holdingForFade:oe,collisionBoxArray:ie,partiallyEvaluatedTextSize:ue,partiallyEvaluatedIconSize:pe,collisionGroup:ge,latestFeatureIndex:be}=s.parameters,Ae=I.get("text-optional"),Ie=I.get("icon-optional"),we=I.get("text-allow-overlap"),Se=I.get("icon-allow-overlap"),Te=I.get("text-rotation-alignment")==="map",We=I.get("icon-rotation-alignment")==="map",je=I.get("text-pitch-alignment")==="map",ht=k.get("symbol-z-offset"),tt=I.get("symbol-elevation-reference")==="sea",ft=I.get("symbol-placement"),[Pt,qe]=I.get("text-size-scale-range"),[De,st]=I.get("icon-size-scale-range"),Xe=o.ay(w,Pt,qe),yt=o.ay(w,De,st),vt=I.get("text-variable-anchor"),bt=Te&&ft!=="point",Dt=We&&ft!=="point",Jt=vt&&T.hasTextData(),or=T.hasIconTextFit()&&Jt&&T.hasIconData();this.transform.setProjection(T.projection);const $t=Jt||bt,rr=Dt||or;let er=we&&(Se||!T.hasIconData()||Ie),_r=Se&&(we||!T.hasTextData()||Ae);const Ar=!ht.isConstant();!T.collisionArrays&&ie&&T.deserializeCollisionBoxes(ie),g&&x&&T.updateCollisionDebugBuffers(this.transform.zoom,ie,Xe,yt);const zr=(wr,sn,un)=>{const{crossTileID:Bn,numVerticalGlyphVertices:Lr}=wr;let an=null;if(V&&V.dynamicFilterNeedsFeature||Ar){const Ei=this.retainedQueryData[T.bucketInstanceId];an=be.loadFeature({featureIndex:wr.featureIndex,bucketIndex:Ei.bucketIndex,sourceLayerIndex:Ei.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},an,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new o.P(wr.tileAnchorX,wr.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[Bn]=new ta(!1,!1,!1,!0),void u.add(Bn);const cn=ht.evaluate(an,{});if(u.has(Bn))return;if(oe)return void(this.placements[Bn]=new ta(!1,!1,!1));let gn=!1,Fr=!1,Mn=!0,hn=!1,ui=!1,rn=null,yn={box:null,offscreen:null,occluded:null},Nn={box:null},Di=null,Oi=null,zi=null,So=0,rl=0,ms=0;un.textFeatureIndex?So=un.textFeatureIndex:wr.useRuntimeCollisionCircles&&(So=wr.featureIndex),un.verticalTextFeatureIndex&&(rl=un.verticalTextFeatureIndex);const $s=Ei=>{Ei.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const gi=this.transform.elevation;Ei.elevation=tt?cn:cn+(gi?gi.getAtTileOffset(Ei.tileID,Ei.tileAnchorX,Ei.tileAnchorY):0),Ei.elevation+=wr.zOffset},zo=un.textBox;if(zo){$s(zo);const Ei=Un=>{let Hi=o.bI.horizontal;if(T.allowVerticalPlacement&&!Un&&this.prevPlacement){const To=this.prevPlacement.placedOrientations[Bn];To&&(this.placedOrientations[Bn]=To,Hi=To,this.markUsedOrientation(T,Hi,wr))}return Hi},gi=(Un,Hi)=>{if(T.allowVerticalPlacement&&Lr>0&&un.verticalTextBox){for(const To of T.writingModes)if(To===o.bI.vertical?(yn=Hi(),Nn=yn):yn=Un(),yn&&yn.box&&yn.box.length)break}else yn=Un()};if(vt){let Un=vt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Bn]){const Ai=this.prevPlacement.variableOffsets[Bn];Un.indexOf(Ai.anchor)>0&&(Un=Un.filter(aa=>aa!==Ai.anchor),Un.unshift(Ai.anchor))}const Hi=(Ai,aa,Yu)=>{const eu=T.getSymbolInstanceTextSize(ue,wr,this.transform.zoom,sn),xd=(Ai.x2-Ai.x1)*eu+2*Ai.padding,bd=(Ai.y2-Ai.y1)*eu+2*Ai.padding,la=wr.hasIconTextFit&&!Se?aa:null;la&&$s(la);let wl={box:[],offscreen:!1,occluded:!1};const Wi=we?2*Un.length:Un.length;for(let ca=0;ca<Wi;++ca){const Ju=this.attemptAnchorPlacement(Un[ca%Un.length],Ai,re,Q,$t,xd,bd,eu,Te,je,X,N,ge,ca>=Un.length,wr,sn,T,Yu,la,ue,pe);if(Ju&&(wl=Ju.placedGlyphBoxes,wl&&wl.box&&wl.box.length)){gn=!0,rn=Ju.shift;break}}return wl};gi(()=>Hi(zo,un.iconBox,o.bI.horizontal),()=>{const Ai=un.verticalTextBox;return Ai&&$s(Ai),T.allowVerticalPlacement&&!(yn&&yn.box&&yn.box.length)&&Lr>0&&Ai?Hi(Ai,un.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}}),yn&&(gn=yn.box,Mn=yn.offscreen,hn=yn.occluded);const To=Ei(!(!yn||!yn.box));if(!gn&&this.prevPlacement){const Ai=this.prevPlacement.variableOffsets[Bn];Ai&&(this.variableOffsets[Bn]=Ai,this.markUsedJustification(T,Ai.anchor,wr,To))}}else{const Un=(Hi,To)=>{const Ai=T.getSymbolInstanceTextSize(ue,wr,this.transform.zoom,sn,w),aa=this.collisionIndex.placeCollisionBox(T,Ai,Hi,re,Q,$t,new o.P(0,0),we,X,N,ge.predicate);return aa&&aa.box&&aa.box.length&&(this.markUsedOrientation(T,To,wr),this.placedOrientations[Bn]=To),aa};gi(()=>Un(zo,o.bI.horizontal),()=>{const Hi=un.verticalTextBox;return T.allowVerticalPlacement&&Lr>0&&Hi?($s(Hi),Un(Hi,o.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Ei(!!(yn&&yn.box&&yn.box.length))}}if(Di=yn,gn=Di&&Di.box&&Di.box.length>0,Mn=Di&&Di.offscreen,hn=Di&&Di.occluded,wr.useRuntimeCollisionCircles){const Ei=T.text.placedSymbolArray.get(wr.centerJustifiedTextSymbolIndex>=0?wr.centerJustifiedTextSymbolIndex:wr.verticalPlacedTextSymbolIndex),gi=o.bJ(T.textSizeData,ue,Ei),Un=I.get("text-padding");Oi=this.collisionIndex.placeCollisionCircles(T,we,Ei,T.lineVertexArray,T.glyphOffsetArray,gi,N,F,q,g,je,ge.predicate,wr.collisionCircleDiameter*gi/o.bU,Un,this.retainedQueryData[T.bucketInstanceId].tileID),gn=we||Oi.circles.length>0&&!Oi.collisionDetected,Mn=Mn&&Oi.offscreen,hn=Oi.occluded}if(un.iconFeatureIndex&&(ms=un.iconFeatureIndex),un.iconBox){const Ei=gi=>{$s(gi);const Un=wr.hasIconTextFit&&rn?xn(rn.x,rn.y,Te,je,this.transform.angle):new o.P(0,0),Hi=T.getSymbolInstanceIconSize(pe,this.transform.zoom,wr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Hi,gi,re,Q,rr,Un,Se,X,N,ge.predicate)};Nn&&Nn.box&&Nn.box.length&&un.verticalIconBox?(zi=Ei(un.verticalIconBox),Fr=zi.box.length>0):(zi=Ei(un.iconBox),Fr=zi.box.length>0),Mn=Mn&&zi.offscreen,ui=zi.occluded}const sa=Ae||wr.numHorizontalGlyphVertices===0&&Lr===0,Da=Ie||wr.numIconVertices===0;if(sa||Da?Da?sa||(Fr=Fr&&gn):gn=Fr&&gn:Fr=gn=Fr&&gn,gn&&Di&&Di.box&&this.collisionIndex.insertCollisionBox(Di.box,I.get("text-ignore-placement"),T.bucketInstanceId,Nn&&Nn.box&&rl?rl:So,ge.ID),Fr&&zi&&this.collisionIndex.insertCollisionBox(zi.box,I.get("icon-ignore-placement"),T.bucketInstanceId,ms,ge.ID),Oi&&(gn&&this.collisionIndex.insertCollisionCircles(Oi.circles,I.get("text-ignore-placement"),T.bucketInstanceId,So,ge.ID),g)){const Ei=T.bucketInstanceId;let gi=this.collisionCircleArrays[Ei];gi===void 0&&(gi=this.collisionCircleArrays[Ei]=new Mv);for(let Un=0;Un<Oi.circles.length;Un+=4)gi.circles.push(Oi.circles[Un+0]),gi.circles.push(Oi.circles[Un+1]),gi.circles.push(Oi.circles[Un+2]),gi.circles.push(Oi.collisionDetected?1:0)}const Fo=T.projection.name!=="globe";er=er&&(Fo||!hn),_r=_r&&(Fo||!ui),this.placements[Bn]=new ta(gn||er,Fr||_r,Mn||T.justReloaded),u.add(Bn)},on=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,on),T.elevationType==="road"&&T.updateRoadElevation(on.canonical),T.updateZOffset(),T.sortFeaturesByY){const wr=T.getSortedSymbolIndexes(this.transform.angle);for(let sn=wr.length-1;sn>=0;--sn){const un=wr[sn];zr(T.symbolInstances.get(un),un,T.collisionArrays[un])}T.hasAnyZOffset&&o.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const wr=T.getSortedIndexesByZOffset();for(let sn=0;sn<wr.length;++sn){const un=wr[sn];zr(T.symbolInstances.get(un),un,T.collisionArrays[un])}}else for(let wr=s.symbolInstanceStart;wr<s.symbolInstanceEnd;wr++)zr(T.symbolInstances.get(wr),wr,T.collisionArrays[wr]);if(g&&T.bucketInstanceId in this.collisionCircleArrays){const wr=this.collisionCircleArrays[T.bucketInstanceId];o.bi(wr.invProjMatrix,N),wr.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(s,u,g,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:k,crossTileID:N}=g,F=o.b$(u),q=x===o.bI.vertical?k:F==="left"?w:F==="center"?T:F==="right"?I:-1;w>=0&&(s.text.placedSymbolArray.get(w).crossTileID=q>=0&&w!==q?0:N),T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=q>=0&&T!==q?0:N),I>=0&&(s.text.placedSymbolArray.get(I).crossTileID=q>=0&&I!==q?0:N),k>=0&&(s.text.placedSymbolArray.get(k).crossTileID=q>=0&&k!==q?0:N)}markUsedOrientation(s,u,g){const x=u===o.bI.horizontal||u===o.bI.horizontalOnly?u:0,w=u===o.bI.vertical?u:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:N}=g,F=s.text.placedSymbolArray;T>=0&&(F.get(T).placedOrientation=x),I>=0&&(F.get(I).placedOrientation=x),k>=0&&(F.get(k).placedOrientation=x),N>=0&&(F.get(N).placedOrientation=w)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const x=u?u.symbolFadeChange(s):1,w=u?u.opacities:{},T=u?u.variableOffsets:{},I=u?u.placedOrientations:{};for(const k in this.placements){const N=this.placements[k],F=w[k];F?(this.opacities[k]=new zu(F,x,N.text,N.icon,null,N.clipped),g=g||N.text!==F.text.placed||N.icon!==F.icon.placed):(this.opacities[k]=new zu(null,x,N.text,N.icon,N.skipFade,N.clipped),g=g||N.text||N.icon)}for(const k in w){const N=w[k];if(!this.opacities[k]){const F=new zu(N,x,!1,!1);F.isHidden()||(this.opacities[k]=F,g=g||N.text.placed||N.icon.placed)}}for(const k in T)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=T[k]);for(const k in I)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=I[k]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)}updateLayerOpacities(s,u,g,x){const w=new Set;for(const T of u){const I=T.getBucket(s);I&&T.latestFeatureIndex&&s.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,w,T,T.collisionBoxArray,g,x,T.tileID,s.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,T.tileID),I.elevationType==="road"&&I.updateRoadElevation(T.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(s,u,g,x,w,T,I,k){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const N=s.layers[0].layout,F=s.layers[0].paint,q=!!s.layers[0].dynamicFilter(),V=new zu(null,0,!1,!1,!0),X=N.get("text-allow-overlap"),re=N.get("icon-allow-overlap"),Q=N.get("text-variable-anchor"),oe=N.get("text-rotation-alignment")==="map",ie=N.get("text-pitch-alignment")==="map",ue=F.get("symbol-z-offset"),pe=N.get("symbol-elevation-reference")==="sea",ge=!ue.isConstant(),be=new zu(null,0,X&&(re||!s.hasIconData()||N.get("icon-optional")),re&&(X||!s.hasTextData()||N.get("text-optional")),!0);!s.collisionArrays&&x&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(x);const Ae=(we,Se,Te)=>{for(let We=0;We<Se/4;We++)we.opacityVertexArray.emplaceBack(Te)};let Ie=0;T&&s.updateReplacement(I,T);for(let we=0;we<s.symbolInstances.length;we++){const Se=s.symbolInstances.get(we),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:We,crossTileID:je,numIconVertices:ht,tileAnchorX:tt,tileAnchorY:ft}=Se;let Pt=null;const qe=this.retainedQueryData[s.bucketInstanceId];ge&&Se&&qe&&(Pt=g.latestFeatureIndex.loadFeature({featureIndex:Se.featureIndex,bucketIndex:qe.bucketIndex,sourceLayerIndex:qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const De=ue.evaluate(Pt,{}),st=u.has(je);let Xe=this.opacities[je];st?Xe=V:Xe||(Xe=be,this.opacities[je]=Xe),u.add(je);const yt=Te>0||We>0,vt=ht>0,bt=this.placedOrientations[je],Dt=bt===o.bI.vertical,Jt=bt===o.bI.horizontal||bt===o.bI.horizontalOnly;!yt&&!vt||Xe.isHidden()||Ie++;let or=!1;if((yt||vt)&&T)for(const $t of s.activeReplacements){if(o.bV($t,w,o.bW.Symbol,k)||$t.min.x>tt||tt>$t.max.x||$t.min.y>ft||ft>$t.max.y)continue;const rr=o.bX(tt,ft,I.canonical,$t.footprintTileId.canonical);if(or=o.bY(rr,$t.footprint),or)break}if(yt){const $t=or?jc:Wh(Xe.text);Ae(s.text,Te,Dt?jc:$t),Ae(s.text,We,Jt?jc:$t);const rr=Xe.text.isHidden(),{leftJustifiedTextSymbolIndex:er,centerJustifiedTextSymbolIndex:_r,rightJustifiedTextSymbolIndex:Ar,verticalPlacedTextSymbolIndex:zr}=Se,on=s.text.placedSymbolArray,wr=rr||Dt?1:0;er>=0&&(on.get(er).hidden=wr),_r>=0&&(on.get(_r).hidden=wr),Ar>=0&&(on.get(Ar).hidden=wr),zr>=0&&(on.get(zr).hidden=rr||Jt?1:0);const sn=this.variableOffsets[je];sn&&this.markUsedJustification(s,sn.anchor,Se,bt);const un=this.placedOrientations[je];un&&(this.markUsedJustification(s,"left",Se,un),this.markUsedOrientation(s,un,Se))}if(vt){const $t=or?jc:Wh(Xe.icon),{placedIconSymbolIndex:rr,verticalPlacedIconSymbolIndex:er}=Se,_r=s.icon.placedSymbolArray,Ar=Xe.icon.isHidden()?1:0;rr>=0&&(Ae(s.icon,ht,Dt?jc:$t),_r.get(rr).hidden=Ar),er>=0&&(Ae(s.icon,Se.numVerticalIconVertices,Jt?jc:$t),_r.get(er).hidden=Ar)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const $t=s.collisionArrays[we];if($t){let rr=new o.P(0,0),er=!0;if($t.textBox||$t.verticalTextBox){if(Q){const Ar=this.variableOffsets[je];Ar?(rr=vn(Ar.anchor,Ar.width,Ar.height,Ar.textOffset,Ar.textScale),oe&&rr._rotate(ie?this.transform.angle:-this.transform.angle)):er=!1}q&&(er=!Xe.clipped),$t.textBox&&Kl(s.textCollisionBox.collisionVertexArray,Xe.text.placed,!er||Dt,De,pe,rr.x,rr.y),$t.verticalTextBox&&Kl(s.textCollisionBox.collisionVertexArray,Xe.text.placed,!er||Jt,De,pe,rr.x,rr.y)}const _r=er&&!!(!Jt&&$t.verticalIconBox);$t.iconBox&&Kl(s.iconCollisionBox.collisionVertexArray,Xe.icon.placed,_r,De,pe,Se.hasIconTextFit?rr.x:0,Se.hasIconTextFit?rr.y:0),$t.verticalIconBox&&Kl(s.iconCollisionBox.collisionVertexArray,Xe.icon.placed,!_r,De,pe,Se.hasIconTextFit?rr.x:0,Se.hasIconTextFit?rr.y:0)}}}if(s.fullyClipped=Ie===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=we.invProjMatrix,s.placementViewportMatrix=we.viewportMatrix,s.collisionCircleArray=we.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function Kl(m,s,u,g,x,w,T){m.emplaceBack(s?1:0,u?1:0,w||0,T||0,g,x?1:0),m.emplaceBack(s?1:0,u?1:0,w||0,T||0,g,x?1:0),m.emplaceBack(s?1:0,u?1:0,w||0,T||0,g,x?1:0),m.emplaceBack(s?1:0,u?1:0,w||0,T||0,g,x?1:0)}const Tn=Math.pow(2,25),Hm=Math.pow(2,24),Hf=Math.pow(2,17),Wf=Math.pow(2,16),Xo=Math.pow(2,9),Gi=Math.pow(2,8),fC=Math.pow(2,1);function Wh(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const s=m.placed?1:0,u=Math.floor(127*m.opacity);return u*Tn+s*Hm+u*Hf+s*Wf+u*Xo+s*Gi+u*fC+s}const jc=0;class qf{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,u,g,x,w,T){const I=this._bucketParts;for(;this._currentTileIndex<s.length;)if(u.getBucketParts(I,x,s[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((k,N)=>k.sortKey-N.sortKey));this._currentPartIndex<I.length;){const k=I[this._currentPartIndex];if(u.placeLayerBucketPart(k,this._seenCrossTileIDs,g,k.symbolInstanceStart===0,T),this._currentPartIndex++,w())return!0}return!1}}class Wm{constructor(s,u,g,x,w,T,I,k,N){this.placement=new Fs(s,w,T,I,k,N),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(s,u,g,x,w){const T=o.q.now(),I=()=>{const k=o.q.now()-T;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){const k=u[s[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=N)&&(!k.maxzoom||k.maxzoom>N)){const F=k,q=F.layout.get("symbol-z-elevate"),V=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,X=F.layout.get("symbol-z-order"),re=X==="viewport-y"||X==="auto"&&!(X!=="viewport-y"&&V),Q=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),oe=re&&Q,ie=this._inProgressLayer=this._inProgressLayer||new qf(F),ue=o.C(k.source,k.scope);if(ie.continuePlacement(q||oe?x[ue]:g[ue],this.placement,this._showCollisionBoxes,k,I,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Zf=512/o.aj/2;class qm{constructor(s,u,g){this.tileID=s,this.bucketInstanceId=g,this.index=new o.c0(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=s.canonical.x*o.aj,w=s.canonical.y*o.aj;for(let T=0;T<u.length;T++){const{key:I,crossTileID:k,tileAnchorX:N,tileAnchorY:F}=u.get(T),q=Math.floor((x+N)*Zf),V=Math.floor((w+F)*Zf);this.index.add(q,V),this.keys.push(I),this.crossTileIDs.push(k)}this.index.finish()}findMatches(s,u,g){const x=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),w=Zf/Math.pow(2,u.canonical.z-this.tileID.canonical.z),T=u.canonical.x*o.aj,I=u.canonical.y*o.aj;for(let k=0;k<s.length;k++){const N=s.get(k);if(N.crossTileID)continue;const{key:F,tileAnchorX:q,tileAnchorY:V}=N,X=Math.floor((T+q)*w),re=Math.floor((I+V)*w),Q=this.index.range(X-x,re-x,X+x,re+x).sort((oe,ie)=>oe-ie);for(const oe of Q){const ie=this.crossTileIDs[oe];if(this.keys[oe]===F&&!g.has(ie)){g.add(ie),N.crossTileID=ie;break}}}}}class hs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const u=Math.round((s-this.lng)/360);if(u!==0)for(const g in this.indexes){const x=this.indexes[g],w={};for(const T in x){const I=x[T];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+u),w[I.tileID.key]=I}this.indexes[g]=w}this.lng=s}addBucket(s,u,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let w=0;w<u.symbolInstances.length;w++)u.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const x=this.usedCrossTileIDs[s.overscaledZ];for(const w in this.indexes){const T=this.indexes[w];if(Number(w)>s.overscaledZ)for(const I in T){const k=T[I];k.tileID.isChildOf(s)&&k.findMatches(u.symbolInstances,s,x)}else{const I=T[s.scaledTo(Number(w)).key];I&&I.findMatches(u.symbolInstances,s,x)}}for(let w=0;w<u.symbolInstances.length;w++){const T=u.symbolInstances.get(w);T.crossTileID||(T.crossTileID=g.generate(),x.add(T.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new qm(s,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(s,u){for(const g of u.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let u=!1;for(const g in this.indexes){const x=this.indexes[g];for(const w in x)s[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[w]),delete x[w],u=!0)}return u}}class Cs{constructor(){this.layerIndexes={},this.crossTileIDs=new hs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,u,g,x){let w=this.layerIndexes[s.fqid];w===void 0&&(w=this.layerIndexes[s.fqid]=new Yl);let T=!1;const I={};x.name!=="globe"&&w.handleWrapJump(g);for(const k of u){const N=k.getBucket(s);N&&s.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(k.tileID,N,this.crossTileIDs)&&(T=!0),I[N.bucketInstanceId]=!0)}return w.removeStaleBuckets(I)&&(T=!0),T}pruneUnusedLayers(s){const u={};s.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const Fu=771;class Mr{constructor(s,u,g,x){this.blendFunction=s,this.blendColor=u.toNonPremultipliedRenderColor(null),this.mask=g,this.blendEquation=x}}Mr.Replace=[1,0,1,0],Mr.disabled=new Mr(Mr.Replace,o.am.transparent,[!1,!1,!1,!1]),Mr.unblended=new Mr(Mr.Replace,o.am.transparent,[!0,!0,!0,!0]),Mr.alphaBlended=new Mr([1,Fu,1,Fu],o.am.transparent,[!0,!0,!0,!0]),Mr.alphaBlendedNonPremultiplied=new Mr([770,Fu,770,Fu],o.am.transparent,[!0,!0,!0,!0]),Mr.multiply=new Mr([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class Ht{constructor(s,u,g){this.func=s,this.mask=u,this.range=g}}Ht.ReadOnly=!1,Ht.ReadWrite=!0,Ht.disabled=new Ht(519,Ht.ReadOnly,[0,1]);const Ca=7680;class mr{constructor(s,u,g,x,w,T){this.test=s,this.ref=u,this.mask=g,this.fail=x,this.depthFail=w,this.pass=T}}mr.disabled=new mr({func:519,mask:0},0,0,Ca,Ca,Ca);const Bi=1029,Xf=2305;class ur{constructor(s,u,g){this.enable=s,this.mode=u,this.frontFace=g}}function qh(m,s){const u=o.c6(m,3);o.c8(m,s),o.cc(m,3,u)}function Zh(m,s){const u=o.c3([]);return o.c4(u,u,-s),o.c5(u,u,-m),u}function Nc(m,s){const u=[m[0],m[1],0],g=[s[0],s[1],0];if(o.ae(u)>=1e-15){const T=o.au([],u);o.c1(g,T,o.bG(g,T)),s[0]=g[0],s[1]=g[1]}const x=o.bF([],s,m);if(o.c2(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return Zh(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}ur.disabled=new ur(!1,Bi,Xf),ur.backCCW=new ur(!0,Bi,Xf),ur.backCW=new ur(!0,Bi,2304),ur.frontCW=new ur(!0,1028,2304),ur.frontCCW=new ur(!0,1028,Xf);class g1{constructor(s,u){this.position=s,this.orientation=u}get position(){return this._position}set position(s){if(s){const u=s instanceof o.ac?s:new o.ac(s[0],s[1],s[2]);this._renderWorldCopies&&(u.x=o.bQ(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(s,u){if(this.orientation=null,!this.position)return;const g=this.position,x=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(s)):0,w=o.ac.fromLngLat(s,x),T=[w.x-g.x,w.y-g.y,w.z-g.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Nc(T,u)}setPitchBearing(s,u){this.orientation=Zh(o.al(s),o.al(-u))}}class Ia{constructor(s,u){this._transform=o.bx([]),this.orientation=u,this.position=s}get mercatorPosition(){const s=this.position;return new o.ac(s[0],s[1],s[2])}get position(){const s=o.c6(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var u;s&&o.cc(this._transform,3,[(u=s)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||o.c3([]),s&&qh(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,u){this._orientation=Zh(s,u),qh(this._transform,this._orientation)}forward(){const s=o.c6(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=o.c6(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=o.c6(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,u){const g=new Float64Array(16);return o.bi(g,this.getWorldToCamera(s,u)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,u,g){const x=this.position;o.c1(x,x,-s);const w=new Float64Array(16);return o.bn(w,[g,g,g]),o.bo(w,w,x),w[10]*=u,w}getWorldToCamera(s,u){const g=new Float64Array(16),x=new Float64Array(4),w=this.position;return o.c7(x,this._orientation),o.c1(w,w,-s),o.c8(g,x),o.bo(g,g,w),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(s,u,g,x){const w=new Float64Array(16);return o.c9(w,s,u,g,x),w}getCameraToClipOrthographic(s,u,g,x,w,T){const I=new Float64Array(16);return o.ca(I,s,u,g,x,w,T),I}getDistanceToElevation(s,u=!1){const g=s===0?0:o.cb(s,u?o.aY(this.position[1]):this.position[1]),x=this.forward();return(g-this.position[2])/x[2]}clone(){return new Ia([...this.position],[...this.orientation])}}const ds={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Kf{constructor(s=0,u=0,g=0,x=0){if(isNaN(s)||s<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=g,this.right=x}interpolate(s,u,g){return u.top!=null&&s.top!=null&&(this.top=o.ai(s.top,u.top,g)),u.bottom!=null&&s.bottom!=null&&(this.bottom=o.ai(s.bottom,u.bottom,g)),u.left!=null&&s.left!=null&&(this.left=o.ai(s.left,u.left,g)),u.right!=null&&s.right!=null&&(this.right=o.ai(s.right,u.right,g)),this}getCenter(s,u){const g=o.ay((this.left+s-this.right)/2,0,s),x=o.ay((this.top+u-this.bottom)/2,0,u);return new o.P(g,x)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Kf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const wo=15;class Ov{constructor(s,u,g,x,w,T,I){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=s||0,this._maxZoom=u||22,this._minPitch=g??0,this._maxPitch=x??60,this.setProjection(T),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new o.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Kf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ia,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new Ov(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<wo}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,u=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=o.cj(this.projectionOptions);const g=this.getProjection(),x=!o.bv(u,g);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cj({name:"mercator"});const u=s!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bQ(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const u=-s*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=o.ck(),o.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const u=o.ay(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=o.al(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const u=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const s=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,w=0;for(let T=0;T<u.length;T++){const I=new o.P(u[T][0]*this.width,g+u[T][1]*(this.height-g)),k=s.pointCoordinate(I);if(!k)continue;const N=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);x+=k[3]*N,w+=N}return w===0?NaN:x/w}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,x=this._mercatorZfromZoom(s),w=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-g,w);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let g;g=s.z<this._camera.position[2]?[u.x,u.y,u.z]:[s.x,s.y,s.z];const x=o.ae(o.at([],this._camera.position,g));return o.ay(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let u=!1;if(s.orientation&&!o.cm(s.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(s.orientation)),s.position){const g=[s.position.x,s.position.y,s.position.z];o.cn(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,u=new g1;return u.position=new o.ac(s[0],s[1],s[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(s){if(!o.co(s))return!1;o.cp(s,s);const u=o.cq([],[0,0,-1],s),g=o.cq([],[0,-1,0],s);if(g[2]<0)return!1;const x=Nc(u,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(s){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;s[2]=o.ay(s[2],x/g,x/u),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,u,g){this._unmodified=!1,this._edgeInsets.interpolate(s,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const u=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(s){const u=[new o.cr(0,s)];if(this.renderWorldCopies){const g=this.pointCoordinate(new o.P(0,0)),x=this.pointCoordinate(new o.P(this.width,0)),w=this.pointCoordinate(new o.P(this.width,this.height)),T=this.pointCoordinate(new o.P(0,this.height)),I=Math.floor(Math.min(g.x,x.x,w.x,T.x)),k=Math.floor(Math.max(g.x,x.x,w.x,T.x)),N=1;for(let F=I-N;F<=k+N;F++)F!==0&&u.push(new o.cr(F,s))}return u}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,u,g){let x=[];const w=g!=null,T=!w;if(T&&this.zoom<u||w&&g[0]===0&&g[1]===0)return x;const I=new Set,k=(F,q,V,X,re)=>{const Q=o.cV(q,F,V,X,re);I.has(Q)||(x.push(new o.aM(F,q,V,X,re)),I.add(Q))};for(let F=0;F<s.length;F++){const q=s[F];if(T&&q.canonical.z!==u)continue;const V=q.canonical,X=q.overscaledZ,re=q.wrap,Q=1<<V.z,oe=V.x+1<Q,ie=V.x>0,ue=V.y+1<Q,pe=V.y>0,ge=q.wrap-(ie?0:1),be=q.wrap+(oe?0:1),Ae=ie?V.x-1:Q-1,Ie=oe?V.x+1:0;if(w)g[0]<0?(k(X,be,V.z,Ie,V.y),g[1]<0&&ue&&(k(X,re,V.z,V.x,V.y+1),k(X,be,V.z,Ie,V.y+1)),g[1]>0&&pe&&(k(X,re,V.z,V.x,V.y-1),k(X,be,V.z,Ie,V.y-1))):g[0]>0?(k(X,ge,V.z,Ae,V.y),g[1]<0&&ue&&(k(X,re,V.z,V.x,V.y+1),k(X,ge,V.z,Ae,V.y+1)),g[1]>0&&pe&&(k(X,re,V.z,V.x,V.y-1),k(X,ge,V.z,Ae,V.y-1))):g[1]<0&&ue?k(X,re,V.z,V.x,V.y+1):pe&&k(X,re,V.z,V.x,V.y-1);else{const we=q.visibleQuadrants;1&we&&(k(X,ge,V.z,Ae,V.y),pe&&(k(X,re,V.z,V.x,V.y-1),k(X,ge,V.z,Ae,V.y-1))),2&we&&(k(X,be,V.z,Ie,V.y),pe&&(k(X,re,V.z,V.x,V.y-1),k(X,be,V.z,Ie,V.y-1))),4&we&&(k(X,ge,V.z,Ae,V.y),ue&&(k(X,re,V.z,V.x,V.y+1),k(X,ge,V.z,Ae,V.y+1))),8&we&&(k(X,be,V.z,Ie,V.y),ue&&(k(X,re,V.z,V.x,V.y+1),k(X,be,V.z,Ie,V.y+1)))}}const N=[];for(const F of x)x.some(q=>F.isChildOf(q))||N.push(F);if(x=N.filter(F=>!s.some(q=>!!(F.overscaledZ<u&&q.isChildOf(F))||F.equals(q)||F.isChildOf(q))),T){const F=1<<u,q=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[F*q.x,F*q.y],X=4,re=X*X;x=x.filter(Q=>{const oe=Q.canonical.x+.5-V[0],ie=Q.canonical.y+.5-V[1];return oe*oe+ie*ie<re})}return x}extendTileCoverToNearPlane(s,u,g){const x=[],w=new Set;for(const ue of s)w.add(ue.key);const T=(ue,pe,ge,be,Ae)=>{const Ie=o.cV(pe,ue,ge,be,Ae);w.has(Ie)||(x.push(new o.aM(ue,pe,ge,be,Ae)),w.add(Ie))},I=s.reduce((ue,pe)=>Math.max(ue,pe.overscaledZ),g),k=1<<g,N=[new o.P(0,0),new o.P(o.aj,0),new o.P(o.aj,o.aj),new o.P(0,o.aj)],F=new o.P(0,0),q=new o.P(0,0),V=(ue,pe)=>{const ge=Math.floor(ue[0]),be=Math.floor(ue[1]),Ae=(ue[0]-ge)*o.aj,Ie=(ue[1]-be)*o.aj,we=Math.floor(pe[0]),Se=Math.floor(pe[1]),Te=(pe[0]-we)*o.aj,We=(pe[1]-Se)*o.aj;for(let je=-1;je<=1;je++){const ht=ge+je;if(!(ht<0||ht>=k)){F.x=Ae-je*o.aj,q.x=Te-(ht-we)*o.aj;for(let tt=-1;tt<=1;tt++){const ft=be+tt;F.y=Ie-tt*o.aj,q.y=We-(ft-Se)*o.aj,o.cW(F,q,N)&&T(I,0,g,ht,ft)}}}},X=u.points,re=X[o.cs],Q=X[o.ct],oe=this._projectToGround(re,X[o.cu]),ie=this._projectToGround(Q,X[o.cv]);return V(re,oe),V(Q,ie),x}_projectToGround(s,u){return o.cw(o.cx(),s,u,s[2]/(s[2]-u[2]))}coveringTiles(s){let u=this.coveringZoomLevel(s);const g=u,x=this.elevation&&this.elevation.exaggeration(),w=x&&!s.isTerrainDEM,T=this.projection.name==="mercator";if(s.minzoom!==void 0&&u<s.minzoom)return[];s.maxzoom!==void 0&&u>s.maxzoom&&(u=s.maxzoom);const I=this.locationCoordinate(this.center),k=this.center.lat,N=1<<u,F=[N*I.x,N*I.y,0],q=this.projection.name==="globe",V=!q,X=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,V),re=q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=N*o.cb(1,this.center.lat),oe=this._camera.position[2]/o.cb(1,this.center.lat),ie=[N*re.x,N*re.y,oe*(V?1:Q)],ue=q||x,pe=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ge=this.isLODDisabled(!0)?u:0;let be;if(this._elevation&&s.isTerrainDEM)be=1e4*this._elevation.exaggeration();else if(this._elevation){const De=this._elevation.getMinMaxForVisibleTiles();be=De?De.max:this._centerAltitude}else be=this._centerAltitude;const Ae=s.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?o.cz(this):1,we=De=>{const Xe=new o.ac(De.x+25e-6,De.y,De.z),yt=new o.ac(De.x,De.y+25e-6,De.z),vt=De.toLngLat(),bt=Xe.toLngLat(),Dt=yt.toLngLat(),Jt=this.locationCoordinate(vt),or=this.locationCoordinate(bt),$t=this.locationCoordinate(Dt),rr=Math.hypot(or.x-Jt.x,or.y-Jt.y),er=Math.hypot($t.x-Jt.x,$t.y-Jt.y);return Math.sqrt(rr*er)*Ie/25e-6},Se=De=>{const st=be,Xe=Ae;return{aabb:o.cC(this,N,0,0,0,De,Xe,st,this.projection),zoom:0,x:0,y:0,minZ:Xe,maxZ:st,wrap:De,fullyVisible:!1}},Te=[];let We=[];const je=u,ht=s.reparseOverscaled?g:u,tt=(oe-this._centerAltitude)*Q,ft=De=>{if(!this._elevation||!De.tileID||!T)return;const st=this._elevation.getMinMaxForTile(De.tileID),Xe=De.aabb;st?(Xe.min[2]=st.min,Xe.max[2]=st.max,Xe.center[2]=(Xe.min[2]+Xe.max[2])/2):(De.shouldSplit=qe(De),De.shouldSplit||(Xe.min[2]=Xe.max[2]=Xe.center[2]=this._centerAltitude))},Pt=(De,st)=>{if(.707*st<De)return 1;const Xe=st/De;return Xe/(1.4144271570014144+(Math.pow(1.1,Xe-1.4144271570014144+1)-1)/(1.1-1)-1)},qe=De=>{if(De.zoom<ge)return!0;if(De.zoom===je)return!1;if(De.shouldSplit!=null)return De.shouldSplit;const st=De.aabb.distanceX(ie),Xe=De.aabb.distanceY(ie);let yt=tt,vt=1;if(q){yt=De.aabb.distanceZ(ie);const er=Math.pow(2,De.zoom),_r=o.aY((De.y+1)/er),Ar=o.aY(De.y/er),zr=Math.min(Math.max(k,_r),Ar),on=o.c_(zr)/o.c_(k);if(vt=zr===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,on/this._mercatorScaleRatio),this.zoom<=o.cX&&De.zoom===je-1&&on>=.9)return!0}else if(w&&(yt=De.aabb.distanceZ(ie)*Q),this.projection.isReprojectedInTileSpace&&g<=5){const er=Math.pow(2,De.zoom),_r=we(new o.ac((De.x+.5)/er,(De.y+.5)/er));vt=_r>.85?1:_r}if(!T){const er=Math.sqrt(st*st+Xe*Xe+yt*yt);let _r=(1<<je-De.zoom)*pe*vt;return _r*=Pt(Math.max(yt,tt),er),er<_r}let bt=Number.MAX_VALUE,Dt=0;const Jt=De.aabb.getCorners(),or=[];for(const er of Jt){o.at(or,er,ie),q||(w?or[2]*=Q:or[2]=tt);const _r=o.bG(or,this._camera.forward());_r<bt&&(bt=_r,Dt=Math.abs(or[2]))}let $t=(1<<je-De.zoom)*pe*vt;if($t*=Pt(Math.max(Dt,tt),bt),bt<$t)return!0;const rr=De.aabb.closestPoint(F);return rr[0]===F[0]&&rr[1]===F[1]};if(this.renderWorldCopies)for(let De=1;De<=3;De++)Te.push(Se(-De)),Te.push(Se(De));for(Te.push(Se(0));Te.length>0;){const De=Te.pop(),st=De.x,Xe=De.y;let yt=De.fullyVisible;const vt=()=>this.projection.name==="globe"&&(De.y===0||De.y===(1<<De.zoom)-1);if(!yt){let bt=ue?De.aabb.intersects(X):De.aabb.intersectsFlat(X);if(bt===0&&vt()){const Dt=new o.cA(De.zoom,st,Xe);bt=o.cB(this,N,Dt,!0).intersects(X)}if(bt===0)continue;yt=bt===2}if(De.zoom!==je&&qe(De))for(let bt=0;bt<4;bt++){const Dt=(st<<1)+bt%2,Jt=(Xe<<1)+(bt>>1),or={aabb:T?De.aabb.quadrant(bt):o.cC(this,N,De.zoom+1,Dt,Jt,De.wrap,De.minZ,De.maxZ,this.projection),zoom:De.zoom+1,x:Dt,y:Jt,wrap:De.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:De.minZ,maxZ:De.maxZ};w&&!q&&(or.tileID=new o.aM(De.zoom+1===je?ht:De.zoom+1,De.wrap,De.zoom+1,Dt,Jt),ft(or)),Te.push(or)}else{const bt=De.zoom===je?ht:De.zoom;if(s.minzoom&&s.minzoom>bt)continue;let Dt=0;if(!yt){let rr=ue?De.aabb.intersectsPrecise(X):De.aabb.intersectsPreciseFlat(X);if(rr===0&&vt()){const er=new o.cA(De.zoom,st,Xe);rr=o.cB(this,N,er,!0).intersectsPrecise(X)}if(rr===0)continue;if(s.calculateQuadrantVisibility)if(X.containsPoint(De.aabb.center))Dt=15;else for(let er=0;er<4;er++)De.aabb.quadrant(er).intersects(X)!==0&&(Dt|=1<<er)}const Jt=F[0]-(.5+st+(De.wrap<<De.zoom))*(1<<u-De.zoom),or=F[1]-.5-Xe,$t=De.tileID?De.tileID:new o.aM(bt,De.wrap,De.zoom,st,Xe);s.calculateQuadrantVisibility&&($t.visibleQuadrants=Dt),We.push({tileID:$t,distanceSq:Jt*Jt+or*or})}}if(this.fogCullDistSq){const De=this.fogCullDistSq,st=this.horizonLineFromTop();We=We.filter(Xe=>{const yt=[0,0,0,1],vt=[o.aj,o.aj,0,1],bt=this.calculateFogTileMatrix(Xe.tileID.toUnwrapped());o.aA(yt,yt,bt),o.aA(vt,vt,bt);const Dt=o.cD([],yt,vt),Jt=o.cE([],yt,vt),or=o.cY(Dt,Jt);if(or===0)return!0;let $t=!1;const rr=this._elevation;if(rr&&or>De&&st!==0){const er=this.calculateProjMatrix(Xe.tileID.toUnwrapped());let _r;s.isTerrainDEM||(_r=rr.getMinMaxForTile(Xe.tileID)),_r||(_r={min:Ae,max:be});const Ar=o.cF(this.rotation),zr=[Ar[0]*o.aj,Ar[1]*o.aj,_r.max];o.ad(zr,zr,er),$t=(1-zr[1])*this.height*.5<st}return or<De||$t})}return We.sort((De,st)=>De.distanceSq-st.distanceSq).map(De=>De.tileID)}resize(s,u){this.width=s,this.height=u,this.pixelsToGLUnits=[2/s,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const u=o.ay(s.lat,-o.cG,o.cG),g=this.projection.project(s.lng,u);return new o.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,u){let g,x;const w=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;g=(u.x-w.x)/I,x=(u.y-w.y)/I}else{const I=this.pointCoordinate(u),k=this.pointCoordinate(w);g=I.x-k.x,x=I.y-k.y}const T=this.locationCoordinate(s);this.setLocation(new o.ac(T.x-g,T.y-x))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,u){return this.projection.locationPoint(this,s,u)}locationPoint3D(s,u){return this.projection.locationPoint(this,s,u,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,u){return this.coordinateLocation(this.pointCoordinate3D(s,u))}locationCoordinate(s,u){const g=u?o.cb(u,s.lat):void 0,x=this.projection.project(s.lng,s.lat);return new o.ac(x.x,x.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,u){const g=u??this._centerAltitude,x=[s.x,s.y,0,1],w=[s.x,s.y,1,1];o.aA(x,x,this.pixelMatrixInverse),o.aA(w,w,this.pixelMatrixInverse);const T=w[3];o.cH(x,x,1/x[3]),o.cH(w,w,1/T);const I=x[2],k=w[2];return{p0:x,p1:w,t:I===k?0:(g-I)/(k-I)}}screenPointToMercatorRay(s){const u=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return o.aA(u,u,this.pixelMatrixInverse),o.aA(g,g,this.pixelMatrixInverse),o.cH(u,u,1/u[3]),o.cH(g,g,1/g[3]),u[2]=o.cb(u[2],this._center.lat)*this.worldSize,g[2]=o.cb(g[2],this._center.lat)*this.worldSize,o.cH(u,u,1/this.worldSize),o.cH(g,g,1/this.worldSize),new o.av([u[0],u[1],u[2]],o.au([],o.at([],g,u)))}rayIntersectionCoordinate(s){const{p0:u,p1:g,t:x}=s,w=o.cb(u[2],this._center.lat),T=o.cb(g[2],this._center.lat);return new o.ac(o.ai(u[0],g[0],x)/this.worldSize,o.ai(u[1],g[1],x)/this.worldSize,o.ai(w,T,x))}pointCoordinate(s,u=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,u)}pointCoordinate3D(s,u){if(!this.elevation)return this.pointCoordinate(s,u);let g=this.projection.pointCoordinate3D(this,s.x,s.y);if(g)return new o.ac(g[0],g[1],g[2]);let x=0,w=this.horizonLineFromTop();if(s.y>w)return this.pointCoordinate(s,u);const T=.02*w,I=s.clone();for(let k=0;k<10&&w-x>T;k++){I.y=o.ai(x,w,.66);const N=this.projection.pointCoordinate3D(this,I.x,I.y);N?(w=I.y,g=N):x=I.y}return g?new o.ac(g[0],g[1],g[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=o.cI)return!this.isPointAboveHorizon(s);const u=this.pointCoordinate(s);return u.y>=0&&u.y<=1}_coordinatePoint(s,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,x=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return o.aA(x,x,this.pixelMatrix),x[3]>0?new o.P(x[0]/x[3],x[1]/x[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:u}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new o.P(u,s)),T=this.pointLocation3D(new o.P(x,s)),I=this.pointLocation3D(new o.P(x,g)),k=this.pointLocation3D(new o.P(u,g));let N=Math.min(w.lng,T.lng,I.lng,k.lng),F=Math.max(w.lng,T.lng,I.lng,k.lng),q=Math.min(w.lat,T.lat,I.lat,k.lat),V=Math.max(w.lat,T.lat,I.lat,k.lat);const X=Math.pow(2,-this.zoom)/16*270,re=this.projection.name==="globe"?1:4,Q=(oe,ie,ue,pe,ge)=>{const be=(oe+ue)/2,Ae=(ie+pe)/2,Ie=new o.P(be,Ae),{lng:we,lat:Se}=this.pointLocation3D(Ie),Te=Math.max(0,N-we,q-Se,we-F,Se-V);N=Math.min(N,we),F=Math.max(F,we),q=Math.min(q,Se),V=Math.max(V,Se),(ge<re||Te>X)&&(Q(oe,ie,be,Ae,ge+1),Q(be,Ae,ue,pe,ge+1))};if(Q(u,s,x,s,1),Q(x,s,x,g,1),Q(x,g,u,g,1),Q(u,g,u,s,1),this.projection.name==="globe"){const[oe,ie]=o.cJ(this);oe?(V=90,F=180,N=-180):ie&&(q=-90,F=180,N=-180)}return new o.aG(new o.ci(N,q),new o.ci(F,V))}_getBoundsRectangular(s,u){const{top:g,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,I=new o.P(x,g),k=new o.P(T,g),N=new o.P(T,w),F=new o.P(x,w);let q=this.pointCoordinate(I,s),V=this.pointCoordinate(k,s);const X=this.pointCoordinate(N,u),re=this.pointCoordinate(F,u),Q=(oe,ie)=>(ie.y-oe.y)/(ie.x-oe.x);return q.y>1&&V.y>=0?q=new o.ac((1-re.y)/Q(re,q)+re.x,1):q.y<0&&V.y<=1&&(q=new o.ac(-re.y/Q(re,q)+re.x,0)),V.y>1&&q.y>=0?V=new o.ac((1-X.y)/Q(X,V)+X.x,1):V.y<0&&q.y<=1&&(V=new o.ac(-X.y/Q(X,V)+X.x,0)),new o.aG().extend(this.coordinateLocation(q)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(X))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=s.visibleDemTiles.reduce((g,x)=>{if(x.dem){const w=x.dem.tree;g.min=Math.min(g.min,w.minimums[0]),g.max=Math.max(g.max,w.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*s.exaggeration(),u.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-o.cG,this.maxLat=o.cG,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aD(this.minLng)*this.tileSize,this.worldMaxX=o.aD(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,u){return this.projection.createTileMatrix(this,u,s)}calculateDistanceTileData(s){const u=s.key,g=this._distanceTileDataCache;if(g[u])return g[u];const x=s.canonical,w=1/this.height,T=this.cameraWorldSize,I=T/this.zoomScale(x.z),k=(x.x+Math.pow(2,x.z)*s.wrap)*I,N=x.y*I,F=this.point;F.x*=T/this.worldSize,F.y*=T/this.worldSize;const q=this.angle,V=Math.sin(-q),X=-Math.cos(-q);return g[u]={bearing:[V,X],center:[(F.x-k)*w,(F.y-N)*w],scale:I/o.aj*w},g[u]}calculateFogTileMatrix(s){const u=s.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return o.az(x,this.worldToFogMatrix,x),g[u]=new Float32Array(x),g[u]}calculateProjMatrix(s,u=!1,g=!1){const x=s.key;let w;if(w=g?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];const T=this.calculatePosMatrix(s,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,o.az(T,I,T),w[x]=new Float32Array(T),w[x]}calculatePixelsToTileUnitsMatrix(s){const u=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const x=o.cK(s,this);return g[u]=x,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,u=o.bn([],[s,s,s]);return o.az(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const u=o.cb(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),x=this._camera.forward(),w=o.cb(1,this._center.lat);g[2]/=w,x[2]/=w,o.au(x,x);const T=s.raycast(g,x,s.exaggeration());if(T){const I=o.bE([],g,x,T),k=new o.ac(I[0],I[1],o.cb(I[2],o.aY(I[1]))),N=(k.z+o.ae([k.x-g[0],k.y-g[1],k.z-g[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const u=this._elevation,g=o.cb(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(g),w=u.getAtPointOrZero(new o.ac(...x)),T=this.pixelsPerMeter/this.worldSize*w,I=this._minimumHeightOverTerrain(),k=x[2]-T;if(k<=I)if(k<0||s){const N=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],N.z-x[2]],q=o.ae(F);F[2]-=(I-k)/this._pixelsPerMercatorPixel;const V=o.ae(F);if(V===0)return;o.c1(F,F,q/V*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],N.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const V=this.center;return V.lat=o.ay(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(V.lng=o.ay(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const u=this._unmodified,{x:g,y:x}=this.point;let w=0,T=g,I=x;const k=this.width/2,N=this.height/2,F=this.worldMinY*this.scale,q=this.worldMaxY*this.scale;if(x-N<F&&(I=F+N),x+N>q&&(I=q-N),q-F<this.height&&(w=Math.max(w,this.height/(q-F)),I=(q+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,re=this.worldSize/2-(V+X)/2;T=(g+re+this.worldSize)%this.worldSize-re,T-k<V&&(T=V+k),T+k>X&&(T=X-k),X-V<this.width&&(w=Math.max(w,this.width/(X-V)),T=(X+V)/2)}T===g&&I===x||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(T,I))),w&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,u=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cb(1,this.center.lat)/o.cb(1,o.c$));const x=o.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?g:1,T=this._camera.getWorldToCamera(this.worldSize,w);let I;const k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-s.x/this.width,k[9]=2*s.y/this.height,this.isOrthographic){let Se=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Te=Se*this.aspect,We=-Te,je=-Se;Te-=s.x,We-=s.x,Se+=s.y,je+=s.y,I=this._camera.getCameraToClipOrthographic(We,Te,je,Se,this._nearZ,this._farZ),((ht,tt,ft,Pt)=>{for(let qe=0;qe<16;qe++)ht[qe]=o.ai(tt[qe],ft[qe],Pt)})(I,I,k,o.cZ(this.pitch>=wo?1:this.pitch/wo))}else I=k;const N=o.cM([],k,T);let F=o.cM([],I,T);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Te=o.bx([]);o.bo(Te,Te,[Se.x*this.worldSize,Se.y*this.worldSize,0]),o.az(Te,Te,o.cN(this)),o.bo(Te,Te,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),o.az(F,F,Te),o.az(N,N,Te),this.inverseAdjustmentMatrix=o.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cP([],F,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=F,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),u){const Se=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Se[8]=2*-s.x/this.width,Se[9]=2*s.y/this.height,this.expandedFarZProjMatrix=o.cM([],Se,T)}else this.expandedFarZProjMatrix=this.projMatrix;const q=o.bi([],I);this.frustumCorners=o.cQ.fromInvProjectionMatrix(q,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const V=new Float32Array(16);o.bx(V),o.cP(V,V,[1,-1,1]),o.cR(V,V,this._pitch),o.by(V,V,this.angle);const X=o.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(X);const re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;X[8]=2*-s.x/this.width,X[9]=2*(s.y+re)/this.height,this.skyboxMatrix=o.az(V,X,V);const Q=this.point,oe=Q.x,ie=Q.y,ue=this.width%2/2,pe=this.height%2/2,ge=Math.cos(this.angle),be=Math.sin(this.angle),Ae=oe-Math.round(oe)+ge*ue+be*pe,Ie=ie-Math.round(ie)+ge*pe+be*ue,we=new Float64Array(F);if(o.bo(we,we,[Ae>.5?Ae-1:Ae,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=we,F=o.bz(),o.cP(F,F,[this.width/2,-this.height/2,1]),o.bo(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=o.bz(),o.cP(F,F,[1,-1,1]),o.bo(F,F,[-1,-1,0]),o.cP(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},F=o.bi(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cS(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(Se,Se,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[s,s,u];o.c1(w,w,x),o.c1(g,g,-1),o.cT(g,g,w);const T=o.bz();o.bo(T,T,g),o.cP(T,T,w),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,u,x)}_computeCameraPosition(s){const u=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-s/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-g[0]*w,x.y/this.worldSize-g[1]*w,s/this.worldSize*this._centerAltitude-g[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],x=s[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((u-g)/x,1)),this._camera.position=o.bE([],this._camera.position,s,w),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),w=o.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),I=Math.max((s[2]-w)/Math.cos(g),T),k=this._zoomFromMercatorZ(I);o.bE(s,s,u,I),this._pitch=o.ay(g,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bQ(x,-Math.PI,Math.PI),this._setZoom(o.ay(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,s)*this.tileSize))}zoomFromMercatorZAdjusted(s){let u=0,g=o.cI,x=0,w=1/0;for(;g-u>1e-6&&g>u;){const T=u+.5*(g-u),I=this.tileSize*Math.pow(2,T),k=this.getCameraToCenterDistance(this.projection,T,I),N=this.scaleZoom(k/(Math.max(0,s)*this.tileSize)),F=Math.abs(T-N);F<w&&(w=F,x=T),T<N?u=T:g=T}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,u){const g=Math.min(s.x,u.x),x=Math.max(s.x,u.x),w=Math.min(s.y,u.y),T=Math.max(s.y,u.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new o.P(g,w),new o.P(x,T),new o.P(g,T),new o.P(x,w)],k=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const F of I){const q=this.pointRayIntersection(F);if(q.t<0)return!0;const V=this.rayIntersectionCoordinate(q);if(V.x<k||V.y<0||V.x>N||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(s,u){const g=o.ae(o.at([],this._camera.position,s)),x=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([u,g,x],w){const T=[u,g,x,1];o.aA(T,T,w);const I=T[3]=Math.max(T[3],1e-6);return T[0]/=I,T[1]/=I,T[2]/=I,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,s))}}getCameraToCenterDistance(s,u=this.zoom,g=this.worldSize){const x=o.cL(s,u,this.width,this.height,1024),w=s.pixelSpaceConversion(this.center.lat,g,x);let T=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(T=o.ai(1,T,o.cZ(this.pitch>=wo?1:this.pitch/wo))),T}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(s,s,this.globeMatrix),s}getFrustum(s){return o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const yl=(m,s)=>{if(s>0&&m.terrain&&o.w("Cutoff is currently disabled on terrain"),s<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=m.transform,g=Math.max(Math.abs(u._zoom-(m.minCutoffZoom-1)),1),x=u.isLODDisabled(!1)?o.af(60,45,u.pitch):o.af(30,15,u.pitch),w=u._farZ-u._nearZ,T=s*u.height,I=((1-(k=x))*u.cameraToCenterDistance+k*(u._farZ+T))*g;var k;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(I-u._nearZ)/w,(I-T-u._nearZ)/w]}}},Ko={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Yf{constructor(s,u){this.aabb=s,this.lastCascade=u}}class pC{add(s,u){const g=this.receivers[s.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],u.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],u.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],u.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],u.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],u.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],u.max[2])):this.receivers[s.key]=new Yf(u,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,u,g){const x=o.d6.fromPoints(s.points);let w=0;for(const T in this.receivers){const I=this.receivers[T];if(!I||!x.intersectsAabb(I.aabb))continue;I.aabb.min=x.closestPoint(I.aabb.min),I.aabb.max=x.closestPoint(I.aabb.max);const k=I.aabb.getCorners();for(let N=0;N<g.length;N++){let F=!0;for(const q of k){const V=[q[0]*u,q[1]*u,q[2]];if(o.ad(V,V,g[N].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){F=!1;break}}if(I.lastCascade=N,w=Math.max(w,N),F)break}}return w+1}}class mC{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new pC,this._depthMode=new Ht(s.context.gl.LEQUAL,Ht.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(Ko,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(Ko,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),s.tp.registerParameter(Ko,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,u){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;const x=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||x<=0||(this._shadowLayerCount=g.style.order.reduce((re,Q)=>{const oe=g.style._mergedLayers[Q];return re+(oe.hasShadowPass()&&!oe.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=g.context,T=Ko.shadowMapResolution,I=Ko.shadowMapResolution;if(this._cascades.length===0||Ko.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let re=0;re<Ko.cascadeCount;++re){const Q=g._shadowMapDebug,oe=w.gl,ie=w.createFramebuffer(T,I,Q,"texture"),ue=new o.T(w,{width:T,height:I,data:null},oe.DEPTH_COMPONENT16);if(ie.depthAttachment.set(ue.texture),Q){const pe=new o.T(w,{width:T,height:I,data:null},oe.RGBA8);ie.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:ie,texture:ue,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cy,scale:0})}}this.shadowDirection=Xh(u);let k=0;if(s.elevation){const re=s.elevation,Q=[1e4,-1e4];re.visibleDemTiles.filter(oe=>oe.dem).forEach(oe=>{const ie=oe.dem.tree;Q[0]=Math.min(Q[0],ie.minimums[0]),Q[1]=Math.max(Q[1],ie.maximums[0])}),Q[0]!==1e4&&(k=(Q[1]-Q[0])*re.exaggeration())}const N=1.5*s.cameraToCenterDistance,F=3*N,q=new Float64Array(16);for(let re=0;re<this._cascades.length;++re){const Q=this._cascades[re];let oe=s.height/50,ie=1;Ko.cascadeCount===1?ie=F:re===0?ie=N:(oe=N,ie=F);const[ue,pe]=Kh(s,this.shadowDirection,oe,ie,Ko.shadowMapResolution,k);Q.scale=s.scale,Q.matrix=ue,Q.boundingSphereRadius=pe,o.bi(q,Q.matrix),Q.frustum=o.cy.fromInvProjectionMatrix(q,1,0,!0),Q.far=ie}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ko.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ko.shadowMapResolution,this._uniformValues.u_shadowmap_0=ds.ShadowMap0,this._uniformValues.u_shadowmap_1=ds.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const X=g.transform.elevation;for(const re of this._groundShadowTiles){let Q={min:0,max:0};if(X){const oe=X.getMinMaxForTile(re);oe&&(Q=oe)}this.addShadowReceiver(re.toUnwrapped(),Q.min,Q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,u){if(!this.enabled)return;const g=this.painter,x=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),x.viewport.set([0,0,Ko.shadowMapResolution,Ko.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){g.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:o.am.white,depth:1});for(const T of s.order){const I=s._mergedLayers[T];if(!I.hasShadowPass()||I.isHidden(g.transform.zoom))continue;const k=s.getLayerSourceCache(I),N=k?u[k.id]:void 0;(I.type==="model"||N&&N.length)&&g.renderLayer(g,k,I,N)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,u=s.style,g=s.context,x=g.gl,w=u.directionalLight,T=u.ambientLight;if(!w||!T)return;const I=[],k=yl(s,s.longestCutoffRange);k.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const N=Bu(u,w,T),F=new Ht(x.LEQUAL,Ht.ReadOnly,s.depthRangeFor3D),q=new mr({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const V of this._groundShadowTiles){const X=V.toUnwrapped(),re=s.isTileAffectedByFog(V),Q=s.getOrCreateProgram("groundShadow",{defines:I,overrideFog:re});this.setupShadows(X,Q),s.uploadCommonUniforms(g,Q,X,null,k);const oe={u_matrix:s.transform.calculateProjMatrix(X),u_ground_shadow_factor:N};Q.draw(s,x.TRIANGLES,F,q,Mr.multiply,ur.disabled,oe,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Mr.unblended:Mr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const u=this.painter.transform,g=u.calculatePosMatrix(s,u.worldSize);return o.az(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){return o.az(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,u,g){if(!this.enabled)return;const x=this.painter.transform,w=this.painter.context,T=w.gl,I=this._uniformValues,k=new Float64Array(16),N=x.calculatePosMatrix(s,x.worldSize);for(let F=0;F<this._cascades.length;F++)o.az(k,this._cascades[F].matrix,N),I[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),w.activeTexture.set(T.TEXTURE0+ds.ShadowMap0+F),this._cascades[F].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!g,this.useNormalOffset){const F=o.d4(s.canonical),q=2/x.tileSize*o.aj/Ko.shadowMapResolution,V=q*this._cascades[0].boundingSphereRadius,X=q*this._cascades[this._cascades.length-1].boundingSphereRadius,re=(g==="vector-tile"?1:3)*function(Q,oe,ie,ue,pe){const ge=o.ay((Q-22)/-22,0,1);return .125*(1-ge)+4*ge}(x.zoom);I.u_shadow_normal_offset=[F,V*re,X*re],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(w,I)}setupShadowsFromMatrix(s,u,g=!1){if(!this.enabled)return;const x=this.painter.context,w=x.gl,T=this._uniformValues,I=new Float64Array(16);for(let k=0;k<Ko.cascadeCount;k++)o.az(I,this._cascades[k].matrix,s),T[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(w.TEXTURE0+ds.ShadowMap0+k),this._cascades[k].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=g,g){const k=Ko.normalOffset;T.u_shadow_normal_offset=[1,k,k],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(x,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,u,g,x){if(x[2]>=0)return{};const w=function(k,N,F){const q=F/(1<<k.canonical.z);return new o.d6([k.canonical.x*q+k.wrap*F,k.canonical.y*q+k.wrap*F,0],[(k.canonical.x+1)*q+k.wrap*F,(k.canonical.y+1)*q+k.wrap*F,N])}(s,u,g).getCorners(),T=u/-x[2];x[0]<0?(o.d5(w[0],w[0],[x[0]*T,0,0]),o.d5(w[3],w[3],[x[0]*T,0,0])):x[0]>0&&(o.d5(w[1],w[1],[x[0]*T,0,0]),o.d5(w[2],w[2],[x[0]*T,0,0])),x[1]<0?(o.d5(w[0],w[0],[0,x[1]*T,0]),o.d5(w[1],w[1],[0,x[1]*T,0])):x[1]>0&&(o.d5(w[2],w[2],[0,x[1]*T,0]),o.d5(w[3],w[3],[0,x[1]*T,0]));const I={};return I.vertices=w,I.planes=[zc(w[1],w[0],w[4]),zc(w[2],w[1],w[5]),zc(w[3],w[2],w[6]),zc(w[0],w[3],w[7])],I}addShadowReceiver(s,u,g){this._receivers.add(s,o.d6.fromTileIdAndHeight(s,u,g))}getMaxCascadeForTile(s){const u=this._receivers.get(s);return u&&u.lastCascade?u.lastCascade:0}}function zc(m,s,u){const g=o.at([],u,s),x=o.at([],m,s),w=o.bF([],g,x),T=o.ae(w);return T===0?[0,0,1,0]:(o.c1(w,w,1/T),[w[0],w[1],w[2],-o.bG(w,s)])}function Xh(m){const s=m.properties.get("direction"),u=o.d1(s.x,s.y,s.z);u[2]=o.ay(u[2],0,75);const g=o.d3([u[0],u[1],u[2]]);return o.d2(g.x,g.y,g.z)}function Bu(m,s,u){const g=s.properties.get("color-use-theme")==="none",x=s.properties.get("color"),w=s.properties.get("intensity"),T=s.properties.get("direction"),I=[T.x,T.y,T.z],k=u.properties.get("color-use-theme")==="none",N=u.properties.get("color"),F=u.properties.get("intensity"),q=Math.max(o.bG([0,0,1],I),0),V=[0,0,0];o.c1(V,N.toPremultipliedRenderColor(k?null:m.getLut(s.scope)).toArray01Linear().slice(0,3),F);const X=[0,0,0];return o.c1(X,x.toPremultipliedRenderColor(g?null:m.getLut(u.scope)).toArray01Linear().slice(0,3),q*w),o.d8([V[0]>0?V[0]/(V[0]+X[0]):0,V[1]>0?V[1]/(V[1]+X[1]):0,V[2]>0?V[2]/(V[2]+X[2]):0])}function Kh(m,s,u,g,x,w){const T=m.zoom,I=m.scale,k=m.worldSize,N=1/k,F=m.aspect,q=Math.sqrt(1+F*F)*Math.tan(.5*m.fovX),V=q*q,X=g-u,re=g+u;let Q,oe;V>X/re?(Q=g,oe=g*q):(Q=.5*re*(1+V),oe=.5*Math.sqrt(X*X+2*(g*g+u*u)*V+re*re*V*V));const ie=m.projection.pixelsPerMeter(m.center.lat,k),ue=m._camera.getCameraToWorldMercator(),pe=[0,0,-Q*N];o.ad(pe,pe,ue);let ge=oe*N;const be=m._edgeInsets;if(!(be.left===0&&be.top===0&&be.right===0&&be.bottom===0||be.left===be.right&&be.top===be.bottom)){const yt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ie:1),vt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,u,g);vt[8]=2*-m.centerOffset.x/m.width,vt[9]=2*m.centerOffset.y/m.height;const bt=new Float64Array(16);o.cM(bt,vt,yt);const Dt=new Float64Array(16);o.bi(Dt,bt);const Jt=o.cy.fromInvProjectionMatrix(Dt,k,T,!0);for(const or of Jt.points){const $t=((Ae=or)[0]/=I,Ae[1]/=I,Ae[2]=o.cb(Ae[2],m._center.lat),Ae);ge=Math.max(ge,o.c2(o.d7([],pe,$t)))}}var Ae;ge*=x/(x-1);const Ie=Math.acos(s[2]),we=Math.atan2(-s[0],-s[1]),Se=new Ia;Se.position=pe,Se.setPitchBearing(Ie,we);const Te=Se.getWorldToCamera(k,ie),We=ge*k,je=Math.min(m._mercatorZfromZoom(17)*k*-2,-2*We),ht=Se.getCameraToClipOrthographic(-We,We,-We,We,je,(We+w*ie)/s[2]),tt=new Float64Array(16);o.az(tt,ht,Te);const ft=o.d2(Math.floor(1e6*pe[0])/1e6*k,Math.floor(1e6*pe[1])/1e6*k,0),Pt=.5*x,qe=[0,0,0];o.ad(qe,ft,tt),o.c1(qe,qe,Pt);const De=[Math.floor(qe[0]),Math.floor(qe[1]),Math.floor(qe[2])],st=[0,0,0];o.at(st,qe,De),o.c1(st,st,-1/Pt);const Xe=new Float64Array(16);return o.bx(Xe),o.bo(Xe,Xe,st),o.az(tt,Xe,tt),[tt,We]}class y1 extends o.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(s,u){return o.aS(this.requestManager.transformRequest(u,o.R.Model).url).then(g=>{if(!g)return;const x=o.aT(g),w=new o.aU(s,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w}).catch(g=>{if(g&&g.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${s} from ${u}: ${g.message}`)))})}load(s,u,g={forceReload:!1}){this.models[u]||(this.models[u]={});const x=Object.keys(s),w=[],T=[];for(const I of x){const k=s[I];this.hasURLBeenRequested(k)&&!g.forceReload||(this.modelByURL[k]={modelId:I,scope:u},w.push(this.loadModel(I,k)),T.push(I)),this.models[u][I]||(this.models[u][I]={model:null,numReferences:1})}this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+T.length,Promise.allSettled(w).then(I=>{for(let k=0;k<I.length;k++){const{status:N}=I[k];if(N==="rejected")continue;const{value:F}=I[k];this.models[u][T[k]]||(this.models[u][T[k]]={model:null,numReferences:1}),this.models[u][T[k]].model=F}this.numModelsLoading[u]-=T.length,this.fire(new o.A("data",{dataType:"style"}))}).catch(I=>{this.fire(new o.z(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,u,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(s,u):this.getModelByURL(this.modelUris[u][s]))}getModel(s,u){return this.models[u]||(this.models[u]={}),this.models[u][s]?this.models[u][s].model:void 0}getModelByURL(s){if(!s)return null;const u=this.modelByURL[s];return u?this.models[u.scope][u.modelId].model:null}hasModelBeenAdded(s,u){return this.models[u]&&this.models[u][s]!==void 0}getModelURIs(s){return this.modelUris[s]||{}}addModel(s,u,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const x=this.requestManager.normalizeModelURL(u);if((this.hasModel(s,g,{exactIdMatch:!0})||this.hasModelBeenAdded(s,g))&&this.modelUris[g][s]===x)this.models[g][s].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:w,modelId:T}=this.modelByURL[x];this.models[w][T].numReferences++}else this.modelUris[g][s]=x,this.load({[s]:this.modelUris[g][s]},g)}addModelURLs(s,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const g=this.modelUris[u];for(const x in s)g[x]=this.requestManager.normalizeModelURL(s[x])}reloadModels(s){this.load(this.modelUris[s],s,{forceReload:!0})}addModelsFromBucket(s,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const g={};for(const x of s)this.hasModel(x,u,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[u][x].numReferences++:this.modelUris[u][x]&&!this.hasURLBeenRequested(x)?g[x]=this.modelUris[u][x]:!this.hasURLBeenRequested(x)&&o.d9(x,!1)&&(this.modelUris[u][x]=this.requestManager.normalizeModelURL(x),g[x]=this.modelUris[u][x]);this.load(g,u)}hasURLBeenRequested(s){return this.modelByURL[s]!==void 0}removeModel(s,u,g=!1,x=!1){if(this.models[u]&&this.models[u][s]&&(this.models[u][s].numReferences--,this.models[u][s].numReferences===0||x)){const w=this.modelUris[u][s];g||delete this.modelUris[u][s],delete this.modelByURL[w];const T=this.models[u][s].model;if(!T)return;delete this.models[u][s],T.destroy()}}destroy(){for(const s of Object.keys(this.models))for(const u of Object.keys(this.models[s])){const g=this.models[s][u].model;delete this.models[s][u],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,u){this.models[u]||(this.models[u]={});for(const g in this.models[u])this.models[u][g].model&&this.models[u][g].model.upload(s.context)}}const Zm=new o.a7({data:new o.a8(o.a5.colorTheme.data)});class kv{constructor(s){this._scope=s,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(s){const u=this._makeBuildingsQueryArea(s),g=this._makeFloorsQueryArea(s),x=s.queryRenderedFeatures(u,this._buildingQueryParams).filter(I=>I.properties.shape_type==="building").reduce((I,k)=>{const N=k.properties.id;return k.properties.shape_type!=="building"||I.some(F=>F.properties.id===N)||I.push(k),I},[]),w=s.queryRenderedFeatures(g,this._floorQueryParams).filter(I=>I.properties.shape_type==="floor").reduce((I,k)=>{const N=k.properties.id;return k.properties.shape_type!=="floor"||I.some(F=>F.properties.id===N)||I.push(k),I},[]),T=[s.getCenter().lng,s.getCenter().lat];return{floors:w,building:this._findBuildingAtCenter(T,x)||(x.length>0?x[0]:null)}}_makeBuildingsQueryArea(s){const u=s.transform.width,g=s.transform.height,x=Math.min(u,g),w=x*(1/8),T=x*(1/8),I=.5*(u-w),k=.5*(g-T);return[new o.P(I,k),new o.P(I+w,k+T)]}_makeFloorsQueryArea(s){const u=s.transform.width,g=s.transform.height,x=u*(2/3),w=g*(2/3),T=.5*(u-x),I=.5*(g-w);return[new o.P(T,I),new o.P(T+x,I+w)]}_findBuildingAtCenter(s,u){for(const g of u)if(g.geometry.type==="Polygon"&&this._pointInPolygon(s,g.geometry.coordinates[0]))return g;return null}_pointInPolygon(s,u){let g=!1;for(let x=0,w=u.length-1;x<u.length;w=x++){const T=u[x][0],I=u[x][1],k=u[w][1];I>s[1]!=k>s[1]&&s[0]<(u[w][0]-T)*(s[1]-I)/(k-I)+T&&(g=!g)}return g}}class Fc{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(s){this._selectedBuildingId=s}setFloors(s){if(this._floors=s.filter(u=>u.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(u=>u.properties.id).includes(this._selectedFloorId)){const u=this._floors.map(g=>({id:g.properties.id,level:g.properties.floor_level})).reduce((g,x)=>{const w=Math.abs(g.level-1),T=Math.abs(x.level-1);return T<w||T===w&&x.level>g.level?x:g});this._selectedFloorId=u.id}}setFloorId(s){this._selectedFloorId=s}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const gC={"mbx-indoor-level-selected":{default:["literal",[]]}};function _1(m){return m=m||{},Object.assign(m,gC)}class yC extends o.E{constructor(s){super(),o.aV(["_onLoad","_onMove"],this),this._map=s,this._floorSelectionState=new Fc,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(s=>{s.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=s.scope,this._indoorDataQuery=new kv(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const s=this._indoorDataQuery.execute(this._map);s&&s.floors.length!==0?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(s)):this._clearIndoorData()}_selectFloors(s){if(s.building)this._floorSelectionState.setBuildingId(s.building.properties.id),this._floorSelectionState.setFloors(s.floors),this._updateUI();else{const u=this._floorSelectionState.getSelectedFloorId();if(u&&s.floors.some(g=>g.properties.id===u))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const s=this._floorSelectionState.getCurrentBuildingFloors().map(g=>({id:g.properties.id,name:g.properties.name,shortName:g.properties.floor_level,levelOrder:g.properties.floor_level})),u=this._floorSelectionState.getSelectedFloorId();u?(this._updateIndoorConfig(),this.fire(new o.A("indoorupdate",{selectedFloorId:u,floors:s}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const s=this._floorSelectionState.getSelectedFloorId();s?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[s]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(s){this._floorSelectionState.setFloorId(s),this._updateIndoorConfig()}}function v1(m){if(!m.metadata||!m.metadata.content_area)return;const s=o.q.devicePixelRatio,{left:u,top:g,width:x,height:w}=m.metadata.content_area,T=u*s,I=g*s;return[T,I,T+x*s,I+w*s]}function x1(m){if(m)return m.map(([s,u])=>[s*o.q.devicePixelRatio,u*o.q.devicePixelRatio])}class Rv{constructor(s,u,g){this.id=s,this.scope=u,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(s){this.missingRequests.has(s.name)||this.pendingRequests.has(s.name)||this.pendingRequests.add(s.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const s=new Map;if(!this.sourceCache.loaded())return s;const u=this.sourceCache.getVisibleCoordinates();if(u.length===0)return s;const g=this.sourceCache.getSource();if(!(g instanceof Dc))return s;const x=u.map(T=>this.sourceCache.getTile(T)),w=g.getImages(x,Array.from(this.pendingRequests));for(const[T,I]of w)s.set(o.I.from({name:T,iconsetId:this.id}),I),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),s}}const Bc=(m,s)=>xe(m,s&&s.filter(u=>u.identifier!=="source.canvas")),b1=o.aF(nn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),w1=o.aF(nn,["setCenter","setZoom","setBearing","setPitch"]),Xm=new Set(["background","sky","slot","custom"]),$c={version:8,layers:[],sources:{}},Jf={duration:300,delay:0};class Ma extends o.E{constructor(s,u={}){super(),this.map=s,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=o.h({},Jf),this._buildingIndex=new c1(this),this.crossTileSymbolIndex=new Cs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new Pn,this.dispatcher=u.dispatcher?u.dispatcher:new o.D(o.db(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new Yr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new o.dc(s._requestManager,u.localFontFamily?o.dd.all:u.localIdeographFontFamily?o.dd.ideographs:o.dd.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new y1(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:u.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",o.de());const g=this;this._rtlTextPluginCallback=Ma.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,T)=>{if(o.df(w),T&&T.every(I=>I))for(const I in g._sourceCaches){const k=g._sourceCaches[I],N=k.getSource().type;N!=="vector"&&N!=="geojson"||k.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(const T in this._layers){const I=this._layers[T];I.source===w.id&&this._validateLayer(I)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(o.j(s))return s;const u=o.dg(s);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${o.dh(JSON.stringify(s))}`}_diffStyle(s,u,g){this.globalId=this._getGlobalId(s);const x=(w,T)=>{try{T(null,this.setState(w,g))}catch(I){T(I,!1)}};if(typeof s=="string"){const w=this.map._requestManager.normalizeStyleURL(s),T=this.map._requestManager.transformRequest(w,o.R.Style);o.n(T,(I,k)=>{I?this.fire(new o.z(I)):k&&x(k,u)})}else typeof s=="object"&&x(s,u)}loadURL(s,u={}){this.fire(new o.A("dataloading",{dataType:"style"}));const g=typeof u.validate=="boolean"?u.validate:!o.j(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,u.accessToken),this.resolvedImports.add(s);const x=this.importsCache.get(s);if(x)return this._load(x,g);const w=this.map._requestManager.transformRequest(s,o.R.Style);this._request=o.n(w,(T,I)=>{if(this._request=null,T)this.fire(new o.z(T));else if(I)return this.importsCache.set(s,I),this._load(I,g)})}loadJSON(s,u={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=o.q.frame(()=>{this._request=null,this._load(s,u.validate!==!1)})}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load($c,!1)}_loadImports(s,u,g){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const w of s){const T=this._createFragmentStyle(w),I=new Promise(F=>{T.once("style.import.load",F),T.once("error",F)}).then(()=>this.mergeAll());if(x.push(I),this.resolvedImports.has(w.url)){T.loadEmpty();continue}const k=w.data||this.importsCache.get(w.url);k?(T.loadJSON(k,{validate:u}),this._isInternalStyle(k)&&(T.globalId=null)):w.url?T.loadURL(w.url,{validate:u}):T.loadEmpty();const N={style:T,id:w.id,config:w.config};if(g){const F=this.fragments.findIndex(({id:q})=>q===g);this.fragments=this.fragments.slice(0,F).concat(N).concat(this.fragments.slice(F))}else this.fragments.push(N)}return Promise.allSettled(x)}getImportGlobalIds(s=this,u=new Set){for(const g of s.fragments)g.style.globalId&&u.add(g.style.globalId),this.getImportGlobalIds(g.style,u);return[...u.values()]}_createFragmentStyle(s){const u=this.scope?o.C(s.id,this.scope):s.id;let g;const x=this._initialConfig&&this._initialConfig[u];(s.config||x)&&(g=o.h({},s.config,x));const w=new Ma(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,u){const g=s.indoor?_1(s.schema):s.schema;if(this._isInternalStyle(s)){const T=o.h({},$c,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(T,u)}if(this.updateConfig(this._config,g),u&&Bc(this,Es(s)))return;this._loaded=!0,this.stylesheet=o.di(s);const x=()=>{for(const N in s.sources)this.addSource(N,s.sources[N],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const N in s.iconsets)this.addIconset(N,s.iconsets[N]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&s.glyphs&&this.glyphManager.setURL(s.glyphs);const T=zf(this.stylesheet.layers);if(this._order=T.map(N=>N.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const N=this.stylesheet.lights[0];this.light=new rt(N.properties,N.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new rt(this.stylesheet.light)),this._layers={};for(const N of T){const F=o.dn(N,this.scope,this._styleColorTheme.lut,this.options);F.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const q=this.getOwnLayerSourceCache(F),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();q&&F.canCastShadows()&&V&&(q.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const k=this.isRootStyle();s.imports?this._loadImports(s.imports,u).then(()=>{this._reloadImports(),this.fire(new o.A(k?"style.load":"style.import.load"))}).catch(N=>{this.fire(new o.z(new Error("Failed to load imports",N))),this.fire(new o.A(k?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.A(k?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const w=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(w){const T=this._evaluateColorThemeData(w);this._loadColorTheme(T).then(()=>{x()}).catch(I=>{o.w(`Couldn't load color theme from the stylesheet: ${I}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,u,g,x,w,T,I,k,N,F;const q={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(V=>{if(V.stylesheet){if(V.light!=null&&(s=V.light),V.stylesheet.lights)for(const X of V.stylesheet.lights)X.type==="ambient"&&V.ambientLight!=null&&(u=V.ambientLight),X.type==="directional"&&V.directionalLight!=null&&(g=V.directionalLight);x=this._prioritizeTerrain(x,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(w=V.fog),V.stylesheet.snow&&V.snow!=null&&(T=V.snow),V.stylesheet.rain&&V.rain!=null&&(I=V.rain),V.stylesheet.camera!=null&&(F=V.stylesheet.camera),V.stylesheet.projection!=null&&(k=V.stylesheet.projection),V.stylesheet.transition!=null&&(N=V.stylesheet.transition),q[V.scope]=V._styleColorTheme}}),this.light=s,this.ambientLight=u,this.directionalLight=g,this.fog=w,this.snow=T,this.rain=I,this._styleColorThemeForScope=q,x===null?delete this.terrain:this.terrain=x,this.camera=F||{"camera-projection":"perspective"},this.projection=k||{name:"mercator"},this.transition=o.h({},Jf,N),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){const u=g=>{for(const x of g.fragments)u(x.style);s(g)};u(this)}_prioritizeTerrain(s,u,g){const x=s&&s.drapeRenderMode===0;return g===null?u&&u.drapeRenderMode===0?u:x?s:null:u!=null&&(!s||x||u&&u.drapeRenderMode===1)?u:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{s=this._prioritizeTerrain(s,u.terrain,u.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(s=u.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},u={},g={};this.forEachFragmentStyle(x=>{for(const w in x._sourceCaches){const T=o.C(w,x.scope);s[T]=x._sourceCaches[w]}for(const w in x._otherSourceCaches){const T=o.C(w,x.scope);u[T]=x._otherSourceCaches[w]}for(const w in x._symbolSourceCaches){const T=o.C(w,x.scope);g[T]=x._symbolSourceCaches[w]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=g}mergeLayers(){const s={},u=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const T of w._order){const I=w._layers[T];if(I.type==="slot"){const k=o.dj(T);if(s[k])continue;s[k]=[]}I.slot&&s[I.slot]?s[I.slot].push(I):u.push(I)}}),this._mergedOrder=[];const x=(w=[])=>{for(const T of w)if(T.type==="slot"){const I=o.dj(T.id);s[I]&&x(s[I]),this._mergedSlots.push(I)}else{const I=o.C(T.id,T.scope);this._mergedOrder.push(I),g[I]=T,T.is3D(!!this.terrain)&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};x(u),this._mergedOrder.sort((w,T)=>{const I=g[w],k=g[T];return I.hasInitialOcclusionOpacityProperties?k.is3D(!!this.terrain)?1:0:I.is3D(!!this.terrain)&&k.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=o.h({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(u,g,x,w){const T=o.h({},g);for(const k of Object.keys(o.a5.colorTheme))T[k]===void 0&&(T[k]=o.a5.colorTheme[k].default);const I=new o.a6(Zm,u,new Map(x));return I.setTransitionOrValue(T,x),I.untransitioned().possiblyEvaluate(new o.aa(0,{worldview:void 0}))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,x)=>{const w="data:image/png;base64,";if(!s||s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let T=s;T.startsWith(w)||(T=w+T);const I=o.I.from("mapbox-reserved-lut"),k=new Image;k.src=T,k.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},k.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void g();this._styleColorTheme.lutLoading=!1;const{width:N,height:F,data:q}=o.q.getImageData(k);if(F>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==F*F)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new o.r({width:N,height:F},q),pixelRatio:1,sdf:!1,usvg:!1,version:0});const V=this.imageManager.getImage(I,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:s},g()):x(new Error("Missing LUT image."))}})}getLut(s){const u=this._styleColorThemeForScope[s];return u?u.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(u,g,x){let w,T,I;const k=o.q.devicePixelRatio>1?"@2x":"";let N=o.n(g.transformRequest(g.normalizeSpriteURL(u,k,".json"),o.R.SpriteJSON),(V,X)=>{N=null,I||(I=V,w=X,q())}),F=o.o(g.transformRequest(g.normalizeSpriteURL(u,k,".png"),o.R.SpriteImage),(V,X)=>{F=null,I||(I=V,T=X,q())});function q(){if(I)x(I);else if(w&&T){const V=o.q.getImageData(T),X={};for(const re in w){const{width:Q,height:oe,x:ie,y:ue,sdf:pe,pixelRatio:ge,stretchX:be,stretchY:Ae,content:Ie}=w[re],we=new o.r({width:Q,height:oe});o.r.copy(V,we,{x:ie,y:ue},{x:0,y:0},{width:Q,height:oe},null),X[re]={data:we,pixelRatio:ge,sdf:pe,stretchX:be,stretchY:Ae,content:Ie,usvg:!1}}x(null,X)}}return{cancel(){N&&(N.cancel(),N=null),F&&(F.cancel(),F=null)}}}(s,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new o.z(u));else if(g){const x=new Map;for(const w in g)x.set(o.I.from(w),g[w]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))})}addIconset(s,u){if(u.type==="sprite")return void this._loadSprite(u.url);const g=this.getOwnSourceCache(u.source);if(!g)return void this.fire(new o.z(new Error(`Source "${u.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));const x=g.getSource();if(x.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${u.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const w=new Rv(s,this.scope,g);this.imageManager.addImageProvider(w,this.scope)}removeIconset(s){this.imageManager.removeImageProvider(s,this.scope)}_loadIconset(s){if(!o.j(s)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(s);const u=this.map._spriteFormat==="auto";var g,x;this._spriteRequest=(x=(w,T)=>{if(this._spriteRequest=null,w)u?this._loadSprite(s):this.fire(new o.z(w));else if(T){const I=new Map;for(const k in T)I.set(o.I.from(k),T[k]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(s),o.R.Iconset),(w,T)=>{if(w)return void x(w);const I={},k=o.da(new o.bq(T));for(const N of k.icons){const F={version:1,pixelRatio:o.q.devicePixelRatio,content:v1(N),stretchX:N.metadata?x1(N.metadata.stretch_x_areas):void 0,stretchY:N.metadata?x1(N.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:N};I[N.name]=F}x(null,I)}))}_validateLayer(s){const u=this.getOwnSource(s.source);if(!u)return;const g=s.sourceLayer;g&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(g)===-1)&&this.fire(new o.z(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,u)=>{const g=this.fragments[u];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){const s={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){const u=[];for(const g of s){const x=this._layers[g];x&&x.type!=="custom"&&u.push(x.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const u=this.getOwnLayer(s);if(u)return u;this.fire(new o.z(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const u=this.getOwnSource(s);if(u)return u;this.fire(new o.z(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,u){const g=this.map.painter;if(g)for(let x=s.minzoom||0;x<(s.maxzoom||25.5);x++){const w=s.getProgramIds();if(w)for(const T of w){const I=s.getDefaultProgramParams(T,u.zoom,this._styleColorTheme.lut);I&&(g.style=this,this.fog&&(g._fogVisible=!0,I.overrideFog=!0,g.getOrCreateProgram(T,I)),g._fogVisible=!1,I.overrideFog=!1,g.getOrCreateProgram(T,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,g.getOrCreateProgram(T,I)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const u=this.calculateLightsBrightness();s.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u)),s.worldview!==this._worldview&&(this._worldview=s.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const g=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const k in I){const{updatedIds:N,removedIds:F}=I[k];(N||F)&&(this._updateWorkerLayers(k,N,F),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const w={};for(const I in this._mergedSourceCaches){const k=this._mergedSourceCaches[I];w[I]=k.used,k.used=!1,k.tileCoverLift=0}for(const I of this._mergedOrder){const k=this._mergedLayers[I];if(k.recalculate(s,this._availableImages),!k.isHidden(s.zoom)){const N=this.getLayerSourceCache(k);N&&(N.used=!0,N.tileCoverLift=Math.max(N.tileCoverLift,k.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(k,s)}):this.precompilePrograms(k,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const I of T)I.sourceCache.used=!0;for(const I in w){const k=this._mergedSourceCaches[I];w[I]!==k.used&&k.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const s=this.imageManager.getPendingImageProviders();for(const u of s){const g=u.resolvePendingRequests(),x=this.getFragmentStyle(u.scope);x&&x.addImages(g)}}_updateTilesForChangedImages(){const s={};for(const u in this._mergedSourceCaches){const g=this._mergedSourceCaches[u].getSource().scope;s[g]=s[g]||this._changes.getUpdatedImages(g),s[g].length!==0&&this._mergedSourceCaches[u].reloadTilesForDependencies(["icons","patterns"],s[g])}for(const u in s)this._changes.resetUpdatedImages(u)}_updateWorkerLayers(s,u,g){const x=this.getFragmentStyle(s);x&&this.dispatcher.broadcast("updateLayers",{layers:u?x._serializeLayers(u):[],scope:s,removedIds:g||[],options:x.options})}setState(s,u){if(this._checkLoaded(),Bc(this,Es(s)))return!1;(s=o.di(s)).layers=zf(s.layers);const g=function(T,I){if(!T)return[{command:nn.setStyle,args:[I]}];let k=[];try{if(!o.bv(T.version,I.version))return[{command:nn.setStyle,args:[I]}];if(o.bv(T.center,I.center)||k.push({command:nn.setCenter,args:[I.center]}),o.bv(T.zoom,I.zoom)||k.push({command:nn.setZoom,args:[I.zoom]}),o.bv(T.bearing,I.bearing)||k.push({command:nn.setBearing,args:[I.bearing]}),o.bv(T.pitch,I.pitch)||k.push({command:nn.setPitch,args:[I.pitch]}),o.bv(T.sprite,I.sprite)||k.push({command:nn.setSprite,args:[I.sprite]}),o.bv(T.glyphs,I.glyphs)||k.push({command:nn.setGlyphs,args:[I.glyphs]}),o.bv(T.imports,I.imports)||function(X=[],re=[],Q){re=re||[];const oe=(X=X||[]).map(Lu),ie=re.map(Lu),ue=X.reduce(Lc,{}),pe=re.reduce(Lc,{}),ge=oe.slice();let be,Ae,Ie,we;for(be=0,Ae=0;be<oe.length;be++)Ie=oe[be],pe.hasOwnProperty(Ie)?Ae++:(Q.push({command:nn.removeImport,args:[Ie]}),ge.splice(ge.indexOf(Ie,Ae),1));for(be=0,Ae=0;be<ie.length;be++)Ie=ie[ie.length-1-be],ge[ge.length-1-be]!==Ie&&(ue.hasOwnProperty(Ie)?(Q.push({command:nn.removeImport,args:[Ie]}),ge.splice(ge.lastIndexOf(Ie,ge.length-Ae),1)):Ae++,we=ge[ge.length-be],Q.push({command:nn.addImport,args:[pe[Ie],we]}),ge.splice(ge.length-be,0,Ie));for(const Se of re){const Te=ue[Se.id];Te&&(delete Te.data,o.bv(Te,Se)||Q.push({command:nn.updateImport,args:[Se.id,Se]}))}}(T.imports,I.imports,k),o.bv(T.transition,I.transition)||k.push({command:nn.setTransition,args:[I.transition]}),o.bv(T.light,I.light)||k.push({command:nn.setLight,args:[I.light]}),o.bv(T.fog,I.fog)||k.push({command:nn.setFog,args:[I.fog]}),o.bv(T.snow,I.snow)||k.push({command:nn.setSnow,args:[I.snow]}),o.bv(T.rain,I.rain)||k.push({command:nn.setRain,args:[I.rain]}),o.bv(T.projection,I.projection)||k.push({command:nn.setProjection,args:[I.projection]}),o.bv(T.lights,I.lights)||k.push({command:nn.setLights,args:[I.lights]}),o.bv(T.camera,I.camera)||k.push({command:nn.setCamera,args:[I.camera]}),o.bv(T.iconsets,I.iconsets)||function(X,re,Q){let oe;for(oe in re=re||{},X=X||{})X.hasOwnProperty(oe)&&(re.hasOwnProperty(oe)||Q.push({command:nn.removeIconset,args:[oe]}));for(oe in re){if(!re.hasOwnProperty(oe))continue;const ie=re[oe];X.hasOwnProperty(oe)?o.bv(X[oe],ie)||(Q.push({command:nn.removeIconset,args:[oe]}),Q.push({command:nn.addIconset,args:[oe,ie]})):Q.push({command:nn.addIconset,args:[oe,ie]})}}(T.iconsets,I.iconsets,k),!o.bv(T["color-theme"],I["color-theme"]))return[{command:nn.setStyle,args:[I]}];const N={},F=[];(function(X,re,Q,oe){let ie;for(ie in re=re||{},X=X||{})X.hasOwnProperty(ie)&&(re.hasOwnProperty(ie)||$h(ie,Q,oe));for(ie in re){if(!re.hasOwnProperty(ie))continue;const ue=re[ie];X.hasOwnProperty(ie)?o.bv(X[ie],ue)||(X[ie].type==="geojson"&&ue.type==="geojson"&&dC(X,re,ie)?Q.push({command:nn.setGeoJSONSourceData,args:[ie,ue.data]}):Ff(ie,re,Q,oe)):Vm(ie,re,Q)}})(T.sources,I.sources,F,N);const q=[];T.layers&&T.layers.forEach(X=>{X.source&&N[X.source]?k.push({command:nn.removeLayer,args:[X.id]}):q.push(X)});let V=T.terrain;V&&N[V.source]&&(k.push({command:nn.setTerrain,args:[void 0]}),V=void 0),k=k.concat(F),o.bv(V,I.terrain)||k.push({command:nn.setTerrain,args:[I.terrain]}),function(X,re,Q){re=re||[];const oe=(X=X||[]).map(Lu),ie=re.map(Lu),ue=X.reduce(Lc,{}),pe=re.reduce(Lc,{}),ge=oe.slice(),be=Object.create(null);let Ae,Ie,we,Se,Te,We,je;for(Ae=0,Ie=0;Ae<oe.length;Ae++)we=oe[Ae],pe.hasOwnProperty(we)?Ie++:(Q.push({command:nn.removeLayer,args:[we]}),ge.splice(ge.indexOf(we,Ie),1));for(Ae=0,Ie=0;Ae<ie.length;Ae++)we=ie[ie.length-1-Ae],ge[ge.length-1-Ae]!==we&&(ue.hasOwnProperty(we)?(Q.push({command:nn.removeLayer,args:[we]}),ge.splice(ge.lastIndexOf(we,ge.length-Ie),1)):Ie++,We=ge[ge.length-Ae],Q.push({command:nn.addLayer,args:[pe[we],We]}),ge.splice(ge.length-Ae,0,we),be[we]=!0);for(Ae=0;Ae<ie.length;Ae++)if(we=ie[Ae],Se=ue[we],Te=pe[we],!be[we]&&!o.bv(Se,Te))if(o.bv(Se.source,Te.source)&&o.bv(Se["source-layer"],Te["source-layer"])&&o.bv(Se.type,Te.type)){for(je in Bf(Se.layout,Te.layout,Q,we,null,nn.setLayoutProperty),Bf(Se.paint,Te.paint,Q,we,null,nn.setPaintProperty),o.bv(Se.slot,Te.slot)||Q.push({command:nn.setSlot,args:[we,Te.slot]}),o.bv(Se.filter,Te.filter)||Q.push({command:nn.setFilter,args:[we,Te.filter]}),o.bv(Se.minzoom,Te.minzoom)&&o.bv(Se.maxzoom,Te.maxzoom)||Q.push({command:nn.setLayerZoomRange,args:[we,Te.minzoom,Te.maxzoom]}),Se)Se.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Bf(Se[je],Te[je],Q,we,je.slice(6),nn.setPaintProperty):o.bv(Se[je],Te[je])||Q.push({command:nn.setLayerProperty,args:[we,je,Te[je]]}));for(je in Te)Te.hasOwnProperty(je)&&!Se.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Bf(Se[je],Te[je],Q,we,je.slice(6),nn.setPaintProperty):o.bv(Se[je],Te[je])||Q.push({command:nn.setLayerProperty,args:[we,je,Te[je]]}))}else Q.push({command:nn.removeLayer,args:[we]}),We=ge[ge.lastIndexOf(we)+1],Q.push({command:nn.addLayer,args:[Te,We]})}(q,I.layers,k)}catch(N){console.warn("Unable to compute style diff:",N),k=[{command:nn.setStyle,args:[I]}]}return k}(this.serialize(),s).filter(T=>!(T.command in w1));if(g.length===0)return!1;const x=g.filter(T=>!(T.command in b1));if(x.length>0)throw new Error(`Unimplemented: ${x.map(T=>T.command).join(", ")}.`);const w=[];return g.forEach(T=>{w.push(this[T.command](...T.args))}),u&&Promise.all(w).then(u).catch(u),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(s){if(s.size===0)return this;for(const[u,g]of s.entries()){if(this.getImage(u))return this.fire(new o.z(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,this.scope,g),this._changes.updateImage(u,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(s,u){return this.getImage(s)?this.fire(new o.z(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,this.scope,u),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(s,u,g=!1){this.imageManager.updateImage(s,this.scope,u),g&&(this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(s){return this.modelManager.addModelURLs(s,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(s,u,g={}){return this._checkLoaded(),this._validate(ye,`models.${s}`,u,null,g)||(this.modelManager.addModel(s,u,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope,!1,!0),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,u,g={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(Wl,`sources.${s}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const x=kf(s,u,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const w=T=>{const I=(T?"symbol:":"other:")+x.id,k=o.C(I,this.scope),N=this._sourceCaches[I]=new Ps(k,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=N,N.onAdd(this.map)};w(!1),u.type!=="vector"&&u.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const u=this.getOwnSource(s);if(!u)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===s)return this.fire(new o.z(new Error(`Source "${s}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new o.z(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([w,T])=>T.type==="source"&&T.source===s);if(x)return this.fire(new o.z(new Error(`Source "${s}" cannot be removed while iconset "${x[0]}" is using it.`)))}const g=this.getOwnSourceCaches(s);for(const x of g){const w=o.dj(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,u){this._checkLoaded(),this.getOwnSource(s).setData(u),this._changes.setDirty()}getOwnSource(s){const u=this.getOwnSourceCache(s);return u&&u.getSource()}getOwnSources(){const s=[];for(const u in this._otherSourceCaches){const g=this.getOwnSourceCache(u);g&&s.push(g.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const u in s){const g=s[u]._tiles;for(const x in g){const w=g[x];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const w of s){if(this._validate(Rc,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(w),T.updateTransitions(u)}else this.ambientLight=new jn(w,qr||(qr=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(w),T.updateTransitions(u)}else this.directionalLight=new jn(w,Ti||(Ti=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=Object.assign(u,{worldview:this.map.getWorldview()}),x=new o.aa(this.z||0,g);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,u=this.ambientLight;if(!s||!u)return;const g=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),x=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),w=s.properties.get("intensity"),T=s.properties.get("direction"),I=1-o.d1(T.x,T.y,T.z)[2]/90,k=g(x)*w*I,N=u.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=u.properties.get("intensity"),q=g(N)*F;return Number(((k+q)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(s==null||s===""&&this.isRootStyle())return this;if(o.dk(s)){const u=o.dl(s),g=this.fragments.find(({id:w})=>w===u);if(!g)return;const x=o.dj(s);return g.style.getFragmentStyle(x)}{const u=this.fragments.find(({id:g})=>g===s);return u?u.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const u={},g=(x,w="")=>`${x}::${w}`;this._featuresetSelectors={};for(const x in s){const w=this._featuresetSelectors[x]=[];for(const T of s[x].selectors){if(T.featureNamespace){const k=this.getOwnLayer(T.layer);if(!k){o.w(`Layer is undefined for selector: ${T.layer}`);continue}const N=g(k.source,k.sourceLayer);if(N in u&&u[N]!==T.featureNamespace){o.w(`"featureNamespace ${T.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}u[N]=T.featureNamespace}let I;if(T.properties)for(const k in T.properties){const N=o.X(T.properties[k]);N.result==="success"&&(I=I||{},I[k]=N.value)}w.push({layerId:T.layer,namespace:T.featureNamespace,properties:I,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const u=this.getFragmentStyle(s);if(!u||!u.stylesheet.featuresets)return[];const g=[];for(const x in u.stylesheet.featuresets)g.push({featuresetId:x,importId:u.scope?u.scope:void 0});return g}getFeaturesetLayers(s,u){const g=this.getFragmentStyle(u),x=g.stylesheet.featuresets;if(!x||!x[s])return this.fire(new o.z(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const T of x[s].selectors){const I=g.getOwnLayer(T.layer);I&&w.push(I)}return w}getConfigProperty(s,u){const g=this.getFragmentStyle(s);if(!g)return null;const x=o.C(u,g.scope),w=g.options.get(x),T=w?w.value||w.default:null;return T?T.serialize():null}setConfigProperty(s,u,g){const x=this.getFragmentStyle(s);if(!x)return;const w=x.stylesheet.indoor?_1(x.stylesheet.schema):x.stylesheet.schema;if(!w||!w[u])return;const T=o.X(g);if(T.result!=="success")return void Bc(this,T.value);const I=T.value.expression,k=o.C(u,x.scope),N=x.options.get(k);if(!N)return;let F;const{minValue:q,maxValue:V,stepValue:X,type:re,values:Q}=w[u],oe=o.X(w[u].default);oe.result==="success"&&(F=oe.value.expression),F?(this.options.set(k,Object.assign({},N,{value:I,default:F,minValue:q,maxValue:V,stepValue:X,type:re,values:Q})),this.updateConfigDependencies(u)):this.fire(new o.z(new Error(`No schema defined for the config option "${u}" in the "${s}" fragment.`)))}getConfig(s){const u=this.getFragmentStyle(s);if(!u)return null;const g=u.stylesheet.schema;if(!g)return null;const x={};for(const w in g){const T=o.C(w,u.scope),I=u.options.get(T),k=I?I.value||I.default:null;x[w]=k?k.serialize():null}return x}setConfig(s,u){const g=this.getFragmentStyle(s);g&&(g.updateConfig(u,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const u=this.getFragmentStyle(s);return u?u.stylesheet.schema:null}setSchema(s,u){const g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=u,g.updateConfig(g._config,u),this.updateConfigDependencies())}updateConfig(s,u){if(this._config=s,s||u)if(u)for(const g in u){let x,w;const T=o.X(u[g].default);if(T.result==="success"&&(x=T.value.expression),s&&s[g]!==void 0){const V=o.X(s[g]);V.result==="success"&&(w=V.value.expression)}const{minValue:I,maxValue:k,stepValue:N,type:F,values:q}=u[g];if(x){const V=o.C(g,this.scope);this.options.set(V,{default:x,value:w,minValue:I,maxValue:k,stepValue:N,type:F,values:q})}else this.fire(new o.z(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(s){for(const u of this._configDependentLayers){const g=this.getLayer(u);if(g){if(s&&!g.configDependencies.has(s))continue;g.possiblyEvaluateVisibility(),this._updateLayer(g)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(u=>{const g=u._styleColorTheme.colorThemeOverride?u._styleColorTheme.colorThemeOverride:u._styleColorTheme.colorTheme;if(g){const x=u._evaluateColorThemeData(g);(!u._styleColorTheme.lut&&x!==""||u._styleColorTheme.lut&&x!==u._styleColorTheme.lut.data)&&u.setColorTheme(g)}}),this._changes.setDirty()}addLayer(s,u,g={}){this._checkLoaded();const x=s.id;if(this._layers[x])return void this.fire(new o.z(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(s.type==="custom"){if(Bc(this,o.dm(s)))return;w=o.dn(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(x,s.source),s=o.di(s),s=o.h(s,{source:x})),this._validate(Br,`layers.${x}`,s,{arrayIndex:-1},g))return;w=o.dn(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}})}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let T=this._order.length;if(u){const F=this._order.indexOf(u);if(F===-1)return void this.fire(new o.z(new Error(`Layer with id "${u}" does not exist on this map.`)));w.slot===this._layers[u].slot?T=F:o.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const I=this.getOwnLayerSourceCache(w),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&w.canCastShadows()&&k&&(I.castsShadows=!0);const N=this._changes.getRemovedLayer(w);if(N&&w.source&&I&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const F=o.C(w.source,w.scope);N.type!==w.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),I.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(s,u){this._checkLoaded();const g=this._checkLayer(s);if(!g||s===u)return;const x=this._order.indexOf(s);this._order.splice(x,1);let w=this._order.length;if(u){const T=this._order.indexOf(u);if(T===-1)return void this.fire(new o.z(new Error(`Layer with id "${u}" does not exist on this map.`)));g.slot===this._layers[u].slot?w=T:o.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const u=this._checkLayer(s);if(!u)return;u.setEventedParent(null);const g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const x=this.getOwnLayerSourceCache(u);if(x&&x.castsShadows){let w=!1;for(const T in this._layers)if(this._layers[T].source===u.source&&this._layers[T].canCastShadows()){w=!0;break}x.castsShadows=w}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const u in this._layers)if(this._layers[u].type===s)return!0;return!1}setLayerZoomRange(s,u,g){this._checkLoaded();const x=this._checkLayer(s);x&&(x.minzoom===u&&x.maxzoom===g||(u!=null&&(x.minzoom=u),g!=null&&(x.maxzoom=g),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,u){this._checkLoaded();const g=this._checkLayer(s);g&&g.slot!==u&&(g.slot=u,this._updateLayer(g))}setFilter(s,u,g={}){this._checkLoaded();const x=this._checkLayer(s);if(x&&!o.bv(x.filter,u))return u==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(Ge,`layers.${x.id}.filter`,u,{layerType:x.type},g)||(x.filter=o.di(u),this._updateLayer(x)))}getFilter(s){const u=this._checkLayer(s);if(u)return o.di(u.filter)}setLayoutProperty(s,u,g,x={}){this._checkLoaded();const w=this._checkLayer(s);if(w&&!o.bv(w.getLayoutProperty(u),g)){if(g!=null&&(!x||x.validate!==!1)&&Bc(w,ce.call(Es,{key:`layers.${s}.layout.${u}`,layerType:w.type,objectKey:u,value:g,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(u,g),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(s,u){const g=this._checkLayer(s);if(g)return g.getLayoutProperty(u)}setPaintProperty(s,u,g,x={}){this._checkLoaded();const w=this._checkLayer(s);if(!w||o.bv(w.getPaintProperty(u),g)||g!=null&&(!x||x.validate!==!1)&&Bc(w,se.call(Es,{key:`layers.${s}.paint.${u}`,layerType:w.type,objectKey:u,value:g,styleSpec:o.a5})))return;const T=w.setPaintProperty(u,g);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),T&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(s,u){const g=this._checkLayer(s);if(g)return g.getPaintProperty(u)}setFeatureState(s,u){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:k,importId:N}=s.target,F=this.getFragmentStyle(N),q=F.getFeaturesetLayers(k);for(const{source:V,sourceLayer:X}of q)F.setFeatureState({id:s.id,source:V,sourceLayer:X},u)}else if("layerId"in s.target){const{layerId:k}=s.target,N=this.getLayer(k);this.setFeatureState({id:s.id,source:N.source,sourceLayer:N.sourceLayer},u)}return}const g=s.source,x=s.sourceLayer,w=this._checkSource(g);if(!w)return;const T=w.type;if(T==="geojson"&&x)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!x)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(g);for(const k of I)k.setFeatureState(x,s.id,u)}removeFeatureState(s,u){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:k,importId:N}=s.target,F=this.getFragmentStyle(N),q=F.getFeaturesetLayers(k);for(const{source:V,sourceLayer:X}of q)F.removeFeatureState({id:s.id,source:V,sourceLayer:X},u)}else if("layerId"in s.target){const{layerId:k}=s.target,N=this.getLayer(k);this.removeFeatureState({id:s.id,source:N.source,sourceLayer:N.sourceLayer},u)}return}const g=s.source,x=this._checkSource(g);if(!x)return;const w=x.type,T=w==="vector"?s.sourceLayer:void 0;if(w==="vector"&&!T)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(g);for(const k of I)k.removeFeatureState(T,s.id,u)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let w;if("featuresetId"in s.target){const{featuresetId:T,importId:I}=s.target,k=this.getFragmentStyle(I),N=k.getFeaturesetLayers(T);for(const{source:F,sourceLayer:q}of N){const V=k.getFeatureState({id:s.id,source:F,sourceLayer:q});if(V&&!w)w=V;else if(!o.bv(w,V))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:T}=s.target,I=this.getLayer(T);w=this.getFeatureState({id:s.id,source:I.source,sourceLayer:I.sourceLayer})}return w}const u=s.source,g=s.sourceLayer,x=this._checkSource(u);if(x){if(x.type!=="vector"||g)return s.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(g,s.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=o.h({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return o.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),u=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return o.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(s){for(const u of Object.values(this._mergedLayers))s(u)&&this._updateLayer(u)}_updateLayer(s){this._changes.updateLayer(s);const u=this.getLayerSourceCache(s),g=o.C(s.source,s.scope),x=this._changes.getUpdatedSourceCaches();s.source&&!x[g]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),u.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const u=I=>this._mergedLayers[I].is3D(!!this.terrain),g=this.order,x={},w=[];for(let I=g.length-1;I>=0;I--){const k=g[I];if(u(k)){x[k]=I;for(const N of s){const F=N[k];if(F)for(const q of F)w.push(q)}}}w.sort((I,k)=>k.intersectionZ-I.intersectionZ);const T=[];for(let I=g.length-1;I>=0;I--){const k=g[I];if(u(k))for(let N=w.length-1;N>=0;N--){const F=w[N].feature;if(F.layer&&x[F.layer.id]<I)break;T.push(F),w.pop()}else for(const N of s){const F=N[k];if(F)for(const q of F)T.push(q.feature)}}return T}queryRenderedFeatures(s,u,g){let x;u&&!Array.isArray(u)&&u.filter&&(this._validate(Ge,"queryRenderedFeatures.filter",u.filter,null,u),x=o.b3(u.filter));const w={},T=F=>{if(Xm.has(F.type))return;const q=this.getOwnLayerSourceCache(F),V=w[q.id]=w[q.id]||{sourceCache:q,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(V.has3DLayers=!0),V.layers[F.fqid]=V.layers[F.fqid]||{styleLayer:F,targets:[]},V.layers[F.fqid].targets.push({filter:x})};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const F of u.layers){const q=this._layers[F];if(!q)return this.fire(new o.z(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];T(q)}}else for(const F in this._layers)T(this._layers[F]);const I=this._queryRenderedFeatures(s,w,g),k=this._flattenAndSortRenderedFeatures(I),N=[];for(const F of k)o.dq(F.layer.id)===this.scope&&N.push(F);return N}queryRenderedFeatureset(s,u,g){let x;u&&!Array.isArray(u)&&u.filter&&(this._validate(Ge,"queryRenderedFeatures.filter",u.filter,null,u),x=o.b3(u.filter));const w="mock",T=[];if(u&&u.target)T.push(Object.assign({},u,{targetId:w,filter:x}));else{const F=this.getFeaturesetDescriptors();for(const q of F)T.push({targetId:w,filter:x,target:q});for(const{style:q}of this.fragments){const V=q.getFeaturesetDescriptors();for(const X of V)T.push({targetId:w,filter:x,target:X})}}const I=this.queryRenderedTargets(s,T,g),k=[],N=new Set;for(const F of I)for(const q of F.variants[w])Fm(q,F,N)||k.push(new o.dr(F,q));return k}queryRenderedTargets(s,u,g){const x={},w=(I,k,N,F)=>{const q=x[k.id]=x[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};if(q.layers[I.fqid]=q.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(q.has3DLayers=!0),!F)return N.uniqueFeatureID=!1,void q.layers[I.fqid].targets.push(N);q.layers[I.fqid].targets.push(Object.assign({},N,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const I of u)if("featuresetId"in I.target){const{featuresetId:k,importId:N}=I.target,F=this.getFragmentStyle(N);if(!F||!F._featuresetSelectors)continue;const q=F._featuresetSelectors[k];if(!q){this.fire(new o.z(new Error(`The featureset '${k}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const V of q){const X=F.getOwnLayer(V.layerId);X&&!Xm.has(X.type)&&w(X,F.getOwnLayerSourceCache(X),I,V)}}else if("layerId"in I.target){const{layerId:k}=I.target,N=this.getLayer(k);if(!N||Xm.has(N.type))continue;w(N,this.getLayerSourceCache(N),I)}const T=this._queryRenderedFeatures(s,x,g);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(s,u,g){const x=[],w=!!this.map._showQueryGeometry,T=mn.createFromScreenPoints(s,g);for(const I in u){const k=Bm(T,u[I],this._availableImages,g,w);Object.keys(k).length&&x.push(k)}if(this.placement)for(const I in u){if(!u[I].sourceCache._onlySymbols)continue;const k=ku(T.screenGeometry,u[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(k).length&&x.push(k)}return x}querySourceFeatures(s,u){const g=u&&u.filter;g&&this._validate(Ge,"querySourceFeatures.filter",g,null,u);let x=[];const w=this.getOwnSourceCaches(s);for(const T of w)x=x.concat(Df(T,u));return x}addSourceType(s,u,g){return Ma.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Ma.setSourceType(s,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:u.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,u,g={}){this._checkLoaded();const x=this.light.getLight();let w=!1;for(const I in s)if(!o.bv(s[I],x[I])){w=!0;break}if(!w)return;const T=this._getTransitionParameters();this.light.setLight(s,u,g),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,u=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),u===0&&delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s;const x=s.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){const I="terrain-dem-src";this.addSource(I,g.source),g=o.di(g),g=o.h(g,{source:I})}const w=o.h({},g),T={};if(this.terrain&&x){w.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(T.style=I.serialize())}if(this._validate(ut,"terrain",w,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&u!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,u),this.fire(new o.A("data",{dataType:"style"}))}else{const w=this.terrain,T=w.get();for(const I of Object.keys(o.a5.terrain))!g.hasOwnProperty(I)&&o.a5.terrain[I].default&&(g[I]=o.a5.terrain[I].default);for(const I in s)if(!o.bv(s[I],T[I])){w.set(s,this.options),this.stylesheet.terrain=s;const k=this._getTransitionParameters({duration:0});w.updateTransitions(k),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const u=this.fog=new Nr(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_createSnow(s){const u=this.snow=new eo(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_createRain(s){const u=this.rain=new Ui(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!o.bv(u.get(),s)){u.set(s,this.options),this.stylesheet.fog=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const u=this.snow;if(!o.bv(u.get(),s)){u.set(s,this.options),this.stylesheet.snow=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const u=this.rain;if(!o.bv(u.get(),s)){u.set(s,this.options),this.stylesheet.rain=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},u=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!u)return this._styleColorTheme.lut=null,void s();const g=this._evaluateColorThemeData(u);this._loadColorTheme(g).then(()=>{this.fire(new o.A("colorthemeset")),s()}).catch(x=>{o.w(`Couldn't set color theme: ${x}`)})}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,u){const g=this.getFragmentStyle(s);g&&(g._styleColorTheme.colorThemeOverride=u,g._reloadColorTheme())}_getTransitionParameters(s){return{now:o.q.now(),transition:o.h(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],u=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?s.push(g):u.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...u)}_createTerrain(s,u){const g=this.terrain=new $e(s,u,this.scope,this.options,this.map.getWorldview());u===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});g.updateTransitions(x)}_force3DLayerUpdate(){for(const s in this._layers){const u=this._layers[s];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const u=this._layers[s];u.type==="symbol"&&this._updateLayer(u)}}_validate(s,u,g,x,w={}){if(w&&w.validate===!1)return!1;const T=o.h({},this.serialize());return Bc(this,s.call(Es,o.h({key:u,style:T,value:g,styleSpec:o.a5},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(s){const u=this.getSourceCaches(s);for(const g of u)g.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}clearLayers(){for(const s in this._mergedLayers){const u=this._mergedLayers[s];u._clear&&u._clear()}}reloadSource(s){const u=this.getSourceCaches(s);for(const g of u)g.resume(),g.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(s=>{s.modelManager.reloadModels(s.scope)})}updateSources(s){let u;this.directionalLight&&(u=Xh(this.directionalLight));const g=new Set;for(const x in this._mergedLayers){const w=this._mergedLayers[x];w.hasElevation()&&!g.has(w.source)&&g.add(w.source)}for(const x in this._mergedSourceCaches){const w=this._mergedSourceCaches[x],T=g.has(w._source.id);w.update(s,void 0,void 0,u,T)}}_generateCollisionBoxes(){for(const s in this._sourceCaches){const u=this._sourceCaches[s];u.resume(),u.reload()}}_updatePlacement(s,u,g,x,w,T,I=!1){let k=!1,N=!1;const F={},q={};for(const V of this._mergedOrder){const X=this._mergedLayers[V];if(X.type!=="symbol")continue;const re=o.C(X.source,X.scope);let Q=F[re];if(!Q){const ie=this.getLayerSourceCache(X);if(!ie)continue;const ue=ie.getRenderableIds(!0).map(pe=>ie.getTileByID(pe));q[re]=ue.slice(),Q=F[re]=ue.sort((pe,ge)=>ge.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(ge.tileID)?-1:1))}const oe=this.crossTileSymbolIndex.addLayer(X,Q,u.center.lng,u.projection);k=k||oe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),u.zoom))&&(this.pauseablePlacement=new Wm(u,this._mergedOrder,I,g,x,w,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,q,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),N=!0),k&&this.pauseablePlacement.placement.setStale()),N||k){this._buildingIndex.onNewFrame(u.zoom);for(let V=0;V<this._mergedOrder.length;V++){const X=this._mergedLayers[this._mergedOrder[V]];if(X.type!=="symbol")continue;const re=this.isLayerClipped(X);this.placement.updateLayerOpacities(X,F[o.C(X.source,X.scope)],V,re?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,u){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:w})=>w===s.id)!==-1)return void this.fire(new o.z(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!u)return g.push(s),this._loadImports([s],!0);const x=g.findIndex(({id:w})=>w===u);return x===-1&&this.fire(new o.z(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,x).concat(s).concat(g.slice(x)),this._loadImports([s],!0,u)}updateImport(s,u){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(s);return x===-1?this:typeof u=="string"?(this.setImportUrl(s,u),this):(u.url&&u.url!==g[x].url&&this.setImportUrl(s,u.url),o.bv(u.config,g[x].config)||this.setImportConfig(s,u.config,u.data.schema),o.bv(u.data,g[x].data)||this.setImportData(s,u.data),this)}moveImport(s,u){this._checkLoaded();let g=this.stylesheet.imports||[];const x=this.getImportIndex(s);if(x===-1)return this;const w=this.getImportIndex(u);if(w===-1)return this;const T=g[x],I=this.fragments[x];return g=g.filter(({id:k})=>k!==s),this.fragments=this.fragments.filter(({id:k})=>k!==s),this.stylesheet.imports=g.slice(0,w).concat(T).concat(g.slice(w)),this.fragments=this.fragments.slice(0,w).concat(I).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(s,u){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(s);if(x===-1)return this;g[x].url=u;const w=this.fragments[x];return w.style=this._createFragmentStyle(g[x]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(u),this}setImportData(s,u){this._checkLoaded();const g=this.getImportIndex(s),x=this.stylesheet.imports||[];return g===-1?this:u?(this.fragments[g].style.setState(u),this._reloadImports(),this):(delete x[g].data,this.setImportUrl(s,x[g].url))}setImportConfig(s,u,g){this._checkLoaded();const x=this.getImportIndex(s),w=this.stylesheet.imports||[];if(x===-1)return this;u?w[x].config=u:delete w[x].config;const T=this.fragments[x];g&&T.style.stylesheet&&(T.style.stylesheet.schema=g);const I=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=u,T.style.updateConfig(u,I),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const u=this.stylesheet.imports||[],g=this.getImportIndex(s);g!==-1&&(u.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){const u=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return u===-1&&this.fire(new o.z(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),u}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const u in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[u];g&&s.push(g.getSource())}return s}getSource(s,u){const g=this.getSourceCache(s,u);return g&&g.getSource()}getLayerSource(s){const u=this.getLayerSourceCache(s);return u&&u.getSource()}getSourceCache(s,u){const g=o.C(s,u);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){const u=o.C(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[s]&&u.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&u.push(this._mergedSymbolSourceCaches[s]),u}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const u in s){const g=s[u];g==="reload"?this.reloadSource(u):g==="clear"&&this.clearSource(u)}}updateLayers(s){const u=this._changes.getUpdatedPaintProperties();for(const g of u){const x=this.getLayer(g);x&&x.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s)}getImages(s,u,g){this.imageManager.getImages(u.images,u.scope,g),this._updateTilesForChangedImages();const x=T=>{if(T){const I=u.images.map(k=>o.I.toString(k));T.setDependencies(u.tileID.key,u.type,I)}},w=o.C(u.source,u.scope);x(this._mergedOtherSourceCaches[w]),x(this._mergedSymbolSourceCaches[w]),u.images.some(T=>T.iconsetId)&&this.fire(new o.A("data",{dataType:"style"}))}rasterizeImages(s,u,g){this.imageManager.rasterizeImages(u,g)}getGlyphs(s,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(s,u,g){return o.dt(u,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const u=[];return this._otherSourceCaches[s]&&u.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&u.push(this._symbolSourceCaches[s]),u}_isSourceCacheLoaded(s){const u=this.getOwnSourceCaches(s);return u.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${s}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,u){if(!this._clipLayerPresent&&s.type!=="fill-extrusion"&&s.type!=="building")return!1;const g=s.type==="fill-extrusion"&&(s.sourceLayer==="building"||s.sourceLayer==="procedural_buildings"),x=s.type==="building";if(s.is3D(!!this.terrain)){if(g||x||u&&u.type==="batched-model"||s.type==="model")return!0}else if(s.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ma.getSourceType=function(m){return zm[m]},Ma.setSourceType=function(m,s){zm[m]=s},Ma.registerForPluginStateChange=o.du;var Dv=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Yh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Jh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Lv="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Km=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,ra=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ym=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Lt=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jv=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Jm=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Qm=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Qf=[];el(Dv,Qf),el(Jh,Qf),el(Yh,Qf);const $u={"_prelude_fog.vertex.glsl":ra,"_prelude_terrain.vertex.glsl":Km,"_prelude_shadow.vertex.glsl":Jm,"_prelude_fog.fragment.glsl":Ym,"_prelude_shadow.fragment.glsl":Qm,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Lt,"_prelude_raster_particle.glsl":jv},Oa={};Jr("",Km),Jr(Ym,ra),Jr(Qm,Jm),Jr(Lt,""),Jr(jv,"");const eg=Jr(Yh,Jh),Vc=Dv;var ep={background:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Jr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Jr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Jr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Jr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Jr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Jr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Jr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Jr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Jr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Jr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Jr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Jr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Jr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Jr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Jr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Jr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Jr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Jr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Lv),skyboxGradient:Jr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Lv),skyboxCapture:Jr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Jr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Jr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Jr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Jr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Jr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Jr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function el(m,s){const u=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of u)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=g.split(" ");for(const w of x)s.includes(w)||s.push(w)}}function Jr(m,s){const u=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(N=>{const F=N.split(" ");return F[F.length-1]}),x=[...new Set(x)]);const w={},T=[],I=[];if(m=m.replace(u,(N,F)=>(I.push(F),"")),(s=s.replace(u,(N,F)=>(T.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let k=[...Qf];el(m,k),el(s,k);for(const N of[...T,...I])$u[N]||console.error(`Undefined include: ${N}`),Oa[N]||(Oa[N]=[],el($u[N],Oa[N])),k=[...k,...Oa[N]];return{fragmentSource:m=m.replace(g,(N,F,q,V,X)=>(w[X]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${X}
in ${q} ${V} ${X};
#else
uniform ${q} ${V} u_${X};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${X}
    ${q} ${V} ${X} = u_${X};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${q} ${V} ${X};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(g,(N,F,q,V,X)=>{const re=V==="float"?"vec2":V,Q=X.match(/color/)?"color":re;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${X}
in ${q} ${V} a_${X};
#endif
`:w[X]?F==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${q} ${re} a_${X};
out ${q} ${V} ${X};
#else
uniform ${q} ${V} u_${X};
#endif
`:F==="initialize"?Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${q} ${V} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${Q}(a_${X}, u_${X}_t);
#else
    ${q} ${V} ${X} = u_${X};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${q} ${V} a_${X};
    out ${q} ${V} ${X};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${X} = a_${X};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${q} ${re} a_${X};
#else
uniform ${q} ${V} u_${X};
#endif
`:F==="define-instanced"?Q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${X}0;
in vec4 a_${X}1;
in vec4 a_${X}2;
in vec4 a_${X}3;
#else
uniform ${q} ${V} u_${X};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${q} ${re} a_${X};
#else
uniform ${q} ${V} u_${X};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${q} ${V} ${X} = a_${X};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${q} ${V} ${X} = a_${X};
#else
    ${q} ${V} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${q} ${V} ${X} = unpack_mix_${Q}(a_${X}, u_${X}_t);
#else
    ${q} ${V} ${X} = u_${X};
#endif
`}),staticAttributes:x,usedDefines:k,vertexIncludes:T,fragmentIncludes:I}}class _C{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,u,g,x,w,T,I,k){this.context=s;let N=this.boundPaintVertexBuffers.length!==x.length;for(let q=0;!N&&q<x.length;q++)this.boundPaintVertexBuffers[q]!==x[q]&&(N=!0);let F=this.boundDynamicVertexBuffers.length!==I.length;for(let q=0;!F&&q<I.length;q++)this.boundDynamicVertexBuffers[q]!==I[q]&&(F=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||N||F||this.boundIndexBuffer!==w||this.boundVertexOffset!==T)this.freshBind(u,g,x,w,T,I,k);else{s.bindVertexArrayOES.set(this.vao);for(const q of I)q&&(q.bind(),k&&q.instanceCount&&q.setVertexAttribDivisor(s.gl,u,k));w&&w.dynamicDraw&&w.bind()}}freshBind(s,u,g,x,w,T,I){const k=s.numAttributes,N=this.context,F=N.gl;this.vao&&this.destroy(),this.vao=N.gl.createVertexArray(),N.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=T,u.enableAttributes(F,s),u.bind(),u.setVertexAttribPointers(F,s,w);for(const q of g)q.enableAttributes(F,s),q.bind(),q.setVertexAttribPointers(F,s,w);for(const q of T)q&&(q.enableAttributes(F,s),q.bind(),q.setVertexAttribPointers(F,s,w),I&&q.instanceCount&&q.setVertexAttribDivisor(F,s,I));x&&x.bind(),N.currentNumAttributes=k}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Nv(m,s){const u=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new o.ac(0,g/u).toLngLat().lat,new o.ac(0,(g+1)/u).toLngLat().lat]}function vC(m,s,u,g,x,w,T){const I=m.context,k=I.gl,N=u.hillshadeFBO;if(!N)return;m.prepareDrawTile();const F=m.isTileAffectedByFog(s),q=m.getOrCreateProgram("hillshade",{overrideFog:F});I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,N.colorAttachment.get());const V=((oe,ie,ue,pe)=>{const ge=ue.paint.get("hillshade-shadow-color"),be=ue.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=ue.paint.get("hillshade-highlight-color"),Ie=ue.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",we=ue.paint.get("hillshade-accent-color"),Se=ue.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Te=ue.paint.get("hillshade-emissive-strength");let We=o.al(ue.paint.get("hillshade-illumination-direction"));if(ue.paint.get("hillshade-illumination-anchor")==="viewport")We-=oe.transform.angle;else if(oe.style&&oe.style.enable3dLights()&&oe.style.directionalLight){const ht=oe.style.directionalLight.properties.get("direction"),tt=o.d1(ht.x,ht.y,ht.z);We=o.al(tt[1])}const je=!oe.options.moving;return{u_matrix:pe||oe.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),je),u_image:0,u_latrange:Nv(0,ie.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),We],u_shadow:ge.toPremultipliedRenderColor(be?null:ue.lut),u_highlight:Ae.toPremultipliedRenderColor(Ie?null:ue.lut),u_emissive_strength:Te,u_accent:we.toPremultipliedRenderColor(Se?null:ue.lut)}})(m,u,g,m.terrain?s.projMatrix:null);m.uploadCommonUniforms(I,q,s.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:re,tileBoundsSegments:Q}=m.getTileBoundsBuffers(u);q.draw(m,k.TRIANGLES,x,w,T,ur.disabled,V,g.id,X,re,Q)}function zv(m,s,u){if(!s.needsDEMTextureUpload)return;const g=m.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(u.stride);const w=u.getPixels();s.demTexture?s.demTexture.update(w,{premultiply:!1}):s.demTexture=new o.T(g,w,x.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function S1(m,s,u){const g=m.context,x=g.gl;if(!s.dem)return;const w=s.dem;if(g.activeTexture.set(x.TEXTURE1),zv(m,s,w),!s.demTexture)return;s.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const T=w.dim;g.activeTexture.set(x.TEXTURE0);let I=s.hillshadeFBO;if(!I){const V=new o.T(g,{width:T,height:T,data:null},x.RGBA8);V.bind(x.LINEAR,x.CLAMP_TO_EDGE),I=s.hillshadeFBO=g.createFramebuffer(T,T,!0,"renderbuffer"),I.colorAttachment.set(V.texture)}g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,T,T]);const{tileBoundsBuffer:k,tileBoundsIndexBuffer:N,tileBoundsSegments:F}=m.getMercatorTileBoundsBuffers(),q=[];m.linearFloatFilteringSupported()&&q.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:q}).draw(m,x.TRIANGLES,Ht.disabled,mr.disabled,Mr.unblended,ur.disabled,((V,X)=>{const re=X.stride,Q=o.bz();return o.ca(Q,0,o.aj,-o.aj,0,0,1),o.bo(Q,Q,[0,-o.aj,0]),{u_matrix:Q,u_image:1,u_dimension:[re,re],u_zoom:V.overscaledZ}})(s.tileID,w),u.id,k,N,F),s.needsHillshadePrepare=!1}class ai{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xC extends ai{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class bC extends ai{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class wC extends ai{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class SC extends ai{getDefault(){return[!0,!0,!0,!0]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class T1 extends ai{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class TC extends ai{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class tg extends ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const u=this.current;(s.func!==u.func||s.ref!==u.ref||s.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class EC extends ai{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class E1 extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=s,this.dirty=!1}}class Fv extends ai{getDefault(){return[0,1]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class rg extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=s,this.dirty=!1}}class Bv extends ai{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Vu extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.BLEND):u.disable(u.BLEND),this.current=s,this.dirty=!1}}class Qh extends ai{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ng extends ai{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class ig extends ai{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class ed extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=s,this.dirty=!1}}class A1 extends ai{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class $v extends ai{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let P1=class extends ai{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class td extends ai{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class og extends ai{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class sg extends ai{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Vv extends ai{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ag extends ai{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class tp extends ai{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class C1 extends ai{getDefault(){return null}set(s){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class I1 extends ai{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class M1 extends ai{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class rd extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class O1 extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Uv extends ai{constructor(s,u){super(s),this.context=s,this.parent=u}getDefault(){return null}}class AC extends Uv{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class k1 extends Uv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Gv extends Uv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Hv extends k1{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Wv=(m,s,u)=>({u_matrix:m,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:u}),lg=(m,s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:T,u_frustum_tr:I,u_frustum_br:k,u_frustum_bl:N,u_globe_pos:F,u_globe_radius:q,u_viewport:V,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:X,u_far_z_cutoff:re});function qv(m,s){return m!=null&&s!=null&&!(!m.hasData()||!s.hasData())&&m.demTexture!=null&&s.demTexture!=null&&m.tileID.key!==s.tileID.key}const Uu=new class{constructor(){this.operations={}}newMorphing(m,s,u,g,x){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==u.tileID.key&&(w.queued=u)}else this.operations[m]={startTime:g,phase:0,duration:x,from:s,to:u,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(const s in this.operations){const u=this.operations[s];for(u.phase=(m-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},R1={0:null,1:"TERRAIN_VERTEX_MORPHING"};function nd(m,s,u){if(s===0)return 0;const g=s<1&&u===514?.25/s:1;return 6*Math.pow(1.5,22-m)*Math.max(s,1)*g}function rp(m,s){const u=1<<m.z;return!s&&(m.x===0||m.x===u-1)||m.y===0||m.y===u-1}const cg=m=>({u_matrix:m});function Is(m,s,u,g,x){if(x>0){const w=o.q.now(),T=(w-m.timeAdded)/x,I=s?(w-s.timeAdded)/x:-1,k=u.getSource(),N=g.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),F=!s||Math.abs(s.tileID.overscaledZ-N)>Math.abs(m.tileID.overscaledZ-N),q=F&&m.refreshedUponExpiration?1:o.ay(F?T:1-I,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}class Zv extends Ps{constructor(s){const u=kf("mock-dem",{type:"raster-dem",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("mock-dem",u,!1),u.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,u){s.state="loaded",u(null)}}class ug extends Ps{constructor(s){const u=kf("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,u,g){if(s.freezeTileCoverage)return;this.transform=s;const x=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,T)=>{if(w[T.key]="",!this._tiles[T.key]){const I=new Ru(T,this._source.tileSize*T.overscaleFactor(),s.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[T.key]=I}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(s){const u=this.proxyCachedFBO[s];if(u!==void 0){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class np extends o.aM{constructor(s,u,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class hg extends o.dF{constructor(s,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,w]=function(k){const N=new o.ba,F=new o.a_,q=131;N.reserve(17161),F.reserve(33800);const V=o.aj/128,X=o.aj+V/2,re=X+V;for(let oe=-V;oe<re;oe+=V)for(let ie=-V;ie<re;ie+=V){const ue=ie<0||ie>X||oe<0||oe>X?24575:0,pe=o.ay(Math.round(ie),0,o.aj),ge=o.ay(Math.round(oe),0,o.aj);N.emplaceBack(pe+ue,ge)}const Q=(oe,ie)=>{const ue=ie*q+oe;F.emplaceBack(ue+1,ue,ue+q),F.emplaceBack(ue+q,ue+q+1,ue+1)};for(let oe=1;oe<129;oe++)for(let ie=1;ie<129;ie++)Q(ie,oe);return[0,129].forEach(oe=>{for(let ie=0;ie<130;ie++)Q(ie,oe),Q(oe,ie)}),[N,F,32768]}(),T=s.context;this.gridBuffer=T.createVertexBuffer(g,o.bc.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=o.bd.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,g.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ug(u.map),this.orthoMatrix=o.bz(),o.ca(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const I=T.gl;this._overlapStencilMode=new mr({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Zv(u.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,u,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const x=s.terrain.properties,w=s.terrain.drapeRenderMode===0,T=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const I=s.terrain&&s.terrain.scope,k=x.get("source"),N=w?this._mockSourceCache:s.getSourceCache(k,I);if(!N)return void o.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=N,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(u):x.get("exaggeration"),!u.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const q=this.getScaledDemTileSize();this.sourceCache.update(u,q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),u.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const u=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;const x=u!=null?g-u:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const w=s.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(w);let I=w-this._previousZoom;const k=this._previousUpdateTimestamp;let N=w;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(w-N)>.5&&(I=.5*(w-N+I)),I*x<0&&(N+=I)),this._evaluationZoom=N;const F=T.getExaggeration(N),q=F===T.getExaggeration(Math.max(0,N-.1));if(q&&Math.abs(F-this._exaggeration)<.01)return F;let V=Math.min(.1,.00375*(this._updateTimestamp-k));return(q||F<.1||Math.abs(I)<1e-4)&&(V=Math.min(.2,4*V)),o.ai(this._exaggeration,F,V)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=u.getIds().map(k=>{const N=u.getTileByID(k).tileID;return N.projMatrix=g.calculateProjMatrix(N.toUnwrapped()),N});(function(k,N){const F=N.transform.pointCoordinate(N.transform.getCameraPoint()),q=new o.P(F.x,F.y);k.sort((V,X)=>{if(X.overscaledZ-V.overscaledZ)return X.overscaledZ-V.overscaledZ;const re=new o.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Q=new o.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),oe=q.mult(1<<V.canonical.z);return oe.x-=.5,oe.y-=.5,oe.distSqr(re)-oe.distSqr(Q)})})(x,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const k in T){const N=T[k];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,s[k],w),N.usedForTerrain))continue;const F=s[k];N.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[u.id]=x.map(k=>new np(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const N=this.terrainTileForTile[k.key];if(!N)continue;const F=N.tileID.key;F in I||(this._visibleDemTiles.push(N),I[F]=F)}}_assignTerrainTiles(s){this._initializing||s.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const s=this.painter.context,u=s.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(s.activeTexture.set(u.TEXTURE1),zv(this.painter,x,w))}}_prepareDemTileUniforms(s,u,g,x){if(!u||u.demTexture==null)return!1;const w=s.tileID.canonical,T=Math.pow(2,u.tileID.canonical.z-w.z),I=x||"";return g[`u_dem_tl${I}`]=[w.x*T%1,w.y*T%1],g[`u_dem_scale${I}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const u=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const w=x.dem.tree.minimums[0];return w>0&&s++,g+w},0);return s?u/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,u=s.gl;s.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),x=new o.dG({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new o.T(s,x,u.R32F,{premultiply:!1}),w}setupElevationDraw(s,u,g){const x=this.painter.context,w=x.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let I=null,k=null,N=1;if(g&&g.morphing&&this._useVertexMorphing){const X=g.morphing.srcDemTile,re=g.morphing.dstDemTile;N=g.morphing.phase,X&&re&&(this._prepareDemTileUniforms(s,X,T,"_prev")&&(k=X),this._prepareDemTileUniforms(s,re,T)&&(I=re))}const F=X=>X&&X.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let q=null;var V;if(this.enabled?k&&I?(q=I.demTexture,x.activeTexture.set(w.TEXTURE4),k.demTexture.bind(F(k),w.CLAMP_TO_EDGE),T.u_dem_lerp=N):(I=this.terrainTileForTile[s.tileID.key],q=this._prepareDemTileUniforms(s,I,T)?I.demTexture:this.emptyDEMTexture):q=this.emptyDEMTexture,x.activeTexture.set(w.TEXTURE2),q&&(T.u_dem_size=(V=q).size[0]===1?1:V.size[0]-2,q.bind(F(I),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,u,T),g&&g.useMeterToDem&&I){const X=(1<<I.tileID.canonical.z)*o.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=X}if(g&&g.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(x,T),this.painter.transform.projection.name==="globe"){const X=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);u.setGlobeUniformValues(x,X)}}globeUniformValues(s,u,g){const x=s.projection;return{u_tile_tl_up:x.upVector(u,0,0),u_tile_tr_up:x.upVector(u,o.aj,0),u_tile_br_up:x.upVector(u,o.aj,o.aj),u_tile_bl_up:x.upVector(u,0,o.aj),u_tile_up_scale:g?o.dH(1):x.upVectorScale(u,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const u=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,T,I,k){if(x.transform.projection.name==="globe")(function(N,F,q,V,X){const re=N.context,Q=re.gl;let oe,ie;const ue=N.transform,pe=o.dy(N,re,ue),ge=(ht,tt)=>{if(ie===tt)return;const ft=[R1[tt],"PROJECTION_GLOBE_VIEW"];pe&&ft.push("CUSTOM_ANTIALIASING");const Pt=N.isTileAffectedByFog(ht);oe=N.getOrCreateProgram("globeRaster",{defines:ft,overrideFog:Pt}),ie=tt},be=N.colorModeForRenderPass(),Ae=new Ht(Q.LEQUAL,Ht.ReadWrite,N.depthRangeFor3D);Uu.update(X);const Ie=o.dz(ue),we=[o.aD(ue.center.lng),o.aH(ue.center.lat)],Se=N.globeSharedBuffers,Te=[ue.width*o.q.devicePixelRatio,ue.height*o.q.devicePixelRatio],We=Float32Array.from(ue.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const ht=N.transform,tt=nd(ht.zoom,F.exaggeration(),F.sourceCache._source.tileSize);ie=-1;const ft=Q.TRIANGLES;for(const Pt of V){const qe=q.getTile(Pt),De=mr.disabled,st=F.prevTerrainTileForTile[Pt.key],Xe=F.terrainTileForTile[Pt.key];qv(st,Xe)&&Uu.newMorphing(Pt.key,st,Xe,X,250),re.activeTexture.set(Q.TEXTURE0),qe.texture&&qe.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const yt=Uu.getMorphValuesForProxy(Pt.key),vt=yt?1:0;yt&&o.L(je,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:o.dx(yt.phase)}});const bt=o.dA(Pt.canonical),Dt=o.dB(bt.getCenter().lat),Jt=o.dC(Pt.canonical,bt,Dt,ht.worldSize/ht._pixelsPerMercatorPixel),or=o.bh(o.dD(Pt.canonical)),$t=lg(ht.expandedFarZProjMatrix,We,Ie,or,o.ah(ht.zoom),we,ht.frustumCorners.TL,ht.frustumCorners.TR,ht.frustumCorners.BR,ht.frustumCorners.BL,ht.globeCenterInViewSpace,ht.globeRadius,Te,tt,ht._farZ,Jt);if(ge(Pt,vt),oe&&(F.setupElevationDraw(qe,oe,je),N.uploadCommonUniforms(re,oe,Pt.toUnwrapped()),Se)){const[rr,er,_r]=Se.getGridBuffers(Dt,tt!==0);oe.draw(N,ft,Ae,De,be,ur.backCCW,$t,"globe_raster",rr,er,_r)}}}if(Se&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){const ht=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&ht.push("CUSTOM_ANTIALIASING"),oe=N.getOrCreateProgram("globeRaster",{defines:ht});for(const tt of V){const{x:ft,y:Pt,z:qe}=tt.canonical,De=Pt===0,st=Pt===(1<<qe)-1,[Xe,yt,vt,bt]=Se.getPoleBuffers(qe,!1);if(bt&&(De||st)){const Dt=q.getTile(tt);re.activeTexture.set(Q.TEXTURE0),Dt.texture&&Dt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Jt=o.dE(qe,ft,ue);const or=o.bh(o.dD(tt.canonical)),$t=(rr,er)=>rr.draw(N,Q.TRIANGLES,Ae,mr.disabled,be,ur.disabled,lg(ue.expandedFarZProjMatrix,Jt,Jt,or,0,we,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,Te,0,ue._farZ),"globe_pole_raster",er,vt,bt);F.setupElevationDraw(Dt,oe,je),N.uploadCommonUniforms(re,oe,tt.toUnwrapped()),De&&N.renderDefaultNorthPole&&$t(oe,Xe),st&&N.renderDefaultSouthPole&&(Jt=o.cP(o.bz(),Jt,[1,-1,1]),$t(oe,yt))}}}})(x,w,T,I,k);else{const N=x.context,F=N.gl;let q,V;const X=x.shadowRenderer,re=yl(x,x.longestCutoffRange),Q=be=>{if(V===be)return;const Ae=[];Ae.push(R1[be]),re.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),X&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),X.useNormalOffset&&Ae.push("NORMAL_OFFSET")),q=x.getOrCreateProgram("terrainRaster",{defines:Ae}),V=be},oe=x.colorModeForRenderPass(),ie=new Ht(F.LEQUAL,Ht.ReadWrite,x.depthRangeFor3D);Uu.update(k);const ue=x.transform,pe=nd(ue.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let ge=[0,0,0];if(X){const be=x.style.directionalLight,Ae=x.style.ambientLight;be&&Ae&&(ge=Bu(x.style,be,Ae))}{V=-1;const be=F.TRIANGLES,[Ae,Ie]=[w.gridIndexBuffer,w.gridSegments];for(const we of I){const Se=T.getTile(we),Te=mr.disabled,We=w.prevTerrainTileForTile[we.key],je=w.terrainTileForTile[we.key];qv(We,je)&&Uu.newMorphing(we.key,We,je,k,250),N.activeTexture.set(F.TEXTURE0),Se.texture&&Se.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ht=Uu.getMorphValuesForProxy(we.key),tt=ht?1:0;let ft;ht&&(ft={morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:o.dx(ht.phase)}});const Pt=Wv(we.projMatrix,rp(we.canonical,ue.renderWorldCopies)?pe/10:pe,ge);if(Q(tt),!q)continue;w.setupElevationDraw(Se,q,ft);const qe=we.toUnwrapped();X&&X.setupShadows(qe,q),x.uploadCommonUniforms(N,q,qe,null,re),q.draw(x,be,ie,Te,oe,ur.backCCW,Pt,"terrain_raster",w.gridBuffer,Ae,Ie)}}}}(u,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),I=u.style.order,k=[];let N=0;for(const F of w){const q=x.getTileByID(F.proxyTileKey),V=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][s]:void 0,X=V!==void 0?x.renderCache[V]:this.pool[N++],re=V!==void 0;if(q.texture=X.tex,re&&!X.dirty){k.push(q.tileID);continue}let Q;g.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(g.clear({color:o.am.transparent,stencil:0}),X.dirty=!1);for(let oe=T.start;oe<=T.end;++oe){const ie=u.style._mergedLayers[I[oe]];if(ie.isHidden(u.transform.zoom))continue;const ue=u.style.getLayerSourceCache(ie),pe=ue?this.proxyToSource[F.key][ue.id]:[F];if(!pe)continue;const ge=pe;g.viewport.set([0,0,X.fb.width,X.fb.height]),Q!==(ue?ue.id:null)&&(this._setupStencil(X,pe,ie,ue),Q=ue?ue.id:null),u.renderLayer(u,ue,ie,ge)}if(this._drapedRenderBatches.length===0)for(const oe of this._pendingGroundEffectLayers){const ie=u.style._mergedLayers[I[oe]];if(ie.isHidden(u.transform.zoom))continue;const ue=u.style.getLayerSourceCache(ie),pe=ue?this.proxyToSource[F.key][ue.id]:[F];if(!pe)continue;const ge=pe;g.viewport.set([0,0,X.fb.width,X.fb.height]),Q!==(ue?ue.id:null)&&(this._setupStencil(X,pe,ie,ue),Q=ue?ue.id:null),u.renderLayer(u,ue,ie,ge)}this.renderedToTile?(X.dirty=!0,k.push(q.tileID)):re||--N,N===5&&(N=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),T.end+1}postRender(){}isLayerOrderingCorrect(s){const u=s.order.length;let g=-1,x=u;for(let w=0;w<u;++w)this._style.isLayerDraped(s._mergedLayers[s.order[w]])?g=Math.max(g,w):x=Math.min(x,w);return x>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{s=Math.min(s,u.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,u,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const T=w.tileID,I=1<<T.overscaledZ,{x:k,y:N}=T.canonical,F=k/I,q=(k+1)/I,V=N/I,X=(N+1)/I;return{minx:F,miny:V,maxx:q,maxy:X,t:w.dem.tree.raycastRoot(F,V,q,X,s,u,g),tile:w}});x.sort((w,T)=>(w.t!==null?w.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const T=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,s,u,g);if(T!=null)return T}return null}_createFBO(){const s=this.painter.context,u=s.gl,g=this.drapeBufferSize;s.activeTexture.set(u.TEXTURE0);const x=new o.T(s,{width:g[0],height:g[1],data:null},u.RGBA8);x.bind(u.LINEAR,u.CLAMP_TO_EDGE);const w=s.createFramebuffer(g[0],g[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new Hv(s,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const u=this._style._mergedLayers[s],g=u.isHidden(this.painter.transform.zoom);return u.type==="hillshade"||u.type==="custom"?!g&&u.shouldRedrape():!g&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const g of this._style.getSources())if(g instanceof Of){s=!0;break}if(!s)return;const u={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],w=this._style.getLayerSourceCache(x);if(w&&!u[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof o.ab){u[w.id]=!0;for(const T of this.proxyCoords){const I=this.proxyToSource[T.key][w.id];if(I)for(const k of I)this._clearRenderCacheForTile(w.id,k)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof Oo){s=!0;break}if(!s)return;const u={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],w=this._style.getLayerSourceCache(x);if(!w||u[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const T=x.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const k=this.proxyToSource[I.key][w.id];if(k)for(const N of k){const F=Is(w.getTile(N),w.findLoadedParent(N,0),w,this.painter.transform,T);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(w.id,N)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,u=s.length;if(u===0)return;const g=[];this._pendingGroundEffectLayers=[];let x,w=0,T=this._style._mergedLayers[s[w]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++w<u;)T=this._style._mergedLayers[s[w]];for(;w<u;++w){const I=this._style._mergedLayers[s[w]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?x===void 0&&(x=w):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),x!==void 0&&(g.push({start:x,end:w-1}),x=void 0)))}if(x!==void 0&&g.push({start:x,end:w-1}),g.length!==0){const I=g[g.length-1];this._pendingGroundEffectLayers.every(k=>k>I.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const T=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let I=0;I<T.length;++I){const k=Object.values(T[I]);u.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let T=g.length-1;T>=0;T--){const I=g[T];if(u.getTileByID(I.key),u.proxyCachedFBO[I.key]!==void 0){const k=s[I.key],N=this.proxyToSource[I.key];let F=0;for(const q in N){const V=N[q],X=k[q];if(!X||X.length!==V.length||V.some((re,Q)=>re!==X[Q]||x[q]&&x[q].hasOwnProperty(re.key))){F=-1;break}++F}for(const q in u.proxyCachedFBO[I.key])u.renderCache[u.proxyCachedFBO[I.key][q]].dirty=F<0||F!==Object.values(k).length}}const w=[...this._drapedRenderBatches];w.sort((T,I)=>I.end-I.start-(T.end-T.start));for(const T of w)for(const I of g){if(u.proxyCachedFBO[I.key])continue;let k=u.renderCachePool.pop();k===void 0&&u.renderCache.length<50&&(k=u.renderCache.length,u.renderCache.push(this._createFBO())),k!==void 0&&(u.proxyCachedFBO[I.key]={},u.proxyCachedFBO[I.key][T.start]=k,u.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(s,u,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,T=w.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let I;if(g.isTileClipped())I=u.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):mr.disabled}_renderTileClippingMasks(s,u){const g=this.painter,x=this.painter.context,w=x.gl;g._tileClippingMaskIDs={},x.setColorMode(Mr.disabled),x.setDepthMode(Ht.disabled);const T=g.getOrCreateProgram("clippingMask");for(const I of s){const k=g._tileClippingMaskIDs[I.key]=--u;T.draw(g,w.TRIANGLES,Ht.disabled,new mr({func:w.ALWAYS,mask:0},k,255,w.KEEP,w.KEEP,w.REPLACE),Mr.disabled,ur.disabled,cg(I.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){const u=this.painter.transform;if(s.x<0||s.x>u.width||s.y<0||s.y>u.height)return null;const g=[s.x,s.y,1,1];o.aA(g,g,u.pixelMatrixInverse),o.cH(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const x=u._camera.position,w=o.cb(1,u.center.lat),T=[x[0],x[1],x[2]/w,0],I=o.d7([],g.slice(0,3),T);o.au(I,I);const k=this.raycast(T,I,this._exaggeration);return k!==null&&k?(o.bE(T,T,I,k),T[3]=T[2],T[2]*=w,T):null}_setupProxiedCoordsForOrtho(s,u,g){if(s.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(s,u,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const x=this.proxiedCoords[s.id]=[],w=this.proxyCoords;for(let k=0;k<w.length;k++){const N=w[k],F=this._findTileCoveringTileID(N,s);if(F){const q=this._createProxiedId(N,F,g[N.key]&&g[N.key][s.id]);x.push(q),this.proxyToSource[N.key][s.id]=[q]}}let T=!1;const I=new Set;for(let k=0;k<u.length;k++){const N=s.getTile(u[k]);if(!N||!N.hasData())continue;const F=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==N.tileID.canonical.z){const q=this.proxyToSource[F.tileID.key][s.id],V=this._createProxiedId(F.tileID,N,g[F.tileID.key]&&g[F.tileID.key][s.id]);q?q.splice(q.length-1,0,V):this.proxyToSource[F.tileID.key][s.id]=[V];const X=this.proxyToSource[F.tileID.key][s.id];I.has(X)||I.add(X),x.push(V),T=!0}}if(this._sourceTilesOverlap[s.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const k of I)k.sort((N,F)=>F.overscaledZ-N.overscaledZ)}_setupProxiedCoordsForImageSource(s,u,g){if(!s.getSource().loaded())return;const x=this.proxiedCoords[s.id]=[],w=this.proxyCoords,T=s.getSource(),I=T.tileID;if(!I)return;const k=new o.P(I.x,I.y)._div(1<<I.z),N=T.coordinates.map(o.ac.fromLngLat).reduce((q,V)=>(q.min.x=Math.min(q.min.x,V.x-k.x),q.min.y=Math.min(q.min.y,V.y-k.y),q.max.x=Math.max(q.max.x,V.x-k.x),q.max.y=Math.max(q.max.y,V.y-k.y),q),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(q,V)=>{const X=q.wrap+q.canonical.x/(1<<q.canonical.z),re=q.canonical.y/(1<<q.canonical.z),Q=o.aj/(1<<q.canonical.z),oe=V.wrap+V.canonical.x/(1<<V.canonical.z),ie=V.canonical.y/(1<<V.canonical.z);return X+Q<oe+N.min.x||X>oe+N.max.x||re+Q<ie+N.min.y||re>ie+N.max.y};for(let q=0;q<w.length;q++){const V=w[q];for(let X=0;X<u.length;X++){const re=s.getTile(u[X]);if(!re||!re.hasData()||F(V,re.tileID))continue;const Q=this._createProxiedId(V,re,g[V.key]&&g[V.key][s.id]),oe=this.proxyToSource[V.key][s.id];oe?oe.push(Q):this.proxyToSource[V.key][s.id]=[Q],x.push(Q)}}}_createProxiedId(s,u,g){let x=this.orthoMatrix;if(g){const w=g.find(T=>T.key===u.tileID.key);if(w)return w}if(u.tileID.key!==s.key){const w=s.canonical.z-u.tileID.canonical.z;let T,I,k;x=o.bz();const N=u.tileID.wrap-s.wrap<<s.overscaledZ;w>0?(T=o.aj>>w,I=T*((u.tileID.canonical.x<<w)-s.canonical.x+N),k=T*((u.tileID.canonical.y<<w)-s.canonical.y)):(T=o.aj<<-w,I=o.aj*(u.tileID.canonical.x-(s.canonical.x+N<<-w)),k=o.aj*(u.tileID.canonical.y-(s.canonical.y<<-w))),o.ca(x,0,T,0,T,0,1),o.bo(x,x,[I,k,0])}return new np(u.tileID,s.key,x)}_findTileCoveringTileID(s,u){let g=u.getTile(s);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[u.id],w=x[s.key];if(g=w?u.getTileByID(w):null,g&&g.hasData()||w===null)return g;let T=g?g.tileID:s,I=T.overscaledZ;const k=u.getSource().minzoom,N=[];if(!w){const q=u.getSource().maxzoom;if(s.canonical.z>=q){const V=s.canonical.z-q;u.getSource().reparseOverscaled?(I=Math.max(s.canonical.z+2,u.transform.tileZoom),T=new o.aM(I,s.wrap,q,s.canonical.x>>V,s.canonical.y>>V)):V!==0&&(I=q,T=new o.aM(I,s.wrap,q,s.canonical.x>>V,s.canonical.y>>V))}T.key!==s.key&&(N.push(T.key),g=u.getTile(T))}const F=q=>{N.forEach(V=>{x[V]=q}),N.length=0};for(I-=1;I>=k&&(!g||!g.hasData());I--){g&&F(g.tileID.key);const q=T.calculateScaledKey(I);if(g=u.getTileByID(q),g&&g.hasData())break;const V=x[q];if(V===null)break;V===void 0?N.push(q):g=u.getTileByID(V)}return F(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,u){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[u.key]=!0}}function Xv(m,s,u){const g=function(I,k,N){const F=o.bG(k,I),q=o.bG(N,[.2126,.7152,.0722]),V=(re,Q,oe)=>(1-oe)*re+oe*Q,X=V(1-.3*Math.min(q,1),1,Math.min(F+1,1));return V(.92,1,Math.asin(o.ay(k[2],-1,1))/Math.PI+.5)*X}(m,[0,0,1],s),x=[0,0,0];o.c1(x,u.slice(0,3),g);const w=[0,0,0];o.c1(w,s.slice(0,3),m[2]);const T=[0,0,0];return o.d5(T,x,w),o.d8(T)}const Kv=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],dg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class fg{static cacheKey(s,u,g,x){let w=`${u}${x?x.cacheKey:""}`;for(const T of g)s.usedDefines.includes(T)&&(w+=`/${T}`);return w}constructor(s,u,g,x,w,T){const I=s.gl;this.program=I.createProgram(),this.configuration=x,this.name=u,this.fixedDefines=[...T];const k=x?x.getBinderAttributes():[],N=(g.staticAttributes||[]).concat(k);let F=x?x.defines():[];F=F.concat(T.map(oe=>`#define ${oe}`));const q=`#version 300 es
`;let V=q+F.concat("precision mediump float;",Vc,eg.fragmentSource).join(`
`);for(const oe of g.fragmentIncludes)V+=`
${$u[oe]}`;V+=`
${g.fragmentSource}`;let X=q+F.concat("precision highp float;",Vc,eg.vertexSource).join(`
`);for(const oe of g.vertexIncludes)X+=`
${$u[oe]}`;this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&g.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(X+=`
uniform int u_instanceID;
`),X+=`
${g.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(X=X.replaceAll("gl_InstanceID","u_instanceID"));const re=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(re,V),I.compileShader(re),I.attachShader(this.program,re);const Q=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(Q,X),I.compileShader(Q),I.attachShader(this.program,Q),this.attributes={},this.numAttributes=N.length;for(let oe=0;oe<this.numAttributes;oe++)if(N[oe]){const ie=N[oe].startsWith("a_")?N[oe]:`a_${N[oe]}`;I.bindAttribLocation(this.program,oe,ie),this.attributes[ie]=oe}I.linkProgram(this.program),I.deleteShader(Q),I.deleteShader(re),this.fixedUniforms=w(s),this.binderUniforms=x?x.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(oe=>({u_instanceID:new o.cd(oe)}))(s)),(T.includes("TERRAIN")||u.indexOf("symbol")!==-1||u.indexOf("circle")!==-1)&&(this.terrainUniforms=(oe=>({u_dem:new o.cd(oe),u_dem_prev:new o.cd(oe),u_dem_tl:new o.cg(oe),u_dem_scale:new o.cf(oe),u_dem_tl_prev:new o.cg(oe),u_dem_scale_prev:new o.cf(oe),u_dem_size:new o.cf(oe),u_dem_lerp:new o.cf(oe),u_exaggeration:new o.cf(oe),u_depth:new o.cd(oe),u_depth_size_inv:new o.cg(oe),u_depth_range_unpack:new o.cg(oe),u_occluder_half_size:new o.cf(oe),u_occlusion_depth_offset:new o.cf(oe),u_meter_to_dem:new o.cf(oe),u_label_plane_matrix_inv:new o.ch(oe)}))(s)),T.includes("GLOBE")&&(this.globeUniforms=(oe=>({u_tile_tl_up:new o.ce(oe),u_tile_tr_up:new o.ce(oe),u_tile_br_up:new o.ce(oe),u_tile_bl_up:new o.ce(oe),u_tile_up_scale:new o.cf(oe)}))(s)),T.includes("FOG")&&(this.fogUniforms=(oe=>({u_fog_matrix:new o.ch(oe),u_fog_range:new o.cg(oe),u_fog_color:new o.d0(oe),u_fog_horizon_blend:new o.cf(oe),u_fog_vertical_limit:new o.cg(oe),u_fog_temporal_offset:new o.cf(oe),u_frustum_tl:new o.ce(oe),u_frustum_tr:new o.ce(oe),u_frustum_br:new o.ce(oe),u_frustum_bl:new o.ce(oe),u_globe_pos:new o.ce(oe),u_globe_radius:new o.cf(oe),u_globe_transition:new o.cf(oe),u_is_globe:new o.cd(oe),u_viewport:new o.cg(oe)}))(s)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(oe=>({u_cutoff_params:new o.d0(oe)}))(s)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(oe=>({u_lighting_ambient_color:new o.ce(oe),u_lighting_directional_dir:new o.ce(oe),u_lighting_directional_color:new o.ce(oe),u_ground_radiance:new o.ce(oe)}))(s)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(oe=>({u_light_matrix_0:new o.ch(oe),u_light_matrix_1:new o.ch(oe),u_fade_range:new o.cg(oe),u_shadow_normal_offset:new o.ce(oe),u_shadow_intensity:new o.cf(oe),u_shadow_texel_size:new o.cf(oe),u_shadow_map_resolution:new o.cf(oe),u_shadow_direction:new o.ce(oe),u_shadow_bias:new o.ce(oe),u_shadowmap_0:new o.cd(oe),u_shadowmap_1:new o.cd(oe)}))(s))}}setTerrainUniformValues(s,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in u)g[x]&&g[x].set(this.program,x,u[x])}}setGlobeUniformValues(s,u){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in u)g[x]&&g[x].set(this.program,x,u[x])}}setFogUniformValues(s,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}setCutoffUniformValues(s,u){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}setLightsUniformValues(s,u){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}setShadowUniformValues(s,u){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;s.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}_drawDebugWireframe(s,u,g,x,w,T,I,k,N,F){const q=s.options.wireframe;if(q.terrain===!1&&q.layers2D===!1&&q.layers3D===!1)return;const V=s.context;if(!(!(!q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!q.layers2D||s._terrain&&s._terrain.renderingToTexture||!Kv.includes(this.name))||!(!q.layers3D||!dg.includes(this.name))))return;const X=V.gl,re=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,w,V);if(!re)return;const Q=[...this.fixedDefines];Q.push("DEBUG_WIREFRAME");const oe=s.getOrCreateProgram(this.name,{config:this.configuration,defines:Q});V.program.set(oe.program);const ie=(ge,be,Ae)=>{if(be[ge]&&Ae[ge])for(const Ie in be[ge])Ae[ge][Ie]&&Ae[ge][Ie].set(Ae.program,Ie,be[ge][Ie].current)};N&&N.setUniforms(oe.program,V,oe.binderUniforms,I,{zoom:k}),ie("fixedUniforms",this,oe),ie("terrainUniforms",this,oe),ie("globeUniforms",this,oe),ie("fogUniforms",this,oe),ie("lightsUniforms",this,oe),ie("shadowUniforms",this,oe),re.bind(),V.setColorMode(new Mr([X.ONE,X.ONE_MINUS_SRC_ALPHA,X.ZERO,X.ONE],o.am.transparent,[!0,!0,!0,!1])),V.setDepthMode(new Ht(u.func===X.LESS?X.LEQUAL:u.func,Ht.ReadOnly,u.range)),V.setStencilMode(mr.disabled);const ue=3*T.primitiveLength*2,pe=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ge=F||1;for(let be=0;be<ge;++be)oe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),X.drawElements(X.LINES,ue,X.UNSIGNED_SHORT,pe)}else F&&F>1?X.drawElementsInstanced(X.LINES,ue,X.UNSIGNED_SHORT,pe,F):X.drawElements(X.LINES,ue,X.UNSIGNED_SHORT,pe);w.bind(),V.program.set(this.program),V.setDepthMode(u),V.setStencilMode(g),V.setColorMode(x)}checkUniforms(s,u,g){if(this.fixedDefines.includes(u)){for(const x of Object.keys(g))if(!g[x].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${x} not set but required by ${u} being defined`)}}draw(s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe){const ie=s.context,ue=ie.gl;if(this.failedToCreate)return;ie.program.set(this.program),ie.setDepthMode(g),ie.setStencilMode(x),ie.setColorMode(w),ie.setCullFace(T);for(const be of Object.keys(this.fixedUniforms))this.fixedUniforms[be].set(this.program,be,I[be]);re&&re.setUniforms(this.program,ie,this.binderUniforms,V,{zoom:X});const pe={[ue.POINTS]:1,[ue.LINES]:2,[ue.TRIANGLES]:3,[ue.LINE_STRIP]:1}[u];this.checkUniforms(k,"RENDER_SHADOWS",this.shadowUniforms);const ge=oe&&oe>0?1:void 0;for(const be of q.get()){const Ae=be.vaos||(be.vaos={});if((Ae[k]||(Ae[k]=new _C)).bind(ie,this,N,re?re.getPaintVertexBuffers():[],F,be.vertexOffset,Q||[],ge),this.forceManualRenderingForInstanceIDShaders){const Ie=oe||1;for(let we=0;we<Ie;++we)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),F?ue.drawElements(u,be.primitiveLength*pe,ue.UNSIGNED_SHORT,be.primitiveOffset*pe*2):ue.drawArrays(u,be.vertexOffset,be.vertexLength)}else oe&&oe>1?ue.drawElementsInstanced(u,be.primitiveLength*pe,ue.UNSIGNED_SHORT,be.primitiveOffset*pe*2,oe):F?ue.drawElements(u,be.primitiveLength*pe,ue.UNSIGNED_SHORT,be.primitiveOffset*pe*2):ue.drawArrays(u,be.vertexOffset,be.vertexLength);u===ue.TRIANGLES&&F&&this._drawDebugWireframe(s,g,x,w,F,be,V,X,re,oe)}}}function pg(m,s,u=0){const g=Math.pow(2,s.tileID.overscaledZ),x=s.tileSize*Math.pow(2,m.transform.tileZoom)/g,w=x*(s.tileID.canonical.x+s.tileID.wrap*g),T=x*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(s,1,m.transform.tileZoom),u_pixel_coord_upper:[w>>16,T>>16],u_pixel_coord_lower:[65535&w,65535&T],u_pattern_transition:u}}const Gu={terrain:0,flat:1},Yv=o.bz(),Jv=(m,s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe,ie)=>{const ue=s.style.light,pe=ue.properties.get("position"),ge=[pe.x,pe.y,pe.z],be=o.dJ();ue.properties.get("anchor")==="viewport"&&(o.dK(be,-s.transform.angle),o.dL(ge,ge,be));const Ae=ue.properties.get("color").toPremultipliedRenderColor(null),Ie=s.transform,we={u_matrix:m,u_lightpos:ge,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yv,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Gu[N],u_base_type:Gu[F],u_ao:x,u_edge_radius:w,u_width_scale:T,u_flood_light_color:re,u_vertical_scale:Q,u_flood_light_intensity:oe,u_ground_shadow_factor:ie};return Ie.projection.name==="globe"&&(we.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],we.u_zoom_transition=q,we.u_inv_rot_matrix=X,we.u_merc_center=V,we.u_up_dir=Ie.projection.upVector(new o.cA(0,0,0),V[0]*o.aj,V[1]*o.aj),we.u_height_lift=k),we},D1=(m,s,u,g,x,w)=>({u_matrix:m,u_edge_radius:s,u_width_scale:u,u_vertical_scale:g,u_height_type:Gu[x],u_base_type:Gu[w]}),id=(m,s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe,ie)=>{const ue=Jv(m,s,u,g,x,w,T,I,N,F,q,V,X,re,Q,oe,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,I.overscaledZ)/k.tileSize/8};return o.h(ue,pg(s,k,ie),pe)},L1=(m,s,u)=>({u_matrix:m,u_emissive_strength:s,u_ground_shadow_factor:u}),j1=(m,s,u,g,x,w=0)=>o.h(L1(m,s,x),pg(u,g,w)),PC=(m,s,u,g)=>({u_matrix:m,u_world:u,u_emissive_strength:s,u_ground_shadow_factor:g}),CC=(m,s,u,g,x,w,T=0)=>o.h(j1(m,s,u,g,w,T),{u_world:x}),IC=(m,s)=>({u_matrix:m,u_ground_shadow_factor:s}),mg=(m,s,u,g,x)=>({u_matrix:m,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:u,u_height_scale:g,u_reset_depth:x}),Qv=(m,s)=>({u_matrix:m,u_normal_matrix:s,u_opacity:1}),e0=m=>({u_matrix:m}),N1=m=>({u_matrix:m}),od=(m,s,u,g,x,w,T,I)=>{const k=o.aj/w.tileSize;return{u_matrix:m,u_inv_rot_matrix:s,u_camera_to_center_distance:u.getCameraToCenterDistance(I),u_extrude_scale:[u.pixelsToGLUnits[0]/k,u.pixelsToGLUnits[1]/k],u_zoom_transition:g,u_tile_id:T,u_merc_center:x}},t0=(m,s,u=1)=>({u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:u}),z1=o.bz(),F1=(m,s,u,g,x,w,T)=>{const I=m.transform,k=I.projection.name==="globe",N=k?o.dM(I.zoom,s.canonical)*I._pixelsPerMercatorPixel:o.aw(u,1,w),F={u_matrix:s.projMatrix,u_extrude_scale:N,u_intensity:T,u_inv_rot_matrix:z1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){F.u_inv_rot_matrix=g,F.u_merc_center=x,F.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],F.u_zoom_transition=o.ah(I.zoom);const q=x[0]*o.aj,V=x[1]*o.aj;F.u_up_dir=I.projection.upVector(new o.cA(0,0,0),q,V)}return F};function gg(m,[s,u,g,x],[w,T]){if(w===T)return[0,0,0,0];const I=255*(m-1)/(m*(T-w));return[s*I,u*I,g*I,x*I]}function Uc(m,s,[u,g]){return u===g?0:.5/m+(s-u)*(m-1)/(m*(g-u))}const r0=(m,s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe,ie,ue,pe,ge)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:N,u_fade_t:F.mix,u_opacity:F.opacity*q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:q.paint.get("raster-brightness-min"),u_brightness_high:q.paint.get("raster-brightness-max"),u_saturation_factor:o.dO(q.paint.get("raster-saturation")),u_contrast_factor:o.dN(q.paint.get("raster-contrast")),u_spin_weights:Gc(q.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:X,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:k,u_colorization_mix:gg(o.dP,Q,ie),u_colorization_offset:Uc(o.dP,oe,ie),u_color_ramp:re,u_texture_offset:[pe/(ue+2*pe),ue/(ue+2*pe)],u_texture_res:[ue+2*pe,ue+2*pe],u_emissive_strength:ge});function Gc(m){m*=Math.PI/180;const s=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*s-u+1)/3,(Math.sqrt(3)*s-u+1)/3]}const Hc=.05,yg=(m,s,u,g,x,w,T,I,k,N,F,q)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:N,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:q,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:k}),B1=(m,s,u,g,x,w,T,I,k,N)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_tile_offset:u,u_velocity:g,u_color_ramp:w,u_velocity_res:x,u_max_speed:T,u_uv_offset:I,u_data_scale:[255*k[0],255*k[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[Hc,Hc]}),$1=(m,s,u,g,x,w,T,I,k,N)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_velocity:u,u_velocity_res:g,u_max_speed:x,u_speed_factor:w,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*k[0],255*k[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[Hc,Hc]}),_g=o.bz(),vg=(m,s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe,ie,ue,pe,ge,be,Ae,Ie)=>{const we=x.transform,Se={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:we.getCameraToCenterDistance(ue),u_rotate_symbol:+u,u_aspect_ratio:we.width/we.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+N,u_elevation_from_sea:k?1:0,u_pitch_with_map:+g,u_texsize:F,u_texsize_icon:q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_g,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:_g,u_up_vector:[0,-1,0],u_color_adj_mat:be,u_icon_transition:Ae||0,u_gamma_scale:g?x.transform.getCameraToCenterDistance(ue)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Ie||1,u_ground_shadow_factor:pe,u_inv_matrix:o.bi(o.bz(),T),u_normal_scale:ge};return ue.name==="globe"&&(Se.u_tile_id=[X.canonical.x,X.canonical.y,1<<X.canonical.z],Se.u_zoom_transition=re,Se.u_inv_rot_matrix=oe,Se.u_merc_center=Q,Se.u_camera_forward=we._camera.forward(),Se.u_ecef_origin=o.dQ(we.globeMatrix,X.toUnwrapped()),Se.u_tile_matrix=Float32Array.from(we.globeMatrix),Se.u_up_vector=ie),Se},V1=(m,s,u,g)=>({u_matrix:m,u_emissive_strength:s,u_opacity:u,u_color:g}),n0=(m,s,u,g,x,w,T,I,k)=>o.h(function(N,F,q,V,X,re){const{width:Q,height:oe}=V.imageManager.getPixelSize(F),ie=Math.pow(2,re.tileID.overscaledZ),ue=re.tileSize*Math.pow(2,V.transform.tileZoom)/ie,pe=ue*(re.tileID.canonical.x+re.tileID.wrap*ie),ge=ue*re.tileID.canonical.y;return{u_image:0,u_pattern_tl:q.tl,u_pattern_br:q.br,u_texsize:[Q,oe],u_pattern_size:q.displaySize,u_pattern_units_to_pixels:X?[V.transform.width,-1*V.transform.height]:[1/o.aw(re,1,V.transform.tileZoom),1/o.aw(re,1,V.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,ge>>16],u_pixel_coord_lower:[65535&pe,65535&ge]}}(0,w,T,g,I,k),{u_matrix:m,u_emissive_strength:s,u_opacity:u}),Hu=new Float32Array(o.bx([])),i0=(m,s,u,g,x,w,T,I,k,N,F,q,V,X=[0,0,0],re)=>{const Q=x.style.light,oe=Q.properties.get("position"),ie=[-oe.x,-oe.y,oe.z],ue=o.dJ();Q.properties.get("anchor")==="viewport"&&(o.dK(ue,-x.transform.angle),o.dL(ie,ie,ue));const pe=F.alphaMode==="MASK",ge=Q.properties.get("color").toNonPremultipliedRenderColor(null),be=V.paint.get("model-ambient-occlusion-intensity"),Ae=V.paint.get("model-color").constantOr(o.am.white).toNonPremultipliedRenderColor(null);return Ae.a=V.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:m,u_lighting_matrix:s,u_normal_matrix:u,u_node_matrix:g||Hu,u_lightpos:ie,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_camera_pos:X,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:k,u_roughnessFactor:N,u_baseColorTexture:ds.BaseColor,u_metallicRoughnessTexture:ds.MetallicRoughness,u_normalTexture:ds.Normal,u_occlusionTexture:ds.Occlusion,u_emissionTexture:ds.Emission,u_lutTexture:ds.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:be,u_emissive_strength:q,u_occlusionTextureTransform:re||[0,0,0,0]}},U1=(m,s=Hu,u=Hu)=>({u_matrix:m,u_instance:s,u_node_matrix:u}),G1={fillExtrusion:m=>({u_matrix:new o.ch(m),u_lightpos:new o.ce(m),u_lightintensity:new o.cf(m),u_lightcolor:new o.ce(m),u_vertical_gradient:new o.cf(m),u_opacity:new o.cf(m),u_edge_radius:new o.cf(m),u_width_scale:new o.cf(m),u_ao:new o.cg(m),u_height_type:new o.cd(m),u_base_type:new o.cd(m),u_tile_id:new o.ce(m),u_zoom_transition:new o.cf(m),u_inv_rot_matrix:new o.ch(m),u_merc_center:new o.cg(m),u_up_dir:new o.ce(m),u_height_lift:new o.cf(m),u_flood_light_color:new o.ce(m),u_vertical_scale:new o.cf(m),u_flood_light_intensity:new o.cf(m),u_ground_shadow_factor:new o.ce(m)}),fillExtrusionDepth:m=>({u_matrix:new o.ch(m),u_edge_radius:new o.cf(m),u_width_scale:new o.cf(m),u_vertical_scale:new o.cf(m),u_height_type:new o.cd(m),u_base_type:new o.cd(m)}),fillExtrusionPattern:m=>({u_matrix:new o.ch(m),u_lightpos:new o.ce(m),u_lightintensity:new o.cf(m),u_lightcolor:new o.ce(m),u_vertical_gradient:new o.cf(m),u_height_factor:new o.cf(m),u_edge_radius:new o.cf(m),u_width_scale:new o.cf(m),u_ao:new o.cg(m),u_height_type:new o.cd(m),u_base_type:new o.cd(m),u_tile_id:new o.ce(m),u_zoom_transition:new o.cf(m),u_inv_rot_matrix:new o.ch(m),u_merc_center:new o.cg(m),u_up_dir:new o.ce(m),u_height_lift:new o.cf(m),u_image:new o.cd(m),u_texsize:new o.cg(m),u_pixel_coord_upper:new o.cg(m),u_pixel_coord_lower:new o.cg(m),u_tile_units_to_pixels:new o.cf(m),u_opacity:new o.cf(m),u_pattern_transition:new o.cf(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new o.ch(m),u_opacity:new o.cf(m),u_ao_pass:new o.cf(m),u_meter_to_tile:new o.cf(m),u_ao:new o.cg(m),u_flood_light_intensity:new o.cf(m),u_flood_light_color:new o.ce(m),u_attenuation:new o.cf(m),u_edge_radius:new o.cf(m),u_fb:new o.cd(m),u_fb_size:new o.cf(m),u_dynamic_offset:new o.cf(m)}),fill:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_ground_shadow_factor:new o.ce(m)}),fillPattern:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_image:new o.cd(m),u_texsize:new o.cg(m),u_pixel_coord_upper:new o.cg(m),u_pixel_coord_lower:new o.cg(m),u_tile_units_to_pixels:new o.cf(m),u_ground_shadow_factor:new o.ce(m),u_pattern_transition:new o.cf(m)}),fillOutline:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_world:new o.cg(m),u_ground_shadow_factor:new o.ce(m)}),fillOutlinePattern:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_world:new o.cg(m),u_image:new o.cd(m),u_texsize:new o.cg(m),u_pixel_coord_upper:new o.cg(m),u_pixel_coord_lower:new o.cg(m),u_tile_units_to_pixels:new o.cf(m),u_ground_shadow_factor:new o.ce(m),u_pattern_transition:new o.cf(m)}),building:m=>({u_matrix:new o.ch(m),u_normal_matrix:new o.ch(m),u_opacity:new o.cf(m)}),buildingBloom:m=>({u_matrix:new o.ch(m)}),buildingDepth:m=>({u_matrix:new o.ch(m)}),elevatedStructuresDepth:m=>({u_matrix:new o.ch(m),u_depth_bias:new o.cf(m)}),elevatedStructures:m=>({u_matrix:new o.ch(m),u_ground_shadow_factor:new o.ce(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new o.ch(m),u_camera_pos:new o.ce(m),u_depth_bias:new o.cf(m),u_height_scale:new o.cf(m),u_reset_depth:new o.cf(m)}),circle:o.dT,collisionBox:m=>({u_matrix:new o.ch(m),u_inv_rot_matrix:new o.ch(m),u_camera_to_center_distance:new o.cf(m),u_extrude_scale:new o.cg(m),u_zoom_transition:new o.cf(m),u_merc_center:new o.cg(m),u_tile_id:new o.ce(m)}),collisionCircle:m=>({u_matrix:new o.ch(m),u_inv_matrix:new o.ch(m),u_camera_to_center_distance:new o.cf(m),u_viewport_size:new o.cg(m)}),debug:m=>({u_color:new o.dv(m),u_matrix:new o.ch(m),u_overlay:new o.cd(m),u_overlay_scale:new o.cf(m)}),clippingMask:m=>({u_matrix:new o.ch(m)}),heatmap:m=>({u_extrude_scale:new o.cf(m),u_intensity:new o.cf(m),u_matrix:new o.ch(m),u_inv_rot_matrix:new o.ch(m),u_merc_center:new o.cg(m),u_tile_id:new o.ce(m),u_zoom_transition:new o.cf(m),u_up_dir:new o.ce(m)}),heatmapTexture:m=>({u_image:new o.cd(m),u_color_ramp:new o.cd(m),u_opacity:new o.cf(m)}),hillshade:m=>({u_matrix:new o.ch(m),u_image:new o.cd(m),u_latrange:new o.cg(m),u_light:new o.cg(m),u_shadow:new o.dv(m),u_highlight:new o.dv(m),u_emissive_strength:new o.cf(m),u_accent:new o.dv(m)}),hillshadePrepare:m=>({u_matrix:new o.ch(m),u_image:new o.cd(m),u_dimension:new o.cg(m),u_zoom:new o.cf(m)}),line:o.dS,linePattern:o.dR,raster:m=>({u_matrix:new o.ch(m),u_normalize_matrix:new o.ch(m),u_globe_matrix:new o.ch(m),u_merc_matrix:new o.ch(m),u_grid_matrix:new o.dw(m),u_tl_parent:new o.cg(m),u_scale_parent:new o.cf(m),u_fade_t:new o.cf(m),u_opacity:new o.cf(m),u_image0:new o.cd(m),u_image1:new o.cd(m),u_brightness_low:new o.cf(m),u_brightness_high:new o.cf(m),u_saturation_factor:new o.cf(m),u_contrast_factor:new o.cf(m),u_spin_weights:new o.ce(m),u_perspective_transform:new o.cg(m),u_raster_elevation:new o.cf(m),u_zoom_transition:new o.cf(m),u_merc_center:new o.cg(m),u_cutoff_params:new o.d0(m),u_colorization_mix:new o.d0(m),u_colorization_offset:new o.cf(m),u_color_ramp:new o.cd(m),u_texture_offset:new o.cg(m),u_texture_res:new o.cg(m),u_emissive_strength:new o.cf(m)}),rasterParticle:m=>({u_matrix:new o.ch(m),u_normalize_matrix:new o.ch(m),u_globe_matrix:new o.ch(m),u_merc_matrix:new o.ch(m),u_grid_matrix:new o.dw(m),u_tl_parent:new o.cg(m),u_scale_parent:new o.cf(m),u_fade_t:new o.cf(m),u_opacity:new o.cf(m),u_image0:new o.cd(m),u_image1:new o.cd(m),u_raster_elevation:new o.cf(m),u_zoom_transition:new o.cf(m),u_merc_center:new o.cg(m),u_cutoff_params:new o.d0(m)}),rasterParticleTexture:m=>({u_texture:new o.cd(m),u_opacity:new o.cf(m)}),rasterParticleDraw:m=>({u_particle_texture:new o.cd(m),u_particle_texture_side_len:new o.cf(m),u_tile_offset:new o.cg(m),u_velocity:new o.cd(m),u_color_ramp:new o.cd(m),u_velocity_res:new o.cg(m),u_max_speed:new o.cf(m),u_uv_offset:new o.cg(m),u_data_scale:new o.cg(m),u_data_offset:new o.cf(m),u_particle_pos_scale:new o.cf(m),u_particle_pos_offset:new o.cg(m)}),rasterParticleUpdate:m=>({u_particle_texture:new o.cd(m),u_particle_texture_side_len:new o.cf(m),u_velocity:new o.cd(m),u_velocity_res:new o.cg(m),u_max_speed:new o.cf(m),u_speed_factor:new o.cf(m),u_reset_rate:new o.cf(m),u_rand_seed:new o.cf(m),u_uv_offset:new o.cg(m),u_data_scale:new o.cg(m),u_data_offset:new o.cf(m),u_particle_pos_scale:new o.cf(m),u_particle_pos_offset:new o.cg(m)}),symbol:m=>({u_is_size_zoom_constant:new o.cd(m),u_is_size_feature_constant:new o.cd(m),u_size_t:new o.cf(m),u_size:new o.cf(m),u_camera_to_center_distance:new o.cf(m),u_rotate_symbol:new o.cd(m),u_aspect_ratio:new o.cf(m),u_fade_change:new o.cf(m),u_matrix:new o.ch(m),u_label_plane_matrix:new o.ch(m),u_coord_matrix:new o.ch(m),u_is_text:new o.cd(m),u_elevation_from_sea:new o.cd(m),u_pitch_with_map:new o.cd(m),u_texsize:new o.cg(m),u_texsize_icon:new o.cg(m),u_texture:new o.cd(m),u_texture_icon:new o.cd(m),u_gamma_scale:new o.cf(m),u_device_pixel_ratio:new o.cf(m),u_tile_id:new o.ce(m),u_zoom_transition:new o.cf(m),u_inv_rot_matrix:new o.ch(m),u_merc_center:new o.cg(m),u_camera_forward:new o.ce(m),u_tile_matrix:new o.ch(m),u_up_vector:new o.ce(m),u_ecef_origin:new o.ce(m),u_is_halo:new o.cd(m),u_icon_transition:new o.cf(m),u_color_adj_mat:new o.ch(m),u_scale_factor:new o.cf(m),u_ground_shadow_factor:new o.ce(m),u_inv_matrix:new o.ch(m),u_normal_scale:new o.cf(m)}),background:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_opacity:new o.cf(m),u_color:new o.dv(m)}),backgroundPattern:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_opacity:new o.cf(m),u_image:new o.cd(m),u_pattern_tl:new o.cg(m),u_pattern_br:new o.cg(m),u_texsize:new o.cg(m),u_pattern_size:new o.cg(m),u_pixel_coord_upper:new o.cg(m),u_pixel_coord_lower:new o.cg(m),u_pattern_units_to_pixels:new o.cg(m)}),terrainRaster:m=>({u_matrix:new o.ch(m),u_image0:new o.cd(m),u_skirt_height:new o.cf(m),u_ground_shadow_factor:new o.ce(m)}),skybox:m=>({u_matrix:new o.ch(m),u_sun_direction:new o.ce(m),u_cubemap:new o.cd(m),u_opacity:new o.cf(m),u_temporal_offset:new o.cf(m)}),skyboxGradient:m=>({u_matrix:new o.ch(m),u_color_ramp:new o.cd(m),u_center_direction:new o.ce(m),u_radius:new o.cf(m),u_opacity:new o.cf(m),u_temporal_offset:new o.cf(m)}),skyboxCapture:m=>({u_matrix_3f:new o.dw(m),u_sun_direction:new o.ce(m),u_sun_intensity:new o.cf(m),u_color_tint_r:new o.d0(m),u_color_tint_m:new o.d0(m),u_luminance:new o.cf(m)}),globeRaster:m=>({u_proj_matrix:new o.ch(m),u_globe_matrix:new o.ch(m),u_normalize_matrix:new o.ch(m),u_merc_matrix:new o.ch(m),u_zoom_transition:new o.cf(m),u_merc_center:new o.cg(m),u_image0:new o.cd(m),u_grid_matrix:new o.dw(m),u_skirt_height:new o.cf(m),u_far_z_cutoff:new o.cf(m),u_frustum_tl:new o.ce(m),u_frustum_tr:new o.ce(m),u_frustum_br:new o.ce(m),u_frustum_bl:new o.ce(m),u_globe_pos:new o.ce(m),u_globe_radius:new o.cf(m),u_viewport:new o.cg(m)}),globeAtmosphere:m=>({u_frustum_tl:new o.ce(m),u_frustum_tr:new o.ce(m),u_frustum_br:new o.ce(m),u_frustum_bl:new o.ce(m),u_horizon:new o.cf(m),u_transition:new o.cf(m),u_fadeout_range:new o.cf(m),u_color:new o.d0(m),u_high_color:new o.d0(m),u_space_color:new o.d0(m),u_temporal_offset:new o.cf(m),u_horizon_angle:new o.cf(m)}),model:m=>({u_matrix:new o.ch(m),u_lighting_matrix:new o.ch(m),u_normal_matrix:new o.ch(m),u_node_matrix:new o.ch(m),u_lightpos:new o.ce(m),u_lightintensity:new o.cf(m),u_lightcolor:new o.ce(m),u_camera_pos:new o.ce(m),u_opacity:new o.cf(m),u_baseColorFactor:new o.d0(m),u_emissiveFactor:new o.d0(m),u_metallicFactor:new o.cf(m),u_roughnessFactor:new o.cf(m),u_baseTextureIsAlpha:new o.cd(m),u_alphaMask:new o.cd(m),u_alphaCutoff:new o.cf(m),u_baseColorTexture:new o.cd(m),u_metallicRoughnessTexture:new o.cd(m),u_normalTexture:new o.cd(m),u_occlusionTexture:new o.cd(m),u_emissionTexture:new o.cd(m),u_lutTexture:new o.cd(m),u_color_mix:new o.d0(m),u_aoIntensity:new o.cf(m),u_emissive_strength:new o.cf(m),u_occlusionTextureTransform:new o.d0(m)}),modelDepth:m=>({u_matrix:new o.ch(m),u_instance:new o.ch(m),u_node_matrix:new o.ch(m)}),groundShadow:m=>({u_matrix:new o.ch(m),u_ground_shadow_factor:new o.ce(m)}),stars:m=>({u_matrix:new o.ch(m),u_up:new o.ce(m),u_right:new o.ce(m),u_intensity_multiplier:new o.cf(m)}),snowParticle:m=>({u_modelview:new o.ch(m),u_projection:new o.ch(m),u_time:new o.cf(m),u_cam_pos:new o.ce(m),u_velocityConeAperture:new o.cf(m),u_velocity:new o.cf(m),u_horizontalOscillationRadius:new o.cf(m),u_horizontalOscillationRate:new o.cf(m),u_boxSize:new o.cf(m),u_billboardSize:new o.cf(m),u_simpleShapeParameters:new o.cg(m),u_screenSize:new o.cg(m),u_thinningCenterPos:new o.cg(m),u_thinningShape:new o.ce(m),u_thinningAffectedRatio:new o.cf(m),u_thinningParticleOffset:new o.cf(m),u_particleColor:new o.d0(m),u_direction:new o.ce(m)}),rainParticle:m=>({u_modelview:new o.ch(m),u_projection:new o.ch(m),u_time:new o.cf(m),u_cam_pos:new o.ce(m),u_texScreen:new o.cd(m),u_velocityConeAperture:new o.cf(m),u_velocity:new o.cf(m),u_boxSize:new o.cf(m),u_rainDropletSize:new o.cg(m),u_distortionStrength:new o.cf(m),u_rainDirection:new o.ce(m),u_color:new o.d0(m),u_screenSize:new o.cg(m),u_thinningCenterPos:new o.cg(m),u_thinningShape:new o.ce(m),u_thinningAffectedRatio:new o.cf(m),u_thinningParticleOffset:new o.cf(m),u_shapeDirectionalPower:new o.cf(m),u_shapeNormalPower:new o.cf(m),u_mode:new o.cf(m)}),vignette:m=>({u_vignetteShape:new o.ce(m),u_vignetteColor:new o.d0(m)}),occlusion:m=>({u_matrix:new o.ch(m),u_anchorPos:new o.ce(m),u_screenSizePx:new o.cg(m),u_occluderSizePx:new o.cg(m),u_color:new o.d0(m)})};class Wc{constructor(s,u,g,x){this.id=Wc.uniqueIdxCounter,Wc.uniqueIdxCounter++,this.context=s;const w=s.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||x||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=Wc.uniqueIdxCounter,Wc.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Wc.uniqueIdxCounter=0;const o0={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class s0{constructor(s,u,g,x,w,T){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=x,this.instanceCount=T,this.context=s;const I=s.gl;this.buffer=I.createBuffer(),s.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||w||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,u){for(let g=0;g<this.attributes.length;g++){const x=u.attributes[this.attributes[g].name];x!==void 0&&s.enableVertexAttribArray(x)}}setVertexAttribPointers(s,u,g){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],T=u.attributes[w.name];T!==void 0&&s.vertexAttribPointer(T,w.components,s[o0[w.type]],!1,this.itemSize,w.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,u,g){for(let x=0;x<this.attributes.length;x++){const w=u.attributes[this.attributes[x].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(w,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wu{constructor(s,u,g,x,w){this.context=s,this.width=u,this.height=g;const T=this.framebuffer=s.gl.createFramebuffer();x&&(this.colorAttachment=new AC(s,T)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new k1(s,T):new Gv(s,T))}destroy(){const s=this.context.gl;if(this.colorAttachment){const u=this.colorAttachment.get();u&&s.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&s.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&s.deleteTexture(u)}s.deleteFramebuffer(this.framebuffer)}}class xg{constructor(s,u){this.gl=s,this.clearColor=new xC(this),this.clearDepth=new bC(this),this.clearStencil=new wC(this),this.colorMask=new SC(this),this.depthMask=new T1(this),this.stencilMask=new TC(this),this.stencilFunc=new tg(this),this.stencilOp=new EC(this),this.stencilTest=new E1(this),this.depthRange=new Fv(this),this.depthTest=new rg(this),this.depthFunc=new Bv(this),this.blend=new Vu(this),this.blendFunc=new Qh(this),this.blendColor=new ng(this),this.blendEquation=new ig(this),this.cullFace=new ed(this),this.cullFaceSide=new A1(this),this.frontFace=new $v(this),this.program=new P1(this),this.activeTexture=new td(this),this.viewport=new og(this),this.bindFramebuffer=new sg(this),this.bindRenderbuffer=new Vv(this),this.bindTexture=new ag(this),this.bindVertexBuffer=new tp(this),this.bindElementBuffer=new C1(this),this.bindVertexArrayOES=new I1(this),this.pixelStoreUnpack=new M1(this),this.pixelStoreUnpackPremultiplyAlpha=new rd(this),this.pixelStoreUnpackFlipY=new O1(this),this.options=u?Object.assign({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=u&&!!u.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,u,g){return new Wc(this,s,u,g)}createVertexBuffer(s,u,g,x,w){return new s0(this,s,u,g,x,w)}createRenderbuffer(s,u,g){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,s,u,g),this.bindRenderbuffer.set(null),w}createFramebuffer(s,u,g,x){return new Wu(this,s,u,g,x)}clear({color:s,depth:u,stencil:g,colorMask:x}){const w=this.gl;let T=0;s&&(T|=w.COLOR_BUFFER_BIT,this.clearColor.set(s.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),u!==void 0&&(T|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),g!==void 0&&(T|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),w.clear(T)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){o.bv(s.blendFunction,Mr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let qc;function a0(m,s,u,g,x,w,T){const I=m.context,k=I.gl,N=m.transform,F=[o.aD(N.center.lng),o.aH(N.center.lat)],q=u.layout.get("symbol-placement"),V=u.layout.get("text-variable-anchor"),X=u.layout.get("icon-rotation-alignment")==="map",re=u.layout.get("text-rotation-alignment")==="map",Q=q!=="point",oe=[];let ie=0,ue=0;for(let Se=0;Se<g.length;Se++){const Te=g[Se],We=s.getTile(Te),je=We.getBucket(u);if(!je)continue;const ht=je.getProjection().createInversionMatrix(N,Te.canonical),tt=[],ft=h1(Te,je,N),Pt=!T&&X&&Q,qe=T&&re&&Q,De=V&&je.hasTextData(),st=je.hasIconTextFit()&&De&&je.hasIconData(),Xe=Pt||qe||T&&De||st,yt=je.projection.name==="globe",vt=yt?o.ah(N.zoom):0;yt&&(tt.push("PROJECTION_GLOBE_VIEW"),Xe&&tt.push("PROJECTED_POS_ON_VIEWPORT"));const bt=m.getOrCreateProgram("collisionBox",{defines:tt});let Dt=ft;x[0]===0&&x[1]===0||(Dt=m.translatePosMatrix(ft,We,x,w));const Jt=T?je.textCollisionBox:je.iconCollisionBox,or=je.collisionCircleArray;if(or.length>0){const rr=o.bz(),er=Dt;o.cM(rr,je.placementInvProjMatrix,N.glCoordMatrix),o.cM(rr,rr,je.placementViewportMatrix),oe.push({circleArray:or,circleOffset:ue,transform:er,invTransform:rr,projection:je.getProjection()}),ie+=or.length/4,ue=ie}if(!Jt)continue;m.terrain&&m.terrain.setupElevationDraw(We,bt);const $t=yt?[Te.canonical.x,Te.canonical.y,1<<Te.canonical.z]:[0,0,0];bt.draw(m,k.LINES,Ht.disabled,mr.disabled,m.colorModeForRenderPass(),ur.disabled,od(Dt,ht,N,vt,F,We,$t,je.getProjection()),u.id,Jt.layoutVertexBuffer,Jt.indexBuffer,Jt.segments,null,N.zoom,null,[Jt.collisionVertexBuffer,Jt.collisionVertexBufferExt])}if(!T||!oe.length)return;const pe=m.getOrCreateProgram("collisionCircle"),ge=new o.dU;ge.resize(4*ie),ge._trim();let be=0;for(const Se of oe)for(let Te=0;Te<Se.circleArray.length/4;Te++){const We=4*Te,je=Se.circleArray[We+0],ht=Se.circleArray[We+1],tt=Se.circleArray[We+2],ft=Se.circleArray[We+3];ge.emplace(be++,je,ht,tt,ft,0),ge.emplace(be++,je,ht,tt,ft,1),ge.emplace(be++,je,ht,tt,ft,2),ge.emplace(be++,je,ht,tt,ft,3)}(!qc||qc.length<2*ie)&&(qc=function(Se){const Te=2*Se,We=new o.a_;We.resize(Te),We._trim();for(let je=0;je<Te;je++){const ht=6*je;We.uint16[ht+0]=4*je+0,We.uint16[ht+1]=4*je+1,We.uint16[ht+2]=4*je+2,We.uint16[ht+3]=4*je+2,We.uint16[ht+4]=4*je+3,We.uint16[ht+5]=4*je+0}return We}(ie));const Ae=I.createIndexBuffer(qc,!0),Ie=I.createVertexBuffer(ge,o.dV.members,!0);for(const Se of oe){const Te={u_matrix:Se.transform,u_inv_matrix:Se.invTransform,u_camera_to_center_distance:(we=N).getCameraToCenterDistance(Se.projection),u_viewport_size:[we.width,we.height]};pe.draw(m,k.TRIANGLES,Ht.disabled,mr.disabled,m.colorModeForRenderPass(),ur.disabled,Te,u.id,Ie,Ae,o.bd.simpleSegment(0,2*Se.circleOffset,Se.circleArray.length,Se.circleArray.length/2),null,N.zoom)}var we;Ie.destroy(),Ae.destroy()}const qu=o.bz();function ip(m){const s=m._camera.getWorldToCamera(m.worldSize,1),u=o.az([],s,m.globeMatrix);o.bi(u,u);const g=[0,0,0],x=[0,1,0,0];return o.aA(x,x,u),g[0]=x[0],g[1]=x[1],g[2]=x[2],o.au(g,g),g}function l0({width:m,height:s,anchor:u,textOffset:g,textScale:x},w){const{horizontalAlign:T,verticalAlign:I}=o.bZ(u),k=-(T-.5)*m,N=-(I-.5)*s,F=o.b_(u,g);return new o.P((k/x+F[0])*w,(N/x+F[1])*w)}function H1(m,s,u,g,x,w,T,I,k,N){const F=m.text.placedSymbolArray,q=m.text.dynamicLayoutVertexArray,V=m.icon.dynamicLayoutVertexArray,X={},re=m.getProjection(),Q=Um(T,re,x),oe=x.elevation,ie=re.upVectorScale(T.canonical,x.center.lat,x.worldSize).metersToTile;q.clear();for(let ue=0;ue<F.length;ue++){const pe=F.get(ue),{tileAnchorX:ge,tileAnchorY:be,numGlyphs:Ae}=pe,Ie=pe.hidden||!pe.crossTileID||m.allowVerticalPlacement&&!pe.placedOrientation?null:g[pe.crossTileID];if(Ie){let we=0,Se=0,Te=0;if(oe){const st=oe?oe.getAtTileOffset(T,ge,be):0,[Xe,yt,vt]=re.upVector(T.canonical,ge,be);we=st*Xe*ie,Se=st*yt*ie,Te=st*vt*ie}let[We,je,ht,tt]=ea(pe.projectedAnchorX+we,pe.projectedAnchorY+Se,pe.projectedAnchorZ+Te,u?Q:w);const ft=Av(x.getCameraToCenterDistance(re),tt);let Pt=o.bJ(m.textSizeData,k,pe)*ft/o.bU;u&&(Pt*=m.tilePixelRatio/I);const qe=l0(Ie,Pt);u?({x:We,y:je,z:ht}=re.projectTilePoint(ge+qe.x,be+qe.y,T.canonical),[We,je,ht]=ea(We+we,je+Se,ht+Te,w)):(s&&qe._rotate(-x.angle),We+=qe.x,je+=qe.y,ht=0);const De=m.allowVerticalPlacement&&pe.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let st=0;st<Ae;st++)o.bL(q,We,je,ht,De);N&&pe.associatedIconIndex>=0&&(X[pe.associatedIconIndex]={x:We,y:je,z:ht,angle:De})}else Gh(Ae,q)}if(N){V.clear();const ue=m.icon.placedSymbolArray;for(let pe=0;pe<ue.length;pe++){const ge=ue.get(pe),{numGlyphs:be}=ge,Ae=X[pe];if(ge.hidden||!Ae)Gh(be,V);else{const{x:Ie,y:we,z:Se,angle:Te}=Ae;for(let We=0;We<be;We++)o.bL(V,Ie,we,Se,Te)}}m.icon.dynamicLayoutVertexBuffer.updateData(V)}m.text.dynamicLayoutVertexBuffer.updateData(q)}function c0(m,s,u,g,x,w,T={}){const I=u.paint.get("icon-translate"),k=u.paint.get("text-translate"),N=u.paint.get("icon-translate-anchor"),F=u.paint.get("text-translate-anchor"),q=u.layout.get("icon-rotation-alignment"),V=u.layout.get("text-rotation-alignment"),X=u.layout.get("icon-pitch-alignment"),re=u.layout.get("text-pitch-alignment"),Q=u.layout.get("icon-keep-upright"),oe=u.layout.get("text-keep-upright"),ie=u.paint.get("icon-color-saturation"),ue=u.paint.get("icon-color-contrast"),pe=u.paint.get("icon-color-brightness-min"),ge=u.paint.get("icon-color-brightness-max"),be=u.layout.get("symbol-elevation-reference")==="sea",Ae=m.context,Ie=Ae.gl,we=m.transform,Se=q==="map",Te=V==="map",We=X==="map",je=re==="map",ht=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let tt=!1;const ft=m.depthModeForSublayer(0,Ht.ReadOnly),Pt=new Ht(m.context.gl.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D),qe=[o.aD(we.center.lng),o.aH(we.center.lat)],De=u.layout.get("text-variable-anchor"),st=we.projection.name==="globe",Xe=[],yt=[0,-1,0];for(const vt of g){const bt=s.getTile(vt),Dt=bt.getBucket(u);if(!Dt||Dt.projection.name==="mercator"&&st||Dt.fullyClipped)continue;const Jt=Dt.projection.name==="globe",or=Jt?o.ah(we.zoom):0,$t=Um(vt,Dt.getProjection(),we),rr=we.calculatePixelsToTileUnitsMatrix(bt),er=De&&Dt.hasTextData(),_r=Dt.hasIconTextFit()&&er&&Dt.hasIconData(),Ar=Dt.getProjection().createInversionMatrix(we,vt.canonical),zr=(1<<bt.tileID.canonical.z)*o.aj/m.transform.worldSize,on=Mn=>{let hn=[0,0,0];if(Mn){const ui=m.style.directionalLight,rn=m.style.ambientLight;ui&&rn&&(hn=Bu(m.style,ui,rn))}return hn},wr=Mn=>{we.depthOcclusionForSymbolsAndCircles&&(u.hasInitialOcclusionOpacityProperties||m.terrain)&&(Mn.push("DEPTH_D24"),Mn.push("DEPTH_OCCLUSION"))},sn=()=>{const Mn=Se&&u.layout.get("symbol-placement")!=="point",hn=[];wr(hn);const ui=Mn||_r,rn=Dt.elevationType==="road",yn=m.shadowRenderer,Nn=rn&&We&&!!yn&&yn.enabled,Di=on(Nn),Oi=rn&&We&&!m.terrain?Pt:ft,zi=u.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&We&&hn.push("PITCH_WITH_MAP_TERRAIN"),Jt&&(hn.push("PROJECTION_GLOBE_VIEW"),ui&&hn.push("PROJECTED_POS_ON_VIEWPORT")),zi>0&&Dt.hasAnySecondaryIcon&&hn.push("ICON_TRANSITION"),!Dt.icon.zOffsetVertexBuffer||rn&&m.terrain||hn.push("Z_OFFSET"),ie===0&&ue===0&&pe===0&&ge===1||hn.push("COLOR_ADJUSTMENT"),Dt.sdfIcons&&hn.push("RENDER_SDF"),Nn&&hn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),rn&&We&&!m.terrain&&Dt.icon.orientationVertexBuffer&&hn.push("ELEVATED_ROADS");const So=Dt.icon.programConfigurations.get(u.id),rl=m.getOrCreateProgram("symbol",{config:So,defines:hn}),ms=bt.imageAtlasTexture?bt.imageAtlasTexture.size:[0,0],$s=Dt.iconSizeData,zo=o.bH($s,we.zoom),sa=We||!we.isOrthographic,Da=Vf($t,bt.tileID.canonical,We,Se,we,Dt.getProjection(),rr),Fo=Xl($t,bt.tileID.canonical,We,Se,we,Dt.getProjection(),rr),Ei=m.translatePosMatrix(Fo,bt,I,N,!0),gi=m.translatePosMatrix($t,bt,I,N),Un=ui?qu:Da,Hi=Se&&!We&&!Mn;let To=yt;!st&&!we.mercatorFromTransition||Se||(To=ip(we));const Ai=Jt?To:yt,aa=u.getColorAdjustmentMatrix(ie,ue,pe,ge),Yu=vg($s.kind,zo,Hi,We,m,gi,Un,Ei,be,!1,ms,[0,0],0,vt,or,qe,Ar,Ai,Dt.getProjection(),Di,zr,aa,zi,null),eu=bt.imageAtlasTexture?bt.imageAtlasTexture:null,xd=u.layout.get("icon-size").constantOr(0)!==1||Dt.iconsNeedLinear,bd=Dt.sdfIcons||m.options.rotating||m.options.zooming||xd||sa?Ie.LINEAR:Ie.NEAREST,la=Dt.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,wl=m.terrain&&We&&Mn?o.bi(o.bz(),Da):qu;if(Mn&&Dt.icon){const Wi=we.elevation,ca=Wi?Wi.getAtTileOffsetFunc(vt,we.center.lat,we.worldSize,Dt.getProjection()):null,Ju=Uh($t,bt.tileID.canonical,We,Se,we,Dt.getProjection(),rr);Nu(Dt,$t,m,!1,Ju,Fo,We,Q,ca,vt)}return{program:rl,buffers:Dt.icon,uniformValues:Yu,atlasTexture:eu,atlasTextureIcon:null,atlasInterpolation:bd,atlasInterpolationIcon:null,isSDF:Dt.sdfIcons,hasHalo:la,depthMode:Oi,tile:bt,renderWithShadows:Nn,labelPlaneMatrixInv:wl}},un=()=>{const Mn=Te&&u.layout.get("symbol-placement")!=="point",hn=[],ui=Mn||De||_r,rn=Dt.elevationType==="road",yn=m.shadowRenderer,Nn=rn&&je&&!!yn&&yn.enabled,Di=on(Nn),Oi=rn&&je&&!m.terrain?Pt:ft;m.terrainRenderModeElevated()&&je&&hn.push("PITCH_WITH_MAP_TERRAIN"),Jt&&(hn.push("PROJECTION_GLOBE_VIEW"),ui&&hn.push("PROJECTED_POS_ON_VIEWPORT")),!Dt.text.zOffsetVertexBuffer||rn&&m.terrain||hn.push("Z_OFFSET"),Dt.iconsInText&&hn.push("RENDER_TEXT_AND_SYMBOL"),hn.push("RENDER_SDF"),Nn&&hn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),rn&&je&&!m.terrain&&Dt.text.orientationVertexBuffer&&hn.push("ELEVATED_ROADS"),wr(hn);const zi=Dt.text.programConfigurations.get(u.id),So=m.getOrCreateProgram("symbol",{config:zi,defines:hn});let rl,ms=[0,0],$s=null;const zo=Dt.textSizeData;Dt.iconsInText&&(ms=bt.imageAtlasTexture?bt.imageAtlasTexture.size:[0,0],$s=bt.imageAtlasTexture?bt.imageAtlasTexture:null,rl=je||!we.isOrthographic||m.options.rotating||m.options.zooming||zo.kind==="composite"||zo.kind==="camera"?Ie.LINEAR:Ie.NEAREST);const sa=bt.glyphAtlasTexture?bt.glyphAtlasTexture.size:[0,0],Da=u.layout.get("text-size-scale-range"),Fo=o.ay(m.scaleFactor,Da[0],Da[1]),Ei=o.bH(zo,we.zoom,Fo),gi=Vf($t,bt.tileID.canonical,je,Te,we,Dt.getProjection(),rr),Un=Xl($t,bt.tileID.canonical,je,Te,we,Dt.getProjection(),rr),Hi=m.translatePosMatrix(Un,bt,k,F,!0),To=m.translatePosMatrix($t,bt,k,F),Ai=ui?qu:gi,aa=Te&&!je&&!Mn;let Yu=yt;!st&&!we.mercatorFromTransition||Te||(Yu=ip(we));const eu=vg(zo.kind,Ei,aa,je,m,To,Ai,Hi,be,!0,sa,ms,0,vt,or,qe,Ar,Jt?Yu:yt,Dt.getProjection(),Di,zr,null,null,Fo),xd=bt.glyphAtlasTexture?bt.glyphAtlasTexture:null,bd=Ie.LINEAR,la=u.paint.get("text-halo-width").constantOr(1)!==0,wl=m.terrain&&je&&Mn?o.bi(o.bz(),gi):qu;if(Mn&&Dt.text){const Wi=we.elevation,ca=Wi?Wi.getAtTileOffsetFunc(vt,we.center.lat,we.worldSize,Dt.getProjection()):null,Ju=Uh($t,bt.tileID.canonical,je,Te,we,Dt.getProjection(),rr);Nu(Dt,$t,m,!0,Ju,Un,je,oe,ca,vt)}return{program:So,buffers:Dt.text,uniformValues:eu,atlasTexture:xd,atlasTextureIcon:$s,atlasInterpolation:bd,atlasInterpolationIcon:rl,isSDF:!0,hasHalo:la,depthMode:Oi,tile:bt,renderWithShadows:Nn,labelPlaneMatrixInv:wl}},Bn=Dt.icon.segments.get().length,Lr=Dt.text.segments.get().length,an=Bn&&!T.onlyText?sn():null,cn=Lr&&!T.onlyIcons?un():null,gn=u.paint.get("icon-opacity").constantOr(1),Fr=u.paint.get("text-opacity").constantOr(1);if(ht&&Dt.canOverlap){tt=!0;const Mn=gn&&!T.onlyText?Dt.icon.segments.get():[],hn=Fr&&!T.onlyIcons?Dt.text.segments.get():[];for(const ui of Mn)Xe.push({segments:new o.bd([ui]),sortKey:ui.sortKey,state:an});for(const ui of hn)Xe.push({segments:new o.bd([ui]),sortKey:ui.sortKey,state:cn})}else T.onlyText||Xe.push({segments:gn?Dt.icon.segments:new o.bd([]),sortKey:0,state:an}),T.onlyIcons||Xe.push({segments:Fr?Dt.text.segments:new o.bd([]),sortKey:0,state:cn})}tt&&Xe.sort((vt,bt)=>vt.sortKey-bt.sortKey);for(const vt of Xe){const bt=vt.state;if(bt)if(m.terrain?m.terrain.setupElevationDraw(bt.tile,bt.program,{useDepthForOcclusion:we.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:bt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(we.depthOcclusionForSymbolsAndCircles,bt.program),Ae.activeTexture.set(Ie.TEXTURE0),bt.atlasTexture&&bt.atlasTexture.bind(bt.atlasInterpolation,Ie.CLAMP_TO_EDGE,!0),bt.atlasTextureIcon&&(Ae.activeTexture.set(Ie.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,Ie.CLAMP_TO_EDGE,!0)),bt.renderWithShadows&&m.shadowRenderer.setupShadows(bt.tile.tileID.toUnwrapped(),bt.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,bt.program),bt.hasHalo){const Dt=bt.uniformValues;Dt.u_is_halo=1,Zc(bt.buffers,vt.segments,u,m,bt.program,bt.depthMode,x,w,Dt,2),Dt.u_is_halo=0}else{if(bt.isSDF){const Dt=bt.uniformValues;bt.hasHalo&&(Dt.u_is_halo=1,Zc(bt.buffers,vt.segments,u,m,bt.program,bt.depthMode,x,w,Dt,1)),Dt.u_is_halo=0}Zc(bt.buffers,vt.segments,u,m,bt.program,bt.depthMode,x,w,bt.uniformValues,1)}}}function Zc(m,s,u,g,x,w,T,I,k,N){const F=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];x.draw(g,g.context.gl.TRIANGLES,w,T,I,ur.disabled,k,u.id,m.layoutVertexBuffer,m.indexBuffer,s,u.paint,g.transform.zoom,m.programConfigurations.get(u.id),F,N)}function op(m,s){const u=1<<m.canonical.z,g=(s.x*u-m.canonical.x-m.wrap*u)*o.aj,x=(s.y*u-m.canonical.y)*o.aj,w=o.e2(s.z,s.y);return o.d2(g,x,w)}function Wt(m,s,u,g,x){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const w=m.context.gl,T=new Ht(m.context.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D),I=new Ht(m.context.gl.GREATER,Ht.ReadWrite,m.depthRangeFor3D),k=function(X){const re=o.cU(X.pitch);let Q=.01;return X.isOrthographic&&(Q=o.ai(1e-4,Q,o.cZ(re>=wo?1:re/wo))),2*Q}(m.transform),N=m.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",q=m.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),V=m.getOrCreateProgram(F);for(const X of g){const re=s.getTile(X),Q=re.getBucket(u);if(!Q)continue;const oe=Q.elevatedStructures;if(!oe)continue;const ie=Q.elevationBufferData.heightRange,ue=op(X.toUnwrapped(),N),pe=m.translatePosMatrix(X.projMatrix,re,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));let ge,be,Ae,Ie;if(x==="initialize"){if(!ie||ie.min>=1||oe.depthSegments.segments[0].primitiveLength===0)continue;ge=mg(pe,ue,k,1,0),be=T,Ae=oe.depthSegments,Ie=q}else if(x==="reset"){if(!ie||ie.min>=0||oe.maskSegments.segments[0].primitiveLength===0)continue;ge=mg(pe,ue,0,0,1),be=I,Ae=oe.maskSegments,Ie=q}else if(x==="geometry"){if(oe.depthSegments.segments[0].primitiveLength===0)continue;ge=mg(pe,ue,k,1,0),be=T,Ae=oe.depthSegments,Ie=V}Ie.draw(m,w.TRIANGLES,be,mr.disabled,Mr.disabled,ur.disabled,ge,u.id,oe.vertexBuffer,oe.indexBuffer,Ae,u.paint,m.transform.zoom)}}function bg(m,s,u){const{painter:g,sourceCache:x,layer:w,coords:T,colorMode:I,elevationType:k,terrainEnabled:N,pass:F}=m,q=g.context.gl,V=w.paint.get("fill-pattern"),X=w.paint.get("fill-pattern-cross-fade"),re=V.constantOr(null);let Q=k;k!=="road"||s&&!N||(Q="none");const oe=Q==="road",ie=m.painter.shadowRenderer,ue=oe&&!!ie&&ie.enabled,pe=new Ht(g.context.gl.LEQUAL,Ht.ReadOnly,g.depthRangeFor3D);let ge=[0,0,0];if(ue){const Ie=g.style.directionalLight,we=g.style.ambientLight;Ie&&we&&(ge=Bu(g.style,Ie,we))}const be=V&&V.constantOr(1),Ae=(Ie,we)=>{let Se,Te,We,je,ht;we?(Se=be&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",We=q.LINES):(Se=be?"fillPattern":"fill",We=q.TRIANGLES);for(const tt of T){const ft=x.getTile(tt);if(be&&!ft.patternsLoaded())continue;const Pt=ft.getBucket(w);if(!Pt)continue;const qe=s?Pt.elevationBufferData:Pt.bufferData;if(qe.isEmpty())continue;g.prepareDrawTile();const De=qe.programConfigurations.get(w.id),st=g.isTileAffectedByFog(tt),Xe=[],yt=[];oe&&(Xe.push("ELEVATED_ROADS"),yt.push(qe.elevatedLayoutVertexBuffer)),ue&&Xe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),be&&(g.context.activeTexture.set(q.TEXTURE0),ft.imageAtlasTexture&&ft.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),De.updatePaintBuffers());let vt=!1;if(re&&ft.imageAtlas){const $t=ft.imageAtlas,rr=o.dZ.from(re),er=rr.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),_r=rr.getSecondary(),Ar=$t.patternPositions.get(er),zr=_r?$t.patternPositions.get(_r.scaleSelf(o.q.devicePixelRatio).toString()):null;vt=!!Ar&&!!zr,Ar&&De.setConstantPatternPositions(Ar,zr)}X>0&&(vt||De.getPatternTransitionVertexBuffer("fill-pattern"))&&Xe.push("FILL_PATTERN_TRANSITION");const bt=g.getOrCreateProgram(Se,{config:De,overrideFog:st,defines:Xe}),Dt=g.translatePosMatrix(tt.projMatrix,ft,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));ue&&ie.setupShadows(ft.tileID.toUnwrapped(),bt,"vector-tile");const Jt=w.paint.get("fill-emissive-strength");if(we){je=qe.lineIndexBuffer,ht=qe.lineSegments;const $t=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[q.drawingBufferWidth,q.drawingBufferHeight];Te=Se==="fillOutlinePattern"&&be?CC(Dt,Jt,g,ft,$t,ge,X):PC(Dt,Jt,$t,ge)}else je=qe.indexBuffer,ht=qe.triangleSegments,Te=be?j1(Dt,Jt,g,ft,ge,X):L1(Dt,Jt,ge);g.uploadCommonUniforms(g.context,bt,tt.toUnwrapped());let or=Ie;(k==="road"&&!N||k==="offset")&&(or=pe),bt.draw(g,We,or,u||g.stencilModeForClipping(tt),I,ur.disabled,Te,w.id,qe.layoutVertexBuffer,je,ht,w.paint,g.transform.zoom,De,yt)}};g.renderPass===F&&Ae(g.depthModeForSublayer(1,g.renderPass==="opaque"?Ht.ReadWrite:Ht.ReadOnly),!1),Q==="none"&&g.renderPass==="translucent"&&w.paint.get("fill-antialias")&&Ae(g.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Ht.ReadOnly),!0)}function sp(m,s,u,g,x,w,T,I){u.resetLayerRenderingStats(m);const k=m.context,N=k.gl,F=m.transform,q=u.paint.get("fill-extrusion-pattern"),V=u.paint.get("fill-extrusion-pattern-cross-fade"),X=q.constantOr(null),re=q.constantOr(1),Q=u.paint.get("fill-extrusion-opacity"),oe=m.style.enable3dLights(),ie=u.paint.get(oe&&!re?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ue=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),ie],pe=u.layout.get("fill-extrusion-edge-radius"),ge=pe>0&&!u.paint.get("fill-extrusion-rounded-roof"),be=ge?0:pe,Ae=F.projection.name==="globe"?o.e5():0,Ie=F.projection.name==="globe",we=Ie?o.ah(F.zoom):0,Se=[o.aD(F.center.lng),o.aH(F.center.lat)],Te=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",We=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Te?null:u.lut).toArray01().slice(0,3),je=u.paint.get("fill-extrusion-flood-light-intensity"),ht=u.paint.get("fill-extrusion-vertical-scale"),tt=u.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ft=u.paint.get("fill-extrusion-height-alignment"),Pt=u.paint.get("fill-extrusion-base-alignment"),qe=yl(m,u.paint.get("fill-extrusion-cutoff-fade-range")),De=[];let st;Ie&&De.push("PROJECTION_GLOBE_VIEW"),ue[0]>0&&De.push("FAUX_AO"),ge&&De.push("ZERO_ROOF_RADIUS"),I&&De.push("HAS_CENTROID"),je>0&&De.push("FLOOD_LIGHT"),qe.shouldRenderCutoff&&De.push("RENDER_CUTOFF"),tt&&De.push("RENDER_WALL_MODE");const Xe=m.renderPass==="shadow",yt=m.shadowRenderer,vt=Xe&&!!yt,bt=Xe?ur.disabled:ur.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Dt=[0,0,0];if(yt){const $t=m.style.directionalLight,rr=m.style.ambientLight;$t&&rr&&(Dt=Bu(m.style,$t,rr)),Xe||(De.push("RENDER_SHADOWS","DEPTH_TEXTURE"),yt.useNormalOffset&&De.push("NORMAL_OFFSET")),st=De.concat(["SHADOWS_SINGLE_CASCADE"])}const Jt=vt?"fillExtrusionDepth":re?"fillExtrusionPattern":"fillExtrusion",or=u.getLayerRenderingStats();for(const $t of g){const rr=s.getTile($t),er=rr.getBucket(u);if(!er||er.projection.name!==F.projection.name)continue;let _r=!1;yt&&(_r=yt.getMaxCascadeForTile($t.toUnwrapped())===0);const Ar=m.isTileAffectedByFog($t),zr=er.programConfigurations.get(u.id);let on=!1;if(X&&rr.imageAtlas){const cn=rr.imageAtlas,gn=o.dZ.from(X),Fr=gn.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Mn=gn.getSecondary(),hn=cn.patternPositions.get(Fr),ui=Mn?cn.patternPositions.get(Mn.scaleSelf(o.q.devicePixelRatio).toString()):null;on=!!hn&&!!ui,hn&&zr.setConstantPatternPositions(hn,ui)}V>0&&(on||zr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&De.push("FILL_EXTRUSION_PATTERN_TRANSITION");const wr=m.getOrCreateProgram(Jt,{config:zr,defines:_r?st:De,overrideFog:Ar});if(m.terrain&&m.terrain.setupElevationDraw(rr,wr,{useMeterToDem:!0}),!er.centroidVertexBuffer){const cn=wr.attributes.a_centroid_pos;cn!==void 0&&N.vertexAttrib2f(cn,0,0)}!Xe&&yt&&yt.setupShadows(rr.tileID.toUnwrapped(),wr,"vector-tile"),re&&(m.context.activeTexture.set(N.TEXTURE0),rr.imageAtlasTexture&&rr.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),zr.updatePaintBuffers());const sn=u.paint.get("fill-extrusion-vertical-gradient"),un=1/er.tileToMeter;let Bn;if(Xe&&yt){if(wg(rr.tileID,er.maxHeight,m))continue;const cn=yt.calculateShadowPassMatrixFromTile(rr.tileID.toUnwrapped());Bn=D1(cn,be,un,ht,ft,Pt)}else{const cn=m.translatePosMatrix($t.expandedProjMatrix,rr,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),gn=F.projection.createInversionMatrix(F,$t.canonical);Bn=re?id(cn,m,sn,Q,ue,be,un,$t,rr,Ae,ft,Pt,we,Se,gn,We,ht,V):Jv(cn,m,sn,Q,ue,be,un,$t,Ae,ft,Pt,we,Se,gn,We,ht,je,Dt)}m.uploadCommonUniforms(k,wr,$t.toUnwrapped(),null,qe);let Lr=er.segments;if(F.projection.name==="mercator"&&!Xe&&(Lr=er.getVisibleSegments(rr.tileID,m.terrain,m.transform.getFrustum(0)),!Lr.get().length))continue;if(or)if(Xe)for(const cn of Lr.get())or.numRenderedVerticesInShadowPass+=cn.primitiveLength;else for(const cn of Lr.get())or.numRenderedVerticesInTransparentPass+=cn.primitiveLength;const an=[];(m.terrain||I)&&an.push(er.centroidVertexBuffer),Ie&&an.push(er.layoutVertexExtBuffer),tt&&an.push(er.wallVertexBuffer),wr.draw(m,k.gl.TRIANGLES,x,w,T,bt,Bn,u.id,er.layoutVertexBuffer,er.indexBuffer,Lr,u.paint,m.transform.zoom,zr,an)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class Jl{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Ms(m,s,u,g,x,w,T,I,k,N,F,q,V,X,re,Q,oe,ie,ue,pe){const ge=s.context,be=ge.gl,Ae=s.transform,Ie=s.transform.zoom,we=[],Se=m.translate,Te=m.translateAnchor,We=m.edgeRadius,je=yl(s,m.cutoffFadeRange);F==="clear"?(we.push("CLEAR_SUBPASS"),pe&&(we.push("CLEAR_FROM_TEXTURE"),ge.activeTexture.set(be.TEXTURE0),pe.bind(be.LINEAR,be.CLAMP_TO_EDGE))):F==="sdf"&&we.push("SDF_SUBPASS"),ie&&we.push("HAS_CENTROID"),je.shouldRenderCutoff&&we.push("RENDER_CUTOFF");const ht=(tt,ft,Pt,qe,De)=>{const st=ft.programConfigurations.get(g.id),Xe=s.isTileAffectedByFog(tt),yt=s.getOrCreateProgram("fillExtrusionGroundEffect",{config:st,defines:we,overrideFog:Xe}),vt=((Dt,Jt,or,$t,rr,er,_r,Ar,zr,on,wr)=>({u_matrix:Jt,u_opacity:or,u_ao_pass:$t?1:0,u_meter_to_tile:rr,u_ao:er,u_flood_light_intensity:_r,u_flood_light_color:Ar,u_attenuation:zr,u_edge_radius:on,u_fb:0,u_fb_size:wr,u_dynamic_offset:1}))(0,qe,q,N,De,[V,X*De],re,Q,oe,Ie>=17?0:We*De,pe?pe.size[0]:0),bt=[];ie&&bt.push(ft.hiddenByLandmarkVertexBuffer),s.uploadCommonUniforms(ge,yt,tt.toUnwrapped(),null,je),yt.draw(s,ge.gl.TRIANGLES,w,T,I,k,vt,g.id,ft.vertexBuffer,ft.indexBuffer,Pt,g.paint,Ie,st,bt)};for(const tt of x){const ft=u.getTile(tt),Pt=ft.getBucket(g);if(!Pt||Pt.projection.name!==Ae.projection.name||!Pt.groundEffect||Pt.groundEffect&&!Pt.groundEffect.hasData())continue;const qe=Pt.groundEffect,De=1/Pt.tileToMeter;{const st=s.translatePosMatrix(tt.projMatrix,ft,Se,Te),Xe=qe.getDefaultSegment();ht(tt,qe,Xe,st,De)}if(ue)for(let st=0;st<4;st++){const Xe=o.e3[st](tt),yt=u.getTile(Xe);if(!yt)continue;const vt=yt.getBucket(g);if(!vt||vt.projection.name!==Ae.projection.name||!vt.groundEffect||vt.groundEffect&&!vt.groundEffect.hasData())continue;const bt=vt.groundEffect;let Dt,Jt;st===0?(Dt=[-o.aj,0,0],Jt=1):st===1?(Dt=[o.aj,0,0],Jt=0):st===2?(Dt=[0,-o.aj,0],Jt=3):(Dt=[0,o.aj,0],Jt=2);const or=bt.regionSegments[Jt];if(!or)continue;const $t=new Float32Array(16);o.bo($t,tt.projMatrix,Dt),ht(tt,bt,or,s.translatePosMatrix($t,ft,Se,Te),De)}}}function dr(m,s,u,g,x,w,T){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const I=w?w.findDEMTileFor(u):null;if(!(I&&I.dem||T))return;w&&I&&I.dem&&g.selfDEMTileTimestamp!==I.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=I.dem._timestamp);const k=ie=>new o.P(Math.ceil((ie+o.e7)*o.e8),0),N=ie=>{const ue=s.getSource().minzoom,pe=be=>{const Ae=s.getTileByID(be);if(Ae&&Ae.hasData())return Ae.getBucket(x)},ge=[0,-1,1];for(const be of ge){if(ie.overscaledZ+be<ue)continue;const Ae=pe(ie.calculateScaledKey(ie.overscaledZ+be));if(Ae)return Ae}},F=[0,0,0],q=(ie,ue)=>(F[0]=Math.min(ie.min.y,ue.min.y),F[1]=Math.max(ie.max.y,ue.max.y),F[2]=o.aj-ue.min.x>ie.max.x?ue.min.x-o.aj:ie.max.x,F),V=(ie,ue)=>(F[0]=Math.min(ie.min.x,ue.min.x),F[1]=Math.max(ie.max.x,ue.max.x),F[2]=o.aj-ue.min.y>ie.max.y?ue.min.y-o.aj:ie.max.y,F),X=[(ie,ue)=>q(ie,ue),(ie,ue)=>q(ue,ie),(ie,ue)=>V(ie,ue),(ie,ue)=>V(ue,ie)],re=(ie,ue,pe,ge,be,Ae,Ie)=>{if(!w)return 0;const we=[[Ae?pe:ie,Ae?ie:pe,0],[Ae?pe:ue,Ae?ue:pe,0]],Se=Ie<0?o.aj+Ie:Ie,Te=[Ae?Se:(ie+ue)/2,Ae?(ie+ue)/2:Se,0];return pe===0&&Ie<0||pe!==0&&Ie>0?w.getForTilePoints(be,[Te],!0,ge):we.push(Te),w.getForTilePoints(u,we,!0,I),Math.max(we[0][2],we[1][2],Te[2])/w.exaggeration()};for(let ie=0;ie<4;ie++){const ue=g.borderFeatureIndices[ie];if(ue.length===0)continue;const pe=o.e3[ie](u),ge=N(pe);if(!(ge&&ge instanceof o.e4))continue;const be=w?w.findDEMTileFor(pe):null;if(!(be&&be.dem||T)||(w&&be&&be.dem&&g.borderDEMTileTimestamp[ie]!==be.dem._timestamp&&(g.borderDoneWithNeighborZ[ie]=-1,g.borderDEMTileTimestamp[ie]=be.dem._timestamp),g.borderDoneWithNeighborZ[ie]===ge.canonical.z))continue;ge.centroidVertexArray.length===0&&ge.createCentroidsBuffer();const Ae=(ie<2?1:5)-ie,Ie=ge.borderDoneWithNeighborZ[Ae]!==g.canonical.z,we=ge.borderFeatureIndices[Ae];let Se=0;if(g.canonical.z!==ge.canonical.z){for(const Te of ue)g.showCentroid(g.featuresOnBorder[Te]);if(Ie)for(const Te of we)ge.showCentroid(ge.featuresOnBorder[Te]);g.borderDoneWithNeighborZ[ie]=ge.canonical.z,ge.borderDoneWithNeighborZ[Ae]=g.canonical.z}for(const Te of ue){const We=g.featuresOnBorder[Te],je=g.centroidData[We.centroidDataIndex],ht=We.borders[ie];let tt;for(;Se<we.length;){tt=ge.featuresOnBorder[we[Se]];const ft=tt.borders[Ae];if(ft[1]>ht[0]+3||ft[0]>ht[0]-3)break;ge.showCentroid(tt),Se++}if(tt&&Se<we.length){const ft=Se;let Pt=0;for(;!(tt.borders[Ae][0]>ht[1]-3)&&(Pt++,++Se!==we.length);)tt=ge.featuresOnBorder[we[Se]];tt=ge.featuresOnBorder[we[ft]];let qe=!1;if(Pt>=1){const Xe=tt.borders[Ae];Math.abs(ht[0]-Xe[0])<3&&Math.abs(ht[1]-Xe[1])<3&&(Pt=1,qe=!0,Se=ft+1)}else if(Pt===0){g.showCentroid(We);continue}const De=ge.centroidData[tt.centroidDataIndex];T&&qe&&(((Q=je).flags|(oe=De).flags)&o.e6?(Q.flags|=o.e6,oe.flags|=o.e6):(Q.flags&=~o.e6,oe.flags&=~o.e6));const st=We.intersectsCount()>1||tt.intersectsCount()>1;if(Pt>1)Se=ft,je.centroidXY=De.centroidXY=new o.P(0,0);else if(be&&be.dem&&!st){const Xe=X[ie](je,De),yt=ie%2?o.aj-1:0,vt=re(Xe[0],Math.min(o.aj-1,Xe[1]),yt,be,pe,ie<2,Xe[2]);je.centroidXY=De.centroidXY=k(vt)}else st?je.centroidXY=De.centroidXY=new o.P(0,0):(je.centroidXY=g.encodeBorderCentroid(We),De.centroidXY=ge.encodeBorderCentroid(tt));g.writeCentroidToBuffer(je),ge.writeCentroidToBuffer(De)}else g.showCentroid(We)}g.borderDoneWithNeighborZ[ie]=ge.canonical.z,ge.borderDoneWithNeighborZ[Ae]=g.canonical.z}var Q,oe;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const u0=[1,0,0],MC=[0,1,0],OC=[0,0,1];function wg(m,s,u){const g=u.transform,x=u.shadowRenderer;if(!x)return!0;const w=m.toUnwrapped(),T=g.tileSize*x._cascades[u.currentShadowCascade].scale;let I=s;if(g.elevation){const Q=g.elevation.getMinMaxForTile(m);Q&&(I+=Q.max)}const k=[...x.shadowDirection];k[2]=-k[2];const N=x.computeSimplifiedTileShadowVolume(w,I,T,k);if(!N)return!1;const F=[u0,MC,OC,k,[k[0],0,k[2]],[0,k[1],k[2]]],q=g.projection.name==="globe",V=g.scaleZoom(T),X=o.cy.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,V,!q),re=x.getCurrentCascadeFrustum();return X.intersectsPrecise(N.vertices,N.planes,F)===0||re.intersectsPrecise(N.vertices,N.planes,F)===0}function Sg(m){const{painter:s,source:u,layer:g,coords:x}=m,w=m.defines,T=s.context,I=s.renderPass==="shadow",k=s.renderPass==="light-beam",N=s.shadowRenderer;let F;N&&(F=w.concat(["SHADOWS_SINGLE_CASCADE"]));const q=o.e9(s.transform.center.lat,s.transform.zoom);for(const V of x){const X=u.getTile(V),re=X.getBucket(g);if(!re)continue;let Q=!1;N&&(Q=N.getMaxCascadeForTile(V.toUnwrapped())===0);const oe=re.programConfigurations.get(g.id);let ie,ue,pe=s.translatePosMatrix(V.expandedProjMatrix,X,[0,0],"map");if(pe=o.cP(o.bz(),pe,[1,1,m.verticalScale]),I&&N){if(wg(X.tileID,re.maxHeight*q,s))continue;let ge=N.calculateShadowPassMatrixFromTile(X.tileID.toUnwrapped());ge=o.cP(o.bz(),ge,[1,1,m.verticalScale]),ue=N1(ge),ie=s.getOrCreateProgram("buildingDepth",{config:oe,defines:Q?F:w,overrideFog:!1})}else if(k)ie=s.getOrCreateProgram("buildingBloom",{config:oe,defines:Q?F:w,overrideFog:!1}),ue=e0(pe);else{const ge=s.transform.calculatePosMatrix(V.toUnwrapped(),s.transform.worldSize);o.cP(ge,ge,[1,1,m.verticalScale]);const be=o.bz();o.cP(be,ge,[1,-1,1/q]),o.bi(be,be),o.ea(be,be),ue=Qv(pe,be),ie=s.getOrCreateProgram("building",{config:oe,defines:Q?F:w,overrideFog:!1}),N&&N.setupShadowsFromMatrix(ge,ie,!0)}if(s.uploadCommonUniforms(T,ie,V.toUnwrapped(),null,null),k){const ge=re.bloomGeometry;ie.draw(s,T.gl.TRIANGLES,m.depthMode,mr.disabled,m.blendMode,ur.disabled,ue,g.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segmentsBucket,g.paint,s.transform.zoom,oe,[ge.layoutAttenuationBuffer,ge.layoutColorBuffer])}else ie.draw(s,T.gl.TRIANGLES,m.depthMode,mr.disabled,m.blendMode,I?ur.disabled:ur.backCW,ue,g.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,g.paint,s.transform.zoom,oe,[re.layoutNormalBuffer,re.layoutColorBuffer])}}function W1(m){return[m[0]*o.eb,m[1]*o.eb,m[2]*o.eb,0]}function Tg(m,s,u,g,x,w,T,I,k){const N=g.getSource(),F=u.globeSharedBuffers;if(!F)return;let q,V,X;if(s&&(q=g.getTile(s)),N instanceof o.aP?(V=N.texture,X=o.dE(0,0,u.transform)):q&&s&&(V=q.texture,X=o.dE(s.canonical.z,s.canonical.x,u.transform)),!V||!X)return;m||(X=o.cP(o.bz(),X,[1,-1,1]));const re=u.context,Q=re.gl,oe=x.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR,ie=u.colorModeForDrapableLayerRenderPass(w),ue=T.defines;ue.push("GLOBE_POLES");const pe=new Ht(Q.LEQUAL,Ht.ReadWrite,u.depthRangeFor3D),ge=Float32Array.from(u.transform.expandedFarZProjMatrix),be=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),re.activeTexture.set(Q.TEXTURE0),V.bind(oe,Q.CLAMP_TO_EDGE),re.activeTexture.set(Q.TEXTURE1),V.bind(oe,Q.CLAMP_TO_EDGE),"useMipmap"in V&&re.extTextureFilterAnisotropic&&u.transform.pitch>20&&Q.texParameterf(Q.TEXTURE_2D,re.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,re.extTextureFilterAnisotropicMax);const[Ae,Ie,we,Se]=s?F.getPoleBuffers(s.canonical.z,!1):F.getPoleBuffers(0,!0),Te=x.paint.get("raster-elevation");let We;m?(We=Ae,u.renderDefaultNorthPole=Te!==0):(We=Ie,u.renderDefaultSouthPole=Te!==0);const je=W1(T.mix),ht=((ft,Pt,qe,De,st,Xe,yt,vt,bt,Dt,Jt,or,$t)=>r0(ft,Pt,qe,new Float32Array(16),new Float32Array(9),[0,0],De,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Xe,[0,0],vt,2,Dt,Jt,or,1,0,$t))(ge,be,X,o.ah(u.transform.zoom),0,x,0,Te,0,je,T.offset,T.range,w),tt=u.getOrCreateProgram("raster",{defines:ue});u.uploadCommonUniforms(re,tt,null),tt.draw(u,Q.TRIANGLES,pe,k,ie,I,ht,x.id,We,we,Se)}function kC(m){const s=m._nearZ,u=m.projection.farthestPixelDistance(m),g=u-s,x=.2*m.height,w=s+x;return[s,u,(w-x-s)/g,(w-s)/g]}function RC(m,s,u,g){if(m)return s instanceof Dc&&m instanceof Fh?s.getTextureDescriptor(m,u,!0):{texture:m.texture,mix:W1(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Bs=o.ec([{name:"a_index",type:"Int16",components:1}]);class h0{constructor(s,u,g,x){const w={width:g[0],height:g[1],data:null},T=s.gl;this.targetColorTexture=new o.T(s,w,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(s,w,T.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(u,x),this.lastInvalidatedAt=0}updateParticleTexture(s,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,x=u.width*u.height;this.particleTexture0=new o.T(this.context,u,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,u,g.RGBA8,{premultiply:!1,useMipmap:!1});const w=new o.ed;w.reserve(x);for(let T=0;T<x;T++)w.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(w,Bs.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function fs(m,s,u){if(!m)return null;const g=s.getTextureDescriptor(m,u,!0);if(!g)return null;let{texture:x,mix:w,offset:T,tileSize:I,buffer:k,format:N}=g;if(!x||!N)return null;let F=!1;return N==="uint32"&&(F=!0,w[3]=0,w=gg(o.ee,w,[0,u.paint.get("raster-particle-max-speed")]),T=Uc(o.ee,T,[0,u.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[k/(I+2*k),I/(I+2*k)],tileSize:I,scalarData:F,scale:w,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function Xc(m){const s=m._nearZ,u=m.projection.farthestPixelDistance(m),g=u-s,x=.2*m.height,w=s+x;return[s,u,(w-x-s)/g,(w-s)/g]}const q1=new o.am(1,0,0,1),d0=new o.am(0,1,0,1),f0=new o.am(0,0,1,1),p0=new o.am(1,0,1,1),Z1=new o.am(0,1,1,1);function _l(m,s,u,g,x,w){for(let T=0;T<u.length;T++)if(x){const N=new o.am(g.r*.8,g.g*.8,g.b*.8,1);Rn(m,s,u[T],g,-1,-1,w),Rn(m,s,u[T],g,-1,1,w),Rn(m,s,u[T],g,1,1,w),Rn(m,s,u[T],g,1,-1,w),Rn(m,s,u[T],N,0,0,w)}else Rn(m,s,u[T],g,0,0,w)}function Rn(m,s,u,g,x,w,T){const I=m.context,k=m.transform,N=I.gl,F=k.projection.name==="globe",q=F?["PROJECTION_GLOBE_VIEW"]:[];let V=o.bw(u.projMatrix);if(F&&o.ah(k.zoom)>0){const je=o.bg(u.canonical,k),ht=o.ef(je);V=o.az(new Float32Array(16),k.globeMatrix,ht),o.az(V,k.projMatrix,V)}const X=o.bz();X[12]+=2*x/(o.q.devicePixelRatio*k.width),X[13]+=2*w/(o.q.devicePixelRatio*k.height),o.az(V,X,V);const re=m.getOrCreateProgram("debug",{defines:q}),Q=s.getTileByID(u.key);m.terrain&&m.terrain.setupElevationDraw(Q,re);const oe=Ht.disabled,ie=mr.disabled,ue=m.colorModeForRenderPass(),pe="$debug";I.activeTexture.set(N.TEXTURE0),m.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),F?Q._makeGlobeTileDebugBuffers(m.context,k):Q._makeDebugTileBoundsBuffers(m.context,k.projection);const ge=Q._tileDebugBuffer||m.debugBuffer,be=Q._tileDebugIndexBuffer||m.debugIndexBuffer,Ae=Q._tileDebugSegments||m.debugSegments;if(re.draw(m,N.LINE_STRIP,oe,ie,ue,ur.disabled,t0(V,g.toPremultipliedRenderColor(null)),pe,ge,be,Ae,null,null,null,[Q._globeTileDebugBorderBuffer]),T){const je=Q.latestRawTileData,ht=Math.floor((je&&je.byteLength||0)/1024);let tt=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(tt+=` => ${u.overscaledZ}`),tt+=` ${Q.state}`,tt+=` ${ht}kb`,function(ft,Pt){ft.initDebugOverlayCanvas();const qe=ft.debugOverlayCanvas,De=ft.context.gl,st=ft.debugOverlayCanvas.getContext("2d");st.clearRect(0,0,qe.width,qe.height),st.shadowColor="white",st.shadowBlur=2,st.lineWidth=1.5,st.strokeStyle="white",st.textBaseline="top",st.font="bold 36px Open Sans, sans-serif",st.fillText(Pt,5,5),st.strokeText(Pt,5,5),ft.debugOverlayTexture.update(qe),ft.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(m,tt)}const Ie=s.getTile(u).tileSize,we=512/Math.min(Ie,512)*(u.overscaledZ/k.zoom)*.5,Se=Q._tileDebugTextBuffer||m.debugBuffer,Te=Q._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,We=Q._tileDebugTextSegments||m.debugSegments;re.draw(m,N.TRIANGLES,oe,ie,Mr.alphaBlended,ur.disabled,t0(V,o.am.transparent.toPremultipliedRenderColor(null),we),pe,Se,Te,We,null,null,null,[Q._globeTileDebugTextBuffer])}function ap(m,s,u,g){lp(m,0,s+u/2,m.transform.width,u,g)}function Eg(m,s,u,g){lp(m,s-u/2,0,u,m.transform.height,g)}function lp(m,s,u,g,x,w){const T=m.context,I=T.gl;I.enable(I.SCISSOR_TEST),I.scissor(s*o.q.devicePixelRatio,u*o.q.devicePixelRatio,g*o.q.devicePixelRatio,x*o.q.devicePixelRatio),T.clear({color:w}),I.disable(I.SCISSOR_TEST)}const X1=o.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:K1}=X1;function Kc(m,s,u,g){m.emplaceBack(s,u,g)}class Zu{constructor(s){this.vertexArray=new o.eg,this.indices=new o.a_,Kc(this.vertexArray,-1,-1,1),Kc(this.vertexArray,1,-1,1),Kc(this.vertexArray,-1,1,1),Kc(this.vertexArray,1,1,1),Kc(this.vertexArray,-1,-1,-1),Kc(this.vertexArray,1,-1,-1),Kc(this.vertexArray,-1,1,-1),Kc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,K1),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function tl(m,s,u,g,x,w){const T=m.context.gl,I=s.paint.get("sky-atmosphere-color"),k=s.paint.get("sky-atmosphere-halo-color"),N=s.paint.get("sky-atmosphere-sun-intensity"),F=((q,V,X,re,Q)=>({u_matrix_3f:q,u_sun_direction:V,u_sun_intensity:X,u_color_tint_r:[re.r,re.g,re.b,re.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(o.ei(o.dJ(),g),x,N,I.toPremultipliedRenderColor(null),k.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+w,s.skyboxTexture,0),u.draw(m,T.TRIANGLES,Ht.disabled,mr.disabled,Mr.unblended,ur.frontCW,F,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Mt=o.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Bt{constructor(s){const u=new o.ej;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const g=new o.a_;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(u,Mt.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const sd=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class xi{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ve{constructor(s){this.colorModeAlphaBlendedWriteRGB=new Mr([1,Fu,1,Fu],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Mr([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new xi,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const u=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Bt(u);const g=this.params.sizeRange,x=this.params.intensityRange,w=function(F){const q=o.el(30),V=[];for(let X=0;X<F;++X){const re=2*Math.PI*q(),Q=Math.acos(1-2*q())-.5*Math.PI;V.push(o.d2(Math.cos(Q)*Math.cos(re),Math.cos(Q)*Math.sin(re),Math.sin(Q)))}return V}(this.params.starsCount),T=o.el(300),I=new o.ek,k=new o.a_;let N=0;for(let F=0;F<w.length;++F){const q=o.c1([],w[F],200),V=Math.max(0,1+.01*g*(1*T()-.5)),X=Math.max(0,1+.01*x*(1*T()-.5));I.emplaceBack(q[0],q[1],q[2],-1,-1,V,X),I.emplaceBack(q[0],q[1],q[2],1,-1,V,X),I.emplaceBack(q[0],q[1],q[2],1,1,V,X),I.emplaceBack(q[0],q[1],q[2],-1,1,V,X),k.emplaceBack(N+0,N+1,N+2),k.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=u.createVertexBuffer(I,sd.members),this.starsIdx=u.createIndexBuffer(k),this.starsSegments=o.bd.simpleSegment(0,0,I.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,u){const g=s.context,x=g.gl,w=s.transform,T=new Ht(x.LEQUAL,Ht.ReadOnly,[0,1]),I=o.ah(w.zoom),k=s.style.getLut(u.scope),N=u.properties.get("color-use-theme")==="none",F=u.properties.get("color").toNonPremultipliedRenderColor(N?null:k).toArray01(),q=u.properties.get("high-color-use-theme")==="none",V=u.properties.get("high-color").toNonPremultipliedRenderColor(q?null:k).toArray01(),X=u.properties.get("space-color-use-theme")==="none",re=u.properties.get("space-color").toNonPremultipliedRenderColor(X?null:k).toArray01(),Q=5e-4,oe=o.em(u.properties.get("horizon-blend"),0,1,Q,.25),ie=o.dy(s,g,w)&&oe===Q?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,ue=s.frameCounter/1e3%1,pe=o.ae(w.globeCenterInViewSpace),ge=Math.sqrt(Math.pow(pe,2)-Math.pow(ie,2)),be=Math.acos(ge/pe),Ae=Ie=>{const we=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ie&&we.push("ALPHA_PASS");const Se=s.getOrCreateProgram("globeAtmosphere",{defines:we}),Te=((je,ht,tt,ft,Pt,qe,De,st,Xe,yt,vt,bt)=>({u_frustum_tl:je,u_frustum_tr:ht,u_frustum_br:tt,u_frustum_bl:ft,u_horizon:Pt,u_transition:qe,u_fadeout_range:De,u_color:st,u_high_color:Xe,u_space_color:yt,u_temporal_offset:vt,u_horizon_angle:bt}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,I,oe,F,V,re,ue,be);s.uploadCommonUniforms(g,Se);const We=this.atmosphereBuffer;We&&Se.draw(s,x.TRIANGLES,T,mr.disabled,Ie?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ur.backCW,Te,Ie?"atmosphere_glow_alpha":"atmosphere_glow",We.vertexBuffer,We.indexBuffer,We.segments)};Ae(!1),Ae(!0)}drawStars(s,u){const g=o.ay(u.properties.get("star-intensity"),0,1);if(g===0)return;const x=s.context,w=x.gl,T=s.transform,I=s.getOrCreateProgram("stars"),k=o.c3([]);o.c5(k,k,-T._pitch),o.c4(k,k,-T.angle),o.c5(k,k,o.al(T._center.lat)),o.en(k,k,-o.al(T._center.lng));const N=o.c8(new Float32Array(16),k),F=o.az([],T.starsProjMatrix,N),q=o.ei([],N),V=o.eo([],q),X=[0,1,0];o.dL(X,X,V),o.c1(X,X,this.params.sizeMultiplier);const re=[1,0,0];o.dL(re,re,V),o.c1(re,re,this.params.sizeMultiplier);const Q=(oe=X,ie=re,ue=g,{u_matrix:Float32Array.from(F),u_up:oe,u_right:ie,u_intensity_multiplier:ue});var oe,ie,ue;s.uploadCommonUniforms(x,I),this.starsVx&&this.starsIdx&&I.draw(s,w.TRIANGLES,Ht.disabled,mr.disabled,this.colorModeAlphaBlendedWriteRGB,ur.disabled,Q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Y1{constructor(){this.visibleTiles=[]}updateBorders(s,u){const g=[],x=[],w=s._getRenderableCoordinates(!1,!0);for(const k of w){const N=s.getTile(k);if(!N.hasData())continue;const F=N.getBucket(u);F&&(F.isEmpty()||(g.push(k.key),x.push({bucket:F,tileID:k.canonical})))}let T=g.length!==this.visibleTiles.length;if(!T){g.sort();for(let k=0;k<g.length;k++)if(g[k]!==this.visibleTiles[k]){T=!0;break}}if(!T)return;const I=new Set;this.visibleTiles=g,x.sort((k,N)=>k.tileID.z-N.tileID.z||k.tileID.x-N.tileID.x||k.tileID.y-N.tileID.y);for(const k of x){const N=new Array,F=new Array,q=k.bucket;for(const V of q.featuresOnBorder)I.has(V.featureId)?F.push(V.footprintIndex):(I.add(V.featureId),N.push(V.footprintIndex));q.updateFootprintHiddenFlags(N,o.ep,!1),q.updateFootprintHiddenFlags(F,o.ep,!0)}}}function cp(m,s){const u=[...m],g=s.cameraWorldSizeForFog/s.worldSize,x=o.bx([]);return o.cP(x,x,[g,g,1]),o.az(u,x,u),o.az(u,s.worldToFogMatrix,u),u}function up(m,s,u,g,x){const w=u.material,T=g.context,{baseColorTexture:I,metallicRoughnessTexture:k}=w.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:F,emissionTexture:q}=w;function V(re,Q,oe){if(re&&(m.push(Q),T.activeTexture.set(T.gl.TEXTURE0+oe),re.gfxTexture)){const{minFilter:ie,magFilter:ue,wrapS:pe,wrapT:ge}=re.sampler;re.gfxTexture.bindExtraParam(ie,ue,pe,ge)}}V(I,"HAS_TEXTURE_u_baseColorTexture",ds.BaseColor),V(k,"HAS_TEXTURE_u_metallicRoughnessTexture",ds.MetallicRoughness),V(N,"HAS_TEXTURE_u_normalTexture",ds.Normal),V(F,"HAS_TEXTURE_u_occlusionTexture",ds.Occlusion),V(q,"HAS_TEXTURE_u_emissionTexture",ds.Emission),x&&(x.texture||(x.texture=new o.et(g.context,x.image,[x.image.height,x.image.height,x.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+ds.LUT),x.texture&&x.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(u.texcoordBuffer)),u.colorBuffer&&(m.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(u.colorBuffer)),u.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(u.normalBuffer)),u.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(u.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||m.push("DIFFUSE_SHADED");const X=g.shadowRenderer;X&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),X.useNormalOffset&&m.push("NORMAL_OFFSET"))}function ad(m,s,u,g,x,w){const T=u.paint.get("model-opacity").constantOr(1),I=s.context,k=new Ht(s.context.gl.LEQUAL,Ht.ReadWrite,s.depthRangeFor3D),N=s.transform,F=m.mesh,q=F.material,V=q.pbrMetallicRoughness,X=s.style.fog;let re;re=s.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:o.az([],g.zScaleMatrix,m.nodeModelMatrix),o.az(re,g.negCameraPosMatrix,re);const Q=o.bi([],re);o.ea(Q,Q);const oe=u.paint.get("model-color-use-theme").constantOr("default")==="none",ie=u.paint.get("model-emissive-strength").constantOr(0),ue=i0(new Float32Array(m.worldViewProjection),new Float32Array(re),new Float32Array(Q),null,s,T,V.baseColorFactor,q.emissiveFactor,V.metallicFactor,V.roughnessFactor,q,ie,u),pe={defines:[]},ge=[],be=s.shadowRenderer;be&&(be.useNormalOffset=!1),up(pe.defines,ge,F,s,oe?null:u.lut);let Ae=null;if(X){const Se=cp(m.nodeModelMatrix,s.transform);if(Ae=new Float32Array(Se),N.projection.name!=="globe"){const Te=F.aabb.min,We=F.aabb.max,[je,ht]=X.getOpacityForBounds(Se,Te[0],Te[1],We[0],We[1]);pe.overrideFog=je>=gt||ht>=gt}}const Ie=yl(s,u.paint.get("model-cutoff-fade-range"));Ie.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const we=s.getOrCreateProgram("model",pe);s.uploadCommonUniforms(I,we,null,Ae,Ie),s.renderPass!=="shadow"&&be&&be.setupShadowsFromMatrix(m.nodeModelMatrix,we),we.draw(s,I.gl.TRIANGLES,k,x,w,F.material.doubleSided?ur.disabled:ur.backCCW,ue,u.id,F.vertexBuffer,F.indexBuffer,F.segments,u.paint,s.transform.zoom,void 0,ge)}function m0(m,s,u,g,x,w,T){let I;I=m.projection.name==="globe"?o.er(u,m):[...u],o.az(I,I,s.matrix);const k=o.az([],g,I);if(s.meshes)for(const N of s.meshes){if(N.material.alphaMode!=="BLEND"){T.push({mesh:N,depth:0,modelIndex:x,worldViewProjection:k,nodeModelMatrix:I});continue}const F=o.ad([],N.centroid,k);!m.isOrthographic&&F[2]<=0||w.push({mesh:N,depth:F[2],modelIndex:x,worldViewProjection:k,nodeModelMatrix:I})}if(s.children)for(const N of s.children)m0(m,N,u,g,x,w,T)}function Ag(m,s,u,g){const x=u.shadowRenderer;if(!x)return;const w=x.getShadowPassDepthMode(),T=x.getShadowPassColorMode(),I=x.calculateShadowPassMatrixFromMatrix(s),k=U1(I);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,w,mr.disabled,T,ur.backCCW,k,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,u.transform.zoom,void 0,void 0)}function ld(m,s,u){const g=s.updateZoomBasedPaintProperties(),x=function(w,T,I){let k,N,F,q=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&q>0){const V=w.terrain,X=V.findDEMTileFor(I);X&&X.dem?k=o.eu.create(V,I,X):q=0}if(q===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),q===T.validForExaggeration&&(q===0||k&&k._demTile&&k._demTile.tileID===T.validForDEMTile.id&&k._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const V in T.instancesPerModel){const X=T.instancesPerModel[V];for(let re=0;re<X.instancedDataArray.length;++re){const Q=(k?q*k.getElevationAt(0|X.instancedDataArray.float32[16*re],0|X.instancedDataArray.float32[16*re+1],!0,!0):0)+X.instancesEvaluatedElevation[re];X.instancedDataArray.float32[16*re+6]=Q,N=N?Math.min(T.terrainElevationMin,Q):Q,F=F?Math.max(T.terrainElevationMax,Q):Q}}return T.terrainElevationMin=N||0,T.terrainElevationMax=F||0,T.validForExaggeration=q,T.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,s,u);(g||x)&&(s.uploaded=!1,s.upload(m.context))}const vl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d6([0,0,0],[o.aj,o.aj,0])};function DC(m,s){const u=1<<m.canonical.z,g=s.getFreeCameraOptions().position,x=s.elevation,w=m.canonical.x/u,T=(m.canonical.x+1)/u,I=m.canonical.y/u,k=(m.canonical.y+1)/u;let N=s._centerAltitude;if(x){const X=x.getMinMaxForTile(m);X&&X.max>N&&(N=X.max)}const F=o.ay(g.x,w,T)-g.x,q=o.ay(g.y,I,k)-g.y,V=o.cb(N,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt(F*F+q*q+V*V))}function g0(m,s,u,g,x,w,T){const I=m.context,k=m.renderPass==="shadow",N=m.shadowRenderer,F=k&&N?N.getShadowPassDepthMode():new Ht(I.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D),q=m.isTileAffectedByFog(w);if(u.meshes)for(const V of u.meshes){const X=["MODEL_POSITION_ON_GPU"],re=[];let Q,oe,ie;g.instancedDataArray.length>20&&X.push("INSTANCED_ARRAYS");const ue=yl(m,s.paint.get("model-cutoff-fade-range"));if(ue.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),k&&N)Q=m.getOrCreateProgram("modelDepth",{defines:X}),oe=U1(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(u.matrix)),ie=N.getShadowPassColorMode();else{up(X,re,V,m,s.paint.get("model-color-use-theme").constantOr("default")==="none"?null:s.lut),Q=m.getOrCreateProgram("model",{defines:X,overrideFog:q});const ge=V.material,be=ge.pbrMetallicRoughness,Ae=s.paint.get("model-opacity").constantOr(1),Ie=s.paint.get("model-emissive-strength").constantOr(0);oe=i0(w.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,m,Ae,be.baseColorFactor,ge.emissiveFactor,be.metallicFactor,be.roughnessFactor,ge,Ie,s,x),N&&(T.shadowUniformsInitialized?Q.setShadowUniformValues(I,N.getShadowUniformValues()):(N.setupShadows(w.toUnwrapped(),Q,"model-tile"),T.shadowUniformsInitialized=!0)),ie=ue.shouldRenderCutoff||Ae<1||ge.alphaMode!=="OPAQUE"?Mr.alphaBlended:Mr.unblended}m.uploadCommonUniforms(I,Q,w.toUnwrapped(),null,ue);const pe=V.material.doubleSided?ur.disabled:ur.backCCW;if(g.instancedDataArray.length>20)re.push(g.instancedDataBuffer),Q.draw(m,I.gl.TRIANGLES,F,mr.disabled,ie,pe,oe,s.id,V.vertexBuffer,V.indexBuffer,V.segments,s.paint,m.transform.zoom,void 0,re,g.instancedDataArray.length);else{const ge=k?"u_instance":"u_normal_matrix";for(let be=0;be<g.instancedDataArray.length;++be)oe[ge]=new Float32Array(g.instancedDataArray.arrayBuffer,64*be,16),Q.draw(m,I.gl.TRIANGLES,F,mr.disabled,ie,pe,oe,s.id,V.vertexBuffer,V.indexBuffer,V.segments,s.paint,m.transform.zoom,void 0,re)}}if(u.children)for(const V of u.children)g0(m,s,V,g,x,w,T)}const Pg=[1,-1,1];function y0(m,s,u,g){if(!u.modelManager)return!0;const x=u.modelManager;if(!u.shadowRenderer)return!0;const w=u.shadowRenderer,T=s.aabb;let I=!0,k=m.maxHeight;if(k===0){let F=0;for(const q in m.instancesPerModel){const V=x.getModel(q,g);V?F=Math.max(F,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):I=!1}k=m.maxScale*F*1.41+m.maxVerticalOffset,I&&(m.maxHeight=k)}T.max[2]=k,T.min[2]+=m.terrainElevationMin,T.max[2]+=m.terrainElevationMax,o.ad(T.min,T.min,s.tileMatrix),o.ad(T.max,T.max,s.tileMatrix);const N=T.intersects(w.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=N===2),N===0}function J1(m,s){const u=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],x=m.uniformValues.u_cutoff_params[2],w=m.uniformValues.u_cutoff_params[3];return g===u||w===x?1:o.ay(((s-u)/(g-u)-x)/(w-x),0,1)}function Q1(m,s,u,g){if(s.pitch<20)return 1;const x=s.getWorldToCameraMatrix();o.az(x,x,m);const w=o.bR(u.min[0],u.min[1],u.min[2],1);let T=o.aA(o.ev(),w,x),I=T,k=T;w[1]=u.max[1],T=o.aA(o.ev(),w,x),I=T[1]<I[1]?T:I,k=T[1]>k[1]?T:k,w[0]=u.max[0],T=o.aA(o.ev(),w,x),I=T[1]<I[1]?T:I,k=T[1]>k[1]?T:k,w[1]=u.min[1],T=o.aA(o.ev(),w,x),I=T[1]<I[1]?T:I,k=T[1]>k[1]?T:k;const N=o.ay(g[0],0,1),F=100*s.pixelsPerMeter*o.ay(g[1],0,1),q=o.ay(g[2],0,1),V=o.ew(o.ev(),I,k,N),X=Math.tan(.5*s.fovX),re=-V[2]*X;if(F===0)return V[1]<-Math.abs(re)?q:1;const Q=(-Math.abs(re)-V[1])/F,oe=(ue,pe,ge)=>(1-ge)*ue+ge*pe,ie=o.ay(oe(1,q,Q),q,1);return oe(1,ie,o.ay((s.pitch-20)/20,0,1))}class Cg{}class hp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,u,g){{const q=this._storage.get(u.id);if(q)return q.lastUsedFrameIdx=s,q.buf}const x=g.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),T=new ArrayBuffer(w),I=new Int16Array(T);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const k=new o.ey;for(let q=0;q<w/2;q+=3){const V=I[q],X=I[q+1],re=I[q+2];k.emplaceBack(V,X),k.emplaceBack(X,re),k.emplaceBack(re,V)}const N=g.bindVertexArrayOES.current,F=new Cg;return F.buf=new Wc(g,k),F.lastUsedFrameIdx=s,this._storage.set(u.id,F),g.bindVertexArrayOES.set(N),F.buf}update(s){for(const[u,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(u))}destroy(){for(const[s,u]of this._storage)u.buf.destroy(),this._storage.delete(s)}}class cd{constructor(s){this.occluderSize=30,this.depthOffset=-1e-4,s.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const eS=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class LC{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Yo{constructor(s,u){this.revealStart=11,this.revealRange=2,s.registerParameter(this,[...u,"Reveal"],"revealStart",{min:0,max:17,step:.05}),s.registerParameter(this,[...u,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const jC=o.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class dp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,u){const g=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new o.ez,I=new o.a_;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(T,jC.members),this.vignetteIdx=s.context.createIndexBuffer(I)}const x=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,g);const T={u_vignetteShape:(w={vignetteShape:[u.start,u.range,Math.pow(10,u.fadePower)],vignetteColor:[u.color.r,u.color.g,u.color.b,u.color.a*u.strength]}).vignetteShape,u_vignetteColor:w.vignetteColor};g.draw(s,s.context.gl.TRIANGLES,Ht.disabled,mr.disabled,Mr.alphaBlended,ur.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,x)}var w}}class ei{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,u){const g=s.getFreeCameraOptions().position,x=g.toAltitude(),w=g.toLngLat(),T=o.al(w.lng),I=o.al(w.lat),k=s.pixelsPerMeter/u,N=T*o.eB,F=o.eB*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const q=-this._offsetYPrev+F,V=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+N)*k,this._accumulatedOffsetY+=q*k,this._accumulatedElevation+=V*k,this._offsetXPrev=N,this._offsetYPrev=F,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Qr(m,s){return[-(m[0]-Math.floor(m[0]/s)*s),-(m[1]-Math.floor(m[1]/s)*s),-(m[2]-Math.floor(m[2]/s)*s)]}function _0(m){const s=o.el(1323123451230),u=[];for(let g=0;g<m;++g){const x=2*s()-1,w=2*s()-1,T=2*s()-1;u.push(o.d2(x,w,T))}return u}function Os(m,s,u,g,x){const w=o.ay((x-u)/(g-u),0,1);return(1-w)*m+w*s}class ud{constructor(s){this._movement=new ei,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new dp,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,u){const g=s.transform;this._movement.update(g,this._ppmScaleFactor);const x=g.starsProjMatrix,w=o.c3([]);o.c5(w,w,o.al(90)-g._pitch),o.c4(w,w,-g.angle);const T=o.c8(new Float32Array(16),w),I=o.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),k=o.ea([],I),N=o.az([],k,T),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*u,this._prevTime=F,{projectionMatrix:x,modelviewMatrix:N}}}class hd extends ud{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Yo(s.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const u=s.context;if(!this.particlesVx){const g=_0(this.particlesCount),x=new o.eC,w=new o.a_;let T=0;const I=o.el(1323123451230);for(let k=0;k<g.length;++k){const N=g[k],F=[2*I()-1,I(),I(),I()];x.emplaceBack(N[0],N[1],N[2],-1,-1,...F),x.emplaceBack(N[0],N[1],N[2],1,-1,...F),x.emplaceBack(N[0],N[1],N[2],1,1,...F),x.emplaceBack(N[0],N[1],N[2],-1,1,...F),w.emplaceBack(T+0,T+1,T+2),w.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=u.createVertexBuffer(x,eS.members),this.particlesIdx=u.createIndexBuffer(w)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const u=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=s.transform.zoom;if(u.revealStart>g)return;const x=Os(0,1,u.revealStart,u.revealStart+u.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const w=structuredClone(this._params);let T=[-w.direction.x,w.direction.y,-100];o.au(T,T);const I=structuredClone(this._vignetteParams);I.strength*=x,w.overrideStyleParameters||(w.intensity=s.style.rain.state.density,w.timeFactor=s.style.rain.state.intensity,w.color=structuredClone(s.style.rain.state.color),T=structuredClone(s.style.rain.state.direction),w.screenThinning.intensity=s.style.rain.state.centerThinning,w.dropletSizeX=s.style.rain.state.dropletSize[0],w.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],w.distortionStrength=100*s.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(s.style.rain.state.vignetteColor));const k=this.updateOnRender(s,w.timeFactor),N=s.context,F=N.gl,q=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new o.T(N,{width:s.width,height:s.height,data:null},F.RGBA8)),w.distortionStrength>0&&(N.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const V=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(N,V),N.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const X=[w.color.r,w.color.g,w.color.b,w.color.a],re=(Q,oe)=>{const ie=Qr(this._movement.getPosition(),Q),ue=w.dropletSizeX,pe=w.dropletSizeX*w.dropletSizeYScale,ge=s.width/2,be=s.height/2,Ae=Os(0,w.screenThinning.start,0,1,w.screenThinning.intensity),Ie=Os(.001,w.screenThinning.range,0,1,w.screenThinning.intensity),we=Os(0,w.screenThinning.particleOffset,0,1,w.screenThinning.intensity),Se=(Te={modelview:k.modelviewMatrix,projection:k.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:w.velocityConeAperture,velocity:w.velocity,boxSize:Q,rainDropletSize:[ue,pe],distortionStrength:w.distortionStrength,rainDirection:T,color:X,screenSize:[q.width,q.height],thinningCenterPos:[ge,be],thinningShape:[Ae,Ie,Math.pow(10,w.screenThinning.fadePower)],thinningAffectedRatio:w.screenThinning.affectedRatio,thinningParticleOffset:we,shapeDirectionalPower:w.shapeDirPower,shapeNormalPower:w.shapeNormalPower,mode:oe?0:1},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_texScreen:0,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_boxSize:Te.boxSize,u_rainDropletSize:Te.rainDropletSize,u_distortionStrength:Te.distortionStrength,u_rainDirection:Te.rainDirection,u_color:Te.color,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_shapeDirectionalPower:Te.shapeDirectionalPower,u_shapeNormalPower:Te.shapeNormalPower,u_mode:Te.mode});var Te;const We=Math.round(w.intensity*this.particlesCount),je=o.bd.simpleSegment(0,0,4*We,2*We);V.draw(s,F.TRIANGLES,Ht.disabled,mr.disabled,Mr.alphaBlended,ur.disabled,Se,"rain_particles",this.particlesVx,this.particlesIdx,je)};w.distortionStrength>0&&re(w.boxSize,!0),re(w.boxSize,!1),this._vignette.draw(s,I)}}const Xu=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class v0 extends ud{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Yo(s.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const u=s.context;if(!this.particlesVx){const g=_0(this.particlesCount),x=new o.eD,w=new o.a_;let T=0;const I=o.el(1323123451230);for(let k=0;k<g.length;++k){const N=g[k],F=I(),q=I(),V=I(),X=[k/g.length,F,q,V],re=[I(),I()];x.emplaceBack(N[0],N[1],N[2],-1,-1,...X,...re),x.emplaceBack(N[0],N[1],N[2],1,-1,...X,...re),x.emplaceBack(N[0],N[1],N[2],1,1,...X,...re),x.emplaceBack(N[0],N[1],N[2],-1,1,...X,...re),w.emplaceBack(T+0,T+1,T+2),w.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=u.createVertexBuffer(x,Xu.members),this.particlesIdx=u.createIndexBuffer(w)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const u=structuredClone(this._params);let g=[-u.direction.x,u.direction.y,-100];o.au(g,g);const x=structuredClone(this._vignetteParams),w=u.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=s.transform.zoom;if(w.revealStart>T)return;const I=Os(0,1,w.revealStart,w.revealStart+w.revealRange,T);x.strength*=I,u.overrideStyleParameters||(u.intensity=s.style.snow.state.density,u.timeFactor=s.style.snow.state.intensity,u.color=structuredClone(s.style.snow.state.color),g=structuredClone(s.style.snow.state.direction),u.screenThinning.intensity=s.style.snow.state.centerThinning,u.billboardSize=2.79*s.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(s.style.snow.state.vignetteColor));const k=this.updateOnRender(s,u.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const N=s.context,F=N.gl,q=s.transform,V=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(N,V),((X,re,Q)=>{const oe=Qr(this._movement.getPosition(),X),ie=q.width/2,ue=q.height/2,pe=Os(0,Q.screenThinning.start,0,1,Q.screenThinning.intensity),ge=Os(.001,Q.screenThinning.range,0,1,Q.screenThinning.intensity),be=Os(0,Q.screenThinning.particleOffset,0,1,Q.screenThinning.intensity),Ae=(Ie={modelview:k.modelviewMatrix,projection:k.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:Q.velocityConeAperture,velocity:Q.velocity,horizontalOscillationRadius:Q.horizontalOscillationRadius,horizontalOscillationRate:Q.horizontalOscillationRate,boxSize:X,billboardSize:1*Q.billboardSize,simpleShapeParameters:[Q.shapeFadeStart,Q.shapeFadePower],screenSize:[q.width,q.height],thinningCenterPos:[ie,ue],thinningShape:[pe,ge,Math.pow(10,Q.screenThinning.fadePower)],thinningAffectedRatio:Q.screenThinning.affectedRatio,thinningParticleOffset:be,color:[Q.color.r,Q.color.g,Q.color.b,Q.color.a],direction:g},{u_modelview:Float32Array.from(Ie.modelview),u_projection:Float32Array.from(Ie.projection),u_time:Ie.time,u_cam_pos:Ie.camPos,u_velocityConeAperture:Ie.velocityConeAperture,u_velocity:Ie.velocity,u_horizontalOscillationRadius:Ie.horizontalOscillationRadius,u_horizontalOscillationRate:Ie.horizontalOscillationRate,u_boxSize:Ie.boxSize,u_billboardSize:Ie.billboardSize,u_simpleShapeParameters:Ie.simpleShapeParameters,u_screenSize:Ie.screenSize,u_thinningCenterPos:Ie.thinningCenterPos,u_thinningShape:Ie.thinningShape,u_thinningAffectedRatio:Ie.thinningAffectedRatio,u_thinningParticleOffset:Ie.thinningParticleOffset,u_particleColor:Ie.color,u_direction:Ie.direction});var Ie;const we=Math.round(Q.intensity*this.particlesCount),Se=o.bd.simpleSegment(0,0,4*we,2*we);this.particlesVx&&this.particlesIdx&&V.draw(s,F.TRIANGLES,Ht.disabled,mr.disabled,Mr.alphaBlended,ur.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,Se)})(u.boxSize,0,u),this._vignette.draw(s,x)}}const x0={symbol:function(m,s,u,g,x){if(m.renderPass!=="translucent")return;const w=mr.disabled,T=m.colorModeForRenderPass(),I=u.layout.get("text-variable-anchor"),k=u.layout.get("text-size-scale-range"),N=o.ay(m.scaleFactor,k[0],k[1]);I&&function(V,X,re,Q,oe,ie,ue,pe){const ge=X.transform,be=oe==="map",Ae=ie==="map";for(const Ie of V){const we=Q.getTile(Ie),Se=we.getBucket(re);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const Te=o.bH(Se.textSizeData,ge.zoom,pe),We=Um(Ie,Se.getProjection(),ge),je=ge.calculatePixelsToTileUnitsMatrix(we),ht=Vf(We,we.tileID.canonical,Ae,be,ge,Se.getProjection(),je),tt=Se.hasIconTextFit()&&Se.hasIconData();Te&&H1(Se,be,Ae,ue,ge,ht,Ie,Math.pow(2,ge.zoom-we.tileID.overscaledZ),Te,tt)}}(g,m,u,s,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),x,N);const F=u.paint.get("icon-opacity").constantOr(1)!==0,q=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||q)?c0(m,s,u,g,w,T):(F&&c0(m,s,u,g,w,T,{onlyIcons:!0}),q&&c0(m,s,u,g,w,T,{onlyText:!0})),s.map.showCollisionBoxes&&(a0(m,s,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),a0(m,s,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,u,g){if(m.renderPass!=="translucent")return;const x=u.paint.get("circle-opacity"),w=u.paint.get("circle-stroke-width"),T=u.paint.get("circle-stroke-opacity"),I=u.layout.get("circle-sort-key").constantOr(1)!==void 0,k=u.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(w.constantOr(1)===0||T.constantOr(1)===0))return;const N=m.context,F=N.gl,q=m.transform,V=!(!m.terrain||!m.terrain.enabled),X=u.layout.get("circle-elevation-reference"),re=m.depthModeForSublayer(0,Ht.ReadOnly),Q=new Ht(m.context.gl.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D),oe=X==="none"||V?re:Q,ie=mr.disabled,ue=m.colorModeForDrapableLayerRenderPass(k),pe=q.projection.name==="globe",ge=[o.aD(q.center.lng),o.aH(q.center.lat)],be=[];for(let Ie=0;Ie<g.length;Ie++){const we=g[Ie],Se=s.getTile(we),Te=Se.getBucket(u);if(!Te||Te.projection.name!==q.projection.name)continue;const We=Te.programConfigurations.get(u.id),je=Te.layoutVertexBuffer,ht=Te.globeExtVertexBuffer,tt=Te.indexBuffer,ft=o.dW(u),Pt=[ht],qe=m.isTileAffectedByFog(we);pe&&ft.push("PROJECTION_GLOBE_VIEW"),ft.push("DEPTH_D24"),m.terrain&&q.depthOcclusionForSymbolsAndCircles&&ft.push("DEPTH_OCCLUSION"),Te.hasElevation&&!m.terrain&&(ft.push("ELEVATED_ROADS"),Pt.push(Te.elevatedLayoutVertexBuffer));const De=m.getOrCreateProgram("circle",{config:We,defines:ft,overrideFog:qe}),st=q.projection.createInversionMatrix(q,we.canonical),Xe={programConfiguration:We,program:De,layoutVertexBuffer:je,dynamicBuffers:Pt,indexBuffer:tt,uniformValues:o.dX(m,we,Se,st,ge,u),tile:Se};if(I){const yt=Te.segments.get();for(const vt of yt)be.push({segments:new o.bd([vt]),sortKey:vt.sortKey,state:Xe})}else be.push({segments:Te.segments,sortKey:0,state:Xe})}I&&be.sort((Ie,we)=>Ie.sortKey-we.sortKey);const Ae={useDepthForOcclusion:q.depthOcclusionForSymbolsAndCircles};for(const Ie of be){const{programConfiguration:we,program:Se,layoutVertexBuffer:Te,dynamicBuffers:We,indexBuffer:je,uniformValues:ht,tile:tt}=Ie.state,ft=Ie.segments;m.terrain&&m.terrain.setupElevationDraw(tt,Se,Ae),m.uploadCommonUniforms(N,Se,tt.tileID.toUnwrapped()),Se.draw(m,F.TRIANGLES,oe,ie,ue,ur.disabled,ht,u.id,Te,je,ft,u.paint,q.zoom,we,We)}},heatmap:function(m,s,u,g){if(u.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,w=x.gl,T=mr.disabled,I=new Mr([w.ONE,w.ONE,w.ONE,w.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(X,re,Q,oe){const ie=X.gl,ue=re.width*oe,pe=re.height*oe;X.activeTexture.set(ie.TEXTURE1),X.viewport.set([0,0,ue,pe]);let ge=Q.heatmapFbo;if(!ge||ge&&(ge.width!==ue||ge.height!==pe)){ge&&ge.destroy();const be=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,be),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),ge=Q.heatmapFbo=X.createFramebuffer(ue,pe,!0,null),function(Ae,Ie,we,Se,Te,We){const je=Ae.gl;je.texImage2D(je.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Te,We,0,je.RGBA,Ae.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),Se.colorAttachment.set(we)}(X,0,be,ge,ue,pe)}else ie.bindTexture(ie.TEXTURE_2D,ge.colorAttachment.get()),X.bindFramebuffer.set(ge.framebuffer)})(x,m,u,m.transform.projection.name==="globe"?.5:.25),x.clear({color:o.am.transparent});const k=m.transform,N=k.projection.name==="globe",F=N?["PROJECTION_GLOBE_VIEW"]:[],q=N?ur.frontCCW:ur.disabled,V=[o.aD(k.center.lng),o.aH(k.center.lat)];for(let X=0;X<g.length;X++){const re=g[X];if(s.hasRenderableParent(re))continue;const Q=s.getTile(re),oe=Q.getBucket(u);if(!oe||oe.projection.name!==k.projection.name)continue;const ie=m.isTileAffectedByFog(re),ue=oe.programConfigurations.get(u.id),pe=m.getOrCreateProgram("heatmap",{config:ue,defines:F,overrideFog:ie}),{zoom:ge}=m.transform;m.terrain&&m.terrain.setupElevationDraw(Q,pe),m.uploadCommonUniforms(x,pe,re.toUnwrapped());const be=k.projection.createInversionMatrix(k,re.canonical);pe.draw(m,w.TRIANGLES,Ht.disabled,T,I,q,F1(m,re,Q,be,V,ge,u.paint.get("heatmap-intensity")),u.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,u.paint,m.transform.zoom,ue,N?[oe.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,w){const T=x.context,I=T.gl,k=w.heatmapFbo;if(!k)return;T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get()),T.activeTexture.set(I.TEXTURE1);let N=w.colorRampTexture;N||(N=w.colorRampTexture=new o.T(T,w.colorRamp,I.RGBA8)),N.bind(I.LINEAR,I.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,I.TRIANGLES,Ht.disabled,mr.disabled,x.colorModeForRenderPass(),ur.disabled,((F,q,V,X)=>({u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(m,u))},line:function(m,s,u,g){if(m.renderPass!=="translucent")return;const x=u.paint.get("line-opacity"),w=u.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const T=u.paint.get("line-emissive-strength"),I=u.paint.get("line-occlusion-opacity"),k=u.layout.get("line-elevation-reference"),N=u.layout.get("line-width-unit")==="meters",F=k==="sea",q=!(!m.terrain||!m.terrain.enabled),V=m.context,X=V.gl;if(u.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const re=u.layout.get("line-cross-slope"),Q=re!==void 0,oe=re<1,ie=m.colorModeForDrapableLayerRenderPass(T),ue=m.terrain&&m.terrain.renderingToTexture,pe=ue?1:o.q.devicePixelRatio,ge=u.paint.get("line-dasharray"),be=ge.constantOr(1),Ae=u.layout.get("line-cap"),Ie=ge.constantOr(null),we=Ae.constantOr(null),Se=u.paint.get("line-pattern"),Te=Se.constantOr(1),We=u.paint.get("line-pattern-cross-fade"),je=Se.constantOr(null),ht=u.paint.get("line-opacity").constantOr(1);let tt=!Te&&ht!==1||m.depthOcclusion&&I>0&&I<1;const ft=u.paint.get("line-gradient"),Pt=Te?"linePattern":"line",qe=o.dY(u);let De;if(ue&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(tt=!1),I!==0&&m.depthOcclusion){const vt=u.paint._values["line-opacity"];vt&&vt.value&&vt.value.kind==="constant"?De=vt.value:o.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}w.value.kind!=="constant"&&w.value.isLineProgressConstant===!1&&qe.push("VARIABLE_LINE_WIDTH");const st=(vt,bt,Dt,Jt,or,$t)=>{for(const rr of vt){const er=s.getTile(rr);if(Te&&!er.patternsLoaded())continue;const _r=er.getBucket(u);if(!_r||_r.elevationType!=="none"&&!or||_r.elevationType==="none"&&or)continue;m.prepareDrawTile();const Ar=[...bt],zr=m.shadowRenderer,on=_r.elevationType==="road"&&!!zr&&zr.enabled;let wr=[0,0,0];if(on){const rn=m.style.directionalLight,yn=m.style.ambientLight;rn&&yn&&(wr=Bu(m.style,rn,yn)),Ar.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const sn=_r.programConfigurations.get(u.id);let un=!1;if(je&&er.imageAtlas){const rn=o.dZ.from(je),yn=rn.getPrimary().scaleSelf(pe).toString(),Nn=er.imageAtlas.patternPositions.get(yn),Di=rn.getSecondary(),Oi=Di?er.imageAtlas.patternPositions.get(Di.scaleSelf(pe).toString()):null;un=!!Nn&&!!Oi,Nn&&sn.setConstantPatternPositions(Nn,Oi)}We>0&&(un||sn.getPatternTransitionVertexBuffer("line-pattern"))&&Ar.push("LINE_PATTERN_TRANSITION");const Bn=m.isTileAffectedByFog(rr),Lr=m.getOrCreateProgram(Pt,{config:sn,defines:Ar,overrideFog:Bn});if(!Te&&Ie&&we&&er.lineAtlas){const rn=er.lineAtlas.getDash(Ie,we);rn&&sn.setConstantPatternPositions(rn)}on&&zr.setupShadows(er.tileID.toUnwrapped(),Lr,"vector-tile");let[an,cn]=u.paint.get("line-trim-offset");(we==="round"||we==="square")&&an!==cn&&(an===0&&(an-=1),cn===1&&(cn+=1));const gn=ue?rr.projMatrix:null,Fr=N?1/_r.tileToMeter/o.aw(er,1,m.transform.zoom):1,Mn=N?1/_r.tileToMeter/o.aw(er,1,Math.floor(m.transform.zoom)):1,hn=Te?o.d_(m,er,u,gn,pe,Fr,Mn,[an,cn],wr,We):o.d$(m,er,u,gn,_r.lineClipsArray.length,pe,Fr,Mn,[an,cn],wr);if(ft){const rn=_r.gradients[u.id];let yn=rn.texture;if(u.gradientVersion!==rn.version){let Nn=256;if(u.stepInterpolant){const Di=s.getSource().maxzoom,Oi=rr.canonical.z===Di?Math.ceil(1<<m.transform.maxZoom-rr.canonical.z):1;Nn=o.ay(o.e0(_r.maxLineLength/o.aj*1024*Oi),256,V.maxTextureSize)}rn.gradient=o.e1({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Nn,image:rn.gradient||void 0,clips:_r.lineClipsArray}),rn.texture?rn.texture.update(rn.gradient):rn.texture=new o.T(V,rn.gradient,X.RGBA8),rn.version=u.gradientVersion,yn=rn.texture}V.activeTexture.set(X.TEXTURE1),yn.bind(u.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}be&&(V.activeTexture.set(X.TEXTURE0),er.lineAtlasTexture&&er.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),sn.updatePaintBuffers()),Te&&(V.activeTexture.set(X.TEXTURE0),er.imageAtlasTexture&&er.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),sn.updatePaintBuffers()),or&&!F&&m.terrain.setupElevationDraw(er,Lr),m.uploadCommonUniforms(V,Lr,rr.toUnwrapped());const ui=rn=>{De!=null&&(De.value=ht*I),Lr.draw(m,X.TRIANGLES,Dt,rn,ie,ur.disabled,hn,u.id,_r.layoutVertexBuffer,_r.indexBuffer,_r.segments,u.paint,m.transform.zoom,sn,[_r.layoutVertexBuffer2,_r.patternVertexBuffer,_r.zOffsetVertexBuffer]),De!=null&&(De.value=ht)};if(tt&&!or){const rn=m.stencilModeForClipping(rr).ref;rn===0&&ue&&V.clear({stencil:0});const yn={func:X.EQUAL,mask:255};hn.u_alpha_discard_threshold=.8,ui(new mr(yn,rn,255,X.KEEP,X.KEEP,X.INVERT)),hn.u_alpha_discard_threshold=0,ui(new mr(yn,rn,255,X.KEEP,X.KEEP,X.KEEP))}else hn.u_alpha_discard_threshold=tt&&or&&$t?.8:0,ui(or?Jt:m.stencilModeForClipping(rr))}};let Xe=m.depthModeForSublayer(0,Ht.ReadOnly);const yt=new Ht(m.depthOcclusion?X.GREATER:X.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D);if(u.hasNonElevatedBuckets){const vt=!ue&&m.terrain;I!==0&&vt?o.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has line-z-offset enabled.`):vt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${u.id}.`):st(g,qe,Xe,mr.disabled,!1,!0)}if(u.hasElevatedBuckets){k==="hd-road-markup"?q||(Xe=yt,qe.push("ELEVATED_ROADS")):(qe.push("ELEVATED"),Xe=yt,Q&&qe.push(oe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&qe.push("ELEVATION_REFERENCE_SEA"));const vt=tt?m.stencilModeFor3D():mr.disabled;m.forceTerrainMode=!0,st(g,qe,Xe,vt,!0,!0),tt&&st(g,qe,Xe,vt,!0,!1),m.forceTerrainMode=!1}tt&&(m.resetStencilClippingMasks(),ue&&V.clear({stencil:0})),I===0||m.depthOcclusion||ue||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,s,u,g){const x=u.paint.get("fill-color"),w=u.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const T=u.paint.get("fill-emissive-strength"),I=m.colorModeForDrapableLayerRenderPass(T),k=u.paint.get("fill-pattern"),N=m.opaquePassEnabledForLayer()&&!k.constantOr(1)&&x.constantOr(o.am.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";let F="none";u.layout.get("fill-elevation-reference")!=="none"?F="road":u.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const q=!(!m.terrain||!m.terrain.enabled),V={painter:m,sourceCache:s,layer:u,coords:g,colorMode:I,elevationType:F,terrainEnabled:q,pass:N};if(m.renderPass!=="shadow")if(F!=="offset"){if(bg(V,!1),F==="road"){const X=!q&&m.renderPass==="translucent";X&&Wt(m,s,u,g,"geometry"),bg(V,!0,mr.disabled),X&&function(re){const{painter:Q,sourceCache:oe,layer:ie,coords:ue,colorMode:pe}=re,ge=Q.context.gl,be=re.painter.shadowRenderer,Ae=!!be&&be.enabled,Ie=new Ht(Q.context.gl.LEQUAL,Ht.ReadOnly,Q.depthRangeFor3D);let we=[0,0,0];if(Ae){const Te=Q.style.directionalLight,We=Q.style.ambientLight;Te&&We&&(we=Bu(Q.style,Te,We))}const Se=Te=>{for(const We of ue){const je=oe.getTile(We),ht=je.getBucket(ie);if(!ht)continue;const tt=ht.elevatedStructures;if(!tt)continue;let ft,Pt;if(Te?(ft=tt.renderableBridgeSegments,Pt=tt.bridgeProgramConfigurations.get(ie.id)):(ft=tt.renderableTunnelSegments,Pt=tt.tunnelProgramConfigurations.get(ie.id)),!ft||ft.segments[0].primitiveLength===0)continue;Pt.updatePaintBuffers(),Q.prepareDrawTile();const qe=Q.isTileAffectedByFog(We),De=[];Ae&&De.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const st=Q.getOrCreateProgram("elevatedStructures",{config:Pt,overrideFog:qe,defines:De}),Xe=Q.translatePosMatrix(We.projMatrix,je,ie.paint.get("fill-translate"),ie.paint.get("fill-translate-anchor"));Ae&&be.setupShadows(je.tileID.toUnwrapped(),st,"vector-tile");const yt=IC(Xe,we);Q.uploadCommonUniforms(Q.context,st,We.toUnwrapped()),st.draw(Q,ge.TRIANGLES,Ie,mr.disabled,pe,ur.backCCW,yt,ie.id,tt.vertexBuffer,tt.indexBuffer,ft,ie.paint,Q.transform.zoom,Pt,[tt.vertexBufferNormal])}};Se(!0),Se(!1)}(V)}}else bg(V,!1,m.stencilModeFor3D());else m.shadowRenderer&&F==="road"&&!q&&function(X){const{painter:re,sourceCache:Q,layer:oe,coords:ie}=X,ue=re.context.gl,pe=X.painter.shadowRenderer;for(const ge of ie){const be=Q.getTile(ge),Ae=be.getBucket(oe);if(!Ae)continue;const Ie=Ae.elevatedStructures;if(!Ie||!Ie.shadowCasterSegments||Ie.shadowCasterSegments.segments[0].primitiveLength===0)continue;re.prepareDrawTile();const we=Ae.bufferData.programConfigurations.get(oe.id),Se=re.isTileAffectedByFog(ge),Te=re.getOrCreateProgram("elevatedStructuresDepth",{config:we,overrideFog:Se}),We=pe.calculateShadowPassMatrixFromTile(be.tileID.toUnwrapped());re.uploadCommonUniforms(re.context,Te,ge.toUnwrapped());const je={u_matrix:We,u_depth_bias:0};Te.draw(re,ue.TRIANGLES,pe.getShadowPassDepthMode(),mr.disabled,pe.getShadowPassColorMode(),ur.disabled,je,oe.id,Ie.vertexBuffer,Ie.indexBuffer,Ie.shadowCasterSegments,oe.paint,re.transform.zoom,we)}}(V)},"fill-extrusion":function(m,s,u,g){const x=u.paint.get("fill-extrusion-opacity"),w=m.context,T=w.gl,I=m.terrain,k=I&&I.renderingToTexture;if(x===0)return;const N=m.conflationActive&&m.style.isLayerClipped(u,s.getSource()),F=m.style.order.indexOf(u.fqid);if(N&&function(q,V,X,re,Q){for(const oe of re){const ie=V.getTile(oe).getBucket(X);ie&&(ie.updateReplacement(oe,q.replacementSource,Q),ie.uploadCentroid(q.context))}}(m,s,u,g,F),I||N)for(const q of g){const V=s.getTile(q).getBucket(u);V&&dr(m.context,s,q,V,u,I,N)}if(m.renderPass==="shadow"&&m.shadowRenderer){const q=m.shadowRenderer;if(I&&x<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const V=q.getShadowPassDepthMode(),X=q.getShadowPassColorMode();sp(m,s,u,g,V,mr.disabled,X,N)}else if(m.renderPass==="translucent"){const q=!u.paint.get("fill-extrusion-pattern").constantOr(1),V=u.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!k&&V.a!==0){const X=new Ht(m.context.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D);x===1&&q?sp(m,s,u,g,X,mr.disabled,Mr.unblended,N):(sp(m,s,u,g,X,mr.disabled,Mr.disabled,N),sp(m,s,u,g,X,m.stencilModeFor3D(),m.colorModeForRenderPass(),N),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&q&&(!I&&m.transform.projection.name!=="globe"||k)){const X=u.paint.get("fill-extrusion-opacity"),re=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),oe=u.paint.get("fill-extrusion-flood-light-intensity"),ie=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ue=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ie?null:u.lut).toArray01().slice(0,3),pe=re>0&&Q>0,ge=oe>0,be=(we,Se,Te)=>(1-Te)*we+Te*Se,Ae=new Jl;Ae.translate=u.paint.get("fill-extrusion-translate"),Ae.translateAnchor=u.paint.get("fill-extrusion-translate-anchor"),Ae.edgeRadius=u.layout.get("fill-extrusion-edge-radius"),Ae.cutoffFadeRange=u.paint.get("fill-extrusion-cutoff-fade-range");const Ie=we=>{const Se=m.depthModeForSublayer(1,Ht.ReadOnly,T.LEQUAL,!0),Te=u.paint.get(we?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),We=be(.1,3,Te),je=m._showOverdrawInspector;if(!je){const ht=new mr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),tt=new Mr([T.ONE,T.ONE,T.ONE,T.ONE],o.am.transparent,[!1,!1,!1,!0],T.MIN);Ms(Ae,m,s,u,g,Se,ht,tt,ur.disabled,we,"sdf",X,re,Q,oe,ue,We,N,!1)}{const ht=je?mr.disabled:new mr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),tt=je?m.colorModeForRenderPass():new Mr([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],o.am.transparent,[!0,!0,!0,!0]);Ms(Ae,m,s,u,g,Se,ht,tt,ur.disabled,we,"color",X,re,Q,oe,ue,We,N,!1)}};if(k){const we=(Se,Te,We)=>{const je=m.depthModeForSublayer(1,Ht.ReadOnly,T.LEQUAL,!1),ht=u.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),tt=be(.1,3,ht);{const ft=new Mr([T.ONE,T.ONE,T.ONE,T.ONE],o.am.transparent,[!1,!1,!1,!0]);Ms(Ae,m,s,u,g,je,mr.disabled,ft,ur.disabled,Se,"clear",X,re,Q,oe,ue,tt,N,Te)}{const ft=new mr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Pt=new Mr([T.ONE,T.ONE,T.ONE,T.ONE],o.am.transparent,[!1,!1,!1,!0],T.MIN);Ms(Ae,m,s,u,g,je,ft,Pt,ur.disabled,Se,"sdf",X,re,Q,oe,ue,tt,N,Te)}{const ft=Se?T.ZERO:T.ONE_MINUS_DST_ALPHA,Pt=new mr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),qe=new Mr([ft,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],o.am.transparent,[!0,!0,!0,!0]);Ms(Ae,m,s,u,g,je,Pt,qe,ur.disabled,Se,"color",X,re,Q,oe,ue,tt,N,Te)}{const ft=new Mr([T.ONE,T.ONE,T.ONE,Se?T.ZERO:T.ONE],o.am.transparent,[!1,!1,!1,!0],Se?T.FUNC_ADD:T.MAX);Ms(Ae,m,s,u,g,je,mr.disabled,ft,ur.disabled,Se,"clear",X,re,Q,oe,ue,tt,N,Te,We)}};if(pe||ge){let Se;if(m.prepareDrawTile(),I){const Te=I.drapeBufferSize[0],We=I.drapeBufferSize[1];Se=I.framebufferCopyTexture,Se&&(!Se||Se.size[0]===Te&&Se.size[1]===We)||(Se&&Se.destroy(),Se=I.framebufferCopyTexture=new o.T(w,new o.r({width:Te,height:We}),T.RGBA8)),Se.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Te,We)}pe&&we(!0,!1,Se),ge&&we(!1,!0,Se)}}else pe&&Ie(!0),ge&&Ie(!1),(pe||ge)&&m.resetStencilClippingMasks()}}},building:function(m,s,u,g){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const x=u.paint.get("building-ambient-occlusion-ground-intensity"),w=u.paint.get("building-ambient-occlusion-ground-radius"),T=u.paint.get("building-ambient-occlusion-ground-attenuation");let I=x>0&&w>0,k=!0;const N=u.paint.get("building-vertical-scale");N<1&&(k=!1);const F=m.conflationActive&&m.style.isLayerClipped(u,s.getSource()),q=m.style.order.indexOf(u.fqid);if(function(V,X,re,Q,oe,ie){for(const ue of ie){const pe=X.getTile(ue).getBucket(re);pe&&(oe&&pe.updateReplacement(ue,V.replacementSource,Q),pe.uploadUpdatedIndexBuffer(V.context))}}(m,s,u,q,F,g),function(V,X,re,Q){for(const oe of Q){const ie=X.getTile(oe).getBucket(re);ie&&ie.needsEvaluation(V,re)&&(ie.evaluate(re),ie.uploadUpdatedColorBuffer(V.context))}}(m,s,u,g),u.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const V=m.shadowRenderer,X=[],re=V.getShadowPassDepthMode();Sg({painter:m,source:s,layer:u,coords:g,defines:X,blendMode:V.getShadowPassColorMode(),depthMode:re,verticalScale:N})}else if(m.renderPass==="translucent"){I&&function(Q,oe,ie,ue,pe,ge,be,Ae,Ie,we,Se,Te,We){const je=Q.context.gl,ht=Q.depthModeForSublayer(1,Ht.ReadOnly,je.LEQUAL,!0),tt=.1*(1-(ft=Se))+3*ft;var ft;const Pt=Q._showOverdrawInspector,qe=Te,De=new Jl;Pt||Ms(De,Q,oe,ie,ue,ht,new mr({func:je.ALWAYS,mask:255},255,255,je.KEEP,je.KEEP,je.REPLACE),new Mr([je.ONE,je.ONE,je.ONE,je.ONE],o.am.transparent,[!1,!1,!1,!0],je.MIN),ur.disabled,pe,"sdf",1,be,Ae,0,we,tt,qe,!1);{const st=Pt?mr.disabled:new mr({func:je.EQUAL,mask:255},255,255,je.KEEP,je.DECR,je.DECR),Xe=Pt?Q.colorModeForRenderPass():new Mr([je.ONE_MINUS_DST_ALPHA,je.DST_ALPHA,je.ONE,je.ONE],o.am.transparent,[!0,!0,!0,!0]);Ms(De,Q,oe,ie,ue,ht,st,Xe,ur.disabled,pe,"color",1,be,Ae,0,we,tt,qe,!1)}}(m,s,u,g,!0,0,x,w,0,[0,0,0],T,F);let V=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];k&&(V=V.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer.useNormalOffset&&(V=V.concat("NORMAL_OFFSET"));const X=new Ht(m.context.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D),re=m.colorModeForRenderPass();Sg({painter:m,source:s,layer:u,coords:g,defines:V,blendMode:re,depthMode:X,verticalScale:N})}else if(m.renderPass==="light-beam"){const V=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],X=new Ht(m.context.gl.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D);Sg({painter:m,source:s,layer:u,coords:g,defines:V,blendMode:Mr.alphaBlended,depthMode:X,verticalScale:N})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,s,u,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const x=m.context,w=m.terrain&&m.terrain.renderingToTexture,[T,I]=m.renderPass!=="translucent"||w?[{},g]:m.stencilConfigForOverlap(g);for(const k of I){const N=s.getTile(k);if(N.needsHillshadePrepare&&m.renderPass==="offscreen")S1(m,N,u);else if(m.renderPass==="translucent"){const F=m.depthModeForSublayer(0,Ht.ReadOnly),q=u.paint.get("hillshade-emissive-strength"),V=m.colorModeForDrapableLayerRenderPass(q),X=w&&m.terrain?m.terrain.stencilModeForRTTOverlap(k):T[k.overscaledZ];vC(m,k,N,u,F,X,V)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,s,u,g,x,w){if(m.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const T=m.transform.projection.name==="globe",I=u.paint.get("raster-elevation")!==0,k=I&&T;if(m.renderElevatedRasterBackface&&!k)return;const N=m.context,F=N.gl,q=s.getSource(),V=function(Ae,Ie,we,Se){const Te=Ie.paint.get("raster-color"),We=Ae.type==="raster-array",je=[],ht=Ie.paint.get("raster-resampling"),tt=Ie.paint.get("raster-color-mix");let ft=Ie.paint.get("raster-color-range");const Pt=[tt[0],tt[1],tt[2],0],qe=tt[3];let De=ht==="nearest"?Se.NEAREST:Se.LINEAR;if(We&&(je.push("RASTER_ARRAY"),Te||je.push("RASTER_COLOR"),ht==="linear"&&je.push("RASTER_ARRAY_LINEAR"),De=Se.NEAREST,!ft&&Ae.rasterLayers)){const st=Ae.rasterLayers.find(({id:Xe})=>Xe===Ie.sourceLayer);st&&st.fields&&st.fields.range&&(ft=st.fields.range)}if(ft=ft||[0,1],Te){je.push("RASTER_COLOR"),we.activeTexture.set(Se.TEXTURE2),Ie.updateColorRamp(ft);let st=Ie.colorRampTexture;st||(st=Ie.colorRampTexture=new o.T(we,Ie.colorRamp,Se.RGBA8)),st.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}return{mix:Pt,range:ft,offset:qe,defines:je,resampling:De}}(q,u,N,F);if(q instanceof o.aP&&!g.length&&!T)return;const X=u.paint.get("raster-emissive-strength"),re=m.colorModeForDrapableLayerRenderPass(X),Q=m.terrain&&m.terrain.renderingToTexture,oe=!m.options.moving,ie=u.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(q instanceof o.aP&&!g.length&&(q.onNorthPole||q.onSouthPole)){const Ae=I?m.stencilModeFor3D():mr.disabled;return void Tg(!!q.onNorthPole,null,m,s,u,X,V,ur.disabled,Ae)}if(!g.length)return;const[ue,pe]=q instanceof o.aP||Q?[{},g]:m.stencilConfigForOverlap(g),ge=pe[pe.length-1].overscaledZ;k&&V.defines.push("PROJECTION_GLOBE_VIEW"),I&&V.defines.push("RENDER_CUTOFF");const be=(Ae,Ie,we)=>{for(const Se of Ae){const Te=Se.toUnwrapped(),We=s.getTile(Se);if(Q&&(!We||!We.hasData()))continue;N.activeTexture.set(F.TEXTURE0);const je=RC(We,q,u,V);if(!je||!je.texture)continue;const{texture:ht,mix:tt,offset:ft,tileSize:Pt,buffer:qe}=je;let De,st;Q?(De=Ht.disabled,st=Se.projMatrix):I?(De=new Ht(F.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D),st=T?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Te,oe)):(De=m.depthModeForSublayer(Se.overscaledZ-ge,u.paint.get("raster-opacity")===1?Ht.ReadWrite:Ht.ReadOnly,F.LESS),st=m.transform.calculateProjMatrix(Te,oe));const Xe=m.terrain&&Q?m.terrain.stencilModeForRTTOverlap(Se):ue[Se.overscaledZ],yt=w?0:u.paint.get("raster-fade-duration");We.registerFadeDuration(yt);const vt=s.findLoadedParent(Se,0),bt=Is(We,vt,s,m.transform,yt);let Dt,Jt;m.terrain&&m.terrain.prepareDrawTile(),N.activeTexture.set(F.TEXTURE0),ht.bind(ie,F.CLAMP_TO_EDGE),N.activeTexture.set(F.TEXTURE1),vt?(vt.texture&&vt.texture.bind(ie,F.CLAMP_TO_EDGE),Dt=Math.pow(2,vt.tileID.overscaledZ-We.tileID.overscaledZ),Jt=[We.tileID.canonical.x*Dt%1,We.tileID.canonical.y*Dt%1]):ht.bind(ie,F.CLAMP_TO_EDGE),"useMipmap"in ht&&N.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const or=m.transform;let $t;const rr=I?kC(or):[0,0,0,0];let er,_r,Ar,zr,on,wr=0;if(k&&q instanceof o.aP&&q.coordinates.length>3)er=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0)))),_r=Float32Array.from(or.globeMatrix),Ar=Float32Array.from(o.dz(or)),zr=[o.aD(or.center.lng),o.aH(or.center.lat)],$t=q.elevatedGlobePerspectiveTransform,on=q.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){const Lr=o.dA(Se.canonical);wr=o.dB(Lr.getCenter().lat),er=Float32Array.from(o.bh(o.dD(Se.canonical))),_r=Float32Array.from(or.globeMatrix),Ar=Float32Array.from(o.dz(or)),zr=[o.aD(or.center.lng),o.aH(or.center.lat)],$t=[0,0],on=Float32Array.from(o.dC(Se.canonical,Lr,wr,or.worldSize/or._pixelsPerMercatorPixel))}else $t=q instanceof o.aP?q.perspectiveTransform:[0,0],er=new Float32Array(16),_r=new Float32Array(9),Ar=new Float32Array(16),zr=[0,0],on=new Float32Array(9);const sn=r0(st,er,_r,Ar,on,Jt||[0,0],o.ah(m.transform.zoom),zr,rr,Dt||1,bt,u,$t,I?u.paint.get("raster-elevation"):0,2,tt,ft,V.range,Pt,qe,X),un=m.isTileAffectedByFog(Se),Bn=m.getOrCreateProgram("raster",{defines:V.defines,overrideFog:un});if(m.uploadCommonUniforms(N,Bn,Te),q instanceof o.aP){const Lr=q.elevatedGlobeVertexBuffer,an=q.elevatedGlobeIndexBuffer;if(Q||!T)q.boundsBuffer&&q.boundsSegments&&Bn.draw(m,F.TRIANGLES,De,mr.disabled,re,ur.disabled,sn,u.id,q.boundsBuffer,m.quadTriangleIndexBuffer,q.boundsSegments);else if(Lr&&an){const cn=or.zoom<=o.cX?q.elevatedGlobeSegments:q.getSegmentsForLongitude(or.center.lng);cn&&Bn.draw(m,F.TRIANGLES,De,mr.disabled,re,Ie,sn,u.id,Lr,an,cn)}}else if(k){De=new Ht(F.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D);const Lr=m.globeSharedBuffers;if(Lr){const[an,cn,gn]=Lr.getGridBuffers(wr,!1);Bn.draw(m,F.TRIANGLES,De,we||Xe,m.colorModeForRenderPass(),Ie,sn,u.id,an,cn,gn)}}else{const{tileBoundsBuffer:Lr,tileBoundsIndexBuffer:an,tileBoundsSegments:cn}=m.getTileBoundsBuffers(We);Bn.draw(m,F.TRIANGLES,De,Xe,re,ur.disabled,sn,u.id,Lr,an,cn)}}if(!(q instanceof o.aP)&&k)for(const Se of Ae){const Te=Se.canonical.y===(1<<Se.canonical.z)-1;Se.canonical.y===0&&Tg(!0,Se,m,s,u,X,V,Ie,we||mr.disabled),Te&&Tg(!1,Se,m,s,u,X,V,Ie===ur.frontCW?ur.backCW:ur.frontCW,we||mr.disabled)}};k?be(pe,m.renderElevatedRasterBackface?ur.backCW:ur.frontCW,m.stencilModeFor3D()):be(pe,ur.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,s,u,g,x,w){m.renderPass==="offscreen"&&function(T,I,k,N){if(!N.length)return;const F=T.context,q=F.gl,V=I.getSource();if(!(V instanceof Dc))return;const X=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count")));let re=k.particlePositionRGBAImage;if(!re||re.width!==X){const pe=function(ge){const be=ge*ge,Ae=new Uint8Array(4*be),Ie=function(Se){return Se|=0,Se=Math.imul(2747636419^Se,2654435769),Se=Math.imul(Se^Se>>>16,2654435769),((Se=Math.imul(Se^Se>>>16,2654435769))>>>0)/4294967296},we=1/1.1;for(let Se=0;Se<be;Se++){const Te=we*(Ie(2*Se+0)+Hc),We=we*(Ie(2*Se+1)+Hc),je=255*Te%1,ht=255*We%1,tt=je,ft=We-ht/255,Pt=ht;Ae[4*Se+0]=255*(Te-je/255),Ae[4*Se+1]=255*tt,Ae[4*Se+2]=255*ft,Ae[4*Se+3]=255*Pt}return Ae}(X);re=k.particlePositionRGBAImage=new o.r({width:X,height:X},pe)}let Q=k.particleFramebuffer;Q?Q.width!==X&&(Q.destroy(),Q=k.particleFramebuffer=F.createFramebuffer(X,X,!0,null)):Q=k.particleFramebuffer=F.createFramebuffer(X,X,!0,null);const oe=[];for(const pe of N){const ge=I.getTile(pe);if(!(ge instanceof Fh))continue;const be=fs(ge,V,k);if(!be)continue;const Ae=[ge.tileSize,ge.tileSize];let Ie=k.tileFramebuffer;Ie||(Ie=k.tileFramebuffer=F.createFramebuffer(Ae[0],Ae[1],!0,null));let we=ge.rasterParticleState;we||(we=ge.rasterParticleState=new h0(F,pe,Ae,re));const Se=we.update(k.lastInvalidatedAt);we.particleTextureDimension!==X&&we.updateParticleTexture(pe,re);const Te=we.targetColorTexture;we.targetColorTexture=we.backgroundColorTexture,we.backgroundColorTexture=Te;const We=we.particleTexture0;we.particleTexture0=we.particleTexture1,we.particleTexture1=We,oe.push([pe,be,we,Se])}if(oe.length===0)return;const ie=o.q.now(),ue=k.previousDrawTimestamp?.001*(ie-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=ie,k.hasColorMap()){F.activeTexture.set(q.TEXTURE0+2);let pe=k.colorRampTexture;pe||(pe=k.colorRampTexture=new o.T(F,k.colorRamp,q.RGBA8)),pe.bind(q.LINEAR,q.CLAMP_TO_EDGE)}F.bindFramebuffer.set(k.tileFramebuffer.framebuffer),function(pe,ge,be){const Ae=pe.context,Ie=Ae.gl,we=ge.tileFramebuffer;Ae.activeTexture.set(Ie.TEXTURE0);const Se={u_texture:0,u_opacity:1.05*(We=ge.paint.get("raster-particle-fade-opacity-factor"))/(We+.05)},Te=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var We;for(const je of be){const[,,ht,tt]=je;we.colorAttachment.set(ht.targetColorTexture.texture),Ae.viewport.set([0,0,we.width,we.height]),Ae.clear({color:o.am.transparent}),tt&&(ht.backgroundColorTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE),Te.draw(pe,Ie.TRIANGLES,Ht.disabled,mr.disabled,Mr.alphaBlended,ur.disabled,Se,ge.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(T,k,oe),function(pe,ge,be,Ae){const Ie=pe.context,we=Ie.gl,Se=be.tileFramebuffer,Te=pe.transform.projection.name==="globe",We=be.paint.get("raster-particle-max-speed");for(const je of Ae){const[ht,tt,ft]=je;Ie.activeTexture.set(we.TEXTURE0+0),tt.texture.bind(we.LINEAR,we.CLAMP_TO_EDGE),Se.colorAttachment.set(ft.targetColorTexture.texture);const Pt=pe.getOrCreateProgram("rasterParticleDraw",{defines:tt.defines,overrideFog:!1});Ie.activeTexture.set(we.TEXTURE0+1);const qe=tt.scalarData?[]:[0,1,2,3].map(Xe=>o.e3[Xe](ht));qe.push(ht);const De=ht.canonical.x,st=ht.canonical.y;for(const Xe of qe){const yt=ge.getTile(Te?Xe.wrapped():Xe);if(!yt)continue;const vt=yt.rasterParticleState;if(!vt)continue;const bt=Xe.canonical.x+(1<<Xe.canonical.z)*(Xe.wrap-ht.wrap),Dt=Xe.canonical.y;vt.particleTexture0.bind(we.NEAREST,we.CLAMP_TO_EDGE);const Jt=B1(1,vt.particleTexture0.size[0],[bt-De,Dt-st],0,tt.texture.size,2,We,tt.textureOffset,tt.scale,tt.offset);Pt.draw(pe,we.POINTS,Ht.disabled,mr.disabled,Mr.alphaBlended,ur.disabled,Jt,be.id,vt.particleIndexBuffer,void 0,vt.particleSegment)}}}(T,I,k,oe),F.bindFramebuffer.set(k.particleFramebuffer.framebuffer),function(pe,ge,be,Ae){const Ie=pe.context,we=Ie.gl,Se=ge.paint.get("raster-particle-max-speed"),Te=Ae*ge.paint.get("raster-particle-speed-factor")*.15,We=function(ht){return Math.pow(ht,6)}(.01+1*ge.paint.get("raster-particle-reset-rate-factor")),je=ge.particleFramebuffer;Ie.viewport.set([0,0,je.width,je.height]);for(const ht of be){const[,tt,ft]=ht;Ie.activeTexture.set(we.TEXTURE0+0),tt.texture.bind(we.LINEAR,we.CLAMP_TO_EDGE),Ie.activeTexture.set(we.TEXTURE0+1);const Pt=ft.particleTexture0;Pt.bind(we.NEAREST,we.CLAMP_TO_EDGE);const qe=$1(1,Pt.size[0],0,tt.texture.size,Se,Te,We,tt.textureOffset,tt.scale,tt.offset);je.colorAttachment.set(ft.particleTexture1.texture),Ie.clear({color:o.am.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:tt.defines}).draw(pe,we.TRIANGLES,Ht.disabled,mr.disabled,Mr.unblended,ur.disabled,qe,ge.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(T,k,oe,ue)}(m,s,u,g),m.renderPass==="translucent"&&(function(T,I,k,N,F){const q=T.context,V=q.gl,X=I.getSource().tileSize,re=5*(1-o.af(o.cI,o.cI+1,T.transform.zoom))*X+k.paint.get("raster-particle-elevation"),Q=!T.options.moving,oe=T.transform.projection.name==="globe";if(!N.length)return;const[ie,ue]=T.stencilConfigForOverlap(N),pe=[];oe&&pe.push("PROJECTION_GLOBE_VIEW");const ge=T.stencilModeFor3D();for(const be of ue){const Ae=be.toUnwrapped(),Ie=I.getTile(be);if(!Ie.rasterParticleState)continue;const we=Ie.rasterParticleState,Se=100;Ie.registerFadeDuration(Se);const Te=I.findLoadedParent(be,0),We=Is(Ie,Te,I,T.transform,Se);let je,ht;T.terrain&&T.terrain.prepareDrawTile(),q.activeTexture.set(V.TEXTURE0),we.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),q.activeTexture.set(V.TEXTURE1),Te&&Te.rasterParticleState?(Te.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),je=Math.pow(2,Te.tileID.overscaledZ-Ie.tileID.overscaledZ),ht=[Ie.tileID.canonical.x*je%1,Ie.tileID.canonical.y*je%1]):we.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const tt=oe?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(Ae,Q),ft=T.transform,Pt=Xc(ft),qe=o.dA(be.canonical),De=o.dB(qe.getCenter().lat);let st,Xe,yt,vt,bt;oe?(st=Float32Array.from(o.bh(o.dD(be.canonical))),Xe=Float32Array.from(ft.globeMatrix),yt=Float32Array.from(o.dz(ft)),vt=[o.aD(ft.center.lng),o.aH(ft.center.lat)],bt=Float32Array.from(o.dC(be.canonical,qe,De,ft.worldSize/ft._pixelsPerMercatorPixel))):(st=new Float32Array(16),Xe=new Float32Array(9),yt=new Float32Array(16),vt=[0,0],bt=new Float32Array(9));const Dt=yg(tt,st,Xe,yt,bt,ht||[0,0],o.ah(T.transform.zoom),vt,Pt,je||1,We,re),Jt=T.isTileAffectedByFog(be),or=T.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:Jt});if(T.uploadCommonUniforms(q,or,Ae),oe){const $t=new Ht(V.LEQUAL,Ht.ReadOnly,T.depthRangeFor3D),rr=0,er=T.globeSharedBuffers;if(er){const[_r,Ar,zr]=er.getGridBuffers(De,rr!==0);or.draw(T,V.TRIANGLES,$t,ge,Mr.alphaBlended,T.renderElevatedRasterBackface?ur.frontCCW:ur.backCCW,Dt,k.id,_r,Ar,zr)}}else{const $t=T.depthModeForSublayer(0,Ht.ReadOnly),rr=ie[be.overscaledZ],{tileBoundsBuffer:er,tileBoundsIndexBuffer:_r,tileBoundsSegments:Ar}=T.getTileBoundsBuffers(Ie);or.draw(T,V.TRIANGLES,$t,rr,Mr.alphaBlended,ur.disabled,Dt,k.id,er,_r,Ar)}}T.resetStencilClippingMasks()}(m,s,u,g),m.style.map.triggerRepaint())},background:function(m,s,u,g){const x=u.paint.get("background-color"),w=u.paint.get("background-color-use-theme").constantOr("default")==="none",T=u.paint.get("background-opacity"),I=u.paint.get("background-emissive-strength"),k=u.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const N=m.context,F=N.gl,q=m.transform,V=q.tileSize,X=u.paint.get("background-pattern");let re;if(X!==void 0&&(X===null||(re=m.imageManager.getPattern(o.I.from(X.toString()),u.scope,m.style.getLut(u.scope)),!re)))return;const Q=!X&&x.a===1&&T===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==Q)return;const oe=mr.disabled,ie=m.depthModeForSublayer(0,Q==="opaque"?Ht.ReadWrite:Ht.ReadOnly),ue=m.colorModeForDrapableLayerRenderPass(I),pe=X?"backgroundPattern":"background";let ge,be=g;if(be||(ge=m.getBackgroundTiles(),be=Object.values(ge).map(Ae=>Ae.tileID)),X&&(N.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context,u.scope)),k){const Ae=m.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),Ie=new Float32Array(o.bx([])),we=new o.aM(0,0,0,0,0),Se=X?n0(Ie,I,T,m,0,u.scope,re,k,{tileID:we,tileSize:V}):V1(Ie,I,T,x.toPremultipliedRenderColor(w?null:u.lut));Ae.draw(m,F.TRIANGLES,ie,oe,ue,ur.disabled,Se,u.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Ae of be){const Ie=m.isTileAffectedByFog(Ae),we=m.getOrCreateProgram(pe,{overrideFog:Ie}),Se=Ae.toUnwrapped(),Te=g?Ae.projMatrix:m.transform.calculateProjMatrix(Se);m.prepareDrawTile();const We=s?s.getTile(Ae):ge?ge[Ae.key]:new Ru(Ae,V,q.zoom,m),je=X?n0(Te,I,T,m,0,u.scope,re,k,{tileID:Ae,tileSize:V}):V1(Te,I,T,x.toPremultipliedRenderColor(w?null:u.lut));m.uploadCommonUniforms(N,we,Se);const{tileBoundsBuffer:ht,tileBoundsIndexBuffer:tt,tileBoundsSegments:ft}=m.getTileBoundsBuffers(We);we.draw(m,F.TRIANGLES,ie,oe,ue,ur.disabled,je,u.id,ht,tt,ft)}},sky:function(m,s,u){const g=m._atmosphere?o.ah(m.transform.zoom):1,x=u.paint.get("sky-opacity")*g;if(x===0)return;const w=m.context,T=u.paint.get("sky-type"),I=new Ht(w.gl.LEQUAL,Ht.ReadOnly,[0,1]),k=m.frameCounter/1e3%1;T==="atmosphere"?m.renderPass==="offscreen"?u.needsSkyboxCapture(m)&&(function(N,F,q,V){const X=N.context,re=X.gl;let Q=F.skyboxFbo;if(!Q){Q=F.skyboxFbo=X.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Zu(X),F.skyboxTexture=X.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,F.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let pe=0;pe<6;++pe)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(Q.framebuffer),X.viewport.set([0,0,32,32]);const oe=F.getCenter(N,!0),ie=N.getOrCreateProgram("skyboxCapture"),ue=new Float64Array(16);o.bx(ue),o.eh(ue,ue,.5*-Math.PI),tl(N,F,ie,ue,oe,0),o.bx(ue),o.eh(ue,ue,.5*Math.PI),tl(N,F,ie,ue,oe,1),o.bx(ue),o.cR(ue,ue,.5*-Math.PI),tl(N,F,ie,ue,oe,2),o.bx(ue),o.cR(ue,ue,.5*Math.PI),tl(N,F,ie,ue,oe,3),o.bx(ue),tl(N,F,ie,ue,oe,4),o.bx(ue),o.eh(ue,ue,Math.PI),tl(N,F,ie,ue,oe,5),X.viewport.set([0,0,N.width,N.height])}(m,u),u.markSkyboxValid(m)):m.renderPass==="sky"&&function(N,F,q,V,X){const re=N.context,Q=re.gl,oe=N.transform,ie=N.getOrCreateProgram("skybox");re.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,F.skyboxTexture);const ue=((pe,ge,be,Ae,Ie)=>({u_matrix:pe,u_sun_direction:ge,u_cubemap:0,u_opacity:Ae,u_temporal_offset:Ie}))(oe.skyboxMatrix,F.getCenter(N,!1),0,V,X);N.uploadCommonUniforms(re,ie),ie.draw(N,Q.TRIANGLES,q,mr.disabled,N.colorModeForRenderPass(),ur.backCW,ue,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,u,I,x,k):T==="gradient"&&m.renderPass==="sky"&&function(N,F,q,V,X){const re=N.context,Q=re.gl,oe=N.transform,ie=N.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Zu(re)),re.activeTexture.set(Q.TEXTURE0);let ue=F.colorRampTexture;ue||(ue=F.colorRampTexture=new o.T(re,F.colorRamp,Q.RGBA8)),ue.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const pe=((ge,be,Ae,Ie,we)=>({u_matrix:ge,u_color_ramp:0,u_center_direction:be,u_radius:o.al(Ae),u_opacity:Ie,u_temporal_offset:we}))(oe.skyboxMatrix,F.getCenter(N,!1),F.paint.get("sky-gradient-radius"),V,X);N.uploadCommonUniforms(re,ie),ie.draw(N,Q.TRIANGLES,q,mr.disabled,N.colorModeForRenderPass(),ur.backCW,pe,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,u,I,x,k)},custom:function(m,s,u,g){const x=m.context,w=u.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&u.isDraped(s)){if(m.renderPass==="offscreen"){const T=w.prerender;if(T){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;T.call(w,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.ah(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else T.call(w,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const I=w.renderToTile;if(I){const k=g[0].canonical,N={x:k.x+g[0].wrap*(w.wrapTileId?0:1<<k.z),y:k.y,z:k.z};x.setDepthMode(Ht.disabled),x.setStencilMode(mr.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),I.call(w,x.gl,N),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(mr.disabled);const T=w.renderingMode==="3d"?new Ht(m.context.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Ht.ReadOnly);if(x.setDepthMode(T),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;w.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.ah(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else w.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,s,u,g){if(m.renderPass==="opaque")return;const x=u.paint.get("model-opacity").constantOr(1);if(x===0)return;const w=u.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!w||m.terrain&&x<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const T=m.shadowRenderer,I=u.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,I||(T.enabled=!1));const k=()=>{T&&(T.useNormalOffset=!0,I||(T.enabled=!0))},N=s.getSource();if(m.renderPass==="light-beam"&&N.type!=="batched-model")return;if(N.type==="vector"||N.type==="geojson")return function(ie,ue,pe,ge,be){const Ae=ie.transform;if(Ae.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${Ae.projection.name} projection is not yet implemented`);const Ie=Ae.getFreeCameraOptions().position;if(!ie.modelManager)return;const we=ie.modelManager;pe.modelManager=we;const Se=ie.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Te=pe._unevaluatedLayout._values["model-id"],We=Object.assign({},pe.layout.get("model-id").parameters),je=ie.style.order.indexOf(pe.fqid);for(const ht of ge){const tt=ue.getTile(ht).getBucket(pe);if(!tt||tt.projection.name!==Ae.projection.name)continue;const ft=tt.getModelUris();ft&&!tt.modelsRequested&&(we.addModelsFromBucket(ft,be),tt.modelsRequested=!0);const Pt=DC(ht,Ae);We.zoom=Pt;const qe=Te.possiblyEvaluate(We);if(ld(ie,tt,ht),vl.shadowUniformsInitialized=!1,vl.useSingleShadowCascade=!!Se&&Se.getMaxCascadeForTile(ht.toUnwrapped())===0,ie.renderPass==="shadow"&&Se){if(ie.currentShadowCascade===1&&tt.isInsideFirstShadowMapFrustum)continue;const Xe=Ae.calculatePosMatrix(ht.toUnwrapped(),Ae.worldSize);if(vl.tileMatrix.set(Xe),vl.shadowTileMatrix=Float32Array.from(Se.calculateShadowPassMatrixFromMatrix(Xe)),vl.aabb.min.fill(0),vl.aabb.max[0]=vl.aabb.max[1]=o.aj,vl.aabb.max[2]=0,y0(tt,vl,ie,pe.scope))continue}const De=1<<ht.canonical.z,st=[((Ie.x-ht.wrap)*De-ht.canonical.x)*o.aj,(Ie.y*De-ht.canonical.y)*o.aj,Ie.z*De*o.aj];ie.conflationActive&&Object.keys(tt.instancesPerModel).length>0&&ie.style.isLayerClipped(pe,ue.getSource())&&tt.updateReplacement(ht,ie.replacementSource,je,be)&&(tt.uploaded=!1,tt.upload(ie.context));for(let Xe in tt.instancesPerModel){const yt=tt.instancesPerModel[Xe];yt.features.length>0&&(Xe=qe.evaluate(yt.features[0].feature,{}));const vt=we.getModel(Xe,be);if(vt||we.hasURLBeenRequested(Xe)||tt.modelUris.includes(Xe)||(tt.modelUris.push(Xe),tt.modelsRequested=!1),vt&&vt.uploaded)for(const bt of vt.nodes)g0(ie,pe,bt,yt,st,ht,vl)}}}(m,s,u,g,N.type==="vector"?u.scope:""),void k();if(!N.loaded())return;if(N.type==="batched-model")return function(ie,ue,pe,ge){pe.resetLayerRenderingStats(ie);const be=ie.context,Ae=ie.transform,Ie=ie.style.fog,we=ie.shadowRenderer;if(Ae.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${Ae.projection.name} projection is not yet implemented`);const Se=ie.transform.getFreeCameraOptions().position,Te=o.c1([],[Se.x,Se.y,Se.z],ie.transform.worldSize),We=o.eq([],Te),je=o.bx([]),ht=o.e9(Ae.center.lat,Ae.zoom),tt=o.bn([],[1,1,1/ht]);o.bo(je,je,We);const ft=pe.paint.get("model-opacity").constantOr(1),Pt=new Ht(be.gl.LEQUAL,Ht.ReadWrite,ie.depthRangeFor3D),qe=new Ht(be.gl.LEQUAL,Ht.ReadOnly,ie.depthRangeFor3D),De=new o.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),st=ie.renderPass==="shadow",Xe=st&&we?we.getCurrentCascadeFrustum():Ae.getFrustum(Ae.scaleZoom(Ae.worldSize)),yt=pe.paint.get("model-front-cutoff"),vt=yt[2]<1,bt=yl(ie,pe.paint.get("model-cutoff-fade-range")),Dt=pe.getLayerRenderingStats();(function(Jt,or,$t,rr){const er=Jt.terrain?Jt.terrain.exaggeration():0,_r=Jt.transform.zoom;for(const Ar of rr){const zr=or.getTile(Ar).getBucket($t);zr&&(zr.setFilter($t.filter),Jt.conflationActive&&zr.updateReplacement(Ar,Jt.replacementSource),zr.evaluateTransform(Jt,$t),Jt.terrain&&er>0&&zr.elevationUpdate(Jt.terrain,er,Ar,$t.source),zr.needsReEvaluation(Jt,_r,$t)&&zr.evaluate($t))}})(ie,ue,pe,ge),function(){let Jt,or,$t;vt?(Jt=ge.length-1,or=-1,$t=-1):(Jt=0,or=ge.length,$t=1);const rr=new Float64Array(16),er=o.cx(),_r=new o.P(0,0);for(let Ar=Jt;Ar!==or;Ar+=$t){const zr=ge[Ar],on=ue.getTile(zr).getBucket(pe);if(!on||!on.uploaded)continue;let wr=!1;we&&(wr=we.getMaxCascadeForTile(zr.toUnwrapped())===0);const sn=Ae.calculatePosMatrix(zr.toUnwrapped(),Ae.worldSize),un=on.modelTraits;!st&&vt&&(o.bi(rr,sn),o.ad(er,Te,rr),_r.x=er[0],_r.y=er[1]);const Bn=[];on.setFilter(pe.filter);for(const Lr of on.getNodesInfo()){if(Lr.hiddenByReplacement||!Lr.node.meshes)continue;const an=Lr.node;let cn=0;ie.terrain&&an.elevation&&(cn=an.elevation*ie.terrain.exaggeration());const gn=(()=>{const So=Lr.aabb;return De.min=[...So.min],De.max=[...So.max],De.min[2]+=cn,De.max[2]+=cn,o.ad(De.min,De.min,sn),o.ad(De.max,De.max,sn),De})(),Fr=Lr.evaluatedScale;if(Fr[0]<=1&&Fr[1]<=1&&Fr[2]<=1&&gn.intersects(Xe)===0)continue;if(!st&&vt){const So=.16666666666666666;Lr.cameraCollisionOpacity=Te[0]>gn.min[0]&&Te[0]<gn.max[0]&&Te[1]>gn.min[1]&&Te[1]<gn.max[1]&&Te[2]*ht<gn.max[2]&&an.footprint&&o.bY(_r,an.footprint)?Math.max(Lr.cameraCollisionOpacity-So,0):Math.min(1,Lr.cameraCollisionOpacity+So)}const Mn=[...sn],hn=1/o.d4(zr.canonical),ui=an.anchor?an.anchor[0]:0,rn=an.anchor?an.anchor[1]:0;o.bo(Mn,Mn,[ui*(Fr[0]-1)+Lr.evaluatedTranslation[0]*hn,rn*(Fr[1]-1)+Lr.evaluatedTranslation[1]*hn,cn+Lr.evaluatedTranslation[2]]),o.cn(Fr,o.es)||o.cP(Mn,Mn,Fr);const yn=o.az([],Mn,an.matrix),Nn=o.az([],Ae.expandedFarZProjMatrix,yn),Di=o.az([],Ae.expandedFarZProjMatrix,Mn),Oi=o.aA([],[ui,rn,cn,1],Nn)[2];an.hidden=!1;let zi=ft;st||(vt&&(zi*=Lr.cameraCollisionOpacity,zi*=Q1(Mn,Ae,Lr.aabb,yt)),zi*=J1(bt,Oi)),zi!==0?Bn.push({nodeInfo:Lr,depth:Oi,opacity:zi,wvpForNode:Nn,wvpForTile:Di,nodeModelMatrix:yn,tileModelMatrix:Mn}):an.hidden=!0}st||Bn.sort((Lr,an)=>!vt||Lr.opacity===1&&an.opacity===1?Lr.depth<an.depth?-1:1:Lr.opacity===1?-1:an.opacity===1?1:Lr.depth>an.depth?-1:1);for(const Lr of Bn){const an=Lr.nodeInfo,cn=an.node;let gn=o.az([],tt,Lr.tileModelMatrix);o.az(gn,je,gn);const Fr=o.bi([],gn);o.ea(Fr,Fr),o.cP(Fr,Fr,Pg),gn=o.az(gn,gn,cn.matrix);const Mn=ie.renderPass==="light-beam",hn=pe.paint.get("model-color-use-theme").constantOr("default")==="none",ui=un&o.ex.HasMapboxMeshFeatures,rn=ui?0:an.evaluatedRMEA[0][2];for(let yn=0;yn<cn.meshes.length;++yn){const Nn=cn.meshes[yn],Di=yn===cn.lightMeshIndex;let Oi=Lr.wvpForNode;if(Di){if(!Mn&&!ie.terrain&&ie.shadowRenderer){ie.currentLayer<ie.firstLightBeamLayer&&(ie.firstLightBeamLayer=ie.currentLayer);continue}Oi=Lr.wvpForTile}else if(Mn)continue;const zi={defines:[]},So=[];if(!st&&we&&(we.useNormalOffset=!!Nn.normalBuffer),up(zi.defines,So,Nn,ie,hn?null:pe.lut),ui||zi.defines.push("DIFFUSE_SHADED"),wr&&zi.defines.push("SHADOWS_SINGLE_CASCADE"),Dt&&(st?Dt.numRenderedVerticesInShadowPass+=Nn.vertexArray.length:Dt.numRenderedVerticesInTransparentPass+=Nn.vertexArray.length),st){Ag(Nn,Lr.nodeModelMatrix,ie,pe);continue}let rl=null;if(Ie){const Fo=cp(Lr.nodeModelMatrix,ie.transform);if(rl=new Float32Array(Fo),Ae.projection.name!=="globe"){const Ei=Nn.aabb.min,gi=Nn.aabb.max,[Un,Hi]=Ie.getOpacityForBounds(Fo,Ei[0],Ei[1],gi[0],gi[1]);zi.overrideFog=Un>=gt||Hi>=gt}}const ms=Nn.material;let $s;ms.occlusionTexture&&ms.occlusionTexture.offsetScale&&($s=ms.occlusionTexture.offsetScale,zi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const zo=ie.getOrCreateProgram("model",zi);!st&&we&&we.setupShadowsFromMatrix(Lr.tileModelMatrix,zo,we.useNormalOffset),ie.uploadCommonUniforms(be,zo,null,rl);const sa=ms.pbrMetallicRoughness;sa.metallicFactor=.9,sa.roughnessFactor=.5;const Da=i0(new Float32Array(Oi),new Float32Array(gn),new Float32Array(Fr),new Float32Array(cn.matrix),ie,Lr.opacity,sa.baseColorFactor,ms.emissiveFactor,sa.metallicFactor,sa.roughnessFactor,ms,rn,pe,[0,0,0],$s);!Di&&(an.hasTranslucentParts||Lr.opacity<1)&&zo.draw(ie,be.gl.TRIANGLES,Pt,mr.disabled,Mr.disabled,ur.backCCW,Da,pe.id,Nn.vertexBuffer,Nn.indexBuffer,Nn.segments,pe.paint,ie.transform.zoom,void 0,So),zo.draw(ie,be.gl.TRIANGLES,Di?qe:Pt,mr.disabled,Di||Lr.opacity<1||an.hasTranslucentParts?Mr.alphaBlended:Mr.unblended,ur.backCCW,Da,pe.id,Nn.vertexBuffer,Nn.indexBuffer,Nn.segments,pe.paint,ie.transform.zoom,void 0,So)}}}}()}(m,s,u,g),void k();if(N.type!=="model")return;const F=N.getModels(),q=[],V=m.transform.getFreeCameraOptions().position,X=o.c1([],[V.x,V.y,V.z],m.transform.worldSize);o.eq(X,X);const re=[],Q=[];let oe=0;for(const ie of F){const ue=u.paint.get("model-rotation").constantOr(null),pe=u.paint.get("model-scale").constantOr(null),ge=u.paint.get("model-translation").constantOr(null);ie.computeModelMatrix(m,ue,pe,ge,!0,!0,!1);const be=o.bx([]),Ae=o.e9(ie.position.lat,m.transform.zoom),Ie=o.bn([],[1,1,1/Ae]);o.bo(be,be,X),q.push({zScaleMatrix:Ie,negCameraPosMatrix:be});for(const we of ie.nodes)m0(m.transform,we,ie.matrix,m.transform.expandedFarZProjMatrix,oe,re,Q);oe++}if(re.sort((ie,ue)=>ue.depth-ie.depth),m.renderPass!=="shadow"){if(x===1)for(const ie of Q)ad(ie,m,u,q[ie.modelIndex],mr.disabled,m.colorModeForRenderPass());else{for(const ie of Q)ad(ie,m,u,q[ie.modelIndex],mr.disabled,Mr.disabled);for(const ie of Q)ad(ie,m,u,q[ie.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const ie of re)ad(ie,m,u,q[ie.modelIndex],mr.disabled,m.colorModeForRenderPass());k()}else{for(const ie of Q)Ag(ie.mesh,ie.nodeModelMatrix,m,u);for(const ie of re)Ag(ie.mesh,ie.nodeModelMatrix,m,u);k()}}},Ig={line:function(m,s,u){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(s){const g=s.getVisibleCoordinates();for(const x of g){const w=s.getTile(x).getBucket(m);if(w&&(w.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,s,u){const g=s.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,g.type==="vector"?m.scope:""));if(g.type==="batched-model"||g.type!=="model")return;const x=g.getModels();for(const w of x)w.upload(u.context)},raster:function(m,s,u){const g=s.getSource();if(!(g instanceof Dc&&g.loaded()))return;const x=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const w=m.paint.get("raster-array-band")||g.getInitialBand(x);if(w==null)return;const T=s.getIds().map(I=>s.getTileByID(I));for(const I of T)I.updateNeeded(m.id,w)&&g.prepareTile(I,x,m.id,w)},"raster-particle":function(m,s,u){const g=s.getSource();if(!(g instanceof Dc&&g.loaded()))return;const x=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const w=m.paint.get("raster-particle-array-band")||g.getInitialBand(x);if(w==null)return;const T=s.getIds().map(I=>s.getTileByID(I));for(const I of T)I.updateNeeded(m.id,w)&&g.prepareTile(I,x,m.id,w)}},Mg={fill:Wt},na={fill:function(m,s,u,g){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const x=m.context.gl,w=new Ht(x.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D),T=new mr({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),I=m.transform.getFreeCameraOptions().position,k=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const N of g){const F=s.getTile(N),q=F.getBucket(u);if(!q)continue;const V=q.elevatedStructures;if(!V||V.depthSegments.segments[0].primitiveLength===0)continue;const X=op(N.toUnwrapped(),I),re=m.translatePosMatrix(N.projMatrix,F,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),Q=mg(re,X,0,1,0);k.draw(m,x.TRIANGLES,w,T,Mr.disabled,ur.disabled,Q,u.id,V.vertexBuffer,V.indexBuffer,V.depthSegments,u.paint,m.transform.zoom)}}};class Yc{constructor(s,u,g,x,w,T){this.context=new xg(s,u),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const I=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const N of I)this._debugParams.enabledLayers[N]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const N of I)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],N);this.occlusionParams=new cd(w),this.setup(),this.numSublayers=Ps.maxUnderzooming+Ps.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new mC(this),this._wireframeDebugCache=new hp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const k=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,k,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=T}updateTerrain(s,u){const g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hg(this,s));const x=this._terrain;this.transform.elevation=g?x:null,x.update(s,this.transform,u),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(s){const u=s.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=u.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const w=g+.78*(x-g);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new hg(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,u){if(this.width=s*o.q.devicePixelRatio,this.height=u*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const s=this.context,u=new o.ba;u.emplaceBack(0,0),u.emplaceBack(o.aj,0),u.emplaceBack(0,o.aj),u.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=s.createVertexBuffer(u,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const g=new o.ba;g.emplaceBack(0,0),g.emplaceBack(o.aj,0),g.emplaceBack(0,o.aj),g.emplaceBack(o.aj,o.aj),this.debugBuffer=s.createVertexBuffer(g,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const x=new o.ba;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const w=new o.aZ;w.emplaceBack(0,0,0,0),w.emplaceBack(o.aj,0,o.aj,0),w.emplaceBack(0,o.aj,0,o.aj),w.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=s.createVertexBuffer(w,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const T=new o.a_;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(T);const I=new o.bb;for(const N of[0,1,3,2,0])I.emplaceBack(N);this.debugIndexBuffer=s.createIndexBuffer(I),this.emptyTexture=new o.T(s,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=o.bz();const k=this.context.gl;this.stencilClearMode=new mr({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,Ht.disabled,this.stencilClearMode,Mr.disabled,ur.disabled,cg(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,u,g){if(!u||this.currentStencilSource===u.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const k of g)if(this._tileClippingMaskIDs[k.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=u.id;const x=this.context,w=x.gl;this.nextStencilID+g.length>256&&this.clearStencil(),x.setColorMode(Mr.disabled),x.setDepthMode(Ht.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of g){const k=u.getTile(I),N=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:q,tileBoundsSegments:V}=this.getTileBoundsBuffers(k);T.draw(this,w.TRIANGLES,Ht.disabled,new mr({func:w.ALWAYS,mask:0},N,255,w.KEEP,w.KEEP,w.REPLACE),Mr.disabled,ur.disabled,cg(I.projMatrix),"$clipping",F,q,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,u=this.context.gl;return new mr({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const u=this.context.gl;return new mr({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(s){const u=this.context.gl,g=s.sort((T,I)=>I.overscaledZ-T.overscaledZ),x=g[g.length-1].overscaledZ,w=g[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const T={};for(let I=0;I<w;I++)T[I+x]=new mr({func:u.GEQUAL,mask:255},I+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=w,[T,g]}return[{[x]:mr.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Mr([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mr.unblended:Mr.alphaBlended}colorModeForDrapableLayerRenderPass(s){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Mr([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,u,g,x=!1){if(this.depthOcclusion)return new Ht(this.context.gl.GREATER,Ht.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Ht.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Ht(g||this.context.gl.LEQUAL,u,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,u=Math.ceil(this.width),g=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),w=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===u&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),u!==0&&g!==0&&(this.depthFBO=new Wu(this.context,u,g,!1,"texture"),this.depthTexture=new o.T(this.context,{width:u,height:g,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),s.bindTexture(s.TEXTURE_2D,w),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,u,g,0,0,u,g,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,u)=>s+u/this._fpsHistory.length,0))}render(s,u){const g=o.q.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=u;const x=this.style._mergedLayers,w=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(w).filter(qe=>{const De=x[qe];return!(De.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[De.type]});let I=T(),k=!1,N=!1,F=null;for(const qe of I){const De=x[qe];De.type==="circle"?k=!0:De.type==="building"?F=De:De.type==="symbol"&&(De.hasInitialOcclusionOpacityProperties?N=!0:k=!0)}let q=I.map(qe=>x[qe]);const V=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let X=0,re=!1;for(const qe in V){const De=V[qe];De.used&&(De.prepare(this.context),De.getSource().usedInConflation&&++X)}let Q=!1;for(const qe of q)qe.isHidden(this.transform.zoom)||(qe.type==="clip"&&(Q=!0),this.prepareLayer(qe));const oe={},ie={},ue={},pe={},ge={};for(const qe in V){const De=V[qe];oe[qe]=De.getVisibleCoordinates(),ie[qe]=oe[qe].slice().reverse(),ue[qe]=De.getVisibleCoordinates(!0).reverse(),pe[qe]=De.getShadowCasterCoordinates(),ge[qe]=De.sortCoordinatesByDistance(oe[qe])}const be=qe=>{const De=this.style.getLayerSourceCache(qe);return De&&De.used?De.getSource():null};if(X||Q||this._clippingActiveLastFrame){const qe=[],De=[];let st=0;for(const Xe of q)this.isSourceForClippingOrConflation(Xe,be(Xe))&&(qe.push(Xe),De.push(st)),st++;if(qe&&(Q||qe.length>1)||this._clippingActiveLastFrame){Q=!1;const Xe=[];for(let yt=0;yt<qe.length;yt++){const vt=qe[yt],bt=De[yt],Dt=this.style.getLayerSourceCache(vt);if(!Dt||!Dt.used||!Dt.getSource().usedInConflation&&vt.type!=="clip"&&vt.type!=="building")continue;let Jt=o.eF,or=o.bW.None;const $t=[];let rr=!0;if(vt.type==="building")Jt=o.eH;else if(vt.type==="clip"){Jt=bt;for(const er of vt.layout.get("clip-layer-types"))or|=er==="model"?o.bW.Model:er==="symbol"?o.bW.Symbol:o.bW.FillExtrusion;for(const er of vt.layout.get("clip-layer-scope"))$t.push(er);vt.isHidden(this.transform.zoom)?rr=!1:Q=!0}rr&&Xe.push({layer:vt.fqid,cache:Dt,order:Jt,clipMask:or,clipScope:$t})}this.replacementSource.setSources(Xe),re=!0}}this._clippingActiveLastFrame=Q,re||this.replacementSource.clear(),this.conflationActive=re,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let qe=0;qe<q.length;qe++){const De=q[qe],st=De.cutoffRange();if(this.longestCutoffRange=Math.max(st,this.longestCutoffRange),st>0){const Xe=be(De);Xe&&(this.minCutoffZoom=Math.max(Xe.minzoom,this.minCutoffZoom)),De.minzoom&&(this.minCutoffZoom=Math.max(De.minzoom,this.minCutoffZoom))}De.is3D(w)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=qe),this._lastOcclusionLayer=qe)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ue),this.opaquePassCutoff=0,I=T(),q=I.map(qe=>x[qe]));const Ie=this._shadowRenderer;if(Ie){Ie.updateShadowParameters(this.transform,this.style.directionalLight);for(const qe in V)for(const De of oe[qe]){let st={min:0,max:0};this.terrain&&(st=this.terrain.getMinMaxForTile(De)||st),Ie.addShadowReceiver(De.toUnwrapped(),st.min,st.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ve(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const we=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Se=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(we&&!this._snow&&(this._snow=new v0(this)),!we&&this._snow&&(this._snow.destroy(),delete this._snow),Se&&!this._rain&&(this._rain=new hd(this)),!Se&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),F){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Y1);const qe=this.style.getLayerSourceCache(F);this.buildingTileBorderManager.updateBorders(qe,F)}if(!xr.has(this.context.gl))return;this.renderPass="offscreen";for(const qe of q){const De=s.getLayerSourceCache(qe);if(!qe.hasOffscreenPass()||qe.isHidden(this.transform.zoom))continue;const st=De?ie[De.id]:void 0;(qe.type==="custom"||qe.type==="raster"||qe.type==="raster-particle"||qe.isSky()||st&&st.length)&&this.renderLayer(this,De,qe,st)}this.depthRangeFor3D=[0,1-(q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,pe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Te=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),We=(()=>{if(u.showOverdrawInspector)return o.am.black;const qe=this.style.fog;if(qe&&this.transform.projection.supportsFog){const De=this.style.getLut(qe.scope);if(!Te){const st=qe.properties.get("color-use-theme")==="none",Xe=qe.properties.get("color").toNonPremultipliedRenderColor(st?null:De).toArray01();return new o.am(...Xe)}if(Te){const st=qe.properties.get("space-color-use-theme")==="none",Xe=qe.properties.get("space-color").toNonPremultipliedRenderColor(st?null:De).toArray01();return new o.am(...Xe)}}return o.am.transparent})();if(this.context.clear({color:We,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const qe=q[this.currentLayer],De=s.getLayerSourceCache(qe);if(qe.isSky())continue;const st=De?(qe.is3D(w)?ge:ie)[De.id]:void 0;this._renderTileClippingMasks(qe,De,st),this.renderLayer(this,De,qe,st)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const qe=q[this.currentLayer],De=s.getLayerSourceCache(qe);qe.isSky()&&this.renderLayer(this,De,qe,De?ie[De.id]:void 0)}function je(qe,De){let st;return De&&(st=(qe.type==="symbol"?ue:qe.is3D(w)?ge:ie)[De.id]),st}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const qe=q[this.currentLayer];if(qe.type==="raster"||qe.type==="raster-particle"){const De=s.getLayerSourceCache(qe);this.renderLayer(this,De,qe,je(qe,De))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ht=0;Ie&&(ht=Ie.getShadowCastingLayerCount());let tt=!1,ft=-1;for(let qe=0;qe<I.length;++qe){const De=q[qe];De.isHidden(this.transform.zoom)||De.is3D(w)&&(ft=qe)}N&&ft===-1&&(k=!0);let Pt=!1;for(;this.currentLayer<I.length;){const qe=q[this.currentLayer],De=s.getLayerSourceCache(qe);if(qe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(qe)){if(qe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Pt&&qe.is3D(w)&&!w){const st=this.currentLayer,Xe=yt=>{for(this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const vt=q[this.currentLayer];if(Mg[vt.type]){const bt=this.style.getLayerSourceCache(vt);Mg[vt.type](this,bt,vt,je(vt,bt),yt)}}};Xe("initialize"),Xe("reset"),this.currentLayer=st,Pt=!0}if(k&&!tt&&this.terrain&&!this.transform.isOrthographic&&(tt=!0,this.blitDepth()),N&&ft!==-1&&this.currentLayer===ft+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(qe,De,De?oe[De.id]:void 0),this.renderLayer(this,De,qe,je(qe,De)),!this.terrain&&Ie&&ht>0&&qe.hasShadowPass()&&--ht==0){{this.clearStencil(),this.resetStencilClippingMasks();const st=this.currentLayer;for(this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const Xe=q[this.currentLayer];if(na[Xe.type]){const yt=this.style.getLayerSourceCache(Xe);na[Xe.type](this,yt,Xe,je(Xe,yt))}}this.currentLayer=st}if(Ie.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const st=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=st;this.currentLayer++){const Xe=q[this.currentLayer];if(!Xe.hasLightBeamPass())continue;const yt=s.getLayerSourceCache(Xe);this.renderLayer(this,yt,Xe,yt?ie[yt.id]:void 0)}this.currentLayer=st,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const st=this.currentLayer;this.depthOcclusion=!0;for(const Xe of this.layersWithOcclusionOpacity){this.currentLayer=Xe;const yt=q[this.currentLayer],vt=s.getLayerSourceCache(yt),bt=vt?ie[vt.id]:void 0;this.terrain||this._renderTileClippingMasks(yt,vt,vt?oe[vt.id]:void 0),this.renderLayer(this,vt,yt,bt)}this.depthOcclusion=!1,this.currentLayer=st,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let qe=null;q.forEach(De=>{const st=s.getLayerSourceCache(De);st&&!De.isHidden(this.transform.zoom)&&st.getVisibleCoordinates().length&&(!qe||qe.getSource().maxzoom<st.getSource().maxzoom)&&(qe=st)}),qe&&this.options.showTileBoundaries&&_l(this,qe,qe.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&_l(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(qe){const De=qe.transform.padding;ap(qe,qe.transform.height-(De.top||0),3,q1),ap(qe,De.bottom||0,3,d0),Eg(qe,De.left||0,3,f0),Eg(qe,qe.transform.width-(De.right||0),3,p0);const st=qe.transform.centerPoint;(function(Xe,yt,vt,bt){lp(Xe,yt-1,vt-10,2,20,bt),lp(Xe,yt-10,vt-1,20,2,bt)})(qe,st.x,qe.transform.height-st.y,Z1)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),re||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:u}=this.transform.projection,g=!u||!u.includes(s.type);if(Ig[s.type]&&(g||this.terrain&&s.type==="custom")){const x=this.style.getLayerSourceCache(s);Ig[s.type](s,x,this)}this.gpuTimingEnd()}renderLayer(s,u,g,x){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||g.type!=="custom")||g.type==="clip"||x0[g.type](s,u,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,g=this.context.gl;let x=this.gpuTimers[s.id];x||(x=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),x.calls++,g.beginQuery(u.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,u=this.context.gl,g=u.createQuery();this.deferredRenderGpuTimeQueries.push(g),u.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const u={};for(const g in s){const x=s[g],w=this.context.extTimerQuery,T=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),u[g]=T}return u}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.gl;let g=0;for(const x of s)g+=u.getQueryParameter(x,u.QUERY_RESULT)/1e6,u.deleteQuery(x);return g}translatePosMatrix(s,u,g,x,w){if(!g[0]&&!g[1])return s;const T=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(T){const N=Math.sin(T),F=Math.cos(T);g=[g[0]*F-g[1]*N,g[0]*N+g[1]*F]}const I=[w?g[0]:o.aw(u,g[0],this.transform.zoom),w?g[1]:o.aw(u,g[1],this.transform.zoom),0],k=new Float32Array(16);return o.bo(k,s,I),k}saveTileTexture(s){if(s.context!==this.context)return;const u=s.size[0],g=this._tileTextures[u];g?g.push(s):this._tileTextures[u]=[s]}getTileTexture(s){const u=this._tileTextures[s];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,u,g){const x=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,w=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||x||u!==void 0&&!u||w.push("FOG","FOG_DITHERING"),x&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(s,u){this.cache=this.cache||{};const g=u&&u.defines||[],x=u&&u.config,w=this.currentGlobalDefines(s,u&&u.overrideFog,u&&u.overrideRtt).concat(g),T=fg.cacheKey(ep[s],s,w,x);return this.cache[T]||(this.cache[T]=new fg(this.context,s,ep[s],x,G1[s],w)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,u){if(this.style.enable3dLights()){const g=this.style.directionalLight,x=this.style.ambientLight;if(g&&x){const w=((T,I,k)=>{const N=T.properties.get("direction"),F=T.properties.get("color-use-theme")==="none",q=T.properties.get("color").toNonPremultipliedRenderColor(F?null:k.getLut(T.scope)).toArray01(),V=T.properties.get("intensity"),X=I.properties.get("color-use-theme")==="none",re=I.properties.get("color").toNonPremultipliedRenderColor(X?null:k.getLut(I.scope)).toArray01(),Q=I.properties.get("intensity"),oe=[N.x,N.y,N.z],ie=o.dI(re,Q),ue=o.dI(q,V);return{u_lighting_ambient_color:ie,u_lighting_directional_dir:oe,u_lighting_directional_color:ue,u_ground_radiance:Xv(oe,ue,ie)}})(g,x,this.style);u.setLightsUniformValues(s,w)}}}uploadCommonUniforms(s,u,g,x,w){if(this.uploadCommonLightUniforms(s,u),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const I=T.getOpacity(this.transform.pitch),k=((N,F,q,V,X,re,Q,oe,ie,ue,pe,ge)=>{const be=N.transform,Ae=F.properties.get("color-use-theme")==="none",Ie=F.properties.get("color").toNonPremultipliedRenderColor(Ae?null:N.style.getLut(F.scope)).toArray01();Ie[3]=V;const we=N.frameCounter/1e3%1,[Se,Te]=F.properties.get("vertical-range");return{u_fog_matrix:q?be.calculateFogTileMatrix(q):ge||N.identityMat,u_fog_range:F.getFovAdjustedRange(be._fov),u_fog_color:Ie,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Se,Te),Te],u_fog_temporal_offset:we,u_frustum_tl:X,u_frustum_tr:re,u_frustum_br:Q,u_frustum_bl:oe,u_globe_pos:ie,u_globe_radius:ue,u_viewport:pe,u_globe_transition:o.ah(be.zoom),u_is_globe:+(be.projection.name==="globe")}})(this,T,g,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],x);u.setFogUniformValues(s,k)}w&&u.setCutoffUniformValues(s,w.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,u=s.createTexture();return s.bindTexture(s.TEXTURE_2D,u),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const x of g)u[x.key]=s[x.key]||new Ru(x,512,this.transform.tileZoom,this,void 0,this.worldview);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,u){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||s.type!=="clip"&&s.type!=="building"&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||s.sourceLayer!=="building"&&s.sourceLayer!=="procedural_buildings")&&(!u||u.type!=="batched-model")))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[s.key];return u||(this._cachedTileFogOpacities[s.key]=u=this.style.fog.getOpacityForTile(s)),u[0]>=gt||u[1]>=gt}setupDepthForOcclusion(s,u,g){const x=this.context,w=x.gl,T=!!g;var I;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(w.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE0),T||u.setTerrainUniformValues(x,g)}}function dd(m,s){let u=!1,g=null;const x=()=>{g=null,u&&(m(),g=setTimeout(x,s),u=!1)};return()=>(u=!0,g||x(),g)}class Og{constructor(s){this._hashName=s&&encodeURIComponent(s),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=dd(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const u=kg(s);if(this._hashName){const g=this._hashName;let x=!1;const w=location.hash.slice(1).split("&").map(T=>{const I=T.split("=")[0];return I===g?(x=!0,`${I}=${u}`):T}).filter(T=>T);return x||w.push(`${g}=${u}`),`#${w.join("&")}`}return`#${u}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(Number(g)))){const g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(u[3]||0):s.getBearing();return s.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function kg(m,s){const u=m.getCenter(),g=Math.round(100*m.getZoom())/100,x=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),T=Math.round(u.lng*w)/w,I=Math.round(u.lat*w)/w,k=m.getBearing(),N=m.getPitch();let F=s?`/${T}/${I}/${g}`:`${g}/${I}/${T}`;return(k||N)&&(F+="/"+Math.round(10*k)/10),N&&(F+=`/${Math.round(N)}`),F}const fd={linearity:.3,easing:o.eI(0,0,.3,1)},Jc=o.h({deceleration:2500,maxSpeed:1400},fd),b0=o.h({deceleration:20,maxSpeed:1400},fd),xl=o.h({deceleration:1e3,maxSpeed:360},fd),w0=o.h({deceleration:1e3,maxSpeed:90},fd);class Rg{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,u=o.q.now();for(;s.length>0&&u-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)u.zoom+=w.zoomDelta||0,u.bearing+=w.bearingDelta||0,u.pitch+=w.pitchDelta||0,w.panDelta&&u.pan._add(w.panDelta),w.around&&(u.around=w.around),w.pinchAround&&(u.pinchAround=w.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(u.pan.mag()){const w=md(u.pan.mag(),g,o.h({},Jc,s||{}));x.offset=u.pan.mult(w.amount/u.pan.mag()),x.center=this._map.transform.center,pd(x,w)}if(u.zoom){const w=md(u.zoom,g,b0);x.zoom=this._map.transform.zoom+w.amount,pd(x,w)}if(u.bearing){const w=md(u.bearing,g,xl);x.bearing=this._map.transform.bearing+o.ay(w.amount,-179,179),pd(x,w)}if(u.pitch){const w=md(u.pitch,g,w0);x.pitch=this._map.transform.pitch+w.amount,pd(x,w)}if(x.zoom||x.bearing){const w=u.pinchAround===void 0?u.around:u.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function pd(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function md(m,s,u){const{maxSpeed:g,linearity:x,deceleration:w}=u,T=o.ay(m*x/(s/1e3),-g,g),I=Math.abs(T)/(w*x);return{easing:u.easing,duration:1e3*I,amount:T*(I/2)}}class ii extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,g,x={}){const w=fe(u.getCanvasContainer(),g),T=u.unproject(w);super(s,o.h({point:w,lngLat:T,originalEvent:g},x)),this._defaultPrevented=!1,this.target=u}}class gd extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,g){const x=s==="touchend"?g.changedTouches:g.touches,w=Ce(u.getCanvasContainer(),x),T=w.map(k=>u.unproject(k)),I=w.reduce((k,N,F,q)=>k.add(N.div(q.length)),new o.P(0,0));super(s,{points:w,point:I,lngLats:T,lngLat:u.unproject(I),originalEvent:g}),this._defaultPrevented=!1}}class S0 extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class T0{constructor(s,u){this._map=s,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new S0(this._map,s))}mousedown(s,u){return this._mousedownPos=u,this._firePreventable(new ii(s.type,this._map,s))}mouseup(s){this._map.fire(new ii(s.type,this._map,s))}preclick(s){const u=o.h({},s);u.type="preclick",this._map.fire(new ii(u.type,this._map,u))}click(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(s),this._map.fire(new ii(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new ii(s.type,this._map,s))}mouseover(s){this._map.fire(new ii(s.type,this._map,s))}mouseout(s){this._map.fire(new ii(s.type,this._map,s))}touchstart(s){return this._firePreventable(new gd(s.type,this._map,s))}touchmove(s){this._map.fire(new gd(s.type,this._map,s))}touchend(s){this._map.fire(new gd(s.type,this._map,s))}touchcancel(s){this._map.fire(new gd(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ku{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new ii(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ii("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new ii(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class E0{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,u){this.isEnabled()&&s.shiftKey&&s.button===0&&(ne(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(s,u){if(!this._active)return;const g=u,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(g)||!this._box&&g.dist(x)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const T=Math.min(x.x,g.x),I=Math.max(x.x,g.x),k=Math.min(x.y,g.y),N=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${k}px)`,this._box.style.width=I-T+"px",this._box.style.height=N-k+"px")})}mouseupWindow(s,u){if(!this._active)return;const g=this._startPos,x=u;if(g&&s.button===0){if(this.reset(),le(),g.x!==x.x||g.y!==x.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:s})),{cameraAnimation:w=>w.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Y(),delete this._startPos,delete this._lastPos}_fireEvent(s,u){return this._map.fire(new o.A(s,{originalEvent:u}))}}function fp(m,s){const u={};for(let g=0;g<m.length;g++)u[m[g].identifier]=s[g];return u}class A0{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const w=new o.P(0,0);for(const T of x)w._add(T);return w.div(x.length)}(u),this.touches=fp(g,u)))}touchmove(s,u,g){if(this.aborted||!this.centroid)return;const x=fp(g,u);for(const w in this.touches){const T=x[w];(!T||T.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(s,u,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Qc{constructor(s){this.singleTap=new A0(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,u,g){this.singleTap.touchstart(s,u,g)}touchmove(s,u,g){this.singleTap.touchmove(s,u,g)}touchend(s,u,g){const x=this.singleTap.touchend(s,u,g);if(x){const w=s.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(w&&T||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class P0{constructor(){this._zoomIn=new Qc({numTouches:1,numTaps:2}),this._zoomOut=new Qc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,u,g){this._zoomIn.touchstart(s,u,g),this._zoomOut.touchstart(s,u,g)}touchmove(s,u,g){this._zoomIn.touchmove(s,u,g),this._zoomOut.touchmove(s,u,g)}touchend(s,u,g){const x=this._zoomIn.touchend(s,u,g),w=this._zoomOut.touchend(s,u,g);return x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:s})}):w?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(w)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const C0={0:1,2:2},Dg={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class yd{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,u){return!1}_move(s,u){return{}}mousedown(s,u){if(this._lastPoint)return;const g=Oe(s);this._correctButton(s,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(s,u){const g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(x,w){const T=C0[w];return x.buttons===void 0||(x.buttons&T)!==T}(s,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}}mouseupWindow(s){this._lastPoint&&Oe(s)===this._eventButton&&(this._moved&&le(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class I0 extends yd{mousedown(s,u){super.mousedown(s,u),this._lastPoint&&(this._active=!0)}_correctButton(s,u){return u===0&&!s.ctrlKey}_move(s,u){return{around:u,panDelta:u.sub(s)}}}class Lg extends yd{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Dg[s.pitchRotateKey]:void 0}_correctButton(s,u){return this._pitchRotateKey?u===0&&s[this._pitchRotateKey]:u===0&&s.ctrlKey||u===2}_move(s,u){const g=.8*(u.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class M0 extends yd{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Dg[s.pitchRotateKey]:void 0}_correctButton(s,u){return this._pitchRotateKey?u===0&&s[this._pitchRotateKey]:u===0&&s.ctrlKey||u===2}_move(s,u){const g=-.5*(u.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class tS{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(s,u,g){return this._calculateTransform(s,u,g)}touchmove(s,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!o.eJ())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,u,g)}}touchend(s,u,g){this._calculateTransform(s,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,u,g){g.length>0&&(this._active=!0);const x=fp(g,u),w=new o.P(0,0),T=new o.P(0,0);let I=0;for(const N in x){const F=x[N],q=this._touches[N];q&&(w._add(F),T._add(F.sub(q)),I++,x[N]=F)}if(this._touches=x,I<this._minTouches||!T.mag())return;const k=T.div(I);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(I),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class jg{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,u,g){return{}}touchstart(s,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(s,u,g){const x=this._firstTwoTouches;if(!x)return;s.preventDefault();const[w,T]=x,I=pp(g,u,w),k=pp(g,u,T);if(!I||!k)return;const N=this._aroundCenter?null:I.add(k).div(2);return this._move([I,k],N,s)}touchend(s,u,g){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,T=pp(g,u,x),I=pp(g,u,w);T&&I||(this._active&&le(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function pp(m,s,u){for(let g=0;g<m.length;g++)if(m[g].identifier===u)return s[g]}function O0(m,s){return Math.log(m/s)/Math.LN2}class rS extends jg{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,u){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(O0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:O0(this._distance,g),pinchAround:u}}}function k0(m,s){return 180*m.angleWith(s)/Math.PI}class nS extends jg{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,u){const g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:k0(this._vector,g),pinchAround:u}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const u=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const x=k0(s,g);return Math.abs(x)<u}}function Ng(m){return Math.abs(m.y)>Math.abs(m.x)}class iS extends jg{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Ng(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,u,g){const x=this._lastPoints;if(!x)return;const w=s[0].sub(x[0]),T=s[1].sub(x[1]);return this._map._cooperativeGestures&&!o.eJ()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(w,T,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(w.y+T.y)/2*-.5})}gestureBeginsVertically(s,u,g){if(this._valid!==void 0)return this._valid;const x=s.mag()>=2,w=u.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const T=s.y>0==u.y>0;return Ng(s)&&Ng(u)&&T}}const oS={panStep:100,bearingStep:15,pitchStep:10};class sS{constructor(){const s=oS;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let u=0,g=0,x=0,w=0,T=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),w=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),w=1);break;case 38:s.shiftKey?x=1:(s.preventDefault(),T=-1);break;case 40:s.shiftKey?x=-1:(s.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:I=>{const k=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:aS,zoom:u?Math.round(k)+u*(s.shiftKey?2:1):k,bearing:I.getBearing()+g*this._bearingStep,pitch:I.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-T*this._panStep],center:I.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function aS(m){return m*(2-m)}const lS=4.000244140625,NC=1/450;class zC{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=NC,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||o.eJ()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=o.q.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,u!==0&&u%lS==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=u,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(x*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=fe(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>lS?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&F!==0&&(F=1/F);const q=u(),V=Math.pow(2,q),X=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(X*F))),this._type==="wheel"&&(this._startZoom=q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:u(),x=this._startZoom,w=this._easing;let T,I=!1;if(this._type==="wheel"&&x&&w){const N=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),F=w(N);T=o.ai(x,g,F),N<1?this._frameId||(this._frameId=!0):I=!0}else T=g,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=T-u();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let u=o.eK;if(this._prevEase){const g=this._prevEase,x=(o.q.now()-g.start)/g.duration,w=g.easing(x+.01)-g.easing(x),T=.27/Math.sqrt(w*w+1e-4)*.01,I=Math.sqrt(.0729-T*T);u=o.eI(T,I,.25,1)}return this._prevEase={start:o.q.now(),duration:s,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ci{constructor(s,u){this._clickZoom=s,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cS{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,u){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class FC{constructor(){this._tap=new Qc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,u,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,u,g))}touchmove(s,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=u[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,s.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(s,u,g)}touchend(s,u,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,u,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class R0{constructor(s,u,g){this._el=s,this._mousePan=u,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class BC{constructor(s,u,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mp{constructor(s,u,g,x){this._el=s,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gp=m=>m.zoom||m.drag||m.pitch||m.rotate;class D0 extends o.A{}class zg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,u){const g=o.at([],u,s);this.radius=o.ae(g[2]<0?o.eM([],g,this.constants):[g[0],g[1],0])}projectRay(s){o.eM(s,s,this.constants),o.au(s,s),o.eN(s,s,this.constants);const u=o.c1([],s,this.radius);if(u[2]>0){const g=o.c1([],[0,0,1],o.bG(u,[0,0,1])),x=o.c1([],o.au([],[u[0],u[1],0]),this.radius),w=o.d5([],u,o.c1([],o.at([],o.d5([],x,g),u),2));u[0]=w[0],u[1]=w[1]}return u}}function ka(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Fg{constructor(s,u){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rg(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new zg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),o.aV(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,w,T]of this._listeners){const I=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,I,T)}}destroy(){for(const[s,u,g]of this._listeners){const x=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(u,x,g)}}_addDefaultHandlers(s){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new T0(u,s));const x=u.boxZoom=new E0(u,s);this._add("boxZoom",x);const w=new P0,T=new cS;u.doubleClickZoom=new ci(T,w),this._add("tapZoom",w),this._add("clickZoom",T);const I=new FC;this._add("tapDragZoom",I);const k=u.touchPitch=new iS(u);this._add("touchPitch",k);const N=new Lg(s),F=new M0(s);u.dragRotate=new BC(s,N,F),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const q=new I0(s),V=new tS(u,s);u.dragPan=new R0(g,q,V),this._add("mousePan",q),this._add("touchPan",V,["touchZoom","touchRotate"]);const X=new nS,re=new rS;u.touchZoomRotate=new mp(g,re,X,I),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ku(u));const Q=u.scrollZoom=new zC(u,this);this._add("scrollZoom",Q,["mousePan"]);const oe=u.keyboard=new sS;this._add("keyboard",oe);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ie]&&u[ie].enable(s[ie])}_add(s,u,g){this._handlers.push({handlerName:s,handler:u,allowed:g}),this._handlersById[s]=u}stop(s){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,u,g){for(const x in s)if(x!==g&&(!u||u.indexOf(x)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const u=[];for(const g of s)this._el.contains(g.target)&&u.push(g);return u}handleEvent(s,u){this._updatingCamera=!0;const g=s.type==="renderFrame",x=g?void 0:s,w={needsRenderFrame:!1},T={},I={},k=s.touches?this._getMapTouches(s.touches):void 0,N=k?Ce(this._el,k):g?void 0:fe(this._el,s);for(const{handlerName:V,handler:X,allowed:re}of this._handlers){if(!X.isEnabled())continue;let Q;this._blockedByActive(I,re,V)?X.reset():X[u||s.type]&&(Q=X[u||s.type](s,N,k),this.mergeHandlerResult(w,T,Q,V,x),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||X.isActive())&&(I[V]=X)}const F={};for(const V in this._previousActiveHandlers)I[V]||(F[V]=x);this._previousActiveHandlers=I,(Object.keys(F).length||ka(w))&&(this._changes.push([w,T,F]),this._triggerRenderFrame()),(Object.keys(I).length||ka(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=w;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(s,u,g,x,w){if(!g)return;o.h(s,g);const T={handlerName:x,originalEvent:g.originalEvent||w};g.zoomDelta!==void 0&&(u.zoom=T),g.panDelta!==void 0&&(u.drag=T),g.pitchDelta!==void 0&&(u.pitch=T),g.bearingDelta!==void 0&&(u.rotate=T)}_applyChanges(){const s={},u={},g={};for(const[x,w,T]of this._changes)x.panDelta&&(s.panDelta=(s.panDelta||new o.P(0,0))._add(x.panDelta)),x.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(s.around=x.around),x.aroundCoord!==void 0&&(s.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(s.pinchAround=x.pinchAround),x.noInertia&&(s.noInertia=x.noInertia),o.h(u,w),o.h(g,T);this._updateMapTransform(s,u,g),this._changes=[]}_updateMapTransform(s,u,g){const x=this._map,w=x.transform,T=ue=>[ue.x,ue.y,ue.z];if((ue=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!ka(s)){const ue=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),ue!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!ka(s))return void this._fireEvents(u,g,!0);let{panDelta:I,zoomDelta:k,bearingDelta:N,pitchDelta:F,around:q,aroundCoord:V,pinchAround:X}=s;w._isCameraConstrained&&(k>0&&(k=0),w._isCameraConstrained=!1),X!==void 0&&(q=X),(k||(ue=>u[ue]&&!this._eventsInProgress[ue])("drag"))&&q&&(this._dragOrigin=T(w.pointCoordinate3D(q)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),q=q||x.transform.centerPoint,N&&(w.bearing+=N),F&&(w.pitch+=F),w._updateCameraState();const re=[0,0,0];if(I)if(w.projection.name==="mercator"){const ue=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(q).dir),pe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(q.sub(I)).dir);re[0]=pe[0]-ue[0],re[1]=pe[1]-ue[1]}else{const ue=w.pointCoordinate(q);if(w.projection.name==="globe"){I=I.rotate(-w.angle);const pe=w._pixelsPerMercatorPixel/w.worldSize;re[0]=-I.x*o.eL(o.aY(ue.y))*pe,re[1]=-I.y*o.eL(w.center.lat)*pe}else{const pe=w.pointCoordinate(q.sub(I));ue&&pe&&(re[0]=pe.x-ue.x,re[1]=pe.y-ue.y)}}const Q=w.zoom,oe=[0,0,0];if(k){const ue=T(V||w.pointCoordinate3D(q)),pe={dir:o.au([],o.at([],ue,w._camera.position))};if(pe.dir[2]<0){const ge=w.zoomDeltaToMovement(ue,k);o.c1(oe,pe.dir,ge)}}const ie=o.d5(re,re,oe);w._translateCameraConstrained(ie),k&&Math.abs(w.zoom-Q)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,g,!0)}_fireEvents(s,u,g){const x=gp(this._eventsInProgress),w=gp(s),T={};for(const F in s){const{originalEvent:q}=s[F];this._eventsInProgress[F]||(T[`${F}start`]=q),this._eventsInProgress[F]=s[F]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const F in T)this._fireEvent(F,T[F]);w&&this._fireEvent("move",w.originalEvent);for(const F in s){const{originalEvent:q}=s[F];this._fireEvent(F,q)}const I={};let k;for(const F in this._eventsInProgress){const{handlerName:q,originalEvent:V}=this._eventsInProgress[F];this._handlersById[q].isActive()||(delete this._eventsInProgress[F],k=u[q]||V,I[`${F}end`]=k)}for(const F in I)this._fireEvent(F,I[F]);const N=gp(this._eventsInProgress);if(g&&(x||w)&&!N){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;F?(q(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:k})):(this._map.fire(new o.A("moveend",{originalEvent:k})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,u){this._map.fire(new o.A(s,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new D0("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ri="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class bl extends o.E{constructor(s,u){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(s,u){return this.jumpTo({center:s},u)}panBy(s,u,g){return s=o.P.convert(s).mult(-1),this.panTo(this.transform.center,o.h({offset:s},u),g)}panTo(s,u,g){return this.easeTo(o.h({center:s},u),g)}getZoom(){return this.transform.zoom}setZoom(s,u){return this.jumpTo({zoom:s},u),this}zoomTo(s,u,g){return this.easeTo(o.h({zoom:s},u),g)}zoomIn(s,u){return this.zoomTo(this.getZoom()+1,s,u),this}zoomOut(s,u){return this.zoomTo(this.getZoom()-1,s,u),this}getBearing(){return this.transform.bearing}setBearing(s,u){return this.jumpTo({bearing:s},u),this}getPadding(){return this.transform.padding}setPadding(s,u){return this.jumpTo({padding:s},u),this}rotateTo(s,u,g){return this.easeTo(o.h({bearing:s},u),g)}resetNorth(s,u){return this.rotateTo(0,o.h({duration:1e3},s),u),this}resetNorthPitch(s,u){return this.easeTo(o.h({bearing:0,pitch:0,duration:1e3},s),u),this}snapToNorth(s,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,u):this}getPitch(){return this.transform.pitch}setPitch(s,u){return this.jumpTo({pitch:s},u),this}cameraForBounds(s,u){s=o.aG.convert(s);const g=u&&u.bearing||0,x=u&&u.pitch||0,w=s.getNorthWest(),T=s.getSouthEast();return this._cameraForBounds(this.transform,w,T,g,x,u)}_extendPadding(s){const u={top:0,right:0,bottom:0,left:0};return s==null?o.h({},u,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:o.h({},u,s)}_extendCameraOptions(s){return(s=o.h({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,u){const g=u.max[0]-u.min[0],x=u.max[1]-u.min[1];return g/x>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):x/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,u,g,x,w,T){const I=s.clone(),k=this._extendCameraOptions(T);I.bearing=x,I.pitch=w;const N=o.ci.convert(u),F=o.ci.convert(g),q=.5*(N.lat+F.lat),V=.5*(N.lng+F.lng),X=o.eO(q,V),re=o.au([],X),Q=o.au([],o.bF([],re,[0,1,0])),oe=o.bF([],Q,re),ie=[Q[0],Q[1],Q[2],0,oe[0],oe[1],oe[2],0,re[0],re[1],re[2],0,0,0,0,1],ue=[X,o.eO(N.lat,N.lng),o.eO(F.lat,N.lng),o.eO(F.lat,F.lng),o.eO(N.lat,F.lng),o.eO(q,N.lng),o.eO(q,F.lng),o.eO(N.lat,V),o.eO(F.lat,V)];let pe=o.d6.fromPoints(ue.map(Xe=>[o.bG(Q,Xe),o.bG(oe,Xe),o.bG(re,Xe)]));const ge=o.ad([],pe.center,ie);o.eP(ge)===0&&o.eQ(ge,0,0,1),o.au(ge,ge),o.c1(ge,ge,o.aB),I.center=o.eR(ge);const be=I.getWorldToCameraMatrix(),Ae=o.bi(new Float64Array(16),be);pe=o.d6.applyTransform(pe,o.az([],be,ie));const Ie=this._extendAABB(pe,I,k,x);if(!Ie)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=Ie,o.ad(ge,ge,be);const we=.5*(pe.max[2]-pe.min[2]),Se=this._minimumAABBFrustumDistance(I,pe),Te=o.c1([],[0,0,1],we),We=o.d5(Te,ge,Te),je=Se+(I.pitch===0?0:o.bD(ge,We)),ht=I.globeCenterInViewSpace,tt=o.at([],ge,[ht[0],ht[1],ht[2]]);o.au(tt,tt),o.c1(tt,tt,je);const ft=o.d5([],ge,tt);o.ad(ft,ft,Ae);const Pt=o.eB/o.aB,qe=o.ae(ft),De=o.cb(Math.max(qe*Pt-o.eB,Number.EPSILON),0),st=Math.min(I.zoomFromMercatorZAdjusted(De),k.maxZoom);return st>.5*(o.cX+o.cI)?(I.setProjection({name:"mercator"}),I.zoom=st,this._cameraForBounds(I,u,g,x,w,T)):{center:I.center,zoom:st,bearing:x,pitch:w}}_extendAABB(s,u,g,x){const w=.5*((g.padding.left||0)+(g.padding.right||0)),T=.5*((g.padding.top||0)+(g.padding.bottom||0)),I=T,k=w,N=w,F=T,q=u.width-(k+N),V=u.height-(I+F),X=o.at([],s.max,s.min),re=Math.min(q/X[0],V/X[1]),Q=Math.min(u.scaleZoom(u.scale*re),g.maxZoom);if(isNaN(Q))return null;const oe=u.scale/u.zoomScale(Q),ie=new o.d6([s.min[0]-k*oe,s.min[1]-F*oe,s.min[2]],[s.max[0]+N*oe,s.max[1]+I*oe,s.max[2]]),ue=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new o.P(g.offset.x,g.offset.y):o.P.convert(g.offset)).rotate(-o.al(x));return ie.center[0]-=ue.x*oe,ie.center[1]+=ue.y*oe,ie}queryTerrainElevation(s,u){const g=this.transform.elevation;return g?(u=o.h({},{exaggerated:!0},u),g.getAtPoint(o.ac.fromLngLat(s),null,u.exaggerated)):null}_cameraForBounds(s,u,g,x,w,T){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,u,g,x,w,T);const I=s.clone(),k=this._extendCameraOptions(T);I.bearing=x,I.pitch=w;const N=o.ci.convert(u),F=o.ci.convert(g),q=new o.ci(N.lng,F.lat),V=new o.ci(F.lng,N.lat),X=I.project(N),re=I.project(F),Q=this.queryTerrainElevation(N),oe=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(q),ue=this.queryTerrainElevation(V),pe=[[X.x,X.y,Math.min(Q||0,oe||0,ie||0,ue||0)],[re.x,re.y,Math.max(Q||0,oe||0,ie||0,ue||0)]];let ge=o.d6.fromPoints(pe);const be=I.getWorldToCameraMatrix(),Ae=o.bi(new Float64Array(16),be);ge=o.d6.applyTransform(ge,be);const Ie=this._extendAABB(ge,I,k,x);if(!Ie)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ge=Ie;const we=.5*o.at([],ge.max,ge.min)[2],Se=this._minimumAABBFrustumDistance(I,ge),Te=[0,0,1,0];o.aA(Te,Te,be),o.eS(Te,Te);const We=o.c1([],Te,Se+we),je=o.d5([],ge.center,We);o.ad(ge.center,ge.center,Ae),o.ad(je,je,Ae);const ht=I.unproject(new o.P(ge.center[0],ge.center[1])),tt=o.eT(I.projection,ht),ft=Math.pow(2,tt),Pt=Math.min(I._zoomFromMercatorZ(je[2]*I.pixelsPerMeter*ft/I.worldSize),k.maxZoom);return I.mercatorFromTransition&&Pt<.5*(o.cX+o.cI)?(I.setProjection({name:"globe"}),I.zoom=Pt,this._cameraForBounds(I,u,g,x,w,T)):{center:ht,zoom:Pt,bearing:x,pitch:w}}fitBounds(s,u,g){const x=this.cameraForBounds(s,u);return this._fitInternal(x,u,g)}fitScreenCoordinates(s,u,g,x,w){const T=o.P.convert(s),I=o.P.convert(u),k=new o.P(Math.min(T.x,I.x),Math.min(T.y,I.y)),N=new o.P(Math.max(T.x,I.x),Math.max(T.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,I))return this;const F=this.transform.pointLocation3D(k),q=this.transform.pointLocation3D(N),V=this.transform.pointLocation3D(new o.P(k.x,N.y)),X=this.transform.pointLocation3D(new o.P(N.x,k.y)),re=[Math.min(F.lng,q.lng,V.lng,X.lng),Math.min(F.lat,q.lat,V.lat,X.lat)],Q=[Math.max(F.lng,q.lng,V.lng,X.lng),Math.max(F.lat,q.lat,V.lat,X.lat)],oe=x&&x.pitch?x.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,re,Q,g,oe,x);return this._fitInternal(ie,x,w)}_fitInternal(s,u,g){return s?(u=o.h(s,u)).linear?this.easeTo(u,g):this.flyTo(u,g):this}jumpTo(s,u){this.stop();const g=s.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,T=!1;"zoom"in s&&g.zoom!==+s.zoom&&(x=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=o.ci.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(w=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(T=!0,g.pitch=+s.pitch);const I=typeof s.padding=="number"?this._extendPadding(s.padding):s.padding;if(s.padding!=null&&!g.isPaddingEqual(I))if(s.retainPadding===!1){const k=g.clone();k.padding=I,g.setLocationAtPoint(g.center,k.centerPoint)}else g.padding=I;return s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new o.A("movestart",u)).fire(new o.A("move",u)),x&&this.fire(new o.A("zoomstart",u)).fire(new o.A("zoom",u)).fire(new o.A("zoomend",u)),w&&this.fire(new o.A("rotatestart",u)).fire(new o.A("rotate",u)).fire(new o.A("rotateend",u)),T&&this.fire(new o.A("pitchstart",u)).fire(new o.A("pitch",u)).fire(new o.A("pitchend",u)),this.fire(new o.A("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Ri),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return o.w(Ri),this;this.stop();const x=g.zoom,w=g.pitch,T=g.bearing;g.setFreeCameraOptions(s);const I=x!==g.zoom,k=w!==g.pitch,N=T!==g.bearing;return this.fire(new o.A("movestart",u)).fire(new o.A("move",u)),I&&this.fire(new o.A("zoomstart",u)).fire(new o.A("zoom",u)).fire(new o.A("zoomend",u)),N&&this.fire(new o.A("rotatestart",u)).fire(new o.A("rotate",u)).fire(new o.A("rotateend",u)),k&&this.fire(new o.A("pitchstart",u)).fire(new o.A("pitch",u)).fire(new o.A("pitchend",u)),this.fire(new o.A("moveend",u)),this}easeTo(s,u){this._stop(!1,s.easeId),((s=o.h({offset:[0,0],duration:500,easing:o.eK},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const g=this.transform,x=this.getZoom(),w=this.getBearing(),T=this.getPitch(),I=this.getPadding(),k="zoom"in s?+s.zoom:x,N="bearing"in s?this._normalizeBearing(s.bearing,w):w,F="pitch"in s?+s.pitch:T,q=this._extendPadding(s.padding),V=o.P.convert(s.offset);let X,re,Q;if(g.projection.name==="globe"){const Te=o.ac.fromLngLat(g.center),We=V.rotate(-g.angle);Te.x+=We.x/g.worldSize,Te.y+=We.y/g.worldSize;const je=Te.toLngLat(),ht=o.ci.convert(s.center||je);this._normalizeCenter(ht),X=g.centerPoint.add(We),re=new o.P(Te.x,Te.y).mult(g.worldSize),Q=new o.P(o.aD(ht.lng),o.aH(ht.lat)).mult(g.worldSize).sub(re)}else{X=g.centerPoint.add(V);const Te=g.pointLocation(X),We=o.ci.convert(s.center||Te);this._normalizeCenter(We),re=g.project(Te),Q=g.project(We).sub(re)}const oe=g.zoomScale(k-x);let ie,ue;s.around&&(ie=o.ci.convert(s.around),ue=g.locationPoint(ie));const pe=this._zooming||k!==x,ge=this._rotating||w!==N,be=this._pitching||F!==T,Ae=!g.isPaddingEqual(q),Ie=s.retainPadding===!1?g.clone():g,we=Te=>We=>{if(pe&&(Te.zoom=o.ai(x,k,We)),ge&&(Te.bearing=o.ai(w,N,We)),be&&(Te.pitch=o.ai(T,F,We)),Ae&&(Ie.interpolatePadding(I,q,We),X=Ie.centerPoint.add(V)),ie)Te.setLocationAtPoint(ie,ue);else{const je=Te.zoomScale(Te.zoom-x),ht=k>x?Math.min(2,oe):Math.max(.5,oe),tt=Math.pow(ht,1-We),ft=Te.unproject(re.add(Q.mult(We*tt)).mult(je));Te.setLocationAtPoint(Te.renderWorldCopies?ft.wrap():ft,X)}return s.preloadOnly||this._fireMoveEvents(u),Te};if(s.preloadOnly){const Te=this._emulate(we,s.duration,g);return this._preloadTiles(Te),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=ge,this._pitching=be,this._padding=Ae,this._easeId=s.easeId,this._prepareEase(u,s.noMoveStart,Se),this._ease(we(g),Te=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(u,Te)},s),this}_prepareEase(s,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||g.moving||this.fire(new o.A("movestart",s)),this._zooming&&!g.zooming&&this.fire(new o.A("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new o.A("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new o.A("pitchstart",s))}_fireMoveEvents(s){this.fire(new o.A("move",s)),this._zooming&&this.fire(new o.A("zoom",s)),this._rotating&&this.fire(new o.A("rotate",s)),this._pitching&&this.fire(new o.A("pitch",s))}_afterEase(s,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new o.A("zoomend",s)),x&&this.fire(new o.A("rotateend",s)),w&&this.fire(new o.A("pitchend",s)),this.fire(new o.A("moveend",s))}flyTo(s,u){if(this._prefersReducedMotion(s)){const Xe=o.aF(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Xe,u)}this.stop(),s=o.h({offset:[0,0],speed:1.2,curve:1.42,easing:o.eK},s);const g=this.transform,x=this.getZoom(),w=this.getBearing(),T=this.getPitch(),I=this.getPadding(),k="zoom"in s?o.ay(+s.zoom,g.minZoom,g.maxZoom):x,N="bearing"in s?this._normalizeBearing(s.bearing,w):w,F="pitch"in s?+s.pitch:T,q=this._extendPadding(s.padding),V=g.zoomScale(k-x),X=o.P.convert(s.offset);let re=g.centerPoint.add(X);const Q=g.pointLocation(re),oe=o.ci.convert(s.center||Q);this._normalizeCenter(oe);const ie=g.project(Q),ue=g.project(oe).sub(ie);let pe=s.curve;const ge=Math.max(g.width,g.height),be=ge/V,Ae=ue.mag();if("minZoom"in s){const Xe=o.ay(Math.min(s.minZoom,x,k),g.minZoom,g.maxZoom),yt=ge/g.zoomScale(Xe-x);pe=Math.sqrt(yt/Ae*2)}const Ie=pe*pe;function we(Xe){const yt=(be*be-ge*ge+(Xe?-1:1)*Ie*Ie*Ae*Ae)/(2*(Xe?be:ge)*Ie*Ae);return Math.log(Math.sqrt(yt*yt+1)-yt)}function Se(Xe){return(Math.exp(Xe)-Math.exp(-Xe))/2}function Te(Xe){return(Math.exp(Xe)+Math.exp(-Xe))/2}const We=we(0);let je=function(Xe){return Te(We)/Te(We+pe*Xe)},ht=function(Xe){return ge*((Te(We)*(Se(yt=We+pe*Xe)/Te(yt))-Se(We))/Ie)/Ae;var yt},tt=(we(1)-We)/pe;if(Math.abs(Ae)<1e-6||!isFinite(tt)){if(Math.abs(ge-be)<1e-6)return this.easeTo(s,u);const Xe=be<ge?-1:1;tt=Math.abs(Math.log(be/ge))/pe,ht=function(){return 0},je=function(yt){return Math.exp(Xe*pe*yt)}}s.duration="duration"in s?+s.duration:1e3*tt/("screenSpeed"in s?+s.screenSpeed/pe:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const ft=w!==N,Pt=F!==T,qe=!g.isPaddingEqual(q),De=s.retainPadding===!1?g.clone():g,st=Xe=>yt=>{const vt=yt*tt,bt=1/je(vt);Xe.zoom=yt===1?k:x+Xe.scaleZoom(bt),ft&&(Xe.bearing=o.ai(w,N,yt)),Pt&&(Xe.pitch=o.ai(T,F,yt)),qe&&(De.interpolatePadding(I,q,yt),re=De.centerPoint.add(X));const Dt=yt===1?oe:Xe.unproject(ie.add(ue.mult(ht(vt))).mult(bt));return Xe.setLocationAtPoint(Xe.renderWorldCopies?Dt.wrap():Dt,re),Xe._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(u),Xe};if(s.preloadOnly){const Xe=this._emulate(st,s.duration,g);return this._preloadTiles(Xe),this}return this._zooming=!0,this._rotating=ft,this._pitching=Pt,this._padding=qe,this._prepareEase(u,!1),this._ease(st(g),()=>this._afterEase(u),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!s){const g=this.handlers;g&&g.stop(!1)}return this}_ease(s,u,g){g.animate===!1||g.duration===0?(s(1),u()):(this._easeStart=o.q.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,u){s=o.bQ(s,-180,180);const g=Math.abs(s-u);return Math.abs(s-360-u)<g&&(s-=360),Math.abs(s+360-u)<g&&(s+=360),s}_normalizeCenter(s){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const g=s.lng-u.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,u,g){const x=Math.ceil(15*u/1e3),w=[],T=s(g.clone());for(let I=0;I<=x;I++){const k=T(I/x);w.push(k.clone())}return w}_preloadTiles(s,u){}}class _d{constructor(s={}){this.options=s,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const u=this.options&&this.options.compact,g=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=z("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const x=z("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",g),this._innerContainer=z("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(s){const g=u.reduce((x,w,T)=>(w.value&&(x+=`${w.key}=${w.value}${T<u.length-1?"&":""}`),x),"?");s.href=`${o.e.FEEDBACK_URL}/${g}#${kg(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const u=this._map.style._mergedSourceCaches;for(const x in u){const w=u[x];if(w.used){const T=w.getSource();T.attribution&&s.indexOf(T.attribution)<0&&s.push(T.attribution)}}s.sort((x,w)=>x.length-w.length),s=s.filter((x,w)=>{for(let T=w+1;T<s.length;T++)if(s[T].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yp{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=z("div","mapboxgl-ctrl");const u=z("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const u in s){const g=s[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class L0{constructor(){o.aV(["_onIndoorUpdate"],this)}onAdd(s){return this._map=s,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",u=>this._onIndoorUpdate({selectedFloorId:u.selectedFloorId,floors:u.floors})),this._container}_createButton(s,u){const g=z("button",s,this._container);return g.type="button",g.addEventListener("click",u),g}_setButtonTitle(s,u){this._map&&(s.setAttribute("aria-label",u),s.innerHTML=`<strong>${u}</strong>`,s.firstElementChild&&s.firstElementChild.setAttribute("title",u))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(s){if(!s||!s.floors)return void(this._container.style.display="none");const u=this._model;this._model=s,this._container.style.display="inline-block";const g=s.floors.sort((x,w)=>x.levelOrder-w.levelOrder);u?(Array.from(this._container.children).forEach(x=>x.remove()),this.addCurrentFloors(g)):this.addCurrentFloors(g)}addCurrentFloors(s){for(const u of s){const g=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(u.id),Array.from(this._container.children).forEach(x=>{x.classList.remove("mapboxgl-ctrl-level-button-selected")}),g.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(g,u.shortName),this._model&&u.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(u.id),g.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(g)}}}class uS{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u}remove(s){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const x of g)if(x.id===s)return void(x.cancelled=!0)}run(s=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class _p{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const u=o.dx((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,u,g){this._start=this.getValue(u),this._end=s,this._startTime=u,this._endTime=u+g}}const $C={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class hS extends o.A{constructor(s,u,g,x){const{point:w,lngLat:T,originalEvent:I,target:k}=s;super(s.type,{point:w,lngLat:T,originalEvent:I,target:k}),this.preventDefault=()=>{s.preventDefault()},this.id=u,this.interaction=g,this.feature=x}}class j0{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,u){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const g=u.filter;let x=u.type;g&&this.filters.set(s,o.b3(g)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const w=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,u)):w.size===0&&this.map.on(x,this.handleType),w.size===0&&this.interactionsByType.set(x,w),w.set(s,u),this.typeById.set(s,x)}get(s){const u=this.typeById.get(s);if(!u)return;const g=this.interactionsByType.get(u);return g?g.get(s):void 0}remove(s){const u=this.typeById.get(s);if(!u)return;this.typeById.delete(s),this.filters.delete(s);const g=this.interactionsByType.get(u);g&&(g.delete(s),u==="mouseenter"||u==="mouseleave"?(this.delegatedInteractions.delete(s),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(u,this.handleType))}queryTargets(s,u){const g=[];for(const[x,w]of u)w.target&&g.push({targetId:x,target:w.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(s,g,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const u=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());u.length&&(s.type="mouseenter",this.handleType(s,u));const g=new Map;for(const[x,{feature:w}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||g.set(w.id,w);g.size&&(s.type="mouseleave",this.handleType(s,Array.from(g.values())))}handleOut(s){const u=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);u.length&&(s.type="mouseleave",this.handleType(s,u)),this.hoveredFeatures.clear()}handleType(s,u){const g=s.type==="mouseenter";if(g&&!this.interactionsByType.has(s.type))return void o.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(s.type)).reverse(),w=!!u;u=u||this.queryTargets(s.point,x);let T=!1;const I=new Set;for(const k of u){for(const[N,F]of x){if(!F.target)continue;const q=k.variants?k.variants[N]:null;if(q){for(const V of q){if(Fm(V,k,I,N))continue;const X=new o.dr(k,V),re=Rf(V,k,N);w&&(X.state=this.map.getFeatureState(X));const Q=g?this.prevHoveredFeatures.get(re):null,oe=new hS(s,N,F,X),ie=Q?Q.stop:F.handler(oe);if(g&&this.hoveredFeatures.set(re,{feature:k,stop:ie}),ie!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[k,N]of x){const{handler:F,target:q}=N;if(!q&&F(new hS(s,k,N,null))!==!1)break}}}function N0(m,s){if(Array.isArray(m)&&Array.isArray(s)){const u=new Set(m),g=new Set(s);return u.size===g.size&&m.every(x=>g.has(x))}return o.bv(m,s)}const vp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},vd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ql{constructor(s,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Lg({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new M0({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(s,u){this.mouseRotate.mousedown(s,u),this.mousePitch&&this.mousePitch.mousedown(s,u),ne()}move(s,u){const g=this.map,x=this.mouseRotate.mousemoveWindow(s,u),w=x&&x.bearingDelta;if(w&&g.setBearing(g.getBearing()+w),this.mousePitch){const T=this.mousePitch.mousemoveWindow(s,u),I=T&&T.pitchDelta;I&&g.setPitch(g.getPitch()+I)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Y(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(o.h({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),fe(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,fe(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ce(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Ce(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ra(m,s,u){if(m=new o.ci(m.lng,m.lat),s){const g=new o.ci(m.lng-360,m.lat),x=new o.ci(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-u.center.lng)/360),T=u.locationPoint3D(m).distSqr(s),I=s.x<0||s.y<0||s.x>u.width||s.y>u.height;u.locationPoint3D(g).distSqr(s)<T&&(I||Math.abs(g.lng-u.center.lng)<w)?m=g:u.locationPoint3D(x).distSqr(s)<T&&(I||Math.abs(x.lng-u.center.lng)<w)&&(m=x)}for(;Math.abs(m.lng-u.center.lng)>180;){const g=u.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const ia={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ps={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class oa extends o.E{constructor(s,u){super(),(s instanceof HTMLElement||u)&&(s=o.h({element:s},u)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:x="#3FB1CE",scale:w=1,draggable:T=!1,clickTolerance:I=0,rotation:k=ps.rotation,rotationAlignment:N=ps.rotationAlignment,pitchAlignment:F=ps.pitchAlignment,occludedOpacity:q=ps.occludedOpacity,altitude:V=ps.altitude}=s||{};this._anchor=g,this._color=x,this._scale=w,this._draggable=T,this._clickTolerance=I,this._rotation=k,this._rotationAlignment=N,this._pitchAlignment=F,this._occludedOpacity=q,this._altitude=V,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=o.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Q=>{Q.preventDefault()}),this._element.addEventListener("mousedown",Q=>{Q.preventDefault()});const X=this._element.classList;for(const Q in ia)X.remove(`mapboxgl-marker-anchor-${Q}`);X.add(`mapboxgl-marker-anchor-${this._anchor}`);const re=s&&s.className?s.className.trim().split(/\s+/):[];X.add(...re),this._popup=null}_createDefaultMarker(){const s=z("div"),u=$("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(this._altitude===0){const g=$("radialGradient",{id:"shadowGradient"},$("defs",{},u));$("stop",{offset:"10%","stop-opacity":.4},g),$("stop",{offset:"100%","stop-opacity":.05},g),$("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u)}return $("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),$("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),$("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.ci.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(this._altitude===0&&s!==0||this._altitude!==0&&s===0)&&(this._element=this._createDefaultMarker()),this._altitude=s||ps.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const u=s.code,g=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){const u=s.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,u=this._pos;if(!s||!u)return!1;const g=s.unproject(u,this._altitude),x=s.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(g)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const u=this._pos;if(!u||u.x<0||u.x>s.transform.width||u.y<0||u.y>s.transform.height)return void this._clearFadeTimer();const g=s.unproject(u,this._altitude);let x;s._showingGlobe()&&o.eW(s.transform,this._lngLat)?x=0:(x=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${ia[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const s=this._pos,u=this._map,g=this.getPitchAlignment();if(!u||!s||g!=="map")return"";if(!u._showingGlobe()){const k=u.getPitch();return k?`rotateX(${k}deg)`:""}const x=o.cU(o.eX(u.transform,this._lngLat)),w=s.sub(o.eY(u.transform)),T=Math.abs(w.x)+Math.abs(w.y);if(T===0)return"";const I=x/T;return`rotateX(${-w.y*I}deg) rotateY(${w.x*I}deg)`}_calculateZTransform(){const s=this._pos,u=this._map;if(!u||!s)return"";let g=0;const x=this.getRotationAlignment();if(x==="map")if(u._showingGlobe()){const w=u.project(new o.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=u.project(new o.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(w);g=o.cU(Math.atan2(T.y,T.x))-90}else g=-u.getBearing();else if(x==="horizon"){const w=o.af(4,6,u.getZoom()),T=o.eY(u.transform);T.y+=w*u.transform.height;const I=s.sub(T),k=o.cU(Math.atan2(I.y,I.x));g=(k>90?k-270:k+90)*(1-w)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Ra(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat,this._altitude),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=o.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const u=this._map;if(!u)return;const g=this._pointerdownPos,x=this._positionDelta;if(g&&x){if(!this._isDragging){const w=this._clickTolerance||u._clickTolerance;if(s.point.dist(g)<w)return;this._isDragging=!0}this._pos=s.point.sub(x),this._lngLat=u.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(s){const u=this._map,g=this._pos;u&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const u=this._map;return u&&(s?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||ps.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||ps.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||ps.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||ps.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const VC={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},UC={maxWidth:100,unit:"metric"},GC={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},HC={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},dS=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jo(m=new o.P(0,0),s="bottom"){if(typeof m=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(s){case"top":return new o.P(0,m);case"top-left":return new o.P(u,u);case"top-right":return new o.P(-u,u);case"bottom":return new o.P(0,-m);case"bottom-left":return new o.P(u,-u);case"bottom-right":return new o.P(-u,-u);case"left":return new o.P(m,0);case"right":return new o.P(-m,0)}return new o.P(0,0)}return m instanceof o.P||Array.isArray(m)?o.P.convert(m):o.P.convert(m[s]||[0,0])}return{version:v,supported:B.supported,setRTLTextPlugin:o.f0,getRTLTextPluginStatus:o.e$,Map:class extends bl{constructor(m){E.mark(b.create);const s=m;if((m=o.h({},vp,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&o.eU(window)&&(m.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ov(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new uS,this._domRenderTaskQueue=new uS,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.h({},$C,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new _p(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Le(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const u=document.getElementById(m.container);if(!u)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=u}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new LC),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Fg(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||o.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new yC(this),m.hash&&(this._hash=new Og(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const u=m.bounds;u&&(this.resize(),this.fitBounds(u,o.h({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new _d({customAttribution:m.customAttribution})),this._logoControl=new yp,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new o.A(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new o.A(`${u.dataType}dataloading`,u))}),this._interactions=new j0(this)}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new o.A("movestart",m)).fire(new o.A("move",m)),this.fire(new o.A("resize",m)),s&&this.fire(new o.A("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(o.aG.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(s=>s.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(s=>s==="auto"?navigator.language:s):m}setLanguage(m){const s=this._parseLanguage(m);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,s=m.projection.name;let u;s==="globe"&&m.zoom>=o.cI?(m.setMercatorFromTransition(),u=!0):s==="mercator"&&m.zoom<o.cI&&(m.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,s){return this._updateProjection(m||s||{name:"mercator"})}_updateProjection(m){let s;return s=m.name==="globe"&&this.transform.zoom>=o.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,s){return this.transform.locationPoint3D(o.ci.convert(m),s)}unproject(m,s){return this.transform.pointLocation3D(o.P.convert(m),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,s,u){const g=x=>{let w=[];if(Array.isArray(s)){const T=s.filter(I=>this.getLayer(I));w=T.length?this.queryRenderedFeatures(x,{layers:T}):[]}else w=this.queryRenderedFeatures(x,{target:s});return w};if(m==="mouseenter"||m==="mouseover"){let x=!1;return{listener:u,targets:s,delegates:{mousemove:T=>{const I=g(T.point);I.length?x||(x=!0,u.call(this,new ii(m,this,T.originalEvent,{features:I}))):x=!1},mouseout:()=>{x=!1}}}}if(m==="mouseleave"||m==="mouseout"){let x=!1;return{listener:u,targets:s,delegates:{mousemove:I=>{g(I.point).length?x=!0:x&&(x=!1,u.call(this,new ii(m,this,I.originalEvent)))},mouseout:I=>{x&&(x=!1,u.call(this,new ii(m,this,I.originalEvent)))}}}}{const x=w=>{const T=g(w.point);T.length&&(w.features=T,u.call(this,w),delete w.features)};return{listener:u,targets:s,delegates:{[m]:x}}}}on(m,s,u){if(typeof s=="function"||u===void 0)return super.on(m,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(m,s,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(m,s,u){if(typeof s=="function"||u===void 0)return super.once(m,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(m,s,u);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(m,s,u){if(typeof s=="function"||u===void 0)return super.off(m,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(x=>{for(let w=0;w<x.length;w++){const T=x[w];if(T.listener===u&&N0(T.targets,s)){for(const I in T.delegates)this.off(I,T.delegates[I]);return x.splice(w,1),this}}})(g),this}queryRenderedFeatures(m,s){if(!this.style)return[];if(m===void 0||m instanceof o.P||Array.isArray(m)||s!==void 0||(s=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!s){const w=this.style.queryRenderedFeatures(m,void 0,this.transform),T=this.style.queryRenderedFeatureset(m,void 0,this.transform);return w.concat(T)}let u=!0;if(s.target&&(u=this._isTargetValid(s.target),u&&!s.layers))return this.style.queryRenderedFeatureset(m,s,this.transform);let g=!0;if(s.layers&&Array.isArray(s.layers)){for(const w of s.layers)if(!this._isValidId(w)){g=!1;break}if(g&&!s.target)return this.style.queryRenderedFeatures(m,s,this.transform)}let x=[];return g&&(x=x.concat(this.style.queryRenderedFeatures(m,s,this.transform))),u&&(x=x.concat(this.style.queryRenderedFeatureset(m,s,this.transform))),x}querySourceFeatures(m,s){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,s)}isPointOnSurface(m){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&o.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(m))}addInteraction(m,s){return this._interactions.add(m,s),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,s){return s=o.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&m&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(m,(u,g)=>{if(u){const x=typeof u=="string"?u:u instanceof Error?u.message:u.error;o.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(m,s)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){const s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const u=o.h({},s);s&&s.config&&(u.initialConfig=s.config,delete u.config),this.style=new Ma(this,u).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ma(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.dk(m)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const s of m)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(m)}addSource(m,s){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,s,u){this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,u)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,s,{pixelRatio:u=1,sdf:g=!1,stretchX:x,stretchY:w,content:T}={}){this._lazyInitEmptyStyle();const I=o.I.from(m);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:k,height:N,data:F}=o.q.getImageData(s);this.style.addImage(I,{data:new o.r({width:k,height:N},F),pixelRatio:u,stretchX:x,stretchY:w,content:T,sdf:g,version:0,usvg:!1})}else if(s.width===void 0||s.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:N}=s,F=s;this.style.addImage(I,{data:new o.r({width:k,height:N},new Uint8Array(F.data)),pixelRatio:u,stretchX:x,stretchY:w,content:T,sdf:g,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}updateImage(m,s){this._lazyInitEmptyStyle();const u=o.I.from(m),g=this.style.getImage(u);if(!g)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?o.q.getImageData(s):s,{width:w,height:T,data:I}=x;if(w===void 0||T===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||T!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${w}, ${T})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const k=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let N=!1;g.usvg?(g.data=new o.r({width:w,height:T},new Uint8Array(I)),g.usvg=!1,g.icon=void 0,N=!0):g.data.replace(I,k),this.style.updateImage(u,g,N)}hasImage(m){return m?!!this.style&&!!this.style.getImage(o.I.from(m)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(o.I.from(m))}loadImage(m,s){o.o(this._requestManager.transformRequest(m,o.R.Image),(u,g)=>{s(u,g instanceof HTMLImageElement?o.q.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,s){this._lazyInitEmptyStyle(),this.style.addModel(m,s)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,s){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)):this}getSlot(m){const s=this.getLayer(m);return s&&s.slot||null}setSlot(m,s){return this.style.setSlot(m,s),this.style.mergeLayers(),this._update(!0)}addImport(m,s){return this.style.addImport(m,s).catch(u=>this.fire(new o.z(new Error("Failed to add import",u)))),this}updateImport(m,s){return typeof s!="string"&&s.id!==m?(this.removeImport(m),this.addImport(s)):(this.style.updateImport(m,s),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,s){return this.style.moveImport(m,s),this._update(!0)}moveLayer(m,s){return this._isValidId(m)?(this.style.moveLayer(m,s),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const s=this.style.getOwnLayer(m);return s?s.type==="custom"?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,s,u){return this._isValidId(m)?(this.style.setLayerZoomRange(m,s,u),this._update(!0)):this}setFilter(m,s,u={}){return this._isValidId(m)?(this.style.setFilter(m,s,u),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,s,u,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,s,u,g),this._update(!0)):this}getPaintProperty(m,s){return this._isValidId(m)?this.style.getPaintProperty(m,s):null}setLayoutProperty(m,s,u,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,s,u,g),this._update(!0)):this}getLayoutProperty(m,s){return this._isValidId(m)?this.style.getLayoutProperty(m,s):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,s){return this.style.setSchema(m,s),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,s){return this.style.setConfig(m,s),this._update(!0)}getConfigProperty(m,s){return this.style.getConfigProperty(m,s)}setConfigProperty(m,s,u){return this.style.setConfigProperty(m,s,u),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const s=m[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,s),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.ci.convert(m),this.transform):0}setFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,s),this._update())}removeFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,s),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.indoor.selectFloor(m)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new L0),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let u,g,x,w=this._container;for(;w&&(!g||!x);){const T=window.getComputedStyle(w).transform;T&&T!=="none"&&(u=T.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(g=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(x=u[3])),w=w.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=x?Math.abs(s/x):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=z("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=z("div","mapboxgl-canvas-container",m);this._canvas=z("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=z("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{g[x]=z("div",`mapboxgl-ctrl-${x}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){const u=o.q.devicePixelRatio||1;this._canvas.width=u*Math.ceil(m),this._canvas.height=u*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const s=this._markers.indexOf(m);s!==-1&&this._markers.splice(s,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const s=this._popups.indexOf(m);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const m=o.h({},B.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",m);s?(Ft(s,!0),this.painter=new Yc(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.l.testSupport(s)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;this.fire(new o.A("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,g=o.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=x.createQuery(),x.beginQuery(u.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,F=this.transform.pitch,q=o.q.now(),V=new o.aa(N,{now:q,fadeDuration:w,pitch:F,transition:this.style.transition,worldview:this._worldview});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(g);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,E.mark(b.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const N=o.q.now()-g;x.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const F=x.getQueryParameter(s,x.QUERY_RESULT)/1e6;x.deleteQuery(s),this.fire(new o.A("gpu-timing-frame",{cpuTime:N,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(N);this.fire(new o.A("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(N);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:F}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(k||this._repaint)this.triggerRepaint();else{const N=this.idle();if(N&&(T=this._updateAverageElevation(g,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,E.mark(b.fullLoad),this._performanceMetricsCollection&&Pr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const s of this._markers)m&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!m||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(m,s=!1){const u=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const x=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=m;const T=Math.abs(x-w);if(T>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(w),u(w);this._averageElevation.easeTo(w,m,300)}else if(T>1e-4)return this._averageElevation.jumpTo(w),u(w)}return!!this._averageElevation.isEasing(m)&&u(this._averageElevation.getValue(m))}_authenticate(){nr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===Ye||m.status===401)){const s=this.painter.context.gl;Ft(s,!1),this._logoControl instanceof yp&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Sr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Er(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function x(w){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,w,0);const T=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,T),T}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(x(m),s.canvasCopies.map(x),s.timeStamps)}_canvasPixelComparison(m,s,u){let g=u[1]-u[0];const x=m.length/4;for(let w=0;w<s.length;w++){const T=s[w];let I=0;for(let k=0;k<T.length;k+=4)T[k]===m[k]&&T[k+1]===m[k+1]&&T[k+2]===m[k+2]&&T[k+3]===m[k+3]&&(I+=1);g+=(u[w+2]-u[w+1])*(1-I/x)}return g}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),xr.delete(this.painter.context.gl),Qt.remove(),sr.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=o.q.frame(s=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(s)}))}_preloadTiles(m){const s=this.style?this.style.getSourceCaches():[];return o.bt(s,(u,g)=>u._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,s){o.eV(m,s)}get version(){return v}},NavigationControl:class{constructor(m={}){this.options=o.h({},vd,m),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:s}):u.resetNorth({},{originalEvent:s}))}),this._compassIcon=z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const s=m.getZoom(),u=s===m.getMaxZoom(),g=s===m.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ql(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,s){const u=z("button",m,this._container);return u.type="button",u.addEventListener("click",s),u}_setButtonTitle(m,s){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",u),m.firstElementChild&&m.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends o.E{constructor(m={}){super();const s=navigator.geolocation;this.options=o.h({geolocation:s},VC,m),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=dd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const s=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,m(u)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>s(u.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),u=m.coords;return!!s&&(u.longitude<s.getWest()||u.longitude>s.getEast()||u.latitude<s.getSouth()||u.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",m)),this._finish()}}_updateCamera(m){const s=new o.ci(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,g=this._map.getBearing(),x=o.h({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(u),x,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new o.ci(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,s=o.cb(1,m._center.lat)*m.worldSize,u=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=z("button","mapboxgl-ctrl-geolocate",this._container),z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z("div","mapboxgl-user-location"),this._dotElement.appendChild(z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new oa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new oa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_d,ScaleControl:class{constructor(m={}){this.options=o.h({},UC,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,s=this._map,u=s._containerHeight/2,g=s._containerWidth/2-m/2,x=s.unproject([g,u]),w=s.unproject([g+m,u]),T=x.distanceTo(w);if(this.options.unit==="imperial"){const I=3.2808*T;I>5280?this._setScale(m,I/5280,"mile"):this._setScale(m,I,"foot")}else this.options.unit==="nautical"?this._setScale(m,T/1852,"nautical-mile"):T>=1e3?this._setScale(m,T/1e3,"kilometer"):this._setScale(m,T,"meter")}_setScale(m,s,u){this._map._requestDomTask(()=>{const g=function(w){const T=Math.pow(10,`${Math.floor(w)}`.length-1);let I=w/T;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(k){const N=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*N)/N}(I),T*I}(s),x=g/s;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(g):`${g}&nbsp;${GC[u]}`,this._container.style.width=m*x+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);z("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:L0,Popup:class extends o.E{constructor(m){super(),this.options=o.h(Object.create(HC),m),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=o.ci.convert(m),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),u=document.createElement("body");let g;for(u.innerHTML=m;g=u.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=z("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(m),this.options.closeButton){const u=this._closeButton=z("button","mapboxgl-popup-close-button",s);u.type="button",u.setAttribute("aria-label","Close popup"),u.innerHTML='<span aria-hidden="true">&#215;</span>',u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._updateClassList(),s}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const s=this._map,u=this._container,g=this._pos;if(!s||!u||!g)return"bottom";const x=u.offsetWidth,w=u.offsetHeight,T=g.x<x/2,I=g.x>s.transform.width-x/2;if(g.y+m<w)return T?"top-left":I?"top-right":"top";if(g.y>s.transform.height-w){if(T)return"bottom-left";if(I)return"bottom-right"}return T?"left":I?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),m.className=s.join(" ")}_update(m){const s=this._map,u=this._content;if(!s||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=z("div","mapboxgl-popup",s.getContainer()),this._tip=z("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ra(this._lngLat,this._pos,s.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m instanceof o.P?m:s.project(this._lngLat,this._altitude),w=Jo(this.options.offset),T=this._anchor=this._getAnchor(w.y),I=Jo(this.options.offset,T),k=x.add(I).round();s._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${ia[T]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&s._showingGlobe()){const x=o.eW(s.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(dS);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:oa,Style:Ma,LngLat:o.ci,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:g1,Evented:o.E,config:o.e,prewarm:o.e_,clearPrewarmedResources:o.eZ,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(m){o.e.ACCESS_TOKEN=m},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(m){o.e.API_URL=m},get workerCount(){return o.f7.workerCount},set workerCount(m){o.f7.workerCount=m},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){o.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){o.f6(m)},get workerUrl(){return o.f5.workerUrl},set workerUrl(m){o.f5.workerUrl=m},get workerClass(){return o.f5.workerClass},set workerClass(m){o.f5.workerClass=m},get workerParams(){return o.f5.workerParams},set workerParams(m){o.f5.workerParams=m},get dracoUrl(){return o.f4()},set dracoUrl(m){o.f3(m)},get meshoptUrl(){return o.f2()},set meshoptUrl(m){o.f1(m)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var f=l;return f})})(j9);var jfe=j9.exports;const vE=Pi(jfe),k$=e=>{let t;const r=new Set,n=(b,E)=>{const P=typeof b=="function"?b(t):b;if(!Object.is(P,t)){const O=t;t=E??(typeof P!="object"||P===null)?P:Object.assign({},t,P),r.forEach(L=>L(t,O))}},l=()=>t,o={setState:n,getState:l,getInitialState:()=>v,subscribe:b=>(r.add(b),()=>r.delete(b))},v=t=e(n,l,o);return o},Nfe=e=>e?k$(e):k$,zfe=e=>e;function Ffe(e,t=zfe){const r=ze.useSyncExternalStore(e.subscribe,ze.useCallback(()=>t(e.getState()),[e,t]),ze.useCallback(()=>t(e.getInitialState()),[e,t]));return ze.useDebugValue(r),r}const R$=e=>{const t=Nfe(e),r=n=>Ffe(t,n);return Object.assign(r,t),r},z9=e=>e?R$(e):R$,Lo=z9((e,t)=>({preschools:[],filteredPreschools:[],selectedPreschool:null,searchFilters:{},isLoading:!1,mapCenter:[15.2,62.4],mapZoom:4.9,showClusters:!0,heatmapType:"density",heatmapIntensity:1,showHeatmap:!1,layerVisibility:{heatmap:!1,clusters:!0,markers:!0,communeBorders:!1},visiblePreschools:[],listContext:"viewport",listSortOrder:"distance",selectedCommune:null,statisticsData:null,showStatistics:!1,performanceMode:"high",searchBoxCollapsed:!1,listPanelCollapsed:!1,searchTerm:"",updatePreschool:r=>e(n=>({preschools:n.preschools.map(l=>l.id===r.id?r:l)})),setPreschools:r=>{console.log(`Setting ${r.length} preschools in store`),e({preschools:r}),t().applyFilters(),e({lastUpdated:Date.now()})},setFilteredPreschools:r=>e({filteredPreschools:r}),setSelectedPreschool:r=>e({selectedPreschool:r}),setSearchFilters:r=>{const n=t(),l={...n.searchFilters,...r};e({searchFilters:l}),n.applyFilters();const h=t();if(r.kommuner&&r.kommuner.length>0)if(r.kommuner.length===1){const f=r.kommuner[0],o=Bfe(f);if(o)e({mapCenter:o,mapZoom:11});else{const v=h.filteredPreschools.filter(b=>b.kommun===f);if(v.length>0){const b=v.map(P=>P.latitud).filter(Boolean),E=v.map(P=>P.longitud).filter(Boolean);if(b.length>0){const P=b.reduce((U,G)=>U+G,0)/b.length,O=E.reduce((U,G)=>U+G,0)/E.length,L=Math.max(...b)-Math.min(...b),B=Math.max(...E)-Math.min(...E),z=Math.max(L,B);let $=12;z<.005?$=15:z<.01?$=14:z<.02?$=13:z<.05?$=12:$=11,e({mapCenter:[O,P],mapZoom:$})}}}}else{const f=h.filteredPreschools,o=f.map(b=>b.latitud).filter(Boolean),v=f.map(b=>b.longitud).filter(Boolean);if(o.length>0){const b=o.reduce((z,$)=>z+$,0)/o.length,E=v.reduce((z,$)=>z+$,0)/v.length,P=Math.max(...o)-Math.min(...o),O=Math.max(...v)-Math.min(...v),L=Math.max(P,O);let B=8;L<.05?B=11:L<.1?B=10:L<.3?B=9:L<.5?B=8:L<1?B=7:B=6,e({mapCenter:[E,b],mapZoom:B})}}else if(r.center&&r.nearbyMode)e({mapCenter:r.center,mapZoom:13});else if(r.query&&!r.kommuner){const f=h.filteredPreschools;if(f.length>0)if(f.length===1){const o=f[0];o.longitud&&o.latitud&&e({mapCenter:[o.longitud,o.latitud],mapZoom:15})}else{const o=f.map(b=>b.latitud).filter(Boolean),v=f.map(b=>b.longitud).filter(Boolean);if(o.length>0){const b=o.reduce((z,$)=>z+$,0)/o.length,E=v.reduce((z,$)=>z+$,0)/v.length,P=Math.max(...o)-Math.min(...o),O=Math.max(...v)-Math.min(...v),L=Math.max(P,O);let B=12;L<.005?B=15:L<.01?B=14:L<.02?B=13:L<.05?B=12:L<.1?B=11:B=10,e({mapCenter:[E,b],mapZoom:B})}}}else if(h.filteredPreschools.length>0&&Object.keys(l).length>0){const f=h.filteredPreschools,o=f.map(b=>b.latitud).filter(Boolean),v=f.map(b=>b.longitud).filter(Boolean);if(o.length>0&&v.length>0){const b=o.reduce((z,$)=>z+$,0)/o.length,E=v.reduce((z,$)=>z+$,0)/v.length,P=Math.max(...o)-Math.min(...o),O=Math.max(...v)-Math.min(...v),L=Math.max(P,O);let B=10;L<.01?B=15:L<.05?B=13:L<.1?B=11:L<.5?B=9:B=7,e({mapCenter:[E,b],mapZoom:B})}}},clearFilters:()=>{e({searchFilters:{},mapCenter:[15,62],mapZoom:5}),t().applyFilters()},clearSearchFilters:()=>{e({searchFilters:{},mapCenter:[15,62],mapZoom:5}),t().applyFilters()},clearSpecificFilter:r=>{const n=t(),l={...n.searchFilters};delete l[r],r==="nearbyMode"?(delete l.center,delete l.radius,e({searchFilters:l,mapCenter:[15,62],mapZoom:5})):e({searchFilters:l}),n.applyFilters()},get hasActiveFilters(){const r=t().searchFilters;return!!(r.kommuner&&r.kommuner.length>0||r.huvudman&&r.huvudman!=="alla"||r.maxChildren&&r.maxChildren<200||r.nearbyMode||r.radius&&r.center||r.query&&r.query.trim().length>0||r.minPersonaltäthet||r.maxPersonaltäthet||r.minExamen||r.maxExamen||r.minBarngrupper||r.maxBarngrupper||r.travelTime)},setLoading:r=>e({isLoading:r}),setMapCenter:r=>e({mapCenter:r}),setMapZoom:r=>e({mapZoom:r}),setShowClusters:r=>e({showClusters:r}),setHeatmapType:r=>e({heatmapType:r}),setHeatmapIntensity:r=>e({heatmapIntensity:r}),setShowHeatmap:r=>e({showHeatmap:r}),setLayerVisibility:(r,n)=>{e(l=>({layerVisibility:{...l.layerVisibility,[r]:n}}))},setSelectedCommune:r=>e({selectedCommune:r}),setStatisticsData:r=>e({statisticsData:r}),setShowStatistics:r=>e({showStatistics:r}),setVisiblePreschools:r=>e({visiblePreschools:r}),setListContext:r=>e({listContext:r}),setListSortOrder:r=>e({listSortOrder:r}),updateVisiblePreschoolsFromViewport:r=>{const{filteredPreschools:n,listSortOrder:l}=t(),h=n.filter(f=>{if(!f.latitud||!f.longitud)return!1;const o=f.latitud,v=f.longitud;return o>=r.south&&o<=r.north&&v>=r.west&&v<=r.east});if(h.length<1e3)switch(l){case"rating":h.sort((f,o)=>(o.google_rating||0)-(f.google_rating||0));break;case"name":h.sort((f,o)=>f.namn.localeCompare(o.namn));break;case"quality":h.sort((f,o)=>(o.andel_med_förskollärarexamen||0)-(f.andel_med_förskollärarexamen||0));break}e({visiblePreschools:h})},setPerformanceMode:r=>e({performanceMode:r}),setSearchBoxCollapsed:r=>e({searchBoxCollapsed:r}),setListPanelCollapsed:r=>e({listPanelCollapsed:r}),setSearchTerm:r=>e({searchTerm:r}),applyFilters:()=>{const{preschools:r,searchFilters:n}=t(),l=r.filter(h=>{if(n.query){const f=n.query.toLowerCase(),o=h.namn.toLowerCase().includes(f),v=h.kommun.toLowerCase().includes(f);if(!o&&!v)return!1}if(n.maxChildren&&h.antal_barn&&h.antal_barn>n.maxChildren||n.kommuner&&n.kommuner.length>0&&!n.kommuner.includes(h.kommun))return!1;if(n.huvudman){const f=n.huvudman==="Fristående"?"Enskild":n.huvudman;if(h.huvudman!==f)return!1}if(n.minPersonaltäthet&&(!h.personaltäthet||h.personaltäthet<n.minPersonaltäthet)||n.maxPersonaltäthet&&(!h.personaltäthet||h.personaltäthet>n.maxPersonaltäthet)||n.minExamen&&(!h.andel_med_förskollärarexamen||h.andel_med_förskollärarexamen<n.minExamen)||n.maxExamen&&(!h.andel_med_förskollärarexamen||h.andel_med_förskollärarexamen>n.maxExamen)||n.minBarngrupper&&h.antal_barngrupper<n.minBarngrupper||n.maxBarngrupper&&h.antal_barngrupper>n.maxBarngrupper)return!1;if(n.radius&&n.center){const[f,o]=Array.isArray(n.center)?n.center:"lng"in n.center?[n.center.lng,n.center.lat]:[n.center.lon,n.center.lat],v=D$(o,f,h.latitud,h.longitud),b=n.radius/1e3;if(v>b)return!1}if(n.travelTime){const f=n.travelTime.userLocation.lat,o=n.travelTime.userLocation.lng,v=D$(f,o,h.latitud,h.longitud),b={walking:5,bicycling:15,driving:30,transit:20}[n.travelTime.transportMode];if(v/b*60>n.travelTime.maxMinutes)return!1}return!0});e({filteredPreschools:l}),console.log(`🔍 Applied filters, ${l.length} preschools match criteria`)}}));function D$(e,t,r,n){const h=OT(r-e),f=OT(n-t),o=Math.sin(h/2)*Math.sin(h/2)+Math.cos(OT(e))*Math.cos(OT(r))*Math.sin(f/2)*Math.sin(f/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}function OT(e){return e*(Math.PI/180)}function Bfe(e){return{Stockholm:[18.0686,59.3293],Göteborg:[11.9746,57.7089],Malmö:[13.0034,55.605],Uppsala:[17.6389,59.8585],Västerås:[16.5554,59.6099],Örebro:[15.2066,59.2741],Linköping:[15.6214,58.4108],Helsingborg:[12.6945,56.0465],Jönköping:[14.1618,57.7826],Norrköping:[16.1926,58.5877],Lund:[13.191,55.7047],Umeå:[20.263,63.8258],Gävle:[17.1414,60.6749],Borås:[12.9401,57.721],Eskilstuna:[16.5077,59.3706],Södertälje:[17.6253,59.1955],Karlstad:[13.5034,59.3793],Täby:[18.0631,59.4439],Växjö:[14.8059,56.8777],Halmstad:[12.858,56.6745],Sundsvall:[17.3063,62.3908],Luleå:[22.1567,65.5848],Trollhättan:[12.2886,58.2837],Östersund:[14.6357,63.1792],Borlänge:[15.4357,60.4858],Falun:[15.6356,60.6066],Skövde:[13.8454,58.3914],Karlskrona:[15.5866,56.1612],Kristianstad:[14.1591,56.0294],Kalmar:[16.3614,56.6634],Vänersborg:[12.3225,58.3789],Varberg:[12.2504,57.1057],Trelleborg:[13.1567,55.3753],Åkersberga:[18.2878,59.4797],Visby:[18.2948,57.6348],Mora:[14.5389,61.0088],Sandviken:[16.7725,60.6184],Kiruna:[20.2253,67.8558],Kungälv:[11.9746,57.8737],Partille:[11.9989,57.7396],Mölndal:[12.0134,57.6554],Lerum:[12.2691,57.7706],Stenungsund:[11.8263,58.0706],Ale:[12.0465,57.9378],Alingsås:[12.5344,57.9304],Vårgårda:[12.8162,58.0356],Herrljunga:[13.0239,58.0916],Tranemo:[13.3454,57.4886],Svenljunga:[13.1064,57.4976],Vara:[12.9584,58.2596],Götene:[13.4234,58.3896],Tibro:[12.5264,58.4236],Lidköping:[13.1577,58.5052],Mariestad:[13.8238,58.7096],Kungsbacka:[12.0784,57.4866]}[e]||null}const Fj=K.createContext({});function Ww(e){const t=K.useRef(null);return t.current===null&&(t.current=e()),t.current}const Bj=typeof window<"u",$j=Bj?K.useLayoutEffect:K.useEffect,qA=K.createContext(null);function Vj(e,t){e.indexOf(t)===-1&&e.push(t)}function Uj(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const Ah=(e,t,r)=>r>t?t:r<e?e:r;let Gj=()=>{};const Ph={},F9=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function B9(e){return typeof e=="object"&&e!==null}const $9=e=>/^0[^.\s]+$/u.test(e);function Hj(e){let t;return()=>(t===void 0&&(t=e()),t)}const Nl=e=>e,$fe=(e,t)=>r=>t(e(r)),qw=(...e)=>e.reduce($fe),Zb=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n};class Wj{constructor(){this.subscriptions=[]}add(t){return Vj(this.subscriptions,t),()=>Uj(this.subscriptions,t)}notify(t,r,n){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,r,n);else for(let h=0;h<l;h++){const f=this.subscriptions[h];f&&f(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const _u=e=>e*1e3,vu=e=>e/1e3;function V9(e,t){return t?e*(1e3/t):0}const U9=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,Vfe=1e-7,Ufe=12;function Gfe(e,t,r,n,l){let h,f,o=0;do f=t+(r-t)/2,h=U9(f,n,l)-e,h>0?r=f:t=f;while(Math.abs(h)>Vfe&&++o<Ufe);return f}function Zw(e,t,r,n){if(e===t&&r===n)return Nl;const l=h=>Gfe(h,0,1,e,r);return h=>h===0||h===1?h:U9(l(h),t,n)}const G9=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,H9=e=>t=>1-e(1-t),W9=Zw(.33,1.53,.69,.99),qj=H9(W9),q9=G9(qj),Z9=e=>(e*=2)<1?.5*qj(e):.5*(2-Math.pow(2,-10*(e-1))),Zj=e=>1-Math.sin(Math.acos(e)),X9=H9(Zj),K9=G9(Zj),Hfe=Zw(.42,0,1,1),Wfe=Zw(0,0,.58,1),Y9=Zw(.42,0,.58,1),qfe=e=>Array.isArray(e)&&typeof e[0]!="number",J9=e=>Array.isArray(e)&&typeof e[0]=="number",Zfe={linear:Nl,easeIn:Hfe,easeInOut:Y9,easeOut:Wfe,circIn:Zj,circInOut:K9,circOut:X9,backIn:qj,backInOut:q9,backOut:W9,anticipate:Z9},Xfe=e=>typeof e=="string",L$=e=>{if(J9(e)){Gj(e.length===4);const[t,r,n,l]=e;return Zw(t,r,n,l)}else if(Xfe(e))return Zfe[e];return e},kT=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Kfe(e,t){let r=new Set,n=new Set,l=!1,h=!1;const f=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function v(E){f.has(E)&&(b.schedule(E),e()),E(o)}const b={schedule:(E,P=!1,O=!1)=>{const B=O&&l?r:n;return P&&f.add(E),B.has(E)||B.add(E),E},cancel:E=>{n.delete(E),f.delete(E)},process:E=>{if(o=E,l){h=!0;return}l=!0,[r,n]=[n,r],r.forEach(v),r.clear(),l=!1,h&&(h=!1,b.process(E))}};return b}const Yfe=40;function Q9(e,t){let r=!1,n=!0;const l={delta:0,timestamp:0,isProcessing:!1},h=()=>r=!0,f=kT.reduce((Z,ne)=>(Z[ne]=Kfe(h),Z),{}),{setup:o,read:v,resolveKeyframes:b,preUpdate:E,update:P,preRender:O,render:L,postRender:B}=f,z=()=>{const Z=Ph.useManualTiming?l.timestamp:performance.now();r=!1,Ph.useManualTiming||(l.delta=n?1e3/60:Math.max(Math.min(Z-l.timestamp,Yfe),1)),l.timestamp=Z,l.isProcessing=!0,o.process(l),v.process(l),b.process(l),E.process(l),P.process(l),O.process(l),L.process(l),B.process(l),l.isProcessing=!1,r&&t&&(n=!1,e(z))},$=()=>{r=!0,n=!0,l.isProcessing||e(z)};return{schedule:kT.reduce((Z,ne)=>{const Y=f[ne];return Z[ne]=(ee,le=!1,fe=!1)=>(r||$(),Y.schedule(ee,le,fe)),Z},{}),cancel:Z=>{for(let ne=0;ne<kT.length;ne++)f[kT[ne]].cancel(Z)},state:l,steps:f}}const{schedule:ao,cancel:Ch,state:Ds,steps:BM}=Q9(typeof requestAnimationFrame<"u"?requestAnimationFrame:Nl,!0);let xE;function Jfe(){xE=void 0}const Ba={now:()=>(xE===void 0&&Ba.set(Ds.isProcessing||Ph.useManualTiming?Ds.timestamp:performance.now()),xE),set:e=>{xE=e,queueMicrotask(Jfe)}},eZ=e=>t=>typeof t=="string"&&t.startsWith(e),Xj=eZ("--"),Qfe=eZ("var(--"),Kj=e=>Qfe(e)?epe.test(e.split("/*")[0].trim()):!1,epe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,ov={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Xb={...ov,transform:e=>Ah(0,1,e)},RT={...ov,default:1},hb=e=>Math.round(e*1e5)/1e5,Yj=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function tpe(e){return e==null}const rpe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Jj=(e,t)=>r=>!!(typeof r=="string"&&rpe.test(r)&&r.startsWith(e)||t&&!tpe(r)&&Object.prototype.hasOwnProperty.call(r,t)),tZ=(e,t,r)=>n=>{if(typeof n!="string")return n;const[l,h,f,o]=n.match(Yj);return{[e]:parseFloat(l),[t]:parseFloat(h),[r]:parseFloat(f),alpha:o!==void 0?parseFloat(o):1}},npe=e=>Ah(0,255,e),$M={...ov,transform:e=>Math.round(npe(e))},qp={test:Jj("rgb","red"),parse:tZ("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+$M.transform(e)+", "+$M.transform(t)+", "+$M.transform(r)+", "+hb(Xb.transform(n))+")"};function ipe(e){let t="",r="",n="",l="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),l=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),l=e.substring(4,5),t+=t,r+=r,n+=n,l+=l),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:l?parseInt(l,16)/255:1}}const iR={test:Jj("#"),parse:ipe,transform:qp.transform},Xw=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),jd=Xw("deg"),xu=Xw("%"),bn=Xw("px"),ope=Xw("vh"),spe=Xw("vw"),j$={...xu,parse:e=>xu.parse(e)/100,transform:e=>xu.transform(e*100)},My={test:Jj("hsl","hue"),parse:tZ("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+xu.transform(hb(t))+", "+xu.transform(hb(r))+", "+hb(Xb.transform(n))+")"},Go={test:e=>qp.test(e)||iR.test(e)||My.test(e),parse:e=>qp.test(e)?qp.parse(e):My.test(e)?My.parse(e):iR.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?qp.transform(e):My.transform(e),getAnimatableNone:e=>{const t=Go.parse(e);return t.alpha=0,Go.transform(t)}},ape=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function lpe(e){return isNaN(e)&&typeof e=="string"&&(e.match(Yj)?.length||0)+(e.match(ape)?.length||0)>0}const rZ="number",nZ="color",cpe="var",upe="var(",N$="${}",hpe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Kb(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},l=[];let h=0;const o=t.replace(hpe,v=>(Go.test(v)?(n.color.push(h),l.push(nZ),r.push(Go.parse(v))):v.startsWith(upe)?(n.var.push(h),l.push(cpe),r.push(v)):(n.number.push(h),l.push(rZ),r.push(parseFloat(v))),++h,N$)).split(N$);return{values:r,split:o,indexes:n,types:l}}function iZ(e){return Kb(e).values}function oZ(e){const{split:t,types:r}=Kb(e),n=t.length;return l=>{let h="";for(let f=0;f<n;f++)if(h+=t[f],l[f]!==void 0){const o=r[f];o===rZ?h+=hb(l[f]):o===nZ?h+=Go.transform(l[f]):h+=l[f]}return h}}const dpe=e=>typeof e=="number"?0:Go.test(e)?Go.getAnimatableNone(e):e;function fpe(e){const t=iZ(e);return oZ(e)(t.map(dpe))}const vf={test:lpe,parse:iZ,createTransformer:oZ,getAnimatableNone:fpe};function VM(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function ppe({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let l=0,h=0,f=0;if(!t)l=h=f=r;else{const o=r<.5?r*(1+t):r+t-r*t,v=2*r-o;l=VM(v,o,e+1/3),h=VM(v,o,e),f=VM(v,o,e-1/3)}return{red:Math.round(l*255),green:Math.round(h*255),blue:Math.round(f*255),alpha:n}}function o2(e,t){return r=>r>0?t:e}const go=(e,t,r)=>e+(t-e)*r,UM=(e,t,r)=>{const n=e*e,l=r*(t*t-n)+n;return l<0?0:Math.sqrt(l)},mpe=[iR,qp,My],gpe=e=>mpe.find(t=>t.test(e));function z$(e){const t=gpe(e);if(!t)return!1;let r=t.parse(e);return t===My&&(r=ppe(r)),r}const F$=(e,t)=>{const r=z$(e),n=z$(t);if(!r||!n)return o2(e,t);const l={...r};return h=>(l.red=UM(r.red,n.red,h),l.green=UM(r.green,n.green,h),l.blue=UM(r.blue,n.blue,h),l.alpha=go(r.alpha,n.alpha,h),qp.transform(l))},oR=new Set(["none","hidden"]);function ype(e,t){return oR.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function _pe(e,t){return r=>go(e,t,r)}function Qj(e){return typeof e=="number"?_pe:typeof e=="string"?Kj(e)?o2:Go.test(e)?F$:bpe:Array.isArray(e)?sZ:typeof e=="object"?Go.test(e)?F$:vpe:o2}function sZ(e,t){const r=[...e],n=r.length,l=e.map((h,f)=>Qj(h)(h,t[f]));return h=>{for(let f=0;f<n;f++)r[f]=l[f](h);return r}}function vpe(e,t){const r={...e,...t},n={};for(const l in r)e[l]!==void 0&&t[l]!==void 0&&(n[l]=Qj(e[l])(e[l],t[l]));return l=>{for(const h in n)r[h]=n[h](l);return r}}function xpe(e,t){const r=[],n={color:0,var:0,number:0};for(let l=0;l<t.values.length;l++){const h=t.types[l],f=e.indexes[h][n[h]],o=e.values[f]??0;r[l]=o,n[h]++}return r}const bpe=(e,t)=>{const r=vf.createTransformer(t),n=Kb(e),l=Kb(t);return n.indexes.var.length===l.indexes.var.length&&n.indexes.color.length===l.indexes.color.length&&n.indexes.number.length>=l.indexes.number.length?oR.has(e)&&!l.values.length||oR.has(t)&&!n.values.length?ype(e,t):qw(sZ(xpe(n,l),l.values),r):o2(e,t)};function aZ(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?go(e,t,r):Qj(e)(e,t)}const wpe=e=>{const t=({timestamp:r})=>e(r);return{start:(r=!0)=>ao.update(t,r),stop:()=>Ch(t),now:()=>Ds.isProcessing?Ds.timestamp:Ba.now()}},lZ=(e,t,r=10)=>{let n="";const l=Math.max(Math.round(t/r),2);for(let h=0;h<l;h++)n+=Math.round(e(h/(l-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},s2=2e4;function eN(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<s2;)t+=r,n=e.next(t);return t>=s2?1/0:t}function Spe(e,t=100,r){const n=r({...e,keyframes:[0,t]}),l=Math.min(eN(n),s2);return{type:"keyframes",ease:h=>n.next(l*h).value/t,duration:vu(l)}}const Tpe=5;function cZ(e,t,r){const n=Math.max(t-Tpe,0);return V9(r-e(n),t-n)}const Po={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},GM=.001;function Epe({duration:e=Po.duration,bounce:t=Po.bounce,velocity:r=Po.velocity,mass:n=Po.mass}){let l,h,f=1-t;f=Ah(Po.minDamping,Po.maxDamping,f),e=Ah(Po.minDuration,Po.maxDuration,vu(e)),f<1?(l=b=>{const E=b*f,P=E*e,O=E-r,L=sR(b,f),B=Math.exp(-P);return GM-O/L*B},h=b=>{const P=b*f*e,O=P*r+r,L=Math.pow(f,2)*Math.pow(b,2)*e,B=Math.exp(-P),z=sR(Math.pow(b,2),f);return(-l(b)+GM>0?-1:1)*((O-L)*B)/z}):(l=b=>{const E=Math.exp(-b*e),P=(b-r)*e+1;return-GM+E*P},h=b=>{const E=Math.exp(-b*e),P=(r-b)*(e*e);return E*P});const o=5/e,v=Ppe(l,h,o);if(e=_u(e),isNaN(v))return{stiffness:Po.stiffness,damping:Po.damping,duration:e};{const b=Math.pow(v,2)*n;return{stiffness:b,damping:f*2*Math.sqrt(n*b),duration:e}}}const Ape=12;function Ppe(e,t,r){let n=r;for(let l=1;l<Ape;l++)n=n-e(n)/t(n);return n}function sR(e,t){return e*Math.sqrt(1-t*t)}const Cpe=["duration","bounce"],Ipe=["stiffness","damping","mass"];function B$(e,t){return t.some(r=>e[r]!==void 0)}function Mpe(e){let t={velocity:Po.velocity,stiffness:Po.stiffness,damping:Po.damping,mass:Po.mass,isResolvedFromDuration:!1,...e};if(!B$(e,Ipe)&&B$(e,Cpe))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(r*1.2),l=n*n,h=2*Ah(.05,1,1-(e.bounce||0))*Math.sqrt(l);t={...t,mass:Po.mass,stiffness:l,damping:h}}else{const r=Epe(e);t={...t,...r,mass:Po.mass},t.isResolvedFromDuration=!0}return t}function a2(e=Po.visualDuration,t=Po.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:l}=r;const h=r.keyframes[0],f=r.keyframes[r.keyframes.length-1],o={done:!1,value:h},{stiffness:v,damping:b,mass:E,duration:P,velocity:O,isResolvedFromDuration:L}=Mpe({...r,velocity:-vu(r.velocity||0)}),B=O||0,z=b/(2*Math.sqrt(v*E)),$=f-h,U=vu(Math.sqrt(v/E)),G=Math.abs($)<5;n||(n=G?Po.restSpeed.granular:Po.restSpeed.default),l||(l=G?Po.restDelta.granular:Po.restDelta.default);let Z;if(z<1){const Y=sR(U,z);Z=ee=>{const le=Math.exp(-z*U*ee);return f-le*((B+z*U*$)/Y*Math.sin(Y*ee)+$*Math.cos(Y*ee))}}else if(z===1)Z=Y=>f-Math.exp(-U*Y)*($+(B+U*$)*Y);else{const Y=U*Math.sqrt(z*z-1);Z=ee=>{const le=Math.exp(-z*U*ee),fe=Math.min(Y*ee,300);return f-le*((B+z*U*$)*Math.sinh(fe)+Y*$*Math.cosh(fe))/Y}}const ne={calculatedDuration:L&&P||null,next:Y=>{const ee=Z(Y);if(L)o.done=Y>=P;else{let le=Y===0?B:0;z<1&&(le=Y===0?_u(B):cZ(Z,Y,ee));const fe=Math.abs(le)<=n,Ce=Math.abs(f-ee)<=l;o.done=fe&&Ce}return o.value=o.done?f:ee,o},toString:()=>{const Y=Math.min(eN(ne),s2),ee=lZ(le=>ne.next(Y*le).value,Y,30);return Y+"ms "+ee},toTransition:()=>{}};return ne}a2.applyToOptions=e=>{const t=Spe(e,100,a2);return e.ease=t.ease,e.duration=_u(t.duration),e.type="keyframes",e};function aR({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:l=10,bounceStiffness:h=500,modifyTarget:f,min:o,max:v,restDelta:b=.5,restSpeed:E}){const P=e[0],O={done:!1,value:P},L=fe=>o!==void 0&&fe<o||v!==void 0&&fe>v,B=fe=>o===void 0?v:v===void 0||Math.abs(o-fe)<Math.abs(v-fe)?o:v;let z=r*t;const $=P+z,U=f===void 0?$:f($);U!==$&&(z=U-P);const G=fe=>-z*Math.exp(-fe/n),Z=fe=>U+G(fe),ne=fe=>{const Ce=G(fe),Oe=Z(fe);O.done=Math.abs(Ce)<=b,O.value=O.done?U:Oe};let Y,ee;const le=fe=>{L(O.value)&&(Y=fe,ee=a2({keyframes:[O.value,B(O.value)],velocity:cZ(Z,fe,O.value),damping:l,stiffness:h,restDelta:b,restSpeed:E}))};return le(0),{calculatedDuration:null,next:fe=>{let Ce=!1;return!ee&&Y===void 0&&(Ce=!0,ne(fe),le(fe)),Y!==void 0&&fe>=Y?ee.next(fe-Y):(!Ce&&ne(fe),O)}}}function Ope(e,t,r){const n=[],l=r||Ph.mix||aZ,h=e.length-1;for(let f=0;f<h;f++){let o=l(e[f],e[f+1]);if(t){const v=Array.isArray(t)?t[f]||Nl:t;o=qw(v,o)}n.push(o)}return n}function uZ(e,t,{clamp:r=!0,ease:n,mixer:l}={}){const h=e.length;if(Gj(h===t.length),h===1)return()=>t[0];if(h===2&&t[0]===t[1])return()=>t[1];const f=e[0]===e[1];e[0]>e[h-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=Ope(t,n,l),v=o.length,b=E=>{if(f&&E<e[0])return t[0];let P=0;if(v>1)for(;P<e.length-2&&!(E<e[P+1]);P++);const O=Zb(e[P],e[P+1],E);return o[P](O)};return r?E=>b(Ah(e[0],e[h-1],E)):b}function kpe(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const l=Zb(0,t,n);e.push(go(r,1,l))}}function Rpe(e){const t=[0];return kpe(t,e.length-1),t}function Dpe(e,t){return e.map(r=>r*t)}function Lpe(e,t){return e.map(()=>t||Y9).splice(0,e.length-1)}function db({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const l=qfe(n)?n.map(L$):L$(n),h={done:!1,value:t[0]},f=Dpe(r&&r.length===t.length?r:Rpe(t),e),o=uZ(f,t,{ease:Array.isArray(l)?l:Lpe(t,l)});return{calculatedDuration:e,next:v=>(h.value=o(v),h.done=v>=e,h)}}const jpe=e=>e!==null;function tN(e,{repeat:t,repeatType:r="loop"},n,l=1){const h=e.filter(jpe),o=l<0||t&&r!=="loop"&&t%2===1?0:h.length-1;return!o||n===void 0?h[o]:n}const Npe={decay:aR,inertia:aR,tween:db,keyframes:db,spring:a2};function hZ(e){typeof e.type=="string"&&(e.type=Npe[e.type])}class rN{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,r){return this.finished.then(t,r)}}const zpe=e=>e/100;class nN extends rN{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==Ba.now()&&this.tick(Ba.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;hZ(t);const{type:r=db,repeat:n=0,repeatDelay:l=0,repeatType:h,velocity:f=0}=t;let{keyframes:o}=t;const v=r||db;v!==db&&typeof o[0]!="number"&&(this.mixKeyframes=qw(zpe,aZ(o[0],o[1])),o=[0,100]);const b=v({...t,keyframes:o});h==="mirror"&&(this.mirroredGenerator=v({...t,keyframes:[...o].reverse(),velocity:-f})),b.calculatedDuration===null&&(b.calculatedDuration=eN(b));const{calculatedDuration:E}=b;this.calculatedDuration=E,this.resolvedDuration=E+l,this.totalDuration=this.resolvedDuration*(n+1)-l,this.generator=b}updateTime(t){const r=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(t,r=!1){const{generator:n,totalDuration:l,mixKeyframes:h,mirroredGenerator:f,resolvedDuration:o,calculatedDuration:v}=this;if(this.startTime===null)return n.next(0);const{delay:b=0,keyframes:E,repeat:P,repeatType:O,repeatDelay:L,type:B,onUpdate:z,finalKeyframe:$}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-l/this.speed,this.startTime)),r?this.currentTime=t:this.updateTime(t);const U=this.currentTime-b*(this.playbackSpeed>=0?1:-1),G=this.playbackSpeed>=0?U<0:U>l;this.currentTime=Math.max(U,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=l);let Z=this.currentTime,ne=n;if(P){const fe=Math.min(this.currentTime,l)/o;let Ce=Math.floor(fe),Oe=fe%1;!Oe&&fe>=1&&(Oe=1),Oe===1&&Ce--,Ce=Math.min(Ce,P+1),!!(Ce%2)&&(O==="reverse"?(Oe=1-Oe,L&&(Oe-=L/o)):O==="mirror"&&(ne=f)),Z=Ah(0,1,Oe)*o}const Y=G?{done:!1,value:E[0]}:ne.next(Z);h&&(Y.value=h(Y.value));let{done:ee}=Y;!G&&v!==null&&(ee=this.playbackSpeed>=0?this.currentTime>=l:this.currentTime<=0);const le=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ee);return le&&B!==aR&&(Y.value=tN(E,this.options,$,this.speed)),z&&z(Y.value),le&&this.finish(),Y}then(t,r){return this.finished.then(t,r)}get duration(){return vu(this.calculatedDuration)}get time(){return vu(this.currentTime)}set time(t){t=_u(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(Ba.now());const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=vu(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=wpe,startTime:r}=this.options;this.driver||(this.driver=t(l=>this.tick(l))),this.options.onPlay?.();const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=r??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Ba.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function Fpe(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const Zp=e=>e*180/Math.PI,lR=e=>{const t=Zp(Math.atan2(e[1],e[0]));return cR(t)},Bpe={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:lR,rotateZ:lR,skewX:e=>Zp(Math.atan(e[1])),skewY:e=>Zp(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},cR=e=>(e=e%360,e<0&&(e+=360),e),$$=lR,V$=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),U$=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),$pe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:V$,scaleY:U$,scale:e=>(V$(e)+U$(e))/2,rotateX:e=>cR(Zp(Math.atan2(e[6],e[5]))),rotateY:e=>cR(Zp(Math.atan2(-e[2],e[0]))),rotateZ:$$,rotate:$$,skewX:e=>Zp(Math.atan(e[4])),skewY:e=>Zp(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function uR(e){return e.includes("scale")?1:0}function hR(e,t){if(!e||e==="none")return uR(t);const r=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,l;if(r)n=$pe,l=r;else{const o=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=Bpe,l=o}if(!l)return uR(t);const h=n[t],f=l[1].split(",").map(Upe);return typeof h=="function"?h(f):f[h]}const Vpe=(e,t)=>{const{transform:r="none"}=getComputedStyle(e);return hR(r,t)};function Upe(e){return parseFloat(e.trim())}const sv=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],av=new Set(sv),G$=e=>e===ov||e===bn,Gpe=new Set(["x","y","z"]),Hpe=sv.filter(e=>!Gpe.has(e));function Wpe(e){const t=[];return Hpe.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}const am={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>hR(t,"x"),y:(e,{transform:t})=>hR(t,"y")};am.translateX=am.x;am.translateY=am.y;const lm=new Set;let dR=!1,fR=!1,pR=!1;function dZ(){if(fR){const e=Array.from(lm).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),r=new Map;t.forEach(n=>{const l=Wpe(n);l.length&&(r.set(n,l),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const l=r.get(n);l&&l.forEach(([h,f])=>{n.getValue(h)?.set(f)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}fR=!1,dR=!1,lm.forEach(e=>e.complete(pR)),lm.clear()}function fZ(){lm.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(fR=!0)})}function qpe(){pR=!0,fZ(),dZ(),pR=!1}class iN{constructor(t,r,n,l,h,f=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=n,this.motionValue=l,this.element=h,this.isAsync=f}scheduleResolve(){this.state="scheduled",this.isAsync?(lm.add(this),dR||(dR=!0,ao.read(fZ),ao.resolveKeyframes(dZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:n,motionValue:l}=this;if(t[0]===null){const h=l?.get(),f=t[t.length-1];if(h!==void 0)t[0]=h;else if(n&&r){const o=n.readValue(r,f);o!=null&&(t[0]=o)}t[0]===void 0&&(t[0]=f),l&&h===void 0&&l.set(t[0])}Fpe(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),lm.delete(this)}cancel(){this.state==="scheduled"&&(lm.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Zpe=e=>e.startsWith("--");function Xpe(e,t,r){Zpe(t)?e.style.setProperty(t,r):e.style[t]=r}const Kpe=Hj(()=>window.ScrollTimeline!==void 0),Ype={};function Jpe(e,t){const r=Hj(e);return()=>Ype[t]??r()}const pZ=Jpe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Kx=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,H$={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Kx([0,.65,.55,1]),circOut:Kx([.55,0,1,.45]),backIn:Kx([.31,.01,.66,-.59]),backOut:Kx([.33,1.53,.69,.99])};function mZ(e,t){if(e)return typeof e=="function"?pZ()?lZ(e,t):"ease-out":J9(e)?Kx(e):Array.isArray(e)?e.map(r=>mZ(r,t)||H$.easeOut):H$[e]}function Qpe(e,t,r,{delay:n=0,duration:l=300,repeat:h=0,repeatType:f="loop",ease:o="easeOut",times:v}={},b=void 0){const E={[t]:r};v&&(E.offset=v);const P=mZ(o,l);Array.isArray(P)&&(E.easing=P);const O={delay:n,duration:l,easing:Array.isArray(P)?"linear":P,fill:"both",iterations:h+1,direction:f==="reverse"?"alternate":"normal"};return b&&(O.pseudoElement=b),e.animate(E,O)}function gZ(e){return typeof e=="function"&&"applyToOptions"in e}function eme({type:e,...t}){return gZ(e)&&pZ()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class tme extends rN{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:r,name:n,keyframes:l,pseudoElement:h,allowFlatten:f=!1,finalKeyframe:o,onComplete:v}=t;this.isPseudoElement=!!h,this.allowFlatten=f,this.options=t,Gj(typeof t.type!="string");const b=eme(t);this.animation=Qpe(r,n,l,b,h),b.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!h){const E=tN(l,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(E):Xpe(r,n,E),this.animation.cancel()}v?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return vu(Number(t))}get time(){return vu(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=_u(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&Kpe()?(this.animation.timeline=t,Nl):r(this)}}const yZ={anticipate:Z9,backInOut:q9,circInOut:K9};function rme(e){return e in yZ}function nme(e){typeof e.ease=="string"&&rme(e.ease)&&(e.ease=yZ[e.ease])}const W$=10;class ime extends tme{constructor(t){nme(t),hZ(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:r,onUpdate:n,onComplete:l,element:h,...f}=this.options;if(!r)return;if(t!==void 0){r.set(t);return}const o=new nN({...f,autoplay:!1}),v=_u(this.finishedTime??this.time);r.setWithVelocity(o.sample(v-W$).value,o.sample(v).value,W$),o.stop()}}const q$=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(vf.test(e)||e==="0")&&!e.startsWith("url("));function ome(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function sme(e,t,r,n){const l=e[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const h=e[e.length-1],f=q$(l,t),o=q$(h,t);return!f||!o?!1:ome(e)||(r==="spring"||gZ(r))&&n}function mR(e){e.duration=0,e.type}const ame=new Set(["opacity","clipPath","filter","transform"]),lme=Hj(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function cme(e){const{motionValue:t,name:r,repeatDelay:n,repeatType:l,damping:h,type:f}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=t.owner.getProps();return lme()&&r&&ame.has(r)&&(r!=="transform"||!b)&&!v&&!n&&l!=="mirror"&&h!==0&&f!=="inertia"}const ume=40;class hme extends rN{constructor({autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:l=0,repeatDelay:h=0,repeatType:f="loop",keyframes:o,name:v,motionValue:b,element:E,...P}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Ba.now();const O={autoplay:t,delay:r,type:n,repeat:l,repeatDelay:h,repeatType:f,name:v,motionValue:b,element:E,...P},L=E?.KeyframeResolver||iN;this.keyframeResolver=new L(o,(B,z,$)=>this.onKeyframesResolved(B,z,O,!$),v,b,E),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,r,n,l){this.keyframeResolver=void 0;const{name:h,type:f,velocity:o,delay:v,isHandoff:b,onUpdate:E}=n;this.resolvedAt=Ba.now(),sme(t,h,f,o)||((Ph.instantAnimations||!v)&&E?.(tN(t,n,r)),t[0]=t[t.length-1],mR(n),n.repeat=0);const O={startTime:l?this.resolvedAt?this.resolvedAt-this.createdAt>ume?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...n,keyframes:t},L=!b&&cme(O)?new ime({...O,element:O.motionValue.owner.current}):new nN(O);L.finished.then(()=>this.notifyFinished()).catch(Nl),this.pendingTimeline&&(this.stopTimeline=L.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=L}get finished(){return this._animation?this.animation.finished:this._finished}then(t,r){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),qpe()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const dme=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function fme(e){const t=dme.exec(e);if(!t)return[,];const[,r,n,l]=t;return[`--${r??n}`,l]}function _Z(e,t,r=1){const[n,l]=fme(e);if(!n)return;const h=window.getComputedStyle(t).getPropertyValue(n);if(h){const f=h.trim();return F9(f)?parseFloat(f):f}return Kj(l)?_Z(l,t,r+1):l}function oN(e,t){return e?.[t]??e?.default??e}const vZ=new Set(["width","height","top","left","right","bottom",...sv]),pme={test:e=>e==="auto",parse:e=>e},xZ=e=>t=>t.test(e),bZ=[ov,bn,xu,jd,spe,ope,pme],Z$=e=>bZ.find(xZ(e));function mme(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||$9(e):!0}const gme=new Set(["brightness","contrast","saturate","opacity"]);function yme(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(Yj)||[];if(!n)return e;const l=r.replace(n,"");let h=gme.has(t)?1:0;return n!==r&&(h*=100),t+"("+h+l+")"}const _me=/\b([a-z-]*)\(.*?\)/gu,gR={...vf,getAnimatableNone:e=>{const t=e.match(_me);return t?t.map(yme).join(" "):e}},X$={...ov,transform:Math.round},vme={rotate:jd,rotateX:jd,rotateY:jd,rotateZ:jd,scale:RT,scaleX:RT,scaleY:RT,scaleZ:RT,skew:jd,skewX:jd,skewY:jd,distance:bn,translateX:bn,translateY:bn,translateZ:bn,x:bn,y:bn,z:bn,perspective:bn,transformPerspective:bn,opacity:Xb,originX:j$,originY:j$,originZ:bn},sN={borderWidth:bn,borderTopWidth:bn,borderRightWidth:bn,borderBottomWidth:bn,borderLeftWidth:bn,borderRadius:bn,radius:bn,borderTopLeftRadius:bn,borderTopRightRadius:bn,borderBottomRightRadius:bn,borderBottomLeftRadius:bn,width:bn,maxWidth:bn,height:bn,maxHeight:bn,top:bn,right:bn,bottom:bn,left:bn,padding:bn,paddingTop:bn,paddingRight:bn,paddingBottom:bn,paddingLeft:bn,margin:bn,marginTop:bn,marginRight:bn,marginBottom:bn,marginLeft:bn,backgroundPositionX:bn,backgroundPositionY:bn,...vme,zIndex:X$,fillOpacity:Xb,strokeOpacity:Xb,numOctaves:X$},xme={...sN,color:Go,backgroundColor:Go,outlineColor:Go,fill:Go,stroke:Go,borderColor:Go,borderTopColor:Go,borderRightColor:Go,borderBottomColor:Go,borderLeftColor:Go,filter:gR,WebkitFilter:gR},wZ=e=>xme[e];function SZ(e,t){let r=wZ(e);return r!==gR&&(r=vf),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const bme=new Set(["auto","none","0"]);function wme(e,t,r){let n=0,l;for(;n<e.length&&!l;){const h=e[n];typeof h=="string"&&!bme.has(h)&&Kb(h).values.length&&(l=e[n]),n++}if(l&&r)for(const h of t)e[h]=SZ(r,l)}class Sme extends iN{constructor(t,r,n,l,h){super(t,r,n,l,h,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let b=t[v];if(typeof b=="string"&&(b=b.trim(),Kj(b))){const E=_Z(b,r.current);E!==void 0&&(t[v]=E),v===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!vZ.has(n)||t.length!==2)return;const[l,h]=t,f=Z$(l),o=Z$(h);if(f!==o)if(G$(f)&&G$(o))for(let v=0;v<t.length;v++){const b=t[v];typeof b=="string"&&(t[v]=parseFloat(b))}else am[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,n=[];for(let l=0;l<t.length;l++)(t[l]===null||mme(t[l]))&&n.push(l);n.length&&wme(t,n,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=am[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const l=r[r.length-1];l!==void 0&&t.getValue(n,l).jump(l,!1)}measureEndState(){const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const l=t.getValue(r);l&&l.jump(this.measuredOrigin,!1);const h=n.length-1,f=n[h];n[h]=am[r](t.measureViewportBox(),window.getComputedStyle(t.current)),f!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=f),this.removedTransforms?.length&&this.removedTransforms.forEach(([o,v])=>{t.getValue(o).set(v)}),this.resolveNoneKeyframes()}}function Tme(e,t,r){if(e instanceof EventTarget)return[e];if(typeof e=="string"){let n=document;const l=r?.[e]??n.querySelectorAll(e);return l?Array.from(l):[]}return Array.from(e)}const TZ=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function EZ(e){return B9(e)&&"offsetHeight"in e}const K$=30,Eme=e=>!isNaN(parseFloat(e)),fb={current:void 0};class Ame{constructor(t,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{const l=Ba.now();if(this.updatedAt!==l&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const h of this.dependents)h.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=Ba.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=Eme(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new Wj);const n=this.events[t].add(r);return t==="change"?()=>{n(),ao.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return fb.current&&fb.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const t=Ba.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>K$)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,K$);return V9(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function _m(e,t){return new Ame(e,t)}const{schedule:aN}=Q9(queueMicrotask,!1),lc={x:!1,y:!1};function AZ(){return lc.x||lc.y}function Pme(e){return e==="x"||e==="y"?lc[e]?null:(lc[e]=!0,()=>{lc[e]=!1}):lc.x||lc.y?null:(lc.x=lc.y=!0,()=>{lc.x=lc.y=!1})}function PZ(e,t){const r=Tme(e),n=new AbortController,l={passive:!0,...t,signal:n.signal};return[r,l,()=>n.abort()]}function Y$(e){return!(e.pointerType==="touch"||AZ())}function Cme(e,t,r={}){const[n,l,h]=PZ(e,r),f=o=>{if(!Y$(o))return;const{target:v}=o,b=t(v,o);if(typeof b!="function"||!v)return;const E=P=>{Y$(P)&&(b(P),v.removeEventListener("pointerleave",E))};v.addEventListener("pointerleave",E,l)};return n.forEach(o=>{o.addEventListener("pointerenter",f,l)}),h}const CZ=(e,t)=>t?e===t?!0:CZ(e,t.parentElement):!1,lN=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Ime=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Mme(e){return Ime.has(e.tagName)||e.tabIndex!==-1}const bE=new WeakSet;function J$(e){return t=>{t.key==="Enter"&&e(t)}}function HM(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Ome=(e,t)=>{const r=e.currentTarget;if(!r)return;const n=J$(()=>{if(bE.has(r))return;HM(r,"down");const l=J$(()=>{HM(r,"up")}),h=()=>HM(r,"cancel");r.addEventListener("keyup",l,t),r.addEventListener("blur",h,t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function Q$(e){return lN(e)&&!AZ()}function kme(e,t,r={}){const[n,l,h]=PZ(e,r),f=o=>{const v=o.currentTarget;if(!Q$(o))return;bE.add(v);const b=t(v,o),E=(L,B)=>{window.removeEventListener("pointerup",P),window.removeEventListener("pointercancel",O),bE.has(v)&&bE.delete(v),Q$(L)&&typeof b=="function"&&b(L,{success:B})},P=L=>{E(L,v===window||v===document||r.useGlobalTarget||CZ(v,L.target))},O=L=>{E(L,!1)};window.addEventListener("pointerup",P,l),window.addEventListener("pointercancel",O,l)};return n.forEach(o=>{(r.useGlobalTarget?window:o).addEventListener("pointerdown",f,l),EZ(o)&&(o.addEventListener("focus",b=>Ome(b,l)),!Mme(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),h}function IZ(e){return B9(e)&&"ownerSVGElement"in e}function Rme(e){return IZ(e)&&e.tagName==="svg"}function Dme(...e){const t=!Array.isArray(e[0]),r=t?0:-1,n=e[0+r],l=e[1+r],h=e[2+r],f=e[3+r],o=uZ(l,h,f);return t?o(n):o}const Ys=e=>!!(e&&e.getVelocity),Lme=[...bZ,Go,vf],jme=e=>Lme.find(xZ(e)),ZA=K.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Nme extends K.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=r.offsetParent,l=EZ(n)&&n.offsetWidth||0,h=this.props.sizeRef.current;h.height=r.offsetHeight||0,h.width=r.offsetWidth||0,h.top=r.offsetTop,h.left=r.offsetLeft,h.right=l-h.width-h.left}return null}componentDidUpdate(){}render(){return this.props.children}}function zme({children:e,isPresent:t,anchorX:r,root:n}){const l=K.useId(),h=K.useRef(null),f=K.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=K.useContext(ZA);return K.useInsertionEffect(()=>{const{width:v,height:b,top:E,left:P,right:O}=f.current;if(t||!h.current||!v||!b)return;const L=r==="left"?`left: ${P}`:`right: ${O}`;h.current.dataset.motionPopId=l;const B=document.createElement("style");o&&(B.nonce=o);const z=n??document.head;return z.appendChild(B),B.sheet&&B.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${v}px !important;
            height: ${b}px !important;
            ${L}px !important;
            top: ${E}px !important;
          }
        `),()=>{z.contains(B)&&z.removeChild(B)}},[t]),M.jsx(Nme,{isPresent:t,childRef:h,sizeRef:f,children:K.cloneElement(e,{ref:h})})}const Fme=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:l,presenceAffectsLayout:h,mode:f,anchorX:o,root:v})=>{const b=Ww(Bme),E=K.useId();let P=!0,O=K.useMemo(()=>(P=!1,{id:E,initial:t,isPresent:r,custom:l,onExitComplete:L=>{b.set(L,!0);for(const B of b.values())if(!B)return;n&&n()},register:L=>(b.set(L,!1),()=>b.delete(L))}),[r,b,n]);return h&&P&&(O={...O}),K.useMemo(()=>{b.forEach((L,B)=>b.set(B,!1))},[r]),K.useEffect(()=>{!r&&!b.size&&n&&n()},[r]),f==="popLayout"&&(e=M.jsx(zme,{isPresent:r,anchorX:o,root:v,children:e})),M.jsx(qA.Provider,{value:O,children:e})};function Bme(){return new Map}function MZ(e=!0){const t=K.useContext(qA);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:l}=t,h=K.useId();K.useEffect(()=>{if(e)return l(h)},[e]);const f=K.useCallback(()=>e&&n&&n(h),[h,n,e]);return!r&&n?[!1,f]:[!0]}const DT=e=>e.key||"";function eV(e){const t=[];return K.Children.forEach(e,r=>{K.isValidElement(r)&&t.push(r)}),t}const Pc=({children:e,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:l=!0,mode:h="sync",propagate:f=!1,anchorX:o="left",root:v})=>{const[b,E]=MZ(f),P=K.useMemo(()=>eV(e),[e]),O=f&&!b?[]:P.map(DT),L=K.useRef(!0),B=K.useRef(P),z=Ww(()=>new Map),[$,U]=K.useState(P),[G,Z]=K.useState(P);$j(()=>{L.current=!1,B.current=P;for(let ee=0;ee<G.length;ee++){const le=DT(G[ee]);O.includes(le)?z.delete(le):z.get(le)!==!0&&z.set(le,!1)}},[G,O.length,O.join("-")]);const ne=[];if(P!==$){let ee=[...P];for(let le=0;le<G.length;le++){const fe=G[le],Ce=DT(fe);O.includes(Ce)||(ee.splice(le,0,fe),ne.push(fe))}return h==="wait"&&ne.length&&(ee=ne),Z(eV(ee)),U(P),null}const{forceRender:Y}=K.useContext(Fj);return M.jsx(M.Fragment,{children:G.map(ee=>{const le=DT(ee),fe=f&&!b?!1:P===G||O.includes(le),Ce=()=>{if(z.has(le))z.set(le,!0);else return;let Oe=!0;z.forEach(Me=>{Me||(Oe=!1)}),Oe&&(Y?.(),Z(B.current),f&&E?.(),n&&n())};return M.jsx(Fme,{isPresent:fe,initial:!L.current||r?void 0:!1,custom:t,presenceAffectsLayout:l,mode:h,root:v,onExitComplete:fe?void 0:Ce,anchorX:o,children:ee},le)})})},OZ=K.createContext({strict:!1}),tV={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},w_={};for(const e in tV)w_[e]={isEnabled:t=>tV[e].some(r=>!!t[r])};function $me(e){for(const t in e)w_[t]={...w_[t],...e[t]}}const Vme=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function l2(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Vme.has(e)}let kZ=e=>!l2(e);function Ume(e){typeof e=="function"&&(kZ=t=>t.startsWith("on")?!l2(t):e(t))}try{Ume(require("@emotion/is-prop-valid").default)}catch{}function Gme(e,t,r){const n={};for(const l in e)l==="values"&&typeof e.values=="object"||(kZ(l)||r===!0&&l2(l)||!t&&!l2(l)||e.draggable&&l.startsWith("onDrag"))&&(n[l]=e[l]);return n}const XA=K.createContext({});function KA(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function Yb(e){return typeof e=="string"||Array.isArray(e)}const cN=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],uN=["initial",...cN];function YA(e){return KA(e.animate)||uN.some(t=>Yb(e[t]))}function RZ(e){return!!(YA(e)||e.variants)}function Hme(e,t){if(YA(e)){const{initial:r,animate:n}=e;return{initial:r===!1||Yb(r)?r:void 0,animate:Yb(n)?n:void 0}}return e.inherit!==!1?t:{}}function Wme(e){const{initial:t,animate:r}=Hme(e,K.useContext(XA));return K.useMemo(()=>({initial:t,animate:r}),[rV(t),rV(r)])}function rV(e){return Array.isArray(e)?e.join(" "):e}const Jb={};function qme(e){for(const t in e)Jb[t]=e[t],Xj(t)&&(Jb[t].isCSSVariable=!0)}function DZ(e,{layout:t,layoutId:r}){return av.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!Jb[e]||e==="opacity")}const Zme={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Xme=sv.length;function Kme(e,t,r){let n="",l=!0;for(let h=0;h<Xme;h++){const f=sv[h],o=e[f];if(o===void 0)continue;let v=!0;if(typeof o=="number"?v=o===(f.startsWith("scale")?1:0):v=parseFloat(o)===0,!v||r){const b=TZ(o,sN[f]);if(!v){l=!1;const E=Zme[f]||f;n+=`${E}(${b}) `}r&&(t[f]=b)}}return n=n.trim(),r?n=r(t,l?"":n):l&&(n="none"),n}function hN(e,t,r){const{style:n,vars:l,transformOrigin:h}=e;let f=!1,o=!1;for(const v in t){const b=t[v];if(av.has(v)){f=!0;continue}else if(Xj(v)){l[v]=b;continue}else{const E=TZ(b,sN[v]);v.startsWith("origin")?(o=!0,h[v]=E):n[v]=E}}if(t.transform||(f||r?n.transform=Kme(t,e.transform,r):n.transform&&(n.transform="none")),o){const{originX:v="50%",originY:b="50%",originZ:E=0}=h;n.transformOrigin=`${v} ${b} ${E}`}}const dN=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function LZ(e,t,r){for(const n in t)!Ys(t[n])&&!DZ(n,r)&&(e[n]=t[n])}function Yme({transformTemplate:e},t){return K.useMemo(()=>{const r=dN();return hN(r,t,e),Object.assign({},r.vars,r.style)},[t])}function Jme(e,t){const r=e.style||{},n={};return LZ(n,r,e),Object.assign(n,Yme(e,t)),n}function Qme(e,t){const r={},n=Jme(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const ege={offset:"stroke-dashoffset",array:"stroke-dasharray"},tge={offset:"strokeDashoffset",array:"strokeDasharray"};function rge(e,t,r=1,n=0,l=!0){e.pathLength=1;const h=l?ege:tge;e[h.offset]=bn.transform(-n);const f=bn.transform(t),o=bn.transform(r);e[h.array]=`${f} ${o}`}function jZ(e,{attrX:t,attrY:r,attrScale:n,pathLength:l,pathSpacing:h=1,pathOffset:f=0,...o},v,b,E){if(hN(e,o,b),v){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:P,style:O}=e;P.transform&&(O.transform=P.transform,delete P.transform),(O.transform||P.transformOrigin)&&(O.transformOrigin=P.transformOrigin??"50% 50%",delete P.transformOrigin),O.transform&&(O.transformBox=E?.transformBox??"fill-box",delete P.transformBox),t!==void 0&&(P.x=t),r!==void 0&&(P.y=r),n!==void 0&&(P.scale=n),l!==void 0&&rge(P,l,h,f,!1)}const NZ=()=>({...dN(),attrs:{}}),zZ=e=>typeof e=="string"&&e.toLowerCase()==="svg";function nge(e,t,r,n){const l=K.useMemo(()=>{const h=NZ();return jZ(h,t,zZ(n),e.transformTemplate,e.style),{...h.attrs,style:{...h.style}}},[t]);if(e.style){const h={};LZ(h,e.style,e),l.style={...h,...l.style}}return l}const ige=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function fN(e){return typeof e!="string"||e.includes("-")?!1:!!(ige.indexOf(e)>-1||/[A-Z]/u.test(e))}function oge(e,t,r,{latestValues:n},l,h=!1){const o=(fN(e)?nge:Qme)(t,n,l,e),v=Gme(t,typeof e=="string",h),b=e!==K.Fragment?{...v,...o,ref:r}:{},{children:E}=t,P=K.useMemo(()=>Ys(E)?E.get():E,[E]);return K.createElement(e,{...b,children:P})}function nV(e){const t=[{},{}];return e?.values.forEach((r,n)=>{t[0][n]=r.get(),t[1][n]=r.getVelocity()}),t}function pN(e,t,r,n){if(typeof t=="function"){const[l,h]=nV(n);t=t(r!==void 0?r:e.custom,l,h)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[l,h]=nV(n);t=t(r!==void 0?r:e.custom,l,h)}return t}function wE(e){return Ys(e)?e.get():e}function sge({scrapeMotionValuesFromProps:e,createRenderState:t},r,n,l){return{latestValues:age(r,n,l,e),renderState:t()}}function age(e,t,r,n){const l={},h=n(e,{});for(const O in h)l[O]=wE(h[O]);let{initial:f,animate:o}=e;const v=YA(e),b=RZ(e);t&&b&&!v&&e.inherit!==!1&&(f===void 0&&(f=t.initial),o===void 0&&(o=t.animate));let E=r?r.initial===!1:!1;E=E||f===!1;const P=E?o:f;if(P&&typeof P!="boolean"&&!KA(P)){const O=Array.isArray(P)?P:[P];for(let L=0;L<O.length;L++){const B=pN(e,O[L]);if(B){const{transitionEnd:z,transition:$,...U}=B;for(const G in U){let Z=U[G];if(Array.isArray(Z)){const ne=E?Z.length-1:0;Z=Z[ne]}Z!==null&&(l[G]=Z)}for(const G in z)l[G]=z[G]}}}return l}const FZ=e=>(t,r)=>{const n=K.useContext(XA),l=K.useContext(qA),h=()=>sge(e,t,n,l);return r?h():Ww(h)};function mN(e,t,r){const{style:n}=e,l={};for(const h in n)(Ys(n[h])||t.style&&Ys(t.style[h])||DZ(h,e)||r?.getValue(h)?.liveStyle!==void 0)&&(l[h]=n[h]);return l}const lge=FZ({scrapeMotionValuesFromProps:mN,createRenderState:dN});function BZ(e,t,r){const n=mN(e,t,r);for(const l in e)if(Ys(e[l])||Ys(t[l])){const h=sv.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;n[h]=e[l]}return n}const cge=FZ({scrapeMotionValuesFromProps:BZ,createRenderState:NZ}),uge=Symbol.for("motionComponentSymbol");function Oy(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function hge(e,t,r){return K.useCallback(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):Oy(r)&&(r.current=n))},[t])}const gN=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),dge="framerAppearId",$Z="data-"+gN(dge),VZ=K.createContext({});function fge(e,t,r,n,l){const{visualElement:h}=K.useContext(XA),f=K.useContext(OZ),o=K.useContext(qA),v=K.useContext(ZA).reducedMotion,b=K.useRef(null);n=n||f.renderer,!b.current&&n&&(b.current=n(e,{visualState:t,parent:h,props:r,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:v}));const E=b.current,P=K.useContext(VZ);E&&!E.projection&&l&&(E.type==="html"||E.type==="svg")&&pge(b.current,r,l,P);const O=K.useRef(!1);K.useInsertionEffect(()=>{E&&O.current&&E.update(r,o)});const L=r[$Z],B=K.useRef(!!L&&!window.MotionHandoffIsComplete?.(L)&&window.MotionHasOptimisedAnimation?.(L));return $j(()=>{E&&(O.current=!0,window.MotionIsMounted=!0,E.updateFeatures(),E.scheduleRenderMicrotask(),B.current&&E.animationState&&E.animationState.animateChanges())}),K.useEffect(()=>{E&&(!B.current&&E.animationState&&E.animationState.animateChanges(),B.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(L)}),B.current=!1),E.enteringChildren=void 0)}),E}function pge(e,t,r,n){const{layoutId:l,layout:h,drag:f,dragConstraints:o,layoutScroll:v,layoutRoot:b,layoutCrossfade:E}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:UZ(e.parent)),e.projection.setOptions({layoutId:l,layout:h,alwaysMeasureLayout:!!f||o&&Oy(o),visualElement:e,animationType:typeof h=="string"?h:"both",initialPromotionConfig:n,crossfade:E,layoutScroll:v,layoutRoot:b})}function UZ(e){if(e)return e.options.allowProjection!==!1?e.projection:UZ(e.parent)}function WM(e,{forwardMotionProps:t=!1}={},r,n){r&&$me(r);const l=fN(e)?cge:lge;function h(o,v){let b;const E={...K.useContext(ZA),...o,layoutId:mge(o)},{isStatic:P}=E,O=Wme(o),L=l(o,P);if(!P&&Bj){gge();const B=yge(E);b=B.MeasureLayout,O.visualElement=fge(e,L,E,n,B.ProjectionNode)}return M.jsxs(XA.Provider,{value:O,children:[b&&O.visualElement?M.jsx(b,{visualElement:O.visualElement,...E}):null,oge(e,o,hge(L,O.visualElement,v),L,P,t)]})}h.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const f=K.forwardRef(h);return f[uge]=e,f}function mge({layoutId:e}){const t=K.useContext(Fj).id;return t&&e!==void 0?t+"-"+e:e}function gge(e,t){K.useContext(OZ).strict}function yge(e){const{drag:t,layout:r}=w_;if(!t&&!r)return{};const n={...t,...r};return{MeasureLayout:t?.isEnabled(e)||r?.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function _ge(e,t){if(typeof Proxy>"u")return WM;const r=new Map,n=(h,f)=>WM(h,f,e,t),l=(h,f)=>n(h,f);return new Proxy(l,{get:(h,f)=>f==="create"?n:(r.has(f)||r.set(f,WM(f,void 0,e,t)),r.get(f))})}function GZ({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function vge({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function xge(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function qM(e){return e===void 0||e===1}function yR({scale:e,scaleX:t,scaleY:r}){return!qM(e)||!qM(t)||!qM(r)}function jp(e){return yR(e)||HZ(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function HZ(e){return iV(e.x)||iV(e.y)}function iV(e){return e&&e!=="0%"}function c2(e,t,r){const n=e-r,l=t*n;return r+l}function oV(e,t,r,n,l){return l!==void 0&&(e=c2(e,l,n)),c2(e,r,n)+t}function _R(e,t=0,r=1,n,l){e.min=oV(e.min,t,r,n,l),e.max=oV(e.max,t,r,n,l)}function WZ(e,{x:t,y:r}){_R(e.x,t.translate,t.scale,t.originPoint),_R(e.y,r.translate,r.scale,r.originPoint)}const sV=.999999999999,aV=1.0000000000001;function bge(e,t,r,n=!1){const l=r.length;if(!l)return;t.x=t.y=1;let h,f;for(let o=0;o<l;o++){h=r[o],f=h.projectionDelta;const{visualElement:v}=h.options;v&&v.props.style&&v.props.style.display==="contents"||(n&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Ry(e,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,WZ(e,f)),n&&jp(h.latestValues)&&Ry(e,h.latestValues))}t.x<aV&&t.x>sV&&(t.x=1),t.y<aV&&t.y>sV&&(t.y=1)}function ky(e,t){e.min=e.min+t,e.max=e.max+t}function lV(e,t,r,n,l=.5){const h=go(e.min,e.max,l);_R(e,t,r,h,n)}function Ry(e,t){lV(e.x,t.x,t.scaleX,t.scale,t.originX),lV(e.y,t.y,t.scaleY,t.scale,t.originY)}function qZ(e,t){return GZ(xge(e.getBoundingClientRect(),t))}function wge(e,t,r){const n=qZ(e,r),{scroll:l}=t;return l&&(ky(n.x,l.offset.x),ky(n.y,l.offset.y)),n}const cV=()=>({translate:0,scale:1,origin:0,originPoint:0}),Dy=()=>({x:cV(),y:cV()}),uV=()=>({min:0,max:0}),Ro=()=>({x:uV(),y:uV()}),vR={current:null},ZZ={current:!1};function Sge(){if(ZZ.current=!0,!!Bj)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>vR.current=e.matches;e.addEventListener("change",t),t()}else vR.current=!1}const Tge=new WeakMap;function Ege(e,t,r){for(const n in t){const l=t[n],h=r[n];if(Ys(l))e.addValue(n,l);else if(Ys(h))e.addValue(n,_m(l,{owner:e}));else if(h!==l)if(e.hasValue(n)){const f=e.getValue(n);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=e.getStaticValue(n);e.addValue(n,_m(f!==void 0?f:l,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const hV=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Age{scrapeMotionValuesFromProps(t,r,n){return{}}constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:l,blockInitialAnimation:h,visualState:f},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=iN,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const O=Ba.now();this.renderScheduledAt<O&&(this.renderScheduledAt=O,ao.render(this.render,!1,!0))};const{latestValues:v,renderState:b}=f;this.latestValues=v,this.baseTarget={...v},this.initialValues=r.initial?{...v}:{},this.renderState=b,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=o,this.blockInitialAnimation=!!h,this.isControllingVariants=YA(r),this.isVariantNode=RZ(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:E,...P}=this.scrapeMotionValuesFromProps(r,{},this);for(const O in P){const L=P[O];v[O]!==void 0&&Ys(L)&&L.set(v[O])}}mount(t){this.current=t,Tge.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),ZZ.current||Sge(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:vR.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Ch(this.notifyUpdate),Ch(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const r=this.features[t];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=av.has(t);n&&this.onBindTransform&&this.onBindTransform();const l=r.on("change",f=>{this.latestValues[t]=f,this.props.onUpdate&&ao.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let h;window.MotionCheckAppearSync&&(h=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{l(),h&&h(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in w_){const r=w_[t];if(!r)continue;const{isEnabled:n,Feature:l}=r;if(!this.features[t]&&l&&n(this.props)&&(this.features[t]=new l(this)),this.features[t]){const h=this.features[t];h.isMounted?h.update():(h.mount(),h.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ro()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<hV.length;n++){const l=hV[n];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const h="on"+l,f=t[h];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=Ege(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const n=this.values.get(t);r!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=_m(r===null?void 0:r,{owner:this}),this.addValue(t,n)),n}readValue(t,r){let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(F9(n)||$9(n))?n=parseFloat(n):!jme(n)&&vf.test(r)&&(n=SZ(t,r)),this.setBaseTarget(t,Ys(n)?n.get():n)),Ys(n)?n.get():n}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const h=pN(this.props,r,this.presenceContext?.custom);h&&(n=h[t])}if(r&&n!==void 0)return n;const l=this.getBaseTargetFromProps(this.props,t);return l!==void 0&&!Ys(l)?l:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new Wj),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}scheduleRenderMicrotask(){aN.render(this.render)}}class XZ extends Age{constructor(){super(...arguments),this.KeyframeResolver=Sme}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Ys(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function KZ(e,{style:t,vars:r},n,l){const h=e.style;let f;for(f in t)h[f]=t[f];l?.applyProjectionStyles(h,n);for(f in r)h.setProperty(f,r[f])}function Pge(e){return window.getComputedStyle(e)}class Cge extends XZ{constructor(){super(...arguments),this.type="html",this.renderInstance=KZ}readValueFromInstance(t,r){if(av.has(r))return this.projection?.isProjecting?uR(r):Vpe(t,r);{const n=Pge(t),l=(Xj(r)?n.getPropertyValue(r):n[r])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:r}){return qZ(t,r)}build(t,r,n){hN(t,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,r,n){return mN(t,r,n)}}const YZ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Ige(e,t,r,n){KZ(e,t,void 0,n);for(const l in t.attrs)e.setAttribute(YZ.has(l)?l:gN(l),t.attrs[l])}class Mge extends XZ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ro}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(av.has(r)){const n=wZ(r);return n&&n.default||0}return r=YZ.has(r)?r:gN(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,n){return BZ(t,r,n)}build(t,r,n){jZ(t,r,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(t,r,n,l){Ige(t,r,n,l)}mount(t){this.isSVGTag=zZ(t.tagName),super.mount(t)}}const Oge=(e,t)=>fN(e)?new Mge(t):new Cge(t,{allowProjection:e!==K.Fragment});function Xy(e,t,r){const n=e.getProps();return pN(n,t,r!==void 0?r:n.custom,e)}const xR=e=>Array.isArray(e);function kge(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,_m(r))}function Rge(e){return xR(e)?e[e.length-1]||0:e}function Dge(e,t){const r=Xy(e,t);let{transitionEnd:n={},transition:l={},...h}=r||{};h={...h,...n};for(const f in h){const o=Rge(h[f]);kge(e,f,o)}}function Lge(e){return!!(Ys(e)&&e.add)}function bR(e,t){const r=e.getValue("willChange");if(Lge(r))return r.add(t);if(!r&&Ph.WillChange){const n=new Ph.WillChange("auto");e.addValue("willChange",n),n.add(t)}}function JZ(e){return e.props[$Z]}const jge=e=>e!==null;function Nge(e,{repeat:t,repeatType:r="loop"},n){const l=e.filter(jge),h=t&&r!=="loop"&&t%2===1?0:l.length-1;return l[h]}const zge={type:"spring",stiffness:500,damping:25,restSpeed:10},Fge=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Bge={type:"keyframes",duration:.8},$ge={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Vge=(e,{keyframes:t})=>t.length>2?Bge:av.has(e)?e.startsWith("scale")?Fge(t[1]):zge:$ge;function Uge({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:l,repeat:h,repeatType:f,repeatDelay:o,from:v,elapsed:b,...E}){return!!Object.keys(E).length}const yN=(e,t,r,n={},l,h)=>f=>{const o=oN(n,e)||{},v=o.delay||n.delay||0;let{elapsed:b=0}=n;b=b-_u(v);const E={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-b,onUpdate:O=>{t.set(O),o.onUpdate&&o.onUpdate(O)},onComplete:()=>{f(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:h?void 0:l};Uge(o)||Object.assign(E,Vge(e,E)),E.duration&&(E.duration=_u(E.duration)),E.repeatDelay&&(E.repeatDelay=_u(E.repeatDelay)),E.from!==void 0&&(E.keyframes[0]=E.from);let P=!1;if((E.type===!1||E.duration===0&&!E.repeatDelay)&&(mR(E),E.delay===0&&(P=!0)),(Ph.instantAnimations||Ph.skipAnimations)&&(P=!0,mR(E),E.delay=0),E.allowFlatten=!o.type&&!o.ease,P&&!h&&t.get()!==void 0){const O=Nge(E.keyframes,o);if(O!==void 0){ao.update(()=>{E.onUpdate(O),E.onComplete()});return}}return o.isSync?new nN(E):new hme(E)};function Gge({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function QZ(e,t,{delay:r=0,transitionOverride:n,type:l}={}){let{transition:h=e.getDefaultTransition(),transitionEnd:f,...o}=t;n&&(h=n);const v=[],b=l&&e.animationState&&e.animationState.getState()[l];for(const E in o){const P=e.getValue(E,e.latestValues[E]??null),O=o[E];if(O===void 0||b&&Gge(b,E))continue;const L={delay:r,...oN(h||{},E)},B=P.get();if(B!==void 0&&!P.isAnimating&&!Array.isArray(O)&&O===B&&!L.velocity)continue;let z=!1;if(window.MotionHandoffAnimation){const U=JZ(e);if(U){const G=window.MotionHandoffAnimation(U,E,ao);G!==null&&(L.startTime=G,z=!0)}}bR(e,E),P.start(yN(E,P,O,e.shouldReduceMotion&&vZ.has(E)?{type:!1}:L,e,z));const $=P.animation;$&&v.push($)}return f&&Promise.all(v).then(()=>{ao.update(()=>{f&&Dge(e,f)})}),v}function eX(e,t,r,n=0,l=1){const h=Array.from(e).sort((b,E)=>b.sortNodePosition(E)).indexOf(t),f=e.size,o=(f-1)*n;return typeof r=="function"?r(h,f):l===1?h*n:o-h*n}function wR(e,t,r={}){const n=Xy(e,t,r.type==="exit"?e.presenceContext?.custom:void 0);let{transition:l=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(l=r.transitionOverride);const h=n?()=>Promise.all(QZ(e,n,r)):()=>Promise.resolve(),f=e.variantChildren&&e.variantChildren.size?(v=0)=>{const{delayChildren:b=0,staggerChildren:E,staggerDirection:P}=l;return Hge(e,t,v,b,E,P,r)}:()=>Promise.resolve(),{when:o}=l;if(o){const[v,b]=o==="beforeChildren"?[h,f]:[f,h];return v().then(()=>b())}else return Promise.all([h(),f(r.delay)])}function Hge(e,t,r=0,n=0,l=0,h=1,f){const o=[];for(const v of e.variantChildren)v.notify("AnimationStart",t),o.push(wR(v,t,{...f,delay:r+(typeof n=="function"?0:n)+eX(e.variantChildren,v,n,l,h)}).then(()=>v.notify("AnimationComplete",t)));return Promise.all(o)}function Wge(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const l=t.map(h=>wR(e,h,r));n=Promise.all(l)}else if(typeof t=="string")n=wR(e,t,r);else{const l=typeof t=="function"?Xy(e,t,r.custom):t;n=Promise.all(QZ(e,l,r))}return n.then(()=>{e.notify("AnimationComplete",t)})}function tX(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}const qge=uN.length;function rX(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?rX(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<qge;r++){const n=uN[r],l=e.props[n];(Yb(l)||l===!1)&&(t[n]=l)}return t}const Zge=[...cN].reverse(),Xge=cN.length;function Kge(e){return t=>Promise.all(t.map(({animation:r,options:n})=>Wge(e,r,n)))}function Yge(e){let t=Kge(e),r=dV(),n=!0;const l=v=>(b,E)=>{const P=Xy(e,E,v==="exit"?e.presenceContext?.custom:void 0);if(P){const{transition:O,transitionEnd:L,...B}=P;b={...b,...B,...L}}return b};function h(v){t=v(e)}function f(v){const{props:b}=e,E=rX(e.parent)||{},P=[],O=new Set;let L={},B=1/0;for(let $=0;$<Xge;$++){const U=Zge[$],G=r[U],Z=b[U]!==void 0?b[U]:E[U],ne=Yb(Z),Y=U===v?G.isActive:null;Y===!1&&(B=$);let ee=Z===E[U]&&Z!==b[U]&&ne;if(ee&&n&&e.manuallyAnimateOnMount&&(ee=!1),G.protectedKeys={...L},!G.isActive&&Y===null||!Z&&!G.prevProp||KA(Z)||typeof Z=="boolean")continue;const le=Jge(G.prevProp,Z);let fe=le||U===v&&G.isActive&&!ee&&ne||$>B&&ne,Ce=!1;const Oe=Array.isArray(Z)?Z:[Z];let Me=Oe.reduce(l(U),{});Y===!1&&(Me={});const{prevResolvedValues:Ke={}}=G,Ye={...Ke,...Me},Le=it=>{fe=!0,O.has(it)&&(Ce=!0,O.delete(it)),G.needsAnimating[it]=!0;const Ze=e.getValue(it);Ze&&(Ze.liveStyle=!1)};for(const it in Ye){const Ze=Me[it],nt=Ke[it];if(L.hasOwnProperty(it))continue;let pt=!1;xR(Ze)&&xR(nt)?pt=!tX(Ze,nt):pt=Ze!==nt,pt?Ze!=null?Le(it):O.add(it):Ze!==void 0&&O.has(it)?Le(it):G.protectedKeys[it]=!0}G.prevProp=Z,G.prevResolvedValues=Me,G.isActive&&(L={...L,...Me}),n&&e.blockInitialAnimation&&(fe=!1);const Qe=ee&&le;fe&&(!Qe||Ce)&&P.push(...Oe.map(it=>{const Ze={type:U};if(typeof it=="string"&&n&&!Qe&&e.manuallyAnimateOnMount&&e.parent){const{parent:nt}=e,pt=Xy(nt,it);if(nt.enteringChildren&&pt){const{delayChildren:_t}=pt.transition||{};Ze.delay=eX(nt.enteringChildren,e,_t)}}return{animation:it,options:Ze}}))}if(O.size){const $={};if(typeof b.initial!="boolean"){const U=Xy(e,Array.isArray(b.initial)?b.initial[0]:b.initial);U&&U.transition&&($.transition=U.transition)}O.forEach(U=>{const G=e.getBaseTarget(U),Z=e.getValue(U);Z&&(Z.liveStyle=!0),$[U]=G??null}),P.push({animation:$})}let z=!!P.length;return n&&(b.initial===!1||b.initial===b.animate)&&!e.manuallyAnimateOnMount&&(z=!1),n=!1,z?t(P):Promise.resolve()}function o(v,b){if(r[v].isActive===b)return Promise.resolve();e.variantChildren?.forEach(P=>P.animationState?.setActive(v,b)),r[v].isActive=b;const E=f(v);for(const P in r)r[P].protectedKeys={};return E}return{animateChanges:f,setActive:o,setAnimateFunction:h,getState:()=>r,reset:()=>{r=dV(),n=!0}}}function Jge(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!tX(t,e):!1}function Cp(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function dV(){return{animate:Cp(!0),whileInView:Cp(),whileHover:Cp(),whileTap:Cp(),whileDrag:Cp(),whileFocus:Cp(),exit:Cp()}}class Sf{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Qge extends Sf{constructor(t){super(t),t.animationState||(t.animationState=Yge(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();KA(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let eye=0;class tye extends Sf{constructor(){super(...arguments),this.id=eye++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const l=this.node.animationState.setActive("exit",!t);r&&!t&&l.then(()=>{r(this.id)})}mount(){const{register:t,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const rye={animation:{Feature:Qge},exit:{Feature:tye}};function Qb(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function Kw(e){return{point:{x:e.pageX,y:e.pageY}}}const nye=e=>t=>lN(t)&&e(t,Kw(t));function pb(e,t,r,n){return Qb(e,t,nye(r),n)}const nX=1e-4,iye=1-nX,oye=1+nX,iX=.01,sye=0-iX,aye=0+iX;function ga(e){return e.max-e.min}function lye(e,t,r){return Math.abs(e-t)<=r}function fV(e,t,r,n=.5){e.origin=n,e.originPoint=go(t.min,t.max,e.origin),e.scale=ga(r)/ga(t),e.translate=go(r.min,r.max,e.origin)-e.originPoint,(e.scale>=iye&&e.scale<=oye||isNaN(e.scale))&&(e.scale=1),(e.translate>=sye&&e.translate<=aye||isNaN(e.translate))&&(e.translate=0)}function mb(e,t,r,n){fV(e.x,t.x,r.x,n?n.originX:void 0),fV(e.y,t.y,r.y,n?n.originY:void 0)}function pV(e,t,r){e.min=r.min+t.min,e.max=e.min+ga(t)}function cye(e,t,r){pV(e.x,t.x,r.x),pV(e.y,t.y,r.y)}function mV(e,t,r){e.min=t.min-r.min,e.max=e.min+ga(t)}function gb(e,t,r){mV(e.x,t.x,r.x),mV(e.y,t.y,r.y)}function Cl(e){return[e("x"),e("y")]}const oX=({current:e})=>e?e.ownerDocument.defaultView:null,gV=(e,t)=>Math.abs(e-t);function uye(e,t){const r=gV(e.x,t.x),n=gV(e.y,t.y);return Math.sqrt(r**2+n**2)}class sX{constructor(t,r,{transformPagePoint:n,contextWindow:l=window,dragSnapToOrigin:h=!1,distanceThreshold:f=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=XM(this.lastMoveEventInfo,this.history),L=this.startEvent!==null,B=uye(O.offset,{x:0,y:0})>=this.distanceThreshold;if(!L&&!B)return;const{point:z}=O,{timestamp:$}=Ds;this.history.push({...z,timestamp:$});const{onStart:U,onMove:G}=this.handlers;L||(U&&U(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),G&&G(this.lastMoveEvent,O)},this.handlePointerMove=(O,L)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=ZM(L,this.transformPagePoint),ao.update(this.updatePoint,!0)},this.handlePointerUp=(O,L)=>{this.end();const{onEnd:B,onSessionEnd:z,resumeAnimation:$}=this.handlers;if(this.dragSnapToOrigin&&$&&$(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const U=XM(O.type==="pointercancel"?this.lastMoveEventInfo:ZM(L,this.transformPagePoint),this.history);this.startEvent&&B&&B(O,U),z&&z(O,U)},!lN(t))return;this.dragSnapToOrigin=h,this.handlers=r,this.transformPagePoint=n,this.distanceThreshold=f,this.contextWindow=l||window;const o=Kw(t),v=ZM(o,this.transformPagePoint),{point:b}=v,{timestamp:E}=Ds;this.history=[{...b,timestamp:E}];const{onSessionStart:P}=r;P&&P(t,XM(v,this.history)),this.removeListeners=qw(pb(this.contextWindow,"pointermove",this.handlePointerMove),pb(this.contextWindow,"pointerup",this.handlePointerUp),pb(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Ch(this.updatePoint)}}function ZM(e,t){return t?{point:t(e.point)}:e}function yV(e,t){return{x:e.x-t.x,y:e.y-t.y}}function XM({point:e},t){return{point:e,delta:yV(e,aX(t)),offset:yV(e,hye(t)),velocity:dye(t,.1)}}function hye(e){return e[0]}function aX(e){return e[e.length-1]}function dye(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const l=aX(e);for(;r>=0&&(n=e[r],!(l.timestamp-n.timestamp>_u(t)));)r--;if(!n)return{x:0,y:0};const h=vu(l.timestamp-n.timestamp);if(h===0)return{x:0,y:0};const f={x:(l.x-n.x)/h,y:(l.y-n.y)/h};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function fye(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?go(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?go(r,e,n.max):Math.min(e,r)),e}function _V(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function pye(e,{top:t,left:r,bottom:n,right:l}){return{x:_V(e.x,r,l),y:_V(e.y,t,n)}}function vV(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function mye(e,t){return{x:vV(e.x,t.x),y:vV(e.y,t.y)}}function gye(e,t){let r=.5;const n=ga(e),l=ga(t);return l>n?r=Zb(t.min,t.max-n,e.min):n>l&&(r=Zb(e.min,e.max-l,t.min)),Ah(0,1,r)}function yye(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const SR=.35;function _ye(e=SR){return e===!1?e=0:e===!0&&(e=SR),{x:xV(e,"left","right"),y:xV(e,"top","bottom")}}function xV(e,t,r){return{min:bV(e,t),max:bV(e,r)}}function bV(e,t){return typeof e=="number"?e:e[t]||0}const vye=new WeakMap;class xye{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ro(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:r=!1,distanceThreshold:n}={}){const{presenceContext:l}=this.visualElement;if(l&&l.isPresent===!1)return;const h=P=>{const{dragSnapToOrigin:O}=this.getProps();O?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Kw(P).point)},f=(P,O)=>{const{drag:L,dragPropagation:B,onDragStart:z}=this.getProps();if(L&&!B&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Pme(L),!this.openDragLock))return;this.latestPointerEvent=P,this.latestPanInfo=O,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Cl(U=>{let G=this.getAxisMotionValue(U).get()||0;if(xu.test(G)){const{projection:Z}=this.visualElement;if(Z&&Z.layout){const ne=Z.layout.layoutBox[U];ne&&(G=ga(ne)*(parseFloat(G)/100))}}this.originPoint[U]=G}),z&&ao.postRender(()=>z(P,O)),bR(this.visualElement,"transform");const{animationState:$}=this.visualElement;$&&$.setActive("whileDrag",!0)},o=(P,O)=>{this.latestPointerEvent=P,this.latestPanInfo=O;const{dragPropagation:L,dragDirectionLock:B,onDirectionLock:z,onDrag:$}=this.getProps();if(!L&&!this.openDragLock)return;const{offset:U}=O;if(B&&this.currentDirection===null){this.currentDirection=bye(U),this.currentDirection!==null&&z&&z(this.currentDirection);return}this.updateAxis("x",O.point,U),this.updateAxis("y",O.point,U),this.visualElement.render(),$&&$(P,O)},v=(P,O)=>{this.latestPointerEvent=P,this.latestPanInfo=O,this.stop(P,O),this.latestPointerEvent=null,this.latestPanInfo=null},b=()=>Cl(P=>this.getAnimationState(P)==="paused"&&this.getAxisMotionValue(P).animation?.play()),{dragSnapToOrigin:E}=this.getProps();this.panSession=new sX(t,{onSessionStart:h,onStart:f,onMove:o,onSessionEnd:v,resumeAnimation:b},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:E,distanceThreshold:n,contextWindow:oX(this.visualElement)})}stop(t,r){const n=t||this.latestPointerEvent,l=r||this.latestPanInfo,h=this.isDragging;if(this.cancel(),!h||!l||!n)return;const{velocity:f}=l;this.startAnimation(f);const{onDragEnd:o}=this.getProps();o&&ao.postRender(()=>o(n,l))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:l}=this.getProps();if(!n||!LT(t,l,this.currentDirection))return;const h=this.getAxisMotionValue(t);let f=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(f=fye(f,this.constraints[t],this.elastic[t])),h.set(f)}resolveConstraints(){const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,l=this.constraints;t&&Oy(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=pye(n.layoutBox,t):this.constraints=!1,this.elastic=_ye(r),l!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Cl(h=>{this.constraints!==!1&&this.getAxisMotionValue(h)&&(this.constraints[h]=yye(n.layoutBox[h],this.constraints[h]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Oy(t))return!1;const n=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const h=wge(n,l.root,this.visualElement.getTransformPagePoint());let f=mye(l.layout.layoutBox,h);if(r){const o=r(vge(f));this.hasMutatedConstraints=!!o,o&&(f=GZ(o))}return f}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:l,dragTransition:h,dragSnapToOrigin:f,onDragTransitionEnd:o}=this.getProps(),v=this.constraints||{},b=Cl(E=>{if(!LT(E,r,this.currentDirection))return;let P=v&&v[E]||{};f&&(P={min:0,max:0});const O=l?200:1e6,L=l?40:1e7,B={type:"inertia",velocity:n?t[E]:0,bounceStiffness:O,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...h,...P};return this.startAxisValueAnimation(E,B)});return Promise.all(b).then(o)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return bR(this.visualElement,t),n.start(yN(t,n,0,r,this.visualElement,!1))}stopAnimation(){Cl(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Cl(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps(),l=n[r];return l||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){Cl(r=>{const{drag:n}=this.getProps();if(!LT(r,n,this.currentDirection))return;const{projection:l}=this.visualElement,h=this.getAxisMotionValue(r);if(l&&l.layout){const{min:f,max:o}=l.layout.layoutBox[r];h.set(t[r]-go(f,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!Oy(r)||!n||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Cl(f=>{const o=this.getAxisMotionValue(f);if(o&&this.constraints!==!1){const v=o.get();l[f]=gye({min:v,max:v},this.constraints[f])}});const{transformTemplate:h}=this.visualElement.getProps();this.visualElement.current.style.transform=h?h({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Cl(f=>{if(!LT(f,t,null))return;const o=this.getAxisMotionValue(f),{min:v,max:b}=this.constraints[f];o.set(go(v,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;vye.set(this.visualElement,this);const t=this.visualElement.current,r=pb(t,"pointerdown",v=>{const{drag:b,dragListener:E=!0}=this.getProps();b&&E&&this.start(v)}),n=()=>{const{dragConstraints:v}=this.getProps();Oy(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,h=l.addEventListener("measure",n);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),ao.read(n);const f=Qb(window,"resize",()=>this.scalePositionWithinConstraints()),o=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(Cl(E=>{const P=this.getAxisMotionValue(E);P&&(this.originPoint[E]+=v[E].translate,P.set(P.get()+v[E].translate))}),this.visualElement.render())});return()=>{f(),r(),h(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:l=!1,dragConstraints:h=!1,dragElastic:f=SR,dragMomentum:o=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:l,dragConstraints:h,dragElastic:f,dragMomentum:o}}}function LT(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function bye(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class wye extends Sf{constructor(t){super(t),this.removeGroupControls=Nl,this.removeListeners=Nl,this.controls=new xye(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Nl}unmount(){this.removeGroupControls(),this.removeListeners()}}const wV=e=>(t,r)=>{e&&ao.postRender(()=>e(t,r))};class Sye extends Sf{constructor(){super(...arguments),this.removePointerDownListener=Nl}onPointerDown(t){this.session=new sX(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:oX(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:l}=this.node.getProps();return{onSessionStart:wV(t),onStart:wV(r),onMove:n,onEnd:(h,f)=>{delete this.session,l&&ao.postRender(()=>l(h,f))}}}mount(){this.removePointerDownListener=pb(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const SE={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function SV(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const kx={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(bn.test(e))e=parseFloat(e);else return e;const r=SV(e,t.target.x),n=SV(e,t.target.y);return`${r}% ${n}%`}},Tye={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,l=vf.parse(e);if(l.length>5)return n;const h=vf.createTransformer(e),f=typeof l[0]!="number"?1:0,o=r.x.scale*t.x,v=r.y.scale*t.y;l[0+f]/=o,l[1+f]/=v;const b=go(o,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),h(l)}};let KM=!1;class Eye extends K.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:l}=this.props,{projection:h}=t;qme(Aye),h&&(r.group&&r.group.add(h),n&&n.register&&l&&n.register(h),KM&&h.root.didUpdate(),h.addEventListener("animationComplete",()=>{this.safeToRemove()}),h.setOptions({...h.options,onExitComplete:()=>this.safeToRemove()})),SE.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:l,isPresent:h}=this.props,{projection:f}=n;return f&&(f.isPresent=h,KM=!0,l||t.layoutDependency!==r||r===void 0||t.isPresent!==h?f.willUpdate():this.safeToRemove(),t.isPresent!==h&&(h?f.promote():f.relegate()||ao.postRender(()=>{const o=f.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),aN.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:l}=t;KM=!0,l&&(l.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(l),n&&n.deregister&&n.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function lX(e){const[t,r]=MZ(),n=K.useContext(Fj);return M.jsx(Eye,{...e,layoutGroup:n,switchLayoutGroup:K.useContext(VZ),isPresent:t,safeToRemove:r})}const Aye={borderRadius:{...kx,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:kx,borderTopRightRadius:kx,borderBottomLeftRadius:kx,borderBottomRightRadius:kx,boxShadow:Tye};function Pye(e,t,r){const n=Ys(e)?e:_m(e);return n.start(yN("",n,t,r)),n.animation}const Cye=(e,t)=>e.depth-t.depth;class Iye{constructor(){this.children=[],this.isDirty=!1}add(t){Vj(this.children,t),this.isDirty=!0}remove(t){Uj(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Cye),this.isDirty=!1,this.children.forEach(t)}}function Mye(e,t){const r=Ba.now(),n=({timestamp:l})=>{const h=l-r;h>=t&&(Ch(n),e(h-t))};return ao.setup(n,!0),()=>Ch(n)}const cX=["TopLeft","TopRight","BottomLeft","BottomRight"],Oye=cX.length,TV=e=>typeof e=="string"?parseFloat(e):e,EV=e=>typeof e=="number"||bn.test(e);function kye(e,t,r,n,l,h){l?(e.opacity=go(0,r.opacity??1,Rye(n)),e.opacityExit=go(t.opacity??1,0,Dye(n))):h&&(e.opacity=go(t.opacity??1,r.opacity??1,n));for(let f=0;f<Oye;f++){const o=`border${cX[f]}Radius`;let v=AV(t,o),b=AV(r,o);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||EV(v)===EV(b)?(e[o]=Math.max(go(TV(v),TV(b),n),0),(xu.test(b)||xu.test(v))&&(e[o]+="%")):e[o]=b}(t.rotate||r.rotate)&&(e.rotate=go(t.rotate||0,r.rotate||0,n))}function AV(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Rye=uX(0,.5,X9),Dye=uX(.5,.95,Nl);function uX(e,t,r){return n=>n<e?0:n>t?1:r(Zb(e,t,n))}function PV(e,t){e.min=t.min,e.max=t.max}function Tl(e,t){PV(e.x,t.x),PV(e.y,t.y)}function CV(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function IV(e,t,r,n,l){return e-=t,e=c2(e,1/r,n),l!==void 0&&(e=c2(e,1/l,n)),e}function Lye(e,t=0,r=1,n=.5,l,h=e,f=e){if(xu.test(t)&&(t=parseFloat(t),t=go(f.min,f.max,t/100)-f.min),typeof t!="number")return;let o=go(h.min,h.max,n);e===h&&(o-=t),e.min=IV(e.min,t,r,o,l),e.max=IV(e.max,t,r,o,l)}function MV(e,t,[r,n,l],h,f){Lye(e,t[r],t[n],t[l],t.scale,h,f)}const jye=["x","scaleX","originX"],Nye=["y","scaleY","originY"];function OV(e,t,r,n){MV(e.x,t,jye,r?r.x:void 0,n?n.x:void 0),MV(e.y,t,Nye,r?r.y:void 0,n?n.y:void 0)}function kV(e){return e.translate===0&&e.scale===1}function hX(e){return kV(e.x)&&kV(e.y)}function RV(e,t){return e.min===t.min&&e.max===t.max}function zye(e,t){return RV(e.x,t.x)&&RV(e.y,t.y)}function DV(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function dX(e,t){return DV(e.x,t.x)&&DV(e.y,t.y)}function LV(e){return ga(e.x)/ga(e.y)}function jV(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Fye{constructor(){this.members=[]}add(t){Vj(this.members,t),t.scheduleRender()}remove(t){if(Uj(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(l=>t===l);if(r===0)return!1;let n;for(let l=r;l>=0;l--){const h=this.members[l];if(h.isPresent!==!1){n=h;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Bye(e,t,r){let n="";const l=e.x.translate/t.x,h=e.y.translate/t.y,f=r?.z||0;if((l||h||f)&&(n=`translate3d(${l}px, ${h}px, ${f}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:b,rotate:E,rotateX:P,rotateY:O,skewX:L,skewY:B}=r;b&&(n=`perspective(${b}px) ${n}`),E&&(n+=`rotate(${E}deg) `),P&&(n+=`rotateX(${P}deg) `),O&&(n+=`rotateY(${O}deg) `),L&&(n+=`skewX(${L}deg) `),B&&(n+=`skewY(${B}deg) `)}const o=e.x.scale*t.x,v=e.y.scale*t.y;return(o!==1||v!==1)&&(n+=`scale(${o}, ${v})`),n||"none"}const YM=["","X","Y","Z"],$ye=1e3;let Vye=0;function JM(e,t,r,n){const{latestValues:l}=t;l[e]&&(r[e]=l[e],t.setStaticValue(e,0),n&&(n[e]=0))}function fX(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=JZ(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:l,layoutId:h}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",ao,!(l||h))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&fX(n)}function pX({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:l}){return class{constructor(f={},o=t?.()){this.id=Vye++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Hye),this.nodes.forEach(Xye),this.nodes.forEach(Kye),this.nodes.forEach(Wye)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new Iye)}addEventListener(f,o){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new Wj),this.eventHandlers.get(f).add(o)}notifyListeners(f,...o){const v=this.eventHandlers.get(f);v&&v.notify(...o)}hasListeners(f){return this.eventHandlers.has(f)}mount(f){if(this.instance)return;this.isSVG=IZ(f)&&!Rme(f),this.instance=f;const{layoutId:o,layout:v,visualElement:b}=this.options;if(b&&!b.current&&b.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(v||o)&&(this.isLayoutDirty=!0),e){let E,P=0;const O=()=>this.root.updateBlockedByResize=!1;ao.read(()=>{P=window.innerWidth}),e(f,()=>{const L=window.innerWidth;L!==P&&(P=L,this.root.updateBlockedByResize=!0,E&&E(),E=Mye(O,250),SE.hasAnimatedSinceResize&&(SE.hasAnimatedSinceResize=!1,this.nodes.forEach(FV)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&b&&(o||v)&&this.addEventListener("didUpdate",({delta:E,hasLayoutChanged:P,hasRelativeLayoutChanged:O,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||b.getDefaultTransition()||t_e,{onLayoutAnimationStart:z,onLayoutAnimationComplete:$}=b.getProps(),U=!this.targetLayout||!dX(this.targetLayout,L),G=!P&&O;if(this.options.layoutRoot||this.resumeFrom||G||P&&(U||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Z={...oN(B,"layout"),onPlay:z,onComplete:$};(b.shouldReduceMotion||this.options.layoutRoot)&&(Z.delay=0,Z.type=!1),this.startAnimation(Z),this.setAnimationOrigin(E,G)}else P||FV(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ch(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Yye),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&fX(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let E=0;E<this.path.length;E++){const P=this.path[E];P.shouldResetTransform=!0,P.updateScroll("snapshot"),P.options.layoutRoot&&P.willUpdate(!1)}const{layoutId:o,layout:v}=this.options;if(o===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(NV);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(zV);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Zye),this.nodes.forEach(Uye),this.nodes.forEach(Gye)):this.nodes.forEach(zV),this.clearAllSnapshots();const o=Ba.now();Ds.delta=Ah(0,1e3/60,o-Ds.timestamp),Ds.timestamp=o,Ds.isProcessing=!0,BM.update.process(Ds),BM.preRender.process(Ds),BM.render.process(Ds),Ds.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,aN.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(qye),this.sharedNodes.forEach(Jye)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ao.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ao.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ga(this.snapshot.measuredBox.x)&&!ga(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ro(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(o=!1),o&&this.instance){const v=n(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!hX(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,E=b!==this.prevTransformTemplateValue;f&&this.instance&&(o||jp(this.latestValues)||E)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const o=this.measurePageBox();let v=this.removeElementScroll(o);return f&&(v=this.removeTransform(v)),r_e(v),{animationId:this.root.animationId,measuredBox:o,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:f}=this.options;if(!f)return Ro();const o=f.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(n_e))){const{scroll:b}=this.root;b&&(ky(o.x,b.offset.x),ky(o.y,b.offset.y))}return o}removeElementScroll(f){const o=Ro();if(Tl(o,f),this.scroll?.wasRoot)return o;for(let v=0;v<this.path.length;v++){const b=this.path[v],{scroll:E,options:P}=b;b!==this.root&&E&&P.layoutScroll&&(E.wasRoot&&Tl(o,f),ky(o.x,E.offset.x),ky(o.y,E.offset.y))}return o}applyTransform(f,o=!1){const v=Ro();Tl(v,f);for(let b=0;b<this.path.length;b++){const E=this.path[b];!o&&E.options.layoutScroll&&E.scroll&&E!==E.root&&Ry(v,{x:-E.scroll.offset.x,y:-E.scroll.offset.y}),jp(E.latestValues)&&Ry(v,E.latestValues)}return jp(this.latestValues)&&Ry(v,this.latestValues),v}removeTransform(f){const o=Ro();Tl(o,f);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!jp(b.latestValues))continue;yR(b.latestValues)&&b.updateSnapshot();const E=Ro(),P=b.measurePageBox();Tl(E,P),OV(o,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,E)}return jp(this.latestValues)&&OV(o,this.latestValues),o}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ds.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const v=!!this.resumingFrom||this!==o;if(!(f||v&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:E,layoutId:P}=this.options;if(!(!this.layout||!(E||P))){if(this.resolvedRelativeTargetAt=Ds.timestamp,!this.targetDelta&&!this.relativeTarget){const O=this.getClosestProjectingParent();O&&O.layout&&this.animationProgress!==1?(this.relativeParent=O,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ro(),this.relativeTargetOrigin=Ro(),gb(this.relativeTargetOrigin,this.layout.layoutBox,O.layout.layoutBox),Tl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ro(),this.targetWithTransforms=Ro()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),cye(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Tl(this.target,this.layout.layoutBox),WZ(this.target,this.targetDelta)):Tl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const O=this.getClosestProjectingParent();O&&!!O.resumingFrom==!!this.resumingFrom&&!O.options.layoutScroll&&O.target&&this.animationProgress!==1?(this.relativeParent=O,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ro(),this.relativeTargetOrigin=Ro(),gb(this.relativeTargetOrigin,this.target,O.target),Tl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||yR(this.parent.latestValues)||HZ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const f=this.getLead(),o=!!this.resumingFrom||this!==f;let v=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(v=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(v=!1),this.resolvedRelativeTargetAt===Ds.timestamp&&(v=!1),v)return;const{layout:b,layoutId:E}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(b||E))return;Tl(this.layoutCorrected,this.layout.layoutBox);const P=this.treeScale.x,O=this.treeScale.y;bge(this.layoutCorrected,this.treeScale,this.path,o),f.layout&&!f.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(f.target=f.layout.layoutBox,f.targetWithTransforms=Ro());const{target:L}=f;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(CV(this.prevProjectionDelta.x,this.projectionDelta.x),CV(this.prevProjectionDelta.y,this.projectionDelta.y)),mb(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==P||this.treeScale.y!==O||!jV(this.projectionDelta.x,this.prevProjectionDelta.x)||!jV(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){if(this.options.visualElement?.scheduleRender(),f){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Dy(),this.projectionDelta=Dy(),this.projectionDeltaWithTransform=Dy()}setAnimationOrigin(f,o=!1){const v=this.snapshot,b=v?v.latestValues:{},E={...this.latestValues},P=Dy();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const O=Ro(),L=v?v.source:void 0,B=this.layout?this.layout.source:void 0,z=L!==B,$=this.getStack(),U=!$||$.members.length<=1,G=!!(z&&!U&&this.options.crossfade===!0&&!this.path.some(e_e));this.animationProgress=0;let Z;this.mixTargetDelta=ne=>{const Y=ne/1e3;BV(P.x,f.x,Y),BV(P.y,f.y,Y),this.setTargetDelta(P),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(gb(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Qye(this.relativeTarget,this.relativeTargetOrigin,O,Y),Z&&zye(this.relativeTarget,Z)&&(this.isProjectionDirty=!1),Z||(Z=Ro()),Tl(Z,this.relativeTarget)),z&&(this.animationValues=E,kye(E,b,this.latestValues,Y,G,U)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Y},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Ch(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ao.update(()=>{SE.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=_m(0)),this.currentAnimation=Pye(this.motionValue,[0,1e3],{...f,velocity:0,isSync:!0,onUpdate:o=>{this.mixTargetDelta(o),f.onUpdate&&f.onUpdate(o)},onStop:()=>{},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta($ye),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:o,target:v,layout:b,latestValues:E}=f;if(!(!o||!v||!b)){if(this!==f&&this.layout&&b&&mX(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||Ro();const P=ga(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+P;const O=ga(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+O}Tl(o,v),Ry(o,E),mb(this.projectionDeltaWithTransform,this.layoutCorrected,o,E)}}registerSharedNode(f,o){this.sharedNodes.has(f)||this.sharedNodes.set(f,new Fye),this.sharedNodes.get(f).add(o);const b=o.options.initialPromotionConfig;o.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(o):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){const{layoutId:f}=this.options;return f?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:f}=this.options;return f?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:o,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let o=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(o=!0),!o)return;const b={};v.z&&JM("z",f,b,this.animationValues);for(let E=0;E<YM.length;E++)JM(`rotate${YM[E]}`,f,b,this.animationValues),JM(`skew${YM[E]}`,f,b,this.animationValues);f.render();for(const E in b)f.setStaticValue(E,b[E]),this.animationValues&&(this.animationValues[E]=b[E]);f.scheduleRender()}applyProjectionStyles(f,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){f.visibility="hidden";return}const v=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,f.visibility="",f.opacity="",f.pointerEvents=wE(o?.pointerEvents)||"",f.transform=v?v(this.latestValues,""):"none";return}const b=this.getLead();if(!this.projectionDelta||!this.layout||!b.target){this.options.layoutId&&(f.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,f.pointerEvents=wE(o?.pointerEvents)||""),this.hasProjected&&!jp(this.latestValues)&&(f.transform=v?v({},""):"none",this.hasProjected=!1);return}f.visibility="";const E=b.animationValues||b.latestValues;this.applyTransformsToTarget();let P=Bye(this.projectionDeltaWithTransform,this.treeScale,E);v&&(P=v(E,P)),f.transform=P;const{x:O,y:L}=this.projectionDelta;f.transformOrigin=`${O.origin*100}% ${L.origin*100}% 0`,b.animationValues?f.opacity=b===this?E.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:E.opacityExit:f.opacity=b===this?E.opacity!==void 0?E.opacity:"":E.opacityExit!==void 0?E.opacityExit:0;for(const B in Jb){if(E[B]===void 0)continue;const{correct:z,applyTo:$,isCSSVariable:U}=Jb[B],G=P==="none"?E[B]:z(E[B],b);if($){const Z=$.length;for(let ne=0;ne<Z;ne++)f[$[ne]]=G}else U?this.options.visualElement.renderState.vars[B]=G:f[B]=G}this.options.layoutId&&(f.pointerEvents=b===this?wE(o?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>f.currentAnimation?.stop()),this.root.nodes.forEach(NV),this.root.sharedNodes.clear()}}}function Uye(e){e.updateLayout()}function Gye(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=e.layout,{animationType:l}=e.options,h=t.source!==e.layout.source;l==="size"?Cl(E=>{const P=h?t.measuredBox[E]:t.layoutBox[E],O=ga(P);P.min=r[E].min,P.max=P.min+O}):mX(l,t.layoutBox,r)&&Cl(E=>{const P=h?t.measuredBox[E]:t.layoutBox[E],O=ga(r[E]);P.max=P.min+O,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[E].max=e.relativeTarget[E].min+O)});const f=Dy();mb(f,r,t.layoutBox);const o=Dy();h?mb(o,e.applyTransform(n,!0),t.measuredBox):mb(o,r,t.layoutBox);const v=!hX(f);let b=!1;if(!e.resumeFrom){const E=e.getClosestProjectingParent();if(E&&!E.resumeFrom){const{snapshot:P,layout:O}=E;if(P&&O){const L=Ro();gb(L,t.layoutBox,P.layoutBox);const B=Ro();gb(B,r,O.layoutBox),dX(L,B)||(b=!0),E.options.layoutRoot&&(e.relativeTarget=B,e.relativeTargetOrigin=L,e.relativeParent=E)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:o,layoutDelta:f,hasLayoutChanged:v,hasRelativeLayoutChanged:b})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function Hye(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Wye(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function qye(e){e.clearSnapshot()}function NV(e){e.clearMeasurements()}function zV(e){e.isLayoutDirty=!1}function Zye(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function FV(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Xye(e){e.resolveTargetDelta()}function Kye(e){e.calcProjection()}function Yye(e){e.resetSkewAndRotation()}function Jye(e){e.removeLeadSnapshot()}function BV(e,t,r){e.translate=go(t.translate,0,r),e.scale=go(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function $V(e,t,r,n){e.min=go(t.min,r.min,n),e.max=go(t.max,r.max,n)}function Qye(e,t,r,n){$V(e.x,t.x,r.x,n),$V(e.y,t.y,r.y,n)}function e_e(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const t_e={duration:.45,ease:[.4,0,.1,1]},VV=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),UV=VV("applewebkit/")&&!VV("chrome/")?Math.round:Nl;function GV(e){e.min=UV(e.min),e.max=UV(e.max)}function r_e(e){GV(e.x),GV(e.y)}function mX(e,t,r){return e==="position"||e==="preserve-aspect"&&!lye(LV(t),LV(r),.2)}function n_e(e){return e!==e.root&&e.scroll?.wasRoot}const i_e=pX({attachResizeListener:(e,t)=>Qb(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),QM={current:void 0},gX=pX({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!QM.current){const e=new i_e({});e.mount(window),e.setOptions({layoutScroll:!0}),QM.current=e}return QM.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),o_e={pan:{Feature:Sye},drag:{Feature:wye,ProjectionNode:gX,MeasureLayout:lX}};function HV(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",r==="Start");const l="onHover"+r,h=n[l];h&&ao.postRender(()=>h(t,Kw(t)))}class s_e extends Sf{mount(){const{current:t}=this.node;t&&(this.unmount=Cme(t,(r,n)=>(HV(this.node,n,"Start"),l=>HV(this.node,l,"End"))))}unmount(){}}class a_e extends Sf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=qw(Qb(this.node.current,"focus",()=>this.onFocus()),Qb(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function WV(e,t,r){const{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",r==="Start");const l="onTap"+(r==="End"?"":r),h=n[l];h&&ao.postRender(()=>h(t,Kw(t)))}class l_e extends Sf{mount(){const{current:t}=this.node;t&&(this.unmount=kme(t,(r,n)=>(WV(this.node,n,"Start"),(l,{success:h})=>WV(this.node,l,h?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const TR=new WeakMap,eO=new WeakMap,c_e=e=>{const t=TR.get(e.target);t&&t(e)},u_e=e=>{e.forEach(c_e)};function h_e({root:e,...t}){const r=e||document;eO.has(r)||eO.set(r,{});const n=eO.get(r),l=JSON.stringify(t);return n[l]||(n[l]=new IntersectionObserver(u_e,{root:e,...t})),n[l]}function d_e(e,t,r){const n=h_e(t);return TR.set(e,r),n.observe(e),()=>{TR.delete(e),n.unobserve(e)}}const f_e={some:0,all:1};class p_e extends Sf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:l="some",once:h}=t,f={root:r?r.current:void 0,rootMargin:n,threshold:typeof l=="number"?l:f_e[l]},o=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,h&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:E,onViewportLeave:P}=this.node.getProps(),O=b?E:P;O&&O(v)};return d_e(this.node.current,f,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(m_e(t,r))&&this.startObserver()}unmount(){}}function m_e({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const g_e={inView:{Feature:p_e},tap:{Feature:l_e},focus:{Feature:a_e},hover:{Feature:s_e}},y_e={layout:{ProjectionNode:gX,MeasureLayout:lX}},__e={...rye,...g_e,...o_e,...y_e},$r=_ge(__e,Oge);function yX(e){const t=Ww(()=>_m(e)),{isStatic:r}=K.useContext(ZA);if(r){const[,n]=K.useState(e);K.useEffect(()=>t.on("change",n),[])}return t}function _X(e,t){const r=yX(t()),n=()=>r.set(t());return n(),$j(()=>{const l=()=>ao.preRender(n,!1,!0),h=e.map(f=>f.on("change",l));return()=>{h.forEach(f=>f()),Ch(n)}}),r}function v_e(e){fb.current=[],e();const t=_X(fb.current,e);return fb.current=void 0,t}function tO(e,t,r,n){if(typeof e=="function")return v_e(e);const l=typeof t=="function"?t:Dme(t,r,n);return Array.isArray(e)?qV(e,l):qV([e],([h])=>l(h))}function qV(e,t){const r=Ww(()=>[]);return _X(e,()=>{r.length=0;const n=e.length;for(let l=0;l<n;l++)r[l]=e[l].get();return t(r)})}const Cn=K.forwardRef(({className:e,...t},r)=>M.jsx("div",{ref:r,className:ln("rounded-xl border bg-card text-card-foreground shadow-soft transition-all duration-300",e),...t}));Cn.displayName="Card";const Ky=K.forwardRef(({className:e,...t},r)=>M.jsx("div",{ref:r,className:ln("flex flex-col space-y-2 p-6",e),...t}));Ky.displayName="CardHeader";const Yy=K.forwardRef(({className:e,...t},r)=>M.jsx("h3",{ref:r,className:ln("text-2xl font-heading font-semibold leading-none tracking-tight",e),...t}));Yy.displayName="CardTitle";const vX=K.forwardRef(({className:e,...t},r)=>M.jsx("p",{ref:r,className:ln("text-sm text-muted-foreground",e),...t}));vX.displayName="CardDescription";const Ml=K.forwardRef(({className:e,...t},r)=>M.jsx("div",{ref:r,className:ln("p-6 pt-0",e),...t}));Ml.displayName="CardContent";const x_e=K.forwardRef(({className:e,...t},r)=>M.jsx("div",{ref:r,className:ln("flex items-center p-6 pt-0",e),...t}));x_e.displayName="CardFooter";const b_e=ev("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:scale-105",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:shadow-lg",outline:"border border-input bg-background/50 hover:bg-accent hover:text-accent-foreground hover:shadow-md hover:scale-105",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:shadow-md",ghost:"hover:bg-accent hover:text-accent-foreground hover:scale-105",link:"text-primary underline-offset-4 hover:underline hover:scale-105",glass:"bg-white/10 backdrop-blur-md border border-white/20 text-white hover:bg-white/20 hover:shadow-lg",gradient:"bg-gradient-primary text-primary-foreground hover:shadow-glow hover:scale-105"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),fn=K.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...l},h)=>{const f=n?cle:"button";return M.jsx(f,{className:ln(b_e({variant:t,size:r,className:e})),ref:h,...l})});fn.displayName="Button";const w_e=ev("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function An({className:e,variant:t,...r}){return M.jsx("div",{className:ln(w_e({variant:t}),e),...r})}const S_e=({rating:e,reviewCount:t=0,showReviewCount:r=!0,size:n="md",className:l})=>{const h={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},f={sm:"text-xs",md:"text-sm",lg:"text-base"};return M.jsxs("div",{className:ln("flex items-center gap-2",l),children:[M.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((o,v)=>M.jsx(ba,{className:ln(h[n],v<Math.floor(e)?"text-yellow-400 fill-yellow-400":v<e?"text-yellow-400 fill-yellow-400/50":"text-muted-foreground")},v))}),M.jsx("span",{className:ln("font-medium",f[n]),children:e.toFixed(1)}),r&&t>0&&M.jsxs("span",{className:ln("text-muted-foreground",f[n]),children:["(",t," ",t===1?"recension":"recensioner",")"]})]})},T_e=({onClickOutside:e,children:t,className:r="",disabled:n=!1})=>{const l=K.useRef(null);return K.useEffect(()=>{if(n)return;const h=f=>{l.current&&!l.current.contains(f.target)&&e()};return document.addEventListener("mousedown",h,!0),()=>{document.removeEventListener("mousedown",h,!0)}},[e,n]),M.jsx("div",{ref:l,className:r,children:t})},E_e=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>iv(async()=>{const{default:n}=await Promise.resolve().then(()=>lv);return{default:n}},void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)};class _N extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class A_e extends _N{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class ZV extends _N{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class XV extends _N{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var ER;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(ER||(ER={}));var P_e=function(e,t,r,n){function l(h){return h instanceof r?h:new r(function(f){f(h)})}return new(r||(r=Promise))(function(h,f){function o(E){try{b(n.next(E))}catch(P){f(P)}}function v(E){try{b(n.throw(E))}catch(P){f(P)}}function b(E){E.done?h(E.value):l(E.value).then(o,v)}b((n=n.apply(e,t||[])).next())})};class C_e{constructor(t,{headers:r={},customFetch:n,region:l=ER.Any}={}){this.url=t,this.headers=r,this.region=l,this.fetch=E_e(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,r={}){var n;return P_e(this,void 0,void 0,function*(){try{const{headers:l,method:h,body:f}=r;let o={},{region:v}=r;v||(v=this.region);const b=new URL(`${this.url}/${t}`);v&&v!=="any"&&(o["x-region"]=v,b.searchParams.set("forceFunctionRegion",v));let E;f&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)&&(typeof Blob<"u"&&f instanceof Blob||f instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",E=f):typeof f=="string"?(o["Content-Type"]="text/plain",E=f):typeof FormData<"u"&&f instanceof FormData?E=f:(o["Content-Type"]="application/json",E=JSON.stringify(f)));const P=yield this.fetch(b.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),l),body:E}).catch(z=>{throw new A_e(z)}),O=P.headers.get("x-relay-error");if(O&&O==="true")throw new ZV(P);if(!P.ok)throw new XV(P);let L=((n=P.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),B;return L==="application/json"?B=yield P.json():L==="application/octet-stream"?B=yield P.blob():L==="text/event-stream"?B=P:L==="multipart/form-data"?B=yield P.formData():B=yield P.text(),{data:B,error:null,response:P}}catch(l){return{data:null,error:l,response:l instanceof XV||l instanceof ZV?l.context:void 0}}})}}var za={},vN={},JA={},Yw={},QA={},eP={},I_e=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},S_=I_e();const M_e=S_.fetch,xX=S_.fetch.bind(S_),bX=S_.Headers,O_e=S_.Request,k_e=S_.Response,lv=Object.freeze(Object.defineProperty({__proto__:null,Headers:bX,Request:O_e,Response:k_e,default:xX,fetch:M_e},Symbol.toStringTag,{value:"Module"})),R_e=Ooe(lv);var tP={};Object.defineProperty(tP,"__esModule",{value:!0});let D_e=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};tP.default=D_e;var wX=Ls&&Ls.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(eP,"__esModule",{value:!0});const L_e=wX(R_e),j_e=wX(tP);let N_e=class{constructor(t){var r,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(r=t.shouldThrowOnError)!==null&&r!==void 0?r:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=L_e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,r){return this.headers=new Headers(this.headers),this.headers.set(t,r),this}then(t,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let l=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async h=>{var f,o,v,b;let E=null,P=null,O=null,L=h.status,B=h.statusText;if(h.ok){if(this.method!=="HEAD"){const G=await h.text();G===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((f=this.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?P=G:P=JSON.parse(G))}const $=(o=this.headers.get("Prefer"))===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),U=(v=h.headers.get("content-range"))===null||v===void 0?void 0:v.split("/");$&&U&&U.length>1&&(O=parseInt(U[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(P)&&(P.length>1?(E={code:"PGRST116",details:`Results contain ${P.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},P=null,O=null,L=406,B="Not Acceptable"):P.length===1?P=P[0]:P=null)}else{const $=await h.text();try{E=JSON.parse($),Array.isArray(E)&&h.status===404&&(P=[],E=null,L=200,B="OK")}catch{h.status===404&&$===""?(L=204,B="No Content"):E={message:$}}if(E&&this.isMaybeSingle&&(!((b=E?.details)===null||b===void 0)&&b.includes("0 rows"))&&(E=null,L=200,B="OK"),E&&this.shouldThrowOnError)throw new j_e.default(E)}return{error:E,data:P,count:O,status:L,statusText:B}});return this.shouldThrowOnError||(l=l.catch(h=>{var f,o,v;return{error:{message:`${(f=h?.name)!==null&&f!==void 0?f:"FetchError"}: ${h?.message}`,details:`${(o=h?.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(v=h?.code)!==null&&v!==void 0?v:""}`},data:null,count:null,status:0,statusText:""}})),l.then(t,r)}returns(){return this}overrideTypes(){return this}};eP.default=N_e;var z_e=Ls&&Ls.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(QA,"__esModule",{value:!0});const F_e=z_e(eP);let B_e=class extends F_e.default{select(t){let r=!1;const n=(t??"*").split("").map(l=>/\s/.test(l)&&!r?"":(l==='"'&&(r=!r),l)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:r=!0,nullsFirst:n,foreignTable:l,referencedTable:h=l}={}){const f=h?`${h}.order`:"order",o=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${o?`${o},`:""}${t}.${r?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:r,referencedTable:n=r}={}){const l=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(l,`${t}`),this}range(t,r,{foreignTable:n,referencedTable:l=n}={}){const h=typeof l>"u"?"offset":`${l}.offset`,f=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(h,`${t}`),this.url.searchParams.set(f,`${r-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:r=!1,settings:n=!1,buffers:l=!1,wal:h=!1,format:f="text"}={}){var o;const v=[t?"analyze":null,r?"verbose":null,n?"settings":null,l?"buffers":null,h?"wal":null].filter(Boolean).join("|"),b=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${b}"; options=${v};`),f==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};QA.default=B_e;var $_e=Ls&&Ls.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Yw,"__esModule",{value:!0});const V_e=$_e(QA);let U_e=class extends V_e.default{eq(t,r){return this.url.searchParams.append(t,`eq.${r}`),this}neq(t,r){return this.url.searchParams.append(t,`neq.${r}`),this}gt(t,r){return this.url.searchParams.append(t,`gt.${r}`),this}gte(t,r){return this.url.searchParams.append(t,`gte.${r}`),this}lt(t,r){return this.url.searchParams.append(t,`lt.${r}`),this}lte(t,r){return this.url.searchParams.append(t,`lte.${r}`),this}like(t,r){return this.url.searchParams.append(t,`like.${r}`),this}likeAllOf(t,r){return this.url.searchParams.append(t,`like(all).{${r.join(",")}}`),this}likeAnyOf(t,r){return this.url.searchParams.append(t,`like(any).{${r.join(",")}}`),this}ilike(t,r){return this.url.searchParams.append(t,`ilike.${r}`),this}ilikeAllOf(t,r){return this.url.searchParams.append(t,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(t,r){return this.url.searchParams.append(t,`ilike(any).{${r.join(",")}}`),this}is(t,r){return this.url.searchParams.append(t,`is.${r}`),this}in(t,r){const n=Array.from(new Set(r)).map(l=>typeof l=="string"&&new RegExp("[,()]").test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cs.{${r.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(r)}`),this}containedBy(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cd.{${r.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(r)}`),this}rangeGt(t,r){return this.url.searchParams.append(t,`sr.${r}`),this}rangeGte(t,r){return this.url.searchParams.append(t,`nxl.${r}`),this}rangeLt(t,r){return this.url.searchParams.append(t,`sl.${r}`),this}rangeLte(t,r){return this.url.searchParams.append(t,`nxr.${r}`),this}rangeAdjacent(t,r){return this.url.searchParams.append(t,`adj.${r}`),this}overlaps(t,r){return typeof r=="string"?this.url.searchParams.append(t,`ov.${r}`):this.url.searchParams.append(t,`ov.{${r.join(",")}}`),this}textSearch(t,r,{config:n,type:l}={}){let h="";l==="plain"?h="pl":l==="phrase"?h="ph":l==="websearch"&&(h="w");const f=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${h}fts${f}.${r}`),this}match(t){return Object.entries(t).forEach(([r,n])=>{this.url.searchParams.append(r,`eq.${n}`)}),this}not(t,r,n){return this.url.searchParams.append(t,`not.${r}.${n}`),this}or(t,{foreignTable:r,referencedTable:n=r}={}){const l=n?`${n}.or`:"or";return this.url.searchParams.append(l,`(${t})`),this}filter(t,r,n){return this.url.searchParams.append(t,`${r}.${n}`),this}};Yw.default=U_e;var G_e=Ls&&Ls.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(JA,"__esModule",{value:!0});const Rx=G_e(Yw);let H_e=class{constructor(t,{headers:r={},schema:n,fetch:l}){this.url=t,this.headers=new Headers(r),this.schema=n,this.fetch=l}select(t,{head:r=!1,count:n}={}){const l=r?"HEAD":"GET";let h=!1;const f=(t??"*").split("").map(o=>/\s/.test(o)&&!h?"":(o==='"'&&(h=!h),o)).join("");return this.url.searchParams.set("select",f),n&&this.headers.append("Prefer",`count=${n}`),new Rx.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:r,defaultToNull:n=!0}={}){var l;const h="POST";if(r&&this.headers.append("Prefer",`count=${r}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const f=t.reduce((o,v)=>o.concat(Object.keys(v)),[]);if(f.length>0){const o=[...new Set(f)].map(v=>`"${v}"`);this.url.searchParams.set("columns",o.join(","))}}return new Rx.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(t,{onConflict:r,ignoreDuplicates:n=!1,count:l,defaultToNull:h=!0}={}){var f;const o="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),r!==void 0&&this.url.searchParams.set("on_conflict",r),l&&this.headers.append("Prefer",`count=${l}`),h||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const v=t.reduce((b,E)=>b.concat(Object.keys(E)),[]);if(v.length>0){const b=[...new Set(v)].map(E=>`"${E}"`);this.url.searchParams.set("columns",b.join(","))}}return new Rx.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}update(t,{count:r}={}){var n;const l="PATCH";return r&&this.headers.append("Prefer",`count=${r}`),new Rx.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var r;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new Rx.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}};JA.default=H_e;var SX=Ls&&Ls.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(vN,"__esModule",{value:!0});const W_e=SX(JA),q_e=SX(Yw);let Z_e=class TX{constructor(t,{headers:r={},schema:n,fetch:l}={}){this.url=t,this.headers=new Headers(r),this.schemaName=n,this.fetch=l}from(t){const r=new URL(`${this.url}/${t}`);return new W_e.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new TX(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:n=!1,get:l=!1,count:h}={}){var f;let o;const v=new URL(`${this.url}/rpc/${t}`);let b;n||l?(o=n?"HEAD":"GET",Object.entries(r).filter(([P,O])=>O!==void 0).map(([P,O])=>[P,Array.isArray(O)?`{${O.join(",")}}`:`${O}`]).forEach(([P,O])=>{v.searchParams.append(P,O)})):(o="POST",b=r);const E=new Headers(this.headers);return h&&E.set("Prefer",`count=${h}`),new q_e.default({method:o,url:v,headers:E,schema:this.schemaName,body:b,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}};vN.default=Z_e;var cv=Ls&&Ls.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(za,"__esModule",{value:!0});za.PostgrestError=za.PostgrestBuilder=za.PostgrestTransformBuilder=za.PostgrestFilterBuilder=za.PostgrestQueryBuilder=za.PostgrestClient=void 0;const EX=cv(vN);za.PostgrestClient=EX.default;const AX=cv(JA);za.PostgrestQueryBuilder=AX.default;const PX=cv(Yw);za.PostgrestFilterBuilder=PX.default;const CX=cv(QA);za.PostgrestTransformBuilder=CX.default;const IX=cv(eP);za.PostgrestBuilder=IX.default;const MX=cv(tP);za.PostgrestError=MX.default;var X_e=za.default={PostgrestClient:EX.default,PostgrestQueryBuilder:AX.default,PostgrestFilterBuilder:PX.default,PostgrestTransformBuilder:CX.default,PostgrestBuilder:IX.default,PostgrestError:MX.default};const{PostgrestClient:K_e,PostgrestQueryBuilder:HGe,PostgrestFilterBuilder:WGe,PostgrestTransformBuilder:qGe,PostgrestBuilder:ZGe,PostgrestError:XGe}=X_e;class Y_e{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const r=parseInt(process.versions.node.split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const J_e="2.15.1",Q_e=`realtime-js/${J_e}`,eve="1.0.0",AR=1e4,tve=1e3,rve=100;var yb;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(yb||(yb={}));var rs;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(rs||(rs={}));var mc;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(mc||(mc={}));var PR;(function(e){e.websocket="websocket"})(PR||(PR={}));var Vp;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Vp||(Vp={}));class nve{constructor(){this.HEADER_LENGTH=1}decode(t,r){return t.constructor===ArrayBuffer?r(this._binaryDecode(t)):r(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const r=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,r,n)}_decodeBroadcast(t,r,n){const l=r.getUint8(1),h=r.getUint8(2);let f=this.HEADER_LENGTH+2;const o=n.decode(t.slice(f,f+l));f=f+l;const v=n.decode(t.slice(f,f+h));f=f+h;const b=JSON.parse(n.decode(t.slice(f,t.byteLength)));return{ref:null,topic:o,event:v,payload:b}}}class OX{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Xi;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Xi||(Xi={}));const KV=(e,t,r={})=>{var n;const l=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(t).reduce((h,f)=>(h[f]=ive(f,e,t,l),h),{})},ive=(e,t,r,n)=>{const l=t.find(o=>o.name===e),h=l?.type,f=r[e];return h&&!n.includes(h)?kX(h,f):CR(f)},kX=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return lve(t,r)}switch(e){case Xi.bool:return ove(t);case Xi.float4:case Xi.float8:case Xi.int2:case Xi.int4:case Xi.int8:case Xi.numeric:case Xi.oid:return sve(t);case Xi.json:case Xi.jsonb:return ave(t);case Xi.timestamp:return cve(t);case Xi.abstime:case Xi.date:case Xi.daterange:case Xi.int4range:case Xi.int8range:case Xi.money:case Xi.reltime:case Xi.text:case Xi.time:case Xi.timestamptz:case Xi.timetz:case Xi.tsrange:case Xi.tstzrange:return CR(t);default:return CR(t)}},CR=e=>e,ove=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},sve=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},ave=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},lve=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let h;const f=e.slice(1,r);try{h=JSON.parse("["+f+"]")}catch{h=f?f.split(","):[]}return h.map(o=>kX(t,o))}return e},cve=e=>typeof e=="string"?e.replace(" ","T"):e,RX=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class rO{constructor(t,r,n={},l=AR){this.channel=t,this.event=r,this.payload=n,this.timeout=l,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var YV;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(YV||(YV={}));class _b{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},l=>{const{onJoin:h,onLeave:f,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=_b.syncState(this.state,l,h,f),this.pendingDiffs.forEach(v=>{this.state=_b.syncDiff(this.state,v,h,f)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},l=>{const{onJoin:h,onLeave:f,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(l):(this.state=_b.syncDiff(this.state,l,h,f),o())}),this.onJoin((l,h,f)=>{this.channel._trigger("presence",{event:"join",key:l,currentPresences:h,newPresences:f})}),this.onLeave((l,h,f)=>{this.channel._trigger("presence",{event:"leave",key:l,currentPresences:h,leftPresences:f})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,l){const h=this.cloneDeep(t),f=this.transformState(r),o={},v={};return this.map(h,(b,E)=>{f[b]||(v[b]=E)}),this.map(f,(b,E)=>{const P=h[b];if(P){const O=E.map($=>$.presence_ref),L=P.map($=>$.presence_ref),B=E.filter($=>L.indexOf($.presence_ref)<0),z=P.filter($=>O.indexOf($.presence_ref)<0);B.length>0&&(o[b]=B),z.length>0&&(v[b]=z)}else o[b]=E}),this.syncDiff(h,{joins:o,leaves:v},n,l)}static syncDiff(t,r,n,l){const{joins:h,leaves:f}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),l||(l=()=>{}),this.map(h,(o,v)=>{var b;const E=(b=t[o])!==null&&b!==void 0?b:[];if(t[o]=this.cloneDeep(v),E.length>0){const P=t[o].map(L=>L.presence_ref),O=E.filter(L=>P.indexOf(L.presence_ref)<0);t[o].unshift(...O)}n(o,E,v)}),this.map(f,(o,v)=>{let b=t[o];if(!b)return;const E=v.map(P=>P.presence_ref);b=b.filter(P=>E.indexOf(P.presence_ref)<0),t[o]=b,l(o,b,v),b.length===0&&delete t[o]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const l=t[n];return"metas"in l?r[n]=l.metas.map(h=>(h.presence_ref=h.phx_ref,delete h.phx_ref,delete h.phx_ref_prev,h)):r[n]=l,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var JV;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(JV||(JV={}));var vb;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(vb||(vb={}));var sh;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(sh||(sh={}));class xN{constructor(t,r={config:{}},n){this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=rs.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new rO(this,mc.join,this.params,this.timeout),this.rejoinTimer=new OX(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=rs.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(l=>l.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=rs.closed,this.socket._remove(this)}),this._onError(l=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,l),this.state=rs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=rs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",l=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,l),this.state=rs.errored,this.rejoinTimer.scheduleTimeout())}),this._on(mc.reply,{},(l,h)=>{this._trigger(this._replyEventName(h),l)}),this.presence=new _b(this),this.broadcastEndpointURL=RX(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(t,r=this.timeout){var n,l;if(this.socket.isConnected()||this.socket.connect(),this.state==rs.closed){const{config:{broadcast:h,presence:f,private:o}}=this.params,v=(l=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(O=>O.filter))!==null&&l!==void 0?l:[],b=!!this.bindings[vb.PRESENCE]&&this.bindings[vb.PRESENCE].length>0,E={},P={broadcast:h,presence:Object.assign(Object.assign({},f),{enabled:b}),postgres_changes:v,private:o};this.socket.accessTokenValue&&(E.access_token=this.socket.accessTokenValue),this._onError(O=>t?.(sh.CHANNEL_ERROR,O)),this._onClose(()=>t?.(sh.CLOSED)),this.updateJoinPayload(Object.assign({config:P},E)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:O})=>{var L;if(this.socket.setAuth(),O===void 0){t?.(sh.SUBSCRIBED);return}else{const B=this.bindings.postgres_changes,z=(L=B?.length)!==null&&L!==void 0?L:0,$=[];for(let U=0;U<z;U++){const G=B[U],{filter:{event:Z,schema:ne,table:Y,filter:ee}}=G,le=O&&O[U];if(le&&le.event===Z&&le.schema===ne&&le.table===Y&&le.filter===ee)$.push(Object.assign(Object.assign({},G),{id:le.id}));else{this.unsubscribe(),this.state=rs.errored,t?.(sh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=$,t&&t(sh.SUBSCRIBED);return}}).receive("error",O=>{this.state=rs.errored,t?.(sh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(O).join(", ")||"error")))}).receive("timeout",()=>{t?.(sh.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===rs.joined&&t===vb.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async send(t,r={}){var n,l;if(!this._canPush()&&t.type==="broadcast"){const{event:h,payload:f}=t,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:h,payload:f,private:this.private}]})};try{const b=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((l=b.body)===null||l===void 0?void 0:l.cancel()),b.ok?"ok":"error"}catch(b){return b.name==="AbortError"?"timed out":"error"}}else return new Promise(h=>{var f,o,v;const b=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((v=(o=(f=this.params)===null||f===void 0?void 0:f.config)===null||o===void 0?void 0:o.broadcast)===null||v===void 0)&&v.ack)&&h("ok"),b.receive("ok",()=>h("ok")),b.receive("error",()=>h("error")),b.receive("timeout",()=>h("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=rs.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(mc.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(l=>{n=new rO(this,mc.leave,{},t),n.receive("ok",()=>{r(),l("ok")}).receive("timeout",()=>{r(),l("timed out")}).receive("error",()=>{l("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=rs.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const l=new AbortController,h=setTimeout(()=>l.abort(),n),f=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:l.signal}));return clearTimeout(h),f}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let l=new rO(this,t,r,n);return this._canPush()?l.send():this._addToPushBuffer(l),l}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>rve){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var l,h;const f=t.toLocaleLowerCase(),{close:o,error:v,leave:b,join:E}=mc;if(n&&[o,v,b,E].indexOf(f)>=0&&n!==this._joinRef())return;let O=this._onMessage(f,r,n);if(r&&!O)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(f)?(l=this.bindings.postgres_changes)===null||l===void 0||l.filter(L=>{var B,z,$;return((B=L.filter)===null||B===void 0?void 0:B.event)==="*"||(($=(z=L.filter)===null||z===void 0?void 0:z.event)===null||$===void 0?void 0:$.toLocaleLowerCase())===f}).map(L=>L.callback(O,n)):(h=this.bindings[f])===null||h===void 0||h.filter(L=>{var B,z,$,U,G,Z;if(["broadcast","presence","postgres_changes"].includes(f))if("id"in L){const ne=L.id,Y=(B=L.filter)===null||B===void 0?void 0:B.event;return ne&&((z=r.ids)===null||z===void 0?void 0:z.includes(ne))&&(Y==="*"||Y?.toLocaleLowerCase()===(($=r.data)===null||$===void 0?void 0:$.type.toLocaleLowerCase()))}else{const ne=(G=(U=L?.filter)===null||U===void 0?void 0:U.event)===null||G===void 0?void 0:G.toLocaleLowerCase();return ne==="*"||ne===((Z=r?.event)===null||Z===void 0?void 0:Z.toLocaleLowerCase())}else return L.type.toLocaleLowerCase()===f}).map(L=>{if(typeof O=="object"&&"ids"in O){const B=O.data,{schema:z,table:$,commit_timestamp:U,type:G,errors:Z}=B;O=Object.assign(Object.assign({},{schema:z,table:$,commit_timestamp:U,eventType:G,new:{},old:{},errors:Z}),this._getPayloadRecords(B))}L.callback(O,n)})}_isClosed(){return this.state===rs.closed}_isJoined(){return this.state===rs.joined}_isJoining(){return this.state===rs.joining}_isLeaving(){return this.state===rs.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const l=t.toLocaleLowerCase(),h={type:l,filter:r,callback:n};return this.bindings[l]?this.bindings[l].push(h):this.bindings[l]=[h],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(l=>{var h;return!(((h=l.type)===null||h===void 0?void 0:h.toLocaleLowerCase())===n&&xN.isEqual(l.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(mc.close,{},t)}_onError(t){this._on(mc.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=rs.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=KV(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=KV(t.columns,t.old_record)),r}}const QV=()=>{},jT={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},uve=[1e3,2e3,5e3,1e4],hve=1e4,dve=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class fve{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=AR,this.transport=null,this.heartbeatIntervalMs=jT.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=QV,this.ref=0,this.reconnectTimer=null,this.logger=QV,this.conn=null,this.sendBuffer=[],this.serializer=new nve,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=l=>{let h;return l?h=l:typeof fetch>"u"?h=(...f)=>iv(async()=>{const{default:o}=await Promise.resolve().then(()=>lv);return{default:o}},void 0).then(({default:o})=>o(...f)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):h=fetch,(...f)=>h(...f)},!(!((n=r?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${PR.websocket}`,this.httpEndpoint=RX(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Y_e.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:eve}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},t?this.conn.close(t,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case yb.connecting:return Vp.Connecting;case yb.open:return Vp.Open;case yb.closing:return Vp.Closing;default:return Vp.Closed}}isConnected(){return this.connectionState()===Vp.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,l=this.getChannels().find(h=>h.topic===n);if(l)return l;{const h=new xN(`realtime:${t}`,r,this);return this.channels.push(h),h}}push(t){const{topic:r,event:n,payload:l,ref:h}=t,f=()=>{this.encode(t,o=>{var v;(v=this.conn)===null||v===void 0||v.send(o)})};this.log("push",`${r} ${n} (${h})`,l),this.isConnected()?f():this.sendBuffer.push(f)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(tve,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},jT.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{r.topic==="phoenix"&&r.event==="phx_reply"&&this.heartbeatCallback(r.payload.status==="ok"?"ok":"error"),r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:l,payload:h,ref:f}=r,o=f?`(${f})`:"",v=h.status||"";this.log("receive",`${v} ${n} ${l} ${o}`.trim(),h),this.channels.filter(b=>b._isMember(n)).forEach(b=>b._trigger(l,h,f)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(mc.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",l=new URLSearchParams(r);return`${t}${n}${l}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([dve],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const l={access_token:r,version:Q_e};r&&n.updateJoinPayload(l),n.joinedOnce&&n._isJoined()&&n._push(mc.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(l){this.log("error",`error in ${t} callback`,l)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new OX(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},jT.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,l,h,f,o,v,b;if(this.transport=(r=t?.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t?.timeout)!==null&&n!==void 0?n:AR,this.heartbeatIntervalMs=(l=t?.heartbeatIntervalMs)!==null&&l!==void 0?l:jT.HEARTBEAT_INTERVAL,this.worker=(h=t?.worker)!==null&&h!==void 0?h:!1,this.accessToken=(f=t?.accessToken)!==null&&f!==void 0?f:null,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(o=t?.reconnectAfterMs)!==null&&o!==void 0?o:E=>uve[E-1]||hve,this.encode=(v=t?.encode)!==null&&v!==void 0?v:(E,P)=>P(JSON.stringify(E)),this.decode=(b=t?.decode)!==null&&b!==void 0?b:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}class bN extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function ns(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class pve extends bN{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class IR extends bN{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}var mve=function(e,t,r,n){function l(h){return h instanceof r?h:new r(function(f){f(h)})}return new(r||(r=Promise))(function(h,f){function o(E){try{b(n.next(E))}catch(P){f(P)}}function v(E){try{b(n.throw(E))}catch(P){f(P)}}function b(E){E.done?h(E.value):l(E.value).then(o,v)}b((n=n.apply(e,t||[])).next())})};const DX=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>iv(async()=>{const{default:n}=await Promise.resolve().then(()=>lv);return{default:n}},void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},gve=()=>mve(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield iv(()=>Promise.resolve().then(()=>lv),void 0)).Response:Response}),MR=e=>{if(Array.isArray(e))return e.map(r=>MR(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const l=r.replace(/([-_][a-z])/gi,h=>h.toUpperCase().replace(/[-_]/g,""));t[l]=MR(n)}),t},yve=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)};var Rm=function(e,t,r,n){function l(h){return h instanceof r?h:new r(function(f){f(h)})}return new(r||(r=Promise))(function(h,f){function o(E){try{b(n.next(E))}catch(P){f(P)}}function v(E){try{b(n.throw(E))}catch(P){f(P)}}function b(E){E.done?h(E.value):l(E.value).then(o,v)}b((n=n.apply(e,t||[])).next())})};const nO=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),_ve=(e,t,r)=>Rm(void 0,void 0,void 0,function*(){const n=yield gve();e instanceof n&&!r?.noResolveJson?e.json().then(l=>{const h=e.status||500,f=l?.statusCode||h+"";t(new pve(nO(l),h,f))}).catch(l=>{t(new IR(nO(l),l))}):t(new IR(nO(e),e))}),vve=(e,t,r,n)=>{const l={method:e,headers:t?.headers||{}};return e==="GET"||!n?l:(yve(n)?(l.headers=Object.assign({"Content-Type":"application/json"},t?.headers),l.body=JSON.stringify(n)):l.body=n,t?.duplex&&(l.duplex=t.duplex),Object.assign(Object.assign({},l),r))};function Jw(e,t,r,n,l,h){return Rm(this,void 0,void 0,function*(){return new Promise((f,o)=>{e(r,vve(t,n,l,h)).then(v=>{if(!v.ok)throw v;return n?.noResolveJson?v:v.json()}).then(v=>f(v)).catch(v=>_ve(v,o,n))})})}function u2(e,t,r,n){return Rm(this,void 0,void 0,function*(){return Jw(e,"GET",t,r,n)})}function au(e,t,r,n,l){return Rm(this,void 0,void 0,function*(){return Jw(e,"POST",t,n,l,r)})}function OR(e,t,r,n,l){return Rm(this,void 0,void 0,function*(){return Jw(e,"PUT",t,n,l,r)})}function xve(e,t,r,n){return Rm(this,void 0,void 0,function*(){return Jw(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function LX(e,t,r,n,l){return Rm(this,void 0,void 0,function*(){return Jw(e,"DELETE",t,n,l,r)})}var da=function(e,t,r,n){function l(h){return h instanceof r?h:new r(function(f){f(h)})}return new(r||(r=Promise))(function(h,f){function o(E){try{b(n.next(E))}catch(P){f(P)}}function v(E){try{b(n.throw(E))}catch(P){f(P)}}function b(E){E.done?h(E.value):l(E.value).then(o,v)}b((n=n.apply(e,t||[])).next())})};const bve={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eU={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class wve{constructor(t,r={},n,l){this.url=t,this.headers=r,this.bucketId=n,this.fetch=DX(l)}uploadOrUpdate(t,r,n,l){return da(this,void 0,void 0,function*(){try{let h;const f=Object.assign(Object.assign({},eU),l);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(f.upsert)});const v=f.metadata;typeof Blob<"u"&&n instanceof Blob?(h=new FormData,h.append("cacheControl",f.cacheControl),v&&h.append("metadata",this.encodeMetadata(v)),h.append("",n)):typeof FormData<"u"&&n instanceof FormData?(h=n,h.append("cacheControl",f.cacheControl),v&&h.append("metadata",this.encodeMetadata(v))):(h=n,o["cache-control"]=`max-age=${f.cacheControl}`,o["content-type"]=f.contentType,v&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),l?.headers&&(o=Object.assign(Object.assign({},o),l.headers));const b=this._removeEmptyFolders(r),E=this._getFinalPath(b),P=yield(t=="PUT"?OR:au)(this.fetch,`${this.url}/object/${E}`,h,Object.assign({headers:o},f?.duplex?{duplex:f.duplex}:{}));return{data:{path:b,id:P.Id,fullPath:P.Key},error:null}}catch(h){if(ns(h))return{data:null,error:h};throw h}})}upload(t,r,n){return da(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,l){return da(this,void 0,void 0,function*(){const h=this._removeEmptyFolders(t),f=this._getFinalPath(h),o=new URL(this.url+`/object/upload/sign/${f}`);o.searchParams.set("token",r);try{let v;const b=Object.assign({upsert:eU.upsert},l),E=Object.assign(Object.assign({},this.headers),{"x-upsert":String(b.upsert)});typeof Blob<"u"&&n instanceof Blob?(v=new FormData,v.append("cacheControl",b.cacheControl),v.append("",n)):typeof FormData<"u"&&n instanceof FormData?(v=n,v.append("cacheControl",b.cacheControl)):(v=n,E["cache-control"]=`max-age=${b.cacheControl}`,E["content-type"]=b.contentType);const P=yield OR(this.fetch,o.toString(),v,{headers:E});return{data:{path:h,fullPath:P.Key},error:null}}catch(v){if(ns(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(t,r){return da(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const l=Object.assign({},this.headers);r?.upsert&&(l["x-upsert"]="true");const h=yield au(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:l}),f=new URL(this.url+h.url),o=f.searchParams.get("token");if(!o)throw new bN("No token returned by API");return{data:{signedUrl:f.toString(),path:t,token:o},error:null}}catch(n){if(ns(n))return{data:null,error:n};throw n}})}update(t,r,n){return da(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return da(this,void 0,void 0,function*(){try{return{data:yield au(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(l){if(ns(l))return{data:null,error:l};throw l}})}copy(t,r,n){return da(this,void 0,void 0,function*(){try{return{data:{path:(yield au(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(l){if(ns(l))return{data:null,error:l};throw l}})}createSignedUrl(t,r,n){return da(this,void 0,void 0,function*(){try{let l=this._getFinalPath(t),h=yield au(this.fetch,`${this.url}/object/sign/${l}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const f=n?.download?`&download=${n.download===!0?"":n.download}`:"";return h={signedUrl:encodeURI(`${this.url}${h.signedURL}${f}`)},{data:h,error:null}}catch(l){if(ns(l))return{data:null,error:l};throw l}})}createSignedUrls(t,r,n){return da(this,void 0,void 0,function*(){try{const l=yield au(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),h=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:l.map(f=>Object.assign(Object.assign({},f),{signedUrl:f.signedURL?encodeURI(`${this.url}${f.signedURL}${h}`):null})),error:null}}catch(l){if(ns(l))return{data:null,error:l};throw l}})}download(t,r){return da(this,void 0,void 0,function*(){const l=typeof r?.transform<"u"?"render/image/authenticated":"object",h=this.transformOptsToQueryString(r?.transform||{}),f=h?`?${h}`:"";try{const o=this._getFinalPath(t);return{data:yield(yield u2(this.fetch,`${this.url}/${l}/${o}${f}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(ns(o))return{data:null,error:o};throw o}})}info(t){return da(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield u2(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:MR(n),error:null}}catch(n){if(ns(n))return{data:null,error:n};throw n}})}exists(t){return da(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield xve(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(ns(n)&&n instanceof IR){const l=n.originalError;if([400,404].includes(l?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),l=[],h=r?.download?`download=${r.download===!0?"":r.download}`:"";h!==""&&l.push(h);const o=typeof r?.transform<"u"?"render/image":"object",v=this.transformOptsToQueryString(r?.transform||{});v!==""&&l.push(v);let b=l.join("&");return b!==""&&(b=`?${b}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${b}`)}}}remove(t){return da(this,void 0,void 0,function*(){try{return{data:yield LX(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(ns(r))return{data:null,error:r};throw r}})}list(t,r,n){return da(this,void 0,void 0,function*(){try{const l=Object.assign(Object.assign(Object.assign({},bve),r),{prefix:t||""});return{data:yield au(this.fetch,`${this.url}/object/list/${this.bucketId}`,l,{headers:this.headers},n),error:null}}catch(l){if(ns(l))return{data:null,error:l};throw l}})}listV2(t,r){return da(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield au(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(ns(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const Sve="2.11.0",Tve={"X-Client-Info":`storage-js/${Sve}`};var oy=function(e,t,r,n){function l(h){return h instanceof r?h:new r(function(f){f(h)})}return new(r||(r=Promise))(function(h,f){function o(E){try{b(n.next(E))}catch(P){f(P)}}function v(E){try{b(n.throw(E))}catch(P){f(P)}}function b(E){E.done?h(E.value):l(E.value).then(o,v)}b((n=n.apply(e,t||[])).next())})};class Eve{constructor(t,r={},n,l){const h=new URL(t);l?.useNewHostname&&/supabase\.(co|in|red)$/.test(h.hostname)&&!h.hostname.includes("storage.supabase.")&&(h.hostname=h.hostname.replace("supabase.","storage.supabase.")),this.url=h.href,this.headers=Object.assign(Object.assign({},Tve),r),this.fetch=DX(n)}listBuckets(){return oy(this,void 0,void 0,function*(){try{return{data:yield u2(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(ns(t))return{data:null,error:t};throw t}})}getBucket(t){return oy(this,void 0,void 0,function*(){try{return{data:yield u2(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(ns(r))return{data:null,error:r};throw r}})}createBucket(t,r={public:!1}){return oy(this,void 0,void 0,function*(){try{return{data:yield au(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ns(n))return{data:null,error:n};throw n}})}updateBucket(t,r){return oy(this,void 0,void 0,function*(){try{return{data:yield OR(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ns(n))return{data:null,error:n};throw n}})}emptyBucket(t){return oy(this,void 0,void 0,function*(){try{return{data:yield au(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(ns(r))return{data:null,error:r};throw r}})}deleteBucket(t){return oy(this,void 0,void 0,function*(){try{return{data:yield LX(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(ns(r))return{data:null,error:r};throw r}})}}class Ave extends Eve{constructor(t,r={},n,l){super(t,r,n,l)}from(t){return new wve(this.url,this.headers,t,this.fetch)}}const Pve="2.56.0";let Yx="";typeof Deno<"u"?Yx="deno":typeof document<"u"?Yx="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Yx="react-native":Yx="node";const Cve={"X-Client-Info":`supabase-js-${Yx}/${Pve}`},Ive={headers:Cve},Mve={schema:"public"},Ove={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},kve={};var Rve=function(e,t,r,n){function l(h){return h instanceof r?h:new r(function(f){f(h)})}return new(r||(r=Promise))(function(h,f){function o(E){try{b(n.next(E))}catch(P){f(P)}}function v(E){try{b(n.throw(E))}catch(P){f(P)}}function b(E){E.done?h(E.value):l(E.value).then(o,v)}b((n=n.apply(e,t||[])).next())})};const Dve=e=>{let t;return e?t=e:typeof fetch>"u"?t=xX:t=fetch,(...r)=>t(...r)},Lve=()=>typeof Headers>"u"?bX:Headers,jve=(e,t,r)=>{const n=Dve(r),l=Lve();return(h,f)=>Rve(void 0,void 0,void 0,function*(){var o;const v=(o=yield t())!==null&&o!==void 0?o:e;let b=new l(f?.headers);return b.has("apikey")||b.set("apikey",e),b.has("Authorization")||b.set("Authorization",`Bearer ${v}`),n(h,Object.assign(Object.assign({},f),{headers:b}))})};var Nve=function(e,t,r,n){function l(h){return h instanceof r?h:new r(function(f){f(h)})}return new(r||(r=Promise))(function(h,f){function o(E){try{b(n.next(E))}catch(P){f(P)}}function v(E){try{b(n.throw(E))}catch(P){f(P)}}function b(E){E.done?h(E.value):l(E.value).then(o,v)}b((n=n.apply(e,t||[])).next())})};function zve(e){return e.endsWith("/")?e:e+"/"}function Fve(e,t){var r,n;const{db:l,auth:h,realtime:f,global:o}=e,{db:v,auth:b,realtime:E,global:P}=t,O={db:Object.assign(Object.assign({},v),l),auth:Object.assign(Object.assign({},b),h),realtime:Object.assign(Object.assign({},E),f),storage:{},global:Object.assign(Object.assign(Object.assign({},P),o),{headers:Object.assign(Object.assign({},(r=P?.headers)!==null&&r!==void 0?r:{}),(n=o?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>Nve(this,void 0,void 0,function*(){return""})};return e.accessToken?O.accessToken=e.accessToken:delete O.accessToken,O}const jX="2.71.1",gy=30*1e3,kR=3,iO=kR*gy,Bve="http://localhost:9999",$ve="supabase.auth.token",Vve={"X-Client-Info":`gotrue-js/${jX}`},RR="X-Supabase-Api-Version",NX={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Uve=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Gve=10*60*1e3;class wN extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function $n(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class Hve extends wN{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function Wve(e){return $n(e)&&e.name==="AuthApiError"}class zX extends wN{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Tf extends wN{constructor(t,r,n,l){super(t,n,l),this.name=r,this.status=n}}class Nd extends Tf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function qve(e){return $n(e)&&e.name==="AuthSessionMissingError"}class NT extends Tf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class zT extends Tf{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class FT extends Tf{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Zve(e){return $n(e)&&e.name==="AuthImplicitGrantRedirectError"}class tU extends Tf{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class DR extends Tf{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function oO(e){return $n(e)&&e.name==="AuthRetryableFetchError"}class rU extends Tf{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class LR extends Tf{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const h2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),nU=` 	
\r=`.split(""),Xve=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<nU.length;t+=1)e[nU[t].charCodeAt(0)]=-2;for(let t=0;t<h2.length;t+=1)e[h2[t].charCodeAt(0)]=t;return e})();function iU(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(h2[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(h2[n]),t.queuedBits-=6}}function FX(e,t,r){const n=Xve[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function oU(e){const t=[],r=f=>{t.push(String.fromCodePoint(f))},n={utf8seq:0,codepoint:0},l={queue:0,queuedBits:0},h=f=>{Jve(f,n,r)};for(let f=0;f<e.length;f+=1)FX(e.charCodeAt(f),l,h);return t.join("")}function Kve(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function Yve(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const l=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|l)+65536,r+=1}Kve(n,t)}}function Jve(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function Qve(e){const t=[],r={queue:0,queuedBits:0},n=l=>{t.push(l)};for(let l=0;l<e.length;l+=1)FX(e.charCodeAt(l),r,n);return new Uint8Array(t)}function e0e(e){const t=[];return Yve(e,r=>t.push(r)),new Uint8Array(t)}function t0e(e){const t=[],r={queue:0,queuedBits:0},n=l=>{t.push(l)};return e.forEach(l=>iU(l,r,n)),iU(null,r,n),t.join("")}function r0e(e){return Math.round(Date.now()/1e3)+e}function n0e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const ac=()=>typeof window<"u"&&typeof document<"u",Ip={tested:!1,writable:!1},BX=()=>{if(!ac())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ip.tested)return Ip.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Ip.tested=!0,Ip.writable=!0}catch{Ip.tested=!0,Ip.writable=!1}return Ip.writable};function i0e(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((l,h)=>{t[h]=l})}catch{}return r.searchParams.forEach((n,l)=>{t[l]=n}),t}const $X=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>iv(async()=>{const{default:n}=await Promise.resolve().then(()=>lv);return{default:n}},void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},o0e=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",yy=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Mp=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Dd=async(e,t)=>{await e.removeItem(t)};class rP{constructor(){this.promise=new rP.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}rP.promiseConstructor=Promise;function sO(e){const t=e.split(".");if(t.length!==3)throw new LR("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!Uve.test(t[n]))throw new LR("JWT not in base64url format");return{header:JSON.parse(oU(t[0])),payload:JSON.parse(oU(t[1])),signature:Qve(t[2]),raw:{header:t[0],payload:t[1]}}}async function s0e(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function a0e(e,t){return new Promise((n,l)=>{(async()=>{for(let h=0;h<1/0;h++)try{const f=await e(h);if(!t(h,null,f)){n(f);return}}catch(f){if(!t(h,f)){l(f);return}}})()})}function l0e(e){return("0"+e.toString(16)).substr(-2)}function c0e(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let l="";for(let h=0;h<56;h++)l+=r.charAt(Math.floor(Math.random()*n));return l}return crypto.getRandomValues(t),Array.from(t,l0e).join("")}async function u0e(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),l=new Uint8Array(n);return Array.from(l).map(h=>String.fromCharCode(h)).join("")}async function h0e(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await u0e(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function sy(e,t,r=!1){const n=c0e();let l=n;r&&(l+="/PASSWORD_RECOVERY"),await yy(e,`${t}-code-verifier`,l);const h=await h0e(n);return[h,n===h?"plain":"s256"]}const d0e=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function f0e(e){const t=e.headers.get(RR);if(!t||!t.match(d0e))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function p0e(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function m0e(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const g0e=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ay(e){if(!g0e.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function aO(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function sU(e){return JSON.parse(JSON.stringify(e))}var y0e=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(r[n[l]]=e[n[l]]);return r};const Np=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),_0e=[502,503,504];async function aU(e){var t;if(!o0e(e))throw new DR(Np(e),0);if(_0e.includes(e.status))throw new DR(Np(e),e.status);let r;try{r=await e.json()}catch(h){throw new zX(Np(h),h)}let n;const l=f0e(e);if(l&&l.getTime()>=NX["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new rU(Np(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new Nd}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((h,f)=>h&&typeof f=="string",!0))throw new rU(Np(r),e.status,r.weak_password.reasons);throw new Hve(Np(r),e.status||500,n)}const v0e=(e,t,r,n)=>{const l={method:e,headers:t?.headers||{}};return e==="GET"?l:(l.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),l.body=JSON.stringify(n),Object.assign(Object.assign({},l),r))};async function oi(e,t,r,n){var l;const h=Object.assign({},n?.headers);h[RR]||(h[RR]=NX["2024-01-01"].name),n?.jwt&&(h.Authorization=`Bearer ${n.jwt}`);const f=(l=n?.query)!==null&&l!==void 0?l:{};n?.redirectTo&&(f.redirect_to=n.redirectTo);const o=Object.keys(f).length?"?"+new URLSearchParams(f).toString():"",v=await x0e(e,t,r+o,{headers:h,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(v):{data:Object.assign({},v),error:null}}async function x0e(e,t,r,n,l,h){const f=v0e(t,n,l,h);let o;try{o=await e(r,Object.assign({},f))}catch(v){throw console.error(v),new DR(Np(v),0)}if(o.ok||await aU(o),n?.noResolveJson)return o;try{return await o.json()}catch(v){await aU(v)}}function ih(e){var t;let r=null;T0e(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=r0e(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function lU(e){const t=ih(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Wd(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function b0e(e){return{data:e,error:null}}function w0e(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:l,verification_type:h}=e,f=y0e(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:r,hashed_token:n,redirect_to:l,verification_type:h},v=Object.assign({},f);return{data:{properties:o,user:v},error:null}}function S0e(e){return e}function T0e(e){return e.access_token&&e.refresh_token&&e.expires_in}const lO=["global","local","others"];var E0e=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(r[n[l]]=e[n[l]]);return r};class A0e{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=$X(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,r=lO[0]){if(lO.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${lO.join(", ")}`);try{return await oi(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if($n(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await oi(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Wd})}catch(n){if($n(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=E0e(t,["options"]),l=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(l.new_email=n?.newEmail,delete l.newEmail),await oi(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:l,headers:this.headers,xform:w0e,redirectTo:r?.redirectTo})}catch(r){if($n(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await oi(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Wd})}catch(r){if($n(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,l,h,f,o,v;try{const b={nextPage:null,lastPage:0,total:0},E=await oi(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(h=(l=t?.perPage)===null||l===void 0?void 0:l.toString())!==null&&h!==void 0?h:""},xform:S0e});if(E.error)throw E.error;const P=await E.json(),O=(f=E.headers.get("x-total-count"))!==null&&f!==void 0?f:0,L=(v=(o=E.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&v!==void 0?v:[];return L.length>0&&(L.forEach(B=>{const z=parseInt(B.split(";")[0].split("=")[1].substring(0,1)),$=JSON.parse(B.split(";")[1].split("=")[1]);b[`${$}Page`]=z}),b.total=parseInt(O)),{data:Object.assign(Object.assign({},P),b),error:null}}catch(b){if($n(b))return{data:{users:[]},error:b};throw b}}async getUserById(t){ay(t);try{return await oi(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Wd})}catch(r){if($n(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){ay(t);try{return await oi(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Wd})}catch(n){if($n(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){ay(t);try{return await oi(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Wd})}catch(n){if($n(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){ay(t.userId);try{const{data:r,error:n}=await oi(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:l=>({data:{factors:l},error:null})});return{data:r,error:n}}catch(r){if($n(r))return{data:null,error:r};throw r}}async _deleteFactor(t){ay(t.userId),ay(t.id);try{return{data:await oi(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if($n(r))return{data:null,error:r};throw r}}}function cU(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}function P0e(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ly={debug:!!(globalThis&&BX()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class VX extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class C0e extends VX{}async function I0e(e,t,r){ly.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),ly.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async l=>{if(l){ly.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,l.name);try{return await r()}finally{ly.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,l.name)}}else{if(t===0)throw ly.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new C0e(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(ly.debug)try{const h=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(h,null,"  "))}catch(h){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",h)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}P0e();const M0e={url:Bve,storageKey:$ve,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Vve,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function uU(e,t,r){return await r()}const cy={};class ew{constructor(t){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ew.nextInstanceID,ew.nextInstanceID+=1,this.instanceID>0&&ac()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const l=Object.assign(Object.assign({},M0e),t);if(this.logDebugMessages=!!l.debug,typeof l.debug=="function"&&(this.logger=l.debug),this.persistSession=l.persistSession,this.storageKey=l.storageKey,this.autoRefreshToken=l.autoRefreshToken,this.admin=new A0e({url:l.url,headers:l.headers,fetch:l.fetch}),this.url=l.url,this.headers=l.headers,this.fetch=$X(l.fetch),this.lock=l.lock||uU,this.detectSessionInUrl=l.detectSessionInUrl,this.flowType=l.flowType,this.hasCustomAuthorizationHeader=l.hasCustomAuthorizationHeader,l.lock?this.lock=l.lock:ac()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=I0e:this.lock=uU,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(l.storage?this.storage=l.storage:BX()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=cU(this.memoryStorage)),l.userStorage&&(this.userStorage=l.userStorage)):(this.memoryStorage={},this.storage=cU(this.memoryStorage)),ac()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(h){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",h)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async h=>{this._debug("received broadcast notification from other tab or client",h),await this._notifyAllSubscribers(h.data.event,h.data.session,!1)})}this.initialize()}get jwks(){var t,r;return(r=(t=cy[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){cy[this.storageKey]=Object.assign(Object.assign({},cy[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=cy[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){cy[this.storageKey]=Object.assign(Object.assign({},cy[this.storageKey]),{cachedAt:t})}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${jX}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const r=i0e(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),ac()&&this.detectSessionInUrl&&n!=="none"){const{data:l,error:h}=await this._getSessionFromURL(r,n);if(h){if(this._debug("#_initialize()","error detecting session from URL",h),Zve(h)){const v=(t=h.details)===null||t===void 0?void 0:t.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:h}}return await this._removeSession(),{error:h}}const{session:f,redirectType:o}=l;return this._debug("#_initialize()","detected session in URL",f,"redirect type",o),await this._saveSession(f),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",f):await this._notifyAllSubscribers("SIGNED_IN",f)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return $n(r)?{error:r}:{error:new zX("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,l;try{const h=await oi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(l=t?.options)===null||l===void 0?void 0:l.captchaToken}},xform:ih}),{data:f,error:o}=h;if(o||!f)return{data:{user:null,session:null},error:o};const v=f.session,b=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:b,session:v},error:null}}catch(h){if($n(h))return{data:{user:null,session:null},error:h};throw h}}async signUp(t){var r,n,l;try{let h;if("email"in t){const{email:E,password:P,options:O}=t;let L=null,B=null;this.flowType==="pkce"&&([L,B]=await sy(this.storage,this.storageKey)),h=await oi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:O?.emailRedirectTo,body:{email:E,password:P,data:(r=O?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:O?.captchaToken},code_challenge:L,code_challenge_method:B},xform:ih})}else if("phone"in t){const{phone:E,password:P,options:O}=t;h=await oi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:E,password:P,data:(n=O?.data)!==null&&n!==void 0?n:{},channel:(l=O?.channel)!==null&&l!==void 0?l:"sms",gotrue_meta_security:{captcha_token:O?.captchaToken}},xform:ih})}else throw new zT("You must provide either an email or phone number and a password");const{data:f,error:o}=h;if(o||!f)return{data:{user:null,session:null},error:o};const v=f.session,b=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:b,session:v},error:null}}catch(h){if($n(h))return{data:{user:null,session:null},error:h};throw h}}async signInWithPassword(t){try{let r;if("email"in t){const{email:h,password:f,options:o}=t;r=await oi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:h,password:f,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:lU})}else if("phone"in t){const{phone:h,password:f,options:o}=t;r=await oi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:h,password:f,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:lU})}else throw new zT("You must provide either an email or phone number and a password");const{data:n,error:l}=r;return l?{data:{user:null,session:null},error:l}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new NT}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:l})}catch(r){if($n(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(t){var r,n,l,h;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:(h=t.options)===null||h===void 0?void 0:h.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;if(r==="solana")return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(t){var r,n,l,h,f,o,v,b,E,P,O,L;let B,z;if("message"in t)B=t.message,z=t.signature;else{const{chain:$,wallet:U,statement:G,options:Z}=t;let ne;if(ac())if(typeof U=="object")ne=U;else{const ee=window;if("solana"in ee&&typeof ee.solana=="object"&&("signIn"in ee.solana&&typeof ee.solana.signIn=="function"||"signMessage"in ee.solana&&typeof ee.solana.signMessage=="function"))ne=ee.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof U!="object"||!Z?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ne=U}const Y=new URL((r=Z?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in ne&&ne.signIn){const ee=await ne.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Z?.signInWithSolana),{version:"1",domain:Y.host,uri:Y.href}),G?{statement:G}:null));let le;if(Array.isArray(ee)&&ee[0]&&typeof ee[0]=="object")le=ee[0];else if(ee&&typeof ee=="object"&&"signedMessage"in ee&&"signature"in ee)le=ee;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in le&&"signature"in le&&(typeof le.signedMessage=="string"||le.signedMessage instanceof Uint8Array)&&le.signature instanceof Uint8Array)B=typeof le.signedMessage=="string"?le.signedMessage:new TextDecoder().decode(le.signedMessage),z=le.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in ne)||typeof ne.signMessage!="function"||!("publicKey"in ne)||typeof ne!="object"||!ne.publicKey||!("toBase58"in ne.publicKey)||typeof ne.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");B=[`${Y.host} wants you to sign in with your Solana account:`,ne.publicKey.toBase58(),...G?["",G,""]:[""],"Version: 1",`URI: ${Y.href}`,`Issued At: ${(l=(n=Z?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&l!==void 0?l:new Date().toISOString()}`,...!((h=Z?.signInWithSolana)===null||h===void 0)&&h.notBefore?[`Not Before: ${Z.signInWithSolana.notBefore}`]:[],...!((f=Z?.signInWithSolana)===null||f===void 0)&&f.expirationTime?[`Expiration Time: ${Z.signInWithSolana.expirationTime}`]:[],...!((o=Z?.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${Z.signInWithSolana.chainId}`]:[],...!((v=Z?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${Z.signInWithSolana.nonce}`]:[],...!((b=Z?.signInWithSolana)===null||b===void 0)&&b.requestId?[`Request ID: ${Z.signInWithSolana.requestId}`]:[],...!((P=(E=Z?.signInWithSolana)===null||E===void 0?void 0:E.resources)===null||P===void 0)&&P.length?["Resources",...Z.signInWithSolana.resources.map(le=>`- ${le}`)]:[]].join(`
`);const ee=await ne.signMessage(new TextEncoder().encode(B),"utf8");if(!ee||!(ee instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");z=ee}}try{const{data:$,error:U}=await oi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:B,signature:t0e(z)},!((O=t.options)===null||O===void 0)&&O.captchaToken?{gotrue_meta_security:{captcha_token:(L=t.options)===null||L===void 0?void 0:L.captchaToken}}:null),xform:ih});if(U)throw U;return!$||!$.session||!$.user?{data:{user:null,session:null},error:new NT}:($.session&&(await this._saveSession($.session),await this._notifyAllSubscribers("SIGNED_IN",$.session)),{data:Object.assign({},$),error:U})}catch($){if($n($))return{data:{user:null,session:null},error:$};throw $}}async _exchangeCodeForSession(t){const r=await Mp(this.storage,`${this.storageKey}-code-verifier`),[n,l]=(r??"").split("/");try{const{data:h,error:f}=await oi(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:ih});if(await Dd(this.storage,`${this.storageKey}-code-verifier`),f)throw f;return!h||!h.session||!h.user?{data:{user:null,session:null,redirectType:null},error:new NT}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:Object.assign(Object.assign({},h),{redirectType:l??null}),error:f})}catch(h){if($n(h))return{data:{user:null,session:null,redirectType:null},error:h};throw h}}async signInWithIdToken(t){try{const{options:r,provider:n,token:l,access_token:h,nonce:f}=t,o=await oi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:l,access_token:h,nonce:f,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:ih}),{data:v,error:b}=o;return b?{data:{user:null,session:null},error:b}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new NT}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:b})}catch(r){if($n(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(t){var r,n,l,h,f;try{if("email"in t){const{email:o,options:v}=t;let b=null,E=null;this.flowType==="pkce"&&([b,E]=await sy(this.storage,this.storageKey));const{error:P}=await oi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=v?.data)!==null&&r!==void 0?r:{},create_user:(n=v?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:b,code_challenge_method:E},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:P}}if("phone"in t){const{phone:o,options:v}=t,{data:b,error:E}=await oi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(l=v?.data)!==null&&l!==void 0?l:{},create_user:(h=v?.shouldCreateUser)!==null&&h!==void 0?h:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(f=v?.channel)!==null&&f!==void 0?f:"sms"}});return{data:{user:null,session:null,messageId:b?.message_id},error:E}}throw new zT("You must provide either an email or phone number.")}catch(o){if($n(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var r,n;try{let l,h;"options"in t&&(l=(r=t.options)===null||r===void 0?void 0:r.redirectTo,h=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:f,error:o}=await oi(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:h}}),redirectTo:l,xform:ih});if(o)throw o;if(!f)throw new Error("An error occurred on token verification.");const v=f.session,b=f.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:b,session:v},error:null}}catch(l){if($n(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithSSO(t){var r,n,l;try{let h=null,f=null;return this.flowType==="pkce"&&([h,f]=await sy(this.storage,this.storageKey)),await oi(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((l=t?.options)===null||l===void 0)&&l.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:f}),headers:this.headers,xform:b0e})}catch(h){if($n(h))return{data:null,error:h};throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new Nd;const{error:l}=await oi(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:l}})}catch(t){if($n(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:l,options:h}=t,{error:f}=await oi(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:l,gotrue_meta_security:{captcha_token:h?.captchaToken}},redirectTo:h?.emailRedirectTo});return{data:{user:null,session:null},error:f}}else if("phone"in t){const{phone:n,type:l,options:h}=t,{data:f,error:o}=await oi(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:l,gotrue_meta_security:{captcha_token:h?.captchaToken}}});return{data:{user:null,session:null,messageId:f?.message_id},error:o}}throw new zT("You must provide either an email or phone number and a type")}catch(r){if($n(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),l=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await l}catch{}})()),l}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const l=[...this.pendingInLock];await Promise.all(l),this.pendingInLock.splice(0,l.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Mp(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<iO:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const f=await Mp(this.userStorage,this.storageKey+"-user");f?.user?t.user=f.user:t.user=aO()}if(this.storage.isServer&&t.user){let f=this.suppressGetSessionWarning;t=new Proxy(t,{get:(v,b,E)=>(!f&&b==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),f=!0,this.suppressGetSessionWarning=!0),Reflect.get(v,b,E))})}return{data:{session:t},error:null}}const{session:l,error:h}=await this._callRefreshToken(t.refresh_token);return h?{data:{session:null},error:h}:{data:{session:l},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await oi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Wd}):await this._useSession(async r=>{var n,l,h;const{data:f,error:o}=r;if(o)throw o;return!(!((n=f.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Nd}:await oi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(h=(l=f.session)===null||l===void 0?void 0:l.access_token)!==null&&h!==void 0?h:void 0,xform:Wd})})}catch(r){if($n(r))return qve(r)&&(await this._removeSession(),await Dd(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:l,error:h}=n;if(h)throw h;if(!l.session)throw new Nd;const f=l.session;let o=null,v=null;this.flowType==="pkce"&&t.email!=null&&([o,v]=await sy(this.storage,this.storageKey));const{data:b,error:E}=await oi(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:v}),jwt:f.access_token,xform:Wd});if(E)throw E;return f.user=b.user,await this._saveSession(f),await this._notifyAllSubscribers("USER_UPDATED",f),{data:{user:f.user},error:null}})}catch(n){if($n(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Nd;const r=Date.now()/1e3;let n=r,l=!0,h=null;const{payload:f}=sO(t.access_token);if(f.exp&&(n=f.exp,l=n<=r),l){const{session:o,error:v}=await this._callRefreshToken(t.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!o)return{data:{user:null,session:null},error:null};h=o}else{const{data:o,error:v}=await this._getUser(t.access_token);if(v)throw v;h={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(h),await this._notifyAllSubscribers("SIGNED_IN",h)}return{data:{user:h.user,session:h},error:null}}catch(r){if($n(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:f,error:o}=r;if(o)throw o;t=(n=f.session)!==null&&n!==void 0?n:void 0}if(!t?.refresh_token)throw new Nd;const{session:l,error:h}=await this._callRefreshToken(t.refresh_token);return h?{data:{user:null,session:null},error:h}:l?{data:{user:l.user,session:l},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if($n(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(t,r){try{if(!ac())throw new FT("No browser detected.");if(t.error||t.error_description||t.error_code)throw new FT(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new tU("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new FT("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new tU("No code detected.");const{data:G,error:Z}=await this._exchangeCodeForSession(t.code);if(Z)throw Z;const ne=new URL(window.location.href);return ne.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ne.toString()),{data:{session:G.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:l,access_token:h,refresh_token:f,expires_in:o,expires_at:v,token_type:b}=t;if(!h||!o||!f||!b)throw new FT("No session defined in URL");const E=Math.round(Date.now()/1e3),P=parseInt(o);let O=E+P;v&&(O=parseInt(v));const L=O-E;L*1e3<=gy&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${L}s, should have been closer to ${P}s`);const B=O-P;E-B>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",B,O,E):E-B<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",B,O,E);const{data:z,error:$}=await this._getUser(h);if($)throw $;const U={provider_token:n,provider_refresh_token:l,access_token:h,expires_in:P,expires_at:O,refresh_token:f,token_type:b,user:z.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:U,redirectType:t.type},error:null}}catch(n){if($n(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Mp(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:l,error:h}=r;if(h)return{error:h};const f=(n=l.session)===null||n===void 0?void 0:n.access_token;if(f){const{error:o}=await this.admin.signOut(f,t);if(o&&!(Wve(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return t!=="others"&&(await this._removeSession(),await Dd(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const r=n0e(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,l;try{const{data:{session:h},error:f}=r;if(f)throw f;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",h)),this._debug("INITIAL_SESSION","callback id",t,"session",h)}catch(h){await((l=this.stateChangeEmitters.get(t))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",h),console.error(h)}})}async resetPasswordForEmail(t,r={}){let n=null,l=null;this.flowType==="pkce"&&([n,l]=await sy(this.storage,this.storageKey,!0));try{return await oi(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:l,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(h){if($n(h))return{data:null,error:h};throw h}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(r){if($n(r))return{data:null,error:r};throw r}}async linkIdentity(t){var r;try{const{data:n,error:l}=await this._useSession(async h=>{var f,o,v,b,E;const{data:P,error:O}=h;if(O)throw O;const L=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(f=t.options)===null||f===void 0?void 0:f.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(v=t.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await oi(this.fetch,"GET",L,{headers:this.headers,jwt:(E=(b=P.session)===null||b===void 0?void 0:b.access_token)!==null&&E!==void 0?E:void 0})});if(l)throw l;return ac()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:t.provider,url:n?.url},error:null}}catch(n){if($n(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,l;const{data:h,error:f}=r;if(f)throw f;return await oi(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(l=(n=h.session)===null||n===void 0?void 0:n.access_token)!==null&&l!==void 0?l:void 0})})}catch(r){if($n(r))return{data:null,error:r};throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await a0e(async l=>(l>0&&await s0e(200*Math.pow(2,l-1)),this._debug(r,"refreshing attempt",l),await oi(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:ih})),(l,h)=>{const f=200*Math.pow(2,l);return h&&oO(h)&&Date.now()+f-n<gy})}catch(n){if(this._debug(r,"error",n),$n(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),ac()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const l=await Mp(this.storage,this.storageKey);if(l&&this.userStorage){let f=await Mp(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!f&&(f={user:l.user},await yy(this.userStorage,this.storageKey+"-user",f)),l.user=(t=f?.user)!==null&&t!==void 0?t:aO()}else if(l&&!l.user&&!l.user){const f=await Mp(this.storage,this.storageKey+"-user");f&&f?.user?(l.user=f.user,await Dd(this.storage,this.storageKey+"-user"),await yy(this.storage,this.storageKey,l)):l.user=aO()}if(this._debug(n,"session from storage",l),!this._isValidSession(l)){this._debug(n,"session is not valid"),l!==null&&await this._removeSession();return}const h=((r=l.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<iO;if(this._debug(n,`session has${h?"":" not"} expired with margin of ${iO}s`),h){if(this.autoRefreshToken&&l.refresh_token){const{error:f}=await this._callRefreshToken(l.refresh_token);f&&(console.error(f),oO(f)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",f),await this._removeSession()))}}else if(l.user&&l.user.__isUserNotAvailableProxy===!0)try{const{data:f,error:o}=await this._getUser(l.access_token);!o&&f?.user?(l.user=f.user,await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(f){console.error("Error getting user data:",f),this._debug(n,"error getting user data, skipping SIGNED_IN notification",f)}else await this._notifyAllSubscribers("SIGNED_IN",l)}catch(l){this._debug(n,"error",l),console.error(l);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new Nd;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const l=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(l,"begin");try{this.refreshingDeferred=new rP;const{data:h,error:f}=await this._refreshAccessToken(t);if(f)throw f;if(!h.session)throw new Nd;await this._saveSession(h.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",h.session);const o={session:h.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(h){if(this._debug(l,"error",h),$n(h)){const f={session:null,error:h};return oO(h)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(f),f}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(h),h}finally{this.refreshingDeferred=null,this._debug(l,"end")}}async _notifyAllSubscribers(t,r,n=!0){const l=`#_notifyAllSubscribers(${t})`;this._debug(l,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const h=[],f=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,r)}catch(v){h.push(v)}});if(await Promise.all(f),h.length>0){for(let o=0;o<h.length;o+=1)console.error(h[o]);throw h[0]}}finally{this._debug(l,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await yy(this.userStorage,this.storageKey+"-user",{user:r.user});const l=Object.assign({},r);delete l.user;const h=sU(l);await yy(this.storage,this.storageKey,h)}else{const l=sU(r);await yy(this.storage,this.storageKey,l)}}async _removeSession(){this._debug("#_removeSession()"),await Dd(this.storage,this.storageKey),await Dd(this.storage,this.storageKey+"-code-verifier"),await Dd(this.storage,this.storageKey+"-user"),this.userStorage&&await Dd(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ac()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),gy);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const l=Math.floor((n.expires_at*1e3-t)/gy);this._debug("#_autoRefreshTokenTick()",`access token expires in ${l} ticks, a tick lasts ${gy}ms, refresh threshold is ${kR} ticks`),l<=kR&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof VX)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ac()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const l=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&l.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&l.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[h,f]=await sy(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(h)}`,code_challenge_method:`${encodeURIComponent(f)}`});l.push(o.toString())}if(n?.queryParams){const h=new URLSearchParams(n.queryParams);l.push(h.toString())}return n?.skipBrowserRedirect&&l.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${l.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:l,error:h}=r;return h?{data:null,error:h}:await oi(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=l?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if($n(r))return{data:null,error:r};throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,l;const{data:h,error:f}=r;if(f)return{data:null,error:f};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:v,error:b}=await oi(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=h?.session)===null||n===void 0?void 0:n.access_token});return b?{data:null,error:b}:(t.factorType==="totp"&&(!((l=v?.totp)===null||l===void 0)&&l.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(r){if($n(r))return{data:null,error:r};throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:l,error:h}=r;if(h)return{data:null,error:h};const{data:f,error:o}=await oi(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(n=l?.session)===null||n===void 0?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+f.expires_in},f)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",f),{data:f,error:o})})}catch(r){if($n(r))return{data:null,error:r};throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:l,error:h}=r;return h?{data:null,error:h}:await oi(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(n=l?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if($n(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=t?.factors||[],l=n.filter(f=>f.factor_type==="totp"&&f.status==="verified"),h=n.filter(f=>f.factor_type==="phone"&&f.status==="verified");return{data:{all:n,totp:l,phone:h},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var r,n;const{data:{session:l},error:h}=t;if(h)return{data:null,error:h};if(!l)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:f}=sO(l.access_token);let o=null;f.aal&&(o=f.aal);let v=o;((n=(r=l.user.factors)===null||r===void 0?void 0:r.filter(P=>P.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(v="aal2");const E=f.amr||[];return{data:{currentLevel:o,nextLevel:v,currentAuthenticationMethods:E},error:null}}))}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(o=>o.kid===t);if(n)return n;const l=Date.now();if(n=this.jwks.keys.find(o=>o.kid===t),n&&this.jwks_cached_at+Gve>l)return n;const{data:h,error:f}=await oi(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(f)throw f;return!h.keys||h.keys.length===0||(this.jwks=h,this.jwks_cached_at=l,n=h.keys.find(o=>o.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:L,error:B}=await this.getSession();if(B||!L.session)return{data:null,error:B};n=L.session.access_token}const{header:l,payload:h,signature:f,raw:{header:o,payload:v}}=sO(n);r?.allowExpired||p0e(h.exp);const b=!l.alg||l.alg.startsWith("HS")||!l.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(l.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!b){const{error:L}=await this.getUser(n);if(L)throw L;return{data:{claims:h,header:l,signature:f},error:null}}const E=m0e(l.alg),P=await crypto.subtle.importKey("jwk",b,E,!0,["verify"]);if(!await crypto.subtle.verify(E,P,f,e0e(`${o}.${v}`)))throw new LR("Invalid JWT signature");return{data:{claims:h,header:l,signature:f},error:null}}catch(n){if($n(n))return{data:null,error:n};throw n}}}ew.nextInstanceID=0;const O0e=ew;class k0e extends O0e{constructor(t){super(t)}}var R0e=function(e,t,r,n){function l(h){return h instanceof r?h:new r(function(f){f(h)})}return new(r||(r=Promise))(function(h,f){function o(E){try{b(n.next(E))}catch(P){f(P)}}function v(E){try{b(n.throw(E))}catch(P){f(P)}}function b(E){E.done?h(E.value):l(E.value).then(o,v)}b((n=n.apply(e,t||[])).next())})};class D0e{constructor(t,r,n){var l,h,f;if(this.supabaseUrl=t,this.supabaseKey=r,!t)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const o=zve(t),v=new URL(o);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const b=`sb-${v.hostname.split(".")[0]}-auth-token`,E={db:Mve,realtime:kve,auth:Object.assign(Object.assign({},Ove),{storageKey:b}),global:Ive},P=Fve(n??{},E);this.storageKey=(l=P.auth.storageKey)!==null&&l!==void 0?l:"",this.headers=(h=P.global.headers)!==null&&h!==void 0?h:{},P.accessToken?(this.accessToken=P.accessToken,this.auth=new Proxy({},{get:(O,L)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(L)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((f=P.auth)!==null&&f!==void 0?f:{},this.headers,P.global.fetch),this.fetch=jve(r,this._getAccessToken.bind(this),P.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},P.realtime)),this.rest=new K_e(new URL("rest/v1",v).href,{headers:this.headers,schema:P.db.schema,fetch:this.fetch}),this.storage=new Ave(this.storageUrl.href,this.headers,this.fetch,n?.storage),P.accessToken||this._listenForAuthEvents()}get functions(){return new C_e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,r;return R0e(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:l,storageKey:h,flowType:f,lock:o,debug:v},b,E){const P={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new k0e({url:this.authUrl.href,headers:Object.assign(Object.assign({},P),b),storageKey:h,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:l,flowType:f,lock:o,debug:v,fetch:E,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new fve(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n?.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const L0e=(e,t,r)=>new D0e(e,t,r);function j0e(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}j0e()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const N0e="https://zfeqsdtddvelapbrwlol.supabase.co",z0e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmZXFzZHRkZHZlbGFwYnJ3bG9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3Njk1NzIsImV4cCI6MjA3MDM0NTU3Mn0.EhgHQSRum7-ZglFq1aAl7vPMM_c0i54gs5eD1fN03UU",_n=L0e(N0e,z0e,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),F0e=({preschool:e,onClose:t,onViewDetails:r,nationalAverage:n})=>{const[l,h]=K.useState([]),[f,o]=K.useState(null),[v,b]=K.useState(null),[E,P]=K.useState(!1),[O,L]=K.useState(0),B=K.useRef(new Map);K.useEffect(()=>{z(),$()},[e.id]);const z=async()=>{try{const G=B.current.get(e.id);if(G){h(G);return}const{data:Z,error:ne}=await _n.from("preschool_images").select("image_url").eq("preschool_id",e.id).eq("image_type","google_places").limit(2).order("created_at");if(!ne&&Z&&Z.length>0){const Y=Z.map(ee=>ee.image_url);B.current.set(e.id,Y),h(Y);return}if(e.latitud&&e.longitud)try{const{data:Y,error:ee}=await _n.functions.invoke("google-places-enricher",{body:{preschoolId:e.id,lat:e.latitud,lng:e.longitud,address:e.adress,name:e.namn}});if(!ee&&Y?.success){const{data:le}=await _n.from("preschool_images").select("image_url").eq("preschool_id",e.id).eq("image_type","google_places").limit(2).order("created_at");if(le&&le.length>0){const fe=le.map(Ce=>Ce.image_url);B.current.set(e.id,fe),h(fe)}}}catch(Y){console.error("Google Places enricher error:",Y)}}catch(G){console.error("Error fetching images:",G)}},$=async()=>{if(!(!e.latitud||!e.longitud)){P(!0),b(null);try{const{data:G,error:Z}=await _n.functions.invoke("street-view-generator",{body:{lat:e.latitud,lng:e.longitud,size:"400x200"}});if(Z)throw Z;if(G?.success&&G?.data?.static_url)o(G.data.static_url);else throw new Error("No street view available")}catch(G){console.error("Street view error:",G),b("Gatuvy ej tillgänglig"),O<2&&setTimeout(()=>{L(Z=>Z+1),$()},1e3)}finally{P(!1)}}},U=(G,Z,ne=!0)=>{const Y=G-Z,ee=Y/Z*100;if(Math.abs(ee)<5)return null;const le=ne?Y>0:Y<0;return M.jsxs(An,{variant:le?"default":"secondary",className:"text-xs ml-1",children:[le?"↑":"↓"," ",Math.abs(ee).toFixed(0),"%"]})};return M.jsx(T_e,{onClickOutside:t,children:M.jsx($r.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.2},className:"fixed left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md mx-4",children:M.jsxs(Cn,{className:"bg-card/95 backdrop-blur-sm border-border/50 shadow-lg",children:[M.jsxs("div",{className:"p-4 border-b border-border",children:[M.jsxs("div",{className:"flex items-start justify-between",children:[M.jsxs("div",{className:"flex-1",children:[M.jsx("h3",{className:"font-semibold text-lg text-foreground",children:e.namn}),M.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[M.jsx(An,{variant:"outline",className:"text-xs",children:e.huvudman==="Enskild"?"Fristående":e.huvudman}),e.google_rating&&e.google_rating>=4.5&&M.jsx(An,{variant:"default",className:"text-xs",children:"Toppenbetyg"})]})]}),M.jsx(fn,{onClick:t,variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:M.jsx($l,{className:"h-4 w-4"})})]}),e.google_rating&&M.jsx("div",{className:"mt-3",children:M.jsx(S_e,{rating:e.google_rating,reviewCount:e.google_reviews_count||0,size:"sm"})})]}),M.jsxs("div",{className:"p-4 space-y-4",children:[f&&M.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-muted",children:[M.jsx("img",{src:f,alt:`Gatuvy för ${e.namn}`,className:"w-full h-24 object-cover cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>window.open(`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${e.latitud},${e.longitud}`,"_blank"),loading:"lazy"}),M.jsx("div",{className:"absolute top-2 right-2",children:M.jsxs(An,{variant:"secondary",className:"text-xs bg-black/50 text-white border-none",children:[M.jsx(Tj,{className:"w-3 h-3 mr-1"}),"Gatuvy"]})})]}),E&&M.jsx("div",{className:"h-24 bg-muted rounded-lg flex items-center justify-center",children:M.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[M.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-primary border-t-transparent rounded-full"}),"Laddar gatuvy..."]})}),v&&!f&&!E&&M.jsx("div",{className:"h-16 bg-muted rounded-lg flex items-center justify-center",children:M.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-xs",children:[M.jsx(ace,{className:"w-3 h-3"}),v]})}),M.jsxs("div",{className:"flex items-start gap-3",children:[M.jsx(Ha,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),M.jsxs("div",{className:"flex-1",children:[M.jsx("p",{className:"text-sm font-medium",children:e.adress}),M.jsx("p",{className:"text-xs text-muted-foreground",children:e.kommun})]})]}),l.length>0&&M.jsxs("div",{className:"mb-4",children:[M.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[M.jsx(oce,{className:"w-4 h-4 text-muted-foreground"}),M.jsx("span",{className:"text-sm font-medium",children:"Bilder"})]}),M.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.map((G,Z)=>M.jsx("img",{src:G,alt:`${e.namn} bild ${Z+1}`,className:"w-full h-20 object-cover rounded-md hover:scale-105 transition-transform duration-200 cursor-pointer",loading:"lazy",onClick:r},Z))})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(km,{className:"h-4 w-4 text-primary"}),M.jsxs("div",{className:"flex-1",children:[M.jsx("p",{className:"text-sm font-medium",children:e.antal_barn||"N/A"}),M.jsx("p",{className:"text-xs text-muted-foreground",children:"Barn"}),n&&e.antal_barn&&U(e.antal_barn,n.avgChildren)]})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(ba,{className:"h-4 w-4 text-primary"}),M.jsxs("div",{className:"flex-1",children:[M.jsx("p",{className:"text-sm font-medium",children:e.personaltäthet?e.personaltäthet.toFixed(1):"N/A"}),M.jsx("p",{className:"text-xs text-muted-foreground",children:"Personal"}),n&&e.personaltäthet&&U(e.personaltäthet,n.avgStaff,!1)]})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(xj,{className:"h-4 w-4 text-primary"}),M.jsxs("div",{className:"flex-1",children:[M.jsx("p",{className:"text-sm font-medium",children:e.andel_med_förskollärarexamen?`${e.andel_med_förskollärarexamen}%`:"N/A"}),M.jsx("p",{className:"text-xs text-muted-foreground",children:"Lärarexamen"}),n&&e.andel_med_förskollärarexamen&&U(e.andel_med_förskollärarexamen,n.avgTeacherExam)]})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(Om,{className:"h-4 w-4 text-primary"}),M.jsxs("div",{className:"flex-1",children:[M.jsx("p",{className:"text-sm font-medium",children:e.antal_barngrupper}),M.jsx("p",{className:"text-xs text-muted-foreground",children:"Grupper"})]})]})]}),M.jsxs("div",{className:"flex gap-2 pt-2",children:[M.jsx(fn,{onClick:r,className:"flex-1",variant:"default",size:"sm",children:"Mer detaljer"}),M.jsx(fn,{onClick:()=>window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${e.adress}, ${e.kommun}`)}`,"_blank"),variant:"outline",size:"sm",children:"Vägbeskrivning"})]})]})]})})})};class UX{static async request(t){try{console.log(`🌐 API Manager: ${t.type} request to ${t.endpoint}`);const{data:r,error:n}=await _n.functions.invoke(this.FUNCTION_URL,{body:t});return n?(console.error("API Manager function error:",n),{success:!1,error:n.message}):(r.cached&&console.log(`📦 Using cached response for ${t.type}:${t.endpoint}`),r)}catch(r){return console.error("API Manager client error:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}static async googlePlaces(t,r,n=3600){return this.request({type:"google_places",endpoint:t,params:r,cache_duration:n})}static async googleMaps(t,r,n=3600){return this.request({type:"google_maps",endpoint:t,params:r,cache_duration:n})}static async mapbox(t,r,n=1800){return this.request({type:"mapbox",endpoint:t,params:r,cache_duration:n})}static async streetView(t,r,n=7200){return this.request({type:"street_view",endpoint:t,params:r,cache_duration:n})}static async enrichPreschool(t,r,n,l,h,f=0){try{console.log(`🏫 Enriching preschool ${t}: ${h}`);const{data:o,error:v}=await _n.functions.invoke("google-places-enricher",{body:{preschoolId:t,lat:r,lng:n,address:l,name:h,priority:f}});return v?(console.error("Preschool enrichment error:",v),{success:!1,error:v.message}):(console.log(`✅ Successfully enriched preschool ${t}`),o)}catch(o){return console.error("Preschool enrichment client error:",o),{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}static async downloadImages(t,r,n="google_places"){try{console.log(`🖼️  Downloading ${r.length} images for preschool ${t}`);const{data:l,error:h}=await _n.functions.invoke("image-downloader",{body:{preschool_id:t,images:r,image_type:n}});return h?(console.error("Image download error:",h),{success:!1,error:h.message}):(console.log(`✅ Successfully downloaded ${l.success_count}/${l.processed_count} images for preschool ${t}`),l)}catch(l){return console.error("Image download client error:",l),{success:!1,error:l instanceof Error?l.message:"Unknown error"}}}static async clearExpiredCache(){try{const{error:t}=await _n.from("api_cache").delete().lt("expires_at",new Date().toISOString());return t?(console.error("Cache cleanup error:",t),{success:!1,error:t.message}):(console.log("✅ Cleared expired cache entries"),{success:!0})}catch(t){return console.error("Cache cleanup client error:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}static async getCacheStats(){try{const{data:t,error:r}=await _n.from("api_cache").select("api_type, count(*)").gte("expires_at",new Date().toISOString());return r?(console.error("Cache stats error:",r),{success:!1,error:r.message}):{success:!0,data:t.reduce((n,l)=>(n[l.api_type]=l.count,n),{})}}catch(t){return console.error("Cache stats client error:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}}ny(UX,"FUNCTION_URL","api-manager");class B0e{constructor(){ny(this,"cache",new Map);ny(this,"CACHE_DURATION",5*60*1e3);ny(this,"STORAGE_KEY","preschool_cluster_cache");this.loadFromStorage()}getCacheKey(t){return`zoom_${Math.round(t*2)/2}`}saveClusterState(t,r){const n=this.getCacheKey(t),l={zoom:t,clusters:r,timestamp:Date.now()};this.cache.set(n,l),this.saveToStorage(),console.log(`💾 Saved cluster cache for zoom ${t} with ${r.length} clusters`)}getClusterState(t){const r=this.getCacheKey(t),n=this.cache.get(r);return n?Date.now()-n.timestamp>this.CACHE_DURATION?(this.cache.delete(r),null):(console.log(`📦 Using cached clusters for zoom ${t}: ${n.clusters.length} clusters`),n):null}generateSwedishClusterApproximation(){return[{center:[18.0686,59.3293],count:850,bounds:{north:59.5,south:59.1,east:18.3,west:17.8},averageRating:4.2,totalChildren:12500,timestamp:Date.now()},{center:[11.9746,57.7089],count:420,bounds:{north:57.9,south:57.5,east:12.2,west:11.7},averageRating:4.1,totalChildren:6800,timestamp:Date.now()},{center:[13.0034,55.605],count:280,bounds:{north:55.8,south:55.4,east:13.3,west:12.7},averageRating:4,totalChildren:4200,timestamp:Date.now()},{center:[17.6389,59.8585],count:180,bounds:{north:60,south:59.7,east:17.9,west:17.4},averageRating:4.3,totalChildren:2800,timestamp:Date.now()},{center:[15.6214,58.4108],count:140,bounds:{north:58.6,south:58.2,east:15.9,west:15.3},averageRating:4.2,totalChildren:2100,timestamp:Date.now()},{center:[15.2066,59.2741],count:120,bounds:{north:59.4,south:59.1,east:15.5,west:14.9},averageRating:4.1,totalChildren:1900,timestamp:Date.now()},{center:[20.263,63.8258],count:85,bounds:{north:64,south:63.6,east:20.5,west:20},averageRating:4,totalChildren:1400,timestamp:Date.now()},{center:[16.5,60.6],count:95,bounds:{north:60.8,south:60.4,east:16.8,west:16.2},averageRating:4.1,totalChildren:1500,timestamp:Date.now()},{center:[14.8,56.9],count:165,bounds:{north:57.2,south:56.6,east:15.2,west:14.4},averageRating:4,totalChildren:2600,timestamp:Date.now()},{center:[13.5,59.4],count:110,bounds:{north:59.7,south:59.1,east:13.8,west:13.2},averageRating:4.1,totalChildren:1800,timestamp:Date.now()},{center:[17.3,62.4],count:75,bounds:{north:62.6,south:62.2,east:17.6,west:17},averageRating:4,totalChildren:1200,timestamp:Date.now()},{center:[22.15,65.58],count:65,bounds:{north:65.8,south:65.3,east:22.5,west:21.8},averageRating:4.2,totalChildren:1e3,timestamp:Date.now()}]}saveToStorage(){try{const t=Array.from(this.cache.entries());localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(t){console.warn("Failed to save cluster cache to storage:",t)}}loadFromStorage(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(t){const r=JSON.parse(t);this.cache=new Map(r),console.log(`📂 Loaded cluster cache with ${this.cache.size} entries`)}}catch(t){console.warn("Failed to load cluster cache from storage:",t)}}clearCache(){this.cache.clear(),localStorage.removeItem(this.STORAGE_KEY),console.log("🗑️ Cleared all cluster cache")}getCacheStats(){let t=0,r=Date.now();return this.cache.forEach(n=>{t+=n.clusters.length,n.timestamp<r&&(r=n.timestamp)}),{entries:this.cache.size,totalClusters:t,oldestEntry:r}}}const Dx=new B0e;function GX(e,t){const[r,n]=K.useState(e);return K.useEffect(()=>{const l=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(l)}},[e,t]),r}const $0e=e=>{const{updateVisiblePreschoolsFromViewport:t}=Lo(),r=K.useRef(0),n=K.useRef(),l=K.useCallback(()=>{if(!e)return;const f=Date.now();if(f-r.current<100)return;const o=e.getBounds();t({north:o.getNorth(),south:o.getSouth(),east:o.getEast(),west:o.getWest()}),r.current=f},[e,t]),h=GX(l,150);return K.useEffect(()=>{if(!e)return;const f=()=>{n.current&&clearTimeout(n.current),l()},o=()=>{h()},v=()=>{l()};return e.on("moveend",f),e.on("move",o),e.on("zoomend",v),l(),()=>{e.off("moveend",f),e.off("move",o),e.off("zoomend",v),n.current&&clearTimeout(n.current)}},[e,l,h]),{updateViewport:l}},V0e="pk.eyJ1Ijoic2tvZ3N0YWRpc2FrIiwiYSI6ImNtY3BhaXRpMjA0ZGcycHBqNHM4dmlwOW0ifQ.KKHGGPnrZVjNjDdITF-_bw";vE.accessToken=V0e;const U0e=({className:e})=>{const t=K.useRef(null),r=K.useRef(null),[n,l]=K.useState(!0),[h,f]=K.useState(!1),[o,v]=K.useState(null),{filteredPreschools:b,selectedPreschool:E,setSelectedPreschool:P,mapCenter:O,mapZoom:L,setMapCenter:B,setMapZoom:z,preschools:$,lastUpdated:U,updateVisiblePreschoolsFromViewport:G}=Lo();$0e(r.current),K.useEffect(()=>{console.log("🎯 Preloading Swedish cluster data for instant display...");const ee=Dx.generateSwedishClusterApproximation();console.log(`📦 Preloaded ${ee.length} cluster approximations for Sweden`)},[]),K.useEffect(()=>{if(!t.current)return;r.current=new vE.Map({container:t.current,style:"mapbox://styles/mapbox/streets-v12",center:[15.2,62.4],zoom:4.9,minZoom:2,maxZoom:18,pitch:0,bearing:0,maxBounds:[[7,55],[25,70]]}),r.current.on("style.load",()=>{if(!r.current)return;console.log("🗺️ Mapbox style loaded, map is ready"),l(!1);const fe=r.current.getZoom();let Ce=Dx.getClusterState(fe);if(Ce)console.log("⚡ Using cached clusters for instant display"),Z(Ce.clusters);else{console.log("🏃‍♂️ No cache found, using Swedish cluster approximation for instant display");const Oe=Dx.generateSwedishClusterApproximation();Z(Oe)}setTimeout(()=>{if(r.current){const Oe=r.current.getBounds();G({north:Oe.getNorth(),south:Oe.getSouth(),east:Oe.getEast(),west:Oe.getWest()}),console.log("🎯 Initial viewport preschools updated")}},1e3)}),r.current.addControl(new vE.NavigationControl,"top-right");const ee=new vE.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});r.current.addControl(ee,"top-right"),ee.on("geolocate",fe=>{const{longitude:Ce,latitude:Oe}=fe.coords;console.log(`User location detected: [${Ce}, ${Oe}]`),B([Ce,Oe]),z(13)});let le;return r.current.on("moveend",()=>{clearTimeout(le),le=setTimeout(()=>{if(!r.current)return;const fe=r.current.getCenter(),Ce=r.current.getZoom();B([fe.lng,fe.lat]),z(Ce);const Oe=r.current.getBounds();G({north:Oe.getNorth(),south:Oe.getSouth(),east:Oe.getEast(),west:Oe.getWest()}),setTimeout(()=>{if(r.current&&r.current.getLayer("preschools-clusters")){const Me=r.current.queryRenderedFeatures({layers:["preschools-clusters"]});if(Me.length>0){const Ke=Me.map(Ye=>({center:Ye.geometry.coordinates,count:Ye.properties.point_count,bounds:{north:Ye.geometry.coordinates[1]+.5,south:Ye.geometry.coordinates[1]-.5,east:Ye.geometry.coordinates[0]+.5,west:Ye.geometry.coordinates[0]-.5},averageRating:Ye.properties.avg_rating||4,totalChildren:Ye.properties.total_children||0,timestamp:Date.now()}));Dx.saveClusterState(Ce,Ke),console.log(`💾 Cached ${Ke.length} clusters for zoom ${Ce.toFixed(1)}`)}}},500),console.log("🗺️ Map moved - updated visible preschools for viewport")},300)}),()=>{r.current?.remove()}},[]);const Z=K.useCallback(ee=>{if(!r.current||!r.current.isStyleLoaded())return;r.current.getLayer("cached-clusters")&&r.current.removeLayer("cached-clusters"),r.current.getLayer("cached-cluster-count")&&r.current.removeLayer("cached-cluster-count"),r.current.getSource("cached-clusters")&&r.current.removeSource("cached-clusters");const le={type:"FeatureCollection",features:ee.map((fe,Ce)=>({type:"Feature",id:Ce,properties:{cluster_id:Ce,point_count:fe.count,point_count_abbreviated:fe.count>1e3?`${(fe.count/1e3).toFixed(1)}k`:fe.count.toString()},geometry:{type:"Point",coordinates:fe.center}}))};r.current.addSource("cached-clusters",{type:"geojson",data:le}),r.current.addLayer({id:"cached-clusters",type:"circle",source:"cached-clusters",paint:{"circle-color":["interpolate",["linear"],["get","point_count"],1,"#34d399",25,"#10b981",100,"#f59e0b",500,"#f97316",1e3,"#dc2626"],"circle-radius":["interpolate",["exponential",1.2],["get","point_count"],1,20,25,28,100,36,500,44,1e3,52],"circle-stroke-width":3,"circle-stroke-color":"#ffffff","circle-opacity":.8}}),r.current.addLayer({id:"cached-cluster-count",type:"symbol",source:"cached-clusters",layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":16},paint:{"text-color":"#ffffff"}}),console.log(`⚡ Added ${ee.length} cached clusters for immediate display`)},[]),ne=K.useMemo(()=>{const ee=b.filter(le=>le.latitud!==null&&le.longitud!==null&&typeof le.latitud=="number"&&typeof le.longitud=="number"&&le.latitud>=55&&le.latitud<=69.1&&le.longitud>=10.9&&le.longitud<=24.2);return console.log(`📍 Valid preschools for map: ${ee.length}/${b.length}`),ee.length>0&&console.log(`✅ First preschool: ${ee[0].namn} at [${ee[0].longitud}, ${ee[0].latitud}]`),ee},[b]),Y=K.useMemo(()=>{const ee={type:"FeatureCollection",features:ne.map(le=>({type:"Feature",properties:{id:le.id,namn:le.namn,kommun:le.kommun,huvudman:le.huvudman,google_rating:le.google_rating||0},geometry:{type:"Point",coordinates:[le.longitud,le.latitud]}}))};return console.log(`🌍 Generated GeoJSON with ${ee.features.length} features`),ee},[ne]);return K.useEffect(()=>{if(console.log(`🔄 Map useEffect triggered - valid preschools: ${ne.length}`),!r.current){console.log("❌ No map instance available");return}if(!r.current.isStyleLoaded()){console.log("⏳ Waiting for map style to load...");const fe=()=>{r.current?.isStyleLoaded()?(console.log("✅ Style loaded, adding preschools"),ee()):setTimeout(fe,100)};fe();return}ee();function ee(){if(!r.current)return;if(["cached-clusters","cached-cluster-count"].forEach(Oe=>{r.current?.getLayer(Oe)&&(r.current.removeLayer(Oe),console.log(`🗑️ Removed cached layer: ${Oe}`))}),r.current?.getSource("cached-clusters")&&(r.current.removeSource("cached-clusters"),console.log("🗑️ Removed cached clusters source")),["preschools-clusters","preschools-cluster-count","preschools-unclustered"].forEach(Oe=>{r.current?.getLayer(Oe)&&r.current.removeLayer(Oe)}),r.current?.getSource("preschools")&&r.current.removeSource("preschools"),ne.length===0){console.log("No valid preschools to display on map");return}console.log(`🗺️ Replacing cached clusters with ${ne.length} real preschools`),r.current.addSource("preschools",{type:"geojson",data:Y,cluster:!0,clusterMaxZoom:13,clusterRadius:45,clusterProperties:{avg_rating:["/",["+",["get","google_rating"]],["get","point_count"]],total_children:["+",["get","antal_barn"]],preschool_count:["get","point_count"]}}),r.current.addLayer({id:"preschools-clusters",type:"circle",source:"preschools",filter:["has","point_count"],paint:{"circle-color":["interpolate",["linear"],["get","point_count"],1,"#34d399",25,"#10b981",100,"#f59e0b",500,"#f97316",1e3,"#dc2626"],"circle-radius":["interpolate",["exponential",1.2],["get","point_count"],1,20,25,28,100,36,500,44,1e3,52],"circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.85}}),r.current.addLayer({id:"preschools-cluster-count",type:"symbol",source:"preschools",filter:["has","point_count"],layout:{"text-field":"{point_count}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),r.current.addLayer({id:"preschools-unclustered",type:"circle",source:"preschools",filter:["!",["has","point_count"]],paint:{"circle-color":["case",[">",["get","google_rating"],4],"#10b981",[">",["get","google_rating"],3],"#f59e0b",["==",["get","google_rating"],0],"#6b7280","#ef4444"],"circle-radius":["interpolate",["exponential",1.5],["zoom"],10,6,15,10],"circle-stroke-width":["interpolate",["linear"],["zoom"],10,1,15,2],"circle-stroke-color":"#ffffff","circle-opacity":.9}}),r.current.on("click","preschools-unclustered",async Oe=>{if(Oe.features&&Oe.features[0]){const Ke=Oe.features[0].properties?.id,Ye=b.find(Le=>Le.id===Ke);Ye&&(v(Ye),f(!0),Ye.latitud&&Ye.longitud&&!Ye.google_rating&&(console.log(`🔄 Auto-enriching preschool: ${Ye.namn}`),UX.enrichPreschool(Ye.id,Ye.latitud,Ye.longitud,Ye.adress||"",Ye.namn,1)))}}),r.current.on("click","preschools-clusters",Oe=>{const Me=r.current.queryRenderedFeatures(Oe.point,{layers:["preschools-clusters"]}),Ke=Me[0].properties.cluster_id;r.current.getSource("preschools").getClusterExpansionZoom(Ke,(Le,Qe)=>{Le||r.current.easeTo({center:Me[0].geometry.coordinates,zoom:Qe})})}),setTimeout(()=>{le()},1e3)}function le(){if(!r.current)return;const fe=r.current.getZoom(),Ce=r.current.queryRenderedFeatures({layers:["preschools-clusters"]});if(Ce.length>0){const Oe=Ce.map(Me=>({center:Me.geometry.coordinates,count:Me.properties.point_count,bounds:{north:Me.geometry.coordinates[1]+.5,south:Me.geometry.coordinates[1]-.5,east:Me.geometry.coordinates[0]+.5,west:Me.geometry.coordinates[0]-.5},averageRating:Me.properties.avg_rating||4,totalChildren:Me.properties.total_children||0,timestamp:Date.now()}));Dx.saveClusterState(fe,Oe),console.log(`💾 Saved ${Oe.length} real clusters to cache for zoom ${fe.toFixed(1)}`)}}},[b,Y,U]),K.useEffect(()=>{if(!r.current)return;const ee=r.current.getCenter(),le=r.current.getZoom(),fe=Array.isArray(O)?O:[O.lng||O.lon,O.lat],[Ce,Oe]=fe,Me=Math.abs(ee.lng-Ce)+Math.abs(ee.lat-Oe),Ke=Math.abs(le-L);(Me>.01||Ke>.5)&&(console.log(`Flying to: [${Ce}, ${Oe}] zoom: ${L}`),r.current.flyTo({center:[Ce,Oe],zoom:L,duration:1e3}))},[O,L]),K.useEffect(()=>{E&&r.current&&E.latitud&&E.longitud&&r.current.flyTo({center:[E.longitud,E.latitud],zoom:14,duration:1e3})},[E]),M.jsxs("div",{className:`relative ${e}`,children:[M.jsx(Pc,{children:h&&o&&M.jsx(F0e,{preschool:o,onClose:()=>{f(!1),v(null)},onViewDetails:()=>{P(o),f(!1),v(null)}})}),M.jsx("div",{ref:t,className:"w-full h-full rounded-lg overflow-hidden"}),n&&M.jsx($r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-gradient-to-br from-primary/20 to-secondary/20 backdrop-blur-sm flex items-center justify-center rounded-lg",children:M.jsxs("div",{className:"text-center",children:[M.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-primary border-t-transparent rounded-full mx-auto mb-4"}),M.jsx("p",{className:"text-foreground font-medium",children:"Laddar karta över Sverige..."})]})})]})};class hU extends ze.Component{constructor(r){super(r);ny(this,"retry",()=>{this.setState({hasError:!1,error:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,n){console.error("ErrorBoundary caught an error:",r,n)}render(){if(this.state.hasError){if(this.props.fallback){const r=this.props.fallback;return M.jsx(r,{error:this.state.error,retry:this.retry})}return M.jsxs(Cn,{className:"p-6 m-4 border-destructive/50",children:[M.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[M.jsx(wce,{className:"h-6 w-6 text-destructive"}),M.jsx("h3",{className:"text-lg font-semibold text-destructive",children:"Något gick fel"})]}),M.jsx("p",{className:"text-muted-foreground mb-4",children:"Ett oväntat fel uppstod. Försök ladda om sidan eller kontakta support om problemet kvarstår."}),this.state.error&&M.jsxs("details",{className:"mb-4",children:[M.jsx("summary",{className:"text-sm text-muted-foreground cursor-pointer hover:text-foreground",children:"Teknisk information"}),M.jsx("pre",{className:"mt-2 text-xs bg-muted p-2 rounded overflow-auto",children:this.state.error.message})]}),M.jsxs(fn,{onClick:this.retry,variant:"outline",className:"w-full",children:[M.jsx($d,{className:"h-4 w-4 mr-2"}),"Försök igen"]})]})}return this.props.children}}function Lx({className:e,...t}){return M.jsx("div",{className:ln("animate-pulse rounded-md bg-muted",e),...t})}const G0e=({className:e})=>M.jsx(Cn,{className:`p-4 ${e}`,children:M.jsxs("div",{className:"space-y-3",children:[M.jsx(Lx,{className:"h-4 w-3/4"}),M.jsx(Lx,{className:"h-4 w-1/2"}),M.jsxs("div",{className:"space-y-2",children:[M.jsx(Lx,{className:"h-3 w-full"}),M.jsx(Lx,{className:"h-3 w-5/6"}),M.jsx(Lx,{className:"h-3 w-4/6"})]})]})}),dU=({children:e,fallback:t,className:r})=>M.jsx(K.Suspense,{fallback:t||M.jsx(G0e,{className:r}),children:e}),H0e=({children:e})=>{const[t,r]=K.useState(navigator.onLine),[n,l]=K.useState(!1);K.useEffect(()=>{const f=()=>{r(!0),l(!1),Fk({title:"Anslutning återställd",description:"Du är nu online igen",duration:3e3})},o=()=>{r(!1),l(!0),Fk({title:"Ingen internetanslutning",description:"Kontrollera din anslutning för att få de senaste uppdateringarna",variant:"destructive",duration:5e3})};return window.addEventListener("online",f),window.addEventListener("offline",o),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",o)}},[]);const h=()=>{window.location.reload()};return M.jsxs(M.Fragment,{children:[n&&M.jsx(Cn,{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-destructive/90 text-destructive-foreground border-destructive",children:M.jsxs("div",{className:"p-3 flex items-center gap-3",children:[M.jsx(Sce,{className:"h-5 w-5"}),M.jsxs("div",{className:"flex-1",children:[M.jsx("p",{className:"text-sm font-medium",children:"Ingen internetanslutning"}),M.jsx("p",{className:"text-xs opacity-90",children:"Vissa funktioner kanske inte fungerar"})]}),M.jsxs(fn,{size:"sm",variant:"secondary",onClick:h,className:"h-8",children:[M.jsx($d,{className:"h-4 w-4 mr-1"}),"Försök igen"]})]})}),e,M.jsx("div",{className:"fixed bottom-4 left-4 z-40"})]})},HX=K.memo(({children:e})=>M.jsx(M.Fragment,{children:e}));HX.displayName="PerformanceOptimizer";var W0e=K.createContext(void 0);function nP(e){const t=K.useContext(W0e);return e||t||"ltr"}function jR(e,[t,r]){return Math.min(r,Math.max(t,e))}function q0e(e,t){return K.useReducer((r,n)=>t[r][n]??r,e)}var SN="ScrollArea",[WX,KGe]=Ec(SN),[Z0e,Ul]=WX(SN),qX=K.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:l,scrollHideDelay:h=600,...f}=e,[o,v]=K.useState(null),[b,E]=K.useState(null),[P,O]=K.useState(null),[L,B]=K.useState(null),[z,$]=K.useState(null),[U,G]=K.useState(0),[Z,ne]=K.useState(0),[Y,ee]=K.useState(!1),[le,fe]=K.useState(!1),Ce=mi(t,Me=>v(Me)),Oe=nP(l);return M.jsx(Z0e,{scope:r,type:n,dir:Oe,scrollHideDelay:h,scrollArea:o,viewport:b,onViewportChange:E,content:P,onContentChange:O,scrollbarX:L,onScrollbarXChange:B,scrollbarXEnabled:Y,onScrollbarXEnabledChange:ee,scrollbarY:z,onScrollbarYChange:$,scrollbarYEnabled:le,onScrollbarYEnabledChange:fe,onCornerWidthChange:G,onCornerHeightChange:ne,children:M.jsx(pn.div,{dir:Oe,...f,ref:Ce,style:{position:"relative","--radix-scroll-area-corner-width":U+"px","--radix-scroll-area-corner-height":Z+"px",...e.style}})})});qX.displayName=SN;var ZX="ScrollAreaViewport",XX=K.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:l,...h}=e,f=Ul(ZX,r),o=K.useRef(null),v=mi(t,o,f.onViewportChange);return M.jsxs(M.Fragment,{children:[M.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),M.jsx(pn.div,{"data-radix-scroll-area-viewport":"",...h,ref:v,style:{overflowX:f.scrollbarXEnabled?"scroll":"hidden",overflowY:f.scrollbarYEnabled?"scroll":"hidden",...e.style},children:M.jsx("div",{ref:f.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});XX.displayName=ZX;var Cu="ScrollAreaScrollbar",TN=K.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=Ul(Cu,e.__scopeScrollArea),{onScrollbarXEnabledChange:h,onScrollbarYEnabledChange:f}=l,o=e.orientation==="horizontal";return K.useEffect(()=>(o?h(!0):f(!0),()=>{o?h(!1):f(!1)}),[o,h,f]),l.type==="hover"?M.jsx(X0e,{...n,ref:t,forceMount:r}):l.type==="scroll"?M.jsx(K0e,{...n,ref:t,forceMount:r}):l.type==="auto"?M.jsx(KX,{...n,ref:t,forceMount:r}):l.type==="always"?M.jsx(EN,{...n,ref:t}):null});TN.displayName=Cu;var X0e=K.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=Ul(Cu,e.__scopeScrollArea),[h,f]=K.useState(!1);return K.useEffect(()=>{const o=l.scrollArea;let v=0;if(o){const b=()=>{window.clearTimeout(v),f(!0)},E=()=>{v=window.setTimeout(()=>f(!1),l.scrollHideDelay)};return o.addEventListener("pointerenter",b),o.addEventListener("pointerleave",E),()=>{window.clearTimeout(v),o.removeEventListener("pointerenter",b),o.removeEventListener("pointerleave",E)}}},[l.scrollArea,l.scrollHideDelay]),M.jsx(Ac,{present:r||h,children:M.jsx(KX,{"data-state":h?"visible":"hidden",...n,ref:t})})}),K0e=K.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=Ul(Cu,e.__scopeScrollArea),h=e.orientation==="horizontal",f=oP(()=>v("SCROLL_END"),100),[o,v]=q0e("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return K.useEffect(()=>{if(o==="idle"){const b=window.setTimeout(()=>v("HIDE"),l.scrollHideDelay);return()=>window.clearTimeout(b)}},[o,l.scrollHideDelay,v]),K.useEffect(()=>{const b=l.viewport,E=h?"scrollLeft":"scrollTop";if(b){let P=b[E];const O=()=>{const L=b[E];P!==L&&(v("SCROLL"),f()),P=L};return b.addEventListener("scroll",O),()=>b.removeEventListener("scroll",O)}},[l.viewport,h,v,f]),M.jsx(Ac,{present:r||o!=="hidden",children:M.jsx(EN,{"data-state":o==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:Xr(e.onPointerEnter,()=>v("POINTER_ENTER")),onPointerLeave:Xr(e.onPointerLeave,()=>v("POINTER_LEAVE"))})})}),KX=K.forwardRef((e,t)=>{const r=Ul(Cu,e.__scopeScrollArea),{forceMount:n,...l}=e,[h,f]=K.useState(!1),o=e.orientation==="horizontal",v=oP(()=>{if(r.viewport){const b=r.viewport.offsetWidth<r.viewport.scrollWidth,E=r.viewport.offsetHeight<r.viewport.scrollHeight;f(o?b:E)}},10);return T_(r.viewport,v),T_(r.content,v),M.jsx(Ac,{present:n||h,children:M.jsx(EN,{"data-state":h?"visible":"hidden",...l,ref:t})})}),EN=K.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,l=Ul(Cu,e.__scopeScrollArea),h=K.useRef(null),f=K.useRef(0),[o,v]=K.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),b=tK(o.viewport,o.content),E={...n,sizes:o,onSizesChange:v,hasThumb:b>0&&b<1,onThumbChange:O=>h.current=O,onThumbPointerUp:()=>f.current=0,onThumbPointerDown:O=>f.current=O};function P(O,L){return rxe(O,f.current,o,L)}return r==="horizontal"?M.jsx(Y0e,{...E,ref:t,onThumbPositionChange:()=>{if(l.viewport&&h.current){const O=l.viewport.scrollLeft,L=fU(O,o,l.dir);h.current.style.transform=`translate3d(${L}px, 0, 0)`}},onWheelScroll:O=>{l.viewport&&(l.viewport.scrollLeft=O)},onDragScroll:O=>{l.viewport&&(l.viewport.scrollLeft=P(O,l.dir))}}):r==="vertical"?M.jsx(J0e,{...E,ref:t,onThumbPositionChange:()=>{if(l.viewport&&h.current){const O=l.viewport.scrollTop,L=fU(O,o);h.current.style.transform=`translate3d(0, ${L}px, 0)`}},onWheelScroll:O=>{l.viewport&&(l.viewport.scrollTop=O)},onDragScroll:O=>{l.viewport&&(l.viewport.scrollTop=P(O))}}):null}),Y0e=K.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...l}=e,h=Ul(Cu,e.__scopeScrollArea),[f,o]=K.useState(),v=K.useRef(null),b=mi(t,v,h.onScrollbarXChange);return K.useEffect(()=>{v.current&&o(getComputedStyle(v.current))},[v]),M.jsx(JX,{"data-orientation":"horizontal",...l,ref:b,sizes:r,style:{bottom:0,left:h.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:h.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":iP(r)+"px",...e.style},onThumbPointerDown:E=>e.onThumbPointerDown(E.x),onDragScroll:E=>e.onDragScroll(E.x),onWheelScroll:(E,P)=>{if(h.viewport){const O=h.viewport.scrollLeft+E.deltaX;e.onWheelScroll(O),nK(O,P)&&E.preventDefault()}},onResize:()=>{v.current&&h.viewport&&f&&n({content:h.viewport.scrollWidth,viewport:h.viewport.offsetWidth,scrollbar:{size:v.current.clientWidth,paddingStart:f2(f.paddingLeft),paddingEnd:f2(f.paddingRight)}})}})}),J0e=K.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...l}=e,h=Ul(Cu,e.__scopeScrollArea),[f,o]=K.useState(),v=K.useRef(null),b=mi(t,v,h.onScrollbarYChange);return K.useEffect(()=>{v.current&&o(getComputedStyle(v.current))},[v]),M.jsx(JX,{"data-orientation":"vertical",...l,ref:b,sizes:r,style:{top:0,right:h.dir==="ltr"?0:void 0,left:h.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":iP(r)+"px",...e.style},onThumbPointerDown:E=>e.onThumbPointerDown(E.y),onDragScroll:E=>e.onDragScroll(E.y),onWheelScroll:(E,P)=>{if(h.viewport){const O=h.viewport.scrollTop+E.deltaY;e.onWheelScroll(O),nK(O,P)&&E.preventDefault()}},onResize:()=>{v.current&&h.viewport&&f&&n({content:h.viewport.scrollHeight,viewport:h.viewport.offsetHeight,scrollbar:{size:v.current.clientHeight,paddingStart:f2(f.paddingTop),paddingEnd:f2(f.paddingBottom)}})}})}),[Q0e,YX]=WX(Cu),JX=K.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:l,onThumbChange:h,onThumbPointerUp:f,onThumbPointerDown:o,onThumbPositionChange:v,onDragScroll:b,onWheelScroll:E,onResize:P,...O}=e,L=Ul(Cu,r),[B,z]=K.useState(null),$=mi(t,Ce=>z(Ce)),U=K.useRef(null),G=K.useRef(""),Z=L.viewport,ne=n.content-n.viewport,Y=os(E),ee=os(v),le=oP(P,10);function fe(Ce){if(U.current){const Oe=Ce.clientX-U.current.left,Me=Ce.clientY-U.current.top;b({x:Oe,y:Me})}}return K.useEffect(()=>{const Ce=Oe=>{const Me=Oe.target;B?.contains(Me)&&Y(Oe,ne)};return document.addEventListener("wheel",Ce,{passive:!1}),()=>document.removeEventListener("wheel",Ce,{passive:!1})},[Z,B,ne,Y]),K.useEffect(ee,[n,ee]),T_(B,le),T_(L.content,le),M.jsx(Q0e,{scope:r,scrollbar:B,hasThumb:l,onThumbChange:os(h),onThumbPointerUp:os(f),onThumbPositionChange:ee,onThumbPointerDown:os(o),children:M.jsx(pn.div,{...O,ref:$,style:{position:"absolute",...O.style},onPointerDown:Xr(e.onPointerDown,Ce=>{Ce.button===0&&(Ce.target.setPointerCapture(Ce.pointerId),U.current=B.getBoundingClientRect(),G.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",L.viewport&&(L.viewport.style.scrollBehavior="auto"),fe(Ce))}),onPointerMove:Xr(e.onPointerMove,fe),onPointerUp:Xr(e.onPointerUp,Ce=>{const Oe=Ce.target;Oe.hasPointerCapture(Ce.pointerId)&&Oe.releasePointerCapture(Ce.pointerId),document.body.style.webkitUserSelect=G.current,L.viewport&&(L.viewport.style.scrollBehavior=""),U.current=null})})})}),d2="ScrollAreaThumb",QX=K.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=YX(d2,e.__scopeScrollArea);return M.jsx(Ac,{present:r||l.hasThumb,children:M.jsx(exe,{ref:t,...n})})}),exe=K.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...l}=e,h=Ul(d2,r),f=YX(d2,r),{onThumbPositionChange:o}=f,v=mi(t,P=>f.onThumbChange(P)),b=K.useRef(void 0),E=oP(()=>{b.current&&(b.current(),b.current=void 0)},100);return K.useEffect(()=>{const P=h.viewport;if(P){const O=()=>{if(E(),!b.current){const L=nxe(P,o);b.current=L,o()}};return o(),P.addEventListener("scroll",O),()=>P.removeEventListener("scroll",O)}},[h.viewport,E,o]),M.jsx(pn.div,{"data-state":f.hasThumb?"visible":"hidden",...l,ref:v,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:Xr(e.onPointerDownCapture,P=>{const L=P.target.getBoundingClientRect(),B=P.clientX-L.left,z=P.clientY-L.top;f.onThumbPointerDown({x:B,y:z})}),onPointerUp:Xr(e.onPointerUp,f.onThumbPointerUp)})});QX.displayName=d2;var AN="ScrollAreaCorner",eK=K.forwardRef((e,t)=>{const r=Ul(AN,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?M.jsx(txe,{...e,ref:t}):null});eK.displayName=AN;var txe=K.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,l=Ul(AN,r),[h,f]=K.useState(0),[o,v]=K.useState(0),b=!!(h&&o);return T_(l.scrollbarX,()=>{const E=l.scrollbarX?.offsetHeight||0;l.onCornerHeightChange(E),v(E)}),T_(l.scrollbarY,()=>{const E=l.scrollbarY?.offsetWidth||0;l.onCornerWidthChange(E),f(E)}),b?M.jsx(pn.div,{...n,ref:t,style:{width:h,height:o,position:"absolute",right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function f2(e){return e?parseInt(e,10):0}function tK(e,t){const r=e/t;return isNaN(r)?0:r}function iP(e){const t=tK(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function rxe(e,t,r,n="ltr"){const l=iP(r),h=l/2,f=t||h,o=l-f,v=r.scrollbar.paddingStart+f,b=r.scrollbar.size-r.scrollbar.paddingEnd-o,E=r.content-r.viewport,P=n==="ltr"?[0,E]:[E*-1,0];return rK([v,b],P)(e)}function fU(e,t,r="ltr"){const n=iP(t),l=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,h=t.scrollbar.size-l,f=t.content-t.viewport,o=h-n,v=r==="ltr"?[0,f]:[f*-1,0],b=jR(e,v);return rK([0,f],[0,o])(b)}function rK(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function nK(e,t){return e>0&&e<t}var nxe=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function l(){const h={left:e.scrollLeft,top:e.scrollTop},f=r.left!==h.left,o=r.top!==h.top;(f||o)&&t(),r=h,n=window.requestAnimationFrame(l)}(),()=>window.cancelAnimationFrame(n)};function oP(e,t){const r=os(e),n=K.useRef(0);return K.useEffect(()=>()=>window.clearTimeout(n.current),[]),K.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function T_(e,t){const r=os(t);ws(()=>{let n=0;if(e){const l=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return l.observe(e),()=>{window.cancelAnimationFrame(n),l.unobserve(e)}}},[e,r])}var iK=qX,ixe=XX,oxe=eK;const NR=K.forwardRef(({className:e,children:t,...r},n)=>M.jsxs(iK,{ref:n,className:ln("relative overflow-hidden",e),...r,children:[M.jsx(ixe,{className:"h-full w-full rounded-[inherit]",children:t}),M.jsx(oK,{}),M.jsx(oxe,{})]}));NR.displayName=iK.displayName;const oK=K.forwardRef(({className:e,orientation:t="vertical",...r},n)=>M.jsx(TN,{ref:n,orientation:t,className:ln("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:M.jsx(QX,{className:"relative flex-1 rounded-full bg-border"})}));oK.displayName=TN.displayName;var cO="rovingFocusGroup.onEntryFocus",sxe={bubbles:!1,cancelable:!0},Qw="RovingFocusGroup",[zR,sK,axe]=gj(Qw),[lxe,aK]=Ec(Qw,[axe]),[cxe,uxe]=lxe(Qw),lK=K.forwardRef((e,t)=>M.jsx(zR.Provider,{scope:e.__scopeRovingFocusGroup,children:M.jsx(zR.Slot,{scope:e.__scopeRovingFocusGroup,children:M.jsx(hxe,{...e,ref:t})})}));lK.displayName=Qw;var hxe=K.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:l=!1,dir:h,currentTabStopId:f,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:v,onEntryFocus:b,preventScrollOnEntryFocus:E=!1,...P}=e,O=K.useRef(null),L=mi(t,O),B=nP(h),[z,$]=gm({prop:f,defaultProp:o??null,onChange:v,caller:Qw}),[U,G]=K.useState(!1),Z=os(b),ne=sK(r),Y=K.useRef(!1),[ee,le]=K.useState(0);return K.useEffect(()=>{const fe=O.current;if(fe)return fe.addEventListener(cO,Z),()=>fe.removeEventListener(cO,Z)},[Z]),M.jsx(cxe,{scope:r,orientation:n,dir:B,loop:l,currentTabStopId:z,onItemFocus:K.useCallback(fe=>$(fe),[$]),onItemShiftTab:K.useCallback(()=>G(!0),[]),onFocusableItemAdd:K.useCallback(()=>le(fe=>fe+1),[]),onFocusableItemRemove:K.useCallback(()=>le(fe=>fe-1),[]),children:M.jsx(pn.div,{tabIndex:U||ee===0?-1:0,"data-orientation":n,...P,ref:L,style:{outline:"none",...e.style},onMouseDown:Xr(e.onMouseDown,()=>{Y.current=!0}),onFocus:Xr(e.onFocus,fe=>{const Ce=!Y.current;if(fe.target===fe.currentTarget&&Ce&&!U){const Oe=new CustomEvent(cO,sxe);if(fe.currentTarget.dispatchEvent(Oe),!Oe.defaultPrevented){const Me=ne().filter(Je=>Je.focusable),Ke=Me.find(Je=>Je.active),Ye=Me.find(Je=>Je.id===z),Qe=[Ke,Ye,...Me].filter(Boolean).map(Je=>Je.ref.current);hK(Qe,E)}}Y.current=!1}),onBlur:Xr(e.onBlur,()=>G(!1))})})}),cK="RovingFocusGroupItem",uK=K.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:l=!1,tabStopId:h,children:f,...o}=e,v=df(),b=h||v,E=uxe(cK,r),P=E.currentTabStopId===b,O=sK(r),{onFocusableItemAdd:L,onFocusableItemRemove:B,currentTabStopId:z}=E;return K.useEffect(()=>{if(n)return L(),()=>B()},[n,L,B]),M.jsx(zR.ItemSlot,{scope:r,id:b,focusable:n,active:l,children:M.jsx(pn.span,{tabIndex:P?0:-1,"data-orientation":E.orientation,...o,ref:t,onMouseDown:Xr(e.onMouseDown,$=>{n?E.onItemFocus(b):$.preventDefault()}),onFocus:Xr(e.onFocus,()=>E.onItemFocus(b)),onKeyDown:Xr(e.onKeyDown,$=>{if($.key==="Tab"&&$.shiftKey){E.onItemShiftTab();return}if($.target!==$.currentTarget)return;const U=pxe($,E.orientation,E.dir);if(U!==void 0){if($.metaKey||$.ctrlKey||$.altKey||$.shiftKey)return;$.preventDefault();let Z=O().filter(ne=>ne.focusable).map(ne=>ne.ref.current);if(U==="last")Z.reverse();else if(U==="prev"||U==="next"){U==="prev"&&Z.reverse();const ne=Z.indexOf($.currentTarget);Z=E.loop?mxe(Z,ne+1):Z.slice(ne+1)}setTimeout(()=>hK(Z))}}),children:typeof f=="function"?f({isCurrentTabStop:P,hasTabStop:z!=null}):f})})});uK.displayName=cK;var dxe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function fxe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function pxe(e,t,r){const n=fxe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return dxe[n]}function hK(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function mxe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var gxe=lK,yxe=uK,sP="Tabs",[_xe,YGe]=Ec(sP,[aK]),dK=aK(),[vxe,PN]=_xe(sP),fK=K.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:l,defaultValue:h,orientation:f="horizontal",dir:o,activationMode:v="automatic",...b}=e,E=nP(o),[P,O]=gm({prop:n,onChange:l,defaultProp:h??"",caller:sP});return M.jsx(vxe,{scope:r,baseId:df(),value:P,onValueChange:O,orientation:f,dir:E,activationMode:v,children:M.jsx(pn.div,{dir:E,"data-orientation":f,...b,ref:t})})});fK.displayName=sP;var pK="TabsList",mK=K.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...l}=e,h=PN(pK,r),f=dK(r);return M.jsx(gxe,{asChild:!0,...f,orientation:h.orientation,dir:h.dir,loop:n,children:M.jsx(pn.div,{role:"tablist","aria-orientation":h.orientation,...l,ref:t})})});mK.displayName=pK;var gK="TabsTrigger",yK=K.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:l=!1,...h}=e,f=PN(gK,r),o=dK(r),v=xK(f.baseId,n),b=bK(f.baseId,n),E=n===f.value;return M.jsx(yxe,{asChild:!0,...o,focusable:!l,active:E,children:M.jsx(pn.button,{type:"button",role:"tab","aria-selected":E,"aria-controls":b,"data-state":E?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:v,...h,ref:t,onMouseDown:Xr(e.onMouseDown,P=>{!l&&P.button===0&&P.ctrlKey===!1?f.onValueChange(n):P.preventDefault()}),onKeyDown:Xr(e.onKeyDown,P=>{[" ","Enter"].includes(P.key)&&f.onValueChange(n)}),onFocus:Xr(e.onFocus,()=>{const P=f.activationMode!=="manual";!E&&!l&&P&&f.onValueChange(n)})})})});yK.displayName=gK;var _K="TabsContent",vK=K.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:l,children:h,...f}=e,o=PN(_K,r),v=xK(o.baseId,n),b=bK(o.baseId,n),E=n===o.value,P=K.useRef(E);return K.useEffect(()=>{const O=requestAnimationFrame(()=>P.current=!1);return()=>cancelAnimationFrame(O)},[]),M.jsx(Ac,{present:l||E,children:({present:O})=>M.jsx(pn.div,{"data-state":E?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":v,hidden:!O,id:b,tabIndex:0,...f,ref:t,style:{...e.style,animationDuration:P.current?"0s":void 0},children:O&&h})})});vK.displayName=_K;function xK(e,t){return`${e}-trigger-${t}`}function bK(e,t){return`${e}-content-${t}`}var xxe=fK,wK=mK,SK=yK,TK=vK;const CN=xxe,aP=K.forwardRef(({className:e,...t},r)=>M.jsx(wK,{ref:r,className:ln("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));aP.displayName=wK.displayName;const bu=K.forwardRef(({className:e,...t},r)=>M.jsx(SK,{ref:r,className:ln("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));bu.displayName=SK.displayName;const wu=K.forwardRef(({className:e,...t},r)=>M.jsx(TK,{ref:r,className:ln("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));wu.displayName=TK.displayName;var IN="Progress",MN=100,[bxe,JGe]=Ec(IN),[wxe,Sxe]=bxe(IN),EK=K.forwardRef((e,t)=>{const{__scopeProgress:r,value:n=null,max:l,getValueLabel:h=Txe,...f}=e;(l||l===0)&&!pU(l)&&console.error(Exe(`${l}`,"Progress"));const o=pU(l)?l:MN;n!==null&&!mU(n,o)&&console.error(Axe(`${n}`,"Progress"));const v=mU(n,o)?n:null,b=p2(v)?h(v,o):void 0;return M.jsx(wxe,{scope:r,value:v,max:o,children:M.jsx(pn.div,{"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":p2(v)?v:void 0,"aria-valuetext":b,role:"progressbar","data-state":CK(v,o),"data-value":v??void 0,"data-max":o,...f,ref:t})})});EK.displayName=IN;var AK="ProgressIndicator",PK=K.forwardRef((e,t)=>{const{__scopeProgress:r,...n}=e,l=Sxe(AK,r);return M.jsx(pn.div,{"data-state":CK(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...n,ref:t})});PK.displayName=AK;function Txe(e,t){return`${Math.round(e/t*100)}%`}function CK(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function p2(e){return typeof e=="number"}function pU(e){return p2(e)&&!isNaN(e)&&e>0}function mU(e,t){return p2(e)&&!isNaN(e)&&e<=t&&e>=0}function Exe(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${MN}\`.`}function Axe(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${MN} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var IK=EK,Pxe=PK;const ON=K.forwardRef(({className:e,value:t,...r},n)=>M.jsx(IK,{ref:n,className:ln("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:M.jsx(Pxe,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));ON.displayName=IK.displayName;function MK(e){const t=K.useRef({value:e,previous:e});return K.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var lP="Switch",[Cxe,QGe]=Ec(lP),[Ixe,Mxe]=Cxe(lP),OK=K.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:l,defaultChecked:h,required:f,disabled:o,value:v="on",onCheckedChange:b,form:E,...P}=e,[O,L]=K.useState(null),B=mi(t,Z=>L(Z)),z=K.useRef(!1),$=O?E||!!O.closest("form"):!0,[U,G]=gm({prop:l,defaultProp:h??!1,onChange:b,caller:lP});return M.jsxs(Ixe,{scope:r,checked:U,disabled:o,children:[M.jsx(pn.button,{type:"button",role:"switch","aria-checked":U,"aria-required":f,"data-state":LK(U),"data-disabled":o?"":void 0,disabled:o,value:v,...P,ref:B,onClick:Xr(e.onClick,Z=>{G(ne=>!ne),$&&(z.current=Z.isPropagationStopped(),z.current||Z.stopPropagation())})}),$&&M.jsx(DK,{control:O,bubbles:!z.current,name:n,value:v,checked:U,required:f,disabled:o,form:E,style:{transform:"translateX(-100%)"}})]})});OK.displayName=lP;var kK="SwitchThumb",RK=K.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,l=Mxe(kK,r);return M.jsx(pn.span,{"data-state":LK(l.checked),"data-disabled":l.disabled?"":void 0,...n,ref:t})});RK.displayName=kK;var Oxe="SwitchBubbleInput",DK=K.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...l},h)=>{const f=K.useRef(null),o=mi(f,h),v=MK(r),b=J7(t);return K.useEffect(()=>{const E=f.current;if(!E)return;const P=window.HTMLInputElement.prototype,L=Object.getOwnPropertyDescriptor(P,"checked").set;if(v!==r&&L){const B=new Event("click",{bubbles:n});L.call(E,r),E.dispatchEvent(B)}},[v,r,n]),M.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...l,tabIndex:-1,ref:o,style:{...l.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});DK.displayName=Oxe;function LK(e){return e?"checked":"unchecked"}var jK=OK,kxe=RK;const NK=K.forwardRef(({className:e,...t},r)=>M.jsx(jK,{className:ln("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:r,children:M.jsx(kxe,{className:ln("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));NK.displayName=jK.displayName;const Rxe=({onDataChange:e,isEnabled:t=!0}={})=>{const r=K.useCallback((n,l)=>{console.log(`Admin Monitor: Critical change in ${l}:`,n),n.eventType==="INSERT"?ch.success(`Ny data tillagd i ${l}`,{description:`${n.eventType} operation utförd`,duration:5e3}):n.eventType==="UPDATE"?ch.info(`Data uppdaterad i ${l}`,{description:`Rad ${n.new?.id||"unknown"} modifierad`,duration:3e3}):n.eventType==="DELETE"&&ch.error(`Data borttagen från ${l}`,{description:`Rad ${n.old?.id||"unknown"} raderad`,duration:5e3}),e&&setTimeout(e,500)},[e]);return K.useEffect(()=>{if(!t)return;console.log("Admin Real-time Monitor: Starting subscriptions");const n=_n.channel("admin_preschool_monitor").on("postgres_changes",{event:"*",schema:"public",table:"Förskolor"},v=>r(v,"Förskolor")).subscribe(),l=_n.channel("admin_google_monitor").on("postgres_changes",{event:"*",schema:"public",table:"preschool_google_data"},v=>r(v,"Google Data")).subscribe(),h=_n.channel("admin_image_monitor").on("postgres_changes",{event:"*",schema:"public",table:"preschool_images"},v=>r(v,"Preschool Images")).subscribe(),f=_n.channel("admin_favorites_monitor").on("postgres_changes",{event:"*",schema:"public",table:"user_favorites"},v=>{console.log("Admin Monitor: User favorites activity:",v),e&&setTimeout(e,1e3)}).subscribe(),o=_n.channel("admin_search_monitor").on("postgres_changes",{event:"*",schema:"public",table:"user_search_history"},v=>{console.log("Admin Monitor: Search activity:",v),e&&setTimeout(e,1e3)}).subscribe();return()=>{console.log("Admin Real-time Monitor: Cleaning up subscriptions"),_n.removeChannel(n),_n.removeChannel(l),_n.removeChannel(h),_n.removeChannel(f),_n.removeChannel(o)}},[t,r]),{isMonitoring:t}},Dxe=()=>{const[e,t]=K.useState(null),[r,n]=K.useState(!0),{preschools:l}=Lo(),h=()=>{if(!l.length)return;const f=l.length,o=l.filter(P=>P.latitud!==null&&P.longitud!==null&&P.latitud!==0&&P.longitud!==0).length,v=f-o,b=l.filter(P=>P.latitud===null||P.longitud===null||P.latitud===0||P.longitud===0).length,E={};l.forEach(P=>{E[P.kommun]||(E[P.kommun]={total:0,missing:0,percentage:0}),E[P.kommun].total++,(P.latitud===null||P.longitud===null||P.latitud===0||P.longitud===0)&&E[P.kommun].missing++}),Object.keys(E).forEach(P=>{const O=E[P];O.percentage=Math.round(O.missing/O.total*100)}),t({total:f,withCoordinates:o,missingCoordinates:v,needsGeocoding:b,byKommun:E}),n(!1)};return K.useEffect(()=>{h()},[l]),{stats:e,isLoading:r,refresh:h}},Lxe=ev("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),zK=K.forwardRef(({className:e,variant:t,...r},n)=>M.jsx("div",{ref:n,role:"alert",className:ln(Lxe({variant:t}),e),...r}));zK.displayName="Alert";const jxe=K.forwardRef(({className:e,...t},r)=>M.jsx("h5",{ref:r,className:ln("mb-1 font-medium leading-none tracking-tight",e),...t}));jxe.displayName="AlertTitle";const FK=K.forwardRef(({className:e,...t},r)=>M.jsx("div",{ref:r,className:ln("text-sm [&_p]:leading-relaxed",e),...t}));FK.displayName="AlertDescription";const Nxe=({missingCoordinatesCount:e,onComplete:t})=>{const[r,n]=K.useState(!1),[l,h]=K.useState(0),[f,o]=K.useState(0),[v,b]=K.useState(0),[E,P]=K.useState(0),[O,L]=K.useState(0),[B,z]=K.useState([]),{preschools:$}=Lo(),{toast:U}=mj(),G=async()=>{n(!0),h(0),o(0),b(0),z([]);try{const Y=$.filter(Me=>Me.latitud===null||Me.longitud===null||Me.latitud===0||Me.longitud===0);if(Y.length===0){U({title:"Ingen bearbetning krävs",description:"Alla förskolor har redan koordinater."}),n(!1);return}const ee=25,le=Math.ceil(Y.length/ee);L(le),console.log(`Starting batch processing: ${Y.length} preschools in ${le} batches`);let fe=0,Ce=0;const Oe=[];for(let Me=0;Me<le;Me++){P(Me+1);const Ke=Me*ee,Ye=Math.min(Ke+ee,Y.length),Le=Y.slice(Ke,Ye);console.log(`Processing batch ${Me+1}/${le}: ${Le.length} preschools`);const Qe=Le.map(Je=>({id:Je.id,Namn:Je.namn,Adress:Je.adress,Kommun:Je.kommun,Postnummer:null,Latitud:Je.latitud,Longitud:Je.longitud}));try{const{data:Je,error:it}=await _n.functions.invoke("geocoding-service",{body:{preschools:Qe}});it?(console.error(`Batch ${Me+1} error:`,it),U({title:`Batch ${Me+1} misslyckades`,description:it.message,variant:"destructive"})):Je&&(fe+=Je.processed||0,Ce+=Je.successful||0,Oe.push(...Je.results||[]),console.log(`Batch ${Me+1} completed: ${Je.successful}/${Je.processed} successful`))}catch(Je){console.error(`Batch ${Me+1} exception:`,Je),U({title:`Batch ${Me+1} fel`,description:`Oväntat fel: ${Je}`,variant:"destructive"})}o(fe),b(Ce),h(Math.round((Me+1)/le*100)),Me<le-1&&(console.log("Waiting 5 seconds before next batch..."),await new Promise(Je=>setTimeout(Je,5e3)))}z(Oe),U({title:"Batch-bearbetning slutförd",description:`${Ce} av ${fe} förskolor bearbetades framgångsrikt.`}),t&&t()}catch(Y){console.error("Batch processing error:",Y),U({title:"Bearbetningsfel",description:`Ett fel uppstod: ${Y}`,variant:"destructive"})}finally{n(!1)}},Z=()=>{n(!1),U({title:"Bearbetning stoppad",description:"Batch-bearbetningen har stoppats."})},ne=()=>{h(0),o(0),b(0),P(0),L(0),z([])};return M.jsxs(Cn,{children:[M.jsxs(Ky,{children:[M.jsxs(Yy,{className:"flex items-center gap-2",children:[M.jsx(Ha,{className:"h-5 w-5"}),"Koordinat Batch-processor"]}),M.jsx(vX,{children:"Bearbeta förskolor som saknar koordinater i batch-operationer"})]}),M.jsxs(Ml,{className:"space-y-4",children:[e>0&&M.jsxs(zK,{children:[M.jsx(Ha,{className:"h-4 w-4"}),M.jsxs(FK,{children:[M.jsx("strong",{children:e})," förskolor saknar koordinater och behöver bearbetas."]})]}),r&&M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex justify-between text-sm",children:[M.jsxs("span",{children:["Batch ",E," av ",O]}),M.jsxs("span",{children:[v,"/",f," framgångsrika"]})]}),M.jsx(ON,{value:l,className:"w-full"}),M.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[M.jsx("span",{children:"Bearbetar koordinater..."}),M.jsxs("span",{children:[l,"% färdigt"]})]})]}),M.jsx("div",{className:"flex gap-2",children:r?M.jsxs(fn,{variant:"destructive",onClick:Z,className:"flex items-center gap-2",children:[M.jsx(C7,{className:"h-4 w-4"}),"Stoppa bearbetning"]}):M.jsxs(M.Fragment,{children:[M.jsxs(fn,{onClick:G,disabled:e===0,className:"flex items-center gap-2",children:[M.jsx(P7,{className:"h-4 w-4"}),"Starta batch-bearbetning"]}),(f>0||B.length>0)&&M.jsxs(fn,{variant:"outline",onClick:ne,className:"flex items-center gap-2",children:[M.jsx(vce,{className:"h-4 w-4"}),"Återställ"]})]})}),B.length>0&&M.jsxs("div",{className:"mt-4",children:[M.jsx("h4",{className:"font-medium mb-2",children:"Senaste resultat:"}),M.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:B.slice(-10).map((Y,ee)=>M.jsxs("div",{className:"flex justify-between items-center text-sm",children:[M.jsx("span",{className:"truncate",children:Y.namn}),M.jsx(An,{variant:Y.success?"default":"destructive",children:Y.success?"✓":"✗"})]},ee))})]})]})]})};var uO=0;function BK(){K.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??gU()),document.body.insertAdjacentElement("beforeend",e[1]??gU()),uO++,()=>{uO===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),uO--}},[])}function gU(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var hO="focusScope.autoFocusOnMount",dO="focusScope.autoFocusOnUnmount",yU={bubbles:!1,cancelable:!0},zxe="FocusScope",kN=K.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:l,onUnmountAutoFocus:h,...f}=e,[o,v]=K.useState(null),b=os(l),E=os(h),P=K.useRef(null),O=mi(t,z=>v(z)),L=K.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;K.useEffect(()=>{if(n){let z=function(Z){if(L.paused||!o)return;const ne=Z.target;o.contains(ne)?P.current=ne:zd(P.current,{select:!0})},$=function(Z){if(L.paused||!o)return;const ne=Z.relatedTarget;ne!==null&&(o.contains(ne)||zd(P.current,{select:!0}))},U=function(Z){if(document.activeElement===document.body)for(const Y of Z)Y.removedNodes.length>0&&zd(o)};document.addEventListener("focusin",z),document.addEventListener("focusout",$);const G=new MutationObserver(U);return o&&G.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",z),document.removeEventListener("focusout",$),G.disconnect()}}},[n,o,L.paused]),K.useEffect(()=>{if(o){vU.add(L);const z=document.activeElement;if(!o.contains(z)){const U=new CustomEvent(hO,yU);o.addEventListener(hO,b),o.dispatchEvent(U),U.defaultPrevented||(Fxe(Gxe($K(o)),{select:!0}),document.activeElement===z&&zd(o))}return()=>{o.removeEventListener(hO,b),setTimeout(()=>{const U=new CustomEvent(dO,yU);o.addEventListener(dO,E),o.dispatchEvent(U),U.defaultPrevented||zd(z??document.body,{select:!0}),o.removeEventListener(dO,E),vU.remove(L)},0)}}},[o,b,E,L]);const B=K.useCallback(z=>{if(!r&&!n||L.paused)return;const $=z.key==="Tab"&&!z.altKey&&!z.ctrlKey&&!z.metaKey,U=document.activeElement;if($&&U){const G=z.currentTarget,[Z,ne]=Bxe(G);Z&&ne?!z.shiftKey&&U===ne?(z.preventDefault(),r&&zd(Z,{select:!0})):z.shiftKey&&U===Z&&(z.preventDefault(),r&&zd(ne,{select:!0})):U===G&&z.preventDefault()}},[r,n,L.paused]);return M.jsx(pn.div,{tabIndex:-1,...f,ref:O,onKeyDown:B})});kN.displayName=zxe;function Fxe(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(zd(n,{select:t}),document.activeElement!==r)return}function Bxe(e){const t=$K(e),r=_U(t,e),n=_U(t.reverse(),e);return[r,n]}function $K(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const l=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||l?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function _U(e,t){for(const r of e)if(!$xe(r,{upTo:t}))return r}function $xe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Vxe(e){return e instanceof HTMLInputElement&&"select"in e}function zd(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&Vxe(e)&&t&&e.select()}}var vU=Uxe();function Uxe(){let e=[];return{add(t){const r=e[0];t!==r&&r?.pause(),e=xU(e,t),e.unshift(t)},remove(t){e=xU(e,t),e[0]?.resume()}}}function xU(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function Gxe(e){return e.filter(t=>t.tagName!=="A")}var Hxe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},uy=new WeakMap,BT=new WeakMap,$T={},fO=0,VK=function(e){return e&&(e.host||VK(e.parentNode))},Wxe=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=VK(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},qxe=function(e,t,r,n){var l=Wxe(t,Array.isArray(e)?e:[e]);$T[r]||($T[r]=new WeakMap);var h=$T[r],f=[],o=new Set,v=new Set(l),b=function(P){!P||o.has(P)||(o.add(P),b(P.parentNode))};l.forEach(b);var E=function(P){!P||v.has(P)||Array.prototype.forEach.call(P.children,function(O){if(o.has(O))E(O);else try{var L=O.getAttribute(n),B=L!==null&&L!=="false",z=(uy.get(O)||0)+1,$=(h.get(O)||0)+1;uy.set(O,z),h.set(O,$),f.push(O),z===1&&B&&BT.set(O,!0),$===1&&O.setAttribute(r,"true"),B||O.setAttribute(n,"true")}catch(U){console.error("aria-hidden: cannot operate on ",O,U)}})};return E(t),o.clear(),fO++,function(){f.forEach(function(P){var O=uy.get(P)-1,L=h.get(P)-1;uy.set(P,O),h.set(P,L),O||(BT.has(P)||P.removeAttribute(n),BT.delete(P)),L||P.removeAttribute(r)}),fO--,fO||(uy=new WeakMap,uy=new WeakMap,BT=new WeakMap,$T={})}},UK=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),l=Hxe(e);return l?(n.push.apply(n,Array.from(l.querySelectorAll("[aria-live], script"))),qxe(n,l,r,"aria-hidden")):function(){return null}},du=function(){return du=Object.assign||function(t){for(var r,n=1,l=arguments.length;n<l;n++){r=arguments[n];for(var h in r)Object.prototype.hasOwnProperty.call(r,h)&&(t[h]=r[h])}return t},du.apply(this,arguments)};function GK(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(r[n[l]]=e[n[l]]);return r}function Zxe(e,t,r){if(r||arguments.length===2)for(var n=0,l=t.length,h;n<l;n++)(h||!(n in t))&&(h||(h=Array.prototype.slice.call(t,0,n)),h[n]=t[n]);return e.concat(h||Array.prototype.slice.call(t))}var TE="right-scroll-bar-position",EE="width-before-scroll-bar",Xxe="with-scroll-bars-hidden",Kxe="--removed-body-scroll-bar-size";function pO(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Yxe(e,t){var r=K.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var l=r.value;l!==n&&(r.value=n,r.callback(n,l))}}}})[0];return r.callback=t,r.facade}var Jxe=typeof window<"u"?K.useLayoutEffect:K.useEffect,bU=new WeakMap;function Qxe(e,t){var r=Yxe(null,function(n){return e.forEach(function(l){return pO(l,n)})});return Jxe(function(){var n=bU.get(r);if(n){var l=new Set(n),h=new Set(e),f=r.current;l.forEach(function(o){h.has(o)||pO(o,null)}),h.forEach(function(o){l.has(o)||pO(o,f)})}bU.set(r,e)},[e]),r}function ebe(e){return e}function tbe(e,t){t===void 0&&(t=ebe);var r=[],n=!1,l={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(h){var f=t(h,n);return r.push(f),function(){r=r.filter(function(o){return o!==f})}},assignSyncMedium:function(h){for(n=!0;r.length;){var f=r;r=[],f.forEach(h)}r={push:function(o){return h(o)},filter:function(){return r}}},assignMedium:function(h){n=!0;var f=[];if(r.length){var o=r;r=[],o.forEach(h),f=r}var v=function(){var E=f;f=[],E.forEach(h)},b=function(){return Promise.resolve().then(v)};b(),r={push:function(E){f.push(E),b()},filter:function(E){return f=f.filter(E),r}}}};return l}function rbe(e){e===void 0&&(e={});var t=tbe(null);return t.options=du({async:!0,ssr:!1},e),t}var HK=function(e){var t=e.sideCar,r=GK(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return K.createElement(n,du({},r))};HK.isSideCarExport=!0;function nbe(e,t){return e.useMedium(t),HK}var WK=rbe(),mO=function(){},cP=K.forwardRef(function(e,t){var r=K.useRef(null),n=K.useState({onScrollCapture:mO,onWheelCapture:mO,onTouchMoveCapture:mO}),l=n[0],h=n[1],f=e.forwardProps,o=e.children,v=e.className,b=e.removeScrollBar,E=e.enabled,P=e.shards,O=e.sideCar,L=e.noRelative,B=e.noIsolation,z=e.inert,$=e.allowPinchZoom,U=e.as,G=U===void 0?"div":U,Z=e.gapMode,ne=GK(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Y=O,ee=Qxe([r,t]),le=du(du({},ne),l);return K.createElement(K.Fragment,null,E&&K.createElement(Y,{sideCar:WK,removeScrollBar:b,shards:P,noRelative:L,noIsolation:B,inert:z,setCallbacks:h,allowPinchZoom:!!$,lockRef:r,gapMode:Z}),f?K.cloneElement(K.Children.only(o),du(du({},le),{ref:ee})):K.createElement(G,du({},le,{className:v,ref:ee}),o))});cP.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};cP.classNames={fullWidth:EE,zeroRight:TE};var ibe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function obe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=ibe();return t&&e.setAttribute("nonce",t),e}function sbe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function abe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var lbe=function(){var e=0,t=null;return{add:function(r){e==0&&(t=obe())&&(sbe(t,r),abe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},cbe=function(){var e=lbe();return function(t,r){K.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},qK=function(){var e=cbe(),t=function(r){var n=r.styles,l=r.dynamic;return e(n,l),null};return t},ube={left:0,top:0,right:0,gap:0},gO=function(e){return parseInt(e||"",10)||0},hbe=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],l=t[e==="padding"?"paddingRight":"marginRight"];return[gO(r),gO(n),gO(l)]},dbe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return ube;var t=hbe(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},fbe=qK(),Jy="data-scroll-locked",pbe=function(e,t,r,n){var l=e.left,h=e.top,f=e.right,o=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(Xxe,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(o,"px ").concat(n,`;
  }
  body[`).concat(Jy,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(h,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(o,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(TE,` {
    right: `).concat(o,"px ").concat(n,`;
  }
  
  .`).concat(EE,` {
    margin-right: `).concat(o,"px ").concat(n,`;
  }
  
  .`).concat(TE," .").concat(TE,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(EE," .").concat(EE,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Jy,`] {
    `).concat(Kxe,": ").concat(o,`px;
  }
`)},wU=function(){var e=parseInt(document.body.getAttribute(Jy)||"0",10);return isFinite(e)?e:0},mbe=function(){K.useEffect(function(){return document.body.setAttribute(Jy,(wU()+1).toString()),function(){var e=wU()-1;e<=0?document.body.removeAttribute(Jy):document.body.setAttribute(Jy,e.toString())}},[])},gbe=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,l=n===void 0?"margin":n;mbe();var h=K.useMemo(function(){return dbe(l)},[l]);return K.createElement(fbe,{styles:pbe(h,!t,l,r?"":"!important")})},FR=!1;if(typeof window<"u")try{var VT=Object.defineProperty({},"passive",{get:function(){return FR=!0,!0}});window.addEventListener("test",VT,VT),window.removeEventListener("test",VT,VT)}catch{FR=!1}var hy=FR?{passive:!1}:!1,ybe=function(e){return e.tagName==="TEXTAREA"},ZK=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!ybe(e)&&r[t]==="visible")},_be=function(e){return ZK(e,"overflowY")},vbe=function(e){return ZK(e,"overflowX")},SU=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var l=XK(e,n);if(l){var h=KK(e,n),f=h[1],o=h[2];if(f>o)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},xbe=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},bbe=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},XK=function(e,t){return e==="v"?_be(t):vbe(t)},KK=function(e,t){return e==="v"?xbe(t):bbe(t)},wbe=function(e,t){return e==="h"&&t==="rtl"?-1:1},Sbe=function(e,t,r,n,l){var h=wbe(e,window.getComputedStyle(t).direction),f=h*n,o=r.target,v=t.contains(o),b=!1,E=f>0,P=0,O=0;do{if(!o)break;var L=KK(e,o),B=L[0],z=L[1],$=L[2],U=z-$-h*B;(B||U)&&XK(e,o)&&(P+=U,O+=B);var G=o.parentNode;o=G&&G.nodeType===Node.DOCUMENT_FRAGMENT_NODE?G.host:G}while(!v&&o!==document.body||v&&(t.contains(o)||t===o));return(E&&Math.abs(P)<1||!E&&Math.abs(O)<1)&&(b=!0),b},UT=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},TU=function(e){return[e.deltaX,e.deltaY]},EU=function(e){return e&&"current"in e?e.current:e},Tbe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Ebe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Abe=0,dy=[];function Pbe(e){var t=K.useRef([]),r=K.useRef([0,0]),n=K.useRef(),l=K.useState(Abe++)[0],h=K.useState(qK)[0],f=K.useRef(e);K.useEffect(function(){f.current=e},[e]),K.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(l));var z=Zxe([e.lockRef.current],(e.shards||[]).map(EU),!0).filter(Boolean);return z.forEach(function($){return $.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),z.forEach(function($){return $.classList.remove("allow-interactivity-".concat(l))})}}},[e.inert,e.lockRef.current,e.shards]);var o=K.useCallback(function(z,$){if("touches"in z&&z.touches.length===2||z.type==="wheel"&&z.ctrlKey)return!f.current.allowPinchZoom;var U=UT(z),G=r.current,Z="deltaX"in z?z.deltaX:G[0]-U[0],ne="deltaY"in z?z.deltaY:G[1]-U[1],Y,ee=z.target,le=Math.abs(Z)>Math.abs(ne)?"h":"v";if("touches"in z&&le==="h"&&ee.type==="range")return!1;var fe=SU(le,ee);if(!fe)return!0;if(fe?Y=le:(Y=le==="v"?"h":"v",fe=SU(le,ee)),!fe)return!1;if(!n.current&&"changedTouches"in z&&(Z||ne)&&(n.current=Y),!Y)return!0;var Ce=n.current||Y;return Sbe(Ce,$,z,Ce==="h"?Z:ne)},[]),v=K.useCallback(function(z){var $=z;if(!(!dy.length||dy[dy.length-1]!==h)){var U="deltaY"in $?TU($):UT($),G=t.current.filter(function(Y){return Y.name===$.type&&(Y.target===$.target||$.target===Y.shadowParent)&&Tbe(Y.delta,U)})[0];if(G&&G.should){$.cancelable&&$.preventDefault();return}if(!G){var Z=(f.current.shards||[]).map(EU).filter(Boolean).filter(function(Y){return Y.contains($.target)}),ne=Z.length>0?o($,Z[0]):!f.current.noIsolation;ne&&$.cancelable&&$.preventDefault()}}},[]),b=K.useCallback(function(z,$,U,G){var Z={name:z,delta:$,target:U,should:G,shadowParent:Cbe(U)};t.current.push(Z),setTimeout(function(){t.current=t.current.filter(function(ne){return ne!==Z})},1)},[]),E=K.useCallback(function(z){r.current=UT(z),n.current=void 0},[]),P=K.useCallback(function(z){b(z.type,TU(z),z.target,o(z,e.lockRef.current))},[]),O=K.useCallback(function(z){b(z.type,UT(z),z.target,o(z,e.lockRef.current))},[]);K.useEffect(function(){return dy.push(h),e.setCallbacks({onScrollCapture:P,onWheelCapture:P,onTouchMoveCapture:O}),document.addEventListener("wheel",v,hy),document.addEventListener("touchmove",v,hy),document.addEventListener("touchstart",E,hy),function(){dy=dy.filter(function(z){return z!==h}),document.removeEventListener("wheel",v,hy),document.removeEventListener("touchmove",v,hy),document.removeEventListener("touchstart",E,hy)}},[]);var L=e.removeScrollBar,B=e.inert;return K.createElement(K.Fragment,null,B?K.createElement(h,{styles:Ebe(l)}):null,L?K.createElement(gbe,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function Cbe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Ibe=nbe(WK,Pbe);var RN=K.forwardRef(function(e,t){return K.createElement(cP,du({},e,{ref:t,sideCar:Ibe}))});RN.classNames=cP.classNames;var Mbe=[" ","Enter","ArrowUp","ArrowDown"],Obe=[" ","Enter"],vm="Select",[uP,hP,kbe]=gj(vm),[uv,eHe]=Ec(vm,[kbe,FA]),dP=FA(),[Rbe,Ef]=uv(vm),[Dbe,Lbe]=uv(vm),YK=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:l,onOpenChange:h,value:f,defaultValue:o,onValueChange:v,dir:b,name:E,autoComplete:P,disabled:O,required:L,form:B}=e,z=dP(t),[$,U]=K.useState(null),[G,Z]=K.useState(null),[ne,Y]=K.useState(!1),ee=nP(b),[le,fe]=gm({prop:n,defaultProp:l??!1,onChange:h,caller:vm}),[Ce,Oe]=gm({prop:f,defaultProp:o,onChange:v,caller:vm}),Me=K.useRef(null),Ke=$?B||!!$.closest("form"):!0,[Ye,Le]=K.useState(new Set),Qe=Array.from(Ye).map(Je=>Je.props.value).join(";");return M.jsx(rde,{...z,children:M.jsxs(Rbe,{required:L,scope:t,trigger:$,onTriggerChange:U,valueNode:G,onValueNodeChange:Z,valueNodeHasChildren:ne,onValueNodeHasChildrenChange:Y,contentId:df(),value:Ce,onValueChange:Oe,open:le,onOpenChange:fe,dir:ee,triggerPointerDownPosRef:Me,disabled:O,children:[M.jsx(uP.Provider,{scope:t,children:M.jsx(Dbe,{scope:e.__scopeSelect,onNativeOptionAdd:K.useCallback(Je=>{Le(it=>new Set(it).add(Je))},[]),onNativeOptionRemove:K.useCallback(Je=>{Le(it=>{const Ze=new Set(it);return Ze.delete(Je),Ze})},[]),children:r})}),Ke?M.jsxs(bY,{"aria-hidden":!0,required:L,tabIndex:-1,name:E,autoComplete:P,value:Ce,onChange:Je=>Oe(Je.target.value),disabled:O,form:B,children:[Ce===void 0?M.jsx("option",{value:""}):null,Array.from(Ye)]},Qe):null]})})};YK.displayName=vm;var JK="SelectTrigger",QK=K.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...l}=e,h=dP(r),f=Ef(JK,r),o=f.disabled||n,v=mi(t,f.onTriggerChange),b=hP(r),E=K.useRef("touch"),[P,O,L]=SY(z=>{const $=b().filter(Z=>!Z.disabled),U=$.find(Z=>Z.value===f.value),G=TY($,z,U);G!==void 0&&f.onValueChange(G.value)}),B=z=>{o||(f.onOpenChange(!0),L()),z&&(f.triggerPointerDownPosRef.current={x:Math.round(z.pageX),y:Math.round(z.pageY)})};return M.jsx(l9,{asChild:!0,...h,children:M.jsx(pn.button,{type:"button",role:"combobox","aria-controls":f.contentId,"aria-expanded":f.open,"aria-required":f.required,"aria-autocomplete":"none",dir:f.dir,"data-state":f.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":wY(f.value)?"":void 0,...l,ref:v,onClick:Xr(l.onClick,z=>{z.currentTarget.focus(),E.current!=="mouse"&&B(z)}),onPointerDown:Xr(l.onPointerDown,z=>{E.current=z.pointerType;const $=z.target;$.hasPointerCapture(z.pointerId)&&$.releasePointerCapture(z.pointerId),z.button===0&&z.ctrlKey===!1&&z.pointerType==="mouse"&&(B(z),z.preventDefault())}),onKeyDown:Xr(l.onKeyDown,z=>{const $=P.current!=="";!(z.ctrlKey||z.altKey||z.metaKey)&&z.key.length===1&&O(z.key),!($&&z.key===" ")&&Mbe.includes(z.key)&&(B(),z.preventDefault())})})})});QK.displayName=JK;var eY="SelectValue",tY=K.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:l,children:h,placeholder:f="",...o}=e,v=Ef(eY,r),{onValueNodeHasChildrenChange:b}=v,E=h!==void 0,P=mi(t,v.onValueNodeChange);return ws(()=>{b(E)},[b,E]),M.jsx(pn.span,{...o,ref:P,style:{pointerEvents:"none"},children:wY(v.value)?M.jsx(M.Fragment,{children:f}):h})});tY.displayName=eY;var jbe="SelectIcon",rY=K.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...l}=e;return M.jsx(pn.span,{"aria-hidden":!0,...l,ref:t,children:n||"▼"})});rY.displayName=jbe;var Nbe="SelectPortal",nY=e=>M.jsx(OA,{asChild:!0,...e});nY.displayName=Nbe;var xm="SelectContent",iY=K.forwardRef((e,t)=>{const r=Ef(xm,e.__scopeSelect),[n,l]=K.useState();if(ws(()=>{l(new DocumentFragment)},[]),!r.open){const h=n;return h?Mm.createPortal(M.jsx(oY,{scope:e.__scopeSelect,children:M.jsx(uP.Slot,{scope:e.__scopeSelect,children:M.jsx("div",{children:e.children})})}),h):null}return M.jsx(sY,{...e,ref:t})});iY.displayName=xm;var cc=10,[oY,Af]=uv(xm),zbe="SelectContentImpl",Fbe=v_("SelectContent.RemoveScroll"),sY=K.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:l,onEscapeKeyDown:h,onPointerDownOutside:f,side:o,sideOffset:v,align:b,alignOffset:E,arrowPadding:P,collisionBoundary:O,collisionPadding:L,sticky:B,hideWhenDetached:z,avoidCollisions:$,...U}=e,G=Ef(xm,r),[Z,ne]=K.useState(null),[Y,ee]=K.useState(null),le=mi(t,Kt=>ne(Kt)),[fe,Ce]=K.useState(null),[Oe,Me]=K.useState(null),Ke=hP(r),[Ye,Le]=K.useState(!1),Qe=K.useRef(!1);K.useEffect(()=>{if(Z)return UK(Z)},[Z]),BK();const Je=K.useCallback(Kt=>{const[Pr,...Qt]=Ke().map(Ft=>Ft.ref.current),[nr]=Qt.slice(-1),xr=document.activeElement;for(const Ft of Kt)if(Ft===xr||(Ft?.scrollIntoView({block:"nearest"}),Ft===Pr&&Y&&(Y.scrollTop=0),Ft===nr&&Y&&(Y.scrollTop=Y.scrollHeight),Ft?.focus(),document.activeElement!==xr))return},[Ke,Y]),it=K.useCallback(()=>Je([fe,Z]),[Je,fe,Z]);K.useEffect(()=>{Ye&&it()},[Ye,it]);const{onOpenChange:Ze,triggerPointerDownPosRef:nt}=G;K.useEffect(()=>{if(Z){let Kt={x:0,y:0};const Pr=nr=>{Kt={x:Math.abs(Math.round(nr.pageX)-(nt.current?.x??0)),y:Math.abs(Math.round(nr.pageY)-(nt.current?.y??0))}},Qt=nr=>{Kt.x<=10&&Kt.y<=10?nr.preventDefault():Z.contains(nr.target)||Ze(!1),document.removeEventListener("pointermove",Pr),nt.current=null};return nt.current!==null&&(document.addEventListener("pointermove",Pr),document.addEventListener("pointerup",Qt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Pr),document.removeEventListener("pointerup",Qt,{capture:!0})}}},[Z,Ze,nt]),K.useEffect(()=>{const Kt=()=>Ze(!1);return window.addEventListener("blur",Kt),window.addEventListener("resize",Kt),()=>{window.removeEventListener("blur",Kt),window.removeEventListener("resize",Kt)}},[Ze]);const[pt,_t]=SY(Kt=>{const Pr=Ke().filter(xr=>!xr.disabled),Qt=Pr.find(xr=>xr.ref.current===document.activeElement),nr=TY(Pr,Kt,Qt);nr&&setTimeout(()=>nr.ref.current.focus())}),It=K.useCallback((Kt,Pr,Qt)=>{const nr=!Qe.current&&!Qt;(G.value!==void 0&&G.value===Pr||nr)&&(Ce(Kt),nr&&(Qe.current=!0))},[G.value]),sr=K.useCallback(()=>Z?.focus(),[Z]),Sr=K.useCallback((Kt,Pr,Qt)=>{const nr=!Qe.current&&!Qt;(G.value!==void 0&&G.value===Pr||nr)&&Me(Kt)},[G.value]),Kr=n==="popper"?BR:aY,Er=Kr===BR?{side:o,sideOffset:v,align:b,alignOffset:E,arrowPadding:P,collisionBoundary:O,collisionPadding:L,sticky:B,hideWhenDetached:z,avoidCollisions:$}:{};return M.jsx(oY,{scope:r,content:Z,viewport:Y,onViewportChange:ee,itemRefCallback:It,selectedItem:fe,onItemLeave:sr,itemTextRefCallback:Sr,focusSelectedItem:it,selectedItemText:Oe,position:n,isPositioned:Ye,searchRef:pt,children:M.jsx(RN,{as:Fbe,allowPinchZoom:!0,children:M.jsx(kN,{asChild:!0,trapped:G.open,onMountAutoFocus:Kt=>{Kt.preventDefault()},onUnmountAutoFocus:Xr(l,Kt=>{G.trigger?.focus({preventScroll:!0}),Kt.preventDefault()}),children:M.jsx(Uw,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:h,onPointerDownOutside:f,onFocusOutside:Kt=>Kt.preventDefault(),onDismiss:()=>G.onOpenChange(!1),children:M.jsx(Kr,{role:"listbox",id:G.contentId,"data-state":G.open?"open":"closed",dir:G.dir,onContextMenu:Kt=>Kt.preventDefault(),...U,...Er,onPlaced:()=>Le(!0),ref:le,style:{display:"flex",flexDirection:"column",outline:"none",...U.style},onKeyDown:Xr(U.onKeyDown,Kt=>{const Pr=Kt.ctrlKey||Kt.altKey||Kt.metaKey;if(Kt.key==="Tab"&&Kt.preventDefault(),!Pr&&Kt.key.length===1&&_t(Kt.key),["ArrowUp","ArrowDown","Home","End"].includes(Kt.key)){let nr=Ke().filter(xr=>!xr.disabled).map(xr=>xr.ref.current);if(["ArrowUp","End"].includes(Kt.key)&&(nr=nr.slice().reverse()),["ArrowUp","ArrowDown"].includes(Kt.key)){const xr=Kt.target,Ft=nr.indexOf(xr);nr=nr.slice(Ft+1)}setTimeout(()=>Je(nr)),Kt.preventDefault()}})})})})})})});sY.displayName=zbe;var Bbe="SelectItemAlignedPosition",aY=K.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...l}=e,h=Ef(xm,r),f=Af(xm,r),[o,v]=K.useState(null),[b,E]=K.useState(null),P=mi(t,le=>E(le)),O=hP(r),L=K.useRef(!1),B=K.useRef(!0),{viewport:z,selectedItem:$,selectedItemText:U,focusSelectedItem:G}=f,Z=K.useCallback(()=>{if(h.trigger&&h.valueNode&&o&&b&&z&&$&&U){const le=h.trigger.getBoundingClientRect(),fe=b.getBoundingClientRect(),Ce=h.valueNode.getBoundingClientRect(),Oe=U.getBoundingClientRect();if(h.dir!=="rtl"){const xr=Oe.left-fe.left,Ft=Ce.left-xr,Pn=le.left-Ft,Hr=le.width+Pn,Yr=Math.max(Hr,fe.width),kn=window.innerWidth-cc,Si=jR(Ft,[cc,Math.max(cc,kn-Yr)]);o.style.minWidth=Hr+"px",o.style.left=Si+"px"}else{const xr=fe.right-Oe.right,Ft=window.innerWidth-Ce.right-xr,Pn=window.innerWidth-le.right-Ft,Hr=le.width+Pn,Yr=Math.max(Hr,fe.width),kn=window.innerWidth-cc,Si=jR(Ft,[cc,Math.max(cc,kn-Yr)]);o.style.minWidth=Hr+"px",o.style.right=Si+"px"}const Me=O(),Ke=window.innerHeight-cc*2,Ye=z.scrollHeight,Le=window.getComputedStyle(b),Qe=parseInt(Le.borderTopWidth,10),Je=parseInt(Le.paddingTop,10),it=parseInt(Le.borderBottomWidth,10),Ze=parseInt(Le.paddingBottom,10),nt=Qe+Je+Ye+Ze+it,pt=Math.min($.offsetHeight*5,nt),_t=window.getComputedStyle(z),It=parseInt(_t.paddingTop,10),sr=parseInt(_t.paddingBottom,10),Sr=le.top+le.height/2-cc,Kr=Ke-Sr,Er=$.offsetHeight/2,Kt=$.offsetTop+Er,Pr=Qe+Je+Kt,Qt=nt-Pr;if(Pr<=Sr){const xr=Me.length>0&&$===Me[Me.length-1].ref.current;o.style.bottom="0px";const Ft=b.clientHeight-z.offsetTop-z.offsetHeight,Pn=Math.max(Kr,Er+(xr?sr:0)+Ft+it),Hr=Pr+Pn;o.style.height=Hr+"px"}else{const xr=Me.length>0&&$===Me[0].ref.current;o.style.top="0px";const Pn=Math.max(Sr,Qe+z.offsetTop+(xr?It:0)+Er)+Qt;o.style.height=Pn+"px",z.scrollTop=Pr-Sr+z.offsetTop}o.style.margin=`${cc}px 0`,o.style.minHeight=pt+"px",o.style.maxHeight=Ke+"px",n?.(),requestAnimationFrame(()=>L.current=!0)}},[O,h.trigger,h.valueNode,o,b,z,$,U,h.dir,n]);ws(()=>Z(),[Z]);const[ne,Y]=K.useState();ws(()=>{b&&Y(window.getComputedStyle(b).zIndex)},[b]);const ee=K.useCallback(le=>{le&&B.current===!0&&(Z(),G?.(),B.current=!1)},[Z,G]);return M.jsx(Vbe,{scope:r,contentWrapper:o,shouldExpandOnScrollRef:L,onScrollButtonChange:ee,children:M.jsx("div",{ref:v,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ne},children:M.jsx(pn.div,{...l,ref:P,style:{boxSizing:"border-box",maxHeight:"100%",...l.style}})})})});aY.displayName=Bbe;var $be="SelectPopperPosition",BR=K.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:l=cc,...h}=e,f=dP(r);return M.jsx(c9,{...f,...h,ref:t,align:n,collisionPadding:l,style:{boxSizing:"border-box",...h.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});BR.displayName=$be;var[Vbe,DN]=uv(xm,{}),$R="SelectViewport",lY=K.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...l}=e,h=Af($R,r),f=DN($R,r),o=mi(t,h.onViewportChange),v=K.useRef(0);return M.jsxs(M.Fragment,{children:[M.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),M.jsx(uP.Slot,{scope:r,children:M.jsx(pn.div,{"data-radix-select-viewport":"",role:"presentation",...l,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...l.style},onScroll:Xr(l.onScroll,b=>{const E=b.currentTarget,{contentWrapper:P,shouldExpandOnScrollRef:O}=f;if(O?.current&&P){const L=Math.abs(v.current-E.scrollTop);if(L>0){const B=window.innerHeight-cc*2,z=parseFloat(P.style.minHeight),$=parseFloat(P.style.height),U=Math.max(z,$);if(U<B){const G=U+L,Z=Math.min(B,G),ne=G-Z;P.style.height=Z+"px",P.style.bottom==="0px"&&(E.scrollTop=ne>0?ne:0,P.style.justifyContent="flex-end")}}}v.current=E.scrollTop})})})]})});lY.displayName=$R;var cY="SelectGroup",[Ube,Gbe]=uv(cY),Hbe=K.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,l=df();return M.jsx(Ube,{scope:r,id:l,children:M.jsx(pn.div,{role:"group","aria-labelledby":l,...n,ref:t})})});Hbe.displayName=cY;var uY="SelectLabel",hY=K.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,l=Gbe(uY,r);return M.jsx(pn.div,{id:l.id,...n,ref:t})});hY.displayName=uY;var m2="SelectItem",[Wbe,dY]=uv(m2),fY=K.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:l=!1,textValue:h,...f}=e,o=Ef(m2,r),v=Af(m2,r),b=o.value===n,[E,P]=K.useState(h??""),[O,L]=K.useState(!1),B=mi(t,G=>v.itemRefCallback?.(G,n,l)),z=df(),$=K.useRef("touch"),U=()=>{l||(o.onValueChange(n),o.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return M.jsx(Wbe,{scope:r,value:n,disabled:l,textId:z,isSelected:b,onItemTextChange:K.useCallback(G=>{P(Z=>Z||(G?.textContent??"").trim())},[]),children:M.jsx(uP.ItemSlot,{scope:r,value:n,disabled:l,textValue:E,children:M.jsx(pn.div,{role:"option","aria-labelledby":z,"data-highlighted":O?"":void 0,"aria-selected":b&&O,"data-state":b?"checked":"unchecked","aria-disabled":l||void 0,"data-disabled":l?"":void 0,tabIndex:l?void 0:-1,...f,ref:B,onFocus:Xr(f.onFocus,()=>L(!0)),onBlur:Xr(f.onBlur,()=>L(!1)),onClick:Xr(f.onClick,()=>{$.current!=="mouse"&&U()}),onPointerUp:Xr(f.onPointerUp,()=>{$.current==="mouse"&&U()}),onPointerDown:Xr(f.onPointerDown,G=>{$.current=G.pointerType}),onPointerMove:Xr(f.onPointerMove,G=>{$.current=G.pointerType,l?v.onItemLeave?.():$.current==="mouse"&&G.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Xr(f.onPointerLeave,G=>{G.currentTarget===document.activeElement&&v.onItemLeave?.()}),onKeyDown:Xr(f.onKeyDown,G=>{v.searchRef?.current!==""&&G.key===" "||(Obe.includes(G.key)&&U(),G.key===" "&&G.preventDefault())})})})})});fY.displayName=m2;var Jx="SelectItemText",pY=K.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:l,...h}=e,f=Ef(Jx,r),o=Af(Jx,r),v=dY(Jx,r),b=Lbe(Jx,r),[E,P]=K.useState(null),O=mi(t,U=>P(U),v.onItemTextChange,U=>o.itemTextRefCallback?.(U,v.value,v.disabled)),L=E?.textContent,B=K.useMemo(()=>M.jsx("option",{value:v.value,disabled:v.disabled,children:L},v.value),[v.disabled,v.value,L]),{onNativeOptionAdd:z,onNativeOptionRemove:$}=b;return ws(()=>(z(B),()=>$(B)),[z,$,B]),M.jsxs(M.Fragment,{children:[M.jsx(pn.span,{id:v.textId,...h,ref:O}),v.isSelected&&f.valueNode&&!f.valueNodeHasChildren?Mm.createPortal(h.children,f.valueNode):null]})});pY.displayName=Jx;var mY="SelectItemIndicator",gY=K.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return dY(mY,r).isSelected?M.jsx(pn.span,{"aria-hidden":!0,...n,ref:t}):null});gY.displayName=mY;var VR="SelectScrollUpButton",yY=K.forwardRef((e,t)=>{const r=Af(VR,e.__scopeSelect),n=DN(VR,e.__scopeSelect),[l,h]=K.useState(!1),f=mi(t,n.onScrollButtonChange);return ws(()=>{if(r.viewport&&r.isPositioned){let o=function(){const b=v.scrollTop>0;h(b)};const v=r.viewport;return o(),v.addEventListener("scroll",o),()=>v.removeEventListener("scroll",o)}},[r.viewport,r.isPositioned]),l?M.jsx(vY,{...e,ref:f,onAutoScroll:()=>{const{viewport:o,selectedItem:v}=r;o&&v&&(o.scrollTop=o.scrollTop-v.offsetHeight)}}):null});yY.displayName=VR;var UR="SelectScrollDownButton",_Y=K.forwardRef((e,t)=>{const r=Af(UR,e.__scopeSelect),n=DN(UR,e.__scopeSelect),[l,h]=K.useState(!1),f=mi(t,n.onScrollButtonChange);return ws(()=>{if(r.viewport&&r.isPositioned){let o=function(){const b=v.scrollHeight-v.clientHeight,E=Math.ceil(v.scrollTop)<b;h(E)};const v=r.viewport;return o(),v.addEventListener("scroll",o),()=>v.removeEventListener("scroll",o)}},[r.viewport,r.isPositioned]),l?M.jsx(vY,{...e,ref:f,onAutoScroll:()=>{const{viewport:o,selectedItem:v}=r;o&&v&&(o.scrollTop=o.scrollTop+v.offsetHeight)}}):null});_Y.displayName=UR;var vY=K.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...l}=e,h=Af("SelectScrollButton",r),f=K.useRef(null),o=hP(r),v=K.useCallback(()=>{f.current!==null&&(window.clearInterval(f.current),f.current=null)},[]);return K.useEffect(()=>()=>v(),[v]),ws(()=>{o().find(E=>E.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[o]),M.jsx(pn.div,{"aria-hidden":!0,...l,ref:t,style:{flexShrink:0,...l.style},onPointerDown:Xr(l.onPointerDown,()=>{f.current===null&&(f.current=window.setInterval(n,50))}),onPointerMove:Xr(l.onPointerMove,()=>{h.onItemLeave?.(),f.current===null&&(f.current=window.setInterval(n,50))}),onPointerLeave:Xr(l.onPointerLeave,()=>{v()})})}),qbe="SelectSeparator",xY=K.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return M.jsx(pn.div,{"aria-hidden":!0,...n,ref:t})});xY.displayName=qbe;var GR="SelectArrow",Zbe=K.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,l=dP(r),h=Ef(GR,r),f=Af(GR,r);return h.open&&f.position==="popper"?M.jsx(u9,{...l,...n,ref:t}):null});Zbe.displayName=GR;var Xbe="SelectBubbleInput",bY=K.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const l=K.useRef(null),h=mi(n,l),f=MK(t);return K.useEffect(()=>{const o=l.current;if(!o)return;const v=window.HTMLSelectElement.prototype,E=Object.getOwnPropertyDescriptor(v,"value").set;if(f!==t&&E){const P=new Event("change",{bubbles:!0});E.call(o,t),o.dispatchEvent(P)}},[f,t]),M.jsx(pn.select,{...r,style:{...t7,...r.style},ref:h,defaultValue:t})});bY.displayName=Xbe;function wY(e){return e===""||e===void 0}function SY(e){const t=os(e),r=K.useRef(""),n=K.useRef(0),l=K.useCallback(f=>{const o=r.current+f;t(o),function v(b){r.current=b,window.clearTimeout(n.current),b!==""&&(n.current=window.setTimeout(()=>v(""),1e3))}(o)},[t]),h=K.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return K.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,l,h]}function TY(e,t,r){const l=t.length>1&&Array.from(t).every(b=>b===t[0])?t[0]:t,h=r?e.indexOf(r):-1;let f=Kbe(e,Math.max(h,0));l.length===1&&(f=f.filter(b=>b!==r));const v=f.find(b=>b.textValue.toLowerCase().startsWith(l.toLowerCase()));return v!==r?v:void 0}function Kbe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var Ybe=YK,EY=QK,Jbe=tY,Qbe=rY,ewe=nY,AY=iY,twe=lY,PY=hY,CY=fY,rwe=pY,nwe=gY,IY=yY,MY=_Y,OY=xY;const iwe=Ybe,owe=Jbe,kY=K.forwardRef(({className:e,children:t,...r},n)=>M.jsxs(EY,{ref:n,className:ln("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,M.jsx(Qbe,{asChild:!0,children:M.jsx(DA,{className:"h-4 w-4 opacity-50"})})]}));kY.displayName=EY.displayName;const RY=K.forwardRef(({className:e,...t},r)=>M.jsx(IY,{ref:r,className:ln("flex cursor-default items-center justify-center py-1",e),...t,children:M.jsx(bj,{className:"h-4 w-4"})}));RY.displayName=IY.displayName;const DY=K.forwardRef(({className:e,...t},r)=>M.jsx(MY,{ref:r,className:ln("flex cursor-default items-center justify-center py-1",e),...t,children:M.jsx(DA,{className:"h-4 w-4"})}));DY.displayName=MY.displayName;const LY=K.forwardRef(({className:e,children:t,position:r="popper",...n},l)=>M.jsx(ewe,{children:M.jsxs(AY,{ref:l,className:ln("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[M.jsx(RY,{}),M.jsx(twe,{className:ln("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),M.jsx(DY,{})]})}));LY.displayName=AY.displayName;const swe=K.forwardRef(({className:e,...t},r)=>M.jsx(PY,{ref:r,className:ln("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));swe.displayName=PY.displayName;const Qx=K.forwardRef(({className:e,children:t,...r},n)=>M.jsxs(CY,{ref:n,className:ln("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[M.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:M.jsx(nwe,{children:M.jsx(sce,{className:"h-4 w-4"})})}),M.jsx(rwe,{children:t})]}));Qx.displayName=CY.displayName;const awe=K.forwardRef(({className:e,...t},r)=>M.jsx(OY,{ref:r,className:ln("-mx-1 my-1 h-px bg-muted",e),...t}));awe.displayName=OY.displayName;var lwe="Label",jY=K.forwardRef((e,t)=>M.jsx(pn.label,{...e,ref:t,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));jY.displayName=lwe;var NY=jY;const cwe=ev("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),HR=K.forwardRef(({className:e,...t},r)=>M.jsx(NY,{ref:r,className:ln(cwe(),e),...t}));HR.displayName=NY.displayName;const uwe=({isOpen:e,onClose:t})=>{const[r,n]=K.useState(!1),[l,h]=K.useState(0),[f,o]=K.useState(10),[v,b]=K.useState(!0),[E,P]=K.useState([]),[O,L]=K.useState("checking"),[B,z]=K.useState(null),[$,U]=K.useState(!1),{preschools:G}=Lo(),{toast:Z}=mj(),{stats:ne,isLoading:Y,refresh:ee}=Dxe(),le=G.filter(Le=>Le.latitud===null||Le.longitud===null||Le.latitud===0||Le.longitud===0),fe=async()=>{U(!0);try{const{data:Le,error:Qe}=await _n.functions.invoke("admin-stats");if(Qe)throw Qe;Le&&Le.database&&z({database:{totalPreschools:Le.database.totalPreschools,missingCoordinates:Le.database.missingCoordinates,withGoogleData:Le.database.withGoogleData,withImages:Le.database.withImages,coordinatesCoverage:Le.database.coordinatesCoverage,googleDataCoverage:Le.database.googleDataCoverage,imagesCoverage:Le.database.imagesCoverage,userFavorites:Le.database.userFavorites,searchHistory:Le.database.searchHistory,googleDataEntries:Le.database.googleDataEntries,imagesCount:Le.database.imagesCount},storage:Le.storage,activity:Le.activity,systemHealth:{databaseOnline:Le.systemHealth.databaseOnline,lastUpdated:Le.systemHealth.lastUpdated}})}catch(Le){console.error("Failed to load admin stats:",Le),Z({title:"Fel",description:"Kunde inte ladda administrativa statistik via admin-stats funktion",variant:"destructive"});try{const{data:Qe,count:Je}=await _n.from("Förskolor").select("id",{count:"exact",head:!0}),{count:it}=await _n.from("Förskolor").select("id",{count:"exact",head:!0}).or("Latitud.is.null,Longitud.is.null,Latitud.eq.0,Longitud.eq.0"),{count:Ze}=await _n.from("preschool_google_data").select("id",{count:"exact",head:!0}),{count:nt}=await _n.from("preschool_images").select("id",{count:"exact",head:!0}),pt=Je||0,_t=it||0,It=Ze||0,sr=nt||0;z({database:{totalPreschools:pt,missingCoordinates:_t,withGoogleData:It,withImages:sr,coordinatesCoverage:pt>0?(pt-_t)/pt*100:0,googleDataCoverage:pt>0?It/pt*100:0,imagesCoverage:pt>0?sr/pt*100:0},systemHealth:{databaseOnline:!0,lastUpdated:new Date().toISOString()}})}catch(Qe){console.error("Fallback stats loading also failed:",Qe)}}finally{U(!1)}};Rxe({onDataChange:fe,isEnabled:e});const Ce=async()=>{L("checking");try{const{data:Le,error:Qe}=await _n.from("Förskolor").select("count").limit(1);if(Qe)throw Qe;L("online")}catch(Le){console.error("API Status check failed:",Le),L("offline")}},Oe=async()=>{if(!r){n(!0),h(0),P([]);try{const Le=await _n.functions.invoke("fix-missing-geocoding",{body:{batchSize:f,dryRun:v}});if(Le.error)throw Le.error;const Qe=Le.data;P(Qe.results||[]),h(100),Z({title:v?"Test slutförd":"Geocoding slutförd",description:`Bearbetade ${Qe.processed} förskolor. ${Qe.success} lyckades, ${Qe.errors} misslyckades.`,variant:Qe.success>0?"default":"destructive"}),!v&&Qe.success>0&&await fe()}catch(Le){console.error("Geocoding failed:",Le),Z({title:"Geocoding misslyckades",description:Le.message,variant:"destructive"})}finally{n(!1)}}},Me=()=>{n(!1),h(0)},Ke=()=>{P([]),h(0)},Ye=async()=>{if(!le.length){Z({title:"Inga förskolor att bearbeta",description:"Alla förskolor har redan koordinater"});return}n(!0),P([]);try{const Le=await _n.functions.invoke("geocoding-service",{body:{preschools:le.slice(0,f).map(Je=>({id:Je.id,Namn:Je.namn,Adress:Je.adress,Kommun:Je.kommun,Latitud:Je.latitud,Longitud:Je.longitud}))}});if(Le.error)throw Le.error;const Qe=Le.data;P(Qe.results||[]),Z({title:"Avancerad geocoding slutförd",description:`${Qe.successful}/${Qe.processed} förskolor geocodade framgångsrikt`,variant:Qe.successful>0?"default":"destructive"}),await fe()}catch(Le){console.error("Advanced geocoding failed:",Le),Z({title:"Avancerad geocoding misslyckades",description:Le.message,variant:"destructive"})}finally{n(!1)}};return K.useEffect(()=>{e&&(Ce(),fe())},[e]),e?M.jsx(Pc,{children:M.jsxs($r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 glass-nav",children:[M.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:t}),M.jsx($r.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"absolute top-4 left-4 right-4 bottom-4 max-w-6xl mx-auto",children:M.jsxs(Cn,{className:"h-full glass-card border-0 shadow-lg",children:[M.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border/20",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx(Ej,{className:"h-6 w-6 text-primary"}),M.jsx("h2",{className:"text-2xl font-heading font-bold",children:"Admin Panel"}),M.jsx(An,{variant:O==="online"?"default":"destructive",children:O==="online"?"Online":O==="offline"?"Offline":"Kontrollerar..."})]}),M.jsx(fn,{onClick:t,variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover-scale",children:M.jsx($l,{className:"h-4 w-4"})})]}),M.jsx("div",{className:"flex-1 p-6",children:M.jsxs(CN,{defaultValue:"overview",className:"h-full",children:[M.jsxs(aP,{className:"grid w-full grid-cols-3",children:[M.jsxs(bu,{value:"overview",children:[M.jsx(Sh,{className:"w-4 h-4 mr-2"}),"Översikt"]}),M.jsxs(bu,{value:"geocoding",children:[M.jsx(Ha,{className:"w-4 h-4 mr-2"}),"Koordinater"]}),M.jsxs(bu,{value:"system",children:[M.jsx(e$,{className:"w-4 h-4 mr-2"}),"System"]})]}),M.jsx(wu,{value:"overview",className:"mt-6",children:M.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:$?M.jsxs("div",{className:"col-span-full flex items-center justify-center py-12",children:[M.jsx($d,{className:"h-8 w-8 animate-spin text-primary"}),M.jsx("span",{className:"ml-2 font-heading",children:"Laddar statistik..."})]}):B?M.jsxs(M.Fragment,{children:[M.jsxs(Cn,{className:"p-6 card-hover",children:[M.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[M.jsx(Sj,{className:"h-8 w-8 text-primary"}),M.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Databas"})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Totalt förskolor:"}),M.jsx(An,{variant:"secondary",children:B.database.totalPreschools.toLocaleString()})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Saknar koordinater:"}),M.jsx(An,{variant:B.database.missingCoordinates>0?"destructive":"default",children:B.database.missingCoordinates.toLocaleString()})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Koordinattäckning:"}),M.jsxs(An,{variant:"default",children:[B.database.coordinatesCoverage.toFixed(1),"%"]})]})]})]}),M.jsxs(Cn,{className:"p-6 card-hover",children:[M.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[M.jsx(ba,{className:"h-8 w-8 text-yellow-500"}),M.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Google Data"})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Med Google data:"}),M.jsx(An,{variant:"secondary",children:B.database.withGoogleData.toLocaleString()})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Datatäckning:"}),M.jsxs(An,{variant:"default",children:[B.database.googleDataCoverage.toFixed(1),"%"]})]})]})]}),M.jsxs(Cn,{className:"p-6 card-hover",children:[M.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[M.jsx(pce,{className:"h-8 w-8 text-green-500"}),M.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Bilder"})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Med bilder:"}),M.jsx(An,{variant:"secondary",children:B.database.withImages.toLocaleString()})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Bildtäckning:"}),M.jsxs(An,{variant:"default",children:[B.database.imagesCoverage.toFixed(1),"%"]})]}),B.database.imagesCount&&M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Totalt bilder:"}),M.jsx(An,{variant:"outline",children:B.database.imagesCount.toLocaleString()})]})]})]}),B.database.userFavorites!==void 0&&M.jsxs(Cn,{className:"p-6 card-hover",children:[M.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[M.jsx(km,{className:"h-8 w-8 text-blue-500"}),M.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Användaraktivitet"})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Favoriter:"}),M.jsx(An,{variant:"secondary",children:B.database.userFavorites.toLocaleString()})]}),B.database.searchHistory!==void 0&&M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Sökhistorik:"}),M.jsx(An,{variant:"secondary",children:B.database.searchHistory.toLocaleString()})]})]})]}),B.storage&&M.jsxs(Cn,{className:"p-6 card-hover",children:[M.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[M.jsx(fce,{className:"h-8 w-8 text-purple-500"}),M.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Lagring"})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Total storlek:"}),M.jsx(An,{variant:"secondary",children:B.storage.totalSizeFormatted})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Buckets:"}),M.jsx(An,{variant:"outline",children:B.storage.buckets.length})]})]})]}),B.activity&&B.activity.recentLogs.length>0&&M.jsxs(Cn,{className:"p-6 card-hover col-span-full",children:[M.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[M.jsx(YE,{className:"h-8 w-8 text-orange-500"}),M.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Senaste aktivitet"})]}),M.jsx(NR,{className:"h-40",children:M.jsx("div",{className:"space-y-2",children:B.activity.recentLogs.slice(0,5).map((Le,Qe)=>M.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-muted/30",children:[M.jsx("span",{className:"text-sm text-muted-foreground truncate",children:Le.message}),M.jsx(An,{variant:"outline",className:"text-xs",children:new Date(Le.created_at).toLocaleTimeString()})]},Qe))})})]})]}):M.jsx("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"Kunde inte ladda statistik"})})}),M.jsx(wu,{value:"geocoding",className:"mt-6",children:M.jsxs("div",{className:"space-y-6",children:[M.jsx(Cn,{className:"glass-popup",children:M.jsxs("div",{className:"p-6",children:[M.jsxs("div",{className:"flex items-center justify-between mb-4",children:[M.jsx("h3",{className:"text-xl font-heading font-semibold",children:"Koordinat-statistik"}),M.jsxs(fn,{variant:"outline",size:"sm",onClick:ee,disabled:Y,className:"flex items-center gap-2",children:[M.jsx($d,{className:`h-4 w-4 ${Y?"animate-spin":""}`}),"Uppdatera"]})]}),Y?M.jsxs("div",{className:"flex items-center justify-center py-8",children:[M.jsx($d,{className:"h-6 w-6 animate-spin"}),M.jsx("span",{className:"ml-2",children:"Laddar koordinatstatistik..."})]}):ne?M.jsxs("div",{className:"space-y-4",children:[M.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[M.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[M.jsx("div",{className:"text-2xl font-bold",children:ne.total}),M.jsx("p",{className:"text-xs text-muted-foreground",children:"Totalt förskolor"})]}),M.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[M.jsx("div",{className:"text-2xl font-bold text-green-600",children:ne.withCoordinates}),M.jsx("p",{className:"text-xs text-muted-foreground",children:"Med koordinater"})]}),M.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[M.jsx("div",{className:"text-2xl font-bold text-red-600",children:ne.missingCoordinates}),M.jsx("p",{className:"text-xs text-muted-foreground",children:"Saknar koordinater"})]}),M.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[M.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(ne.withCoordinates/ne.total*100),"%"]}),M.jsx("p",{className:"text-xs text-muted-foreground",children:"Täckning"})]})]}),Object.entries(ne.byKommun).filter(([Le,Qe])=>Qe.missing>0).length>0&&M.jsxs("div",{className:"space-y-2",children:[M.jsx("h4",{className:"font-medium",children:"Kommuner med saknade koordinater:"}),M.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Object.entries(ne.byKommun).filter(([Le,Qe])=>Qe.missing>0).sort((Le,Qe)=>Qe[1].missing-Le[1].missing).slice(0,10).map(([Le,Qe])=>M.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-background/30 rounded",children:[M.jsx("span",{className:"truncate font-medium",children:Le}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("span",{className:"text-red-600 font-semibold",children:Qe.missing}),M.jsxs("span",{className:"text-muted-foreground",children:["av ",Qe.total]}),M.jsxs(An,{variant:"outline",children:[Qe.percentage,"%"]})]})]},Le))})]})]}):M.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Kunde inte ladda koordinatstatistik"})]})}),M.jsx(Nxe,{missingCoordinatesCount:le.length,onComplete:()=>{fe(),ee(),Z({title:"Koordinater uppdaterade",description:"Förskoledata har uppdaterats med nya koordinater."})}}),M.jsx(Cn,{className:"glass-popup",children:M.jsxs("div",{className:"p-6",children:[M.jsxs("div",{className:"flex items-center justify-between mb-6",children:[M.jsxs("div",{children:[M.jsx("h3",{className:"text-xl font-heading font-semibold mb-2",children:"Äldre geocoding-verktyg"}),M.jsx("p",{className:"text-muted-foreground",children:"Fallback-verktyg för manuell geocoding-hantering"})]}),M.jsxs(An,{variant:le.length>0?"destructive":"default",children:[le.length," saknar koordinater"]})]}),M.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[M.jsxs("div",{className:"space-y-4",children:[M.jsxs("div",{children:[M.jsx(HR,{htmlFor:"batch-size",className:"font-heading font-medium",children:"Antal per omgång"}),M.jsxs(iwe,{value:f.toString(),onValueChange:Le=>o(Number(Le)),children:[M.jsx(kY,{children:M.jsx(owe,{})}),M.jsxs(LY,{children:[M.jsx(Qx,{value:"5",children:"5 förskolor"}),M.jsx(Qx,{value:"10",children:"10 förskolor"}),M.jsx(Qx,{value:"20",children:"20 förskolor"}),M.jsx(Qx,{value:"50",children:"50 förskolor"})]})]})]}),M.jsxs("div",{className:"flex items-center space-x-2",children:[M.jsx(NK,{id:"dry-run",checked:v,onCheckedChange:b}),M.jsx(HR,{htmlFor:"dry-run",className:"font-heading font-medium",children:"Test-läge (sparar inte)"})]})]}),M.jsxs("div",{className:"space-y-4",children:[M.jsxs("div",{className:"flex gap-2",children:[M.jsx(fn,{onClick:Oe,disabled:r||le.length===0,className:"flex-1 hover-scale",variant:v?"outline":"default",children:r?M.jsxs(M.Fragment,{children:[M.jsx($d,{className:"w-4 h-4 mr-2 animate-spin"}),"Kör..."]}):M.jsxs(M.Fragment,{children:[M.jsx(P7,{className:"w-4 h-4 mr-2"}),v?"Testa":"Kör"," Geocoding"]})}),r&&M.jsx(fn,{onClick:Me,variant:"destructive",size:"sm",className:"hover-scale",children:M.jsx(C7,{className:"w-4 h-4"})})]}),M.jsxs(fn,{onClick:Ye,disabled:r||le.length===0,variant:"secondary",className:"w-full hover-scale",children:[M.jsx(S7,{className:"w-4 h-4 mr-2"}),"Avancerad Geocoding"]})]})]}),l>0&&M.jsxs("div",{className:"mb-6",children:[M.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[M.jsx("span",{className:"font-heading font-medium",children:"Framsteg"}),M.jsxs("span",{children:[l.toFixed(0),"%"]})]}),M.jsx(ON,{value:l,className:"h-2"})]}),E.length>0&&M.jsxs("div",{children:[M.jsxs("div",{className:"flex justify-between items-center mb-4",children:[M.jsxs("h4",{className:"font-heading font-medium",children:["Resultat (",E.length,")"]}),M.jsxs(fn,{onClick:Ke,variant:"ghost",size:"sm",className:"hover-scale",children:[M.jsx($l,{className:"w-4 h-4 mr-1"}),"Rensa"]})]}),M.jsx(NR,{className:"h-64 rounded-lg border",children:M.jsx("div",{className:"p-4 space-y-2",children:E.map((Le,Qe)=>M.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background/50 hover:bg-background/70 transition-colors",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[Le.status==="success"?M.jsx(lce,{className:"w-4 h-4 text-green-500"}):M.jsx(cce,{className:"w-4 h-4 text-red-500"}),M.jsxs("div",{children:[M.jsx("div",{className:"font-heading font-medium text-sm",children:Le.name}),Le.coordinates&&M.jsxs("div",{className:"text-xs text-muted-foreground",children:[Le.coordinates.lat.toFixed(4),", ",Le.coordinates.lng.toFixed(4)]}),Le.error&&M.jsx("div",{className:"text-xs text-red-500",children:Le.error})]})]}),M.jsx(An,{variant:Le.status==="success"?"default":"destructive",children:Le.updated?"Sparad":Le.status==="success"?"Test":"Fel"})]},Qe))})})]})]})})]})}),M.jsx(wu,{value:"system",className:"mt-6",children:M.jsxs("div",{className:"grid gap-6",children:[M.jsxs(Cn,{className:"p-6 card-hover",children:[M.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[M.jsx(YE,{className:"h-6 w-6 text-primary"}),M.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Systemhälsa"})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("span",{className:"text-muted-foreground",children:"Databas:"}),M.jsx(An,{variant:O==="online"?"default":"destructive",children:O==="online"?"Online":"Offline"})]}),B&&M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("span",{className:"text-muted-foreground",children:"Senast uppdaterad:"}),M.jsx("span",{className:"text-sm",children:new Date(B.systemHealth.lastUpdated).toLocaleString("sv-SE")})]})]})]}),M.jsxs(Cn,{className:"p-6 card-hover",children:[M.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[M.jsx(Tce,{className:"h-6 w-6 text-primary"}),M.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Verktyg"})]}),M.jsxs("div",{className:"flex gap-3",children:[M.jsxs(fn,{onClick:fe,disabled:$,variant:"outline",className:"hover-scale",children:[$?M.jsx($d,{className:"w-4 h-4 mr-2 animate-spin"}):M.jsx($d,{className:"w-4 h-4 mr-2"}),"Uppdatera statistik"]}),M.jsxs(fn,{onClick:Ce,variant:"outline",className:"hover-scale",children:[M.jsx(e$,{className:"w-4 h-4 mr-2"}),"Kontrollera API"]})]})]})]})})]})})]})})]})}):null},hwe=({className:e})=>{const[t,r]=K.useState(!1),{preschools:n,filteredPreschools:l,visiblePreschools:h,searchFilters:f,mapZoom:o}=Lo(),v=K.useMemo(()=>{const O=o>8?h:l;if(O.length===0)return null;const B=O.reduce((Y,ee)=>Y+(ee.antal_barn||0),0)/O.length,z=O.filter(Y=>Y.personaltäthet&&Y.personaltäthet>0),$=z.length>0?z.reduce((Y,ee)=>Y+ee.personaltäthet,0)/z.length:0,U=O.filter(Y=>Y.andel_med_förskollärarexamen!=null),G=U.length>0?U.reduce((Y,ee)=>Y+(ee.andel_med_förskollärarexamen||0),0)/U.length:0,Z=O.filter(Y=>Y.huvudman==="Kommunal").length,ne=O.filter(Y=>Y.huvudman==="Enskild").length;return{total:O.length,avgChildren:Math.round(B),avgStaff:Number($.toFixed(1)),avgExam:Math.round(G),municipal:Z,privatCount:ne}},[l,h,o]),b=K.useMemo(()=>{if(n.length===0)return null;const L=n.reduce((G,Z)=>G+(Z.antal_barn||0),0)/n.length,B=n.filter(G=>G.personaltäthet&&G.personaltäthet>0),z=B.length>0?B.reduce((G,Z)=>G+Z.personaltäthet,0)/B.length:0,$=n.filter(G=>G.andel_med_förskollärarexamen!=null),U=$.length>0?$.reduce((G,Z)=>G+(Z.andel_med_förskollärarexamen||0),0)/$.length:0;return{avgChildren:Math.round(L),avgStaff:Number(z.toFixed(1)),avgExam:Math.round(U)}},[n]),E=(O,L,B=!0)=>{if(Math.abs(O-L)<L*.05)return M.jsx(A7,{className:"w-3 h-3 text-muted-foreground"});const $=O>L;return(B?$:!$)?M.jsx(Om,{className:"w-3 h-3 text-green-600"}):M.jsx(bce,{className:"w-3 h-3 text-orange-500"})},P=()=>f.kommuner&&f.kommuner.length>0?`${f.kommuner[0]} vs Riket`:o>8?"Synliga vs Riket":"Aktuellt urval vs Riket";return!v||!b?null:M.jsx("div",{className:`fixed bottom-4 right-4 z-60 ${e}`,children:M.jsx(Pc,{mode:"wait",children:t?M.jsx($r.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{duration:.3,ease:"easeInOut"},children:M.jsxs(Cn,{className:"w-80 p-4 bg-card/95 backdrop-blur-xl border-border/50 shadow-2xl",children:[M.jsxs("div",{className:"flex items-center justify-between mb-3",children:[M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(Sh,{className:"w-4 h-4"}),M.jsx("h3",{className:"font-medium text-sm",children:P()})]}),M.jsx(fn,{onClick:()=>r(!1),variant:"ghost",size:"icon",className:"w-6 h-6 rounded-full",children:M.jsx($l,{className:"w-3 h-3"})})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("span",{className:"text-sm text-muted-foreground",children:"Förskolor"}),M.jsx(An,{variant:"outline",className:"text-xs",children:v.total})]}),M.jsxs("div",{className:"space-y-2",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("span",{className:"text-sm",children:"Barn/förskola"}),M.jsxs("div",{className:"flex items-center gap-1",children:[E(v.avgChildren,b.avgChildren),M.jsx("span",{className:"text-sm font-medium",children:v.avgChildren}),M.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",b.avgChildren,")"]})]})]}),M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("span",{className:"text-sm",children:"Personaltäthet"}),M.jsxs("div",{className:"flex items-center gap-1",children:[E(v.avgStaff,b.avgStaff),M.jsx("span",{className:"text-sm font-medium",children:v.avgStaff}),M.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",b.avgStaff,")"]})]})]}),M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("span",{className:"text-sm",children:"Lärarexamen %"}),M.jsxs("div",{className:"flex items-center gap-1",children:[E(v.avgExam,b.avgExam),M.jsxs("span",{className:"text-sm font-medium",children:[v.avgExam,"%"]}),M.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",b.avgExam,"%)"]})]})]})]}),M.jsxs("div",{className:"border-t border-border/50 pt-3",children:[M.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Huvudman"}),M.jsxs("div",{className:"flex justify-between",children:[M.jsxs("div",{className:"text-center",children:[M.jsx("div",{className:"text-sm font-medium",children:v.municipal}),M.jsx("div",{className:"text-xs text-muted-foreground",children:"Kommunal"})]}),M.jsxs("div",{className:"text-center",children:[M.jsx("div",{className:"text-sm font-medium",children:v.privatCount}),M.jsx("div",{className:"text-xs text-muted-foreground",children:"Enskild"})]})]})]})]})]})},"popup"):M.jsx($r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2}},"button")})})},dwe=({className:e})=>{const{layerVisibility:t,heatmapType:r,heatmapIntensity:n,showHeatmap:l,setLayerVisibility:h,setHeatmapType:f,setHeatmapIntensity:o,setShowHeatmap:v}=Lo();return M.jsx($r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:`absolute top-4 right-4 z-10 ${e}`})},AU="m 145.3125,527.5 0.5,3.75 -0.5,2.75 -1.4375,-1.1875 -2.125,-0.4375 -1.625,2.4375 2.125,3.0625 1.8125,1.25 0.0625,2.25 -1.4375,0.875 -0.6875,1.8125 0.875,1.1875 1.625,-0.625 0,1.5 -0.875,0.8125 -2.25,0.25 2.25,2.6875 0.5625,1.6875 -0.8125,2.75 -0.9375,2.5 -1.75,0.0625 0.3125,2.5 -1.9375,1.5 0.4375,2.25 -0.875,1.8125 0.9375,3 2.125,1 -2.25,3.375 -0.875,2.5 0.125,2.0625 -0.5625,2.5 -0.75,4.1875 0.9375,-0.5625 0.6875,1.1875 -0.8125,0.9375 -1.0625,-0.9375 -1.0625,4.6875 -1.875,0.4375 -1.125,2.25 -0.3125,1.375 0.0625,2.1875 -0.9375,0.375 -0.625,2.125 -1.0625,1.125 -0.9375,3.125 -0.8125,3.6875 -1.0625,4.0625 -1.375,2.875 -1.125,0.75 -1.5625,3.4375 -1.6875,-1.5 -2,1.1875 -1.1875,-0.4375 1.625,-1.5625 0.4375,-1.375 -1.3125,-1.125 -2.5625,0.4375 -0.875,-0.625 -1.6875,0.625 -1,1 -1.1875,-1.3125 -0.625,1.1875 -1.8125,1 -0.5625,-2 -1.0625,0.375 -2.3125,0.375 -1.75,-0.0625 -0.9375,-1.125 -1,1.125 -1.8125,0.0625 -2.625,0.125 -1.9375,0.25",fwe=({phase:e,progress:t,markerCount:r})=>{const[n]=K.useState(()=>{const h=[];for(let f=0;f<120;f++){const o=50+Math.random()*190,v=50+Math.random()*500;let b=o;v<200&&(b=100+Math.random()*90),v>400&&(b=70+Math.random()*150),h.push({id:f,x:b,y:v,size:1.2+Math.random()*.8,delay:Math.random()*.8})}return h}),l=Math.floor(t/100*n.length);return M.jsxs("div",{className:"relative w-32 h-72 mx-auto",children:[M.jsxs("svg",{viewBox:"0 0 290 660",className:"w-full h-full drop-shadow-xl",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.15))"},children:[M.jsx($r.path,{d:AU,fill:"none",stroke:"url(#swedenBorderGradient)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"2000",initial:{strokeDashoffset:2e3},animate:{strokeDashoffset:e==="drawing"?2e3-t*20:0},transition:{duration:0,ease:"linear"},style:{willChange:"stroke-dashoffset",transform:"translateZ(0)"},filter:"url(#borderGlow)"}),M.jsx($r.path,{d:AU,fill:"url(#swedenFillGradient)",stroke:"none",initial:{opacity:0,scale:.95},animate:{opacity:e==="filling"||e==="markers"||e==="complete"?.2:0,scale:e==="filling"||e==="markers"||e==="complete"?1:.95},transition:{duration:.6,ease:"easeOut"},filter:"url(#innerGlow)"}),e==="markers"&&n.slice(0,l).map(h=>M.jsxs($r.g,{style:{willChange:"transform, opacity",transform:"translateZ(0)"},children:[M.jsx($r.circle,{cx:h.x,cy:h.y,r:h.size,fill:"hsl(0, 80%, 60%)",initial:{scale:0,opacity:0,y:h.y+8},animate:{scale:1,opacity:.9,y:h.y},transition:{delay:h.delay*.02,duration:.25,type:"spring",stiffness:800,damping:30},style:{willChange:"transform, opacity",transform:"translateZ(0)"},filter:"url(#markerGlow)"}),M.jsx($r.circle,{cx:h.x,cy:h.y,r:"0",fill:"none",stroke:"hsl(0, 75%, 65%)",strokeWidth:"1",opacity:"0.6",initial:{r:0,opacity:0},animate:{r:[0,h.size*4,0],opacity:[0,.8,0]},transition:{delay:h.delay*.02+.15,duration:1,ease:"easeOut"},style:{willChange:"transform, opacity",transform:"translateZ(0)"}})]},h.id)),M.jsxs("defs",{children:[M.jsxs("linearGradient",{id:"swedenBorderGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[M.jsx("stop",{offset:"0%",stopColor:"hsl(210, 100%, 50%)"}),M.jsx("stop",{offset:"50%",stopColor:"hsl(220, 90%, 55%)"}),M.jsx("stop",{offset:"100%",stopColor:"hsl(230, 80%, 60%)"})]}),M.jsxs("linearGradient",{id:"swedenFillGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[M.jsx("stop",{offset:"0%",stopColor:"hsl(210, 50%, 75%)"}),M.jsx("stop",{offset:"50%",stopColor:"hsl(220, 40%, 80%)"}),M.jsx("stop",{offset:"100%",stopColor:"hsl(230, 30%, 85%)"})]}),M.jsxs("filter",{id:"borderGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[M.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),M.jsxs("feMerge",{children:[M.jsx("feMergeNode",{in:"coloredBlur"}),M.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),M.jsxs("filter",{id:"markerGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[M.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),M.jsxs("feMerge",{children:[M.jsx("feMergeNode",{in:"coloredBlur"}),M.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),M.jsxs("filter",{id:"innerGlow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[M.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),M.jsxs("feMerge",{children:[M.jsx("feMergeNode",{in:"coloredBlur"}),M.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]})]}),e==="markers"&&M.jsx($r.div,{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2 bg-white/95 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg border border-red-100",initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.3,type:"spring",stiffness:400},children:M.jsxs($r.span,{className:"text-sm font-bold text-red-600",initial:{opacity:.8,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.15},children:[r.toLocaleString("sv-SE")," förskolor"]},r)})]})},pwe=({step:e,isActive:t,isCompleted:r,index:n})=>{const l=e.icon;return M.jsxs($r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.08,duration:.5,type:"spring",stiffness:400},className:"text-center relative",children:[M.jsxs($r.div,{className:"w-12 h-12 rounded-xl flex items-center justify-center mb-2 mx-auto relative overflow-hidden",style:{backgroundColor:r?e.color:t?`${e.color}15`:"hsl(0, 0%, 96%)",border:t?`2px solid ${e.color}`:"2px solid transparent"},animate:{boxShadow:t?[`0 4px 20px ${e.color}25`,`0 8px 30px ${e.color}35`,`0 4px 20px ${e.color}25`]:"0 2px 8px rgba(0,0,0,0.05)",scale:t?[1,1.05,1]:1},transition:{boxShadow:{duration:2,repeat:1/0},scale:{duration:.6}},children:[M.jsx($r.div,{animate:{rotate:t?[0,5,-5,0]:0,scale:r?1.1:1},transition:{rotate:{duration:1,repeat:t?1/0:0},scale:{duration:.3}},children:M.jsx(l,{className:"w-5 h-5",style:{color:r?"white":t?e.color:"hsl(0, 0%, 60%)"}})}),r&&!t&&M.jsx($r.div,{className:"absolute top-0 right-0 w-3 h-3 bg-green-500 rounded-full flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:600},children:M.jsx("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:M.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),M.jsx($r.p,{className:"text-xs font-medium mb-1",animate:{color:r||t?"hsl(0, 0%, 20%)":"hsl(0, 0%, 60%)"},children:e.label}),M.jsx($r.p,{className:"text-xs opacity-70",animate:{opacity:t?1:.5},children:e.detail})]})},mwe=({onComplete:e})=>{const[t,r]=K.useState("hidden"),[n,l]=K.useState(0),[h,f]=K.useState(0),[o,v]=K.useState(0),[b,E]=K.useState(0),[P,O]=K.useState(!1),{preschools:L}=Lo(),B=L.length>0?L.length:8739,z=[{label:"Hämtar förskolor",detail:`${B.toLocaleString("sv-SE")} enheter`,icon:sm,color:"hsl(0, 80%, 60%)"},{label:"Öppnar data",detail:"Betyg & information",icon:Sj,color:"hsl(210, 90%, 55%)"},{label:"Skapar karta",detail:"Interaktiv visning",icon:Ha,color:"hsl(85, 60%, 50%)"}];return K.useEffect(()=>{console.log("🚀 Starting loading animation - background data fetching is now active");const U=[{time:0,action:()=>O(!0)},{time:200,action:()=>{r("drawing"),f(0)}},{time:900,action:()=>{r("filling"),f(1)}},{time:1300,action:()=>{r("markers"),f(2)}},{time:2100,action:()=>r("complete")},{time:2200,action:()=>O(!1)},{time:2500,action:()=>{console.log("✅ Loading animation complete - map should display with preloaded data"),e()}}].map(({time:G,action:Z})=>setTimeout(Z,G));return()=>U.forEach(clearTimeout)},[e]),K.useEffect(()=>{if(!P)return;const $=Date.now(),U=2e3;let G;const Z=()=>{const ne=Date.now()-$,Y=Math.min(ne/U,1);let ee;Y<.8?ee=1-Math.pow(1-Y/.8,2.5):ee=.95+(Y-.8)/.2*.05;const le=Math.floor(B*ee);E(le),Y<1?G=requestAnimationFrame(Z):E(B)};return G=requestAnimationFrame(Z),()=>cancelAnimationFrame(G)},[P,B]),K.useEffect(()=>{let $,U=Date.now();const G=()=>{const Z=Date.now()-U;let ne=0,Y=0;switch(t){case"drawing":ne=Math.min(Z/700*100,100);break;case"filling":ne=100;break;case"markers":const ee=Z-0,le=Math.min(ee/800,1);let fe;le<.7?fe=1-Math.pow(1-le/.7,3):fe=.99+(le-.7)/.3*.01,ne=fe*100,Y=Math.floor(B*fe),v(Y);break;default:ne=0}l(ne),(t==="drawing"||t==="markers")&&($=requestAnimationFrame(G))};return(t==="drawing"||t==="markers")&&(U=Date.now(),$=requestAnimationFrame(G)),()=>{$&&cancelAnimationFrame($)}},[t,B]),M.jsx(Pc,{children:P&&M.jsx($r.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95,filter:"blur(8px)"},transition:{duration:.4,ease:[.25,.46,.45,.94]},className:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50/50 to-indigo-50/30",style:{willChange:"transform, opacity",transform:"translateZ(0)",backfaceVisibility:"hidden",perspective:"1000px"},children:M.jsxs("div",{className:"text-center max-w-sm mx-auto px-6",children:[M.jsx(fwe,{phase:t,progress:n,markerCount:o}),M.jsxs($r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.6},className:"mb-6 mt-6 text-center",children:[M.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent mb-3",children:"Sveriges Förskolor"}),M.jsxs($r.div,{className:"mb-3",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.5},children:[M.jsx($r.div,{className:"text-4xl font-bold font-mono text-blue-700 mb-1",initial:{opacity:.9,scale:.98},animate:{opacity:1,scale:1},transition:{duration:.1},style:{willChange:"transform, opacity",transform:"translateZ(0)"},children:b.toLocaleString("sv-SE")},b),M.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"förskolor laddade"})]}),M.jsx("p",{className:"text-xs text-gray-500",children:"Interaktiv karta över hela Sverige"})]}),M.jsx("div",{className:"grid grid-cols-3 gap-6 mb-6",children:z.map(($,U)=>M.jsx(pwe,{step:$,isActive:h===U,isCompleted:h>U,index:U},U))}),M.jsx("div",{className:"w-64 h-1.5 bg-gray-200 rounded-full mx-auto overflow-hidden",children:M.jsx($r.div,{className:"h-full bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 rounded-full",initial:{width:0},animate:{width:`${Math.min((h+1)/z.length*100,100)}%`},transition:{duration:.6,ease:"easeOut"}})})]})})})},gwe=({isMapVisible:e,children:t,onTransitionComplete:r})=>(K.useEffect(()=>{if(e){const n=setTimeout(()=>{r?.()},1e3);return()=>clearTimeout(n)}},[e,r]),M.jsxs($r.div,{initial:{opacity:0,scale:.95},animate:{opacity:e?1:0,scale:e?1:.95},transition:{duration:1,ease:[.25,.46,.45,.94]},className:"relative w-full h-full",children:[t,M.jsx($r.div,{initial:{opacity:1},animate:{opacity:e?0:1},transition:{duration:.8,delay:.2},className:"absolute inset-0 bg-gradient-to-br from-background/80 via-background/60 to-background/40 pointer-events-none",style:{backdropFilter:"blur(2px)",background:"linear-gradient(135deg, hsl(var(--background)/0.8) 0%, hsl(var(--background)/0.6) 50%, hsl(var(--background)/0.4) 100%)"}})]})),ywe=({children:e,onClick:t,className:r,variant:n="default",size:l="default",disabled:h=!1})=>M.jsx($r.div,{whileHover:{scale:1.02},whileTap:{scale:.98},transition:{type:"spring",stiffness:400,damping:17},children:M.jsx(fn,{onClick:t,variant:n,size:l,disabled:h,className:ln("transition-all duration-200 hover:shadow-glow",r),children:e})}),fP=z9((e,t)=>({selectedPreschools:[],isOpen:!1,addToComparison:r=>{const n=t().selectedPreschools;n.length>=5||n.find(l=>l.id===r.id)||e({selectedPreschools:[...n,r]})},removeFromComparison:r=>{const n=t().selectedPreschools;e({selectedPreschools:n.filter(l=>l.id!==r)})},clearComparison:()=>{e({selectedPreschools:[]})},isInComparison:r=>t().selectedPreschools.some(n=>n.id===r),setIsOpen:r=>{e({isOpen:r})}})),_we=()=>{const{selectedPreschools:e,removeFromComparison:t,clearComparison:r,setIsOpen:n}=fP(),[l,h]=K.useState(!1);if(e.length===0)return null;const f=E=>{const P=e.map(O=>O[E]).filter(O=>O!=null);return P.length>0?P.reduce((O,L)=>O+L,0)/P.length:0},o=f("antal_barn"),v=f("personaltäthet"),b=f("andel_med_förskollärarexamen");return M.jsx(Pc,{children:M.jsx($r.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"fixed bottom-4 right-4 z-50",children:M.jsxs(Cn,{className:"bg-card/95 backdrop-blur-lg shadow-nordic border-border/50 p-4 max-w-sm",children:[M.jsxs("div",{className:"flex items-center justify-between mb-3",children:[M.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2",children:[M.jsx(Sh,{className:"w-4 h-4"}),"Jämförelse"]}),M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx(fn,{variant:"ghost",size:"sm",onClick:()=>h(!l),className:"h-6 w-6 p-0",children:M.jsx(Om,{className:"h-3 w-3"})}),M.jsx(fn,{variant:"ghost",size:"sm",onClick:r,className:"h-6 w-6 p-0",children:M.jsx($l,{className:"h-3 w-3"})})]})]}),l&&e.length>=2&&M.jsxs($r.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-3 p-2 bg-muted/30 rounded-md space-y-1",children:[M.jsxs("div",{className:"flex items-center justify-between text-xs",children:[M.jsxs("span",{className:"flex items-center gap-1",children:[M.jsx(km,{className:"w-3 h-3"}),"Snitt barn:"]}),M.jsx("span",{className:"font-medium",children:o.toFixed(0)})]}),M.jsxs("div",{className:"flex items-center justify-between text-xs",children:[M.jsxs("span",{className:"flex items-center gap-1",children:[M.jsx(ba,{className:"w-3 h-3"}),"Personal:"]}),M.jsx("span",{className:"font-medium",children:v.toFixed(1)})]}),M.jsxs("div",{className:"flex items-center justify-between text-xs",children:[M.jsxs("span",{className:"flex items-center gap-1",children:[M.jsx(xj,{className:"w-3 h-3"}),"Examen:"]}),M.jsxs("span",{className:"font-medium",children:[b.toFixed(0),"%"]})]})]}),M.jsx("div",{className:"space-y-2 mb-4",children:e.map(E=>M.jsxs("div",{className:"flex items-center justify-between bg-muted/50 rounded-md p-2",children:[M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("p",{className:"text-xs font-medium truncate",children:E.namn}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("p",{className:"text-xs text-muted-foreground truncate",children:E.kommun}),E.google_rating&&M.jsxs(An,{variant:"outline",className:"text-xs h-4 px-1",children:["★ ",E.google_rating.toFixed(1)]})]})]}),M.jsx(fn,{variant:"ghost",size:"sm",onClick:()=>t(E.id),className:"h-5 w-5 p-0 ml-2",children:M.jsx($l,{className:"h-3 w-3"})})]},E.id))}),M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs(An,{variant:"secondary",className:"text-xs",children:[e.length,"/5"]}),e.length>=2&&M.jsxs(fn,{onClick:()=>n(!0),size:"sm",className:"text-xs",children:["Jämför ",e.length," förskolor"]})]})]})})})};var pP="Dialog",[zY,tHe]=Ec(pP),[vwe,Cc]=zY(pP),FY=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:l,onOpenChange:h,modal:f=!0}=e,o=K.useRef(null),v=K.useRef(null),[b,E]=gm({prop:n,defaultProp:l??!1,onChange:h,caller:pP});return M.jsx(vwe,{scope:t,triggerRef:o,contentRef:v,contentId:df(),titleId:df(),descriptionId:df(),open:b,onOpenChange:E,onOpenToggle:K.useCallback(()=>E(P=>!P),[E]),modal:f,children:r})};FY.displayName=pP;var BY="DialogTrigger",$Y=K.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Cc(BY,r),h=mi(t,l.triggerRef);return M.jsx(pn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":NN(l.open),...n,ref:h,onClick:Xr(e.onClick,l.onOpenToggle)})});$Y.displayName=BY;var LN="DialogPortal",[xwe,VY]=zY(LN,{forceMount:void 0}),UY=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:l}=e,h=Cc(LN,t);return M.jsx(xwe,{scope:t,forceMount:r,children:K.Children.map(n,f=>M.jsx(Ac,{present:r||h.open,children:M.jsx(OA,{asChild:!0,container:l,children:f})}))})};UY.displayName=LN;var g2="DialogOverlay",GY=K.forwardRef((e,t)=>{const r=VY(g2,e.__scopeDialog),{forceMount:n=r.forceMount,...l}=e,h=Cc(g2,e.__scopeDialog);return h.modal?M.jsx(Ac,{present:n||h.open,children:M.jsx(wwe,{...l,ref:t})}):null});GY.displayName=g2;var bwe=v_("DialogOverlay.RemoveScroll"),wwe=K.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Cc(g2,r);return M.jsx(RN,{as:bwe,allowPinchZoom:!0,shards:[l.contentRef],children:M.jsx(pn.div,{"data-state":NN(l.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),bm="DialogContent",HY=K.forwardRef((e,t)=>{const r=VY(bm,e.__scopeDialog),{forceMount:n=r.forceMount,...l}=e,h=Cc(bm,e.__scopeDialog);return M.jsx(Ac,{present:n||h.open,children:h.modal?M.jsx(Swe,{...l,ref:t}):M.jsx(Twe,{...l,ref:t})})});HY.displayName=bm;var Swe=K.forwardRef((e,t)=>{const r=Cc(bm,e.__scopeDialog),n=K.useRef(null),l=mi(t,r.contentRef,n);return K.useEffect(()=>{const h=n.current;if(h)return UK(h)},[]),M.jsx(WY,{...e,ref:l,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Xr(e.onCloseAutoFocus,h=>{h.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:Xr(e.onPointerDownOutside,h=>{const f=h.detail.originalEvent,o=f.button===0&&f.ctrlKey===!0;(f.button===2||o)&&h.preventDefault()}),onFocusOutside:Xr(e.onFocusOutside,h=>h.preventDefault())})}),Twe=K.forwardRef((e,t)=>{const r=Cc(bm,e.__scopeDialog),n=K.useRef(!1),l=K.useRef(!1);return M.jsx(WY,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:h=>{e.onCloseAutoFocus?.(h),h.defaultPrevented||(n.current||r.triggerRef.current?.focus(),h.preventDefault()),n.current=!1,l.current=!1},onInteractOutside:h=>{e.onInteractOutside?.(h),h.defaultPrevented||(n.current=!0,h.detail.originalEvent.type==="pointerdown"&&(l.current=!0));const f=h.target;r.triggerRef.current?.contains(f)&&h.preventDefault(),h.detail.originalEvent.type==="focusin"&&l.current&&h.preventDefault()}})}),WY=K.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:l,onCloseAutoFocus:h,...f}=e,o=Cc(bm,r),v=K.useRef(null),b=mi(t,v);return BK(),M.jsxs(M.Fragment,{children:[M.jsx(kN,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:l,onUnmountAutoFocus:h,children:M.jsx(Uw,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":NN(o.open),...f,ref:b,onDismiss:()=>o.onOpenChange(!1)})}),M.jsxs(M.Fragment,{children:[M.jsx(Ewe,{titleId:o.titleId}),M.jsx(Pwe,{contentRef:v,descriptionId:o.descriptionId})]})]})}),jN="DialogTitle",qY=K.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Cc(jN,r);return M.jsx(pn.h2,{id:l.titleId,...n,ref:t})});qY.displayName=jN;var ZY="DialogDescription",XY=K.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Cc(ZY,r);return M.jsx(pn.p,{id:l.descriptionId,...n,ref:t})});XY.displayName=ZY;var KY="DialogClose",YY=K.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Cc(KY,r);return M.jsx(pn.button,{type:"button",...n,ref:t,onClick:Xr(e.onClick,()=>l.onOpenChange(!1))})});YY.displayName=KY;function NN(e){return e?"open":"closed"}var JY="DialogTitleWarning",[rHe,QY]=ale(JY,{contentName:bm,titleName:jN,docsSlug:"dialog"}),Ewe=({titleId:e})=>{const t=QY(JY),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return K.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},Awe="DialogDescriptionWarning",Pwe=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${QY(Awe).contentName}}.`;return K.useEffect(()=>{const l=e.current?.getAttribute("aria-describedby");t&&l&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},eJ=FY,Cwe=$Y,tJ=UY,mP=GY,gP=HY,yP=qY,_P=XY,rJ=YY;const Iwe=eJ,Mwe=tJ,nJ=K.forwardRef(({className:e,...t},r)=>M.jsx(mP,{ref:r,className:ln("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));nJ.displayName=mP.displayName;const iJ=K.forwardRef(({className:e,children:t,...r},n)=>M.jsxs(Mwe,{children:[M.jsx(nJ,{}),M.jsxs(gP,{ref:n,className:ln("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,M.jsxs(rJ,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[M.jsx($l,{className:"h-4 w-4"}),M.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));iJ.displayName=gP.displayName;const oJ=({className:e,...t})=>M.jsx("div",{className:ln("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});oJ.displayName="DialogHeader";const sJ=K.forwardRef(({className:e,...t},r)=>M.jsx(yP,{ref:r,className:ln("text-lg font-semibold leading-none tracking-tight",e),...t}));sJ.displayName=yP.displayName;const Owe=K.forwardRef(({className:e,...t},r)=>M.jsx(_P,{ref:r,className:ln("text-sm text-muted-foreground",e),...t}));Owe.displayName=_P.displayName;const kwe=()=>{const{selectedPreschools:e,isOpen:t,setIsOpen:r,clearComparison:n}=fP(),l=(v,b,E=!0)=>{const P=Math.min(...b.filter(z=>z>0)),O=Math.max(...b.filter(z=>z>0));if(P===O)return"bg-muted";const L=(v-P)/(O-P),B=E?L:1-L;return B>=.7?"bg-green-500":B>=.4?"bg-yellow-500":"bg-red-500"};if(!t||e.length<2)return null;const h=e.map(v=>v.google_rating||0),f=e.map(v=>v.personaltäthet||0),o=e.map(v=>v.andel_med_förskollärarexamen||0);return e.map(v=>v.antal_barn||0),M.jsx(Iwe,{open:t,onOpenChange:r,children:M.jsxs(iJ,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[M.jsx(oJ,{children:M.jsxs(sJ,{className:"flex items-center gap-2",children:[M.jsx(Sh,{className:"w-5 h-5"}),"Jämför ",e.length," förskolor"]})}),M.jsxs("div",{className:"space-y-6",children:[M.jsx("div",{className:"overflow-x-auto",children:M.jsxs("table",{className:"w-full border-collapse",children:[M.jsx("thead",{children:M.jsxs("tr",{className:"border-b",children:[M.jsx("th",{className:"text-left p-3 font-semibold",children:"Förskola"}),M.jsx("th",{className:"text-left p-3 font-semibold",children:"Huvudman"}),M.jsx("th",{className:"text-left p-3 font-semibold",children:"Kommun"}),M.jsx("th",{className:"text-left p-3 font-semibold",children:"Barn"})]})}),M.jsx("tbody",{children:e.map(v=>M.jsxs("tr",{className:"border-b",children:[M.jsx("td",{className:"p-3 font-medium",children:v.namn}),M.jsx("td",{className:"p-3",children:M.jsx(An,{variant:"secondary",children:v.huvudman})}),M.jsx("td",{className:"p-3 text-muted-foreground",children:v.kommun}),M.jsx("td",{className:"p-3",children:v.antal_barn||"N/A"})]},v.id))})]})}),M.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[M.jsxs(Cn,{className:"p-4",children:[M.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[M.jsx(ba,{className:"w-4 h-4 text-yellow-500"}),"Google betyg"]}),M.jsx("div",{className:"space-y-3",children:e.map(v=>M.jsxs("div",{className:"space-y-1",children:[M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("span",{className:"text-sm font-medium truncate pr-2",children:v.namn}),M.jsx("span",{className:"text-sm font-bold",children:v.google_rating?.toFixed(1)||"N/A"})]}),v.google_rating&&M.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:M.jsx("div",{className:`h-2 rounded-full ${l(v.google_rating,h)}`,style:{width:`${v.google_rating/5*100}%`}})})]},v.id))})]}),M.jsxs(Cn,{className:"p-4",children:[M.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[M.jsx(km,{className:"w-4 h-4 text-blue-500"}),"Personaltäthet"]}),M.jsx("div",{className:"space-y-3",children:e.map(v=>M.jsxs("div",{className:"space-y-1",children:[M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("span",{className:"text-sm font-medium truncate pr-2",children:v.namn}),M.jsx("span",{className:"text-sm font-bold",children:v.personaltäthet?.toFixed(1)||"N/A"})]}),v.personaltäthet&&M.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:M.jsx("div",{className:`h-2 rounded-full ${l(v.personaltäthet,f)}`,style:{width:`${Math.min(v.personaltäthet/Math.max(...f)*100,100)}%`}})})]},v.id))})]}),M.jsxs(Cn,{className:"p-4",children:[M.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[M.jsx(T7,{className:"w-4 h-4 text-green-500"}),"Lärarexamen %"]}),M.jsx("div",{className:"space-y-3",children:e.map(v=>M.jsxs("div",{className:"space-y-1",children:[M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("span",{className:"text-sm font-medium truncate pr-2",children:v.namn}),M.jsxs("span",{className:"text-sm font-bold",children:[v.andel_med_förskollärarexamen?.toFixed(0),"% || 'N/A'"]})]}),v.andel_med_förskollärarexamen&&M.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:M.jsx("div",{className:`h-2 rounded-full ${l(v.andel_med_förskollärarexamen,o)}`,style:{width:`${v.andel_med_förskollärarexamen}%`}})})]},v.id))})]})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx(fn,{onClick:n,variant:"outline",children:"Rensa jämförelse"}),M.jsx(fn,{onClick:()=>r(!1),variant:"default",children:"Stäng"})]})]})]})})},Rwe=eJ,Dwe=Cwe,Lwe=tJ,aJ=K.forwardRef(({className:e,...t},r)=>M.jsx(mP,{className:ln("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));aJ.displayName=mP.displayName;const jwe=ev("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),lJ=K.forwardRef(({side:e="right",className:t,children:r,...n},l)=>M.jsxs(Lwe,{children:[M.jsx(aJ,{}),M.jsxs(gP,{ref:l,className:ln(jwe({side:e}),t),...n,children:[r,M.jsxs(rJ,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[M.jsx($l,{className:"h-4 w-4"}),M.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));lJ.displayName=gP.displayName;const Nwe=K.forwardRef(({className:e,...t},r)=>M.jsx(yP,{ref:r,className:ln("text-lg font-semibold text-foreground",e),...t}));Nwe.displayName=yP.displayName;const zwe=K.forwardRef(({className:e,...t},r)=>M.jsx(_P,{ref:r,className:ln("text-sm text-muted-foreground",e),...t}));zwe.displayName=_P.displayName;const Fwe=()=>{const{filteredPreschools:e}=Lo(),{selectedPreschools:t,setIsOpen:r}=fP(),n=[{icon:Wk,label:"Sök",action:()=>{const l=document.querySelector("[data-search-trigger]");l&&l.click()}},{icon:gce,label:"Karta",action:()=>{window.scrollTo({top:0,behavior:"smooth"})}},{icon:Sh,label:"Statistik",action:()=>{const l=document.querySelector('[data-testid="statistics-button"]');l&&l.click()},badge:e.length},{icon:E7,label:"Jämför",action:()=>{t.length>0&&r(!0)},badge:t.length}];return M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-card border-t border-border md:hidden",children:M.jsx("div",{className:"grid grid-cols-4 gap-1 p-2",children:n.map(l=>M.jsxs(fn,{variant:"ghost",size:"sm",onClick:l.action,className:"flex flex-col items-center gap-1 h-auto p-2 relative",children:[M.jsx(l.icon,{className:"h-5 w-5"}),M.jsx("span",{className:"text-xs",children:l.label}),l.badge!==void 0&&l.badge>0&&M.jsx(An,{variant:"secondary",className:"absolute -top-1 -right-1 h-5 w-5 p-0 text-xs flex items-center justify-center",children:l.badge>99?"99+":l.badge})]},l.label))})}),M.jsx("div",{className:"fixed top-0 left-0 right-0 z-40 bg-card/95 backdrop-blur border-b border-border md:hidden",children:M.jsxs("div",{className:"flex items-center justify-between p-4",children:[M.jsx("h1",{className:"text-lg font-bold",children:"Sveriges Förskolor"}),M.jsxs(Rwe,{children:[M.jsx(Dwe,{asChild:!0,children:M.jsx(fn,{variant:"ghost",size:"sm",children:M.jsx(yce,{className:"h-5 w-5"})})}),M.jsx(lJ,{side:"right",className:"w-80",children:M.jsxs("div",{className:"space-y-4 mt-8",children:[M.jsxs("div",{className:"space-y-2",children:[M.jsx("h3",{className:"font-semibold",children:"Navigation"}),n.map(l=>M.jsxs(fn,{variant:"ghost",onClick:l.action,className:"w-full justify-start",children:[M.jsx(l.icon,{className:"h-4 w-4 mr-2"}),l.label,l.badge!==void 0&&l.badge>0&&M.jsx(An,{variant:"secondary",className:"ml-auto",children:l.badge})]},l.label))]}),M.jsxs("div",{className:"space-y-2",children:[M.jsx("h3",{className:"font-semibold",children:"Information"}),M.jsxs(fn,{variant:"ghost",className:"w-full justify-start",children:[M.jsx(mce,{className:"h-4 w-4 mr-2"}),"Om tjänsten"]}),M.jsxs(fn,{variant:"ghost",className:"w-full justify-start",children:[M.jsx(Ej,{className:"h-4 w-4 mr-2"}),"Inställningar"]})]})]})})]})]})})]})};var Bwe=Array.isArray,qa=Bwe,$we=typeof Ls=="object"&&Ls&&Ls.Object===Object&&Ls,cJ=$we,Vwe=cJ,Uwe=typeof self=="object"&&self&&self.Object===Object&&self,Gwe=Vwe||Uwe||Function("return this")(),Iu=Gwe,Hwe=Iu,Wwe=Hwe.Symbol,e1=Wwe,PU=e1,uJ=Object.prototype,qwe=uJ.hasOwnProperty,Zwe=uJ.toString,jx=PU?PU.toStringTag:void 0;function Xwe(e){var t=qwe.call(e,jx),r=e[jx];try{e[jx]=void 0;var n=!0}catch{}var l=Zwe.call(e);return n&&(t?e[jx]=r:delete e[jx]),l}var Kwe=Xwe,Ywe=Object.prototype,Jwe=Ywe.toString;function Qwe(e){return Jwe.call(e)}var e1e=Qwe,CU=e1,t1e=Kwe,r1e=e1e,n1e="[object Null]",i1e="[object Undefined]",IU=CU?CU.toStringTag:void 0;function o1e(e){return e==null?e===void 0?i1e:n1e:IU&&IU in Object(e)?t1e(e):r1e(e)}var Lh=o1e;function s1e(e){return e!=null&&typeof e=="object"}var jh=s1e,a1e=Lh,l1e=jh,c1e="[object Symbol]";function u1e(e){return typeof e=="symbol"||l1e(e)&&a1e(e)==c1e}var hv=u1e,h1e=qa,d1e=hv,f1e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p1e=/^\w*$/;function m1e(e,t){if(h1e(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||d1e(e)?!0:p1e.test(e)||!f1e.test(e)||t!=null&&e in Object(t)}var zN=m1e;function g1e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Pf=g1e;const dv=Pi(Pf);var y1e=Lh,_1e=Pf,v1e="[object AsyncFunction]",x1e="[object Function]",b1e="[object GeneratorFunction]",w1e="[object Proxy]";function S1e(e){if(!_1e(e))return!1;var t=y1e(e);return t==x1e||t==b1e||t==v1e||t==w1e}var FN=S1e;const In=Pi(FN);var T1e=Iu,E1e=T1e["__core-js_shared__"],A1e=E1e,yO=A1e,MU=function(){var e=/[^.]+$/.exec(yO&&yO.keys&&yO.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function P1e(e){return!!MU&&MU in e}var C1e=P1e,I1e=Function.prototype,M1e=I1e.toString;function O1e(e){if(e!=null){try{return M1e.call(e)}catch{}try{return e+""}catch{}}return""}var hJ=O1e,k1e=FN,R1e=C1e,D1e=Pf,L1e=hJ,j1e=/[\\^$.*+?()[\]{}|]/g,N1e=/^\[object .+?Constructor\]$/,z1e=Function.prototype,F1e=Object.prototype,B1e=z1e.toString,$1e=F1e.hasOwnProperty,V1e=RegExp("^"+B1e.call($1e).replace(j1e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function U1e(e){if(!D1e(e)||R1e(e))return!1;var t=k1e(e)?V1e:N1e;return t.test(L1e(e))}var G1e=U1e;function H1e(e,t){return e?.[t]}var W1e=H1e,q1e=G1e,Z1e=W1e;function X1e(e,t){var r=Z1e(e,t);return q1e(r)?r:void 0}var Dm=X1e,K1e=Dm,Y1e=K1e(Object,"create"),vP=Y1e,OU=vP;function J1e(){this.__data__=OU?OU(null):{},this.size=0}var Q1e=J1e;function eSe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var tSe=eSe,rSe=vP,nSe="__lodash_hash_undefined__",iSe=Object.prototype,oSe=iSe.hasOwnProperty;function sSe(e){var t=this.__data__;if(rSe){var r=t[e];return r===nSe?void 0:r}return oSe.call(t,e)?t[e]:void 0}var aSe=sSe,lSe=vP,cSe=Object.prototype,uSe=cSe.hasOwnProperty;function hSe(e){var t=this.__data__;return lSe?t[e]!==void 0:uSe.call(t,e)}var dSe=hSe,fSe=vP,pSe="__lodash_hash_undefined__";function mSe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=fSe&&t===void 0?pSe:t,this}var gSe=mSe,ySe=Q1e,_Se=tSe,vSe=aSe,xSe=dSe,bSe=gSe;function fv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}fv.prototype.clear=ySe;fv.prototype.delete=_Se;fv.prototype.get=vSe;fv.prototype.has=xSe;fv.prototype.set=bSe;var wSe=fv;function SSe(){this.__data__=[],this.size=0}var TSe=SSe;function ESe(e,t){return e===t||e!==e&&t!==t}var BN=ESe,ASe=BN;function PSe(e,t){for(var r=e.length;r--;)if(ASe(e[r][0],t))return r;return-1}var xP=PSe,CSe=xP,ISe=Array.prototype,MSe=ISe.splice;function OSe(e){var t=this.__data__,r=CSe(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():MSe.call(t,r,1),--this.size,!0}var kSe=OSe,RSe=xP;function DSe(e){var t=this.__data__,r=RSe(t,e);return r<0?void 0:t[r][1]}var LSe=DSe,jSe=xP;function NSe(e){return jSe(this.__data__,e)>-1}var zSe=NSe,FSe=xP;function BSe(e,t){var r=this.__data__,n=FSe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var $Se=BSe,VSe=TSe,USe=kSe,GSe=LSe,HSe=zSe,WSe=$Se;function pv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}pv.prototype.clear=VSe;pv.prototype.delete=USe;pv.prototype.get=GSe;pv.prototype.has=HSe;pv.prototype.set=WSe;var bP=pv,qSe=Dm,ZSe=Iu,XSe=qSe(ZSe,"Map"),$N=XSe,kU=wSe,KSe=bP,YSe=$N;function JSe(){this.size=0,this.__data__={hash:new kU,map:new(YSe||KSe),string:new kU}}var QSe=JSe;function eTe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var tTe=eTe,rTe=tTe;function nTe(e,t){var r=e.__data__;return rTe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var wP=nTe,iTe=wP;function oTe(e){var t=iTe(this,e).delete(e);return this.size-=t?1:0,t}var sTe=oTe,aTe=wP;function lTe(e){return aTe(this,e).get(e)}var cTe=lTe,uTe=wP;function hTe(e){return uTe(this,e).has(e)}var dTe=hTe,fTe=wP;function pTe(e,t){var r=fTe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var mTe=pTe,gTe=QSe,yTe=sTe,_Te=cTe,vTe=dTe,xTe=mTe;function mv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}mv.prototype.clear=gTe;mv.prototype.delete=yTe;mv.prototype.get=_Te;mv.prototype.has=vTe;mv.prototype.set=xTe;var VN=mv,dJ=VN,bTe="Expected a function";function UN(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(bTe);var r=function(){var n=arguments,l=t?t.apply(this,n):n[0],h=r.cache;if(h.has(l))return h.get(l);var f=e.apply(this,n);return r.cache=h.set(l,f)||h,f};return r.cache=new(UN.Cache||dJ),r}UN.Cache=dJ;var fJ=UN;const wTe=Pi(fJ);var STe=fJ,TTe=500;function ETe(e){var t=STe(e,function(n){return r.size===TTe&&r.clear(),n}),r=t.cache;return t}var ATe=ETe,PTe=ATe,CTe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ITe=/\\(\\)?/g,MTe=PTe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(CTe,function(r,n,l,h){t.push(l?h.replace(ITe,"$1"):n||r)}),t}),OTe=MTe;function kTe(e,t){for(var r=-1,n=e==null?0:e.length,l=Array(n);++r<n;)l[r]=t(e[r],r,e);return l}var GN=kTe,RU=e1,RTe=GN,DTe=qa,LTe=hv,DU=RU?RU.prototype:void 0,LU=DU?DU.toString:void 0;function pJ(e){if(typeof e=="string")return e;if(DTe(e))return RTe(e,pJ)+"";if(LTe(e))return LU?LU.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var jTe=pJ,NTe=jTe;function zTe(e){return e==null?"":NTe(e)}var mJ=zTe,FTe=qa,BTe=zN,$Te=OTe,VTe=mJ;function UTe(e,t){return FTe(e)?e:BTe(e,t)?[e]:$Te(VTe(e))}var gJ=UTe,GTe=hv;function HTe(e){if(typeof e=="string"||GTe(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var SP=HTe,WTe=gJ,qTe=SP;function ZTe(e,t){t=WTe(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[qTe(t[r++])];return r&&r==n?e:void 0}var HN=ZTe,XTe=HN;function KTe(e,t,r){var n=e==null?void 0:XTe(e,t);return n===void 0?r:n}var yJ=KTe;const dl=Pi(yJ);function YTe(e){return e==null}var JTe=YTe;const ni=Pi(JTe);var QTe=Lh,eEe=qa,tEe=jh,rEe="[object String]";function nEe(e){return typeof e=="string"||!eEe(e)&&tEe(e)&&QTe(e)==rEe}var iEe=nEe;const wm=Pi(iEe);var _J={exports:{}},Ni={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WN=Symbol.for("react.element"),qN=Symbol.for("react.portal"),TP=Symbol.for("react.fragment"),EP=Symbol.for("react.strict_mode"),AP=Symbol.for("react.profiler"),PP=Symbol.for("react.provider"),CP=Symbol.for("react.context"),oEe=Symbol.for("react.server_context"),IP=Symbol.for("react.forward_ref"),MP=Symbol.for("react.suspense"),OP=Symbol.for("react.suspense_list"),kP=Symbol.for("react.memo"),RP=Symbol.for("react.lazy"),sEe=Symbol.for("react.offscreen"),vJ;vJ=Symbol.for("react.module.reference");function Gl(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case WN:switch(e=e.type,e){case TP:case AP:case EP:case MP:case OP:return e;default:switch(e=e&&e.$$typeof,e){case oEe:case CP:case IP:case RP:case kP:case PP:return e;default:return t}}case qN:return t}}}Ni.ContextConsumer=CP;Ni.ContextProvider=PP;Ni.Element=WN;Ni.ForwardRef=IP;Ni.Fragment=TP;Ni.Lazy=RP;Ni.Memo=kP;Ni.Portal=qN;Ni.Profiler=AP;Ni.StrictMode=EP;Ni.Suspense=MP;Ni.SuspenseList=OP;Ni.isAsyncMode=function(){return!1};Ni.isConcurrentMode=function(){return!1};Ni.isContextConsumer=function(e){return Gl(e)===CP};Ni.isContextProvider=function(e){return Gl(e)===PP};Ni.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===WN};Ni.isForwardRef=function(e){return Gl(e)===IP};Ni.isFragment=function(e){return Gl(e)===TP};Ni.isLazy=function(e){return Gl(e)===RP};Ni.isMemo=function(e){return Gl(e)===kP};Ni.isPortal=function(e){return Gl(e)===qN};Ni.isProfiler=function(e){return Gl(e)===AP};Ni.isStrictMode=function(e){return Gl(e)===EP};Ni.isSuspense=function(e){return Gl(e)===MP};Ni.isSuspenseList=function(e){return Gl(e)===OP};Ni.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===TP||e===AP||e===EP||e===MP||e===OP||e===sEe||typeof e=="object"&&e!==null&&(e.$$typeof===RP||e.$$typeof===kP||e.$$typeof===PP||e.$$typeof===CP||e.$$typeof===IP||e.$$typeof===vJ||e.getModuleId!==void 0)};Ni.typeOf=Gl;_J.exports=Ni;var aEe=_J.exports,lEe=Lh,cEe=jh,uEe="[object Number]";function hEe(e){return typeof e=="number"||cEe(e)&&lEe(e)==uEe}var xJ=hEe;const dEe=Pi(xJ);var fEe=xJ;function pEe(e){return fEe(e)&&e!=+e}var mEe=pEe;const t1=Pi(mEe);var ya=function(t){return t===0?0:t>0?1:-1},Xp=function(t){return wm(t)&&t.indexOf("%")===t.length-1},pr=function(t){return dEe(t)&&!t1(t)},gEe=function(t){return ni(t)},as=function(t){return pr(t)||wm(t)},yEe=0,r1=function(t){var r=++yEe;return"".concat(t||"").concat(r)},_a=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!pr(t)&&!wm(t))return n;var h;if(Xp(t)){var f=t.indexOf("%");h=r*parseFloat(t.slice(0,f))/100}else h=+t;return t1(h)&&(h=n),l&&h>r&&(h=r),h},qd=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},_Ee=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},l=0;l<r;l++)if(!n[t[l]])n[t[l]]=!0;else return!0;return!1},Vd=function(t,r){return pr(t)&&pr(r)?function(n){return t+n*(r-t)}:function(){return r}};function WR(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):dl(n,t))===r})}var vEe=function(t,r){return pr(t)&&pr(r)?t-r:wm(t)&&wm(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Qy(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function qR(e){"@babel/helpers - typeof";return qR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qR(e)}var xEe=["viewBox","children"],bEe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],jU=["points","pathLength"],_O={svg:xEe,polygon:jU,polyline:jU},ZN=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],y2=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(K.isValidElement(t)&&(n=t.props),!dv(n))return null;var l={};return Object.keys(n).forEach(function(h){ZN.includes(h)&&(l[h]=r||function(f){return n[h](n,f)})}),l},wEe=function(t,r,n){return function(l){return t(r,n,l),null}},Sm=function(t,r,n){if(!dv(t)||qR(t)!=="object")return null;var l=null;return Object.keys(t).forEach(function(h){var f=t[h];ZN.includes(h)&&typeof f=="function"&&(l||(l={}),l[h]=wEe(f,r,n))}),l},SEe=["children"],TEe=["children"];function NU(e,t){if(e==null)return{};var r=EEe(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function EEe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var zU={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},yh=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},FU=null,vO=null,XN=function e(t){if(t===FU&&Array.isArray(vO))return vO;var r=[];return K.Children.forEach(t,function(n){ni(n)||(aEe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),vO=r,FU=t,r};function zl(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(l){return yh(l)}):n=[yh(t)],XN(e).forEach(function(l){var h=dl(l,"type.displayName")||dl(l,"type.name");n.indexOf(h)!==-1&&r.push(l)}),r}function sl(e,t){var r=zl(e,t);return r&&r[0]}var BU=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,l=r.height;return!(!pr(n)||n<=0||!pr(l)||l<=0)},AEe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],PEe=function(t){return t&&t.type&&wm(t.type)&&AEe.indexOf(t.type)>=0},CEe=function(t,r,n,l){var h,f=(h=_O?.[l])!==null&&h!==void 0?h:[];return r.startsWith("data-")||!In(t)&&(l&&f.includes(r)||bEe.includes(r))||n&&ZN.includes(r)},wn=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var l=t;if(K.isValidElement(t)&&(l=t.props),!dv(l))return null;var h={};return Object.keys(l).forEach(function(f){var o;CEe((o=l)===null||o===void 0?void 0:o[f],f,r,n)&&(h[f]=l[f])}),h},ZR=function e(t,r){if(t===r)return!0;var n=K.Children.count(t);if(n!==K.Children.count(r))return!1;if(n===0)return!0;if(n===1)return $U(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var l=0;l<n;l++){var h=t[l],f=r[l];if(Array.isArray(h)||Array.isArray(f)){if(!e(h,f))return!1}else if(!$U(h,f))return!1}return!0},$U=function(t,r){if(ni(t)&&ni(r))return!0;if(!ni(t)&&!ni(r)){var n=t.props||{},l=n.children,h=NU(n,SEe),f=r.props||{},o=f.children,v=NU(f,TEe);return l&&o?Qy(h,v)&&ZR(l,o):!l&&!o?Qy(h,v):!1}return!1},VU=function(t,r){var n=[],l={};return XN(t).forEach(function(h,f){if(PEe(h))n.push(h);else if(h){var o=yh(h.type),v=r[o]||{},b=v.handler,E=v.once;if(b&&(!E||!l[o])){var P=b(h,o,f);n.push(P),l[o]=!0}}}),n},IEe=function(t){var r=t&&t.type;return r&&zU[r]?zU[r]:null},MEe=function(t,r){return XN(r).indexOf(t)},OEe=["children","width","height","viewBox","className","style","title","desc"];function XR(){return XR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},XR.apply(this,arguments)}function kEe(e,t){if(e==null)return{};var r=REe(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function REe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function KR(e){var t=e.children,r=e.width,n=e.height,l=e.viewBox,h=e.className,f=e.style,o=e.title,v=e.desc,b=kEe(e,OEe),E=l||{width:r,height:n,x:0,y:0},P=qn("recharts-surface",h);return ze.createElement("svg",XR({},wn(b,!0,"svg"),{className:P,width:r,height:n,style:f,viewBox:"".concat(E.x," ").concat(E.y," ").concat(E.width," ").concat(E.height)}),ze.createElement("title",null,o),ze.createElement("desc",null,v),t)}var DEe=["children","className"];function YR(){return YR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},YR.apply(this,arguments)}function LEe(e,t){if(e==null)return{};var r=jEe(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function jEe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Li=ze.forwardRef(function(e,t){var r=e.children,n=e.className,l=LEe(e,DEe),h=qn("recharts-layer",n);return ze.createElement("g",YR({className:h},wn(l,!0),{ref:t}),r)}),bc=function(t,r){for(var n=arguments.length,l=new Array(n>2?n-2:0),h=2;h<n;h++)l[h-2]=arguments[h]};function NEe(e,t,r){var n=-1,l=e.length;t<0&&(t=-t>l?0:l+t),r=r>l?l:r,r<0&&(r+=l),l=t>r?0:r-t>>>0,t>>>=0;for(var h=Array(l);++n<l;)h[n]=e[n+t];return h}var zEe=NEe,FEe=zEe;function BEe(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:FEe(e,t,r)}var $Ee=BEe,VEe="\\ud800-\\udfff",UEe="\\u0300-\\u036f",GEe="\\ufe20-\\ufe2f",HEe="\\u20d0-\\u20ff",WEe=UEe+GEe+HEe,qEe="\\ufe0e\\ufe0f",ZEe="\\u200d",XEe=RegExp("["+ZEe+VEe+WEe+qEe+"]");function KEe(e){return XEe.test(e)}var bJ=KEe;function YEe(e){return e.split("")}var JEe=YEe,wJ="\\ud800-\\udfff",QEe="\\u0300-\\u036f",e2e="\\ufe20-\\ufe2f",t2e="\\u20d0-\\u20ff",r2e=QEe+e2e+t2e,n2e="\\ufe0e\\ufe0f",i2e="["+wJ+"]",JR="["+r2e+"]",QR="\\ud83c[\\udffb-\\udfff]",o2e="(?:"+JR+"|"+QR+")",SJ="[^"+wJ+"]",TJ="(?:\\ud83c[\\udde6-\\uddff]){2}",EJ="[\\ud800-\\udbff][\\udc00-\\udfff]",s2e="\\u200d",AJ=o2e+"?",PJ="["+n2e+"]?",a2e="(?:"+s2e+"(?:"+[SJ,TJ,EJ].join("|")+")"+PJ+AJ+")*",l2e=PJ+AJ+a2e,c2e="(?:"+[SJ+JR+"?",JR,TJ,EJ,i2e].join("|")+")",u2e=RegExp(QR+"(?="+QR+")|"+c2e+l2e,"g");function h2e(e){return e.match(u2e)||[]}var d2e=h2e,f2e=JEe,p2e=bJ,m2e=d2e;function g2e(e){return p2e(e)?m2e(e):f2e(e)}var y2e=g2e,_2e=$Ee,v2e=bJ,x2e=y2e,b2e=mJ;function w2e(e){return function(t){t=b2e(t);var r=v2e(t)?x2e(t):void 0,n=r?r[0]:t.charAt(0),l=r?_2e(r,1).join(""):t.slice(1);return n[e]()+l}}var S2e=w2e,T2e=S2e,E2e=T2e("toUpperCase"),A2e=E2e;const DP=Pi(A2e);function Yi(e){return function(){return e}}const CJ=Math.cos,_2=Math.sin,Ic=Math.sqrt,v2=Math.PI,LP=2*v2,eD=Math.PI,tD=2*eD,zp=1e-6,P2e=tD-zp;function IJ(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function C2e(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return IJ;const r=10**t;return function(n){this._+=n[0];for(let l=1,h=n.length;l<h;++l)this._+=Math.round(arguments[l]*r)/r+n[l]}}class I2e{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?IJ:C2e(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,l){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+l}`}bezierCurveTo(t,r,n,l,h,f){this._append`C${+t},${+r},${+n},${+l},${this._x1=+h},${this._y1=+f}`}arcTo(t,r,n,l,h){if(t=+t,r=+r,n=+n,l=+l,h=+h,h<0)throw new Error(`negative radius: ${h}`);let f=this._x1,o=this._y1,v=n-t,b=l-r,E=f-t,P=o-r,O=E*E+P*P;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(O>zp)if(!(Math.abs(P*v-b*E)>zp)||!h)this._append`L${this._x1=t},${this._y1=r}`;else{let L=n-f,B=l-o,z=v*v+b*b,$=L*L+B*B,U=Math.sqrt(z),G=Math.sqrt(O),Z=h*Math.tan((eD-Math.acos((z+O-$)/(2*U*G)))/2),ne=Z/G,Y=Z/U;Math.abs(ne-1)>zp&&this._append`L${t+ne*E},${r+ne*P}`,this._append`A${h},${h},0,0,${+(P*L>E*B)},${this._x1=t+Y*v},${this._y1=r+Y*b}`}}arc(t,r,n,l,h,f){if(t=+t,r=+r,n=+n,f=!!f,n<0)throw new Error(`negative radius: ${n}`);let o=n*Math.cos(l),v=n*Math.sin(l),b=t+o,E=r+v,P=1^f,O=f?l-h:h-l;this._x1===null?this._append`M${b},${E}`:(Math.abs(this._x1-b)>zp||Math.abs(this._y1-E)>zp)&&this._append`L${b},${E}`,n&&(O<0&&(O=O%tD+tD),O>P2e?this._append`A${n},${n},0,1,${P},${t-o},${r-v}A${n},${n},0,1,${P},${this._x1=b},${this._y1=E}`:O>zp&&this._append`A${n},${n},0,${+(O>=eD)},${P},${this._x1=t+n*Math.cos(h)},${this._y1=r+n*Math.sin(h)}`)}rect(t,r,n,l){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+l}h${-n}Z`}toString(){return this._}}function KN(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new I2e(t)}function YN(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function MJ(e){this._context=e}MJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function jP(e){return new MJ(e)}function OJ(e){return e[0]}function kJ(e){return e[1]}function RJ(e,t){var r=Yi(!0),n=null,l=jP,h=null,f=KN(o);e=typeof e=="function"?e:e===void 0?OJ:Yi(e),t=typeof t=="function"?t:t===void 0?kJ:Yi(t);function o(v){var b,E=(v=YN(v)).length,P,O=!1,L;for(n==null&&(h=l(L=f())),b=0;b<=E;++b)!(b<E&&r(P=v[b],b,v))===O&&((O=!O)?h.lineStart():h.lineEnd()),O&&h.point(+e(P,b,v),+t(P,b,v));if(L)return h=null,L+""||null}return o.x=function(v){return arguments.length?(e=typeof v=="function"?v:Yi(+v),o):e},o.y=function(v){return arguments.length?(t=typeof v=="function"?v:Yi(+v),o):t},o.defined=function(v){return arguments.length?(r=typeof v=="function"?v:Yi(!!v),o):r},o.curve=function(v){return arguments.length?(l=v,n!=null&&(h=l(n)),o):l},o.context=function(v){return arguments.length?(v==null?n=h=null:h=l(n=v),o):n},o}function GT(e,t,r){var n=null,l=Yi(!0),h=null,f=jP,o=null,v=KN(b);e=typeof e=="function"?e:e===void 0?OJ:Yi(+e),t=typeof t=="function"?t:Yi(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?kJ:Yi(+r);function b(P){var O,L,B,z=(P=YN(P)).length,$,U=!1,G,Z=new Array(z),ne=new Array(z);for(h==null&&(o=f(G=v())),O=0;O<=z;++O){if(!(O<z&&l($=P[O],O,P))===U)if(U=!U)L=O,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),B=O-1;B>=L;--B)o.point(Z[B],ne[B]);o.lineEnd(),o.areaEnd()}U&&(Z[O]=+e($,O,P),ne[O]=+t($,O,P),o.point(n?+n($,O,P):Z[O],r?+r($,O,P):ne[O]))}if(G)return o=null,G+""||null}function E(){return RJ().defined(l).curve(f).context(h)}return b.x=function(P){return arguments.length?(e=typeof P=="function"?P:Yi(+P),n=null,b):e},b.x0=function(P){return arguments.length?(e=typeof P=="function"?P:Yi(+P),b):e},b.x1=function(P){return arguments.length?(n=P==null?null:typeof P=="function"?P:Yi(+P),b):n},b.y=function(P){return arguments.length?(t=typeof P=="function"?P:Yi(+P),r=null,b):t},b.y0=function(P){return arguments.length?(t=typeof P=="function"?P:Yi(+P),b):t},b.y1=function(P){return arguments.length?(r=P==null?null:typeof P=="function"?P:Yi(+P),b):r},b.lineX0=b.lineY0=function(){return E().x(e).y(t)},b.lineY1=function(){return E().x(e).y(r)},b.lineX1=function(){return E().x(n).y(t)},b.defined=function(P){return arguments.length?(l=typeof P=="function"?P:Yi(!!P),b):l},b.curve=function(P){return arguments.length?(f=P,h!=null&&(o=f(h)),b):f},b.context=function(P){return arguments.length?(P==null?h=o=null:o=f(h=P),b):h},b}class DJ{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function M2e(e){return new DJ(e,!0)}function O2e(e){return new DJ(e,!1)}const JN={draw(e,t){const r=Ic(t/v2);e.moveTo(r,0),e.arc(0,0,r,0,LP)}},k2e={draw(e,t){const r=Ic(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},LJ=Ic(1/3),R2e=LJ*2,D2e={draw(e,t){const r=Ic(t/R2e),n=r*LJ;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},L2e={draw(e,t){const r=Ic(t),n=-r/2;e.rect(n,n,r,r)}},j2e=.8908130915292852,jJ=_2(v2/10)/_2(7*v2/10),N2e=_2(LP/10)*jJ,z2e=-CJ(LP/10)*jJ,F2e={draw(e,t){const r=Ic(t*j2e),n=N2e*r,l=z2e*r;e.moveTo(0,-r),e.lineTo(n,l);for(let h=1;h<5;++h){const f=LP*h/5,o=CJ(f),v=_2(f);e.lineTo(v*r,-o*r),e.lineTo(o*n-v*l,v*n+o*l)}e.closePath()}},xO=Ic(3),B2e={draw(e,t){const r=-Ic(t/(xO*3));e.moveTo(0,r*2),e.lineTo(-xO*r,-r),e.lineTo(xO*r,-r),e.closePath()}},El=-.5,Al=Ic(3)/2,rD=1/Ic(12),$2e=(rD/2+1)*3,V2e={draw(e,t){const r=Ic(t/$2e),n=r/2,l=r*rD,h=n,f=r*rD+r,o=-h,v=f;e.moveTo(n,l),e.lineTo(h,f),e.lineTo(o,v),e.lineTo(El*n-Al*l,Al*n+El*l),e.lineTo(El*h-Al*f,Al*h+El*f),e.lineTo(El*o-Al*v,Al*o+El*v),e.lineTo(El*n+Al*l,El*l-Al*n),e.lineTo(El*h+Al*f,El*f-Al*h),e.lineTo(El*o+Al*v,El*v-Al*o),e.closePath()}};function U2e(e,t){let r=null,n=KN(l);e=typeof e=="function"?e:Yi(e||JN),t=typeof t=="function"?t:Yi(t===void 0?64:+t);function l(){let h;if(r||(r=h=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),h)return r=null,h+""||null}return l.type=function(h){return arguments.length?(e=typeof h=="function"?h:Yi(h),l):e},l.size=function(h){return arguments.length?(t=typeof h=="function"?h:Yi(+h),l):t},l.context=function(h){return arguments.length?(r=h??null,l):r},l}function x2(){}function b2(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function NJ(e){this._context=e}NJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:b2(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:b2(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function G2e(e){return new NJ(e)}function zJ(e){this._context=e}zJ.prototype={areaStart:x2,areaEnd:x2,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:b2(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function H2e(e){return new zJ(e)}function FJ(e){this._context=e}FJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:b2(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function W2e(e){return new FJ(e)}function BJ(e){this._context=e}BJ.prototype={areaStart:x2,areaEnd:x2,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function q2e(e){return new BJ(e)}function UU(e){return e<0?-1:1}function GU(e,t,r){var n=e._x1-e._x0,l=t-e._x1,h=(e._y1-e._y0)/(n||l<0&&-0),f=(r-e._y1)/(l||n<0&&-0),o=(h*l+f*n)/(n+l);return(UU(h)+UU(f))*Math.min(Math.abs(h),Math.abs(f),.5*Math.abs(o))||0}function HU(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function bO(e,t,r){var n=e._x0,l=e._y0,h=e._x1,f=e._y1,o=(h-n)/3;e._context.bezierCurveTo(n+o,l+o*t,h-o,f-o*r,h,f)}function w2(e){this._context=e}w2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:bO(this,this._t0,HU(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,bO(this,HU(this,r=GU(this,e,t)),r);break;default:bO(this,this._t0,r=GU(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function $J(e){this._context=new VJ(e)}($J.prototype=Object.create(w2.prototype)).point=function(e,t){w2.prototype.point.call(this,t,e)};function VJ(e){this._context=e}VJ.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,l,h){this._context.bezierCurveTo(t,e,n,r,h,l)}};function Z2e(e){return new w2(e)}function X2e(e){return new $J(e)}function UJ(e){this._context=e}UJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=WU(e),l=WU(t),h=0,f=1;f<r;++h,++f)this._context.bezierCurveTo(n[0][h],l[0][h],n[1][h],l[1][h],e[f],t[f]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function WU(e){var t,r=e.length-1,n,l=new Array(r),h=new Array(r),f=new Array(r);for(l[0]=0,h[0]=2,f[0]=e[0]+2*e[1],t=1;t<r-1;++t)l[t]=1,h[t]=4,f[t]=4*e[t]+2*e[t+1];for(l[r-1]=2,h[r-1]=7,f[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=l[t]/h[t-1],h[t]-=n,f[t]-=n*f[t-1];for(l[r-1]=f[r-1]/h[r-1],t=r-2;t>=0;--t)l[t]=(f[t]-l[t+1])/h[t];for(h[r-1]=(e[r]+l[r-1])/2,t=0;t<r-1;++t)h[t]=2*e[t+1]-l[t+1];return[l,h]}function K2e(e){return new UJ(e)}function NP(e,t){this._context=e,this._t=t}NP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function Y2e(e){return new NP(e,.5)}function J2e(e){return new NP(e,0)}function Q2e(e){return new NP(e,1)}function E_(e,t){if((f=e.length)>1)for(var r=1,n,l,h=e[t[0]],f,o=h.length;r<f;++r)for(l=h,h=e[t[r]],n=0;n<o;++n)h[n][1]+=h[n][0]=isNaN(l[n][1])?l[n][0]:l[n][1]}function nD(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function eAe(e,t){return e[t]}function tAe(e){const t=[];return t.key=e,t}function rAe(){var e=Yi([]),t=nD,r=E_,n=eAe;function l(h){var f=Array.from(e.apply(this,arguments),tAe),o,v=f.length,b=-1,E;for(const P of h)for(o=0,++b;o<v;++o)(f[o][b]=[0,+n(P,f[o].key,b,h)]).data=P;for(o=0,E=YN(t(f));o<v;++o)f[E[o]].index=o;return r(f,E),f}return l.keys=function(h){return arguments.length?(e=typeof h=="function"?h:Yi(Array.from(h)),l):e},l.value=function(h){return arguments.length?(n=typeof h=="function"?h:Yi(+h),l):n},l.order=function(h){return arguments.length?(t=h==null?nD:typeof h=="function"?h:Yi(Array.from(h)),l):t},l.offset=function(h){return arguments.length?(r=h??E_,l):r},l}function nAe(e,t){if((n=e.length)>0){for(var r,n,l=0,h=e[0].length,f;l<h;++l){for(f=r=0;r<n;++r)f+=e[r][l][1]||0;if(f)for(r=0;r<n;++r)e[r][l][1]/=f}E_(e,t)}}function iAe(e,t){if((l=e.length)>0){for(var r=0,n=e[t[0]],l,h=n.length;r<h;++r){for(var f=0,o=0;f<l;++f)o+=e[f][r][1]||0;n[r][1]+=n[r][0]=-o/2}E_(e,t)}}function oAe(e,t){if(!(!((f=e.length)>0)||!((h=(l=e[t[0]]).length)>0))){for(var r=0,n=1,l,h,f;n<h;++n){for(var o=0,v=0,b=0;o<f;++o){for(var E=e[t[o]],P=E[n][1]||0,O=E[n-1][1]||0,L=(P-O)/2,B=0;B<o;++B){var z=e[t[B]],$=z[n][1]||0,U=z[n-1][1]||0;L+=$-U}v+=P,b+=L*P}l[n-1][1]+=l[n-1][0]=r,v&&(r-=b/v)}l[n-1][1]+=l[n-1][0]=r,E_(e,t)}}function tw(e){"@babel/helpers - typeof";return tw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tw(e)}var sAe=["type","size","sizeType"];function iD(){return iD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},iD.apply(this,arguments)}function qU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function ZU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qU(Object(r),!0).forEach(function(n){aAe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aAe(e,t,r){return t=lAe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lAe(e){var t=cAe(e,"string");return tw(t)=="symbol"?t:t+""}function cAe(e,t){if(tw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(tw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uAe(e,t){if(e==null)return{};var r=hAe(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function hAe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var GJ={symbolCircle:JN,symbolCross:k2e,symbolDiamond:D2e,symbolSquare:L2e,symbolStar:F2e,symbolTriangle:B2e,symbolWye:V2e},dAe=Math.PI/180,fAe=function(t){var r="symbol".concat(DP(t));return GJ[r]||JN},pAe=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var l=18*dAe;return 1.25*t*t*(Math.tan(l)-Math.tan(l*2)*Math.pow(Math.tan(l),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},mAe=function(t,r){GJ["symbol".concat(DP(t))]=r},QN=function(t){var r=t.type,n=r===void 0?"circle":r,l=t.size,h=l===void 0?64:l,f=t.sizeType,o=f===void 0?"area":f,v=uAe(t,sAe),b=ZU(ZU({},v),{},{type:n,size:h,sizeType:o}),E=function(){var $=fAe(n),U=U2e().type($).size(pAe(h,o,n));return U()},P=b.className,O=b.cx,L=b.cy,B=wn(b,!0);return O===+O&&L===+L&&h===+h?ze.createElement("path",iD({},B,{className:qn("recharts-symbols",P),transform:"translate(".concat(O,", ").concat(L,")"),d:E()})):null};QN.registerSymbol=mAe;function A_(e){"@babel/helpers - typeof";return A_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A_(e)}function oD(){return oD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oD.apply(this,arguments)}function XU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function gAe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XU(Object(r),!0).forEach(function(n){rw(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yAe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _Ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,WJ(n.key),n)}}function vAe(e,t,r){return t&&_Ae(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function xAe(e,t,r){return t=S2(t),bAe(e,HJ()?Reflect.construct(t,r||[],S2(e).constructor):t.apply(e,r))}function bAe(e,t){if(t&&(A_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wAe(e)}function wAe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function HJ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(HJ=function(){return!!e})()}function S2(e){return S2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},S2(e)}function SAe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sD(e,t)}function sD(e,t){return sD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},sD(e,t)}function rw(e,t,r){return t=WJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WJ(e){var t=TAe(e,"string");return A_(t)=="symbol"?t:t+""}function TAe(e,t){if(A_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(A_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Pl=32,e3=function(e){function t(){return yAe(this,t),xAe(this,t,arguments)}return SAe(t,e),vAe(t,[{key:"renderIcon",value:function(n){var l=this.props.inactiveColor,h=Pl/2,f=Pl/6,o=Pl/3,v=n.inactive?l:n.color;if(n.type==="plainline")return ze.createElement("line",{strokeWidth:4,fill:"none",stroke:v,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:h,x2:Pl,y2:h,className:"recharts-legend-icon"});if(n.type==="line")return ze.createElement("path",{strokeWidth:4,fill:"none",stroke:v,d:"M0,".concat(h,"h").concat(o,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(2*o,",").concat(h,`
            H`).concat(Pl,"M").concat(2*o,",").concat(h,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(o,",").concat(h),className:"recharts-legend-icon"});if(n.type==="rect")return ze.createElement("path",{stroke:"none",fill:v,d:"M0,".concat(Pl/8,"h").concat(Pl,"v").concat(Pl*3/4,"h").concat(-Pl,"z"),className:"recharts-legend-icon"});if(ze.isValidElement(n.legendIcon)){var b=gAe({},n);return delete b.legendIcon,ze.cloneElement(n.legendIcon,b)}return ze.createElement(QN,{fill:v,cx:h,cy:h,size:Pl,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,l=this.props,h=l.payload,f=l.iconSize,o=l.layout,v=l.formatter,b=l.inactiveColor,E={x:0,y:0,width:Pl,height:Pl},P={display:o==="horizontal"?"inline-block":"block",marginRight:10},O={display:"inline-block",verticalAlign:"middle",marginRight:4};return h.map(function(L,B){var z=L.formatter||v,$=qn(rw(rw({"recharts-legend-item":!0},"legend-item-".concat(B),!0),"inactive",L.inactive));if(L.type==="none")return null;var U=In(L.value)?null:L.value;bc(!In(L.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var G=L.inactive?b:L.color;return ze.createElement("li",oD({className:$,style:P,key:"legend-item-".concat(B)},Sm(n.props,L,B)),ze.createElement(KR,{width:f,height:f,viewBox:E,style:O},n.renderIcon(L)),ze.createElement("span",{className:"recharts-legend-item-text",style:{color:G}},z?z(U,L,B):U))})}},{key:"render",value:function(){var n=this.props,l=n.payload,h=n.layout,f=n.align;if(!l||!l.length)return null;var o={padding:0,margin:0,textAlign:h==="horizontal"?f:"left"};return ze.createElement("ul",{className:"recharts-default-legend",style:o},this.renderItems())}}])}(K.PureComponent);rw(e3,"displayName","Legend");rw(e3,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var EAe=bP;function AAe(){this.__data__=new EAe,this.size=0}var PAe=AAe;function CAe(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var IAe=CAe;function MAe(e){return this.__data__.get(e)}var OAe=MAe;function kAe(e){return this.__data__.has(e)}var RAe=kAe,DAe=bP,LAe=$N,jAe=VN,NAe=200;function zAe(e,t){var r=this.__data__;if(r instanceof DAe){var n=r.__data__;if(!LAe||n.length<NAe-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new jAe(n)}return r.set(e,t),this.size=r.size,this}var FAe=zAe,BAe=bP,$Ae=PAe,VAe=IAe,UAe=OAe,GAe=RAe,HAe=FAe;function gv(e){var t=this.__data__=new BAe(e);this.size=t.size}gv.prototype.clear=$Ae;gv.prototype.delete=VAe;gv.prototype.get=UAe;gv.prototype.has=GAe;gv.prototype.set=HAe;var qJ=gv,WAe="__lodash_hash_undefined__";function qAe(e){return this.__data__.set(e,WAe),this}var ZAe=qAe;function XAe(e){return this.__data__.has(e)}var KAe=XAe,YAe=VN,JAe=ZAe,QAe=KAe;function T2(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new YAe;++t<r;)this.add(e[t])}T2.prototype.add=T2.prototype.push=JAe;T2.prototype.has=QAe;var ZJ=T2;function ePe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var XJ=ePe;function tPe(e,t){return e.has(t)}var KJ=tPe,rPe=ZJ,nPe=XJ,iPe=KJ,oPe=1,sPe=2;function aPe(e,t,r,n,l,h){var f=r&oPe,o=e.length,v=t.length;if(o!=v&&!(f&&v>o))return!1;var b=h.get(e),E=h.get(t);if(b&&E)return b==t&&E==e;var P=-1,O=!0,L=r&sPe?new rPe:void 0;for(h.set(e,t),h.set(t,e);++P<o;){var B=e[P],z=t[P];if(n)var $=f?n(z,B,P,t,e,h):n(B,z,P,e,t,h);if($!==void 0){if($)continue;O=!1;break}if(L){if(!nPe(t,function(U,G){if(!iPe(L,G)&&(B===U||l(B,U,r,n,h)))return L.push(G)})){O=!1;break}}else if(!(B===z||l(B,z,r,n,h))){O=!1;break}}return h.delete(e),h.delete(t),O}var YJ=aPe,lPe=Iu,cPe=lPe.Uint8Array,uPe=cPe;function hPe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,l){r[++t]=[l,n]}),r}var dPe=hPe;function fPe(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var t3=fPe,KU=e1,YU=uPe,pPe=BN,mPe=YJ,gPe=dPe,yPe=t3,_Pe=1,vPe=2,xPe="[object Boolean]",bPe="[object Date]",wPe="[object Error]",SPe="[object Map]",TPe="[object Number]",EPe="[object RegExp]",APe="[object Set]",PPe="[object String]",CPe="[object Symbol]",IPe="[object ArrayBuffer]",MPe="[object DataView]",JU=KU?KU.prototype:void 0,wO=JU?JU.valueOf:void 0;function OPe(e,t,r,n,l,h,f){switch(r){case MPe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case IPe:return!(e.byteLength!=t.byteLength||!h(new YU(e),new YU(t)));case xPe:case bPe:case TPe:return pPe(+e,+t);case wPe:return e.name==t.name&&e.message==t.message;case EPe:case PPe:return e==t+"";case SPe:var o=gPe;case APe:var v=n&_Pe;if(o||(o=yPe),e.size!=t.size&&!v)return!1;var b=f.get(e);if(b)return b==t;n|=vPe,f.set(e,t);var E=mPe(o(e),o(t),n,l,h,f);return f.delete(e),E;case CPe:if(wO)return wO.call(e)==wO.call(t)}return!1}var kPe=OPe;function RPe(e,t){for(var r=-1,n=t.length,l=e.length;++r<n;)e[l+r]=t[r];return e}var JJ=RPe,DPe=JJ,LPe=qa;function jPe(e,t,r){var n=t(e);return LPe(e)?n:DPe(n,r(e))}var NPe=jPe;function zPe(e,t){for(var r=-1,n=e==null?0:e.length,l=0,h=[];++r<n;){var f=e[r];t(f,r,e)&&(h[l++]=f)}return h}var FPe=zPe;function BPe(){return[]}var $Pe=BPe,VPe=FPe,UPe=$Pe,GPe=Object.prototype,HPe=GPe.propertyIsEnumerable,QU=Object.getOwnPropertySymbols,WPe=QU?function(e){return e==null?[]:(e=Object(e),VPe(QU(e),function(t){return HPe.call(e,t)}))}:UPe,qPe=WPe;function ZPe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var XPe=ZPe,KPe=Lh,YPe=jh,JPe="[object Arguments]";function QPe(e){return YPe(e)&&KPe(e)==JPe}var eCe=QPe,e6=eCe,tCe=jh,QJ=Object.prototype,rCe=QJ.hasOwnProperty,nCe=QJ.propertyIsEnumerable,iCe=e6(function(){return arguments}())?e6:function(e){return tCe(e)&&rCe.call(e,"callee")&&!nCe.call(e,"callee")},r3=iCe,E2={exports:{}};function oCe(){return!1}var sCe=oCe;E2.exports;(function(e,t){var r=Iu,n=sCe,l=t&&!t.nodeType&&t,h=l&&!0&&e&&!e.nodeType&&e,f=h&&h.exports===l,o=f?r.Buffer:void 0,v=o?o.isBuffer:void 0,b=v||n;e.exports=b})(E2,E2.exports);var eQ=E2.exports,aCe=9007199254740991,lCe=/^(?:0|[1-9]\d*)$/;function cCe(e,t){var r=typeof e;return t=t??aCe,!!t&&(r=="number"||r!="symbol"&&lCe.test(e))&&e>-1&&e%1==0&&e<t}var n3=cCe,uCe=9007199254740991;function hCe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=uCe}var i3=hCe,dCe=Lh,fCe=i3,pCe=jh,mCe="[object Arguments]",gCe="[object Array]",yCe="[object Boolean]",_Ce="[object Date]",vCe="[object Error]",xCe="[object Function]",bCe="[object Map]",wCe="[object Number]",SCe="[object Object]",TCe="[object RegExp]",ECe="[object Set]",ACe="[object String]",PCe="[object WeakMap]",CCe="[object ArrayBuffer]",ICe="[object DataView]",MCe="[object Float32Array]",OCe="[object Float64Array]",kCe="[object Int8Array]",RCe="[object Int16Array]",DCe="[object Int32Array]",LCe="[object Uint8Array]",jCe="[object Uint8ClampedArray]",NCe="[object Uint16Array]",zCe="[object Uint32Array]",io={};io[MCe]=io[OCe]=io[kCe]=io[RCe]=io[DCe]=io[LCe]=io[jCe]=io[NCe]=io[zCe]=!0;io[mCe]=io[gCe]=io[CCe]=io[yCe]=io[ICe]=io[_Ce]=io[vCe]=io[xCe]=io[bCe]=io[wCe]=io[SCe]=io[TCe]=io[ECe]=io[ACe]=io[PCe]=!1;function FCe(e){return pCe(e)&&fCe(e.length)&&!!io[dCe(e)]}var BCe=FCe;function $Ce(e){return function(t){return e(t)}}var tQ=$Ce,A2={exports:{}};A2.exports;(function(e,t){var r=cJ,n=t&&!t.nodeType&&t,l=n&&!0&&e&&!e.nodeType&&e,h=l&&l.exports===n,f=h&&r.process,o=function(){try{var v=l&&l.require&&l.require("util").types;return v||f&&f.binding&&f.binding("util")}catch{}}();e.exports=o})(A2,A2.exports);var VCe=A2.exports,UCe=BCe,GCe=tQ,t6=VCe,r6=t6&&t6.isTypedArray,HCe=r6?GCe(r6):UCe,rQ=HCe,WCe=XPe,qCe=r3,ZCe=qa,XCe=eQ,KCe=n3,YCe=rQ,JCe=Object.prototype,QCe=JCe.hasOwnProperty;function eIe(e,t){var r=ZCe(e),n=!r&&qCe(e),l=!r&&!n&&XCe(e),h=!r&&!n&&!l&&YCe(e),f=r||n||l||h,o=f?WCe(e.length,String):[],v=o.length;for(var b in e)(t||QCe.call(e,b))&&!(f&&(b=="length"||l&&(b=="offset"||b=="parent")||h&&(b=="buffer"||b=="byteLength"||b=="byteOffset")||KCe(b,v)))&&o.push(b);return o}var tIe=eIe,rIe=Object.prototype;function nIe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||rIe;return e===r}var iIe=nIe;function oIe(e,t){return function(r){return e(t(r))}}var nQ=oIe,sIe=nQ,aIe=sIe(Object.keys,Object),lIe=aIe,cIe=iIe,uIe=lIe,hIe=Object.prototype,dIe=hIe.hasOwnProperty;function fIe(e){if(!cIe(e))return uIe(e);var t=[];for(var r in Object(e))dIe.call(e,r)&&r!="constructor"&&t.push(r);return t}var pIe=fIe,mIe=FN,gIe=i3;function yIe(e){return e!=null&&gIe(e.length)&&!mIe(e)}var n1=yIe,_Ie=tIe,vIe=pIe,xIe=n1;function bIe(e){return xIe(e)?_Ie(e):vIe(e)}var zP=bIe,wIe=NPe,SIe=qPe,TIe=zP;function EIe(e){return wIe(e,TIe,SIe)}var AIe=EIe,n6=AIe,PIe=1,CIe=Object.prototype,IIe=CIe.hasOwnProperty;function MIe(e,t,r,n,l,h){var f=r&PIe,o=n6(e),v=o.length,b=n6(t),E=b.length;if(v!=E&&!f)return!1;for(var P=v;P--;){var O=o[P];if(!(f?O in t:IIe.call(t,O)))return!1}var L=h.get(e),B=h.get(t);if(L&&B)return L==t&&B==e;var z=!0;h.set(e,t),h.set(t,e);for(var $=f;++P<v;){O=o[P];var U=e[O],G=t[O];if(n)var Z=f?n(G,U,O,t,e,h):n(U,G,O,e,t,h);if(!(Z===void 0?U===G||l(U,G,r,n,h):Z)){z=!1;break}$||($=O=="constructor")}if(z&&!$){var ne=e.constructor,Y=t.constructor;ne!=Y&&"constructor"in e&&"constructor"in t&&!(typeof ne=="function"&&ne instanceof ne&&typeof Y=="function"&&Y instanceof Y)&&(z=!1)}return h.delete(e),h.delete(t),z}var OIe=MIe,kIe=Dm,RIe=Iu,DIe=kIe(RIe,"DataView"),LIe=DIe,jIe=Dm,NIe=Iu,zIe=jIe(NIe,"Promise"),FIe=zIe,BIe=Dm,$Ie=Iu,VIe=BIe($Ie,"Set"),iQ=VIe,UIe=Dm,GIe=Iu,HIe=UIe(GIe,"WeakMap"),WIe=HIe,aD=LIe,lD=$N,cD=FIe,uD=iQ,hD=WIe,oQ=Lh,yv=hJ,i6="[object Map]",qIe="[object Object]",o6="[object Promise]",s6="[object Set]",a6="[object WeakMap]",l6="[object DataView]",ZIe=yv(aD),XIe=yv(lD),KIe=yv(cD),YIe=yv(uD),JIe=yv(hD),Fp=oQ;(aD&&Fp(new aD(new ArrayBuffer(1)))!=l6||lD&&Fp(new lD)!=i6||cD&&Fp(cD.resolve())!=o6||uD&&Fp(new uD)!=s6||hD&&Fp(new hD)!=a6)&&(Fp=function(e){var t=oQ(e),r=t==qIe?e.constructor:void 0,n=r?yv(r):"";if(n)switch(n){case ZIe:return l6;case XIe:return i6;case KIe:return o6;case YIe:return s6;case JIe:return a6}return t});var QIe=Fp,SO=qJ,eMe=YJ,tMe=kPe,rMe=OIe,c6=QIe,u6=qa,h6=eQ,nMe=rQ,iMe=1,d6="[object Arguments]",f6="[object Array]",HT="[object Object]",oMe=Object.prototype,p6=oMe.hasOwnProperty;function sMe(e,t,r,n,l,h){var f=u6(e),o=u6(t),v=f?f6:c6(e),b=o?f6:c6(t);v=v==d6?HT:v,b=b==d6?HT:b;var E=v==HT,P=b==HT,O=v==b;if(O&&h6(e)){if(!h6(t))return!1;f=!0,E=!1}if(O&&!E)return h||(h=new SO),f||nMe(e)?eMe(e,t,r,n,l,h):tMe(e,t,v,r,n,l,h);if(!(r&iMe)){var L=E&&p6.call(e,"__wrapped__"),B=P&&p6.call(t,"__wrapped__");if(L||B){var z=L?e.value():e,$=B?t.value():t;return h||(h=new SO),l(z,$,r,n,h)}}return O?(h||(h=new SO),rMe(e,t,r,n,l,h)):!1}var aMe=sMe,lMe=aMe,m6=jh;function sQ(e,t,r,n,l){return e===t?!0:e==null||t==null||!m6(e)&&!m6(t)?e!==e&&t!==t:lMe(e,t,r,n,sQ,l)}var o3=sQ,cMe=qJ,uMe=o3,hMe=1,dMe=2;function fMe(e,t,r,n){var l=r.length,h=l,f=!n;if(e==null)return!h;for(e=Object(e);l--;){var o=r[l];if(f&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++l<h;){o=r[l];var v=o[0],b=e[v],E=o[1];if(f&&o[2]){if(b===void 0&&!(v in e))return!1}else{var P=new cMe;if(n)var O=n(b,E,v,e,t,P);if(!(O===void 0?uMe(E,b,hMe|dMe,n,P):O))return!1}}return!0}var pMe=fMe,mMe=Pf;function gMe(e){return e===e&&!mMe(e)}var aQ=gMe,yMe=aQ,_Me=zP;function vMe(e){for(var t=_Me(e),r=t.length;r--;){var n=t[r],l=e[n];t[r]=[n,l,yMe(l)]}return t}var xMe=vMe;function bMe(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var lQ=bMe,wMe=pMe,SMe=xMe,TMe=lQ;function EMe(e){var t=SMe(e);return t.length==1&&t[0][2]?TMe(t[0][0],t[0][1]):function(r){return r===e||wMe(r,e,t)}}var AMe=EMe;function PMe(e,t){return e!=null&&t in Object(e)}var CMe=PMe,IMe=gJ,MMe=r3,OMe=qa,kMe=n3,RMe=i3,DMe=SP;function LMe(e,t,r){t=IMe(t,e);for(var n=-1,l=t.length,h=!1;++n<l;){var f=DMe(t[n]);if(!(h=e!=null&&r(e,f)))break;e=e[f]}return h||++n!=l?h:(l=e==null?0:e.length,!!l&&RMe(l)&&kMe(f,l)&&(OMe(e)||MMe(e)))}var jMe=LMe,NMe=CMe,zMe=jMe;function FMe(e,t){return e!=null&&zMe(e,t,NMe)}var BMe=FMe,$Me=o3,VMe=yJ,UMe=BMe,GMe=zN,HMe=aQ,WMe=lQ,qMe=SP,ZMe=1,XMe=2;function KMe(e,t){return GMe(e)&&HMe(t)?WMe(qMe(e),t):function(r){var n=VMe(r,e);return n===void 0&&n===t?UMe(r,e):$Me(t,n,ZMe|XMe)}}var YMe=KMe;function JMe(e){return e}var _v=JMe;function QMe(e){return function(t){return t?.[e]}}var eOe=QMe,tOe=HN;function rOe(e){return function(t){return tOe(t,e)}}var nOe=rOe,iOe=eOe,oOe=nOe,sOe=zN,aOe=SP;function lOe(e){return sOe(e)?iOe(aOe(e)):oOe(e)}var cOe=lOe,uOe=AMe,hOe=YMe,dOe=_v,fOe=qa,pOe=cOe;function mOe(e){return typeof e=="function"?e:e==null?dOe:typeof e=="object"?fOe(e)?hOe(e[0],e[1]):uOe(e):pOe(e)}var Mu=mOe;function gOe(e,t,r,n){for(var l=e.length,h=r+(n?1:-1);n?h--:++h<l;)if(t(e[h],h,e))return h;return-1}var cQ=gOe;function yOe(e){return e!==e}var _Oe=yOe;function vOe(e,t,r){for(var n=r-1,l=e.length;++n<l;)if(e[n]===t)return n;return-1}var xOe=vOe,bOe=cQ,wOe=_Oe,SOe=xOe;function TOe(e,t,r){return t===t?SOe(e,t,r):bOe(e,wOe,r)}var EOe=TOe,AOe=EOe;function POe(e,t){var r=e==null?0:e.length;return!!r&&AOe(e,t,0)>-1}var COe=POe;function IOe(e,t,r){for(var n=-1,l=e==null?0:e.length;++n<l;)if(r(t,e[n]))return!0;return!1}var MOe=IOe;function OOe(){}var kOe=OOe,TO=iQ,ROe=kOe,DOe=t3,LOe=1/0,jOe=TO&&1/DOe(new TO([,-0]))[1]==LOe?function(e){return new TO(e)}:ROe,NOe=jOe,zOe=ZJ,FOe=COe,BOe=MOe,$Oe=KJ,VOe=NOe,UOe=t3,GOe=200;function HOe(e,t,r){var n=-1,l=FOe,h=e.length,f=!0,o=[],v=o;if(r)f=!1,l=BOe;else if(h>=GOe){var b=t?null:VOe(e);if(b)return UOe(b);f=!1,l=$Oe,v=new zOe}else v=t?[]:o;e:for(;++n<h;){var E=e[n],P=t?t(E):E;if(E=r||E!==0?E:0,f&&P===P){for(var O=v.length;O--;)if(v[O]===P)continue e;t&&v.push(P),o.push(E)}else l(v,P,r)||(v!==o&&v.push(P),o.push(E))}return o}var WOe=HOe,qOe=Mu,ZOe=WOe;function XOe(e,t){return e&&e.length?ZOe(e,qOe(t)):[]}var KOe=XOe;const g6=Pi(KOe);function uQ(e,t,r){return t===!0?g6(e,r):In(t)?g6(e,t):e}function P_(e){"@babel/helpers - typeof";return P_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P_(e)}var YOe=["ref"];function y6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function rh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y6(Object(r),!0).forEach(function(n){FP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y6(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _6(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,dQ(n.key),n)}}function QOe(e,t,r){return t&&_6(e.prototype,t),r&&_6(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function eke(e,t,r){return t=P2(t),tke(e,hQ()?Reflect.construct(t,r||[],P2(e).constructor):t.apply(e,r))}function tke(e,t){if(t&&(P_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rke(e)}function rke(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hQ=function(){return!!e})()}function P2(e){return P2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},P2(e)}function nke(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dD(e,t)}function dD(e,t){return dD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},dD(e,t)}function FP(e,t,r){return t=dQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dQ(e){var t=ike(e,"string");return P_(t)=="symbol"?t:t+""}function ike(e,t){if(P_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(P_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function oke(e,t){if(e==null)return{};var r=ske(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ske(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function ake(e){return e.value}function lke(e,t){if(ze.isValidElement(e))return ze.cloneElement(e,t);if(typeof e=="function")return ze.createElement(e,t);t.ref;var r=oke(t,YOe);return ze.createElement(e3,r)}var v6=1,e_=function(e){function t(){var r;JOe(this,t);for(var n=arguments.length,l=new Array(n),h=0;h<n;h++)l[h]=arguments[h];return r=eke(this,t,[].concat(l)),FP(r,"lastBoundingBox",{width:-1,height:-1}),r}return nke(t,e),QOe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,l=this.getBBox();l?(Math.abs(l.width-this.lastBoundingBox.width)>v6||Math.abs(l.height-this.lastBoundingBox.height)>v6)&&(this.lastBoundingBox.width=l.width,this.lastBoundingBox.height=l.height,n&&n(l)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?rh({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var l=this.props,h=l.layout,f=l.align,o=l.verticalAlign,v=l.margin,b=l.chartWidth,E=l.chartHeight,P,O;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(f==="center"&&h==="vertical"){var L=this.getBBoxSnapshot();P={left:((b||0)-L.width)/2}}else P=f==="right"?{right:v&&v.right||0}:{left:v&&v.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(o==="middle"){var B=this.getBBoxSnapshot();O={top:((E||0)-B.height)/2}}else O=o==="bottom"?{bottom:v&&v.bottom||0}:{top:v&&v.top||0};return rh(rh({},P),O)}},{key:"render",value:function(){var n=this,l=this.props,h=l.content,f=l.width,o=l.height,v=l.wrapperStyle,b=l.payloadUniqBy,E=l.payload,P=rh(rh({position:"absolute",width:f||"auto",height:o||"auto"},this.getDefaultPosition(v)),v);return ze.createElement("div",{className:"recharts-legend-wrapper",style:P,ref:function(L){n.wrapperNode=L}},lke(h,rh(rh({},this.props),{},{payload:uQ(E,b,ake)})))}}],[{key:"getWithHeight",value:function(n,l){var h=rh(rh({},this.defaultProps),n.props),f=h.layout;return f==="vertical"&&pr(n.props.height)?{height:n.props.height}:f==="horizontal"?{width:n.props.width||l}:null}}])}(K.PureComponent);FP(e_,"displayName","Legend");FP(e_,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var x6=e1,cke=r3,uke=qa,b6=x6?x6.isConcatSpreadable:void 0;function hke(e){return uke(e)||cke(e)||!!(b6&&e&&e[b6])}var dke=hke,fke=JJ,pke=dke;function fQ(e,t,r,n,l){var h=-1,f=e.length;for(r||(r=pke),l||(l=[]);++h<f;){var o=e[h];t>0&&r(o)?t>1?fQ(o,t-1,r,n,l):fke(l,o):n||(l[l.length]=o)}return l}var pQ=fQ;function mke(e){return function(t,r,n){for(var l=-1,h=Object(t),f=n(t),o=f.length;o--;){var v=f[e?o:++l];if(r(h[v],v,h)===!1)break}return t}}var gke=mke,yke=gke,_ke=yke(),vke=_ke,xke=vke,bke=zP;function wke(e,t){return e&&xke(e,t,bke)}var mQ=wke,Ske=n1;function Tke(e,t){return function(r,n){if(r==null)return r;if(!Ske(r))return e(r,n);for(var l=r.length,h=t?l:-1,f=Object(r);(t?h--:++h<l)&&n(f[h],h,f)!==!1;);return r}}var Eke=Tke,Ake=mQ,Pke=Eke,Cke=Pke(Ake),s3=Cke,Ike=s3,Mke=n1;function Oke(e,t){var r=-1,n=Mke(e)?Array(e.length):[];return Ike(e,function(l,h,f){n[++r]=t(l,h,f)}),n}var gQ=Oke;function kke(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var Rke=kke,w6=hv;function Dke(e,t){if(e!==t){var r=e!==void 0,n=e===null,l=e===e,h=w6(e),f=t!==void 0,o=t===null,v=t===t,b=w6(t);if(!o&&!b&&!h&&e>t||h&&f&&v&&!o&&!b||n&&f&&v||!r&&v||!l)return 1;if(!n&&!h&&!b&&e<t||b&&r&&l&&!n&&!h||o&&r&&l||!f&&l||!v)return-1}return 0}var Lke=Dke,jke=Lke;function Nke(e,t,r){for(var n=-1,l=e.criteria,h=t.criteria,f=l.length,o=r.length;++n<f;){var v=jke(l[n],h[n]);if(v){if(n>=o)return v;var b=r[n];return v*(b=="desc"?-1:1)}}return e.index-t.index}var zke=Nke,EO=GN,Fke=HN,Bke=Mu,$ke=gQ,Vke=Rke,Uke=tQ,Gke=zke,Hke=_v,Wke=qa;function qke(e,t,r){t.length?t=EO(t,function(h){return Wke(h)?function(f){return Fke(f,h.length===1?h[0]:h)}:h}):t=[Hke];var n=-1;t=EO(t,Uke(Bke));var l=$ke(e,function(h,f,o){var v=EO(t,function(b){return b(h)});return{criteria:v,index:++n,value:h}});return Vke(l,function(h,f){return Gke(h,f,r)})}var Zke=qke;function Xke(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var Kke=Xke,Yke=Kke,S6=Math.max;function Jke(e,t,r){return t=S6(t===void 0?e.length-1:t,0),function(){for(var n=arguments,l=-1,h=S6(n.length-t,0),f=Array(h);++l<h;)f[l]=n[t+l];l=-1;for(var o=Array(t+1);++l<t;)o[l]=n[l];return o[t]=r(f),Yke(e,this,o)}}var Qke=Jke;function eRe(e){return function(){return e}}var tRe=eRe,rRe=Dm,nRe=function(){try{var e=rRe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),yQ=nRe,iRe=tRe,T6=yQ,oRe=_v,sRe=T6?function(e,t){return T6(e,"toString",{configurable:!0,enumerable:!1,value:iRe(t),writable:!0})}:oRe,aRe=sRe,lRe=800,cRe=16,uRe=Date.now;function hRe(e){var t=0,r=0;return function(){var n=uRe(),l=cRe-(n-r);if(r=n,l>0){if(++t>=lRe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var dRe=hRe,fRe=aRe,pRe=dRe,mRe=pRe(fRe),gRe=mRe,yRe=_v,_Re=Qke,vRe=gRe;function xRe(e,t){return vRe(_Re(e,t,yRe),e+"")}var bRe=xRe,wRe=BN,SRe=n1,TRe=n3,ERe=Pf;function ARe(e,t,r){if(!ERe(r))return!1;var n=typeof t;return(n=="number"?SRe(r)&&TRe(t,r.length):n=="string"&&t in r)?wRe(r[t],e):!1}var BP=ARe,PRe=pQ,CRe=Zke,IRe=bRe,E6=BP,MRe=IRe(function(e,t){if(e==null)return[];var r=t.length;return r>1&&E6(e,t[0],t[1])?t=[]:r>2&&E6(t[0],t[1],t[2])&&(t=[t[0]]),CRe(e,PRe(t,1),[])}),ORe=MRe;const a3=Pi(ORe);function nw(e){"@babel/helpers - typeof";return nw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nw(e)}function fD(){return fD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fD.apply(this,arguments)}function kRe(e,t){return jRe(e)||LRe(e,t)||DRe(e,t)||RRe()}function RRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DRe(e,t){if(e){if(typeof e=="string")return A6(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return A6(e,t)}}function A6(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function LRe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function jRe(e){if(Array.isArray(e))return e}function P6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function AO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?P6(Object(r),!0).forEach(function(n){NRe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P6(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NRe(e,t,r){return t=zRe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zRe(e){var t=FRe(e,"string");return nw(t)=="symbol"?t:t+""}function FRe(e,t){if(nw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(nw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function BRe(e){return Array.isArray(e)&&as(e[0])&&as(e[1])?e.join(" ~ "):e}var $Re=function(t){var r=t.separator,n=r===void 0?" : ":r,l=t.contentStyle,h=l===void 0?{}:l,f=t.itemStyle,o=f===void 0?{}:f,v=t.labelStyle,b=v===void 0?{}:v,E=t.payload,P=t.formatter,O=t.itemSorter,L=t.wrapperClassName,B=t.labelClassName,z=t.label,$=t.labelFormatter,U=t.accessibilityLayer,G=U===void 0?!1:U,Z=function(){if(E&&E.length){var Ke={padding:0,margin:0},Ye=(O?a3(E,O):E).map(function(Le,Qe){if(Le.type==="none")return null;var Je=AO({display:"block",paddingTop:4,paddingBottom:4,color:Le.color||"#000"},o),it=Le.formatter||P||BRe,Ze=Le.value,nt=Le.name,pt=Ze,_t=nt;if(it&&pt!=null&&_t!=null){var It=it(Ze,nt,Le,Qe,E);if(Array.isArray(It)){var sr=kRe(It,2);pt=sr[0],_t=sr[1]}else pt=It}return ze.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(Qe),style:Je},as(_t)?ze.createElement("span",{className:"recharts-tooltip-item-name"},_t):null,as(_t)?ze.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,ze.createElement("span",{className:"recharts-tooltip-item-value"},pt),ze.createElement("span",{className:"recharts-tooltip-item-unit"},Le.unit||""))});return ze.createElement("ul",{className:"recharts-tooltip-item-list",style:Ke},Ye)}return null},ne=AO({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},h),Y=AO({margin:0},b),ee=!ni(z),le=ee?z:"",fe=qn("recharts-default-tooltip",L),Ce=qn("recharts-tooltip-label",B);ee&&$&&E!==void 0&&E!==null&&(le=$(z,E));var Oe=G?{role:"status","aria-live":"assertive"}:{};return ze.createElement("div",fD({className:fe,style:ne},Oe),ze.createElement("p",{className:Ce,style:Y},ze.isValidElement(le)?le:"".concat(le)),Z())};function iw(e){"@babel/helpers - typeof";return iw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iw(e)}function WT(e,t,r){return t=VRe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VRe(e){var t=URe(e,"string");return iw(t)=="symbol"?t:t+""}function URe(e,t){if(iw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(iw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Nx="recharts-tooltip-wrapper",GRe={visibility:"hidden"};function HRe(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return qn(Nx,WT(WT(WT(WT({},"".concat(Nx,"-right"),pr(r)&&t&&pr(t.x)&&r>=t.x),"".concat(Nx,"-left"),pr(r)&&t&&pr(t.x)&&r<t.x),"".concat(Nx,"-bottom"),pr(n)&&t&&pr(t.y)&&n>=t.y),"".concat(Nx,"-top"),pr(n)&&t&&pr(t.y)&&n<t.y))}function C6(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,l=e.offsetTopLeft,h=e.position,f=e.reverseDirection,o=e.tooltipDimension,v=e.viewBox,b=e.viewBoxDimension;if(h&&pr(h[n]))return h[n];var E=r[n]-o-l,P=r[n]+l;if(t[n])return f[n]?E:P;if(f[n]){var O=E,L=v[n];return O<L?Math.max(P,v[n]):Math.max(E,v[n])}var B=P+o,z=v[n]+b;return B>z?Math.max(E,v[n]):Math.max(P,v[n])}function WRe(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function qRe(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,l=e.position,h=e.reverseDirection,f=e.tooltipBox,o=e.useTranslate3d,v=e.viewBox,b,E,P;return f.height>0&&f.width>0&&r?(E=C6({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:l,reverseDirection:h,tooltipDimension:f.width,viewBox:v,viewBoxDimension:v.width}),P=C6({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:l,reverseDirection:h,tooltipDimension:f.height,viewBox:v,viewBoxDimension:v.height}),b=WRe({translateX:E,translateY:P,useTranslate3d:o})):b=GRe,{cssProperties:b,cssClasses:HRe({translateX:E,translateY:P,coordinate:r})}}function C_(e){"@babel/helpers - typeof";return C_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C_(e)}function I6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function M6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?I6(Object(r),!0).forEach(function(n){mD(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I6(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XRe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vQ(n.key),n)}}function KRe(e,t,r){return t&&XRe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function YRe(e,t,r){return t=C2(t),JRe(e,_Q()?Reflect.construct(t,r||[],C2(e).constructor):t.apply(e,r))}function JRe(e,t){if(t&&(C_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QRe(e)}function QRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _Q(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_Q=function(){return!!e})()}function C2(e){return C2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},C2(e)}function eDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pD(e,t)}function pD(e,t){return pD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},pD(e,t)}function mD(e,t,r){return t=vQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vQ(e){var t=tDe(e,"string");return C_(t)=="symbol"?t:t+""}function tDe(e,t){if(C_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(C_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var O6=1,rDe=function(e){function t(){var r;ZRe(this,t);for(var n=arguments.length,l=new Array(n),h=0;h<n;h++)l[h]=arguments[h];return r=YRe(this,t,[].concat(l)),mD(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),mD(r,"handleKeyDown",function(f){if(f.key==="Escape"){var o,v,b,E;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(o=(v=r.props.coordinate)===null||v===void 0?void 0:v.x)!==null&&o!==void 0?o:0,y:(b=(E=r.props.coordinate)===null||E===void 0?void 0:E.y)!==null&&b!==void 0?b:0}})}}),r}return eDe(t,e),KRe(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>O6||Math.abs(n.height-this.state.lastBoundingBox.height)>O6)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,l;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((l=this.props.coordinate)===null||l===void 0?void 0:l.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,l=this.props,h=l.active,f=l.allowEscapeViewBox,o=l.animationDuration,v=l.animationEasing,b=l.children,E=l.coordinate,P=l.hasPayload,O=l.isAnimationActive,L=l.offset,B=l.position,z=l.reverseDirection,$=l.useTranslate3d,U=l.viewBox,G=l.wrapperStyle,Z=qRe({allowEscapeViewBox:f,coordinate:E,offsetTopLeft:L,position:B,reverseDirection:z,tooltipBox:this.state.lastBoundingBox,useTranslate3d:$,viewBox:U}),ne=Z.cssClasses,Y=Z.cssProperties,ee=M6(M6({transition:O&&h?"transform ".concat(o,"ms ").concat(v):void 0},Y),{},{pointerEvents:"none",visibility:!this.state.dismissed&&h&&P?"visible":"hidden",position:"absolute",top:0,left:0},G);return ze.createElement("div",{tabIndex:-1,className:ne,style:ee,ref:function(fe){n.wrapperNode=fe}},b)}}])}(K.PureComponent),nDe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},vv={isSsr:nDe()};function I_(e){"@babel/helpers - typeof";return I_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I_(e)}function k6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function R6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k6(Object(r),!0).forEach(function(n){l3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k6(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oDe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,bQ(n.key),n)}}function sDe(e,t,r){return t&&oDe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function aDe(e,t,r){return t=I2(t),lDe(e,xQ()?Reflect.construct(t,r||[],I2(e).constructor):t.apply(e,r))}function lDe(e,t){if(t&&(I_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cDe(e)}function cDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xQ=function(){return!!e})()}function I2(e){return I2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},I2(e)}function uDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gD(e,t)}function gD(e,t){return gD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},gD(e,t)}function l3(e,t,r){return t=bQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bQ(e){var t=hDe(e,"string");return I_(t)=="symbol"?t:t+""}function hDe(e,t){if(I_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(I_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function dDe(e){return e.dataKey}function fDe(e,t){return ze.isValidElement(e)?ze.cloneElement(e,t):typeof e=="function"?ze.createElement(e,t):ze.createElement($Re,t)}var ja=function(e){function t(){return iDe(this,t),aDe(this,t,arguments)}return uDe(t,e),sDe(t,[{key:"render",value:function(){var n=this,l=this.props,h=l.active,f=l.allowEscapeViewBox,o=l.animationDuration,v=l.animationEasing,b=l.content,E=l.coordinate,P=l.filterNull,O=l.isAnimationActive,L=l.offset,B=l.payload,z=l.payloadUniqBy,$=l.position,U=l.reverseDirection,G=l.useTranslate3d,Z=l.viewBox,ne=l.wrapperStyle,Y=B??[];P&&Y.length&&(Y=uQ(B.filter(function(le){return le.value!=null&&(le.hide!==!0||n.props.includeHidden)}),z,dDe));var ee=Y.length>0;return ze.createElement(rDe,{allowEscapeViewBox:f,animationDuration:o,animationEasing:v,isAnimationActive:O,active:h,coordinate:E,hasPayload:ee,offset:L,position:$,reverseDirection:U,useTranslate3d:G,viewBox:Z,wrapperStyle:ne},fDe(b,R6(R6({},this.props),{},{payload:Y})))}}])}(K.PureComponent);l3(ja,"displayName","Tooltip");l3(ja,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!vv.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var pDe=Iu,mDe=function(){return pDe.Date.now()},gDe=mDe,yDe=/\s/;function _De(e){for(var t=e.length;t--&&yDe.test(e.charAt(t)););return t}var vDe=_De,xDe=vDe,bDe=/^\s+/;function wDe(e){return e&&e.slice(0,xDe(e)+1).replace(bDe,"")}var SDe=wDe,TDe=SDe,D6=Pf,EDe=hv,L6=NaN,ADe=/^[-+]0x[0-9a-f]+$/i,PDe=/^0b[01]+$/i,CDe=/^0o[0-7]+$/i,IDe=parseInt;function MDe(e){if(typeof e=="number")return e;if(EDe(e))return L6;if(D6(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=D6(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=TDe(e);var r=PDe.test(e);return r||CDe.test(e)?IDe(e.slice(2),r?2:8):ADe.test(e)?L6:+e}var wQ=MDe,ODe=Pf,PO=gDe,j6=wQ,kDe="Expected a function",RDe=Math.max,DDe=Math.min;function LDe(e,t,r){var n,l,h,f,o,v,b=0,E=!1,P=!1,O=!0;if(typeof e!="function")throw new TypeError(kDe);t=j6(t)||0,ODe(r)&&(E=!!r.leading,P="maxWait"in r,h=P?RDe(j6(r.maxWait)||0,t):h,O="trailing"in r?!!r.trailing:O);function L(ee){var le=n,fe=l;return n=l=void 0,b=ee,f=e.apply(fe,le),f}function B(ee){return b=ee,o=setTimeout(U,t),E?L(ee):f}function z(ee){var le=ee-v,fe=ee-b,Ce=t-le;return P?DDe(Ce,h-fe):Ce}function $(ee){var le=ee-v,fe=ee-b;return v===void 0||le>=t||le<0||P&&fe>=h}function U(){var ee=PO();if($(ee))return G(ee);o=setTimeout(U,z(ee))}function G(ee){return o=void 0,O&&n?L(ee):(n=l=void 0,f)}function Z(){o!==void 0&&clearTimeout(o),b=0,n=v=l=o=void 0}function ne(){return o===void 0?f:G(PO())}function Y(){var ee=PO(),le=$(ee);if(n=arguments,l=this,v=ee,le){if(o===void 0)return B(v);if(P)return clearTimeout(o),o=setTimeout(U,t),L(v)}return o===void 0&&(o=setTimeout(U,t)),f}return Y.cancel=Z,Y.flush=ne,Y}var jDe=LDe,NDe=jDe,zDe=Pf,FDe="Expected a function";function BDe(e,t,r){var n=!0,l=!0;if(typeof e!="function")throw new TypeError(FDe);return zDe(r)&&(n="leading"in r?!!r.leading:n,l="trailing"in r?!!r.trailing:l),NDe(e,t,{leading:n,maxWait:t,trailing:l})}var $De=BDe;const SQ=Pi($De);function ow(e){"@babel/helpers - typeof";return ow=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ow(e)}function N6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function qT(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N6(Object(r),!0).forEach(function(n){VDe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N6(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VDe(e,t,r){return t=UDe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UDe(e){var t=GDe(e,"string");return ow(t)=="symbol"?t:t+""}function GDe(e,t){if(ow(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ow(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HDe(e,t){return XDe(e)||ZDe(e,t)||qDe(e,t)||WDe()}function WDe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qDe(e,t){if(e){if(typeof e=="string")return z6(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z6(e,t)}}function z6(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ZDe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function XDe(e){if(Array.isArray(e))return e}var xb=K.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,l=n===void 0?{width:-1,height:-1}:n,h=e.width,f=h===void 0?"100%":h,o=e.height,v=o===void 0?"100%":o,b=e.minWidth,E=b===void 0?0:b,P=e.minHeight,O=e.maxHeight,L=e.children,B=e.debounce,z=B===void 0?0:B,$=e.id,U=e.className,G=e.onResize,Z=e.style,ne=Z===void 0?{}:Z,Y=K.useRef(null),ee=K.useRef();ee.current=G,K.useImperativeHandle(t,function(){return Object.defineProperty(Y.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),Y.current},configurable:!0})});var le=K.useState({containerWidth:l.width,containerHeight:l.height}),fe=HDe(le,2),Ce=fe[0],Oe=fe[1],Me=K.useCallback(function(Ye,Le){Oe(function(Qe){var Je=Math.round(Ye),it=Math.round(Le);return Qe.containerWidth===Je&&Qe.containerHeight===it?Qe:{containerWidth:Je,containerHeight:it}})},[]);K.useEffect(function(){var Ye=function(nt){var pt,_t=nt[0].contentRect,It=_t.width,sr=_t.height;Me(It,sr),(pt=ee.current)===null||pt===void 0||pt.call(ee,It,sr)};z>0&&(Ye=SQ(Ye,z,{trailing:!0,leading:!1}));var Le=new ResizeObserver(Ye),Qe=Y.current.getBoundingClientRect(),Je=Qe.width,it=Qe.height;return Me(Je,it),Le.observe(Y.current),function(){Le.disconnect()}},[Me,z]);var Ke=K.useMemo(function(){var Ye=Ce.containerWidth,Le=Ce.containerHeight;if(Ye<0||Le<0)return null;bc(Xp(f)||Xp(v),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,f,v),bc(!r||r>0,"The aspect(%s) must be greater than zero.",r);var Qe=Xp(f)?Ye:f,Je=Xp(v)?Le:v;r&&r>0&&(Qe?Je=Qe/r:Je&&(Qe=Je*r),O&&Je>O&&(Je=O)),bc(Qe>0||Je>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,Qe,Je,f,v,E,P,r);var it=!Array.isArray(L)&&yh(L.type).endsWith("Chart");return ze.Children.map(L,function(Ze){return ze.isValidElement(Ze)?K.cloneElement(Ze,qT({width:Qe,height:Je},it?{style:qT({height:"100%",width:"100%",maxHeight:Je,maxWidth:Qe},Ze.props.style)}:{})):Ze})},[r,L,v,O,P,E,Ce,f]);return ze.createElement("div",{id:$?"".concat($):void 0,className:qn("recharts-responsive-container",U),style:qT(qT({},ne),{},{width:f,height:v,minWidth:E,minHeight:P,maxHeight:O}),ref:Y},Ke)}),i1=function(t){return null};i1.displayName="Cell";function sw(e){"@babel/helpers - typeof";return sw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sw(e)}function F6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function yD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F6(Object(r),!0).forEach(function(n){KDe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F6(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KDe(e,t,r){return t=YDe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YDe(e){var t=JDe(e,"string");return sw(t)=="symbol"?t:t+""}function JDe(e,t){if(sw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(sw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fy={widthCache:{},cacheCount:0},QDe=2e3,eLe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},B6="recharts_measurement_span";function tLe(e){var t=yD({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var bb=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||vv.isSsr)return{width:0,height:0};var n=tLe(r),l=JSON.stringify({text:t,copyStyle:n});if(fy.widthCache[l])return fy.widthCache[l];try{var h=document.getElementById(B6);h||(h=document.createElement("span"),h.setAttribute("id",B6),h.setAttribute("aria-hidden","true"),document.body.appendChild(h));var f=yD(yD({},eLe),n);Object.assign(h.style,f),h.textContent="".concat(t);var o=h.getBoundingClientRect(),v={width:o.width,height:o.height};return fy.widthCache[l]=v,++fy.cacheCount>QDe&&(fy.cacheCount=0,fy.widthCache={}),v}catch{return{width:0,height:0}}},rLe=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function aw(e){"@babel/helpers - typeof";return aw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aw(e)}function M2(e,t){return sLe(e)||oLe(e,t)||iLe(e,t)||nLe()}function nLe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iLe(e,t){if(e){if(typeof e=="string")return $6(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $6(e,t)}}function $6(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function oLe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;v=!1}else for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function sLe(e){if(Array.isArray(e))return e}function aLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V6(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cLe(n.key),n)}}function lLe(e,t,r){return t&&V6(e.prototype,t),r&&V6(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function cLe(e){var t=uLe(e,"string");return aw(t)=="symbol"?t:t+""}function uLe(e,t){if(aw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(aw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var U6=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,G6=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,hLe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,dLe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,TQ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},fLe=Object.keys(TQ),Ly="NaN";function pLe(e,t){return e*TQ[t]}var ZT=function(){function e(t,r){aLe(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!hLe.test(r)&&(this.num=NaN,this.unit=""),fLe.includes(r)&&(this.num=pLe(t,r),this.unit="px")}return lLe(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,l=(n=dLe.exec(r))!==null&&n!==void 0?n:[],h=M2(l,3),f=h[1],o=h[2];return new e(parseFloat(f),o??"")}}])}();function EQ(e){if(e.includes(Ly))return Ly;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=U6.exec(t))!==null&&r!==void 0?r:[],l=M2(n,4),h=l[1],f=l[2],o=l[3],v=ZT.parse(h??""),b=ZT.parse(o??""),E=f==="*"?v.multiply(b):v.divide(b);if(E.isNaN())return Ly;t=t.replace(U6,E.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var P,O=(P=G6.exec(t))!==null&&P!==void 0?P:[],L=M2(O,4),B=L[1],z=L[2],$=L[3],U=ZT.parse(B??""),G=ZT.parse($??""),Z=z==="+"?U.add(G):U.subtract(G);if(Z.isNaN())return Ly;t=t.replace(G6,Z.toString())}return t}var H6=/\(([^()]*)\)/;function mLe(e){for(var t=e;t.includes("(");){var r=H6.exec(t),n=M2(r,2),l=n[1];t=t.replace(H6,EQ(l))}return t}function gLe(e){var t=e.replace(/\s+/g,"");return t=mLe(t),t=EQ(t),t}function yLe(e){try{return gLe(e)}catch{return Ly}}function CO(e){var t=yLe(e.slice(5,-1));return t===Ly?"":t}var _Le=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],vLe=["dx","dy","angle","className","breakAll"];function _D(){return _D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_D.apply(this,arguments)}function W6(e,t){if(e==null)return{};var r=xLe(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function q6(e,t){return TLe(e)||SLe(e,t)||wLe(e,t)||bLe()}function bLe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wLe(e,t){if(e){if(typeof e=="string")return Z6(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Z6(e,t)}}function Z6(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function SLe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;v=!1}else for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function TLe(e){if(Array.isArray(e))return e}var AQ=/[ \f\n\r\t\v\u2028\u2029]+/,PQ=function(t){var r=t.children,n=t.breakAll,l=t.style;try{var h=[];ni(r)||(n?h=r.toString().split(""):h=r.toString().split(AQ));var f=h.map(function(v){return{word:v,width:bb(v,l).width}}),o=n?0:bb(" ",l).width;return{wordsWithComputedWidth:f,spaceWidth:o}}catch{return null}},ELe=function(t,r,n,l,h){var f=t.maxLines,o=t.children,v=t.style,b=t.breakAll,E=pr(f),P=o,O=function(){var Qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Qe.reduce(function(Je,it){var Ze=it.word,nt=it.width,pt=Je[Je.length-1];if(pt&&(l==null||h||pt.width+nt+n<Number(l)))pt.words.push(Ze),pt.width+=nt+n;else{var _t={words:[Ze],width:nt};Je.push(_t)}return Je},[])},L=O(r),B=function(Qe){return Qe.reduce(function(Je,it){return Je.width>it.width?Je:it})};if(!E)return L;for(var z="…",$=function(Qe){var Je=P.slice(0,Qe),it=PQ({breakAll:b,style:v,children:Je+z}).wordsWithComputedWidth,Ze=O(it),nt=Ze.length>f||B(Ze).width>Number(l);return[nt,Ze]},U=0,G=P.length-1,Z=0,ne;U<=G&&Z<=P.length-1;){var Y=Math.floor((U+G)/2),ee=Y-1,le=$(ee),fe=q6(le,2),Ce=fe[0],Oe=fe[1],Me=$(Y),Ke=q6(Me,1),Ye=Ke[0];if(!Ce&&!Ye&&(U=Y+1),Ce&&Ye&&(G=Y-1),!Ce&&Ye){ne=Oe;break}Z++}return ne||L},X6=function(t){var r=ni(t)?[]:t.toString().split(AQ);return[{words:r}]},ALe=function(t){var r=t.width,n=t.scaleToFit,l=t.children,h=t.style,f=t.breakAll,o=t.maxLines;if((r||n)&&!vv.isSsr){var v,b,E=PQ({breakAll:f,children:l,style:h});if(E){var P=E.wordsWithComputedWidth,O=E.spaceWidth;v=P,b=O}else return X6(l);return ELe({breakAll:f,children:l,maxLines:o,style:h},v,b,r,n)}return X6(l)},K6="#808080",Tm=function(t){var r=t.x,n=r===void 0?0:r,l=t.y,h=l===void 0?0:l,f=t.lineHeight,o=f===void 0?"1em":f,v=t.capHeight,b=v===void 0?"0.71em":v,E=t.scaleToFit,P=E===void 0?!1:E,O=t.textAnchor,L=O===void 0?"start":O,B=t.verticalAnchor,z=B===void 0?"end":B,$=t.fill,U=$===void 0?K6:$,G=W6(t,_Le),Z=K.useMemo(function(){return ALe({breakAll:G.breakAll,children:G.children,maxLines:G.maxLines,scaleToFit:P,style:G.style,width:G.width})},[G.breakAll,G.children,G.maxLines,P,G.style,G.width]),ne=G.dx,Y=G.dy,ee=G.angle,le=G.className,fe=G.breakAll,Ce=W6(G,vLe);if(!as(n)||!as(h))return null;var Oe=n+(pr(ne)?ne:0),Me=h+(pr(Y)?Y:0),Ke;switch(z){case"start":Ke=CO("calc(".concat(b,")"));break;case"middle":Ke=CO("calc(".concat((Z.length-1)/2," * -").concat(o," + (").concat(b," / 2))"));break;default:Ke=CO("calc(".concat(Z.length-1," * -").concat(o,")"));break}var Ye=[];if(P){var Le=Z[0].width,Qe=G.width;Ye.push("scale(".concat((pr(Qe)?Qe/Le:1)/Le,")"))}return ee&&Ye.push("rotate(".concat(ee,", ").concat(Oe,", ").concat(Me,")")),Ye.length&&(Ce.transform=Ye.join(" ")),ze.createElement("text",_D({},wn(Ce,!0),{x:Oe,y:Me,className:qn("recharts-text",le),textAnchor:L,fill:U.includes("url")?K6:U}),Z.map(function(Je,it){var Ze=Je.words.join(fe?"":" ");return ze.createElement("tspan",{x:Oe,dy:it===0?Ke:o,key:"".concat(Ze,"-").concat(it)},Ze)}))};function ff(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function PLe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function CQ(e){let t,r,n;e.length!==2?(t=ff,r=(o,v)=>ff(e(o),v),n=(o,v)=>e(o)-v):(t=e===ff||e===PLe?e:CLe,r=e,n=e);function l(o,v,b=0,E=o.length){if(b<E){if(t(v,v)!==0)return E;do{const P=b+E>>>1;r(o[P],v)<0?b=P+1:E=P}while(b<E)}return b}function h(o,v,b=0,E=o.length){if(b<E){if(t(v,v)!==0)return E;do{const P=b+E>>>1;r(o[P],v)<=0?b=P+1:E=P}while(b<E)}return b}function f(o,v,b=0,E=o.length){const P=l(o,v,b,E-1);return P>b&&n(o[P-1],v)>-n(o[P],v)?P-1:P}return{left:l,center:f,right:h}}function CLe(){return 0}function IQ(e){return e===null?NaN:+e}function*ILe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const MLe=CQ(ff),o1=MLe.right;CQ(IQ).center;class Y6 extends Map{constructor(t,r=RLe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,l]of t)this.set(n,l)}get(t){return super.get(J6(this,t))}has(t){return super.has(J6(this,t))}set(t,r){return super.set(OLe(this,t),r)}delete(t){return super.delete(kLe(this,t))}}function J6({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function OLe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function kLe({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function RLe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function DLe(e=ff){if(e===ff)return MQ;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function MQ(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const LLe=Math.sqrt(50),jLe=Math.sqrt(10),NLe=Math.sqrt(2);function O2(e,t,r){const n=(t-e)/Math.max(0,r),l=Math.floor(Math.log10(n)),h=n/Math.pow(10,l),f=h>=LLe?10:h>=jLe?5:h>=NLe?2:1;let o,v,b;return l<0?(b=Math.pow(10,-l)/f,o=Math.round(e*b),v=Math.round(t*b),o/b<e&&++o,v/b>t&&--v,b=-b):(b=Math.pow(10,l)*f,o=Math.round(e/b),v=Math.round(t/b),o*b<e&&++o,v*b>t&&--v),v<o&&.5<=r&&r<2?O2(e,t,r*2):[o,v,b]}function vD(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[l,h,f]=n?O2(t,e,r):O2(e,t,r);if(!(h>=l))return[];const o=h-l+1,v=new Array(o);if(n)if(f<0)for(let b=0;b<o;++b)v[b]=(h-b)/-f;else for(let b=0;b<o;++b)v[b]=(h-b)*f;else if(f<0)for(let b=0;b<o;++b)v[b]=(l+b)/-f;else for(let b=0;b<o;++b)v[b]=(l+b)*f;return v}function xD(e,t,r){return t=+t,e=+e,r=+r,O2(e,t,r)[2]}function zLe(e,t,r){t=+t,e=+e,r=+r;const n=t<e,l=n?xD(t,e,r):xD(e,t,r);return(n?-1:1)*(l<0?1/-l:l)}function Q6(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function e8(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function OQ(e,t,r=0,n=1/0,l){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(l=l===void 0?MQ:DLe(l);n>r;){if(n-r>600){const v=n-r+1,b=t-r+1,E=Math.log(v),P=.5*Math.exp(2*E/3),O=.5*Math.sqrt(E*P*(v-P)/v)*(b-v/2<0?-1:1),L=Math.max(r,Math.floor(t-b*P/v+O)),B=Math.min(n,Math.floor(t+(v-b)*P/v+O));OQ(e,t,L,B,l)}const h=e[t];let f=r,o=n;for(zx(e,r,t),l(e[n],h)>0&&zx(e,r,n);f<o;){for(zx(e,f,o),++f,--o;l(e[f],h)<0;)++f;for(;l(e[o],h)>0;)--o}l(e[r],h)===0?zx(e,r,o):(++o,zx(e,o,n)),o<=t&&(r=o+1),t<=o&&(n=o-1)}return e}function zx(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function FLe(e,t,r){if(e=Float64Array.from(ILe(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return e8(e);if(t>=1)return Q6(e);var n,l=(n-1)*t,h=Math.floor(l),f=Q6(OQ(e,h).subarray(0,h+1)),o=e8(e.subarray(h+1));return f+(o-f)*(l-h)}}function BLe(e,t,r=IQ){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,l=(n-1)*t,h=Math.floor(l),f=+r(e[h],h,e),o=+r(e[h+1],h+1,e);return f+(o-f)*(l-h)}}function $Le(e,t,r){e=+e,t=+t,r=(l=arguments.length)<2?(t=e,e=0,1):l<3?1:+r;for(var n=-1,l=Math.max(0,Math.ceil((t-e)/r))|0,h=new Array(l);++n<l;)h[n]=e+n*r;return h}function Hl(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Nh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const bD=Symbol("implicit");function c3(){var e=new Y6,t=[],r=[],n=bD;function l(h){let f=e.get(h);if(f===void 0){if(n!==bD)return n;e.set(h,f=t.push(h)-1)}return r[f%r.length]}return l.domain=function(h){if(!arguments.length)return t.slice();t=[],e=new Y6;for(const f of h)e.has(f)||e.set(f,t.push(f)-1);return l},l.range=function(h){return arguments.length?(r=Array.from(h),l):r.slice()},l.unknown=function(h){return arguments.length?(n=h,l):n},l.copy=function(){return c3(t,r).unknown(n)},Hl.apply(l,arguments),l}function lw(){var e=c3().unknown(void 0),t=e.domain,r=e.range,n=0,l=1,h,f,o=!1,v=0,b=0,E=.5;delete e.unknown;function P(){var O=t().length,L=l<n,B=L?l:n,z=L?n:l;h=(z-B)/Math.max(1,O-v+b*2),o&&(h=Math.floor(h)),B+=(z-B-h*(O-v))*E,f=h*(1-v),o&&(B=Math.round(B),f=Math.round(f));var $=$Le(O).map(function(U){return B+h*U});return r(L?$.reverse():$)}return e.domain=function(O){return arguments.length?(t(O),P()):t()},e.range=function(O){return arguments.length?([n,l]=O,n=+n,l=+l,P()):[n,l]},e.rangeRound=function(O){return[n,l]=O,n=+n,l=+l,o=!0,P()},e.bandwidth=function(){return f},e.step=function(){return h},e.round=function(O){return arguments.length?(o=!!O,P()):o},e.padding=function(O){return arguments.length?(v=Math.min(1,b=+O),P()):v},e.paddingInner=function(O){return arguments.length?(v=Math.min(1,O),P()):v},e.paddingOuter=function(O){return arguments.length?(b=+O,P()):b},e.align=function(O){return arguments.length?(E=Math.max(0,Math.min(1,O)),P()):E},e.copy=function(){return lw(t(),[n,l]).round(o).paddingInner(v).paddingOuter(b).align(E)},Hl.apply(P(),arguments)}function kQ(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return kQ(t())},e}function wb(){return kQ(lw.apply(null,arguments).paddingInner(1))}function u3(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function RQ(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function s1(){}var cw=.7,k2=1/cw,t_="\\s*([+-]?\\d+)\\s*",uw="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Su="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",VLe=/^#([0-9a-f]{3,8})$/,ULe=new RegExp(`^rgb\\(${t_},${t_},${t_}\\)$`),GLe=new RegExp(`^rgb\\(${Su},${Su},${Su}\\)$`),HLe=new RegExp(`^rgba\\(${t_},${t_},${t_},${uw}\\)$`),WLe=new RegExp(`^rgba\\(${Su},${Su},${Su},${uw}\\)$`),qLe=new RegExp(`^hsl\\(${uw},${Su},${Su}\\)$`),ZLe=new RegExp(`^hsla\\(${uw},${Su},${Su},${uw}\\)$`),t8={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};u3(s1,hw,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:r8,formatHex:r8,formatHex8:XLe,formatHsl:KLe,formatRgb:n8,toString:n8});function r8(){return this.rgb().formatHex()}function XLe(){return this.rgb().formatHex8()}function KLe(){return DQ(this).formatHsl()}function n8(){return this.rgb().formatRgb()}function hw(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=VLe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?i8(t):r===3?new $a(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?XT(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?XT(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=ULe.exec(e))?new $a(t[1],t[2],t[3],1):(t=GLe.exec(e))?new $a(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=HLe.exec(e))?XT(t[1],t[2],t[3],t[4]):(t=WLe.exec(e))?XT(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=qLe.exec(e))?a8(t[1],t[2]/100,t[3]/100,1):(t=ZLe.exec(e))?a8(t[1],t[2]/100,t[3]/100,t[4]):t8.hasOwnProperty(e)?i8(t8[e]):e==="transparent"?new $a(NaN,NaN,NaN,0):null}function i8(e){return new $a(e>>16&255,e>>8&255,e&255,1)}function XT(e,t,r,n){return n<=0&&(e=t=r=NaN),new $a(e,t,r,n)}function YLe(e){return e instanceof s1||(e=hw(e)),e?(e=e.rgb(),new $a(e.r,e.g,e.b,e.opacity)):new $a}function wD(e,t,r,n){return arguments.length===1?YLe(e):new $a(e,t,r,n??1)}function $a(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}u3($a,wD,RQ(s1,{brighter(e){return e=e==null?k2:Math.pow(k2,e),new $a(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?cw:Math.pow(cw,e),new $a(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new $a(cm(this.r),cm(this.g),cm(this.b),R2(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:o8,formatHex:o8,formatHex8:JLe,formatRgb:s8,toString:s8}));function o8(){return`#${Kp(this.r)}${Kp(this.g)}${Kp(this.b)}`}function JLe(){return`#${Kp(this.r)}${Kp(this.g)}${Kp(this.b)}${Kp((isNaN(this.opacity)?1:this.opacity)*255)}`}function s8(){const e=R2(this.opacity);return`${e===1?"rgb(":"rgba("}${cm(this.r)}, ${cm(this.g)}, ${cm(this.b)}${e===1?")":`, ${e})`}`}function R2(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function cm(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Kp(e){return e=cm(e),(e<16?"0":"")+e.toString(16)}function a8(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new _c(e,t,r,n)}function DQ(e){if(e instanceof _c)return new _c(e.h,e.s,e.l,e.opacity);if(e instanceof s1||(e=hw(e)),!e)return new _c;if(e instanceof _c)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,l=Math.min(t,r,n),h=Math.max(t,r,n),f=NaN,o=h-l,v=(h+l)/2;return o?(t===h?f=(r-n)/o+(r<n)*6:r===h?f=(n-t)/o+2:f=(t-r)/o+4,o/=v<.5?h+l:2-h-l,f*=60):o=v>0&&v<1?0:f,new _c(f,o,v,e.opacity)}function QLe(e,t,r,n){return arguments.length===1?DQ(e):new _c(e,t,r,n??1)}function _c(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}u3(_c,QLe,RQ(s1,{brighter(e){return e=e==null?k2:Math.pow(k2,e),new _c(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?cw:Math.pow(cw,e),new _c(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,l=2*r-n;return new $a(IO(e>=240?e-240:e+120,l,n),IO(e,l,n),IO(e<120?e+240:e-120,l,n),this.opacity)},clamp(){return new _c(l8(this.h),KT(this.s),KT(this.l),R2(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=R2(this.opacity);return`${e===1?"hsl(":"hsla("}${l8(this.h)}, ${KT(this.s)*100}%, ${KT(this.l)*100}%${e===1?")":`, ${e})`}`}}));function l8(e){return e=(e||0)%360,e<0?e+360:e}function KT(e){return Math.max(0,Math.min(1,e||0))}function IO(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const h3=e=>()=>e;function eje(e,t){return function(r){return e+r*t}}function tje(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function rje(e){return(e=+e)==1?LQ:function(t,r){return r-t?tje(t,r,e):h3(isNaN(t)?r:t)}}function LQ(e,t){var r=t-e;return r?eje(e,r):h3(isNaN(e)?t:e)}const c8=function e(t){var r=rje(t);function n(l,h){var f=r((l=wD(l)).r,(h=wD(h)).r),o=r(l.g,h.g),v=r(l.b,h.b),b=LQ(l.opacity,h.opacity);return function(E){return l.r=f(E),l.g=o(E),l.b=v(E),l.opacity=b(E),l+""}}return n.gamma=e,n}(1);function nje(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),l;return function(h){for(l=0;l<r;++l)n[l]=e[l]*(1-h)+t[l]*h;return n}}function ije(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function oje(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,l=new Array(n),h=new Array(r),f;for(f=0;f<n;++f)l[f]=xv(e[f],t[f]);for(;f<r;++f)h[f]=t[f];return function(o){for(f=0;f<n;++f)h[f]=l[f](o);return h}}function sje(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function D2(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function aje(e,t){var r={},n={},l;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(l in t)l in e?r[l]=xv(e[l],t[l]):n[l]=t[l];return function(h){for(l in r)n[l]=r[l](h);return n}}var SD=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,MO=new RegExp(SD.source,"g");function lje(e){return function(){return e}}function cje(e){return function(t){return e(t)+""}}function uje(e,t){var r=SD.lastIndex=MO.lastIndex=0,n,l,h,f=-1,o=[],v=[];for(e=e+"",t=t+"";(n=SD.exec(e))&&(l=MO.exec(t));)(h=l.index)>r&&(h=t.slice(r,h),o[f]?o[f]+=h:o[++f]=h),(n=n[0])===(l=l[0])?o[f]?o[f]+=l:o[++f]=l:(o[++f]=null,v.push({i:f,x:D2(n,l)})),r=MO.lastIndex;return r<t.length&&(h=t.slice(r),o[f]?o[f]+=h:o[++f]=h),o.length<2?v[0]?cje(v[0].x):lje(t):(t=v.length,function(b){for(var E=0,P;E<t;++E)o[(P=v[E]).i]=P.x(b);return o.join("")})}function xv(e,t){var r=typeof t,n;return t==null||r==="boolean"?h3(t):(r==="number"?D2:r==="string"?(n=hw(t))?(t=n,c8):uje:t instanceof hw?c8:t instanceof Date?sje:ije(t)?nje:Array.isArray(t)?oje:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?aje:D2)(e,t)}function d3(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function hje(e,t){t===void 0&&(t=e,e=xv);for(var r=0,n=t.length-1,l=t[0],h=new Array(n<0?0:n);r<n;)h[r]=e(l,l=t[++r]);return function(f){var o=Math.max(0,Math.min(n-1,Math.floor(f*=n)));return h[o](f-o)}}function dje(e){return function(){return e}}function L2(e){return+e}var u8=[0,1];function va(e){return e}function TD(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:dje(isNaN(t)?NaN:.5)}function fje(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function pje(e,t,r){var n=e[0],l=e[1],h=t[0],f=t[1];return l<n?(n=TD(l,n),h=r(f,h)):(n=TD(n,l),h=r(h,f)),function(o){return h(n(o))}}function mje(e,t,r){var n=Math.min(e.length,t.length)-1,l=new Array(n),h=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++f<n;)l[f]=TD(e[f],e[f+1]),h[f]=r(t[f],t[f+1]);return function(o){var v=o1(e,o,1,n)-1;return h[v](l[v](o))}}function a1(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function $P(){var e=u8,t=u8,r=xv,n,l,h,f=va,o,v,b;function E(){var O=Math.min(e.length,t.length);return f!==va&&(f=fje(e[0],e[O-1])),o=O>2?mje:pje,v=b=null,P}function P(O){return O==null||isNaN(O=+O)?h:(v||(v=o(e.map(n),t,r)))(n(f(O)))}return P.invert=function(O){return f(l((b||(b=o(t,e.map(n),D2)))(O)))},P.domain=function(O){return arguments.length?(e=Array.from(O,L2),E()):e.slice()},P.range=function(O){return arguments.length?(t=Array.from(O),E()):t.slice()},P.rangeRound=function(O){return t=Array.from(O),r=d3,E()},P.clamp=function(O){return arguments.length?(f=O?!0:va,E()):f!==va},P.interpolate=function(O){return arguments.length?(r=O,E()):r},P.unknown=function(O){return arguments.length?(h=O,P):h},function(O,L){return n=O,l=L,E()}}function f3(){return $P()(va,va)}function gje(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function j2(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function M_(e){return e=j2(Math.abs(e)),e?e[1]:NaN}function yje(e,t){return function(r,n){for(var l=r.length,h=[],f=0,o=e[0],v=0;l>0&&o>0&&(v+o+1>n&&(o=Math.max(1,n-v)),h.push(r.substring(l-=o,l+o)),!((v+=o+1)>n));)o=e[f=(f+1)%e.length];return h.reverse().join(t)}}function _je(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var vje=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function dw(e){if(!(t=vje.exec(e)))throw new Error("invalid format: "+e);var t;return new p3({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}dw.prototype=p3.prototype;function p3(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}p3.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function xje(e){e:for(var t=e.length,r=1,n=-1,l;r<t;++r)switch(e[r]){case".":n=l=r;break;case"0":n===0&&(n=r),l=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(l+1):e}var jQ;function bje(e,t){var r=j2(e,t);if(!r)return e+"";var n=r[0],l=r[1],h=l-(jQ=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,f=n.length;return h===f?n:h>f?n+new Array(h-f+1).join("0"):h>0?n.slice(0,h)+"."+n.slice(h):"0."+new Array(1-h).join("0")+j2(e,Math.max(0,t+h-1))[0]}function h8(e,t){var r=j2(e,t);if(!r)return e+"";var n=r[0],l=r[1];return l<0?"0."+new Array(-l).join("0")+n:n.length>l+1?n.slice(0,l+1)+"."+n.slice(l+1):n+new Array(l-n.length+2).join("0")}const d8={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:gje,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>h8(e*100,t),r:h8,s:bje,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function f8(e){return e}var p8=Array.prototype.map,m8=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function wje(e){var t=e.grouping===void 0||e.thousands===void 0?f8:yje(p8.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",l=e.decimal===void 0?".":e.decimal+"",h=e.numerals===void 0?f8:_je(p8.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",o=e.minus===void 0?"−":e.minus+"",v=e.nan===void 0?"NaN":e.nan+"";function b(P){P=dw(P);var O=P.fill,L=P.align,B=P.sign,z=P.symbol,$=P.zero,U=P.width,G=P.comma,Z=P.precision,ne=P.trim,Y=P.type;Y==="n"?(G=!0,Y="g"):d8[Y]||(Z===void 0&&(Z=12),ne=!0,Y="g"),($||O==="0"&&L==="=")&&($=!0,O="0",L="=");var ee=z==="$"?r:z==="#"&&/[boxX]/.test(Y)?"0"+Y.toLowerCase():"",le=z==="$"?n:/[%p]/.test(Y)?f:"",fe=d8[Y],Ce=/[defgprs%]/.test(Y);Z=Z===void 0?6:/[gprs]/.test(Y)?Math.max(1,Math.min(21,Z)):Math.max(0,Math.min(20,Z));function Oe(Me){var Ke=ee,Ye=le,Le,Qe,Je;if(Y==="c")Ye=fe(Me)+Ye,Me="";else{Me=+Me;var it=Me<0||1/Me<0;if(Me=isNaN(Me)?v:fe(Math.abs(Me),Z),ne&&(Me=xje(Me)),it&&+Me==0&&B!=="+"&&(it=!1),Ke=(it?B==="("?B:o:B==="-"||B==="("?"":B)+Ke,Ye=(Y==="s"?m8[8+jQ/3]:"")+Ye+(it&&B==="("?")":""),Ce){for(Le=-1,Qe=Me.length;++Le<Qe;)if(Je=Me.charCodeAt(Le),48>Je||Je>57){Ye=(Je===46?l+Me.slice(Le+1):Me.slice(Le))+Ye,Me=Me.slice(0,Le);break}}}G&&!$&&(Me=t(Me,1/0));var Ze=Ke.length+Me.length+Ye.length,nt=Ze<U?new Array(U-Ze+1).join(O):"";switch(G&&$&&(Me=t(nt+Me,nt.length?U-Ye.length:1/0),nt=""),L){case"<":Me=Ke+Me+Ye+nt;break;case"=":Me=Ke+nt+Me+Ye;break;case"^":Me=nt.slice(0,Ze=nt.length>>1)+Ke+Me+Ye+nt.slice(Ze);break;default:Me=nt+Ke+Me+Ye;break}return h(Me)}return Oe.toString=function(){return P+""},Oe}function E(P,O){var L=b((P=dw(P),P.type="f",P)),B=Math.max(-8,Math.min(8,Math.floor(M_(O)/3)))*3,z=Math.pow(10,-B),$=m8[8+B/3];return function(U){return L(z*U)+$}}return{format:b,formatPrefix:E}}var YT,m3,NQ;Sje({thousands:",",grouping:[3],currency:["$",""]});function Sje(e){return YT=wje(e),m3=YT.format,NQ=YT.formatPrefix,YT}function Tje(e){return Math.max(0,-M_(Math.abs(e)))}function Eje(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(M_(t)/3)))*3-M_(Math.abs(e)))}function Aje(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,M_(t)-M_(e))+1}function zQ(e,t,r,n){var l=zLe(e,t,r),h;switch(n=dw(n??",f"),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(h=Eje(l,f))&&(n.precision=h),NQ(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(h=Aje(l,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=h-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(h=Tje(l))&&(n.precision=h-(n.type==="%")*2);break}}return m3(n)}function Cf(e){var t=e.domain;return e.ticks=function(r){var n=t();return vD(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var l=t();return zQ(l[0],l[l.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),l=0,h=n.length-1,f=n[l],o=n[h],v,b,E=10;for(o<f&&(b=f,f=o,o=b,b=l,l=h,h=b);E-- >0;){if(b=xD(f,o,r),b===v)return n[l]=f,n[h]=o,t(n);if(b>0)f=Math.floor(f/b)*b,o=Math.ceil(o/b)*b;else if(b<0)f=Math.ceil(f*b)/b,o=Math.floor(o*b)/b;else break;v=b}return e},e}function N2(){var e=f3();return e.copy=function(){return a1(e,N2())},Hl.apply(e,arguments),Cf(e)}function FQ(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,L2),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return FQ(e).unknown(t)},e=arguments.length?Array.from(e,L2):[0,1],Cf(r)}function BQ(e,t){e=e.slice();var r=0,n=e.length-1,l=e[r],h=e[n],f;return h<l&&(f=r,r=n,n=f,f=l,l=h,h=f),e[r]=t.floor(l),e[n]=t.ceil(h),e}function g8(e){return Math.log(e)}function y8(e){return Math.exp(e)}function Pje(e){return-Math.log(-e)}function Cje(e){return-Math.exp(-e)}function Ije(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Mje(e){return e===10?Ije:e===Math.E?Math.exp:t=>Math.pow(e,t)}function Oje(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function _8(e){return(t,r)=>-e(-t,r)}function g3(e){const t=e(g8,y8),r=t.domain;let n=10,l,h;function f(){return l=Oje(n),h=Mje(n),r()[0]<0?(l=_8(l),h=_8(h),e(Pje,Cje)):e(g8,y8),t}return t.base=function(o){return arguments.length?(n=+o,f()):n},t.domain=function(o){return arguments.length?(r(o),f()):r()},t.ticks=o=>{const v=r();let b=v[0],E=v[v.length-1];const P=E<b;P&&([b,E]=[E,b]);let O=l(b),L=l(E),B,z;const $=o==null?10:+o;let U=[];if(!(n%1)&&L-O<$){if(O=Math.floor(O),L=Math.ceil(L),b>0){for(;O<=L;++O)for(B=1;B<n;++B)if(z=O<0?B/h(-O):B*h(O),!(z<b)){if(z>E)break;U.push(z)}}else for(;O<=L;++O)for(B=n-1;B>=1;--B)if(z=O>0?B/h(-O):B*h(O),!(z<b)){if(z>E)break;U.push(z)}U.length*2<$&&(U=vD(b,E,$))}else U=vD(O,L,Math.min(L-O,$)).map(h);return P?U.reverse():U},t.tickFormat=(o,v)=>{if(o==null&&(o=10),v==null&&(v=n===10?"s":","),typeof v!="function"&&(!(n%1)&&(v=dw(v)).precision==null&&(v.trim=!0),v=m3(v)),o===1/0)return v;const b=Math.max(1,n*o/t.ticks().length);return E=>{let P=E/h(Math.round(l(E)));return P*n<n-.5&&(P*=n),P<=b?v(E):""}},t.nice=()=>r(BQ(r(),{floor:o=>h(Math.floor(l(o))),ceil:o=>h(Math.ceil(l(o)))})),t}function $Q(){const e=g3($P()).domain([1,10]);return e.copy=()=>a1(e,$Q()).base(e.base()),Hl.apply(e,arguments),e}function v8(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function x8(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function y3(e){var t=1,r=e(v8(t),x8(t));return r.constant=function(n){return arguments.length?e(v8(t=+n),x8(t)):t},Cf(r)}function VQ(){var e=y3($P());return e.copy=function(){return a1(e,VQ()).constant(e.constant())},Hl.apply(e,arguments)}function b8(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function kje(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Rje(e){return e<0?-e*e:e*e}function _3(e){var t=e(va,va),r=1;function n(){return r===1?e(va,va):r===.5?e(kje,Rje):e(b8(r),b8(1/r))}return t.exponent=function(l){return arguments.length?(r=+l,n()):r},Cf(t)}function v3(){var e=_3($P());return e.copy=function(){return a1(e,v3()).exponent(e.exponent())},Hl.apply(e,arguments),e}function Dje(){return v3.apply(null,arguments).exponent(.5)}function w8(e){return Math.sign(e)*e*e}function Lje(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function UQ(){var e=f3(),t=[0,1],r=!1,n;function l(h){var f=Lje(e(h));return isNaN(f)?n:r?Math.round(f):f}return l.invert=function(h){return e.invert(w8(h))},l.domain=function(h){return arguments.length?(e.domain(h),l):e.domain()},l.range=function(h){return arguments.length?(e.range((t=Array.from(h,L2)).map(w8)),l):t.slice()},l.rangeRound=function(h){return l.range(h).round(!0)},l.round=function(h){return arguments.length?(r=!!h,l):r},l.clamp=function(h){return arguments.length?(e.clamp(h),l):e.clamp()},l.unknown=function(h){return arguments.length?(n=h,l):n},l.copy=function(){return UQ(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Hl.apply(l,arguments),Cf(l)}function GQ(){var e=[],t=[],r=[],n;function l(){var f=0,o=Math.max(1,t.length);for(r=new Array(o-1);++f<o;)r[f-1]=BLe(e,f/o);return h}function h(f){return f==null||isNaN(f=+f)?n:t[o1(r,f)]}return h.invertExtent=function(f){var o=t.indexOf(f);return o<0?[NaN,NaN]:[o>0?r[o-1]:e[0],o<r.length?r[o]:e[e.length-1]]},h.domain=function(f){if(!arguments.length)return e.slice();e=[];for(let o of f)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(ff),l()},h.range=function(f){return arguments.length?(t=Array.from(f),l()):t.slice()},h.unknown=function(f){return arguments.length?(n=f,h):n},h.quantiles=function(){return r.slice()},h.copy=function(){return GQ().domain(e).range(t).unknown(n)},Hl.apply(h,arguments)}function HQ(){var e=0,t=1,r=1,n=[.5],l=[0,1],h;function f(v){return v!=null&&v<=v?l[o1(n,v,0,r)]:h}function o(){var v=-1;for(n=new Array(r);++v<r;)n[v]=((v+1)*t-(v-r)*e)/(r+1);return f}return f.domain=function(v){return arguments.length?([e,t]=v,e=+e,t=+t,o()):[e,t]},f.range=function(v){return arguments.length?(r=(l=Array.from(v)).length-1,o()):l.slice()},f.invertExtent=function(v){var b=l.indexOf(v);return b<0?[NaN,NaN]:b<1?[e,n[0]]:b>=r?[n[r-1],t]:[n[b-1],n[b]]},f.unknown=function(v){return arguments.length&&(h=v),f},f.thresholds=function(){return n.slice()},f.copy=function(){return HQ().domain([e,t]).range(l).unknown(h)},Hl.apply(Cf(f),arguments)}function WQ(){var e=[.5],t=[0,1],r,n=1;function l(h){return h!=null&&h<=h?t[o1(e,h,0,n)]:r}return l.domain=function(h){return arguments.length?(e=Array.from(h),n=Math.min(e.length,t.length-1),l):e.slice()},l.range=function(h){return arguments.length?(t=Array.from(h),n=Math.min(e.length,t.length-1),l):t.slice()},l.invertExtent=function(h){var f=t.indexOf(h);return[e[f-1],e[f]]},l.unknown=function(h){return arguments.length?(r=h,l):r},l.copy=function(){return WQ().domain(e).range(t).unknown(r)},Hl.apply(l,arguments)}const OO=new Date,kO=new Date;function ls(e,t,r,n){function l(h){return e(h=arguments.length===0?new Date:new Date(+h)),h}return l.floor=h=>(e(h=new Date(+h)),h),l.ceil=h=>(e(h=new Date(h-1)),t(h,1),e(h),h),l.round=h=>{const f=l(h),o=l.ceil(h);return h-f<o-h?f:o},l.offset=(h,f)=>(t(h=new Date(+h),f==null?1:Math.floor(f)),h),l.range=(h,f,o)=>{const v=[];if(h=l.ceil(h),o=o==null?1:Math.floor(o),!(h<f)||!(o>0))return v;let b;do v.push(b=new Date(+h)),t(h,o),e(h);while(b<h&&h<f);return v},l.filter=h=>ls(f=>{if(f>=f)for(;e(f),!h(f);)f.setTime(f-1)},(f,o)=>{if(f>=f)if(o<0)for(;++o<=0;)for(;t(f,-1),!h(f););else for(;--o>=0;)for(;t(f,1),!h(f););}),r&&(l.count=(h,f)=>(OO.setTime(+h),kO.setTime(+f),e(OO),e(kO),Math.floor(r(OO,kO))),l.every=h=>(h=Math.floor(h),!isFinite(h)||!(h>0)?null:h>1?l.filter(n?f=>n(f)%h===0:f=>l.count(0,f)%h===0):l)),l}const z2=ls(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);z2.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ls(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):z2);z2.range;const fh=1e3,Ll=fh*60,ph=Ll*60,Ih=ph*24,x3=Ih*7,S8=Ih*30,RO=Ih*365,Yp=ls(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*fh)},(e,t)=>(t-e)/fh,e=>e.getUTCSeconds());Yp.range;const b3=ls(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*fh)},(e,t)=>{e.setTime(+e+t*Ll)},(e,t)=>(t-e)/Ll,e=>e.getMinutes());b3.range;const w3=ls(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Ll)},(e,t)=>(t-e)/Ll,e=>e.getUTCMinutes());w3.range;const S3=ls(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*fh-e.getMinutes()*Ll)},(e,t)=>{e.setTime(+e+t*ph)},(e,t)=>(t-e)/ph,e=>e.getHours());S3.range;const T3=ls(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*ph)},(e,t)=>(t-e)/ph,e=>e.getUTCHours());T3.range;const l1=ls(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ll)/Ih,e=>e.getDate()-1);l1.range;const VP=ls(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ih,e=>e.getUTCDate()-1);VP.range;const qQ=ls(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ih,e=>Math.floor(e/Ih));qQ.range;function Lm(e){return ls(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Ll)/x3)}const UP=Lm(0),F2=Lm(1),jje=Lm(2),Nje=Lm(3),O_=Lm(4),zje=Lm(5),Fje=Lm(6);UP.range;F2.range;jje.range;Nje.range;O_.range;zje.range;Fje.range;function jm(e){return ls(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/x3)}const GP=jm(0),B2=jm(1),Bje=jm(2),$je=jm(3),k_=jm(4),Vje=jm(5),Uje=jm(6);GP.range;B2.range;Bje.range;$je.range;k_.range;Vje.range;Uje.range;const E3=ls(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());E3.range;const A3=ls(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());A3.range;const Mh=ls(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Mh.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ls(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Mh.range;const Oh=ls(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Oh.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ls(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Oh.range;function DO(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Gje(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Hje(e){let t,r,n;e.length!==2?(t=DO,r=(o,v)=>DO(e(o),v),n=(o,v)=>e(o)-v):(t=e===DO||e===Gje?e:Wje,r=e,n=e);function l(o,v,b=0,E=o.length){if(b<E){if(t(v,v)!==0)return E;do{const P=b+E>>>1;r(o[P],v)<0?b=P+1:E=P}while(b<E)}return b}function h(o,v,b=0,E=o.length){if(b<E){if(t(v,v)!==0)return E;do{const P=b+E>>>1;r(o[P],v)<=0?b=P+1:E=P}while(b<E)}return b}function f(o,v,b=0,E=o.length){const P=l(o,v,b,E-1);return P>b&&n(o[P-1],v)>-n(o[P],v)?P-1:P}return{left:l,center:f,right:h}}function Wje(){return 0}const qje=Math.sqrt(50),Zje=Math.sqrt(10),Xje=Math.sqrt(2);function ZQ(e,t,r){const n=(t-e)/Math.max(0,r),l=Math.floor(Math.log10(n)),h=n/Math.pow(10,l),f=h>=qje?10:h>=Zje?5:h>=Xje?2:1;let o,v,b;return l<0?(b=Math.pow(10,-l)/f,o=Math.round(e*b),v=Math.round(t*b),o/b<e&&++o,v/b>t&&--v,b=-b):(b=Math.pow(10,l)*f,o=Math.round(e/b),v=Math.round(t/b),o*b<e&&++o,v*b>t&&--v),v<o&&.5<=r&&r<2?ZQ(e,t,r*2):[o,v,b]}function T8(e,t,r){return t=+t,e=+e,r=+r,ZQ(e,t,r)[2]}function E8(e,t,r){t=+t,e=+e,r=+r;const n=t<e,l=n?T8(t,e,r):T8(e,t,r);return(n?-1:1)*(l<0?1/-l:l)}function XQ(e,t,r,n,l,h){const f=[[Yp,1,fh],[Yp,5,5*fh],[Yp,15,15*fh],[Yp,30,30*fh],[h,1,Ll],[h,5,5*Ll],[h,15,15*Ll],[h,30,30*Ll],[l,1,ph],[l,3,3*ph],[l,6,6*ph],[l,12,12*ph],[n,1,Ih],[n,2,2*Ih],[r,1,x3],[t,1,S8],[t,3,3*S8],[e,1,RO]];function o(b,E,P){const O=E<b;O&&([b,E]=[E,b]);const L=P&&typeof P.range=="function"?P:v(b,E,P),B=L?L.range(b,+E+1):[];return O?B.reverse():B}function v(b,E,P){const O=Math.abs(E-b)/P,L=Hje(([,,$])=>$).right(f,O);if(L===f.length)return e.every(E8(b/RO,E/RO,P));if(L===0)return z2.every(Math.max(E8(b,E,P),1));const[B,z]=f[O/f[L-1][2]<f[L][2]/O?L-1:L];return B.every(z)}return[o,v]}const[Kje,Yje]=XQ(Oh,A3,GP,qQ,T3,w3),[Jje,Qje]=XQ(Mh,E3,UP,l1,S3,b3);function LO(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function jO(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Fx(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function eNe(e){var t=e.dateTime,r=e.date,n=e.time,l=e.periods,h=e.days,f=e.shortDays,o=e.months,v=e.shortMonths,b=Bx(l),E=$x(l),P=Bx(h),O=$x(h),L=Bx(f),B=$x(f),z=Bx(o),$=$x(o),U=Bx(v),G=$x(v),Z={a:it,A:Ze,b:nt,B:pt,c:null,d:O8,e:O8,f:SNe,g:RNe,G:LNe,H:xNe,I:bNe,j:wNe,L:KQ,m:TNe,M:ENe,p:_t,q:It,Q:D8,s:L8,S:ANe,u:PNe,U:CNe,V:INe,w:MNe,W:ONe,x:null,X:null,y:kNe,Y:DNe,Z:jNe,"%":R8},ne={a:sr,A:Sr,b:Kr,B:Er,c:null,d:k8,e:k8,f:BNe,g:KNe,G:JNe,H:NNe,I:zNe,j:FNe,L:JQ,m:$Ne,M:VNe,p:Kt,q:Pr,Q:D8,s:L8,S:UNe,u:GNe,U:HNe,V:WNe,w:qNe,W:ZNe,x:null,X:null,y:XNe,Y:YNe,Z:QNe,"%":R8},Y={a:Oe,A:Me,b:Ke,B:Ye,c:Le,d:I8,e:I8,f:gNe,g:C8,G:P8,H:M8,I:M8,j:dNe,L:mNe,m:hNe,M:fNe,p:Ce,q:uNe,Q:_Ne,s:vNe,S:pNe,u:oNe,U:sNe,V:aNe,w:iNe,W:lNe,x:Qe,X:Je,y:C8,Y:P8,Z:cNe,"%":yNe};Z.x=ee(r,Z),Z.X=ee(n,Z),Z.c=ee(t,Z),ne.x=ee(r,ne),ne.X=ee(n,ne),ne.c=ee(t,ne);function ee(Qt,nr){return function(xr){var Ft=[],Pn=-1,Hr=0,Yr=Qt.length,kn,Si,jo;for(xr instanceof Date||(xr=new Date(+xr));++Pn<Yr;)Qt.charCodeAt(Pn)===37&&(Ft.push(Qt.slice(Hr,Pn)),(Si=A8[kn=Qt.charAt(++Pn)])!=null?kn=Qt.charAt(++Pn):Si=kn==="e"?" ":"0",(jo=nr[kn])&&(kn=jo(xr,Si)),Ft.push(kn),Hr=Pn+1);return Ft.push(Qt.slice(Hr,Pn)),Ft.join("")}}function le(Qt,nr){return function(xr){var Ft=Fx(1900,void 0,1),Pn=fe(Ft,Qt,xr+="",0),Hr,Yr;if(Pn!=xr.length)return null;if("Q"in Ft)return new Date(Ft.Q);if("s"in Ft)return new Date(Ft.s*1e3+("L"in Ft?Ft.L:0));if(nr&&!("Z"in Ft)&&(Ft.Z=0),"p"in Ft&&(Ft.H=Ft.H%12+Ft.p*12),Ft.m===void 0&&(Ft.m="q"in Ft?Ft.q:0),"V"in Ft){if(Ft.V<1||Ft.V>53)return null;"w"in Ft||(Ft.w=1),"Z"in Ft?(Hr=jO(Fx(Ft.y,0,1)),Yr=Hr.getUTCDay(),Hr=Yr>4||Yr===0?B2.ceil(Hr):B2(Hr),Hr=VP.offset(Hr,(Ft.V-1)*7),Ft.y=Hr.getUTCFullYear(),Ft.m=Hr.getUTCMonth(),Ft.d=Hr.getUTCDate()+(Ft.w+6)%7):(Hr=LO(Fx(Ft.y,0,1)),Yr=Hr.getDay(),Hr=Yr>4||Yr===0?F2.ceil(Hr):F2(Hr),Hr=l1.offset(Hr,(Ft.V-1)*7),Ft.y=Hr.getFullYear(),Ft.m=Hr.getMonth(),Ft.d=Hr.getDate()+(Ft.w+6)%7)}else("W"in Ft||"U"in Ft)&&("w"in Ft||(Ft.w="u"in Ft?Ft.u%7:"W"in Ft?1:0),Yr="Z"in Ft?jO(Fx(Ft.y,0,1)).getUTCDay():LO(Fx(Ft.y,0,1)).getDay(),Ft.m=0,Ft.d="W"in Ft?(Ft.w+6)%7+Ft.W*7-(Yr+5)%7:Ft.w+Ft.U*7-(Yr+6)%7);return"Z"in Ft?(Ft.H+=Ft.Z/100|0,Ft.M+=Ft.Z%100,jO(Ft)):LO(Ft)}}function fe(Qt,nr,xr,Ft){for(var Pn=0,Hr=nr.length,Yr=xr.length,kn,Si;Pn<Hr;){if(Ft>=Yr)return-1;if(kn=nr.charCodeAt(Pn++),kn===37){if(kn=nr.charAt(Pn++),Si=Y[kn in A8?nr.charAt(Pn++):kn],!Si||(Ft=Si(Qt,xr,Ft))<0)return-1}else if(kn!=xr.charCodeAt(Ft++))return-1}return Ft}function Ce(Qt,nr,xr){var Ft=b.exec(nr.slice(xr));return Ft?(Qt.p=E.get(Ft[0].toLowerCase()),xr+Ft[0].length):-1}function Oe(Qt,nr,xr){var Ft=L.exec(nr.slice(xr));return Ft?(Qt.w=B.get(Ft[0].toLowerCase()),xr+Ft[0].length):-1}function Me(Qt,nr,xr){var Ft=P.exec(nr.slice(xr));return Ft?(Qt.w=O.get(Ft[0].toLowerCase()),xr+Ft[0].length):-1}function Ke(Qt,nr,xr){var Ft=U.exec(nr.slice(xr));return Ft?(Qt.m=G.get(Ft[0].toLowerCase()),xr+Ft[0].length):-1}function Ye(Qt,nr,xr){var Ft=z.exec(nr.slice(xr));return Ft?(Qt.m=$.get(Ft[0].toLowerCase()),xr+Ft[0].length):-1}function Le(Qt,nr,xr){return fe(Qt,t,nr,xr)}function Qe(Qt,nr,xr){return fe(Qt,r,nr,xr)}function Je(Qt,nr,xr){return fe(Qt,n,nr,xr)}function it(Qt){return f[Qt.getDay()]}function Ze(Qt){return h[Qt.getDay()]}function nt(Qt){return v[Qt.getMonth()]}function pt(Qt){return o[Qt.getMonth()]}function _t(Qt){return l[+(Qt.getHours()>=12)]}function It(Qt){return 1+~~(Qt.getMonth()/3)}function sr(Qt){return f[Qt.getUTCDay()]}function Sr(Qt){return h[Qt.getUTCDay()]}function Kr(Qt){return v[Qt.getUTCMonth()]}function Er(Qt){return o[Qt.getUTCMonth()]}function Kt(Qt){return l[+(Qt.getUTCHours()>=12)]}function Pr(Qt){return 1+~~(Qt.getUTCMonth()/3)}return{format:function(Qt){var nr=ee(Qt+="",Z);return nr.toString=function(){return Qt},nr},parse:function(Qt){var nr=le(Qt+="",!1);return nr.toString=function(){return Qt},nr},utcFormat:function(Qt){var nr=ee(Qt+="",ne);return nr.toString=function(){return Qt},nr},utcParse:function(Qt){var nr=le(Qt+="",!0);return nr.toString=function(){return Qt},nr}}}var A8={"-":"",_:" ",0:"0"},Ss=/^\s*\d+/,tNe=/^%/,rNe=/[\\^$*+?|[\]().{}]/g;function wi(e,t,r){var n=e<0?"-":"",l=(n?-e:e)+"",h=l.length;return n+(h<r?new Array(r-h+1).join(t)+l:l)}function nNe(e){return e.replace(rNe,"\\$&")}function Bx(e){return new RegExp("^(?:"+e.map(nNe).join("|")+")","i")}function $x(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function iNe(e,t,r){var n=Ss.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function oNe(e,t,r){var n=Ss.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function sNe(e,t,r){var n=Ss.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function aNe(e,t,r){var n=Ss.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function lNe(e,t,r){var n=Ss.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function P8(e,t,r){var n=Ss.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function C8(e,t,r){var n=Ss.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function cNe(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function uNe(e,t,r){var n=Ss.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function hNe(e,t,r){var n=Ss.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function I8(e,t,r){var n=Ss.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function dNe(e,t,r){var n=Ss.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function M8(e,t,r){var n=Ss.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function fNe(e,t,r){var n=Ss.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function pNe(e,t,r){var n=Ss.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function mNe(e,t,r){var n=Ss.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function gNe(e,t,r){var n=Ss.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function yNe(e,t,r){var n=tNe.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function _Ne(e,t,r){var n=Ss.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function vNe(e,t,r){var n=Ss.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function O8(e,t){return wi(e.getDate(),t,2)}function xNe(e,t){return wi(e.getHours(),t,2)}function bNe(e,t){return wi(e.getHours()%12||12,t,2)}function wNe(e,t){return wi(1+l1.count(Mh(e),e),t,3)}function KQ(e,t){return wi(e.getMilliseconds(),t,3)}function SNe(e,t){return KQ(e,t)+"000"}function TNe(e,t){return wi(e.getMonth()+1,t,2)}function ENe(e,t){return wi(e.getMinutes(),t,2)}function ANe(e,t){return wi(e.getSeconds(),t,2)}function PNe(e){var t=e.getDay();return t===0?7:t}function CNe(e,t){return wi(UP.count(Mh(e)-1,e),t,2)}function YQ(e){var t=e.getDay();return t>=4||t===0?O_(e):O_.ceil(e)}function INe(e,t){return e=YQ(e),wi(O_.count(Mh(e),e)+(Mh(e).getDay()===4),t,2)}function MNe(e){return e.getDay()}function ONe(e,t){return wi(F2.count(Mh(e)-1,e),t,2)}function kNe(e,t){return wi(e.getFullYear()%100,t,2)}function RNe(e,t){return e=YQ(e),wi(e.getFullYear()%100,t,2)}function DNe(e,t){return wi(e.getFullYear()%1e4,t,4)}function LNe(e,t){var r=e.getDay();return e=r>=4||r===0?O_(e):O_.ceil(e),wi(e.getFullYear()%1e4,t,4)}function jNe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+wi(t/60|0,"0",2)+wi(t%60,"0",2)}function k8(e,t){return wi(e.getUTCDate(),t,2)}function NNe(e,t){return wi(e.getUTCHours(),t,2)}function zNe(e,t){return wi(e.getUTCHours()%12||12,t,2)}function FNe(e,t){return wi(1+VP.count(Oh(e),e),t,3)}function JQ(e,t){return wi(e.getUTCMilliseconds(),t,3)}function BNe(e,t){return JQ(e,t)+"000"}function $Ne(e,t){return wi(e.getUTCMonth()+1,t,2)}function VNe(e,t){return wi(e.getUTCMinutes(),t,2)}function UNe(e,t){return wi(e.getUTCSeconds(),t,2)}function GNe(e){var t=e.getUTCDay();return t===0?7:t}function HNe(e,t){return wi(GP.count(Oh(e)-1,e),t,2)}function QQ(e){var t=e.getUTCDay();return t>=4||t===0?k_(e):k_.ceil(e)}function WNe(e,t){return e=QQ(e),wi(k_.count(Oh(e),e)+(Oh(e).getUTCDay()===4),t,2)}function qNe(e){return e.getUTCDay()}function ZNe(e,t){return wi(B2.count(Oh(e)-1,e),t,2)}function XNe(e,t){return wi(e.getUTCFullYear()%100,t,2)}function KNe(e,t){return e=QQ(e),wi(e.getUTCFullYear()%100,t,2)}function YNe(e,t){return wi(e.getUTCFullYear()%1e4,t,4)}function JNe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?k_(e):k_.ceil(e),wi(e.getUTCFullYear()%1e4,t,4)}function QNe(){return"+0000"}function R8(){return"%"}function D8(e){return+e}function L8(e){return Math.floor(+e/1e3)}var py,eee,tee;e3e({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function e3e(e){return py=eNe(e),eee=py.format,py.parse,tee=py.utcFormat,py.utcParse,py}function t3e(e){return new Date(e)}function r3e(e){return e instanceof Date?+e:+new Date(+e)}function P3(e,t,r,n,l,h,f,o,v,b){var E=f3(),P=E.invert,O=E.domain,L=b(".%L"),B=b(":%S"),z=b("%I:%M"),$=b("%I %p"),U=b("%a %d"),G=b("%b %d"),Z=b("%B"),ne=b("%Y");function Y(ee){return(v(ee)<ee?L:o(ee)<ee?B:f(ee)<ee?z:h(ee)<ee?$:n(ee)<ee?l(ee)<ee?U:G:r(ee)<ee?Z:ne)(ee)}return E.invert=function(ee){return new Date(P(ee))},E.domain=function(ee){return arguments.length?O(Array.from(ee,r3e)):O().map(t3e)},E.ticks=function(ee){var le=O();return e(le[0],le[le.length-1],ee??10)},E.tickFormat=function(ee,le){return le==null?Y:b(le)},E.nice=function(ee){var le=O();return(!ee||typeof ee.range!="function")&&(ee=t(le[0],le[le.length-1],ee??10)),ee?O(BQ(le,ee)):E},E.copy=function(){return a1(E,P3(e,t,r,n,l,h,f,o,v,b))},E}function n3e(){return Hl.apply(P3(Jje,Qje,Mh,E3,UP,l1,S3,b3,Yp,eee).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function i3e(){return Hl.apply(P3(Kje,Yje,Oh,A3,GP,VP,T3,w3,Yp,tee).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function HP(){var e=0,t=1,r,n,l,h,f=va,o=!1,v;function b(P){return P==null||isNaN(P=+P)?v:f(l===0?.5:(P=(h(P)-r)*l,o?Math.max(0,Math.min(1,P)):P))}b.domain=function(P){return arguments.length?([e,t]=P,r=h(e=+e),n=h(t=+t),l=r===n?0:1/(n-r),b):[e,t]},b.clamp=function(P){return arguments.length?(o=!!P,b):o},b.interpolator=function(P){return arguments.length?(f=P,b):f};function E(P){return function(O){var L,B;return arguments.length?([L,B]=O,f=P(L,B),b):[f(0),f(1)]}}return b.range=E(xv),b.rangeRound=E(d3),b.unknown=function(P){return arguments.length?(v=P,b):v},function(P){return h=P,r=P(e),n=P(t),l=r===n?0:1/(n-r),b}}function If(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function ree(){var e=Cf(HP()(va));return e.copy=function(){return If(e,ree())},Nh.apply(e,arguments)}function nee(){var e=g3(HP()).domain([1,10]);return e.copy=function(){return If(e,nee()).base(e.base())},Nh.apply(e,arguments)}function iee(){var e=y3(HP());return e.copy=function(){return If(e,iee()).constant(e.constant())},Nh.apply(e,arguments)}function C3(){var e=_3(HP());return e.copy=function(){return If(e,C3()).exponent(e.exponent())},Nh.apply(e,arguments)}function o3e(){return C3.apply(null,arguments).exponent(.5)}function oee(){var e=[],t=va;function r(n){if(n!=null&&!isNaN(n=+n))return t((o1(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let l of n)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(ff),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,l)=>t(l/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(l,h)=>FLe(e,h/n))},r.copy=function(){return oee(t).domain(e)},Nh.apply(r,arguments)}function WP(){var e=0,t=.5,r=1,n=1,l,h,f,o,v,b=va,E,P=!1,O;function L(z){return isNaN(z=+z)?O:(z=.5+((z=+E(z))-h)*(n*z<n*h?o:v),b(P?Math.max(0,Math.min(1,z)):z))}L.domain=function(z){return arguments.length?([e,t,r]=z,l=E(e=+e),h=E(t=+t),f=E(r=+r),o=l===h?0:.5/(h-l),v=h===f?0:.5/(f-h),n=h<l?-1:1,L):[e,t,r]},L.clamp=function(z){return arguments.length?(P=!!z,L):P},L.interpolator=function(z){return arguments.length?(b=z,L):b};function B(z){return function($){var U,G,Z;return arguments.length?([U,G,Z]=$,b=hje(z,[U,G,Z]),L):[b(0),b(.5),b(1)]}}return L.range=B(xv),L.rangeRound=B(d3),L.unknown=function(z){return arguments.length?(O=z,L):O},function(z){return E=z,l=z(e),h=z(t),f=z(r),o=l===h?0:.5/(h-l),v=h===f?0:.5/(f-h),n=h<l?-1:1,L}}function see(){var e=Cf(WP()(va));return e.copy=function(){return If(e,see())},Nh.apply(e,arguments)}function aee(){var e=g3(WP()).domain([.1,1,10]);return e.copy=function(){return If(e,aee()).base(e.base())},Nh.apply(e,arguments)}function lee(){var e=y3(WP());return e.copy=function(){return If(e,lee()).constant(e.constant())},Nh.apply(e,arguments)}function I3(){var e=_3(WP());return e.copy=function(){return If(e,I3()).exponent(e.exponent())},Nh.apply(e,arguments)}function s3e(){return I3.apply(null,arguments).exponent(.5)}const j8=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:lw,scaleDiverging:see,scaleDivergingLog:aee,scaleDivergingPow:I3,scaleDivergingSqrt:s3e,scaleDivergingSymlog:lee,scaleIdentity:FQ,scaleImplicit:bD,scaleLinear:N2,scaleLog:$Q,scaleOrdinal:c3,scalePoint:wb,scalePow:v3,scaleQuantile:GQ,scaleQuantize:HQ,scaleRadial:UQ,scaleSequential:ree,scaleSequentialLog:nee,scaleSequentialPow:C3,scaleSequentialQuantile:oee,scaleSequentialSqrt:o3e,scaleSequentialSymlog:iee,scaleSqrt:Dje,scaleSymlog:VQ,scaleThreshold:WQ,scaleTime:n3e,scaleUtc:i3e,tickFormat:zQ},Symbol.toStringTag,{value:"Module"}));var a3e=hv;function l3e(e,t,r){for(var n=-1,l=e.length;++n<l;){var h=e[n],f=t(h);if(f!=null&&(o===void 0?f===f&&!a3e(f):r(f,o)))var o=f,v=h}return v}var qP=l3e;function c3e(e,t){return e>t}var cee=c3e,u3e=qP,h3e=cee,d3e=_v;function f3e(e){return e&&e.length?u3e(e,d3e,h3e):void 0}var p3e=f3e;const ZP=Pi(p3e);function m3e(e,t){return e<t}var uee=m3e,g3e=qP,y3e=uee,_3e=_v;function v3e(e){return e&&e.length?g3e(e,_3e,y3e):void 0}var x3e=v3e;const XP=Pi(x3e);var b3e=GN,w3e=Mu,S3e=gQ,T3e=qa;function E3e(e,t){var r=T3e(e)?b3e:S3e;return r(e,w3e(t))}var A3e=E3e,P3e=pQ,C3e=A3e;function I3e(e,t){return P3e(C3e(e,t),1)}var M3e=I3e;const O3e=Pi(M3e);var k3e=o3;function R3e(e,t){return k3e(e,t)}var D3e=R3e;const KP=Pi(D3e);var bv=1e9,L3e={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},O3,uo=!0,Vl="[DecimalError] ",um=Vl+"Invalid argument: ",M3=Vl+"Exponent out of range: ",wv=Math.floor,Bp=Math.pow,j3e=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ll,_s=1e7,oo=7,hee=9007199254740991,$2=wv(hee/oo),Dr={};Dr.absoluteValue=Dr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Dr.comparedTo=Dr.cmp=function(e){var t,r,n,l,h=this;if(e=new h.constructor(e),h.s!==e.s)return h.s||-e.s;if(h.e!==e.e)return h.e>e.e^h.s<0?1:-1;for(n=h.d.length,l=e.d.length,t=0,r=n<l?n:l;t<r;++t)if(h.d[t]!==e.d[t])return h.d[t]>e.d[t]^h.s<0?1:-1;return n===l?0:n>l^h.s<0?1:-1};Dr.decimalPlaces=Dr.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*oo;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Dr.dividedBy=Dr.div=function(e){return _h(this,new this.constructor(e))};Dr.dividedToIntegerBy=Dr.idiv=function(e){var t=this,r=t.constructor;return Vi(_h(t,new r(e),0,1),r.precision)};Dr.equals=Dr.eq=function(e){return!this.cmp(e)};Dr.exponent=function(){return Wo(this)};Dr.greaterThan=Dr.gt=function(e){return this.cmp(e)>0};Dr.greaterThanOrEqualTo=Dr.gte=function(e){return this.cmp(e)>=0};Dr.isInteger=Dr.isint=function(){return this.e>this.d.length-2};Dr.isNegative=Dr.isneg=function(){return this.s<0};Dr.isPositive=Dr.ispos=function(){return this.s>0};Dr.isZero=function(){return this.s===0};Dr.lessThan=Dr.lt=function(e){return this.cmp(e)<0};Dr.lessThanOrEqualTo=Dr.lte=function(e){return this.cmp(e)<1};Dr.logarithm=Dr.log=function(e){var t,r=this,n=r.constructor,l=n.precision,h=l+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(ll))throw Error(Vl+"NaN");if(r.s<1)throw Error(Vl+(r.s?"NaN":"-Infinity"));return r.eq(ll)?new n(0):(uo=!1,t=_h(fw(r,h),fw(e,h),h),uo=!0,Vi(t,l))};Dr.minus=Dr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?pee(t,e):dee(t,(e.s=-e.s,e))};Dr.modulo=Dr.mod=function(e){var t,r=this,n=r.constructor,l=n.precision;if(e=new n(e),!e.s)throw Error(Vl+"NaN");return r.s?(uo=!1,t=_h(r,e,0,1).times(e),uo=!0,r.minus(t)):Vi(new n(r),l)};Dr.naturalExponential=Dr.exp=function(){return fee(this)};Dr.naturalLogarithm=Dr.ln=function(){return fw(this)};Dr.negated=Dr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Dr.plus=Dr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?dee(t,e):pee(t,(e.s=-e.s,e))};Dr.precision=Dr.sd=function(e){var t,r,n,l=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(um+e);if(t=Wo(l)+1,n=l.d.length-1,r=n*oo+1,n=l.d[n],n){for(;n%10==0;n/=10)r--;for(n=l.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Dr.squareRoot=Dr.sqrt=function(){var e,t,r,n,l,h,f,o=this,v=o.constructor;if(o.s<1){if(!o.s)return new v(0);throw Error(Vl+"NaN")}for(e=Wo(o),uo=!1,l=Math.sqrt(+o),l==0||l==1/0?(t=pu(o.d),(t.length+e)%2==0&&(t+="0"),l=Math.sqrt(t),e=wv((e+1)/2)-(e<0||e%2),l==1/0?t="5e"+e:(t=l.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new v(t)):n=new v(l.toString()),r=v.precision,l=f=r+3;;)if(h=n,n=h.plus(_h(o,h,f+2)).times(.5),pu(h.d).slice(0,f)===(t=pu(n.d)).slice(0,f)){if(t=t.slice(f-3,f+1),l==f&&t=="4999"){if(Vi(h,r+1,0),h.times(h).eq(o)){n=h;break}}else if(t!="9999")break;f+=4}return uo=!0,Vi(n,r)};Dr.times=Dr.mul=function(e){var t,r,n,l,h,f,o,v,b,E=this,P=E.constructor,O=E.d,L=(e=new P(e)).d;if(!E.s||!e.s)return new P(0);for(e.s*=E.s,r=E.e+e.e,v=O.length,b=L.length,v<b&&(h=O,O=L,L=h,f=v,v=b,b=f),h=[],f=v+b,n=f;n--;)h.push(0);for(n=b;--n>=0;){for(t=0,l=v+n;l>n;)o=h[l]+L[n]*O[l-n-1]+t,h[l--]=o%_s|0,t=o/_s|0;h[l]=(h[l]+t)%_s|0}for(;!h[--f];)h.pop();return t?++r:h.shift(),e.d=h,e.e=r,uo?Vi(e,P.precision):e};Dr.toDecimalPlaces=Dr.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Au(e,0,bv),t===void 0?t=n.rounding:Au(t,0,8),Vi(r,e+Wo(r)+1,t))};Dr.toExponential=function(e,t){var r,n=this,l=n.constructor;return e===void 0?r=Em(n,!0):(Au(e,0,bv),t===void 0?t=l.rounding:Au(t,0,8),n=Vi(new l(n),e+1,t),r=Em(n,!0,e+1)),r};Dr.toFixed=function(e,t){var r,n,l=this,h=l.constructor;return e===void 0?Em(l):(Au(e,0,bv),t===void 0?t=h.rounding:Au(t,0,8),n=Vi(new h(l),e+Wo(l)+1,t),r=Em(n.abs(),!1,e+Wo(n)+1),l.isneg()&&!l.isZero()?"-"+r:r)};Dr.toInteger=Dr.toint=function(){var e=this,t=e.constructor;return Vi(new t(e),Wo(e)+1,t.rounding)};Dr.toNumber=function(){return+this};Dr.toPower=Dr.pow=function(e){var t,r,n,l,h,f,o=this,v=o.constructor,b=12,E=+(e=new v(e));if(!e.s)return new v(ll);if(o=new v(o),!o.s){if(e.s<1)throw Error(Vl+"Infinity");return o}if(o.eq(ll))return o;if(n=v.precision,e.eq(ll))return Vi(o,n);if(t=e.e,r=e.d.length-1,f=t>=r,h=o.s,f){if((r=E<0?-E:E)<=hee){for(l=new v(ll),t=Math.ceil(n/oo+4),uo=!1;r%2&&(l=l.times(o),z8(l.d,t)),r=wv(r/2),r!==0;)o=o.times(o),z8(o.d,t);return uo=!0,e.s<0?new v(ll).div(l):Vi(l,n)}}else if(h<0)throw Error(Vl+"NaN");return h=h<0&&e.d[Math.max(t,r)]&1?-1:1,o.s=1,uo=!1,l=e.times(fw(o,n+b)),uo=!0,l=fee(l),l.s=h,l};Dr.toPrecision=function(e,t){var r,n,l=this,h=l.constructor;return e===void 0?(r=Wo(l),n=Em(l,r<=h.toExpNeg||r>=h.toExpPos)):(Au(e,1,bv),t===void 0?t=h.rounding:Au(t,0,8),l=Vi(new h(l),e,t),r=Wo(l),n=Em(l,e<=r||r<=h.toExpNeg,e)),n};Dr.toSignificantDigits=Dr.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Au(e,1,bv),t===void 0?t=n.rounding:Au(t,0,8)),Vi(new n(r),e,t)};Dr.toString=Dr.valueOf=Dr.val=Dr.toJSON=Dr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Wo(e),r=e.constructor;return Em(e,t<=r.toExpNeg||t>=r.toExpPos)};function dee(e,t){var r,n,l,h,f,o,v,b,E=e.constructor,P=E.precision;if(!e.s||!t.s)return t.s||(t=new E(e)),uo?Vi(t,P):t;if(v=e.d,b=t.d,f=e.e,l=t.e,v=v.slice(),h=f-l,h){for(h<0?(n=v,h=-h,o=b.length):(n=b,l=f,o=v.length),f=Math.ceil(P/oo),o=f>o?f+1:o+1,h>o&&(h=o,n.length=1),n.reverse();h--;)n.push(0);n.reverse()}for(o=v.length,h=b.length,o-h<0&&(h=o,n=b,b=v,v=n),r=0;h;)r=(v[--h]=v[h]+b[h]+r)/_s|0,v[h]%=_s;for(r&&(v.unshift(r),++l),o=v.length;v[--o]==0;)v.pop();return t.d=v,t.e=l,uo?Vi(t,P):t}function Au(e,t,r){if(e!==~~e||e<t||e>r)throw Error(um+e)}function pu(e){var t,r,n,l=e.length-1,h="",f=e[0];if(l>0){for(h+=f,t=1;t<l;t++)n=e[t]+"",r=oo-n.length,r&&(h+=Ud(r)),h+=n;f=e[t],n=f+"",r=oo-n.length,r&&(h+=Ud(r))}else if(f===0)return"0";for(;f%10===0;)f/=10;return h+f}var _h=function(){function e(n,l){var h,f=0,o=n.length;for(n=n.slice();o--;)h=n[o]*l+f,n[o]=h%_s|0,f=h/_s|0;return f&&n.unshift(f),n}function t(n,l,h,f){var o,v;if(h!=f)v=h>f?1:-1;else for(o=v=0;o<h;o++)if(n[o]!=l[o]){v=n[o]>l[o]?1:-1;break}return v}function r(n,l,h){for(var f=0;h--;)n[h]-=f,f=n[h]<l[h]?1:0,n[h]=f*_s+n[h]-l[h];for(;!n[0]&&n.length>1;)n.shift()}return function(n,l,h,f){var o,v,b,E,P,O,L,B,z,$,U,G,Z,ne,Y,ee,le,fe,Ce=n.constructor,Oe=n.s==l.s?1:-1,Me=n.d,Ke=l.d;if(!n.s)return new Ce(n);if(!l.s)throw Error(Vl+"Division by zero");for(v=n.e-l.e,le=Ke.length,Y=Me.length,L=new Ce(Oe),B=L.d=[],b=0;Ke[b]==(Me[b]||0);)++b;if(Ke[b]>(Me[b]||0)&&--v,h==null?G=h=Ce.precision:f?G=h+(Wo(n)-Wo(l))+1:G=h,G<0)return new Ce(0);if(G=G/oo+2|0,b=0,le==1)for(E=0,Ke=Ke[0],G++;(b<Y||E)&&G--;b++)Z=E*_s+(Me[b]||0),B[b]=Z/Ke|0,E=Z%Ke|0;else{for(E=_s/(Ke[0]+1)|0,E>1&&(Ke=e(Ke,E),Me=e(Me,E),le=Ke.length,Y=Me.length),ne=le,z=Me.slice(0,le),$=z.length;$<le;)z[$++]=0;fe=Ke.slice(),fe.unshift(0),ee=Ke[0],Ke[1]>=_s/2&&++ee;do E=0,o=t(Ke,z,le,$),o<0?(U=z[0],le!=$&&(U=U*_s+(z[1]||0)),E=U/ee|0,E>1?(E>=_s&&(E=_s-1),P=e(Ke,E),O=P.length,$=z.length,o=t(P,z,O,$),o==1&&(E--,r(P,le<O?fe:Ke,O))):(E==0&&(o=E=1),P=Ke.slice()),O=P.length,O<$&&P.unshift(0),r(z,P,$),o==-1&&($=z.length,o=t(Ke,z,le,$),o<1&&(E++,r(z,le<$?fe:Ke,$))),$=z.length):o===0&&(E++,z=[0]),B[b++]=E,o&&z[0]?z[$++]=Me[ne]||0:(z=[Me[ne]],$=1);while((ne++<Y||z[0]!==void 0)&&G--)}return B[0]||B.shift(),L.e=v,Vi(L,f?h+Wo(L)+1:h)}}();function fee(e,t){var r,n,l,h,f,o,v=0,b=0,E=e.constructor,P=E.precision;if(Wo(e)>16)throw Error(M3+Wo(e));if(!e.s)return new E(ll);for(uo=!1,o=P,f=new E(.03125);e.abs().gte(.1);)e=e.times(f),b+=5;for(n=Math.log(Bp(2,b))/Math.LN10*2+5|0,o+=n,r=l=h=new E(ll),E.precision=o;;){if(l=Vi(l.times(e),o),r=r.times(++v),f=h.plus(_h(l,r,o)),pu(f.d).slice(0,o)===pu(h.d).slice(0,o)){for(;b--;)h=Vi(h.times(h),o);return E.precision=P,t==null?(uo=!0,Vi(h,P)):h}h=f}}function Wo(e){for(var t=e.e*oo,r=e.d[0];r>=10;r/=10)t++;return t}function NO(e,t,r){if(t>e.LN10.sd())throw uo=!0,r&&(e.precision=r),Error(Vl+"LN10 precision limit exceeded");return Vi(new e(e.LN10),t)}function Ud(e){for(var t="";e--;)t+="0";return t}function fw(e,t){var r,n,l,h,f,o,v,b,E,P=1,O=10,L=e,B=L.d,z=L.constructor,$=z.precision;if(L.s<1)throw Error(Vl+(L.s?"NaN":"-Infinity"));if(L.eq(ll))return new z(0);if(t==null?(uo=!1,b=$):b=t,L.eq(10))return t==null&&(uo=!0),NO(z,b);if(b+=O,z.precision=b,r=pu(B),n=r.charAt(0),h=Wo(L),Math.abs(h)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)L=L.times(e),r=pu(L.d),n=r.charAt(0),P++;h=Wo(L),n>1?(L=new z("0."+r),h++):L=new z(n+"."+r.slice(1))}else return v=NO(z,b+2,$).times(h+""),L=fw(new z(n+"."+r.slice(1)),b-O).plus(v),z.precision=$,t==null?(uo=!0,Vi(L,$)):L;for(o=f=L=_h(L.minus(ll),L.plus(ll),b),E=Vi(L.times(L),b),l=3;;){if(f=Vi(f.times(E),b),v=o.plus(_h(f,new z(l),b)),pu(v.d).slice(0,b)===pu(o.d).slice(0,b))return o=o.times(2),h!==0&&(o=o.plus(NO(z,b+2,$).times(h+""))),o=_h(o,new z(P),b),z.precision=$,t==null?(uo=!0,Vi(o,$)):o;o=v,l+=2}}function N8(e,t){var r,n,l;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(l=t.length;t.charCodeAt(l-1)===48;)--l;if(t=t.slice(n,l),t){if(l-=n,r=r-n-1,e.e=wv(r/oo),e.d=[],n=(r+1)%oo,r<0&&(n+=oo),n<l){for(n&&e.d.push(+t.slice(0,n)),l-=oo;n<l;)e.d.push(+t.slice(n,n+=oo));t=t.slice(n),n=oo-t.length}else n-=l;for(;n--;)t+="0";if(e.d.push(+t),uo&&(e.e>$2||e.e<-$2))throw Error(M3+r)}else e.s=0,e.e=0,e.d=[0];return e}function Vi(e,t,r){var n,l,h,f,o,v,b,E,P=e.d;for(f=1,h=P[0];h>=10;h/=10)f++;if(n=t-f,n<0)n+=oo,l=t,b=P[E=0];else{if(E=Math.ceil((n+1)/oo),h=P.length,E>=h)return e;for(b=h=P[E],f=1;h>=10;h/=10)f++;n%=oo,l=n-oo+f}if(r!==void 0&&(h=Bp(10,f-l-1),o=b/h%10|0,v=t<0||P[E+1]!==void 0||b%h,v=r<4?(o||v)&&(r==0||r==(e.s<0?3:2)):o>5||o==5&&(r==4||v||r==6&&(n>0?l>0?b/Bp(10,f-l):0:P[E-1])%10&1||r==(e.s<0?8:7))),t<1||!P[0])return v?(h=Wo(e),P.length=1,t=t-h-1,P[0]=Bp(10,(oo-t%oo)%oo),e.e=wv(-t/oo)||0):(P.length=1,P[0]=e.e=e.s=0),e;if(n==0?(P.length=E,h=1,E--):(P.length=E+1,h=Bp(10,oo-n),P[E]=l>0?(b/Bp(10,f-l)%Bp(10,l)|0)*h:0),v)for(;;)if(E==0){(P[0]+=h)==_s&&(P[0]=1,++e.e);break}else{if(P[E]+=h,P[E]!=_s)break;P[E--]=0,h=1}for(n=P.length;P[--n]===0;)P.pop();if(uo&&(e.e>$2||e.e<-$2))throw Error(M3+Wo(e));return e}function pee(e,t){var r,n,l,h,f,o,v,b,E,P,O=e.constructor,L=O.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new O(e),uo?Vi(t,L):t;if(v=e.d,P=t.d,n=t.e,b=e.e,v=v.slice(),f=b-n,f){for(E=f<0,E?(r=v,f=-f,o=P.length):(r=P,n=b,o=v.length),l=Math.max(Math.ceil(L/oo),o)+2,f>l&&(f=l,r.length=1),r.reverse(),l=f;l--;)r.push(0);r.reverse()}else{for(l=v.length,o=P.length,E=l<o,E&&(o=l),l=0;l<o;l++)if(v[l]!=P[l]){E=v[l]<P[l];break}f=0}for(E&&(r=v,v=P,P=r,t.s=-t.s),o=v.length,l=P.length-o;l>0;--l)v[o++]=0;for(l=P.length;l>f;){if(v[--l]<P[l]){for(h=l;h&&v[--h]===0;)v[h]=_s-1;--v[h],v[l]+=_s}v[l]-=P[l]}for(;v[--o]===0;)v.pop();for(;v[0]===0;v.shift())--n;return v[0]?(t.d=v,t.e=n,uo?Vi(t,L):t):new O(0)}function Em(e,t,r){var n,l=Wo(e),h=pu(e.d),f=h.length;return t?(r&&(n=r-f)>0?h=h.charAt(0)+"."+h.slice(1)+Ud(n):f>1&&(h=h.charAt(0)+"."+h.slice(1)),h=h+(l<0?"e":"e+")+l):l<0?(h="0."+Ud(-l-1)+h,r&&(n=r-f)>0&&(h+=Ud(n))):l>=f?(h+=Ud(l+1-f),r&&(n=r-l-1)>0&&(h=h+"."+Ud(n))):((n=l+1)<f&&(h=h.slice(0,n)+"."+h.slice(n)),r&&(n=r-f)>0&&(l+1===f&&(h+="."),h+=Ud(n))),e.s<0?"-"+h:h}function z8(e,t){if(e.length>t)return e.length=t,!0}function mee(e){var t,r,n;function l(h){var f=this;if(!(f instanceof l))return new l(h);if(f.constructor=l,h instanceof l){f.s=h.s,f.e=h.e,f.d=(h=h.d)?h.slice():h;return}if(typeof h=="number"){if(h*0!==0)throw Error(um+h);if(h>0)f.s=1;else if(h<0)h=-h,f.s=-1;else{f.s=0,f.e=0,f.d=[0];return}if(h===~~h&&h<1e7){f.e=0,f.d=[h];return}return N8(f,h.toString())}else if(typeof h!="string")throw Error(um+h);if(h.charCodeAt(0)===45?(h=h.slice(1),f.s=-1):f.s=1,j3e.test(h))N8(f,h);else throw Error(um+h)}if(l.prototype=Dr,l.ROUND_UP=0,l.ROUND_DOWN=1,l.ROUND_CEIL=2,l.ROUND_FLOOR=3,l.ROUND_HALF_UP=4,l.ROUND_HALF_DOWN=5,l.ROUND_HALF_EVEN=6,l.ROUND_HALF_CEIL=7,l.ROUND_HALF_FLOOR=8,l.clone=mee,l.config=l.set=N3e,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return l.config(e),l}function N3e(e){if(!e||typeof e!="object")throw Error(Vl+"Object expected");var t,r,n,l=["precision",1,bv,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<l.length;t+=3)if((n=e[r=l[t]])!==void 0)if(wv(n)===n&&n>=l[t+1]&&n<=l[t+2])this[r]=n;else throw Error(um+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(um+r+": "+n);return this}var O3=mee(L3e);ll=new O3(1);const Fi=O3;function z3e(e){return V3e(e)||$3e(e)||B3e(e)||F3e()}function F3e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B3e(e,t){if(e){if(typeof e=="string")return ED(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ED(e,t)}}function $3e(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function V3e(e){if(Array.isArray(e))return ED(e)}function ED(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var U3e=function(t){return t},gee={},yee=function(t){return t===gee},F8=function(t){return function r(){return arguments.length===0||arguments.length===1&&yee(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},G3e=function e(t,r){return t===1?r:F8(function(){for(var n=arguments.length,l=new Array(n),h=0;h<n;h++)l[h]=arguments[h];var f=l.filter(function(o){return o!==gee}).length;return f>=t?r.apply(void 0,l):e(t-f,F8(function(){for(var o=arguments.length,v=new Array(o),b=0;b<o;b++)v[b]=arguments[b];var E=l.map(function(P){return yee(P)?v.shift():P});return r.apply(void 0,z3e(E).concat(v))}))})},YP=function(t){return G3e(t.length,t)},AD=function(t,r){for(var n=[],l=t;l<r;++l)n[l-t]=l;return n},H3e=YP(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),W3e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return U3e;var l=r.reverse(),h=l[0],f=l.slice(1);return function(){return f.reduce(function(o,v){return v(o)},h.apply(void 0,arguments))}},PD=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},_ee=function(t){var r=null,n=null;return function(){for(var l=arguments.length,h=new Array(l),f=0;f<l;f++)h[f]=arguments[f];return r&&h.every(function(o,v){return o===r[v]})||(r=h,n=t.apply(void 0,h)),n}};function q3e(e){var t;return e===0?t=1:t=Math.floor(new Fi(e).abs().log(10).toNumber())+1,t}function Z3e(e,t,r){for(var n=new Fi(e),l=0,h=[];n.lt(t)&&l<1e5;)h.push(n.toNumber()),n=n.add(r),l++;return h}var X3e=YP(function(e,t,r){var n=+e,l=+t;return n+r*(l-n)}),K3e=YP(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),Y3e=YP(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const JP={rangeStep:Z3e,getDigitCount:q3e,interpolateNumber:X3e,uninterpolateNumber:K3e,uninterpolateTruncation:Y3e};function CD(e){return eze(e)||Q3e(e)||vee(e)||J3e()}function J3e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q3e(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function eze(e){if(Array.isArray(e))return ID(e)}function pw(e,t){return nze(e)||rze(e,t)||vee(e,t)||tze()}function tze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vee(e,t){if(e){if(typeof e=="string")return ID(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ID(e,t)}}function ID(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function rze(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,l=!1,h=void 0;try{for(var f=e[Symbol.iterator](),o;!(n=(o=f.next()).done)&&(r.push(o.value),!(t&&r.length===t));n=!0);}catch(v){l=!0,h=v}finally{try{!n&&f.return!=null&&f.return()}finally{if(l)throw h}}return r}}function nze(e){if(Array.isArray(e))return e}function xee(e){var t=pw(e,2),r=t[0],n=t[1],l=r,h=n;return r>n&&(l=n,h=r),[l,h]}function bee(e,t,r){if(e.lte(0))return new Fi(0);var n=JP.getDigitCount(e.toNumber()),l=new Fi(10).pow(n),h=e.div(l),f=n!==1?.05:.1,o=new Fi(Math.ceil(h.div(f).toNumber())).add(r).mul(f),v=o.mul(l);return t?v:new Fi(Math.ceil(v))}function ize(e,t,r){var n=1,l=new Fi(e);if(!l.isint()&&r){var h=Math.abs(e);h<1?(n=new Fi(10).pow(JP.getDigitCount(e)-1),l=new Fi(Math.floor(l.div(n).toNumber())).mul(n)):h>1&&(l=new Fi(Math.floor(e)))}else e===0?l=new Fi(Math.floor((t-1)/2)):r||(l=new Fi(Math.floor(e)));var f=Math.floor((t-1)/2),o=W3e(H3e(function(v){return l.add(new Fi(v-f).mul(n)).toNumber()}),AD);return o(0,t)}function wee(e,t,r,n){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Fi(0),tickMin:new Fi(0),tickMax:new Fi(0)};var h=bee(new Fi(t).sub(e).div(r-1),n,l),f;e<=0&&t>=0?f=new Fi(0):(f=new Fi(e).add(t).div(2),f=f.sub(new Fi(f).mod(h)));var o=Math.ceil(f.sub(e).div(h).toNumber()),v=Math.ceil(new Fi(t).sub(f).div(h).toNumber()),b=o+v+1;return b>r?wee(e,t,r,n,l+1):(b<r&&(v=t>0?v+(r-b):v,o=t>0?o:o+(r-b)),{step:h,tickMin:f.sub(new Fi(o).mul(h)),tickMax:f.add(new Fi(v).mul(h))})}function oze(e){var t=pw(e,2),r=t[0],n=t[1],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=Math.max(l,2),o=xee([r,n]),v=pw(o,2),b=v[0],E=v[1];if(b===-1/0||E===1/0){var P=E===1/0?[b].concat(CD(AD(0,l-1).map(function(){return 1/0}))):[].concat(CD(AD(0,l-1).map(function(){return-1/0})),[E]);return r>n?PD(P):P}if(b===E)return ize(b,l,h);var O=wee(b,E,f,h),L=O.step,B=O.tickMin,z=O.tickMax,$=JP.rangeStep(B,z.add(new Fi(.1).mul(L)),L);return r>n?PD($):$}function sze(e,t){var r=pw(e,2),n=r[0],l=r[1],h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=xee([n,l]),o=pw(f,2),v=o[0],b=o[1];if(v===-1/0||b===1/0)return[n,l];if(v===b)return[v];var E=Math.max(t,2),P=bee(new Fi(b).sub(v).div(E-1),h,0),O=[].concat(CD(JP.rangeStep(new Fi(v),new Fi(b).sub(new Fi(.99).mul(P)),P)),[b]);return n>l?PD(O):O}var aze=_ee(oze),lze=_ee(sze),cze="Invariant failed";function Am(e,t){throw new Error(cze)}var uze=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function R_(e){"@babel/helpers - typeof";return R_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R_(e)}function V2(){return V2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V2.apply(this,arguments)}function hze(e,t){return mze(e)||pze(e,t)||fze(e,t)||dze()}function dze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fze(e,t){if(e){if(typeof e=="string")return B8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B8(e,t)}}function B8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pze(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function mze(e){if(Array.isArray(e))return e}function gze(e,t){if(e==null)return{};var r=yze(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function yze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function _ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vze(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Eee(n.key),n)}}function xze(e,t,r){return t&&vze(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function bze(e,t,r){return t=U2(t),wze(e,See()?Reflect.construct(t,r||[],U2(e).constructor):t.apply(e,r))}function wze(e,t){if(t&&(R_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Sze(e)}function Sze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function See(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(See=function(){return!!e})()}function U2(e){return U2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},U2(e)}function Tze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MD(e,t)}function MD(e,t){return MD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},MD(e,t)}function Tee(e,t,r){return t=Eee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Eee(e){var t=Eze(e,"string");return R_(t)=="symbol"?t:t+""}function Eze(e,t){if(R_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(R_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var QP=function(e){function t(){return _ze(this,t),bze(this,t,arguments)}return Tze(t,e),xze(t,[{key:"render",value:function(){var n=this.props,l=n.offset,h=n.layout,f=n.width,o=n.dataKey,v=n.data,b=n.dataPointFormatter,E=n.xAxis,P=n.yAxis,O=gze(n,uze),L=wn(O,!1);this.props.direction==="x"&&E.type!=="number"&&Am();var B=v.map(function(z){var $=b(z,o),U=$.x,G=$.y,Z=$.value,ne=$.errorVal;if(!ne)return null;var Y=[],ee,le;if(Array.isArray(ne)){var fe=hze(ne,2);ee=fe[0],le=fe[1]}else ee=le=ne;if(h==="vertical"){var Ce=E.scale,Oe=G+l,Me=Oe+f,Ke=Oe-f,Ye=Ce(Z-ee),Le=Ce(Z+le);Y.push({x1:Le,y1:Me,x2:Le,y2:Ke}),Y.push({x1:Ye,y1:Oe,x2:Le,y2:Oe}),Y.push({x1:Ye,y1:Me,x2:Ye,y2:Ke})}else if(h==="horizontal"){var Qe=P.scale,Je=U+l,it=Je-f,Ze=Je+f,nt=Qe(Z-ee),pt=Qe(Z+le);Y.push({x1:it,y1:pt,x2:Ze,y2:pt}),Y.push({x1:Je,y1:nt,x2:Je,y2:pt}),Y.push({x1:it,y1:nt,x2:Ze,y2:nt})}return ze.createElement(Li,V2({className:"recharts-errorBar",key:"bar-".concat(Y.map(function(_t){return"".concat(_t.x1,"-").concat(_t.x2,"-").concat(_t.y1,"-").concat(_t.y2)}))},L),Y.map(function(_t){return ze.createElement("line",V2({},_t,{key:"line-".concat(_t.x1,"-").concat(_t.x2,"-").concat(_t.y1,"-").concat(_t.y2)}))}))});return ze.createElement(Li,{className:"recharts-errorBars"},B)}}])}(ze.Component);Tee(QP,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});Tee(QP,"displayName","ErrorBar");function mw(e){"@babel/helpers - typeof";return mw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mw(e)}function $8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Op(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$8(Object(r),!0).forEach(function(n){Aze(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Aze(e,t,r){return t=Pze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pze(e){var t=Cze(e,"string");return mw(t)=="symbol"?t:t+""}function Cze(e,t){if(mw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(mw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Aee=function(t){var r=t.children,n=t.formattedGraphicalItems,l=t.legendWidth,h=t.legendContent,f=sl(r,e_);if(!f)return null;var o=e_.defaultProps,v=o!==void 0?Op(Op({},o),f.props):{},b;return f.props&&f.props.payload?b=f.props&&f.props.payload:h==="children"?b=(n||[]).reduce(function(E,P){var O=P.item,L=P.props,B=L.sectors||L.data||[];return E.concat(B.map(function(z){return{type:f.props.iconType||O.props.legendType,value:z.name,color:z.fill,payload:z}}))},[]):b=(n||[]).map(function(E){var P=E.item,O=P.type.defaultProps,L=O!==void 0?Op(Op({},O),P.props):{},B=L.dataKey,z=L.name,$=L.legendType,U=L.hide;return{inactive:U,dataKey:B,type:v.iconType||$||"square",color:k3(P),value:z||B,payload:L}}),Op(Op(Op({},v),e_.getWithHeight(f,l)),{},{payload:b,item:f})};function gw(e){"@babel/helpers - typeof";return gw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gw(e)}function V8(e){return kze(e)||Oze(e)||Mze(e)||Ize()}function Ize(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mze(e,t){if(e){if(typeof e=="string")return OD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return OD(e,t)}}function Oze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function kze(e){if(Array.isArray(e))return OD(e)}function OD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function U8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Io(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U8(Object(r),!0).forEach(function(n){r_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function r_(e,t,r){return t=Rze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Rze(e){var t=Dze(e,"string");return gw(t)=="symbol"?t:t+""}function Dze(e,t){if(gw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ks(e,t,r){return ni(e)||ni(t)?r:as(t)?dl(e,t,r):In(t)?t(e):r}function Sb(e,t,r,n){var l=O3e(e,function(o){return Ks(o,t)});if(r==="number"){var h=l.filter(function(o){return pr(o)||parseFloat(o)});return h.length?[XP(h),ZP(h)]:[1/0,-1/0]}var f=n?l.filter(function(o){return!ni(o)}):l;return f.map(function(o){return as(o)||o instanceof Date?o:""})}var Lze=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],l=arguments.length>2?arguments[2]:void 0,h=arguments.length>3?arguments[3]:void 0,f=-1,o=(r=n?.length)!==null&&r!==void 0?r:0;if(o<=1)return 0;if(h&&h.axisType==="angleAxis"&&Math.abs(Math.abs(h.range[1]-h.range[0])-360)<=1e-6)for(var v=h.range,b=0;b<o;b++){var E=b>0?l[b-1].coordinate:l[o-1].coordinate,P=l[b].coordinate,O=b>=o-1?l[0].coordinate:l[b+1].coordinate,L=void 0;if(ya(P-E)!==ya(O-P)){var B=[];if(ya(O-P)===ya(v[1]-v[0])){L=O;var z=P+v[1]-v[0];B[0]=Math.min(z,(z+E)/2),B[1]=Math.max(z,(z+E)/2)}else{L=E;var $=O+v[1]-v[0];B[0]=Math.min(P,($+P)/2),B[1]=Math.max(P,($+P)/2)}var U=[Math.min(P,(L+P)/2),Math.max(P,(L+P)/2)];if(t>U[0]&&t<=U[1]||t>=B[0]&&t<=B[1]){f=l[b].index;break}}else{var G=Math.min(E,O),Z=Math.max(E,O);if(t>(G+P)/2&&t<=(Z+P)/2){f=l[b].index;break}}}else for(var ne=0;ne<o;ne++)if(ne===0&&t<=(n[ne].coordinate+n[ne+1].coordinate)/2||ne>0&&ne<o-1&&t>(n[ne].coordinate+n[ne-1].coordinate)/2&&t<=(n[ne].coordinate+n[ne+1].coordinate)/2||ne===o-1&&t>(n[ne].coordinate+n[ne-1].coordinate)/2){f=n[ne].index;break}return f},k3=function(t){var r,n=t,l=n.type.displayName,h=(r=t.type)!==null&&r!==void 0&&r.defaultProps?Io(Io({},t.type.defaultProps),t.props):t.props,f=h.stroke,o=h.fill,v;switch(l){case"Line":v=f;break;case"Area":case"Radar":v=f&&f!=="none"?f:o;break;default:v=o;break}return v},jze=function(t){var r=t.barSize,n=t.totalSize,l=t.stackGroups,h=l===void 0?{}:l;if(!h)return{};for(var f={},o=Object.keys(h),v=0,b=o.length;v<b;v++)for(var E=h[o[v]].stackGroups,P=Object.keys(E),O=0,L=P.length;O<L;O++){var B=E[P[O]],z=B.items,$=B.cateAxisId,U=z.filter(function(le){return yh(le.type).indexOf("Bar")>=0});if(U&&U.length){var G=U[0].type.defaultProps,Z=G!==void 0?Io(Io({},G),U[0].props):U[0].props,ne=Z.barSize,Y=Z[$];f[Y]||(f[Y]=[]);var ee=ni(ne)?r:ne;f[Y].push({item:U[0],stackList:U.slice(1),barSize:ni(ee)?void 0:_a(ee,n,0)})}}return f},Nze=function(t){var r=t.barGap,n=t.barCategoryGap,l=t.bandSize,h=t.sizeList,f=h===void 0?[]:h,o=t.maxBarSize,v=f.length;if(v<1)return null;var b=_a(r,l,0,!0),E,P=[];if(f[0].barSize===+f[0].barSize){var O=!1,L=l/v,B=f.reduce(function(ne,Y){return ne+Y.barSize||0},0);B+=(v-1)*b,B>=l&&(B-=(v-1)*b,b=0),B>=l&&L>0&&(O=!0,L*=.9,B=v*L);var z=(l-B)/2>>0,$={offset:z-b,size:0};E=f.reduce(function(ne,Y){var ee={item:Y.item,position:{offset:$.offset+$.size+b,size:O?L:Y.barSize}},le=[].concat(V8(ne),[ee]);return $=le[le.length-1].position,Y.stackList&&Y.stackList.length&&Y.stackList.forEach(function(fe){le.push({item:fe,position:$})}),le},P)}else{var U=_a(n,l,0,!0);l-2*U-(v-1)*b<=0&&(b=0);var G=(l-2*U-(v-1)*b)/v;G>1&&(G>>=0);var Z=o===+o?Math.min(G,o):G;E=f.reduce(function(ne,Y,ee){var le=[].concat(V8(ne),[{item:Y.item,position:{offset:U+(G+b)*ee+(G-Z)/2,size:Z}}]);return Y.stackList&&Y.stackList.length&&Y.stackList.forEach(function(fe){le.push({item:fe,position:le[le.length-1].position})}),le},P)}return E},zze=function(t,r,n,l){var h=n.children,f=n.width,o=n.margin,v=f-(o.left||0)-(o.right||0),b=Aee({children:h,legendWidth:v});if(b){var E=l||{},P=E.width,O=E.height,L=b.align,B=b.verticalAlign,z=b.layout;if((z==="vertical"||z==="horizontal"&&B==="middle")&&L!=="center"&&pr(t[L]))return Io(Io({},t),{},r_({},L,t[L]+(P||0)));if((z==="horizontal"||z==="vertical"&&L==="center")&&B!=="middle"&&pr(t[B]))return Io(Io({},t),{},r_({},B,t[B]+(O||0)))}return t},Fze=function(t,r,n){return ni(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},Pee=function(t,r,n,l,h){var f=r.props.children,o=zl(f,QP).filter(function(b){return Fze(l,h,b.props.direction)});if(o&&o.length){var v=o.map(function(b){return b.props.dataKey});return t.reduce(function(b,E){var P=Ks(E,n);if(ni(P))return b;var O=Array.isArray(P)?[XP(P),ZP(P)]:[P,P],L=v.reduce(function(B,z){var $=Ks(E,z,0),U=O[0]-Math.abs(Array.isArray($)?$[0]:$),G=O[1]+Math.abs(Array.isArray($)?$[1]:$);return[Math.min(U,B[0]),Math.max(G,B[1])]},[1/0,-1/0]);return[Math.min(L[0],b[0]),Math.max(L[1],b[1])]},[1/0,-1/0])}return null},Bze=function(t,r,n,l,h){var f=r.map(function(o){return Pee(t,o,n,h,l)}).filter(function(o){return!ni(o)});return f&&f.length?f.reduce(function(o,v){return[Math.min(o[0],v[0]),Math.max(o[1],v[1])]},[1/0,-1/0]):null},Cee=function(t,r,n,l,h){var f=r.map(function(v){var b=v.props.dataKey;return n==="number"&&b&&Pee(t,v,b,l)||Sb(t,b,n,h)});if(n==="number")return f.reduce(function(v,b){return[Math.min(v[0],b[0]),Math.max(v[1],b[1])]},[1/0,-1/0]);var o={};return f.reduce(function(v,b){for(var E=0,P=b.length;E<P;E++)o[b[E]]||(o[b[E]]=!0,v.push(b[E]));return v},[])},Iee=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},Mee=function(t,r,n,l){if(l)return t.map(function(v){return v.coordinate});var h,f,o=t.map(function(v){return v.coordinate===r&&(h=!0),v.coordinate===n&&(f=!0),v.coordinate});return h||o.push(r),f||o.push(n),o},mh=function(t,r,n){if(!t)return null;var l=t.scale,h=t.duplicateDomain,f=t.type,o=t.range,v=t.realScaleType==="scaleBand"?l.bandwidth()/2:2,b=(r||n)&&f==="category"&&l.bandwidth?l.bandwidth()/v:0;if(b=t.axisType==="angleAxis"&&o?.length>=2?ya(o[0]-o[1])*2*b:b,r&&(t.ticks||t.niceTicks)){var E=(t.ticks||t.niceTicks).map(function(P){var O=h?h.indexOf(P):P;return{coordinate:l(O)+b,value:P,offset:b}});return E.filter(function(P){return!t1(P.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(P,O){return{coordinate:l(P)+b,value:P,index:O,offset:b}}):l.ticks&&!n?l.ticks(t.tickCount).map(function(P){return{coordinate:l(P)+b,value:P,offset:b}}):l.domain().map(function(P,O){return{coordinate:l(P)+b,value:h?h[P]:P,index:O,offset:b}})},zO=new WeakMap,JT=function(t,r){if(typeof r!="function")return t;zO.has(t)||zO.set(t,new WeakMap);var n=zO.get(t);if(n.has(r))return n.get(r);var l=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,l),l},Oee=function(t,r,n){var l=t.scale,h=t.type,f=t.layout,o=t.axisType;if(l==="auto")return f==="radial"&&o==="radiusAxis"?{scale:lw(),realScaleType:"band"}:f==="radial"&&o==="angleAxis"?{scale:N2(),realScaleType:"linear"}:h==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:wb(),realScaleType:"point"}:h==="category"?{scale:lw(),realScaleType:"band"}:{scale:N2(),realScaleType:"linear"};if(wm(l)){var v="scale".concat(DP(l));return{scale:(j8[v]||wb)(),realScaleType:j8[v]?v:"point"}}return In(l)?{scale:l}:{scale:wb(),realScaleType:"point"}},G8=1e-4,kee=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,l=t.range(),h=Math.min(l[0],l[1])-G8,f=Math.max(l[0],l[1])+G8,o=t(r[0]),v=t(r[n-1]);(o<h||o>f||v<h||v>f)&&t.domain([r[0],r[n-1]])}},$ze=function(t,r){if(!t)return null;for(var n=0,l=t.length;n<l;n++)if(t[n].item===r)return t[n].position;return null},Vze=function(t,r){if(!r||r.length!==2||!pr(r[0])||!pr(r[1]))return t;var n=Math.min(r[0],r[1]),l=Math.max(r[0],r[1]),h=[t[0],t[1]];return(!pr(t[0])||t[0]<n)&&(h[0]=n),(!pr(t[1])||t[1]>l)&&(h[1]=l),h[0]>l&&(h[0]=l),h[1]<n&&(h[1]=n),h},Uze=function(t){var r=t.length;if(!(r<=0))for(var n=0,l=t[0].length;n<l;++n)for(var h=0,f=0,o=0;o<r;++o){var v=t1(t[o][n][1])?t[o][n][0]:t[o][n][1];v>=0?(t[o][n][0]=h,t[o][n][1]=h+v,h=t[o][n][1]):(t[o][n][0]=f,t[o][n][1]=f+v,f=t[o][n][1])}},Gze=function(t){var r=t.length;if(!(r<=0))for(var n=0,l=t[0].length;n<l;++n)for(var h=0,f=0;f<r;++f){var o=t1(t[f][n][1])?t[f][n][0]:t[f][n][1];o>=0?(t[f][n][0]=h,t[f][n][1]=h+o,h=t[f][n][1]):(t[f][n][0]=0,t[f][n][1]=0)}},Hze={sign:Uze,expand:nAe,none:E_,silhouette:iAe,wiggle:oAe,positive:Gze},Wze=function(t,r,n){var l=r.map(function(o){return o.props.dataKey}),h=Hze[n],f=rAe().keys(l).value(function(o,v){return+Ks(o,v,0)}).order(nD).offset(h);return f(t)},qze=function(t,r,n,l,h,f){if(!t)return null;var o=f?r.reverse():r,v={},b=o.reduce(function(P,O){var L,B=(L=O.type)!==null&&L!==void 0&&L.defaultProps?Io(Io({},O.type.defaultProps),O.props):O.props,z=B.stackId,$=B.hide;if($)return P;var U=B[n],G=P[U]||{hasStack:!1,stackGroups:{}};if(as(z)){var Z=G.stackGroups[z]||{numericAxisId:n,cateAxisId:l,items:[]};Z.items.push(O),G.hasStack=!0,G.stackGroups[z]=Z}else G.stackGroups[r1("_stackId_")]={numericAxisId:n,cateAxisId:l,items:[O]};return Io(Io({},P),{},r_({},U,G))},v),E={};return Object.keys(b).reduce(function(P,O){var L=b[O];if(L.hasStack){var B={};L.stackGroups=Object.keys(L.stackGroups).reduce(function(z,$){var U=L.stackGroups[$];return Io(Io({},z),{},r_({},$,{numericAxisId:n,cateAxisId:l,items:U.items,stackedData:Wze(t,U.items,h)}))},B)}return Io(Io({},P),{},r_({},O,L))},E)},Ree=function(t,r){var n=r.realScaleType,l=r.type,h=r.tickCount,f=r.originalDomain,o=r.allowDecimals,v=n||r.scale;if(v!=="auto"&&v!=="linear")return null;if(h&&l==="number"&&f&&(f[0]==="auto"||f[1]==="auto")){var b=t.domain();if(!b.length)return null;var E=aze(b,h,o);return t.domain([XP(E),ZP(E)]),{niceTicks:E}}if(h&&l==="number"){var P=t.domain(),O=lze(P,h,o);return{niceTicks:O}}return null},H8=function(t){var r=t.axis,n=t.ticks,l=t.offset,h=t.bandSize,f=t.entry,o=t.index;if(r.type==="category")return n[o]?n[o].coordinate+l:null;var v=Ks(f,r.dataKey,r.domain[o]);return ni(v)?null:r.scale(v)-h/2+l},Zze=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var l=Math.min(n[0],n[1]),h=Math.max(n[0],n[1]);return l<=0&&h>=0?0:h<0?h:l}return n[0]},Xze=function(t,r){var n,l=(n=t.type)!==null&&n!==void 0&&n.defaultProps?Io(Io({},t.type.defaultProps),t.props):t.props,h=l.stackId;if(as(h)){var f=r[h];if(f){var o=f.items.indexOf(t);return o>=0?f.stackedData[o]:null}}return null},Kze=function(t){return t.reduce(function(r,n){return[XP(n.concat([r[0]]).filter(pr)),ZP(n.concat([r[1]]).filter(pr))]},[1/0,-1/0])},Dee=function(t,r,n){return Object.keys(t).reduce(function(l,h){var f=t[h],o=f.stackedData,v=o.reduce(function(b,E){var P=Kze(E.slice(r,n+1));return[Math.min(b[0],P[0]),Math.max(b[1],P[1])]},[1/0,-1/0]);return[Math.min(v[0],l[0]),Math.max(v[1],l[1])]},[1/0,-1/0]).map(function(l){return l===1/0||l===-1/0?0:l})},W8=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,q8=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,kD=function(t,r,n){if(In(t))return t(r,n);if(!Array.isArray(t))return r;var l=[];if(pr(t[0]))l[0]=n?t[0]:Math.min(t[0],r[0]);else if(W8.test(t[0])){var h=+W8.exec(t[0])[1];l[0]=r[0]-h}else In(t[0])?l[0]=t[0](r[0]):l[0]=r[0];if(pr(t[1]))l[1]=n?t[1]:Math.max(t[1],r[1]);else if(q8.test(t[1])){var f=+q8.exec(t[1])[1];l[1]=r[1]+f}else In(t[1])?l[1]=t[1](r[1]):l[1]=r[1];return l},G2=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var l=t.scale.bandwidth();if(!n||l>0)return l}if(t&&r&&r.length>=2){for(var h=a3(r,function(P){return P.coordinate}),f=1/0,o=1,v=h.length;o<v;o++){var b=h[o],E=h[o-1];f=Math.min((b.coordinate||0)-(E.coordinate||0),f)}return f===1/0?0:f}return n?void 0:0},Z8=function(t,r,n){return!t||!t.length||KP(t,dl(n,"type.defaultProps.domain"))?r:t},Lee=function(t,r){var n=t.type.defaultProps?Io(Io({},t.type.defaultProps),t.props):t.props,l=n.dataKey,h=n.name,f=n.unit,o=n.formatter,v=n.tooltipType,b=n.chartType,E=n.hide;return Io(Io({},wn(t,!1)),{},{dataKey:l,unit:f,formatter:o,name:h||l,color:k3(t),value:Ks(r,l),type:v,payload:r,chartType:b,hide:E})};function yw(e){"@babel/helpers - typeof";return yw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yw(e)}function X8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function ah(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?X8(Object(r),!0).forEach(function(n){jee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jee(e,t,r){return t=Yze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Yze(e){var t=Jze(e,"string");return yw(t)=="symbol"?t:t+""}function Jze(e,t){if(yw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(yw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Qze(e,t){return nFe(e)||rFe(e,t)||tFe(e,t)||eFe()}function eFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tFe(e,t){if(e){if(typeof e=="string")return K8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K8(e,t)}}function K8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function rFe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function nFe(e){if(Array.isArray(e))return e}var H2=Math.PI/180,iFe=function(t){return t*180/Math.PI},Qi=function(t,r,n,l){return{x:t+Math.cos(-H2*l)*n,y:r+Math.sin(-H2*l)*n}},Nee=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},oFe=function(t,r,n,l,h){var f=t.width,o=t.height,v=t.startAngle,b=t.endAngle,E=_a(t.cx,f,f/2),P=_a(t.cy,o,o/2),O=Nee(f,o,n),L=_a(t.innerRadius,O,0),B=_a(t.outerRadius,O,O*.8),z=Object.keys(r);return z.reduce(function($,U){var G=r[U],Z=G.domain,ne=G.reversed,Y;if(ni(G.range))l==="angleAxis"?Y=[v,b]:l==="radiusAxis"&&(Y=[L,B]),ne&&(Y=[Y[1],Y[0]]);else{Y=G.range;var ee=Y,le=Qze(ee,2);v=le[0],b=le[1]}var fe=Oee(G,h),Ce=fe.realScaleType,Oe=fe.scale;Oe.domain(Z).range(Y),kee(Oe);var Me=Ree(Oe,ah(ah({},G),{},{realScaleType:Ce})),Ke=ah(ah(ah({},G),Me),{},{range:Y,radius:B,realScaleType:Ce,scale:Oe,cx:E,cy:P,innerRadius:L,outerRadius:B,startAngle:v,endAngle:b});return ah(ah({},$),{},jee({},U,Ke))},{})},sFe=function(t,r){var n=t.x,l=t.y,h=r.x,f=r.y;return Math.sqrt(Math.pow(n-h,2)+Math.pow(l-f,2))},aFe=function(t,r){var n=t.x,l=t.y,h=r.cx,f=r.cy,o=sFe({x:n,y:l},{x:h,y:f});if(o<=0)return{radius:o};var v=(n-h)/o,b=Math.acos(v);return l>f&&(b=2*Math.PI-b),{radius:o,angle:iFe(b),angleInRadian:b}},lFe=function(t){var r=t.startAngle,n=t.endAngle,l=Math.floor(r/360),h=Math.floor(n/360),f=Math.min(l,h);return{startAngle:r-f*360,endAngle:n-f*360}},cFe=function(t,r){var n=r.startAngle,l=r.endAngle,h=Math.floor(n/360),f=Math.floor(l/360),o=Math.min(h,f);return t+o*360},Y8=function(t,r){var n=t.x,l=t.y,h=aFe({x:n,y:l},r),f=h.radius,o=h.angle,v=r.innerRadius,b=r.outerRadius;if(f<v||f>b)return!1;if(f===0)return!0;var E=lFe(r),P=E.startAngle,O=E.endAngle,L=o,B;if(P<=O){for(;L>O;)L-=360;for(;L<P;)L+=360;B=L>=P&&L<=O}else{for(;L>P;)L-=360;for(;L<O;)L+=360;B=L>=O&&L<=P}return B?ah(ah({},r),{},{radius:f,angle:cFe(L,r)}):null},zee=function(t){return!K.isValidElement(t)&&!In(t)&&typeof t!="boolean"?t.className:""};function _w(e){"@babel/helpers - typeof";return _w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_w(e)}var uFe=["offset"];function hFe(e){return mFe(e)||pFe(e)||fFe(e)||dFe()}function dFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fFe(e,t){if(e){if(typeof e=="string")return RD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return RD(e,t)}}function pFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function mFe(e){if(Array.isArray(e))return RD(e)}function RD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function gFe(e,t){if(e==null)return{};var r=yFe(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function yFe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function J8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function ts(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?J8(Object(r),!0).forEach(function(n){_Fe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _Fe(e,t,r){return t=vFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vFe(e){var t=xFe(e,"string");return _w(t)=="symbol"?t:t+""}function xFe(e,t){if(_w(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_w(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vw(){return vw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},vw.apply(this,arguments)}var bFe=function(t){var r=t.value,n=t.formatter,l=ni(t.children)?r:t.children;return In(n)?n(l):l},wFe=function(t,r){var n=ya(r-t),l=Math.min(Math.abs(r-t),360);return n*l},SFe=function(t,r,n){var l=t.position,h=t.viewBox,f=t.offset,o=t.className,v=h,b=v.cx,E=v.cy,P=v.innerRadius,O=v.outerRadius,L=v.startAngle,B=v.endAngle,z=v.clockWise,$=(P+O)/2,U=wFe(L,B),G=U>=0?1:-1,Z,ne;l==="insideStart"?(Z=L+G*f,ne=z):l==="insideEnd"?(Z=B-G*f,ne=!z):l==="end"&&(Z=B+G*f,ne=z),ne=U<=0?ne:!ne;var Y=Qi(b,E,$,Z),ee=Qi(b,E,$,Z+(ne?1:-1)*359),le="M".concat(Y.x,",").concat(Y.y,`
    A`).concat($,",").concat($,",0,1,").concat(ne?0:1,`,
    `).concat(ee.x,",").concat(ee.y),fe=ni(t.id)?r1("recharts-radial-line-"):t.id;return ze.createElement("text",vw({},n,{dominantBaseline:"central",className:qn("recharts-radial-bar-label",o)}),ze.createElement("defs",null,ze.createElement("path",{id:fe,d:le})),ze.createElement("textPath",{xlinkHref:"#".concat(fe)},r))},TFe=function(t){var r=t.viewBox,n=t.offset,l=t.position,h=r,f=h.cx,o=h.cy,v=h.innerRadius,b=h.outerRadius,E=h.startAngle,P=h.endAngle,O=(E+P)/2;if(l==="outside"){var L=Qi(f,o,b+n,O),B=L.x,z=L.y;return{x:B,y:z,textAnchor:B>=f?"start":"end",verticalAnchor:"middle"}}if(l==="center")return{x:f,y:o,textAnchor:"middle",verticalAnchor:"middle"};if(l==="centerTop")return{x:f,y:o,textAnchor:"middle",verticalAnchor:"start"};if(l==="centerBottom")return{x:f,y:o,textAnchor:"middle",verticalAnchor:"end"};var $=(v+b)/2,U=Qi(f,o,$,O),G=U.x,Z=U.y;return{x:G,y:Z,textAnchor:"middle",verticalAnchor:"middle"}},EFe=function(t){var r=t.viewBox,n=t.parentViewBox,l=t.offset,h=t.position,f=r,o=f.x,v=f.y,b=f.width,E=f.height,P=E>=0?1:-1,O=P*l,L=P>0?"end":"start",B=P>0?"start":"end",z=b>=0?1:-1,$=z*l,U=z>0?"end":"start",G=z>0?"start":"end";if(h==="top"){var Z={x:o+b/2,y:v-P*l,textAnchor:"middle",verticalAnchor:L};return ts(ts({},Z),n?{height:Math.max(v-n.y,0),width:b}:{})}if(h==="bottom"){var ne={x:o+b/2,y:v+E+O,textAnchor:"middle",verticalAnchor:B};return ts(ts({},ne),n?{height:Math.max(n.y+n.height-(v+E),0),width:b}:{})}if(h==="left"){var Y={x:o-$,y:v+E/2,textAnchor:U,verticalAnchor:"middle"};return ts(ts({},Y),n?{width:Math.max(Y.x-n.x,0),height:E}:{})}if(h==="right"){var ee={x:o+b+$,y:v+E/2,textAnchor:G,verticalAnchor:"middle"};return ts(ts({},ee),n?{width:Math.max(n.x+n.width-ee.x,0),height:E}:{})}var le=n?{width:b,height:E}:{};return h==="insideLeft"?ts({x:o+$,y:v+E/2,textAnchor:G,verticalAnchor:"middle"},le):h==="insideRight"?ts({x:o+b-$,y:v+E/2,textAnchor:U,verticalAnchor:"middle"},le):h==="insideTop"?ts({x:o+b/2,y:v+O,textAnchor:"middle",verticalAnchor:B},le):h==="insideBottom"?ts({x:o+b/2,y:v+E-O,textAnchor:"middle",verticalAnchor:L},le):h==="insideTopLeft"?ts({x:o+$,y:v+O,textAnchor:G,verticalAnchor:B},le):h==="insideTopRight"?ts({x:o+b-$,y:v+O,textAnchor:U,verticalAnchor:B},le):h==="insideBottomLeft"?ts({x:o+$,y:v+E-O,textAnchor:G,verticalAnchor:L},le):h==="insideBottomRight"?ts({x:o+b-$,y:v+E-O,textAnchor:U,verticalAnchor:L},le):dv(h)&&(pr(h.x)||Xp(h.x))&&(pr(h.y)||Xp(h.y))?ts({x:o+_a(h.x,b),y:v+_a(h.y,E),textAnchor:"end",verticalAnchor:"end"},le):ts({x:o+b/2,y:v+E/2,textAnchor:"middle",verticalAnchor:"middle"},le)},AFe=function(t){return"cx"in t&&pr(t.cx)};function xs(e){var t=e.offset,r=t===void 0?5:t,n=gFe(e,uFe),l=ts({offset:r},n),h=l.viewBox,f=l.position,o=l.value,v=l.children,b=l.content,E=l.className,P=E===void 0?"":E,O=l.textBreakAll;if(!h||ni(o)&&ni(v)&&!K.isValidElement(b)&&!In(b))return null;if(K.isValidElement(b))return K.cloneElement(b,l);var L;if(In(b)){if(L=K.createElement(b,l),K.isValidElement(L))return L}else L=bFe(l);var B=AFe(h),z=wn(l,!0);if(B&&(f==="insideStart"||f==="insideEnd"||f==="end"))return SFe(l,L,z);var $=B?TFe(l):EFe(l);return ze.createElement(Tm,vw({className:qn("recharts-label",P)},z,$,{breakAll:O}),L)}xs.displayName="Label";var Fee=function(t){var r=t.cx,n=t.cy,l=t.angle,h=t.startAngle,f=t.endAngle,o=t.r,v=t.radius,b=t.innerRadius,E=t.outerRadius,P=t.x,O=t.y,L=t.top,B=t.left,z=t.width,$=t.height,U=t.clockWise,G=t.labelViewBox;if(G)return G;if(pr(z)&&pr($)){if(pr(P)&&pr(O))return{x:P,y:O,width:z,height:$};if(pr(L)&&pr(B))return{x:L,y:B,width:z,height:$}}return pr(P)&&pr(O)?{x:P,y:O,width:0,height:0}:pr(r)&&pr(n)?{cx:r,cy:n,startAngle:h||l||0,endAngle:f||l||0,innerRadius:b||0,outerRadius:E||v||o||0,clockWise:U}:t.viewBox?t.viewBox:{}},PFe=function(t,r){return t?t===!0?ze.createElement(xs,{key:"label-implicit",viewBox:r}):as(t)?ze.createElement(xs,{key:"label-implicit",viewBox:r,value:t}):K.isValidElement(t)?t.type===xs?K.cloneElement(t,{key:"label-implicit",viewBox:r}):ze.createElement(xs,{key:"label-implicit",content:t,viewBox:r}):In(t)?ze.createElement(xs,{key:"label-implicit",content:t,viewBox:r}):dv(t)?ze.createElement(xs,vw({viewBox:r},t,{key:"label-implicit"})):null:null},CFe=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var l=t.children,h=Fee(t),f=zl(l,xs).map(function(v,b){return K.cloneElement(v,{viewBox:r||h,key:"label-".concat(b)})});if(!n)return f;var o=PFe(t.label,r||h);return[o].concat(hFe(f))};xs.parseViewBox=Fee;xs.renderCallByParent=CFe;function IFe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var MFe=IFe;const OFe=Pi(MFe);function xw(e){"@babel/helpers - typeof";return xw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xw(e)}var kFe=["valueAccessor"],RFe=["data","dataKey","clockWise","id","textBreakAll"];function DFe(e){return zFe(e)||NFe(e)||jFe(e)||LFe()}function LFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jFe(e,t){if(e){if(typeof e=="string")return DD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return DD(e,t)}}function NFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function zFe(e){if(Array.isArray(e))return DD(e)}function DD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function W2(){return W2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},W2.apply(this,arguments)}function Q8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function eG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q8(Object(r),!0).forEach(function(n){FFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function FFe(e,t,r){return t=BFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BFe(e){var t=$Fe(e,"string");return xw(t)=="symbol"?t:t+""}function $Fe(e,t){if(xw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function tG(e,t){if(e==null)return{};var r=VFe(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function VFe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var UFe=function(t){return Array.isArray(t.value)?OFe(t.value):t.value};function pf(e){var t=e.valueAccessor,r=t===void 0?UFe:t,n=tG(e,kFe),l=n.data,h=n.dataKey,f=n.clockWise,o=n.id,v=n.textBreakAll,b=tG(n,RFe);return!l||!l.length?null:ze.createElement(Li,{className:"recharts-label-list"},l.map(function(E,P){var O=ni(h)?r(E,P):Ks(E&&E.payload,h),L=ni(o)?{}:{id:"".concat(o,"-").concat(P)};return ze.createElement(xs,W2({},wn(E,!0),b,L,{parentViewBox:E.parentViewBox,value:O,textBreakAll:v,viewBox:xs.parseViewBox(ni(f)?E:eG(eG({},E),{},{clockWise:f})),key:"label-".concat(P),index:P}))}))}pf.displayName="LabelList";function GFe(e,t){return e?e===!0?ze.createElement(pf,{key:"labelList-implicit",data:t}):ze.isValidElement(e)||In(e)?ze.createElement(pf,{key:"labelList-implicit",data:t,content:e}):dv(e)?ze.createElement(pf,W2({data:t},e,{key:"labelList-implicit"})):null:null}function HFe(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,l=zl(n,pf).map(function(f,o){return K.cloneElement(f,{data:t,key:"labelList-".concat(o)})});if(!r)return l;var h=GFe(e.label,t);return[h].concat(DFe(l))}pf.renderCallByParent=HFe;function bw(e){"@babel/helpers - typeof";return bw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bw(e)}function LD(){return LD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},LD.apply(this,arguments)}function rG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function nG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rG(Object(r),!0).forEach(function(n){WFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WFe(e,t,r){return t=qFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qFe(e){var t=ZFe(e,"string");return bw(t)=="symbol"?t:t+""}function ZFe(e,t){if(bw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var XFe=function(t,r){var n=ya(r-t),l=Math.min(Math.abs(r-t),359.999);return n*l},QT=function(t){var r=t.cx,n=t.cy,l=t.radius,h=t.angle,f=t.sign,o=t.isExternal,v=t.cornerRadius,b=t.cornerIsExternal,E=v*(o?1:-1)+l,P=Math.asin(v/E)/H2,O=b?h:h+f*P,L=Qi(r,n,E,O),B=Qi(r,n,l,O),z=b?h-f*P:h,$=Qi(r,n,E*Math.cos(P*H2),z);return{center:L,circleTangency:B,lineTangency:$,theta:P}},Bee=function(t){var r=t.cx,n=t.cy,l=t.innerRadius,h=t.outerRadius,f=t.startAngle,o=t.endAngle,v=XFe(f,o),b=f+v,E=Qi(r,n,h,f),P=Qi(r,n,h,b),O="M ".concat(E.x,",").concat(E.y,`
    A `).concat(h,",").concat(h,`,0,
    `).concat(+(Math.abs(v)>180),",").concat(+(f>b),`,
    `).concat(P.x,",").concat(P.y,`
  `);if(l>0){var L=Qi(r,n,l,f),B=Qi(r,n,l,b);O+="L ".concat(B.x,",").concat(B.y,`
            A `).concat(l,",").concat(l,`,0,
            `).concat(+(Math.abs(v)>180),",").concat(+(f<=b),`,
            `).concat(L.x,",").concat(L.y," Z")}else O+="L ".concat(r,",").concat(n," Z");return O},KFe=function(t){var r=t.cx,n=t.cy,l=t.innerRadius,h=t.outerRadius,f=t.cornerRadius,o=t.forceCornerRadius,v=t.cornerIsExternal,b=t.startAngle,E=t.endAngle,P=ya(E-b),O=QT({cx:r,cy:n,radius:h,angle:b,sign:P,cornerRadius:f,cornerIsExternal:v}),L=O.circleTangency,B=O.lineTangency,z=O.theta,$=QT({cx:r,cy:n,radius:h,angle:E,sign:-P,cornerRadius:f,cornerIsExternal:v}),U=$.circleTangency,G=$.lineTangency,Z=$.theta,ne=v?Math.abs(b-E):Math.abs(b-E)-z-Z;if(ne<0)return o?"M ".concat(B.x,",").concat(B.y,`
        a`).concat(f,",").concat(f,",0,0,1,").concat(f*2,`,0
        a`).concat(f,",").concat(f,",0,0,1,").concat(-f*2,`,0
      `):Bee({cx:r,cy:n,innerRadius:l,outerRadius:h,startAngle:b,endAngle:E});var Y="M ".concat(B.x,",").concat(B.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(P<0),",").concat(L.x,",").concat(L.y,`
    A`).concat(h,",").concat(h,",0,").concat(+(ne>180),",").concat(+(P<0),",").concat(U.x,",").concat(U.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(P<0),",").concat(G.x,",").concat(G.y,`
  `);if(l>0){var ee=QT({cx:r,cy:n,radius:l,angle:b,sign:P,isExternal:!0,cornerRadius:f,cornerIsExternal:v}),le=ee.circleTangency,fe=ee.lineTangency,Ce=ee.theta,Oe=QT({cx:r,cy:n,radius:l,angle:E,sign:-P,isExternal:!0,cornerRadius:f,cornerIsExternal:v}),Me=Oe.circleTangency,Ke=Oe.lineTangency,Ye=Oe.theta,Le=v?Math.abs(b-E):Math.abs(b-E)-Ce-Ye;if(Le<0&&f===0)return"".concat(Y,"L").concat(r,",").concat(n,"Z");Y+="L".concat(Ke.x,",").concat(Ke.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(P<0),",").concat(Me.x,",").concat(Me.y,`
      A`).concat(l,",").concat(l,",0,").concat(+(Le>180),",").concat(+(P>0),",").concat(le.x,",").concat(le.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(P<0),",").concat(fe.x,",").concat(fe.y,"Z")}else Y+="L".concat(r,",").concat(n,"Z");return Y},YFe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},$ee=function(t){var r=nG(nG({},YFe),t),n=r.cx,l=r.cy,h=r.innerRadius,f=r.outerRadius,o=r.cornerRadius,v=r.forceCornerRadius,b=r.cornerIsExternal,E=r.startAngle,P=r.endAngle,O=r.className;if(f<h||E===P)return null;var L=qn("recharts-sector",O),B=f-h,z=_a(o,B,0,!0),$;return z>0&&Math.abs(E-P)<360?$=KFe({cx:n,cy:l,innerRadius:h,outerRadius:f,cornerRadius:Math.min(z,B/2),forceCornerRadius:v,cornerIsExternal:b,startAngle:E,endAngle:P}):$=Bee({cx:n,cy:l,innerRadius:h,outerRadius:f,startAngle:E,endAngle:P}),ze.createElement("path",LD({},wn(r,!0),{className:L,d:$,role:"img"}))};function ww(e){"@babel/helpers - typeof";return ww=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ww(e)}function jD(){return jD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jD.apply(this,arguments)}function iG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function oG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iG(Object(r),!0).forEach(function(n){JFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JFe(e,t,r){return t=QFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QFe(e){var t=eBe(e,"string");return ww(t)=="symbol"?t:t+""}function eBe(e,t){if(ww(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ww(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sG={curveBasisClosed:H2e,curveBasisOpen:W2e,curveBasis:G2e,curveBumpX:M2e,curveBumpY:O2e,curveLinearClosed:q2e,curveLinear:jP,curveMonotoneX:Z2e,curveMonotoneY:X2e,curveNatural:K2e,curveStep:Y2e,curveStepAfter:Q2e,curveStepBefore:J2e},eE=function(t){return t.x===+t.x&&t.y===+t.y},Vx=function(t){return t.x},Ux=function(t){return t.y},tBe=function(t,r){if(In(t))return t;var n="curve".concat(DP(t));return(n==="curveMonotone"||n==="curveBump")&&r?sG["".concat(n).concat(r==="vertical"?"Y":"X")]:sG[n]||jP},rBe=function(t){var r=t.type,n=r===void 0?"linear":r,l=t.points,h=l===void 0?[]:l,f=t.baseLine,o=t.layout,v=t.connectNulls,b=v===void 0?!1:v,E=tBe(n,o),P=b?h.filter(function(z){return eE(z)}):h,O;if(Array.isArray(f)){var L=b?f.filter(function(z){return eE(z)}):f,B=P.map(function(z,$){return oG(oG({},z),{},{base:L[$]})});return o==="vertical"?O=GT().y(Ux).x1(Vx).x0(function(z){return z.base.x}):O=GT().x(Vx).y1(Ux).y0(function(z){return z.base.y}),O.defined(eE).curve(E),O(B)}return o==="vertical"&&pr(f)?O=GT().y(Ux).x1(Vx).x0(f):pr(f)?O=GT().x(Vx).y1(Ux).y0(f):O=RJ().x(Vx).y(Ux),O.defined(eE).curve(E),O(P)},ND=function(t){var r=t.className,n=t.points,l=t.path,h=t.pathRef;if((!n||!n.length)&&!l)return null;var f=n&&n.length?rBe(t):l;return K.createElement("path",jD({},wn(t,!1),y2(t),{className:qn("recharts-curve",r),d:f,ref:h}))},Vee={exports:{}},nBe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",iBe=nBe,oBe=iBe;function Uee(){}function Gee(){}Gee.resetWarningCache=Uee;var sBe=function(){function e(n,l,h,f,o,v){if(v!==oBe){var b=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw b.name="Invariant Violation",b}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Gee,resetWarningCache:Uee};return r.PropTypes=r,r};Vee.exports=sBe();var aBe=Vee.exports;const ki=Pi(aBe);var lBe=Object.getOwnPropertyNames,cBe=Object.getOwnPropertySymbols,uBe=Object.prototype.hasOwnProperty;function aG(e,t){return function(n,l,h){return e(n,l,h)&&t(n,l,h)}}function tE(e){return function(r,n,l){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,l);var h=l.cache,f=h.get(r),o=h.get(n);if(f&&o)return f===n&&o===r;h.set(r,n),h.set(n,r);var v=e(r,n,l);return h.delete(r),h.delete(n),v}}function lG(e){return lBe(e).concat(cBe(e))}var hBe=Object.hasOwn||function(e,t){return uBe.call(e,t)};function Nm(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var dBe="__v",fBe="__o",pBe="_owner",cG=Object.getOwnPropertyDescriptor,uG=Object.keys;function mBe(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function gBe(e,t){return Nm(e.getTime(),t.getTime())}function yBe(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function _Be(e,t){return e===t}function hG(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var l=new Array(n),h=e.entries(),f,o,v=0;(f=h.next())&&!f.done;){for(var b=t.entries(),E=!1,P=0;(o=b.next())&&!o.done;){if(l[P]){P++;continue}var O=f.value,L=o.value;if(r.equals(O[0],L[0],v,P,e,t,r)&&r.equals(O[1],L[1],O[0],L[0],e,t,r)){E=l[P]=!0;break}P++}if(!E)return!1;v++}return!0}var vBe=Nm;function xBe(e,t,r){var n=uG(e),l=n.length;if(uG(t).length!==l)return!1;for(;l-- >0;)if(!Hee(e,t,r,n[l]))return!1;return!0}function Gx(e,t,r){var n=lG(e),l=n.length;if(lG(t).length!==l)return!1;for(var h,f,o;l-- >0;)if(h=n[l],!Hee(e,t,r,h)||(f=cG(e,h),o=cG(t,h),(f||o)&&(!f||!o||f.configurable!==o.configurable||f.enumerable!==o.enumerable||f.writable!==o.writable)))return!1;return!0}function bBe(e,t){return Nm(e.valueOf(),t.valueOf())}function wBe(e,t){return e.source===t.source&&e.flags===t.flags}function dG(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var l=new Array(n),h=e.values(),f,o;(f=h.next())&&!f.done;){for(var v=t.values(),b=!1,E=0;(o=v.next())&&!o.done;){if(!l[E]&&r.equals(f.value,o.value,f.value,o.value,e,t,r)){b=l[E]=!0;break}E++}if(!b)return!1}return!0}function SBe(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function TBe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function Hee(e,t,r,n){return(n===pBe||n===fBe||n===dBe)&&(e.$$typeof||t.$$typeof)?!0:hBe(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var EBe="[object Arguments]",ABe="[object Boolean]",PBe="[object Date]",CBe="[object Error]",IBe="[object Map]",MBe="[object Number]",OBe="[object Object]",kBe="[object RegExp]",RBe="[object Set]",DBe="[object String]",LBe="[object URL]",jBe=Array.isArray,fG=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,pG=Object.assign,NBe=Object.prototype.toString.call.bind(Object.prototype.toString);function zBe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,l=e.areFunctionsEqual,h=e.areMapsEqual,f=e.areNumbersEqual,o=e.areObjectsEqual,v=e.arePrimitiveWrappersEqual,b=e.areRegExpsEqual,E=e.areSetsEqual,P=e.areTypedArraysEqual,O=e.areUrlsEqual;return function(B,z,$){if(B===z)return!0;if(B==null||z==null)return!1;var U=typeof B;if(U!==typeof z)return!1;if(U!=="object")return U==="number"?f(B,z,$):U==="function"?l(B,z,$):!1;var G=B.constructor;if(G!==z.constructor)return!1;if(G===Object)return o(B,z,$);if(jBe(B))return t(B,z,$);if(fG!=null&&fG(B))return P(B,z,$);if(G===Date)return r(B,z,$);if(G===RegExp)return b(B,z,$);if(G===Map)return h(B,z,$);if(G===Set)return E(B,z,$);var Z=NBe(B);return Z===PBe?r(B,z,$):Z===kBe?b(B,z,$):Z===IBe?h(B,z,$):Z===RBe?E(B,z,$):Z===OBe?typeof B.then!="function"&&typeof z.then!="function"&&o(B,z,$):Z===LBe?O(B,z,$):Z===CBe?n(B,z,$):Z===EBe?o(B,z,$):Z===ABe||Z===MBe||Z===DBe?v(B,z,$):!1}}function FBe(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,l={areArraysEqual:n?Gx:mBe,areDatesEqual:gBe,areErrorsEqual:yBe,areFunctionsEqual:_Be,areMapsEqual:n?aG(hG,Gx):hG,areNumbersEqual:vBe,areObjectsEqual:n?Gx:xBe,arePrimitiveWrappersEqual:bBe,areRegExpsEqual:wBe,areSetsEqual:n?aG(dG,Gx):dG,areTypedArraysEqual:n?Gx:SBe,areUrlsEqual:TBe};if(r&&(l=pG({},l,r(l))),t){var h=tE(l.areArraysEqual),f=tE(l.areMapsEqual),o=tE(l.areObjectsEqual),v=tE(l.areSetsEqual);l=pG({},l,{areArraysEqual:h,areMapsEqual:f,areObjectsEqual:o,areSetsEqual:v})}return l}function BBe(e){return function(t,r,n,l,h,f,o){return e(t,r,o)}}function $Be(e){var t=e.circular,r=e.comparator,n=e.createState,l=e.equals,h=e.strict;if(n)return function(v,b){var E=n(),P=E.cache,O=P===void 0?t?new WeakMap:void 0:P,L=E.meta;return r(v,b,{cache:O,equals:l,meta:L,strict:h})};if(t)return function(v,b){return r(v,b,{cache:new WeakMap,equals:l,meta:void 0,strict:h})};var f={cache:void 0,equals:l,meta:void 0,strict:h};return function(v,b){return r(v,b,f)}}var VBe=Mf();Mf({strict:!0});Mf({circular:!0});Mf({circular:!0,strict:!0});Mf({createInternalComparator:function(){return Nm}});Mf({strict:!0,createInternalComparator:function(){return Nm}});Mf({circular:!0,createInternalComparator:function(){return Nm}});Mf({circular:!0,createInternalComparator:function(){return Nm},strict:!0});function Mf(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,l=e.createState,h=e.strict,f=h===void 0?!1:h,o=FBe(e),v=zBe(o),b=n?n(v):BBe(v);return $Be({circular:r,comparator:v,createState:l,equals:b,strict:f})}function UBe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function mG(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function l(h){r<0&&(r=h),h-r>t?(e(h),r=-1):UBe(l)};requestAnimationFrame(n)}function zD(e){"@babel/helpers - typeof";return zD=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zD(e)}function GBe(e){return ZBe(e)||qBe(e)||WBe(e)||HBe()}function HBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WBe(e,t){if(e){if(typeof e=="string")return gG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gG(e,t)}}function gG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ZBe(e){if(Array.isArray(e))return e}function XBe(){var e={},t=function(){return null},r=!1,n=function l(h){if(!r){if(Array.isArray(h)){if(!h.length)return;var f=h,o=GBe(f),v=o[0],b=o.slice(1);if(typeof v=="number"){mG(l.bind(null,b),v);return}l(v),mG(l.bind(null,b));return}zD(h)==="object"&&(e=h,t(e)),typeof h=="function"&&h()}};return{stop:function(){r=!0},start:function(h){r=!1,n(h)},subscribe:function(h){return t=h,function(){t=function(){return null}}}}}function Sw(e){"@babel/helpers - typeof";return Sw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sw(e)}function yG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function _G(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yG(Object(r),!0).forEach(function(n){Wee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wee(e,t,r){return t=KBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KBe(e){var t=YBe(e,"string");return Sw(t)==="symbol"?t:String(t)}function YBe(e,t){if(Sw(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sw(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var JBe=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,l){return n.filter(function(h){return l.includes(h)})})},QBe=function(t){return t},e5e=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Tb=function(t,r){return Object.keys(r).reduce(function(n,l){return _G(_G({},n),{},Wee({},l,t(l,r[l])))},{})},vG=function(t,r,n){return t.map(function(l){return"".concat(e5e(l)," ").concat(r,"ms ").concat(n)}).join(",")};function t5e(e,t){return i5e(e)||n5e(e,t)||qee(e,t)||r5e()}function r5e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n5e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function i5e(e){if(Array.isArray(e))return e}function o5e(e){return l5e(e)||a5e(e)||qee(e)||s5e()}function s5e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qee(e,t){if(e){if(typeof e=="string")return FD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return FD(e,t)}}function a5e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function l5e(e){if(Array.isArray(e))return FD(e)}function FD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var q2=1e-4,Zee=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},Xee=function(t,r){return t.map(function(n,l){return n*Math.pow(r,l)}).reduce(function(n,l){return n+l})},xG=function(t,r){return function(n){var l=Zee(t,r);return Xee(l,n)}},c5e=function(t,r){return function(n){var l=Zee(t,r),h=[].concat(o5e(l.map(function(f,o){return f*o}).slice(1)),[0]);return Xee(h,n)}},bG=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var l=r[0],h=r[1],f=r[2],o=r[3];if(r.length===1)switch(r[0]){case"linear":l=0,h=0,f=1,o=1;break;case"ease":l=.25,h=.1,f=.25,o=1;break;case"ease-in":l=.42,h=0,f=1,o=1;break;case"ease-out":l=.42,h=0,f=.58,o=1;break;case"ease-in-out":l=0,h=0,f=.58,o=1;break;default:{var v=r[0].split("(");if(v[0]==="cubic-bezier"&&v[1].split(")")[0].split(",").length===4){var b=v[1].split(")")[0].split(",").map(function($){return parseFloat($)}),E=t5e(b,4);l=E[0],h=E[1],f=E[2],o=E[3]}}}var P=xG(l,f),O=xG(h,o),L=c5e(l,f),B=function(U){return U>1?1:U<0?0:U},z=function(U){for(var G=U>1?1:U,Z=G,ne=0;ne<8;++ne){var Y=P(Z)-G,ee=L(Z);if(Math.abs(Y-G)<q2||ee<q2)return O(Z);Z=B(Z-Y/ee)}return O(Z)};return z.isStepper=!1,z},u5e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,l=t.damping,h=l===void 0?8:l,f=t.dt,o=f===void 0?17:f,v=function(E,P,O){var L=-(E-P)*n,B=O*h,z=O+(L-B)*o/1e3,$=O*o/1e3+E;return Math.abs($-P)<q2&&Math.abs(z)<q2?[P,0]:[$,z]};return v.isStepper=!0,v.dt=o,v},h5e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var l=r[0];if(typeof l=="string")switch(l){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return bG(l);case"spring":return u5e();default:if(l.split("(")[0]==="cubic-bezier")return bG(l)}return typeof l=="function"?l:null};function Tw(e){"@babel/helpers - typeof";return Tw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tw(e)}function wG(e){return p5e(e)||f5e(e)||Kee(e)||d5e()}function d5e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f5e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function p5e(e){if(Array.isArray(e))return $D(e)}function SG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function ks(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SG(Object(r),!0).forEach(function(n){BD(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BD(e,t,r){return t=m5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m5e(e){var t=g5e(e,"string");return Tw(t)==="symbol"?t:String(t)}function g5e(e,t){if(Tw(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Tw(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function y5e(e,t){return x5e(e)||v5e(e,t)||Kee(e,t)||_5e()}function _5e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kee(e,t){if(e){if(typeof e=="string")return $D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $D(e,t)}}function $D(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v5e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function x5e(e){if(Array.isArray(e))return e}var Z2=function(t,r,n){return t+(r-t)*n},VD=function(t){var r=t.from,n=t.to;return r!==n},b5e=function e(t,r,n){var l=Tb(function(h,f){if(VD(f)){var o=t(f.from,f.to,f.velocity),v=y5e(o,2),b=v[0],E=v[1];return ks(ks({},f),{},{from:b,velocity:E})}return f},r);return n<1?Tb(function(h,f){return VD(f)?ks(ks({},f),{},{velocity:Z2(f.velocity,l[h].velocity,n),from:Z2(f.from,l[h].from,n)}):f},r):e(t,l,n-1)};const w5e=function(e,t,r,n,l){var h=JBe(e,t),f=h.reduce(function($,U){return ks(ks({},$),{},BD({},U,[e[U],t[U]]))},{}),o=h.reduce(function($,U){return ks(ks({},$),{},BD({},U,{from:e[U],velocity:0,to:t[U]}))},{}),v=-1,b,E,P=function(){return null},O=function(){return Tb(function(U,G){return G.from},o)},L=function(){return!Object.values(o).filter(VD).length},B=function(U){b||(b=U);var G=U-b,Z=G/r.dt;o=b5e(r,o,Z),l(ks(ks(ks({},e),t),O())),b=U,L()||(v=requestAnimationFrame(P))},z=function(U){E||(E=U);var G=(U-E)/n,Z=Tb(function(Y,ee){return Z2.apply(void 0,wG(ee).concat([r(G)]))},f);if(l(ks(ks(ks({},e),t),Z)),G<1)v=requestAnimationFrame(P);else{var ne=Tb(function(Y,ee){return Z2.apply(void 0,wG(ee).concat([r(1)]))},f);l(ks(ks(ks({},e),t),ne))}};return P=r.isStepper?B:z,function(){return requestAnimationFrame(P),function(){cancelAnimationFrame(v)}}};function D_(e){"@babel/helpers - typeof";return D_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D_(e)}var S5e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function T5e(e,t){if(e==null)return{};var r=E5e(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function E5e(e,t){if(e==null)return{};var r={},n=Object.keys(e),l,h;for(h=0;h<n.length;h++)l=n[h],!(t.indexOf(l)>=0)&&(r[l]=e[l]);return r}function FO(e){return I5e(e)||C5e(e)||P5e(e)||A5e()}function A5e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P5e(e,t){if(e){if(typeof e=="string")return UD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return UD(e,t)}}function C5e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function I5e(e){if(Array.isArray(e))return UD(e)}function UD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function TG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function sc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TG(Object(r),!0).forEach(function(n){eb(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eb(e,t,r){return t=Yee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M5e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O5e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Yee(n.key),n)}}function k5e(e,t,r){return t&&O5e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Yee(e){var t=R5e(e,"string");return D_(t)==="symbol"?t:String(t)}function R5e(e,t){if(D_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(D_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function D5e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GD(e,t)}function GD(e,t){return GD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},GD(e,t)}function L5e(e){var t=j5e();return function(){var n=X2(e),l;if(t){var h=X2(this).constructor;l=Reflect.construct(n,arguments,h)}else l=n.apply(this,arguments);return HD(this,l)}}function HD(e,t){if(t&&(D_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WD(e)}function WD(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j5e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function X2(e){return X2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},X2(e)}var kh=function(e){D5e(r,e);var t=L5e(r);function r(n,l){var h;M5e(this,r),h=t.call(this,n,l);var f=h.props,o=f.isActive,v=f.attributeName,b=f.from,E=f.to,P=f.steps,O=f.children,L=f.duration;if(h.handleStyleChange=h.handleStyleChange.bind(WD(h)),h.changeStyle=h.changeStyle.bind(WD(h)),!o||L<=0)return h.state={style:{}},typeof O=="function"&&(h.state={style:E}),HD(h);if(P&&P.length)h.state={style:P[0].style};else if(b){if(typeof O=="function")return h.state={style:b},HD(h);h.state={style:v?eb({},v,b):b}}else h.state={style:{}};return h}return k5e(r,[{key:"componentDidMount",value:function(){var l=this.props,h=l.isActive,f=l.canBegin;this.mounted=!0,!(!h||!f)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(l){var h=this.props,f=h.isActive,o=h.canBegin,v=h.attributeName,b=h.shouldReAnimate,E=h.to,P=h.from,O=this.state.style;if(o){if(!f){var L={style:v?eb({},v,E):E};this.state&&O&&(v&&O[v]!==E||!v&&O!==E)&&this.setState(L);return}if(!(VBe(l.to,E)&&l.canBegin&&l.isActive)){var B=!l.canBegin||!l.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var z=B||b?P:l.to;if(this.state&&O){var $={style:v?eb({},v,z):z};(v&&O[v]!==z||!v&&O!==z)&&this.setState($)}this.runAnimation(sc(sc({},this.props),{},{from:z,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var l=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),l&&l()}},{key:"handleStyleChange",value:function(l){this.changeStyle(l)}},{key:"changeStyle",value:function(l){this.mounted&&this.setState({style:l})}},{key:"runJSAnimation",value:function(l){var h=this,f=l.from,o=l.to,v=l.duration,b=l.easing,E=l.begin,P=l.onAnimationEnd,O=l.onAnimationStart,L=w5e(f,o,h5e(b),v,this.changeStyle),B=function(){h.stopJSAnimation=L()};this.manager.start([O,E,B,v,P])}},{key:"runStepAnimation",value:function(l){var h=this,f=l.steps,o=l.begin,v=l.onAnimationStart,b=f[0],E=b.style,P=b.duration,O=P===void 0?0:P,L=function(z,$,U){if(U===0)return z;var G=$.duration,Z=$.easing,ne=Z===void 0?"ease":Z,Y=$.style,ee=$.properties,le=$.onAnimationEnd,fe=U>0?f[U-1]:$,Ce=ee||Object.keys(Y);if(typeof ne=="function"||ne==="spring")return[].concat(FO(z),[h.runJSAnimation.bind(h,{from:fe.style,to:Y,duration:G,easing:ne}),G]);var Oe=vG(Ce,G,ne),Me=sc(sc(sc({},fe.style),Y),{},{transition:Oe});return[].concat(FO(z),[Me,G,le]).filter(QBe)};return this.manager.start([v].concat(FO(f.reduce(L,[E,Math.max(O,o)])),[l.onAnimationEnd]))}},{key:"runAnimation",value:function(l){this.manager||(this.manager=XBe());var h=l.begin,f=l.duration,o=l.attributeName,v=l.to,b=l.easing,E=l.onAnimationStart,P=l.onAnimationEnd,O=l.steps,L=l.children,B=this.manager;if(this.unSubscribe=B.subscribe(this.handleStyleChange),typeof b=="function"||typeof L=="function"||b==="spring"){this.runJSAnimation(l);return}if(O.length>1){this.runStepAnimation(l);return}var z=o?eb({},o,v):v,$=vG(Object.keys(z),f,b);B.start([E,h,sc(sc({},z),{},{transition:$}),f,P])}},{key:"render",value:function(){var l=this.props,h=l.children;l.begin;var f=l.duration;l.attributeName,l.easing;var o=l.isActive;l.steps,l.from,l.to,l.canBegin,l.onAnimationEnd,l.shouldReAnimate,l.onAnimationReStart;var v=T5e(l,S5e),b=K.Children.count(h),E=this.state.style;if(typeof h=="function")return h(E);if(!o||b===0||f<=0)return h;var P=function(L){var B=L.props,z=B.style,$=z===void 0?{}:z,U=B.className,G=K.cloneElement(L,sc(sc({},v),{},{style:sc(sc({},$),E),className:U}));return G};return b===1?P(K.Children.only(h)):ze.createElement("div",null,K.Children.map(h,function(O){return P(O)}))}}]),r}(K.PureComponent);kh.displayName="Animate";kh.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};kh.propTypes={from:ki.oneOfType([ki.object,ki.string]),to:ki.oneOfType([ki.object,ki.string]),attributeName:ki.string,duration:ki.number,begin:ki.number,easing:ki.oneOfType([ki.string,ki.func]),steps:ki.arrayOf(ki.shape({duration:ki.number.isRequired,style:ki.object.isRequired,easing:ki.oneOfType([ki.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),ki.func]),properties:ki.arrayOf("string"),onAnimationEnd:ki.func})),children:ki.oneOfType([ki.node,ki.func]),isActive:ki.bool,canBegin:ki.bool,onAnimationEnd:ki.func,shouldReAnimate:ki.bool,onAnimationStart:ki.func,onAnimationReStart:ki.func};function Ew(e){"@babel/helpers - typeof";return Ew=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ew(e)}function K2(){return K2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},K2.apply(this,arguments)}function N5e(e,t){return $5e(e)||B5e(e,t)||F5e(e,t)||z5e()}function z5e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F5e(e,t){if(e){if(typeof e=="string")return EG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return EG(e,t)}}function EG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function B5e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function $5e(e){if(Array.isArray(e))return e}function AG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function PG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?AG(Object(r),!0).forEach(function(n){V5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):AG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function V5e(e,t,r){return t=U5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function U5e(e){var t=G5e(e,"string");return Ew(t)=="symbol"?t:t+""}function G5e(e,t){if(Ew(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ew(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var CG=function(t,r,n,l,h){var f=Math.min(Math.abs(n)/2,Math.abs(l)/2),o=l>=0?1:-1,v=n>=0?1:-1,b=l>=0&&n>=0||l<0&&n<0?1:0,E;if(f>0&&h instanceof Array){for(var P=[0,0,0,0],O=0,L=4;O<L;O++)P[O]=h[O]>f?f:h[O];E="M".concat(t,",").concat(r+o*P[0]),P[0]>0&&(E+="A ".concat(P[0],",").concat(P[0],",0,0,").concat(b,",").concat(t+v*P[0],",").concat(r)),E+="L ".concat(t+n-v*P[1],",").concat(r),P[1]>0&&(E+="A ".concat(P[1],",").concat(P[1],",0,0,").concat(b,`,
        `).concat(t+n,",").concat(r+o*P[1])),E+="L ".concat(t+n,",").concat(r+l-o*P[2]),P[2]>0&&(E+="A ".concat(P[2],",").concat(P[2],",0,0,").concat(b,`,
        `).concat(t+n-v*P[2],",").concat(r+l)),E+="L ".concat(t+v*P[3],",").concat(r+l),P[3]>0&&(E+="A ".concat(P[3],",").concat(P[3],",0,0,").concat(b,`,
        `).concat(t,",").concat(r+l-o*P[3])),E+="Z"}else if(f>0&&h===+h&&h>0){var B=Math.min(f,h);E="M ".concat(t,",").concat(r+o*B,`
            A `).concat(B,",").concat(B,",0,0,").concat(b,",").concat(t+v*B,",").concat(r,`
            L `).concat(t+n-v*B,",").concat(r,`
            A `).concat(B,",").concat(B,",0,0,").concat(b,",").concat(t+n,",").concat(r+o*B,`
            L `).concat(t+n,",").concat(r+l-o*B,`
            A `).concat(B,",").concat(B,",0,0,").concat(b,",").concat(t+n-v*B,",").concat(r+l,`
            L `).concat(t+v*B,",").concat(r+l,`
            A `).concat(B,",").concat(B,",0,0,").concat(b,",").concat(t,",").concat(r+l-o*B," Z")}else E="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(l," h ").concat(-n," Z");return E},H5e=function(t,r){if(!t||!r)return!1;var n=t.x,l=t.y,h=r.x,f=r.y,o=r.width,v=r.height;if(Math.abs(o)>0&&Math.abs(v)>0){var b=Math.min(h,h+o),E=Math.max(h,h+o),P=Math.min(f,f+v),O=Math.max(f,f+v);return n>=b&&n<=E&&l>=P&&l<=O}return!1},W5e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},R3=function(t){var r=PG(PG({},W5e),t),n=K.useRef(),l=K.useState(-1),h=N5e(l,2),f=h[0],o=h[1];K.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var ne=n.current.getTotalLength();ne&&o(ne)}catch{}},[]);var v=r.x,b=r.y,E=r.width,P=r.height,O=r.radius,L=r.className,B=r.animationEasing,z=r.animationDuration,$=r.animationBegin,U=r.isAnimationActive,G=r.isUpdateAnimationActive;if(v!==+v||b!==+b||E!==+E||P!==+P||E===0||P===0)return null;var Z=qn("recharts-rectangle",L);return G?ze.createElement(kh,{canBegin:f>0,from:{width:E,height:P,x:v,y:b},to:{width:E,height:P,x:v,y:b},duration:z,animationEasing:B,isActive:G},function(ne){var Y=ne.width,ee=ne.height,le=ne.x,fe=ne.y;return ze.createElement(kh,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:$,duration:z,isActive:U,easing:B},ze.createElement("path",K2({},wn(r,!0),{className:Z,d:CG(le,fe,Y,ee,O),ref:n})))}):ze.createElement("path",K2({},wn(r,!0),{className:Z,d:CG(v,b,E,P,O)}))},q5e=["points","className","baseLinePoints","connectNulls"];function jy(){return jy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jy.apply(this,arguments)}function Z5e(e,t){if(e==null)return{};var r=X5e(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function X5e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function IG(e){return Q5e(e)||J5e(e)||Y5e(e)||K5e()}function K5e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Y5e(e,t){if(e){if(typeof e=="string")return qD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qD(e,t)}}function J5e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Q5e(e){if(Array.isArray(e))return qD(e)}function qD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var MG=function(t){return t&&t.x===+t.x&&t.y===+t.y},e4e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){MG(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),MG(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},Eb=function(t,r){var n=e4e(t);r&&(n=[n.reduce(function(h,f){return[].concat(IG(h),IG(f))},[])]);var l=n.map(function(h){return h.reduce(function(f,o,v){return"".concat(f).concat(v===0?"M":"L").concat(o.x,",").concat(o.y)},"")}).join("");return n.length===1?"".concat(l,"Z"):l},t4e=function(t,r,n){var l=Eb(t,n);return"".concat(l.slice(-1)==="Z"?l.slice(0,-1):l,"L").concat(Eb(r.reverse(),n).slice(1))},r4e=function(t){var r=t.points,n=t.className,l=t.baseLinePoints,h=t.connectNulls,f=Z5e(t,q5e);if(!r||!r.length)return null;var o=qn("recharts-polygon",n);if(l&&l.length){var v=f.stroke&&f.stroke!=="none",b=t4e(r,l,h);return ze.createElement("g",{className:o},ze.createElement("path",jy({},wn(f,!0),{fill:b.slice(-1)==="Z"?f.fill:"none",stroke:"none",d:b})),v?ze.createElement("path",jy({},wn(f,!0),{fill:"none",d:Eb(r,h)})):null,v?ze.createElement("path",jy({},wn(f,!0),{fill:"none",d:Eb(l,h)})):null)}var E=Eb(r,h);return ze.createElement("path",jy({},wn(f,!0),{fill:E.slice(-1)==="Z"?f.fill:"none",className:o,d:E}))};function ZD(){return ZD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ZD.apply(this,arguments)}var D3=function(t){var r=t.cx,n=t.cy,l=t.r,h=t.className,f=qn("recharts-dot",h);return r===+r&&n===+n&&l===+l?K.createElement("circle",ZD({},wn(t,!1),y2(t),{className:f,cx:r,cy:n,r:l})):null};function Aw(e){"@babel/helpers - typeof";return Aw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Aw(e)}var n4e=["x","y","top","left","width","height","className"];function XD(){return XD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},XD.apply(this,arguments)}function OG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function i4e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OG(Object(r),!0).forEach(function(n){o4e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function o4e(e,t,r){return t=s4e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s4e(e){var t=a4e(e,"string");return Aw(t)=="symbol"?t:t+""}function a4e(e,t){if(Aw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Aw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function l4e(e,t){if(e==null)return{};var r=c4e(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function c4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var u4e=function(t,r,n,l,h,f){return"M".concat(t,",").concat(h,"v").concat(l,"M").concat(f,",").concat(r,"h").concat(n)},h4e=function(t){var r=t.x,n=r===void 0?0:r,l=t.y,h=l===void 0?0:l,f=t.top,o=f===void 0?0:f,v=t.left,b=v===void 0?0:v,E=t.width,P=E===void 0?0:E,O=t.height,L=O===void 0?0:O,B=t.className,z=l4e(t,n4e),$=i4e({x:n,y:h,top:o,left:b,width:P,height:L},z);return!pr(n)||!pr(h)||!pr(P)||!pr(L)||!pr(o)||!pr(b)?null:ze.createElement("path",XD({},wn($,!0),{className:qn("recharts-cross",B),d:u4e(n,h,P,L,o,b)}))},d4e=qP,f4e=cee,p4e=Mu;function m4e(e,t){return e&&e.length?d4e(e,p4e(t),f4e):void 0}var g4e=m4e;const y4e=Pi(g4e);var _4e=qP,v4e=Mu,x4e=uee;function b4e(e,t){return e&&e.length?_4e(e,v4e(t),x4e):void 0}var w4e=b4e;const S4e=Pi(w4e);var T4e=["cx","cy","angle","ticks","axisLine"],E4e=["ticks","tick","angle","tickFormatter","stroke"];function L_(e){"@babel/helpers - typeof";return L_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L_(e)}function Ab(){return Ab=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ab.apply(this,arguments)}function kG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function kp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kG(Object(r),!0).forEach(function(n){eC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RG(e,t){if(e==null)return{};var r=A4e(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function A4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function P4e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function DG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Qee(n.key),n)}}function C4e(e,t,r){return t&&DG(e.prototype,t),r&&DG(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function I4e(e,t,r){return t=Y2(t),M4e(e,Jee()?Reflect.construct(t,r||[],Y2(e).constructor):t.apply(e,r))}function M4e(e,t){if(t&&(L_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return O4e(e)}function O4e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Jee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Jee=function(){return!!e})()}function Y2(e){return Y2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Y2(e)}function k4e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&KD(e,t)}function KD(e,t){return KD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},KD(e,t)}function eC(e,t,r){return t=Qee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qee(e){var t=R4e(e,"string");return L_(t)=="symbol"?t:t+""}function R4e(e,t){if(L_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(L_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var tC=function(e){function t(){return P4e(this,t),I4e(this,t,arguments)}return k4e(t,e),C4e(t,[{key:"getTickValueCoord",value:function(n){var l=n.coordinate,h=this.props,f=h.angle,o=h.cx,v=h.cy;return Qi(o,v,l,f)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,l;switch(n){case"left":l="end";break;case"right":l="start";break;default:l="middle";break}return l}},{key:"getViewBox",value:function(){var n=this.props,l=n.cx,h=n.cy,f=n.angle,o=n.ticks,v=y4e(o,function(E){return E.coordinate||0}),b=S4e(o,function(E){return E.coordinate||0});return{cx:l,cy:h,startAngle:f,endAngle:f,innerRadius:b.coordinate||0,outerRadius:v.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,l=n.cx,h=n.cy,f=n.angle,o=n.ticks,v=n.axisLine,b=RG(n,T4e),E=o.reduce(function(B,z){return[Math.min(B[0],z.coordinate),Math.max(B[1],z.coordinate)]},[1/0,-1/0]),P=Qi(l,h,E[0],f),O=Qi(l,h,E[1],f),L=kp(kp(kp({},wn(b,!1)),{},{fill:"none"},wn(v,!1)),{},{x1:P.x,y1:P.y,x2:O.x,y2:O.y});return ze.createElement("line",Ab({className:"recharts-polar-radius-axis-line"},L))}},{key:"renderTicks",value:function(){var n=this,l=this.props,h=l.ticks,f=l.tick,o=l.angle,v=l.tickFormatter,b=l.stroke,E=RG(l,E4e),P=this.getTickTextAnchor(),O=wn(E,!1),L=wn(f,!1),B=h.map(function(z,$){var U=n.getTickValueCoord(z),G=kp(kp(kp(kp({textAnchor:P,transform:"rotate(".concat(90-o,", ").concat(U.x,", ").concat(U.y,")")},O),{},{stroke:"none",fill:b},L),{},{index:$},U),{},{payload:z});return ze.createElement(Li,Ab({className:qn("recharts-polar-radius-axis-tick",zee(f)),key:"tick-".concat(z.coordinate)},Sm(n.props,z,$)),t.renderTickItem(f,G,v?v(z.value,$):z.value))});return ze.createElement(Li,{className:"recharts-polar-radius-axis-ticks"},B)}},{key:"render",value:function(){var n=this.props,l=n.ticks,h=n.axisLine,f=n.tick;return!l||!l.length?null:ze.createElement(Li,{className:qn("recharts-polar-radius-axis",this.props.className)},h&&this.renderAxisLine(),f&&this.renderTicks(),xs.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,l,h){var f;return ze.isValidElement(n)?f=ze.cloneElement(n,l):In(n)?f=n(l):f=ze.createElement(Tm,Ab({},l,{className:"recharts-polar-radius-axis-tick-value"}),h),f}}])}(K.PureComponent);eC(tC,"displayName","PolarRadiusAxis");eC(tC,"axisType","radiusAxis");eC(tC,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function j_(e){"@babel/helpers - typeof";return j_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j_(e)}function Up(){return Up=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Up.apply(this,arguments)}function LG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Rp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LG(Object(r),!0).forEach(function(n){rC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function D4e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,tte(n.key),n)}}function L4e(e,t,r){return t&&jG(e.prototype,t),r&&jG(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function j4e(e,t,r){return t=J2(t),N4e(e,ete()?Reflect.construct(t,r||[],J2(e).constructor):t.apply(e,r))}function N4e(e,t){if(t&&(j_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return z4e(e)}function z4e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ete(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ete=function(){return!!e})()}function J2(e){return J2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},J2(e)}function F4e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&YD(e,t)}function YD(e,t){return YD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},YD(e,t)}function rC(e,t,r){return t=tte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tte(e){var t=B4e(e,"string");return j_(t)=="symbol"?t:t+""}function B4e(e,t){if(j_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(j_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var $4e=Math.PI/180,NG=1e-5,nC=function(e){function t(){return D4e(this,t),j4e(this,t,arguments)}return F4e(t,e),L4e(t,[{key:"getTickLineCoord",value:function(n){var l=this.props,h=l.cx,f=l.cy,o=l.radius,v=l.orientation,b=l.tickSize,E=b||8,P=Qi(h,f,o,n.coordinate),O=Qi(h,f,o+(v==="inner"?-1:1)*E,n.coordinate);return{x1:P.x,y1:P.y,x2:O.x,y2:O.y}}},{key:"getTickTextAnchor",value:function(n){var l=this.props.orientation,h=Math.cos(-n.coordinate*$4e),f;return h>NG?f=l==="outer"?"start":"end":h<-NG?f=l==="outer"?"end":"start":f="middle",f}},{key:"renderAxisLine",value:function(){var n=this.props,l=n.cx,h=n.cy,f=n.radius,o=n.axisLine,v=n.axisLineType,b=Rp(Rp({},wn(this.props,!1)),{},{fill:"none"},wn(o,!1));if(v==="circle")return ze.createElement(D3,Up({className:"recharts-polar-angle-axis-line"},b,{cx:l,cy:h,r:f}));var E=this.props.ticks,P=E.map(function(O){return Qi(l,h,f,O.coordinate)});return ze.createElement(r4e,Up({className:"recharts-polar-angle-axis-line"},b,{points:P}))}},{key:"renderTicks",value:function(){var n=this,l=this.props,h=l.ticks,f=l.tick,o=l.tickLine,v=l.tickFormatter,b=l.stroke,E=wn(this.props,!1),P=wn(f,!1),O=Rp(Rp({},E),{},{fill:"none"},wn(o,!1)),L=h.map(function(B,z){var $=n.getTickLineCoord(B),U=n.getTickTextAnchor(B),G=Rp(Rp(Rp({textAnchor:U},E),{},{stroke:"none",fill:b},P),{},{index:z,payload:B,x:$.x2,y:$.y2});return ze.createElement(Li,Up({className:qn("recharts-polar-angle-axis-tick",zee(f)),key:"tick-".concat(B.coordinate)},Sm(n.props,B,z)),o&&ze.createElement("line",Up({className:"recharts-polar-angle-axis-tick-line"},O,$)),f&&t.renderTickItem(f,G,v?v(B.value,z):B.value))});return ze.createElement(Li,{className:"recharts-polar-angle-axis-ticks"},L)}},{key:"render",value:function(){var n=this.props,l=n.ticks,h=n.radius,f=n.axisLine;return h<=0||!l||!l.length?null:ze.createElement(Li,{className:qn("recharts-polar-angle-axis",this.props.className)},f&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,l,h){var f;return ze.isValidElement(n)?f=ze.cloneElement(n,l):In(n)?f=n(l):f=ze.createElement(Tm,Up({},l,{className:"recharts-polar-angle-axis-tick-value"}),h),f}}])}(K.PureComponent);rC(nC,"displayName","PolarAngleAxis");rC(nC,"axisType","angleAxis");rC(nC,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var V4e=nQ,U4e=V4e(Object.getPrototypeOf,Object),G4e=U4e,H4e=Lh,W4e=G4e,q4e=jh,Z4e="[object Object]",X4e=Function.prototype,K4e=Object.prototype,rte=X4e.toString,Y4e=K4e.hasOwnProperty,J4e=rte.call(Object);function Q4e(e){if(!q4e(e)||H4e(e)!=Z4e)return!1;var t=W4e(e);if(t===null)return!0;var r=Y4e.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&rte.call(r)==J4e}var e$e=Q4e;const t$e=Pi(e$e);var r$e=Lh,n$e=jh,i$e="[object Boolean]";function o$e(e){return e===!0||e===!1||n$e(e)&&r$e(e)==i$e}var s$e=o$e;const a$e=Pi(s$e);function Pw(e){"@babel/helpers - typeof";return Pw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pw(e)}function Q2(){return Q2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Q2.apply(this,arguments)}function l$e(e,t){return d$e(e)||h$e(e,t)||u$e(e,t)||c$e()}function c$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u$e(e,t){if(e){if(typeof e=="string")return zG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zG(e,t)}}function zG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h$e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function d$e(e){if(Array.isArray(e))return e}function FG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function BG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FG(Object(r),!0).forEach(function(n){f$e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function f$e(e,t,r){return t=p$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p$e(e){var t=m$e(e,"string");return Pw(t)=="symbol"?t:t+""}function m$e(e,t){if(Pw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Pw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var $G=function(t,r,n,l,h){var f=n-l,o;return o="M ".concat(t,",").concat(r),o+="L ".concat(t+n,",").concat(r),o+="L ".concat(t+n-f/2,",").concat(r+h),o+="L ".concat(t+n-f/2-l,",").concat(r+h),o+="L ".concat(t,",").concat(r," Z"),o},g$e={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},y$e=function(t){var r=BG(BG({},g$e),t),n=K.useRef(),l=K.useState(-1),h=l$e(l,2),f=h[0],o=h[1];K.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var Z=n.current.getTotalLength();Z&&o(Z)}catch{}},[]);var v=r.x,b=r.y,E=r.upperWidth,P=r.lowerWidth,O=r.height,L=r.className,B=r.animationEasing,z=r.animationDuration,$=r.animationBegin,U=r.isUpdateAnimationActive;if(v!==+v||b!==+b||E!==+E||P!==+P||O!==+O||E===0&&P===0||O===0)return null;var G=qn("recharts-trapezoid",L);return U?ze.createElement(kh,{canBegin:f>0,from:{upperWidth:0,lowerWidth:0,height:O,x:v,y:b},to:{upperWidth:E,lowerWidth:P,height:O,x:v,y:b},duration:z,animationEasing:B,isActive:U},function(Z){var ne=Z.upperWidth,Y=Z.lowerWidth,ee=Z.height,le=Z.x,fe=Z.y;return ze.createElement(kh,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:$,duration:z,easing:B},ze.createElement("path",Q2({},wn(r,!0),{className:G,d:$G(le,fe,ne,Y,ee),ref:n})))}):ze.createElement("g",null,ze.createElement("path",Q2({},wn(r,!0),{className:G,d:$G(v,b,E,P,O)})))},_$e=["option","shapeType","propTransformer","activeClassName","isActive"];function Cw(e){"@babel/helpers - typeof";return Cw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cw(e)}function v$e(e,t){if(e==null)return{};var r=x$e(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function x$e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function VG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function eA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VG(Object(r),!0).forEach(function(n){b$e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function b$e(e,t,r){return t=w$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w$e(e){var t=S$e(e,"string");return Cw(t)=="symbol"?t:t+""}function S$e(e,t){if(Cw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Cw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function T$e(e,t){return eA(eA({},t),e)}function E$e(e,t){return e==="symbols"}function UG(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return ze.createElement(R3,r);case"trapezoid":return ze.createElement(y$e,r);case"sector":return ze.createElement($ee,r);case"symbols":if(E$e(t))return ze.createElement(QN,r);break;default:return null}}function A$e(e){return K.isValidElement(e)?e.props:e}function nte(e){var t=e.option,r=e.shapeType,n=e.propTransformer,l=n===void 0?T$e:n,h=e.activeClassName,f=h===void 0?"recharts-active-shape":h,o=e.isActive,v=v$e(e,_$e),b;if(K.isValidElement(t))b=K.cloneElement(t,eA(eA({},v),A$e(t)));else if(In(t))b=t(v);else if(t$e(t)&&!a$e(t)){var E=l(t,v);b=ze.createElement(UG,{shapeType:r,elementProps:E})}else{var P=v;b=ze.createElement(UG,{shapeType:r,elementProps:P})}return o?ze.createElement(Li,{className:f},b):b}function iC(e,t){return t!=null&&"trapezoids"in e.props}function oC(e,t){return t!=null&&"sectors"in e.props}function Iw(e,t){return t!=null&&"points"in e.props}function P$e(e,t){var r,n,l=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,h=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return l&&h}function C$e(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function I$e(e,t){var r=e.x===t.x,n=e.y===t.y,l=e.z===t.z;return r&&n&&l}function M$e(e,t){var r;return iC(e,t)?r=P$e:oC(e,t)?r=C$e:Iw(e,t)&&(r=I$e),r}function O$e(e,t){var r;return iC(e,t)?r="trapezoids":oC(e,t)?r="sectors":Iw(e,t)&&(r="points"),r}function k$e(e,t){if(iC(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(oC(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return Iw(e,t)?t.payload:{}}function R$e(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,l=O$e(r,t),h=k$e(r,t),f=n.filter(function(v,b){var E=KP(h,v),P=r.props[l].filter(function(B){var z=M$e(r,t);return z(B,t)}),O=r.props[l].indexOf(P[P.length-1]),L=b===O;return E&&L}),o=n.indexOf(f[f.length-1]);return o}var AE;function N_(e){"@babel/helpers - typeof";return N_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N_(e)}function Ny(){return Ny=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ny.apply(this,arguments)}function GG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Ki(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?GG(Object(r),!0).forEach(function(n){Rl(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):GG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function D$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function HG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ote(n.key),n)}}function L$e(e,t,r){return t&&HG(e.prototype,t),r&&HG(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function j$e(e,t,r){return t=tA(t),N$e(e,ite()?Reflect.construct(t,r||[],tA(e).constructor):t.apply(e,r))}function N$e(e,t){if(t&&(N_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return z$e(e)}function z$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ite(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ite=function(){return!!e})()}function tA(e){return tA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},tA(e)}function F$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&JD(e,t)}function JD(e,t){return JD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},JD(e,t)}function Rl(e,t,r){return t=ote(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ote(e){var t=B$e(e,"string");return N_(t)=="symbol"?t:t+""}function B$e(e,t){if(N_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(N_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var zh=function(e){function t(r){var n;return D$e(this,t),n=j$e(this,t,[r]),Rl(n,"pieRef",null),Rl(n,"sectorRefs",[]),Rl(n,"id",r1("recharts-pie-")),Rl(n,"handleAnimationEnd",function(){var l=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),In(l)&&l()}),Rl(n,"handleAnimationStart",function(){var l=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),In(l)&&l()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return F$e(t,e),L$e(t,[{key:"isActiveIndex",value:function(n){var l=this.props.activeIndex;return Array.isArray(l)?l.indexOf(n)!==-1:n===l}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var l=this.props.isAnimationActive;if(l&&!this.state.isAnimationFinished)return null;var h=this.props,f=h.label,o=h.labelLine,v=h.dataKey,b=h.valueKey,E=wn(this.props,!1),P=wn(f,!1),O=wn(o,!1),L=f&&f.offsetRadius||20,B=n.map(function(z,$){var U=(z.startAngle+z.endAngle)/2,G=Qi(z.cx,z.cy,z.outerRadius+L,U),Z=Ki(Ki(Ki(Ki({},E),z),{},{stroke:"none"},P),{},{index:$,textAnchor:t.getTextAnchor(G.x,z.cx)},G),ne=Ki(Ki(Ki(Ki({},E),z),{},{fill:"none",stroke:z.fill},O),{},{index:$,points:[Qi(z.cx,z.cy,z.outerRadius,U),G]}),Y=v;return ni(v)&&ni(b)?Y="value":ni(v)&&(Y=b),ze.createElement(Li,{key:"label-".concat(z.startAngle,"-").concat(z.endAngle,"-").concat(z.midAngle,"-").concat($)},o&&t.renderLabelLineItem(o,ne,"line"),t.renderLabelItem(f,Z,Ks(z,Y)))});return ze.createElement(Li,{className:"recharts-pie-labels"},B)}},{key:"renderSectorsStatically",value:function(n){var l=this,h=this.props,f=h.activeShape,o=h.blendStroke,v=h.inactiveShape;return n.map(function(b,E){if(b?.startAngle===0&&b?.endAngle===0&&n.length!==1)return null;var P=l.isActiveIndex(E),O=v&&l.hasActiveIndex()?v:null,L=P?f:O,B=Ki(Ki({},b),{},{stroke:o?b.fill:b.stroke,tabIndex:-1});return ze.createElement(Li,Ny({ref:function($){$&&!l.sectorRefs.includes($)&&l.sectorRefs.push($)},tabIndex:-1,className:"recharts-pie-sector"},Sm(l.props,b,E),{key:"sector-".concat(b?.startAngle,"-").concat(b?.endAngle,"-").concat(b.midAngle,"-").concat(E)}),ze.createElement(nte,Ny({option:L,isActive:P,shapeType:"sector"},B)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,l=this.props,h=l.sectors,f=l.isAnimationActive,o=l.animationBegin,v=l.animationDuration,b=l.animationEasing,E=l.animationId,P=this.state,O=P.prevSectors,L=P.prevIsAnimationActive;return ze.createElement(kh,{begin:o,duration:v,isActive:f,easing:b,from:{t:0},to:{t:1},key:"pie-".concat(E,"-").concat(L),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(B){var z=B.t,$=[],U=h&&h[0],G=U.startAngle;return h.forEach(function(Z,ne){var Y=O&&O[ne],ee=ne>0?dl(Z,"paddingAngle",0):0;if(Y){var le=Vd(Y.endAngle-Y.startAngle,Z.endAngle-Z.startAngle),fe=Ki(Ki({},Z),{},{startAngle:G+ee,endAngle:G+le(z)+ee});$.push(fe),G=fe.endAngle}else{var Ce=Z.endAngle,Oe=Z.startAngle,Me=Vd(0,Ce-Oe),Ke=Me(z),Ye=Ki(Ki({},Z),{},{startAngle:G+ee,endAngle:G+Ke+ee});$.push(Ye),G=Ye.endAngle}}),ze.createElement(Li,null,n.renderSectorsStatically($))})}},{key:"attachKeyboardHandlers",value:function(n){var l=this;n.onkeydown=function(h){if(!h.altKey)switch(h.key){case"ArrowLeft":{var f=++l.state.sectorToFocus%l.sectorRefs.length;l.sectorRefs[f].focus(),l.setState({sectorToFocus:f});break}case"ArrowRight":{var o=--l.state.sectorToFocus<0?l.sectorRefs.length-1:l.state.sectorToFocus%l.sectorRefs.length;l.sectorRefs[o].focus(),l.setState({sectorToFocus:o});break}case"Escape":{l.sectorRefs[l.state.sectorToFocus].blur(),l.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,l=n.sectors,h=n.isAnimationActive,f=this.state.prevSectors;return h&&l&&l.length&&(!f||!KP(f,l))?this.renderSectorsWithAnimation():this.renderSectorsStatically(l)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,l=this.props,h=l.hide,f=l.sectors,o=l.className,v=l.label,b=l.cx,E=l.cy,P=l.innerRadius,O=l.outerRadius,L=l.isAnimationActive,B=this.state.isAnimationFinished;if(h||!f||!f.length||!pr(b)||!pr(E)||!pr(P)||!pr(O))return null;var z=qn("recharts-pie",o);return ze.createElement(Li,{tabIndex:this.props.rootTabIndex,className:z,ref:function(U){n.pieRef=U}},this.renderSectors(),v&&this.renderLabels(f),xs.renderCallByParent(this.props,null,!1),(!L||B)&&pf.renderCallByParent(this.props,f,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,l){return l.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==l.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:l.curSectors,isAnimationFinished:!0}:n.sectors!==l.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,l){return n>l?"start":n<l?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,l,h){if(ze.isValidElement(n))return ze.cloneElement(n,l);if(In(n))return n(l);var f=qn("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return ze.createElement(ND,Ny({},l,{key:h,type:"linear",className:f}))}},{key:"renderLabelItem",value:function(n,l,h){if(ze.isValidElement(n))return ze.cloneElement(n,l);var f=h;if(In(n)&&(f=n(l),ze.isValidElement(f)))return f;var o=qn("recharts-pie-label-text",typeof n!="boolean"&&!In(n)?n.className:"");return ze.createElement(Tm,Ny({},l,{alignmentBaseline:"middle",className:o}),f)}}])}(K.PureComponent);AE=zh;Rl(zh,"displayName","Pie");Rl(zh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!vv.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Rl(zh,"parseDeltaAngle",function(e,t){var r=ya(t-e),n=Math.min(Math.abs(t-e),360);return r*n});Rl(zh,"getRealPieData",function(e){var t=e.data,r=e.children,n=wn(e,!1),l=zl(r,i1);return t&&t.length?t.map(function(h,f){return Ki(Ki(Ki({payload:h},n),h),l&&l[f]&&l[f].props)}):l&&l.length?l.map(function(h){return Ki(Ki({},n),h.props)}):[]});Rl(zh,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,l=t.width,h=t.height,f=Nee(l,h),o=n+_a(e.cx,l,l/2),v=r+_a(e.cy,h,h/2),b=_a(e.innerRadius,f,0),E=_a(e.outerRadius,f,f*.8),P=e.maxRadius||Math.sqrt(l*l+h*h)/2;return{cx:o,cy:v,innerRadius:b,outerRadius:E,maxRadius:P}});Rl(zh,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Ki(Ki({},t.type.defaultProps),t.props):t.props,l=AE.getRealPieData(n);if(!l||!l.length)return null;var h=n.cornerRadius,f=n.startAngle,o=n.endAngle,v=n.paddingAngle,b=n.dataKey,E=n.nameKey,P=n.valueKey,O=n.tooltipType,L=Math.abs(n.minAngle),B=AE.parseCoordinateOfPie(n,r),z=AE.parseDeltaAngle(f,o),$=Math.abs(z),U=b;ni(b)&&ni(P)?(bc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),U="value"):ni(b)&&(bc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),U=P);var G=l.filter(function(fe){return Ks(fe,U,0)!==0}).length,Z=($>=360?G:G-1)*v,ne=$-G*L-Z,Y=l.reduce(function(fe,Ce){var Oe=Ks(Ce,U,0);return fe+(pr(Oe)?Oe:0)},0),ee;if(Y>0){var le;ee=l.map(function(fe,Ce){var Oe=Ks(fe,U,0),Me=Ks(fe,E,Ce),Ke=(pr(Oe)?Oe:0)/Y,Ye;Ce?Ye=le.endAngle+ya(z)*v*(Oe!==0?1:0):Ye=f;var Le=Ye+ya(z)*((Oe!==0?L:0)+Ke*ne),Qe=(Ye+Le)/2,Je=(B.innerRadius+B.outerRadius)/2,it=[{name:Me,value:Oe,payload:fe,dataKey:U,type:O}],Ze=Qi(B.cx,B.cy,Je,Qe);return le=Ki(Ki(Ki({percent:Ke,cornerRadius:h,name:Me,tooltipPayload:it,midAngle:Qe,middleRadius:Je,tooltipPosition:Ze},fe),B),{},{value:Ks(fe,U),startAngle:Ye,endAngle:Le,payload:fe,paddingAngle:ya(z)*v}),le})}return Ki(Ki({},B),{},{sectors:ee,data:l})});var $$e=Math.ceil,V$e=Math.max;function U$e(e,t,r,n){for(var l=-1,h=V$e($$e((t-e)/(r||1)),0),f=Array(h);h--;)f[n?h:++l]=e,e+=r;return f}var G$e=U$e,H$e=wQ,WG=1/0,W$e=17976931348623157e292;function q$e(e){if(!e)return e===0?e:0;if(e=H$e(e),e===WG||e===-WG){var t=e<0?-1:1;return t*W$e}return e===e?e:0}var ste=q$e,Z$e=G$e,X$e=BP,BO=ste;function K$e(e){return function(t,r,n){return n&&typeof n!="number"&&X$e(t,r,n)&&(r=n=void 0),t=BO(t),r===void 0?(r=t,t=0):r=BO(r),n=n===void 0?t<r?1:-1:BO(n),Z$e(t,r,n,e)}}var Y$e=K$e,J$e=Y$e,Q$e=J$e(),eVe=Q$e;const rA=Pi(eVe);function Mw(e){"@babel/helpers - typeof";return Mw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mw(e)}function qG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function ZG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qG(Object(r),!0).forEach(function(n){ate(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ate(e,t,r){return t=tVe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tVe(e){var t=rVe(e,"string");return Mw(t)=="symbol"?t:t+""}function rVe(e,t){if(Mw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Mw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var nVe=["Webkit","Moz","O","ms"],iVe=function(t,r){var n=t.replace(/(\w)/,function(h){return h.toUpperCase()}),l=nVe.reduce(function(h,f){return ZG(ZG({},h),{},ate({},f+n,r))},{});return l[t]=r,l};function z_(e){"@babel/helpers - typeof";return z_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z_(e)}function nA(){return nA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nA.apply(this,arguments)}function XG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function $O(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XG(Object(r),!0).forEach(function(n){il(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oVe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cte(n.key),n)}}function sVe(e,t,r){return t&&KG(e.prototype,t),r&&KG(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function aVe(e,t,r){return t=iA(t),lVe(e,lte()?Reflect.construct(t,r||[],iA(e).constructor):t.apply(e,r))}function lVe(e,t){if(t&&(z_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cVe(e)}function cVe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lte=function(){return!!e})()}function iA(e){return iA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},iA(e)}function uVe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&QD(e,t)}function QD(e,t){return QD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},QD(e,t)}function il(e,t,r){return t=cte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cte(e){var t=hVe(e,"string");return z_(t)=="symbol"?t:t+""}function hVe(e,t){if(z_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(z_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var dVe=function(t){var r=t.data,n=t.startIndex,l=t.endIndex,h=t.x,f=t.width,o=t.travellerWidth;if(!r||!r.length)return{};var v=r.length,b=wb().domain(rA(0,v)).range([h,h+f-o]),E=b.domain().map(function(P){return b(P)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:b(n),endX:b(l),scale:b,scaleValues:E}},YG=function(t){return t.changedTouches&&!!t.changedTouches.length},F_=function(e){function t(r){var n;return oVe(this,t),n=aVe(this,t,[r]),il(n,"handleDrag",function(l){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(l):n.state.isSlideMoving&&n.handleSlideDrag(l)}),il(n,"handleTouchMove",function(l){l.changedTouches!=null&&l.changedTouches.length>0&&n.handleDrag(l.changedTouches[0])}),il(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var l=n.props,h=l.endIndex,f=l.onDragEnd,o=l.startIndex;f?.({endIndex:h,startIndex:o})}),n.detachDragEndListener()}),il(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),il(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),il(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),il(n,"handleSlideDragStart",function(l){var h=YG(l)?l.changedTouches[0]:l;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:h.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return uVe(t,e),sVe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var l=n.startX,h=n.endX,f=this.state.scaleValues,o=this.props,v=o.gap,b=o.data,E=b.length-1,P=Math.min(l,h),O=Math.max(l,h),L=t.getIndexInRange(f,P),B=t.getIndexInRange(f,O);return{startIndex:L-L%v,endIndex:B===E?E:B-B%v}}},{key:"getTextOfTick",value:function(n){var l=this.props,h=l.data,f=l.tickFormatter,o=l.dataKey,v=Ks(h[n],o,n);return In(f)?f(v,n):v}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var l=this.state,h=l.slideMoveStartX,f=l.startX,o=l.endX,v=this.props,b=v.x,E=v.width,P=v.travellerWidth,O=v.startIndex,L=v.endIndex,B=v.onChange,z=n.pageX-h;z>0?z=Math.min(z,b+E-P-o,b+E-P-f):z<0&&(z=Math.max(z,b-f,b-o));var $=this.getIndex({startX:f+z,endX:o+z});($.startIndex!==O||$.endIndex!==L)&&B&&B($),this.setState({startX:f+z,endX:o+z,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,l){var h=YG(l)?l.changedTouches[0]:l;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:h.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var l=this.state,h=l.brushMoveStartX,f=l.movingTravellerId,o=l.endX,v=l.startX,b=this.state[f],E=this.props,P=E.x,O=E.width,L=E.travellerWidth,B=E.onChange,z=E.gap,$=E.data,U={startX:this.state.startX,endX:this.state.endX},G=n.pageX-h;G>0?G=Math.min(G,P+O-L-b):G<0&&(G=Math.max(G,P-b)),U[f]=b+G;var Z=this.getIndex(U),ne=Z.startIndex,Y=Z.endIndex,ee=function(){var fe=$.length-1;return f==="startX"&&(o>v?ne%z===0:Y%z===0)||o<v&&Y===fe||f==="endX"&&(o>v?Y%z===0:ne%z===0)||o>v&&Y===fe};this.setState(il(il({},f,b+G),"brushMoveStartX",n.pageX),function(){B&&ee()&&B(Z)})}},{key:"handleTravellerMoveKeyboard",value:function(n,l){var h=this,f=this.state,o=f.scaleValues,v=f.startX,b=f.endX,E=this.state[l],P=o.indexOf(E);if(P!==-1){var O=P+n;if(!(O===-1||O>=o.length)){var L=o[O];l==="startX"&&L>=b||l==="endX"&&L<=v||this.setState(il({},l,L),function(){h.props.onChange(h.getIndex({startX:h.state.startX,endX:h.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,l=n.x,h=n.y,f=n.width,o=n.height,v=n.fill,b=n.stroke;return ze.createElement("rect",{stroke:b,fill:v,x:l,y:h,width:f,height:o})}},{key:"renderPanorama",value:function(){var n=this.props,l=n.x,h=n.y,f=n.width,o=n.height,v=n.data,b=n.children,E=n.padding,P=K.Children.only(b);return P?ze.cloneElement(P,{x:l,y:h,width:f,height:o,margin:E,compact:!0,data:v}):null}},{key:"renderTravellerLayer",value:function(n,l){var h,f,o=this,v=this.props,b=v.y,E=v.travellerWidth,P=v.height,O=v.traveller,L=v.ariaLabel,B=v.data,z=v.startIndex,$=v.endIndex,U=Math.max(n,this.props.x),G=$O($O({},wn(this.props,!1)),{},{x:U,y:b,width:E,height:P}),Z=L||"Min value: ".concat((h=B[z])===null||h===void 0?void 0:h.name,", Max value: ").concat((f=B[$])===null||f===void 0?void 0:f.name);return ze.createElement(Li,{tabIndex:0,role:"slider","aria-label":Z,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[l],onTouchStart:this.travellerDragStartHandlers[l],onKeyDown:function(Y){["ArrowLeft","ArrowRight"].includes(Y.key)&&(Y.preventDefault(),Y.stopPropagation(),o.handleTravellerMoveKeyboard(Y.key==="ArrowRight"?1:-1,l))},onFocus:function(){o.setState({isTravellerFocused:!0})},onBlur:function(){o.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(O,G))}},{key:"renderSlide",value:function(n,l){var h=this.props,f=h.y,o=h.height,v=h.stroke,b=h.travellerWidth,E=Math.min(n,l)+b,P=Math.max(Math.abs(l-n)-b,0);return ze.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:v,fillOpacity:.2,x:E,y:f,width:P,height:o})}},{key:"renderText",value:function(){var n=this.props,l=n.startIndex,h=n.endIndex,f=n.y,o=n.height,v=n.travellerWidth,b=n.stroke,E=this.state,P=E.startX,O=E.endX,L=5,B={pointerEvents:"none",fill:b};return ze.createElement(Li,{className:"recharts-brush-texts"},ze.createElement(Tm,nA({textAnchor:"end",verticalAnchor:"middle",x:Math.min(P,O)-L,y:f+o/2},B),this.getTextOfTick(l)),ze.createElement(Tm,nA({textAnchor:"start",verticalAnchor:"middle",x:Math.max(P,O)+v+L,y:f+o/2},B),this.getTextOfTick(h)))}},{key:"render",value:function(){var n=this.props,l=n.data,h=n.className,f=n.children,o=n.x,v=n.y,b=n.width,E=n.height,P=n.alwaysShowText,O=this.state,L=O.startX,B=O.endX,z=O.isTextActive,$=O.isSlideMoving,U=O.isTravellerMoving,G=O.isTravellerFocused;if(!l||!l.length||!pr(o)||!pr(v)||!pr(b)||!pr(E)||b<=0||E<=0)return null;var Z=qn("recharts-brush",h),ne=ze.Children.count(f)===1,Y=iVe("userSelect","none");return ze.createElement(Li,{className:Z,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:Y},this.renderBackground(),ne&&this.renderPanorama(),this.renderSlide(L,B),this.renderTravellerLayer(L,"startX"),this.renderTravellerLayer(B,"endX"),(z||$||U||G||P)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var l=n.x,h=n.y,f=n.width,o=n.height,v=n.stroke,b=Math.floor(h+o/2)-1;return ze.createElement(ze.Fragment,null,ze.createElement("rect",{x:l,y:h,width:f,height:o,fill:v,stroke:"none"}),ze.createElement("line",{x1:l+1,y1:b,x2:l+f-1,y2:b,fill:"none",stroke:"#fff"}),ze.createElement("line",{x1:l+1,y1:b+2,x2:l+f-1,y2:b+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,l){var h;return ze.isValidElement(n)?h=ze.cloneElement(n,l):In(n)?h=n(l):h=t.renderDefaultTraveller(l),h}},{key:"getDerivedStateFromProps",value:function(n,l){var h=n.data,f=n.width,o=n.x,v=n.travellerWidth,b=n.updateId,E=n.startIndex,P=n.endIndex;if(h!==l.prevData||b!==l.prevUpdateId)return $O({prevData:h,prevTravellerWidth:v,prevUpdateId:b,prevX:o,prevWidth:f},h&&h.length?dVe({data:h,width:f,x:o,travellerWidth:v,startIndex:E,endIndex:P}):{scale:null,scaleValues:null});if(l.scale&&(f!==l.prevWidth||o!==l.prevX||v!==l.prevTravellerWidth)){l.scale.range([o,o+f-v]);var O=l.scale.domain().map(function(L){return l.scale(L)});return{prevData:h,prevTravellerWidth:v,prevUpdateId:b,prevX:o,prevWidth:f,startX:l.scale(n.startIndex),endX:l.scale(n.endIndex),scaleValues:O}}return null}},{key:"getIndexInRange",value:function(n,l){for(var h=n.length,f=0,o=h-1;o-f>1;){var v=Math.floor((f+o)/2);n[v]>l?o=v:f=v}return l>=n[o]?o:f}}])}(K.PureComponent);il(F_,"displayName","Brush");il(F_,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var fVe=s3;function pVe(e,t){var r;return fVe(e,function(n,l,h){return r=t(n,l,h),!r}),!!r}var mVe=pVe,gVe=XJ,yVe=Mu,_Ve=mVe,vVe=qa,xVe=BP;function bVe(e,t,r){var n=vVe(e)?gVe:_Ve;return r&&xVe(e,t,r)&&(t=void 0),n(e,yVe(t))}var wVe=bVe;const SVe=Pi(wVe);var Tu=function(t,r){var n=t.alwaysShow,l=t.ifOverflow;return n&&(l="extendDomain"),l===r},JG=yQ;function TVe(e,t,r){t=="__proto__"&&JG?JG(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var EVe=TVe,AVe=EVe,PVe=mQ,CVe=Mu;function IVe(e,t){var r={};return t=CVe(t),PVe(e,function(n,l,h){AVe(r,l,t(n,l,h))}),r}var MVe=IVe;const OVe=Pi(MVe);function kVe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var RVe=kVe,DVe=s3;function LVe(e,t){var r=!0;return DVe(e,function(n,l,h){return r=!!t(n,l,h),r}),r}var jVe=LVe,NVe=RVe,zVe=jVe,FVe=Mu,BVe=qa,$Ve=BP;function VVe(e,t,r){var n=BVe(e)?NVe:zVe;return r&&$Ve(e,t,r)&&(t=void 0),n(e,FVe(t))}var UVe=VVe;const ute=Pi(UVe);var GVe=["x","y"];function Ow(e){"@babel/helpers - typeof";return Ow=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ow(e)}function eL(){return eL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},eL.apply(this,arguments)}function QG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Hx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QG(Object(r),!0).forEach(function(n){HVe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function HVe(e,t,r){return t=WVe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WVe(e){var t=qVe(e,"string");return Ow(t)=="symbol"?t:t+""}function qVe(e,t){if(Ow(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ow(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ZVe(e,t){if(e==null)return{};var r=XVe(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function XVe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function KVe(e,t){var r=e.x,n=e.y,l=ZVe(e,GVe),h="".concat(r),f=parseInt(h,10),o="".concat(n),v=parseInt(o,10),b="".concat(t.height||l.height),E=parseInt(b,10),P="".concat(t.width||l.width),O=parseInt(P,10);return Hx(Hx(Hx(Hx(Hx({},t),l),f?{x:f}:{}),v?{y:v}:{}),{},{height:E,width:O,name:t.name,radius:t.radius})}function eH(e){return ze.createElement(nte,eL({shapeType:"rectangle",propTransformer:KVe,activeClassName:"recharts-active-bar"},e))}var YVe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,l){if(typeof t=="number")return t;var h=pr(n)||gEe(n);return h?t(n,l):(h||Am(),r)}},JVe=["value","background"],hte;function B_(e){"@babel/helpers - typeof";return B_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B_(e)}function QVe(e,t){if(e==null)return{};var r=eUe(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function eUe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function oA(){return oA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oA.apply(this,arguments)}function tH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Uo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tH(Object(r),!0).forEach(function(n){rf(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fte(n.key),n)}}function rUe(e,t,r){return t&&rH(e.prototype,t),r&&rH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function nUe(e,t,r){return t=sA(t),iUe(e,dte()?Reflect.construct(t,r||[],sA(e).constructor):t.apply(e,r))}function iUe(e,t){if(t&&(B_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oUe(e)}function oUe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dte=function(){return!!e})()}function sA(e){return sA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},sA(e)}function sUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tL(e,t)}function tL(e,t){return tL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},tL(e,t)}function rf(e,t,r){return t=fte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fte(e){var t=aUe(e,"string");return B_(t)=="symbol"?t:t+""}function aUe(e,t){if(B_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(B_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Rh=function(e){function t(){var r;tUe(this,t);for(var n=arguments.length,l=new Array(n),h=0;h<n;h++)l[h]=arguments[h];return r=nUe(this,t,[].concat(l)),rf(r,"state",{isAnimationFinished:!1}),rf(r,"id",r1("recharts-bar-")),rf(r,"handleAnimationEnd",function(){var f=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),f&&f()}),rf(r,"handleAnimationStart",function(){var f=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),f&&f()}),r}return sUe(t,e),rUe(t,[{key:"renderRectanglesStatically",value:function(n){var l=this,h=this.props,f=h.shape,o=h.dataKey,v=h.activeIndex,b=h.activeBar,E=wn(this.props,!1);return n&&n.map(function(P,O){var L=O===v,B=L?b:f,z=Uo(Uo(Uo({},E),P),{},{isActive:L,option:B,index:O,dataKey:o,onAnimationStart:l.handleAnimationStart,onAnimationEnd:l.handleAnimationEnd});return ze.createElement(Li,oA({className:"recharts-bar-rectangle"},Sm(l.props,P,O),{key:"rectangle-".concat(P?.x,"-").concat(P?.y,"-").concat(P?.value,"-").concat(O)}),ze.createElement(eH,z))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,l=this.props,h=l.data,f=l.layout,o=l.isAnimationActive,v=l.animationBegin,b=l.animationDuration,E=l.animationEasing,P=l.animationId,O=this.state.prevData;return ze.createElement(kh,{begin:v,duration:b,isActive:o,easing:E,from:{t:0},to:{t:1},key:"bar-".concat(P),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(L){var B=L.t,z=h.map(function($,U){var G=O&&O[U];if(G){var Z=Vd(G.x,$.x),ne=Vd(G.y,$.y),Y=Vd(G.width,$.width),ee=Vd(G.height,$.height);return Uo(Uo({},$),{},{x:Z(B),y:ne(B),width:Y(B),height:ee(B)})}if(f==="horizontal"){var le=Vd(0,$.height),fe=le(B);return Uo(Uo({},$),{},{y:$.y+$.height-fe,height:fe})}var Ce=Vd(0,$.width),Oe=Ce(B);return Uo(Uo({},$),{},{width:Oe})});return ze.createElement(Li,null,n.renderRectanglesStatically(z))})}},{key:"renderRectangles",value:function(){var n=this.props,l=n.data,h=n.isAnimationActive,f=this.state.prevData;return h&&l&&l.length&&(!f||!KP(f,l))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(l)}},{key:"renderBackground",value:function(){var n=this,l=this.props,h=l.data,f=l.dataKey,o=l.activeIndex,v=wn(this.props.background,!1);return h.map(function(b,E){b.value;var P=b.background,O=QVe(b,JVe);if(!P)return null;var L=Uo(Uo(Uo(Uo(Uo({},O),{},{fill:"#eee"},P),v),Sm(n.props,b,E)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:f,index:E,className:"recharts-bar-background-rectangle"});return ze.createElement(eH,oA({key:"background-bar-".concat(E),option:n.props.background,isActive:E===o},L))})}},{key:"renderErrorBar",value:function(n,l){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var h=this.props,f=h.data,o=h.xAxis,v=h.yAxis,b=h.layout,E=h.children,P=zl(E,QP);if(!P)return null;var O=b==="vertical"?f[0].height/2:f[0].width/2,L=function($,U){var G=Array.isArray($.value)?$.value[1]:$.value;return{x:$.x,y:$.y,value:G,errorVal:Ks($,U)}},B={clipPath:n?"url(#clipPath-".concat(l,")"):null};return ze.createElement(Li,B,P.map(function(z){return ze.cloneElement(z,{key:"error-bar-".concat(l,"-").concat(z.props.dataKey),data:f,xAxis:o,yAxis:v,layout:b,offset:O,dataPointFormatter:L})}))}},{key:"render",value:function(){var n=this.props,l=n.hide,h=n.data,f=n.className,o=n.xAxis,v=n.yAxis,b=n.left,E=n.top,P=n.width,O=n.height,L=n.isAnimationActive,B=n.background,z=n.id;if(l||!h||!h.length)return null;var $=this.state.isAnimationFinished,U=qn("recharts-bar",f),G=o&&o.allowDataOverflow,Z=v&&v.allowDataOverflow,ne=G||Z,Y=ni(z)?this.id:z;return ze.createElement(Li,{className:U},G||Z?ze.createElement("defs",null,ze.createElement("clipPath",{id:"clipPath-".concat(Y)},ze.createElement("rect",{x:G?b:b-P/2,y:Z?E:E-O/2,width:G?P:P*2,height:Z?O:O*2}))):null,ze.createElement(Li,{className:"recharts-bar-rectangles",clipPath:ne?"url(#clipPath-".concat(Y,")"):null},B?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(ne,Y),(!L||$)&&pf.renderCallByParent(this.props,h))}}],[{key:"getDerivedStateFromProps",value:function(n,l){return n.animationId!==l.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:l.curData}:n.data!==l.curData?{curData:n.data}:null}}])}(K.PureComponent);hte=Rh;rf(Rh,"displayName","Bar");rf(Rh,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!vv.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});rf(Rh,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,l=e.bandSize,h=e.xAxis,f=e.yAxis,o=e.xAxisTicks,v=e.yAxisTicks,b=e.stackedData,E=e.dataStartIndex,P=e.displayedData,O=e.offset,L=$ze(n,r);if(!L)return null;var B=t.layout,z=r.type.defaultProps,$=z!==void 0?Uo(Uo({},z),r.props):r.props,U=$.dataKey,G=$.children,Z=$.minPointSize,ne=B==="horizontal"?f:h,Y=b?ne.scale.domain():null,ee=Zze({numericAxis:ne}),le=zl(G,i1),fe=P.map(function(Ce,Oe){var Me,Ke,Ye,Le,Qe,Je;b?Me=Vze(b[E+Oe],Y):(Me=Ks(Ce,U),Array.isArray(Me)||(Me=[ee,Me]));var it=YVe(Z,hte.defaultProps.minPointSize)(Me[1],Oe);if(B==="horizontal"){var Ze,nt=[f.scale(Me[0]),f.scale(Me[1])],pt=nt[0],_t=nt[1];Ke=H8({axis:h,ticks:o,bandSize:l,offset:L.offset,entry:Ce,index:Oe}),Ye=(Ze=_t??pt)!==null&&Ze!==void 0?Ze:void 0,Le=L.size;var It=pt-_t;if(Qe=Number.isNaN(It)?0:It,Je={x:Ke,y:f.y,width:Le,height:f.height},Math.abs(it)>0&&Math.abs(Qe)<Math.abs(it)){var sr=ya(Qe||it)*(Math.abs(it)-Math.abs(Qe));Ye-=sr,Qe+=sr}}else{var Sr=[h.scale(Me[0]),h.scale(Me[1])],Kr=Sr[0],Er=Sr[1];if(Ke=Kr,Ye=H8({axis:f,ticks:v,bandSize:l,offset:L.offset,entry:Ce,index:Oe}),Le=Er-Kr,Qe=L.size,Je={x:h.x,y:Ye,width:h.width,height:Qe},Math.abs(it)>0&&Math.abs(Le)<Math.abs(it)){var Kt=ya(Le||it)*(Math.abs(it)-Math.abs(Le));Le+=Kt}}return Uo(Uo(Uo({},Ce),{},{x:Ke,y:Ye,width:Le,height:Qe,value:b?Me:Me[1],payload:Ce,background:Je},le&&le[Oe]&&le[Oe].props),{},{tooltipPayload:[Lee(r,Ce)],tooltipPosition:{x:Ke+Le/2,y:Ye+Qe/2}})});return Uo({data:fe,layout:B},O)});function kw(e){"@babel/helpers - typeof";return kw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kw(e)}function lUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pte(n.key),n)}}function cUe(e,t,r){return t&&nH(e.prototype,t),r&&nH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function iH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function gc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iH(Object(r),!0).forEach(function(n){sC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sC(e,t,r){return t=pte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pte(e){var t=uUe(e,"string");return kw(t)=="symbol"?t:t+""}function uUe(e,t){if(kw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(kw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hUe=function(t,r,n,l,h){var f=t.width,o=t.height,v=t.layout,b=t.children,E=Object.keys(r),P={left:n.left,leftMirror:n.left,right:f-n.right,rightMirror:f-n.right,top:n.top,topMirror:n.top,bottom:o-n.bottom,bottomMirror:o-n.bottom},O=!!sl(b,Rh);return E.reduce(function(L,B){var z=r[B],$=z.orientation,U=z.domain,G=z.padding,Z=G===void 0?{}:G,ne=z.mirror,Y=z.reversed,ee="".concat($).concat(ne?"Mirror":""),le,fe,Ce,Oe,Me;if(z.type==="number"&&(z.padding==="gap"||z.padding==="no-gap")){var Ke=U[1]-U[0],Ye=1/0,Le=z.categoricalDomain.sort(vEe);if(Le.forEach(function(Sr,Kr){Kr>0&&(Ye=Math.min((Sr||0)-(Le[Kr-1]||0),Ye))}),Number.isFinite(Ye)){var Qe=Ye/Ke,Je=z.layout==="vertical"?n.height:n.width;if(z.padding==="gap"&&(le=Qe*Je/2),z.padding==="no-gap"){var it=_a(t.barCategoryGap,Qe*Je),Ze=Qe*Je/2;le=Ze-it-(Ze-it)/Je*it}}}l==="xAxis"?fe=[n.left+(Z.left||0)+(le||0),n.left+n.width-(Z.right||0)-(le||0)]:l==="yAxis"?fe=v==="horizontal"?[n.top+n.height-(Z.bottom||0),n.top+(Z.top||0)]:[n.top+(Z.top||0)+(le||0),n.top+n.height-(Z.bottom||0)-(le||0)]:fe=z.range,Y&&(fe=[fe[1],fe[0]]);var nt=Oee(z,h,O),pt=nt.scale,_t=nt.realScaleType;pt.domain(U).range(fe),kee(pt);var It=Ree(pt,gc(gc({},z),{},{realScaleType:_t}));l==="xAxis"?(Me=$==="top"&&!ne||$==="bottom"&&ne,Ce=n.left,Oe=P[ee]-Me*z.height):l==="yAxis"&&(Me=$==="left"&&!ne||$==="right"&&ne,Ce=P[ee]-Me*z.width,Oe=n.top);var sr=gc(gc(gc({},z),It),{},{realScaleType:_t,x:Ce,y:Oe,scale:pt,width:l==="xAxis"?n.width:z.width,height:l==="yAxis"?n.height:z.height});return sr.bandSize=G2(sr,It),!z.hide&&l==="xAxis"?P[ee]+=(Me?-1:1)*sr.height:z.hide||(P[ee]+=(Me?-1:1)*sr.width),gc(gc({},L),{},sC({},B,sr))},{})},mte=function(t,r){var n=t.x,l=t.y,h=r.x,f=r.y;return{x:Math.min(n,h),y:Math.min(l,f),width:Math.abs(h-n),height:Math.abs(f-l)}},dUe=function(t){var r=t.x1,n=t.y1,l=t.x2,h=t.y2;return mte({x:r,y:n},{x:l,y:h})},gte=function(){function e(t){lUe(this,e),this.scale=t}return cUe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=n.bandAware,h=n.position;if(r!==void 0){if(h)switch(h){case"start":return this.scale(r);case"middle":{var f=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+f}case"end":{var o=this.bandwidth?this.bandwidth():0;return this.scale(r)+o}default:return this.scale(r)}if(l){var v=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+v}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),l=n[0],h=n[n.length-1];return l<=h?r>=l&&r<=h:r>=h&&r<=l}}],[{key:"create",value:function(r){return new e(r)}}])}();sC(gte,"EPS",1e-4);var L3=function(t){var r=Object.keys(t).reduce(function(n,l){return gc(gc({},n),{},sC({},l,gte.create(t[l])))},{});return gc(gc({},r),{},{apply:function(l){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=h.bandAware,o=h.position;return OVe(l,function(v,b){return r[b].apply(v,{bandAware:f,position:o})})},isInRange:function(l){return ute(l,function(h,f){return r[f].isInRange(h)})}})};function fUe(e){return(e%180+180)%180}var pUe=function(t){var r=t.width,n=t.height,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,h=fUe(l),f=h*Math.PI/180,o=Math.atan(n/r),v=f>o&&f<Math.PI-o?n/Math.sin(f):r/Math.cos(f);return Math.abs(v)},mUe=Mu,gUe=n1,yUe=zP;function _Ue(e){return function(t,r,n){var l=Object(t);if(!gUe(t)){var h=mUe(r);t=yUe(t),r=function(o){return h(l[o],o,l)}}var f=e(t,r,n);return f>-1?l[h?t[f]:f]:void 0}}var vUe=_Ue,xUe=ste;function bUe(e){var t=xUe(e),r=t%1;return t===t?r?t-r:t:0}var wUe=bUe,SUe=cQ,TUe=Mu,EUe=wUe,AUe=Math.max;function PUe(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var l=r==null?0:EUe(r);return l<0&&(l=AUe(n+l,0)),SUe(e,TUe(t),l)}var CUe=PUe,IUe=vUe,MUe=CUe,OUe=IUe(MUe),kUe=OUe;const RUe=Pi(kUe);var DUe=wTe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),j3=K.createContext(void 0),N3=K.createContext(void 0),yte=K.createContext(void 0),_te=K.createContext({}),vte=K.createContext(void 0),xte=K.createContext(0),bte=K.createContext(0),oH=function(t){var r=t.state,n=r.xAxisMap,l=r.yAxisMap,h=r.offset,f=t.clipPathId,o=t.children,v=t.width,b=t.height,E=DUe(h);return ze.createElement(j3.Provider,{value:n},ze.createElement(N3.Provider,{value:l},ze.createElement(_te.Provider,{value:h},ze.createElement(yte.Provider,{value:E},ze.createElement(vte.Provider,{value:f},ze.createElement(xte.Provider,{value:b},ze.createElement(bte.Provider,{value:v},o)))))))},LUe=function(){return K.useContext(vte)},wte=function(t){var r=K.useContext(j3);r==null&&Am();var n=r[t];return n==null&&Am(),n},jUe=function(){var t=K.useContext(j3);return qd(t)},NUe=function(){var t=K.useContext(N3),r=RUe(t,function(n){return ute(n.domain,Number.isFinite)});return r||qd(t)},Ste=function(t){var r=K.useContext(N3);r==null&&Am();var n=r[t];return n==null&&Am(),n},zUe=function(){var t=K.useContext(yte);return t},FUe=function(){return K.useContext(_te)},z3=function(){return K.useContext(bte)},F3=function(){return K.useContext(xte)};function $_(e){"@babel/helpers - typeof";return $_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$_(e)}function BUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $Ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ete(n.key),n)}}function VUe(e,t,r){return t&&$Ue(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function UUe(e,t,r){return t=aA(t),GUe(e,Tte()?Reflect.construct(t,r||[],aA(e).constructor):t.apply(e,r))}function GUe(e,t){if(t&&($_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return HUe(e)}function HUe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Tte=function(){return!!e})()}function aA(e){return aA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},aA(e)}function WUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rL(e,t)}function rL(e,t){return rL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},rL(e,t)}function sH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function aH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sH(Object(r),!0).forEach(function(n){B3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function B3(e,t,r){return t=Ete(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ete(e){var t=qUe(e,"string");return $_(t)=="symbol"?t:t+""}function qUe(e,t){if($_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if($_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function ZUe(e,t){return JUe(e)||YUe(e,t)||KUe(e,t)||XUe()}function XUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KUe(e,t){if(e){if(typeof e=="string")return lH(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lH(e,t)}}function lH(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function YUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function JUe(e){if(Array.isArray(e))return e}function nL(){return nL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nL.apply(this,arguments)}var QUe=function(t,r){var n;return ze.isValidElement(t)?n=ze.cloneElement(t,r):In(t)?n=t(r):n=ze.createElement("line",nL({},r,{className:"recharts-reference-line-line"})),n},e6e=function(t,r,n,l,h,f,o,v,b){var E=h.x,P=h.y,O=h.width,L=h.height;if(n){var B=b.y,z=t.y.apply(B,{position:f});if(Tu(b,"discard")&&!t.y.isInRange(z))return null;var $=[{x:E+O,y:z},{x:E,y:z}];return v==="left"?$.reverse():$}if(r){var U=b.x,G=t.x.apply(U,{position:f});if(Tu(b,"discard")&&!t.x.isInRange(G))return null;var Z=[{x:G,y:P+L},{x:G,y:P}];return o==="top"?Z.reverse():Z}if(l){var ne=b.segment,Y=ne.map(function(ee){return t.apply(ee,{position:f})});return Tu(b,"discard")&&SVe(Y,function(ee){return!t.isInRange(ee)})?null:Y}return null};function t6e(e){var t=e.x,r=e.y,n=e.segment,l=e.xAxisId,h=e.yAxisId,f=e.shape,o=e.className,v=e.alwaysShow,b=LUe(),E=wte(l),P=Ste(h),O=zUe();if(!b||!O)return null;bc(v===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var L=L3({x:E.scale,y:P.scale}),B=as(t),z=as(r),$=n&&n.length===2,U=e6e(L,B,z,$,O,e.position,E.orientation,P.orientation,e);if(!U)return null;var G=ZUe(U,2),Z=G[0],ne=Z.x,Y=Z.y,ee=G[1],le=ee.x,fe=ee.y,Ce=Tu(e,"hidden")?"url(#".concat(b,")"):void 0,Oe=aH(aH({clipPath:Ce},wn(e,!0)),{},{x1:ne,y1:Y,x2:le,y2:fe});return ze.createElement(Li,{className:qn("recharts-reference-line",o)},QUe(f,Oe),xs.renderCallByParent(e,dUe({x1:ne,y1:Y,x2:le,y2:fe})))}var $3=function(e){function t(){return BUe(this,t),UUe(this,t,arguments)}return WUe(t,e),VUe(t,[{key:"render",value:function(){return ze.createElement(t6e,this.props)}}])}(ze.Component);B3($3,"displayName","ReferenceLine");B3($3,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function iL(){return iL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},iL.apply(this,arguments)}function V_(e){"@babel/helpers - typeof";return V_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V_(e)}function cH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function uH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cH(Object(r),!0).forEach(function(n){aC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function r6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n6e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Pte(n.key),n)}}function i6e(e,t,r){return t&&n6e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function o6e(e,t,r){return t=lA(t),s6e(e,Ate()?Reflect.construct(t,r||[],lA(e).constructor):t.apply(e,r))}function s6e(e,t){if(t&&(V_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return a6e(e)}function a6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ate(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ate=function(){return!!e})()}function lA(e){return lA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},lA(e)}function l6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oL(e,t)}function oL(e,t){return oL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},oL(e,t)}function aC(e,t,r){return t=Pte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pte(e){var t=c6e(e,"string");return V_(t)=="symbol"?t:t+""}function c6e(e,t){if(V_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(V_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var u6e=function(t){var r=t.x,n=t.y,l=t.xAxis,h=t.yAxis,f=L3({x:l.scale,y:h.scale}),o=f.apply({x:r,y:n},{bandAware:!0});return Tu(t,"discard")&&!f.isInRange(o)?null:o},lC=function(e){function t(){return r6e(this,t),o6e(this,t,arguments)}return l6e(t,e),i6e(t,[{key:"render",value:function(){var n=this.props,l=n.x,h=n.y,f=n.r,o=n.alwaysShow,v=n.clipPathId,b=as(l),E=as(h);if(bc(o===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!b||!E)return null;var P=u6e(this.props);if(!P)return null;var O=P.x,L=P.y,B=this.props,z=B.shape,$=B.className,U=Tu(this.props,"hidden")?"url(#".concat(v,")"):void 0,G=uH(uH({clipPath:U},wn(this.props,!0)),{},{cx:O,cy:L});return ze.createElement(Li,{className:qn("recharts-reference-dot",$)},t.renderDot(z,G),xs.renderCallByParent(this.props,{x:O-f,y:L-f,width:2*f,height:2*f}))}}])}(ze.Component);aC(lC,"displayName","ReferenceDot");aC(lC,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});aC(lC,"renderDot",function(e,t){var r;return ze.isValidElement(e)?r=ze.cloneElement(e,t):In(e)?r=e(t):r=ze.createElement(D3,iL({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function sL(){return sL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},sL.apply(this,arguments)}function U_(e){"@babel/helpers - typeof";return U_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U_(e)}function hH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function dH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hH(Object(r),!0).forEach(function(n){cC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function h6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d6e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ite(n.key),n)}}function f6e(e,t,r){return t&&d6e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function p6e(e,t,r){return t=cA(t),m6e(e,Cte()?Reflect.construct(t,r||[],cA(e).constructor):t.apply(e,r))}function m6e(e,t){if(t&&(U_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return g6e(e)}function g6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Cte=function(){return!!e})()}function cA(e){return cA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},cA(e)}function y6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&aL(e,t)}function aL(e,t){return aL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},aL(e,t)}function cC(e,t,r){return t=Ite(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ite(e){var t=_6e(e,"string");return U_(t)=="symbol"?t:t+""}function _6e(e,t){if(U_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(U_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var v6e=function(t,r,n,l,h){var f=h.x1,o=h.x2,v=h.y1,b=h.y2,E=h.xAxis,P=h.yAxis;if(!E||!P)return null;var O=L3({x:E.scale,y:P.scale}),L={x:t?O.x.apply(f,{position:"start"}):O.x.rangeMin,y:n?O.y.apply(v,{position:"start"}):O.y.rangeMin},B={x:r?O.x.apply(o,{position:"end"}):O.x.rangeMax,y:l?O.y.apply(b,{position:"end"}):O.y.rangeMax};return Tu(h,"discard")&&(!O.isInRange(L)||!O.isInRange(B))?null:mte(L,B)},uC=function(e){function t(){return h6e(this,t),p6e(this,t,arguments)}return y6e(t,e),f6e(t,[{key:"render",value:function(){var n=this.props,l=n.x1,h=n.x2,f=n.y1,o=n.y2,v=n.className,b=n.alwaysShow,E=n.clipPathId;bc(b===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var P=as(l),O=as(h),L=as(f),B=as(o),z=this.props.shape;if(!P&&!O&&!L&&!B&&!z)return null;var $=v6e(P,O,L,B,this.props);if(!$&&!z)return null;var U=Tu(this.props,"hidden")?"url(#".concat(E,")"):void 0;return ze.createElement(Li,{className:qn("recharts-reference-area",v)},t.renderRect(z,dH(dH({clipPath:U},wn(this.props,!0)),$)),xs.renderCallByParent(this.props,$))}}])}(ze.Component);cC(uC,"displayName","ReferenceArea");cC(uC,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});cC(uC,"renderRect",function(e,t){var r;return ze.isValidElement(e)?r=ze.cloneElement(e,t):In(e)?r=e(t):r=ze.createElement(R3,sL({},t,{className:"recharts-reference-area-rect"})),r});function Mte(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],l=0;l<e.length;l+=t)n.push(e[l]);return n}function x6e(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return pUe(n,r)}function b6e(e,t,r){var n=r==="width",l=e.x,h=e.y,f=e.width,o=e.height;return t===1?{start:n?l:h,end:n?l+f:h+o}:{start:n?l+f:h+o,end:n?l:h}}function uA(e,t,r,n,l){if(e*t<e*n||e*t>e*l)return!1;var h=r();return e*(t-e*h/2-n)>=0&&e*(t+e*h/2-l)<=0}function w6e(e,t){return Mte(e,t+1)}function S6e(e,t,r,n,l){for(var h=(n||[]).slice(),f=t.start,o=t.end,v=0,b=1,E=f,P=function(){var B=n?.[v];if(B===void 0)return{v:Mte(n,b)};var z=v,$,U=function(){return $===void 0&&($=r(B,z)),$},G=B.coordinate,Z=v===0||uA(e,G,U,E,o);Z||(v=0,E=f,b+=1),Z&&(E=G+e*(U()/2+l),v+=b)},O;b<=h.length;)if(O=P(),O)return O.v;return[]}function Rw(e){"@babel/helpers - typeof";return Rw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rw(e)}function fH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function qs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fH(Object(r),!0).forEach(function(n){T6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function T6e(e,t,r){return t=E6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E6e(e){var t=A6e(e,"string");return Rw(t)=="symbol"?t:t+""}function A6e(e,t){if(Rw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Rw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function P6e(e,t,r,n,l){for(var h=(n||[]).slice(),f=h.length,o=t.start,v=t.end,b=function(O){var L=h[O],B,z=function(){return B===void 0&&(B=r(L,O)),B};if(O===f-1){var $=e*(L.coordinate+e*z()/2-v);h[O]=L=qs(qs({},L),{},{tickCoord:$>0?L.coordinate-$*e:L.coordinate})}else h[O]=L=qs(qs({},L),{},{tickCoord:L.coordinate});var U=uA(e,L.tickCoord,z,o,v);U&&(v=L.tickCoord-e*(z()/2+l),h[O]=qs(qs({},L),{},{isShow:!0}))},E=f-1;E>=0;E--)b(E);return h}function C6e(e,t,r,n,l,h){var f=(n||[]).slice(),o=f.length,v=t.start,b=t.end;if(h){var E=n[o-1],P=r(E,o-1),O=e*(E.coordinate+e*P/2-b);f[o-1]=E=qs(qs({},E),{},{tickCoord:O>0?E.coordinate-O*e:E.coordinate});var L=uA(e,E.tickCoord,function(){return P},v,b);L&&(b=E.tickCoord-e*(P/2+l),f[o-1]=qs(qs({},E),{},{isShow:!0}))}for(var B=h?o-1:o,z=function(G){var Z=f[G],ne,Y=function(){return ne===void 0&&(ne=r(Z,G)),ne};if(G===0){var ee=e*(Z.coordinate-e*Y()/2-v);f[G]=Z=qs(qs({},Z),{},{tickCoord:ee<0?Z.coordinate-ee*e:Z.coordinate})}else f[G]=Z=qs(qs({},Z),{},{tickCoord:Z.coordinate});var le=uA(e,Z.tickCoord,Y,v,b);le&&(v=Z.tickCoord+e*(Y()/2+l),f[G]=qs(qs({},Z),{},{isShow:!0}))},$=0;$<B;$++)z($);return f}function V3(e,t,r){var n=e.tick,l=e.ticks,h=e.viewBox,f=e.minTickGap,o=e.orientation,v=e.interval,b=e.tickFormatter,E=e.unit,P=e.angle;if(!l||!l.length||!n)return[];if(pr(v)||vv.isSsr)return w6e(l,typeof v=="number"&&pr(v)?v:0);var O=[],L=o==="top"||o==="bottom"?"width":"height",B=E&&L==="width"?bb(E,{fontSize:t,letterSpacing:r}):{width:0,height:0},z=function(Z,ne){var Y=In(b)?b(Z.value,ne):Z.value;return L==="width"?x6e(bb(Y,{fontSize:t,letterSpacing:r}),B,P):bb(Y,{fontSize:t,letterSpacing:r})[L]},$=l.length>=2?ya(l[1].coordinate-l[0].coordinate):1,U=b6e(h,$,L);return v==="equidistantPreserveStart"?S6e($,U,z,l,f):(v==="preserveStart"||v==="preserveStartEnd"?O=C6e($,U,z,l,f,v==="preserveStartEnd"):O=P6e($,U,z,l,f),O.filter(function(G){return G.isShow}))}var I6e=["viewBox"],M6e=["viewBox"],O6e=["ticks"];function G_(e){"@babel/helpers - typeof";return G_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G_(e)}function zy(){return zy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zy.apply(this,arguments)}function pH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function es(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pH(Object(r),!0).forEach(function(n){U3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VO(e,t){if(e==null)return{};var r=k6e(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function k6e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function R6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kte(n.key),n)}}function D6e(e,t,r){return t&&mH(e.prototype,t),r&&mH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function L6e(e,t,r){return t=hA(t),j6e(e,Ote()?Reflect.construct(t,r||[],hA(e).constructor):t.apply(e,r))}function j6e(e,t){if(t&&(G_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return N6e(e)}function N6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ote(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ote=function(){return!!e})()}function hA(e){return hA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},hA(e)}function z6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lL(e,t)}function lL(e,t){return lL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},lL(e,t)}function U3(e,t,r){return t=kte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kte(e){var t=F6e(e,"string");return G_(t)=="symbol"?t:t+""}function F6e(e,t){if(G_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(G_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Sv=function(e){function t(r){var n;return R6e(this,t),n=L6e(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return z6e(t,e),D6e(t,[{key:"shouldComponentUpdate",value:function(n,l){var h=n.viewBox,f=VO(n,I6e),o=this.props,v=o.viewBox,b=VO(o,M6e);return!Qy(h,v)||!Qy(f,b)||!Qy(l,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var l=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];l&&this.setState({fontSize:window.getComputedStyle(l).fontSize,letterSpacing:window.getComputedStyle(l).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var l=this.props,h=l.x,f=l.y,o=l.width,v=l.height,b=l.orientation,E=l.tickSize,P=l.mirror,O=l.tickMargin,L,B,z,$,U,G,Z=P?-1:1,ne=n.tickSize||E,Y=pr(n.tickCoord)?n.tickCoord:n.coordinate;switch(b){case"top":L=B=n.coordinate,$=f+ +!P*v,z=$-Z*ne,G=z-Z*O,U=Y;break;case"left":z=$=n.coordinate,B=h+ +!P*o,L=B-Z*ne,U=L-Z*O,G=Y;break;case"right":z=$=n.coordinate,B=h+ +P*o,L=B+Z*ne,U=L+Z*O,G=Y;break;default:L=B=n.coordinate,$=f+ +P*v,z=$+Z*ne,G=z+Z*O,U=Y;break}return{line:{x1:L,y1:z,x2:B,y2:$},tick:{x:U,y:G}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,l=n.orientation,h=n.mirror,f;switch(l){case"left":f=h?"start":"end";break;case"right":f=h?"end":"start";break;default:f="middle";break}return f}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,l=n.orientation,h=n.mirror,f="end";switch(l){case"left":case"right":f="middle";break;case"top":f=h?"start":"end";break;default:f=h?"end":"start";break}return f}},{key:"renderAxisLine",value:function(){var n=this.props,l=n.x,h=n.y,f=n.width,o=n.height,v=n.orientation,b=n.mirror,E=n.axisLine,P=es(es(es({},wn(this.props,!1)),wn(E,!1)),{},{fill:"none"});if(v==="top"||v==="bottom"){var O=+(v==="top"&&!b||v==="bottom"&&b);P=es(es({},P),{},{x1:l,y1:h+O*o,x2:l+f,y2:h+O*o})}else{var L=+(v==="left"&&!b||v==="right"&&b);P=es(es({},P),{},{x1:l+L*f,y1:h,x2:l+L*f,y2:h+o})}return ze.createElement("line",zy({},P,{className:qn("recharts-cartesian-axis-line",dl(E,"className"))}))}},{key:"renderTicks",value:function(n,l,h){var f=this,o=this.props,v=o.tickLine,b=o.stroke,E=o.tick,P=o.tickFormatter,O=o.unit,L=V3(es(es({},this.props),{},{ticks:n}),l,h),B=this.getTickTextAnchor(),z=this.getTickVerticalAnchor(),$=wn(this.props,!1),U=wn(E,!1),G=es(es({},$),{},{fill:"none"},wn(v,!1)),Z=L.map(function(ne,Y){var ee=f.getTickLineCoord(ne),le=ee.line,fe=ee.tick,Ce=es(es(es(es({textAnchor:B,verticalAnchor:z},$),{},{stroke:"none",fill:b},U),fe),{},{index:Y,payload:ne,visibleTicksCount:L.length,tickFormatter:P});return ze.createElement(Li,zy({className:"recharts-cartesian-axis-tick",key:"tick-".concat(ne.value,"-").concat(ne.coordinate,"-").concat(ne.tickCoord)},Sm(f.props,ne,Y)),v&&ze.createElement("line",zy({},G,le,{className:qn("recharts-cartesian-axis-tick-line",dl(v,"className"))})),E&&t.renderTickItem(E,Ce,"".concat(In(P)?P(ne.value,Y):ne.value).concat(O||"")))});return ze.createElement("g",{className:"recharts-cartesian-axis-ticks"},Z)}},{key:"render",value:function(){var n=this,l=this.props,h=l.axisLine,f=l.width,o=l.height,v=l.ticksGenerator,b=l.className,E=l.hide;if(E)return null;var P=this.props,O=P.ticks,L=VO(P,O6e),B=O;return In(v)&&(B=O&&O.length>0?v(this.props):v(L)),f<=0||o<=0||!B||!B.length?null:ze.createElement(Li,{className:qn("recharts-cartesian-axis",b),ref:function($){n.layerReference=$}},h&&this.renderAxisLine(),this.renderTicks(B,this.state.fontSize,this.state.letterSpacing),xs.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,l,h){var f,o=qn(l.className,"recharts-cartesian-axis-tick-value");return ze.isValidElement(n)?f=ze.cloneElement(n,es(es({},l),{},{className:o})):In(n)?f=n(es(es({},l),{},{className:o})):f=ze.createElement(Tm,zy({},l,{className:"recharts-cartesian-axis-tick-value"}),h),f}}])}(K.Component);U3(Sv,"displayName","CartesianAxis");U3(Sv,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var B6e=["x1","y1","x2","y2","key"],$6e=["offset"];function Pm(e){"@babel/helpers - typeof";return Pm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pm(e)}function gH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Xs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gH(Object(r),!0).forEach(function(n){V6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function V6e(e,t,r){return t=U6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function U6e(e){var t=G6e(e,"string");return Pm(t)=="symbol"?t:t+""}function G6e(e,t){if(Pm(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Pm(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jp(){return Jp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Jp.apply(this,arguments)}function yH(e,t){if(e==null)return{};var r=H6e(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function H6e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var W6e=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,l=t.x,h=t.y,f=t.width,o=t.height,v=t.ry;return ze.createElement("rect",{x:l,y:h,ry:v,width:f,height:o,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function Rte(e,t){var r;if(ze.isValidElement(e))r=ze.cloneElement(e,t);else if(In(e))r=e(t);else{var n=t.x1,l=t.y1,h=t.x2,f=t.y2,o=t.key,v=yH(t,B6e),b=wn(v,!1);b.offset;var E=yH(b,$6e);r=ze.createElement("line",Jp({},E,{x1:n,y1:l,x2:h,y2:f,fill:"none",key:o}))}return r}function q6e(e){var t=e.x,r=e.width,n=e.horizontal,l=n===void 0?!0:n,h=e.horizontalPoints;if(!l||!h||!h.length)return null;var f=h.map(function(o,v){var b=Xs(Xs({},e),{},{x1:t,y1:o,x2:t+r,y2:o,key:"line-".concat(v),index:v});return Rte(l,b)});return ze.createElement("g",{className:"recharts-cartesian-grid-horizontal"},f)}function Z6e(e){var t=e.y,r=e.height,n=e.vertical,l=n===void 0?!0:n,h=e.verticalPoints;if(!l||!h||!h.length)return null;var f=h.map(function(o,v){var b=Xs(Xs({},e),{},{x1:o,y1:t,x2:o,y2:t+r,key:"line-".concat(v),index:v});return Rte(l,b)});return ze.createElement("g",{className:"recharts-cartesian-grid-vertical"},f)}function X6e(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,l=e.y,h=e.width,f=e.height,o=e.horizontalPoints,v=e.horizontal,b=v===void 0?!0:v;if(!b||!t||!t.length)return null;var E=o.map(function(O){return Math.round(O+l-l)}).sort(function(O,L){return O-L});l!==E[0]&&E.unshift(0);var P=E.map(function(O,L){var B=!E[L+1],z=B?l+f-O:E[L+1]-O;if(z<=0)return null;var $=L%t.length;return ze.createElement("rect",{key:"react-".concat(L),y:O,x:n,height:z,width:h,stroke:"none",fill:t[$],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return ze.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},P)}function K6e(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,l=e.fillOpacity,h=e.x,f=e.y,o=e.width,v=e.height,b=e.verticalPoints;if(!r||!n||!n.length)return null;var E=b.map(function(O){return Math.round(O+h-h)}).sort(function(O,L){return O-L});h!==E[0]&&E.unshift(0);var P=E.map(function(O,L){var B=!E[L+1],z=B?h+o-O:E[L+1]-O;if(z<=0)return null;var $=L%n.length;return ze.createElement("rect",{key:"react-".concat(L),x:O,y:f,width:z,height:v,stroke:"none",fill:n[$],fillOpacity:l,className:"recharts-cartesian-grid-bg"})});return ze.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},P)}var Y6e=function(t,r){var n=t.xAxis,l=t.width,h=t.height,f=t.offset;return Mee(V3(Xs(Xs(Xs({},Sv.defaultProps),n),{},{ticks:mh(n,!0),viewBox:{x:0,y:0,width:l,height:h}})),f.left,f.left+f.width,r)},J6e=function(t,r){var n=t.yAxis,l=t.width,h=t.height,f=t.offset;return Mee(V3(Xs(Xs(Xs({},Sv.defaultProps),n),{},{ticks:mh(n,!0),viewBox:{x:0,y:0,width:l,height:h}})),f.top,f.top+f.height,r)},my={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function G3(e){var t,r,n,l,h,f,o=z3(),v=F3(),b=FUe(),E=Xs(Xs({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:my.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:my.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:my.horizontal,horizontalFill:(l=e.horizontalFill)!==null&&l!==void 0?l:my.horizontalFill,vertical:(h=e.vertical)!==null&&h!==void 0?h:my.vertical,verticalFill:(f=e.verticalFill)!==null&&f!==void 0?f:my.verticalFill,x:pr(e.x)?e.x:b.left,y:pr(e.y)?e.y:b.top,width:pr(e.width)?e.width:b.width,height:pr(e.height)?e.height:b.height}),P=E.x,O=E.y,L=E.width,B=E.height,z=E.syncWithTicks,$=E.horizontalValues,U=E.verticalValues,G=jUe(),Z=NUe();if(!pr(L)||L<=0||!pr(B)||B<=0||!pr(P)||P!==+P||!pr(O)||O!==+O)return null;var ne=E.verticalCoordinatesGenerator||Y6e,Y=E.horizontalCoordinatesGenerator||J6e,ee=E.horizontalPoints,le=E.verticalPoints;if((!ee||!ee.length)&&In(Y)){var fe=$&&$.length,Ce=Y({yAxis:Z?Xs(Xs({},Z),{},{ticks:fe?$:Z.ticks}):void 0,width:o,height:v,offset:b},fe?!0:z);bc(Array.isArray(Ce),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Pm(Ce),"]")),Array.isArray(Ce)&&(ee=Ce)}if((!le||!le.length)&&In(ne)){var Oe=U&&U.length,Me=ne({xAxis:G?Xs(Xs({},G),{},{ticks:Oe?U:G.ticks}):void 0,width:o,height:v,offset:b},Oe?!0:z);bc(Array.isArray(Me),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Pm(Me),"]")),Array.isArray(Me)&&(le=Me)}return ze.createElement("g",{className:"recharts-cartesian-grid"},ze.createElement(W6e,{fill:E.fill,fillOpacity:E.fillOpacity,x:E.x,y:E.y,width:E.width,height:E.height,ry:E.ry}),ze.createElement(q6e,Jp({},E,{offset:b,horizontalPoints:ee,xAxis:G,yAxis:Z})),ze.createElement(Z6e,Jp({},E,{offset:b,verticalPoints:le,xAxis:G,yAxis:Z})),ze.createElement(X6e,Jp({},E,{horizontalPoints:ee})),ze.createElement(K6e,Jp({},E,{verticalPoints:le})))}G3.displayName="CartesianGrid";function H_(e){"@babel/helpers - typeof";return H_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H_(e)}function Q6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function e8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,jte(n.key),n)}}function t8e(e,t,r){return t&&e8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function r8e(e,t,r){return t=dA(t),n8e(e,Dte()?Reflect.construct(t,r||[],dA(e).constructor):t.apply(e,r))}function n8e(e,t){if(t&&(H_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return i8e(e)}function i8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Dte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Dte=function(){return!!e})()}function dA(e){return dA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},dA(e)}function o8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cL(e,t)}function cL(e,t){return cL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},cL(e,t)}function Lte(e,t,r){return t=jte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jte(e){var t=s8e(e,"string");return H_(t)=="symbol"?t:t+""}function s8e(e,t){if(H_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(H_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function uL(){return uL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uL.apply(this,arguments)}function a8e(e){var t=e.xAxisId,r=z3(),n=F3(),l=wte(t);return l==null?null:K.createElement(Sv,uL({},l,{className:qn("recharts-".concat(l.axisType," ").concat(l.axisType),l.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(f){return mh(f,!0)}}))}var W_=function(e){function t(){return Q6e(this,t),r8e(this,t,arguments)}return o8e(t,e),t8e(t,[{key:"render",value:function(){return K.createElement(a8e,this.props)}}])}(K.Component);Lte(W_,"displayName","XAxis");Lte(W_,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function q_(e){"@babel/helpers - typeof";return q_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q_(e)}function l8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Fte(n.key),n)}}function u8e(e,t,r){return t&&c8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function h8e(e,t,r){return t=fA(t),d8e(e,Nte()?Reflect.construct(t,r||[],fA(e).constructor):t.apply(e,r))}function d8e(e,t){if(t&&(q_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return f8e(e)}function f8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Nte=function(){return!!e})()}function fA(e){return fA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},fA(e)}function p8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hL(e,t)}function hL(e,t){return hL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},hL(e,t)}function zte(e,t,r){return t=Fte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fte(e){var t=m8e(e,"string");return q_(t)=="symbol"?t:t+""}function m8e(e,t){if(q_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(q_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function dL(){return dL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dL.apply(this,arguments)}var g8e=function(t){var r=t.yAxisId,n=z3(),l=F3(),h=Ste(r);return h==null?null:K.createElement(Sv,dL({},h,{className:qn("recharts-".concat(h.axisType," ").concat(h.axisType),h.className),viewBox:{x:0,y:0,width:n,height:l},ticksGenerator:function(o){return mh(o,!0)}}))},Z_=function(e){function t(){return l8e(this,t),h8e(this,t,arguments)}return p8e(t,e),u8e(t,[{key:"render",value:function(){return K.createElement(g8e,this.props)}}])}(K.Component);zte(Z_,"displayName","YAxis");zte(Z_,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function _H(e){return x8e(e)||v8e(e)||_8e(e)||y8e()}function y8e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _8e(e,t){if(e){if(typeof e=="string")return fL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fL(e,t)}}function v8e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function x8e(e){if(Array.isArray(e))return fL(e)}function fL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var pL=function(t,r,n,l,h){var f=zl(t,$3),o=zl(t,lC),v=[].concat(_H(f),_H(o)),b=zl(t,uC),E="".concat(l,"Id"),P=l[0],O=r;if(v.length&&(O=v.reduce(function(z,$){if($.props[E]===n&&Tu($.props,"extendDomain")&&pr($.props[P])){var U=$.props[P];return[Math.min(z[0],U),Math.max(z[1],U)]}return z},O)),b.length){var L="".concat(P,"1"),B="".concat(P,"2");O=b.reduce(function(z,$){if($.props[E]===n&&Tu($.props,"extendDomain")&&pr($.props[L])&&pr($.props[B])){var U=$.props[L],G=$.props[B];return[Math.min(z[0],U,G),Math.max(z[1],U,G)]}return z},O)}return h&&h.length&&(O=h.reduce(function(z,$){return pr($)?[Math.min(z[0],$),Math.max(z[1],$)]:z},O)),O},Bte={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function l(v,b,E){this.fn=v,this.context=b,this.once=E||!1}function h(v,b,E,P,O){if(typeof E!="function")throw new TypeError("The listener must be a function");var L=new l(E,P||v,O),B=r?r+b:b;return v._events[B]?v._events[B].fn?v._events[B]=[v._events[B],L]:v._events[B].push(L):(v._events[B]=L,v._eventsCount++),v}function f(v,b){--v._eventsCount===0?v._events=new n:delete v._events[b]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var b=[],E,P;if(this._eventsCount===0)return b;for(P in E=this._events)t.call(E,P)&&b.push(r?P.slice(1):P);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(E)):b},o.prototype.listeners=function(b){var E=r?r+b:b,P=this._events[E];if(!P)return[];if(P.fn)return[P.fn];for(var O=0,L=P.length,B=new Array(L);O<L;O++)B[O]=P[O].fn;return B},o.prototype.listenerCount=function(b){var E=r?r+b:b,P=this._events[E];return P?P.fn?1:P.length:0},o.prototype.emit=function(b,E,P,O,L,B){var z=r?r+b:b;if(!this._events[z])return!1;var $=this._events[z],U=arguments.length,G,Z;if($.fn){switch($.once&&this.removeListener(b,$.fn,void 0,!0),U){case 1:return $.fn.call($.context),!0;case 2:return $.fn.call($.context,E),!0;case 3:return $.fn.call($.context,E,P),!0;case 4:return $.fn.call($.context,E,P,O),!0;case 5:return $.fn.call($.context,E,P,O,L),!0;case 6:return $.fn.call($.context,E,P,O,L,B),!0}for(Z=1,G=new Array(U-1);Z<U;Z++)G[Z-1]=arguments[Z];$.fn.apply($.context,G)}else{var ne=$.length,Y;for(Z=0;Z<ne;Z++)switch($[Z].once&&this.removeListener(b,$[Z].fn,void 0,!0),U){case 1:$[Z].fn.call($[Z].context);break;case 2:$[Z].fn.call($[Z].context,E);break;case 3:$[Z].fn.call($[Z].context,E,P);break;case 4:$[Z].fn.call($[Z].context,E,P,O);break;default:if(!G)for(Y=1,G=new Array(U-1);Y<U;Y++)G[Y-1]=arguments[Y];$[Z].fn.apply($[Z].context,G)}}return!0},o.prototype.on=function(b,E,P){return h(this,b,E,P,!1)},o.prototype.once=function(b,E,P){return h(this,b,E,P,!0)},o.prototype.removeListener=function(b,E,P,O){var L=r?r+b:b;if(!this._events[L])return this;if(!E)return f(this,L),this;var B=this._events[L];if(B.fn)B.fn===E&&(!O||B.once)&&(!P||B.context===P)&&f(this,L);else{for(var z=0,$=[],U=B.length;z<U;z++)(B[z].fn!==E||O&&!B[z].once||P&&B[z].context!==P)&&$.push(B[z]);$.length?this._events[L]=$.length===1?$[0]:$:f(this,L)}return this},o.prototype.removeAllListeners=function(b){var E;return b?(E=r?r+b:b,this._events[E]&&f(this,E)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o})(Bte);var b8e=Bte.exports;const w8e=Pi(b8e);var UO=new w8e,GO="recharts.syncMouseEvents";function Dw(e){"@babel/helpers - typeof";return Dw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dw(e)}function S8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$te(n.key),n)}}function E8e(e,t,r){return t&&T8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function HO(e,t,r){return t=$te(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $te(e){var t=A8e(e,"string");return Dw(t)=="symbol"?t:t+""}function A8e(e,t){if(Dw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Dw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var P8e=function(){function e(){S8e(this,e),HO(this,"activeIndex",0),HO(this,"coordinateList",[]),HO(this,"layout","horizontal")}return E8e(e,[{key:"setDetails",value:function(r){var n,l=r.coordinateList,h=l===void 0?null:l,f=r.container,o=f===void 0?null:f,v=r.layout,b=v===void 0?null:v,E=r.offset,P=E===void 0?null:E,O=r.mouseHandlerCallback,L=O===void 0?null:O;this.coordinateList=(n=h??this.coordinateList)!==null&&n!==void 0?n:[],this.container=o??this.container,this.layout=b??this.layout,this.offset=P??this.offset,this.mouseHandlerCallback=L??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var l=this.container.getBoundingClientRect(),h=l.x,f=l.y,o=l.height,v=this.coordinateList[this.activeIndex].coordinate,b=((r=window)===null||r===void 0?void 0:r.scrollX)||0,E=((n=window)===null||n===void 0?void 0:n.scrollY)||0,P=h+v+b,O=f+this.offset.top+o/2+E;this.mouseHandlerCallback({pageX:P,pageY:O})}}}])}();function C8e(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e?.[0],l=e?.[1];if(n&&l&&pr(n)&&pr(l))return!0}return!1}function I8e(e,t,r,n){var l=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-l:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-l,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function Vte(e){var t=e.cx,r=e.cy,n=e.radius,l=e.startAngle,h=e.endAngle,f=Qi(t,r,n,l),o=Qi(t,r,n,h);return{points:[f,o],cx:t,cy:r,radius:n,startAngle:l,endAngle:h}}function M8e(e,t,r){var n,l,h,f;if(e==="horizontal")n=t.x,h=n,l=r.top,f=r.top+r.height;else if(e==="vertical")l=t.y,f=l,n=r.left,h=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var o=t.cx,v=t.cy,b=t.innerRadius,E=t.outerRadius,P=t.angle,O=Qi(o,v,b,P),L=Qi(o,v,E,P);n=O.x,l=O.y,h=L.x,f=L.y}else return Vte(t);return[{x:n,y:l},{x:h,y:f}]}function Lw(e){"@babel/helpers - typeof";return Lw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lw(e)}function vH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function rE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vH(Object(r),!0).forEach(function(n){O8e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function O8e(e,t,r){return t=k8e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k8e(e){var t=R8e(e,"string");return Lw(t)=="symbol"?t:t+""}function R8e(e,t){if(Lw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Lw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function D8e(e){var t,r,n=e.element,l=e.tooltipEventType,h=e.isActive,f=e.activeCoordinate,o=e.activePayload,v=e.offset,b=e.activeTooltipIndex,E=e.tooltipAxisBandSize,P=e.layout,O=e.chartName,L=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!L||!h||!f||O!=="ScatterChart"&&l!=="axis")return null;var B,z=ND;if(O==="ScatterChart")B=f,z=h4e;else if(O==="BarChart")B=I8e(P,f,v,E),z=R3;else if(P==="radial"){var $=Vte(f),U=$.cx,G=$.cy,Z=$.radius,ne=$.startAngle,Y=$.endAngle;B={cx:U,cy:G,startAngle:ne,endAngle:Y,innerRadius:Z,outerRadius:Z},z=$ee}else B={points:M8e(P,f,v)},z=ND;var ee=rE(rE(rE(rE({stroke:"#ccc",pointerEvents:"none"},v),B),wn(L,!1)),{},{payload:o,payloadIndex:b,className:qn("recharts-tooltip-cursor",L.className)});return K.isValidElement(L)?K.cloneElement(L,ee):K.createElement(z,ee)}var L8e=["item"],j8e=["children","className","width","height","style","compact","title","desc"];function X_(e){"@babel/helpers - typeof";return X_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X_(e)}function Fy(){return Fy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fy.apply(this,arguments)}function xH(e,t){return F8e(e)||z8e(e,t)||Gte(e,t)||N8e()}function N8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function z8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,h,f,o=[],v=!0,b=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(E){b=!0,l=E}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw l}}return o}}function F8e(e){if(Array.isArray(e))return e}function bH(e,t){if(e==null)return{};var r=B8e(e,t),n,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(l=0;l<h.length;l++)n=h[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function B8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function $8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Hte(n.key),n)}}function U8e(e,t,r){return t&&V8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function G8e(e,t,r){return t=pA(t),H8e(e,Ute()?Reflect.construct(t,r||[],pA(e).constructor):t.apply(e,r))}function H8e(e,t){if(t&&(X_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return W8e(e)}function W8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ute(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ute=function(){return!!e})()}function pA(e){return pA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},pA(e)}function q8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mL(e,t)}function mL(e,t){return mL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},mL(e,t)}function K_(e){return K8e(e)||X8e(e)||Gte(e)||Z8e()}function Z8e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gte(e,t){if(e){if(typeof e=="string")return gL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gL(e,t)}}function X8e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function K8e(e){if(Array.isArray(e))return gL(e)}function gL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function wH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Ut(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wH(Object(r),!0).forEach(function(n){dn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dn(e,t,r){return t=Hte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Hte(e){var t=Y8e(e,"string");return X_(t)=="symbol"?t:t+""}function Y8e(e,t){if(X_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(X_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var J8e={xAxis:["bottom","top"],yAxis:["left","right"]},Q8e={width:"100%",height:"100%"},Wte={x:0,y:0};function nE(e){return e}var eGe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},tGe=function(t,r,n,l){var h=r.find(function(E){return E&&E.index===n});if(h){if(t==="horizontal")return{x:h.coordinate,y:l.y};if(t==="vertical")return{x:l.x,y:h.coordinate};if(t==="centric"){var f=h.coordinate,o=l.radius;return Ut(Ut(Ut({},l),Qi(l.cx,l.cy,o,f)),{},{angle:f,radius:o})}var v=h.coordinate,b=l.angle;return Ut(Ut(Ut({},l),Qi(l.cx,l.cy,v,b)),{},{angle:b,radius:v})}return Wte},hC=function(t,r){var n=r.graphicalItems,l=r.dataStartIndex,h=r.dataEndIndex,f=(n??[]).reduce(function(o,v){var b=v.props.data;return b&&b.length?[].concat(K_(o),K_(b)):o},[]);return f.length>0?f:t&&t.length&&pr(l)&&pr(h)?t.slice(l,h+1):[]};function qte(e){return e==="number"?[0,"auto"]:void 0}var yL=function(t,r,n,l){var h=t.graphicalItems,f=t.tooltipAxis,o=hC(r,t);return n<0||!h||!h.length||n>=o.length?null:h.reduce(function(v,b){var E,P=(E=b.props.data)!==null&&E!==void 0?E:r;P&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(P=P.slice(t.dataStartIndex,t.dataEndIndex+1));var O;if(f.dataKey&&!f.allowDuplicatedCategory){var L=P===void 0?o:P;O=WR(L,f.dataKey,l)}else O=P&&P[n]||o[n];return O?[].concat(K_(v),[Lee(b,O)]):v},[])},SH=function(t,r,n,l){var h=l||{x:t.chartX,y:t.chartY},f=eGe(h,n),o=t.orderedTooltipTicks,v=t.tooltipAxis,b=t.tooltipTicks,E=Lze(f,o,b,v);if(E>=0&&b){var P=b[E]&&b[E].value,O=yL(t,r,E,P),L=tGe(n,o,E,h);return{activeTooltipIndex:E,activeLabel:P,activePayload:O,activeCoordinate:L}}return null},rGe=function(t,r){var n=r.axes,l=r.graphicalItems,h=r.axisType,f=r.axisIdKey,o=r.stackGroups,v=r.dataStartIndex,b=r.dataEndIndex,E=t.layout,P=t.children,O=t.stackOffset,L=Iee(E,h);return n.reduce(function(B,z){var $,U=z.type.defaultProps!==void 0?Ut(Ut({},z.type.defaultProps),z.props):z.props,G=U.type,Z=U.dataKey,ne=U.allowDataOverflow,Y=U.allowDuplicatedCategory,ee=U.scale,le=U.ticks,fe=U.includeHidden,Ce=U[f];if(B[Ce])return B;var Oe=hC(t.data,{graphicalItems:l.filter(function(It){var sr,Sr=f in It.props?It.props[f]:(sr=It.type.defaultProps)===null||sr===void 0?void 0:sr[f];return Sr===Ce}),dataStartIndex:v,dataEndIndex:b}),Me=Oe.length,Ke,Ye,Le;C8e(U.domain,ne,G)&&(Ke=kD(U.domain,null,ne),L&&(G==="number"||ee!=="auto")&&(Le=Sb(Oe,Z,"category")));var Qe=qte(G);if(!Ke||Ke.length===0){var Je,it=(Je=U.domain)!==null&&Je!==void 0?Je:Qe;if(Z){if(Ke=Sb(Oe,Z,G),G==="category"&&L){var Ze=_Ee(Ke);Y&&Ze?(Ye=Ke,Ke=rA(0,Me)):Y||(Ke=Z8(it,Ke,z).reduce(function(It,sr){return It.indexOf(sr)>=0?It:[].concat(K_(It),[sr])},[]))}else if(G==="category")Y?Ke=Ke.filter(function(It){return It!==""&&!ni(It)}):Ke=Z8(it,Ke,z).reduce(function(It,sr){return It.indexOf(sr)>=0||sr===""||ni(sr)?It:[].concat(K_(It),[sr])},[]);else if(G==="number"){var nt=Bze(Oe,l.filter(function(It){var sr,Sr,Kr=f in It.props?It.props[f]:(sr=It.type.defaultProps)===null||sr===void 0?void 0:sr[f],Er="hide"in It.props?It.props.hide:(Sr=It.type.defaultProps)===null||Sr===void 0?void 0:Sr.hide;return Kr===Ce&&(fe||!Er)}),Z,h,E);nt&&(Ke=nt)}L&&(G==="number"||ee!=="auto")&&(Le=Sb(Oe,Z,"category"))}else L?Ke=rA(0,Me):o&&o[Ce]&&o[Ce].hasStack&&G==="number"?Ke=O==="expand"?[0,1]:Dee(o[Ce].stackGroups,v,b):Ke=Cee(Oe,l.filter(function(It){var sr=f in It.props?It.props[f]:It.type.defaultProps[f],Sr="hide"in It.props?It.props.hide:It.type.defaultProps.hide;return sr===Ce&&(fe||!Sr)}),G,E,!0);if(G==="number")Ke=pL(P,Ke,Ce,h,le),it&&(Ke=kD(it,Ke,ne));else if(G==="category"&&it){var pt=it,_t=Ke.every(function(It){return pt.indexOf(It)>=0});_t&&(Ke=pt)}}return Ut(Ut({},B),{},dn({},Ce,Ut(Ut({},U),{},{axisType:h,domain:Ke,categoricalDomain:Le,duplicateDomain:Ye,originalDomain:($=U.domain)!==null&&$!==void 0?$:Qe,isCategorical:L,layout:E})))},{})},nGe=function(t,r){var n=r.graphicalItems,l=r.Axis,h=r.axisType,f=r.axisIdKey,o=r.stackGroups,v=r.dataStartIndex,b=r.dataEndIndex,E=t.layout,P=t.children,O=hC(t.data,{graphicalItems:n,dataStartIndex:v,dataEndIndex:b}),L=O.length,B=Iee(E,h),z=-1;return n.reduce(function($,U){var G=U.type.defaultProps!==void 0?Ut(Ut({},U.type.defaultProps),U.props):U.props,Z=G[f],ne=qte("number");if(!$[Z]){z++;var Y;return B?Y=rA(0,L):o&&o[Z]&&o[Z].hasStack?(Y=Dee(o[Z].stackGroups,v,b),Y=pL(P,Y,Z,h)):(Y=kD(ne,Cee(O,n.filter(function(ee){var le,fe,Ce=f in ee.props?ee.props[f]:(le=ee.type.defaultProps)===null||le===void 0?void 0:le[f],Oe="hide"in ee.props?ee.props.hide:(fe=ee.type.defaultProps)===null||fe===void 0?void 0:fe.hide;return Ce===Z&&!Oe}),"number",E),l.defaultProps.allowDataOverflow),Y=pL(P,Y,Z,h)),Ut(Ut({},$),{},dn({},Z,Ut(Ut({axisType:h},l.defaultProps),{},{hide:!0,orientation:dl(J8e,"".concat(h,".").concat(z%2),null),domain:Y,originalDomain:ne,isCategorical:B,layout:E})))}return $},{})},iGe=function(t,r){var n=r.axisType,l=n===void 0?"xAxis":n,h=r.AxisComp,f=r.graphicalItems,o=r.stackGroups,v=r.dataStartIndex,b=r.dataEndIndex,E=t.children,P="".concat(l,"Id"),O=zl(E,h),L={};return O&&O.length?L=rGe(t,{axes:O,graphicalItems:f,axisType:l,axisIdKey:P,stackGroups:o,dataStartIndex:v,dataEndIndex:b}):f&&f.length&&(L=nGe(t,{Axis:h,graphicalItems:f,axisType:l,axisIdKey:P,stackGroups:o,dataStartIndex:v,dataEndIndex:b})),L},oGe=function(t){var r=qd(t),n=mh(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:a3(n,function(l){return l.coordinate}),tooltipAxis:r,tooltipAxisBandSize:G2(r,n)}},TH=function(t){var r=t.children,n=t.defaultShowTooltip,l=sl(r,F_),h=0,f=0;return t.data&&t.data.length!==0&&(f=t.data.length-1),l&&l.props&&(l.props.startIndex>=0&&(h=l.props.startIndex),l.props.endIndex>=0&&(f=l.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:h,dataEndIndex:f,activeTooltipIndex:-1,isTooltipActive:!!n}},sGe=function(t){return!t||!t.length?!1:t.some(function(r){var n=yh(r&&r.type);return n&&n.indexOf("Bar")>=0})},EH=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},aGe=function(t,r){var n=t.props,l=t.graphicalItems,h=t.xAxisMap,f=h===void 0?{}:h,o=t.yAxisMap,v=o===void 0?{}:o,b=n.width,E=n.height,P=n.children,O=n.margin||{},L=sl(P,F_),B=sl(P,e_),z=Object.keys(v).reduce(function(Y,ee){var le=v[ee],fe=le.orientation;return!le.mirror&&!le.hide?Ut(Ut({},Y),{},dn({},fe,Y[fe]+le.width)):Y},{left:O.left||0,right:O.right||0}),$=Object.keys(f).reduce(function(Y,ee){var le=f[ee],fe=le.orientation;return!le.mirror&&!le.hide?Ut(Ut({},Y),{},dn({},fe,dl(Y,"".concat(fe))+le.height)):Y},{top:O.top||0,bottom:O.bottom||0}),U=Ut(Ut({},$),z),G=U.bottom;L&&(U.bottom+=L.props.height||F_.defaultProps.height),B&&r&&(U=zze(U,l,n,r));var Z=b-U.left-U.right,ne=E-U.top-U.bottom;return Ut(Ut({brushBottom:G},U),{},{width:Math.max(Z,0),height:Math.max(ne,0)})},lGe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},Zte=function(t){var r=t.chartName,n=t.GraphicalChild,l=t.defaultTooltipEventType,h=l===void 0?"axis":l,f=t.validateTooltipEventTypes,o=f===void 0?["axis"]:f,v=t.axisComponents,b=t.legendContent,E=t.formatAxisMap,P=t.defaultProps,O=function(U,G){var Z=G.graphicalItems,ne=G.stackGroups,Y=G.offset,ee=G.updateId,le=G.dataStartIndex,fe=G.dataEndIndex,Ce=U.barSize,Oe=U.layout,Me=U.barGap,Ke=U.barCategoryGap,Ye=U.maxBarSize,Le=EH(Oe),Qe=Le.numericAxisName,Je=Le.cateAxisName,it=sGe(Z),Ze=[];return Z.forEach(function(nt,pt){var _t=hC(U.data,{graphicalItems:[nt],dataStartIndex:le,dataEndIndex:fe}),It=nt.type.defaultProps!==void 0?Ut(Ut({},nt.type.defaultProps),nt.props):nt.props,sr=It.dataKey,Sr=It.maxBarSize,Kr=It["".concat(Qe,"Id")],Er=It["".concat(Je,"Id")],Kt={},Pr=v.reduce(function(Ci,vo){var fo=G["".concat(vo.axisType,"Map")],Ta=It["".concat(vo.axisType,"Id")];fo&&fo[Ta]||vo.axisType==="zAxis"||Am();var Za=fo[Ta];return Ut(Ut({},Ci),{},dn(dn({},vo.axisType,Za),"".concat(vo.axisType,"Ticks"),mh(Za)))},Kt),Qt=Pr[Je],nr=Pr["".concat(Je,"Ticks")],xr=ne&&ne[Kr]&&ne[Kr].hasStack&&Xze(nt,ne[Kr].stackGroups),Ft=yh(nt.type).indexOf("Bar")>=0,Pn=G2(Qt,nr),Hr=[],Yr=it&&jze({barSize:Ce,stackGroups:ne,totalSize:lGe(Pr,Je)});if(Ft){var kn,Si,jo=ni(Sr)?Ye:Sr,No=(kn=(Si=G2(Qt,nr,!0))!==null&&Si!==void 0?Si:jo)!==null&&kn!==void 0?kn:0;Hr=Nze({barGap:Me,barCategoryGap:Ke,bandSize:No!==Pn?No:Pn,sizeList:Yr[Er],maxBarSize:jo}),No!==Pn&&(Hr=Hr.map(function(Ci){return Ut(Ut({},Ci),{},{position:Ut(Ut({},Ci.position),{},{offset:Ci.position.offset-No/2})})}))}var ho=nt&&nt.type&&nt.type.getComposedData;ho&&Ze.push({props:Ut(Ut({},ho(Ut(Ut({},Pr),{},{displayedData:_t,props:U,dataKey:sr,item:nt,bandSize:Pn,barPosition:Hr,offset:Y,stackedData:xr,layout:Oe,dataStartIndex:le,dataEndIndex:fe}))),{},dn(dn(dn({key:nt.key||"item-".concat(pt)},Qe,Pr[Qe]),Je,Pr[Je]),"animationId",ee)),childIndex:MEe(nt,U.children),item:nt})}),Ze},L=function(U,G){var Z=U.props,ne=U.dataStartIndex,Y=U.dataEndIndex,ee=U.updateId;if(!BU({props:Z}))return null;var le=Z.children,fe=Z.layout,Ce=Z.stackOffset,Oe=Z.data,Me=Z.reverseStackOrder,Ke=EH(fe),Ye=Ke.numericAxisName,Le=Ke.cateAxisName,Qe=zl(le,n),Je=qze(Oe,Qe,"".concat(Ye,"Id"),"".concat(Le,"Id"),Ce,Me),it=v.reduce(function(It,sr){var Sr="".concat(sr.axisType,"Map");return Ut(Ut({},It),{},dn({},Sr,iGe(Z,Ut(Ut({},sr),{},{graphicalItems:Qe,stackGroups:sr.axisType===Ye&&Je,dataStartIndex:ne,dataEndIndex:Y}))))},{}),Ze=aGe(Ut(Ut({},it),{},{props:Z,graphicalItems:Qe}),G?.legendBBox);Object.keys(it).forEach(function(It){it[It]=E(Z,it[It],Ze,It.replace("Map",""),r)});var nt=it["".concat(Le,"Map")],pt=oGe(nt),_t=O(Z,Ut(Ut({},it),{},{dataStartIndex:ne,dataEndIndex:Y,updateId:ee,graphicalItems:Qe,stackGroups:Je,offset:Ze}));return Ut(Ut({formattedGraphicalItems:_t,graphicalItems:Qe,offset:Ze,stackGroups:Je},pt),it)},B=function($){function U(G){var Z,ne,Y;return $8e(this,U),Y=G8e(this,U,[G]),dn(Y,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),dn(Y,"accessibilityManager",new P8e),dn(Y,"handleLegendBBoxUpdate",function(ee){if(ee){var le=Y.state,fe=le.dataStartIndex,Ce=le.dataEndIndex,Oe=le.updateId;Y.setState(Ut({legendBBox:ee},L({props:Y.props,dataStartIndex:fe,dataEndIndex:Ce,updateId:Oe},Ut(Ut({},Y.state),{},{legendBBox:ee}))))}}),dn(Y,"handleReceiveSyncEvent",function(ee,le,fe){if(Y.props.syncId===ee){if(fe===Y.eventEmitterSymbol&&typeof Y.props.syncMethod!="function")return;Y.applySyncEvent(le)}}),dn(Y,"handleBrushChange",function(ee){var le=ee.startIndex,fe=ee.endIndex;if(le!==Y.state.dataStartIndex||fe!==Y.state.dataEndIndex){var Ce=Y.state.updateId;Y.setState(function(){return Ut({dataStartIndex:le,dataEndIndex:fe},L({props:Y.props,dataStartIndex:le,dataEndIndex:fe,updateId:Ce},Y.state))}),Y.triggerSyncEvent({dataStartIndex:le,dataEndIndex:fe})}}),dn(Y,"handleMouseEnter",function(ee){var le=Y.getMouseInfo(ee);if(le){var fe=Ut(Ut({},le),{},{isTooltipActive:!0});Y.setState(fe),Y.triggerSyncEvent(fe);var Ce=Y.props.onMouseEnter;In(Ce)&&Ce(fe,ee)}}),dn(Y,"triggeredAfterMouseMove",function(ee){var le=Y.getMouseInfo(ee),fe=le?Ut(Ut({},le),{},{isTooltipActive:!0}):{isTooltipActive:!1};Y.setState(fe),Y.triggerSyncEvent(fe);var Ce=Y.props.onMouseMove;In(Ce)&&Ce(fe,ee)}),dn(Y,"handleItemMouseEnter",function(ee){Y.setState(function(){return{isTooltipActive:!0,activeItem:ee,activePayload:ee.tooltipPayload,activeCoordinate:ee.tooltipPosition||{x:ee.cx,y:ee.cy}}})}),dn(Y,"handleItemMouseLeave",function(){Y.setState(function(){return{isTooltipActive:!1}})}),dn(Y,"handleMouseMove",function(ee){ee.persist(),Y.throttleTriggeredAfterMouseMove(ee)}),dn(Y,"handleMouseLeave",function(ee){Y.throttleTriggeredAfterMouseMove.cancel();var le={isTooltipActive:!1};Y.setState(le),Y.triggerSyncEvent(le);var fe=Y.props.onMouseLeave;In(fe)&&fe(le,ee)}),dn(Y,"handleOuterEvent",function(ee){var le=IEe(ee),fe=dl(Y.props,"".concat(le));if(le&&In(fe)){var Ce,Oe;/.*touch.*/i.test(le)?Oe=Y.getMouseInfo(ee.changedTouches[0]):Oe=Y.getMouseInfo(ee),fe((Ce=Oe)!==null&&Ce!==void 0?Ce:{},ee)}}),dn(Y,"handleClick",function(ee){var le=Y.getMouseInfo(ee);if(le){var fe=Ut(Ut({},le),{},{isTooltipActive:!0});Y.setState(fe),Y.triggerSyncEvent(fe);var Ce=Y.props.onClick;In(Ce)&&Ce(fe,ee)}}),dn(Y,"handleMouseDown",function(ee){var le=Y.props.onMouseDown;if(In(le)){var fe=Y.getMouseInfo(ee);le(fe,ee)}}),dn(Y,"handleMouseUp",function(ee){var le=Y.props.onMouseUp;if(In(le)){var fe=Y.getMouseInfo(ee);le(fe,ee)}}),dn(Y,"handleTouchMove",function(ee){ee.changedTouches!=null&&ee.changedTouches.length>0&&Y.throttleTriggeredAfterMouseMove(ee.changedTouches[0])}),dn(Y,"handleTouchStart",function(ee){ee.changedTouches!=null&&ee.changedTouches.length>0&&Y.handleMouseDown(ee.changedTouches[0])}),dn(Y,"handleTouchEnd",function(ee){ee.changedTouches!=null&&ee.changedTouches.length>0&&Y.handleMouseUp(ee.changedTouches[0])}),dn(Y,"handleDoubleClick",function(ee){var le=Y.props.onDoubleClick;if(In(le)){var fe=Y.getMouseInfo(ee);le(fe,ee)}}),dn(Y,"handleContextMenu",function(ee){var le=Y.props.onContextMenu;if(In(le)){var fe=Y.getMouseInfo(ee);le(fe,ee)}}),dn(Y,"triggerSyncEvent",function(ee){Y.props.syncId!==void 0&&UO.emit(GO,Y.props.syncId,ee,Y.eventEmitterSymbol)}),dn(Y,"applySyncEvent",function(ee){var le=Y.props,fe=le.layout,Ce=le.syncMethod,Oe=Y.state.updateId,Me=ee.dataStartIndex,Ke=ee.dataEndIndex;if(ee.dataStartIndex!==void 0||ee.dataEndIndex!==void 0)Y.setState(Ut({dataStartIndex:Me,dataEndIndex:Ke},L({props:Y.props,dataStartIndex:Me,dataEndIndex:Ke,updateId:Oe},Y.state)));else if(ee.activeTooltipIndex!==void 0){var Ye=ee.chartX,Le=ee.chartY,Qe=ee.activeTooltipIndex,Je=Y.state,it=Je.offset,Ze=Je.tooltipTicks;if(!it)return;if(typeof Ce=="function")Qe=Ce(Ze,ee);else if(Ce==="value"){Qe=-1;for(var nt=0;nt<Ze.length;nt++)if(Ze[nt].value===ee.activeLabel){Qe=nt;break}}var pt=Ut(Ut({},it),{},{x:it.left,y:it.top}),_t=Math.min(Ye,pt.x+pt.width),It=Math.min(Le,pt.y+pt.height),sr=Ze[Qe]&&Ze[Qe].value,Sr=yL(Y.state,Y.props.data,Qe),Kr=Ze[Qe]?{x:fe==="horizontal"?Ze[Qe].coordinate:_t,y:fe==="horizontal"?It:Ze[Qe].coordinate}:Wte;Y.setState(Ut(Ut({},ee),{},{activeLabel:sr,activeCoordinate:Kr,activePayload:Sr,activeTooltipIndex:Qe}))}else Y.setState(ee)}),dn(Y,"renderCursor",function(ee){var le,fe=Y.state,Ce=fe.isTooltipActive,Oe=fe.activeCoordinate,Me=fe.activePayload,Ke=fe.offset,Ye=fe.activeTooltipIndex,Le=fe.tooltipAxisBandSize,Qe=Y.getTooltipEventType(),Je=(le=ee.props.active)!==null&&le!==void 0?le:Ce,it=Y.props.layout,Ze=ee.key||"_recharts-cursor";return ze.createElement(D8e,{key:Ze,activeCoordinate:Oe,activePayload:Me,activeTooltipIndex:Ye,chartName:r,element:ee,isActive:Je,layout:it,offset:Ke,tooltipAxisBandSize:Le,tooltipEventType:Qe})}),dn(Y,"renderPolarAxis",function(ee,le,fe){var Ce=dl(ee,"type.axisType"),Oe=dl(Y.state,"".concat(Ce,"Map")),Me=ee.type.defaultProps,Ke=Me!==void 0?Ut(Ut({},Me),ee.props):ee.props,Ye=Oe&&Oe[Ke["".concat(Ce,"Id")]];return K.cloneElement(ee,Ut(Ut({},Ye),{},{className:qn(Ce,Ye.className),key:ee.key||"".concat(le,"-").concat(fe),ticks:mh(Ye,!0)}))}),dn(Y,"renderPolarGrid",function(ee){var le=ee.props,fe=le.radialLines,Ce=le.polarAngles,Oe=le.polarRadius,Me=Y.state,Ke=Me.radiusAxisMap,Ye=Me.angleAxisMap,Le=qd(Ke),Qe=qd(Ye),Je=Qe.cx,it=Qe.cy,Ze=Qe.innerRadius,nt=Qe.outerRadius;return K.cloneElement(ee,{polarAngles:Array.isArray(Ce)?Ce:mh(Qe,!0).map(function(pt){return pt.coordinate}),polarRadius:Array.isArray(Oe)?Oe:mh(Le,!0).map(function(pt){return pt.coordinate}),cx:Je,cy:it,innerRadius:Ze,outerRadius:nt,key:ee.key||"polar-grid",radialLines:fe})}),dn(Y,"renderLegend",function(){var ee=Y.state.formattedGraphicalItems,le=Y.props,fe=le.children,Ce=le.width,Oe=le.height,Me=Y.props.margin||{},Ke=Ce-(Me.left||0)-(Me.right||0),Ye=Aee({children:fe,formattedGraphicalItems:ee,legendWidth:Ke,legendContent:b});if(!Ye)return null;var Le=Ye.item,Qe=bH(Ye,L8e);return K.cloneElement(Le,Ut(Ut({},Qe),{},{chartWidth:Ce,chartHeight:Oe,margin:Me,onBBoxUpdate:Y.handleLegendBBoxUpdate}))}),dn(Y,"renderTooltip",function(){var ee,le=Y.props,fe=le.children,Ce=le.accessibilityLayer,Oe=sl(fe,ja);if(!Oe)return null;var Me=Y.state,Ke=Me.isTooltipActive,Ye=Me.activeCoordinate,Le=Me.activePayload,Qe=Me.activeLabel,Je=Me.offset,it=(ee=Oe.props.active)!==null&&ee!==void 0?ee:Ke;return K.cloneElement(Oe,{viewBox:Ut(Ut({},Je),{},{x:Je.left,y:Je.top}),active:it,label:Qe,payload:it?Le:[],coordinate:Ye,accessibilityLayer:Ce})}),dn(Y,"renderBrush",function(ee){var le=Y.props,fe=le.margin,Ce=le.data,Oe=Y.state,Me=Oe.offset,Ke=Oe.dataStartIndex,Ye=Oe.dataEndIndex,Le=Oe.updateId;return K.cloneElement(ee,{key:ee.key||"_recharts-brush",onChange:JT(Y.handleBrushChange,ee.props.onChange),data:Ce,x:pr(ee.props.x)?ee.props.x:Me.left,y:pr(ee.props.y)?ee.props.y:Me.top+Me.height+Me.brushBottom-(fe.bottom||0),width:pr(ee.props.width)?ee.props.width:Me.width,startIndex:Ke,endIndex:Ye,updateId:"brush-".concat(Le)})}),dn(Y,"renderReferenceElement",function(ee,le,fe){if(!ee)return null;var Ce=Y,Oe=Ce.clipPathId,Me=Y.state,Ke=Me.xAxisMap,Ye=Me.yAxisMap,Le=Me.offset,Qe=ee.type.defaultProps||{},Je=ee.props,it=Je.xAxisId,Ze=it===void 0?Qe.xAxisId:it,nt=Je.yAxisId,pt=nt===void 0?Qe.yAxisId:nt;return K.cloneElement(ee,{key:ee.key||"".concat(le,"-").concat(fe),xAxis:Ke[Ze],yAxis:Ye[pt],viewBox:{x:Le.left,y:Le.top,width:Le.width,height:Le.height},clipPathId:Oe})}),dn(Y,"renderActivePoints",function(ee){var le=ee.item,fe=ee.activePoint,Ce=ee.basePoint,Oe=ee.childIndex,Me=ee.isRange,Ke=[],Ye=le.props.key,Le=le.item.type.defaultProps!==void 0?Ut(Ut({},le.item.type.defaultProps),le.item.props):le.item.props,Qe=Le.activeDot,Je=Le.dataKey,it=Ut(Ut({index:Oe,dataKey:Je,cx:fe.x,cy:fe.y,r:4,fill:k3(le.item),strokeWidth:2,stroke:"#fff",payload:fe.payload,value:fe.value},wn(Qe,!1)),y2(Qe));return Ke.push(U.renderActiveDot(Qe,it,"".concat(Ye,"-activePoint-").concat(Oe))),Ce?Ke.push(U.renderActiveDot(Qe,Ut(Ut({},it),{},{cx:Ce.x,cy:Ce.y}),"".concat(Ye,"-basePoint-").concat(Oe))):Me&&Ke.push(null),Ke}),dn(Y,"renderGraphicChild",function(ee,le,fe){var Ce=Y.filterFormatItem(ee,le,fe);if(!Ce)return null;var Oe=Y.getTooltipEventType(),Me=Y.state,Ke=Me.isTooltipActive,Ye=Me.tooltipAxis,Le=Me.activeTooltipIndex,Qe=Me.activeLabel,Je=Y.props.children,it=sl(Je,ja),Ze=Ce.props,nt=Ze.points,pt=Ze.isRange,_t=Ze.baseLine,It=Ce.item.type.defaultProps!==void 0?Ut(Ut({},Ce.item.type.defaultProps),Ce.item.props):Ce.item.props,sr=It.activeDot,Sr=It.hide,Kr=It.activeBar,Er=It.activeShape,Kt=!!(!Sr&&Ke&&it&&(sr||Kr||Er)),Pr={};Oe!=="axis"&&it&&it.props.trigger==="click"?Pr={onClick:JT(Y.handleItemMouseEnter,ee.props.onClick)}:Oe!=="axis"&&(Pr={onMouseLeave:JT(Y.handleItemMouseLeave,ee.props.onMouseLeave),onMouseEnter:JT(Y.handleItemMouseEnter,ee.props.onMouseEnter)});var Qt=K.cloneElement(ee,Ut(Ut({},Ce.props),Pr));function nr(vo){return typeof Ye.dataKey=="function"?Ye.dataKey(vo.payload):null}if(Kt)if(Le>=0){var xr,Ft;if(Ye.dataKey&&!Ye.allowDuplicatedCategory){var Pn=typeof Ye.dataKey=="function"?nr:"payload.".concat(Ye.dataKey.toString());xr=WR(nt,Pn,Qe),Ft=pt&&_t&&WR(_t,Pn,Qe)}else xr=nt?.[Le],Ft=pt&&_t&&_t[Le];if(Er||Kr){var Hr=ee.props.activeIndex!==void 0?ee.props.activeIndex:Le;return[K.cloneElement(ee,Ut(Ut(Ut({},Ce.props),Pr),{},{activeIndex:Hr})),null,null]}if(!ni(xr))return[Qt].concat(K_(Y.renderActivePoints({item:Ce,activePoint:xr,basePoint:Ft,childIndex:Le,isRange:pt})))}else{var Yr,kn=(Yr=Y.getItemByXY(Y.state.activeCoordinate))!==null&&Yr!==void 0?Yr:{graphicalItem:Qt},Si=kn.graphicalItem,jo=Si.item,No=jo===void 0?ee:jo,ho=Si.childIndex,Ci=Ut(Ut(Ut({},Ce.props),Pr),{},{activeIndex:ho});return[K.cloneElement(No,Ci),null,null]}return pt?[Qt,null,null]:[Qt,null]}),dn(Y,"renderCustomized",function(ee,le,fe){return K.cloneElement(ee,Ut(Ut({key:"recharts-customized-".concat(fe)},Y.props),Y.state))}),dn(Y,"renderMap",{CartesianGrid:{handler:nE,once:!0},ReferenceArea:{handler:Y.renderReferenceElement},ReferenceLine:{handler:nE},ReferenceDot:{handler:Y.renderReferenceElement},XAxis:{handler:nE},YAxis:{handler:nE},Brush:{handler:Y.renderBrush,once:!0},Bar:{handler:Y.renderGraphicChild},Line:{handler:Y.renderGraphicChild},Area:{handler:Y.renderGraphicChild},Radar:{handler:Y.renderGraphicChild},RadialBar:{handler:Y.renderGraphicChild},Scatter:{handler:Y.renderGraphicChild},Pie:{handler:Y.renderGraphicChild},Funnel:{handler:Y.renderGraphicChild},Tooltip:{handler:Y.renderCursor,once:!0},PolarGrid:{handler:Y.renderPolarGrid,once:!0},PolarAngleAxis:{handler:Y.renderPolarAxis},PolarRadiusAxis:{handler:Y.renderPolarAxis},Customized:{handler:Y.renderCustomized}}),Y.clipPathId="".concat((Z=G.id)!==null&&Z!==void 0?Z:r1("recharts"),"-clip"),Y.throttleTriggeredAfterMouseMove=SQ(Y.triggeredAfterMouseMove,(ne=G.throttleDelay)!==null&&ne!==void 0?ne:1e3/60),Y.state={},Y}return q8e(U,$),U8e(U,[{key:"componentDidMount",value:function(){var Z,ne;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(Z=this.props.margin.left)!==null&&Z!==void 0?Z:0,top:(ne=this.props.margin.top)!==null&&ne!==void 0?ne:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var Z=this.props,ne=Z.children,Y=Z.data,ee=Z.height,le=Z.layout,fe=sl(ne,ja);if(fe){var Ce=fe.props.defaultIndex;if(!(typeof Ce!="number"||Ce<0||Ce>this.state.tooltipTicks.length-1)){var Oe=this.state.tooltipTicks[Ce]&&this.state.tooltipTicks[Ce].value,Me=yL(this.state,Y,Ce,Oe),Ke=this.state.tooltipTicks[Ce].coordinate,Ye=(this.state.offset.top+ee)/2,Le=le==="horizontal",Qe=Le?{x:Ke,y:Ye}:{y:Ke,x:Ye},Je=this.state.formattedGraphicalItems.find(function(Ze){var nt=Ze.item;return nt.type.name==="Scatter"});Je&&(Qe=Ut(Ut({},Qe),Je.props.points[Ce].tooltipPosition),Me=Je.props.points[Ce].tooltipPayload);var it={activeTooltipIndex:Ce,isTooltipActive:!0,activeLabel:Oe,activePayload:Me,activeCoordinate:Qe};this.setState(it),this.renderCursor(fe),this.accessibilityManager.setIndex(Ce)}}}},{key:"getSnapshotBeforeUpdate",value:function(Z,ne){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==ne.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==Z.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==Z.margin){var Y,ee;this.accessibilityManager.setDetails({offset:{left:(Y=this.props.margin.left)!==null&&Y!==void 0?Y:0,top:(ee=this.props.margin.top)!==null&&ee!==void 0?ee:0}})}return null}},{key:"componentDidUpdate",value:function(Z){ZR([sl(Z.children,ja)],[sl(this.props.children,ja)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var Z=sl(this.props.children,ja);if(Z&&typeof Z.props.shared=="boolean"){var ne=Z.props.shared?"axis":"item";return o.indexOf(ne)>=0?ne:h}return h}},{key:"getMouseInfo",value:function(Z){if(!this.container)return null;var ne=this.container,Y=ne.getBoundingClientRect(),ee=rLe(Y),le={chartX:Math.round(Z.pageX-ee.left),chartY:Math.round(Z.pageY-ee.top)},fe=Y.width/ne.offsetWidth||1,Ce=this.inRange(le.chartX,le.chartY,fe);if(!Ce)return null;var Oe=this.state,Me=Oe.xAxisMap,Ke=Oe.yAxisMap,Ye=this.getTooltipEventType(),Le=SH(this.state,this.props.data,this.props.layout,Ce);if(Ye!=="axis"&&Me&&Ke){var Qe=qd(Me).scale,Je=qd(Ke).scale,it=Qe&&Qe.invert?Qe.invert(le.chartX):null,Ze=Je&&Je.invert?Je.invert(le.chartY):null;return Ut(Ut({},le),{},{xValue:it,yValue:Ze},Le)}return Le?Ut(Ut({},le),Le):null}},{key:"inRange",value:function(Z,ne){var Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,ee=this.props.layout,le=Z/Y,fe=ne/Y;if(ee==="horizontal"||ee==="vertical"){var Ce=this.state.offset,Oe=le>=Ce.left&&le<=Ce.left+Ce.width&&fe>=Ce.top&&fe<=Ce.top+Ce.height;return Oe?{x:le,y:fe}:null}var Me=this.state,Ke=Me.angleAxisMap,Ye=Me.radiusAxisMap;if(Ke&&Ye){var Le=qd(Ke);return Y8({x:le,y:fe},Le)}return null}},{key:"parseEventsOfWrapper",value:function(){var Z=this.props.children,ne=this.getTooltipEventType(),Y=sl(Z,ja),ee={};Y&&ne==="axis"&&(Y.props.trigger==="click"?ee={onClick:this.handleClick}:ee={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var le=y2(this.props,this.handleOuterEvent);return Ut(Ut({},le),ee)}},{key:"addListener",value:function(){UO.on(GO,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){UO.removeListener(GO,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(Z,ne,Y){for(var ee=this.state.formattedGraphicalItems,le=0,fe=ee.length;le<fe;le++){var Ce=ee[le];if(Ce.item===Z||Ce.props.key===Z.key||ne===yh(Ce.item.type)&&Y===Ce.childIndex)return Ce}return null}},{key:"renderClipPath",value:function(){var Z=this.clipPathId,ne=this.state.offset,Y=ne.left,ee=ne.top,le=ne.height,fe=ne.width;return ze.createElement("defs",null,ze.createElement("clipPath",{id:Z},ze.createElement("rect",{x:Y,y:ee,height:le,width:fe})))}},{key:"getXScales",value:function(){var Z=this.state.xAxisMap;return Z?Object.entries(Z).reduce(function(ne,Y){var ee=xH(Y,2),le=ee[0],fe=ee[1];return Ut(Ut({},ne),{},dn({},le,fe.scale))},{}):null}},{key:"getYScales",value:function(){var Z=this.state.yAxisMap;return Z?Object.entries(Z).reduce(function(ne,Y){var ee=xH(Y,2),le=ee[0],fe=ee[1];return Ut(Ut({},ne),{},dn({},le,fe.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(Z){var ne;return(ne=this.state.xAxisMap)===null||ne===void 0||(ne=ne[Z])===null||ne===void 0?void 0:ne.scale}},{key:"getYScaleByAxisId",value:function(Z){var ne;return(ne=this.state.yAxisMap)===null||ne===void 0||(ne=ne[Z])===null||ne===void 0?void 0:ne.scale}},{key:"getItemByXY",value:function(Z){var ne=this.state,Y=ne.formattedGraphicalItems,ee=ne.activeItem;if(Y&&Y.length)for(var le=0,fe=Y.length;le<fe;le++){var Ce=Y[le],Oe=Ce.props,Me=Ce.item,Ke=Me.type.defaultProps!==void 0?Ut(Ut({},Me.type.defaultProps),Me.props):Me.props,Ye=yh(Me.type);if(Ye==="Bar"){var Le=(Oe.data||[]).find(function(Ze){return H5e(Z,Ze)});if(Le)return{graphicalItem:Ce,payload:Le}}else if(Ye==="RadialBar"){var Qe=(Oe.data||[]).find(function(Ze){return Y8(Z,Ze)});if(Qe)return{graphicalItem:Ce,payload:Qe}}else if(iC(Ce,ee)||oC(Ce,ee)||Iw(Ce,ee)){var Je=R$e({graphicalItem:Ce,activeTooltipItem:ee,itemData:Ke.data}),it=Ke.activeIndex===void 0?Je:Ke.activeIndex;return{graphicalItem:Ut(Ut({},Ce),{},{childIndex:it}),payload:Iw(Ce,ee)?Ke.data[Je]:Ce.props.data[Je]}}}return null}},{key:"render",value:function(){var Z=this;if(!BU(this))return null;var ne=this.props,Y=ne.children,ee=ne.className,le=ne.width,fe=ne.height,Ce=ne.style,Oe=ne.compact,Me=ne.title,Ke=ne.desc,Ye=bH(ne,j8e),Le=wn(Ye,!1);if(Oe)return ze.createElement(oH,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ze.createElement(KR,Fy({},Le,{width:le,height:fe,title:Me,desc:Ke}),this.renderClipPath(),VU(Y,this.renderMap)));if(this.props.accessibilityLayer){var Qe,Je;Le.tabIndex=(Qe=this.props.tabIndex)!==null&&Qe!==void 0?Qe:0,Le.role=(Je=this.props.role)!==null&&Je!==void 0?Je:"application",Le.onKeyDown=function(Ze){Z.accessibilityManager.keyboardEvent(Ze)},Le.onFocus=function(){Z.accessibilityManager.focus()}}var it=this.parseEventsOfWrapper();return ze.createElement(oH,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ze.createElement("div",Fy({className:qn("recharts-wrapper",ee),style:Ut({position:"relative",cursor:"default",width:le,height:fe},Ce)},it,{ref:function(nt){Z.container=nt}}),ze.createElement(KR,Fy({},Le,{width:le,height:fe,title:Me,desc:Ke,style:Q8e}),this.renderClipPath(),VU(Y,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(K.Component);dn(B,"displayName",r),dn(B,"defaultProps",Ut({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},P)),dn(B,"getDerivedStateFromProps",function($,U){var G=$.dataKey,Z=$.data,ne=$.children,Y=$.width,ee=$.height,le=$.layout,fe=$.stackOffset,Ce=$.margin,Oe=U.dataStartIndex,Me=U.dataEndIndex;if(U.updateId===void 0){var Ke=TH($);return Ut(Ut(Ut({},Ke),{},{updateId:0},L(Ut(Ut({props:$},Ke),{},{updateId:0}),U)),{},{prevDataKey:G,prevData:Z,prevWidth:Y,prevHeight:ee,prevLayout:le,prevStackOffset:fe,prevMargin:Ce,prevChildren:ne})}if(G!==U.prevDataKey||Z!==U.prevData||Y!==U.prevWidth||ee!==U.prevHeight||le!==U.prevLayout||fe!==U.prevStackOffset||!Qy(Ce,U.prevMargin)){var Ye=TH($),Le={chartX:U.chartX,chartY:U.chartY,isTooltipActive:U.isTooltipActive},Qe=Ut(Ut({},SH(U,Z,le)),{},{updateId:U.updateId+1}),Je=Ut(Ut(Ut({},Ye),Le),Qe);return Ut(Ut(Ut({},Je),L(Ut({props:$},Je),U)),{},{prevDataKey:G,prevData:Z,prevWidth:Y,prevHeight:ee,prevLayout:le,prevStackOffset:fe,prevMargin:Ce,prevChildren:ne})}if(!ZR(ne,U.prevChildren)){var it,Ze,nt,pt,_t=sl(ne,F_),It=_t&&(it=(Ze=_t.props)===null||Ze===void 0?void 0:Ze.startIndex)!==null&&it!==void 0?it:Oe,sr=_t&&(nt=(pt=_t.props)===null||pt===void 0?void 0:pt.endIndex)!==null&&nt!==void 0?nt:Me,Sr=It!==Oe||sr!==Me,Kr=!ni(Z),Er=Kr&&!Sr?U.updateId:U.updateId+1;return Ut(Ut({updateId:Er},L(Ut(Ut({props:$},U),{},{updateId:Er,dataStartIndex:It,dataEndIndex:sr}),U)),{},{prevChildren:ne,dataStartIndex:It,dataEndIndex:sr})}return null}),dn(B,"renderActiveDot",function($,U,G){var Z;return K.isValidElement($)?Z=K.cloneElement($,U):In($)?Z=$(U):Z=ze.createElement(D3,U),ze.createElement(Li,{className:"recharts-active-dot",key:G},Z)});var z=K.forwardRef(function(U,G){return ze.createElement(B,Fy({},U,{ref:G}))});return z.displayName=B.displayName,z},_L=Zte({chartName:"BarChart",GraphicalChild:Rh,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:W_},{axisType:"yAxis",AxisComp:Z_}],formatAxisMap:hUe}),vL=Zte({chartName:"PieChart",GraphicalChild:zh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:nC},{axisType:"radiusAxis",AxisComp:tC}],formatAxisMap:oFe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const cGe=({className:e})=>{const{filteredPreschools:t,searchFilters:r}=Lo(),[n,l]=K.useState(!1),h=K.useMemo(()=>{const b=t.filter(G=>G.latitud&&G.longitud),E=b.length,P=b.reduce((G,Z)=>G+(Z.antal_barn||0),0),O=b.filter(G=>G.huvudman==="Kommunal").length,L=b.filter(G=>G.huvudman==="Enskild").length,B=b.filter(G=>G.andel_med_förskollärarexamen).reduce((G,Z)=>G+(Z.andel_med_förskollärarexamen||0),0)/b.filter(G=>G.andel_med_förskollärarexamen).length||0,z=b.filter(G=>G.personaltäthet).reduce((G,Z)=>G+(Z.personaltäthet||0),0)/b.filter(G=>G.personaltäthet).length||0,$=b.filter(G=>G.google_rating).reduce((G,Z)=>G+(Z.google_rating||0),0)/b.filter(G=>G.google_rating).length||0,U=b.filter(G=>G.google_rating).length;return{totalPreschools:E,totalChildren:P,kommunalCount:O,enskildCount:L,avgTeacherEducation:B,avgStaffDensity:z,avgRating:$,ratedCount:U,preschools:b}},[t]),f=()=>r.kommuner&&r.kommuner.length>0?`Statistik för ${r.kommuner.length===1?r.kommuner[0]:`${r.kommuner.length} kommuner`}`:r.nearbyMode?"Statistik för närområdet":r.query?`Statistik för "${r.query}"`:"Statistik för alla förskolor",o=[{name:"Kommunal",value:h.kommunalCount,color:"hsl(210, 85%, 60%)"},{name:"Fristående",value:h.enskildCount,color:"hsl(25, 85%, 60%)"}],v=K.useMemo(()=>{const b=[{name:"90-100%",min:90,max:100,count:0},{name:"80-89%",min:80,max:89,count:0},{name:"70-79%",min:70,max:79,count:0},{name:"60-69%",min:60,max:69,count:0},{name:"<60%",min:0,max:59,count:0}];return h.preschools.forEach(E=>{if(E.andel_med_förskollärarexamen){const P=b.find(O=>E.andel_med_förskollärarexamen>=O.min&&E.andel_med_förskollärarexamen<=O.max);P&&P.count++}}),b.filter(E=>E.count>0)},[h.preschools]);return n?M.jsx($r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`absolute bottom-4 left-4 z-30 w-96 max-h-[calc(100vh-2rem)] ${e}`,children:M.jsxs(Cn,{className:"glass-card border-0 shadow-lg h-full flex flex-col",children:[M.jsx(Ky,{className:"pb-4",children:M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{children:[M.jsx(Yy,{className:"text-lg font-heading font-semibold text-foreground",children:f()}),M.jsx("p",{className:"text-sm text-muted-foreground",children:"Översikt och jämförelser"})]}),M.jsx(fn,{onClick:()=>l(!1),variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:M.jsx(DA,{className:"h-3 w-3"})})]})}),M.jsx(Ml,{className:"flex-1 overflow-hidden",children:M.jsxs(CN,{defaultValue:"overview",className:"h-full flex flex-col",children:[M.jsxs(aP,{className:"grid w-full grid-cols-3",children:[M.jsx(bu,{value:"overview",children:"Översikt"}),M.jsx(bu,{value:"quality",children:"Kvalitet"}),M.jsx(bu,{value:"distribution",children:"Fördelning"})]}),M.jsxs("div",{className:"flex-1 overflow-y-auto mt-4",children:[M.jsxs(wu,{value:"overview",className:"space-y-4 mt-0",children:[M.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[M.jsx(Cn,{className:"bg-gradient-to-br from-bubble-kommunal/10 to-bubble-kommunal/5 border-bubble-kommunal/20",children:M.jsx(Ml,{className:"p-3",children:M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(sm,{className:"h-4 w-4 text-bubble-kommunal"}),M.jsxs("div",{children:[M.jsx("p",{className:"text-xs text-muted-foreground",children:"Förskolor"}),M.jsx("p",{className:"text-lg font-bold text-bubble-kommunal",children:h.totalPreschools})]})]})})}),M.jsx(Cn,{className:"bg-gradient-to-br from-bubble-enskild/10 to-bubble-enskild/5 border-bubble-enskild/20",children:M.jsx(Ml,{className:"p-3",children:M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(km,{className:"h-4 w-4 text-bubble-enskild"}),M.jsxs("div",{children:[M.jsx("p",{className:"text-xs text-muted-foreground",children:"Barn totalt"}),M.jsx("p",{className:"text-lg font-bold text-bubble-enskild",children:h.totalChildren})]})]})})}),h.avgRating>0&&M.jsx(Cn,{className:"bg-gradient-to-br from-bubble-high-rating/10 to-bubble-high-rating/5 border-bubble-high-rating/20",children:M.jsx(Ml,{className:"p-3",children:M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(ba,{className:"h-4 w-4 text-bubble-high-rating"}),M.jsxs("div",{children:[M.jsx("p",{className:"text-xs text-muted-foreground",children:"Snittbetyg"}),M.jsx("p",{className:"text-lg font-bold text-bubble-high-rating",children:h.avgRating.toFixed(1)})]})]})})}),h.avgTeacherEducation>0&&M.jsx(Cn,{className:"bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20",children:M.jsx(Ml,{className:"p-3",children:M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(T7,{className:"h-4 w-4 text-primary"}),M.jsxs("div",{children:[M.jsx("p",{className:"text-xs text-muted-foreground",children:"Förskollärare"}),M.jsxs("p",{className:"text-lg font-bold text-primary",children:[Math.round(h.avgTeacherEducation),"%"]})]})]})})})]}),M.jsxs("div",{className:"space-y-2",children:[M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("span",{className:"text-sm text-muted-foreground",children:"Kommunal vs Fristående"}),M.jsxs("div",{className:"flex gap-1",children:[M.jsxs(An,{variant:"outline",className:"text-xs bg-bubble-kommunal/10 text-bubble-kommunal border-bubble-kommunal/20",children:[h.kommunalCount," kommunal"]}),M.jsxs(An,{variant:"outline",className:"text-xs bg-bubble-enskild/10 text-bubble-enskild border-bubble-enskild/20",children:[h.enskildCount," fristående"]})]})]}),h.avgStaffDensity>0&&M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("span",{className:"text-sm text-muted-foreground",children:"Snitt personaltäthet"}),M.jsxs("span",{className:"text-sm font-medium",children:[h.avgStaffDensity.toFixed(1)," barn/personal"]})]}),h.ratedCount>0&&M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("span",{className:"text-sm text-muted-foreground",children:"Förskolor med betyg"}),M.jsxs("span",{className:"text-sm font-medium",children:[h.ratedCount," av ",h.totalPreschools]})]})]})]}),M.jsxs(wu,{value:"quality",className:"space-y-4 mt-0",children:[v.length>0&&M.jsxs(Cn,{children:[M.jsx(Ky,{className:"pb-2",children:M.jsx(Yy,{className:"text-sm",children:"Fördelning förskollärare med examen"})}),M.jsx(Ml,{children:M.jsx(xb,{width:"100%",height:200,children:M.jsxs(_L,{data:v,children:[M.jsx(G3,{strokeDasharray:"3 3",opacity:.3}),M.jsx(W_,{dataKey:"name",fontSize:10}),M.jsx(Z_,{fontSize:10}),M.jsx(ja,{}),M.jsx(Rh,{dataKey:"count",fill:"hsl(130, 70%, 60%)",radius:[2,2,0,0]})]})})})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsx("h4",{className:"font-medium text-sm",children:"Kvalitetsinsikter"}),h.avgTeacherEducation>=80&&M.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-bubble-high-rating/10 border border-bubble-high-rating/20",children:[M.jsx(Om,{className:"h-4 w-4 text-bubble-high-rating mt-0.5"}),M.jsxs("div",{children:[M.jsx("p",{className:"text-sm font-medium text-bubble-high-rating",children:"Hög kvalitet"}),M.jsxs("p",{className:"text-xs text-muted-foreground",children:["Området har en hög andel förskollärare med examen (",Math.round(h.avgTeacherEducation),"%)."]})]})]}),h.avgRating>=4.5&&M.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-yellow-50 border border-yellow-200",children:[M.jsx(ba,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),M.jsxs("div",{children:[M.jsx("p",{className:"text-sm font-medium text-yellow-700",children:"Högt betyg"}),M.jsxs("p",{className:"text-xs text-muted-foreground",children:["Förskolor i området har utmärkta betyg (",h.avgRating.toFixed(1),"/5)."]})]})]})]})]}),M.jsx(wu,{value:"distribution",className:"space-y-4 mt-0",children:o.some(b=>b.value>0)&&M.jsxs(Cn,{children:[M.jsx(Ky,{className:"pb-2",children:M.jsx(Yy,{className:"text-sm",children:"Kommunal vs Fristående"})}),M.jsxs(Ml,{children:[M.jsx(xb,{width:"100%",height:200,children:M.jsxs(vL,{children:[M.jsx(vL,{data:o,dataKey:"value",cx:"50%",cy:"50%",outerRadius:80,children:o.map((b,E)=>M.jsx(i1,{fill:b.color},`cell-${E}`))}),M.jsx(ja,{})]})}),M.jsx("div",{className:"flex justify-center gap-4 mt-2",children:o.map(b=>M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:b.color}}),M.jsxs("span",{className:"text-xs text-muted-foreground",children:[b.name," (",b.value,")"]})]},b.name))})]})]})})]})]})})]})}):M.jsx($r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`absolute bottom-4 left-4 z-30 ${e}`,children:M.jsx(Cn,{className:"glass-card border-0 shadow-lg hover-lift-subtle cursor-pointer",onClick:()=>l(!0),children:M.jsx(Ml,{className:"p-4",children:M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx(Sh,{className:"h-5 w-5 text-primary"}),M.jsxs("div",{children:[M.jsx("h3",{className:"font-heading font-semibold text-sm text-foreground",children:f()}),M.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.totalPreschools," förskolor • ",h.totalChildren," barn"]})]}),M.jsx(bj,{className:"h-4 w-4 text-muted-foreground ml-auto"})]})})})})},H3=K.forwardRef(({className:e,type:t,...r},n)=>M.jsx("input",{type:t,className:ln("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));H3.displayName="Input";var uGe="Separator",AH="horizontal",hGe=["horizontal","vertical"],Xte=K.forwardRef((e,t)=>{const{decorative:r,orientation:n=AH,...l}=e,h=dGe(n)?n:AH,o=r?{role:"none"}:{"aria-orientation":h==="vertical"?h:void 0,role:"separator"};return M.jsx(pn.div,{"data-orientation":h,...o,...l,ref:t})});Xte.displayName=uGe;function dGe(e){return hGe.includes(e)}var Kte=Xte;const $p=K.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},l)=>M.jsx(Kte,{ref:l,decorative:r,orientation:t,className:ln("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));$p.displayName=Kte.displayName;const fGe=()=>{const e=K.useRef(new Map),[t,r]=K.useState(!1),n=30*60*1e3,l=K.useCallback(async o=>{const v=Date.now(),b=e.current.get(o);if(b&&v<b.expiry)return b.data;r(!0);try{const{data:E,error:P}=await _n.from("preschool_images").select("image_url").eq("preschool_id",o).eq("image_type","google_places").order("created_at");if(P)return console.error("Error fetching images:",P),[];const O=E?.map(L=>L.image_url)||[];return e.current.set(o,{data:O,timestamp:v,expiry:v+n}),O}catch(E){return console.error("Error in image cache:",E),[]}finally{r(!1)}},[]),h=K.useCallback(async o=>{const v=o.map(b=>l(b));await Promise.allSettled(v)},[l]),f=K.useCallback(()=>{e.current.clear()},[]);return{getImages:l,preloadImages:h,clearCache:f,isLoading:t}},pGe=({preschoolId:e,preschoolName:t,streetViewPanoId:r,lat:n,lng:l})=>{const[h,f]=K.useState([]),[o,v]=K.useState(0),[b,E]=K.useState(!1),[P,O]=K.useState(!0),{getImages:L}=fGe();K.useEffect(()=>{(async()=>{O(!0);try{const Y=[...await L(e)];if(r&&n&&l){const ee=`https://maps.googleapis.com/maps/api/streetview?size=800x600&location=${n},${l}&fov=90&pitch=0&key=demo`;Y.push(ee)}f(Y)}catch(ne){console.error("Error loading images:",ne)}finally{O(!1)}})()},[e,r,n,l,L]);const B=()=>{v(Z=>(Z+1)%h.length)},z=()=>{v(Z=>(Z-1+h.length)%h.length)},$=()=>{E(!0)},U=()=>{E(!1)},G=()=>{if(n&&l){const Z=`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${n},${l}`;window.open(Z,"_blank")}};return P?M.jsxs("div",{className:"space-y-2",children:[M.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[M.jsx(Ha,{className:"h-4 w-4"}),"Bilder"]}),M.jsx("div",{className:"w-full h-48 bg-muted rounded-lg animate-pulse flex items-center justify-center",children:M.jsx("span",{className:"text-sm text-muted-foreground",children:"Laddar bilder..."})})]}):h.length===0?M.jsxs("div",{className:"space-y-2",children:[M.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[M.jsx(Ha,{className:"h-4 w-4"}),"Bilder"]}),M.jsx("div",{className:"w-full h-32 bg-muted/30 rounded-lg flex items-center justify-center",children:M.jsx("span",{className:"text-sm text-muted-foreground",children:"Inga bilder tillgängliga"})})]}):M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"space-y-2",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[M.jsx(Ha,{className:"h-4 w-4"}),"Bilder"]}),h.length>1&&M.jsxs(An,{variant:"secondary",className:"text-xs",children:[o+1," / ",h.length]})]}),M.jsxs("div",{className:"relative group",children:[M.jsx("div",{className:"w-full h-48 bg-muted rounded-lg overflow-hidden cursor-pointer",onClick:$,children:M.jsx("img",{src:h[o],alt:`${t} - Bild ${o+1}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",onError:Z=>{console.error("Failed to load image:",h[o]),Z.currentTarget.src="/placeholder.svg"}})}),h.length>1&&M.jsxs(M.Fragment,{children:[M.jsx(fn,{variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white hover:bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity",onClick:Z=>{Z.stopPropagation(),z()},children:M.jsx(Gk,{className:"h-4 w-4"})}),M.jsx(fn,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white hover:bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity",onClick:Z=>{Z.stopPropagation(),B()},children:M.jsx(Hk,{className:"h-4 w-4"})})]}),r&&o===h.length-1&&M.jsxs(fn,{variant:"ghost",size:"sm",className:"absolute bottom-2 right-2 bg-black/50 text-white hover:bg-black/70 text-xs",onClick:Z=>{Z.stopPropagation(),G()},children:[M.jsx(uce,{className:"h-3 w-3 mr-1"}),"Street View"]})]}),h.length>1&&M.jsx("div",{className:"flex gap-1 overflow-x-auto",children:h.map((Z,ne)=>M.jsx("button",{className:`flex-shrink-0 w-12 h-12 rounded border-2 overflow-hidden transition-all ${ne===o?"border-primary":"border-transparent hover:border-muted-foreground/50"}`,onClick:()=>v(ne),children:M.jsx("img",{src:Z,alt:`Thumbnail ${ne+1}`,className:"w-full h-full object-cover",onError:Y=>{Y.currentTarget.src="/placeholder.svg"}})},ne))})]}),M.jsx(Pc,{children:b&&M.jsx($r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center",onClick:U,children:M.jsxs($r.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:"relative max-w-6xl max-h-[90vh] w-full h-full flex items-center justify-center",onClick:Z=>Z.stopPropagation(),children:[M.jsx("img",{src:h[o],alt:`${t} - Fullscreen`,className:"max-w-full max-h-full object-contain"}),M.jsx(fn,{variant:"ghost",size:"sm",className:"absolute top-4 right-4 text-white hover:bg-white/20",onClick:U,children:M.jsx($l,{className:"h-6 w-6"})}),h.length>1&&M.jsxs(M.Fragment,{children:[M.jsx(fn,{variant:"ghost",size:"sm",className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20",onClick:z,children:M.jsx(Gk,{className:"h-8 w-8"})}),M.jsx(fn,{variant:"ghost",size:"sm",className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20",onClick:B,children:M.jsx(Hk,{className:"h-8 w-8"})})]}),M.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white text-sm",children:[o+1," / ",h.length]})]})})})]})},mGe=({reviews:e,rating:t,reviewsCount:r})=>{const[n,l]=K.useState(!1),[h,f]=K.useState(null),o=K.useMemo(()=>{if(!e)return[];try{return typeof e=="string"?JSON.parse(e):e}catch(B){return console.error("Error parsing reviews:",B),[]}},[e]),v=K.useMemo(()=>{if(!o.length)return[];let B=o;return h!==null&&(B=B.filter(z=>z.rating===h)),B.sort((z,$)=>$.time-z.time)},[o,h]),b=n?v:v.slice(0,3),E=K.useMemo(()=>{if(!o.length)return{};const B={};return o.forEach(z=>{B[z.rating]=(B[z.rating]||0)+1}),B},[o]),P=K.useMemo(()=>o.length?o.reduce((z,$)=>z+$.rating,0)/o.length:t||0,[o,t]),O=B=>B.replace("a day ago","för en dag sedan").replace("days ago","dagar sedan").replace("a week ago","för en vecka sedan").replace("weeks ago","veckor sedan").replace("a month ago","för en månad sedan").replace("months ago","månader sedan").replace("a year ago","för ett år sedan").replace("years ago","år sedan"),L=(B,z="sm")=>{const $=z==="sm"?"h-3 w-3":"h-4 w-4";return M.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(U=>M.jsx(ba,{className:`${$} ${U<=B?"fill-yellow-400 text-yellow-400":"text-muted-foreground/30"}`},U))})};return!o.length&&!t?M.jsxs("div",{className:"space-y-2",children:[M.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[M.jsx(J4,{className:"h-4 w-4"}),"Recensioner"]}),M.jsx("div",{className:"bg-muted/30 rounded-lg p-3 text-center",children:M.jsx("p",{className:"text-sm text-muted-foreground",children:"Inga recensioner tillgängliga"})})]}):M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[M.jsx(J4,{className:"h-4 w-4"}),"Recensioner"]}),o.length>0&&M.jsxs(An,{variant:"secondary",className:"text-xs",children:[v.length," av ",o.length]})]}),(t||P>0)&&M.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-3",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center gap-2",children:[L(P,"md"),M.jsx("span",{className:"font-semibold text-lg",children:P.toFixed(1)})]}),r&&M.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",r," recensioner)"]})]}),Object.keys(E).length>0&&M.jsx("div",{className:"space-y-1",children:[5,4,3,2,1].map(B=>{const z=E[B]||0,$=o.length>0?z/o.length*100:0;return M.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[M.jsx("span",{className:"w-3 text-muted-foreground",children:B}),M.jsx(ba,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),M.jsx("div",{className:"flex-1 bg-muted rounded-full h-1.5",children:M.jsx("div",{className:"bg-yellow-400 h-1.5 rounded-full transition-all duration-300",style:{width:`${$}%`}})}),M.jsx("span",{className:"w-6 text-muted-foreground",children:z})]},B)})})]}),o.length>0&&M.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[M.jsxs(fn,{variant:h===null?"default":"outline",size:"sm",onClick:()=>f(null),className:"flex-shrink-0",children:[M.jsx(hce,{className:"h-3 w-3 mr-1"}),"Alla"]}),[5,4,3,2,1].map(B=>{const z=E[B]||0;return z===0?null:M.jsxs(fn,{variant:h===B?"default":"outline",size:"sm",onClick:()=>f(B),className:"flex-shrink-0",children:[B," ",M.jsx(ba,{className:"h-3 w-3 ml-1 fill-current"}),M.jsxs("span",{className:"ml-1 text-xs",children:["(",z,")"]})]},B)})]}),v.length>0&&M.jsxs("div",{className:"space-y-3",children:[M.jsx(Pc,{children:b.map((B,z)=>M.jsxs($r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:z*.1},className:"bg-muted/20 rounded-lg p-3 space-y-2",children:[M.jsxs("div",{className:"flex items-start justify-between",children:[M.jsxs("div",{className:"flex items-center gap-2",children:[B.profile_photo_url&&M.jsx("img",{src:B.profile_photo_url,alt:B.author_name,className:"w-6 h-6 rounded-full",onError:$=>{$.currentTarget.style.display="none"}}),M.jsxs("div",{children:[M.jsx("p",{className:"font-medium text-sm",children:B.author_name}),M.jsx("p",{className:"text-xs text-muted-foreground",children:O(B.relative_time_description)})]})]}),L(B.rating)]}),M.jsx("p",{className:"text-sm leading-relaxed",children:B.text}),M.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[M.jsx(xce,{className:"h-3 w-3"}),M.jsx("span",{children:"Hjälpsam"})]})]},`${B.author_name}-${B.time}`))}),v.length>3&&M.jsxs(fn,{variant:"outline",size:"sm",onClick:()=>l(!n),className:"w-full",children:[n?"Visa färre":`Visa alla ${v.length} recensioner`,M.jsx(Om,{className:"h-3 w-3 ml-1"})]})]}),v.length===0&&h!==null&&M.jsx("div",{className:"bg-muted/30 rounded-lg p-3 text-center",children:M.jsxs("p",{className:"text-sm text-muted-foreground",children:["Inga recensioner med ",h," stjärnor"]})})]})},gGe=()=>{const[e,t]=K.useState({totalPreschools:0,enrichedPreschools:0,coveragePercentage:0,recentlyUpdated:0,needingUpdate:0}),[r,n]=K.useState(!0),[l,h]=K.useState(new Map),f=K.useCallback(async P=>{if(l.has(P))return l.get(P)||null;try{const{data:O,error:L}=await _n.from("preschool_google_data").select("*").eq("preschool_id",P).maybeSingle();return L?(console.error("Error fetching Google data:",L),null):(O&&(l.set(P,O),h(new Map(l))),O)}catch(O){return console.error("Error in getGoogleData:",O),null}},[l]),o=K.useCallback(async P=>{try{const O=P.filter($=>!l.has($));if(O.length===0)return;const{data:L,error:B}=await _n.from("preschool_google_data").select("*").in("preschool_id",O);if(B){console.error("Error preloading Google data:",B);return}const z=new Map(l);L?.forEach($=>{z.set($.preschool_id,$)}),h(z)}catch(O){console.error("Error in preloadGoogleData:",O)}},[l]),v=K.useCallback(async()=>{n(!0);try{const{count:P}=await _n.from("Förskolor").select("*",{count:"exact",head:!0}).not("Latitud","is",null),{count:O}=await _n.from("preschool_google_data").select("*",{count:"exact",head:!0}),L=new Date;L.setDate(L.getDate()-7);const{count:B}=await _n.from("preschool_google_data").select("*",{count:"exact",head:!0}).gte("last_updated",L.toISOString()),z=new Date;z.setDate(z.getDate()-30);const{count:$}=await _n.from("preschool_google_data").select("*",{count:"exact",head:!0}).lt("last_updated",z.toISOString()),U=P||0,G=O||0,Z=U>0?Math.round(G/U*100):0;t({totalPreschools:U,enrichedPreschools:G,coveragePercentage:Z,recentlyUpdated:B||0,needingUpdate:($||0)+(U-G)})}catch(P){console.error("Error refreshing stats:",P)}finally{n(!1)}},[]),b=K.useCallback(async P=>{try{if(P&&P.length>0)for(const O of P.slice(0,10)){const{data:L}=await _n.from("Förskolor").select('id, "Namn", "Adress", "Latitud", "Longitud"').eq("id",O).single();L&&await _n.functions.invoke("google-places-enricher",{body:{preschoolId:L.id,lat:L.Latitud,lng:L.Longitud,address:L.Adress,name:L.Namn}})}else await _n.functions.invoke("google-places-enricher",{body:{batch:!0}});h(new Map),await v()}catch(O){console.error("Error triggering enrichment:",O)}},[v]),E=K.useCallback(()=>{h(new Map)},[]);return K.useEffect(()=>{v()},[v]),{stats:e,isLoading:r,getGoogleData:f,preloadGoogleData:o,refreshStats:v,triggerEnrichment:b,clearCache:E}},Yte=({preschool:e,onBack:t,nationalAverage:r})=>{const[n,l]=K.useState(null),{getGoogleData:h}=gGe();K.useEffect(()=>{(async()=>{const P=await h(e.id);l(P)})()},[e.id,h]);const f=E=>{switch(E){case"Kommunal":return{label:"Kommunal förskola",color:"bg-blue-500/10 text-blue-700 border-blue-200",icon:M.jsx(sm,{className:"h-3 w-3"})};case"Enskild":return{label:"Fristående förskola",color:"bg-green-500/10 text-green-700 border-green-200",icon:M.jsx(sm,{className:"h-3 w-3"})};default:return{label:E,color:"bg-gray-500/10 text-gray-700 border-gray-200",icon:M.jsx(sm,{className:"h-3 w-3"})}}},o=E=>E?E>=80?"Utmärkt":E>=65?"Bra":E>=50?"Medel":"Under medel":"Ingen data",v=E=>E?M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(P=>M.jsx(ba,{className:`h-4 w-4 ${P<=E?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},P))}),M.jsx("span",{className:"font-medium",children:E.toFixed(1)}),e.google_reviews_count&&M.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",e.google_reviews_count," recensioner)"]})]}):null,b=f(e.huvudman);return M.jsx($r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"absolute right-4 top-4 z-30 w-80 max-h-[calc(100vh-2rem)]",children:M.jsxs(Cn,{className:"glass-card border-0 shadow-lg h-full flex flex-col",children:[M.jsx(Ky,{className:"p-4 border-b border-border/20",children:M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx(fn,{onClick:t,variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:M.jsx(nce,{className:"h-4 w-4"})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx(Yy,{className:"text-lg font-heading truncate",children:e.namn}),M.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[M.jsx(Ha,{className:"h-3 w-3"}),M.jsx("span",{children:e.kommun})]})]})]})}),M.jsxs(Ml,{className:"p-4 flex-1 overflow-y-auto space-y-4",children:[M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs(An,{className:b.color,children:[b.icon,M.jsx("span",{className:"ml-1",children:b.label})]}),(n?.google_rating||e.google_rating)&&M.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[M.jsx(ba,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),M.jsx("span",{className:"font-medium",children:(n?.google_rating||e.google_rating)?.toFixed(1)})]})]}),e.adress&&M.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[M.jsx(Ha,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),M.jsx("span",{children:e.adress})]})]}),M.jsx($p,{}),(n?.google_rating||e.google_rating)&&M.jsxs("div",{className:"space-y-2",children:[M.jsx("h4",{className:"font-medium text-sm",children:"Betyg"}),v(n?.google_rating||e.google_rating),r&&(n?.google_rating||e.google_rating)>r.avgRating&&M.jsxs("p",{className:"text-xs text-green-600",children:["Över riksgenomsnittet (",r.avgRating.toFixed(1),")"]})]}),e.antal_barn&&M.jsxs("div",{className:"space-y-2",children:[M.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[M.jsx(I7,{className:"h-4 w-4"}),"Barn och personal"]}),M.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Antal barn:"}),M.jsx("span",{className:"font-medium",children:e.antal_barn})]}),e.antal_barngrupper&&M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Barngrupper:"}),M.jsx("span",{className:"font-medium",children:e.antal_barngrupper})]}),e.personaltäthet&&M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-muted-foreground",children:"Personaltäthet:"}),M.jsxs("span",{className:"font-medium",children:[e.personaltäthet.toFixed(1)," barn/tjänst"]})]})]})]}),e.andel_med_förskollärarexamen&&M.jsxs("div",{className:"space-y-2",children:[M.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[M.jsx(xj,{className:"h-4 w-4"}),"Kvalitet"]}),M.jsxs("div",{className:"space-y-2",children:[M.jsxs("div",{className:"flex justify-between text-sm",children:[M.jsx("span",{className:"text-muted-foreground",children:"Förskollärare:"}),M.jsxs("span",{className:"font-medium",children:[Math.round(e.andel_med_förskollärarexamen),"%"]})]}),M.jsx("div",{className:"flex-1 bg-muted rounded-full h-2",children:M.jsx("div",{className:"bg-gradient-primary h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,e.andel_med_förskollärarexamen)}%`}})}),M.jsxs("p",{className:"text-xs text-muted-foreground",children:["Kvalitetsnivå: ",o(e.andel_med_förskollärarexamen)]}),r&&e.andel_med_förskollärarexamen>r.avgTeacherExam&&M.jsxs("p",{className:"text-xs text-green-600",children:["Över riksgenomsnittet (",r.avgTeacherExam,"%)"]})]})]}),(n?.contact_phone||n?.website_url||e.contact_phone||e.website_url)&&M.jsxs(M.Fragment,{children:[M.jsx($p,{}),M.jsxs("div",{className:"space-y-2",children:[M.jsx("h4",{className:"font-medium text-sm",children:"Kontakt"}),M.jsxs("div",{className:"space-y-2",children:[(n?.contact_phone||e.contact_phone)&&M.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[M.jsx(_ce,{className:"h-4 w-4 text-muted-foreground"}),M.jsx("a",{href:`tel:${n?.contact_phone||e.contact_phone}`,className:"text-primary hover:underline",children:n?.contact_phone||e.contact_phone})]}),(n?.website_url||e.website_url)&&M.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[M.jsx(S7,{className:"h-4 w-4 text-muted-foreground"}),M.jsx("a",{href:n?.website_url||e.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline truncate",children:"Webbsida"})]})]})]})]}),(n?.opening_hours||e.opening_hours)&&M.jsxs(M.Fragment,{children:[M.jsx($p,{}),M.jsxs("div",{className:"space-y-2",children:[M.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[M.jsx(wj,{className:"h-4 w-4"}),"Öppettider"]}),M.jsx("div",{className:"text-sm",children:typeof(n?.opening_hours||e.opening_hours)=="object"?M.jsx("div",{className:"space-y-1",children:Object.entries(n?.opening_hours||e.opening_hours).map(([E,P])=>M.jsxs("div",{className:"flex justify-between",children:[M.jsxs("span",{className:"text-muted-foreground capitalize",children:[E,":"]}),M.jsx("span",{children:P})]},E))}):M.jsx("p",{className:"text-muted-foreground",children:n?.opening_hours||e.opening_hours})})]})]}),M.jsx($p,{}),M.jsx(pGe,{preschoolId:e.id,preschoolName:e.namn,streetViewPanoId:n?.street_view_pano_id,lat:e.latitud,lng:e.longitud}),M.jsx($p,{}),M.jsx(mGe,{reviews:n?.reviews,rating:n?.google_rating||e.google_rating,reviewsCount:n?.google_reviews_count||e.google_reviews_count}),M.jsx($p,{}),M.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2",children:[M.jsx("h4",{className:"font-medium text-sm",children:"Sammanfattning"}),M.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[M.jsxs("div",{className:"flex flex-col",children:[M.jsx("span",{className:"text-muted-foreground",children:"Typ"}),M.jsx("span",{className:"font-medium",children:e.huvudman})]}),M.jsxs("div",{className:"flex flex-col",children:[M.jsx("span",{className:"text-muted-foreground",children:"Barn"}),M.jsx("span",{className:"font-medium",children:e.antal_barn||"Ej angivet"})]}),M.jsxs("div",{className:"flex flex-col",children:[M.jsx("span",{className:"text-muted-foreground",children:"Betyg"}),M.jsx("span",{className:"font-medium",children:n?.google_rating||e.google_rating?`${(n?.google_rating||e.google_rating).toFixed(1)} ⭐`:"Inget betyg"})]}),M.jsxs("div",{className:"flex flex-col",children:[M.jsx("span",{className:"text-muted-foreground",children:"Kvalitet"}),M.jsx("span",{className:"font-medium",children:e.andel_med_förskollärarexamen?o(e.andel_med_förskollärarexamen):"Ingen data"})]})]})]})]})]})})},yGe=Object.freeze(Object.defineProperty({__proto__:null,PreschoolDetailsPanel:Yte},Symbol.toStringTag,{value:"Module"})),Jte=K.memo(({preschool:e,index:t,onPreschoolClick:r,onFavorite:n,onCompare:l,onShowDetails:h,isFavorite:f,isInComparison:o,comparisonFull:v})=>{const b=K.useCallback(P=>{if(!P)return null;const O=P>=4.5?"text-green-600":P>=4?"text-yellow-600":"text-orange-600";return M.jsxs("div",{className:`flex items-center gap-1 ${O}`,children:[M.jsx(ba,{className:"h-3 w-3 fill-current"}),M.jsx("span",{className:"text-xs font-medium",children:P.toFixed(1)})]})},[]),E=K.useCallback(P=>P==="Kommunal"?"bg-blue-500/10 text-blue-700 border-blue-200":"bg-green-500/10 text-green-700 border-green-200",[]);return M.jsx($r.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:Math.min(t*.01,.2)},layout:!0,children:M.jsx(Cn,{className:"hover-lift-subtle cursor-pointer border border-border/30 bg-background/50 relative transition-all duration-200",children:M.jsx(Ml,{className:"p-3",children:M.jsxs("div",{className:"space-y-2",children:[M.jsxs("div",{className:"flex items-start justify-between gap-2",children:[M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("h4",{className:"font-medium text-sm text-foreground truncate hover:text-primary cursor-pointer transition-colors duration-200",onClick:()=>r(e),title:e.namn,children:e.namn}),M.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[M.jsx(Ha,{className:"h-3 w-3 text-muted-foreground"}),M.jsx("span",{className:"text-xs text-muted-foreground truncate",children:e.kommun})]})]}),b(e.google_rating)]}),M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(An,{variant:"outline",className:`text-xs px-1.5 py-0.5 ${E(e.huvudman)}`,children:e.huvudman==="Enskild"?"Fristående":e.huvudman}),e.antal_barn&&M.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[M.jsx(I7,{className:"h-3 w-3"}),M.jsx("span",{className:"text-xs",children:e.antal_barn})]})]}),M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx(fn,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-primary/10 transition-colors duration-200",onClick:P=>n(e.id,P),children:M.jsx(E7,{className:`h-3 w-3 transition-colors duration-200 ${f?"fill-red-500 text-red-500":""}`})}),M.jsx(fn,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-primary/10 transition-colors duration-200",onClick:P=>l(e.id,P),disabled:v&&!o,children:M.jsx(rce,{className:`h-3 w-3 transition-colors duration-200 ${o?"fill-blue-500 text-blue-500":""}`})}),M.jsx(fn,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-primary/10 transition-colors duration-200",onClick:()=>h(e),children:M.jsx(Tj,{className:"h-3 w-3"})})]})]}),e.andel_med_förskollärarexamen&&M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx("div",{className:"flex-1 bg-muted rounded-full h-1.5",children:M.jsx("div",{className:"bg-gradient-primary h-1.5 rounded-full transition-all duration-500",style:{width:`${Math.min(100,e.andel_med_förskollärarexamen)}%`}})}),M.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(e.andel_med_förskollärarexamen),"% förskollärare"]})]})]})})})})});Jte.displayName="PreschoolListItem";const Qte=K.memo(({items:e,onPreschoolClick:t,onFavorite:r,onCompare:n,onShowDetails:l,favorites:h,comparison:f})=>{const o=K.useRef(null),[v,b]=K.useState({start:0,end:20}),E=120,P=5;K.useEffect(()=>{const z=o.current;if(!z)return;const $=()=>{const U=z.scrollTop,G=z.clientHeight,Z=Math.max(0,Math.floor(U/E)-P),ne=Math.min(e.length,Math.ceil((U+G)/E)+P);b({start:Z,end:ne})};return z.addEventListener("scroll",$,{passive:!0}),$(),()=>z.removeEventListener("scroll",$)},[e.length]);const O=e.slice(v.start,v.end),L=v.start*E,B=e.length*E;return M.jsx("div",{ref:o,className:"overflow-y-auto max-h-[calc(100vh-16rem)] relative",children:M.jsx("div",{style:{height:B,position:"relative"},children:M.jsx("div",{style:{transform:`translateY(${L}px)`},children:M.jsx("div",{className:"space-y-2 p-2",children:O.map((z,$)=>M.jsx(Jte,{preschool:z,index:v.start+$,onPreschoolClick:t,onFavorite:r,onCompare:n,onShowDetails:l,isFavorite:h.has(z.id),isInComparison:f.has(z.id),comparisonFull:f.size>=3},z.id))})})})})});Qte.displayName="VirtualizedList";const _Ge=({className:e})=>{const{filteredPreschools:t,visiblePreschools:r,searchFilters:n,setSelectedPreschool:l,setMapCenter:h,setMapZoom:f,preschools:o,listContext:v,setListContext:b}=Lo(),[E,P]=K.useState(!1),[O,L]=K.useState(null),[B,z]=K.useState(""),[$,U]=K.useState("rating"),[G,Z]=K.useState(new Set),[ne,Y]=K.useState(new Set),[ee,le]=K.useState(!0),fe=GX(B,300);K.useEffect(()=>{console.log(`👁️ Viewport visibility changed - viewportOnly: ${ee}, visible count: ${r.length}`)},[ee,r.length]);const Ce=K.useMemo(()=>(console.log(`📊 List data source update - viewportOnly: ${ee}, visible: ${r.length}, filtered: ${t.length}`),ee?r:t),[ee,r,t]),Oe=K.useMemo(()=>{const it=performance.now();let Ze=[...Ce].filter(pt=>pt.latitud&&pt.longitud);if(fe){const pt=fe.toLowerCase();Ze=Ze.filter(_t=>_t.namn.toLowerCase().includes(pt)||_t.kommun.toLowerCase().includes(pt)||_t.adress?.toLowerCase().includes(pt))}Ze.sort((pt,_t)=>{switch($){case"rating":return(_t.google_rating||0)-(pt.google_rating||0);case"name":return pt.namn.localeCompare(_t.namn);case"children":return(_t.antal_barn||0)-(pt.antal_barn||0);case"quality":return(_t.andel_med_förskollärarexamen||0)-(pt.andel_med_förskollärarexamen||0);default:return 0}});const nt=performance.now();return console.log(`🔄 List processed: ${Ze.length} items (from ${Ce.length} source) - viewport: ${ee} - search: "${fe}" - sort: ${$}`),nt-it>10&&console.log(`⚠️ List processing took ${nt-it}ms for ${Ze.length} items`),Ze},[Ce,fe,$]),Me=K.useCallback(it=>{it.longitud&&it.latitud&&(l(it),h([it.longitud,it.latitud]),f(15))},[l,h,f]),Ke=K.useCallback((it,Ze)=>{Ze.stopPropagation(),Z(nt=>{const pt=new Set(nt);return pt.has(it)?pt.delete(it):pt.add(it),pt})},[]),Ye=K.useCallback((it,Ze)=>{Ze.stopPropagation(),Y(nt=>{const pt=new Set(nt);return pt.has(it)?pt.delete(it):pt.size<3&&pt.add(it),pt})},[]),Le=()=>ee?"Synliga på kartan":n.kommuner&&n.kommuner.length>0?`Förskolor i ${n.kommuner.join(", ")}`:n.nearbyMode?"Närliggande förskolor":n.query?`Sökresultat för "${n.query}"`:"Alla förskolor",Qe=()=>{const it=Oe.length,Ze=Ce.length,nt=t.length;return B?ee?`${it} träffar på kartan (av ${Ze} synliga)`:`${it} sökträffar (av ${nt} filtrerade)`:ee?`${it} synliga på kartan (av ${nt} totalt)`:`${it} förskolor`},Je=K.useMemo(()=>{if(o.length===0)return;const it=o.filter(_t=>_t.antal_barn).map(_t=>_t.antal_barn),Ze=o.filter(_t=>_t.personaltäthet).map(_t=>_t.personaltäthet),nt=o.filter(_t=>_t.andel_med_förskollärarexamen).map(_t=>_t.andel_med_förskollärarexamen),pt=o.filter(_t=>_t.google_rating).map(_t=>_t.google_rating);return{avgChildren:it.length>0?Math.round(it.reduce((_t,It)=>_t+It,0)/it.length):0,avgStaff:Ze.length>0?Ze.reduce((_t,It)=>_t+It,0)/Ze.length:0,avgTeacherExam:nt.length>0?Math.round(nt.reduce((_t,It)=>_t+It,0)/nt.length):0,avgRating:pt.length>0?pt.reduce((_t,It)=>_t+It,0)/pt.length:0}},[o]);return O?M.jsx(Yte,{preschool:O,onBack:()=>L(null),nationalAverage:Je}):M.jsx($r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:`absolute right-4 top-4 z-30 w-80 max-h-[calc(100vh-2rem)] ${e}`,children:M.jsxs(Cn,{className:"glass-card border-0 shadow-lg h-full flex flex-col",children:[M.jsxs("div",{className:"p-4 border-b border-border/20",children:[M.jsxs("div",{className:"flex items-center justify-between mb-3",children:[M.jsxs("div",{children:[M.jsx("h3",{className:"font-heading font-semibold text-sm text-foreground",children:Le()}),M.jsx("p",{className:"text-xs text-muted-foreground",children:Qe()})]}),M.jsx(fn,{onClick:()=>P(!E),variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:E?M.jsx(DA,{className:"h-3 w-3"}):M.jsx(bj,{className:"h-3 w-3"})})]}),!E&&M.jsxs("div",{className:"space-y-2",children:[M.jsx(H3,{placeholder:"Sök i listan...",value:B,onChange:it=>z(it.target.value),className:"h-8 text-xs"}),M.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[M.jsxs("select",{value:$,onChange:it=>U(it.target.value),className:"text-xs p-1 rounded border bg-background",children:[M.jsx("option",{value:"rating",children:"Betyg"}),M.jsx("option",{value:"name",children:"Namn"}),M.jsx("option",{value:"children",children:"Antal barn"}),M.jsx("option",{value:"quality",children:"Kvalitet"})]}),M.jsx(fn,{size:"sm",variant:ee?"default":"outline",onClick:()=>le(!ee),className:"text-xs h-6 px-2",children:ee?"Endast karta":"Alla"}),ne.size>0&&M.jsxs(An,{variant:"secondary",className:"text-xs",children:["Jämför (",ne.size,")"]})]})]})]}),M.jsx(Pc,{children:!E&&M.jsx($r.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"flex-1 overflow-hidden",children:Oe.length>0?M.jsx(Qte,{items:Oe,onPreschoolClick:Me,onFavorite:Ke,onCompare:Ye,onShowDetails:L,favorites:G,comparison:ne}):M.jsx("div",{className:"text-center py-8",children:M.jsx("p",{className:"text-muted-foreground text-sm",children:B?"Inga förskolor matchar sökningen.":ee?"Inga förskolor synliga i kartvy.":"Inga förskolor hittades med de valda filtren."})})})})]})})},vGe=()=>{const{selectedPreschool:e}=Lo();K.useEffect(()=>{if(e){const r=`Förskola vald: ${e.namn} i ${e.kommun}`;t(r)}},[e]);const t=r=>{const n=document.createElement("div");n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","true"),n.className="sr-only",n.textContent=r,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},1e3)};return K.useEffect(()=>{const r=document.createElement("div");r.className="skip-links",r.innerHTML=`
      <a href="#main-content" class="skip-link">Hoppa till huvudinnehåll</a>
      <a href="#search-filters" class="skip-link">Hoppa till sökfilter</a>
      <a href="#map" class="skip-link">Hoppa till karta</a>
    `;const n=document.createElement("style");return n.textContent=`
      .skip-links {
        position: fixed;
        top: -100px;
        left: 0;
        z-index: 9999;
      }
      
      .skip-link {
        position: absolute;
        left: -10000px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
        background: var(--primary);
        color: var(--primary-foreground);
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 4px;
        font-weight: 500;
      }
      
      .skip-link:focus {
        position: static;
        left: auto;
        width: auto;
        height: auto;
        overflow: visible;
        margin: 8px;
        outline: 2px solid var(--ring);
        outline-offset: 2px;
      }
      
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    `,document.head.appendChild(n),document.body.prepend(r),()=>{document.body.contains(r)&&document.body.removeChild(r),document.head.contains(n)&&document.head.removeChild(n)}},[]),K.useEffect(()=>{const r=n=>{if(n.key==="Escape"){const l=new CustomEvent("closeAllPanels");document.dispatchEvent(l)}if(n.key==="f"&&n.ctrlKey){n.preventDefault();const l=document.querySelector('input[placeholder*="kommun"]');l&&l.focus()}};return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[]),null},xGe=()=>{const[e,t]=K.useState(""),[r,n]=K.useState(!1),[l,h]=K.useState([]),[f,o]=K.useState(-1),v=K.useRef(null),{preschools:b,setMapCenter:E,setMapZoom:P,setSelectedPreschool:O,searchTerm:L,setSearchTerm:B}=Lo();K.useEffect(()=>{const Y=localStorage.getItem("preschool-recent-searches");if(Y)try{h(JSON.parse(Y))}catch(ee){console.error("Error loading recent searches:",ee)}},[]);const z=K.useMemo(()=>{if(!e.trim())return l.slice(0,5);const Y=e.toLowerCase().trim(),ee=[],le=b.filter(Oe=>Oe.namn&&Oe.namn.toLowerCase().includes(Y)&&Oe.latitud&&Oe.longitud).slice(0,8).map(Oe=>({id:`preschool-${Oe.id}`,type:"preschool",title:Oe.namn,subtitle:`${Oe.kommun} • ${Oe.huvudman||"Okänd huvudman"}`,coordinates:[Oe.longitud,Oe.latitud],preschoolId:Oe.id}));ee.push(...le);const fe=[...new Set(b.filter(Oe=>Oe.kommun&&Oe.kommun.toLowerCase().includes(Y)&&Oe.latitud&&Oe.longitud).map(Oe=>Oe.kommun))].slice(0,5).map(Oe=>{const Me=b.filter(Le=>Le.kommun===Oe&&Le.latitud&&Le.longitud),Ke=Me.reduce((Le,Qe)=>Le+Qe.latitud,0)/Me.length,Ye=Me.reduce((Le,Qe)=>Le+Qe.longitud,0)/Me.length;return{id:`kommun-${Oe}`,type:"kommun",title:Oe,subtitle:`${Me.length} förskolor`,coordinates:[Ye,Ke]}});ee.push(...fe);const Ce=b.filter(Oe=>Oe.adress&&Oe.adress.toLowerCase().includes(Y)&&Oe.latitud&&Oe.longitud).slice(0,3).map(Oe=>({id:`address-${Oe.id}`,type:"area",title:Oe.adress,subtitle:`${Oe.kommun} • ${Oe.namn}`,coordinates:[Oe.longitud,Oe.latitud],preschoolId:Oe.id}));return ee.push(...Ce),ee.slice(0,12)},[e,b,l]),$=Y=>{t(Y),B(Y),o(-1),n(!0)},U=Y=>{t(Y.title),B(Y.title),n(!1),o(-1);const ee=[Y,...l.filter(le=>le.id!==Y.id)].slice(0,10);if(h(ee),localStorage.setItem("preschool-recent-searches",JSON.stringify(ee)),Y.coordinates)if(E(Y.coordinates),Y.type==="preschool"&&Y.preschoolId){const le=b.find(fe=>fe.id===Y.preschoolId);le&&(O(le),P(15))}else Y.type==="kommun"?P(11):P(13);v.current?.blur()},G=()=>{t(""),B(""),n(!1),o(-1)},Z=Y=>{if(r)switch(Y.key){case"ArrowDown":Y.preventDefault(),o(ee=>ee<z.length-1?ee+1:0);break;case"ArrowUp":Y.preventDefault(),o(ee=>ee>0?ee-1:z.length-1);break;case"Enter":Y.preventDefault(),f>=0&&z[f]&&U(z[f]);break;case"Escape":n(!1),o(-1);break}},ne=Y=>{switch(Y){case"preschool":return M.jsx(sm,{className:"w-4 h-4 text-blue-500"});case"kommun":return M.jsx(Ha,{className:"w-4 h-4 text-green-500"});case"area":return M.jsx(Ha,{className:"w-4 h-4 text-orange-500"});case"recent":return M.jsx(wj,{className:"w-4 h-4 text-gray-500"});default:return M.jsx(Wk,{className:"w-4 h-4 text-gray-500"})}};return M.jsxs("div",{className:"relative w-full",children:[M.jsxs("div",{className:"relative",children:[M.jsx(Wk,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),M.jsx(H3,{ref:v,type:"text",placeholder:"Sök förskola, kommun eller adress...",value:e,onChange:Y=>$(Y.target.value),onFocus:()=>n(!0),onKeyDown:Z,className:"pl-10 pr-10 bg-white/95 backdrop-blur-sm border border-border/50"}),e&&M.jsx("button",{onClick:G,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:M.jsx($l,{className:"w-4 h-4"})})]}),M.jsx(Pc,{children:r&&z.length>0&&M.jsx($r.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute top-full left-0 right-0 mt-2 z-50",children:M.jsx(Cn,{className:"bg-white/98 backdrop-blur-md border border-border/50 shadow-lg max-h-80 overflow-y-auto",children:M.jsxs("div",{className:"p-2",children:[!e.trim()&&l.length>0&&M.jsx("div",{className:"px-3 py-2 text-xs font-medium text-muted-foreground border-b border-border/30",children:"Senaste sökningar"}),z.map((Y,ee)=>M.jsxs($r.button,{onClick:()=>U(Y),className:`w-full flex items-center space-x-3 p-3 rounded-lg text-left hover:bg-accent/50 transition-colors ${f===ee?"bg-accent/70":""}`,initial:{opacity:0},animate:{opacity:1},transition:{delay:ee*.02},children:[ne(Y.type),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("div",{className:"font-medium text-sm text-foreground truncate",children:Y.title}),Y.subtitle&&M.jsx("div",{className:"text-xs text-muted-foreground truncate",children:Y.subtitle})]})]},Y.id))]})})})}),r&&M.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>n(!1)})]})},WO=768;function ere(){const[e,t]=K.useState(void 0);return K.useEffect(()=>{const r=window.matchMedia(`(max-width: ${WO-1}px)`),n=()=>{t(window.innerWidth<WO)};return r.addEventListener("change",n),t(window.innerWidth<WO),()=>r.removeEventListener("change",n)},[]),!!e}const bGe=()=>{const e=ere(),{filteredPreschools:t,selectedPreschool:r,setSelectedPreschool:n}=Lo(),[l,h]=K.useState(0),[f,o]=K.useState(!1),v=K.useRef(null),b=yX(0);if(!e||(K.useEffect(()=>{if(t.length>0&&!f){const $=setTimeout(()=>o(!0),2e3);return()=>clearTimeout($)}},[t.length,f]),t.length===0))return null;const E=t[l],P=tO(b,[-300,0,300],[.8,1,.8]),O=tO(b,[-300,0,300],[.3,1,.3]),L=($,U)=>{U.offset.x>100&&l>0?(h(l-1),n(t[l-1])):U.offset.x<-100&&l<t.length-1&&(h(l+1),n(t[l+1])),b.set(0)},B=()=>{l>0&&(h(l-1),n(t[l-1]))},z=()=>{l<t.length-1&&(h(l+1),n(t[l+1]))};return K.useEffect(()=>{if(r){const $=t.findIndex(U=>U.id===r.id);$>=0&&$!==l&&h($)}},[r,t,l]),!E||!f?null:M.jsxs(M.Fragment,{children:[M.jsx($r.button,{onClick:()=>o(!f),className:"fixed bottom-20 right-4 z-50 md:hidden bg-primary/90 text-primary-foreground p-3 rounded-full shadow-lg",whileHover:{scale:1.05},whileTap:{scale:.95},initial:{scale:0},animate:{scale:1},transition:{delay:1,duration:.3},children:M.jsx(Q4,{className:"w-5 h-5"})}),M.jsxs($r.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},className:"fixed bottom-20 left-4 right-4 z-40 md:hidden",children:[M.jsx("div",{ref:v,className:"relative",children:M.jsx($r.div,{drag:"x",dragConstraints:v,dragElastic:.1,onDragEnd:L,style:{x:b,scale:P,opacity:O},className:"cursor-grab active:cursor-grabbing",children:M.jsxs(Cn,{className:"bg-white/95 backdrop-blur-sm border border-border/50 shadow-lg p-4",children:[M.jsxs("div",{className:"flex items-center justify-between mb-3",children:[M.jsxs("div",{className:"flex items-center space-x-2",children:[M.jsx($r.button,{onClick:B,disabled:l===0,className:"p-2 rounded-full bg-primary/10 disabled:opacity-30 disabled:cursor-not-allowed",whileTap:{scale:.9},children:M.jsx(Gk,{className:"w-4 h-4"})}),M.jsxs("span",{className:"text-xs text-muted-foreground font-medium",children:[l+1," av ",t.length]}),M.jsx($r.button,{onClick:z,disabled:l===t.length-1,className:"p-2 rounded-full bg-primary/10 disabled:opacity-30 disabled:cursor-not-allowed",whileTap:{scale:.9},children:M.jsx(Hk,{className:"w-4 h-4"})})]}),M.jsx("button",{onClick:()=>o(!1),className:"text-muted-foreground hover:text-foreground p-1",children:"✕"})]}),M.jsx("div",{className:"flex justify-center space-x-1 mb-4",children:Array.from({length:Math.min(5,t.length)},($,U)=>{let G;return t.length<=5?G=U:G=Math.max(0,Math.min(t.length-5,l-2))+U,M.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-all duration-200 ${G===l?"bg-primary w-4":"bg-border"}`},G)})}),M.jsxs("div",{className:"space-y-3",children:[M.jsxs("div",{children:[M.jsx("h3",{className:"font-semibold text-foreground line-clamp-2",children:E.namn}),M.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[M.jsx(Ha,{className:"w-3 h-3 text-muted-foreground"}),M.jsx("span",{className:"text-sm text-muted-foreground line-clamp-1",children:E.kommun}),E.huvudman&&M.jsx(An,{variant:"outline",className:"text-xs",children:E.huvudman==="Kommunal"?"Kommunal":"Fristående"})]})]}),M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center space-x-4",children:[E.google_rating&&E.google_rating>0&&M.jsxs("div",{className:"flex items-center space-x-1",children:[M.jsx(ba,{className:"w-4 h-4 text-yellow-500 fill-current"}),M.jsx("span",{className:"text-sm font-medium",children:E.google_rating.toFixed(1)})]}),E.antal_barn&&E.antal_barn>0&&M.jsxs("div",{className:"flex items-center space-x-1",children:[M.jsx(km,{className:"w-4 h-4 text-blue-500"}),M.jsx("span",{className:"text-sm text-muted-foreground",children:E.antal_barn})]}),E.personal_andel_forskollararexamen&&M.jsxs(An,{variant:"secondary",className:"text-xs",children:[Math.round(E.personal_andel_forskollararexamen*100),"% lärare"]})]}),M.jsx("div",{className:"text-xs text-muted-foreground",children:"👆 Swipa"})]})]}),M.jsx($r.div,{className:"absolute inset-0 pointer-events-none rounded-lg",style:{background:tO(b,[-300,-100,0,100,300],["linear-gradient(90deg, rgba(34,197,94,0.1) 0%, transparent 100%)","linear-gradient(90deg, rgba(34,197,94,0.05) 0%, transparent 100%)","transparent","linear-gradient(270deg, rgba(59,130,246,0.05) 0%, transparent 100%)","linear-gradient(270deg, rgba(59,130,246,0.1) 0%, transparent 100%)"])}})]})})}),M.jsxs($r.div,{initial:{opacity:1},animate:{opacity:0},transition:{delay:4,duration:2},className:"absolute -top-16 left-1/2 transform -translate-x-1/2 bg-black/80 text-white px-3 py-2 rounded-full text-xs whitespace-nowrap flex items-center space-x-2",children:[M.jsx(Q4,{className:"w-3 h-3"}),M.jsx("span",{children:"Swipa för att bläddra mellan förskolor"})]})]})]})},wGe=()=>{const{preschools:e,visiblePreschools:t,filteredPreschools:r}=Lo(),[n,l]=K.useState({renderTime:0,frameRate:0,memoryUsage:0,visibleElements:0,loadTime:0,cacheHitRate:0}),[h,f]=K.useState(!1),[o,v]=K.useState(!1);K.useEffect(()=>{const P=O=>{O.ctrlKey&&O.shiftKey&&O.key==="P"&&(v(!o),console.log("🔧 Performance Dashboard toggled:",!o))};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[o]),K.useEffect(()=>{const P=()=>{const L=performance.now(),B=performance.now();t.length*.1;const z=performance.now()-B,$=(e.length*.5+t.length*.8)/1024;l({renderTime:z,frameRate:Math.max(30,60-t.length*.01),memoryUsage:$,visibleElements:t.length,loadTime:L,cacheHitRate:Math.min(95,70+t.length/e.length*25)})};P();const O=setInterval(P,1e3);return()=>clearInterval(O)},[e.length,t.length,r.length]);const E=(()=>{let P=100;return n.renderTime>16&&(P-=20),n.frameRate<30&&(P-=30),n.memoryUsage>50&&(P-=15),n.visibleElements>1e3&&(P-=10),n.cacheHitRate<80&&(P-=15),P>=90?{grade:"A+",color:"text-green-600 bg-green-100",description:"Utmärkt prestanda"}:P>=80?{grade:"A",color:"text-green-600 bg-green-100",description:"Mycket bra prestanda"}:P>=70?{grade:"B",color:"text-blue-600 bg-blue-100",description:"Bra prestanda"}:P>=60?{grade:"C",color:"text-yellow-600 bg-yellow-100",description:"Godkänd prestanda"}:P>=50?{grade:"D",color:"text-orange-600 bg-orange-100",description:"Sämre prestanda"}:{grade:"F",color:"text-red-600 bg-red-100",description:"Dålig prestanda"}})();return o?M.jsxs("div",{className:"fixed top-4 right-4 z-50",children:[M.jsx($r.button,{onClick:()=>f(!h),className:"bg-black/80 text-white p-2 rounded-lg hover:bg-black/90 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},title:"Performance Dashboard (Ctrl+Shift+P to toggle in production)",children:M.jsx(YE,{className:"w-4 h-4"})}),M.jsx(Pc,{children:h&&M.jsx($r.div,{initial:{opacity:0,scale:.9,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-20},className:"absolute top-12 right-0 w-80",children:M.jsx(Cn,{className:"p-4 bg-white/95 backdrop-blur-sm border border-border/50 shadow-xl",children:M.jsxs("div",{className:"space-y-4",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center space-x-2",children:[M.jsx(YE,{className:"w-5 h-5 text-primary"}),M.jsx("h3",{className:"font-semibold",children:"Prestanda"}),M.jsx(An,{variant:"outline",className:"text-xs",children:"PROD"})]}),M.jsx(An,{className:E.color,children:E.grade})]}),M.jsx("p",{className:"text-xs text-muted-foreground",children:E.description}),M.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[M.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[M.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[M.jsx(Ece,{className:"w-3 h-3 text-yellow-500"}),M.jsx("span",{className:"text-xs font-medium",children:"Render"})]}),M.jsxs("div",{className:"text-sm font-bold",children:[n.renderTime.toFixed(1),"ms"]}),M.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.frameRate.toFixed(0)," FPS"]})]}),M.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[M.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[M.jsx(Sj,{className:"w-3 h-3 text-blue-500"}),M.jsx("span",{className:"text-xs font-medium",children:"Minne"})]}),M.jsxs("div",{className:"text-sm font-bold",children:[n.memoryUsage.toFixed(1),"MB"]}),M.jsxs("div",{className:"text-xs text-muted-foreground",children:["~",Math.round(n.memoryUsage*1.2),"MB max"]})]}),M.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[M.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[M.jsx(Tj,{className:"w-3 h-3 text-green-500"}),M.jsx("span",{className:"text-xs font-medium",children:"Synliga"})]}),M.jsx("div",{className:"text-sm font-bold",children:n.visibleElements.toLocaleString()}),M.jsxs("div",{className:"text-xs text-muted-foreground",children:["av ",e.length.toLocaleString()]})]}),M.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[M.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[M.jsx(Om,{className:"w-3 h-3 text-purple-500"}),M.jsx("span",{className:"text-xs font-medium",children:"Cache"})]}),M.jsxs("div",{className:"text-sm font-bold",children:[n.cacheHitRate.toFixed(0),"%"]}),M.jsx("div",{className:"text-xs text-muted-foreground",children:"Träffar"})]})]}),M.jsxs("div",{className:"space-y-2",children:[M.jsx("h4",{className:"text-xs font-medium text-muted-foreground",children:"Optimeringar"}),M.jsxs("div",{className:"flex items-center justify-between text-xs",children:[M.jsx("span",{children:"Viewport Culling"}),M.jsx(An,{variant:n.visibleElements<e.length?"default":"secondary",children:n.visibleElements<e.length?"Aktiv":"Inaktiv"})]}),M.jsxs("div",{className:"flex items-center justify-between text-xs",children:[M.jsx("span",{children:"LOD System"}),M.jsx(An,{variant:"default",children:"Aktiv"})]}),M.jsxs("div",{className:"flex items-center justify-between text-xs",children:[M.jsx("span",{children:"Clustering"}),M.jsx(An,{variant:n.visibleElements>100?"default":"secondary",children:n.visibleElements>100?"Aktiv":"Inaktiv"})]}),M.jsxs("div",{className:"flex items-center justify-between text-xs",children:[M.jsx("span",{children:"Progressive Loading"}),M.jsx(An,{variant:"default",children:"Aktiv"})]})]}),n.frameRate<30&&M.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-2 rounded text-xs",children:[M.jsxs("div",{className:"flex items-center space-x-1 text-yellow-700",children:[M.jsx(wj,{className:"w-3 h-3"}),M.jsx("span",{className:"font-medium",children:"Prestandavarning"})]}),M.jsx("p",{className:"mt-1 text-yellow-600",children:"Zooma ut eller aktivera clustering för bättre prestanda"})]}),M.jsxs("div",{className:"border-t pt-3 space-y-1 text-xs text-muted-foreground",children:[M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{children:"Totalt förskolor:"}),M.jsx("span",{children:e.length.toLocaleString()})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{children:"Filtrerade:"}),M.jsx("span",{children:r.length.toLocaleString()})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{children:"I viewport:"}),M.jsx("span",{children:t.length.toLocaleString()})]})]}),M.jsx("div",{className:"bg-blue-50 border border-blue-200 p-2 rounded text-xs",children:M.jsxs("p",{className:"text-blue-600",children:["💡 Tryck ",M.jsx("kbd",{className:"bg-blue-100 px-1 rounded",children:"Ctrl+Shift+P"})," för att togglela denna dashboard"]})})]})})})})]}):null},SGe=({isOpen:e,onClose:t})=>{const{filteredPreschools:r,searchTerm:n,selectedCommune:l}=Lo(),[h,f]=K.useState("overview"),o=K.useMemo(()=>l?{type:"kommun",name:l,title:`Statistik för ${l}`}:n&&n.trim()?{type:"search",name:n.trim(),title:`Statistik för "${n.trim()}"`}:{type:"national",name:"Sverige",title:"Riksstatistik för förskolor"},[l,n]),v=K.useMemo(()=>{if(r.length===0)return null;const $=r.length,U=r.filter(Ye=>Ye.antal_barn&&Ye.antal_barn>0),G=U.reduce((Ye,Le)=>Ye+(Le.antal_barn||0),0),Z=r.filter(Ye=>Ye.antal_barngrupper&&Ye.antal_barngrupper>0),ne=Z.reduce((Ye,Le)=>Ye+(Le.antal_barngrupper||0),0),Y=U.length>0?G/U.length:0,ee=ne>0?G/ne:0,le=r.filter(Ye=>Ye.personaltäthet&&Ye.personaltäthet>0),fe=le.length>0?le.reduce((Ye,Le)=>Ye+(Le.personaltäthet||0),0)/le.length:0,Ce=r.filter(Ye=>Ye.andel_med_förskollärarexamen!=null&&Ye.andel_med_förskollärarexamen>=0),Oe=Ce.length>0?Ce.reduce((Ye,Le)=>Ye+(Le.andel_med_förskollärarexamen||0),0)/Ce.length:0,Me=r.filter(Ye=>Ye.google_rating&&Ye.google_rating>0),Ke=Me.length>0?Me.reduce((Ye,Le)=>Ye+(Le.google_rating||0),0)/Me.length:0;return{totalPreschools:$,totalChildren:G,avgChildrenPerPreschool:Math.round(Y*10)/10,avgChildrenPerGroup:Math.round(ee*10)/10,avgStaffDensity:Math.round(fe*10)/10,avgTeacherRatio:Math.round(Oe*10)/10,avgRating:Math.round(Ke*10)/10,validRatings:Me.length,validChildren:U.length,validGroups:Z.length,validStaff:le.length,validTeachers:Ce.length}},[r]),b={avgChildrenPerPreschool:55.1,avgChildrenPerGroup:16.8,avgStaffDensity:5.1,avgTeacherRatio:40.8,avgRating:4.1},E=K.useMemo(()=>v?[{label:"Barn per förskola",current:v.avgChildrenPerPreschool,national:b.avgChildrenPerPreschool,unit:"barn",trend:v.avgChildrenPerPreschool>b.avgChildrenPerPreschool?"up":v.avgChildrenPerPreschool<b.avgChildrenPerPreschool?"down":"stable",description:"Genomsnittligt antal barn per förskola"},{label:"Barn per grupp",current:v.avgChildrenPerGroup,national:b.avgChildrenPerGroup,unit:"barn",trend:v.avgChildrenPerGroup>b.avgChildrenPerGroup?"up":v.avgChildrenPerGroup<b.avgChildrenPerGroup?"down":"stable",description:"Genomsnittlig barngruppsstorlek"},{label:"Personaltäthet",current:v.avgStaffDensity,national:b.avgStaffDensity,unit:"barn/personal",trend:v.avgStaffDensity<b.avgStaffDensity?"up":v.avgStaffDensity>b.avgStaffDensity?"down":"stable",description:"Antal barn per personal (lägre är bättre)"},{label:"Förskollärare",current:v.avgTeacherRatio,national:b.avgTeacherRatio,unit:"%",trend:v.avgTeacherRatio>b.avgTeacherRatio?"up":v.avgTeacherRatio<b.avgTeacherRatio?"down":"stable",description:"Andel personal med förskollärarexamen"},{label:"Google Betyg",current:v.avgRating,national:b.avgRating,unit:"/5",trend:v.avgRating>b.avgRating?"up":v.avgRating<b.avgRating?"down":"stable",description:`Genomsnittligt Google-betyg (${v.validRatings} förskolor)`}]:[],[v,b]),P=K.useMemo(()=>{if(!v)return[];const $=[{range:"Små (1-20)",min:1,max:20,count:0},{range:"Medel (21-50)",min:21,max:50,count:0},{range:"Stora (51-100)",min:51,max:100,count:0},{range:"Mycket stora (>100)",min:101,max:9999,count:0}];return r.forEach(U=>{U.antal_barn&&$.forEach(G=>{U.antal_barn>=G.min&&U.antal_barn<=G.max&&G.count++})}),$},[r]),O=K.useMemo(()=>{const $={Kommunal:0,Privat:0,Kooperativ:0,Övrigt:0};return r.forEach(U=>{if(!U.huvudman||U.huvudman.trim()===""){$.Övrigt++;return}const G=U.huvudman.toLowerCase().trim();G.includes("kommun")||G.includes("kommun")?$.Kommunal++:G.includes("privat")||G.includes("aktiebolag")||G.includes("ab")||G.includes("enskild")||G.includes("stiftelse")||G.includes("företag")?$.Privat++:G.includes("kooperativ")||G.includes("ekonomisk förening")||G.includes("föräldra")||G.includes("kooperativ")?$.Kooperativ++:$.Övrigt++}),Object.entries($).filter(([U,G])=>G>0).map(([U,G])=>({name:U,value:G}))},[r]),L=$=>{switch($){case"up":return M.jsx(ice,{className:"w-4 h-4 text-green-500"});case"down":return M.jsx(tce,{className:"w-4 h-4 text-red-500"});default:return M.jsx(A7,{className:"w-4 h-4 text-gray-500"})}},B=($,U,G)=>{if(!$||!U||$===0||U===0)return"Ingen data";const Z=Math.abs($-U),ne=U>0?Z/U*100:0,Y=$>U;return ne<1?"≈ rikssnitt":`${Y?"+":"-"}${Z.toFixed(1)}${G} (${ne.toFixed(0)}%)`},z=["hsl(142, 76%, 36%)","hsl(200, 85%, 45%)","hsl(35, 100%, 55%)","hsl(215, 20%, 65%)"];return!e||!v?null:M.jsx(Pc,{children:M.jsx($r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",onClick:t,children:M.jsx($r.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.3},className:"fixed left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[95vw] max-w-6xl max-h-[95vh] overflow-hidden md:w-[90vw] md:max-h-[90vh]",onClick:$=>$.stopPropagation(),children:M.jsxs(Cn,{className:"h-full bg-white/95 backdrop-blur-sm border border-border/50 shadow-xl",children:[M.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border/30",children:[M.jsxs("div",{className:"flex items-center space-x-3",children:[M.jsx(Sh,{className:"w-6 h-6 text-primary"}),M.jsxs("div",{children:[M.jsx("h2",{className:"text-2xl font-bold",children:o.title}),M.jsxs("p",{className:"text-sm text-muted-foreground",children:["Visar data för ",v.totalPreschools.toLocaleString()," förskolor"]})]})]}),M.jsx(fn,{variant:"ghost",size:"sm",onClick:t,children:M.jsx($l,{className:"w-5 h-5"})})]}),M.jsx("div",{className:"flex-1 overflow-auto",children:M.jsxs(CN,{value:h,onValueChange:f,className:"w-full",children:[M.jsxs(aP,{className:"grid w-full grid-cols-3 mx-6 mt-6",children:[M.jsx(bu,{value:"overview",children:"📊 Översikt"}),M.jsx(bu,{value:"comparison",children:"📈 Jämförelse"}),M.jsx(bu,{value:"distribution",children:"📋 Fördelning"})]}),M.jsxs(wu,{value:"overview",className:"p-6 space-y-6",children:[M.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[M.jsxs(Cn,{className:"p-4",children:[M.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[M.jsx(sm,{className:"w-4 h-4 text-blue-500"}),M.jsx("span",{className:"text-sm font-medium",children:"Förskolor"})]}),M.jsx("div",{className:"text-2xl font-bold",children:v.totalPreschools.toLocaleString()}),M.jsx("div",{className:"text-xs text-muted-foreground",children:"st"})]}),M.jsxs(Cn,{className:"p-4",children:[M.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[M.jsx(km,{className:"w-4 h-4 text-green-500"}),M.jsx("span",{className:"text-sm font-medium",children:"Totalt barn"})]}),M.jsx("div",{className:"text-2xl font-bold",children:v.totalChildren.toLocaleString()}),M.jsx("div",{className:"text-xs text-muted-foreground",children:"barn"})]}),M.jsxs(Cn,{className:"p-4",children:[M.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[M.jsx(Om,{className:"w-4 h-4 text-orange-500"}),M.jsx("span",{className:"text-sm font-medium",children:"⌀ Barn/förskola"})]}),M.jsx("div",{className:"text-2xl font-bold",children:v.avgChildrenPerPreschool.toFixed(1)}),M.jsx("div",{className:"text-xs text-muted-foreground",children:"barn"})]}),M.jsxs(Cn,{className:"p-4",children:[M.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[M.jsx(ba,{className:"w-4 h-4 text-yellow-500"}),M.jsx("span",{className:"text-sm font-medium",children:"⌀ Betyg"})]}),M.jsx("div",{className:"text-2xl font-bold",children:v.avgRating>0?v.avgRating.toFixed(1):"N/A"}),M.jsx("div",{className:"text-xs text-muted-foreground",children:"/5.0"})]})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsx("h3",{className:"text-lg font-semibold",children:"Nyckeltal vs Rikssnitt"}),E.slice(0,3).map(($,U)=>M.jsx(Cn,{className:"p-4",children:M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center space-x-3",children:[L($.trend),M.jsxs("div",{children:[M.jsx("div",{className:"font-medium",children:$.label}),M.jsx("div",{className:"text-sm text-muted-foreground",children:$.description})]})]}),M.jsxs("div",{className:"text-right",children:[M.jsxs("div",{className:"text-2xl font-bold",children:[$.current.toFixed(1),$.unit]}),M.jsxs("div",{className:"text-sm text-muted-foreground",children:["Rikssnitt: ",$.national.toFixed(1),$.unit]}),M.jsx(An,{variant:"outline",className:"text-xs mt-1",children:B($.current,$.national,$.unit)})]})]})},U))]})]}),M.jsxs(wu,{value:"comparison",className:"p-6 space-y-6",children:[M.jsx("h3",{className:"text-lg font-semibold",children:"Detaljerad Jämförelse med Rikssnitt"}),E.map(($,U)=>M.jsxs(Cn,{className:"p-6",children:[M.jsxs("div",{className:"flex items-center justify-between mb-4",children:[M.jsxs("div",{className:"flex items-center space-x-3",children:[L($.trend),M.jsxs("div",{children:[M.jsx("h4",{className:"text-lg font-semibold",children:$.label}),M.jsx("p",{className:"text-sm text-muted-foreground",children:$.description})]})]}),M.jsx(An,{variant:$.trend==="up"?"default":$.trend==="down"?"destructive":"secondary",children:B($.current,$.national,$.unit)})]}),M.jsx("div",{className:"h-16",children:M.jsx(xb,{width:"100%",height:"100%",children:M.jsxs(_L,{data:[{name:o.name,value:$.current},{name:"Rikssnitt",value:$.national}],margin:{top:5,right:30,left:20,bottom:5},children:[M.jsx(W_,{dataKey:"name"}),M.jsx(Z_,{}),M.jsx(ja,{formatter:G=>[`${Number(G).toFixed(1)}${$.unit}`,""]}),M.jsx(Rh,{dataKey:"value",fill:$.trend==="up"?"#22c55e":$.trend==="down"?"#ef4444":"#94a3b8",radius:4})]})})})]},U))]}),M.jsxs(wu,{value:"distribution",className:"p-6 space-y-6",children:[M.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[M.jsxs(Cn,{className:"p-6",children:[M.jsx("h3",{className:"text-lg font-semibold mb-4",children:"📏 Förskolor per Storlek"}),M.jsx("div",{className:"h-64",children:M.jsx(xb,{width:"100%",height:"100%",children:M.jsxs(_L,{data:P,children:[M.jsx(G3,{strokeDasharray:"3 3"}),M.jsx(W_,{dataKey:"range"}),M.jsx(Z_,{}),M.jsx(ja,{}),M.jsx(Rh,{dataKey:"count",fill:"hsl(142, 76%, 36%)",radius:4})]})})})]}),M.jsxs(Cn,{className:"p-6",children:[M.jsx("h3",{className:"text-lg font-semibold mb-4",children:"🏢 Huvudmansfördelning"}),M.jsx("div",{className:"h-64",children:M.jsx(xb,{width:"100%",height:"100%",children:M.jsxs(vL,{children:[M.jsx(zh,{data:O,cx:"50%",cy:"50%",labelLine:!1,label:({name:$,percent:U})=>`${$} ${(U*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:O.map(($,U)=>M.jsx(i1,{fill:z[U%z.length]},`cell-${U}`))}),M.jsx(ja,{})]})})}),M.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:O.map(($,U)=>M.jsxs("div",{className:"flex items-center space-x-2",children:[M.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:z[U%z.length]}}),M.jsxs("span",{className:"text-sm",children:[$.name,": ",$.value]})]},$.name))})]})]}),M.jsxs(Cn,{className:"p-6",children:[M.jsx("h3",{className:"text-lg font-semibold mb-4",children:"📋 Sammanfattning av urval"}),M.jsx("div",{className:"overflow-x-auto",children:M.jsx("table",{className:"w-full text-sm",children:M.jsxs("tbody",{className:"space-y-2",children:[M.jsxs("tr",{children:[M.jsx("td",{className:"font-medium",children:"Sammanhang:"}),M.jsx("td",{children:o.title})]}),M.jsxs("tr",{children:[M.jsx("td",{className:"font-medium",children:"Antal förskolor:"}),M.jsxs("td",{children:[v.totalPreschools.toLocaleString()," st"]})]}),M.jsxs("tr",{children:[M.jsx("td",{className:"font-medium",children:"Totalt antal barn:"}),M.jsxs("td",{children:[v.totalChildren.toLocaleString()," barn"]})]}),M.jsxs("tr",{children:[M.jsx("td",{className:"font-medium",children:"Genomsnittlig förskolestorlek:"}),M.jsxs("td",{children:[v.avgChildrenPerPreschool.toFixed(1)," barn/förskola"]})]}),M.jsxs("tr",{children:[M.jsx("td",{className:"font-medium",children:"Förskolor med betyg:"}),M.jsxs("td",{children:[v.validRatings," st (",(v.validRatings/v.totalPreschools*100).toFixed(1),"%)"]})]})]})})})]})]})]})})]})})})})},TGe=()=>{const{performanceMode:e,setPerformanceMode:t}=Lo(),r=K.useRef(null);K.useEffect(()=>{const f=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),o="ontouchstart"in window,v=window.innerWidth<768;(f||o||v)&&(e==="high"&&t("medium"),n(),l(),h())},[]);const n=()=>{let f=document.querySelector('meta[name="viewport"]');f||(f=document.createElement("meta"),f.setAttribute("name","viewport"),document.head.appendChild(f)),f.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no");let o=document.querySelector('meta[name="theme-color"]');o||(o=document.createElement("meta"),o.setAttribute("name","theme-color"),o.setAttribute("content","#1f2937"),document.head.appendChild(o));let v=document.querySelector('meta[name="mobile-web-app-capable"]');v||(v=document.createElement("meta"),v.setAttribute("name","mobile-web-app-capable"),v.setAttribute("content","yes"),document.head.appendChild(v))},l=()=>{const f=document.createElement("style");f.textContent=`
      @media (max-width: 768px) {
        .mapboxgl-ctrl button {
          min-width: 44px !important;
          min-height: 44px !important;
        }
        
        .mapboxgl-popup-close-button {
          width: 30px !important;
          height: 30px !important;
          font-size: 16px !important;
        }
        
        /* Larger touch targets for UI elements */
        button, .clickable {
          min-height: 44px;
          min-width: 44px;
        }
        
        /* Improved scrolling on mobile */
        .overflow-y-auto {
          -webkit-overflow-scrolling: touch;
          overflow-scrolling: touch;
        }
        
        /* Prevent text selection on mobile */
        .map-container, .mapboxgl-map {
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: transparent;
        }
        
        /* Better mobile panels */
        .mobile-panel {
          position: fixed !important;
          bottom: 0 !important;
          left: 0 !important;
          right: 0 !important;
          top: auto !important;
          transform: none !important;
          border-radius: 16px 16px 0 0 !important;
          max-height: 70vh !important;
        }
      }
    `,document.head.appendChild(f)},h=()=>{let f=0;const o=v=>{const b=Date.now();b-f<=300&&v.preventDefault(),f=b};return document.addEventListener("touchend",o,{passive:!1}),()=>{document.removeEventListener("touchend",o)}};return K.useEffect(()=>{const f=b=>{b.touches.length===1&&(r.current={x:b.touches[0].clientX,y:b.touches[0].clientY,time:Date.now()})},o=b=>{b.touches.length>1&&b.preventDefault()},v=b=>{if(r.current&&b.changedTouches.length===1){const E={x:b.changedTouches[0].clientX,y:b.changedTouches[0].clientY,time:Date.now()},P=E.x-r.current.x,O=E.y-r.current.y,L=E.time-r.current.time;if(Math.sqrt(P*P+O*O)>50&&L<300){const z=Math.atan2(O,P)*180/Math.PI;Math.abs(z)<45?document.dispatchEvent(new CustomEvent("swipeRight")):Math.abs(z)>135?document.dispatchEvent(new CustomEvent("swipeLeft")):z>45&&z<135?document.dispatchEvent(new CustomEvent("swipeDown")):z<-45&&z>-135&&document.dispatchEvent(new CustomEvent("swipeUp"))}}r.current=null};return document.addEventListener("touchstart",f,{passive:!0}),document.addEventListener("touchmove",o,{passive:!1}),document.addEventListener("touchend",v,{passive:!0}),()=>{document.removeEventListener("touchstart",f),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",v)}},[]),null},EGe=()=>{const{preschools:e,setPreschools:t,updatePreschool:r,setLoading:n}=Lo(),l=K.useCallback(o=>{const v={id:o.new.id,namn:o.new.Namn,kommun:o.new.Kommun,adress:o.new.Adress||"",latitud:o.new.Latitud||0,longitud:o.new.Longitud||0,antal_barn:o.new["Antal barn"],huvudman:o.new.Huvudman,personaltäthet:o.new.Personaltäthet,andel_med_förskollärarexamen:o.new["Andel med förskollärarexamen"],antal_barngrupper:o.new["Antal barngrupper"]};t([...e,v]),ch.success(`Ny förskola tillagd: ${v.namn}`)},[e,t]),h=K.useCallback(o=>{const v={id:o.new.id,namn:o.new.Namn,kommun:o.new.Kommun,adress:o.new.Adress||"",latitud:o.new.Latitud||0,longitud:o.new.Longitud||0,antal_barn:o.new["Antal barn"],huvudman:o.new.Huvudman,personaltäthet:o.new.Personaltäthet,andel_med_förskollärarexamen:o.new["Andel med förskollärarexamen"],antal_barngrupper:o.new["Antal barngrupper"]},b={lat:o.old?.Latitud,lng:o.old?.Longitud},E={lat:o.new.Latitud,lng:o.new.Longitud};(b.lat===null||b.lat===0)&&E.lat!==null&&E.lat!==0?ch.success(`Koordinater tillagda för ${v.namn}!`):b.lat!==E.lat||b.lng!==E.lng?ch.info(`Koordinater uppdaterade för ${v.namn}`):ch.info(`Förskola uppdaterad: ${v.namn}`),r(v)},[r]),f=K.useCallback(o=>{const v=o.old.id,b=e.filter(E=>E.id!==v);t(b),ch.error(`Förskola borttagen: ${o.old.Namn}`)},[e,t]);return K.useEffect(()=>{const o=_n.channel("preschool_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"Förskolor"},l).on("postgres_changes",{event:"UPDATE",schema:"public",table:"Förskolor"},h).on("postgres_changes",{event:"DELETE",schema:"public",table:"Förskolor"},f).subscribe(),v=_n.channel("google_data_changes").on("postgres_changes",{event:"*",schema:"public",table:"preschool_google_data"},E=>{if(console.log("Google data update received:",E),E.eventType==="INSERT"||E.eventType==="UPDATE"){const P=E.new?.preschool_id;if(P){const L=Lo.getState().preschools.map(B=>B.id===P?{...B,google_rating:E.new?.google_rating,google_reviews_count:E.new?.google_reviews_count,google_reviews:E.new?.reviews,contact_phone:E.new?.contact_phone,website_url:E.new?.website_url,opening_hours:E.new?.opening_hours}:B);t(L)}}}).subscribe(),b=_n.channel("image_changes").on("postgres_changes",{event:"*",schema:"public",table:"preschool_images"},E=>{console.log("Image update received:",E),ch.info("Nya bilder tillgängliga")}).subscribe();return()=>{_n.removeChannel(o),_n.removeChannel(v),_n.removeChannel(b)}},[l,h,f]),{}},AGe=()=>{const e=K.useRef(!1),t=K.useRef(),r=K.useCallback(async()=>{if(!e.current){e.current=!0;try{const{data:h}=await _n.from("preschool_google_data").select("preschool_id"),f=h?.map(v=>v.preschool_id)||[],{data:o}=await _n.from("Förskolor").select('id, "Namn", "Adress", "Latitud", "Longitud"').not("Latitud","is",null).not("Longitud","is",null).not("id","in",f.length>0?f:["00000000-0000-0000-0000-000000000000"]).limit(8);if(o&&o.length>0)for(const v of o)try{await _n.functions.invoke("google-places-enricher",{body:{preschoolId:v.id,lat:v.Latitud,lng:v.Longitud,address:v.Adress,name:v.Namn}}),await new Promise(b=>setTimeout(b,3e3))}catch(b){console.error(`Silent enrichment error for ${v.id}:`,b)}}catch(h){console.error("Background enrichment error:",h)}finally{e.current=!1,t.current=setTimeout(()=>{r()},10*60*1e3)}}},[]),n=K.useCallback(()=>{t.current=setTimeout(()=>{r()},3e4)},[r]),l=K.useCallback(()=>{t.current&&clearTimeout(t.current),e.current=!1},[]);return K.useEffect(()=>()=>{l()},[l]),{startBackgroundEnrichment:n,stopBackgroundEnrichment:l,isRunning:e.current}},PGe=()=>{const[e,t]=K.useState(!0),[r,n]=K.useState(null),{setPreschools:l,setLoading:h}=Lo(),{startBackgroundEnrichment:f}=AGe();EGe();const o=async()=>{try{t(!0),h(!0),n(null);const{data:v,error:b}=await _n.from("Förskolor").select(`
          id,
          "Namn",
          "Kommun", 
          "Adress",
          "Latitud",
          "Longitud",
          "Antal barn",
          "Huvudman",
          "Personaltäthet",
          "Andel med förskollärarexamen",
          "Antal barngrupper",
          preschool_google_data (
            google_rating,
            google_reviews_count,
            reviews,
            contact_phone,
            website_url,
            opening_hours
          )
        `);if(b)throw b;const E=(v||[]).map(O=>({id:O.id,namn:O.Namn,kommun:O.Kommun,adress:O.Adress||"",latitud:O.Latitud!==null?O.Latitud:null,longitud:O.Longitud!==null?O.Longitud:null,antal_barn:O["Antal barn"],huvudman:O.Huvudman,personaltäthet:O.Personaltäthet,andel_med_förskollärarexamen:O["Andel med förskollärarexamen"],antal_barngrupper:O["Antal barngrupper"],google_rating:O.preschool_google_data?.[0]?.google_rating,google_reviews_count:O.preschool_google_data?.[0]?.google_reviews_count,google_reviews:O.preschool_google_data?.[0]?.reviews,contact_phone:O.preschool_google_data?.[0]?.contact_phone,website_url:O.preschool_google_data?.[0]?.website_url,opening_hours:O.preschool_google_data?.[0]?.opening_hours})),P=E.filter(O=>O.latitud===null||O.longitud===null||O.latitud===0||O.longitud===0);if(P.length>0){console.log(`Found ${P.length} preschools needing geocoding. Triggering background processing...`);const O=P.map(L=>({id:L.id,Namn:L.namn,Adress:L.adress,Kommun:L.kommun,Latitud:L.latitud,Longitud:L.longitud}));_n.functions.invoke("geocoding-service",{body:{preschools:O.slice(0,25)}}).then(L=>{console.log("Geocoding service response:",L)}).catch(L=>{console.error("Geocoding service error:",L)})}console.log(`🗺️ Setting ${E.length} preschools in store for map display`),l(E),console.log(`✅ Successfully loaded and displayed ${E.length} preschools on map`),f()}catch(v){console.error("Error fetching preschools:",v),n(v instanceof Error?v.message:"An error occurred")}finally{t(!1),h(!1)}};return K.useEffect(()=>{console.log("🚀 Starting immediate preschool data fetch during loading animation..."),o()},[]),{isLoading:e,error:r,refetch:o}},CGe="/sweden-preschool-spotlight/assets/preschool-icon-DeZlZPNS.jpg";K.lazy(()=>iv(()=>Promise.resolve().then(()=>yGe),void 0).then(e=>({default:e.PreschoolDetailsPanel})));const IGe=()=>{const{isLoading:e,error:t}=PGe(),{searchBoxCollapsed:r,setSearchBoxCollapsed:n}=Lo(),{selectedPreschools:l,setIsOpen:h}=fP(),f=ere(),[o,v]=K.useState(!0),[b,E]=K.useState(!1),[P,O]=K.useState(!1),[L,B]=K.useState(!1),z=()=>{v(!1),E(!0)},$=r;return t?M.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-secondary/20",children:M.jsxs("div",{className:"text-center",children:[M.jsx("h1",{className:"text-2xl font-bold text-destructive mb-2",children:"Ett fel uppstod"}),M.jsx("p",{className:"text-muted-foreground",children:t})]})}):M.jsx(H0e,{children:M.jsxs(HX,{children:[M.jsx(vGe,{}),M.jsx(TGe,{}),o&&M.jsx(mwe,{onComplete:z}),M.jsxs($r.div,{className:"min-h-screen bg-gradient-to-br from-background via-background to-secondary/10",id:"main-content",initial:{opacity:0},animate:{opacity:o?0:1},transition:{delay:0,duration:.6,ease:"easeOut"},children:[M.jsx($r.header,{initial:{opacity:0,y:-15},animate:{opacity:o?0:1,y:0},transition:{delay:0,duration:.4,ease:"easeOut"},className:"relative z-40 bg-white border-b border-border/10",children:M.jsx("div",{className:"container mx-auto px-6 md:px-8 py-4 md:py-6",children:M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center space-x-3 md:space-x-5",children:[M.jsx($r.img,{src:CGe,alt:"Sveriges Förskolor",className:"w-10 h-10 md:w-14 md:h-14 rounded-2xl shadow-lg hover-lift",whileHover:{scale:1.05},transition:{duration:.2}}),M.jsxs("div",{children:[M.jsx("h1",{className:"text-xl md:text-4xl font-bold text-gradient font-heading leading-tight",children:"Förskolor i Sverige"}),M.jsx("p",{className:"text-sm md:text-base text-muted-foreground font-medium mt-1 md:mt-2 hidden sm:block",children:"Hitta och jämför förskolor – i hela landet"})]})]}),M.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[M.jsxs(fn,{variant:"outline",size:"lg",className:"items-center gap-3 glass-effect hover-glow-subtle relative border-0 font-semibold",onClick:()=>B(!0),children:[M.jsx(Sh,{className:"w-5 h-5"}),"Statistik"]}),M.jsxs(fn,{variant:"outline",size:"lg",className:"items-center gap-3 glass-effect hover-glow-subtle relative border-0 font-semibold",onClick:()=>h(!0),children:[M.jsx(dce,{className:"w-5 h-5"}),"Jämför",l.length>0&&M.jsx(An,{variant:"secondary",className:"absolute -top-2 -right-2 h-6 w-6 p-0 text-sm flex items-center justify-center bg-primary text-primary-foreground",children:l.length})]})]})]})})}),M.jsxs("div",{className:`relative ${f?"pb-16":""}`,children:[!f&&M.jsx($r.div,{initial:{opacity:0,x:-20,scale:.95},animate:{opacity:o?0:1,x:0,scale:1},transition:{delay:0,duration:.3,ease:"easeOut"},className:"absolute left-6 top-6 z-30",children:M.jsx(hU,{children:M.jsx(dU,{children:M.jsx(xGe,{})})})}),M.jsx($r.div,{initial:{opacity:0,x:20,scale:.95},animate:{opacity:o?0:1,x:0,scale:1},transition:{delay:.1,duration:.3,ease:"easeOut"},children:M.jsx(hU,{children:M.jsx(dU,{children:M.jsx(_Ge,{})})})}),M.jsx($r.div,{className:`${f?"h-[calc(100vh-64px)]":"h-screen"}`,initial:{opacity:0},animate:{opacity:o?0:1},transition:{delay:.2,duration:.4,ease:"easeOut"},children:M.jsxs(gwe,{isMapVisible:b,children:[M.jsx(U0e,{className:"w-full h-full"}),M.jsx(hwe,{}),M.jsx(dwe,{})]})}),$&&M.jsx("button",{onClick:()=>n(!1),className:"absolute top-4 left-4 z-50 bg-card/95 backdrop-blur-lg shadow-nordic border-border/50 rounded-lg px-3 py-2 text-sm font-medium hover:bg-accent transition-colors",children:"🔍 Sök förskolor"}),M.jsx(uwe,{isOpen:P,onClose:()=>O(!1)}),M.jsx(_we,{}),M.jsx(kwe,{}),M.jsx(SGe,{isOpen:L,onClose:()=>B(!1)}),M.jsx(cGe,{}),M.jsx(wGe,{}),f&&M.jsx(Fwe,{}),f&&M.jsx($r.div,{initial:{opacity:0,y:15},animate:{opacity:o?0:1,y:0},transition:{delay:.3,duration:.3},className:"fixed bottom-20 left-4 z-40 md:hidden",children:M.jsx(fn,{variant:"outline",size:"sm",className:"glass-effect hover-glow-subtle border-0 p-3 rounded-full shadow-lg",onClick:()=>B(!0),children:M.jsx(Sh,{className:"w-5 h-5"})})}),M.jsx(bGe,{}),M.jsx($r.div,{initial:{opacity:0,y:15,scale:.9},animate:{opacity:o?0:1,y:0,scale:1},transition:{delay:.4,duration:.3,ease:"easeOut"},className:"fixed bottom-6 right-6 z-40",children:M.jsx(ywe,{onClick:()=>O(!0),variant:"outline",size:"lg",className:"glass-effect hover-glow-subtle border-0 p-4 rounded-2xl shadow-nordic",children:M.jsx(Ej,{className:"w-6 h-6"})})}),e&&!o&&M.jsx($r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-background/80 backdrop-blur-lg flex items-center justify-center z-50",children:M.jsxs("div",{className:"text-center",children:[M.jsx($r.div,{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4",animate:{rotate:360},transition:{duration:.8,repeat:1/0,ease:"linear"}}),M.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Laddar Sveriges förskolor..."}),M.jsx("p",{className:"text-muted-foreground",children:"Hämtar data från Supabase-databasen"})]})})]})]})]})})},MGe=()=>{const e=D9();return K.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),M.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:M.jsxs("div",{className:"text-center",children:[M.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),M.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),M.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},OGe=new Gde,kGe=()=>M.jsx(Wde,{client:OGe,children:M.jsxs(xde,{children:[M.jsx(aue,{}),M.jsx(Lue,{}),M.jsx(Rfe,{basename:"/sweden-preschool-spotlight",children:M.jsxs(Mfe,{children:[M.jsx(rR,{path:"/",element:M.jsx(IGe,{})}),M.jsx(rR,{path:"*",element:M.jsx(MGe,{})})]})})]})});Zq(document.getElementById("root")).render(M.jsx(kGe,{}));
