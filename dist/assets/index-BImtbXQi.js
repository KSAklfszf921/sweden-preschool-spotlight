(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const h of c)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function r(c){const h={};return c.integrity&&(h.integrity=c.integrity),c.referrerPolicy&&(h.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?h.credentials="include":c.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function n(c){if(c.ep)return;c.ep=!0;const h=r(c);fetch(c.href,h)}})();var sae=Object.defineProperty,iH=e=>{throw TypeError(e)},lae=(e,t,r)=>t in e?sae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ab=(e,t,r)=>lae(e,typeof t!="symbol"?t+"":t,r),FD=(e,t,r)=>t.has(e)||iH("Cannot "+r),Xt=(e,t,r)=>(FD(e,t,"read from private field"),r?r.call(e):t.get(e)),Ai=(e,t,r)=>t.has(e)?iH("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Bn=(e,t,r,n)=>(FD(e,t,"write to private field"),t.set(e,r),r),ps=(e,t,r)=>(FD(e,t,"access private method"),r),iO=(e,t,r,n)=>({set _(c){Bn(e,t,c)},get _(){return Xt(e,t,n)}});function cae(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const c in n)if(c!=="default"&&!(c in e)){const h=Object.getOwnPropertyDescriptor(n,c);h&&Object.defineProperty(e,c,h.get?h:{enumerable:!0,get:()=>n[c]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=t(n);fetch(n.href,c)}})();var za=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ki(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function uae(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var c=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,c.get?c:{enumerable:!0,get:function(){return e[n]}})}),r}var oH={exports:{}},AA={},aH={exports:{}},si={};/**
* @license React
* react.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var Uw=Symbol.for("react.element"),hae=Symbol.for("react.portal"),dae=Symbol.for("react.fragment"),fae=Symbol.for("react.strict_mode"),pae=Symbol.for("react.profiler"),mae=Symbol.for("react.provider"),gae=Symbol.for("react.context"),yae=Symbol.for("react.forward_ref"),_ae=Symbol.for("react.suspense"),vae=Symbol.for("react.memo"),xae=Symbol.for("react.lazy"),r4=Symbol.iterator;function bae(e){return e===null||typeof e!="object"?null:(e=r4&&e[r4]||e["@@iterator"],typeof e=="function"?e:null)}var sH={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},lH=Object.assign,cH={};function Z_(e,t,r){this.props=e,this.context=t,this.refs=cH,this.updater=r||sH}Z_.prototype.isReactComponent={};Z_.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Z_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function uH(){}uH.prototype=Z_.prototype;function BD(e,t,r){this.props=e,this.context=t,this.refs=cH,this.updater=r||sH}var UD=BD.prototype=new uH;UD.constructor=BD;lH(UD,Z_.prototype);UD.isPureReactComponent=!0;var n4=Array.isArray,hH=Object.prototype.hasOwnProperty,VD={current:null},dH={key:!0,ref:!0,__self:!0,__source:!0};function fH(e,t,r){var n,c={},h=null,p=null;if(t!=null)for(n in t.ref!==void 0&&(p=t.ref),t.key!==void 0&&(h=""+t.key),t)hH.call(t,n)&&!dH.hasOwnProperty(n)&&(c[n]=t[n]);var o=arguments.length-2;if(o===1)c.children=r;else if(1<o){for(var v=Array(o),w=0;w<o;w++)v[w]=arguments[w+2];c.children=v}if(e&&e.defaultProps)for(n in o=e.defaultProps,o)c[n]===void 0&&(c[n]=o[n]);return{$$typeof:Uw,type:e,key:h,ref:p,props:c,_owner:VD.current}}function wae(e,t){return{$$typeof:Uw,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function $D(e){return typeof e=="object"&&e!==null&&e.$$typeof===Uw}function Sae(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var i4=/\/+/g;function _M(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Sae(""+e.key):t.toString(36)}function u2(e,t,r,n,c){var h=typeof e;(h==="undefined"||h==="boolean")&&(e=null);var p=!1;if(e===null)p=!0;else switch(h){case"string":case"number":p=!0;break;case"object":switch(e.$$typeof){case Uw:case hae:p=!0}}if(p)return p=e,c=c(p),e=n===""?"."+_M(p,0):n,n4(c)?(r="",e!=null&&(r=e.replace(i4,"$&/")+"/"),u2(c,t,r,"",function(w){return w})):c!=null&&($D(c)&&(c=wae(c,r+(!c.key||p&&p.key===c.key?"":(""+c.key).replace(i4,"$&/")+"/")+e)),t.push(c)),1;if(p=0,n=n===""?".":n+":",n4(e))for(var o=0;o<e.length;o++){h=e[o];var v=n+_M(h,o);p+=u2(h,t,r,v,c)}else if(v=bae(e),typeof v=="function")for(e=v.call(e),o=0;!(h=e.next()).done;)h=h.value,v=n+_M(h,o++),p+=u2(h,t,r,v,c);else if(h==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return p}function dT(e,t,r){if(e==null)return e;var n=[],c=0;return u2(e,n,"","",function(h){return t.call(r,h,c++)}),n}function Tae(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ws={current:null},h2={transition:null},Eae={ReactCurrentDispatcher:ws,ReactCurrentBatchConfig:h2,ReactCurrentOwner:VD};function pH(){throw Error("act(...) is not supported in production builds of React.")}si.Children={map:dT,forEach:function(e,t,r){dT(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return dT(e,function(){t++}),t},toArray:function(e){return dT(e,function(t){return t})||[]},only:function(e){if(!$D(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};si.Component=Z_;si.Fragment=dae;si.Profiler=pae;si.PureComponent=BD;si.StrictMode=fae;si.Suspense=_ae;si.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Eae;si.act=pH;si.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=lH({},e.props),c=e.key,h=e.ref,p=e._owner;if(t!=null){if(t.ref!==void 0&&(h=t.ref,p=VD.current),t.key!==void 0&&(c=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(v in t)hH.call(t,v)&&!dH.hasOwnProperty(v)&&(n[v]=t[v]===void 0&&o!==void 0?o[v]:t[v])}var v=arguments.length-2;if(v===1)n.children=r;else if(1<v){o=Array(v);for(var w=0;w<v;w++)o[w]=arguments[w+2];n.children=o}return{$$typeof:Uw,type:e.type,key:c,ref:h,props:n,_owner:p}};si.createContext=function(e){return e={$$typeof:gae,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:mae,_context:e},e.Consumer=e};si.createElement=fH;si.createFactory=function(e){var t=fH.bind(null,e);return t.type=e,t};si.createRef=function(){return{current:null}};si.forwardRef=function(e){return{$$typeof:yae,render:e}};si.isValidElement=$D;si.lazy=function(e){return{$$typeof:xae,_payload:{_status:-1,_result:e},_init:Tae}};si.memo=function(e,t){return{$$typeof:vae,type:e,compare:t===void 0?null:t}};si.startTransition=function(e){var t=h2.transition;h2.transition={};try{e()}finally{h2.transition=t}};si.unstable_act=pH;si.useCallback=function(e,t){return ws.current.useCallback(e,t)};si.useContext=function(e){return ws.current.useContext(e)};si.useDebugValue=function(){};si.useDeferredValue=function(e){return ws.current.useDeferredValue(e)};si.useEffect=function(e,t){return ws.current.useEffect(e,t)};si.useId=function(){return ws.current.useId()};si.useImperativeHandle=function(e,t,r){return ws.current.useImperativeHandle(e,t,r)};si.useInsertionEffect=function(e,t){return ws.current.useInsertionEffect(e,t)};si.useLayoutEffect=function(e,t){return ws.current.useLayoutEffect(e,t)};si.useMemo=function(e,t){return ws.current.useMemo(e,t)};si.useReducer=function(e,t,r){return ws.current.useReducer(e,t,r)};si.useRef=function(e){return ws.current.useRef(e)};si.useState=function(e){return ws.current.useState(e)};si.useSyncExternalStore=function(e,t,r){return ws.current.useSyncExternalStore(e,t,r)};si.useTransition=function(){return ws.current.useTransition()};si.version="18.3.1";aH.exports=si;var Z=aH.exports;const Ne=ki(Z),GD=cae({__proto__:null,default:Ne},[Z]);/**
* @license React
* react-jsx-runtime.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var Aae=Z,kae=Symbol.for("react.element"),Cae=Symbol.for("react.fragment"),Pae=Object.prototype.hasOwnProperty,Mae=Aae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Iae={key:!0,ref:!0,__self:!0,__source:!0};function mH(e,t,r){var n,c={},h=null,p=null;r!==void 0&&(h=""+r),t.key!==void 0&&(h=""+t.key),t.ref!==void 0&&(p=t.ref);for(n in t)Pae.call(t,n)&&!Iae.hasOwnProperty(n)&&(c[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)c[n]===void 0&&(c[n]=t[n]);return{$$typeof:kae,type:e,key:h,ref:p,props:c,_owner:Mae.current}}AA.Fragment=Cae;AA.jsx=mH;AA.jsxs=mH;oH.exports=AA;var C=oH.exports,gH={exports:{}},ml={},yH={exports:{}},_H={};/**
* @license React
* scheduler.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/(function(e){function t(rt,ht){var vt=rt.length;rt.push(ht);e:for(;0<vt;){var mt=vt-1>>>1,ct=rt[mt];if(0<c(ct,ht))rt[mt]=ht,rt[vt]=ct,vt=mt;else break e}}function r(rt){return rt.length===0?null:rt[0]}function n(rt){if(rt.length===0)return null;var ht=rt[0],vt=rt.pop();if(vt!==ht){rt[0]=vt;e:for(var mt=0,ct=rt.length,Vt=ct>>>1;mt<Vt;){var xr=2*(mt+1)-1,tn=rt[xr],Er=xr+1,Ft=rt[Er];if(0>c(tn,vt))Er<ct&&0>c(Ft,tn)?(rt[mt]=Ft,rt[Er]=vt,mt=Er):(rt[mt]=tn,rt[xr]=vt,mt=xr);else if(Er<ct&&0>c(Ft,vt))rt[mt]=Ft,rt[Er]=vt,mt=Er;else break e}}return ht}function c(rt,ht){var vt=rt.sortIndex-ht.sortIndex;return vt!==0?vt:rt.id-ht.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;e.unstable_now=function(){return h.now()}}else{var p=Date,o=p.now();e.unstable_now=function(){return p.now()-o}}var v=[],w=[],T=1,M=null,O=3,D=!1,B=!1,N=!1,G=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(rt){for(var ht=r(w);ht!==null;){if(ht.callback===null)n(w);else if(ht.startTime<=rt)n(w),ht.sortIndex=ht.expirationTime,t(v,ht);else break;ht=r(w)}}function Y(rt){if(N=!1,X(rt),!B)if(r(v)!==null)B=!0,He(ne);else{var ht=r(w);ht!==null&&lt(Y,ht.startTime-rt)}}function ne(rt,ht){B=!1,N&&(N=!1,V(ge),ge=-1),D=!0;var vt=O;try{for(X(ht),M=r(v);M!==null&&(!(M.expirationTime>ht)||rt&&!Ce());){var mt=M.callback;if(typeof mt=="function"){M.callback=null,O=M.priorityLevel;var ct=mt(M.expirationTime<=ht);ht=e.unstable_now(),typeof ct=="function"?M.callback=ct:M===r(v)&&n(v),X(ht)}else n(v);M=r(v)}if(M!==null)var Vt=!0;else{var xr=r(w);xr!==null&&lt(Y,xr.startTime-ht),Vt=!1}return Vt}finally{M=null,O=vt,D=!1}}var se=!1,le=null,ge=-1,je=5,ze=-1;function Ce(){return!(e.unstable_now()-ze<je)}function Ke(){if(le!==null){var rt=e.unstable_now();ze=rt;var ht=!0;try{ht=le(!0,rt)}finally{ht?Ye():(se=!1,le=null)}}else se=!1}var Ye;if(typeof U=="function")Ye=function(){U(Ke)};else if(typeof MessageChannel<"u"){var Oe=new MessageChannel,tt=Oe.port2;Oe.port1.onmessage=Ke,Ye=function(){tt.postMessage(null)}}else Ye=function(){G(Ke,0)};function He(rt){le=rt,se||(se=!0,Ye())}function lt(rt,ht){ge=G(function(){rt(e.unstable_now())},ht)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(rt){rt.callback=null},e.unstable_continueExecution=function(){B||D||(B=!0,He(ne))},e.unstable_forceFrameRate=function(rt){0>rt||125<rt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):je=0<rt?Math.floor(1e3/rt):5},e.unstable_getCurrentPriorityLevel=function(){return O},e.unstable_getFirstCallbackNode=function(){return r(v)},e.unstable_next=function(rt){switch(O){case 1:case 2:case 3:var ht=3;break;default:ht=O}var vt=O;O=ht;try{return rt()}finally{O=vt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(rt,ht){switch(rt){case 1:case 2:case 3:case 4:case 5:break;default:rt=3}var vt=O;O=rt;try{return ht()}finally{O=vt}},e.unstable_scheduleCallback=function(rt,ht,vt){var mt=e.unstable_now();switch(typeof vt=="object"&&vt!==null?(vt=vt.delay,vt=typeof vt=="number"&&0<vt?mt+vt:mt):vt=mt,rt){case 1:var ct=-1;break;case 2:ct=250;break;case 5:ct=1073741823;break;case 4:ct=1e4;break;default:ct=5e3}return ct=vt+ct,rt={id:T++,callback:ht,priorityLevel:rt,startTime:vt,expirationTime:ct,sortIndex:-1},vt>mt?(rt.sortIndex=vt,t(w,rt),r(v)===null&&rt===r(w)&&(N?(V(ge),ge=-1):N=!0,lt(Y,vt-mt))):(rt.sortIndex=ct,t(v,rt),B||D||(B=!0,He(ne))),rt},e.unstable_shouldYield=Ce,e.unstable_wrapCallback=function(rt){var ht=O;return function(){var vt=O;O=ht;try{return rt.apply(this,arguments)}finally{O=vt}}}})(_H);yH.exports=_H;var Oae=yH.exports;/**
* @license React
* react-dom.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var jae=Z,pl=Oae;function cr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var vH=new Set,Ob={};function Mm(e,t){c_(e,t),c_(e+"Capture",t)}function c_(e,t){for(Ob[e]=t,e=0;e<t.length;e++)vH.add(t[e])}var wh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),oO=Object.prototype.hasOwnProperty,Rae=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,o4={},a4={};function Dae(e){return oO.call(a4,e)?!0:oO.call(o4,e)?!1:Rae.test(e)?a4[e]=!0:(o4[e]=!0,!1)}function Lae(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function zae(e,t,r,n){if(t===null||typeof t>"u"||Lae(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ss(e,t,r,n,c,h,p){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=c,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=h,this.removeEmptyString=p}var Fa={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Fa[e]=new Ss(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Fa[t]=new Ss(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Fa[e]=new Ss(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Fa[e]=new Ss(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Fa[e]=new Ss(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Fa[e]=new Ss(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Fa[e]=new Ss(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Fa[e]=new Ss(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Fa[e]=new Ss(e,5,!1,e.toLowerCase(),null,!1,!1)});var qD=/[\-:]([a-z])/g;function HD(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(qD,HD);Fa[t]=new Ss(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(qD,HD);Fa[t]=new Ss(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(qD,HD);Fa[t]=new Ss(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Fa[e]=new Ss(e,1,!1,e.toLowerCase(),null,!1,!1)});Fa.xlinkHref=new Ss("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Fa[e]=new Ss(e,1,!1,e.toLowerCase(),null,!0,!0)});function WD(e,t,r,n){var c=Fa.hasOwnProperty(t)?Fa[t]:null;(c!==null?c.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(zae(t,r,c,n)&&(r=null),n||c===null?Dae(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):c.mustUseProperty?e[c.propertyName]=r===null?c.type===3?!1:"":r:(t=c.attributeName,n=c.attributeNamespace,r===null?e.removeAttribute(t):(c=c.type,r=c===3||c===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Nh=jae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,fT=Symbol.for("react.element"),Ty=Symbol.for("react.portal"),Ey=Symbol.for("react.fragment"),ZD=Symbol.for("react.strict_mode"),aO=Symbol.for("react.profiler"),xH=Symbol.for("react.provider"),bH=Symbol.for("react.context"),KD=Symbol.for("react.forward_ref"),sO=Symbol.for("react.suspense"),lO=Symbol.for("react.suspense_list"),XD=Symbol.for("react.memo"),$d=Symbol.for("react.lazy"),wH=Symbol.for("react.offscreen"),s4=Symbol.iterator;function _x(e){return e===null||typeof e!="object"?null:(e=s4&&e[s4]||e["@@iterator"],typeof e=="function"?e:null)}var _o=Object.assign,vM;function Yx(e){if(vM===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);vM=t&&t[1]||""}return`
`+vM+e}var xM=!1;function bM(e,t){if(!e||xM)return"";xM=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(w){var n=w}Reflect.construct(e,[],t)}else{try{t.call()}catch(w){n=w}e.call(t.prototype)}else{try{throw Error()}catch(w){n=w}e()}}catch(w){if(w&&n&&typeof w.stack=="string"){for(var c=w.stack.split(`
`),h=n.stack.split(`
`),p=c.length-1,o=h.length-1;1<=p&&0<=o&&c[p]!==h[o];)o--;for(;1<=p&&0<=o;p--,o--)if(c[p]!==h[o]){if(p!==1||o!==1)do if(p--,o--,0>o||c[p]!==h[o]){var v=`
`+c[p].replace(" at new "," at ");return e.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",e.displayName)),v}while(1<=p&&0<=o);break}}}finally{xM=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Yx(e):""}function Nae(e){switch(e.tag){case 5:return Yx(e.type);case 16:return Yx("Lazy");case 13:return Yx("Suspense");case 19:return Yx("SuspenseList");case 0:case 2:case 15:return e=bM(e.type,!1),e;case 11:return e=bM(e.type.render,!1),e;case 1:return e=bM(e.type,!0),e;default:return""}}function cO(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Ey:return"Fragment";case Ty:return"Portal";case aO:return"Profiler";case ZD:return"StrictMode";case sO:return"Suspense";case lO:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case bH:return(e.displayName||"Context")+".Consumer";case xH:return(e._context.displayName||"Context")+".Provider";case KD:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case XD:return t=e.displayName||null,t!==null?t:cO(e.type)||"Memo";case $d:t=e._payload,e=e._init;try{return cO(e(t))}catch{}}return null}function Fae(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cO(t);case 8:return t===ZD?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function pf(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function SH(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Bae(e){var t=SH(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,h=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(p){n=""+p,h.call(this,p)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(p){n=""+p},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function pT(e){e._valueTracker||(e._valueTracker=Bae(e))}function TH(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=SH(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function R2(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function uO(e,t){var r=t.checked;return _o({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function l4(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=pf(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function EH(e,t){t=t.checked,t!=null&&WD(e,"checked",t,!1)}function hO(e,t){EH(e,t);var r=pf(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?dO(e,t.type,r):t.hasOwnProperty("defaultValue")&&dO(e,t.type,pf(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function c4(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function dO(e,t,r){(t!=="number"||R2(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Jx=Array.isArray;function Hy(e,t,r,n){if(e=e.options,t){t={};for(var c=0;c<r.length;c++)t["$"+r[c]]=!0;for(r=0;r<e.length;r++)c=t.hasOwnProperty("$"+e[r].value),e[r].selected!==c&&(e[r].selected=c),c&&n&&(e[r].defaultSelected=!0)}else{for(r=""+pf(r),t=null,c=0;c<e.length;c++){if(e[c].value===r){e[c].selected=!0,n&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function fO(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(cr(91));return _o({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function u4(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(cr(92));if(Jx(r)){if(1<r.length)throw Error(cr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:pf(r)}}function AH(e,t){var r=pf(t.value),n=pf(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function h4(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function kH(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pO(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?kH(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mT,CH=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,c){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,c)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(mT=mT||document.createElement("div"),mT.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=mT.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function jb(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var sb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Uae=["Webkit","ms","Moz","O"];Object.keys(sb).forEach(function(e){Uae.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),sb[t]=sb[e]})});function PH(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||sb.hasOwnProperty(e)&&sb[e]?(""+t).trim():t+"px"}function MH(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,c=PH(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,c):e[r]=c}}var Vae=_o({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mO(e,t){if(t){if(Vae[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(cr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(cr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(cr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(cr(62))}}function gO(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yO=null;function YD(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var _O=null,Wy=null,Zy=null;function d4(e){if(e=Gw(e)){if(typeof _O!="function")throw Error(cr(280));var t=e.stateNode;t&&(t=IA(t),_O(e.stateNode,e.type,t))}}function IH(e){Wy?Zy?Zy.push(e):Zy=[e]:Wy=e}function OH(){if(Wy){var e=Wy,t=Zy;if(Zy=Wy=null,d4(e),t)for(e=0;e<t.length;e++)d4(t[e])}}function jH(e,t){return e(t)}function RH(){}var wM=!1;function DH(e,t,r){if(wM)return e(t,r);wM=!0;try{return jH(e,t,r)}finally{wM=!1,(Wy!==null||Zy!==null)&&(RH(),OH())}}function Rb(e,t){var r=e.stateNode;if(r===null)return null;var n=IA(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(cr(231,t,typeof r));return r}var vO=!1;if(wh)try{var vx={};Object.defineProperty(vx,"passive",{get:function(){vO=!0}}),window.addEventListener("test",vx,vx),window.removeEventListener("test",vx,vx)}catch{vO=!1}function $ae(e,t,r,n,c,h,p,o,v){var w=Array.prototype.slice.call(arguments,3);try{t.apply(r,w)}catch(T){this.onError(T)}}var lb=!1,D2=null,L2=!1,xO=null,Gae={onError:function(e){lb=!0,D2=e}};function qae(e,t,r,n,c,h,p,o,v){lb=!1,D2=null,$ae.apply(Gae,arguments)}function Hae(e,t,r,n,c,h,p,o,v){if(qae.apply(this,arguments),lb){if(lb){var w=D2;lb=!1,D2=null}else throw Error(cr(198));L2||(L2=!0,xO=w)}}function Im(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function LH(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function f4(e){if(Im(e)!==e)throw Error(cr(188))}function Wae(e){var t=e.alternate;if(!t){if(t=Im(e),t===null)throw Error(cr(188));return t!==e?null:e}for(var r=e,n=t;;){var c=r.return;if(c===null)break;var h=c.alternate;if(h===null){if(n=c.return,n!==null){r=n;continue}break}if(c.child===h.child){for(h=c.child;h;){if(h===r)return f4(c),e;if(h===n)return f4(c),t;h=h.sibling}throw Error(cr(188))}if(r.return!==n.return)r=c,n=h;else{for(var p=!1,o=c.child;o;){if(o===r){p=!0,r=c,n=h;break}if(o===n){p=!0,n=c,r=h;break}o=o.sibling}if(!p){for(o=h.child;o;){if(o===r){p=!0,r=h,n=c;break}if(o===n){p=!0,n=h,r=c;break}o=o.sibling}if(!p)throw Error(cr(189))}}if(r.alternate!==n)throw Error(cr(190))}if(r.tag!==3)throw Error(cr(188));return r.stateNode.current===r?e:t}function zH(e){return e=Wae(e),e!==null?NH(e):null}function NH(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=NH(e);if(t!==null)return t;e=e.sibling}return null}var FH=pl.unstable_scheduleCallback,p4=pl.unstable_cancelCallback,Zae=pl.unstable_shouldYield,Kae=pl.unstable_requestPaint,Ro=pl.unstable_now,Xae=pl.unstable_getCurrentPriorityLevel,JD=pl.unstable_ImmediatePriority,BH=pl.unstable_UserBlockingPriority,z2=pl.unstable_NormalPriority,Yae=pl.unstable_LowPriority,UH=pl.unstable_IdlePriority,kA=null,yu=null;function Jae(e){if(yu&&typeof yu.onCommitFiberRoot=="function")try{yu.onCommitFiberRoot(kA,e,void 0,(e.current.flags&128)===128)}catch{}}var gc=Math.clz32?Math.clz32:tse,Qae=Math.log,ese=Math.LN2;function tse(e){return e>>>=0,e===0?32:31-(Qae(e)/ese|0)|0}var gT=64,yT=4194304;function Qx(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function N2(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,c=e.suspendedLanes,h=e.pingedLanes,p=r&268435455;if(p!==0){var o=p&~c;o!==0?n=Qx(o):(h&=p,h!==0&&(n=Qx(h)))}else p=r&~c,p!==0?n=Qx(p):h!==0&&(n=Qx(h));if(n===0)return 0;if(t!==0&&t!==n&&!(t&c)&&(c=n&-n,h=t&-t,c>=h||c===16&&(h&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-gc(t),c=1<<r,n|=e[r],t&=~c;return n}function rse(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nse(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,c=e.expirationTimes,h=e.pendingLanes;0<h;){var p=31-gc(h),o=1<<p,v=c[p];v===-1?(!(o&r)||o&n)&&(c[p]=rse(o,t)):v<=t&&(e.expiredLanes|=o),h&=~o}}function bO(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function VH(){var e=gT;return gT<<=1,!(gT&4194240)&&(gT=64),e}function SM(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Vw(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-gc(t),e[t]=r}function ise(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var c=31-gc(r),h=1<<c;t[c]=0,n[c]=-1,e[c]=-1,r&=~h}}function QD(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-gc(r),c=1<<n;c&t|e[n]&t&&(e[n]|=t),r&=~c}}var zi=0;function $H(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var GH,eL,qH,HH,WH,wO=!1,_T=[],rf=null,nf=null,of=null,Db=new Map,Lb=new Map,Zd=[],ose="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function m4(e,t){switch(e){case"focusin":case"focusout":rf=null;break;case"dragenter":case"dragleave":nf=null;break;case"mouseover":case"mouseout":of=null;break;case"pointerover":case"pointerout":Db.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lb.delete(t.pointerId)}}function xx(e,t,r,n,c,h){return e===null||e.nativeEvent!==h?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:h,targetContainers:[c]},t!==null&&(t=Gw(t),t!==null&&eL(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function ase(e,t,r,n,c){switch(t){case"focusin":return rf=xx(rf,e,t,r,n,c),!0;case"dragenter":return nf=xx(nf,e,t,r,n,c),!0;case"mouseover":return of=xx(of,e,t,r,n,c),!0;case"pointerover":var h=c.pointerId;return Db.set(h,xx(Db.get(h)||null,e,t,r,n,c)),!0;case"gotpointercapture":return h=c.pointerId,Lb.set(h,xx(Lb.get(h)||null,e,t,r,n,c)),!0}return!1}function ZH(e){var t=Xp(e.target);if(t!==null){var r=Im(t);if(r!==null){if(t=r.tag,t===13){if(t=LH(r),t!==null){e.blockedOn=t,WH(e.priority,function(){qH(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function d2(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=SO(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);yO=n,r.target.dispatchEvent(n),yO=null}else return t=Gw(r),t!==null&&eL(t),e.blockedOn=r,!1;t.shift()}return!0}function g4(e,t,r){d2(e)&&r.delete(t)}function sse(){wO=!1,rf!==null&&d2(rf)&&(rf=null),nf!==null&&d2(nf)&&(nf=null),of!==null&&d2(of)&&(of=null),Db.forEach(g4),Lb.forEach(g4)}function bx(e,t){e.blockedOn===t&&(e.blockedOn=null,wO||(wO=!0,pl.unstable_scheduleCallback(pl.unstable_NormalPriority,sse)))}function zb(e){function t(c){return bx(c,e)}if(0<_T.length){bx(_T[0],e);for(var r=1;r<_T.length;r++){var n=_T[r];n.blockedOn===e&&(n.blockedOn=null)}}for(rf!==null&&bx(rf,e),nf!==null&&bx(nf,e),of!==null&&bx(of,e),Db.forEach(t),Lb.forEach(t),r=0;r<Zd.length;r++)n=Zd[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Zd.length&&(r=Zd[0],r.blockedOn===null);)ZH(r),r.blockedOn===null&&Zd.shift()}var Ky=Nh.ReactCurrentBatchConfig,F2=!0;function lse(e,t,r,n){var c=zi,h=Ky.transition;Ky.transition=null;try{zi=1,tL(e,t,r,n)}finally{zi=c,Ky.transition=h}}function cse(e,t,r,n){var c=zi,h=Ky.transition;Ky.transition=null;try{zi=4,tL(e,t,r,n)}finally{zi=c,Ky.transition=h}}function tL(e,t,r,n){if(F2){var c=SO(e,t,r,n);if(c===null)jM(e,t,n,B2,r),m4(e,n);else if(ase(c,e,t,r,n))n.stopPropagation();else if(m4(e,n),t&4&&-1<ose.indexOf(e)){for(;c!==null;){var h=Gw(c);if(h!==null&&GH(h),h=SO(e,t,r,n),h===null&&jM(e,t,n,B2,r),h===c)break;c=h}c!==null&&n.stopPropagation()}else jM(e,t,n,null,r)}}var B2=null;function SO(e,t,r,n){if(B2=null,e=YD(n),e=Xp(e),e!==null)if(t=Im(e),t===null)e=null;else if(r=t.tag,r===13){if(e=LH(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return B2=e,null}function KH(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xae()){case JD:return 1;case BH:return 4;case z2:case Yae:return 16;case UH:return 536870912;default:return 16}default:return 16}}var Jd=null,rL=null,f2=null;function XH(){if(f2)return f2;var e,t=rL,r=t.length,n,c="value"in Jd?Jd.value:Jd.textContent,h=c.length;for(e=0;e<r&&t[e]===c[e];e++);var p=r-e;for(n=1;n<=p&&t[r-n]===c[h-n];n++);return f2=c.slice(e,1<n?1-n:void 0)}function p2(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function vT(){return!0}function y4(){return!1}function gl(e){function t(r,n,c,h,p){this._reactName=r,this._targetInst=c,this.type=n,this.nativeEvent=h,this.target=p,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(r=e[o],this[o]=r?r(h):h[o]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?vT:y4,this.isPropagationStopped=y4,this}return _o(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=vT)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=vT)},persist:function(){},isPersistent:vT}),t}var K_={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nL=gl(K_),$w=_o({},K_,{view:0,detail:0}),use=gl($w),TM,EM,wx,CA=_o({},$w,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:iL,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==wx&&(wx&&e.type==="mousemove"?(TM=e.screenX-wx.screenX,EM=e.screenY-wx.screenY):EM=TM=0,wx=e),TM)},movementY:function(e){return"movementY"in e?e.movementY:EM}}),_4=gl(CA),hse=_o({},CA,{dataTransfer:0}),dse=gl(hse),fse=_o({},$w,{relatedTarget:0}),AM=gl(fse),pse=_o({},K_,{animationName:0,elapsedTime:0,pseudoElement:0}),mse=gl(pse),gse=_o({},K_,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yse=gl(gse),_se=_o({},K_,{data:0}),v4=gl(_se),vse={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xse={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bse={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wse(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=bse[e])?!!t[e]:!1}function iL(){return wse}var Sse=_o({},$w,{key:function(e){if(e.key){var t=vse[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=p2(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?xse[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:iL,charCode:function(e){return e.type==="keypress"?p2(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?p2(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Tse=gl(Sse),Ese=_o({},CA,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),x4=gl(Ese),Ase=_o({},$w,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:iL}),kse=gl(Ase),Cse=_o({},K_,{propertyName:0,elapsedTime:0,pseudoElement:0}),Pse=gl(Cse),Mse=_o({},CA,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ise=gl(Mse),Ose=[9,13,27,32],oL=wh&&"CompositionEvent"in window,cb=null;wh&&"documentMode"in document&&(cb=document.documentMode);var jse=wh&&"TextEvent"in window&&!cb,YH=wh&&(!oL||cb&&8<cb&&11>=cb),b4=" ",w4=!1;function JH(e,t){switch(e){case"keyup":return Ose.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function QH(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ay=!1;function Rse(e,t){switch(e){case"compositionend":return QH(t);case"keypress":return t.which!==32?null:(w4=!0,b4);case"textInput":return e=t.data,e===b4&&w4?null:e;default:return null}}function Dse(e,t){if(Ay)return e==="compositionend"||!oL&&JH(e,t)?(e=XH(),f2=rL=Jd=null,Ay=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return YH&&t.locale!=="ko"?null:t.data;default:return null}}var Lse={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function S4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Lse[e.type]:t==="textarea"}function e7(e,t,r,n){IH(n),t=U2(t,"onChange"),0<t.length&&(r=new nL("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var ub=null,Nb=null;function zse(e){h7(e,0)}function PA(e){var t=Py(e);if(TH(t))return e}function Nse(e,t){if(e==="change")return t}var t7=!1;if(wh){var kM;if(wh){var CM="oninput"in document;if(!CM){var T4=document.createElement("div");T4.setAttribute("oninput","return;"),CM=typeof T4.oninput=="function"}kM=CM}else kM=!1;t7=kM&&(!document.documentMode||9<document.documentMode)}function E4(){ub&&(ub.detachEvent("onpropertychange",r7),Nb=ub=null)}function r7(e){if(e.propertyName==="value"&&PA(Nb)){var t=[];e7(t,Nb,e,YD(e)),DH(zse,t)}}function Fse(e,t,r){e==="focusin"?(E4(),ub=t,Nb=r,ub.attachEvent("onpropertychange",r7)):e==="focusout"&&E4()}function Bse(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return PA(Nb)}function Use(e,t){if(e==="click")return PA(t)}function Vse(e,t){if(e==="input"||e==="change")return PA(t)}function $se(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var vc=typeof Object.is=="function"?Object.is:$se;function Fb(e,t){if(vc(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var c=r[n];if(!oO.call(t,c)||!vc(e[c],t[c]))return!1}return!0}function A4(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function k4(e,t){var r=A4(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=A4(r)}}function n7(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?n7(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function i7(){for(var e=window,t=R2();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=R2(e.document)}return t}function aL(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Gse(e){var t=i7(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&n7(r.ownerDocument.documentElement,r)){if(n!==null&&aL(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var c=r.textContent.length,h=Math.min(n.start,c);n=n.end===void 0?h:Math.min(n.end,c),!e.extend&&h>n&&(c=n,n=h,h=c),c=k4(r,h);var p=k4(r,n);c&&p&&(e.rangeCount!==1||e.anchorNode!==c.node||e.anchorOffset!==c.offset||e.focusNode!==p.node||e.focusOffset!==p.offset)&&(t=t.createRange(),t.setStart(c.node,c.offset),e.removeAllRanges(),h>n?(e.addRange(t),e.extend(p.node,p.offset)):(t.setEnd(p.node,p.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var qse=wh&&"documentMode"in document&&11>=document.documentMode,ky=null,TO=null,hb=null,EO=!1;function C4(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;EO||ky==null||ky!==R2(n)||(n=ky,"selectionStart"in n&&aL(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),hb&&Fb(hb,n)||(hb=n,n=U2(TO,"onSelect"),0<n.length&&(t=new nL("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=ky)))}function xT(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Cy={animationend:xT("Animation","AnimationEnd"),animationiteration:xT("Animation","AnimationIteration"),animationstart:xT("Animation","AnimationStart"),transitionend:xT("Transition","TransitionEnd")},PM={},o7={};wh&&(o7=document.createElement("div").style,"AnimationEvent"in window||(delete Cy.animationend.animation,delete Cy.animationiteration.animation,delete Cy.animationstart.animation),"TransitionEvent"in window||delete Cy.transitionend.transition);function MA(e){if(PM[e])return PM[e];if(!Cy[e])return e;var t=Cy[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in o7)return PM[e]=t[r];return e}var a7=MA("animationend"),s7=MA("animationiteration"),l7=MA("animationstart"),c7=MA("transitionend"),u7=new Map,P4="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vf(e,t){u7.set(e,t),Mm(t,[e])}for(var MM=0;MM<P4.length;MM++){var IM=P4[MM],Hse=IM.toLowerCase(),Wse=IM[0].toUpperCase()+IM.slice(1);vf(Hse,"on"+Wse)}vf(a7,"onAnimationEnd");vf(s7,"onAnimationIteration");vf(l7,"onAnimationStart");vf("dblclick","onDoubleClick");vf("focusin","onFocus");vf("focusout","onBlur");vf(c7,"onTransitionEnd");c_("onMouseEnter",["mouseout","mouseover"]);c_("onMouseLeave",["mouseout","mouseover"]);c_("onPointerEnter",["pointerout","pointerover"]);c_("onPointerLeave",["pointerout","pointerover"]);Mm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mm("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var eb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zse=new Set("cancel close invalid load scroll toggle".split(" ").concat(eb));function M4(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Hae(n,t,void 0,e),e.currentTarget=null}function h7(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],c=n.event;n=n.listeners;e:{var h=void 0;if(t)for(var p=n.length-1;0<=p;p--){var o=n[p],v=o.instance,w=o.currentTarget;if(o=o.listener,v!==h&&c.isPropagationStopped())break e;M4(c,o,w),h=v}else for(p=0;p<n.length;p++){if(o=n[p],v=o.instance,w=o.currentTarget,o=o.listener,v!==h&&c.isPropagationStopped())break e;M4(c,o,w),h=v}}}if(L2)throw e=xO,L2=!1,xO=null,e}function io(e,t){var r=t[MO];r===void 0&&(r=t[MO]=new Set);var n=e+"__bubble";r.has(n)||(d7(t,e,2,!1),r.add(n))}function OM(e,t,r){var n=0;t&&(n|=4),d7(r,e,n,t)}var bT="_reactListening"+Math.random().toString(36).slice(2);function Bb(e){if(!e[bT]){e[bT]=!0,vH.forEach(function(r){r!=="selectionchange"&&(Zse.has(r)||OM(r,!1,e),OM(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[bT]||(t[bT]=!0,OM("selectionchange",!1,t))}}function d7(e,t,r,n){switch(KH(t)){case 1:var c=lse;break;case 4:c=cse;break;default:c=tL}r=c.bind(null,t,r,e),c=void 0,!vO||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),n?c!==void 0?e.addEventListener(t,r,{capture:!0,passive:c}):e.addEventListener(t,r,!0):c!==void 0?e.addEventListener(t,r,{passive:c}):e.addEventListener(t,r,!1)}function jM(e,t,r,n,c){var h=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var p=n.tag;if(p===3||p===4){var o=n.stateNode.containerInfo;if(o===c||o.nodeType===8&&o.parentNode===c)break;if(p===4)for(p=n.return;p!==null;){var v=p.tag;if((v===3||v===4)&&(v=p.stateNode.containerInfo,v===c||v.nodeType===8&&v.parentNode===c))return;p=p.return}for(;o!==null;){if(p=Xp(o),p===null)return;if(v=p.tag,v===5||v===6){n=h=p;continue e}o=o.parentNode}}n=n.return}DH(function(){var w=h,T=YD(r),M=[];e:{var O=u7.get(e);if(O!==void 0){var D=nL,B=e;switch(e){case"keypress":if(p2(r)===0)break e;case"keydown":case"keyup":D=Tse;break;case"focusin":B="focus",D=AM;break;case"focusout":B="blur",D=AM;break;case"beforeblur":case"afterblur":D=AM;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":D=_4;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":D=dse;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":D=kse;break;case a7:case s7:case l7:D=mse;break;case c7:D=Pse;break;case"scroll":D=use;break;case"wheel":D=Ise;break;case"copy":case"cut":case"paste":D=yse;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":D=x4}var N=(t&4)!==0,G=!N&&e==="scroll",V=N?O!==null?O+"Capture":null:O;N=[];for(var U=w,X;U!==null;){X=U;var Y=X.stateNode;if(X.tag===5&&Y!==null&&(X=Y,V!==null&&(Y=Rb(U,V),Y!=null&&N.push(Ub(U,Y,X)))),G)break;U=U.return}0<N.length&&(O=new D(O,B,null,r,T),M.push({event:O,listeners:N}))}}if(!(t&7)){e:{if(O=e==="mouseover"||e==="pointerover",D=e==="mouseout"||e==="pointerout",O&&r!==yO&&(B=r.relatedTarget||r.fromElement)&&(Xp(B)||B[Sh]))break e;if((D||O)&&(O=T.window===T?T:(O=T.ownerDocument)?O.defaultView||O.parentWindow:window,D?(B=r.relatedTarget||r.toElement,D=w,B=B?Xp(B):null,B!==null&&(G=Im(B),B!==G||B.tag!==5&&B.tag!==6)&&(B=null)):(D=null,B=w),D!==B)){if(N=_4,Y="onMouseLeave",V="onMouseEnter",U="mouse",(e==="pointerout"||e==="pointerover")&&(N=x4,Y="onPointerLeave",V="onPointerEnter",U="pointer"),G=D==null?O:Py(D),X=B==null?O:Py(B),O=new N(Y,U+"leave",D,r,T),O.target=G,O.relatedTarget=X,Y=null,Xp(T)===w&&(N=new N(V,U+"enter",B,r,T),N.target=X,N.relatedTarget=G,Y=N),G=Y,D&&B)t:{for(N=D,V=B,U=0,X=N;X;X=oy(X))U++;for(X=0,Y=V;Y;Y=oy(Y))X++;for(;0<U-X;)N=oy(N),U--;for(;0<X-U;)V=oy(V),X--;for(;U--;){if(N===V||V!==null&&N===V.alternate)break t;N=oy(N),V=oy(V)}N=null}else N=null;D!==null&&I4(M,O,D,N,!1),B!==null&&G!==null&&I4(M,G,B,N,!0)}}e:{if(O=w?Py(w):window,D=O.nodeName&&O.nodeName.toLowerCase(),D==="select"||D==="input"&&O.type==="file")var ne=Nse;else if(S4(O))if(t7)ne=Vse;else{ne=Bse;var se=Fse}else(D=O.nodeName)&&D.toLowerCase()==="input"&&(O.type==="checkbox"||O.type==="radio")&&(ne=Use);if(ne&&(ne=ne(e,w))){e7(M,ne,r,T);break e}se&&se(e,O,w),e==="focusout"&&(se=O._wrapperState)&&se.controlled&&O.type==="number"&&dO(O,"number",O.value)}switch(se=w?Py(w):window,e){case"focusin":(S4(se)||se.contentEditable==="true")&&(ky=se,TO=w,hb=null);break;case"focusout":hb=TO=ky=null;break;case"mousedown":EO=!0;break;case"contextmenu":case"mouseup":case"dragend":EO=!1,C4(M,r,T);break;case"selectionchange":if(qse)break;case"keydown":case"keyup":C4(M,r,T)}var le;if(oL)e:{switch(e){case"compositionstart":var ge="onCompositionStart";break e;case"compositionend":ge="onCompositionEnd";break e;case"compositionupdate":ge="onCompositionUpdate";break e}ge=void 0}else Ay?JH(e,r)&&(ge="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(ge="onCompositionStart");ge&&(YH&&r.locale!=="ko"&&(Ay||ge!=="onCompositionStart"?ge==="onCompositionEnd"&&Ay&&(le=XH()):(Jd=T,rL="value"in Jd?Jd.value:Jd.textContent,Ay=!0)),se=U2(w,ge),0<se.length&&(ge=new v4(ge,e,null,r,T),M.push({event:ge,listeners:se}),le?ge.data=le:(le=QH(r),le!==null&&(ge.data=le)))),(le=jse?Rse(e,r):Dse(e,r))&&(w=U2(w,"onBeforeInput"),0<w.length&&(T=new v4("onBeforeInput","beforeinput",null,r,T),M.push({event:T,listeners:w}),T.data=le))}h7(M,t)})}function Ub(e,t,r){return{instance:e,listener:t,currentTarget:r}}function U2(e,t){for(var r=t+"Capture",n=[];e!==null;){var c=e,h=c.stateNode;c.tag===5&&h!==null&&(c=h,h=Rb(e,r),h!=null&&n.unshift(Ub(e,h,c)),h=Rb(e,t),h!=null&&n.push(Ub(e,h,c))),e=e.return}return n}function oy(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function I4(e,t,r,n,c){for(var h=t._reactName,p=[];r!==null&&r!==n;){var o=r,v=o.alternate,w=o.stateNode;if(v!==null&&v===n)break;o.tag===5&&w!==null&&(o=w,c?(v=Rb(r,h),v!=null&&p.unshift(Ub(r,v,o))):c||(v=Rb(r,h),v!=null&&p.push(Ub(r,v,o)))),r=r.return}p.length!==0&&e.push({event:t,listeners:p})}var Kse=/\r\n?/g,Xse=/\u0000|\uFFFD/g;function O4(e){return(typeof e=="string"?e:""+e).replace(Kse,`
`).replace(Xse,"")}function wT(e,t,r){if(t=O4(t),O4(e)!==t&&r)throw Error(cr(425))}function V2(){}var AO=null,kO=null;function CO(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var PO=typeof setTimeout=="function"?setTimeout:void 0,Yse=typeof clearTimeout=="function"?clearTimeout:void 0,j4=typeof Promise=="function"?Promise:void 0,Jse=typeof queueMicrotask=="function"?queueMicrotask:typeof j4<"u"?function(e){return j4.resolve(null).then(e).catch(Qse)}:PO;function Qse(e){setTimeout(function(){throw e})}function RM(e,t){var r=t,n=0;do{var c=r.nextSibling;if(e.removeChild(r),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(n===0){e.removeChild(c),zb(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=c}while(r);zb(t)}function af(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function R4(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var X_=Math.random().toString(36).slice(2),hu="__reactFiber$"+X_,Vb="__reactProps$"+X_,Sh="__reactContainer$"+X_,MO="__reactEvents$"+X_,ele="__reactListeners$"+X_,tle="__reactHandles$"+X_;function Xp(e){var t=e[hu];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Sh]||r[hu]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=R4(e);e!==null;){if(r=e[hu])return r;e=R4(e)}return t}e=r,r=e.parentNode}return null}function Gw(e){return e=e[hu]||e[Sh],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Py(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(cr(33))}function IA(e){return e[Vb]||null}var IO=[],My=-1;function xf(e){return{current:e}}function lo(e){0>My||(e.current=IO[My],IO[My]=null,My--)}function Qi(e,t){My++,IO[My]=e.current,e.current=t}var mf={},ts=xf(mf),Gs=xf(!1),dm=mf;function u_(e,t){var r=e.type.contextTypes;if(!r)return mf;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var c={},h;for(h in r)c[h]=t[h];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=c),c}function qs(e){return e=e.childContextTypes,e!=null}function $2(){lo(Gs),lo(ts)}function D4(e,t,r){if(ts.current!==mf)throw Error(cr(168));Qi(ts,t),Qi(Gs,r)}function f7(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var c in n)if(!(c in t))throw Error(cr(108,Fae(e)||"Unknown",c));return _o({},r,n)}function G2(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||mf,dm=ts.current,Qi(ts,e),Qi(Gs,Gs.current),!0}function L4(e,t,r){var n=e.stateNode;if(!n)throw Error(cr(169));r?(e=f7(e,t,dm),n.__reactInternalMemoizedMergedChildContext=e,lo(Gs),lo(ts),Qi(ts,e)):lo(Gs),Qi(Gs,r)}var dh=null,OA=!1,DM=!1;function p7(e){dh===null?dh=[e]:dh.push(e)}function rle(e){OA=!0,p7(e)}function bf(){if(!DM&&dh!==null){DM=!0;var e=0,t=zi;try{var r=dh;for(zi=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}dh=null,OA=!1}catch(c){throw dh!==null&&(dh=dh.slice(e+1)),FH(JD,bf),c}finally{zi=t,DM=!1}}return null}var Iy=[],Oy=0,q2=null,H2=0,Pl=[],Ml=0,fm=null,ph=1,mh="";function Fp(e,t){Iy[Oy++]=H2,Iy[Oy++]=q2,q2=e,H2=t}function m7(e,t,r){Pl[Ml++]=ph,Pl[Ml++]=mh,Pl[Ml++]=fm,fm=e;var n=ph;e=mh;var c=32-gc(n)-1;n&=~(1<<c),r+=1;var h=32-gc(t)+c;if(30<h){var p=c-c%5;h=(n&(1<<p)-1).toString(32),n>>=p,c-=p,ph=1<<32-gc(t)+c|r<<c|n,mh=h+e}else ph=1<<h|r<<c|n,mh=e}function sL(e){e.return!==null&&(Fp(e,1),m7(e,1,0))}function lL(e){for(;e===q2;)q2=Iy[--Oy],Iy[Oy]=null,H2=Iy[--Oy],Iy[Oy]=null;for(;e===fm;)fm=Pl[--Ml],Pl[Ml]=null,mh=Pl[--Ml],Pl[Ml]=null,ph=Pl[--Ml],Pl[Ml]=null}var hl=null,ul=null,ho=!1,pc=null;function g7(e,t){var r=Ol(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function z4(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,hl=e,ul=af(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,hl=e,ul=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=fm!==null?{id:ph,overflow:mh}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Ol(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,hl=e,ul=null,!0):!1;default:return!1}}function OO(e){return(e.mode&1)!==0&&(e.flags&128)===0}function jO(e){if(ho){var t=ul;if(t){var r=t;if(!z4(e,t)){if(OO(e))throw Error(cr(418));t=af(r.nextSibling);var n=hl;t&&z4(e,t)?g7(n,r):(e.flags=e.flags&-4097|2,ho=!1,hl=e)}}else{if(OO(e))throw Error(cr(418));e.flags=e.flags&-4097|2,ho=!1,hl=e}}}function N4(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;hl=e}function ST(e){if(e!==hl)return!1;if(!ho)return N4(e),ho=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!CO(e.type,e.memoizedProps)),t&&(t=ul)){if(OO(e))throw y7(),Error(cr(418));for(;t;)g7(e,t),t=af(t.nextSibling)}if(N4(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(cr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){ul=af(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}ul=null}}else ul=hl?af(e.stateNode.nextSibling):null;return!0}function y7(){for(var e=ul;e;)e=af(e.nextSibling)}function h_(){ul=hl=null,ho=!1}function cL(e){pc===null?pc=[e]:pc.push(e)}var nle=Nh.ReactCurrentBatchConfig;function Sx(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(cr(309));var n=r.stateNode}if(!n)throw Error(cr(147,e));var c=n,h=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===h?t.ref:(t=function(p){var o=c.refs;p===null?delete o[h]:o[h]=p},t._stringRef=h,t)}if(typeof e!="string")throw Error(cr(284));if(!r._owner)throw Error(cr(290,e))}return e}function TT(e,t){throw e=Object.prototype.toString.call(t),Error(cr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function F4(e){var t=e._init;return t(e._payload)}function _7(e){function t(V,U){if(e){var X=V.deletions;X===null?(V.deletions=[U],V.flags|=16):X.push(U)}}function r(V,U){if(!e)return null;for(;U!==null;)t(V,U),U=U.sibling;return null}function n(V,U){for(V=new Map;U!==null;)U.key!==null?V.set(U.key,U):V.set(U.index,U),U=U.sibling;return V}function c(V,U){return V=uf(V,U),V.index=0,V.sibling=null,V}function h(V,U,X){return V.index=X,e?(X=V.alternate,X!==null?(X=X.index,X<U?(V.flags|=2,U):X):(V.flags|=2,U)):(V.flags|=1048576,U)}function p(V){return e&&V.alternate===null&&(V.flags|=2),V}function o(V,U,X,Y){return U===null||U.tag!==6?(U=VM(X,V.mode,Y),U.return=V,U):(U=c(U,X),U.return=V,U)}function v(V,U,X,Y){var ne=X.type;return ne===Ey?T(V,U,X.props.children,Y,X.key):U!==null&&(U.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===$d&&F4(ne)===U.type)?(Y=c(U,X.props),Y.ref=Sx(V,U,X),Y.return=V,Y):(Y=b2(X.type,X.key,X.props,null,V.mode,Y),Y.ref=Sx(V,U,X),Y.return=V,Y)}function w(V,U,X,Y){return U===null||U.tag!==4||U.stateNode.containerInfo!==X.containerInfo||U.stateNode.implementation!==X.implementation?(U=$M(X,V.mode,Y),U.return=V,U):(U=c(U,X.children||[]),U.return=V,U)}function T(V,U,X,Y,ne){return U===null||U.tag!==7?(U=am(X,V.mode,Y,ne),U.return=V,U):(U=c(U,X),U.return=V,U)}function M(V,U,X){if(typeof U=="string"&&U!==""||typeof U=="number")return U=VM(""+U,V.mode,X),U.return=V,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case fT:return X=b2(U.type,U.key,U.props,null,V.mode,X),X.ref=Sx(V,null,U),X.return=V,X;case Ty:return U=$M(U,V.mode,X),U.return=V,U;case $d:var Y=U._init;return M(V,Y(U._payload),X)}if(Jx(U)||_x(U))return U=am(U,V.mode,X,null),U.return=V,U;TT(V,U)}return null}function O(V,U,X,Y){var ne=U!==null?U.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return ne!==null?null:o(V,U,""+X,Y);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case fT:return X.key===ne?v(V,U,X,Y):null;case Ty:return X.key===ne?w(V,U,X,Y):null;case $d:return ne=X._init,O(V,U,ne(X._payload),Y)}if(Jx(X)||_x(X))return ne!==null?null:T(V,U,X,Y,null);TT(V,X)}return null}function D(V,U,X,Y,ne){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return V=V.get(X)||null,o(U,V,""+Y,ne);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case fT:return V=V.get(Y.key===null?X:Y.key)||null,v(U,V,Y,ne);case Ty:return V=V.get(Y.key===null?X:Y.key)||null,w(U,V,Y,ne);case $d:var se=Y._init;return D(V,U,X,se(Y._payload),ne)}if(Jx(Y)||_x(Y))return V=V.get(X)||null,T(U,V,Y,ne,null);TT(U,Y)}return null}function B(V,U,X,Y){for(var ne=null,se=null,le=U,ge=U=0,je=null;le!==null&&ge<X.length;ge++){le.index>ge?(je=le,le=null):je=le.sibling;var ze=O(V,le,X[ge],Y);if(ze===null){le===null&&(le=je);break}e&&le&&ze.alternate===null&&t(V,le),U=h(ze,U,ge),se===null?ne=ze:se.sibling=ze,se=ze,le=je}if(ge===X.length)return r(V,le),ho&&Fp(V,ge),ne;if(le===null){for(;ge<X.length;ge++)le=M(V,X[ge],Y),le!==null&&(U=h(le,U,ge),se===null?ne=le:se.sibling=le,se=le);return ho&&Fp(V,ge),ne}for(le=n(V,le);ge<X.length;ge++)je=D(le,V,ge,X[ge],Y),je!==null&&(e&&je.alternate!==null&&le.delete(je.key===null?ge:je.key),U=h(je,U,ge),se===null?ne=je:se.sibling=je,se=je);return e&&le.forEach(function(Ce){return t(V,Ce)}),ho&&Fp(V,ge),ne}function N(V,U,X,Y){var ne=_x(X);if(typeof ne!="function")throw Error(cr(150));if(X=ne.call(X),X==null)throw Error(cr(151));for(var se=ne=null,le=U,ge=U=0,je=null,ze=X.next();le!==null&&!ze.done;ge++,ze=X.next()){le.index>ge?(je=le,le=null):je=le.sibling;var Ce=O(V,le,ze.value,Y);if(Ce===null){le===null&&(le=je);break}e&&le&&Ce.alternate===null&&t(V,le),U=h(Ce,U,ge),se===null?ne=Ce:se.sibling=Ce,se=Ce,le=je}if(ze.done)return r(V,le),ho&&Fp(V,ge),ne;if(le===null){for(;!ze.done;ge++,ze=X.next())ze=M(V,ze.value,Y),ze!==null&&(U=h(ze,U,ge),se===null?ne=ze:se.sibling=ze,se=ze);return ho&&Fp(V,ge),ne}for(le=n(V,le);!ze.done;ge++,ze=X.next())ze=D(le,V,ge,ze.value,Y),ze!==null&&(e&&ze.alternate!==null&&le.delete(ze.key===null?ge:ze.key),U=h(ze,U,ge),se===null?ne=ze:se.sibling=ze,se=ze);return e&&le.forEach(function(Ke){return t(V,Ke)}),ho&&Fp(V,ge),ne}function G(V,U,X,Y){if(typeof X=="object"&&X!==null&&X.type===Ey&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case fT:e:{for(var ne=X.key,se=U;se!==null;){if(se.key===ne){if(ne=X.type,ne===Ey){if(se.tag===7){r(V,se.sibling),U=c(se,X.props.children),U.return=V,V=U;break e}}else if(se.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===$d&&F4(ne)===se.type){r(V,se.sibling),U=c(se,X.props),U.ref=Sx(V,se,X),U.return=V,V=U;break e}r(V,se);break}else t(V,se);se=se.sibling}X.type===Ey?(U=am(X.props.children,V.mode,Y,X.key),U.return=V,V=U):(Y=b2(X.type,X.key,X.props,null,V.mode,Y),Y.ref=Sx(V,U,X),Y.return=V,V=Y)}return p(V);case Ty:e:{for(se=X.key;U!==null;){if(U.key===se)if(U.tag===4&&U.stateNode.containerInfo===X.containerInfo&&U.stateNode.implementation===X.implementation){r(V,U.sibling),U=c(U,X.children||[]),U.return=V,V=U;break e}else{r(V,U);break}else t(V,U);U=U.sibling}U=$M(X,V.mode,Y),U.return=V,V=U}return p(V);case $d:return se=X._init,G(V,U,se(X._payload),Y)}if(Jx(X))return B(V,U,X,Y);if(_x(X))return N(V,U,X,Y);TT(V,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,U!==null&&U.tag===6?(r(V,U.sibling),U=c(U,X),U.return=V,V=U):(r(V,U),U=VM(X,V.mode,Y),U.return=V,V=U),p(V)):r(V,U)}return G}var d_=_7(!0),v7=_7(!1),W2=xf(null),Z2=null,jy=null,uL=null;function hL(){uL=jy=Z2=null}function dL(e){var t=W2.current;lo(W2),e._currentValue=t}function RO(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Xy(e,t){Z2=e,uL=jy=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Us=!0),e.firstContext=null)}function zl(e){var t=e._currentValue;if(uL!==e)if(e={context:e,memoizedValue:t,next:null},jy===null){if(Z2===null)throw Error(cr(308));jy=e,Z2.dependencies={lanes:0,firstContext:e}}else jy=jy.next=e;return t}var Yp=null;function fL(e){Yp===null?Yp=[e]:Yp.push(e)}function x7(e,t,r,n){var c=t.interleaved;return c===null?(r.next=r,fL(t)):(r.next=c.next,c.next=r),t.interleaved=r,Th(e,n)}function Th(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Gd=!1;function pL(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function b7(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function vh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function sf(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,xi&2){var c=n.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),n.pending=t,Th(e,r)}return c=n.interleaved,c===null?(t.next=t,fL(n)):(t.next=c.next,c.next=t),n.interleaved=t,Th(e,r)}function m2(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,QD(e,r)}}function B4(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var c=null,h=null;if(r=r.firstBaseUpdate,r!==null){do{var p={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};h===null?c=h=p:h=h.next=p,r=r.next}while(r!==null);h===null?c=h=t:h=h.next=t}else c=h=t;r={baseState:n.baseState,firstBaseUpdate:c,lastBaseUpdate:h,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function K2(e,t,r,n){var c=e.updateQueue;Gd=!1;var h=c.firstBaseUpdate,p=c.lastBaseUpdate,o=c.shared.pending;if(o!==null){c.shared.pending=null;var v=o,w=v.next;v.next=null,p===null?h=w:p.next=w,p=v;var T=e.alternate;T!==null&&(T=T.updateQueue,o=T.lastBaseUpdate,o!==p&&(o===null?T.firstBaseUpdate=w:o.next=w,T.lastBaseUpdate=v))}if(h!==null){var M=c.baseState;p=0,T=w=v=null,o=h;do{var O=o.lane,D=o.eventTime;if((n&O)===O){T!==null&&(T=T.next={eventTime:D,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var B=e,N=o;switch(O=t,D=r,N.tag){case 1:if(B=N.payload,typeof B=="function"){M=B.call(D,M,O);break e}M=B;break e;case 3:B.flags=B.flags&-65537|128;case 0:if(B=N.payload,O=typeof B=="function"?B.call(D,M,O):B,O==null)break e;M=_o({},M,O);break e;case 2:Gd=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,O=c.effects,O===null?c.effects=[o]:O.push(o))}else D={eventTime:D,lane:O,tag:o.tag,payload:o.payload,callback:o.callback,next:null},T===null?(w=T=D,v=M):T=T.next=D,p|=O;if(o=o.next,o===null){if(o=c.shared.pending,o===null)break;O=o,o=O.next,O.next=null,c.lastBaseUpdate=O,c.shared.pending=null}}while(!0);if(T===null&&(v=M),c.baseState=v,c.firstBaseUpdate=w,c.lastBaseUpdate=T,t=c.shared.interleaved,t!==null){c=t;do p|=c.lane,c=c.next;while(c!==t)}else h===null&&(c.shared.lanes=0);mm|=p,e.lanes=p,e.memoizedState=M}}function U4(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],c=n.callback;if(c!==null){if(n.callback=null,n=r,typeof c!="function")throw Error(cr(191,c));c.call(n)}}}var qw={},_u=xf(qw),$b=xf(qw),Gb=xf(qw);function Jp(e){if(e===qw)throw Error(cr(174));return e}function mL(e,t){switch(Qi(Gb,t),Qi($b,e),Qi(_u,qw),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:pO(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=pO(t,e)}lo(_u),Qi(_u,t)}function f_(){lo(_u),lo($b),lo(Gb)}function w7(e){Jp(Gb.current);var t=Jp(_u.current),r=pO(t,e.type);t!==r&&(Qi($b,e),Qi(_u,r))}function gL(e){$b.current===e&&(lo(_u),lo($b))}var mo=xf(0);function X2(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var LM=[];function yL(){for(var e=0;e<LM.length;e++)LM[e]._workInProgressVersionPrimary=null;LM.length=0}var g2=Nh.ReactCurrentDispatcher,zM=Nh.ReactCurrentBatchConfig,pm=0,yo=null,ra=null,ya=null,Y2=!1,db=!1,qb=0,ile=0;function Wa(){throw Error(cr(321))}function _L(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!vc(e[r],t[r]))return!1;return!0}function vL(e,t,r,n,c,h){if(pm=h,yo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,g2.current=e===null||e.memoizedState===null?lle:cle,e=r(n,c),db){h=0;do{if(db=!1,qb=0,25<=h)throw Error(cr(301));h+=1,ya=ra=null,t.updateQueue=null,g2.current=ule,e=r(n,c)}while(db)}if(g2.current=J2,t=ra!==null&&ra.next!==null,pm=0,ya=ra=yo=null,Y2=!1,t)throw Error(cr(300));return e}function xL(){var e=qb!==0;return qb=0,e}function cu(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ya===null?yo.memoizedState=ya=e:ya=ya.next=e,ya}function Nl(){if(ra===null){var e=yo.alternate;e=e!==null?e.memoizedState:null}else e=ra.next;var t=ya===null?yo.memoizedState:ya.next;if(t!==null)ya=t,ra=e;else{if(e===null)throw Error(cr(310));ra=e,e={memoizedState:ra.memoizedState,baseState:ra.baseState,baseQueue:ra.baseQueue,queue:ra.queue,next:null},ya===null?yo.memoizedState=ya=e:ya=ya.next=e}return ya}function Hb(e,t){return typeof t=="function"?t(e):t}function NM(e){var t=Nl(),r=t.queue;if(r===null)throw Error(cr(311));r.lastRenderedReducer=e;var n=ra,c=n.baseQueue,h=r.pending;if(h!==null){if(c!==null){var p=c.next;c.next=h.next,h.next=p}n.baseQueue=c=h,r.pending=null}if(c!==null){h=c.next,n=n.baseState;var o=p=null,v=null,w=h;do{var T=w.lane;if((pm&T)===T)v!==null&&(v=v.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),n=w.hasEagerState?w.eagerState:e(n,w.action);else{var M={lane:T,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};v===null?(o=v=M,p=n):v=v.next=M,yo.lanes|=T,mm|=T}w=w.next}while(w!==null&&w!==h);v===null?p=n:v.next=o,vc(n,t.memoizedState)||(Us=!0),t.memoizedState=n,t.baseState=p,t.baseQueue=v,r.lastRenderedState=n}if(e=r.interleaved,e!==null){c=e;do h=c.lane,yo.lanes|=h,mm|=h,c=c.next;while(c!==e)}else c===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function FM(e){var t=Nl(),r=t.queue;if(r===null)throw Error(cr(311));r.lastRenderedReducer=e;var n=r.dispatch,c=r.pending,h=t.memoizedState;if(c!==null){r.pending=null;var p=c=c.next;do h=e(h,p.action),p=p.next;while(p!==c);vc(h,t.memoizedState)||(Us=!0),t.memoizedState=h,t.baseQueue===null&&(t.baseState=h),r.lastRenderedState=h}return[h,n]}function S7(){}function T7(e,t){var r=yo,n=Nl(),c=t(),h=!vc(n.memoizedState,c);if(h&&(n.memoizedState=c,Us=!0),n=n.queue,bL(k7.bind(null,r,n,e),[e]),n.getSnapshot!==t||h||ya!==null&&ya.memoizedState.tag&1){if(r.flags|=2048,Wb(9,A7.bind(null,r,n,c,t),void 0,null),va===null)throw Error(cr(349));pm&30||E7(r,t,c)}return c}function E7(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=yo.updateQueue,t===null?(t={lastEffect:null,stores:null},yo.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function A7(e,t,r,n){t.value=r,t.getSnapshot=n,C7(t)&&P7(e)}function k7(e,t,r){return r(function(){C7(t)&&P7(e)})}function C7(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!vc(e,r)}catch{return!0}}function P7(e){var t=Th(e,1);t!==null&&yc(t,e,1,-1)}function V4(e){var t=cu();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hb,lastRenderedState:e},t.queue=e,e=e.dispatch=sle.bind(null,yo,e),[t.memoizedState,e]}function Wb(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=yo.updateQueue,t===null?(t={lastEffect:null,stores:null},yo.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function M7(){return Nl().memoizedState}function y2(e,t,r,n){var c=cu();yo.flags|=e,c.memoizedState=Wb(1|t,r,void 0,n===void 0?null:n)}function jA(e,t,r,n){var c=Nl();n=n===void 0?null:n;var h=void 0;if(ra!==null){var p=ra.memoizedState;if(h=p.destroy,n!==null&&_L(n,p.deps)){c.memoizedState=Wb(t,r,h,n);return}}yo.flags|=e,c.memoizedState=Wb(1|t,r,h,n)}function $4(e,t){return y2(8390656,8,e,t)}function bL(e,t){return jA(2048,8,e,t)}function I7(e,t){return jA(4,2,e,t)}function O7(e,t){return jA(4,4,e,t)}function j7(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function R7(e,t,r){return r=r!=null?r.concat([e]):null,jA(4,4,j7.bind(null,t,e),r)}function wL(){}function D7(e,t){var r=Nl();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&_L(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function L7(e,t){var r=Nl();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&_L(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function z7(e,t,r){return pm&21?(vc(r,t)||(r=VH(),yo.lanes|=r,mm|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Us=!0),e.memoizedState=r)}function ole(e,t){var r=zi;zi=r!==0&&4>r?r:4,e(!0);var n=zM.transition;zM.transition={};try{e(!1),t()}finally{zi=r,zM.transition=n}}function N7(){return Nl().memoizedState}function ale(e,t,r){var n=cf(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},F7(e))B7(t,r);else if(r=x7(e,t,r,n),r!==null){var c=xs();yc(r,e,n,c),U7(r,t,n)}}function sle(e,t,r){var n=cf(e),c={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(F7(e))B7(t,c);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=t.lastRenderedReducer,h!==null))try{var p=t.lastRenderedState,o=h(p,r);if(c.hasEagerState=!0,c.eagerState=o,vc(o,p)){var v=t.interleaved;v===null?(c.next=c,fL(t)):(c.next=v.next,v.next=c),t.interleaved=c;return}}catch{}finally{}r=x7(e,t,c,n),r!==null&&(c=xs(),yc(r,e,n,c),U7(r,t,n))}}function F7(e){var t=e.alternate;return e===yo||t!==null&&t===yo}function B7(e,t){db=Y2=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function U7(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,QD(e,r)}}var J2={readContext:zl,useCallback:Wa,useContext:Wa,useEffect:Wa,useImperativeHandle:Wa,useInsertionEffect:Wa,useLayoutEffect:Wa,useMemo:Wa,useReducer:Wa,useRef:Wa,useState:Wa,useDebugValue:Wa,useDeferredValue:Wa,useTransition:Wa,useMutableSource:Wa,useSyncExternalStore:Wa,useId:Wa,unstable_isNewReconciler:!1},lle={readContext:zl,useCallback:function(e,t){return cu().memoizedState=[e,t===void 0?null:t],e},useContext:zl,useEffect:$4,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,y2(4194308,4,j7.bind(null,t,e),r)},useLayoutEffect:function(e,t){return y2(4194308,4,e,t)},useInsertionEffect:function(e,t){return y2(4,2,e,t)},useMemo:function(e,t){var r=cu();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=cu();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=ale.bind(null,yo,e),[n.memoizedState,e]},useRef:function(e){var t=cu();return e={current:e},t.memoizedState=e},useState:V4,useDebugValue:wL,useDeferredValue:function(e){return cu().memoizedState=e},useTransition:function(){var e=V4(!1),t=e[0];return e=ole.bind(null,e[1]),cu().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=yo,c=cu();if(ho){if(r===void 0)throw Error(cr(407));r=r()}else{if(r=t(),va===null)throw Error(cr(349));pm&30||E7(n,t,r)}c.memoizedState=r;var h={value:r,getSnapshot:t};return c.queue=h,$4(k7.bind(null,n,h,e),[e]),n.flags|=2048,Wb(9,A7.bind(null,n,h,r,t),void 0,null),r},useId:function(){var e=cu(),t=va.identifierPrefix;if(ho){var r=mh,n=ph;r=(n&~(1<<32-gc(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=qb++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=ile++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},cle={readContext:zl,useCallback:D7,useContext:zl,useEffect:bL,useImperativeHandle:R7,useInsertionEffect:I7,useLayoutEffect:O7,useMemo:L7,useReducer:NM,useRef:M7,useState:function(){return NM(Hb)},useDebugValue:wL,useDeferredValue:function(e){var t=Nl();return z7(t,ra.memoizedState,e)},useTransition:function(){var e=NM(Hb)[0],t=Nl().memoizedState;return[e,t]},useMutableSource:S7,useSyncExternalStore:T7,useId:N7,unstable_isNewReconciler:!1},ule={readContext:zl,useCallback:D7,useContext:zl,useEffect:bL,useImperativeHandle:R7,useInsertionEffect:I7,useLayoutEffect:O7,useMemo:L7,useReducer:FM,useRef:M7,useState:function(){return FM(Hb)},useDebugValue:wL,useDeferredValue:function(e){var t=Nl();return ra===null?t.memoizedState=e:z7(t,ra.memoizedState,e)},useTransition:function(){var e=FM(Hb)[0],t=Nl().memoizedState;return[e,t]},useMutableSource:S7,useSyncExternalStore:T7,useId:N7,unstable_isNewReconciler:!1};function cc(e,t){if(e&&e.defaultProps){t=_o({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function DO(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:_o({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var RA={isMounted:function(e){return(e=e._reactInternals)?Im(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=xs(),c=cf(e),h=vh(n,c);h.payload=t,r!=null&&(h.callback=r),t=sf(e,h,c),t!==null&&(yc(t,e,c,n),m2(t,e,c))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=xs(),c=cf(e),h=vh(n,c);h.tag=1,h.payload=t,r!=null&&(h.callback=r),t=sf(e,h,c),t!==null&&(yc(t,e,c,n),m2(t,e,c))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=xs(),n=cf(e),c=vh(r,n);c.tag=2,t!=null&&(c.callback=t),t=sf(e,c,n),t!==null&&(yc(t,e,n,r),m2(t,e,n))}};function G4(e,t,r,n,c,h,p){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,h,p):t.prototype&&t.prototype.isPureReactComponent?!Fb(r,n)||!Fb(c,h):!0}function V7(e,t,r){var n=!1,c=mf,h=t.contextType;return typeof h=="object"&&h!==null?h=zl(h):(c=qs(t)?dm:ts.current,n=t.contextTypes,h=(n=n!=null)?u_(e,c):mf),t=new t(r,h),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=RA,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=c,e.__reactInternalMemoizedMaskedChildContext=h),t}function q4(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&RA.enqueueReplaceState(t,t.state,null)}function LO(e,t,r,n){var c=e.stateNode;c.props=r,c.state=e.memoizedState,c.refs={},pL(e);var h=t.contextType;typeof h=="object"&&h!==null?c.context=zl(h):(h=qs(t)?dm:ts.current,c.context=u_(e,h)),c.state=e.memoizedState,h=t.getDerivedStateFromProps,typeof h=="function"&&(DO(e,t,h,r),c.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(t=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),t!==c.state&&RA.enqueueReplaceState(c,c.state,null),K2(e,r,c,n),c.state=e.memoizedState),typeof c.componentDidMount=="function"&&(e.flags|=4194308)}function p_(e,t){try{var r="",n=t;do r+=Nae(n),n=n.return;while(n);var c=r}catch(h){c=`
Error generating stack: `+h.message+`
`+h.stack}return{value:e,source:t,stack:c,digest:null}}function BM(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function zO(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var hle=typeof WeakMap=="function"?WeakMap:Map;function $7(e,t,r){r=vh(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){eE||(eE=!0,HO=n),zO(e,t)},r}function G7(e,t,r){r=vh(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var c=t.value;r.payload=function(){return n(c)},r.callback=function(){zO(e,t)}}var h=e.stateNode;return h!==null&&typeof h.componentDidCatch=="function"&&(r.callback=function(){zO(e,t),typeof n!="function"&&(lf===null?lf=new Set([this]):lf.add(this));var p=t.stack;this.componentDidCatch(t.value,{componentStack:p!==null?p:""})}),r}function H4(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new hle;var c=new Set;n.set(t,c)}else c=n.get(t),c===void 0&&(c=new Set,n.set(t,c));c.has(r)||(c.add(r),e=Ele.bind(null,e,t,r),t.then(e,e))}function W4(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Z4(e,t,r,n,c){return e.mode&1?(e.flags|=65536,e.lanes=c,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=vh(-1,1),t.tag=2,sf(r,t,1))),r.lanes|=1),e)}var dle=Nh.ReactCurrentOwner,Us=!1;function fs(e,t,r,n){t.child=e===null?v7(t,null,r,n):d_(t,e.child,r,n)}function K4(e,t,r,n,c){r=r.render;var h=t.ref;return Xy(t,c),n=vL(e,t,r,n,h,c),r=xL(),e!==null&&!Us?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Eh(e,t,c)):(ho&&r&&sL(t),t.flags|=1,fs(e,t,n,c),t.child)}function X4(e,t,r,n,c){if(e===null){var h=r.type;return typeof h=="function"&&!ML(h)&&h.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=h,q7(e,t,h,n,c)):(e=b2(r.type,null,n,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(h=e.child,!(e.lanes&c)){var p=h.memoizedProps;if(r=r.compare,r=r!==null?r:Fb,r(p,n)&&e.ref===t.ref)return Eh(e,t,c)}return t.flags|=1,e=uf(h,n),e.ref=t.ref,e.return=t,t.child=e}function q7(e,t,r,n,c){if(e!==null){var h=e.memoizedProps;if(Fb(h,n)&&e.ref===t.ref)if(Us=!1,t.pendingProps=n=h,(e.lanes&c)!==0)e.flags&131072&&(Us=!0);else return t.lanes=e.lanes,Eh(e,t,c)}return NO(e,t,r,n,c)}function H7(e,t,r){var n=t.pendingProps,c=n.children,h=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qi(Dy,ol),ol|=r;else{if(!(r&1073741824))return e=h!==null?h.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Qi(Dy,ol),ol|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=h!==null?h.baseLanes:r,Qi(Dy,ol),ol|=n}else h!==null?(n=h.baseLanes|r,t.memoizedState=null):n=r,Qi(Dy,ol),ol|=n;return fs(e,t,c,r),t.child}function W7(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function NO(e,t,r,n,c){var h=qs(r)?dm:ts.current;return h=u_(t,h),Xy(t,c),r=vL(e,t,r,n,h,c),n=xL(),e!==null&&!Us?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Eh(e,t,c)):(ho&&n&&sL(t),t.flags|=1,fs(e,t,r,c),t.child)}function Y4(e,t,r,n,c){if(qs(r)){var h=!0;G2(t)}else h=!1;if(Xy(t,c),t.stateNode===null)_2(e,t),V7(t,r,n),LO(t,r,n,c),n=!0;else if(e===null){var p=t.stateNode,o=t.memoizedProps;p.props=o;var v=p.context,w=r.contextType;typeof w=="object"&&w!==null?w=zl(w):(w=qs(r)?dm:ts.current,w=u_(t,w));var T=r.getDerivedStateFromProps,M=typeof T=="function"||typeof p.getSnapshotBeforeUpdate=="function";M||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(o!==n||v!==w)&&q4(t,p,n,w),Gd=!1;var O=t.memoizedState;p.state=O,K2(t,n,p,c),v=t.memoizedState,o!==n||O!==v||Gs.current||Gd?(typeof T=="function"&&(DO(t,r,T,n),v=t.memoizedState),(o=Gd||G4(t,r,o,n,O,v,w))?(M||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(t.flags|=4194308)):(typeof p.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=v),p.props=n,p.state=v,p.context=w,n=o):(typeof p.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{p=t.stateNode,b7(e,t),o=t.memoizedProps,w=t.type===t.elementType?o:cc(t.type,o),p.props=w,M=t.pendingProps,O=p.context,v=r.contextType,typeof v=="object"&&v!==null?v=zl(v):(v=qs(r)?dm:ts.current,v=u_(t,v));var D=r.getDerivedStateFromProps;(T=typeof D=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(o!==M||O!==v)&&q4(t,p,n,v),Gd=!1,O=t.memoizedState,p.state=O,K2(t,n,p,c);var B=t.memoizedState;o!==M||O!==B||Gs.current||Gd?(typeof D=="function"&&(DO(t,r,D,n),B=t.memoizedState),(w=Gd||G4(t,r,w,n,O,B,v)||!1)?(T||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(n,B,v),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(n,B,v)),typeof p.componentDidUpdate=="function"&&(t.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof p.componentDidUpdate!="function"||o===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=B),p.props=n,p.state=B,p.context=v,n=w):(typeof p.componentDidUpdate!="function"||o===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),n=!1)}return FO(e,t,r,n,h,c)}function FO(e,t,r,n,c,h){W7(e,t);var p=(t.flags&128)!==0;if(!n&&!p)return c&&L4(t,r,!1),Eh(e,t,h);n=t.stateNode,dle.current=t;var o=p&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&p?(t.child=d_(t,e.child,null,h),t.child=d_(t,null,o,h)):fs(e,t,o,h),t.memoizedState=n.state,c&&L4(t,r,!0),t.child}function Z7(e){var t=e.stateNode;t.pendingContext?D4(e,t.pendingContext,t.pendingContext!==t.context):t.context&&D4(e,t.context,!1),mL(e,t.containerInfo)}function J4(e,t,r,n,c){return h_(),cL(c),t.flags|=256,fs(e,t,r,n),t.child}var BO={dehydrated:null,treeContext:null,retryLane:0};function UO(e){return{baseLanes:e,cachePool:null,transitions:null}}function K7(e,t,r){var n=t.pendingProps,c=mo.current,h=!1,p=(t.flags&128)!==0,o;if((o=p)||(o=e!==null&&e.memoizedState===null?!1:(c&2)!==0),o?(h=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(c|=1),Qi(mo,c&1),e===null)return jO(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(p=n.children,e=n.fallback,h?(n=t.mode,h=t.child,p={mode:"hidden",children:p},!(n&1)&&h!==null?(h.childLanes=0,h.pendingProps=p):h=zA(p,n,0,null),e=am(e,n,r,null),h.return=t,e.return=t,h.sibling=e,t.child=h,t.child.memoizedState=UO(r),t.memoizedState=BO,e):SL(t,p));if(c=e.memoizedState,c!==null&&(o=c.dehydrated,o!==null))return fle(e,t,p,n,o,c,r);if(h){h=n.fallback,p=t.mode,c=e.child,o=c.sibling;var v={mode:"hidden",children:n.children};return!(p&1)&&t.child!==c?(n=t.child,n.childLanes=0,n.pendingProps=v,t.deletions=null):(n=uf(c,v),n.subtreeFlags=c.subtreeFlags&14680064),o!==null?h=uf(o,h):(h=am(h,p,r,null),h.flags|=2),h.return=t,n.return=t,n.sibling=h,t.child=n,n=h,h=t.child,p=e.child.memoizedState,p=p===null?UO(r):{baseLanes:p.baseLanes|r,cachePool:null,transitions:p.transitions},h.memoizedState=p,h.childLanes=e.childLanes&~r,t.memoizedState=BO,n}return h=e.child,e=h.sibling,n=uf(h,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function SL(e,t){return t=zA({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function ET(e,t,r,n){return n!==null&&cL(n),d_(t,e.child,null,r),e=SL(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function fle(e,t,r,n,c,h,p){if(r)return t.flags&256?(t.flags&=-257,n=BM(Error(cr(422))),ET(e,t,p,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(h=n.fallback,c=t.mode,n=zA({mode:"visible",children:n.children},c,0,null),h=am(h,c,p,null),h.flags|=2,n.return=t,h.return=t,n.sibling=h,t.child=n,t.mode&1&&d_(t,e.child,null,p),t.child.memoizedState=UO(p),t.memoizedState=BO,h);if(!(t.mode&1))return ET(e,t,p,null);if(c.data==="$!"){if(n=c.nextSibling&&c.nextSibling.dataset,n)var o=n.dgst;return n=o,h=Error(cr(419)),n=BM(h,n,void 0),ET(e,t,p,n)}if(o=(p&e.childLanes)!==0,Us||o){if(n=va,n!==null){switch(p&-p){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(n.suspendedLanes|p)?0:c,c!==0&&c!==h.retryLane&&(h.retryLane=c,Th(e,c),yc(n,e,c,-1))}return PL(),n=BM(Error(cr(421))),ET(e,t,p,n)}return c.data==="$?"?(t.flags|=128,t.child=e.child,t=Ale.bind(null,e),c._reactRetry=t,null):(e=h.treeContext,ul=af(c.nextSibling),hl=t,ho=!0,pc=null,e!==null&&(Pl[Ml++]=ph,Pl[Ml++]=mh,Pl[Ml++]=fm,ph=e.id,mh=e.overflow,fm=t),t=SL(t,n.children),t.flags|=4096,t)}function Q4(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),RO(e.return,t,r)}function UM(e,t,r,n,c){var h=e.memoizedState;h===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:c}:(h.isBackwards=t,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=r,h.tailMode=c)}function X7(e,t,r){var n=t.pendingProps,c=n.revealOrder,h=n.tail;if(fs(e,t,n.children,r),n=mo.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Q4(e,r,t);else if(e.tag===19)Q4(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Qi(mo,n),!(t.mode&1))t.memoizedState=null;else switch(c){case"forwards":for(r=t.child,c=null;r!==null;)e=r.alternate,e!==null&&X2(e)===null&&(c=r),r=r.sibling;r=c,r===null?(c=t.child,t.child=null):(c=r.sibling,r.sibling=null),UM(t,!1,c,r,h);break;case"backwards":for(r=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&X2(e)===null){t.child=c;break}e=c.sibling,c.sibling=r,r=c,c=e}UM(t,!0,r,null,h);break;case"together":UM(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function _2(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Eh(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),mm|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(cr(153));if(t.child!==null){for(e=t.child,r=uf(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=uf(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function ple(e,t,r){switch(t.tag){case 3:Z7(t),h_();break;case 5:w7(t);break;case 1:qs(t.type)&&G2(t);break;case 4:mL(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,c=t.memoizedProps.value;Qi(W2,n._currentValue),n._currentValue=c;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Qi(mo,mo.current&1),t.flags|=128,null):r&t.child.childLanes?K7(e,t,r):(Qi(mo,mo.current&1),e=Eh(e,t,r),e!==null?e.sibling:null);Qi(mo,mo.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return X7(e,t,r);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Qi(mo,mo.current),n)break;return null;case 22:case 23:return t.lanes=0,H7(e,t,r)}return Eh(e,t,r)}var Y7,VO,J7,Q7;Y7=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};VO=function(){};J7=function(e,t,r,n){var c=e.memoizedProps;if(c!==n){e=t.stateNode,Jp(_u.current);var h=null;switch(r){case"input":c=uO(e,c),n=uO(e,n),h=[];break;case"select":c=_o({},c,{value:void 0}),n=_o({},n,{value:void 0}),h=[];break;case"textarea":c=fO(e,c),n=fO(e,n),h=[];break;default:typeof c.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=V2)}mO(r,n);var p;r=null;for(w in c)if(!n.hasOwnProperty(w)&&c.hasOwnProperty(w)&&c[w]!=null)if(w==="style"){var o=c[w];for(p in o)o.hasOwnProperty(p)&&(r||(r={}),r[p]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Ob.hasOwnProperty(w)?h||(h=[]):(h=h||[]).push(w,null));for(w in n){var v=n[w];if(o=c?.[w],n.hasOwnProperty(w)&&v!==o&&(v!=null||o!=null))if(w==="style")if(o){for(p in o)!o.hasOwnProperty(p)||v&&v.hasOwnProperty(p)||(r||(r={}),r[p]="");for(p in v)v.hasOwnProperty(p)&&o[p]!==v[p]&&(r||(r={}),r[p]=v[p])}else r||(h||(h=[]),h.push(w,r)),r=v;else w==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,o=o?o.__html:void 0,v!=null&&o!==v&&(h=h||[]).push(w,v)):w==="children"?typeof v!="string"&&typeof v!="number"||(h=h||[]).push(w,""+v):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(Ob.hasOwnProperty(w)?(v!=null&&w==="onScroll"&&io("scroll",e),h||o===v||(h=[])):(h=h||[]).push(w,v))}r&&(h=h||[]).push("style",r);var w=h;(t.updateQueue=w)&&(t.flags|=4)}};Q7=function(e,t,r,n){r!==n&&(t.flags|=4)};function Tx(e,t){if(!ho)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Za(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var c=e.child;c!==null;)r|=c.lanes|c.childLanes,n|=c.subtreeFlags&14680064,n|=c.flags&14680064,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)r|=c.lanes|c.childLanes,n|=c.subtreeFlags,n|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function mle(e,t,r){var n=t.pendingProps;switch(lL(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Za(t),null;case 1:return qs(t.type)&&$2(),Za(t),null;case 3:return n=t.stateNode,f_(),lo(Gs),lo(ts),yL(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(ST(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,pc!==null&&(KO(pc),pc=null))),VO(e,t),Za(t),null;case 5:gL(t);var c=Jp(Gb.current);if(r=t.type,e!==null&&t.stateNode!=null)J7(e,t,r,n,c),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(cr(166));return Za(t),null}if(e=Jp(_u.current),ST(t)){n=t.stateNode,r=t.type;var h=t.memoizedProps;switch(n[hu]=t,n[Vb]=h,e=(t.mode&1)!==0,r){case"dialog":io("cancel",n),io("close",n);break;case"iframe":case"object":case"embed":io("load",n);break;case"video":case"audio":for(c=0;c<eb.length;c++)io(eb[c],n);break;case"source":io("error",n);break;case"img":case"image":case"link":io("error",n),io("load",n);break;case"details":io("toggle",n);break;case"input":l4(n,h),io("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!h.multiple},io("invalid",n);break;case"textarea":u4(n,h),io("invalid",n)}mO(r,h),c=null;for(var p in h)if(h.hasOwnProperty(p)){var o=h[p];p==="children"?typeof o=="string"?n.textContent!==o&&(h.suppressHydrationWarning!==!0&&wT(n.textContent,o,e),c=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(h.suppressHydrationWarning!==!0&&wT(n.textContent,o,e),c=["children",""+o]):Ob.hasOwnProperty(p)&&o!=null&&p==="onScroll"&&io("scroll",n)}switch(r){case"input":pT(n),c4(n,h,!0);break;case"textarea":pT(n),h4(n);break;case"select":case"option":break;default:typeof h.onClick=="function"&&(n.onclick=V2)}n=c,t.updateQueue=n,n!==null&&(t.flags|=4)}else{p=c.nodeType===9?c:c.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=kH(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=p.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=p.createElement(r,{is:n.is}):(e=p.createElement(r),r==="select"&&(p=e,n.multiple?p.multiple=!0:n.size&&(p.size=n.size))):e=p.createElementNS(e,r),e[hu]=t,e[Vb]=n,Y7(e,t,!1,!1),t.stateNode=e;e:{switch(p=gO(r,n),r){case"dialog":io("cancel",e),io("close",e),c=n;break;case"iframe":case"object":case"embed":io("load",e),c=n;break;case"video":case"audio":for(c=0;c<eb.length;c++)io(eb[c],e);c=n;break;case"source":io("error",e),c=n;break;case"img":case"image":case"link":io("error",e),io("load",e),c=n;break;case"details":io("toggle",e),c=n;break;case"input":l4(e,n),c=uO(e,n),io("invalid",e);break;case"option":c=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},c=_o({},n,{value:void 0}),io("invalid",e);break;case"textarea":u4(e,n),c=fO(e,n),io("invalid",e);break;default:c=n}mO(r,c),o=c;for(h in o)if(o.hasOwnProperty(h)){var v=o[h];h==="style"?MH(e,v):h==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&CH(e,v)):h==="children"?typeof v=="string"?(r!=="textarea"||v!=="")&&jb(e,v):typeof v=="number"&&jb(e,""+v):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(Ob.hasOwnProperty(h)?v!=null&&h==="onScroll"&&io("scroll",e):v!=null&&WD(e,h,v,p))}switch(r){case"input":pT(e),c4(e,n,!1);break;case"textarea":pT(e),h4(e);break;case"option":n.value!=null&&e.setAttribute("value",""+pf(n.value));break;case"select":e.multiple=!!n.multiple,h=n.value,h!=null?Hy(e,!!n.multiple,h,!1):n.defaultValue!=null&&Hy(e,!!n.multiple,n.defaultValue,!0);break;default:typeof c.onClick=="function"&&(e.onclick=V2)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Za(t),null;case 6:if(e&&t.stateNode!=null)Q7(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(cr(166));if(r=Jp(Gb.current),Jp(_u.current),ST(t)){if(n=t.stateNode,r=t.memoizedProps,n[hu]=t,(h=n.nodeValue!==r)&&(e=hl,e!==null))switch(e.tag){case 3:wT(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&wT(n.nodeValue,r,(e.mode&1)!==0)}h&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[hu]=t,t.stateNode=n}return Za(t),null;case 13:if(lo(mo),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ho&&ul!==null&&t.mode&1&&!(t.flags&128))y7(),h_(),t.flags|=98560,h=!1;else if(h=ST(t),n!==null&&n.dehydrated!==null){if(e===null){if(!h)throw Error(cr(318));if(h=t.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(cr(317));h[hu]=t}else h_(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Za(t),h=!1}else pc!==null&&(KO(pc),pc=null),h=!0;if(!h)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||mo.current&1?ia===0&&(ia=3):PL())),t.updateQueue!==null&&(t.flags|=4),Za(t),null);case 4:return f_(),VO(e,t),e===null&&Bb(t.stateNode.containerInfo),Za(t),null;case 10:return dL(t.type._context),Za(t),null;case 17:return qs(t.type)&&$2(),Za(t),null;case 19:if(lo(mo),h=t.memoizedState,h===null)return Za(t),null;if(n=(t.flags&128)!==0,p=h.rendering,p===null)if(n)Tx(h,!1);else{if(ia!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(p=X2(e),p!==null){for(t.flags|=128,Tx(h,!1),n=p.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)h=r,e=n,h.flags&=14680066,p=h.alternate,p===null?(h.childLanes=0,h.lanes=e,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=p.childLanes,h.lanes=p.lanes,h.child=p.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=p.memoizedProps,h.memoizedState=p.memoizedState,h.updateQueue=p.updateQueue,h.type=p.type,e=p.dependencies,h.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Qi(mo,mo.current&1|2),t.child}e=e.sibling}h.tail!==null&&Ro()>m_&&(t.flags|=128,n=!0,Tx(h,!1),t.lanes=4194304)}else{if(!n)if(e=X2(p),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Tx(h,!0),h.tail===null&&h.tailMode==="hidden"&&!p.alternate&&!ho)return Za(t),null}else 2*Ro()-h.renderingStartTime>m_&&r!==1073741824&&(t.flags|=128,n=!0,Tx(h,!1),t.lanes=4194304);h.isBackwards?(p.sibling=t.child,t.child=p):(r=h.last,r!==null?r.sibling=p:t.child=p,h.last=p)}return h.tail!==null?(t=h.tail,h.rendering=t,h.tail=t.sibling,h.renderingStartTime=Ro(),t.sibling=null,r=mo.current,Qi(mo,n?r&1|2:r&1),t):(Za(t),null);case 22:case 23:return CL(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?ol&1073741824&&(Za(t),t.subtreeFlags&6&&(t.flags|=8192)):Za(t),null;case 24:return null;case 25:return null}throw Error(cr(156,t.tag))}function gle(e,t){switch(lL(t),t.tag){case 1:return qs(t.type)&&$2(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return f_(),lo(Gs),lo(ts),yL(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return gL(t),null;case 13:if(lo(mo),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(cr(340));h_()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return lo(mo),null;case 4:return f_(),null;case 10:return dL(t.type._context),null;case 22:case 23:return CL(),null;case 24:return null;default:return null}}var AT=!1,Xa=!1,yle=typeof WeakSet=="function"?WeakSet:Set,Dr=null;function Ry(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Ao(e,t,n)}else r.current=null}function e9(e,t,r){try{r()}catch(n){Ao(e,t,n)}}var e6=!1;function _le(e,t){if(AO=F2,e=i7(),aL(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var c=n.anchorOffset,h=n.focusNode;n=n.focusOffset;try{r.nodeType,h.nodeType}catch{r=null;break e}var p=0,o=-1,v=-1,w=0,T=0,M=e,O=null;t:for(;;){for(var D;M!==r||c!==0&&M.nodeType!==3||(o=p+c),M!==h||n!==0&&M.nodeType!==3||(v=p+n),M.nodeType===3&&(p+=M.nodeValue.length),(D=M.firstChild)!==null;)O=M,M=D;for(;;){if(M===e)break t;if(O===r&&++w===c&&(o=p),O===h&&++T===n&&(v=p),(D=M.nextSibling)!==null)break;M=O,O=M.parentNode}M=D}r=o===-1||v===-1?null:{start:o,end:v}}else r=null}r=r||{start:0,end:0}}else r=null;for(kO={focusedElem:e,selectionRange:r},F2=!1,Dr=t;Dr!==null;)if(t=Dr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Dr=e;else for(;Dr!==null;){t=Dr;try{var B=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var N=B.memoizedProps,G=B.memoizedState,V=t.stateNode,U=V.getSnapshotBeforeUpdate(t.elementType===t.type?N:cc(t.type,N),G);V.__reactInternalSnapshotBeforeUpdate=U}break;case 3:var X=t.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(cr(163))}}catch(Y){Ao(t,t.return,Y)}if(e=t.sibling,e!==null){e.return=t.return,Dr=e;break}Dr=t.return}return B=e6,e6=!1,B}function fb(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var c=n=n.next;do{if((c.tag&e)===e){var h=c.destroy;c.destroy=void 0,h!==void 0&&e9(t,r,h)}c=c.next}while(c!==n)}}function DA(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function $O(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function t9(e){var t=e.alternate;t!==null&&(e.alternate=null,t9(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[hu],delete t[Vb],delete t[MO],delete t[ele],delete t[tle])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function r9(e){return e.tag===5||e.tag===3||e.tag===4}function t6(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||r9(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function GO(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=V2));else if(n!==4&&(e=e.child,e!==null))for(GO(e,t,r),e=e.sibling;e!==null;)GO(e,t,r),e=e.sibling}function qO(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(qO(e,t,r),e=e.sibling;e!==null;)qO(e,t,r),e=e.sibling}var Da=null,hc=!1;function Rd(e,t,r){for(r=r.child;r!==null;)n9(e,t,r),r=r.sibling}function n9(e,t,r){if(yu&&typeof yu.onCommitFiberUnmount=="function")try{yu.onCommitFiberUnmount(kA,r)}catch{}switch(r.tag){case 5:Xa||Ry(r,t);case 6:var n=Da,c=hc;Da=null,Rd(e,t,r),Da=n,hc=c,Da!==null&&(hc?(e=Da,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Da.removeChild(r.stateNode));break;case 18:Da!==null&&(hc?(e=Da,r=r.stateNode,e.nodeType===8?RM(e.parentNode,r):e.nodeType===1&&RM(e,r),zb(e)):RM(Da,r.stateNode));break;case 4:n=Da,c=hc,Da=r.stateNode.containerInfo,hc=!0,Rd(e,t,r),Da=n,hc=c;break;case 0:case 11:case 14:case 15:if(!Xa&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){c=n=n.next;do{var h=c,p=h.destroy;h=h.tag,p!==void 0&&(h&2||h&4)&&e9(r,t,p),c=c.next}while(c!==n)}Rd(e,t,r);break;case 1:if(!Xa&&(Ry(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(o){Ao(r,t,o)}Rd(e,t,r);break;case 21:Rd(e,t,r);break;case 22:r.mode&1?(Xa=(n=Xa)||r.memoizedState!==null,Rd(e,t,r),Xa=n):Rd(e,t,r);break;default:Rd(e,t,r)}}function r6(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new yle),t.forEach(function(n){var c=kle.bind(null,e,n);r.has(n)||(r.add(n),n.then(c,c))})}}function rc(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var c=r[n];try{var h=e,p=t,o=p;e:for(;o!==null;){switch(o.tag){case 5:Da=o.stateNode,hc=!1;break e;case 3:Da=o.stateNode.containerInfo,hc=!0;break e;case 4:Da=o.stateNode.containerInfo,hc=!0;break e}o=o.return}if(Da===null)throw Error(cr(160));n9(h,p,c),Da=null,hc=!1;var v=c.alternate;v!==null&&(v.return=null),c.return=null}catch(w){Ao(c,t,w)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)i9(t,e),t=t.sibling}function i9(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(rc(t,e),au(e),n&4){try{fb(3,e,e.return),DA(3,e)}catch(N){Ao(e,e.return,N)}try{fb(5,e,e.return)}catch(N){Ao(e,e.return,N)}}break;case 1:rc(t,e),au(e),n&512&&r!==null&&Ry(r,r.return);break;case 5:if(rc(t,e),au(e),n&512&&r!==null&&Ry(r,r.return),e.flags&32){var c=e.stateNode;try{jb(c,"")}catch(N){Ao(e,e.return,N)}}if(n&4&&(c=e.stateNode,c!=null)){var h=e.memoizedProps,p=r!==null?r.memoizedProps:h,o=e.type,v=e.updateQueue;if(e.updateQueue=null,v!==null)try{o==="input"&&h.type==="radio"&&h.name!=null&&EH(c,h),gO(o,p);var w=gO(o,h);for(p=0;p<v.length;p+=2){var T=v[p],M=v[p+1];T==="style"?MH(c,M):T==="dangerouslySetInnerHTML"?CH(c,M):T==="children"?jb(c,M):WD(c,T,M,w)}switch(o){case"input":hO(c,h);break;case"textarea":AH(c,h);break;case"select":var O=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!h.multiple;var D=h.value;D!=null?Hy(c,!!h.multiple,D,!1):O!==!!h.multiple&&(h.defaultValue!=null?Hy(c,!!h.multiple,h.defaultValue,!0):Hy(c,!!h.multiple,h.multiple?[]:"",!1))}c[Vb]=h}catch(N){Ao(e,e.return,N)}}break;case 6:if(rc(t,e),au(e),n&4){if(e.stateNode===null)throw Error(cr(162));c=e.stateNode,h=e.memoizedProps;try{c.nodeValue=h}catch(N){Ao(e,e.return,N)}}break;case 3:if(rc(t,e),au(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{zb(t.containerInfo)}catch(N){Ao(e,e.return,N)}break;case 4:rc(t,e),au(e);break;case 13:rc(t,e),au(e),c=e.child,c.flags&8192&&(h=c.memoizedState!==null,c.stateNode.isHidden=h,!h||c.alternate!==null&&c.alternate.memoizedState!==null||(AL=Ro())),n&4&&r6(e);break;case 22:if(T=r!==null&&r.memoizedState!==null,e.mode&1?(Xa=(w=Xa)||T,rc(t,e),Xa=w):rc(t,e),au(e),n&8192){if(w=e.memoizedState!==null,(e.stateNode.isHidden=w)&&!T&&e.mode&1)for(Dr=e,T=e.child;T!==null;){for(M=Dr=T;Dr!==null;){switch(O=Dr,D=O.child,O.tag){case 0:case 11:case 14:case 15:fb(4,O,O.return);break;case 1:Ry(O,O.return);var B=O.stateNode;if(typeof B.componentWillUnmount=="function"){n=O,r=O.return;try{t=n,B.props=t.memoizedProps,B.state=t.memoizedState,B.componentWillUnmount()}catch(N){Ao(n,r,N)}}break;case 5:Ry(O,O.return);break;case 22:if(O.memoizedState!==null){i6(M);continue}}D!==null?(D.return=O,Dr=D):i6(M)}T=T.sibling}e:for(T=null,M=e;;){if(M.tag===5){if(T===null){T=M;try{c=M.stateNode,w?(h=c.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none"):(o=M.stateNode,v=M.memoizedProps.style,p=v!=null&&v.hasOwnProperty("display")?v.display:null,o.style.display=PH("display",p))}catch(N){Ao(e,e.return,N)}}}else if(M.tag===6){if(T===null)try{M.stateNode.nodeValue=w?"":M.memoizedProps}catch(N){Ao(e,e.return,N)}}else if((M.tag!==22&&M.tag!==23||M.memoizedState===null||M===e)&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===e)break e;for(;M.sibling===null;){if(M.return===null||M.return===e)break e;T===M&&(T=null),M=M.return}T===M&&(T=null),M.sibling.return=M.return,M=M.sibling}}break;case 19:rc(t,e),au(e),n&4&&r6(e);break;case 21:break;default:rc(t,e),au(e)}}function au(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(r9(r)){var n=r;break e}r=r.return}throw Error(cr(160))}switch(n.tag){case 5:var c=n.stateNode;n.flags&32&&(jb(c,""),n.flags&=-33);var h=t6(e);qO(e,h,c);break;case 3:case 4:var p=n.stateNode.containerInfo,o=t6(e);GO(e,o,p);break;default:throw Error(cr(161))}}catch(v){Ao(e,e.return,v)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function vle(e,t,r){Dr=e,o9(e)}function o9(e,t,r){for(var n=(e.mode&1)!==0;Dr!==null;){var c=Dr,h=c.child;if(c.tag===22&&n){var p=c.memoizedState!==null||AT;if(!p){var o=c.alternate,v=o!==null&&o.memoizedState!==null||Xa;o=AT;var w=Xa;if(AT=p,(Xa=v)&&!w)for(Dr=c;Dr!==null;)p=Dr,v=p.child,p.tag===22&&p.memoizedState!==null?o6(c):v!==null?(v.return=p,Dr=v):o6(c);for(;h!==null;)Dr=h,o9(h),h=h.sibling;Dr=c,AT=o,Xa=w}n6(e)}else c.subtreeFlags&8772&&h!==null?(h.return=c,Dr=h):n6(e)}}function n6(e){for(;Dr!==null;){var t=Dr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Xa||DA(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Xa)if(r===null)n.componentDidMount();else{var c=t.elementType===t.type?r.memoizedProps:cc(t.type,r.memoizedProps);n.componentDidUpdate(c,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var h=t.updateQueue;h!==null&&U4(t,h,n);break;case 3:var p=t.updateQueue;if(p!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}U4(t,p,r)}break;case 5:var o=t.stateNode;if(r===null&&t.flags&4){r=o;var v=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&r.focus();break;case"img":v.src&&(r.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var w=t.alternate;if(w!==null){var T=w.memoizedState;if(T!==null){var M=T.dehydrated;M!==null&&zb(M)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(cr(163))}Xa||t.flags&512&&$O(t)}catch(O){Ao(t,t.return,O)}}if(t===e){Dr=null;break}if(r=t.sibling,r!==null){r.return=t.return,Dr=r;break}Dr=t.return}}function i6(e){for(;Dr!==null;){var t=Dr;if(t===e){Dr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Dr=r;break}Dr=t.return}}function o6(e){for(;Dr!==null;){var t=Dr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{DA(4,t)}catch(v){Ao(t,r,v)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var c=t.return;try{n.componentDidMount()}catch(v){Ao(t,c,v)}}var h=t.return;try{$O(t)}catch(v){Ao(t,h,v)}break;case 5:var p=t.return;try{$O(t)}catch(v){Ao(t,p,v)}}}catch(v){Ao(t,t.return,v)}if(t===e){Dr=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Dr=o;break}Dr=t.return}}var xle=Math.ceil,Q2=Nh.ReactCurrentDispatcher,TL=Nh.ReactCurrentOwner,Rl=Nh.ReactCurrentBatchConfig,xi=0,va=null,Uo=null,Na=0,ol=0,Dy=xf(0),ia=0,Zb=null,mm=0,LA=0,EL=0,pb=null,Fs=null,AL=0,m_=1/0,ch=null,eE=!1,HO=null,lf=null,kT=!1,Qd=null,tE=0,mb=0,WO=null,v2=-1,x2=0;function xs(){return xi&6?Ro():v2!==-1?v2:v2=Ro()}function cf(e){return e.mode&1?xi&2&&Na!==0?Na&-Na:nle.transition!==null?(x2===0&&(x2=VH()),x2):(e=zi,e!==0||(e=window.event,e=e===void 0?16:KH(e.type)),e):1}function yc(e,t,r,n){if(50<mb)throw mb=0,WO=null,Error(cr(185));Vw(e,r,n),(!(xi&2)||e!==va)&&(e===va&&(!(xi&2)&&(LA|=r),ia===4&&Kd(e,Na)),Hs(e,n),r===1&&xi===0&&!(t.mode&1)&&(m_=Ro()+500,OA&&bf()))}function Hs(e,t){var r=e.callbackNode;nse(e,t);var n=N2(e,e===va?Na:0);if(n===0)r!==null&&p4(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&p4(r),t===1)e.tag===0?rle(a6.bind(null,e)):p7(a6.bind(null,e)),Jse(function(){!(xi&6)&&bf()}),r=null;else{switch($H(n)){case 1:r=JD;break;case 4:r=BH;break;case 16:r=z2;break;case 536870912:r=UH;break;default:r=z2}r=f9(r,a9.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function a9(e,t){if(v2=-1,x2=0,xi&6)throw Error(cr(327));var r=e.callbackNode;if(Yy()&&e.callbackNode!==r)return null;var n=N2(e,e===va?Na:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=rE(e,n);else{t=n;var c=xi;xi|=2;var h=l9();(va!==e||Na!==t)&&(ch=null,m_=Ro()+500,om(e,t));do try{Sle();break}catch(o){s9(e,o)}while(!0);hL(),Q2.current=h,xi=c,Uo!==null?t=0:(va=null,Na=0,t=ia)}if(t!==0){if(t===2&&(c=bO(e),c!==0&&(n=c,t=ZO(e,c))),t===1)throw r=Zb,om(e,0),Kd(e,n),Hs(e,Ro()),r;if(t===6)Kd(e,n);else{if(c=e.current.alternate,!(n&30)&&!ble(c)&&(t=rE(e,n),t===2&&(h=bO(e),h!==0&&(n=h,t=ZO(e,h))),t===1))throw r=Zb,om(e,0),Kd(e,n),Hs(e,Ro()),r;switch(e.finishedWork=c,e.finishedLanes=n,t){case 0:case 1:throw Error(cr(345));case 2:Bp(e,Fs,ch);break;case 3:if(Kd(e,n),(n&130023424)===n&&(t=AL+500-Ro(),10<t)){if(N2(e,0)!==0)break;if(c=e.suspendedLanes,(c&n)!==n){xs(),e.pingedLanes|=e.suspendedLanes&c;break}e.timeoutHandle=PO(Bp.bind(null,e,Fs,ch),t);break}Bp(e,Fs,ch);break;case 4:if(Kd(e,n),(n&4194240)===n)break;for(t=e.eventTimes,c=-1;0<n;){var p=31-gc(n);h=1<<p,p=t[p],p>c&&(c=p),n&=~h}if(n=c,n=Ro()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*xle(n/1960))-n,10<n){e.timeoutHandle=PO(Bp.bind(null,e,Fs,ch),n);break}Bp(e,Fs,ch);break;case 5:Bp(e,Fs,ch);break;default:throw Error(cr(329))}}}return Hs(e,Ro()),e.callbackNode===r?a9.bind(null,e):null}function ZO(e,t){var r=pb;return e.current.memoizedState.isDehydrated&&(om(e,t).flags|=256),e=rE(e,t),e!==2&&(t=Fs,Fs=r,t!==null&&KO(t)),e}function KO(e){Fs===null?Fs=e:Fs.push.apply(Fs,e)}function ble(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var c=r[n],h=c.getSnapshot;c=c.value;try{if(!vc(h(),c))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Kd(e,t){for(t&=~EL,t&=~LA,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-gc(t),n=1<<r;e[r]=-1,t&=~n}}function a6(e){if(xi&6)throw Error(cr(327));Yy();var t=N2(e,0);if(!(t&1))return Hs(e,Ro()),null;var r=rE(e,t);if(e.tag!==0&&r===2){var n=bO(e);n!==0&&(t=n,r=ZO(e,n))}if(r===1)throw r=Zb,om(e,0),Kd(e,t),Hs(e,Ro()),r;if(r===6)throw Error(cr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Bp(e,Fs,ch),Hs(e,Ro()),null}function kL(e,t){var r=xi;xi|=1;try{return e(t)}finally{xi=r,xi===0&&(m_=Ro()+500,OA&&bf())}}function gm(e){Qd!==null&&Qd.tag===0&&!(xi&6)&&Yy();var t=xi;xi|=1;var r=Rl.transition,n=zi;try{if(Rl.transition=null,zi=1,e)return e()}finally{zi=n,Rl.transition=r,xi=t,!(xi&6)&&bf()}}function CL(){ol=Dy.current,lo(Dy)}function om(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Yse(r)),Uo!==null)for(r=Uo.return;r!==null;){var n=r;switch(lL(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&$2();break;case 3:f_(),lo(Gs),lo(ts),yL();break;case 5:gL(n);break;case 4:f_();break;case 13:lo(mo);break;case 19:lo(mo);break;case 10:dL(n.type._context);break;case 22:case 23:CL()}r=r.return}if(va=e,Uo=e=uf(e.current,null),Na=ol=t,ia=0,Zb=null,EL=LA=mm=0,Fs=pb=null,Yp!==null){for(t=0;t<Yp.length;t++)if(r=Yp[t],n=r.interleaved,n!==null){r.interleaved=null;var c=n.next,h=r.pending;if(h!==null){var p=h.next;h.next=c,n.next=p}r.pending=n}Yp=null}return e}function s9(e,t){do{var r=Uo;try{if(hL(),g2.current=J2,Y2){for(var n=yo.memoizedState;n!==null;){var c=n.queue;c!==null&&(c.pending=null),n=n.next}Y2=!1}if(pm=0,ya=ra=yo=null,db=!1,qb=0,TL.current=null,r===null||r.return===null){ia=1,Zb=t,Uo=null;break}e:{var h=e,p=r.return,o=r,v=t;if(t=Na,o.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var w=v,T=o,M=T.tag;if(!(T.mode&1)&&(M===0||M===11||M===15)){var O=T.alternate;O?(T.updateQueue=O.updateQueue,T.memoizedState=O.memoizedState,T.lanes=O.lanes):(T.updateQueue=null,T.memoizedState=null)}var D=W4(p);if(D!==null){D.flags&=-257,Z4(D,p,o,h,t),D.mode&1&&H4(h,w,t),t=D,v=w;var B=t.updateQueue;if(B===null){var N=new Set;N.add(v),t.updateQueue=N}else B.add(v);break e}else{if(!(t&1)){H4(h,w,t),PL();break e}v=Error(cr(426))}}else if(ho&&o.mode&1){var G=W4(p);if(G!==null){!(G.flags&65536)&&(G.flags|=256),Z4(G,p,o,h,t),cL(p_(v,o));break e}}h=v=p_(v,o),ia!==4&&(ia=2),pb===null?pb=[h]:pb.push(h),h=p;do{switch(h.tag){case 3:h.flags|=65536,t&=-t,h.lanes|=t;var V=$7(h,v,t);B4(h,V);break e;case 1:o=v;var U=h.type,X=h.stateNode;if(!(h.flags&128)&&(typeof U.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(lf===null||!lf.has(X)))){h.flags|=65536,t&=-t,h.lanes|=t;var Y=G7(h,o,t);B4(h,Y);break e}}h=h.return}while(h!==null)}u9(r)}catch(ne){t=ne,Uo===r&&r!==null&&(Uo=r=r.return);continue}break}while(!0)}function l9(){var e=Q2.current;return Q2.current=J2,e===null?J2:e}function PL(){(ia===0||ia===3||ia===2)&&(ia=4),va===null||!(mm&268435455)&&!(LA&268435455)||Kd(va,Na)}function rE(e,t){var r=xi;xi|=2;var n=l9();(va!==e||Na!==t)&&(ch=null,om(e,t));do try{wle();break}catch(c){s9(e,c)}while(!0);if(hL(),xi=r,Q2.current=n,Uo!==null)throw Error(cr(261));return va=null,Na=0,ia}function wle(){for(;Uo!==null;)c9(Uo)}function Sle(){for(;Uo!==null&&!Zae();)c9(Uo)}function c9(e){var t=d9(e.alternate,e,ol);e.memoizedProps=e.pendingProps,t===null?u9(e):Uo=t,TL.current=null}function u9(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=gle(r,t),r!==null){r.flags&=32767,Uo=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ia=6,Uo=null;return}}else if(r=mle(r,t,ol),r!==null){Uo=r;return}if(t=t.sibling,t!==null){Uo=t;return}Uo=t=e}while(t!==null);ia===0&&(ia=5)}function Bp(e,t,r){var n=zi,c=Rl.transition;try{Rl.transition=null,zi=1,Tle(e,t,r,n)}finally{Rl.transition=c,zi=n}return null}function Tle(e,t,r,n){do Yy();while(Qd!==null);if(xi&6)throw Error(cr(327));r=e.finishedWork;var c=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(cr(177));e.callbackNode=null,e.callbackPriority=0;var h=r.lanes|r.childLanes;if(ise(e,h),e===va&&(Uo=va=null,Na=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||kT||(kT=!0,f9(z2,function(){return Yy(),null})),h=(r.flags&15990)!==0,r.subtreeFlags&15990||h){h=Rl.transition,Rl.transition=null;var p=zi;zi=1;var o=xi;xi|=4,TL.current=null,_le(e,r),i9(r,e),Gse(kO),F2=!!AO,kO=AO=null,e.current=r,vle(r),Kae(),xi=o,zi=p,Rl.transition=h}else e.current=r;if(kT&&(kT=!1,Qd=e,tE=c),h=e.pendingLanes,h===0&&(lf=null),Jae(r.stateNode),Hs(e,Ro()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)c=t[r],n(c.value,{componentStack:c.stack,digest:c.digest});if(eE)throw eE=!1,e=HO,HO=null,e;return tE&1&&e.tag!==0&&Yy(),h=e.pendingLanes,h&1?e===WO?mb++:(mb=0,WO=e):mb=0,bf(),null}function Yy(){if(Qd!==null){var e=$H(tE),t=Rl.transition,r=zi;try{if(Rl.transition=null,zi=16>e?16:e,Qd===null)var n=!1;else{if(e=Qd,Qd=null,tE=0,xi&6)throw Error(cr(331));var c=xi;for(xi|=4,Dr=e.current;Dr!==null;){var h=Dr,p=h.child;if(Dr.flags&16){var o=h.deletions;if(o!==null){for(var v=0;v<o.length;v++){var w=o[v];for(Dr=w;Dr!==null;){var T=Dr;switch(T.tag){case 0:case 11:case 15:fb(8,T,h)}var M=T.child;if(M!==null)M.return=T,Dr=M;else for(;Dr!==null;){T=Dr;var O=T.sibling,D=T.return;if(t9(T),T===w){Dr=null;break}if(O!==null){O.return=D,Dr=O;break}Dr=D}}}var B=h.alternate;if(B!==null){var N=B.child;if(N!==null){B.child=null;do{var G=N.sibling;N.sibling=null,N=G}while(N!==null)}}Dr=h}}if(h.subtreeFlags&2064&&p!==null)p.return=h,Dr=p;else e:for(;Dr!==null;){if(h=Dr,h.flags&2048)switch(h.tag){case 0:case 11:case 15:fb(9,h,h.return)}var V=h.sibling;if(V!==null){V.return=h.return,Dr=V;break e}Dr=h.return}}var U=e.current;for(Dr=U;Dr!==null;){p=Dr;var X=p.child;if(p.subtreeFlags&2064&&X!==null)X.return=p,Dr=X;else e:for(p=U;Dr!==null;){if(o=Dr,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:DA(9,o)}}catch(ne){Ao(o,o.return,ne)}if(o===p){Dr=null;break e}var Y=o.sibling;if(Y!==null){Y.return=o.return,Dr=Y;break e}Dr=o.return}}if(xi=c,bf(),yu&&typeof yu.onPostCommitFiberRoot=="function")try{yu.onPostCommitFiberRoot(kA,e)}catch{}n=!0}return n}finally{zi=r,Rl.transition=t}}return!1}function s6(e,t,r){t=p_(r,t),t=$7(e,t,1),e=sf(e,t,1),t=xs(),e!==null&&(Vw(e,1,t),Hs(e,t))}function Ao(e,t,r){if(e.tag===3)s6(e,e,r);else for(;t!==null;){if(t.tag===3){s6(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(lf===null||!lf.has(n))){e=p_(r,e),e=G7(t,e,1),t=sf(t,e,1),e=xs(),t!==null&&(Vw(t,1,e),Hs(t,e));break}}t=t.return}}function Ele(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=xs(),e.pingedLanes|=e.suspendedLanes&r,va===e&&(Na&r)===r&&(ia===4||ia===3&&(Na&130023424)===Na&&500>Ro()-AL?om(e,0):EL|=r),Hs(e,t)}function h9(e,t){t===0&&(e.mode&1?(t=yT,yT<<=1,!(yT&130023424)&&(yT=4194304)):t=1);var r=xs();e=Th(e,t),e!==null&&(Vw(e,t,r),Hs(e,r))}function Ale(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),h9(e,r)}function kle(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,c=e.memoizedState;c!==null&&(r=c.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(cr(314))}n!==null&&n.delete(t),h9(e,r)}var d9;d9=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Gs.current)Us=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Us=!1,ple(e,t,r);Us=!!(e.flags&131072)}else Us=!1,ho&&t.flags&1048576&&m7(t,H2,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;_2(e,t),e=t.pendingProps;var c=u_(t,ts.current);Xy(t,r),c=vL(null,t,n,e,c,r);var h=xL();return t.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,qs(n)?(h=!0,G2(t)):h=!1,t.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,pL(t),c.updater=RA,t.stateNode=c,c._reactInternals=t,LO(t,n,e,r),t=FO(null,t,n,!0,h,r)):(t.tag=0,ho&&h&&sL(t),fs(null,t,c,r),t=t.child),t;case 16:n=t.elementType;e:{switch(_2(e,t),e=t.pendingProps,c=n._init,n=c(n._payload),t.type=n,c=t.tag=Ple(n),e=cc(n,e),c){case 0:t=NO(null,t,n,e,r);break e;case 1:t=Y4(null,t,n,e,r);break e;case 11:t=K4(null,t,n,e,r);break e;case 14:t=X4(null,t,n,cc(n.type,e),r);break e}throw Error(cr(306,n,""))}return t;case 0:return n=t.type,c=t.pendingProps,c=t.elementType===n?c:cc(n,c),NO(e,t,n,c,r);case 1:return n=t.type,c=t.pendingProps,c=t.elementType===n?c:cc(n,c),Y4(e,t,n,c,r);case 3:e:{if(Z7(t),e===null)throw Error(cr(387));n=t.pendingProps,h=t.memoizedState,c=h.element,b7(e,t),K2(t,n,null,r);var p=t.memoizedState;if(n=p.element,h.isDehydrated)if(h={element:n,isDehydrated:!1,cache:p.cache,pendingSuspenseBoundaries:p.pendingSuspenseBoundaries,transitions:p.transitions},t.updateQueue.baseState=h,t.memoizedState=h,t.flags&256){c=p_(Error(cr(423)),t),t=J4(e,t,n,r,c);break e}else if(n!==c){c=p_(Error(cr(424)),t),t=J4(e,t,n,r,c);break e}else for(ul=af(t.stateNode.containerInfo.firstChild),hl=t,ho=!0,pc=null,r=v7(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(h_(),n===c){t=Eh(e,t,r);break e}fs(e,t,n,r)}t=t.child}return t;case 5:return w7(t),e===null&&jO(t),n=t.type,c=t.pendingProps,h=e!==null?e.memoizedProps:null,p=c.children,CO(n,c)?p=null:h!==null&&CO(n,h)&&(t.flags|=32),W7(e,t),fs(e,t,p,r),t.child;case 6:return e===null&&jO(t),null;case 13:return K7(e,t,r);case 4:return mL(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=d_(t,null,n,r):fs(e,t,n,r),t.child;case 11:return n=t.type,c=t.pendingProps,c=t.elementType===n?c:cc(n,c),K4(e,t,n,c,r);case 7:return fs(e,t,t.pendingProps,r),t.child;case 8:return fs(e,t,t.pendingProps.children,r),t.child;case 12:return fs(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,c=t.pendingProps,h=t.memoizedProps,p=c.value,Qi(W2,n._currentValue),n._currentValue=p,h!==null)if(vc(h.value,p)){if(h.children===c.children&&!Gs.current){t=Eh(e,t,r);break e}}else for(h=t.child,h!==null&&(h.return=t);h!==null;){var o=h.dependencies;if(o!==null){p=h.child;for(var v=o.firstContext;v!==null;){if(v.context===n){if(h.tag===1){v=vh(-1,r&-r),v.tag=2;var w=h.updateQueue;if(w!==null){w=w.shared;var T=w.pending;T===null?v.next=v:(v.next=T.next,T.next=v),w.pending=v}}h.lanes|=r,v=h.alternate,v!==null&&(v.lanes|=r),RO(h.return,r,t),o.lanes|=r;break}v=v.next}}else if(h.tag===10)p=h.type===t.type?null:h.child;else if(h.tag===18){if(p=h.return,p===null)throw Error(cr(341));p.lanes|=r,o=p.alternate,o!==null&&(o.lanes|=r),RO(p,r,t),p=h.sibling}else p=h.child;if(p!==null)p.return=h;else for(p=h;p!==null;){if(p===t){p=null;break}if(h=p.sibling,h!==null){h.return=p.return,p=h;break}p=p.return}h=p}fs(e,t,c.children,r),t=t.child}return t;case 9:return c=t.type,n=t.pendingProps.children,Xy(t,r),c=zl(c),n=n(c),t.flags|=1,fs(e,t,n,r),t.child;case 14:return n=t.type,c=cc(n,t.pendingProps),c=cc(n.type,c),X4(e,t,n,c,r);case 15:return q7(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,c=t.pendingProps,c=t.elementType===n?c:cc(n,c),_2(e,t),t.tag=1,qs(n)?(e=!0,G2(t)):e=!1,Xy(t,r),V7(t,n,c),LO(t,n,c,r),FO(null,t,n,!0,e,r);case 19:return X7(e,t,r);case 22:return H7(e,t,r)}throw Error(cr(156,t.tag))};function f9(e,t){return FH(e,t)}function Cle(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ol(e,t,r,n){return new Cle(e,t,r,n)}function ML(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Ple(e){if(typeof e=="function")return ML(e)?1:0;if(e!=null){if(e=e.$$typeof,e===KD)return 11;if(e===XD)return 14}return 2}function uf(e,t){var r=e.alternate;return r===null?(r=Ol(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function b2(e,t,r,n,c,h){var p=2;if(n=e,typeof e=="function")ML(e)&&(p=1);else if(typeof e=="string")p=5;else e:switch(e){case Ey:return am(r.children,c,h,t);case ZD:p=8,c|=8;break;case aO:return e=Ol(12,r,t,c|2),e.elementType=aO,e.lanes=h,e;case sO:return e=Ol(13,r,t,c),e.elementType=sO,e.lanes=h,e;case lO:return e=Ol(19,r,t,c),e.elementType=lO,e.lanes=h,e;case wH:return zA(r,c,h,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case xH:p=10;break e;case bH:p=9;break e;case KD:p=11;break e;case XD:p=14;break e;case $d:p=16,n=null;break e}throw Error(cr(130,e==null?e:typeof e,""))}return t=Ol(p,r,t,c),t.elementType=e,t.type=n,t.lanes=h,t}function am(e,t,r,n){return e=Ol(7,e,n,t),e.lanes=r,e}function zA(e,t,r,n){return e=Ol(22,e,n,t),e.elementType=wH,e.lanes=r,e.stateNode={isHidden:!1},e}function VM(e,t,r){return e=Ol(6,e,null,t),e.lanes=r,e}function $M(e,t,r){return t=Ol(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Mle(e,t,r,n,c){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=SM(0),this.expirationTimes=SM(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=SM(0),this.identifierPrefix=n,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function IL(e,t,r,n,c,h,p,o,v){return e=new Mle(e,t,r,o,v),t===1?(t=1,h===!0&&(t|=8)):t=0,h=Ol(3,null,null,t),e.current=h,h.stateNode=e,h.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},pL(h),e}function Ile(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ty,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function p9(e){if(!e)return mf;e=e._reactInternals;e:{if(Im(e)!==e||e.tag!==1)throw Error(cr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(qs(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(cr(171))}if(e.tag===1){var r=e.type;if(qs(r))return f7(e,r,t)}return t}function m9(e,t,r,n,c,h,p,o,v){return e=IL(r,n,!0,e,c,h,p,o,v),e.context=p9(null),r=e.current,n=xs(),c=cf(r),h=vh(n,c),h.callback=t??null,sf(r,h,c),e.current.lanes=c,Vw(e,c,n),Hs(e,n),e}function NA(e,t,r,n){var c=t.current,h=xs(),p=cf(c);return r=p9(r),t.context===null?t.context=r:t.pendingContext=r,t=vh(h,p),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=sf(c,t,p),e!==null&&(yc(e,c,p,h),m2(e,c,p)),p}function nE(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function l6(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function OL(e,t){l6(e,t),(e=e.alternate)&&l6(e,t)}function Ole(){return null}var g9=typeof reportError=="function"?reportError:function(e){console.error(e)};function jL(e){this._internalRoot=e}FA.prototype.render=jL.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(cr(409));NA(e,t,null,null)};FA.prototype.unmount=jL.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;gm(function(){NA(null,e,null,null)}),t[Sh]=null}};function FA(e){this._internalRoot=e}FA.prototype.unstable_scheduleHydration=function(e){if(e){var t=HH();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Zd.length&&t!==0&&t<Zd[r].priority;r++);Zd.splice(r,0,e),r===0&&ZH(e)}};function RL(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function BA(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function c6(){}function jle(e,t,r,n,c){if(c){if(typeof n=="function"){var h=n;n=function(){var w=nE(p);h.call(w)}}var p=m9(t,n,e,0,null,!1,!1,"",c6);return e._reactRootContainer=p,e[Sh]=p.current,Bb(e.nodeType===8?e.parentNode:e),gm(),p}for(;c=e.lastChild;)e.removeChild(c);if(typeof n=="function"){var o=n;n=function(){var w=nE(v);o.call(w)}}var v=IL(e,0,!1,null,null,!1,!1,"",c6);return e._reactRootContainer=v,e[Sh]=v.current,Bb(e.nodeType===8?e.parentNode:e),gm(function(){NA(t,v,r,n)}),v}function UA(e,t,r,n,c){var h=r._reactRootContainer;if(h){var p=h;if(typeof c=="function"){var o=c;c=function(){var v=nE(p);o.call(v)}}NA(t,p,e,c)}else p=jle(r,t,e,c,n);return nE(p)}GH=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Qx(t.pendingLanes);r!==0&&(QD(t,r|1),Hs(t,Ro()),!(xi&6)&&(m_=Ro()+500,bf()))}break;case 13:gm(function(){var n=Th(e,1);if(n!==null){var c=xs();yc(n,e,1,c)}}),OL(e,1)}};eL=function(e){if(e.tag===13){var t=Th(e,134217728);if(t!==null){var r=xs();yc(t,e,134217728,r)}OL(e,134217728)}};qH=function(e){if(e.tag===13){var t=cf(e),r=Th(e,t);if(r!==null){var n=xs();yc(r,e,t,n)}OL(e,t)}};HH=function(){return zi};WH=function(e,t){var r=zi;try{return zi=e,t()}finally{zi=r}};_O=function(e,t,r){switch(t){case"input":if(hO(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var c=IA(n);if(!c)throw Error(cr(90));TH(n),hO(n,c)}}}break;case"textarea":AH(e,r);break;case"select":t=r.value,t!=null&&Hy(e,!!r.multiple,t,!1)}};jH=kL;RH=gm;var Rle={usingClientEntryPoint:!1,Events:[Gw,Py,IA,IH,OH,kL]},Ex={findFiberByHostInstance:Xp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Dle={bundleType:Ex.bundleType,version:Ex.version,rendererPackageName:Ex.rendererPackageName,rendererConfig:Ex.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Nh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=zH(e),e===null?null:e.stateNode},findFiberByHostInstance:Ex.findFiberByHostInstance||Ole,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var CT=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!CT.isDisabled&&CT.supportsFiber)try{kA=CT.inject(Dle),yu=CT}catch{}}ml.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rle;ml.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!RL(t))throw Error(cr(200));return Ile(e,t,null,r)};ml.createRoot=function(e,t){if(!RL(e))throw Error(cr(299));var r=!1,n="",c=g9;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=IL(e,1,!1,null,null,r,!1,n,c),e[Sh]=t.current,Bb(e.nodeType===8?e.parentNode:e),new jL(t)};ml.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(cr(188)):(e=Object.keys(e).join(","),Error(cr(268,e)));return e=zH(t),e=e===null?null:e.stateNode,e};ml.flushSync=function(e){return gm(e)};ml.hydrate=function(e,t,r){if(!BA(t))throw Error(cr(200));return UA(null,e,t,!0,r)};ml.hydrateRoot=function(e,t,r){if(!RL(e))throw Error(cr(405));var n=r!=null&&r.hydratedSources||null,c=!1,h="",p=g9;if(r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),t=m9(t,null,e,1,r??null,c,!1,h,p),e[Sh]=t.current,Bb(e),n)for(e=0;e<n.length;e++)r=n[e],c=r._getVersion,c=c(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,c]:t.mutableSourceEagerHydrationData.push(r,c);return new FA(t)};ml.render=function(e,t,r){if(!BA(t))throw Error(cr(200));return UA(null,e,t,!1,r)};ml.unmountComponentAtNode=function(e){if(!BA(e))throw Error(cr(40));return e._reactRootContainer?(gm(function(){UA(null,null,e,!1,function(){e._reactRootContainer=null,e[Sh]=null})}),!0):!1};ml.unstable_batchedUpdates=kL;ml.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!BA(r))throw Error(cr(200));if(e==null||e._reactInternals===void 0)throw Error(cr(38));return UA(e,t,r,!1,n)};ml.version="18.3.1-next-f1338f8080-20240426";function y9(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(y9)}catch(e){console.error(e)}}y9(),gH.exports=ml;var Om=gH.exports;const _9=ki(Om);var v9,u6=Om;v9=u6.createRoot,u6.hydrateRoot;const Lle=1,zle=1e6;let GM=0;function Nle(){return GM=(GM+1)%Number.MAX_SAFE_INTEGER,GM.toString()}const qM=new Map,h6=e=>{if(qM.has(e))return;const t=setTimeout(()=>{qM.delete(e),gb({type:"REMOVE_TOAST",toastId:e})},zle);qM.set(e,t)},Fle=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,Lle)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?h6(r):e.toasts.forEach(n=>{h6(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},w2=[];let S2={toasts:[]};function gb(e){S2=Fle(S2,e),w2.forEach(t=>{t(S2)})}function XO({...e}){const t=Nle(),r=c=>gb({type:"UPDATE_TOAST",toast:{...c,id:t}}),n=()=>gb({type:"DISMISS_TOAST",toastId:t});return gb({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:c=>{c||n()}}}),{id:t,dismiss:n,update:r}}function DL(){const[e,t]=Z.useState(S2);return Z.useEffect(()=>(w2.push(t),()=>{const r=w2.indexOf(t);r>-1&&w2.splice(r,1)}),[e]),{...e,toast:XO,dismiss:r=>gb({type:"DISMISS_TOAST",toastId:r})}}function Zr(e,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(e?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}function d6(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function x9(...e){return t=>{let r=!1;const n=e.map(c=>{const h=d6(c,t);return!r&&typeof h=="function"&&(r=!0),h});if(r)return()=>{for(let c=0;c<n.length;c++){const h=n[c];typeof h=="function"?h():d6(e[c],null)}}}}function yi(...e){return Z.useCallback(x9(...e),e)}function Ble(e,t){const r=Z.createContext(t),n=h=>{const{children:p,...o}=h,v=Z.useMemo(()=>o,Object.values(o));return C.jsx(r.Provider,{value:v,children:p})};n.displayName=e+"Provider";function c(h){const p=Z.useContext(r);if(p)return p;if(t!==void 0)return t;throw new Error(`\`${h}\` must be used within \`${e}\``)}return[n,c]}function wc(e,t=[]){let r=[];function n(h,p){const o=Z.createContext(p),v=r.length;r=[...r,p];const w=M=>{const{scope:O,children:D,...B}=M,N=O?.[e]?.[v]||o,G=Z.useMemo(()=>B,Object.values(B));return C.jsx(N.Provider,{value:G,children:D})};w.displayName=h+"Provider";function T(M,O){const D=O?.[e]?.[v]||o,B=Z.useContext(D);if(B)return B;if(p!==void 0)return p;throw new Error(`\`${M}\` must be used within \`${h}\``)}return[w,T]}const c=()=>{const h=r.map(p=>Z.createContext(p));return function(p){const o=p?.[e]||h;return Z.useMemo(()=>({[`__scope${e}`]:{...p,[e]:o}}),[p,o])}};return c.scopeName=e,[n,Ule(c,...t)]}function Ule(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(c){const h=n.reduce((p,{useScope:o,scopeName:v})=>{const w=o(c)[`__scope${v}`];return{...p,...w}},{});return Z.useMemo(()=>({[`__scope${t.scopeName}`]:h}),[h])}};return r.scopeName=t.scopeName,r}function g_(e){const t=$le(e),r=Z.forwardRef((n,c)=>{const{children:h,...p}=n,o=Z.Children.toArray(h),v=o.find(qle);if(v){const w=v.props.children,T=o.map(M=>M===v?Z.Children.count(w)>1?Z.Children.only(null):Z.isValidElement(w)?w.props.children:null:M);return C.jsx(t,{...p,ref:c,children:Z.isValidElement(w)?Z.cloneElement(w,void 0,T):null})}return C.jsx(t,{...p,ref:c,children:h})});return r.displayName=`${e}.Slot`,r}var Vle=g_("Slot");function $le(e){const t=Z.forwardRef((r,n)=>{const{children:c,...h}=r;if(Z.isValidElement(c)){const p=Wle(c),o=Hle(h,c.props);return c.type!==Z.Fragment&&(o.ref=n?x9(n,p):p),Z.cloneElement(c,o)}return Z.Children.count(c)>1?Z.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var b9=Symbol("radix.slottable");function Gle(e){const t=({children:r})=>C.jsx(C.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=b9,t}function qle(e){return Z.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===b9}function Hle(e,t){const r={...t};for(const n in t){const c=e[n],h=t[n];/^on[A-Z]/.test(n)?c&&h?r[n]=(...p)=>{const o=h(...p);return c(...p),o}:c&&(r[n]=c):n==="style"?r[n]={...c,...h}:n==="className"&&(r[n]=[c,h].filter(Boolean).join(" "))}return{...e,...r}}function Wle(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function LL(e){const t=e+"CollectionProvider",[r,n]=wc(t),[c,h]=r(t,{collectionRef:{current:null},itemMap:new Map}),p=N=>{const{scope:G,children:V}=N,U=Ne.useRef(null),X=Ne.useRef(new Map).current;return C.jsx(c,{scope:G,itemMap:X,collectionRef:U,children:V})};p.displayName=t;const o=e+"CollectionSlot",v=g_(o),w=Ne.forwardRef((N,G)=>{const{scope:V,children:U}=N,X=h(o,V),Y=yi(G,X.collectionRef);return C.jsx(v,{ref:Y,children:U})});w.displayName=o;const T=e+"CollectionItemSlot",M="data-radix-collection-item",O=g_(T),D=Ne.forwardRef((N,G)=>{const{scope:V,children:U,...X}=N,Y=Ne.useRef(null),ne=yi(G,Y),se=h(T,V);return Ne.useEffect(()=>(se.itemMap.set(Y,{ref:Y,...X}),()=>void se.itemMap.delete(Y))),C.jsx(O,{[M]:"",ref:ne,children:U})});D.displayName=T;function B(N){const G=h(e+"CollectionConsumer",N);return Ne.useCallback(()=>{const V=G.collectionRef.current;if(!V)return[];const U=Array.from(V.querySelectorAll(`[${M}]`));return Array.from(G.itemMap.values()).sort((X,Y)=>U.indexOf(X.ref.current)-U.indexOf(Y.ref.current))},[G.collectionRef,G.itemMap])}return[{Provider:p,Slot:w,ItemSlot:D},B,n]}var Zle=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],fn=Zle.reduce((e,t)=>{const r=g_(`Primitive.${t}`),n=Z.forwardRef((c,h)=>{const{asChild:p,...o}=c,v=p?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),C.jsx(v,{...o,ref:h})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function w9(e,t){e&&Om.flushSync(()=>e.dispatchEvent(t))}function na(e){const t=Z.useRef(e);return Z.useEffect(()=>{t.current=e}),Z.useMemo(()=>(...r)=>t.current?.(...r),[])}function Kle(e,t=globalThis?.document){const r=na(e);Z.useEffect(()=>{const n=c=>{c.key==="Escape"&&r(c)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var Xle="DismissableLayer",YO="dismissableLayer.update",Yle="dismissableLayer.pointerDownOutside",Jle="dismissableLayer.focusOutside",f6,S9=Z.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Hw=Z.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:c,onFocusOutside:h,onInteractOutside:p,onDismiss:o,...v}=e,w=Z.useContext(S9),[T,M]=Z.useState(null),O=T?.ownerDocument??globalThis?.document,[,D]=Z.useState({}),B=yi(t,le=>M(le)),N=Array.from(w.layers),[G]=[...w.layersWithOutsidePointerEventsDisabled].slice(-1),V=N.indexOf(G),U=T?N.indexOf(T):-1,X=w.layersWithOutsidePointerEventsDisabled.size>0,Y=U>=V,ne=ece(le=>{const ge=le.target,je=[...w.branches].some(ze=>ze.contains(ge));!Y||je||(c?.(le),p?.(le),le.defaultPrevented||o?.())},O),se=tce(le=>{const ge=le.target;[...w.branches].some(je=>je.contains(ge))||(h?.(le),p?.(le),le.defaultPrevented||o?.())},O);return Kle(le=>{U===w.layers.size-1&&(n?.(le),!le.defaultPrevented&&o&&(le.preventDefault(),o()))},O),Z.useEffect(()=>{if(T)return r&&(w.layersWithOutsidePointerEventsDisabled.size===0&&(f6=O.body.style.pointerEvents,O.body.style.pointerEvents="none"),w.layersWithOutsidePointerEventsDisabled.add(T)),w.layers.add(T),p6(),()=>{r&&w.layersWithOutsidePointerEventsDisabled.size===1&&(O.body.style.pointerEvents=f6)}},[T,O,r,w]),Z.useEffect(()=>()=>{T&&(w.layers.delete(T),w.layersWithOutsidePointerEventsDisabled.delete(T),p6())},[T,w]),Z.useEffect(()=>{const le=()=>D({});return document.addEventListener(YO,le),()=>document.removeEventListener(YO,le)},[]),C.jsx(fn.div,{...v,ref:B,style:{pointerEvents:X?Y?"auto":"none":void 0,...e.style},onFocusCapture:Zr(e.onFocusCapture,se.onFocusCapture),onBlurCapture:Zr(e.onBlurCapture,se.onBlurCapture),onPointerDownCapture:Zr(e.onPointerDownCapture,ne.onPointerDownCapture)})});Hw.displayName=Xle;var Qle="DismissableLayerBranch",T9=Z.forwardRef((e,t)=>{const r=Z.useContext(S9),n=Z.useRef(null),c=yi(t,n);return Z.useEffect(()=>{const h=n.current;if(h)return r.branches.add(h),()=>{r.branches.delete(h)}},[r.branches]),C.jsx(fn.div,{...e,ref:c})});T9.displayName=Qle;function ece(e,t=globalThis?.document){const r=na(e),n=Z.useRef(!1),c=Z.useRef(()=>{});return Z.useEffect(()=>{const h=o=>{if(o.target&&!n.current){let v=function(){E9(Yle,r,w,{discrete:!0})};const w={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",c.current),c.current=v,t.addEventListener("click",c.current,{once:!0})):v()}else t.removeEventListener("click",c.current);n.current=!1},p=window.setTimeout(()=>{t.addEventListener("pointerdown",h)},0);return()=>{window.clearTimeout(p),t.removeEventListener("pointerdown",h),t.removeEventListener("click",c.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function tce(e,t=globalThis?.document){const r=na(e),n=Z.useRef(!1);return Z.useEffect(()=>{const c=h=>{h.target&&!n.current&&E9(Jle,r,{originalEvent:h},{discrete:!1})};return t.addEventListener("focusin",c),()=>t.removeEventListener("focusin",c)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function p6(){const e=new CustomEvent(YO);document.dispatchEvent(e)}function E9(e,t,r,{discrete:n}){const c=r.originalEvent.target,h=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&c.addEventListener(e,t,{once:!0}),n?w9(c,h):c.dispatchEvent(h)}var rce=Hw,nce=T9,xa=globalThis?.document?Z.useLayoutEffect:()=>{},ice="Portal",VA=Z.forwardRef((e,t)=>{const{container:r,...n}=e,[c,h]=Z.useState(!1);xa(()=>h(!0),[]);const p=r||c&&globalThis?.document?.body;return p?_9.createPortal(C.jsx(fn.div,{...n,ref:t}),p):null});VA.displayName=ice;function oce(e,t){return Z.useReducer((r,n)=>t[r][n]??r,e)}var Sc=e=>{const{present:t,children:r}=e,n=ace(t),c=typeof r=="function"?r({present:n.isPresent}):Z.Children.only(r),h=yi(n.ref,sce(c));return typeof r=="function"||n.isPresent?Z.cloneElement(c,{ref:h}):null};Sc.displayName="Presence";function ace(e){const[t,r]=Z.useState(),n=Z.useRef(null),c=Z.useRef(e),h=Z.useRef("none"),p=e?"mounted":"unmounted",[o,v]=oce(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Z.useEffect(()=>{const w=PT(n.current);h.current=o==="mounted"?w:"none"},[o]),xa(()=>{const w=n.current,T=c.current;if(T!==e){const M=h.current,O=PT(w);e?v("MOUNT"):O==="none"||w?.display==="none"?v("UNMOUNT"):v(T&&M!==O?"ANIMATION_OUT":"UNMOUNT"),c.current=e}},[e,v]),xa(()=>{if(t){let w;const T=t.ownerDocument.defaultView??window,M=D=>{const B=PT(n.current).includes(CSS.escape(D.animationName));if(D.target===t&&B&&(v("ANIMATION_END"),!c.current)){const N=t.style.animationFillMode;t.style.animationFillMode="forwards",w=T.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=N)})}},O=D=>{D.target===t&&(h.current=PT(n.current))};return t.addEventListener("animationstart",O),t.addEventListener("animationcancel",M),t.addEventListener("animationend",M),()=>{T.clearTimeout(w),t.removeEventListener("animationstart",O),t.removeEventListener("animationcancel",M),t.removeEventListener("animationend",M)}}else v("ANIMATION_END")},[t,v]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:Z.useCallback(w=>{n.current=w?getComputedStyle(w):null,r(w)},[])}}function PT(e){return e?.animationName||"none"}function sce(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var lce=GD[" useInsertionEffect ".trim().toString()]||xa;function ym({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[c,h,p]=cce({defaultProp:t,onChange:r}),o=e!==void 0,v=o?e:c;{const T=Z.useRef(e!==void 0);Z.useEffect(()=>{const M=T.current;M!==o&&console.warn(`${n} is changing from ${M?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),T.current=o},[o,n])}const w=Z.useCallback(T=>{if(o){const M=uce(T)?T(e):T;M!==e&&p.current?.(M)}else h(T)},[o,e,h,p]);return[v,w]}function cce({defaultProp:e,onChange:t}){const[r,n]=Z.useState(e),c=Z.useRef(r),h=Z.useRef(t);return lce(()=>{h.current=t},[t]),Z.useEffect(()=>{c.current!==r&&(h.current?.(r),c.current=r)},[r,c]),[r,n,h]}function uce(e){return typeof e=="function"}var A9=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),hce="VisuallyHidden",$A=Z.forwardRef((e,t)=>C.jsx(fn.span,{...e,ref:t,style:{...A9,...e.style}}));$A.displayName=hce;var dce=$A,zL="ToastProvider",[NL,fce,pce]=LL("Toast"),[k9,Jqe]=wc("Toast",[pce]),[mce,GA]=k9(zL),C9=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:c="right",swipeThreshold:h=50,children:p}=e,[o,v]=Z.useState(null),[w,T]=Z.useState(0),M=Z.useRef(!1),O=Z.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${zL}\`. Expected non-empty \`string\`.`),C.jsx(NL.Provider,{scope:t,children:C.jsx(mce,{scope:t,label:r,duration:n,swipeDirection:c,swipeThreshold:h,toastCount:w,viewport:o,onViewportChange:v,onToastAdd:Z.useCallback(()=>T(D=>D+1),[]),onToastRemove:Z.useCallback(()=>T(D=>D-1),[]),isFocusedToastEscapeKeyDownRef:M,isClosePausedRef:O,children:p})})};C9.displayName=zL;var P9="ToastViewport",gce=["F8"],JO="toast.viewportPause",QO="toast.viewportResume",M9=Z.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=gce,label:c="Notifications ({hotkey})",...h}=e,p=GA(P9,r),o=fce(r),v=Z.useRef(null),w=Z.useRef(null),T=Z.useRef(null),M=Z.useRef(null),O=yi(t,M,p.onViewportChange),D=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),B=p.toastCount>0;Z.useEffect(()=>{const G=V=>{n.length!==0&&n.every(U=>V[U]||V.code===U)&&M.current?.focus()};return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[n]),Z.useEffect(()=>{const G=v.current,V=M.current;if(B&&G&&V){const U=()=>{if(!p.isClosePausedRef.current){const se=new CustomEvent(JO);V.dispatchEvent(se),p.isClosePausedRef.current=!0}},X=()=>{if(p.isClosePausedRef.current){const se=new CustomEvent(QO);V.dispatchEvent(se),p.isClosePausedRef.current=!1}},Y=se=>{!G.contains(se.relatedTarget)&&X()},ne=()=>{G.contains(document.activeElement)||X()};return G.addEventListener("focusin",U),G.addEventListener("focusout",Y),G.addEventListener("pointermove",U),G.addEventListener("pointerleave",ne),window.addEventListener("blur",U),window.addEventListener("focus",X),()=>{G.removeEventListener("focusin",U),G.removeEventListener("focusout",Y),G.removeEventListener("pointermove",U),G.removeEventListener("pointerleave",ne),window.removeEventListener("blur",U),window.removeEventListener("focus",X)}}},[B,p.isClosePausedRef]);const N=Z.useCallback(({tabbingDirection:G})=>{const V=o().map(U=>{const X=U.ref.current,Y=[X,...Pce(X)];return G==="forwards"?Y:Y.reverse()});return(G==="forwards"?V.reverse():V).flat()},[o]);return Z.useEffect(()=>{const G=M.current;if(G){const V=U=>{const X=U.altKey||U.ctrlKey||U.metaKey;if(U.key==="Tab"&&!X){const Y=document.activeElement,ne=U.shiftKey;if(U.target===G&&ne){w.current?.focus();return}const se=N({tabbingDirection:ne?"backwards":"forwards"}),le=se.findIndex(ge=>ge===Y);HM(se.slice(le+1))?U.preventDefault():ne?w.current?.focus():T.current?.focus()}};return G.addEventListener("keydown",V),()=>G.removeEventListener("keydown",V)}},[o,N]),C.jsxs(nce,{ref:v,role:"region","aria-label":c.replace("{hotkey}",D),tabIndex:-1,style:{pointerEvents:B?void 0:"none"},children:[B&&C.jsx(ej,{ref:w,onFocusFromOutsideViewport:()=>{const G=N({tabbingDirection:"forwards"});HM(G)}}),C.jsx(NL.Slot,{scope:r,children:C.jsx(fn.ol,{tabIndex:-1,...h,ref:O})}),B&&C.jsx(ej,{ref:T,onFocusFromOutsideViewport:()=>{const G=N({tabbingDirection:"backwards"});HM(G)}})]})});M9.displayName=P9;var I9="ToastFocusProxy",ej=Z.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...c}=e,h=GA(I9,r);return C.jsx($A,{tabIndex:0,...c,ref:t,style:{position:"fixed"},onFocus:p=>{const o=p.relatedTarget;!h.viewport?.contains(o)&&n()}})});ej.displayName=I9;var Ww="Toast",yce="toast.swipeStart",_ce="toast.swipeMove",vce="toast.swipeCancel",xce="toast.swipeEnd",O9=Z.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:c,onOpenChange:h,...p}=e,[o,v]=ym({prop:n,defaultProp:c??!0,onChange:h,caller:Ww});return C.jsx(Sc,{present:r||o,children:C.jsx(Sce,{open:o,...p,ref:t,onClose:()=>v(!1),onPause:na(e.onPause),onResume:na(e.onResume),onSwipeStart:Zr(e.onSwipeStart,w=>{w.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Zr(e.onSwipeMove,w=>{const{x:T,y:M}=w.detail.delta;w.currentTarget.setAttribute("data-swipe","move"),w.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${T}px`),w.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${M}px`)}),onSwipeCancel:Zr(e.onSwipeCancel,w=>{w.currentTarget.setAttribute("data-swipe","cancel"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),w.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Zr(e.onSwipeEnd,w=>{const{x:T,y:M}=w.detail.delta;w.currentTarget.setAttribute("data-swipe","end"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),w.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${T}px`),w.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${M}px`),v(!1)})})})});O9.displayName=Ww;var[bce,wce]=k9(Ww,{onClose(){}}),Sce=Z.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:c,open:h,onClose:p,onEscapeKeyDown:o,onPause:v,onResume:w,onSwipeStart:T,onSwipeMove:M,onSwipeCancel:O,onSwipeEnd:D,...B}=e,N=GA(Ww,r),[G,V]=Z.useState(null),U=yi(t,Oe=>V(Oe)),X=Z.useRef(null),Y=Z.useRef(null),ne=c||N.duration,se=Z.useRef(0),le=Z.useRef(ne),ge=Z.useRef(0),{onToastAdd:je,onToastRemove:ze}=N,Ce=na(()=>{G?.contains(document.activeElement)&&N.viewport?.focus(),p()}),Ke=Z.useCallback(Oe=>{!Oe||Oe===1/0||(window.clearTimeout(ge.current),se.current=new Date().getTime(),ge.current=window.setTimeout(Ce,Oe))},[Ce]);Z.useEffect(()=>{const Oe=N.viewport;if(Oe){const tt=()=>{Ke(le.current),w?.()},He=()=>{const lt=new Date().getTime()-se.current;le.current=le.current-lt,window.clearTimeout(ge.current),v?.()};return Oe.addEventListener(JO,He),Oe.addEventListener(QO,tt),()=>{Oe.removeEventListener(JO,He),Oe.removeEventListener(QO,tt)}}},[N.viewport,ne,v,w,Ke]),Z.useEffect(()=>{h&&!N.isClosePausedRef.current&&Ke(ne)},[h,ne,N.isClosePausedRef,Ke]),Z.useEffect(()=>(je(),()=>ze()),[je,ze]);const Ye=Z.useMemo(()=>G?F9(G):null,[G]);return N.viewport?C.jsxs(C.Fragment,{children:[Ye&&C.jsx(Tce,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite",children:Ye}),C.jsx(bce,{scope:r,onClose:Ce,children:Om.createPortal(C.jsx(NL.ItemSlot,{scope:r,children:C.jsx(rce,{asChild:!0,onEscapeKeyDown:Zr(o,()=>{N.isFocusedToastEscapeKeyDownRef.current||Ce(),N.isFocusedToastEscapeKeyDownRef.current=!1}),children:C.jsx(fn.li,{tabIndex:0,"data-state":h?"open":"closed","data-swipe-direction":N.swipeDirection,...B,ref:U,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Zr(e.onKeyDown,Oe=>{Oe.key==="Escape"&&(o?.(Oe.nativeEvent),Oe.nativeEvent.defaultPrevented||(N.isFocusedToastEscapeKeyDownRef.current=!0,Ce()))}),onPointerDown:Zr(e.onPointerDown,Oe=>{Oe.button===0&&(X.current={x:Oe.clientX,y:Oe.clientY})}),onPointerMove:Zr(e.onPointerMove,Oe=>{if(!X.current)return;const tt=Oe.clientX-X.current.x,He=Oe.clientY-X.current.y,lt=!!Y.current,rt=["left","right"].includes(N.swipeDirection),ht=["left","up"].includes(N.swipeDirection)?Math.min:Math.max,vt=rt?ht(0,tt):0,mt=rt?0:ht(0,He),ct=Oe.pointerType==="touch"?10:2,Vt={x:vt,y:mt},xr={originalEvent:Oe,delta:Vt};lt?(Y.current=Vt,MT(_ce,M,xr,{discrete:!1})):m6(Vt,N.swipeDirection,ct)?(Y.current=Vt,MT(yce,T,xr,{discrete:!1}),Oe.target.setPointerCapture(Oe.pointerId)):(Math.abs(tt)>ct||Math.abs(He)>ct)&&(X.current=null)}),onPointerUp:Zr(e.onPointerUp,Oe=>{const tt=Y.current,He=Oe.target;if(He.hasPointerCapture(Oe.pointerId)&&He.releasePointerCapture(Oe.pointerId),Y.current=null,X.current=null,tt){const lt=Oe.currentTarget,rt={originalEvent:Oe,delta:tt};m6(tt,N.swipeDirection,N.swipeThreshold)?MT(xce,D,rt,{discrete:!0}):MT(vce,O,rt,{discrete:!0}),lt.addEventListener("click",ht=>ht.preventDefault(),{once:!0})}})})})}),N.viewport)})]}):null}),Tce=e=>{const{__scopeToast:t,children:r,...n}=e,c=GA(Ww,t),[h,p]=Z.useState(!1),[o,v]=Z.useState(!1);return kce(()=>p(!0)),Z.useEffect(()=>{const w=window.setTimeout(()=>v(!0),1e3);return()=>window.clearTimeout(w)},[]),o?null:C.jsx(VA,{asChild:!0,children:C.jsx($A,{...n,children:h&&C.jsxs(C.Fragment,{children:[c.label," ",r]})})})},Ece="ToastTitle",j9=Z.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return C.jsx(fn.div,{...n,ref:t})});j9.displayName=Ece;var Ace="ToastDescription",R9=Z.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return C.jsx(fn.div,{...n,ref:t})});R9.displayName=Ace;var D9="ToastAction",L9=Z.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?C.jsx(N9,{altText:r,asChild:!0,children:C.jsx(FL,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${D9}\`. Expected non-empty \`string\`.`),null)});L9.displayName=D9;var z9="ToastClose",FL=Z.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,c=wce(z9,r);return C.jsx(N9,{asChild:!0,children:C.jsx(fn.button,{type:"button",...n,ref:t,onClick:Zr(e.onClick,c.onClose)})})});FL.displayName=z9;var N9=Z.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...c}=e;return C.jsx(fn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...c,ref:t})});function F9(e){const t=[];return Array.from(e.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&t.push(r.textContent),Cce(r)){const n=r.ariaHidden||r.hidden||r.style.display==="none",c=r.dataset.radixToastAnnounceExclude==="";if(!n)if(c){const h=r.dataset.radixToastAnnounceAlt;h&&t.push(h)}else t.push(...F9(r))}}),t}function MT(e,t,r,{discrete:n}){const c=r.originalEvent.currentTarget,h=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&c.addEventListener(e,t,{once:!0}),n?w9(c,h):c.dispatchEvent(h)}var m6=(e,t,r=0)=>{const n=Math.abs(e.x),c=Math.abs(e.y),h=n>c;return t==="left"||t==="right"?h&&n>r:!h&&c>r};function kce(e=()=>{}){const t=na(e);xa(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function Cce(e){return e.nodeType===e.ELEMENT_NODE}function Pce(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const c=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||c?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function HM(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var Mce=C9,B9=M9,U9=O9,V9=j9,$9=R9,G9=L9,q9=FL;function H9(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var c=e.length;for(t=0;t<c;t++)e[t]&&(r=H9(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Hn(){for(var e,t,r=0,n="",c=arguments.length;r<c;r++)(e=arguments[r])&&(t=H9(e))&&(n&&(n+=" "),n+=t);return n}const g6=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,y6=Hn,Y_=(e,t)=>r=>{var n;if(t?.variants==null)return y6(e,r?.class,r?.className);const{variants:c,defaultVariants:h}=t,p=Object.keys(c).map(w=>{const T=r?.[w],M=h?.[w];if(T===null)return null;const O=g6(T)||g6(M);return c[w][O]}),o=r&&Object.entries(r).reduce((w,T)=>{let[M,O]=T;return O===void 0||(w[M]=O),w},{}),v=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((w,T)=>{let{class:M,className:O,...D}=T;return Object.entries(D).every(B=>{let[N,G]=B;return Array.isArray(G)?G.includes({...h,...o}[N]):{...h,...o}[N]===G})?[...w,M,O]:w},[]);return y6(e,p,v,r?.class,r?.className)};/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ice=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),W9=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/var Oce={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const jce=Z.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:c="",children:h,iconNode:p,...o},v)=>Z.createElement("svg",{ref:v,...Oce,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:W9("lucide",c),...o},[...p.map(([w,T])=>Z.createElement(w,T)),...Array.isArray(h)?h:[h]]));/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const en=(e,t)=>{const r=Z.forwardRef(({className:n,...c},h)=>Z.createElement(jce,{ref:h,iconNode:t,className:W9(`lucide-${Ice(e)}`,n),...c}));return r.displayName=`${e}`,r};/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const iE=en("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Rce=en("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Dce=en("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Lce=en("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const zce=en("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const BL=en("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const sm=en("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Nce=en("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ah=en("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Fce=en("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Zw=en("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const tj=en("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const rj=en("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const qA=en("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Bce=en("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Uce=en("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Vce=en("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const UL=en("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const VL=en("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const $ce=en("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const $L=en("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Gce=en("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const qce=en("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Z9=en("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const K9=en("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Hce=en("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const X9=en("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Wce=en("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Zce=en("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ws=en("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Kce=en("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Xce=en("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const _6=en("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Y9=en("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const nj=en("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Yce=en("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const J9=en("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const qd=en("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Jce=en("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const tb=en("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const v6=en("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const GL=en("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Q9=en("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const bs=en("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Qce=en("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const eue=en("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const tue=en("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const jm=en("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const rue=en("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const eW=en("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Rm=en("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const nue=en("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const iue=en("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Qa=en("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const oue=en("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),qL="-",aue=e=>{const t=lue(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:c=>{const h=c.split(qL);return h[0]===""&&h.length!==1&&h.shift(),tW(h,t)||sue(c)},getConflictingClassGroupIds:(c,h)=>{const p=r[c]||[];return h&&n[c]?[...p,...n[c]]:p}}},tW=(e,t)=>{if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),c=n?tW(e.slice(1),n):void 0;if(c)return c;if(t.validators.length===0)return;const h=e.join(qL);return t.validators.find(({validator:p})=>p(h))?.classGroupId},x6=/^\[(.+)\]$/,sue=e=>{if(x6.test(e)){const t=x6.exec(e)[1],r=t?.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},lue=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return uue(Object.entries(e.classGroups),r).forEach(([c,h])=>{ij(h,n,c,t)}),n},ij=(e,t,r,n)=>{e.forEach(c=>{if(typeof c=="string"){const h=c===""?t:b6(t,c);h.classGroupId=r;return}if(typeof c=="function"){if(cue(c)){ij(c(n),t,r,n);return}t.validators.push({validator:c,classGroupId:r});return}Object.entries(c).forEach(([h,p])=>{ij(p,b6(t,h),r,n)})})},b6=(e,t)=>{let r=e;return t.split(qL).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},cue=e=>e.isThemeGetter,uue=(e,t)=>t?e.map(([r,n])=>{const c=n.map(h=>typeof h=="string"?t+h:typeof h=="object"?Object.fromEntries(Object.entries(h).map(([p,o])=>[t+p,o])):h);return[r,c]}):e,hue=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const c=(h,p)=>{r.set(h,p),t++,t>e&&(t=0,n=r,r=new Map)};return{get(h){let p=r.get(h);if(p!==void 0)return p;if((p=n.get(h))!==void 0)return c(h,p),p},set(h,p){r.has(h)?r.set(h,p):c(h,p)}}},rW="!",due=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,c=t[0],h=t.length,p=o=>{const v=[];let w=0,T=0,M;for(let G=0;G<o.length;G++){let V=o[G];if(w===0){if(V===c&&(n||o.slice(G,G+h)===t)){v.push(o.slice(T,G)),T=G+h;continue}if(V==="/"){M=G;continue}}V==="["?w++:V==="]"&&w--}const O=v.length===0?o:o.substring(T),D=O.startsWith(rW),B=D?O.substring(1):O,N=M&&M>T?M-T:void 0;return{modifiers:v,hasImportantModifier:D,baseClassName:B,maybePostfixModifierPosition:N}};return r?o=>r({className:o,parseClassName:p}):p},fue=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},pue=e=>({cache:hue(e.cacheSize),parseClassName:due(e),...aue(e)}),mue=/\s+/,gue=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:c}=t,h=[],p=e.trim().split(mue);let o="";for(let v=p.length-1;v>=0;v-=1){const w=p[v],{modifiers:T,hasImportantModifier:M,baseClassName:O,maybePostfixModifierPosition:D}=r(w);let B=!!D,N=n(B?O.substring(0,D):O);if(!N){if(!B){o=w+(o.length>0?" "+o:o);continue}if(N=n(O),!N){o=w+(o.length>0?" "+o:o);continue}B=!1}const G=fue(T).join(":"),V=M?G+rW:G,U=V+N;if(h.includes(U))continue;h.push(U);const X=c(N,B);for(let Y=0;Y<X.length;++Y){const ne=X[Y];h.push(V+ne)}o=w+(o.length>0?" "+o:o)}return o};function yue(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=nW(t))&&(n&&(n+=" "),n+=r);return n}const nW=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=nW(e[n]))&&(r&&(r+=" "),r+=t);return r};function _ue(e,...t){let r,n,c,h=p;function p(v){const w=t.reduce((T,M)=>M(T),e());return r=pue(w),n=r.cache.get,c=r.cache.set,h=o,o(v)}function o(v){const w=n(v);if(w)return w;const T=gue(v,r);return c(v,T),T}return function(){return h(yue.apply(null,arguments))}}const no=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},iW=/^\[(?:([a-z-]+):)?(.+)\]$/i,vue=/^\d+\/\d+$/,xue=new Set(["px","full","screen"]),bue=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,wue=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Sue=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Tue=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Eue=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,rh=e=>Jy(e)||xue.has(e)||vue.test(e),Dd=e=>J_(e,"length",jue),Jy=e=>!!e&&!Number.isNaN(Number(e)),WM=e=>J_(e,"number",Jy),Ax=e=>!!e&&Number.isInteger(Number(e)),Aue=e=>e.endsWith("%")&&Jy(e.slice(0,-1)),qn=e=>iW.test(e),Ld=e=>bue.test(e),kue=new Set(["length","size","percentage"]),Cue=e=>J_(e,kue,oW),Pue=e=>J_(e,"position",oW),Mue=new Set(["image","url"]),Iue=e=>J_(e,Mue,Due),Oue=e=>J_(e,"",Rue),kx=()=>!0,J_=(e,t,r)=>{const n=iW.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},jue=e=>wue.test(e)&&!Sue.test(e),oW=()=>!1,Rue=e=>Tue.test(e),Due=e=>Eue.test(e),Lue=()=>{const e=no("colors"),t=no("spacing"),r=no("blur"),n=no("brightness"),c=no("borderColor"),h=no("borderRadius"),p=no("borderSpacing"),o=no("borderWidth"),v=no("contrast"),w=no("grayscale"),T=no("hueRotate"),M=no("invert"),O=no("gap"),D=no("gradientColorStops"),B=no("gradientColorStopPositions"),N=no("inset"),G=no("margin"),V=no("opacity"),U=no("padding"),X=no("saturate"),Y=no("scale"),ne=no("sepia"),se=no("skew"),le=no("space"),ge=no("translate"),je=()=>["auto","contain","none"],ze=()=>["auto","hidden","clip","visible","scroll"],Ce=()=>["auto",qn,t],Ke=()=>[qn,t],Ye=()=>["",rh,Dd],Oe=()=>["auto",Jy,qn],tt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],He=()=>["solid","dashed","dotted","double","none"],lt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],rt=()=>["start","end","center","between","around","evenly","stretch"],ht=()=>["","0",qn],vt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],mt=()=>[Jy,qn];return{cacheSize:500,separator:":",theme:{colors:[kx],spacing:[rh,Dd],blur:["none","",Ld,qn],brightness:mt(),borderColor:[e],borderRadius:["none","","full",Ld,qn],borderSpacing:Ke(),borderWidth:Ye(),contrast:mt(),grayscale:ht(),hueRotate:mt(),invert:ht(),gap:Ke(),gradientColorStops:[e],gradientColorStopPositions:[Aue,Dd],inset:Ce(),margin:Ce(),opacity:mt(),padding:Ke(),saturate:mt(),scale:mt(),sepia:ht(),skew:mt(),space:Ke(),translate:Ke()},classGroups:{aspect:[{aspect:["auto","square","video",qn]}],container:["container"],columns:[{columns:[Ld]}],"break-after":[{"break-after":vt()}],"break-before":[{"break-before":vt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...tt(),qn]}],overflow:[{overflow:ze()}],"overflow-x":[{"overflow-x":ze()}],"overflow-y":[{"overflow-y":ze()}],overscroll:[{overscroll:je()}],"overscroll-x":[{"overscroll-x":je()}],"overscroll-y":[{"overscroll-y":je()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[N]}],"inset-x":[{"inset-x":[N]}],"inset-y":[{"inset-y":[N]}],start:[{start:[N]}],end:[{end:[N]}],top:[{top:[N]}],right:[{right:[N]}],bottom:[{bottom:[N]}],left:[{left:[N]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ax,qn]}],basis:[{basis:Ce()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",qn]}],grow:[{grow:ht()}],shrink:[{shrink:ht()}],order:[{order:["first","last","none",Ax,qn]}],"grid-cols":[{"grid-cols":[kx]}],"col-start-end":[{col:["auto",{span:["full",Ax,qn]},qn]}],"col-start":[{"col-start":Oe()}],"col-end":[{"col-end":Oe()}],"grid-rows":[{"grid-rows":[kx]}],"row-start-end":[{row:["auto",{span:[Ax,qn]},qn]}],"row-start":[{"row-start":Oe()}],"row-end":[{"row-end":Oe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",qn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",qn]}],gap:[{gap:[O]}],"gap-x":[{"gap-x":[O]}],"gap-y":[{"gap-y":[O]}],"justify-content":[{justify:["normal",...rt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...rt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...rt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[U]}],px:[{px:[U]}],py:[{py:[U]}],ps:[{ps:[U]}],pe:[{pe:[U]}],pt:[{pt:[U]}],pr:[{pr:[U]}],pb:[{pb:[U]}],pl:[{pl:[U]}],m:[{m:[G]}],mx:[{mx:[G]}],my:[{my:[G]}],ms:[{ms:[G]}],me:[{me:[G]}],mt:[{mt:[G]}],mr:[{mr:[G]}],mb:[{mb:[G]}],ml:[{ml:[G]}],"space-x":[{"space-x":[le]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[le]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",qn,t]}],"min-w":[{"min-w":[qn,t,"min","max","fit"]}],"max-w":[{"max-w":[qn,t,"none","full","min","max","fit","prose",{screen:[Ld]},Ld]}],h:[{h:[qn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[qn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[qn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[qn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Ld,Dd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",WM]}],"font-family":[{font:[kx]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",qn]}],"line-clamp":[{"line-clamp":["none",Jy,WM]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",rh,qn]}],"list-image":[{"list-image":["none",qn]}],"list-style-type":[{list:["none","disc","decimal",qn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[V]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[V]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...He(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",rh,Dd]}],"underline-offset":[{"underline-offset":["auto",rh,qn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ke()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",qn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",qn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[V]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...tt(),Pue]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Cue]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Iue]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[B]}],"gradient-via-pos":[{via:[B]}],"gradient-to-pos":[{to:[B]}],"gradient-from":[{from:[D]}],"gradient-via":[{via:[D]}],"gradient-to":[{to:[D]}],rounded:[{rounded:[h]}],"rounded-s":[{"rounded-s":[h]}],"rounded-e":[{"rounded-e":[h]}],"rounded-t":[{"rounded-t":[h]}],"rounded-r":[{"rounded-r":[h]}],"rounded-b":[{"rounded-b":[h]}],"rounded-l":[{"rounded-l":[h]}],"rounded-ss":[{"rounded-ss":[h]}],"rounded-se":[{"rounded-se":[h]}],"rounded-ee":[{"rounded-ee":[h]}],"rounded-es":[{"rounded-es":[h]}],"rounded-tl":[{"rounded-tl":[h]}],"rounded-tr":[{"rounded-tr":[h]}],"rounded-br":[{"rounded-br":[h]}],"rounded-bl":[{"rounded-bl":[h]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[V]}],"border-style":[{border:[...He(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[V]}],"divide-style":[{divide:He()}],"border-color":[{border:[c]}],"border-color-x":[{"border-x":[c]}],"border-color-y":[{"border-y":[c]}],"border-color-s":[{"border-s":[c]}],"border-color-e":[{"border-e":[c]}],"border-color-t":[{"border-t":[c]}],"border-color-r":[{"border-r":[c]}],"border-color-b":[{"border-b":[c]}],"border-color-l":[{"border-l":[c]}],"divide-color":[{divide:[c]}],"outline-style":[{outline:["",...He()]}],"outline-offset":[{"outline-offset":[rh,qn]}],"outline-w":[{outline:[rh,Dd]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Ye()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[V]}],"ring-offset-w":[{"ring-offset":[rh,Dd]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Ld,Oue]}],"shadow-color":[{shadow:[kx]}],opacity:[{opacity:[V]}],"mix-blend":[{"mix-blend":[...lt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":lt()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[v]}],"drop-shadow":[{"drop-shadow":["","none",Ld,qn]}],grayscale:[{grayscale:[w]}],"hue-rotate":[{"hue-rotate":[T]}],invert:[{invert:[M]}],saturate:[{saturate:[X]}],sepia:[{sepia:[ne]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[v]}],"backdrop-grayscale":[{"backdrop-grayscale":[w]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[T]}],"backdrop-invert":[{"backdrop-invert":[M]}],"backdrop-opacity":[{"backdrop-opacity":[V]}],"backdrop-saturate":[{"backdrop-saturate":[X]}],"backdrop-sepia":[{"backdrop-sepia":[ne]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[p]}],"border-spacing-x":[{"border-spacing-x":[p]}],"border-spacing-y":[{"border-spacing-y":[p]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",qn]}],duration:[{duration:mt()}],ease:[{ease:["linear","in","out","in-out",qn]}],delay:[{delay:mt()}],animate:[{animate:["none","spin","ping","pulse","bounce",qn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Y]}],"scale-x":[{"scale-x":[Y]}],"scale-y":[{"scale-y":[Y]}],rotate:[{rotate:[Ax,qn]}],"translate-x":[{"translate-x":[ge]}],"translate-y":[{"translate-y":[ge]}],"skew-x":[{"skew-x":[se]}],"skew-y":[{"skew-y":[se]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",qn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",qn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ke()}],"scroll-mx":[{"scroll-mx":Ke()}],"scroll-my":[{"scroll-my":Ke()}],"scroll-ms":[{"scroll-ms":Ke()}],"scroll-me":[{"scroll-me":Ke()}],"scroll-mt":[{"scroll-mt":Ke()}],"scroll-mr":[{"scroll-mr":Ke()}],"scroll-mb":[{"scroll-mb":Ke()}],"scroll-ml":[{"scroll-ml":Ke()}],"scroll-p":[{"scroll-p":Ke()}],"scroll-px":[{"scroll-px":Ke()}],"scroll-py":[{"scroll-py":Ke()}],"scroll-ps":[{"scroll-ps":Ke()}],"scroll-pe":[{"scroll-pe":Ke()}],"scroll-pt":[{"scroll-pt":Ke()}],"scroll-pr":[{"scroll-pr":Ke()}],"scroll-pb":[{"scroll-pb":Ke()}],"scroll-pl":[{"scroll-pl":Ke()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",qn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[rh,Dd,WM]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},zue=_ue(Lue);function ln(...e){return zue(Hn(e))}const Nue=Mce,aW=Z.forwardRef(({className:e,...t},r)=>C.jsx(B9,{ref:r,className:ln("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));aW.displayName=B9.displayName;const Fue=Y_("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),sW=Z.forwardRef(({className:e,variant:t,...r},n)=>C.jsx(U9,{ref:n,className:ln(Fue({variant:t}),e),...r}));sW.displayName=U9.displayName;const Bue=Z.forwardRef(({className:e,...t},r)=>C.jsx(G9,{ref:r,className:ln("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));Bue.displayName=G9.displayName;const lW=Z.forwardRef(({className:e,...t},r)=>C.jsx(q9,{ref:r,className:ln("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:C.jsx(Qa,{className:"h-4 w-4"})}));lW.displayName=q9.displayName;const cW=Z.forwardRef(({className:e,...t},r)=>C.jsx(V9,{ref:r,className:ln("text-sm font-semibold",e),...t}));cW.displayName=V9.displayName;const uW=Z.forwardRef(({className:e,...t},r)=>C.jsx($9,{ref:r,className:ln("text-sm opacity-90",e),...t}));uW.displayName=$9.displayName;function Uue(){const{toasts:e}=DL();return C.jsxs(Nue,{children:[e.map(function({id:t,title:r,description:n,action:c,...h}){return C.jsxs(sW,{...h,children:[C.jsxs("div",{className:"grid gap-1",children:[r&&C.jsx(cW,{children:r}),n&&C.jsx(uW,{children:n})]}),c,C.jsx(lW,{})]},t)}),C.jsx(aW,{})]})}var Vue=e=>{switch(e){case"success":return que;case"info":return Wue;case"warning":return Hue;case"error":return Zue;default:return null}},$ue=Array(12).fill(0),Gue=({visible:e,className:t})=>Ne.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Ne.createElement("div",{className:"sonner-spinner"},$ue.map((r,n)=>Ne.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),que=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Hue=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Wue=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Zue=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Kue=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ne.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ne.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Xue=()=>{let[e,t]=Ne.useState(document.hidden);return Ne.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},oj=1,Yue=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...n}=e,c=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:oj++,h=this.toasts.find(o=>o.id===c),p=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(c)&&this.dismissedToasts.delete(c),h?this.toasts=this.toasts.map(o=>o.id===c?(this.publish({...o,...e,id:c,title:r}),{...o,...e,id:c,dismissible:p,title:r}):o):this.addToast({title:r,...n,dismissible:p,id:c}),c},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let n=e instanceof Promise?e:e(),c=r!==void 0,h,p=n.then(async v=>{if(h=["resolve",v],Ne.isValidElement(v))c=!1,this.create({id:r,type:"default",message:v});else if(Que(v)&&!v.ok){c=!1;let w=typeof t.error=="function"?await t.error(`HTTP error! status: ${v.status}`):t.error,T=typeof t.description=="function"?await t.description(`HTTP error! status: ${v.status}`):t.description;this.create({id:r,type:"error",message:w,description:T})}else if(t.success!==void 0){c=!1;let w=typeof t.success=="function"?await t.success(v):t.success,T=typeof t.description=="function"?await t.description(v):t.description;this.create({id:r,type:"success",message:w,description:T})}}).catch(async v=>{if(h=["reject",v],t.error!==void 0){c=!1;let w=typeof t.error=="function"?await t.error(v):t.error,T=typeof t.description=="function"?await t.description(v):t.description;this.create({id:r,type:"error",message:w,description:T})}}).finally(()=>{var v;c&&(this.dismiss(r),r=void 0),(v=t.finally)==null||v.call(t)}),o=()=>new Promise((v,w)=>p.then(()=>h[0]==="reject"?w(h[1]):v(h[1])).catch(w));return typeof r!="string"&&typeof r!="number"?{unwrap:o}:Object.assign(r,{unwrap:o})},this.custom=(e,t)=>{let r=t?.id||oj++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},zs=new Yue,Jue=(e,t)=>{let r=t?.id||oj++;return zs.addToast({title:e,...t,id:r}),r},Que=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",ehe=Jue,the=()=>zs.toasts,rhe=()=>zs.getActiveToasts(),fh=Object.assign(ehe,{success:zs.success,info:zs.info,warning:zs.warning,error:zs.error,custom:zs.custom,message:zs.message,promise:zs.promise,dismiss:zs.dismiss,loading:zs.loading},{getHistory:the,getToasts:rhe});function nhe(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}nhe(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function IT(e){return e.label!==void 0}var ihe=3,ohe="32px",ahe="16px",w6=4e3,she=356,lhe=14,che=20,uhe=200;function nc(...e){return e.filter(Boolean).join(" ")}function hhe(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var dhe=e=>{var t,r,n,c,h,p,o,v,w,T,M;let{invert:O,toast:D,unstyled:B,interacting:N,setHeights:G,visibleToasts:V,heights:U,index:X,toasts:Y,expanded:ne,removeToast:se,defaultRichColors:le,closeButton:ge,style:je,cancelButtonStyle:ze,actionButtonStyle:Ce,className:Ke="",descriptionClassName:Ye="",duration:Oe,position:tt,gap:He,loadingIcon:lt,expandByDefault:rt,classNames:ht,icons:vt,closeButtonAriaLabel:mt="Close toast",pauseWhenPageIsHidden:ct}=e,[Vt,xr]=Ne.useState(null),[tn,Er]=Ne.useState(null),[Ft,br]=Ne.useState(!1),[Yt,Qt]=Ne.useState(!1),[Sr,Ut]=Ne.useState(!1),[Nn,Jr]=Ne.useState(!1),[Kr,In]=Ne.useState(!1),[Fi,$o]=Ne.useState(0),[Co,Hi]=Ne.useState(0),Bi=Ne.useRef(D.duration||Oe||w6),wa=Ne.useRef(null),xo=Ne.useRef(null),$l=X===0,kc=X+1<=V,Ci=D.type,bo=D.dismissible!==!1,ju=D.className||"",Xs=D.descriptionClassName||"",Ys=Ne.useMemo(()=>U.findIndex(ut=>ut.toastId===D.id)||0,[U,D.id]),Po=Ne.useMemo(()=>{var ut;return(ut=D.closeButton)!=null?ut:ge},[D.closeButton,ge]),sa=Ne.useMemo(()=>D.duration||Oe||w6,[D.duration,Oe]),Ts=Ne.useRef(0),la=Ne.useRef(0),Js=Ne.useRef(0),Sa=Ne.useRef(null),[Cc,Yn]=tt.split("-"),Pc=Ne.useMemo(()=>U.reduce((ut,Wn,Pi)=>Pi>=Ys?ut:ut+Wn.height,0),[U,Ys]),Mc=Xue(),Ta=D.invert||O,Gl=Ci==="loading";la.current=Ne.useMemo(()=>Ys*He+Pc,[Ys,Pc]),Ne.useEffect(()=>{Bi.current=sa},[sa]),Ne.useEffect(()=>{br(!0)},[]),Ne.useEffect(()=>{let ut=xo.current;if(ut){let Wn=ut.getBoundingClientRect().height;return Hi(Wn),G(Pi=>[{toastId:D.id,height:Wn,position:D.position},...Pi]),()=>G(Pi=>Pi.filter(Go=>Go.toastId!==D.id))}},[G,D.id]),Ne.useLayoutEffect(()=>{if(!Ft)return;let ut=xo.current,Wn=ut.style.height;ut.style.height="auto";let Pi=ut.getBoundingClientRect().height;ut.style.height=Wn,Hi(Pi),G(Go=>Go.find(Br=>Br.toastId===D.id)?Go.map(Br=>Br.toastId===D.id?{...Br,height:Pi}:Br):[{toastId:D.id,height:Pi,position:D.position},...Go])},[Ft,D.title,D.description,G,D.id]);let Es=Ne.useCallback(()=>{Qt(!0),$o(la.current),G(ut=>ut.filter(Wn=>Wn.toastId!==D.id)),setTimeout(()=>{se(D)},uhe)},[D,se,G,la]);Ne.useEffect(()=>{if(D.promise&&Ci==="loading"||D.duration===1/0||D.type==="loading")return;let ut;return ne||N||ct&&Mc?(()=>{if(Js.current<Ts.current){let Wn=new Date().getTime()-Ts.current;Bi.current=Bi.current-Wn}Js.current=new Date().getTime()})():Bi.current!==1/0&&(Ts.current=new Date().getTime(),ut=setTimeout(()=>{var Wn;(Wn=D.onAutoClose)==null||Wn.call(D,D),Es()},Bi.current)),()=>clearTimeout(ut)},[ne,N,D,Ci,ct,Mc,Es]),Ne.useEffect(()=>{D.delete&&Es()},[Es,D.delete]);function Ic(){var ut,Wn,Pi;return vt!=null&&vt.loading?Ne.createElement("div",{className:nc(ht?.loader,(ut=D?.classNames)==null?void 0:ut.loader,"sonner-loader"),"data-visible":Ci==="loading"},vt.loading):lt?Ne.createElement("div",{className:nc(ht?.loader,(Wn=D?.classNames)==null?void 0:Wn.loader,"sonner-loader"),"data-visible":Ci==="loading"},lt):Ne.createElement(Gue,{className:nc(ht?.loader,(Pi=D?.classNames)==null?void 0:Pi.loader),visible:Ci==="loading"})}return Ne.createElement("li",{tabIndex:0,ref:xo,className:nc(Ke,ju,ht?.toast,(t=D?.classNames)==null?void 0:t.toast,ht?.default,ht?.[Ci],(r=D?.classNames)==null?void 0:r[Ci]),"data-sonner-toast":"","data-rich-colors":(n=D.richColors)!=null?n:le,"data-styled":!(D.jsx||D.unstyled||B),"data-mounted":Ft,"data-promise":!!D.promise,"data-swiped":Kr,"data-removed":Yt,"data-visible":kc,"data-y-position":Cc,"data-x-position":Yn,"data-index":X,"data-front":$l,"data-swiping":Sr,"data-dismissible":bo,"data-type":Ci,"data-invert":Ta,"data-swipe-out":Nn,"data-swipe-direction":tn,"data-expanded":!!(ne||rt&&Ft),style:{"--index":X,"--toasts-before":X,"--z-index":Y.length-X,"--offset":`${Yt?Fi:la.current}px`,"--initial-height":rt?"auto":`${Co}px`,...je,...D.style},onDragEnd:()=>{Ut(!1),xr(null),Sa.current=null},onPointerDown:ut=>{Gl||!bo||(wa.current=new Date,$o(la.current),ut.target.setPointerCapture(ut.pointerId),ut.target.tagName!=="BUTTON"&&(Ut(!0),Sa.current={x:ut.clientX,y:ut.clientY}))},onPointerUp:()=>{var ut,Wn,Pi,Go;if(Nn||!bo)return;Sa.current=null;let Br=Number(((ut=xo.current)==null?void 0:ut.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),qe=Number(((Wn=xo.current)==null?void 0:Wn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),oe=new Date().getTime()-((Pi=wa.current)==null?void 0:Pi.getTime()),ce=Vt==="x"?Br:qe,ye=Math.abs(ce)/oe;if(Math.abs(ce)>=che||ye>.11){$o(la.current),(Go=D.onDismiss)==null||Go.call(D,D),Er(Vt==="x"?Br>0?"right":"left":qe>0?"down":"up"),Es(),Jr(!0),In(!1);return}Ut(!1),xr(null)},onPointerMove:ut=>{var Wn,Pi,Go,Br;if(!Sa.current||!bo||((Wn=window.getSelection())==null?void 0:Wn.toString().length)>0)return;let qe=ut.clientY-Sa.current.y,oe=ut.clientX-Sa.current.x,ce=(Pi=e.swipeDirections)!=null?Pi:hhe(tt);!Vt&&(Math.abs(oe)>1||Math.abs(qe)>1)&&xr(Math.abs(oe)>Math.abs(qe)?"x":"y");let ye={x:0,y:0};Vt==="y"?(ce.includes("top")||ce.includes("bottom"))&&(ce.includes("top")&&qe<0||ce.includes("bottom")&&qe>0)&&(ye.y=qe):Vt==="x"&&(ce.includes("left")||ce.includes("right"))&&(ce.includes("left")&&oe<0||ce.includes("right")&&oe>0)&&(ye.x=oe),(Math.abs(ye.x)>0||Math.abs(ye.y)>0)&&In(!0),(Go=xo.current)==null||Go.style.setProperty("--swipe-amount-x",`${ye.x}px`),(Br=xo.current)==null||Br.style.setProperty("--swipe-amount-y",`${ye.y}px`)}},Po&&!D.jsx?Ne.createElement("button",{"aria-label":mt,"data-disabled":Gl,"data-close-button":!0,onClick:Gl||!bo?()=>{}:()=>{var ut;Es(),(ut=D.onDismiss)==null||ut.call(D,D)},className:nc(ht?.closeButton,(c=D?.classNames)==null?void 0:c.closeButton)},(h=vt?.close)!=null?h:Kue):null,D.jsx||Z.isValidElement(D.title)?D.jsx?D.jsx:typeof D.title=="function"?D.title():D.title:Ne.createElement(Ne.Fragment,null,Ci||D.icon||D.promise?Ne.createElement("div",{"data-icon":"",className:nc(ht?.icon,(p=D?.classNames)==null?void 0:p.icon)},D.promise||D.type==="loading"&&!D.icon?D.icon||Ic():null,D.type!=="loading"?D.icon||vt?.[Ci]||Vue(Ci):null):null,Ne.createElement("div",{"data-content":"",className:nc(ht?.content,(o=D?.classNames)==null?void 0:o.content)},Ne.createElement("div",{"data-title":"",className:nc(ht?.title,(v=D?.classNames)==null?void 0:v.title)},typeof D.title=="function"?D.title():D.title),D.description?Ne.createElement("div",{"data-description":"",className:nc(Ye,Xs,ht?.description,(w=D?.classNames)==null?void 0:w.description)},typeof D.description=="function"?D.description():D.description):null),Z.isValidElement(D.cancel)?D.cancel:D.cancel&&IT(D.cancel)?Ne.createElement("button",{"data-button":!0,"data-cancel":!0,style:D.cancelButtonStyle||ze,onClick:ut=>{var Wn,Pi;IT(D.cancel)&&bo&&((Pi=(Wn=D.cancel).onClick)==null||Pi.call(Wn,ut),Es())},className:nc(ht?.cancelButton,(T=D?.classNames)==null?void 0:T.cancelButton)},D.cancel.label):null,Z.isValidElement(D.action)?D.action:D.action&&IT(D.action)?Ne.createElement("button",{"data-button":!0,"data-action":!0,style:D.actionButtonStyle||Ce,onClick:ut=>{var Wn,Pi;IT(D.action)&&((Pi=(Wn=D.action).onClick)==null||Pi.call(Wn,ut),!ut.defaultPrevented&&Es())},className:nc(ht?.actionButton,(M=D?.classNames)==null?void 0:M.actionButton)},D.action.label):null))};function S6(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function fhe(e,t){let r={};return[e,t].forEach((n,c)=>{let h=c===1,p=h?"--mobile-offset":"--offset",o=h?ahe:ohe;function v(w){["top","right","bottom","left"].forEach(T=>{r[`${p}-${T}`]=typeof w=="number"?`${w}px`:w})}typeof n=="number"||typeof n=="string"?v(n):typeof n=="object"?["top","right","bottom","left"].forEach(w=>{n[w]===void 0?r[`${p}-${w}`]=o:r[`${p}-${w}`]=typeof n[w]=="number"?`${n[w]}px`:n[w]}):v(o)}),r}var phe=Z.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:c=["altKey","KeyT"],expand:h,closeButton:p,className:o,offset:v,mobileOffset:w,theme:T="light",richColors:M,duration:O,style:D,visibleToasts:B=ihe,toastOptions:N,dir:G=S6(),gap:V=lhe,loadingIcon:U,icons:X,containerAriaLabel:Y="Notifications",pauseWhenPageIsHidden:ne}=e,[se,le]=Ne.useState([]),ge=Ne.useMemo(()=>Array.from(new Set([n].concat(se.filter(ct=>ct.position).map(ct=>ct.position)))),[se,n]),[je,ze]=Ne.useState([]),[Ce,Ke]=Ne.useState(!1),[Ye,Oe]=Ne.useState(!1),[tt,He]=Ne.useState(T!=="system"?T:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),lt=Ne.useRef(null),rt=c.join("+").replace(/Key/g,"").replace(/Digit/g,""),ht=Ne.useRef(null),vt=Ne.useRef(!1),mt=Ne.useCallback(ct=>{le(Vt=>{var xr;return(xr=Vt.find(tn=>tn.id===ct.id))!=null&&xr.delete||zs.dismiss(ct.id),Vt.filter(({id:tn})=>tn!==ct.id)})},[]);return Ne.useEffect(()=>zs.subscribe(ct=>{if(ct.dismiss){le(Vt=>Vt.map(xr=>xr.id===ct.id?{...xr,delete:!0}:xr));return}setTimeout(()=>{_9.flushSync(()=>{le(Vt=>{let xr=Vt.findIndex(tn=>tn.id===ct.id);return xr!==-1?[...Vt.slice(0,xr),{...Vt[xr],...ct},...Vt.slice(xr+1)]:[ct,...Vt]})})})}),[]),Ne.useEffect(()=>{if(T!=="system"){He(T);return}if(T==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?He("dark"):He("light")),typeof window>"u")return;let ct=window.matchMedia("(prefers-color-scheme: dark)");try{ct.addEventListener("change",({matches:Vt})=>{He(Vt?"dark":"light")})}catch{ct.addListener(({matches:Vt})=>{try{He(Vt?"dark":"light")}catch(xr){console.error(xr)}})}},[T]),Ne.useEffect(()=>{se.length<=1&&Ke(!1)},[se]),Ne.useEffect(()=>{let ct=Vt=>{var xr,tn;c.every(Er=>Vt[Er]||Vt.code===Er)&&(Ke(!0),(xr=lt.current)==null||xr.focus()),Vt.code==="Escape"&&(document.activeElement===lt.current||(tn=lt.current)!=null&&tn.contains(document.activeElement))&&Ke(!1)};return document.addEventListener("keydown",ct),()=>document.removeEventListener("keydown",ct)},[c]),Ne.useEffect(()=>{if(lt.current)return()=>{ht.current&&(ht.current.focus({preventScroll:!0}),ht.current=null,vt.current=!1)}},[lt.current]),Ne.createElement("section",{ref:t,"aria-label":`${Y} ${rt}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},ge.map((ct,Vt)=>{var xr;let[tn,Er]=ct.split("-");return se.length?Ne.createElement("ol",{key:ct,dir:G==="auto"?S6():G,tabIndex:-1,ref:lt,className:o,"data-sonner-toaster":!0,"data-theme":tt,"data-y-position":tn,"data-lifted":Ce&&se.length>1&&!h,"data-x-position":Er,style:{"--front-toast-height":`${((xr=je[0])==null?void 0:xr.height)||0}px`,"--width":`${she}px`,"--gap":`${V}px`,...D,...fhe(v,w)},onBlur:Ft=>{vt.current&&!Ft.currentTarget.contains(Ft.relatedTarget)&&(vt.current=!1,ht.current&&(ht.current.focus({preventScroll:!0}),ht.current=null))},onFocus:Ft=>{Ft.target instanceof HTMLElement&&Ft.target.dataset.dismissible==="false"||vt.current||(vt.current=!0,ht.current=Ft.relatedTarget)},onMouseEnter:()=>Ke(!0),onMouseMove:()=>Ke(!0),onMouseLeave:()=>{Ye||Ke(!1)},onDragEnd:()=>Ke(!1),onPointerDown:Ft=>{Ft.target instanceof HTMLElement&&Ft.target.dataset.dismissible==="false"||Oe(!0)},onPointerUp:()=>Oe(!1)},se.filter(Ft=>!Ft.position&&Vt===0||Ft.position===ct).map((Ft,br)=>{var Yt,Qt;return Ne.createElement(dhe,{key:Ft.id,icons:X,index:br,toast:Ft,defaultRichColors:M,duration:(Yt=N?.duration)!=null?Yt:O,className:N?.className,descriptionClassName:N?.descriptionClassName,invert:r,visibleToasts:B,closeButton:(Qt=N?.closeButton)!=null?Qt:p,interacting:Ye,position:ct,style:N?.style,unstyled:N?.unstyled,classNames:N?.classNames,cancelButtonStyle:N?.cancelButtonStyle,actionButtonStyle:N?.actionButtonStyle,removeToast:mt,toasts:se.filter(Sr=>Sr.position==Ft.position),heights:je.filter(Sr=>Sr.position==Ft.position),setHeights:ze,expandByDefault:h,gap:V,loadingIcon:U,expanded:Ce,pauseWhenPageIsHidden:ne,swipeDirections:e.swipeDirections})})):null}))});const mhe=({...e})=>C.jsx(phe,{theme:"light",className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e});var ghe=GD[" useId ".trim().toString()]||(()=>{}),yhe=0;function hf(e){const[t,r]=Z.useState(ghe());return xa(()=>{r(n=>n??String(yhe++))},[e]),t?`radix-${t}`:""}const _he=["top","right","bottom","left"],gf=Math.min,sl=Math.max,oE=Math.round,OT=Math.floor,vu=e=>({x:e,y:e}),vhe={left:"right",right:"left",bottom:"top",top:"bottom"},xhe={start:"end",end:"start"};function aj(e,t,r){return sl(e,gf(t,r))}function kh(e,t){return typeof e=="function"?e(t):e}function Ch(e){return e.split("-")[0]}function Q_(e){return e.split("-")[1]}function HL(e){return e==="x"?"y":"x"}function WL(e){return e==="y"?"height":"width"}const bhe=new Set(["top","bottom"]);function pu(e){return bhe.has(Ch(e))?"y":"x"}function ZL(e){return HL(pu(e))}function whe(e,t,r){r===void 0&&(r=!1);const n=Q_(e),c=ZL(e),h=WL(c);let p=c==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[h]>t.floating[h]&&(p=aE(p)),[p,aE(p)]}function She(e){const t=aE(e);return[sj(e),t,sj(t)]}function sj(e){return e.replace(/start|end/g,t=>xhe[t])}const T6=["left","right"],E6=["right","left"],The=["top","bottom"],Ehe=["bottom","top"];function Ahe(e,t,r){switch(e){case"top":case"bottom":return r?t?E6:T6:t?T6:E6;case"left":case"right":return t?The:Ehe;default:return[]}}function khe(e,t,r,n){const c=Q_(e);let h=Ahe(Ch(e),r==="start",n);return c&&(h=h.map(p=>p+"-"+c),t&&(h=h.concat(h.map(sj)))),h}function aE(e){return e.replace(/left|right|bottom|top/g,t=>vhe[t])}function Che(e){return{top:0,right:0,bottom:0,left:0,...e}}function hW(e){return typeof e!="number"?Che(e):{top:e,right:e,bottom:e,left:e}}function sE(e){const{x:t,y:r,width:n,height:c}=e;return{width:n,height:c,top:r,left:t,right:t+n,bottom:r+c,x:t,y:r}}function A6(e,t,r){let{reference:n,floating:c}=e;const h=pu(t),p=ZL(t),o=WL(p),v=Ch(t),w=h==="y",T=n.x+n.width/2-c.width/2,M=n.y+n.height/2-c.height/2,O=n[o]/2-c[o]/2;let D;switch(v){case"top":D={x:T,y:n.y-c.height};break;case"bottom":D={x:T,y:n.y+n.height};break;case"right":D={x:n.x+n.width,y:M};break;case"left":D={x:n.x-c.width,y:M};break;default:D={x:n.x,y:n.y}}switch(Q_(t)){case"start":D[p]-=O*(r&&w?-1:1);break;case"end":D[p]+=O*(r&&w?-1:1);break}return D}const Phe=async(e,t,r)=>{const{placement:n="bottom",strategy:c="absolute",middleware:h=[],platform:p}=r,o=h.filter(Boolean),v=await(p.isRTL==null?void 0:p.isRTL(t));let w=await p.getElementRects({reference:e,floating:t,strategy:c}),{x:T,y:M}=A6(w,n,v),O=n,D={},B=0;for(let N=0;N<o.length;N++){const{name:G,fn:V}=o[N],{x:U,y:X,data:Y,reset:ne}=await V({x:T,y:M,initialPlacement:n,placement:O,strategy:c,middlewareData:D,rects:w,platform:p,elements:{reference:e,floating:t}});T=U??T,M=X??M,D={...D,[G]:{...D[G],...Y}},ne&&B<=50&&(B++,typeof ne=="object"&&(ne.placement&&(O=ne.placement),ne.rects&&(w=ne.rects===!0?await p.getElementRects({reference:e,floating:t,strategy:c}):ne.rects),{x:T,y:M}=A6(w,O,v)),N=-1)}return{x:T,y:M,placement:O,strategy:c,middlewareData:D}};async function Kb(e,t){var r;t===void 0&&(t={});const{x:n,y:c,platform:h,rects:p,elements:o,strategy:v}=e,{boundary:w="clippingAncestors",rootBoundary:T="viewport",elementContext:M="floating",altBoundary:O=!1,padding:D=0}=kh(t,e),B=hW(D),N=o[O?M==="floating"?"reference":"floating":M],G=sE(await h.getClippingRect({element:(r=await(h.isElement==null?void 0:h.isElement(N)))==null||r?N:N.contextElement||await(h.getDocumentElement==null?void 0:h.getDocumentElement(o.floating)),boundary:w,rootBoundary:T,strategy:v})),V=M==="floating"?{x:n,y:c,width:p.floating.width,height:p.floating.height}:p.reference,U=await(h.getOffsetParent==null?void 0:h.getOffsetParent(o.floating)),X=await(h.isElement==null?void 0:h.isElement(U))?await(h.getScale==null?void 0:h.getScale(U))||{x:1,y:1}:{x:1,y:1},Y=sE(h.convertOffsetParentRelativeRectToViewportRelativeRect?await h.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:V,offsetParent:U,strategy:v}):V);return{top:(G.top-Y.top+B.top)/X.y,bottom:(Y.bottom-G.bottom+B.bottom)/X.y,left:(G.left-Y.left+B.left)/X.x,right:(Y.right-G.right+B.right)/X.x}}const Mhe=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:c,rects:h,platform:p,elements:o,middlewareData:v}=t,{element:w,padding:T=0}=kh(e,t)||{};if(w==null)return{};const M=hW(T),O={x:r,y:n},D=ZL(c),B=WL(D),N=await p.getDimensions(w),G=D==="y",V=G?"top":"left",U=G?"bottom":"right",X=G?"clientHeight":"clientWidth",Y=h.reference[B]+h.reference[D]-O[D]-h.floating[B],ne=O[D]-h.reference[D],se=await(p.getOffsetParent==null?void 0:p.getOffsetParent(w));let le=se?se[X]:0;(!le||!await(p.isElement==null?void 0:p.isElement(se)))&&(le=o.floating[X]||h.floating[B]);const ge=Y/2-ne/2,je=le/2-N[B]/2-1,ze=gf(M[V],je),Ce=gf(M[U],je),Ke=ze,Ye=le-N[B]-Ce,Oe=le/2-N[B]/2+ge,tt=aj(Ke,Oe,Ye),He=!v.arrow&&Q_(c)!=null&&Oe!==tt&&h.reference[B]/2-(Oe<Ke?ze:Ce)-N[B]/2<0,lt=He?Oe<Ke?Oe-Ke:Oe-Ye:0;return{[D]:O[D]+lt,data:{[D]:tt,centerOffset:Oe-tt-lt,...He&&{alignmentOffset:lt}},reset:He}}}),Ihe=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:c,middlewareData:h,rects:p,initialPlacement:o,platform:v,elements:w}=t,{mainAxis:T=!0,crossAxis:M=!0,fallbackPlacements:O,fallbackStrategy:D="bestFit",fallbackAxisSideDirection:B="none",flipAlignment:N=!0,...G}=kh(e,t);if((r=h.arrow)!=null&&r.alignmentOffset)return{};const V=Ch(c),U=pu(o),X=Ch(o)===o,Y=await(v.isRTL==null?void 0:v.isRTL(w.floating)),ne=O||(X||!N?[aE(o)]:She(o)),se=B!=="none";!O&&se&&ne.push(...khe(o,N,B,Y));const le=[o,...ne],ge=await Kb(t,G),je=[];let ze=((n=h.flip)==null?void 0:n.overflows)||[];if(T&&je.push(ge[V]),M){const Oe=whe(c,p,Y);je.push(ge[Oe[0]],ge[Oe[1]])}if(ze=[...ze,{placement:c,overflows:je}],!je.every(Oe=>Oe<=0)){var Ce,Ke;const Oe=(((Ce=h.flip)==null?void 0:Ce.index)||0)+1,tt=le[Oe];if(tt&&(!(M==="alignment"&&U!==pu(tt))||ze.every(lt=>pu(lt.placement)===U?lt.overflows[0]>0:!0)))return{data:{index:Oe,overflows:ze},reset:{placement:tt}};let He=(Ke=ze.filter(lt=>lt.overflows[0]<=0).sort((lt,rt)=>lt.overflows[1]-rt.overflows[1])[0])==null?void 0:Ke.placement;if(!He)switch(D){case"bestFit":{var Ye;const lt=(Ye=ze.filter(rt=>{if(se){const ht=pu(rt.placement);return ht===U||ht==="y"}return!0}).map(rt=>[rt.placement,rt.overflows.filter(ht=>ht>0).reduce((ht,vt)=>ht+vt,0)]).sort((rt,ht)=>rt[1]-ht[1])[0])==null?void 0:Ye[0];lt&&(He=lt);break}case"initialPlacement":He=o;break}if(c!==He)return{reset:{placement:He}}}return{}}}};function k6(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function C6(e){return _he.some(t=>e[t]>=0)}const Ohe=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...c}=kh(e,t);switch(n){case"referenceHidden":{const h=await Kb(t,{...c,elementContext:"reference"}),p=k6(h,r.reference);return{data:{referenceHiddenOffsets:p,referenceHidden:C6(p)}}}case"escaped":{const h=await Kb(t,{...c,altBoundary:!0}),p=k6(h,r.floating);return{data:{escapedOffsets:p,escaped:C6(p)}}}default:return{}}}}},dW=new Set(["left","top"]);async function jhe(e,t){const{placement:r,platform:n,elements:c}=e,h=await(n.isRTL==null?void 0:n.isRTL(c.floating)),p=Ch(r),o=Q_(r),v=pu(r)==="y",w=dW.has(p)?-1:1,T=h&&v?-1:1,M=kh(t,e);let{mainAxis:O,crossAxis:D,alignmentAxis:B}=typeof M=="number"?{mainAxis:M,crossAxis:0,alignmentAxis:null}:{mainAxis:M.mainAxis||0,crossAxis:M.crossAxis||0,alignmentAxis:M.alignmentAxis};return o&&typeof B=="number"&&(D=o==="end"?B*-1:B),v?{x:D*T,y:O*w}:{x:O*w,y:D*T}}const Rhe=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:c,y:h,placement:p,middlewareData:o}=t,v=await jhe(t,e);return p===((r=o.offset)==null?void 0:r.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:c+v.x,y:h+v.y,data:{...v,placement:p}}}}},Dhe=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:c}=t,{mainAxis:h=!0,crossAxis:p=!1,limiter:o={fn:G=>{let{x:V,y:U}=G;return{x:V,y:U}}},...v}=kh(e,t),w={x:r,y:n},T=await Kb(t,v),M=pu(Ch(c)),O=HL(M);let D=w[O],B=w[M];if(h){const G=O==="y"?"top":"left",V=O==="y"?"bottom":"right",U=D+T[G],X=D-T[V];D=aj(U,D,X)}if(p){const G=M==="y"?"top":"left",V=M==="y"?"bottom":"right",U=B+T[G],X=B-T[V];B=aj(U,B,X)}const N=o.fn({...t,[O]:D,[M]:B});return{...N,data:{x:N.x-r,y:N.y-n,enabled:{[O]:h,[M]:p}}}}}},Lhe=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:c,rects:h,middlewareData:p}=t,{offset:o=0,mainAxis:v=!0,crossAxis:w=!0}=kh(e,t),T={x:r,y:n},M=pu(c),O=HL(M);let D=T[O],B=T[M];const N=kh(o,t),G=typeof N=="number"?{mainAxis:N,crossAxis:0}:{mainAxis:0,crossAxis:0,...N};if(v){const X=O==="y"?"height":"width",Y=h.reference[O]-h.floating[X]+G.mainAxis,ne=h.reference[O]+h.reference[X]-G.mainAxis;D<Y?D=Y:D>ne&&(D=ne)}if(w){var V,U;const X=O==="y"?"width":"height",Y=dW.has(Ch(c)),ne=h.reference[M]-h.floating[X]+(Y&&((V=p.offset)==null?void 0:V[M])||0)+(Y?0:G.crossAxis),se=h.reference[M]+h.reference[X]+(Y?0:((U=p.offset)==null?void 0:U[M])||0)-(Y?G.crossAxis:0);B<ne?B=ne:B>se&&(B=se)}return{[O]:D,[M]:B}}}},zhe=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:c,rects:h,platform:p,elements:o}=t,{apply:v=()=>{},...w}=kh(e,t),T=await Kb(t,w),M=Ch(c),O=Q_(c),D=pu(c)==="y",{width:B,height:N}=h.floating;let G,V;M==="top"||M==="bottom"?(G=M,V=O===(await(p.isRTL==null?void 0:p.isRTL(o.floating))?"start":"end")?"left":"right"):(V=M,G=O==="end"?"top":"bottom");const U=N-T.top-T.bottom,X=B-T.left-T.right,Y=gf(N-T[G],U),ne=gf(B-T[V],X),se=!t.middlewareData.shift;let le=Y,ge=ne;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(ge=X),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(le=U),se&&!O){const ze=sl(T.left,0),Ce=sl(T.right,0),Ke=sl(T.top,0),Ye=sl(T.bottom,0);D?ge=B-2*(ze!==0||Ce!==0?ze+Ce:sl(T.left,T.right)):le=N-2*(Ke!==0||Ye!==0?Ke+Ye:sl(T.top,T.bottom))}await v({...t,availableWidth:ge,availableHeight:le});const je=await p.getDimensions(o.floating);return B!==je.width||N!==je.height?{reset:{rects:!0}}:{}}}};function HA(){return typeof window<"u"}function ev(e){return fW(e)?(e.nodeName||"").toLowerCase():"#document"}function dl(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Pu(e){var t;return(t=(fW(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function fW(e){return HA()?e instanceof Node||e instanceof dl(e).Node:!1}function xc(e){return HA()?e instanceof Element||e instanceof dl(e).Element:!1}function ku(e){return HA()?e instanceof HTMLElement||e instanceof dl(e).HTMLElement:!1}function P6(e){return!HA()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof dl(e).ShadowRoot}const Nhe=new Set(["inline","contents"]);function Kw(e){const{overflow:t,overflowX:r,overflowY:n,display:c}=bc(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!Nhe.has(c)}const Fhe=new Set(["table","td","th"]);function Bhe(e){return Fhe.has(ev(e))}const Uhe=[":popover-open",":modal"];function WA(e){return Uhe.some(t=>{try{return e.matches(t)}catch{return!1}})}const Vhe=["transform","translate","scale","rotate","perspective"],$he=["transform","translate","scale","rotate","perspective","filter"],Ghe=["paint","layout","strict","content"];function KL(e){const t=XL(),r=xc(e)?bc(e):e;return Vhe.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||$he.some(n=>(r.willChange||"").includes(n))||Ghe.some(n=>(r.contain||"").includes(n))}function qhe(e){let t=yf(e);for(;ku(t)&&!y_(t);){if(KL(t))return t;if(WA(t))return null;t=yf(t)}return null}function XL(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Hhe=new Set(["html","body","#document"]);function y_(e){return Hhe.has(ev(e))}function bc(e){return dl(e).getComputedStyle(e)}function ZA(e){return xc(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function yf(e){if(ev(e)==="html")return e;const t=e.assignedSlot||e.parentNode||P6(e)&&e.host||Pu(e);return P6(t)?t.host:t}function pW(e){const t=yf(e);return y_(t)?e.ownerDocument?e.ownerDocument.body:e.body:ku(t)&&Kw(t)?t:pW(t)}function Xb(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const c=pW(e),h=c===((n=e.ownerDocument)==null?void 0:n.body),p=dl(c);if(h){const o=lj(p);return t.concat(p,p.visualViewport||[],Kw(c)?c:[],o&&r?Xb(o):[])}return t.concat(c,Xb(c,[],r))}function lj(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function mW(e){const t=bc(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const c=ku(e),h=c?e.offsetWidth:r,p=c?e.offsetHeight:n,o=oE(r)!==h||oE(n)!==p;return o&&(r=h,n=p),{width:r,height:n,$:o}}function YL(e){return xc(e)?e:e.contextElement}function Qy(e){const t=YL(e);if(!ku(t))return vu(1);const r=t.getBoundingClientRect(),{width:n,height:c,$:h}=mW(t);let p=(h?oE(r.width):r.width)/n,o=(h?oE(r.height):r.height)/c;return(!p||!Number.isFinite(p))&&(p=1),(!o||!Number.isFinite(o))&&(o=1),{x:p,y:o}}const Whe=vu(0);function gW(e){const t=dl(e);return!XL()||!t.visualViewport?Whe:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Zhe(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==dl(e)?!1:t}function _m(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const c=e.getBoundingClientRect(),h=YL(e);let p=vu(1);t&&(n?xc(n)&&(p=Qy(n)):p=Qy(e));const o=Zhe(h,r,n)?gW(h):vu(0);let v=(c.left+o.x)/p.x,w=(c.top+o.y)/p.y,T=c.width/p.x,M=c.height/p.y;if(h){const O=dl(h),D=n&&xc(n)?dl(n):n;let B=O,N=lj(B);for(;N&&n&&D!==B;){const G=Qy(N),V=N.getBoundingClientRect(),U=bc(N),X=V.left+(N.clientLeft+parseFloat(U.paddingLeft))*G.x,Y=V.top+(N.clientTop+parseFloat(U.paddingTop))*G.y;v*=G.x,w*=G.y,T*=G.x,M*=G.y,v+=X,w+=Y,B=dl(N),N=lj(B)}}return sE({width:T,height:M,x:v,y:w})}function KA(e,t){const r=ZA(e).scrollLeft;return t?t.left+r:_m(Pu(e)).left+r}function yW(e,t){const r=e.getBoundingClientRect(),n=r.left+t.scrollLeft-KA(e,r),c=r.top+t.scrollTop;return{x:n,y:c}}function Khe(e){let{elements:t,rect:r,offsetParent:n,strategy:c}=e;const h=c==="fixed",p=Pu(n),o=t?WA(t.floating):!1;if(n===p||o&&h)return r;let v={scrollLeft:0,scrollTop:0},w=vu(1);const T=vu(0),M=ku(n);if((M||!M&&!h)&&((ev(n)!=="body"||Kw(p))&&(v=ZA(n)),ku(n))){const D=_m(n);w=Qy(n),T.x=D.x+n.clientLeft,T.y=D.y+n.clientTop}const O=p&&!M&&!h?yW(p,v):vu(0);return{width:r.width*w.x,height:r.height*w.y,x:r.x*w.x-v.scrollLeft*w.x+T.x+O.x,y:r.y*w.y-v.scrollTop*w.y+T.y+O.y}}function Xhe(e){return Array.from(e.getClientRects())}function Yhe(e){const t=Pu(e),r=ZA(e),n=e.ownerDocument.body,c=sl(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),h=sl(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let p=-r.scrollLeft+KA(e);const o=-r.scrollTop;return bc(n).direction==="rtl"&&(p+=sl(t.clientWidth,n.clientWidth)-c),{width:c,height:h,x:p,y:o}}const M6=25;function Jhe(e,t){const r=dl(e),n=Pu(e),c=r.visualViewport;let h=n.clientWidth,p=n.clientHeight,o=0,v=0;if(c){h=c.width,p=c.height;const T=XL();(!T||T&&t==="fixed")&&(o=c.offsetLeft,v=c.offsetTop)}const w=KA(n);if(w<=0){const T=n.ownerDocument,M=T.body,O=getComputedStyle(M),D=T.compatMode==="CSS1Compat"&&parseFloat(O.marginLeft)+parseFloat(O.marginRight)||0,B=Math.abs(n.clientWidth-M.clientWidth-D);B<=M6&&(h-=B)}else w<=M6&&(h+=w);return{width:h,height:p,x:o,y:v}}const Qhe=new Set(["absolute","fixed"]);function ede(e,t){const r=_m(e,!0,t==="fixed"),n=r.top+e.clientTop,c=r.left+e.clientLeft,h=ku(e)?Qy(e):vu(1),p=e.clientWidth*h.x,o=e.clientHeight*h.y,v=c*h.x,w=n*h.y;return{width:p,height:o,x:v,y:w}}function I6(e,t,r){let n;if(t==="viewport")n=Jhe(e,r);else if(t==="document")n=Yhe(Pu(e));else if(xc(t))n=ede(t,r);else{const c=gW(e);n={x:t.x-c.x,y:t.y-c.y,width:t.width,height:t.height}}return sE(n)}function _W(e,t){const r=yf(e);return r===t||!xc(r)||y_(r)?!1:bc(r).position==="fixed"||_W(r,t)}function tde(e,t){const r=t.get(e);if(r)return r;let n=Xb(e,[],!1).filter(o=>xc(o)&&ev(o)!=="body"),c=null;const h=bc(e).position==="fixed";let p=h?yf(e):e;for(;xc(p)&&!y_(p);){const o=bc(p),v=KL(p);!v&&o.position==="fixed"&&(c=null),(h?!v&&!c:!v&&o.position==="static"&&c&&Qhe.has(c.position)||Kw(p)&&!v&&_W(e,p))?n=n.filter(w=>w!==p):c=o,p=yf(p)}return t.set(e,n),n}function rde(e){let{element:t,boundary:r,rootBoundary:n,strategy:c}=e;const h=[...r==="clippingAncestors"?WA(t)?[]:tde(t,this._c):[].concat(r),n],p=h[0],o=h.reduce((v,w)=>{const T=I6(t,w,c);return v.top=sl(T.top,v.top),v.right=gf(T.right,v.right),v.bottom=gf(T.bottom,v.bottom),v.left=sl(T.left,v.left),v},I6(t,p,c));return{width:o.right-o.left,height:o.bottom-o.top,x:o.left,y:o.top}}function nde(e){const{width:t,height:r}=mW(e);return{width:t,height:r}}function ide(e,t,r){const n=ku(t),c=Pu(t),h=r==="fixed",p=_m(e,!0,h,t);let o={scrollLeft:0,scrollTop:0};const v=vu(0);function w(){v.x=KA(c)}if(n||!n&&!h)if((ev(t)!=="body"||Kw(c))&&(o=ZA(t)),n){const D=_m(t,!0,h,t);v.x=D.x+t.clientLeft,v.y=D.y+t.clientTop}else c&&w();h&&!n&&c&&w();const T=c&&!n&&!h?yW(c,o):vu(0),M=p.left+o.scrollLeft-v.x-T.x,O=p.top+o.scrollTop-v.y-T.y;return{x:M,y:O,width:p.width,height:p.height}}function ZM(e){return bc(e).position==="static"}function O6(e,t){if(!ku(e)||bc(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Pu(e)===r&&(r=r.ownerDocument.body),r}function vW(e,t){const r=dl(e);if(WA(e))return r;if(!ku(e)){let c=yf(e);for(;c&&!y_(c);){if(xc(c)&&!ZM(c))return c;c=yf(c)}return r}let n=O6(e,t);for(;n&&Bhe(n)&&ZM(n);)n=O6(n,t);return n&&y_(n)&&ZM(n)&&!KL(n)?r:n||qhe(e)||r}const ode=async function(e){const t=this.getOffsetParent||vW,r=this.getDimensions,n=await r(e.floating);return{reference:ide(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function ade(e){return bc(e).direction==="rtl"}const sde={convertOffsetParentRelativeRectToViewportRelativeRect:Khe,getDocumentElement:Pu,getClippingRect:rde,getOffsetParent:vW,getElementRects:ode,getClientRects:Xhe,getDimensions:nde,getScale:Qy,isElement:xc,isRTL:ade};function xW(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function lde(e,t){let r=null,n;const c=Pu(e);function h(){var o;clearTimeout(n),(o=r)==null||o.disconnect(),r=null}function p(o,v){o===void 0&&(o=!1),v===void 0&&(v=1),h();const w=e.getBoundingClientRect(),{left:T,top:M,width:O,height:D}=w;if(o||t(),!O||!D)return;const B=OT(M),N=OT(c.clientWidth-(T+O)),G=OT(c.clientHeight-(M+D)),V=OT(T),U={rootMargin:-B+"px "+-N+"px "+-G+"px "+-V+"px",threshold:sl(0,gf(1,v))||1};let X=!0;function Y(ne){const se=ne[0].intersectionRatio;if(se!==v){if(!X)return p();se?p(!1,se):n=setTimeout(()=>{p(!1,1e-7)},1e3)}se===1&&!xW(w,e.getBoundingClientRect())&&p(),X=!1}try{r=new IntersectionObserver(Y,{...U,root:c.ownerDocument})}catch{r=new IntersectionObserver(Y,U)}r.observe(e)}return p(!0),h}function cde(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:c=!0,ancestorResize:h=!0,elementResize:p=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:v=!1}=n,w=YL(e),T=c||h?[...w?Xb(w):[],...Xb(t)]:[];T.forEach(V=>{c&&V.addEventListener("scroll",r,{passive:!0}),h&&V.addEventListener("resize",r)});const M=w&&o?lde(w,r):null;let O=-1,D=null;p&&(D=new ResizeObserver(V=>{let[U]=V;U&&U.target===w&&D&&(D.unobserve(t),cancelAnimationFrame(O),O=requestAnimationFrame(()=>{var X;(X=D)==null||X.observe(t)})),r()}),w&&!v&&D.observe(w),D.observe(t));let B,N=v?_m(e):null;v&&G();function G(){const V=_m(e);N&&!xW(N,V)&&r(),N=V,B=requestAnimationFrame(G)}return r(),()=>{var V;T.forEach(U=>{c&&U.removeEventListener("scroll",r),h&&U.removeEventListener("resize",r)}),M?.(),(V=D)==null||V.disconnect(),D=null,v&&cancelAnimationFrame(B)}}const ude=Rhe,hde=Dhe,dde=Ihe,fde=zhe,pde=Ohe,j6=Mhe,mde=Lhe,gde=(e,t,r)=>{const n=new Map,c={platform:sde,...r},h={...c.platform,_c:n};return Phe(e,t,{...c,platform:h})};var yde=typeof document<"u",_de=function(){},T2=yde?Z.useLayoutEffect:_de;function lE(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,c;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!lE(e[n],t[n]))return!1;return!0}if(c=Object.keys(e),r=c.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,c[n]))return!1;for(n=r;n--!==0;){const h=c[n];if(!(h==="_owner"&&e.$$typeof)&&!lE(e[h],t[h]))return!1}return!0}return e!==e&&t!==t}function bW(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function R6(e,t){const r=bW(e);return Math.round(t*r)/r}function KM(e){const t=Z.useRef(e);return T2(()=>{t.current=e}),t}function vde(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:c,elements:{reference:h,floating:p}={},transform:o=!0,whileElementsMounted:v,open:w}=e,[T,M]=Z.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[O,D]=Z.useState(n);lE(O,n)||D(n);const[B,N]=Z.useState(null),[G,V]=Z.useState(null),U=Z.useCallback(rt=>{rt!==se.current&&(se.current=rt,N(rt))},[]),X=Z.useCallback(rt=>{rt!==le.current&&(le.current=rt,V(rt))},[]),Y=h||B,ne=p||G,se=Z.useRef(null),le=Z.useRef(null),ge=Z.useRef(T),je=v!=null,ze=KM(v),Ce=KM(c),Ke=KM(w),Ye=Z.useCallback(()=>{if(!se.current||!le.current)return;const rt={placement:t,strategy:r,middleware:O};Ce.current&&(rt.platform=Ce.current),gde(se.current,le.current,rt).then(ht=>{const vt={...ht,isPositioned:Ke.current!==!1};Oe.current&&!lE(ge.current,vt)&&(ge.current=vt,Om.flushSync(()=>{M(vt)}))})},[O,t,r,Ce,Ke]);T2(()=>{w===!1&&ge.current.isPositioned&&(ge.current.isPositioned=!1,M(rt=>({...rt,isPositioned:!1})))},[w]);const Oe=Z.useRef(!1);T2(()=>(Oe.current=!0,()=>{Oe.current=!1}),[]),T2(()=>{if(Y&&(se.current=Y),ne&&(le.current=ne),Y&&ne){if(ze.current)return ze.current(Y,ne,Ye);Ye()}},[Y,ne,Ye,ze,je]);const tt=Z.useMemo(()=>({reference:se,floating:le,setReference:U,setFloating:X}),[U,X]),He=Z.useMemo(()=>({reference:Y,floating:ne}),[Y,ne]),lt=Z.useMemo(()=>{const rt={position:r,left:0,top:0};if(!He.floating)return rt;const ht=R6(He.floating,T.x),vt=R6(He.floating,T.y);return o?{...rt,transform:"translate("+ht+"px, "+vt+"px)",...bW(He.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:ht,top:vt}},[r,o,He.floating,T.x,T.y]);return Z.useMemo(()=>({...T,update:Ye,refs:tt,elements:He,floatingStyles:lt}),[T,Ye,tt,He,lt])}const xde=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:c}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?j6({element:n.current,padding:c}).fn(r):{}:n?j6({element:n,padding:c}).fn(r):{}}}},bde=(e,t)=>({...ude(e),options:[e,t]}),wde=(e,t)=>({...hde(e),options:[e,t]}),Sde=(e,t)=>({...mde(e),options:[e,t]}),Tde=(e,t)=>({...dde(e),options:[e,t]}),Ede=(e,t)=>({...fde(e),options:[e,t]}),Ade=(e,t)=>({...pde(e),options:[e,t]}),kde=(e,t)=>({...xde(e),options:[e,t]});var Cde="Arrow",wW=Z.forwardRef((e,t)=>{const{children:r,width:n=10,height:c=5,...h}=e;return C.jsx(fn.svg,{...h,ref:t,width:n,height:c,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:C.jsx("polygon",{points:"0,0 30,0 15,10"})})});wW.displayName=Cde;var Pde=wW;function SW(e){const[t,r]=Z.useState(void 0);return xa(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(c=>{if(!Array.isArray(c)||!c.length)return;const h=c[0];let p,o;if("borderBoxSize"in h){const v=h.borderBoxSize,w=Array.isArray(v)?v[0]:v;p=w.inlineSize,o=w.blockSize}else p=e.offsetWidth,o=e.offsetHeight;r({width:p,height:o})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var JL="Popper",[TW,XA]=wc(JL),[Mde,EW]=TW(JL),AW=e=>{const{__scopePopper:t,children:r}=e,[n,c]=Z.useState(null);return C.jsx(Mde,{scope:t,anchor:n,onAnchorChange:c,children:r})};AW.displayName=JL;var kW="PopperAnchor",CW=Z.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...c}=e,h=EW(kW,r),p=Z.useRef(null),o=yi(t,p),v=Z.useRef(null);return Z.useEffect(()=>{const w=v.current;v.current=n?.current||p.current,w!==v.current&&h.onAnchorChange(v.current)}),n?null:C.jsx(fn.div,{...c,ref:o})});CW.displayName=kW;var QL="PopperContent",[Ide,Ode]=TW(QL),PW=Z.forwardRef((e,t)=>{const{__scopePopper:r,side:n="bottom",sideOffset:c=0,align:h="center",alignOffset:p=0,arrowPadding:o=0,avoidCollisions:v=!0,collisionBoundary:w=[],collisionPadding:T=0,sticky:M="partial",hideWhenDetached:O=!1,updatePositionStrategy:D="optimized",onPlaced:B,...N}=e,G=EW(QL,r),[V,U]=Z.useState(null),X=yi(t,Ft=>U(Ft)),[Y,ne]=Z.useState(null),se=SW(Y),le=se?.width??0,ge=se?.height??0,je=n+(h!=="center"?"-"+h:""),ze=typeof T=="number"?T:{top:0,right:0,bottom:0,left:0,...T},Ce=Array.isArray(w)?w:[w],Ke=Ce.length>0,Ye={padding:ze,boundary:Ce.filter(Rde),altBoundary:Ke},{refs:Oe,floatingStyles:tt,placement:He,isPositioned:lt,middlewareData:rt}=vde({strategy:"fixed",placement:je,whileElementsMounted:(...Ft)=>cde(...Ft,{animationFrame:D==="always"}),elements:{reference:G.anchor},middleware:[bde({mainAxis:c+ge,alignmentAxis:p}),v&&wde({mainAxis:!0,crossAxis:!1,limiter:M==="partial"?Sde():void 0,...Ye}),v&&Tde({...Ye}),Ede({...Ye,apply:({elements:Ft,rects:br,availableWidth:Yt,availableHeight:Qt})=>{const{width:Sr,height:Ut}=br.reference,Nn=Ft.floating.style;Nn.setProperty("--radix-popper-available-width",`${Yt}px`),Nn.setProperty("--radix-popper-available-height",`${Qt}px`),Nn.setProperty("--radix-popper-anchor-width",`${Sr}px`),Nn.setProperty("--radix-popper-anchor-height",`${Ut}px`)}}),Y&&kde({element:Y,padding:o}),Dde({arrowWidth:le,arrowHeight:ge}),O&&Ade({strategy:"referenceHidden",...Ye})]}),[ht,vt]=OW(He),mt=na(B);xa(()=>{lt&&mt?.()},[lt,mt]);const ct=rt.arrow?.x,Vt=rt.arrow?.y,xr=rt.arrow?.centerOffset!==0,[tn,Er]=Z.useState();return xa(()=>{V&&Er(window.getComputedStyle(V).zIndex)},[V]),C.jsx("div",{ref:Oe.setFloating,"data-radix-popper-content-wrapper":"",style:{...tt,transform:lt?tt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:tn,"--radix-popper-transform-origin":[rt.transformOrigin?.x,rt.transformOrigin?.y].join(" "),...rt.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:C.jsx(Ide,{scope:r,placedSide:ht,onArrowChange:ne,arrowX:ct,arrowY:Vt,shouldHideArrow:xr,children:C.jsx(fn.div,{"data-side":ht,"data-align":vt,...N,ref:X,style:{...N.style,animation:lt?void 0:"none"}})})})});PW.displayName=QL;var MW="PopperArrow",jde={top:"bottom",right:"left",bottom:"top",left:"right"},IW=Z.forwardRef(function(e,t){const{__scopePopper:r,...n}=e,c=Ode(MW,r),h=jde[c.placedSide];return C.jsx("span",{ref:c.onArrowChange,style:{position:"absolute",left:c.arrowX,top:c.arrowY,[h]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[c.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[c.placedSide],visibility:c.shouldHideArrow?"hidden":void 0},children:C.jsx(Pde,{...n,ref:t,style:{...n.style,display:"block"}})})});IW.displayName=MW;function Rde(e){return e!==null}var Dde=e=>({name:"transformOrigin",options:e,fn(t){const{placement:r,rects:n,middlewareData:c}=t,h=c.arrow?.centerOffset!==0,p=h?0:e.arrowWidth,o=h?0:e.arrowHeight,[v,w]=OW(r),T={start:"0%",center:"50%",end:"100%"}[w],M=(c.arrow?.x??0)+p/2,O=(c.arrow?.y??0)+o/2;let D="",B="";return v==="bottom"?(D=h?T:`${M}px`,B=`${-o}px`):v==="top"?(D=h?T:`${M}px`,B=`${n.floating.height+o}px`):v==="right"?(D=`${-o}px`,B=h?T:`${O}px`):v==="left"&&(D=`${n.floating.width+o}px`,B=h?T:`${O}px`),{data:{x:D,y:B}}}});function OW(e){const[t,r="center"]=e.split("-");return[t,r]}var Lde=AW,jW=CW,RW=PW,DW=IW,[YA,Qqe]=wc("Tooltip",[XA]),e3=XA(),LW="TooltipProvider",zde=700,D6="tooltip.open",[Nde,zW]=YA(LW),NW=e=>{const{__scopeTooltip:t,delayDuration:r=zde,skipDelayDuration:n=300,disableHoverableContent:c=!1,children:h}=e,p=Z.useRef(!0),o=Z.useRef(!1),v=Z.useRef(0);return Z.useEffect(()=>{const w=v.current;return()=>window.clearTimeout(w)},[]),C.jsx(Nde,{scope:t,isOpenDelayedRef:p,delayDuration:r,onOpen:Z.useCallback(()=>{window.clearTimeout(v.current),p.current=!1},[]),onClose:Z.useCallback(()=>{window.clearTimeout(v.current),v.current=window.setTimeout(()=>p.current=!0,n)},[n]),isPointerInTransitRef:o,onPointerInTransitChange:Z.useCallback(w=>{o.current=w},[]),disableHoverableContent:c,children:h})};NW.displayName=LW;var FW="Tooltip",[eHe,JA]=YA(FW),cj="TooltipTrigger",Fde=Z.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,c=JA(cj,r),h=zW(cj,r),p=e3(r),o=Z.useRef(null),v=yi(t,o,c.onTriggerChange),w=Z.useRef(!1),T=Z.useRef(!1),M=Z.useCallback(()=>w.current=!1,[]);return Z.useEffect(()=>()=>document.removeEventListener("pointerup",M),[M]),C.jsx(jW,{asChild:!0,...p,children:C.jsx(fn.button,{"aria-describedby":c.open?c.contentId:void 0,"data-state":c.stateAttribute,...n,ref:v,onPointerMove:Zr(e.onPointerMove,O=>{O.pointerType!=="touch"&&!T.current&&!h.isPointerInTransitRef.current&&(c.onTriggerEnter(),T.current=!0)}),onPointerLeave:Zr(e.onPointerLeave,()=>{c.onTriggerLeave(),T.current=!1}),onPointerDown:Zr(e.onPointerDown,()=>{c.open&&c.onClose(),w.current=!0,document.addEventListener("pointerup",M,{once:!0})}),onFocus:Zr(e.onFocus,()=>{w.current||c.onOpen()}),onBlur:Zr(e.onBlur,c.onClose),onClick:Zr(e.onClick,c.onClose)})})});Fde.displayName=cj;var Bde="TooltipPortal",[tHe,Ude]=YA(Bde,{forceMount:void 0}),__="TooltipContent",BW=Z.forwardRef((e,t)=>{const r=Ude(__,e.__scopeTooltip),{forceMount:n=r.forceMount,side:c="top",...h}=e,p=JA(__,e.__scopeTooltip);return C.jsx(Sc,{present:n||p.open,children:p.disableHoverableContent?C.jsx(UW,{side:c,...h,ref:t}):C.jsx(Vde,{side:c,...h,ref:t})})}),Vde=Z.forwardRef((e,t)=>{const r=JA(__,e.__scopeTooltip),n=zW(__,e.__scopeTooltip),c=Z.useRef(null),h=yi(t,c),[p,o]=Z.useState(null),{trigger:v,onClose:w}=r,T=c.current,{onPointerInTransitChange:M}=n,O=Z.useCallback(()=>{o(null),M(!1)},[M]),D=Z.useCallback((B,N)=>{const G=B.currentTarget,V={x:B.clientX,y:B.clientY},U=Wde(V,G.getBoundingClientRect()),X=Zde(V,U),Y=Kde(N.getBoundingClientRect()),ne=Yde([...X,...Y]);o(ne),M(!0)},[M]);return Z.useEffect(()=>()=>O(),[O]),Z.useEffect(()=>{if(v&&T){const B=G=>D(G,T),N=G=>D(G,v);return v.addEventListener("pointerleave",B),T.addEventListener("pointerleave",N),()=>{v.removeEventListener("pointerleave",B),T.removeEventListener("pointerleave",N)}}},[v,T,D,O]),Z.useEffect(()=>{if(p){const B=N=>{const G=N.target,V={x:N.clientX,y:N.clientY},U=v?.contains(G)||T?.contains(G),X=!Xde(V,p);U?O():X&&(O(),w())};return document.addEventListener("pointermove",B),()=>document.removeEventListener("pointermove",B)}},[v,T,p,w,O]),C.jsx(UW,{...e,ref:h})}),[$de,Gde]=YA(FW,{isInside:!1}),qde=Gle("TooltipContent"),UW=Z.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":c,onEscapeKeyDown:h,onPointerDownOutside:p,...o}=e,v=JA(__,r),w=e3(r),{onClose:T}=v;return Z.useEffect(()=>(document.addEventListener(D6,T),()=>document.removeEventListener(D6,T)),[T]),Z.useEffect(()=>{if(v.trigger){const M=O=>{O.target?.contains(v.trigger)&&T()};return window.addEventListener("scroll",M,{capture:!0}),()=>window.removeEventListener("scroll",M,{capture:!0})}},[v.trigger,T]),C.jsx(Hw,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:h,onPointerDownOutside:p,onFocusOutside:M=>M.preventDefault(),onDismiss:T,children:C.jsxs(RW,{"data-state":v.stateAttribute,...w,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[C.jsx(qde,{children:n}),C.jsx($de,{scope:r,isInside:!0,children:C.jsx(dce,{id:v.contentId,role:"tooltip",children:c||n})})]})})});BW.displayName=__;var VW="TooltipArrow",Hde=Z.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,c=e3(r);return Gde(VW,r).isInside?null:C.jsx(DW,{...c,...n,ref:t})});Hde.displayName=VW;function Wde(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),c=Math.abs(t.right-e.x),h=Math.abs(t.left-e.x);switch(Math.min(r,n,c,h)){case h:return"left";case c:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function Zde(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function Kde(e){const{top:t,right:r,bottom:n,left:c}=e;return[{x:c,y:t},{x:r,y:t},{x:r,y:n},{x:c,y:n}]}function Xde(e,t){const{x:r,y:n}=e;let c=!1;for(let h=0,p=t.length-1;h<t.length;p=h++){const o=t[h],v=t[p],w=o.x,T=o.y,M=v.x,O=v.y;T>n!=O>n&&r<(M-w)*(n-T)/(O-T)+w&&(c=!c)}return c}function Yde(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),Jde(t)}function Jde(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const c=e[n];for(;t.length>=2;){const h=t[t.length-1],p=t[t.length-2];if((h.x-p.x)*(c.y-p.y)>=(h.y-p.y)*(c.x-p.x))t.pop();else break}t.push(c)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const c=e[n];for(;r.length>=2;){const h=r[r.length-1],p=r[r.length-2];if((h.x-p.x)*(c.y-p.y)>=(h.y-p.y)*(c.x-p.x))r.pop();else break}r.push(c)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var Qde=NW,$W=BW;const efe=Qde,tfe=Z.forwardRef(({className:e,sideOffset:t=4,...r},n)=>C.jsx($W,{ref:n,sideOffset:t,className:ln("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));tfe.displayName=$W.displayName;var QA=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ek=typeof window>"u"||"Deno"in globalThis;function uc(){}function rfe(e,t){return typeof e=="function"?e(t):e}function nfe(e){return typeof e=="number"&&e>=0&&e!==1/0}function ife(e,t){return Math.max(e+(t||0)-Date.now(),0)}function uj(e,t){return typeof e=="function"?e(t):e}function ofe(e,t){return typeof e=="function"?e(t):e}function L6(e,t){const{type:r="all",exact:n,fetchStatus:c,predicate:h,queryKey:p,stale:o}=e;if(p){if(n){if(t.queryHash!==t3(p,t.options))return!1}else if(!Jb(t.queryKey,p))return!1}if(r!=="all"){const v=t.isActive();if(r==="active"&&!v||r==="inactive"&&v)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||c&&c!==t.state.fetchStatus||h&&!h(t))}function z6(e,t){const{exact:r,status:n,predicate:c,mutationKey:h}=e;if(h){if(!t.options.mutationKey)return!1;if(r){if(Yb(t.options.mutationKey)!==Yb(h))return!1}else if(!Jb(t.options.mutationKey,h))return!1}return!(n&&t.state.status!==n||c&&!c(t))}function t3(e,t){return(t?.queryKeyHashFn||Yb)(e)}function Yb(e){return JSON.stringify(e,(t,r)=>hj(r)?Object.keys(r).sort().reduce((n,c)=>(n[c]=r[c],n),{}):r)}function Jb(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>Jb(e[r],t[r])):!1}function GW(e,t){if(e===t)return e;const r=N6(e)&&N6(t);if(r||hj(e)&&hj(t)){const n=r?e:Object.keys(e),c=n.length,h=r?t:Object.keys(t),p=h.length,o=r?[]:{},v=new Set(n);let w=0;for(let T=0;T<p;T++){const M=r?T:h[T];(!r&&v.has(M)||r)&&e[M]===void 0&&t[M]===void 0?(o[M]=void 0,w++):(o[M]=GW(e[M],t[M]),o[M]===e[M]&&e[M]!==void 0&&w++)}return c===p&&w===c?e:o}return t}function N6(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function hj(e){if(!F6(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!F6(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function F6(e){return Object.prototype.toString.call(e)==="[object Object]"}function afe(e){return new Promise(t=>{setTimeout(t,e)})}function sfe(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?GW(e,t):t}function lfe(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function cfe(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var r3=Symbol();function qW(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===r3?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var ay,Cp,Cx,B6,ufe=(B6=class extends QA{constructor(){super(),Ai(this,ay),Ai(this,Cp),Ai(this,Cx),Bn(this,Cx,e=>{if(!ek&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){Xt(this,Cp)||this.setEventListener(Xt(this,Cx))}onUnsubscribe(){var e;this.hasListeners()||((e=Xt(this,Cp))==null||e.call(this),Bn(this,Cp,void 0))}setEventListener(e){var t;Bn(this,Cx,e),(t=Xt(this,Cp))==null||t.call(this),Bn(this,Cp,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){Xt(this,ay)!==e&&(Bn(this,ay,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof Xt(this,ay)=="boolean"?Xt(this,ay):globalThis.document?.visibilityState!=="hidden"}},ay=new WeakMap,Cp=new WeakMap,Cx=new WeakMap,B6),HW=new ufe,Px,Pp,Mx,U6,hfe=(U6=class extends QA{constructor(){super(),Ai(this,Px,!0),Ai(this,Pp),Ai(this,Mx),Bn(this,Mx,e=>{if(!ek&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){Xt(this,Pp)||this.setEventListener(Xt(this,Mx))}onUnsubscribe(){var e;this.hasListeners()||((e=Xt(this,Pp))==null||e.call(this),Bn(this,Pp,void 0))}setEventListener(e){var t;Bn(this,Mx,e),(t=Xt(this,Pp))==null||t.call(this),Bn(this,Pp,e(this.setOnline.bind(this)))}setOnline(e){Xt(this,Px)!==e&&(Bn(this,Px,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return Xt(this,Px)}},Px=new WeakMap,Pp=new WeakMap,Mx=new WeakMap,U6),cE=new hfe;function dfe(){let e,t;const r=new Promise((c,h)=>{e=c,t=h});r.status="pending",r.catch(()=>{});function n(c){Object.assign(r,c),delete r.resolve,delete r.reject}return r.resolve=c=>{n({status:"fulfilled",value:c}),e(c)},r.reject=c=>{n({status:"rejected",reason:c}),t(c)},r}function ffe(e){return Math.min(1e3*2**e,3e4)}function WW(e){return(e??"online")==="online"?cE.isOnline():!0}var ZW=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function KW(e){let t=!1,r=0,n;const c=dfe(),h=()=>c.status!=="pending",p=N=>{h()||(O(new ZW(N)),e.abort?.())},o=()=>{t=!0},v=()=>{t=!1},w=()=>HW.isFocused()&&(e.networkMode==="always"||cE.isOnline())&&e.canRun(),T=()=>WW(e.networkMode)&&e.canRun(),M=N=>{h()||(n?.(),c.resolve(N))},O=N=>{h()||(n?.(),c.reject(N))},D=()=>new Promise(N=>{n=G=>{(h()||w())&&N(G)},e.onPause?.()}).then(()=>{n=void 0,h()||e.onContinue?.()}),B=()=>{if(h())return;let N;const G=r===0?e.initialPromise:void 0;try{N=G??e.fn()}catch(V){N=Promise.reject(V)}Promise.resolve(N).then(M).catch(V=>{if(h())return;const U=e.retry??(ek?0:3),X=e.retryDelay??ffe,Y=typeof X=="function"?X(r,V):X,ne=U===!0||typeof U=="number"&&r<U||typeof U=="function"&&U(r,V);if(t||!ne){O(V);return}r++,e.onFail?.(r,V),afe(Y).then(()=>w()?void 0:D()).then(()=>{t?O(V):B()})})};return{promise:c,status:()=>c.status,cancel:p,continue:()=>(n?.(),c),cancelRetry:o,continueRetry:v,canStart:T,start:()=>(T()?B():D().then(B),c)}}var pfe=e=>setTimeout(e,0);function mfe(){let e=[],t=0,r=o=>{o()},n=o=>{o()},c=pfe;const h=o=>{t?e.push(o):c(()=>{r(o)})},p=()=>{const o=e;e=[],o.length&&c(()=>{n(()=>{o.forEach(v=>{r(v)})})})};return{batch:o=>{let v;t++;try{v=o()}finally{t--,t||p()}return v},batchCalls:o=>(...v)=>{h(()=>{o(...v)})},schedule:h,setNotifyFunction:o=>{r=o},setBatchNotifyFunction:o=>{n=o},setScheduler:o=>{c=o}}}var ms=mfe(),sy,V6,XW=(V6=class{constructor(){Ai(this,sy)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),nfe(this.gcTime)&&Bn(this,sy,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(ek?1/0:5*60*1e3))}clearGcTimeout(){Xt(this,sy)&&(clearTimeout(Xt(this,sy)),Bn(this,sy,void 0))}},sy=new WeakMap,V6),Ix,Ox,ic,ly,ja,jT,cy,su,nh,$6,gfe=($6=class extends XW{constructor(e){super(),Ai(this,su),Ai(this,Ix),Ai(this,Ox),Ai(this,ic),Ai(this,ly),Ai(this,ja),Ai(this,jT),Ai(this,cy),Bn(this,cy,!1),Bn(this,jT,e.defaultOptions),this.setOptions(e.options),this.observers=[],Bn(this,ly,e.client),Bn(this,ic,Xt(this,ly).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Bn(this,Ix,_fe(this.options)),this.state=e.state??Xt(this,Ix),this.scheduleGc()}get meta(){return this.options.meta}get promise(){return Xt(this,ja)?.promise}setOptions(e){this.options={...Xt(this,jT),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Xt(this,ic).remove(this)}setData(e,t){const r=sfe(this.state.data,e,this.options);return ps(this,su,nh).call(this,{data:r,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),r}setState(e,t){ps(this,su,nh).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){const t=Xt(this,ja)?.promise;return Xt(this,ja)?.cancel(e),t?t.then(uc).catch(uc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Xt(this,Ix))}isActive(){return this.observers.some(e=>ofe(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===r3||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>uj(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!ife(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),Xt(this,ja)?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),Xt(this,ja)?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),Xt(this,ic).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(Xt(this,ja)&&(Xt(this,cy)?Xt(this,ja).cancel({revert:!0}):Xt(this,ja).cancelRetry()),this.scheduleGc()),Xt(this,ic).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ps(this,su,nh).call(this,{type:"invalidate"})}async fetch(e,t){if(this.state.fetchStatus!=="idle"&&Xt(this,ja)?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(Xt(this,ja))return Xt(this,ja).continueRetry(),Xt(this,ja).promise}if(e&&this.setOptions(e),!this.options.queryFn){const p=this.observers.find(o=>o.options.queryFn);p&&this.setOptions(p.options)}const r=new AbortController,n=p=>{Object.defineProperty(p,"signal",{enumerable:!0,get:()=>(Bn(this,cy,!0),r.signal)})},c=()=>{const p=qW(this.options,t),o=(()=>{const v={client:Xt(this,ly),queryKey:this.queryKey,meta:this.meta};return n(v),v})();return Bn(this,cy,!1),this.options.persister?this.options.persister(p,o,this):p(o)},h=(()=>{const p={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:Xt(this,ly),state:this.state,fetchFn:c};return n(p),p})();this.options.behavior?.onFetch(h,this),Bn(this,Ox,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==h.fetchOptions?.meta)&&ps(this,su,nh).call(this,{type:"fetch",meta:h.fetchOptions?.meta}),Bn(this,ja,KW({initialPromise:t?.initialPromise,fn:h.fetchFn,abort:r.abort.bind(r),onFail:(p,o)=>{ps(this,su,nh).call(this,{type:"failed",failureCount:p,error:o})},onPause:()=>{ps(this,su,nh).call(this,{type:"pause"})},onContinue:()=>{ps(this,su,nh).call(this,{type:"continue"})},retry:h.options.retry,retryDelay:h.options.retryDelay,networkMode:h.options.networkMode,canRun:()=>!0}));try{const p=await Xt(this,ja).start();if(p===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(p),Xt(this,ic).config.onSuccess?.(p,this),Xt(this,ic).config.onSettled?.(p,this.state.error,this),p}catch(p){if(p instanceof ZW){if(p.silent)return Xt(this,ja).promise;if(p.revert){if(this.setState({...Xt(this,Ox),fetchStatus:"idle"}),this.state.data===void 0)throw p;return this.state.data}}throw ps(this,su,nh).call(this,{type:"error",error:p}),Xt(this,ic).config.onError?.(p,this),Xt(this,ic).config.onSettled?.(this.state.data,p,this),p}finally{this.scheduleGc()}}},Ix=new WeakMap,Ox=new WeakMap,ic=new WeakMap,ly=new WeakMap,ja=new WeakMap,jT=new WeakMap,cy=new WeakMap,su=new WeakSet,nh=function(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...yfe(r.data,this.options),fetchMeta:e.meta??null};case"success":const n={...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Bn(this,Ox,e.manual?n:void 0),n;case"error":const c=e.error;return{...r,error:c,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:c,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),ms.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),Xt(this,ic).notify({query:this,type:"updated",action:e})})},$6);function yfe(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:WW(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function _fe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var ih,G6,vfe=(G6=class extends QA{constructor(e={}){super(),Ai(this,ih),this.config=e,Bn(this,ih,new Map)}build(e,t,r){const n=t.queryKey,c=t.queryHash??t3(n,t);let h=this.get(c);return h||(h=new gfe({client:e,queryKey:n,queryHash:c,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(n)}),this.add(h)),h}add(e){Xt(this,ih).has(e.queryHash)||(Xt(this,ih).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=Xt(this,ih).get(e.queryHash);t&&(e.destroy(),t===e&&Xt(this,ih).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){ms.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return Xt(this,ih).get(e)}getAll(){return[...Xt(this,ih).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(r=>L6(t,r))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(r=>L6(e,r)):t}notify(e){ms.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){ms.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){ms.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ih=new WeakMap,G6),oh,Ls,uy,ah,zd,q6,xfe=(q6=class extends XW{constructor(e){super(),Ai(this,ah),Ai(this,oh),Ai(this,Ls),Ai(this,uy),this.mutationId=e.mutationId,Bn(this,Ls,e.mutationCache),Bn(this,oh,[]),this.state=e.state||bfe(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){Xt(this,oh).includes(e)||(Xt(this,oh).push(e),this.clearGcTimeout(),Xt(this,Ls).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Bn(this,oh,Xt(this,oh).filter(t=>t!==e)),this.scheduleGc(),Xt(this,Ls).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){Xt(this,oh).length||(this.state.status==="pending"?this.scheduleGc():Xt(this,Ls).remove(this))}continue(){return Xt(this,uy)?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{ps(this,ah,zd).call(this,{type:"continue"})};Bn(this,uy,KW({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(c,h)=>{ps(this,ah,zd).call(this,{type:"failed",failureCount:c,error:h})},onPause:()=>{ps(this,ah,zd).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Xt(this,Ls).canRun(this)}));const r=this.state.status==="pending",n=!Xt(this,uy).canStart();try{if(r)t();else{ps(this,ah,zd).call(this,{type:"pending",variables:e,isPaused:n}),await Xt(this,Ls).config.onMutate?.(e,this);const h=await this.options.onMutate?.(e);h!==this.state.context&&ps(this,ah,zd).call(this,{type:"pending",context:h,variables:e,isPaused:n})}const c=await Xt(this,uy).start();return await Xt(this,Ls).config.onSuccess?.(c,e,this.state.context,this),await this.options.onSuccess?.(c,e,this.state.context),await Xt(this,Ls).config.onSettled?.(c,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(c,null,e,this.state.context),ps(this,ah,zd).call(this,{type:"success",data:c}),c}catch(c){try{throw await Xt(this,Ls).config.onError?.(c,e,this.state.context,this),await this.options.onError?.(c,e,this.state.context),await Xt(this,Ls).config.onSettled?.(void 0,c,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,c,e,this.state.context),c}finally{ps(this,ah,zd).call(this,{type:"error",error:c})}}finally{Xt(this,Ls).runNext(this)}}},oh=new WeakMap,Ls=new WeakMap,uy=new WeakMap,ah=new WeakSet,zd=function(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),ms.batch(()=>{Xt(this,oh).forEach(r=>{r.onMutationUpdate(e)}),Xt(this,Ls).notify({mutation:this,type:"updated",action:e})})},q6);function bfe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Nd,lu,RT,H6,wfe=(H6=class extends QA{constructor(e={}){super(),Ai(this,Nd),Ai(this,lu),Ai(this,RT),this.config=e,Bn(this,Nd,new Set),Bn(this,lu,new Map),Bn(this,RT,0)}build(e,t,r){const n=new xfe({mutationCache:this,mutationId:++iO(this,RT)._,options:e.defaultMutationOptions(t),state:r});return this.add(n),n}add(e){Xt(this,Nd).add(e);const t=DT(e);if(typeof t=="string"){const r=Xt(this,lu).get(t);r?r.push(e):Xt(this,lu).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(Xt(this,Nd).delete(e)){const t=DT(e);if(typeof t=="string"){const r=Xt(this,lu).get(t);if(r)if(r.length>1){const n=r.indexOf(e);n!==-1&&r.splice(n,1)}else r[0]===e&&Xt(this,lu).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=DT(e);if(typeof t=="string"){const r=Xt(this,lu).get(t)?.find(n=>n.state.status==="pending");return!r||r===e}else return!0}runNext(e){const t=DT(e);return typeof t=="string"?Xt(this,lu).get(t)?.find(r=>r!==e&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ms.batch(()=>{Xt(this,Nd).forEach(e=>{this.notify({type:"removed",mutation:e})}),Xt(this,Nd).clear(),Xt(this,lu).clear()})}getAll(){return Array.from(Xt(this,Nd))}find(e){const t={exact:!0,...e};return this.getAll().find(r=>z6(t,r))}findAll(e={}){return this.getAll().filter(t=>z6(e,t))}notify(e){ms.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return ms.batch(()=>Promise.all(e.map(t=>t.continue().catch(uc))))}},Nd=new WeakMap,lu=new WeakMap,RT=new WeakMap,H6);function DT(e){return e.options.scope?.id}function W6(e){return{onFetch:(t,r)=>{const n=t.options,c=t.fetchOptions?.meta?.fetchMore?.direction,h=t.state.data?.pages||[],p=t.state.data?.pageParams||[];let o={pages:[],pageParams:[]},v=0;const w=async()=>{let T=!1;const M=B=>{Object.defineProperty(B,"signal",{enumerable:!0,get:()=>(t.signal.aborted?T=!0:t.signal.addEventListener("abort",()=>{T=!0}),t.signal)})},O=qW(t.options,t.fetchOptions),D=async(B,N,G)=>{if(T)return Promise.reject();if(N==null&&B.pages.length)return Promise.resolve(B);const V=(()=>{const ne={client:t.client,queryKey:t.queryKey,pageParam:N,direction:G?"backward":"forward",meta:t.options.meta};return M(ne),ne})(),U=await O(V),{maxPages:X}=t.options,Y=G?cfe:lfe;return{pages:Y(B.pages,U,X),pageParams:Y(B.pageParams,N,X)}};if(c&&h.length){const B=c==="backward",N=B?Sfe:Z6,G={pages:h,pageParams:p},V=N(n,G);o=await D(G,V,B)}else{const B=e??h.length;do{const N=v===0?p[0]??n.initialPageParam:Z6(n,o);if(v>0&&N==null)break;o=await D(o,N),v++}while(v<B)}return o};t.options.persister?t.fetchFn=()=>t.options.persister?.(w,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r):t.fetchFn=w}}}function Z6(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function Sfe(e,{pages:t,pageParams:r}){return t.length>0?e.getPreviousPageParam?.(t[0],t,r[0],r):void 0}var Oo,Mp,Ip,jx,Rx,Op,Dx,Lx,K6,Tfe=(K6=class{constructor(e={}){Ai(this,Oo),Ai(this,Mp),Ai(this,Ip),Ai(this,jx),Ai(this,Rx),Ai(this,Op),Ai(this,Dx),Ai(this,Lx),Bn(this,Oo,e.queryCache||new vfe),Bn(this,Mp,e.mutationCache||new wfe),Bn(this,Ip,e.defaultOptions||{}),Bn(this,jx,new Map),Bn(this,Rx,new Map),Bn(this,Op,0)}mount(){iO(this,Op)._++,Xt(this,Op)===1&&(Bn(this,Dx,HW.subscribe(async e=>{e&&(await this.resumePausedMutations(),Xt(this,Oo).onFocus())})),Bn(this,Lx,cE.subscribe(async e=>{e&&(await this.resumePausedMutations(),Xt(this,Oo).onOnline())})))}unmount(){var e,t;iO(this,Op)._--,Xt(this,Op)===0&&((e=Xt(this,Dx))==null||e.call(this),Bn(this,Dx,void 0),(t=Xt(this,Lx))==null||t.call(this),Bn(this,Lx,void 0))}isFetching(e){return Xt(this,Oo).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Xt(this,Mp).findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return Xt(this,Oo).get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=Xt(this,Oo).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(uj(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return Xt(this,Oo).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),c=Xt(this,Oo).get(n.queryHash)?.state.data,h=rfe(t,c);if(h!==void 0)return Xt(this,Oo).build(this,n).setData(h,{...r,manual:!0})}setQueriesData(e,t,r){return ms.batch(()=>Xt(this,Oo).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return Xt(this,Oo).get(t.queryHash)?.state}removeQueries(e){const t=Xt(this,Oo);ms.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=Xt(this,Oo);return ms.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=ms.batch(()=>Xt(this,Oo).findAll(e).map(c=>c.cancel(r)));return Promise.all(n).then(uc).catch(uc)}invalidateQueries(e,t={}){return ms.batch(()=>(Xt(this,Oo).findAll(e).forEach(r=>{r.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=ms.batch(()=>Xt(this,Oo).findAll(e).filter(c=>!c.isDisabled()&&!c.isStatic()).map(c=>{let h=c.fetch(void 0,r);return r.throwOnError||(h=h.catch(uc)),c.state.fetchStatus==="paused"?Promise.resolve():h}));return Promise.all(n).then(uc)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=Xt(this,Oo).build(this,t);return r.isStaleByTime(uj(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(uc).catch(uc)}fetchInfiniteQuery(e){return e.behavior=W6(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(uc).catch(uc)}ensureInfiniteQueryData(e){return e.behavior=W6(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return cE.isOnline()?Xt(this,Mp).resumePausedMutations():Promise.resolve()}getQueryCache(){return Xt(this,Oo)}getMutationCache(){return Xt(this,Mp)}getDefaultOptions(){return Xt(this,Ip)}setDefaultOptions(e){Bn(this,Ip,e)}setQueryDefaults(e,t){Xt(this,jx).set(Yb(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Xt(this,jx).values()],r={};return t.forEach(n=>{Jb(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){Xt(this,Rx).set(Yb(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Xt(this,Rx).values()],r={};return t.forEach(n=>{Jb(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Xt(this,Ip).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=t3(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===r3&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...Xt(this,Ip).mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Xt(this,Oo).clear(),Xt(this,Mp).clear()}},Oo=new WeakMap,Mp=new WeakMap,Ip=new WeakMap,jx=new WeakMap,Rx=new WeakMap,Op=new WeakMap,Dx=new WeakMap,Lx=new WeakMap,K6),Efe=Z.createContext(void 0),Afe=({client:e,children:t})=>(Z.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),C.jsx(Efe.Provider,{value:e,children:t}));/**
* @remix-run/router v1.23.0
*
* Copyright (c) Remix Software Inc.
*
* This source code is licensed under the MIT license found in the
* LICENSE.md file in the root directory of this source tree.
*
* @license MIT
*/function uE(){return uE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uE.apply(this,arguments)}var ef;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(ef||(ef={}));const X6="popstate";function kfe(e){e===void 0&&(e={});function t(n,c){let{pathname:h,search:p,hash:o}=n.location;return dj("",{pathname:h,search:p,hash:o},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function r(n,c){return typeof c=="string"?c:JW(c)}return Pfe(t,r,null,e)}function Zs(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function YW(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Cfe(){return Math.random().toString(36).substr(2,8)}function Y6(e,t){return{usr:e.state,key:e.key,idx:t}}function dj(e,t,r,n){return r===void 0&&(r=null),uE({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?tk(t):t,{state:r,key:t&&t.key||n||Cfe()})}function JW(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function tk(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Pfe(e,t,r,n){n===void 0&&(n={});let{window:c=document.defaultView,v5Compat:h=!1}=n,p=c.history,o=ef.Pop,v=null,w=T();w==null&&(w=0,p.replaceState(uE({},p.state,{idx:w}),""));function T(){return(p.state||{idx:null}).idx}function M(){o=ef.Pop;let G=T(),V=G==null?null:G-w;w=G,v&&v({action:o,location:N.location,delta:V})}function O(G,V){o=ef.Push;let U=dj(N.location,G,V);w=T()+1;let X=Y6(U,w),Y=N.createHref(U);try{p.pushState(X,"",Y)}catch(ne){if(ne instanceof DOMException&&ne.name==="DataCloneError")throw ne;c.location.assign(Y)}h&&v&&v({action:o,location:N.location,delta:1})}function D(G,V){o=ef.Replace;let U=dj(N.location,G,V);w=T();let X=Y6(U,w),Y=N.createHref(U);p.replaceState(X,"",Y),h&&v&&v({action:o,location:N.location,delta:0})}function B(G){let V=c.location.origin!=="null"?c.location.origin:c.location.href,U=typeof G=="string"?G:JW(G);return U=U.replace(/ $/,"%20"),Zs(V,"No window.location.(origin|href) available to create URL for href: "+U),new URL(U,V)}let N={get action(){return o},get location(){return e(c,p)},listen(G){if(v)throw new Error("A history only accepts one active listener");return c.addEventListener(X6,M),v=G,()=>{c.removeEventListener(X6,M),v=null}},createHref(G){return t(c,G)},createURL:B,encodeLocation(G){let V=B(G);return{pathname:V.pathname,search:V.search,hash:V.hash}},push:O,replace:D,go(G){return p.go(G)}};return N}var J6;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(J6||(J6={}));function Mfe(e,t,r){return r===void 0&&(r="/"),Ife(e,t,r)}function Ife(e,t,r,n){let c=typeof t=="string"?tk(t):t,h=tZ(c.pathname||"/",r);if(h==null)return null;let p=QW(e);Ofe(p);let o=null;for(let v=0;o==null&&v<p.length;++v){let w=Gfe(h);o=Ufe(p[v],w)}return o}function QW(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let c=(h,p,o)=>{let v={relativePath:o===void 0?h.path||"":o,caseSensitive:h.caseSensitive===!0,childrenIndex:p,route:h};v.relativePath.startsWith("/")&&(Zs(v.relativePath.startsWith(n),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(n.length));let w=e_([n,v.relativePath]),T=r.concat(v);h.children&&h.children.length>0&&(Zs(h.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+w+'".')),QW(h.children,t,T,w)),!(h.path==null&&!h.index)&&t.push({path:w,score:Ffe(w,h.index),routesMeta:T})};return e.forEach((h,p)=>{var o;if(h.path===""||!((o=h.path)!=null&&o.includes("?")))c(h,p);else for(let v of eZ(h.path))c(h,p,v)}),t}function eZ(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,c=r.endsWith("?"),h=r.replace(/\?$/,"");if(n.length===0)return c?[h,""]:[h];let p=eZ(n.join("/")),o=[];return o.push(...p.map(v=>v===""?h:[h,v].join("/"))),c&&o.push(...p),o.map(v=>e.startsWith("/")&&v===""?"/":v)}function Ofe(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Bfe(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const jfe=/^:[\w-]+$/,Rfe=3,Dfe=2,Lfe=1,zfe=10,Nfe=-2,Q6=e=>e==="*";function Ffe(e,t){let r=e.split("/"),n=r.length;return r.some(Q6)&&(n+=Nfe),t&&(n+=Dfe),r.filter(c=>!Q6(c)).reduce((c,h)=>c+(jfe.test(h)?Rfe:h===""?Lfe:zfe),n)}function Bfe(e,t){return e.length===t.length&&e.slice(0,-1).every((r,n)=>r===t[n])?e[e.length-1]-t[t.length-1]:0}function Ufe(e,t,r){let{routesMeta:n}=e,c={},h="/",p=[];for(let o=0;o<n.length;++o){let v=n[o],w=o===n.length-1,T=h==="/"?t:t.slice(h.length)||"/",M=Vfe({path:v.relativePath,caseSensitive:v.caseSensitive,end:w},T),O=v.route;if(!M)return null;Object.assign(c,M.params),p.push({params:c,pathname:e_([h,M.pathname]),pathnameBase:qfe(e_([h,M.pathnameBase])),route:O}),M.pathnameBase!=="/"&&(h=e_([h,M.pathnameBase]))}return p}function Vfe(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=$fe(e.path,e.caseSensitive,e.end),c=t.match(r);if(!c)return null;let h=c[0],p=h.replace(/(.)\/+$/,"$1"),o=c.slice(1);return{params:n.reduce((v,w,T)=>{let{paramName:M,isOptional:O}=w;if(M==="*"){let B=o[T]||"";p=h.slice(0,h.length-B.length).replace(/(.)\/+$/,"$1")}const D=o[T];return O&&!D?v[M]=void 0:v[M]=(D||"").replace(/%2F/g,"/"),v},{}),pathname:h,pathnameBase:p,pattern:e}}function $fe(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),YW(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],c="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(h,p,o)=>(n.push({paramName:p,isOptional:o!=null}),o?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),c+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":e!==""&&e!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,t?void 0:"i"),n]}function Gfe(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return YW(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function tZ(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}const e_=e=>e.join("/").replace(/\/\/+/g,"/"),qfe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/");function Hfe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const rZ=["post","put","patch","delete"];new Set(rZ);const Wfe=["get",...rZ];new Set(Wfe);/**
* React Router v6.30.1
*
* Copyright (c) Remix Software Inc.
*
* This source code is licensed under the MIT license found in the
* LICENSE.md file in the root directory of this source tree.
*
* @license MIT
*/function hE(){return hE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hE.apply(this,arguments)}const Zfe=Z.createContext(null),Kfe=Z.createContext(null),nZ=Z.createContext(null),rk=Z.createContext(null),nk=Z.createContext({outlet:null,matches:[],isDataRoute:!1}),iZ=Z.createContext(null);function n3(){return Z.useContext(rk)!=null}function oZ(){return n3()||Zs(!1),Z.useContext(rk).location}function Xfe(e,t){return Yfe(e,t)}function Yfe(e,t,r,n){n3()||Zs(!1);let{navigator:c}=Z.useContext(nZ),{matches:h}=Z.useContext(nk),p=h[h.length-1],o=p?p.params:{};p&&p.pathname;let v=p?p.pathnameBase:"/";p&&p.route;let w=oZ(),T;if(t){var M;let G=typeof t=="string"?tk(t):t;v==="/"||(M=G.pathname)!=null&&M.startsWith(v)||Zs(!1),T=G}else T=w;let O=T.pathname||"/",D=O;if(v!=="/"){let G=v.replace(/^\//,"").split("/");D="/"+O.replace(/^\//,"").split("/").slice(G.length).join("/")}let B=Mfe(e,{pathname:D}),N=rpe(B&&B.map(G=>Object.assign({},G,{params:Object.assign({},o,G.params),pathname:e_([v,c.encodeLocation?c.encodeLocation(G.pathname).pathname:G.pathname]),pathnameBase:G.pathnameBase==="/"?v:e_([v,c.encodeLocation?c.encodeLocation(G.pathnameBase).pathname:G.pathnameBase])})),h,r,n);return t&&N?Z.createElement(rk.Provider,{value:{location:hE({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:ef.Pop}},N):N}function Jfe(){let e=ape(),t=Hfe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Z.createElement(Z.Fragment,null,Z.createElement("h2",null,"Unexpected Application Error!"),Z.createElement("h3",{style:{fontStyle:"italic"}},t),r?Z.createElement("pre",{style:n},r):null,null)}const Qfe=Z.createElement(Jfe,null);class epe extends Z.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?Z.createElement(nk.Provider,{value:this.props.routeContext},Z.createElement(iZ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function tpe(e){let{routeContext:t,match:r,children:n}=e,c=Z.useContext(Zfe);return c&&c.static&&c.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=r.route.id),Z.createElement(nk.Provider,{value:t},n)}function rpe(e,t,r,n){var c;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var h;if(!r)return null;if(r.errors)e=r.matches;else if((h=n)!=null&&h.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let p=e,o=(c=r)==null?void 0:c.errors;if(o!=null){let T=p.findIndex(M=>M.route.id&&o?.[M.route.id]!==void 0);T>=0||Zs(!1),p=p.slice(0,Math.min(p.length,T+1))}let v=!1,w=-1;if(r&&n&&n.v7_partialHydration)for(let T=0;T<p.length;T++){let M=p[T];if((M.route.HydrateFallback||M.route.hydrateFallbackElement)&&(w=T),M.route.id){let{loaderData:O,errors:D}=r,B=M.route.loader&&O[M.route.id]===void 0&&(!D||D[M.route.id]===void 0);if(M.route.lazy||B){v=!0,w>=0?p=p.slice(0,w+1):p=[p[0]];break}}}return p.reduceRight((T,M,O)=>{let D,B=!1,N=null,G=null;r&&(D=o&&M.route.id?o[M.route.id]:void 0,N=M.route.errorElement||Qfe,v&&(w<0&&O===0?(spe("route-fallback"),B=!0,G=null):w===O&&(B=!0,G=M.route.hydrateFallbackElement||null)));let V=t.concat(p.slice(0,O+1)),U=()=>{let X;return D?X=N:B?X=G:M.route.Component?X=Z.createElement(M.route.Component,null):M.route.element?X=M.route.element:X=T,Z.createElement(tpe,{match:M,routeContext:{outlet:T,matches:V,isDataRoute:r!=null},children:X})};return r&&(M.route.ErrorBoundary||M.route.errorElement||O===0)?Z.createElement(epe,{location:r.location,revalidation:r.revalidation,component:N,error:D,children:U(),routeContext:{outlet:null,matches:V,isDataRoute:!0}}):U()},null)}var aZ=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(aZ||{});function npe(e){let t=Z.useContext(Kfe);return t||Zs(!1),t}function ipe(e){let t=Z.useContext(nk);return t||Zs(!1),t}function ope(e){let t=ipe(),r=t.matches[t.matches.length-1];return r.route.id||Zs(!1),r.route.id}function ape(){var e;let t=Z.useContext(iZ),r=npe(aZ.UseRouteError),n=ope();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}const eU={};function spe(e,t,r){eU[e]||(eU[e]=!0)}function lpe(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function fj(e){Zs(!1)}function cpe(e){let{basename:t="/",children:r=null,location:n,navigationType:c=ef.Pop,navigator:h,static:p=!1,future:o}=e;n3()&&Zs(!1);let v=t.replace(/^\/*/,"/"),w=Z.useMemo(()=>({basename:v,navigator:h,static:p,future:hE({v7_relativeSplatPath:!1},o)}),[v,o,h,p]);typeof n=="string"&&(n=tk(n));let{pathname:T="/",search:M="",hash:O="",state:D=null,key:B="default"}=n,N=Z.useMemo(()=>{let G=tZ(T,v);return G==null?null:{location:{pathname:G,search:M,hash:O,state:D,key:B},navigationType:c}},[v,T,M,O,D,B,c]);return N==null?null:Z.createElement(nZ.Provider,{value:w},Z.createElement(rk.Provider,{children:r,value:N}))}function upe(e){let{children:t,location:r}=e;return Xfe(pj(t),r)}new Promise(()=>{});function pj(e,t){t===void 0&&(t=[]);let r=[];return Z.Children.forEach(e,(n,c)=>{if(!Z.isValidElement(n))return;let h=[...t,c];if(n.type===Z.Fragment){r.push.apply(r,pj(n.props.children,h));return}n.type!==fj&&Zs(!1),!n.props.index||!n.props.children||Zs(!1);let p={id:n.props.id||h.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(p.children=pj(n.props.children,h)),r.push(p)}),r}/**
* React Router DOM v6.30.1
*
* Copyright (c) Remix Software Inc.
*
* This source code is licensed under the MIT license found in the
* LICENSE.md file in the root directory of this source tree.
*
* @license MIT
*/const hpe="6";try{window.__reactRouterVersion=hpe}catch{}const dpe="startTransition",tU=GD[dpe];function fpe(e){let{basename:t,children:r,future:n,window:c}=e,h=Z.useRef();h.current==null&&(h.current=kfe({window:c,v5Compat:!0}));let p=h.current,[o,v]=Z.useState({action:p.action,location:p.location}),{v7_startTransition:w}=n||{},T=Z.useCallback(M=>{w&&tU?tU(()=>v(M)):v(M)},[v,w]);return Z.useLayoutEffect(()=>p.listen(T),[p,T]),Z.useEffect(()=>lpe(n),[n]),Z.createElement(cpe,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:p,future:n})}var rU;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(rU||(rU={}));var nU;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(nU||(nU={}));const tv=function(e,t,r){let n=Promise.resolve();function c(h){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=h,window.dispatchEvent(p),!p.defaultPrevented)throw h}return n.then(h=>{for(const p of h||[])p.status==="rejected"&&c(p.reason);return e().catch(c)})};var sZ={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(za,function(){var r,n,c;function h(o,v){if(!r)r=v;else if(!n)n=v;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",T={};r(T),c=v(T),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}h(["exports"],function(o){var v=1e-6,w=typeof Float32Array<"u"?Float32Array:Array;function T(l,i){var s=i[0],d=i[1],f=i[2],y=i[3],_=s*y-f*d;return _?(l[0]=y*(_=1/_),l[1]=-d*_,l[2]=-f*_,l[3]=s*_,l):null}function M(){var l=new w(9);return w!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function O(l,i){var s=i[0],d=i[1],f=i[2],y=i[3],_=i[4],S=i[5],A=i[6],k=i[7],j=i[8];return l[0]=_*j-S*k,l[1]=f*k-d*j,l[2]=d*S-f*_,l[3]=S*A-y*j,l[4]=s*j-f*A,l[5]=f*y-s*S,l[6]=y*k-_*A,l[7]=d*A-s*k,l[8]=s*_-d*y,l}function D(l,i,s){var d=i[0],f=i[1],y=i[2],_=i[3],S=i[4],A=i[5],k=i[6],j=i[7],R=i[8],L=s[0],H=s[1],W=s[2],J=s[3],Q=s[4],ae=s[5],de=s[6],he=s[7],fe=s[8];return l[0]=L*d+H*_+W*k,l[1]=L*f+H*S+W*j,l[2]=L*y+H*A+W*R,l[3]=J*d+Q*_+ae*k,l[4]=J*f+Q*S+ae*j,l[5]=J*y+Q*A+ae*R,l[6]=de*d+he*_+fe*k,l[7]=de*f+he*S+fe*j,l[8]=de*y+he*A+fe*R,l}function B(){var l=new w(16);return w!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function N(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function G(l,i){var s=i[0],d=i[1],f=i[2],y=i[3],_=i[4],S=i[5],A=i[6],k=i[7],j=i[8],R=i[9],L=i[10],H=i[11],W=i[12],J=i[13],Q=i[14],ae=i[15],de=s*S-d*_,he=s*A-f*_,fe=s*k-y*_,Me=d*A-f*S,Ae=d*k-y*S,ke=f*k-y*A,Le=j*J-R*W,Be=j*Q-L*W,st=j*ae-H*W,Ge=R*Q-L*J,ft=R*ae-H*J,wt=L*ae-H*Q,xt=de*wt-he*ft+fe*Ge+Me*st-Ae*Be+ke*Le;return xt?(l[0]=(S*wt-A*ft+k*Ge)*(xt=1/xt),l[1]=(f*ft-d*wt-y*Ge)*xt,l[2]=(J*ke-Q*Ae+ae*Me)*xt,l[3]=(L*Ae-R*ke-H*Me)*xt,l[4]=(A*st-_*wt-k*Be)*xt,l[5]=(s*wt-f*st+y*Be)*xt,l[6]=(Q*fe-W*ke-ae*he)*xt,l[7]=(j*ke-L*fe+H*he)*xt,l[8]=(_*ft-S*st+k*Le)*xt,l[9]=(d*st-s*ft-y*Le)*xt,l[10]=(W*Ae-J*fe+ae*de)*xt,l[11]=(R*fe-j*Ae-H*de)*xt,l[12]=(S*Be-_*Ge-A*Le)*xt,l[13]=(s*Ge-d*Be+f*Le)*xt,l[14]=(J*he-W*Me-Q*de)*xt,l[15]=(j*Me-R*he+L*de)*xt,l):null}function V(l,i,s){var d=i[0],f=i[1],y=i[2],_=i[3],S=i[4],A=i[5],k=i[6],j=i[7],R=i[8],L=i[9],H=i[10],W=i[11],J=i[12],Q=i[13],ae=i[14],de=i[15],he=s[0],fe=s[1],Me=s[2],Ae=s[3];return l[0]=he*d+fe*S+Me*R+Ae*J,l[1]=he*f+fe*A+Me*L+Ae*Q,l[2]=he*y+fe*k+Me*H+Ae*ae,l[3]=he*_+fe*j+Me*W+Ae*de,l[4]=(he=s[4])*d+(fe=s[5])*S+(Me=s[6])*R+(Ae=s[7])*J,l[5]=he*f+fe*A+Me*L+Ae*Q,l[6]=he*y+fe*k+Me*H+Ae*ae,l[7]=he*_+fe*j+Me*W+Ae*de,l[8]=(he=s[8])*d+(fe=s[9])*S+(Me=s[10])*R+(Ae=s[11])*J,l[9]=he*f+fe*A+Me*L+Ae*Q,l[10]=he*y+fe*k+Me*H+Ae*ae,l[11]=he*_+fe*j+Me*W+Ae*de,l[12]=(he=s[12])*d+(fe=s[13])*S+(Me=s[14])*R+(Ae=s[15])*J,l[13]=he*f+fe*A+Me*L+Ae*Q,l[14]=he*y+fe*k+Me*H+Ae*ae,l[15]=he*_+fe*j+Me*W+Ae*de,l}function U(l,i,s){var d,f,y,_,S,A,k,j,R,L,H,W,J=s[0],Q=s[1],ae=s[2];return i===l?(l[12]=i[0]*J+i[4]*Q+i[8]*ae+i[12],l[13]=i[1]*J+i[5]*Q+i[9]*ae+i[13],l[14]=i[2]*J+i[6]*Q+i[10]*ae+i[14],l[15]=i[3]*J+i[7]*Q+i[11]*ae+i[15]):(f=i[1],y=i[2],_=i[3],S=i[4],A=i[5],k=i[6],j=i[7],R=i[8],L=i[9],H=i[10],W=i[11],l[0]=d=i[0],l[1]=f,l[2]=y,l[3]=_,l[4]=S,l[5]=A,l[6]=k,l[7]=j,l[8]=R,l[9]=L,l[10]=H,l[11]=W,l[12]=d*J+S*Q+R*ae+i[12],l[13]=f*J+A*Q+L*ae+i[13],l[14]=y*J+k*Q+H*ae+i[14],l[15]=_*J+j*Q+W*ae+i[15]),l}function X(l,i,s){var d=s[0],f=s[1],y=s[2];return l[0]=i[0]*d,l[1]=i[1]*d,l[2]=i[2]*d,l[3]=i[3]*d,l[4]=i[4]*f,l[5]=i[5]*f,l[6]=i[6]*f,l[7]=i[7]*f,l[8]=i[8]*y,l[9]=i[9]*y,l[10]=i[10]*y,l[11]=i[11]*y,l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l}function Y(l,i,s){var d=Math.sin(s),f=Math.cos(s),y=i[4],_=i[5],S=i[6],A=i[7],k=i[8],j=i[9],R=i[10],L=i[11];return i!==l&&(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[4]=y*f+k*d,l[5]=_*f+j*d,l[6]=S*f+R*d,l[7]=A*f+L*d,l[8]=k*f-y*d,l[9]=j*f-_*d,l[10]=R*f-S*d,l[11]=L*f-A*d,l}function ne(l,i,s){var d=Math.sin(s),f=Math.cos(s),y=i[0],_=i[1],S=i[2],A=i[3],k=i[8],j=i[9],R=i[10],L=i[11];return i!==l&&(l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=y*f-k*d,l[1]=_*f-j*d,l[2]=S*f-R*d,l[3]=A*f-L*d,l[8]=y*d+k*f,l[9]=_*d+j*f,l[10]=S*d+R*f,l[11]=A*d+L*f,l}function se(l,i,s){var d=Math.sin(s),f=Math.cos(s),y=i[0],_=i[1],S=i[2],A=i[3],k=i[4],j=i[5],R=i[6],L=i[7];return i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=y*f+k*d,l[1]=_*f+j*d,l[2]=S*f+R*d,l[3]=A*f+L*d,l[4]=k*f-y*d,l[5]=j*f-_*d,l[6]=R*f-S*d,l[7]=L*f-A*d,l}function le(l,i){return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ge(l,i,s){var d,f,y,_=s[0],S=s[1],A=s[2],k=Math.hypot(_,S,A);return k<v?null:(_*=k=1/k,S*=k,A*=k,d=Math.sin(i),f=Math.cos(i),l[0]=_*_*(y=1-f)+f,l[1]=S*_*y+A*d,l[2]=A*_*y-S*d,l[3]=0,l[4]=_*S*y-A*d,l[5]=S*S*y+f,l[6]=A*S*y+_*d,l[7]=0,l[8]=_*A*y+S*d,l[9]=S*A*y-_*d,l[10]=A*A*y+f,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function je(l,i){var s=i[0],d=i[1],f=i[2],y=i[3],_=s+s,S=d+d,A=f+f,k=s*_,j=d*_,R=d*S,L=f*_,H=f*S,W=f*A,J=y*_,Q=y*S,ae=y*A;return l[0]=1-R-W,l[1]=j+ae,l[2]=L-Q,l[3]=0,l[4]=j-ae,l[5]=1-k-W,l[6]=H+J,l[7]=0,l[8]=L+Q,l[9]=H-J,l[10]=1-k-R,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}Math.hypot||(Math.hypot=function(){for(var l=0,i=arguments.length;i--;)l+=arguments[i]*arguments[i];return Math.sqrt(l)});var ze=V;function Ce(){var l=new w(3);return w!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Ke(l){var i=new w(3);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i}function Ye(l){return Math.hypot(l[0],l[1],l[2])}function Oe(l,i,s){var d=new w(3);return d[0]=l,d[1]=i,d[2]=s,d}function tt(l,i,s,d){return l[0]=i,l[1]=s,l[2]=d,l}function He(l,i,s){return l[0]=i[0]+s[0],l[1]=i[1]+s[1],l[2]=i[2]+s[2],l}function lt(l,i,s){return l[0]=i[0]-s[0],l[1]=i[1]-s[1],l[2]=i[2]-s[2],l}function rt(l,i,s){return l[0]=i[0]*s[0],l[1]=i[1]*s[1],l[2]=i[2]*s[2],l}function ht(l,i,s){return l[0]=Math.min(i[0],s[0]),l[1]=Math.min(i[1],s[1]),l[2]=Math.min(i[2],s[2]),l}function vt(l,i,s){return l[0]=Math.max(i[0],s[0]),l[1]=Math.max(i[1],s[1]),l[2]=Math.max(i[2],s[2]),l}function mt(l,i,s){return l[0]=i[0]*s,l[1]=i[1]*s,l[2]=i[2]*s,l}function ct(l,i,s,d){return l[0]=i[0]+s[0]*d,l[1]=i[1]+s[1]*d,l[2]=i[2]+s[2]*d,l}function Vt(l,i){var s=i[0]-l[0],d=i[1]-l[1],f=i[2]-l[2];return s*s+d*d+f*f}function xr(l){var i=l[0],s=l[1],d=l[2];return i*i+s*s+d*d}function tn(l,i){return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l}function Er(l,i){var s=i[0],d=i[1],f=i[2],y=s*s+d*d+f*f;return y>0&&(y=1/Math.sqrt(y)),l[0]=i[0]*y,l[1]=i[1]*y,l[2]=i[2]*y,l}function Ft(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]}function br(l,i,s){var d=i[0],f=i[1],y=i[2],_=s[0],S=s[1],A=s[2];return l[0]=f*A-y*S,l[1]=y*_-d*A,l[2]=d*S-f*_,l}function Yt(l,i,s,d){var f=i[0],y=i[1],_=i[2];return l[0]=f+d*(s[0]-f),l[1]=y+d*(s[1]-y),l[2]=_+d*(s[2]-_),l}function Qt(l,i,s){var d=i[0],f=i[1],y=i[2],_=s[3]*d+s[7]*f+s[11]*y+s[15];return l[0]=(s[0]*d+s[4]*f+s[8]*y+s[12])/(_=_||1),l[1]=(s[1]*d+s[5]*f+s[9]*y+s[13])/_,l[2]=(s[2]*d+s[6]*f+s[10]*y+s[14])/_,l}function Sr(l,i,s){var d=i[0],f=i[1],y=i[2];return l[0]=d*s[0]+f*s[3]+y*s[6],l[1]=d*s[1]+f*s[4]+y*s[7],l[2]=d*s[2]+f*s[5]+y*s[8],l}function Ut(l,i,s){var d=s[0],f=s[1],y=s[2],_=i[0],S=i[1],A=i[2],k=f*A-y*S,j=y*_-d*A,R=d*S-f*_,L=f*R-y*j,H=y*k-d*R,W=d*j-f*k,J=2*s[3];return j*=J,R*=J,H*=2,W*=2,l[0]=_+(k*=J)+(L*=2),l[1]=S+j+H,l[2]=A+R+W,l}function Nn(l){return l[0]=0,l[1]=0,l[2]=0,l}function Jr(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]}var Kr=lt,In=rt,Fi=Ye;function $o(){var l=new w(4);return w!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Co(l,i,s){return l[0]=i[0]*s,l[1]=i[1]*s,l[2]=i[2]*s,l[3]=i[3]*s,l}function Hi(l,i){var s=i[0],d=i[1],f=i[2],y=i[3],_=s*s+d*d+f*f+y*y;return _>0&&(_=1/Math.sqrt(_)),l[0]=s*_,l[1]=d*_,l[2]=f*_,l[3]=y*_,l}function Bi(l,i,s){var d=i[0],f=i[1],y=i[2],_=i[3];return l[0]=s[0]*d+s[4]*f+s[8]*y+s[12]*_,l[1]=s[1]*d+s[5]*f+s[9]*y+s[13]*_,l[2]=s[2]*d+s[6]*f+s[10]*y+s[14]*_,l[3]=s[3]*d+s[7]*f+s[11]*y+s[15]*_,l}function wa(){var l=new w(4);return w!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function xo(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function $l(l,i,s){s*=.5;var d=i[0],f=i[1],y=i[2],_=i[3],S=Math.sin(s),A=Math.cos(s);return l[0]=d*A+_*S,l[1]=f*A+y*S,l[2]=y*A-f*S,l[3]=_*A-d*S,l}function kc(l,i,s){s*=.5;var d=i[0],f=i[1],y=i[2],_=i[3],S=Math.sin(s),A=Math.cos(s);return l[0]=d*A-y*S,l[1]=f*A+_*S,l[2]=y*A+d*S,l[3]=_*A-f*S,l}Ce(),$o();var Ci,bo,ju,Xs=Hi,Ys=(Ci=Ce(),bo=Oe(1,0,0),ju=Oe(0,1,0),function(l,i,s){var d=Ft(i,s);return d<-.999999?(br(Ci,bo,i),Fi(Ci)<1e-6&&br(Ci,ju,i),Er(Ci,Ci),function(f,y,_){_*=.5;var S=Math.sin(_);f[0]=S*y[0],f[1]=S*y[1],f[2]=S*y[2],f[3]=Math.cos(_)}(l,Ci,Math.PI),l):d>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(br(Ci,i,s),l[0]=Ci[0],l[1]=Ci[1],l[2]=Ci[2],l[3]=1+d,Xs(l,l))});function Po(){var l=new w(2);return w!=Float32Array&&(l[0]=0,l[1]=0),l}function sa(l,i){var s=new w(2);return s[0]=l,s[1]=i,s}function Ts(l,i,s){return l[0]=i[0]+s[0],l[1]=i[1]+s[1],l}function la(l,i,s){return l[0]=i[0]-s[0],l[1]=i[1]-s[1],l}function Js(l,i,s){return l[0]=i[0]*s,l[1]=i[1]*s,l}function Sa(l){return Math.hypot(l[0],l[1])}function Cc(l,i){var s=i[0],d=i[1],f=s*s+d*d;return f>0&&(f=1/Math.sqrt(f)),l[0]=i[0]*f,l[1]=i[1]*f,l}function Yn(l,i){return l[0]*i[0]+l[1]*i[1]}wa(),wa(),M();var Pc,Mc,Ta=la;function Gl(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}Po();var Es=function(){if(Mc)return Pc;function l(i,s,d,f){this.cx=3*i,this.bx=3*(d-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=s,this.p2x=d,this.p2y=f}return Mc=1,Pc=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,s){if(s===void 0&&(s=1e-6),i<0)return 0;if(i>1)return 1;for(var d=i,f=0;f<8;f++){var y=this.sampleCurveX(d)-i;if(Math.abs(y)<s)return d;var _=this.sampleCurveDerivativeX(d);if(Math.abs(_)<1e-6)break;d-=y/_}var S=0,A=1;for(d=i,f=0;f<20&&(y=this.sampleCurveX(d),!(Math.abs(y-i)<s));f++)i>y?S=d:A=d,d=.5*(A-S)+S;return d},solve:function(i,s){return this.sampleCurveY(this.solveCurveX(i,s))}},Pc}(),Ic=Gl(Es);function ut(l,i){this.x=l,this.y=i}function Wn(l,i){if(Array.isArray(l)){if(!Array.isArray(i)||l.length!==i.length)return!1;for(let s=0;s<l.length;s++)if(!Wn(l[s],i[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&i!==null){if(typeof i!="object"||Object.keys(l).length!==Object.keys(i).length)return!1;for(const s in l)if(!Wn(l[s],i[s]))return!1;return!0}return l===i}ut.prototype={clone(){return new ut(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,i){return this.clone()._rotateAround(l,i)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const i=l.x-this.x,s=l.y-this.y;return i*i+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,i){return Math.atan2(this.x*i-this.y*l,this.x*l+this.y*i)},_matMult(l){const i=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=i,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const i=Math.cos(l),s=Math.sin(l),d=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=d,this},_rotateAround(l,i){const s=Math.cos(l),d=Math.sin(l),f=i.y+d*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-d*(this.y-i.y),this.y=f,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ut},ut.convert=function(l){if(l instanceof ut)return l;if(Array.isArray(l))return new ut(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new ut(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};const Pi=Math.PI/180,Go=180/Math.PI;function Br(l){return l*Pi}function qe(l){return l*Go}const oe=[[0,0],[1,0],[1,1],[0,1]];function ce(l){if(l<=0)return 0;if(l>=1)return 1;const i=l*l,s=i*l;return 4*(l<.5?s:3*(l-i)+s-.75)}function ye(l,i,s,d){const f=new Ic(l,i,s,d);return function(y){return f.solve(y)}}const Ie=ye(.25,.1,.25,1);function xe(l,i,s){return Math.min(s,Math.max(i,l))}function Fe(l,i,s){return(s=xe((s-l)/(i-l),0,1))*s*(3-2*s)}function et(l,i,s){const d=s-i,f=((l-i)%d+d)%d+i;return f===i?s:f}function Ue(l,i,s){if(!l.length)return s(null,[]);let d=l.length;const f=new Array(l.length);let y=null;l.forEach((_,S)=>{i(_,(A,k)=>{A&&(y=A),f[S]=k,--d==0&&s(y,f)})})}function Qe(l,...i){for(const s of i)for(const d in s)l[d]=s[d];return l}let Ot=1;function gt(){return Ot++}function sr(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function _r(l,i){l.forEach(s=>{i[s]&&(i[s]=i[s].bind(i))})}function Tr(l,i,s){const d={};for(const f in l)d[f]=i.call(this,l[f],f,l);return d}function Gr(l,i,s){const d={};for(const f in l)i.call(this,l[f],f,l)&&(d[f]=l[f]);return d}function zr(l){return Array.isArray(l)?l.map(zr):typeof l=="object"&&l?Tr(l,zr):l}function Hr(l,i){for(let s=0;s<l.length;s++)if(i.indexOf(l[s])>=0)return!0;return!1}const Un={};function Wr(l){Un[l]||(typeof console<"u"&&console.warn(l),Un[l]=!0)}function Ti(l,i,s){return(s.y-l.y)*(i.x-l.x)>(i.y-l.y)*(s.x-l.x)}function to(l){let i=0;for(let s,d,f=0,y=l.length,_=y-1;f<y;_=f++)s=l[f],d=l[_],i+=(d.x-s.x)*(s.y+d.y);return i}function Wi([l,i,s]){const d=Br(i+90),f=Br(s);return{x:l*Math.cos(d)*Math.sin(f),y:l*Math.sin(d)*Math.sin(f),z:l*Math.cos(f),azimuthal:i,polar:s}}function Dn(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function pn(l){const i={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,d,f,y)=>{const _=f||y;return i[d]=!_||_.toLowerCase(),""}),i["max-age"]){const s=parseInt(i["max-age"],10);isNaN(s)?delete i["max-age"]:i["max-age"]=s}return i}let bi=null;function pi(l,i){return[l[4*i],l[4*i+1],l[4*i+2],l[4*i+3]]}function ci(l,i,s,d){for(;i<s;){const f=i+s>>1;l[f]<d?i=f+1:s=f}return i}function wo(l,i,s,d){for(;i<s;){const f=i+s>>1;l[f]<=d?i=f+1:s=f}return i}function Ea(l){return l>0?1/(1.001-l):1+l}function qo(l){return l>0?1-1/(1.001-l):-l}function If(l,i,s){return(l-i.min)*(s.max-s.min)/(i.max-i.min)+s.min}const Mo={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Mo.API_URL)return null;try{const l=new URL(Mo.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Oc(l){return Mo.API_URL_REGEX.test(l)}function Bm(l){return Mo.API_SPRITE_REGEX.test(l)}let Of,jf,Um,Vm,Ru,Rf;function $m(){return Of==null&&(Of=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Of}const Qs={now:()=>Vm!==void 0?Vm:performance.now(),setNow(l){Vm=l},restoreNow(){Vm=void 0},frame(l){const i=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(l,i=0){const{width:s,height:d}=l;Ru||(Ru=document.createElement("canvas"));const f=Ru.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(s>Ru.width||d>Ru.height)&&(Ru.width=s,Ru.height=d),f.clearRect(-i,-i,s+2*i,d+2*i),f.drawImage(l,0,0,s,d),f.getImageData(-i,-i,s+2*i,d+2*i)},resolveURL:l=>(jf||(jf=document.createElement("a")),jf.href=l,jf.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Um==null&&(Um=window.matchMedia("(prefers-reduced-motion: reduce)")),Um.matches)},hasCanvasFingerprintNoise(){if(Rf!==void 0)return Rf;if(!$m())return Rf=!1,!1;const l=new OffscreenCanvas(85,1),i=l.getContext("2d",{willReadFrequently:!0});let s=0;for(let f=0;f<l.width;++f)i.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,i.fillRect(f,0,1,1);const d=i.getImageData(0,0,l.width,l.height);s=0;for(let f=0;f<d.data.length;++f)if(f%4!=3&&s++!==d.data[f])return Rf=!0,!0;return Rf=!1,!1}};function rs(l,i){const s=l.indexOf("?");if(s<0)return`${l}?${new URLSearchParams(i).toString()}`;const d=new URLSearchParams(l.slice(s));for(const f in i)d.set(f,i[f]);return`${l.slice(0,s)}?${d.toString()}`}function As(l,i={persistentParams:[]}){const s=l.indexOf("?");if(s<0)return l;const d=new URLSearchParams,f=new URLSearchParams(l.slice(s));for(const _ of i.persistentParams){const S=f.get(_);S&&d.set(_,S)}const y=d.toString();return`${l.slice(0,s)}${y.length>0?`?${y}`:""}`}const ql="mapbox-tiles";let el=500,Hl=50;const Df=["language","worldview","jobid"];let jc,Lf;function Du(){try{return caches}catch{}}function $h(){const l=Du();l&&jc==null&&(jc=l.open(ql))}let bv=1/0;const wv={supported:!1,testSupport:function(l){!zf&&Lu&&(Gh?p1(l):Aa=l)}};let Aa,Lu,zf=!1,Gh=!1;const f1=typeof self<"u"?self:{};function p1(l){const i=l.createTexture();l.bindTexture(l.TEXTURE_2D,i);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Lu),l.isContextLost())return;wv.supported=!0}catch{}l.deleteTexture(i),zf=!0}f1.document&&(Lu=f1.document.createElement("img"),Lu.onload=function(){Aa&&p1(Aa),Aa=null,Gh=!0},Lu.onerror=function(){zf=!0,Aa=null},Lu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Nf={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Nf);class on extends Error{constructor(i,s,d){s===401&&Oc(d)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=s,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Gm=Dn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,qh=function(l,i){if(!(/^file:/.test(s=l.url)||/^file:/.test(Gm())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,f){const y=new AbortController,_=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Gm(),referrerPolicy:d.referrerPolicy,signal:y.signal});let S=!1,A=!1;const k=(j=_.url).indexOf("sku=")>0&&Oc(j);var j;d.type==="json"&&_.headers.set("Accept","application/json");const R=(H,W,J)=>{if(A)return;if(H&&H.message!=="SecurityError"&&Wr(H.toString()),W&&J)return L(W);const Q=Date.now();fetch(_).then(ae=>{if(ae.ok){const de=k?ae.clone():null;return L(ae,de,Q)}return f(new on(ae.statusText,ae.status,d.url))}).catch(ae=>{ae.name!=="AbortError"&&f(new Error(`${ae.message} ${d.url}`))})},L=(H,W,J)=>{(d.type==="arrayBuffer"?H.arrayBuffer():d.type==="json"?H.json():H.text()).then(Q=>{A||(W&&J&&function(ae,de,he){if($h(),jc==null)return;const fe=pn(de.headers.get("Cache-Control")||"");if(fe["no-store"])return;const Me={status:de.status,statusText:de.statusText,headers:new Headers};de.headers.forEach((Le,Be)=>Me.headers.set(Be,Le)),fe["max-age"]&&Me.headers.set("Expires",new Date(he+1e3*fe["max-age"]).toUTCString());const Ae=Me.headers.get("Expires");if(!Ae||new Date(Ae).getTime()-he<42e4)return;let ke=As(ae.url,{persistentParams:Df});if(de.status===206){const Le=ae.headers.get("Range");if(!Le)return;Me.status=200,ke=rs(ke,{range:Le})}(function(Le,Be){if(Lf===void 0)try{new Response(new ReadableStream),Lf=!0}catch{Lf=!1}Lf?Be(Le.body):Le.blob().then(Be).catch(st=>Wr(st.message))})(de,Le=>{const Be=new Response((st=de.status)!==200&&st!==404&&[101,103,204,205,304].includes(st)?null:Le,Me);var st;$h(),jc?.then(Ge=>Ge.put(ke,Be)).catch(Ge=>Wr(Ge.message))})}(_,W,J),S=!0,f(null,Q,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(Q=>{A||f(new Error(Q.message))})};return k?function(H,W){if($h(),jc==null)return W(null);jc.then(J=>{let Q=As(H.url,{persistentParams:Df});const ae=H.headers.get("Range");ae&&(Q=rs(Q,{range:ae})),J.match(Q).then(de=>{const he=function(fe){if(!fe)return!1;const Me=new Date(fe.headers.get("Expires")||0),Ae=pn(fe.headers.get("Cache-Control")||"");return Number(Me)>Date.now()&&!Ae["no-cache"]}(de);J.delete(Q).catch(W),he&&J.put(Q,de.clone()).catch(W),W(null,de,he)}).catch(W)}).catch(W)}(_,R):R(null,null),{cancel:()=>{A=!0,S||y.abort()}}}(l,i);if(Dn(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,i,void 0,!0)}var s;return function(d,f){const y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const _ in d.headers)y.setRequestHeader(_,d.headers[_]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{f(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let _=y.response;if(d.type==="json")try{_=JSON.parse(y.response)}catch(S){return f(S)}f(null,_,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else f(new on(y.statusText,y.status,d.url))},y.send(d.body),{cancel:()=>y.abort()}}(l,i)},Ff=function(l,i){return qh(Qe(l,{type:"arrayBuffer"}),i)};function SC(l){const i=document.createElement("a");return i.href=l,i.protocol===location.protocol&&i.host===location.host}const Bf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let zu,Rc;zu=[],Rc=0;const Uf=function(l,i){if(wv.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),Rc>=Mo.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:l,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return zu.push(y),y}Rc++;let s=!1;const d=()=>{if(!s)for(s=!0,Rc--;zu.length&&Rc<Mo.MAX_PARALLEL_IMAGE_REQUESTS;){const y=zu.shift(),{requestParameters:_,callback:S,cancelled:A}=y;A||(y.cancel=Uf(_,S).cancel)}},f=Ff(l,(y,_,S,A)=>{d(),y?i(y):_&&(self.createImageBitmap?function(k,j){const R=new Blob([new Uint8Array(k)],{type:"image/png"});createImageBitmap(R).then(L=>{j(null,L)}).catch(L=>{j(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(k,j)=>i(k,j,S,A)):function(k,j){const R=new Image;R.onload=()=>{j(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=Bf})},R.onerror=()=>j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(k)],{type:"image/png"});R.src=k.byteLength?URL.createObjectURL(L):Bf}(_,(k,j)=>i(k,j,S,A)))});return{cancel:()=>{f.cancel(),d()}}};var m1,qm,g1,Hh={exports:{}},Nu={exports:{}},y1={exports:{}},Vf=function(){if(g1)return Hh.exports;g1=1;var l=(m1||(m1=1,Nu.exports=function(s,d){var f,y,_,S,A,k,j,R;for(y=s.length-(f=3&s.length),_=d,A=3432918353,k=461845907,R=0;R<y;)j=255&s.charCodeAt(R)|(255&s.charCodeAt(++R))<<8|(255&s.charCodeAt(++R))<<16|(255&s.charCodeAt(++R))<<24,++R,_=27492+(65535&(S=5*(65535&(_=(_^=j=(65535&(j=(j=(65535&j)*A+(((j>>>16)*A&65535)<<16)&4294967295)<<15|j>>>17))*k+(((j>>>16)*k&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(j=0,f){case 3:j^=(255&s.charCodeAt(R+2))<<16;case 2:j^=(255&s.charCodeAt(R+1))<<8;case 1:_^=j=(65535&(j=(j=(65535&(j^=255&s.charCodeAt(R)))*A+(((j>>>16)*A&65535)<<16)&4294967295)<<15|j>>>17))*k+(((j>>>16)*k&65535)<<16)&4294967295}return _^=s.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Nu.exports),i=(qm||(qm=1,y1.exports=function(s,d){for(var f,y=s.length,_=d^y,S=0;y>=4;)f=1540483477*(65535&(f=255&s.charCodeAt(S)|(255&s.charCodeAt(++S))<<8|(255&s.charCodeAt(++S))<<16|(255&s.charCodeAt(++S))<<24))+((1540483477*(f>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:_^=(255&s.charCodeAt(S+2))<<16;case 2:_^=(255&s.charCodeAt(S+1))<<8;case 1:_=1540483477*(65535&(_^=255&s.charCodeAt(S)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),y1.exports);return Hh.exports=l,Hh.exports.murmur3=l,Hh.exports.murmur2=i,Hh.exports}(),Wh=Gl(Vf);class Wl{constructor(i,...s){Qe(this,s[0]||{}),this.type=i}}class ns extends Wl{constructor(i,s={}){super("error",Qe({error:i},s))}}function Sv(l,i,s){s[l]&&s[l].indexOf(i)!==-1||(s[l]=s[l]||[],s[l].push(i))}function Tv(l,i,s){if(s&&s[l]){const d=s[l].indexOf(i);d!==-1&&s[l].splice(d,1)}}class Fu{on(i,s){return this._listeners=this._listeners||{},Sv(i,s,this._listeners),this}off(i,s){return Tv(i,s,this._listeners),Tv(i,s,this._oneTimeListeners),this}once(i,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Sv(i,s,this._oneTimeListeners),this):new Promise(d=>{this.once(i,d)})}fire(i,s){const d=typeof i=="string"?new Wl(i,s):i,f=d.type;if(this.listens(f)){d.target=this;const y=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const A of y)A.call(this,d);const _=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const A of _)Tv(f,A,this._oneTimeListeners),A.call(this,d);const S=this._eventedParent;S&&(Qe(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(d))}else d instanceof ns&&console.error(d.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,s){return this._eventedParent=i,this._eventedParentData=s,this}}class Ba{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new Ba(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[s,d]=i.split("");return new Ba({name:s,iconsetId:d})}static isEqual(i,s){return i.name===s.name&&i.iconsetId===s.iconsetId}toString(){return Ba.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ev,Hm={},Av=function(){if(Ev)return Hm;Ev=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(y){return(y=Math.round(y))<0?0:y>255?255:y}function s(y){return i(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function d(y){return(_=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:_>1?1:_;var _}function f(y,_,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?y+(_-y)*S*6:2*S<1?_:3*S<2?y+(_-y)*(2/3-S)*6:y}try{Hm.parseCSSColor=function(y){var _,S=y.replace(/ /g,"").toLowerCase();if(S in l)return l[S].slice();if(S[0]==="#")return S.length===4?(_=parseInt(S.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:S.length===7&&(_=parseInt(S.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var A=S.indexOf("("),k=S.indexOf(")");if(A!==-1&&k+1===S.length){var j=S.substr(0,A),R=S.substr(A+1,k-(A+1)).split(","),L=1;switch(j){case"rgba":if(R.length!==4)return null;L=d(R.pop());case"rgb":return R.length!==3?null:[s(R[0]),s(R[1]),s(R[2]),L];case"hsla":if(R.length!==4)return null;L=d(R.pop());case"hsl":if(R.length!==3)return null;var H=(parseFloat(R[0])%360+360)%360/360,W=d(R[1]),J=d(R[2]),Q=J<=.5?J*(W+1):J+W-J*W,ae=2*J-Q;return[i(255*f(ae,Q,H+1/3)),i(255*f(ae,Q,H)),i(255*f(ae,Q,H-1/3)),L];default:return null}}return null}}catch{}return Hm}();class Tn{constructor(i,s,d,f=1){this.r=i,this.g=s,this.b=d,this.a=f}static parse(i){if(!i)return;if(i instanceof Tn)return i;if(typeof i!="string")return;const s=Av.parseCSSColor(i);return s?new Tn(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){const[i,s,d,f]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*s)},${Math.round(255*d)},${f})`}toNonPremultipliedRenderColor(i){const{r:s,g:d,b:f,a:y}=this;return new Zh(i,s,d,f,y)}toPremultipliedRenderColor(i){const{r:s,g:d,b:f,a:y}=this;return new _1(i,s*y,d*y,f*y,y)}clone(){return new Tn(this.r,this.g,this.b,this.a)}}class $f{constructor(i,s,d,f,y,_=!1){if(this.premultiplied=!1,this.premultiplied=_,i){const S=i.image.height,A=S*S;this.premultiplied?(s=y===0?0:s/y*(S-1),d=y===0?0:d/y*(S-1),f=y===0?0:f/y*(S-1)):(s*=S-1,d*=S-1,f*=S-1);const k=Math.floor(s),j=Math.floor(d),R=Math.floor(f),L=Math.ceil(s),H=Math.ceil(d),W=Math.ceil(f),J=s-k,Q=d-j,ae=f-R,de=i.image.data,he=4*(k+j*A+R*S),fe=4*(k+j*A+W*S),Me=4*(k+H*A+R*S),Ae=4*(k+H*A+W*S),ke=4*(L+j*A+R*S),Le=4*(L+j*A+W*S),Be=4*(L+H*A+R*S),st=4*(L+H*A+W*S);if(he<0||st>=de.length)throw new Error("out of range");this.r=lr(lr(lr(de[he],de[fe],ae),lr(de[Me],de[Ae],ae),Q),lr(lr(de[ke],de[Le],ae),lr(de[Be],de[st],ae),Q),J)/255*(this.premultiplied?y:1),this.g=lr(lr(lr(de[he+1],de[fe+1],ae),lr(de[Me+1],de[Ae+1],ae),Q),lr(lr(de[ke+1],de[Le+1],ae),lr(de[Be+1],de[st+1],ae),Q),J)/255*(this.premultiplied?y:1),this.b=lr(lr(lr(de[he+2],de[fe+2],ae),lr(de[Me+2],de[Ae+2],ae),Q),lr(lr(de[ke+2],de[Le+2],ae),lr(de[Be+2],de[st+2],ae),Q),J)/255*(this.premultiplied?y:1),this.a=y}else this.r=s,this.g=d,this.b=f,this.a=y}toArray(){const{r:i,g:s,b:d,a:f}=this;return[255*i,255*s,255*d,f]}toHslaArray(){let{r:i,g:s,b:d,a:f}=this;if(this.premultiplied){if(f===0)return[0,0,0,0];i/=f,s/=f,d/=f}const y=Math.min(Math.max(i,0),1),_=Math.min(Math.max(s,0),1),S=Math.min(Math.max(d,0),1),A=Math.min(y,_,S),k=Math.max(y,_,S),j=(A+k)/2;if(A===k)return[0,0,100*j,f];const R=k-A,L=j>.5?R/(2-k-A):R/(k+A);let H=0;return k===y?H=(_-S)/R+(_<S?6:0):k===_?H=(S-y)/R+2:k===S&&(H=(y-_)/R+4),H*=60,[Math.min(Math.max(H,0),360),Math.min(Math.max(100*L,0),100),Math.min(Math.max(100*j,0),100),f]}toArray01(){const{r:i,g:s,b:d,a:f}=this;return[i,s,d,f]}toArray01Scaled(i){const{r:s,g:d,b:f}=this;return[s*i,d*i,f*i]}toArray01Linear(){const{r:i,g:s,b:d,a:f}=this;return[Math.pow(i,2.2),Math.pow(s,2.2),Math.pow(d,2.2),f]}}class Zh extends $f{constructor(i,s,d,f,y){super(i,s,d,f,y,!1)}}class _1 extends $f{constructor(i,s,d,f,y){super(i,s,d,f,y,!0)}}function lr(l,i,s){return l*(1-s)+i*s}function v1(l,i,s){return l.map((d,f)=>lr(d,i[f],s))}Tn.black=new Tn(0,0,0,1),Tn.white=new Tn(1,1,1,1),Tn.transparent=new Tn(0,0,0,0),Tn.red=new Tn(1,0,0,1),Tn.blue=new Tn(0,0,1,1);var Gf=Object.freeze({__proto__:null,array:v1,color:function(l,i,s){return new Tn(lr(l.r,i.r,s),lr(l.g,i.g,s),lr(l.b,i.b,s),lr(l.a,i.a,s))},number:lr});function Bu(l,...i){for(const s of i)for(const d in s)l[d]=s[d];return l}class is extends Error{constructor(i,s){super(s),this.message=s,this.key=i}}class kv{constructor(i,s=[]){this.parent=i,this.bindings={};for(const[d,f]of s)this.bindings[d]=f}concat(i){return new kv(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Kh={kind:"null"},or={kind:"number"},yn={kind:"string"},_n={kind:"boolean"},Ua={kind:"color"},Zl={kind:"object"},En={kind:"value"},Wm={kind:"collator"},qf={kind:"formatted"},Hf={kind:"resolvedImage"};function Ho(l,i){return{kind:"array",itemType:l,N:i}}function Zi(l){if(l.kind==="array"){const i=Zi(l.itemType);return typeof l.N=="number"?`array<${i}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${i}>`}return l.kind}const TC=[Kh,or,yn,_n,Ua,qf,Zl,Ho(En),Hf];function Xh(l,i){if(i.kind==="error")return null;if(l.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Xh(l.itemType,i.itemType))&&(typeof l.N!="number"||l.N===i.N))return null}else{if(l.kind===i.kind)return null;if(l.kind==="value"){for(const s of TC)if(!Xh(s,i))return null}}return`Expected ${Zi(l)} but found ${Zi(i)} instead.`}function Dc(l,i){return i.some(s=>s.kind===l.kind)}function Wf(l,i){return i.some(s=>s==="null"?l===null:s==="array"?Array.isArray(l):s==="object"?l&&!Array.isArray(l)&&typeof l=="object":s===typeof l)}function Zm(l,i){return l.kind==="array"&&i.kind==="array"?l.N===i.N&&Zm(l.itemType,i.itemType):l.kind===i.kind}class Zf{constructor(i,s,d){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,s){return this.collator.compare(i,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Km{constructor(i,s,d,f,y){this.text=i.normalize?i.normalize():i,this.image=s,this.scale=d,this.fontStack=f,this.textColor=y}}class ca{constructor(i){this.sections=i}static fromString(i){return new ca([new Km(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof ca?i:ca.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const s of this.sections){if(s.image){const f=s.image.getPrimary().id.toString();i.push(["image",f]);continue}i.push(s.text);const d={};s.fontStack&&(d["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(d["font-scale"]=s.scale),s.textColor&&(d["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(d)}return i}}class Kl{constructor(i,s={}){if(this.id=Ba.from(i),this.options=Object.assign({},s),s.transform){const{a:d,b:f,c:y,d:_,e:S,f:A}=s.transform;this.options.transform=new DOMMatrix([d,f,y,_,S,A])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:i,b:s,c:d,d:f,e:y,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:i,b:s,c:d,d:f,e:y,f:_}})}static parse(i){let s,d,f,y;try{({name:s,iconsetId:d,params:f,transform:y}=JSON.parse(i)||{})}catch{return null}if(!s)return null;const{a:_,b:S,c:A,d:k,e:j,f:R}=y||{};return new Kl({name:s,iconsetId:d},{params:f,transform:new DOMMatrix([_,S,A,k,j,R])})}scaleSelf(i,s){return this.options.transform.scaleSelf(i,s),this}}class ka{constructor(i,s,d,f,y=!1){this.primaryId=Ba.from(i),this.primaryOptions=s,d&&(this.secondaryId=Ba.from(d)),this.secondaryOptions=f,this.available=y}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Kl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Kl(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?ka.build({name:i}):i}static build(i,s,d,f){return!i||typeof i=="object"&&!("name"in i)?null:new ka(i,d,s,f)}}function Uu(l,i,s,d){return typeof l=="number"&&l>=0&&l<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof s=="number"&&s>=0&&s<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[l,i,s,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[l,i,s,d]:[l,i,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Or(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Tn||l instanceof Zf||l instanceof ca||l instanceof ka)return!0;if(Array.isArray(l)){for(const i of l)if(!Or(i))return!1;return!0}if(typeof l=="object"){for(const i in l)if(!Or(l[i]))return!1;return!0}return!1}function Ht(l){if(l===null)return Kh;if(typeof l=="string")return yn;if(typeof l=="boolean")return _n;if(typeof l=="number")return or;if(l instanceof Tn)return Ua;if(l instanceof Zf)return Wm;if(l instanceof ca)return qf;if(l instanceof ka)return Hf;if(Array.isArray(l)){const i=l.length;let s;for(const d of l){const f=Ht(d);if(s){if(s===f)continue;s=En;break}s=f}return Ho(s||En,i)}return Zl}function ks(l){const i=typeof l;return l===null?"":i==="string"||i==="number"||i==="boolean"?String(l):l instanceof ca||l instanceof ka||l instanceof Tn?l.toString():JSON.stringify(l)}class mr{constructor(i,s){this.type=i,this.value=s}static parse(i,s){if(i.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Or(i[1]))return s.error("invalid value");const d=i[1];let f=Ht(d);const y=s.expectedType;return f.kind!=="array"||f.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(f=y),new mr(f,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Tn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ca?this.value.serialize():this.value}}class Vi{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Kf={string:yn,number:or,boolean:_n,object:Zl};class ur{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");let d,f=1;const y=i[0];if(y==="array"){let S,A;if(i.length>2){const k=i[1];if(typeof k!="string"||!(k in Kf)||k==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);S=Kf[k],f++}else S=En;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);A=i[2],f++}d=Ho(S,A)}else d=Kf[y];const _=[];for(;f<i.length;f++){const S=s.parse(i[f],f,En);if(!S)return null;_.push(S)}return new ur(d,_)}evaluate(i){for(let s=0;s<this.args.length;s++){const d=this.args[s].evaluate(i);if(!Xh(this.type,Ht(d)))return d;if(s===this.args.length-1)throw new Vi(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Zi(Ht(d))} but was expected to be of type ${Zi(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,s=[i.kind];if(i.kind==="array"){const d=i.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){s.push(d.kind);const f=i.N;(typeof f=="number"||this.args.length>1)&&s.push(f)}}return s.concat(this.args.map(d=>d.serialize()))}}class Yh{constructor(i){this.type=qf,this.sections=i}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return s.error("First argument must be an image or text section.");const f=[];let y=!1;for(let _=1;_<=i.length-1;++_){const S=i[_];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;let A=null;if(S["font-scale"]&&(A=s.parseObjectValue(S["font-scale"],_,"font-scale",or),!A))return null;let k=null;if(S["text-font"]&&(k=s.parseObjectValue(S["text-font"],_,"text-font",Ho(yn)),!k))return null;let j=null;if(S["text-color"]&&(j=s.parseObjectValue(S["text-color"],_,"text-color",Ua),!j))return null;const R=f[f.length-1];R.scale=A,R.font=k,R.textColor=j}else{const A=s.parse(i[_],_,En);if(!A)return null;const k=A.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,f.push({content:A,scale:null,font:null,textColor:null})}}return new Yh(f)}evaluate(i){return new ca(this.sections.map(s=>{const d=s.content.evaluate(i);return Zm(Ht(d),Hf)?new Km("",d,null,null,null):new Km(ks(d),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))}eachChild(i){for(const s of this.sections)i(s.content),s.scale&&i(s.scale),s.font&&i(s.font),s.textColor&&i(s.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const s of this.sections){i.push(s.content.serialize());const d={};s.scale&&(d["font-scale"]=s.scale.serialize()),s.font&&(d["text-font"]=s.font.serialize()),s.textColor&&(d["text-color"]=s.textColor.serialize()),i.push(d)}return i}}class Jh{constructor(i,s,d,f){this._imageWarnHistory={},this.type=Hf,this.namePrimary=i,this.nameSecondary=s,d&&(this.paramsPrimary=d.params,this.iconsetIdPrimary=d.iconset?d.iconset.id:void 0),f&&(this.paramsSecondary=f.params,this.iconsetIdSecondary=f.iconset?f.iconset.id:void 0)}static parse(i,s){if(i.length<2)return s.error("Expected two or more arguments.");let d=1;const f=[];function y(){if(d<i.length){const S=s.parse(i[d],d++,yn);return S?(f.push({image:S,options:{}}),!0):(s.error(f.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(d<i.length){const A=i[d];if((S=A)===null||typeof S!="object"||Array.isArray(S))return!0;const k=A.params,j=A.iconset,R=s.concat(d);if(!k&&!j)return d++,!0;if(k){if(typeof k!="object"||k.constructor!==Object)return R.error('Image options "params" should be an object'),!1;const L={},H=R.concat(void 0,"params");for(const W in k){if(!W)return H.error("Image parameter name should be non-empty"),!1;const J=H.concat(void 0,W).parse(k[W],void 0,Ua,void 0,{typeAnnotation:"coerce"});if(!J)return!1;L[W]=J}f[f.length-1].options.params=L}if(j){if(typeof j!="object"||j.constructor!==Object)return R.error('Image options "iconset" should be an object'),!1;if(!j.id)return R.error('Image options "iconset" should have an "id" property'),!1;f[f.length-1].options.iconset=j}return d++,!0}var S;return!0}for(let S=0;S<2;S++)if(!y()||!_())return;return new Jh(f[0].image,f[1]?f[1].image:void 0,f[0].options,f[1]?f[1].options:void 0)}evaluateParams(i,s){const d={};if(s){for(const f in s)if(s[f])try{d[f]=s[f].evaluate(i)}catch{continue}if(Object.keys(d).length!==0)return{params:d}}}evaluate(i){const s={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},d=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,f=ka.build(s,d,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(f&&i.availableImages){const y=f.getPrimary().id;if(f.available=i.availableImages.some(_=>Ba.isEqual(_,y)),f.available){const _=f.getSecondary()?f.getSecondary().id:null;_&&(f.available=i.availableImages.some(S=>Ba.isEqual(S,_)))}}return f}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const s in this.paramsPrimary)this.paramsPrimary[s]&&i(this.paramsPrimary[s]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const s in this.paramsSecondary)this.paramsSecondary[s]&&i(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(i,s){const d={};if(s&&(d.iconset={id:s}),i){d.params={};for(const f in i)i[f]&&(d.params[f]=i[f].serialize())}return Object.keys(d).length>0?d:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&i.push(s)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&i.push(s)}return i}}function Lc(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}const x1={"to-boolean":_n,"to-color":Ua,"to-number":or,"to-string":yn};class Cs{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const d=i[0],f=[];let y=Kh;if(d==="to-array"){if(!Array.isArray(i[1]))return null;const _=i[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);y=Ho(s.expectedType.itemType,_)}else{if(!(_>0&&Or(i[1][0])))return null;y=Ho(Ht(i[1][0]),_)}for(let S=0;S<_;S++){const A=i[1][S];let k;if(Lc(A)==="array")k=s.parse(A,void 0,y.itemType);else{const j=Lc(A);if(j!==y.itemType.kind)return s.error(`Expected ${y.itemType.kind} but found ${j}.`);k=s.registry.literal.parse(["literal",A===void 0?null:A],s)}if(!k)return null;f.push(k)}}else{if((d==="to-boolean"||d==="to-string")&&i.length!==2)return s.error("Expected one argument.");y=x1[d];for(let _=1;_<i.length;_++){const S=s.parse(i[_],_,En);if(!S)return null;f.push(S)}}return new Cs(y,f)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let s,d;for(const f of this.args){if(s=f.evaluate(i),d=null,s instanceof Tn)return s;if(typeof s=="string"){const y=i.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(d=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Uu(s[0],s[1],s[2],s[3]),!d))return new Tn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Vi(d||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const d of this.args){if(s=d.evaluate(i),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new Vi(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?ca.fromString(ks(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?ka.build(ks(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(s=>s.evaluate(i)):ks(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Yh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Jh(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{i.push(s.serialize())}),i}}const ua=["Unknown","Point","LineString","Polygon"];class Xf{constructor(i,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ua[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:d,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*s-i[0])+this.featureDistanceData.bearing[1]*(f*s-i[1])}return 0}parseColor(i){let s=this._parseColorCache[i];return s||(s=this._parseColorCache[i]=Tn.parse(i)),s}getConfig(i){return this.options?this.options.get(i):null}}class So{constructor(i,s,d,f,y){this.name=i,this.type=s,this._evaluate=d,this.args=f,this._overloadIndex=y}evaluate(i){if(!this._evaluate){const s=So.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,s){const d=i[0],f=So.definitions[d];if(!f)return s.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(f)?f[0]:f.type,_=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,S=[];let A=null,k=-1;for(const[j,R]of _){if(Array.isArray(j)&&j.length!==i.length-1)continue;S.push(j),k++,A=new lg(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const L=[];let H=!1;for(let W=1;W<i.length;W++){const J=i[W],Q=Array.isArray(j)?j[W-1]:j.type,ae=A.parse(J,1+L.length,Q);if(!ae){H=!0;break}L.push(ae)}if(!H)if(Array.isArray(j)&&j.length!==L.length)A.error(`Expected ${j.length} arguments, but found ${L.length} instead.`);else{for(let W=0;W<L.length;W++){const J=Array.isArray(j)?j[W]:j.type,Q=L[W];A.concat(W+1).checkSubtype(J,Q.type)}if(A.errors.length===0)return new So(d,y,R,L,k)}}if(S.length===1)s.errors.push(...A.errors);else{const j=(S.length?S:_.map(([L])=>L)).map(Cv).join(" | "),R=[];for(let L=1;L<i.length;L++){const H=s.parse(i[L],1+R.length);if(!H)return null;R.push(Zi(H.type))}s.error(`Expected arguments of type ${j}, but found (${R.join(", ")}) instead.`)}return null}static register(i,s){So.definitions=s;for(const d in s)i[d]=So}}function Cv(l){return Array.isArray(l)?`(${l.map(Zi).join(", ")})`:`(${Zi(l.type)}...)`}class yl{constructor(i,s,d){this.type=Wm,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=s}static parse(i,s){if(i.length!==2)return s.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return s.error("Collator options argument must be an object.");const f=d["case-sensitive"]===void 0?s.parse(!1,1,_n):s.parseObjectValue(d["case-sensitive"],1,"case-sensitive",_n);if(!f)return null;const y=d["diacritic-sensitive"]===void 0?s.parse(!1,1,_n):s.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",_n);if(!y)return null;let _=null;return d.locale&&(_=s.parseObjectValue(d.locale,1,"locale",yn),!_)?null:new yl(f,y,_)}evaluate(i){return new Zf(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function Wo(l,i,s=0,d=l.length-1,f=EC){for(;d>s;){if(d-s>600){const A=d-s+1,k=i-s+1,j=Math.log(A),R=.5*Math.exp(2*j/3),L=.5*Math.sqrt(j*R*(A-R)/A)*(k-A/2<0?-1:1);Wo(l,i,Math.max(s,Math.floor(i-k*R/A+L)),Math.min(d,Math.floor(i+(A-k)*R/A+L)),f)}const y=l[i];let _=s,S=d;for(Yf(l,s,i),f(l[d],y)>0&&Yf(l,s,d);_<S;){for(Yf(l,_,S),_++,S--;f(l[_],y)<0;)_++;for(;f(l[S],y)>0;)S--}f(l[s],y)===0?Yf(l,s,S):(S++,Yf(l,S,d)),S<=i&&(s=S+1),i<=S&&(d=S-1)}}function Yf(l,i,s){const d=l[i];l[i]=l[s],l[s]=d}function EC(l,i){return l<i?-1:l>i?1:0}function AC(l){let i=0;for(let s,d,f=0,y=l.length,_=y-1;f<y;_=f++)s=l[f],d=l[_],i+=(d.x-s.x)*(s.y+d.y);return i}function zc(l,i){l[0]=Math.min(l[0],i[0]),l[1]=Math.min(l[1],i[1]),l[2]=Math.max(l[2],i[0]),l[3]=Math.max(l[3],i[1])}function Qh(l,i){return!(l[0]<=i[0]||l[2]>=i[2]||l[1]<=i[1]||l[3]>=i[3])}function Vu(l,i,s){const d=l[0]-i[0],f=l[1]-i[1],y=l[0]-s[0],_=l[1]-s[1];return d*_-y*f==0&&d*y<=0&&f*_<=0}function ed(l,i,s=!1){let d=!1;for(let S=0,A=i.length;S<A;S++){const k=i[S];for(let j=0,R=k.length,L=R-1;j<R;L=j++){const H=k[L],W=k[j];if(Vu(l,H,W))return s;(y=H)[1]>(f=l)[1]!=(_=W)[1]>f[1]&&f[0]<(_[0]-y[0])*(f[1]-y[1])/(_[1]-y[1])+y[0]&&(d=!d)}}var f,y,_;return d}function b1(l,i,s,d){const f=d[0]-s[0],y=d[1]-s[1],_=(l[0]-s[0])*y-f*(l[1]-s[1]),S=(i[0]-s[0])*y-f*(i[1]-s[1]);return _>0&&S<0||_<0&&S>0}function Xm(l,i,s,d){return(f=[d[0]-s[0],d[1]-s[1]])[0]*(y=[i[0]-l[0],i[1]-l[1]])[1]-f[1]*y[0]!=0&&!(!b1(l,i,s,d)||!b1(s,d,l,i));var f,y}function Pv(l){const i=new ut(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new ut(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const d of l[0])i.x>d.x&&(i.x=d.x),i.y>d.y&&(i.y=d.y),s.x<d.x&&(s.x=d.x),s.y<d.y&&(s.y=d.y);return{min:i,max:s}}const Nc=8192;function kC(l,i){const s=(180+l[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,f=Math.pow(2,i.z);return[Math.round(s*f*Nc),Math.round(d*f*Nc)]}function w1(l,i){for(let s=0;s<i.length;s++)if(ed(l,i[s]))return!0;return!1}function CC(l,i,s){for(const d of s)for(let f=0,y=d.length,_=y-1;f<y;_=f++)if(Xm(l,i,d[_],d[f]))return!0;return!1}function S1(l,i){for(let s=0;s<l.length;++s)if(!ed(l[s],i))return!1;for(let s=0;s<l.length-1;++s)if(CC(l[s],l[s+1],i))return!1;return!0}function T1(l,i){for(let s=0;s<i.length;s++)if(S1(l,i[s]))return!0;return!1}function Mv(l,i,s){const d=[];for(let f=0;f<l.length;f++){const y=[];for(let _=0;_<l[f].length;_++){const S=kC(l[f][_],s);zc(i,S),y.push(S)}d.push(y)}return d}function Fc(l,i,s){const d=[];for(let f=0;f<l.length;f++){const y=Mv(l[f],i,s);d.push(y)}return d}function E1(l,i,s,d){if(l[0]<s[0]||l[0]>s[2]){const f=.5*d;let y=l[0]-s[0]>f?-d:s[0]-l[0]>f?d:0;y===0&&(y=l[0]-s[2]>f?-d:s[2]-l[0]>f?d:0),l[0]+=y}zc(i,l)}function A1(l,i,s,d){const f=Math.pow(2,d.z)*Nc,y=[d.x*Nc,d.y*Nc],_=[];if(!l)return _;for(const S of l)for(const A of S){const k=[A.x+y[0],A.y+y[1]];E1(k,i,s,f),_.push(k)}return _}function Ym(l,i,s,d){const f=Math.pow(2,d.z)*Nc,y=[d.x*Nc,d.y*Nc],_=[];if(!l)return _;for(const A of l){const k=[];for(const j of A){const R=[j.x+y[0],j.y+y[1]];zc(i,R),k.push(R)}_.push(k)}if(i[2]-i[0]<=f/2){(S=i)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const A of _)for(const k of A)E1(k,i,s,f)}var S;return _}class Bc{constructor(i,s){this.type=_n,this.geojson=i,this.geometries=s}static parse(i,s){if(i.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Or(i[1])){const d=i[1];if(d.type==="FeatureCollection")for(let f=0;f<d.features.length;++f){const y=d.features[f].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Bc(d,d.features[f].geometry)}else if(d.type==="Feature"){const f=d.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Bc(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Bc(d,d)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(s,d){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const S=Mv(d.coordinates,y,_),A=A1(s.geometry(),f,y,_);if(!Qh(f,y))return!1;for(const k of A)if(!ed(k,S))return!1}if(d.type==="MultiPolygon"){const S=Fc(d.coordinates,y,_),A=A1(s.geometry(),f,y,_);if(!Qh(f,y))return!1;for(const k of A)if(!w1(k,S))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(s,d){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const S=Mv(d.coordinates,y,_),A=Ym(s.geometry(),f,y,_);if(!Qh(f,y))return!1;for(const k of A)if(!S1(k,S))return!1}if(d.type==="MultiPolygon"){const S=Fc(d.coordinates,y,_),A=Ym(s.geometry(),f,y,_);if(!Qh(f,y))return!1;for(const k of A)if(!T1(k,S))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Jf={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ps=1/298.257223563,Iv=Ps*(2-Ps),td=Math.PI/180;class rd{static fromTile(i,s,d){const f=Math.PI*(1-2*(i+.5)/Math.pow(2,s)),y=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/td;return new rd(y,d)}static get units(){return Jf}constructor(i,s){if(i===void 0)throw new Error("No latitude given.");if(s&&!Jf[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Jf).join(", ")}`);const d=6378.137*td*(s?Jf[s]:1),f=Math.cos(i*td),y=1/(1-Iv*(1-f*f)),_=Math.sqrt(y);this.kx=d*_*f,this.ky=d*_*y*(1-Iv)}distance(i,s){const d=os(i[0]-s[0])*this.kx,f=(i[1]-s[1])*this.ky;return Math.sqrt(d*d+f*f)}bearing(i,s){const d=os(s[0]-i[0])*this.kx;return Math.atan2(d,(s[1]-i[1])*this.ky)/td}destination(i,s,d){const f=d*td;return this.offset(i,Math.sin(f)*s,Math.cos(f)*s)}offset(i,s,d){return[i[0]+s/this.kx,i[1]+d/this.ky]}lineDistance(i){let s=0;for(let d=0;d<i.length-1;d++)s+=this.distance(i[d],i[d+1]);return s}area(i){let s=0;for(let d=0;d<i.length;d++){const f=i[d];for(let y=0,_=f.length,S=_-1;y<_;S=y++)s+=os(f[y][0]-f[S][0])*(f[y][1]+f[S][1])*(d?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(i,s){let d=0;if(s<=0)return i[0];for(let f=0;f<i.length-1;f++){const y=i[f],_=i[f+1],S=this.distance(y,_);if(d+=S,d>s)return Jm(y,_,(s-(d-S))/S)}return i[i.length-1]}pointToSegmentDistance(i,s,d){let[f,y]=s,_=os(d[0]-f)*this.kx,S=(d[1]-y)*this.ky;if(_!==0||S!==0){const A=(os(i[0]-f)*this.kx*_+(i[1]-y)*this.ky*S)/(_*_+S*S);A>1?(f=d[0],y=d[1]):A>0&&(f+=_/this.kx*A,y+=S/this.ky*A)}return _=os(i[0]-f)*this.kx,S=(i[1]-y)*this.ky,Math.sqrt(_*_+S*S)}pointOnLine(i,s){let d=1/0,f=i[0][0],y=i[0][1],_=0,S=0;for(let A=0;A<i.length-1;A++){let k=i[A][0],j=i[A][1],R=os(i[A+1][0]-k)*this.kx,L=(i[A+1][1]-j)*this.ky,H=0;R===0&&L===0||(H=(os(s[0]-k)*this.kx*R+(s[1]-j)*this.ky*L)/(R*R+L*L),H>1?(k=i[A+1][0],j=i[A+1][1]):H>0&&(k+=R/this.kx*H,j+=L/this.ky*H)),R=os(s[0]-k)*this.kx,L=(s[1]-j)*this.ky;const W=R*R+L*L;W<d&&(d=W,f=k,y=j,_=A,S=H)}return{point:[f,y],index:_,t:Math.max(0,Math.min(1,S))}}lineSlice(i,s,d){let f=this.pointOnLine(d,i),y=this.pointOnLine(d,s);if(f.index>y.index||f.index===y.index&&f.t>y.t){const k=f;f=y,y=k}const _=[f.point],S=f.index+1,A=y.index;!Ov(d[S],_[0])&&S<=A&&_.push(d[S]);for(let k=S+1;k<=A;k++)_.push(d[k]);return Ov(d[A],y.point)||_.push(y.point),_}lineSliceAlong(i,s,d){let f=0;const y=[];for(let _=0;_<d.length-1;_++){const S=d[_],A=d[_+1],k=this.distance(S,A);if(f+=k,f>i&&y.length===0&&y.push(Jm(S,A,(i-(f-k))/k)),f>=s)return y.push(Jm(S,A,(s-(f-k))/k)),y;f>i&&y.push(A)}return y}bufferPoint(i,s){const d=s/this.ky,f=s/this.kx;return[i[0]-f,i[1]-d,i[0]+f,i[1]+d]}bufferBBox(i,s){const d=s/this.ky,f=s/this.kx;return[i[0]-f,i[1]-d,i[2]+f,i[3]+d]}insideBBox(i,s){return os(i[0]-s[0])>=0&&os(i[0]-s[2])<=0&&i[1]>=s[1]&&i[1]<=s[3]}}function Ov(l,i){return l[0]===i[0]&&l[1]===i[1]}function Jm(l,i,s){const d=os(i[0]-l[0]);return[l[0]+d*s,l[1]+(i[1]-l[1])*s]}function os(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class Qm{constructor(i=[],s=(d,f)=>d<f?-1:d>f?1:0){if(this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:s,compare:d}=this,f=s[i];for(;i>0;){const y=i-1>>1,_=s[y];if(d(f,_)>=0)break;s[i]=_,i=y}s[i]=f}_down(i){const{data:s,compare:d}=this,f=this.length>>1,y=s[i];for(;i<f;){let _=1+(i<<1);const S=_+1;if(S<this.length&&d(s[S],s[_])<0&&(_=S),d(s[_],y)>=0)break;s[i]=s[_],i=_}s[i]=y}}var Dt=8192;function jv(l,i){return i.dist-l.dist}const eg=100,tg=50;function Qf(l){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==l.length)return!1;for(let s=0;s<i.length;s++)if(i[s]!==l[s])return!1;return!0}function $u(l){return l[1]-l[0]+1}function Ms(l,i){const s=l[1]>=l[0]&&l[1]<i;return s||console.warn("Distance Expression: Index is out of range"),s}function rg(l,i){if(l[0]>l[1])return[null,null];const s=$u(l);if(i){if(s===2)return[l,null];const d=Math.floor(s/2);return[[l[0],l[0]+d],[l[0]+d,l[1]]]}{if(s===1)return[l,null];const d=Math.floor(s/2)-1;return[[l[0],l[0]+d],[l[0]+d+1,l[1]]]}}function Uc(l,i){const s=[1/0,1/0,-1/0,-1/0];if(!Ms(i,l.length))return s;for(let d=i[0];d<=i[1];++d)zc(s,l[d]);return s}function ep(l){const i=[1/0,1/0,-1/0,-1/0];for(let s=0;s<l.length;++s)for(let d=0;d<l[s].length;++d)zc(i,l[s][d]);return i}function tl(l,i,s){if(Qf(l)||Qf(i))return NaN;let d=0,f=0;return l[2]<i[0]&&(d=i[0]-l[2]),l[0]>i[2]&&(d=l[0]-i[2]),l[1]>i[3]&&(f=l[1]-i[3]),l[3]<i[1]&&(f=i[1]-l[3]),s.distance([0,0],[d,f])}function Xr(l){return 360*l-180}function PC(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Rv(l,i){const s=Math.pow(2,i.z),d=(l.y/Dt+i.y)/s;return[Xr((l.x/Dt+i.x)/s),PC(d)]}function MC(l,i){const s=[];for(let d=0;d<l.length;++d)s.push(Rv(l[d],i));return s}function Dv(l,i,s){const d=s.pointOnLine(i,l).point;return s.distance(l,d)}function k1(l,i,s,d,f){const y=s.slice(d[0],d[1]+1);let _=1/0;for(let S=i[0];S<=i[1];++S)if((_=Math.min(_,Dv(l[S],y,f)))===0)return 0;return _}function li(l,i,s,d,f){const y=Math.min(f.pointToSegmentDistance(l,s,d),f.pointToSegmentDistance(i,s,d)),_=Math.min(f.pointToSegmentDistance(s,l,i),f.pointToSegmentDistance(d,l,i));return Math.min(y,_)}function IC(l,i,s,d,f){if(!Ms(i,l.length)||!Ms(d,s.length))return NaN;let y=1/0;for(let _=i[0];_<i[1];++_)for(let S=d[0];S<d[1];++S){if(Xm(l[_],l[_+1],s[S],s[S+1]))return 0;y=Math.min(y,li(l[_],l[_+1],s[S],s[S+1],f))}return y}function OC(l,i,s,d,f){if(!Ms(i,l.length)||!Ms(d,s.length))return NaN;let y=1/0;for(let _=i[0];_<=i[1];++_)for(let S=d[0];S<=d[1];++S)if((y=Math.min(y,f.distance(l[_],s[S])))===0)return y;return y}function jC(l,i,s){if(ed(l,i,!0))return 0;let d=1/0;for(const f of i){const y=f.length;if(y<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[y-1]&&(d=Math.min(d,s.pointToSegmentDistance(l,f[y-1],f[0])))===0||(d=Math.min(d,Dv(l,f,s)))===0)return d}return d}function RC(l,i,s,d){if(!Ms(i,l.length))return NaN;for(let y=i[0];y<=i[1];++y)if(ed(l[y],s,!0))return 0;let f=1/0;for(let y=i[0];y<i[1];++y)for(const _ of s)for(let S=0,A=_.length,k=A-1;S<A;k=S++){if(Xm(l[y],l[y+1],_[k],_[S]))return 0;f=Math.min(f,li(l[y],l[y+1],_[k],_[S],d))}return f}function C1(l,i){for(const s of l)for(let d=0;d<=s.length-1;++d)if(ed(s[d],i,!0))return!0;return!1}function DC(l,i,s,d=1/0){const f=ep(l),y=ep(i);if(d!==1/0&&tl(f,y,s)>=d)return d;if(Qh(f,y)){if(C1(l,i))return 0}else if(C1(i,l))return 0;let _=d;for(const S of l)for(let A=0,k=S.length,j=k-1;A<k;j=A++)for(const R of i)for(let L=0,H=R.length,W=H-1;L<H;W=L++){if(Xm(S[j],S[A],R[W],R[L]))return 0;_=Math.min(_,li(S[j],S[A],R[W],R[L],s))}return _}function ng(l,i,s,d,f,y,_){if(y===null||_===null)return;const S=tl(Uc(d,y),Uc(f,_),s);S<i&&l.push({dist:S,range1:y,range2:_})}function LC(l,i,s,d,f=1/0){let y=Math.min(d.distance(l[0],s[0][0]),f);if(y===0)return y;const _=new Qm([{dist:0,range1:[0,l.length-1],range2:[0,0]}],jv),S=i?tg:eg,A=ep(s);for(;_.length;){const k=_.pop();if(k.dist>=y)continue;const j=k.range1;if($u(j)<=S){if(!Ms(j,l.length))return NaN;if(i){const R=RC(l,j,s,d);if((y=Math.min(y,R))===0)return y}else for(let R=j[0];R<=j[1];++R){const L=jC(l[R],s,d);if((y=Math.min(y,L))===0)return y}}else{const R=rg(j,i);if(R[0]!==null){const L=tl(Uc(l,R[0]),A,d);L<y&&_.push({dist:L,range1:R[0],range2:[0,0]})}if(R[1]!==null){const L=tl(Uc(l,R[1]),A,d);L<y&&_.push({dist:L,range1:R[1],range2:[0,0]})}}}return y}function P1(l,i,s,d,f,y=1/0){let _=Math.min(y,f.distance(l[0],s[0]));if(_===0)return _;const S=new Qm([{dist:0,range1:[0,l.length-1],range2:[0,s.length-1]}],jv),A=i?tg:eg,k=d?tg:eg;for(;S.length;){const j=S.pop();if(j.dist>=_)continue;const R=j.range1,L=j.range2;if($u(R)<=A&&$u(L)<=k){if(!Ms(R,l.length)||!Ms(L,s.length))return NaN;if(i&&d?_=Math.min(_,IC(l,R,s,L,f)):i||d?i&&!d?_=Math.min(_,k1(s,L,l,R,f)):!i&&d&&(_=Math.min(_,k1(l,R,s,L,f))):_=Math.min(_,OC(l,R,s,L,f)),_===0)return _}else{const H=rg(R,i),W=rg(L,d);ng(S,_,f,l,s,H[0],W[0]),ng(S,_,f,l,s,H[0],W[1]),ng(S,_,f,l,s,H[1],W[0]),ng(S,_,f,l,s,H[1],W[1])}}return _}function Lv(l,i,s,d,f=1/0){let y=f;const _=Uc(l,[0,l.length-1]);for(const S of s)if(!(y!==1/0&&tl(_,Uc(S,[0,S.length-1]),d)>=y)&&(y=Math.min(y,P1(l,i,S,!0,d,y)),y===0))return y;return y}function ig(l,i,s,d,f=1/0){let y=f;const _=Uc(l,[0,l.length-1]);for(const S of s){if(y!==1/0&&tl(_,ep(S),d)>=y)continue;const A=LC(l,i,S,d,y);if(isNaN(A))return A;if((y=Math.min(y,A))===0)return y}return y}function zv(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Gu{constructor(i,s){this.type=or,this.geojson=i,this.geometries=s}static parse(i,s){if(i.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(Or(i[1])){const d=i[1];if(d.type==="FeatureCollection"){for(let f=0;f<d.features.length;++f)if(zv(d.features[f].geometry.type))return new Gu(d,d.features[f].geometry)}else if(d.type==="Feature"){if(zv(d.geometry.type))return new Gu(d,d.geometry)}else if(zv(d.type))return new Gu(d,d)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const s=i.geometry(),d=i.canonicalID();if(s!=null&&d!=null){if(i.geometryType()==="Point")return function(f,y,_){const S=[];for(const k of f)for(const j of k)S.push(Rv(j,y));const A=new rd(S[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?P1(S,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",A):_.type==="MultiLineString"?Lv(S,!1,_.coordinates,A):_.type==="Polygon"||_.type==="MultiPolygon"?ig(S,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,A):null}(s,d,this.geometries);if(i.geometryType()==="LineString")return function(f,y,_){const S=[];for(const k of f){const j=[];for(const R of k)j.push(Rv(R,y));S.push(j)}const A=new rd(S[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Lv(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,A);if(_.type==="MultiLineString"){let k=1/0;for(let j=0;j<_.coordinates.length;j++){const R=Lv(_.coordinates[j],!0,S,A,k);if(isNaN(R))return R;if((k=Math.min(k,R))===0)return k}return k}if(_.type==="Polygon"||_.type==="MultiPolygon"){let k=1/0;for(let j=0;j<S.length;j++){const R=ig(S[j],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,A,k);if(isNaN(R))return R;if((k=Math.min(k,R))===0)return k}return k}return null}(s,d,this.geometries);if(i.geometryType()==="Polygon")return function(f,y,_){const S=[];for(const k of function(j,R){const L=j.length;if(L<=1)return[j];const H=[];let W,J;for(let Q=0;Q<L;Q++){const ae=AC(j[Q]);ae!==0&&(j[Q].area=Math.abs(ae),J===void 0&&(J=ae<0),J===ae<0?(W&&H.push(W),W=[j[Q]]):W.push(j[Q]))}return W&&H.push(W),H}(f)){const j=[];for(let R=0;R<k.length;++R)j.push(MC(k[R],y));S.push(j)}const A=new rd(S[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return ig(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,A);if(_.type==="MultiLineString"){let k=1/0;for(let j=0;j<_.coordinates.length;j++){const R=ig(_.coordinates[j],!0,S,A,k);if(isNaN(R))return R;if((k=Math.min(k,R))===0)return k}return k}return _.type==="Polygon"||_.type==="MultiPolygon"?function(k,j,R){let L=1/0;for(const H of k)for(const W of j){const J=DC(H,W,R,L);if(isNaN(J))return J;if((L=Math.min(L,J))===0)return L}return L}(_.type==="Polygon"?[_.coordinates]:_.coordinates,S,A):null}(s,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function nd(l){if(l instanceof So&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Bc||l instanceof Gu)return!1;if(l instanceof od)return l.featureConstant;let i=!0;return l.eachChild(s=>{i&&!nd(s)&&(i=!1)}),i}function og(l){if(l instanceof So&&l.name==="feature-state")return!1;let i=!0;return l.eachChild(s=>{i&&!og(s)&&(i=!1)}),i}function ag(l){if(l instanceof od)return new Set([l.key]);let i=new Set;return l.eachChild(s=>{i=new Set([...i,...ag(s)])}),i}function id(l,i){if(l instanceof So&&i.indexOf(l.name)>=0)return!1;let s=!0;return l.eachChild(d=>{s&&!id(d,i)&&(s=!1)}),s}function M1(l,i,s){return[l,i,s].filter(Boolean).join("")}function Nv(l,i){switch(l){case"string":return ks(i);case"number":return+i;case"boolean":return!!i;case"color":return Tn.parse(i);case"formatted":return ca.fromString(ks(i));case"resolvedImage":return ka.build(ks(i))}return i}function I1(l,i,s,d){return d!==void 0&&(l=d*Math.round(l/d)),i!==void 0&&l<i&&(l=i),s!==void 0&&l>s&&(l=s),l}class od{constructor(i,s,d,f=!1){this.type=i,this.key=s,this.scope=d,this.featureConstant=f}static parse(i,s){let d=s.expectedType;if(d==null&&(d=En),i.length<2||i.length>3)return s.error("Invalid number of arguments for 'config' expression.");const f=s.parse(i[1],1);if(!(f instanceof mr))return s.error("Key name of 'config' expression must be a string literal.");let y,_=!0;const S=ks(f.value);if(i.length>=3){const A=s.parse(i[2],2);if(!(A instanceof mr))return s.error("Scope of 'config' expression must be a string literal.");y=ks(A.value)}if(s.options){const A=M1(S,y,s._scope),k=s.options.get(A);k&&(_=nd(k.value||k.default))}return new od(d,S,y,_)}evaluate(i){const s=M1(this.key,this.scope,i.scope),d=i.getConfig(s);if(!d)return null;const{type:f,value:y,values:_,minValue:S,maxValue:A,stepValue:k}=d,j=d.default.evaluate(i);let R=j;if(y){const L=i.scope;i.scope=(L||"").split("").slice(1).join(""),R=y.evaluate(i),i.scope=L}return f&&(R=Nv(f,R)),R===void 0||S===void 0&&A===void 0&&k===void 0||(typeof R=="number"?R=I1(R,S,A,k):Array.isArray(R)&&(R=R.map(L=>typeof L=="number"?I1(L,S,A,k):L))),y!==void 0&&R!==void 0&&_&&!_.includes(R)&&(R=j,f&&(R=Nv(f,R))),(f&&f!==this.type||R!==void 0&&!Zm(Ht(R),this.type))&&(R=Nv(this.type.kind,R)),R}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class sg{constructor(i,s){this.type=s.type,this.name=i,this.boundExpression=s}static parse(i,s){if(i.length!==2||typeof i[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const d=i[1];return s.scope.has(d)?new sg(d,s.scope.get(d)):s.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class lg{constructor(i,s=[],d,f=new kv,y=[],_,S){this.registry=i,this.path=s,this.key=s.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=f,this.errors=y,this.expectedType=d,this._scope=_,this.options=S}parse(i,s,d,f,y={}){return s||d?this.concat(s,null,d,f)._parse(i,y):this._parse(i,y)}parseObjectValue(i,s,d,f,y,_={}){return this.concat(s,d,f,y)._parse(i,_)}_parse(i,s){function d(f,y,_){return _==="assert"?new ur(y,[f]):_==="coerce"?new Cs(y,[f]):f}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(f){let y=f.parse(i,this);if(!y)return null;if(this.expectedType){const _=this.expectedType,S=y.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||S.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(_,S))return null}else y=d(y,_,s.typeAnnotation||"coerce");else y=d(y,_,s.typeAnnotation||"assert")}if(!(y instanceof mr)&&y.type.kind!=="resolvedImage"&&Fv(y)){const _=new Xf(this._scope,this.options);try{y=new mr(y.type,y.evaluate(_))}catch(S){return this.error(S.message),null}}return y}return Cs.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,s,d,f){let y=typeof i=="number"?this.path.concat(i):this.path;y=typeof s=="string"?y.concat(s):y;const _=f?this.scope.concat(f):this.scope;return new lg(this.registry,y,d||null,_,this.errors,this._scope,this.options)}error(i,...s){const d=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new is(d,i))}checkSubtype(i,s){const d=Xh(i,s);return d&&this.error(d),d}}function Fv(l){if(l instanceof sg)return Fv(l.boundExpression);if(l instanceof So&&l.name==="error"||l instanceof yl||l instanceof Bc||l instanceof Gu||l instanceof od)return!1;const i=l instanceof Cs||l instanceof ur;let s=!0;return l.eachChild(d=>{s=i?s&&Fv(d):s&&d instanceof mr}),!!s&&nd(l)&&id(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function cg(l,i){const s=l.length-1;let d,f,y=0,_=s,S=0;for(;y<=_;)if(S=Math.floor((y+_)/2),d=l[S],f=l[S+1],d<=i){if(S===s||i<f)return S;y=S+1}else{if(!(d>i))throw new Vi("Input is not a number.");_=S-1}return 0}class tp{constructor(i,s,d){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(const[f,y]of d)this.labels.push(f),this.outputs.push(y)}static parse(i,s){if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");const d=s.parse(i[1],1,or);if(!d)return null;const f=[];let y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(let _=1;_<i.length;_+=2){const S=_===1?-1/0:i[_],A=i[_+1],k=_,j=_+1;if(typeof S!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(f.length&&f[f.length-1][0]>=S)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const R=s.parse(A,j,y);if(!R)return null;y=y||R.type,f.push([S,R])}return new tp(y,d,f)}evaluate(i){const s=this.labels,d=this.outputs;if(s.length===1)return d[0].evaluate(i);const f=this.input.evaluate(i);if(f<=s[0])return d[0].evaluate(i);const y=s.length;return f>=s[y-1]?d[y-1].evaluate(i):d[cg(s,f)].evaluate(i)}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i}}const O1=.95047,j1=1.08883,R1=4/29,ad=6/29,D1=3*ad*ad,Bv=ad*ad*ad,zC=Math.PI/180,L1=180/Math.PI;function Uv(l){return l>Bv?Math.pow(l,1/3):l/D1+R1}function Vv(l){return l>ad?l*l*l:D1*(l-R1)}function $v(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function ug(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Gv(l){const i=ug(l.r),s=ug(l.g),d=ug(l.b),f=Uv((.4124564*i+.3575761*s+.1804375*d)/O1),y=Uv((.2126729*i+.7151522*s+.072175*d)/1);return{l:116*y-16,a:500*(f-y),b:200*(y-Uv((.0193339*i+.119192*s+.9503041*d)/j1)),alpha:l.a}}function qu(l){let i=(l.l+16)/116,s=isNaN(l.a)?i:i+l.a/500,d=isNaN(l.b)?i:i-l.b/200;return i=1*Vv(i),s=O1*Vv(s),d=j1*Vv(d),new Tn($v(3.2404542*s-1.5371385*i-.4985314*d),$v(-.969266*s+1.8760108*i+.041556*d),$v(.0556434*s-.2040259*i+1.0572252*d),l.alpha)}function z1(l,i,s){const d=i-l;return l+s*(d>180||d<-180?d-360*Math.round(d/360):d)}const sd={forward:Gv,reverse:qu,interpolate:function(l,i,s){return{l:lr(l.l,i.l,s),a:lr(l.a,i.a,s),b:lr(l.b,i.b,s),alpha:lr(l.alpha,i.alpha,s)}}},rp={forward:function(l){const{l:i,a:s,b:d}=Gv(l),f=Math.atan2(d,s)*L1;return{h:f<0?f+360:f,c:Math.sqrt(s*s+d*d),l:i,alpha:l.a}},reverse:function(l){const i=l.h*zC,s=l.c;return qu({l:l.l,a:Math.cos(i)*s,b:Math.sin(i)*s,alpha:l.alpha})},interpolate:function(l,i,s){return{h:z1(l.h,i.h,s),c:lr(l.c,i.c,s),l:lr(l.l,i.l,s),alpha:lr(l.alpha,i.alpha,s)}}};var hg=Object.freeze({__proto__:null,hcl:rp,lab:sd});class Ca{constructor(i,s,d,f,y){this.type=i,this.operator=s,this.interpolation=d,this.input=f,this.labels=[],this.outputs=[];for(const[_,S]of y)this.labels.push(_),this.outputs.push(S)}static interpolationFactor(i,s,d,f){let y=0;if(i.name==="exponential")y=qv(s,i.base,d,f);else if(i.name==="linear")y=qv(s,1,d,f);else if(i.name==="cubic-bezier"){const _=i.controlPoints;y=new Ic(_[0],_[1],_[2],_[3]).solve(qv(s,1,d,f))}return y}static parse(i,s){let[d,f,y,..._]=i;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const k=f[1];if(typeof k!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:k}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const k=f.slice(1);if(k.length!==4||k.some(j=>typeof j!="number"||j<0||j>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:k}}}if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,or),!y)return null;const S=[];let A=null;d==="interpolate-hcl"||d==="interpolate-lab"?A=Ua:s.expectedType&&s.expectedType.kind!=="value"&&(A=s.expectedType);for(let k=0;k<_.length;k+=2){const j=_[k],R=_[k+1],L=k+3,H=k+4;if(typeof j!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(S.length&&S[S.length-1][0]>=j)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const W=s.parse(R,H,A);if(!W)return null;A=A||W.type,S.push([j,W])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new Ca(A,d,f,y,S):s.error(`Type ${Zi(A)} is not interpolatable.`)}evaluate(i){const s=this.labels,d=this.outputs;if(s.length===1)return d[0].evaluate(i);const f=this.input.evaluate(i);if(f<=s[0])return d[0].evaluate(i);const y=s.length;if(f>=s[y-1])return d[y-1].evaluate(i);const _=cg(s,f),S=Ca.interpolationFactor(this.interpolation,f,s[_],s[_+1]),A=d[_].evaluate(i),k=d[_+1].evaluate(i);return this.operator==="interpolate"?Gf[this.type.kind.toLowerCase()](A,k,S):this.operator==="interpolate-hcl"?rp.reverse(rp.interpolate(rp.forward(A),rp.forward(k),S)):sd.reverse(sd.interpolate(sd.forward(A),sd.forward(k),S))}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const s=[this.operator,i,this.input.serialize()];for(let d=0;d<this.labels.length;d++)s.push(this.labels[d],this.outputs[d].serialize());return s}}function qv(l,i,s,d){const f=d-s,y=l-s;return f===0?0:i===1?y/f:(Math.pow(i,y)-1)/(Math.pow(i,f)-1)}class dg{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expectected at least one argument.");let d=null;const f=s.expectedType;f&&f.kind!=="value"&&(d=f);const y=[];for(const S of i.slice(1)){const A=s.parse(S,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!A)return null;d=d||A.type,y.push(A)}const _=f&&y.some(S=>Xh(f,S.type));return new dg(_?En:d,y)}evaluate(i){let s,d=null,f=0;for(const y of this.args){if(f++,d=y.evaluate(i),d&&d instanceof ka&&!d.available&&(s||(s=d),d=null,f===this.args.length))return s;if(d!==null)break}return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(s=>{i.push(s.serialize())}),i}}class np{constructor(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const s of this.bindings)i(s[1]);i(this.result)}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let y=1;y<i.length-1;y+=2){const _=i[y];if(typeof _!="string")return s.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const S=s.parse(i[y+1],y+1);if(!S)return null;d.push([_,S])}const f=s.parse(i[i.length-1],i.length-1,s.expectedType,d);return f?new np(d,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[s,d]of this.bindings)i.push(s,d.serialize());return i.push(this.result.serialize()),i}}class fg{constructor(i,s,d){this.type=i,this.index=s,this.input=d}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,or),f=s.parse(i[2],2,Ho(s.expectedType||En));return d&&f?new fg(f.type.itemType,d,f):null}evaluate(i){const s=this.index.evaluate(i),d=this.input.evaluate(i);if(s<0)throw new Vi(`Array index out of bounds: ${s} < 0.`);if(s>=d.length)throw new Vi(`Array index out of bounds: ${s} > ${d.length-1}.`);if(s!==Math.floor(s))throw new Vi(`Array index must be an integer, but found ${s} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return d[s]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Hv{constructor(i,s,d){this.type=i,this.index=s,this.input=d}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,or),f=s.parse(i[2],2,Ho(s.expectedType||En));return d&&f?new Hv(f.type.itemType,d,f):null}evaluate(i){const s=this.index.evaluate(i),d=this.input.evaluate(i);if(s<0)throw new Vi(`Array index out of bounds: ${s} < 0.`);if(s>d.length-1)throw new Vi(`Array index out of bounds: ${s} > ${d.length-1}.`);if(s===Math.floor(s))return d[s];const f=Math.floor(s),y=Math.ceil(s),_=d[f],S=d[y];if(typeof _!="number"||typeof S!="number")throw new Vi(`Cannot interpolate between non-number values at index ${s}.`);const A=s-f;return _*(1-A)+S*A}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Wv{constructor(i,s){this.type=_n,this.needle=i,this.haystack=s}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,En),f=s.parse(i[2],2,En);return d&&f?Dc(d.type,[_n,yn,or,Kh,En])?new Wv(d,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(d.type)} instead`):null}evaluate(i){const s=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(d==null)return!1;if(!Wf(s,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(Ht(s))} instead.`);if(!Wf(d,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${Zi(Ht(d))} instead.`);return d.indexOf(s)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class pg{constructor(i,s,d){this.type=or,this.needle=i,this.haystack=s,this.fromIndex=d}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,En),f=s.parse(i[2],2,En);if(!d||!f)return null;if(!Dc(d.type,[_n,yn,or,Kh,En]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(d.type)} instead`);if(i.length===4){const y=s.parse(i[3],3,or);return y?new pg(d,f,y):null}return new pg(d,f)}evaluate(i){const s=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!Wf(s,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(Ht(s))} instead.`);if(!Wf(d,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${Zi(Ht(d))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(i);return d.indexOf(s,f)}return d.indexOf(s)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class mg{constructor(i,s,d,f,y,_){this.inputType=i,this.type=s,this.input=d,this.cases=f,this.outputs=y,this.otherwise=_}static parse(i,s){if(i.length<5)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return s.error("Expected an even number of arguments.");let d,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const y={},_=[];for(let k=2;k<i.length-1;k+=2){let j=i[k];const R=i[k+1];Array.isArray(j)||(j=[j]);const L=s.concat(k);if(j.length===0)return L.error("Expected at least one branch label.");for(const W of j){if(typeof W!="number"&&typeof W!="string")return L.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return L.error("Numeric branch labels must be integer values.");if(d){if(L.checkSubtype(d,Ht(W)))return null}else d=Ht(W);if(y[String(W)]!==void 0)return L.error("Branch labels must be unique.");y[String(W)]=_.length}const H=s.parse(R,k,f);if(!H)return null;f=f||H.type,_.push(H)}const S=s.parse(i[1],1,En);if(!S)return null;const A=s.parse(i[i.length-1],i.length-1,f);return A?S.type.kind!=="value"&&s.concat(1).checkSubtype(d,S.type)?null:new mg(d,f,S,y,_,A):null}evaluate(i){const s=this.input.evaluate(i);return(Zm(Ht(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),d=[],f={};for(const _ of s){const S=f[this.cases[_]];S===void 0?(f[this.cases[_]]=d.length,d.push([this.cases[_],[_]])):d[S][1].push(_)}const y=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,S]of d)i.push(S.length===1?y(S[0]):S.map(y)),i.push(this.outputs[_].serialize());return i.push(this.otherwise.serialize()),i}}class gg{constructor(i,s,d){this.type=i,this.branches=s,this.otherwise=d}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return s.error("Expected an odd number of arguments.");let d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);const f=[];for(let _=1;_<i.length-1;_+=2){const S=s.parse(i[_],_,_n);if(!S)return null;const A=s.parse(i[_+1],_+1,d);if(!A)return null;f.push([S,A]),d=d||A.type}const y=s.parse(i[i.length-1],i.length-1,d);return y?new gg(d,f,y):null}evaluate(i){for(const[s,d]of this.branches)if(s.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[s,d]of this.branches)i(s),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(s=>{i.push(s.serialize())}),i}}class Hu{constructor(i,s,d,f){this.type=i,this.input=s,this.beginIndex=d,this.endIndex=f}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,En),f=s.parse(i[2],2,or);if(!d||!f)return null;if(!Dc(d.type,[Ho(En),yn,En]))return s.error(`Expected first argument to be of type array or string, but found ${Zi(d.type)} instead`);if(i.length===4){const y=s.parse(i[3],3,or);return y?new Hu(d.type,d,f,y):null}return new Hu(d.type,d,f)}evaluate(i){const s=this.input.evaluate(i),d=this.beginIndex.evaluate(i);if(!Wf(s,["string","array"]))throw new Vi(`Expected first argument to be of type array or string, but found ${Zi(Ht(s))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(i);return s.slice(d,f)}return s.slice(d)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Zv{constructor(i,s){this.type=Ho(yn),this.str=i,this.delimiter=s}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,yn),f=s.parse(i[2],2,yn);return d&&f?new Zv(d,f):void 0}evaluate(i){const s=this.str.evaluate(i),d=this.delimiter.evaluate(i);return s.split(d)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Kv(l,i){return l==="=="||l==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function N1(l,i,s,d){return d.compare(i,s)===0}function ld(l,i,s){const d=l!=="=="&&l!=="!=";return class lZ{constructor(y,_,S){this.type=_n,this.lhs=y,this.rhs=_,this.collator=S,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");const S=y[0];let A=_.parse(y[1],1,En);if(!A)return null;if(!Kv(S,A.type))return _.concat(1).error(`"${S}" comparisons are not supported for type '${Zi(A.type)}'.`);let k=_.parse(y[2],2,En);if(!k)return null;if(!Kv(S,k.type))return _.concat(2).error(`"${S}" comparisons are not supported for type '${Zi(k.type)}'.`);if(A.type.kind!==k.type.kind&&A.type.kind!=="value"&&k.type.kind!=="value")return _.error(`Cannot compare types '${Zi(A.type)}' and '${Zi(k.type)}'.`);d&&(A.type.kind==="value"&&k.type.kind!=="value"?A=new ur(k.type,[A]):A.type.kind!=="value"&&k.type.kind==="value"&&(k=new ur(A.type,[k])));let j=null;if(y.length===4){if(A.type.kind!=="string"&&k.type.kind!=="string"&&A.type.kind!=="value"&&k.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(j=_.parse(y[3],3,Wm),!j)return null}return new lZ(A,k,j)}evaluate(y){const _=this.lhs.evaluate(y),S=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const A=Ht(_),k=Ht(S);if(A.kind!==k.kind||A.kind!=="string"&&A.kind!=="number")throw new Vi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${A.kind}, ${k.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const A=Ht(_),k=Ht(S);if(A.kind!=="string"||k.kind!=="string")return i(y,_,S)}return this.collator?s(y,_,S,this.collator.evaluate(y)):i(y,_,S)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[l];return this.eachChild(_=>{y.push(_.serialize())}),y}}}const F1=ld("==",function(l,i,s){return i===s},N1),B1=ld("!=",function(l,i,s){return i!==s},function(l,i,s,d){return!N1(0,i,s,d)}),NC=ld("<",function(l,i,s){return i<s},function(l,i,s,d){return d.compare(i,s)<0}),FC=ld(">",function(l,i,s){return i>s},function(l,i,s,d){return d.compare(i,s)>0}),BC=ld("<=",function(l,i,s){return i<=s},function(l,i,s,d){return d.compare(i,s)<=0}),yg=ld(">=",function(l,i,s){return i>=s},function(l,i,s,d){return d.compare(i,s)>=0});class Xv{constructor(i,s,d,f,y,_){this.type=yn,this.number=i,this.locale=s,this.currency=d,this.unit=f,this.minFractionDigits=y,this.maxFractionDigits=_}static parse(i,s){if(i.length!==3)return s.error("Expected two arguments.");const d=s.parse(i[1],1,or);if(!d)return null;const f=i[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let y=null;if(f.locale&&(y=s.parseObjectValue(f.locale,2,"locale",yn),!y))return null;let _=null;if(f.currency&&(_=s.parseObjectValue(f.currency,2,"currency",yn),!_))return null;let S=null;if(f.unit&&(S=s.parseObjectValue(f.unit,2,"unit",yn),!S))return null;let A=null;if(f["min-fraction-digits"]&&(A=s.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",or),!A))return null;let k=null;return f["max-fraction-digits"]&&(k=s.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",or),!k)?null:new Xv(d,y,_,S,A,k)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Yv{constructor(i){this.type=or,this.input=i}static parse(i,s){if(i.length!==2)return s.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=s.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Zi(d.type)} instead.`):new Yv(d):null}evaluate(i){const s=this.input.evaluate(i);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Vi(`Expected value to be of type string or array, but found ${Zi(Ht(s))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(s=>{i.push(s.serialize())}),i}}function U1(l){return function(){l=1831565813+(l|=0)|0;let i=Math.imul(l^l>>>15,1|l);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const cd={"==":F1,"!=":B1,">":FC,"<":NC,">=":yg,"<=":BC,array:ur,at:fg,"at-interpolated":Hv,boolean:ur,case:gg,coalesce:dg,collator:yl,format:Yh,image:Jh,in:Wv,"index-of":pg,interpolate:Ca,"interpolate-hcl":Ca,"interpolate-lab":Ca,length:Yv,let:np,literal:mr,match:mg,number:ur,"number-format":Xv,object:ur,slice:Hu,step:tp,string:ur,"to-boolean":Cs,"to-color":Cs,"to-number":Cs,"to-string":Cs,var:sg,within:Bc,distance:Gu,config:od,split:Zv};function Jv(l,[i,s,d,f]){i=i.evaluate(l),s=s.evaluate(l),d=d.evaluate(l);const y=f?f.evaluate(l):1,_=Uu(i,s,d,y);if(_)throw new Vi(_);return new Tn(i/255,s/255,d/255,y)}function V1(l,[i,s,d,f]){i=i.evaluate(l),s=s.evaluate(l),d=d.evaluate(l);const y=f?f.evaluate(l):1,_=function(k,j,R,L){return typeof k=="number"&&k>=0&&k<=360?typeof j=="number"&&j>=0&&j<=100&&typeof R=="number"&&R>=0&&R<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[k,j,R,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[k,j,R,L]:[k,j,R]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[k,j,R,L]:[k,j,R]).join(", ")}]: 'h' must be between 0 and 360.`}(i,s,d,y);if(_)throw new Vi(_);const S=`hsla(${i}, ${s}%, ${d}%, ${y})`,A=Tn.parse(S);if(!A)throw new Vi(`Failed to parse HSLA color: ${S}`);return A}function $1(l,i){return l in i}function _g(l,i){const s=i[l];return s===void 0?null:s}function Vc(l){return{type:l}}function Qv(l){return{result:"success",value:l}}function $c(l){return{result:"error",value:l}}function Gc(l,i){return!!l&&!!l.parameters&&l.parameters.indexOf(i)>-1}function vg(l){return l["property-type"]==="data-driven"}function G1(l){return Gc(l.expression,"measure-light")}function q1(l){return Gc(l.expression,"zoom")}function xg(l){return!!l.expression&&l.expression.interpolated}function bg(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function H1(l){return l}function e0(l,i){const s=i.type==="color",d=l.stops&&typeof l.stops[0][0]=="object",f=d||!(d||l.property!==void 0),y=l.type||(xg(i)?"exponential":"interval");if(s&&((l=Bu({},l)).stops&&(l.stops=l.stops.map(k=>[k[0],Tn.parse(k[1])])),l.default=Tn.parse(l.default?l.default:i.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!hg[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let _,S,A;if(y==="exponential")_=Z1;else if(y==="interval")_=W1;else if(y==="categorical"){_=t0,S=Object.create(null);for(const k of l.stops)S[k[0]]=k[1];A=typeof l.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);_=qc}if(d){const k={},j=[];for(let H=0;H<l.stops.length;H++){const W=l.stops[H],J=W[0].zoom;k[J]===void 0&&(k[J]={zoom:J,type:l.type,property:l.property,default:l.default,stops:[]},j.push(J)),k[J].stops.push([W[0].value,W[1]])}const R=[];for(const H of j)R.push([k[H].zoom,e0(k[H],i)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Ca.interpolationFactor.bind(void 0,L),zoomStops:R.map(H=>H[0]),evaluate:({zoom:H},W)=>Z1({stops:R,base:l.base},i,H).evaluate(H,W)}}if(f){const k=y==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:Ca.interpolationFactor.bind(void 0,k),zoomStops:l.stops.map(j=>j[0]),evaluate:({zoom:j})=>_(l,i,j,S,A)}}return{kind:"source",evaluate(k,j){const R=j&&j.properties?j.properties[l.property]:void 0;return R===void 0?Wu(l.default,i.default):_(l,i,R,S,A)}}}function Wu(l,i,s){return l!==void 0?l:i!==void 0?i:s!==void 0?s:void 0}function t0(l,i,s,d,f){return Wu(typeof s===f?d[s]:void 0,l.default,i.default)}function W1(l,i,s){if(Lc(s)!=="number")return Wu(l.default,i.default);const d=l.stops.length;if(d===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[d-1][0])return l.stops[d-1][1];const f=cg(l.stops.map(y=>y[0]),s);return l.stops[f][1]}function Z1(l,i,s){const d=l.base!==void 0?l.base:1;if(Lc(s)!=="number")return Wu(l.default,i.default);const f=l.stops.length;if(f===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[f-1][0])return l.stops[f-1][1];const y=cg(l.stops.map(j=>j[0]),s),_=function(j,R,L,H){const W=H-L,J=j-L;return W===0?0:R===1?J/W:(Math.pow(R,J)-1)/(Math.pow(R,W)-1)}(s,d,l.stops[y][0],l.stops[y+1][0]),S=l.stops[y][1],A=l.stops[y+1][1];let k=Gf[i.type]||H1;if(l.colorSpace&&l.colorSpace!=="rgb"){const j=hg[l.colorSpace];k=(R,L)=>j.reverse(j.interpolate(j.forward(R),j.forward(L),_))}return typeof S.evaluate=="function"?{evaluate(...j){const R=S.evaluate.apply(void 0,j),L=A.evaluate.apply(void 0,j);if(R!==void 0&&L!==void 0)return k(R,L,_)}}:k(S,A,_)}function qc(l,i,s){return i.type==="color"?s=Tn.parse(s):i.type==="formatted"?s=ca.fromString(s.toString()):i.type==="resolvedImage"?s=ka.build(s.toString()):Lc(s)===i.type||i.type==="enum"&&i.values[s]||(s=void 0),Wu(s,l.default,i.default)}So.register(cd,{error:[{kind:"error"},[yn],(l,[i])=>{throw new Vi(i.evaluate(l))}],typeof:[yn,[En],(l,[i])=>Zi(Ht(i.evaluate(l)))],"to-rgba":[Ho(or,4),[Ua],(l,[i])=>i.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ho(or,4),[Ua],(l,[i])=>i.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ua,[or,or,or],Jv],rgba:[Ua,[or,or,or,or],Jv],hsl:[Ua,[or,or,or],V1],hsla:[Ua,[or,or,or,or],V1],has:{type:_n,overloads:[[[yn],(l,[i])=>$1(i.evaluate(l),l.properties())],[[yn,Zl],(l,[i,s])=>$1(i.evaluate(l),s.evaluate(l))]]},get:{type:En,overloads:[[[yn],(l,[i])=>_g(i.evaluate(l),l.properties())],[[yn,Zl],(l,[i,s])=>_g(i.evaluate(l),s.evaluate(l))]]},"feature-state":[En,[yn],(l,[i])=>_g(i.evaluate(l),l.featureState||{})],properties:[Zl,[],l=>l.properties()],"geometry-type":[yn,[],l=>l.geometryType()],worldview:[yn,[],l=>l.globals.worldview||""],id:[En,[],l=>l.id()],zoom:[or,[],l=>l.globals.zoom],pitch:[or,[],l=>l.globals.pitch||0],"distance-from-center":[or,[],l=>l.distanceFromCenter()],"measure-light":[or,[yn],(l,[i])=>l.measureLight(i.evaluate(l))],"heatmap-density":[or,[],l=>l.globals.heatmapDensity||0],"line-progress":[or,[],l=>l.globals.lineProgress||0],"raster-value":[or,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[or,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[or,[],l=>l.globals.skyRadialProgress||0],accumulated:[En,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[or,Vc(or),(l,i)=>{let s=0;for(const d of i)s+=d.evaluate(l);return s}],"*":[or,Vc(or),(l,i)=>{let s=1;for(const d of i)s*=d.evaluate(l);return s}],"-":{type:or,overloads:[[[or,or],(l,[i,s])=>i.evaluate(l)-s.evaluate(l)],[[or],(l,[i])=>-i.evaluate(l)]]},"/":[or,[or,or],(l,[i,s])=>i.evaluate(l)/s.evaluate(l)],"%":[or,[or,or],(l,[i,s])=>i.evaluate(l)%s.evaluate(l)],ln2:[or,[],()=>Math.LN2],pi:[or,[],()=>Math.PI],e:[or,[],()=>Math.E],"^":[or,[or,or],(l,[i,s])=>Math.pow(i.evaluate(l),s.evaluate(l))],sqrt:[or,[or],(l,[i])=>Math.sqrt(i.evaluate(l))],log10:[or,[or],(l,[i])=>Math.log(i.evaluate(l))/Math.LN10],ln:[or,[or],(l,[i])=>Math.log(i.evaluate(l))],log2:[or,[or],(l,[i])=>Math.log(i.evaluate(l))/Math.LN2],sin:[or,[or],(l,[i])=>Math.sin(i.evaluate(l))],cos:[or,[or],(l,[i])=>Math.cos(i.evaluate(l))],tan:[or,[or],(l,[i])=>Math.tan(i.evaluate(l))],asin:[or,[or],(l,[i])=>Math.asin(i.evaluate(l))],acos:[or,[or],(l,[i])=>Math.acos(i.evaluate(l))],atan:[or,[or],(l,[i])=>Math.atan(i.evaluate(l))],min:[or,Vc(or),(l,i)=>Math.min(...i.map(s=>s.evaluate(l)))],max:[or,Vc(or),(l,i)=>Math.max(...i.map(s=>s.evaluate(l)))],abs:[or,[or],(l,[i])=>Math.abs(i.evaluate(l))],round:[or,[or],(l,[i])=>{const s=i.evaluate(l);return s<0?-Math.round(-s):Math.round(s)}],floor:[or,[or],(l,[i])=>Math.floor(i.evaluate(l))],ceil:[or,[or],(l,[i])=>Math.ceil(i.evaluate(l))],"filter-==":[_n,[yn,En],(l,[i,s])=>l.properties()[i.value]===s.value],"filter-id-==":[_n,[En],(l,[i])=>l.id()===i.value],"filter-type-==":[_n,[yn],(l,[i])=>l.geometryType()===i.value],"filter-<":[_n,[yn,En],(l,[i,s])=>{const d=l.properties()[i.value],f=s.value;return typeof d==typeof f&&d<f}],"filter-id-<":[_n,[En],(l,[i])=>{const s=l.id(),d=i.value;return typeof s==typeof d&&s<d}],"filter->":[_n,[yn,En],(l,[i,s])=>{const d=l.properties()[i.value],f=s.value;return typeof d==typeof f&&d>f}],"filter-id->":[_n,[En],(l,[i])=>{const s=l.id(),d=i.value;return typeof s==typeof d&&s>d}],"filter-<=":[_n,[yn,En],(l,[i,s])=>{const d=l.properties()[i.value],f=s.value;return typeof d==typeof f&&d<=f}],"filter-id-<=":[_n,[En],(l,[i])=>{const s=l.id(),d=i.value;return typeof s==typeof d&&s<=d}],"filter->=":[_n,[yn,En],(l,[i,s])=>{const d=l.properties()[i.value],f=s.value;return typeof d==typeof f&&d>=f}],"filter-id->=":[_n,[En],(l,[i])=>{const s=l.id(),d=i.value;return typeof s==typeof d&&s>=d}],"filter-has":[_n,[En],(l,[i])=>i.value in l.properties()],"filter-has-id":[_n,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[_n,[Ho(yn)],(l,[i])=>i.value.indexOf(l.geometryType())>=0],"filter-id-in":[_n,[Ho(En)],(l,[i])=>i.value.indexOf(l.id())>=0],"filter-in-small":[_n,[yn,Ho(En)],(l,[i,s])=>s.value.indexOf(l.properties()[i.value])>=0],"filter-in-large":[_n,[yn,Ho(En)],(l,[i,s])=>function(d,f,y,_){for(;y<=_;){const S=y+_>>1;if(f[S]===d)return!0;f[S]>d?_=S-1:y=S+1}return!1}(l.properties()[i.value],s.value,0,s.value.length-1)],all:{type:_n,overloads:[[[_n,_n],(l,[i,s])=>i.evaluate(l)&&s.evaluate(l)],[Vc(_n),(l,i)=>{for(const s of i)if(!s.evaluate(l))return!1;return!0}]]},any:{type:_n,overloads:[[[_n,_n],(l,[i,s])=>i.evaluate(l)||s.evaluate(l)],[Vc(_n),(l,i)=>{for(const s of i)if(s.evaluate(l))return!0;return!1}]]},"!":[_n,[_n],(l,[i])=>!i.evaluate(l)],"is-supported-script":[_n,[yn],(l,[i])=>{const s=l.globals&&l.globals.isSupportedScript;return!s||s(i.evaluate(l))}],upcase:[yn,[yn],(l,[i])=>i.evaluate(l).toUpperCase()],downcase:[yn,[yn],(l,[i])=>i.evaluate(l).toLowerCase()],concat:[yn,Vc(En),(l,i)=>i.map(s=>ks(s.evaluate(l))).join("")],"resolved-locale":[yn,[Wm],(l,[i])=>i.evaluate(l).resolvedLocale()],random:[or,[or,or,En],(l,i)=>{const[s,d,f]=i.map(_=>_.evaluate(l));if(s>d||s===d)return s;let y;if(typeof f=="string")y=function(_){let S=0;if(_.length===0)return S;for(let A=0;A<_.length;A++)S=(S<<5)-S+_.charCodeAt(A),S|=0;return S}(f);else{if(typeof f!="number")throw new Vi(`Invalid seed input: ${f}`);y=f}return s+U1(y)()*(d-s)}]});class r0{constructor(i,s,d,f){this.expression=i,this._warningHistory={},this._evaluator=new Xf(d,f),this._defaultValue=s?function(y){return y.type==="color"&&(bg(y.default)||Array.isArray(y.default))?new Tn(0,0,0,0):y.type==="color"?Tn.parse(y.default)||null:y.default===void 0?null:y.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=ag(i)}evaluateWithoutErrorHandling(i,s,d,f,y,_,S,A){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=d,this._evaluator.canonical=f||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(i,s,d,f,y,_,S,A){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=d||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new Vi(`Expected value to be one of ${Object.keys(this._enumValues).map(j=>JSON.stringify(j)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${k.message}`)),this._defaultValue}}}function n0(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in cd}function Zu(l,i,s,d){const f=new lg(cd,[],i?function(_){const S={color:Ua,string:yn,number:or,enum:yn,boolean:_n,formatted:qf,resolvedImage:Hf};return _.type==="array"?Ho(S[_.value]||En,_.length):S[_.type]}(i):void 0,void 0,void 0,s,d),y=f.parse(l,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?Qv(new r0(y,i,s,d)):$c(f.errors)}class wg{constructor(i,s,d,f){this.kind=i,this._styleExpression=s,this.isLightConstant=d,this.isLineProgressConstant=f,this.isStateDependent=i!=="constant"&&!og(s.expression),this.configDependencies=ag(s.expression)}evaluateWithoutErrorHandling(i,s,d,f,y,_){return this._styleExpression.evaluateWithoutErrorHandling(i,s,d,f,y,_)}evaluate(i,s,d,f,y,_){return this._styleExpression.evaluate(i,s,d,f,y,_)}}class Hc{constructor(i,s,d,f,y,_){this.kind=i,this.zoomStops=d,this._styleExpression=s,this.isStateDependent=i!=="camera"&&!og(s.expression),this.isLightConstant=y,this.isLineProgressConstant=_,this.configDependencies=ag(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,s,d,f,y,_){return this._styleExpression.evaluateWithoutErrorHandling(i,s,d,f,y,_)}evaluate(i,s,d,f,y,_){return this._styleExpression.evaluate(i,s,d,f,y,_)}interpolationFactor(i,s,d){return this.interpolationType?Ca.interpolationFactor(this.interpolationType,i,s,d):0}}function i0(l,i,s,d){if((l=Zu(l,i,s,d)).result==="error")return l;const f=l.value.expression,y=nd(f);if(!y&&!vg(i))return $c([new is("","data expressions not supported")]);const _=id(f,["zoom","pitch","distance-from-center"]);if(!_&&!q1(i))return $c([new is("","zoom expressions not supported")]);const S=id(f,["measure-light"]);if(!S&&!G1(i))return $c([new is("","measure-light expression not supported")]);const A=id(f,["line-progress"]);if(!A&&!function(R){return Gc(R.expression,"line-progress")}(i))return $c([new is("","line-progress expression not supported")]);const k=i.expression&&i.expression.relaxZoomRestriction,j=ip(f);return j||_||k?j instanceof is?$c([j]):j instanceof Ca&&!xg(i)?$c([new is("",'"interpolate" expressions cannot be used with this property')]):Qv(j?new Hc(y&&A?"camera":"composite",l.value,j.labels,j instanceof Ca?j.interpolation:void 0,S,A):new wg(y&&A?"constant":"source",l.value,S,A)):$c([new is("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ku{constructor(i,s){this._parameters=i,this._specification=s,Bu(this,e0(this._parameters,this._specification))}static deserialize(i){return new Ku(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ip(l){let i=null;if(l instanceof np)i=ip(l.result);else if(l instanceof dg){for(const s of l.args)if(i=ip(s),i)break}else(l instanceof tp||l instanceof Ca)&&l.input instanceof So&&l.input.name==="zoom"&&(i=l);return i instanceof is||l.eachChild(s=>{const d=ip(s);d instanceof is?i=d:i&&d&&i!==d&&(i=new is("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var o0,K1,a0=function(){if(K1)return o0;K1=1,o0=i;var l=3;function i(s,d,f){var y=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var _=new Int32Array(this.arrayBuffer);s=_[0],this.d=(d=_[1])+2*(f=_[2]);for(var S=0;S<this.d*this.d;S++){var A=_[l+S],k=_[l+S+1];y.push(A===k?null:_.subarray(A,k))}var j=_[l+y.length+1];this.keys=_.subarray(_[l+y.length],j),this.bboxes=_.subarray(j),this.insert=this._insertReadonly}else{this.d=d+2*f;for(var R=0;R<this.d*this.d;R++)y.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=s,this.padding=f,this.scale=d/s,this.uid=0;var L=f/d*s;this.min=-L,this.max=s+L}return i.prototype.insert=function(s,d,f,y,_){this._forEachCell(d,f,y,_,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(d),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(_)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(s,d,f,y,_,S){this.cells[_].push(S)},i.prototype.query=function(s,d,f,y,_){var S=this.min,A=this.max;if(s<=S&&d<=S&&A<=f&&A<=y&&!_)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(s,d,f,y,this._queryCell,k,{},_),k},i.prototype._queryCell=function(s,d,f,y,_,S,A,k){var j=this.cells[_];if(j!==null)for(var R=this.keys,L=this.bboxes,H=0;H<j.length;H++){var W=j[H];if(A[W]===void 0){var J=4*W;(k?k(L[J+0],L[J+1],L[J+2],L[J+3]):s<=L[J+2]&&d<=L[J+3]&&f>=L[J+0]&&y>=L[J+1])?(A[W]=!0,S.push(R[W])):A[W]=!1}}},i.prototype._forEachCell=function(s,d,f,y,_,S,A,k){for(var j=this._convertToCellCoord(s),R=this._convertToCellCoord(d),L=this._convertToCellCoord(f),H=this._convertToCellCoord(y),W=j;W<=L;W++)for(var J=R;J<=H;J++){var Q=this.d*J+W;if((!k||k(this._convertFromCellCoord(W),this._convertFromCellCoord(J),this._convertFromCellCoord(W+1),this._convertFromCellCoord(J+1)))&&_.call(this,s,d,f,y,Q,S,A,k))return}},i.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},i.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,d=l+this.cells.length+1+1,f=0,y=0;y<this.cells.length;y++)f+=this.cells[y].length;var _=new Int32Array(d+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var S=d,A=0;A<s.length;A++){var k=s[A];_[l+A]=S,_.set(k,S),S+=k.length}return _[l+s.length]=S,_.set(this.keys,S),_[l+s.length+1]=S+=this.keys.length,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer},o0}(),Wc=Gl(a0);const op={};function Wt(l,i,s={}){Object.defineProperty(l,"_classRegistryKey",{value:i,writable:!1}),op[i]={klass:l,omit:s.omit||[]}}Wt(Object,"Object"),Wc.serialize=function(l,i){const s=l.toArrayBuffer();return i&&i.add(s),{buffer:s}},Wc.deserialize=function(l){return new Wc(l.buffer)},Object.defineProperty(Wc,"name",{value:"Grid"}),Wt(Wc,"Grid"),delete ut.prototype.constructor,typeof DOMMatrix<"u"&&Wt(DOMMatrix,"DOMMatrix"),Wt(Tn,"Color"),Wt(Error,"Error"),Wt(ca,"Formatted"),Wt(Km,"FormattedSection"),Wt(on,"AJAXError"),Wt(ka,"ResolvedImage"),Wt(Ku,"StylePropertyFunction"),Wt(r0,"StyleExpression",{omit:["_evaluator"]}),Wt(Ba,"ImageId"),Wt(Kl,"ImageVariant"),Wt(Hc,"ZoomDependentExpression"),Wt(wg,"ZoomConstantExpression"),Wt(So,"CompoundExpression",{omit:["_evaluate"]});for(const l in cd)op[cd[l]._classRegistryKey]||Wt(cd[l],`Expression${l}`);function Sg(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function ap(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Xl(l,i){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Sg(l)||ap(l))return i&&i.add(l),l;if(ArrayBuffer.isView(l))return i&&i.add(l.buffer),l;if(l instanceof ImageData)return i&&i.add(l.data.buffer),l;if(Array.isArray(l)){const s=[];for(const d of l)s.push(Xl(d,i));return s}if(l instanceof Map){const s={$name:"Map",entries:[]};for(const[d,f]of l.entries())s.entries.push(Xl(d),Xl(f,i));return s}if(l instanceof Set){const s={$name:"Set"};let d=0;for(const f of l.values())s[++d]=Xl(f);return s}if(l instanceof DOMMatrix){const s={$name:"DOMMatrix"},d=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const f of d)s[f]=l[f];return s}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const s=l.constructor,d=s._classRegistryKey;if(!d)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);const f=s.serialize?s.serialize(l,i):{};if(!s.serialize){for(const y in l)l.hasOwnProperty(y)&&(op[d].omit.indexOf(y)>=0||(f[y]=Xl(l[y],i)));l instanceof Error&&(f.message=l.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(f.$name=d),f}throw new Error("can't serialize object of type "+typeof l)}function Pa(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Sg(l)||ap(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Pa);if(typeof l=="object"){const i=l.$name||"Object";if(i==="Map"){const f=l.entries||[],y=new Map;for(let _=0;_<f.length;_+=2)y.set(Pa(f[_]),Pa(f[_+1]));return y}if(i==="Set"){const f=new Set;for(const y of Object.keys(l))y!=="$name"&&f.add(Pa(l[y]));return f}if(i==="DOMMatrix"){let f;return f=l.is2D?[l.a,l.b,l.c,l.d,l.e,l.f]:[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44],new DOMMatrix(f)}if(i==="BigInt")return BigInt(l.value);const{klass:s}=op[i];if(!s)throw new Error(`Can't deserialize unregistered class "${i}".`);if(s.deserialize)return s.deserialize(l);const d=Object.create(s.prototype);for(const f of Object.keys(l))f!=="$name"&&(d[f]=Pa(l[f]));return d}throw new Error("can't deserialize object of type "+typeof l)}const hr={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function s0(l){for(const i of l)if(Tg(i.charCodeAt(0)))return!0;return!1}function UC(l){for(const i of l)if(!VC(i.charCodeAt(0)))return!1;return!0}function VC(l){return!(hr.Arabic(l)||hr["Arabic Supplement"](l)||hr["Arabic Extended-A"](l)||hr["Arabic Presentation Forms-A"](l)||hr["Arabic Presentation Forms-B"](l))}function Tg(l){return!(l!==746&&l!==747&&(l<4352||!(hr["Bopomofo Extended"](l)||hr.Bopomofo(l)||hr["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||hr["CJK Compatibility Ideographs"](l)||hr["CJK Compatibility"](l)||hr["CJK Radicals Supplement"](l)||hr["CJK Strokes"](l)||!(!hr["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||hr["CJK Unified Ideographs Extension A"](l)||hr["CJK Unified Ideographs"](l)||hr["Enclosed CJK Letters and Months"](l)||hr["Hangul Compatibility Jamo"](l)||hr["Hangul Jamo Extended-A"](l)||hr["Hangul Jamo Extended-B"](l)||hr["Hangul Jamo"](l)||hr["Hangul Syllables"](l)||hr.Hiragana(l)||hr["Ideographic Description Characters"](l)||hr.Kanbun(l)||hr["Kangxi Radicals"](l)||hr["Katakana Phonetic Extensions"](l)||hr.Katakana(l)&&l!==12540||!(!hr["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!hr["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||hr["Unified Canadian Aboriginal Syllabics"](l)||hr["Unified Canadian Aboriginal Syllabics Extended"](l)||hr["Vertical Forms"](l)||hr["Yijing Hexagram Symbols"](l)||hr["Yi Syllables"](l)||hr["Yi Radicals"](l))))}function Eg(l){return!(Tg(l)||function(i){return!!(hr["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||hr["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||hr["Letterlike Symbols"](i)||hr["Number Forms"](i)||hr["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||hr["Control Pictures"](i)&&i!==9251||hr["Optical Character Recognition"](i)||hr["Enclosed Alphanumerics"](i)||hr["Geometric Shapes"](i)||hr["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||hr["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||hr["CJK Symbols and Punctuation"](i)||hr.Katakana(i)||hr["Private Use Area"](i)||hr["CJK Compatibility Forms"](i)||hr["Small Form Variants"](i)||hr["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(l))}function X1(l){return hr.Arabic(l)||hr["Arabic Supplement"](l)||hr["Arabic Extended-A"](l)||hr["Arabic Presentation Forms-A"](l)||hr["Arabic Presentation Forms-B"](l)}function Ag(l){return l>=1424&&l<=2303||hr["Arabic Presentation Forms-A"](l)||hr["Arabic Presentation Forms-B"](l)}function $C(l,i){return!(!i&&Ag(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||hr.Khmer(l))}function GC(l){for(const i of l)if(Ag(i.charCodeAt(0)))return!0;return!1}const Va={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let l0=null,ha=Va.unavailable,Zc=null;const Y1=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(ha=Va.error),l0&&l0(l)};function c0(){u0.fire(new Wl("pluginStateChange",{pluginStatus:ha,pluginURL:Zc}))}const u0=new Fu,h0=function(){return ha},J1=function(){if(ha!==Va.deferred||!Zc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ha=Va.loading,c0(),Zc&&Ff({url:Zc},l=>{l?Y1(l):(ha=Va.loaded,c0())})},_l={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ha===Va.loaded||_l.applyArabicShaping!=null,isLoading:()=>ha===Va.loading,setState(l){ha=l.pluginStatus,Zc=l.pluginURL},isParsing:()=>ha===Va.parsing,isParsed:()=>ha===Va.parsed,getPluginURL:()=>Zc};class On{constructor(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(s,d){for(const f of s)if(!$C(f.charCodeAt(0),d))return!1;return!0}(i,_l.isLoaded())}}class sp{constructor(i,s,d,f){this.property=i,this.value=s,this.expression=function(y,_,S,A){if(bg(y))return new Ku(y,_);if(n0(y)||Array.isArray(y)&&y.length>0){const k=i0(y,_,S,A);if(k.result==="error")throw new Error(k.value.map(j=>`${j.key}: ${j.message}`).join(", "));return k.value}{let k=y;return typeof y=="string"&&_.type==="color"&&(k=Tn.parse(y)),{kind:"constant",configDependencies:new Set,evaluate:()=>k}}}(s===void 0?i.specification.default:s,i.specification,d,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,s,d){return this.property.possiblyEvaluate(this,i,s,d)}}class kg{constructor(i,s,d){this.property=i,this.value=new sp(i,void 0,s,d)}transitioned(i,s){return new Q1(this.property,this.value,s,Qe({},i.transition,this.transition),i.now)}untransitioned(){return new Q1(this.property,this.value,null,{},0)}}class lp{constructor(i,s,d){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=s,this._options=d,this.configDependencies=new Set}getValue(i){return zr(this._values[i].value.value)}setValue(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new kg(this._values[i].property,this._scope,this._options)),this._values[i].value=new sp(this._values[i].property,s===null?void 0:zr(s),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,s){s&&(this._options=s);const d=this._properties.properties;if(i)for(const f in i){const y=i[f];if(f.endsWith("-transition")){const _=f.slice(0,-11);d[_]&&this.setTransition(_,y)}else d.hasOwnProperty(f)&&this.setValue(f,y)}}getTransition(i){return zr(this._values[i].transition)}setTransition(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new kg(this._values[i].property)),this._values[i].transition=zr(s)||void 0}serialize(){const i={};for(const s of Object.keys(this._values)){const d=this.getValue(s);d!==void 0&&(i[s]=d);const f=this.getTransition(s);f!==void 0&&(i[`${s}-transition`]=f)}return i}transitioned(i,s){const d=new eS(this._properties);for(const f of Object.keys(this._values))d._values[f]=this._values[f].transitioned(i,s._values[f]);return d}untransitioned(){const i=new eS(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].untransitioned();return i}}class Q1{constructor(i,s,d,f,y){const _=f.delay||0,S=f.duration||0;y=y||0,this.property=i,this.value=s,this.begin=y+_,this.end=this.begin+S,i.specification.transition&&(f.delay||f.duration)&&(this.prior=d)}possiblyEvaluate(i,s,d){const f=i.now||0,y=this.value.possiblyEvaluate(i,s,d),_=this.prior;if(_){if(f>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(f<this.begin)return _.possiblyEvaluate(i,s,d);{const S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(i,s,d),y,ce(S))}}return y}}class eS{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,s,d){const f=new rl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(i,s,d);return f}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Kc{constructor(i,s,d){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=s,this._options=d,this.configDependencies=new Set}getValue(i){return zr(this._values[i].value)}setValue(i,s){this._values[i]=new sp(this._values[i].property,s===null?void 0:zr(s),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const s of Object.keys(this._values)){const d=this.getValue(s);d!==void 0&&(i[s]=d)}return i}possiblyEvaluate(i,s,d){const f=new rl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(i,s,d);return f}}class Xu{constructor(i,s,d){this.property=i,this.value=s,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,s,d,f){return this.property.evaluate(this.value,this.parameters,i,s,d,f)}}class rl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class It{constructor(i){this.specification=i}possiblyEvaluate(i,s){return i.expression.evaluate(s)}interpolate(i,s,d){const f=Gf[this.specification.type];return f?f(i,s,d):i}}class $t{constructor(i,s){this.specification=i,this.overrides=s}possiblyEvaluate(i,s,d,f){return new Xu(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(s,null,{},d,f)}:i.expression,s)}interpolate(i,s,d){if(i.value.kind!=="constant"||s.value.kind!=="constant")return i;if(i.value.value===void 0||s.value.value===void 0)return new Xu(this,{kind:"constant",value:void 0},i.parameters);const f=Gf[this.specification.type];return f?new Xu(this,{kind:"constant",value:f(i.value.value,s.value.value,d)},i.parameters):i}evaluate(i,s,d,f,y,_){return i.kind==="constant"?i.value:i.evaluate(s,d,f,y,_)}}class ud{constructor(i){this.specification=i}possiblyEvaluate(i,s,d,f){return!!i.expression.evaluate(s,null,{},d,f)}interpolate(){return!1}}class wi{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new On(0,{});for(const d in i){const f=i[d];f.specification.overridable&&this.overridableProperties.push(d);const y=this.defaultPropertyValues[d]=new sp(f,void 0),_=this.defaultTransitionablePropertyValues[d]=new kg(f);this.defaultTransitioningPropertyValues[d]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=y.possiblyEvaluate(s)}}}Wt($t,"DataDrivenProperty"),Wt(It,"DataConstantProperty"),Wt(ud,"ColorRampProperty");var $e=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function tS(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function cp(l){if(Array.isArray(l))return l.map(cp);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const i={};for(const s in l)i[s]=cp(l[s]);return i}return tS(l)}function up(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const i of l.slice(1))if(!up(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function hd(l,i="",s=null,d="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};up(l)||(l=Pg(l));const f=l;let y=!0;try{y=function(j){if(!dd(j))return j;let R=cp(j);return Cg(R),R=d0(R),R}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let _=null,S=null;if(d!=="background"&&d!=="sky"&&d!=="slot"){S=$e[`filter_${d}`];const j=Zu(y,S,i,s);if(j.result==="error")throw new Error(j.value.map(R=>`${R.key}: ${R.message}`).join(", "));_=(R,L,H)=>j.value.evaluate(R,L,{},H)}let A=null,k=null;if(y!==f){const j=Zu(f,S,i,s);if(j.result==="error")throw new Error(j.value.map(R=>`${R.key}: ${R.message}`).join(", "));A=(R,L,H,W,J)=>j.value.evaluate(R,L,{},H,void 0,void 0,W,J),k=!nd(j.value.expression)}return{filter:_,dynamicFilter:A||void 0,needGeometry:f0(y),needFeature:!!k}}function d0(l){if(!Array.isArray(l))return l;const i=function(s){if(vl.has(s[0])){for(let d=1;d<s.length;d++)if(dd(s[d]))return!0}return s}(l);return i===!0?i:i.map(s=>d0(s))}function Cg(l){let i=!1;const s=[];if(l[0]==="case"){for(let d=1;d<l.length-1;d+=2)i=i||dd(l[d]),s.push(l[d+1]);s.push(l[l.length-1])}else if(l[0]==="match"){i=i||dd(l[1]);for(let d=2;d<l.length-1;d+=2)s.push(l[d+1]);s.push(l[l.length-1])}else if(l[0]==="step"){i=i||dd(l[1]);for(let d=1;d<l.length-1;d+=2)s.push(l[d+1])}i&&(l.length=0,l.push("any",...s));for(let d=1;d<l.length;d++)Cg(l[d])}function dd(l){if(!Array.isArray(l))return!1;if((i=l[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let s=1;s<l.length;s++)if(dd(l[s]))return!0;return!1}const vl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function qC(l,i){return l<i?-1:l>i?1:0}function f0(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let i=1;i<l.length;i++)if(f0(l[i]))return!0;return!1}function Pg(l){if(!l)return!0;const i=l[0];return l.length<=1?i!=="any":i==="=="?p0(l[1],l[2],"=="):i==="!="?Mg(p0(l[1],l[2],"==")):i==="<"||i===">"||i==="<="||i===">="?p0(l[1],l[2],i):i==="any"?(s=l.slice(1),["any"].concat(s.map(Pg))):i==="all"?["all"].concat(l.slice(1).map(Pg)):i==="none"?["all"].concat(l.slice(1).map(Pg).map(Mg)):i==="in"?rS(l[1],l.slice(2)):i==="!in"?Mg(rS(l[1],l.slice(2))):i==="has"?nS(l[1]):i!=="!has"||Mg(nS(l[1]));var s}function p0(l,i,s){switch(l){case"$type":return[`filter-type-${s}`,i];case"$id":return[`filter-id-${s}`,i];default:return[`filter-${s}`,l,i]}}function rS(l,i){if(i.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(s=>typeof s!=typeof i[0])?["filter-in-large",l,["literal",i.sort(qC)]]:["filter-in-small",l,["literal",i]]}}function nS(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Mg(l){return["!",l]}const hp="";function fd(l,i){return i?`${l}${hp}${i}`:l}const iS="-transition",HC=new Set(["fill","line","background","hillshade","raster"]);class Zo extends Fu{constructor(i,s,d,f,y){if(super(),this.id=i.id,this.fqid=fd(this.id,d),this.type=i.type,this.scope=d,this.lut=f,this.options=y,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const _=Zu(this.filter,$e[`filter_${i.type}`]);_.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,..._.value.configDependencies]))}if(i.slot&&(this.slot=i.slot),s.layout&&(this._unevaluatedLayout=new Kc(s.layout,this.scope,y),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint){this._transitionablePaint=new lp(s.paint,this.scope,y);for(const _ in i.paint)this.setPaintProperty(_,i.paint[_]);for(const _ in i.layout)this.setLayoutProperty(_,i.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rl(s.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&HC.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,s){if(this.type==="custom"&&i==="visibility")return void(this.visibility=s);const d=this._unevaluatedLayout;d._properties.properties[i]&&(d.setValue(i,s),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),i==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(iS)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,s){const d=this._transitionablePaint,f=d._properties.properties;if(i.endsWith(iS)){const R=i.slice(0,-11);return f[R]&&d.setTransition(R,s||void 0),!1}if(!f[i])return!1;const y=d._values[i],_=y.value.isDataDriven(),S=y.value;d.setValue(i,s),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const A=d._values[i].value,k=A.isDataDriven(),j=i.endsWith("pattern")||i==="line-dasharray";return k||_||j||this._handleOverridablePaintPropertyUpdate(i,S,A)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,s,d){return null}_handleOverridablePaintPropertyUpdate(i,s,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,s)}serialize(){return Gr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const s=this.paint.get(i);if(s instanceof Xu&&vg(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=hd(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,s,d,f,y,_,S,A,k){}}const WC={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dp{constructor(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ei{constructor(){this.capacity=-1,this.resize(0)}static serialize(i,s){return i._trim(),s&&s.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yr(l,i=1){let s=0,d=0;return{members:l.map(f=>{const y=WC[f.type].BYTES_PER_ELEMENT,_=s=m0(s,Math.max(i,y)),S=f.components||1;return d=Math.max(d,y),s+=y*S,{name:f.name,type:f.type,components:S,offset:_}}),size:m0(s,Math.max(d,i)),alignment:i}}function m0(l,i){return Math.ceil(l/i)*i}class Ma extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s){const d=this.length;return this.resize(d+1),this.emplace(d,i,s)}emplace(i,s,d){const f=2*i;return this.int16[f+0]=s,this.int16[f+1]=d,i}}Ma.prototype.bytesPerElement=4,Wt(Ma,"StructArrayLayout2i4");class pd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,s,d)}emplace(i,s,d,f){const y=3*i;return this.int16[y+0]=s,this.int16[y+1]=d,this.int16[y+2]=f,i}}pd.prototype.bytesPerElement=6,Wt(pd,"StructArrayLayout3i6");class md extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,i,s,d,f)}emplace(i,s,d,f,y){const _=4*i;return this.int16[_+0]=s,this.int16[_+1]=d,this.int16[_+2]=f,this.int16[_+3]=y,i}}md.prototype.bytesPerElement=8,Wt(md,"StructArrayLayout4i8");class Yu extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.float32[1*i+0]=s,i}}Yu.prototype.bytesPerElement=4,Wt(Yu,"StructArrayLayout1f4");class g0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,s,d)}emplace(i,s,d,f){const y=4*i,_=2*i;return this.int16[y+0]=s,this.int16[y+1]=d,this.float32[_+1]=f,i}}g0.prototype.bytesPerElement=8,Wt(g0,"StructArrayLayout2i1f8");class y0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,s,d)}emplace(i,s,d,f){const y=4*i;return this.int16[y+0]=s,this.int16[y+1]=d,this.int16[y+2]=f,i}}y0.prototype.bytesPerElement=8,Wt(y0,"StructArrayLayout3i8");class Ig extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,d,f,y)}emplace(i,s,d,f,y,_){const S=5*i;return this.int16[S+0]=s,this.int16[S+1]=d,this.int16[S+2]=f,this.int16[S+3]=y,this.int16[S+4]=_,i}}Ig.prototype.bytesPerElement=10,Wt(Ig,"StructArrayLayout5i10");class Og extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,s,d,f,y,_,S)}emplace(i,s,d,f,y,_,S,A){const k=6*i,j=12*i,R=3*i;return this.int16[k+0]=s,this.int16[k+1]=d,this.uint8[j+4]=f,this.uint8[j+5]=y,this.uint8[j+6]=_,this.uint8[j+7]=S,this.float32[R+2]=A,i}}Og.prototype.bytesPerElement=12,Wt(Og,"StructArrayLayout2i4ub1f12");class as extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,s,d)}emplace(i,s,d,f){const y=3*i;return this.float32[y+0]=s,this.float32[y+1]=d,this.float32[y+2]=f,i}}as.prototype.bytesPerElement=12,Wt(as,"StructArrayLayout3f12");class Xc extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,d,f,y)}emplace(i,s,d,f,y,_){const S=6*i,A=3*i;return this.uint16[S+0]=s,this.uint16[S+1]=d,this.uint16[S+2]=f,this.uint16[S+3]=y,this.float32[A+2]=_,i}}Xc.prototype.bytesPerElement=12,Wt(Xc,"StructArrayLayout4ui1f12");class gd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,i,s,d,f)}emplace(i,s,d,f,y){const _=4*i;return this.uint16[_+0]=s,this.uint16[_+1]=d,this.uint16[_+2]=f,this.uint16[_+3]=y,i}}gd.prototype.bytesPerElement=8,Wt(gd,"StructArrayLayout4ui8");class jg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,s,d,f,y,_)}emplace(i,s,d,f,y,_,S){const A=6*i;return this.int16[A+0]=s,this.int16[A+1]=d,this.int16[A+2]=f,this.int16[A+3]=y,this.int16[A+4]=_,this.int16[A+5]=S,i}}jg.prototype.bytesPerElement=12,Wt(jg,"StructArrayLayout6i12");class Rg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S,A,k,j,R,L){const H=this.length;return this.resize(H+1),this.emplace(H,i,s,d,f,y,_,S,A,k,j,R,L)}emplace(i,s,d,f,y,_,S,A,k,j,R,L,H){const W=12*i;return this.int16[W+0]=s,this.int16[W+1]=d,this.int16[W+2]=f,this.int16[W+3]=y,this.uint16[W+4]=_,this.uint16[W+5]=S,this.uint16[W+6]=A,this.uint16[W+7]=k,this.int16[W+8]=j,this.int16[W+9]=R,this.int16[W+10]=L,this.int16[W+11]=H,i}}Rg.prototype.bytesPerElement=24,Wt(Rg,"StructArrayLayout4i4ui4i24");class yd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,s,d,f,y,_)}emplace(i,s,d,f,y,_,S){const A=10*i,k=5*i;return this.int16[A+0]=s,this.int16[A+1]=d,this.int16[A+2]=f,this.float32[k+2]=y,this.float32[k+3]=_,this.float32[k+4]=S,i}}yd.prototype.bytesPerElement=20,Wt(yd,"StructArrayLayout3i3f20");class Yc extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,i,s,d,f)}emplace(i,s,d,f,y){const _=4*i;return this.float32[_+0]=s,this.float32[_+1]=d,this.float32[_+2]=f,this.float32[_+3]=y,i}}Yc.prototype.bytesPerElement=16,Wt(Yc,"StructArrayLayout4f16");class _0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint32[1*i+0]=s,i}}_0.prototype.bytesPerElement=4,Wt(_0,"StructArrayLayout1ul4");class xl extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s){const d=this.length;return this.resize(d+1),this.emplace(d,i,s)}emplace(i,s,d){const f=2*i;return this.uint16[f+0]=s,this.uint16[f+1]=d,i}}xl.prototype.bytesPerElement=4,Wt(xl,"StructArrayLayout2ui4");class v0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S,A,k,j,R,L,H){const W=this.length;return this.resize(W+1),this.emplace(W,i,s,d,f,y,_,S,A,k,j,R,L,H)}emplace(i,s,d,f,y,_,S,A,k,j,R,L,H,W){const J=20*i,Q=10*i;return this.int16[J+0]=s,this.int16[J+1]=d,this.int16[J+2]=f,this.int16[J+3]=y,this.int16[J+4]=_,this.float32[Q+3]=S,this.float32[Q+4]=A,this.float32[Q+5]=k,this.float32[Q+6]=j,this.int16[J+14]=R,this.uint32[Q+8]=L,this.uint16[J+18]=H,this.uint16[J+19]=W,i}}v0.prototype.bytesPerElement=40,Wt(v0,"StructArrayLayout5i4f1i1ul2ui40");class Dg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,s,d,f,y,_,S)}emplace(i,s,d,f,y,_,S,A){const k=8*i;return this.int16[k+0]=s,this.int16[k+1]=d,this.int16[k+2]=f,this.int16[k+4]=y,this.int16[k+5]=_,this.int16[k+6]=S,this.int16[k+7]=A,i}}Dg.prototype.bytesPerElement=16,Wt(Dg,"StructArrayLayout3i2i2i16");class _d extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,d,f,y)}emplace(i,s,d,f,y,_){const S=4*i,A=8*i;return this.float32[S+0]=s,this.float32[S+1]=d,this.float32[S+2]=f,this.int16[A+6]=y,this.int16[A+7]=_,i}}_d.prototype.bytesPerElement=16,Wt(_d,"StructArrayLayout2f1f2i16");class vd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,s,d,f,y,_)}emplace(i,s,d,f,y,_,S){const A=20*i,k=5*i;return this.uint8[A+0]=s,this.uint8[A+1]=d,this.float32[k+1]=f,this.float32[k+2]=y,this.float32[k+3]=_,this.float32[k+4]=S,i}}vd.prototype.bytesPerElement=20,Wt(vd,"StructArrayLayout2ub4f20");class ii extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d){const f=this.length;return this.resize(f+1),this.emplace(f,i,s,d)}emplace(i,s,d,f){const y=3*i;return this.uint16[y+0]=s,this.uint16[y+1]=d,this.uint16[y+2]=f,i}}ii.prototype.bytesPerElement=6,Wt(ii,"StructArrayLayout3ui6");class xd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q,ae,de,he,fe,Me){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q,ae,de,he,fe,Me)}emplace(i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q,ae,de,he,fe,Me,Ae){const ke=30*i,Le=15*i,Be=60*i;return this.int16[ke+0]=s,this.int16[ke+1]=d,this.int16[ke+2]=f,this.float32[Le+2]=y,this.float32[Le+3]=_,this.uint16[ke+8]=S,this.uint16[ke+9]=A,this.uint32[Le+5]=k,this.uint32[Le+6]=j,this.uint32[Le+7]=R,this.uint16[ke+16]=L,this.uint16[ke+17]=H,this.uint16[ke+18]=W,this.float32[Le+10]=J,this.float32[Le+11]=Q,this.uint8[Be+48]=ae,this.uint8[Be+49]=de,this.uint8[Be+50]=he,this.uint32[Le+13]=fe,this.int16[ke+28]=Me,this.uint8[Be+58]=Ae,i}}xd.prototype.bytesPerElement=60,Wt(xd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class x0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q,ae,de,he,fe,Me,Ae,ke,Le,Be,st,Ge,ft,wt,xt,At,kt,it){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q,ae,de,he,fe,Me,Ae,ke,Le,Be,st,Ge,ft,wt,xt,At,kt,it)}emplace(i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q,ae,de,he,fe,Me,Ae,ke,Le,Be,st,Ge,ft,wt,xt,At,kt,it,Tt){const Xe=20*i,at=40*i,Mt=80*i;return this.float32[Xe+0]=s,this.float32[Xe+1]=d,this.int16[at+4]=f,this.int16[at+5]=y,this.int16[at+6]=_,this.int16[at+7]=S,this.int16[at+8]=A,this.int16[at+9]=k,this.int16[at+10]=j,this.int16[at+11]=R,this.int16[at+12]=L,this.uint16[at+13]=H,this.uint16[at+14]=W,this.uint16[at+15]=J,this.uint16[at+16]=Q,this.uint16[at+17]=ae,this.uint16[at+18]=de,this.uint16[at+19]=he,this.uint16[at+20]=fe,this.uint16[at+21]=Me,this.uint16[at+22]=Ae,this.uint16[at+23]=ke,this.uint16[at+24]=Le,this.uint16[at+25]=Be,this.uint16[at+26]=st,this.uint16[at+27]=Ge,this.uint32[Xe+14]=ft,this.float32[Xe+15]=wt,this.float32[Xe+16]=xt,this.float32[Xe+17]=At,this.float32[Xe+18]=kt,this.uint8[Mt+76]=it,this.uint16[at+39]=Tt,i}}x0.prototype.bytesPerElement=80,Wt(x0,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class b0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_){const S=this.length;return this.resize(S+1),this.emplace(S,i,s,d,f,y,_)}emplace(i,s,d,f,y,_,S){const A=6*i;return this.float32[A+0]=s,this.float32[A+1]=d,this.float32[A+2]=f,this.float32[A+3]=y,this.float32[A+4]=_,this.float32[A+5]=S,i}}b0.prototype.bytesPerElement=24,Wt(b0,"StructArrayLayout6f24");class Ju extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,d,f,y)}emplace(i,s,d,f,y,_){const S=5*i;return this.float32[S+0]=s,this.float32[S+1]=d,this.float32[S+2]=f,this.float32[S+3]=y,this.float32[S+4]=_,i}}Ju.prototype.bytesPerElement=20,Wt(Ju,"StructArrayLayout5f20");class w0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,s,d,f,y,_,S)}emplace(i,s,d,f,y,_,S,A){const k=7*i;return this.float32[k+0]=s,this.float32[k+1]=d,this.float32[k+2]=f,this.float32[k+3]=y,this.float32[k+4]=_,this.float32[k+5]=S,this.float32[k+6]=A,i}}w0.prototype.bytesPerElement=28,Wt(w0,"StructArrayLayout7f28");class fp extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S,A,k,j,R){const L=this.length;return this.resize(L+1),this.emplace(L,i,s,d,f,y,_,S,A,k,j,R)}emplace(i,s,d,f,y,_,S,A,k,j,R,L){const H=11*i;return this.float32[H+0]=s,this.float32[H+1]=d,this.float32[H+2]=f,this.float32[H+3]=y,this.float32[H+4]=_,this.float32[H+5]=S,this.float32[H+6]=A,this.float32[H+7]=k,this.float32[H+8]=j,this.float32[H+9]=R,this.float32[H+10]=L,i}}fp.prototype.bytesPerElement=44,Wt(fp,"StructArrayLayout11f44");class S0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S,A,k){const j=this.length;return this.resize(j+1),this.emplace(j,i,s,d,f,y,_,S,A,k)}emplace(i,s,d,f,y,_,S,A,k,j){const R=9*i;return this.float32[R+0]=s,this.float32[R+1]=d,this.float32[R+2]=f,this.float32[R+3]=y,this.float32[R+4]=_,this.float32[R+5]=S,this.float32[R+6]=A,this.float32[R+7]=k,this.float32[R+8]=j,i}}S0.prototype.bytesPerElement=36,Wt(S0,"StructArrayLayout9f36");class Jc extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s){const d=this.length;return this.resize(d+1),this.emplace(d,i,s)}emplace(i,s,d){const f=2*i;return this.float32[f+0]=s,this.float32[f+1]=d,i}}Jc.prototype.bytesPerElement=8,Wt(Jc,"StructArrayLayout2f8");class T0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,i,s,d,f)}emplace(i,s,d,f,y){const _=6*i;return this.uint32[3*i+0]=s,this.uint16[_+2]=d,this.uint16[_+3]=f,this.uint16[_+4]=y,i}}T0.prototype.bytesPerElement=12,Wt(T0,"StructArrayLayout1ul3ui12");class E0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint16[1*i+0]=s,i}}E0.prototype.bytesPerElement=2,Wt(E0,"StructArrayLayout1ui2");class Lg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q){const ae=this.length;return this.resize(ae+1),this.emplace(ae,i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q)}emplace(i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q,ae){const de=16*i;return this.float32[de+0]=s,this.float32[de+1]=d,this.float32[de+2]=f,this.float32[de+3]=y,this.float32[de+4]=_,this.float32[de+5]=S,this.float32[de+6]=A,this.float32[de+7]=k,this.float32[de+8]=j,this.float32[de+9]=R,this.float32[de+10]=L,this.float32[de+11]=H,this.float32[de+12]=W,this.float32[de+13]=J,this.float32[de+14]=Q,this.float32[de+15]=ae,i}}Lg.prototype.bytesPerElement=64,Wt(Lg,"StructArrayLayout16f64");class bd extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,f,y,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,s,d,f,y,_,S)}emplace(i,s,d,f,y,_,S,A){const k=10*i,j=5*i;return this.uint16[k+0]=s,this.uint16[k+1]=d,this.uint16[k+2]=f,this.uint16[k+3]=y,this.float32[j+2]=_,this.float32[j+3]=S,this.float32[j+4]=A,i}}bd.prototype.bytesPerElement=20,Wt(bd,"StructArrayLayout4ui3f20");class A0 extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.int16[1*i+0]=s,i}}A0.prototype.bytesPerElement=2,Wt(A0,"StructArrayLayout1i2");class zg extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint8[1*i+0]=s,i}}zg.prototype.bytesPerElement=1,Wt(zg,"StructArrayLayout1ub1");class k0 extends dp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}k0.prototype.size=40;class oS extends v0{get(i){return new k0(this,i)}}Wt(oS,"CollisionBoxArray");class Ng extends dp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Ng.prototype.size=60;class pp extends xd{get(i){return new Ng(this,i)}}Wt(pp,"PlacedSymbolArray");class C0 extends dp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}C0.prototype.size=80;class aS extends x0{get(i){return new C0(this,i)}}Wt(aS,"SymbolInstanceArray");class P0 extends Yu{getoffsetX(i){return this.float32[1*i+0]}}Wt(P0,"GlyphOffsetArray");class sS extends Ma{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Wt(sS,"SymbolLineVertexArray");class Fg extends dp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Fg.prototype.size=12;class lS extends T0{get(i){return new Fg(this,i)}}Wt(lS,"FeatureIndexArray");class cS extends xl{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Wt(cS,"FillExtrusionCentroidArray");class uS extends dp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}uS.prototype.size=6;class hS extends pd{get(i){return new uS(this,i)}}Wt(hS,"FillExtrusionWallArray");const dS=Yr([{name:"a_pos",components:2,type:"Int16"}],4),ZC=Yr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),KC=Yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ui{constructor(i=[]){this.segments=i}_prepareSegment(i,s,d,f){let y=this.segments[this.segments.length-1];return i>ui.MAX_VERTEX_ARRAY_LENGTH&&Wr(`Max vertices per segment is ${ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!y||y.vertexLength+i>ui.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==f)&&(y={vertexOffset:s,primitiveOffset:d,vertexLength:0,primitiveLength:0},f!==void 0&&(y.sortKey=f),this.segments.push(y)),y}prepareSegment(i,s,d,f){return this._prepareSegment(i,s.length,d.length,f)}get(){return this.segments}destroy(){for(const i of this.segments)for(const s in i.vaos)i.vaos[s].destroy()}static simpleSegment(i,s,d,f){return new ui([{vertexOffset:i,primitiveOffset:s,vertexLength:d,primitiveLength:f,vaos:{},sortKey:0}])}}function fS(l,i){return 256*(l=xe(Math.floor(l),0,255))+xe(Math.floor(i),0,255)}ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wt(ui,"SegmentVector");const XC=Yr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),M0=Yr([{name:"a_pattern_b",components:4,type:"Uint16"}]),YC=Yr([{name:"a_dash",components:4,type:"Uint16"}]);class mp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,s,d,f){this.ids.push(gp(i)),this.positions.push(s,d,f)}eachPosition(i,s){const d=gp(i);let f=0,y=this.ids.length-1;for(;f<y;){const _=f+y>>1;this.ids[_]>=d?y=_:f=_+1}for(;this.ids[f]===d;)s(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(i,s){const d=new Float64Array(i.ids),f=new Uint32Array(i.positions);return I0(d,f,0,d.length-1),s&&(s.add(d.buffer),s.add(f.buffer)),{ids:d,positions:f}}static deserialize(i){const s=new mp;let d;s.ids=i.ids,s.positions=i.positions;for(const f of s.ids)f!==d&&s.uniqueIds.push(f),d=f;return s.indexed=!0,s}}function gp(l){const i=+l;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:Wh(String(l))}function I0(l,i,s,d){for(;s<d;){const f=l[s+d>>1];let y=s-1,_=d+1;for(;;){do y++;while(l[y]<f);do _--;while(l[_]>f);if(y>=_)break;Bg(l,y,_),Bg(i,3*y,3*_),Bg(i,3*y+1,3*_+1),Bg(i,3*y+2,3*_+2)}_-s<d-_?(I0(l,i,s,_),s=_+1):(I0(l,i,_+1,d),d=_)}}function Bg(l,i,s){const d=l[i];l[i]=l[s],l[s]=d}Wt(mp,"FeaturePositionMap");class Is{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,s),this.initialized=!0),!!this.location}set(i,s,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ug extends Is{constructor(i){super(i),this.current=0}set(i,s,d){this.fetchUniformLocation(i,s)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class Ii extends Is{constructor(i){super(i),this.current=0}set(i,s,d){this.fetchUniformLocation(i,s)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class bl extends Is{constructor(i){super(i),this.current=[0,0]}set(i,s,d){this.fetchUniformLocation(i,s)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class wd extends Is{constructor(i){super(i),this.current=[0,0,0]}set(i,s,d){this.fetchUniformLocation(i,s)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class yp extends Is{constructor(i){super(i),this.current=[0,0,0,0]}set(i,s,d){this.fetchUniformLocation(i,s)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class O0 extends Is{constructor(i){super(i),this.current=Tn.transparent.toPremultipliedRenderColor(null)}set(i,s,d){this.fetchUniformLocation(i,s)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const pS=new Float32Array(16);class _p extends Is{constructor(i){super(i),this.current=pS}set(i,s,d){if(this.fetchUniformLocation(i,s)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let f=1;f<16;f++)if(d[f]!==this.current[f]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const JC=new Float32Array(9),mS=new Float32Array(4);class j0 extends Is{constructor(i){super(i),this.current=mS}set(i,s,d){if(this.fetchUniformLocation(i,s)){for(let f=0;f<4;f++)if(d[f]!==this.current[f]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function R0(l){return[fS(255*l.r,255*l.g),fS(255*l.b,255*l.a)]}class vp{constructor(i,s,d,f){this.value=i,this.uniformNames=s.map(y=>`u_${y}`),this.type=d,this.context=f}setUniform(i,s,d,f,y){const _=f.constantOr(this.value);s.set(i,y,_ instanceof Tn?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(i,s){return this.type==="color"?new O0(i):new Ii(i)}}class Sd{constructor(i,s){this.uniformNames=s.map(d=>`u_${d}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,s){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(i,s,d,f,y){let _=null;y!=="u_pattern"&&y!=="u_dash"||(_=this.pattern),y==="u_pattern_b"&&(_=this.patternTransition),y==="u_pixel_ratio"&&(_=this.pixelRatio),_&&s.set(i,y,_)}getBinding(i,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new yp(i):new Ii(i)}}class Yl{constructor(i,s,d,f){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(i,s,d,f,y,_,S,A){const k=this.paintVertexArray.length,j=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new On(0,{brightness:_,worldview:A}),s,{},y,f,S):this.expression.kind==="constant"&&this.expression.value,R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new On(0,{brightness:_,worldview:A}),s,{},y,f,S):this.lutExpression.value)==="none";this.paintVertexArray.resize(i),this._setPaintValue(k,i,j,R?null:this.context.lut)}updatePaintArray(i,s,d,f,y,_,S,A){const k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:S,worldview:A},d,f,void 0,y):this.expression.kind==="constant"&&this.expression.value,j=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new On(0,{brightness:S,worldview:A}),d,f,void 0,y):this.lutExpression.value)==="none";this._setPaintValue(i,s,k,j?null:this.context.lut)}_setPaintValue(i,s,d,f){if(this.type==="color"){const y=R0(d.toPremultipliedRenderColor(f));for(let _=i;_<s;_++)this.paintVertexArray.emplace(_,y[0],y[1])}else{for(let y=i;y<s;y++)this.paintVertexArray.emplace(y,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Os{constructor(i,s,d,f,y,_){this.expression=i,this.uniformNames=s.map(S=>`u_${S}_t`),this.type=d,this.useIntegerZoom=f,this.context=y,this.maxValue=0,this.paintVertexAttributes=s.map(S=>({name:`a_${S}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(i,s,d,f,y,_,S,A){const k=this.expression.evaluate(new On(this.context.zoom,{brightness:_,worldview:A}),s,{},y,f,S),j=this.expression.evaluate(new On(this.context.zoom+1,{brightness:_,worldview:A}),s,{},y,f,S),R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new On(0,{brightness:_,worldview:A}),s,{},y,f,S):this.lutExpression.value)==="none",L=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(L,i,k,j,R?null:this.context.lut)}updatePaintArray(i,s,d,f,y,_,S,A){const k=this.expression.evaluate({zoom:this.context.zoom,brightness:S,worldview:A},d,f,void 0,y),j=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S,worldview:A},d,f,void 0,y),R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new On(0,{brightness:S,worldview:A}),d,f,void 0,y):this.lutExpression.value)==="none";this._setPaintValue(i,s,k,j,R?null:this.context.lut)}_setPaintValue(i,s,d,f,y){if(this.type==="color"){const _=R0(d.toPremultipliedRenderColor(y)),S=R0(d.toPremultipliedRenderColor(y));for(let A=i;A<s;A++)this.paintVertexArray.emplace(A,_[0],_[1],S[0],S[1])}else{for(let _=i;_<s;_++)this.paintVertexArray.emplace(_,d,f);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,s,d,f,y){const _=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,S=xe(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);s.set(i,y,S)}getBinding(i,s){return new Ii(i)}}class ss{constructor(i,s,d,f,y){this.expression=i,this.layerId=y,this.paintVertexAttributes=(d==="array"?YC:XC).members;for(let _=0;_<s.length;++_);this.paintVertexArray=new f,this.paintTransitionVertexArray=new gd}populatePaintArray(i,s,d,f){const y=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(y,i,s.patterns&&s.patterns[this.layerId],d)}updatePaintArray(i,s,d,f,y,_,S){this._setPaintValues(i,s,d.patterns&&d.patterns[this.layerId],_)}_setPaintValues(i,s,d,f){if(!f||!d)return;const y=f[d[0]],_=f[d[1]];if(y){if(y){const{tl:S,br:A,pixelRatio:k}=y;for(let j=i;j<s;j++)this.paintVertexArray.emplace(j,S[0],S[1],A[0],A[1],k)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:S,br:A}=_;for(let k=i;k<s;k++)this.paintTransitionVertexArray.emplace(k,S[0],S[1],A[0],A[1])}}}upload(i){const s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,M0.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class da{constructor(i,s,d=()=>!0){this.binders={},this._buffers=[],this.context=s;const f=[];for(const y in i.paint._values){const _=i.paint.get(y);if(y.endsWith("-use-theme")||!d(y)||!(_ instanceof Xu&&vg(_.property.specification)))continue;const S=eP(y,i.type),A=_.value,k=_.property.specification.type,j=!!_.property.useIntegerZoom,R=y==="line-dasharray"||y.endsWith("pattern"),L=i.paint.get(`${y}-use-theme`),H=y==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||L&&L.value.kind!=="constant";if(A.kind!=="constant"||H)if(A.kind==="source"||H||R){const W=gS(y,k,"source");this.binders[y]=R?new ss(A,S,k,W,i.id):new Yl(A,S,k,W),f.push(`/a_${y}`)}else{const W=gS(y,k,"composite");this.binders[y]=new Os(A,S,k,j,s,W),f.push(`/z_${y}`)}else this.binders[y]=R?new Sd(A.value,S):new vp(A.value,S,k,s),f.push(`/u_${y}`);L&&(this.binders[y].lutExpression=L.value)}this.cacheKey=f.sort().join("")}getMaxValue(i){const s=this.binders[i];return s instanceof Yl||s instanceof Os?s.maxValue:0}populatePaintArrays(i,s,d,f,y,_,S,A){for(const k in this.binders){const j=this.binders[k];j.context=this.context,(j instanceof Yl||j instanceof Os||j instanceof ss)&&j.populatePaintArray(i,s,d,f,y,_,S,A)}}setConstantPatternPositions(i,s){for(const d in this.binders){const f=this.binders[d];f instanceof Sd&&f.setConstantPatternPositions(i,s)}}getPatternTransitionVertexBuffer(i){const s=this.binders[i];return s instanceof ss?s.paintTransitionVertexBuffer:null}updatePaintArrays(i,s,d,f,y,_,S,A,k,j){let R=!1;const L=Object.keys(i),H=L.length!==0&&!A,W=H?L:s.uniqueIds;this.context.lut=y.lut;for(const J in this.binders){const Q=this.binders[J];if(Q.context=this.context,(Q instanceof Yl||Q instanceof Os||Q instanceof ss)&&Q.expression&&Q.expression.kind&&Q.expression.kind!=="constant"&&(Q.expression.isStateDependent===!0||Q.expression.isLightConstant===!1)){const ae=y.paint.get(J);Q.expression=ae.value;for(const de of W){const he=i[de.toString()];s.eachPosition(de,(fe,Me,Ae)=>{const ke=f.feature(fe);Q.updatePaintArray(Me,Ae,ke,he,_,S,k,j)})}if(!H)for(const de of d.uniqueIds){const he=i[de.toString()];d.eachPosition(de,(fe,Me,Ae)=>{const ke=f.feature(fe);Q.updatePaintArray(Me,Ae,ke,he,_,S,k,j)})}R=!0}}return R}defines(){const i=[];for(const s in this.binders){const d=this.binders[s];(d instanceof vp||d instanceof Sd)&&i.push(...d.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return i}getBinderAttributes(){const i=[];for(const s in this.binders){const d=this.binders[s];if(d instanceof Yl||d instanceof Os||d instanceof ss)for(let f=0;f<d.paintVertexAttributes.length;f++)i.push(d.paintVertexAttributes[f].name);if(d instanceof ss)for(let f=0;f<M0.members.length;f++)i.push(M0.members[f].name)}return i}getBinderUniforms(){const i=[];for(const s in this.binders){const d=this.binders[s];if(d instanceof vp||d instanceof Sd||d instanceof Os)for(const f of d.uniformNames)i.push(f)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const s=[];for(const d in this.binders){const f=this.binders[d];if(f instanceof vp||f instanceof Sd||f instanceof Os)for(const y of f.uniformNames)s.push({name:y,property:d,binding:f.getBinding(i,y)})}return s}setUniforms(i,s,d,f,y){for(const{name:_,property:S,binding:A}of d)this.binders[S].setUniform(i,A,y,f.get(S),_)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Yl||s instanceof Os||s instanceof ss)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof ss&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(i){for(const s in this.binders){const d=this.binders[s];(d instanceof Yl||d instanceof Os||d instanceof ss)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const s=this.binders[i];(s instanceof Yl||s instanceof Os||s instanceof ss)&&s.destroy()}}}class ls{constructor(i,s,d=()=>!0){this.programConfigurations={};for(const f of i)this.programConfigurations[f.id]=new da(f,s,d);this.needsUpload=!1,this._featureMap=new mp,this._featureMapWithoutIds=new mp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,s,d,f,y,_,S,A,k){for(const j in this.programConfigurations)this.programConfigurations[j].populatePaintArrays(i,s,f,y,_,S,A,k);s.id!==void 0?this._featureMap.add(s.id,d,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,s,d,f,y,_,S,A){for(const k of d)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,s,k,f,y,_,S||0,A)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const QC={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function eP(l,i){return QC[l]||[l.replace(`${i}-`,"").replace(/-/g,"_")]}const tP={"line-pattern":{source:Xc,composite:Xc},"fill-pattern":{source:Xc,composite:Xc},"fill-extrusion-pattern":{source:Xc,composite:Xc},"line-dasharray":{source:gd,composite:gd}},rP={color:{source:Jc,composite:Yc},number:{source:Yu,composite:Jc}};function gS(l,i,s){const d=tP[l];return d&&d[s]||rP[i][s]}Wt(vp,"ConstantBinder"),Wt(Sd,"PatternConstantBinder"),Wt(Yl,"SourceExpressionBinder"),Wt(ss,"PatternCompositeBinder"),Wt(Os,"CompositeExpressionBinder"),Wt(da,"ProgramConfiguration",{omit:["_buffers"]}),Wt(ls,"ProgramConfigurationSet");const Ko=Dt/Math.PI/2,m=5,a=6,u=16383,g=64,x=[g,32,16],b=-Ko,E=Ko;function P(l,i,s,d=Ko){return s=Br(s),[l*Math.sin(s)*d,-i*d,l*Math.cos(s)*d]}function I(l,i,s){return P(Math.cos(Br(l)),Math.sin(Br(l)),i,s)}const z=63710088e-1,F=2*Math.PI*z;class q{constructor(i,s){if(isNaN(i)||isNaN(s))throw new Error(`Invalid LngLat object: (${i}, ${s})`);if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new q(et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const s=Math.PI/180,d=this.lat*s,f=i.lat*s,y=Math.sin(d)*Math.sin(f)+Math.cos(d)*Math.cos(f)*Math.cos((i.lng-this.lng)*s);return z*Math.acos(Math.min(y,1))}toBounds(i=0){const s=360*i/40075017,d=s/Math.cos(Math.PI/180*this.lat);return new $({lng:this.lng-d,lat:this.lat-s},{lng:this.lng+d,lat:this.lat+s})}toEcef(i){return I(this.lat,this.lng,Ko+i*Ko/z)}static convert(i){if(i instanceof q)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new q(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new q(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ${constructor(i,s){if(i)if(s)this.setSouthWest(i).setNorthEast(s);else if(i.length===4){const d=i;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{const d=i;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(i){return this._ne=i instanceof q?new q(i.lng,i.lat):q.convert(i),this}setSouthWest(i){return this._sw=i instanceof q?new q(i.lng,i.lat):q.convert(i),this}extend(i){const s=this._sw,d=this._ne;let f,y;if(i instanceof q)f=i,y=i;else{if(!(i instanceof $))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend($.convert(i)):this.extend(q.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(q.convert(i)):this;if(f=i._sw,y=i._ne,!f||!y)return this}return s||d?(s.lng=Math.min(f.lng,s.lng),s.lat=Math.min(f.lat,s.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new q(f.lng,f.lat),this._ne=new q(y.lng,y.lat)),this}getCenter(){return new q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new q(this.getWest(),this.getNorth())}getSouthEast(){return new q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:s,lat:d}=q.convert(i);let f=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&f}static convert(i){if(i)return i instanceof $?i:new $(i)}}const K=0,te=25.5;function ee(l){return F*Math.cos(l*Math.PI/180)}function re(l){return(180+l)/360}function ie(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function ue(l,i){return l/ee(i)}function pe(l){return 360*l-180}function me(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Te(l,i){return l*ee(me(i))}const we=85.051129;function Pe(l){return Math.cos(Br(xe(l,-we,we)))}function be(l,i){const s=xe(i,K,te),d=Math.pow(2,s);return Pe(l)*F/(512*d)}function Se(l){return 1/Math.cos(l*Math.PI/180)}function Ee(l,i=0){const s=Math.exp(Math.PI*(1-(l.y+i/Dt)/(1<<l.z)*2));return 80150034*s/(s*s+1)/Dt/(1<<l.z)}class Ve{constructor(i,s,d=0){this.x=+i,this.y=+s,this.z=+d}static fromLngLat(i,s=0){const d=q.convert(i);return new Ve(re(d.lng),ie(d.lat),ue(s,d.lat))}toLngLat(){return new q(pe(this.x),me(this.y))}toAltitude(){return Te(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/F*Se(me(this.y))}}function De(l,i,s,d,f,y,_,S,A){const k=(i+d)/2,j=(s+f)/2,R=new ut(k,j);S(R),function(L,H,W,J,Q,ae){const de=W-Q,he=J-ae;return Math.abs((J-H)*de-(W-L)*he)/Math.hypot(de,he)}(R.x,R.y,y.x,y.y,_.x,_.y)>=A?(De(l,i,s,k,j,y,R,S,A),De(l,k,j,d,f,R,_,S,A)):l.push(_)}function dt(l,i,s){let d=l[0],f=d.x,y=d.y;i(d);const _=[d];for(let S=1;S<l.length;S++){const A=l[S],{x:k,y:j}=A;i(A),De(_,f,y,k,j,d,A,i,s),f=k,y=j,d=A}return _}function Je(l,i,s,d){if(d(i,s)){const f=i.add(s)._mult(.5);Je(l,i,f,d),Je(l,f,s,d)}else l.push(s)}function pt(l,i){let s=l[0];const d=[s];for(let f=1;f<l.length;f++){const y=l[f];Je(d,s,y,i),s=y}return d}const Ct=Math.pow(2,14)-1,We=-Ct-1;function Re(l,i){const s=Math.round(l.x*i),d=Math.round(l.y*i);return l.x=xe(s,We,Ct),l.y=xe(d,We,Ct),(s<l.x||s>l.x+1||d<l.y||d>l.y+1)&&Wr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function nt(l,i,s){const d=l.loadGeometry(),f=l.extent,y=Dt/f;if(i&&s&&s.projection.isReprojectedInTileSpace){const _=1<<i.z,{scale:S,x:A,y:k,projection:j}=s,R=L=>{const H=pe((i.x+L.x/f)/_),W=me((i.y+L.y/f)/_),J=j.project(H,W);L.x=(J.x*S-A)*f,L.y=(J.y*S-k)*f};for(let L=0;L<d.length;L++)if(l.type!==1)d[L]=dt(d[L],R,1);else{const H=[];for(const W of d[L])W.x<0||W.x>=f||W.y<0||W.y>=f||(R(W),H.push(W));d[L]=H}}for(const _ of d)for(const S of _)Re(S,y);return d}function Ze(l,i){return{type:l.type,id:l.id,properties:l.properties,geometry:i?nt(l):[]}}class yt{constructor(i,s,d,f,y){this.properties={},this.extent=d,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=f,this._values=y,i.readFields(bt,this,s)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const s=i.readVarint()+i.pos,d=[];let f,y=1,_=0,S=0,A=0;for(;i.pos<s;){if(_<=0){const k=i.readVarint();y=7&k,_=k>>3}if(_--,y===1||y===2)S+=i.readSVarint(),A+=i.readSVarint(),y===1&&(f&&d.push(f),f=[]),f&&f.push(new ut(S,A));else{if(y!==7)throw new Error(`unknown command ${y}`);f&&f.push(f[0].clone())}}return f&&d.push(f),d}bbox(){const i=this._pbf;i.pos=this._geometry;const s=i.readVarint()+i.pos;let d=1,f=0,y=0,_=0,S=1/0,A=-1/0,k=1/0,j=-1/0;for(;i.pos<s;){if(f<=0){const R=i.readVarint();d=7&R,f=R>>3}if(f--,d===1||d===2)y+=i.readSVarint(),_+=i.readSVarint(),y<S&&(S=y),y>A&&(A=y),_<k&&(k=_),_>j&&(j=_);else if(d!==7)throw new Error(`unknown command ${d}`)}return[S,k,A,j]}toGeoJSON(i,s,d){const f=this.extent*Math.pow(2,d),y=this.extent*i,_=this.extent*s,S=this.loadGeometry();function A(L){return[360*(L.x+y)/f-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+_)/f)*Math.PI))-90]}function k(L){return L.map(A)}let j;if(this.type===1){const L=[];for(const W of S)L.push(W[0]);const H=k(L);j=L.length===1?{type:"Point",coordinates:H[0]}:{type:"MultiPoint",coordinates:H}}else if(this.type===2){const L=S.map(k);j=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=function(W){const J=W.length;if(J<=1)return[W];const Q=[];let ae,de;for(let he=0;he<J;he++){const fe=Et(W[he]);fe!==0&&(de===void 0&&(de=fe<0),de===fe<0?(ae&&Q.push(ae),ae=[W[he]]):ae&&ae.push(W[he]))}return ae&&Q.push(ae),Q}(S),H=[];for(const W of L)H.push(W.map(k));j=H.length===1?{type:"Polygon",coordinates:H[0]}:{type:"MultiPolygon",coordinates:H}}}const R={type:"Feature",geometry:j,properties:this.properties};return this.id!=null&&(R.id=this.id),R}}function bt(l,i,s){l===1?i.id=s.readVarint():l===2?function(d,f){const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=f._keys[d.readVarint()],S=f._values[d.readVarint()];f.properties[_]=S}}(s,i):l===3?i.type=s.readVarint():l===4&&(i._geometry=s.pos)}function Et(l){let i=0;for(let s,d,f=0,y=l.length,_=y-1;f<y;_=f++)s=l[f],d=l[_],i+=(d.x-s.x)*(s.y+d.y);return i}yt.types=["Unknown","Point","LineString","Polygon"];class jt{constructor(i,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(tr,this,s),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const s=this._pbf.readVarint()+this._pbf.pos;return new yt(this._pbf,s,this.extent,this._keys,this._values)}}function tr(l,i,s){l===15?i.version=s.readVarint():l===1?i.name=s.readString():l===5?i.extent=s.readVarint():l===2?i._features.push(s.pos):l===3?i._keys.push(s.readString()):l===4&&i._values.push(function(d){let f=null;const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=d.readVarint()>>3;f=_===1?d.readString():_===2?d.readFloat():_===3?d.readDouble():_===4?d.readVarint64():_===5?d.readVarint():_===6?d.readSVarint():_===7?d.readBoolean():null}if(f==null)throw new Error("unknown feature value");return f}(s))}class ir{constructor(i,s){this.layers=i.readFields(Zt,{},s)}}function Zt(l,i,s){if(l===3){const d=new jt(s,s.readVarint()+s.pos);d.length&&(i[d.name]=d)}}const er="3d_elevation_id",nr="level";class wr{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,s){return this._valid&&i(s(this._geometry)),this}require(i,s,d){return this.get(i,!0,s,d)}optional(i,s,d){return this.get(i,!1,s,d)}success(){return this._valid}get(i,s,d,f){const y=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&y!==void 0&&!Number.isNaN(y)?d(f?f(y):y):s&&(this._valid=!1),this}}class Cr{constructor(i,s){this.featureFunc=i,this.vertexFunc=s}parseFeature(i,s,d){return this.featureFunc(i,s,d)}parseVertex(i,s,d){return this.vertexFunc(i,s,d)}}const Nr=new Cr((l,i,s)=>l.reset(i).require(er,d=>{s.id=d}).optional("fixed_height_relative",d=>{s.constantHeight=d},vr.decodeRelativeHeight).geometry(d=>{s.bounds=d},Pv).success(),(l,i,s)=>l.reset(i).require(er,d=>{s.id=d}).require("elevation_idx",d=>{s.idx=d}).require("extent",d=>{s.extent=d}).require("height_relative",d=>{s.height=d},vr.decodeRelativeHeight).geometry(d=>{s.position=d},vr.getPoint).success()),Cn=new Cr((l,i,s)=>l.reset(i).require(er,d=>{s.id=d}).optional("fixed_height",d=>{s.constantHeight=d},vr.decodeMetricHeight).geometry(d=>{s.bounds=d},Pv).success(),(l,i,s)=>l.reset(i).require(er,d=>{s.id=d}).require("elevation_idx",d=>{s.idx=d}).require("extent",d=>{s.extent=d}).require("height",d=>{s.height=d},vr.decodeMetricHeight).geometry(d=>{s.position=d},vr.getPoint).success());class vr{static getPoint(i){return sa(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static parse(i){const s=[],d=[],f=i.length,y=new wr;for(let S=0;S<f;S++){const A=i.feature(S),k=A.properties.version,j=(_=k)?_==="1.0.1"?Cn:void 0:Nr;if(j===void 0){Wr(`Unknown elevation feature version number ${k||"(unknown)"}`);continue}const R=A.properties.hasOwnProperty("type")?A.properties.type:void 0;if(R){if(yt.types[A.type]==="Point"&&R==="curve_point"){const L={};j.parseVertex(y,A,L)&&s.push(L)}else if(yt.types[A.type]==="Polygon"&&R==="curve_meta"){const L={};j.parseFeature(y,A,L)&&d.push(L)}}}var _;return{vertices:s,features:d}}}class un{constructor(i,s){this.pos=i,this.dir=s}intersectsPlane(i,s,d){const f=Yn(s,this.dir);if(Math.abs(f)<1e-6)return!1;const y=((i[0]-this.pos[0])*s[0]+(i[1]-this.pos[1])*s[1])/f;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,!0}}class hn{constructor(i,s){this.pos=i,this.dir=s}intersectsPlane(i,s,d){const f=Ft(s,this.dir);if(Math.abs(f)<1e-6)return!1;const y=((i[0]-this.pos[0])*s[0]+(i[1]-this.pos[1])*s[1]+(i[2]-this.pos[2])*s[2])/f;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,d[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(i,s,d){if(function(H,W){var J=H[0],Q=H[1],ae=H[2],de=W[0],he=W[1],fe=W[2];return Math.abs(J-de)<=v*Math.max(1,Math.abs(J),Math.abs(de))&&Math.abs(Q-he)<=v*Math.max(1,Math.abs(Q),Math.abs(he))&&Math.abs(ae-fe)<=v*Math.max(1,Math.abs(ae),Math.abs(fe))}(this.pos,i)||s===0)return d[0]=d[1]=d[2]=0,!1;const[f,y,_]=this.dir,S=this.pos[0]-i[0],A=this.pos[1]-i[1],k=this.pos[2]-i[2],j=f*f+y*y+_*_,R=2*(S*f+A*y+k*_),L=R*R-4*j*(S*S+A*A+k*k-s*s);if(L<0){const H=Math.max(-R/2,0),W=S+f*H,J=A+y*H,Q=k+_*H,ae=Math.hypot(W,J,Q);return d[0]=W*s/ae,d[1]=J*s/ae,d[2]=Q*s/ae,!1}{const H=(-R-Math.sqrt(L))/(2*j);if(H<0){const W=Math.hypot(S,A,k);return d[0]=S*s/W,d[1]=A*s/W,d[2]=k*s/W,!1}return d[0]=S+f*H,d[1]=A+y*H,d[2]=k+_*H,!0}}}class Zn{constructor(i,s,d,f,y){this.TL=i,this.TR=s,this.BR=d,this.BL=f,this.horizon=y}static fromInvProjectionMatrix(i,s,d){const f=[-1,1,1],y=[1,1,1],_=[1,-1,1],S=[-1,-1,1],A=Qt(f,f,i),k=Qt(y,y,i),j=Qt(_,_,i),R=Qt(S,S,i);return new Zn(A,k,j,R,s/d)}}function Mr(l,i,s){let d=1/0,f=-1/0;const y=[];for(const _ of l){Kr(y,_,i);const S=Ft(y,s);d=Math.min(d,S),f=Math.max(f,S)}return[d,f]}function an(l,i){let s=!0;for(let d=0;d<l.planes.length;d++){const f=l.planes[d];let y=0;for(let _=0;_<i.length;_++)y+=Ft(f,i[_])+f[3]>=0;if(y===0)return 0;y!==i.length&&(s=!1)}return s?2:1}function cn(l,i){for(const s of l.projections){const d=Mr(i,l.points[0],s.axis);if(s.projection[1]<d[0]||s.projection[0]>d[1])return 0}return 1}function vn(l,i){let s=0;const d=[0,0,0,0];for(let _=0;_<l.length;_++)d[0]=l[_][0],d[1]=l[_][1],d[2]=l[_][2],d[3]=1,(f=d)[0]*(y=i)[0]+f[1]*y[1]+f[2]*y[2]+f[3]*y[3]>=0&&s++;var f,y;return s}class hi{constructor(i,s){this.points=i||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=kr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Kr([],this.points[2],this.points[3]),Kr([],this.points[0],this.points[3]),Kr([],this.points[4],this.points[0]),Kr([],this.points[5],this.points[1]),Kr([],this.points[6],this.points[2]),Kr([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const f=[0,-d[2],d[1]],y=[d[2],0,-d[0]];this.projections.push({axis:f,projection:Mr(this.points,this.points[0],f)}),this.projections.push({axis:y,projection:Mr(this.points,this.points[0],y)})}}static fromInvProjectionMatrix(i,s,d,f){const y=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const j=Bi([],k,i),R=1/j[3]/s*y;return(L=j)[0]=(H=j)[0]*(W=[R,R,f?1/j[3]:R,R])[0],L[1]=H[1]*W[1],L[2]=H[2]*W[2],L[3]=H[3]*W[3],L;var L,H,W}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const j=Er([],br([],Kr([],_[k[0]],_[k[1]]),Kr([],_[k[2]],_[k[1]]))),R=-Ft(j,_[k[1]]);return j.concat(R)}),A=[];for(let k=0;k<_.length;k++)A.push([_[k][0],_[k][1],_[k][2]]);return new hi(A,S)}intersectsPrecise(i,s,d){for(let f=0;f<s.length;f++)if(!vn(i,s[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!vn(i,this.planes[f]))return 0;for(const f of d)for(const y of this.frustumEdges){const _=br([],f,y),S=Ye(_);if(S===0)continue;mt(_,_,1/S);const A=Mr(this.points,this.points[0],_),k=Mr(i,this.points[0],_);if(A[0]>k[1]||k[0]>A[1])return 0}return 1}containsPoint(i){for(const s of this.planes){const d=s[3];if(Ft([s[0],s[1],s[2]],i)+d<0)return!1}return!0}}class kr{static fromPoints(i){const s=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const f of i)ht(s,s,f),vt(d,d,f);return new kr(s,d)}static fromTileIdAndHeight(i,s,d){const f=1<<i.canonical.z,y=i.canonical.x,_=i.canonical.y;return new kr([y/f,_/f,s],[(y+1)/f,(_+1)/f,d])}static applyTransform(i,s){const d=i.getCorners();for(let f=0;f<d.length;++f)Qt(d[f],d[f],s);return kr.fromPoints(d)}static applyTransformFast(i,s){const d=[s[12],s[13],s[14]],f=[...d];for(let y=0;y<3;y++)for(let _=0;_<3;_++){const S=s[4*_+y],A=S*i.min[_],k=S*i.max[_];d[y]+=Math.min(A,k),f[y]+=Math.max(A,k)}return new kr(d,f)}static projectAabbCorners(i,s){const d=i.getCorners();for(let f=0;f<d.length;++f)Qt(d[f],d[f],s);return d}constructor(i,s){this.min=i,this.max=s,this.center=mt([],He([],this.min,this.max),.5)}quadrant(i){const s=[i%2==0,i<2],d=Ke(this.min),f=Ke(this.max);for(let y=0;y<s.length;y++)d[y]=s[y]?this.min[y]:this.center[y],f[y]=s[y]?this.center[y]:this.max[y];return f[2]=this.max[2],new kr(d,f)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,s=this.max;return[[i[0],i[1],i[2]],[s[0],i[1],i[2]],[s[0],s[1],i[2]],[i[0],s[1],i[2]],[i[0],i[1],s[2]],[s[0],i[1],s[2]],[s[0],s[1],s[2]],[i[0],s[1],s[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?an(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?an(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,s){return s||this.intersects(i)?cn(i,this.getCorners()):0}intersectsPreciseFlat(i,s){return s||this.intersectsFlat(i)?cn(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let s=0;s<3;++s)if(this.min[s]>i.max[s]||i.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],i.min[s]),this.max[s]=Math.max(this.max[s],i.max[s])}encapsulatePoint(i){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],i[s]),this.max[s]=Math.max(this.max[s],i[s])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}Wt(kr,"Aabb");class mn{constructor(i,s){this.feature=i,this.metersToTile=s,this.index=0}get(){const i=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,d=s[1],f=-s[0],y=(i.extent+1)*this.metersToTile;return[new ut(Math.trunc(i.position[0]+d*y),Math.trunc(i.position[1]+f*y)),new ut(Math.trunc(i.position[0]-d*y),Math.trunc(i.position[1]-f*y))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class mi{constructor(i,s,d,f,y,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=i,this.heightRange={min:d,max:d},this.safeArea=s,this.constantHeight=d,this.constantHeight==null&&(this.constantHeight!=null||f.length!==0)){this.vertices=f,this.edges=y,this.edges=this.edges.filter(S=>{return S.a<this.vertices.length&&S.b<this.vertices.length&&!((A=this.vertices[S.a].position)[0]===(k=this.vertices[S.b].position)[0]&&A[1]===k[1]);var A,k}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const S of this.vertices)this.vertexProps.push({dir:sa(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,S.height),this.heightRange.max=Math.max(this.heightRange.max,S.height);for(const S of this.edges){const A=this.vertices[S.a].position,k=this.vertices[S.b].position,j=la(Po(),k,A),R=Sa(j),L=Js(Po(),j,1/R);this.edgeProps.push({vec:j,dir:L,len:R});const H=this.vertexProps[S.a].dir,W=this.vertexProps[S.b].dir;Ts(H,H,L),Ts(W,W,L)}for(const S of this.vertexProps)S.dir[0]===0&&S.dir[1]===0||Cc(S.dir,S.dir);this.tessellate(_)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const s=this.getClosestEdge(i);if(s==null)return 0;const[d,f]=s;return lr(this.vertices[this.edges[d].a].height,this.vertices[this.edges[d].b].height,f)}computeSlopeNormal(i,s){const d=this.getClosestEdge(i);if(!d)return Oe(0,0,1);const f=d[0],y=this.edges[f],_=this.edgeProps[f].vec,S=Oe(_[0],_[1],(this.vertices[y.b].height-this.vertices[y.a].height)*s),A=Oe(S[1],-S[0],0);br(A,A,S);const k=Ye(A);return k>0?mt(A,A,1/k):Oe(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let s=0,d=Number.POSITIVE_INFINITY,f=0;const y=sa(i.x,i.y);for(let _=0;_<this.edges.length;_++){const S=this.edges[_],A=this.edgeProps[_].dir,k=new un(y,this.edgeProps[_].dir),j=this.vertices[S.a].position,R=this.vertices[S.b].position,L=Po(),H=Po(),W=k.intersectsPlane(j,this.vertexProps[S.a].dir,L),J=k.intersectsPlane(R,this.vertexProps[S.b].dir,H);if(!W||!J)continue;const Q=la(Po(),H,L),ae=la(Po(),y,L),de=Yn(Q,Q),he=de>0?Yn(ae,Q)/de:0,fe=xe(he,0,1),Me=Math.abs((he-fe)*this.edgeProps[_].len),Ae=la(Po(),y,j),ke=Me+Math.abs(Yn(Ae,sa(A[1],-A[0])));ke<d&&(s=_,d=ke,f=fe)}return[s,f]}tessellate(i){for(let s=this.edges.length-1;s>=0;--s){const d=this.edges[s].a,f=this.edges[s].b,{position:y,height:_,extent:S}=this.vertices[d],{position:A,height:k,extent:j}=this.vertices[f],R=this.vertexProps[d].dir,L=this.vertexProps[f].dir,H=Oe(y[0]/i,y[1]/i,_),W=Oe(A[0]/i,A[1]/i,k),J=Oe(R[1],-R[0],0);mt(J,J,S);const Q=Oe(L[1],-L[0],0);if(mt(Q,Q,j),this.distSqLines(Oe(H[0]+.5*J[0],H[1]+.5*J[1],H[2]+.5*J[2]),Oe(W[0]-.5*Q[0],W[1]-.5*Q[1],W[2]-.5*Q[2]),Oe(H[0]-.5*J[0],H[1]-.5*J[1],H[2]-.5*J[2]),Oe(W[0]+.5*Q[0],W[1]+.5*Q[1],W[2]+.5*Q[2]))<=.0025000000000000005)continue;const ae=this.vertices.length,de=Ts(Po(),y,A);this.vertices.push({position:Js(de,de,.5),height:.5*(_+k),extent:.5*(S+j)});const he=Ts(Po(),R,L);this.vertexProps.push({dir:Cc(he,he)}),this.edges.splice(s,1),this.edgeProps.splice(s,1),this.edges.push({a:d,b:ae}),this.edges.push({a:ae,b:f});const fe=la(Po(),this.vertices[ae].position,y),Me=Sa(fe),Ae={vec:fe,dir:Js(Po(),fe,1/Me),len:Me};this.edgeProps.push(Ae),this.edgeProps.push(Ae)}}distSqLines(i,s,d,f){const y=lt(Ce(),s,i),_=lt(Ce(),f,d),S=lt(Ce(),i,d),A=Ft(y,y),k=Ft(y,_),j=Ft(y,S),R=Ft(_,_),L=Ft(_,S),H=A*R-k*k;if(H===0){const Q=Ft(S,_)/Ft(_,_);return Vt(Yt(Ce(),d,f,Q),i)}const W=(k*L-j*R)/H,J=(A*L-k*j)/H;return Vt(Yt(Ce(),i,s,W),Yt(Ce(),d,f,J))}}class rn{static parseFrom(i,s){const d=vr.parse(i);if(!d)return[];let{vertices:f,features:y}=d;const _=1/Ee(s);y.sort((j,R)=>j.id-R.id),f.sort((j,R)=>j.id-R.id||j.idx-R.idx),f=f.filter((j,R,L)=>R===L.findIndex(H=>H.id===j.id&&H.idx===j.idx));const S=new Array;let A=0;const k=f.length;for(const j of y){if(j.constantHeight){S.push(new mi(j.id,j.bounds,j.constantHeight));continue}for(;A!==k&&f[A].id<j.id;)A++;if(A===k||f[A].id!==j.id)continue;const R=new Array,L=new Array,H=A;for(;A!==k&&f[A].id===j.id;){const W=f[A];if(R.push({position:W.position,height:W.height,extent:W.extent}),A!==H&&f[A-1].idx===W.idx-1){const J=A-H;L.push({a:J-1,b:J})}A++}S.push(new mi(j.id,j.bounds,void 0,R,L,_))}return S}static getElevationFeature(i,s){if(!s)return;const d=+i.properties[er];return Number.isNaN(d)?void 0:s.find(f=>f.id===d)}}class xn{constructor(i,s){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(s)||(this.zScale=Math.pow(2,s.z-i.z),this.xOffset=(i.x*this.zScale-s.x)*Dt,this.yOffset=(i.y*this.zScale-s.y)*Dt)}constantElevation(i,s){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,s)}pointElevation(i,s,d){return this.constantElevation(s,d)??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(i),d))}computeBiasedHeight(i,s){return s<=0?i:i+s*Fe(0,s,i>=0?i:Math.abs(.5*i))}}Wt(mi,"ElevationFeature");class Ln{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Ma,this.indexArray=new ii,this.segments=new ui,this.programConfigurations=new ls(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Yu),this.worldview=i.worldview}updateFootprints(i,s){}populate(i,s,d,f){const y=this.layers[0],_=[];let S=null;y.type==="circle"&&(S=y.layout.get("circle-sort-key"));for(const{feature:k,id:j,index:R,sourceLayerIndex:L}of i){const H=this.layers[0]._featureFilter.needGeometry,W=Ze(k,H);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),W,d))continue;const J=S?S.evaluate(W,{},d):void 0,Q={id:j,properties:k.properties,type:k.type,sourceLayerIndex:L,index:R,geometry:H?W.geometry:nt(k,d,f),patterns:{},sortKey:J};_.push(Q)}S&&_.sort((k,j)=>k.sortKey-j.sortKey);let A=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new jg,A=f.projection);for(const k of _){const{geometry:j,index:R,sourceLayerIndex:L}=k,H=i[R].feature;this.addFeature(k,j,R,s.availableImages,d,A,s.brightness,s.elevationFeatures),s.featureIndex.insert(H,j,R,L,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,s,d,f,y,_,S){this.programConfigurations.updatePaintArrays(i,s,y,d,f,_,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,dS.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,KC.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,ZC.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,s,d,f,y,_,S,A){let k;this.elevationMode!=="none"&&(k=rn.getElevationFeature(i,A));for(const j of s)for(const R of j){const L=R.x,H=R.y;if(L<0||L>=Dt||H<0||H>=Dt)continue;if(_){const Q=_.projectTilePoint(L,H,y),ae=_.upVector(y,L,H);this.addGlobeExtVertex(Q,ae),this.addGlobeExtVertex(Q,ae),this.addGlobeExtVertex(Q,ae),this.addGlobeExtVertex(Q,ae)}const W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),J=W.vertexLength;if(this.addCircleVertex(L,H,-1,-1),this.addCircleVertex(L,H,1,-1),this.addCircleVertex(L,H,1,1),this.addCircleVertex(L,H,-1,1),this.elevationMode!=="none"){const Q=k?k.pointElevation(new ut(L,H)):0;this.hasElevation=this.hasElevation||Q!==0;for(let ae=0;ae<4;ae++)this.elevatedLayoutVertexArray.emplaceBack(Q)}this.indexArray.emplaceBack(J,J+1,J+2),this.indexArray.emplaceBack(J,J+2,J+3),W.vertexLength+=4,W.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{},f,y,S,void 0,this.worldview)}addCircleVertex(i,s,d,f){this.layoutVertexArray.emplaceBack(2*i+(d+1)/2,2*s+(f+1)/2)}addGlobeExtVertex(i,s){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function Ei(l,i){for(let s=0;s<l.length;s++)if(oi(i,l[s]))return!0;for(let s=0;s<i.length;s++)if(oi(l,i[s]))return!0;return!!cs(l,i)}function Oi(l,i,s){return!!oi(l,i)||!!Ga(i,l,s)}function ji(l,i){if(l.length===1)return Rs(i,l[0]);for(let s=0;s<i.length;s++){const d=i[s];for(let f=0;f<d.length;f++)if(oi(l,d[f]))return!0}for(let s=0;s<l.length;s++)if(Rs(i,l[s]))return!0;for(let s=0;s<i.length;s++)if(cs(l,i[s]))return!0;return!1}function Do(l,i,s){if(l.length>1){if(cs(l,i))return!0;for(let d=0;d<i.length;d++)if(Ga(i[d],l,s))return!0}for(let d=0;d<l.length;d++)if(Ga(l[d],i,s))return!0;return!1}function cs(l,i){if(l.length===0||i.length===0)return!1;for(let s=0;s<l.length-1;s++){const d=l[s],f=l[s+1];for(let y=0;y<i.length-1;y++)if($a(d,f,i[y],i[y+1]))return!0}return!1}function $a(l,i,s,d){return Ti(l,s,d)!==Ti(i,s,d)&&Ti(l,i,s)!==Ti(l,i,d)}function fa(l,i,s){return(l.x-s.x)*(i.y-s.y)-(l.y-s.y)*(i.x-s.x)}function pa(l,i,s,d){const f=fa(l,i,d),y=fa(l,i,s);if(Math.sign(f)===Math.sign(y))return;const _=fa(s,d,l),S=_+y-f;return Math.sign(_)!==Math.sign(S)?[_/(_-S),y/(y-f)]:void 0}function Ga(l,i,s){const d=s*s;if(i.length===1)return l.distSqr(i[0])<d;for(let f=1;f<i.length;f++)if(js(l,i[f-1],i[f])<d)return!0;return!1}function js(l,i,s){const d=i.distSqr(s);if(d===0)return l.distSqr(i);const f=((l.x-i.x)*(s.x-i.x)+(l.y-i.y)*(s.y-i.y))/d;return l.distSqr(f<0?i:f>1?s:s.sub(i)._mult(f)._add(i))}function Rs(l,i){let s,d,f,y=!1;for(let _=0;_<l.length;_++){s=l[_];for(let S=0,A=s.length-1;S<s.length;A=S++)d=s[S],f=s[A],d.y>i.y!=f.y>i.y&&i.x<(f.x-d.x)*(i.y-d.y)/(f.y-d.y)+d.x&&(y=!y)}return y}function oi(l,i){let s=!1;for(let d=0,f=l.length-1;d<l.length;f=d++){const y=l[d],_=l[f];y.y>i.y!=_.y>i.y&&i.x<(_.x-y.x)*(i.y-y.y)/(_.y-y.y)+y.x&&(s=!s)}return s}function Ri(l,i,s,d,f){for(const _ of l)if(i<=_.x&&s<=_.y&&d>=_.x&&f>=_.y)return!0;const y=[new ut(i,s),new ut(i,f),new ut(d,f),new ut(d,s)];if(l.length>2){for(const _ of y)if(oi(l,_))return!0}for(let _=0;_<l.length-1;_++)if(Vn(l[_],l[_+1],y))return!0;return!1}function Vn(l,i,s){const d=s[0],f=s[2];if(l.x<d.x&&i.x<d.x||l.x>f.x&&i.x>f.x||l.y<d.y&&i.y<d.y||l.y>f.y&&i.y>f.y)return!1;const y=Ti(l,i,s[0]);return y!==Ti(l,i,s[1])||y!==Ti(l,i,s[2])||y!==Ti(l,i,s[3])}function Di(l,i,s,d,f,y){let _=i.y-l.y,S=l.x-i.x;if(y=y||0){const A=_*_+S*S;if(A===0)return!0;const k=Math.sqrt(A);_/=k,S/=k}return!((s.x-l.x)*_+(s.y-l.y)*S-y<0||(d.x-l.x)*_+(d.y-l.y)*S-y<0||(f.x-l.x)*_+(f.y-l.y)*S-y<0)}function Xo(l,i,s,d,f,y,_){return!(Di(l,i,d,f,y,_)||Di(i,s,d,f,y,_)||Di(s,l,d,f,y,_)||Di(d,f,l,i,s,_)||Di(f,y,l,i,s,_)||Di(y,d,l,i,s,_))}function _i(l,i,s){const d=i.paint.get(l).value;return d.kind==="constant"?d.value:s.programConfigurations.get(i.id).getMaxValue(l)}function Ia(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Qu(l,i,s,d,f){if(!i[0]&&!i[1])return l;const y=ut.convert(i)._mult(f);s==="viewport"&&y._rotate(-d);const _=[];for(let S=0;S<l.length;S++)_.push(l[S].sub(y));return _}function Qc(l,i,s,d){const f=ut.convert(l)._mult(d);return i==="viewport"&&f._rotate(-s),f}let Td,Ed;function eu(l,i,s){var d=2*Math.PI*6378137/256/Math.pow(2,s);return[l*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}Wt(Ln,"CircleBucket",{omit:["layers"]});class Oa{constructor(i,s,d){this.z=i,this.x=s,this.y=d,this.key=Ds(0,i,i,s,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const s=this.z-i.z;return i.z===0||i.z<this.z&&i.x===this.x>>s&&i.y===this.y>>s}url(i,s){const d=function(y,_,S){var A=eu(256*y,256*(_=Math.pow(2,S)-_-1),S),k=eu(256*(y+1),256*(_+1),S);return A[0]+","+A[1]+","+k[0]+","+k[1]}(this.x,this.y,this.z),f=function(y,_,S){let A,k="";for(let j=y;j>0;j--)A=1<<j-1,k+=(_&A?1:0)+(S&A?2:0);return k}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tu{constructor(i,s){this.wrap=i,this.canonical=s,this.key=Ds(i,s.z,s.z,s.x,s.y)}}class $i{constructor(i,s,d,f,y){this.overscaledZ=i,this.wrap=s,this.canonical=new Oa(d,+f,+y),this.key=s===0&&i===d?this.canonical.key:Ds(s,i,d,f,y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const s=this.canonical.z-i;return i>this.canonical.z?new $i(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $i(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(i,s=!0){if(this.overscaledZ===i&&s)return this.key;if(i>this.canonical.z)return Ds(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-i;return Ds(this.wrap*+s,i,i,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const s=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s}children(i){if(this.overscaledZ>=i)return[new $i(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,d=2*this.canonical.x,f=2*this.canonical.y;return[new $i(s,this.wrap,s,d,f),new $i(s,this.wrap,s,d+1,f),new $i(s,this.wrap,s,d,f+1),new $i(s,this.wrap,s,d+1,f+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new $i(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new $i(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ds(l,i,s,d,f){const y=1<<Math.min(s,22);let _=y*(f%y)+d%y;return l&&s<22&&(_+=y*y*((l<0?-2*l-1:2*l)%(1<<2*(22-s)))),16*(32*_+s)+(i-s)}const Ore=[l=>{let i=l.canonical.x-1,s=l.wrap;return i<0&&(i=(1<<l.canonical.z)-1,s--),new $i(l.overscaledZ,s,l.canonical.z,i,l.canonical.y)},l=>{let i=l.canonical.x+1,s=l.wrap;return i===1<<l.canonical.z&&(i=0,s++),new $i(l.overscaledZ,s,l.canonical.z,i,l.canonical.y)},l=>new $i(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new $i(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Wt(Oa,"CanonicalTileID"),Wt($i,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const jre=Yr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yS}=jre,Rre=Yr([{name:"a_pos_3",components:3,type:"Int16"}]);var fN=Yr([{name:"a_pos",type:"Int16",components:2}]);function _S(l){return l*Ko/z}const Dre=[new kr([b,b,b],[E,E,E]),new kr([b,b,b],[0,0,E]),new kr([0,b,b],[E,0,E]),new kr([b,0,b],[0,E,E]),new kr([0,0,b],[E,E,E])];function pN(l,i,s,d=!0){const f=mt([],l._camera.position,l.worldSize),y=[i,s,1,1];Bi(y,y,l.pixelMatrixInverse),Co(y,y,1/y[3]);const _=Er([],Kr([],y,f)),S=l.globeMatrix,A=[S[12],S[13],S[14]],k=Kr([],A,f),j=Ye(k),R=Er([],k),L=l.worldSize/(2*Math.PI),H=Ft(R,_),W=Math.asin(L/j);if(W<Math.acos(H)){if(!d)return null;const st=[],Ge=[];mt(st,_,j/H),Er(Ge,Kr(Ge,st,k)),Er(_,He(_,k,mt(_,Ge,Math.tan(W)*j)))}const J=[];new hn(f,_).closestPointOnSphere(A,L,J);const Q=Er([],pi(S,0)),ae=Er([],pi(S,1)),de=Er([],pi(S,2)),he=Ft(Q,J),fe=Ft(ae,J),Me=Ft(de,J),Ae=qe(Math.asin(-fe/L));let ke=qe(Math.atan2(he,Me));ke=l.center.lng+function(st,Ge){const ft=(Ge-st+180)%360-180;return ft<-180?ft+360:ft}(l.center.lng,ke);const Le=re(ke),Be=xe(ie(Ae),0,1);return new Ve(Le,Be)}class Lre{constructor(i,s,d){this.a=Kr([],i,d),this.b=Kr([],s,d),this.center=d;const f=Er([],this.a),y=Er([],this.b);this.angle=Math.acos(Ft(f,y))}}function nP(l,i){if(l.angle===0)return null;let s;return s=l.a[i]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[i]/l.a[i]/Math.sin(l.angle)-1/Math.tan(l.angle)),s<0||s>1?null:function(d,f,y,_){const S=Math.sin(y);return d*(Math.sin((1-_)*y)/S)+f*(Math.sin(_*y)/S)}(l.a[i],l.b[i],l.angle,xe(s,0,1))+l.center[i]}function ru(l){if(l.z<=1)return Dre[l.z+2*l.y+l.x];const i=iP(vS(l));return kr.fromPoints(i)}function eh(l,i,s){return mt(l,l,1-s),ct(l,l,i,s)}function mN(l,i,s){for(const d of l)Qt(d,d,i),mt(d,d,s)}function gN(l,i,s,d){const f=i/l.worldSize,y=l.globeMatrix;if(s.z<=1){const Be=ru(s).getCorners();return mN(Be,y,f),kr.fromPoints(Be)}const _=vS(s,d),S=iP(_,Ko+_S(l._tileCoverLift));mN(S,y,f);const A=Number.MAX_VALUE,k=[-A,-A,-A],j=[A,A,A];if(_.contains(l.center)){for(const Ge of S)ht(j,j,Ge),vt(k,k,Ge);k[2]=0;const Be=l.point,st=[Be.x*f,Be.y*f,0];return ht(j,j,st),vt(k,k,st),new kr(j,k)}if(l._tileCoverLift>0){for(const Be of S)ht(j,j,Be),vt(k,k,Be);return new kr(j,k)}const R=[y[12]*f,y[13]*f,y[14]*f],L=_.getCenter(),H=xe(l.center.lat,-we,we),W=xe(L.lat,-we,we),J=re(l.center.lng),Q=ie(H);let ae=J-re(L.lng);const de=Q-ie(W);ae>.5?ae-=1:ae<-.5&&(ae+=1);let he=0;Math.abs(ae)>Math.abs(de)?he=ae>=0?1:3:(he=de>=0?0:2,ct(R,R,[y[4]*f,y[5]*f,y[6]*f],-Math.sin(Br(de>=0?_.getSouth():_.getNorth()))*Ko));const fe=S[he],Me=S[(he+1)%4],Ae=new Lre(fe,Me,R),ke=[nP(Ae,0)||fe[0],nP(Ae,1)||fe[1],nP(Ae,2)||fe[2]],Le=Ad(l.zoom);if(Le>0){const Be=function({x:Ge,y:ft,z:wt},xt,At,kt,it){const Tt=1/(1<<wt);let Xe=Ge*Tt,at=Xe+Tt,Mt=ft*Tt,St=Mt+Tt,ar=0;const Kt=(Xe+at)/2-kt;return Kt>.5?ar=-1:Kt<-.5&&(ar=1),Xe=((Xe+ar)*xt-(kt*=xt))*At+kt,at=((at+ar)*xt-kt)*At+kt,Mt=(Mt*xt-(it*=xt))*At+it,St=(St*xt-it)*At+it,[[Xe,St,0],[at,St,0],[at,Mt,0],[Xe,Mt,0]]}(s,i,l._pixelsPerMercatorPixel,J,Q);for(let Ge=0;Ge<S.length;Ge++)eh(S[Ge],Be[Ge],Le);const st=He([],Be[he],Be[(he+1)%4]);mt(st,st,.5),eh(ke,st,Le)}for(const Be of S)ht(j,j,Be),vt(k,k,Be);return j[2]=Math.min(fe[2],Me[2]),ht(j,j,ke),vt(k,k,ke),new kr(j,k)}function vS({x:l,y:i,z:s},d=!1){const f=1/(1<<s),y=new q(pe(l*f),i===(1<<s)-1&&d?-90:me((i+1)*f)),_=new q(pe((l+1)*f),i===0&&d?90:me(i*f));return new $(y,_)}function iP(l,i=Ko){const s=Br(l.getNorth()),d=Br(l.getSouth()),f=Math.cos(s),y=Math.cos(d),_=Math.sin(s),S=Math.sin(d),A=l.getWest(),k=l.getEast();return[P(y,S,A,i),P(y,S,k,i),P(f,_,k,i),P(f,_,A,i)]}function D0(l,i,s,d){const f=1<<s.z,y=(l/Dt+s.x)/f;return I(me((i/Dt+s.y)/f),pe(y),d)}function xS({min:l,max:i}){return u/Math.max(i[0]-l[0],i[1]-l[1],i[2]-l[2])}const yN=new Float64Array(16);function bS(l){const i=xS(l),s=le(yN,[i,i,i]);return U(s,s,tn([],l.min))}function oP(l){const i=(d=l.min,(s=yN)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=d[0],s[13]=d[1],s[14]=d[2],s[15]=1,s);var s,d;const f=1/xS(l);return X(i,i,[f,f,f])}function aP(l){const i=Dt/(2*Math.PI);return l/(2*Math.PI)/i}function _N(l,i){return Dt/(512*Math.pow(2,l))*xS(ru(i))}function vN(l,i,s,d,f){const y=aP(s),_=[l,i,-s/(2*Math.PI)],S=N(new Float64Array(16));return U(S,S,_),X(S,S,[y,y,y]),Y(S,S,Br(-f)),ne(S,S,Br(-d)),S}function Ad(l){return Fe(m,a,l)}function xN(l,i){const s=I(i.lat,i.lng),d=function(W){const J=I(W._center.lat,W._center.lng);let Q=br([],Oe(0,1,0),J);const ae=ge([],-W.angle,J);Q=Qt(Q,Q,ae),ge(ae,-W._pitch,Q);const de=Er([],J);return mt(de,de,_S(W.cameraToCenterDistance/W.pixelsPerMeter)),Qt(de,de,ae),He([],J,de)}(l);return _=(f=lt([],d,s))[0],S=f[1],A=f[2],k=(y=s)[0],j=y[1],R=y[2],H=(L=Math.sqrt(_*_+S*S+A*A)*Math.sqrt(k*k+j*j+R*R))&&Ft(f,y)/L,Math.acos(Math.min(Math.max(H,-1),1));var f,y,_,S,A,k,j,R,L,H}function sP(l,i){return xN(l,i)>Math.PI/2*1.01}const bN=Br(85),zre=Math.cos(bN),Nre=Math.sin(bN),Fre=B(),wN=l=>{const i=[];return l.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function SN(l,i,s,d,f,y,_,S,A){if(y&&l.queryGeometry.isAboveHorizon)return!1;y&&(A*=l.pixelToTileUnitsFactor);const k=l.tileID.canonical,j=s.projection.upVectorScale(k,s.center.lat,s.worldSize).metersToTile;for(const R of i)for(const L of R){const H=L.add(S),W=f&&s.elevation?s.elevation.exaggeration()*f.getElevationAt(H.x,H.y,!0):0,J=s.projection.projectTilePoint(H.x,H.y,k);if(W>0){const he=s.projection.upVector(k,H.x,H.y);J.x+=he[0]*j*W,J.y+=he[1]*j*W,J.z+=he[2]*j*W}const Q=y?H:Bre(J.x,J.y,J.z,d),ae=y?l.tilespaceRays.map(he=>Vre(he,W)):l.queryGeometry.screenGeometry,de=Bi([],[J.x,J.y,J.z,1],d);if(!_&&y?A*=de[3]/s.cameraToCenterDistance:_&&!y&&(A*=s.cameraToCenterDistance/de[3]),y){const he=me((L.y/Dt+k.y)/(1<<k.z));A/=s.projection.pixelsPerMeter(he,1)/ue(1,he)}if(Oi(ae,Q,A))return!0}return!1}function Bre(l,i,s,d){const f=Bi([],[l,i,s,1],d);return new ut(f[0]/f[3],f[1]/f[3])}const TN=Oe(0,0,0),Ure=Oe(0,0,1);function Vre(l,i){const s=Ce();return TN[2]=i,l.intersectsPlane(TN,Ure,s),new ut(s[0],s[1])}class EN extends Ln{}let AN,kN,CN,PN;function MN(l,{width:i,height:s},d,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==i*s*d)throw new RangeError("mismatched image size")}else f=new Uint8Array(i*s*d);return l.width=i,l.height=s,l.data=f,l}function IN(l,i,s){const{width:d,height:f}=i;d===l.width&&f===l.height||(lP(l,i,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,d),height:Math.min(l.height,f)},s,null),l.width=d,l.height=f,l.data=i.data)}function lP(l,i,s,d,f,y,_,S){if(f.width===0||f.height===0)return i;if(f.width>l.width||f.height>l.height||s.x>l.width-f.width||s.y>l.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>i.width||f.height>i.height||d.x>i.width-f.width||d.y>i.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const A=l.data,k=i.data,j=y===4&&S;for(let R=0;R<f.height;R++){const L=((s.y+R)*l.width+s.x)*y,H=((d.y+R)*i.width+d.x)*y;if(j)for(let W=0;W<f.width;W++){const J=L+W*y+3,Q=H+W*y;k[Q+0]=255,k[Q+1]=255,k[Q+2]=255,k[Q+3]=A[J]}else if(_)for(let W=0;W<f.width;W++){const J=L+W*y,Q=H+W*y,ae=new Tn(A[J+0]/255,A[J+1]/255,A[J+2]/255,A[J+3]).toNonPremultipliedRenderColor(_).toArray();k[Q+0]=ae[0],k[Q+1]=ae[1],k[Q+2]=ae[2],k[Q+3]=ae[3]}else for(let W=0;W<f.width*y;W++)k[H+W]=A[L+W]}return i}Wt(EN,"HeatmapBucket",{omit:["layers"]});class kd{constructor(i,s){MN(this,i,1,s)}resize(i){IN(this,new kd(i),1)}clone(){return new kd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,d,f,y){lP(i,s,d,f,y,1,null)}}class Lo{constructor(i,s){MN(this,i,4,s)}resize(i){IN(this,new Lo(i),4)}replace(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,d,f,y,_,S){lP(i,s,d,f,y,4,_,S)}}class ON{constructor(i,s){this.width=i.width,this.height=i.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function L0(l){const i={},s=l.resolution||256,d=l.clips?l.clips.length:1,f=l.image||new Lo({width:s,height:d}),y=(_,S,A)=>{i[l.evaluationKey]=A;const k=l.expression.evaluate(i),j=k?k.toNonPremultipliedRenderColor(null):null;j&&(f.data[_+S+0]=Math.floor(255*j.r),f.data[_+S+1]=Math.floor(255*j.g),f.data[_+S+2]=Math.floor(255*j.b),f.data[_+S+3]=Math.floor(255*j.a))};if(l.clips)for(let _=0,S=0;_<d;++_,S+=4*s)for(let A=0,k=0;A<s;A++,k+=4){const j=A/(s-1),{start:R,end:L}=l.clips[_];y(S,k,R*(1-j)+L*j)}else for(let _=0,S=0;_<s;_++,S+=4)y(0,S,_/(s-1));return f}Wt(kd,"AlphaImage"),Wt(Lo,"RGBAImage");const $re=Yr([{name:"a_pos",components:2,type:"Int16"}],4),Gre=Yr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),qre=Yr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Hre=Yr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Vg(l,i,s=2){const d=i&&i.length,f=d?i[0]*s:l.length;let y=jN(l,0,f,s,!0);const _=[];if(!y||y.next===y.prev)return _;let S,A,k;if(d&&(y=function(j,R,L,H){const W=[];for(let J=0,Q=R.length;J<Q;J++){const ae=jN(j,R[J]*H,J<Q-1?R[J+1]*H:j.length,H,!1);ae===ae.next&&(ae.steiner=!0),W.push(ene(ae))}W.sort(Yre);for(let J=0;J<W.length;J++)L=Jre(W[J],L);return L}(l,i,y,s)),l.length>80*s){S=l[0],A=l[1];let j=S,R=A;for(let L=s;L<f;L+=s){const H=l[L],W=l[L+1];H<S&&(S=H),W<A&&(A=W),H>j&&(j=H),W>R&&(R=W)}k=Math.max(j-S,R-A),k=k!==0?32767/k:0}return z0(y,_,s,S,A,k,0),_}function jN(l,i,s,d,f){let y;if(f===function(_,S,A,k){let j=0;for(let R=S,L=A-k;R<A;R+=k)j+=(_[L]-_[R])*(_[R+1]+_[L+1]),L=R;return j}(l,i,s,d)>0)for(let _=i;_<s;_+=d)y=zN(_/d|0,l[_],l[_+1],y);else for(let _=s-d;_>=i;_-=d)y=zN(_/d|0,l[_],l[_+1],y);return y&&$g(y,y.next)&&(B0(y),y=y.next),y}function xp(l,i){if(!l)return l;i||(i=l);let s,d=l;do if(s=!1,d.steiner||!$g(d,d.next)&&po(d.prev,d,d.next)!==0)d=d.next;else{if(B0(d),d=i=d.prev,d===d.next)break;s=!0}while(s||d!==i);return i}function z0(l,i,s,d,f,y,_){if(!l)return;!_&&y&&function(A,k,j,R){let L=A;do L.z===0&&(L.z=cP(L.x,L.y,k,j,R)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==A);L.prevZ.nextZ=null,L.prevZ=null,function(H){let W,J=1;do{let Q,ae=H;H=null;let de=null;for(W=0;ae;){W++;let he=ae,fe=0;for(let Ae=0;Ae<J&&(fe++,he=he.nextZ,he);Ae++);let Me=J;for(;fe>0||Me>0&&he;)fe!==0&&(Me===0||!he||ae.z<=he.z)?(Q=ae,ae=ae.nextZ,fe--):(Q=he,he=he.nextZ,Me--),de?de.nextZ=Q:H=Q,Q.prevZ=de,de=Q;ae=he}de.nextZ=null,J*=2}while(W>1)}(L)}(l,d,f,y);let S=l;for(;l.prev!==l.next;){const A=l.prev,k=l.next;if(y?Zre(l,d,f,y):Wre(l))i.push(A.i,l.i,k.i),B0(l),l=k.next,S=k.next;else if((l=k)===S){_?_===1?z0(l=Kre(xp(l),i),i,s,d,f,y,2):_===2&&Xre(l,i,s,d,f,y):z0(xp(l),i,s,d,f,y,1);break}}}function Wre(l){const i=l.prev,s=l,d=l.next;if(po(i,s,d)>=0)return!1;const f=i.x,y=s.x,_=d.x,S=i.y,A=s.y,k=d.y,j=Math.min(f,y,_),R=Math.min(S,A,k),L=Math.max(f,y,_),H=Math.max(S,A,k);let W=d.next;for(;W!==i;){if(W.x>=j&&W.x<=L&&W.y>=R&&W.y<=H&&N0(f,S,y,A,_,k,W.x,W.y)&&po(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function Zre(l,i,s,d){const f=l.prev,y=l,_=l.next;if(po(f,y,_)>=0)return!1;const S=f.x,A=y.x,k=_.x,j=f.y,R=y.y,L=_.y,H=Math.min(S,A,k),W=Math.min(j,R,L),J=Math.max(S,A,k),Q=Math.max(j,R,L),ae=cP(H,W,i,s,d),de=cP(J,Q,i,s,d);let he=l.prevZ,fe=l.nextZ;for(;he&&he.z>=ae&&fe&&fe.z<=de;){if(he.x>=H&&he.x<=J&&he.y>=W&&he.y<=Q&&he!==f&&he!==_&&N0(S,j,A,R,k,L,he.x,he.y)&&po(he.prev,he,he.next)>=0||(he=he.prevZ,fe.x>=H&&fe.x<=J&&fe.y>=W&&fe.y<=Q&&fe!==f&&fe!==_&&N0(S,j,A,R,k,L,fe.x,fe.y)&&po(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;he&&he.z>=ae;){if(he.x>=H&&he.x<=J&&he.y>=W&&he.y<=Q&&he!==f&&he!==_&&N0(S,j,A,R,k,L,he.x,he.y)&&po(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;fe&&fe.z<=de;){if(fe.x>=H&&fe.x<=J&&fe.y>=W&&fe.y<=Q&&fe!==f&&fe!==_&&N0(S,j,A,R,k,L,fe.x,fe.y)&&po(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function Kre(l,i){let s=l;do{const d=s.prev,f=s.next.next;!$g(d,f)&&DN(d,s,s.next,f)&&F0(d,f)&&F0(f,d)&&(i.push(d.i,s.i,f.i),B0(s),B0(s.next),s=l=f),s=s.next}while(s!==l);return xp(s)}function Xre(l,i,s,d,f,y){let _=l;do{let S=_.next.next;for(;S!==_.prev;){if(_.i!==S.i&&tne(_,S)){let A=LN(_,S);return _=xp(_,_.next),A=xp(A,A.next),z0(_,i,s,d,f,y,0),void z0(A,i,s,d,f,y,0)}S=S.next}_=_.next}while(_!==l)}function Yre(l,i){let s=l.x-i.x;return s===0&&(s=l.y-i.y,s===0)&&(s=(l.next.y-l.y)/(l.next.x-l.x)-(i.next.y-i.y)/(i.next.x-i.x)),s}function Jre(l,i){const s=function(f,y){let _=y;const S=f.x,A=f.y;let k,j=-1/0;if($g(f,_))return _;do{if($g(f,_.next))return _.next;if(A<=_.y&&A>=_.next.y&&_.next.y!==_.y){const J=_.x+(A-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(J<=S&&J>j&&(j=J,k=_.x<_.next.x?_:_.next,J===S))return k}_=_.next}while(_!==y);if(!k)return null;const R=k,L=k.x,H=k.y;let W=1/0;_=k;do{if(S>=_.x&&_.x>=L&&S!==_.x&&RN(A<H?S:j,A,L,H,A<H?j:S,A,_.x,_.y)){const J=Math.abs(A-_.y)/(S-_.x);F0(_,f)&&(J<W||J===W&&(_.x>k.x||_.x===k.x&&Qre(k,_)))&&(k=_,W=J)}_=_.next}while(_!==R);return k}(l,i);if(!s)return i;const d=LN(s,l);return xp(d,d.next),xp(s,s.next)}function Qre(l,i){return po(l.prev,l,i.prev)<0&&po(i.next,l,l.next)<0}function cP(l,i,s,d,f){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-s)*f|0)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-d)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function ene(l){let i=l,s=l;do(i.x<s.x||i.x===s.x&&i.y<s.y)&&(s=i),i=i.next;while(i!==l);return s}function RN(l,i,s,d,f,y,_,S){return(f-_)*(i-S)>=(l-_)*(y-S)&&(l-_)*(d-S)>=(s-_)*(i-S)&&(s-_)*(y-S)>=(f-_)*(d-S)}function N0(l,i,s,d,f,y,_,S){return!(l===_&&i===S)&&RN(l,i,s,d,f,y,_,S)}function tne(l,i){return l.next.i!==i.i&&l.prev.i!==i.i&&!function(s,d){let f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==d.i&&f.next.i!==d.i&&DN(f,f.next,s,d))return!0;f=f.next}while(f!==s);return!1}(l,i)&&(F0(l,i)&&F0(i,l)&&function(s,d){let f=s,y=!1;const _=(s.x+d.x)/2,S=(s.y+d.y)/2;do f.y>S!=f.next.y>S&&f.next.y!==f.y&&_<(f.next.x-f.x)*(S-f.y)/(f.next.y-f.y)+f.x&&(y=!y),f=f.next;while(f!==s);return y}(l,i)&&(po(l.prev,l,i.prev)||po(l,i.prev,i))||$g(l,i)&&po(l.prev,l,l.next)>0&&po(i.prev,i,i.next)>0)}function po(l,i,s){return(i.y-l.y)*(s.x-i.x)-(i.x-l.x)*(s.y-i.y)}function $g(l,i){return l.x===i.x&&l.y===i.y}function DN(l,i,s,d){const f=SS(po(l,i,s)),y=SS(po(l,i,d)),_=SS(po(s,d,l)),S=SS(po(s,d,i));return f!==y&&_!==S||!(f!==0||!wS(l,s,i))||!(y!==0||!wS(l,d,i))||!(_!==0||!wS(s,l,d))||!(S!==0||!wS(s,i,d))}function wS(l,i,s){return i.x<=Math.max(l.x,s.x)&&i.x>=Math.min(l.x,s.x)&&i.y<=Math.max(l.y,s.y)&&i.y>=Math.min(l.y,s.y)}function SS(l){return l>0?1:l<0?-1:0}function F0(l,i){return po(l.prev,l,l.next)<0?po(l,i,l.next)>=0&&po(l,l.prev,i)>=0:po(l,i,l.prev)<0||po(l,l.next,i)<0}function LN(l,i){const s=uP(l.i,l.x,l.y),d=uP(i.i,i.x,i.y),f=l.next,y=i.prev;return l.next=i,i.prev=l,s.next=f,f.prev=s,d.next=s,s.prev=d,y.next=d,d.prev=y,d}function zN(l,i,s,d){const f=uP(l,i,s);return d?(f.next=d.next,f.prev=d,d.next.prev=f,d.next=f):(f.prev=f,f.next=f),f}function B0(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function uP(l,i,s){return{i:l,x:i,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function U0(l,i){const s=l.length;if(s<=1)return[l];const d=[];let f,y;for(let _=0;_<s;_++){const S=to(l[_]);S!==0&&(l[_].area=Math.abs(S),y===void 0&&(y=S<0),y===S<0?(f&&d.push(f),f=[l[_]]):f.push(l[_]))}if(f&&d.push(f),i>1)for(let _=0;_<d.length;_++)d[_].length<=i||(Wo(d[_],i,1,d[_].length-1,rne),d[_]=d[_].slice(0,i));return d}function rne(l,i){return i.area-l.area}function NN(l,i,s=1){if(!l)return null;const d=typeof l=="string"?ka.from(l).getPrimary():l.getPrimary(),f=typeof l=="string"?null:l.getSecondary();for(const y of[d,f]){if(!y)continue;const _=y.id.toString();i.has(_)||i.set(_,[]),y.scaleSelf(s),i.get(_).push(y)}return{primary:d.toString(),secondary:f?f.toString():null}}function hP(l,i,s,d){const f=d.patternDependencies;let y=!1;for(const _ of i){const S=_.paint.get(`${l}-pattern`);S.isConstant()||(y=!0),NN(S.constantOr(null),f,s)&&(y=!0)}return y}function dP(l,i,s,d,f,y){const _=y.patternDependencies;for(const S of i){const A=S.paint.get(`${l}-pattern`).value;if(A.kind!=="constant"){let k=A.evaluate({zoom:d},s,{},y.availableImages);k=k&&k.name?k.name:k;const j=NN(k,_,f);if(!j)continue;const{primary:R,secondary:L}=j;R&&(s.patterns[S.id]=[R,L].filter(Boolean))}}return s}class FN{constructor(){this.polygons=new Map}add(i,...s){this.polygons.has(i)?this.polygons.get(i).push(...s):this.polygons.set(i,s)}merge(i){for(const[s,d]of i.polygons)this.add(s,...d)}}class bp{constructor(){this.portals=[]}static evaluate(i){if(i.length===0)return new bp;let s=[];for(const k of i)s.push(...k.portals);if(s.length===0)return new bp;const d=(k,j)=>k<=0&&j<=0||k>=Dt&&j>=Dt;for(const k of s){const j=k.va,R=k.vb;(d(j.x,R.x)||d(j.y,R.y))&&(k.type="border")}const f=s.filter(k=>k.type!=="unevaluated"),y=s.filter(k=>k.type==="unevaluated");if(y.length===0)return new bp;y.sort((k,j)=>k.hash===j.hash?k.isTunnel===j.isTunnel?0:k.isTunnel?-1:1:k.hash<j.hash?1:-1),s=f.concat(y);let _=f.length,S=_,A=_;do if(S++,S===s.length||s[_].hash!==s[S].hash){if(S-_==2){A<_&&(s[A]=s[_],s[_]=null);const k=s[A],j=s[S-1];k.type=k.isTunnel!==j.isTunnel?"tunnel":"polygon",k.connection={a:k.connection.a,b:j.connection.a},A++}_=S}while(_!==s.length);return s.splice(A),s.sort((k,j)=>k.hash<j.hash?1:-1),{portals:s}}}Wt(bp,"ElevationPortalGraph"),Wt(FN,"ElevationPolygons");class nne{constructor(i,s,d){this.outPositions=i,this.outNormals=s,this.outIndices=d,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(i,s,d){let f=i[2];d!=null&&(f*=d);const y=this.getVec3Bits(i)<<96n|this.getVec3Bits(s),_=this.vertexLookup.get(y);if(_!=null)return _;const S=this.outPositions.length;this.vertexLookup.set(y,S);const A=Math.trunc(16384*s[0]),k=Math.trunc(16384*s[1]),j=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(i[0],i[1],f),this.outNormals.emplaceBack(A,k,j),S}addTriangle(i,s,d){this.outIndices.emplaceBack(i,s,d)}addTriangles(i,s,d){if(i.length===0)return;const f=d.length===1,y=Ce(),_=Ce();for(let S=0;S<i.length;S+=3){const A=s[i[S+0]],k=s[i[S+1]],j=s[i[S+2]],R=f?d[0]:d[i[S+1]],L=f?d[0]:d[i[S+2]];tt(y,A.x,A.y,f?d[0]:d[i[S+0]]);const H=this.addVertex(y,_);tt(y,k.x,k.y,R);const W=this.addVertex(y,_);tt(y,j.x,j.y,L);const J=this.addVertex(y,_);this.outIndices.emplaceBack(H,W,J)}}addQuad(i,s,d,f,y,_){const S=this.addVertex(i,y,_),A=this.addVertex(s,y,_),k=this.addVertex(d,y,_),j=this.addVertex(f,y,_);this.addTriangle(S,A,k),this.addTriangle(k,j,S)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(i){return this.view.setFloat32(0,i),BigInt(this.view.getUint32(0))}getVec3Bits(i){return this.getBits(i[0])<<64n|this.getBits(i[1])<<32n|this.getBits(i[2])}}class us{constructor(i,s,d,f){this.unevaluatedPortals=new bp,this.portalPolygons=new FN,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new g0,this.vertexNormals=new y0,this.indexArray=new ii,this.tileToMeters=Ee(i),this.bridgeProgramConfigurations=new ls(s,{zoom:d,lut:f},y=>y!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new ls(s,{zoom:d,lut:f},y=>y!=="fill-bridge-guard-rail-color")}addVertices(i,s){const d=this.unevalVertices.length;for(let f=0;f<i.length;f++)this.unevalVertices.push(i[f]),this.unevalHeights.push(s[f]);return d}addTriangles(i,s,d){const f=d?this.unevalTunnelTriangles:this.unevalTriangles;for(const y of i)f.push(y+s)}addRenderableRing(i,s,d,f,y,_){const S=[new ut(y.min.x,y.min.y),new ut(y.max.x,y.min.y),new ut(y.max.x,y.max.y),new ut(y.min.x,y.max.y)];for(let A=0;A<d-1;A++){const k=s+A,j=k+1,R=this.unevalVertices[k],L=this.unevalVertices[j];if(!(R.x>=y.min.x&&R.x<=y.max.x&&R.y>=y.min.y&&R.y<=y.max.y||L.x>=y.min.x&&L.x<=y.max.x&&L.y>=y.min.y&&L.y<=y.max.y||Vn(R,L,S))||this.isOnBorder(R.x,L.x)||this.isOnBorder(R.y,L.y))continue;const H=us.computeEdgeHash(this.unevalVertices[k],this.unevalVertices[j]);let W,J=this.vertexHashLookup.get(us.computePosHash(R));J!=null?W=J.next:(J=this.vertexHashLookup.get(us.computePosHash(L)),W=J!=null?J.prev:H),this.unevalEdges.push({polygonIdx:i,a:k,b:j,hash:H,portalHash:W,isTunnel:f,type:"unevaluated",featureInfo:_})}}addPortalCandidates(i,s,d,f,y){if(s.length===0)return;this.portalPolygons.add(i,{geometry:s,zLevel:y});const _=s[0];this.vertexHashLookup.clear();let S=us.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let A=0;A<_.length-1;A++){const k=_[A+0],j=_[A+1],R=sa(j.x-k.x,j.y-k.y),L=Sa(R);if(L===0)continue;let H="unevaluated";const W=f.pointElevation(k),J=f.pointElevation(j);Math.abs(W)<.01&&Math.abs(J)<.01?H="entrance":(this.isOnBorder(k.x,j.x)||this.isOnBorder(k.y,j.y))&&(H="border");const Q=us.computeEdgeHash(k,j);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:k,vb:j,vab:R,length:L,hash:Q,isTunnel:d,type:H});const ae=us.computePosHash(k);this.vertexHashLookup.set(ae,{prev:S,next:Q}),S=Q}}construct(i){if(this.unevalVertices.length===0)return;const s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),d=L=>{L.primitiveLength=this.indexArray.length-L.primitiveOffset},f=new nne(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const y=s(),_=s(),S=s(),A=(L,H)=>{L.sort((J,Q)=>J.type===H&&Q.type!==H?-1:J.type!==H&&Q.type===H?1:0);const W=L.findIndex(J=>J.type!==H);return W>=0?W:L.length};let k=0;this.unevalEdges.length>0&&(k=A(this.unevalEdges,"none"),this.constructBridgeStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},this.tileToMeters)),d(S);const j=s(),R=s();if(this.unevalEdges.length>0){const L=this.unevalEdges.splice(k),H=A(L,"tunnel")+k;this.unevalEdges.push(...L),this.constructTunnelStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},{min:k,max:H})}d(j),f.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),d(R),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),d(_),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),d(y),this.maskSegments=ui.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.depthSegments=ui.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=ui.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.renderableTunnelSegments=ui.simpleSegment(0,j.primitiveOffset,0,j.primitiveLength),this.shadowCasterSegments=ui.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength)}update(i,s,d,f,y,_,S,A){this.bridgeProgramConfigurations.updatePaintArrays(i,s,y,d,f,_,S,A),this.tunnelProgramConfigurations.updatePaintArrays(i,s,y,d,f,_,S,A)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,qre.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,Hre.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,s,d,f,y){const _=(S,A)=>{for(let k=0;k<A.length-1;k++){const j=A[k].featureIndex,R=A[k+1].vertexStart,L=i.feature(j);S.populatePaintArrays(R,L,j,{},d,s,f,void 0,y)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,s,d,f,y){const _=new Map;for(let S=f;S<y;S++){const A=d[S],k=A.a,j=A.b,R=us.computePosHash(i[k]),L=us.computePosHash(i[j]);let H=_.get(R);H||(H={},_.set(R,H));let W=_.get(L);W||(W={},_.set(L,W)),s[k]<=0&&s[j]<=0||(H.to=j,W.from=k)}return _}isTerminalVertex(i,s){const d=us.computePosHash(this.unevalVertices[i]),f=s.get(d);return!f||!f.from||!f.to}constructBridgeStructures(i,s,d,f,y,_){i.clearVertexLookup();const S=this.computeVertexConnections(s,d,f,y.min,y.max),A=1/_,k=.5*A,j=(At,kt)=>tt(At,s[kt].x,s[kt].y,d[kt]*A),R=Ce(),L=Ce(),H=Ce(),W=Ce(),J=Ce(),Q=(At,kt)=>{const it=S.get(us.computePosHash(s[kt])),Tt=it.from,Xe=it.to;if(!Tt||!Xe)return;j(R,Tt),j(L,kt),j(H,Xe),Nn(W),Jr(R,L)||(Kr(J,L,R),Er(W,J)),Jr(H,L)||(Kr(J,H,L),He(W,W,Er(J,J)));const at=Fi(W);return at>0?mt(At,W,1/at):void 0};let ae=Number.POSITIVE_INFINITY;this.sortSubarray(f,y.min,y.max,(At,kt)=>At.featureInfo.featureIndex-kt.featureInfo.featureIndex);const de=Ce(),he=Ce(),fe=Ce(),Me=Ce(),Ae=Ce(),ke=Ce(),Le=Ce(),Be=Ce(),st=Ce(),Ge=[Ce(),Ce(),Ce(),Ce()],ft=[Ce(),Ce(),Ce(),Ce()],wt=[{coord:new ut(0,0),height:0},{coord:new ut(0,0),height:0}],xt=(At,kt)=>At>kt;for(let At=y.min;At<y.max;At++){const kt=f[At];if(!kt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(wt,s,d,kt,xt))continue;const[it,Tt]=wt;if(tt(de,it.coord.x,it.coord.y,A*it.height),tt(he,Tt.coord.x,Tt.coord.y,A*Tt.height),Jr(de,he))continue;Kr(fe,he,de),Er(fe,fe);const Xe=Q(Be,kt.a)||fe,at=Q(st,kt.b)||fe;tt(Me,Xe[1],-Xe[0],0),Er(Me,Me),tt(Ae,at[1],-at[0],0),Er(Ae,Ae),br(Be,Me,Xe),Er(ke,Be),br(Be,Ae,at),Er(Le,Be),He(Ge[0],de,mt(Be,Kr(Be,Me,ke),k)),He(Ge[1],de,mt(Be,He(Be,Me,ke),k)),He(Ge[2],de,mt(Be,ke,k)),Ge[3]=de,He(ft[0],he,mt(Be,Kr(Be,Ae,Le),k)),He(ft[1],he,mt(Be,He(Be,Ae,Le),k)),He(ft[2],he,mt(Be,Le,k)),ft[3]=he,ae=this.addFeatureSection(kt.featureInfo.featureIndex,ae,this.bridgeFeatureSections,i);const Mt=i.addVertex(Ge[0],Me,_),St=i.addVertex(Ge[1],Me,_),ar=i.addVertex(ft[0],Ae,_),Kt=i.addVertex(ft[1],Ae,_);i.addTriangle(Mt,St,ar),i.addTriangle(St,Kt,ar);const _t=i.addVertex(Ge[1],ke,_),Pt=i.addVertex(Ge[2],ke,_),rr=i.addVertex(ft[1],Le,_),Bt=i.addVertex(ft[2],Le,_);i.addTriangle(_t,Pt,rr),i.addTriangle(Pt,Bt,rr),tn(Me,Me),tn(Ae,Ae);const Nt=i.addVertex(Ge[2],Me,_),qt=i.addVertex(Ge[3],Me,_),pr=i.addVertex(ft[2],Ae,_),gr=i.addVertex(ft[3],Ae,_);i.addTriangle(Nt,qt,pr),i.addTriangle(qt,gr,pr);const Pr=this.isTerminalVertex(kt.a,S),Ar=this.isTerminalVertex(kt.b,S);it.height<.01&&Pr&&i.addQuad(Ge[3],Ge[2],Ge[1],Ge[0],tn(Xe,Xe),_),Tt.height<.01&&Ar&&i.addQuad(ft[0],ft[1],ft[2],ft[3],at,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,s,d,f,y,_){i.clearVertexLookup();let S=Number.POSITIVE_INFINITY;const A=(ae,de)=>ae.featureInfo.featureIndex-de.featureInfo.featureIndex;this.sortSubarray(f,y.min,y.max,A),this.sortSubarray(f,_.min,_.max,A);const k=ae=>Er(ae,ae),j=[{coord:new ut(0,0),height:0},{coord:new ut(0,0),height:0}],R=(ae,de)=>ae<de,L=Ce(),H=Ce(),W=Ce(),J=Ce(),Q=Ce();for(let ae=y.min;ae<y.max;ae++){if(!this.prepareEdgePoints(j,s,d,f[ae],R))continue;const[de,he]=j,fe=k(tt(Q,-(he.coord.y-de.coord.y),he.coord.x-de.coord.x,0));S=this.addFeatureSection(f[ae].featureInfo.featureIndex,S,this.tunnelFeatureSections,i),i.addQuad(tt(L,de.coord.x,de.coord.y,de.height),tt(H,he.coord.x,he.coord.y,he.height),tt(W,he.coord.x,he.coord.y,f[ae].isTunnel?-.1:0),tt(J,de.coord.x,de.coord.y,f[ae].isTunnel?-.1:0),fe)}for(let ae=_.min;ae<_.max;ae++){const de=f[ae];de.isTunnel&&([de.a,de.b]=[de.b,de.a]);const he=s[de.a],fe=s[de.b],Me=k(tt(Q,-(fe.y-he.y),fe.x-he.x,0));S=this.addFeatureSection(de.featureInfo.featureIndex,S,this.tunnelFeatureSections,i),i.addQuad(tt(L,fe.x,fe.y,0),tt(H,he.x,he.y,0),tt(W,he.x,he.y,d[de.a]+4),tt(J,fe.x,fe.y,d[de.b]+4),Me),i.addQuad(tt(L,he.x,he.y,0),tt(H,fe.x,fe.y,0),tt(W,fe.x,fe.y,d[de.b]+4),tt(J,he.x,he.y,d[de.a]+4),Me)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,s,d,f){i.coord.x=s,i.coord.y=d,i.height=f}prepareEdgePoints(i,s,d,f,y){let _=s[f.a].x,S=s[f.a].y,A=s[f.b].x,k=s[f.b].y,j=d[f.a],R=d[f.b];const L=y(j,0),H=y(R,0);if(L&&H)return this.setElevatedPoint(i[0],_,S,j),this.setElevatedPoint(i[1],A,k,R),!0;if(!L&&!H)return!1;if(L){if(!H){const W=R/(R-j);A=lr(A,_,W),k=lr(k,S,W),R=lr(R,j,W)}}else{const W=j/(j-R);_=lr(_,A,W),S=lr(S,k,W),j=lr(j,R,W)}return this.setElevatedPoint(i[0],_,S,j),this.setElevatedPoint(i[1],A,k,R),!0}prepareEdges(i,s){if(s.length===0)return;s.sort((S,A)=>S.hash===A.hash?A.polygonIdx-S.polygonIdx:A.hash>S.hash?1:-1);let d=0,f=0,y=0,_=s[d].polygonIdx;do f++,(f===s.length||s[d].hash!==s[f].hash)&&((f-d==1||s[f-1].polygonIdx!==_)&&(y<d&&(s[y]=s[d],s[d]=null),s[y].type="none",y++),d=f,d!==s.length&&(_=s[d].polygonIdx));while(d!==s.length);if(s.splice(y),s.length!==0&&i.length!==0){s.sort((k,j)=>k.portalHash<j.portalHash?1:-1);let S=0,A=0;for(;S!==s.length&&A!==i.length;){const k=s[S],j=i[A];k.portalHash>j.hash?S++:j.hash>k.portalHash?A++:(k.type=j.type,S++)}}}isOnBorder(i,s){return i<=0&&s<=0||i>=Dt&&s>=Dt}addFeatureSection(i,s,d,f){return i!==s&&(s=i,d.push({featureIndex:i,vertexStart:f.getVertexCount()}),f.clearVertexLookup()),s}sortSubarray(i,s,d,f){const y=i.slice(s,d);y.sort(f),i.splice(s,y.length,...y)}static computeEdgeHash(i,s){return(i.y===s.y&&i.x>s.x||i.y>s.y)&&([i,s]=[s,i]),BigInt(us.computePosHash(i))<<32n|BigInt(us.computePosHash(s))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}var BN,UN={exports:{}},VN=(BN||(BN=1,function(l,i){(function(s){function d(_e,ve){return _e>ve?1:_e<ve?-1:0}var f=function(_e,ve){_e===void 0&&(_e=d),ve===void 0&&(ve=!1),this._compare=_e,this._root=null,this._size=0,this._noDuplicates=!!ve},y={size:{configurable:!0}};function _(_e,ve,ot,Rt,zt){var Lt=zt-Rt;if(Lt>0){var Jt=Rt+Math.floor(Lt/2),yr={key:ve[Jt],data:ot[Jt],parent:_e};return yr.left=_(yr,ve,ot,Rt,Jt),yr.right=_(yr,ve,ot,Jt+1,zt),yr}return null}function S(_e,ve,ot,Rt,zt){if(!(ot>=Rt)){for(var Lt=_e[ot+Rt>>1],Jt=ot-1,yr=Rt+1;;){do Jt++;while(zt(_e[Jt],Lt)<0);do yr--;while(zt(_e[yr],Lt)>0);if(Jt>=yr)break;var Vr=_e[Jt];_e[Jt]=_e[yr],_e[yr]=Vr,Vr=ve[Jt],ve[Jt]=ve[yr],ve[yr]=Vr}S(_e,ve,ot,yr,zt),S(_e,ve,yr+1,Rt,zt)}}f.prototype.rotateLeft=function(_e){var ve=_e.right;ve&&(_e.right=ve.left,ve.left&&(ve.left.parent=_e),ve.parent=_e.parent),_e.parent?_e===_e.parent.left?_e.parent.left=ve:_e.parent.right=ve:this._root=ve,ve&&(ve.left=_e),_e.parent=ve},f.prototype.rotateRight=function(_e){var ve=_e.left;ve&&(_e.left=ve.right,ve.right&&(ve.right.parent=_e),ve.parent=_e.parent),_e.parent?_e===_e.parent.left?_e.parent.left=ve:_e.parent.right=ve:this._root=ve,ve&&(ve.right=_e),_e.parent=ve},f.prototype._splay=function(_e){for(;_e.parent;){var ve=_e.parent;ve.parent?ve.left===_e&&ve.parent.left===ve?(this.rotateRight(ve.parent),this.rotateRight(ve)):ve.right===_e&&ve.parent.right===ve?(this.rotateLeft(ve.parent),this.rotateLeft(ve)):ve.left===_e&&ve.parent.right===ve?(this.rotateRight(ve),this.rotateLeft(ve)):(this.rotateLeft(ve),this.rotateRight(ve)):ve.left===_e?this.rotateRight(ve):this.rotateLeft(ve)}},f.prototype.splay=function(_e){for(var ve,ot,Rt,zt,Lt;_e.parent;)(ot=(ve=_e.parent).parent)&&ot.parent?((Rt=ot.parent).left===ot?Rt.left=_e:Rt.right=_e,_e.parent=Rt):(_e.parent=null,this._root=_e),zt=_e.left,Lt=_e.right,_e===ve.left?(ot&&(ot.left===ve?(ve.right?(ot.left=ve.right,ot.left.parent=ot):ot.left=null,ve.right=ot,ot.parent=ve):(zt?(ot.right=zt,zt.parent=ot):ot.right=null,_e.left=ot,ot.parent=_e)),Lt?(ve.left=Lt,Lt.parent=ve):ve.left=null,_e.right=ve,ve.parent=_e):(ot&&(ot.right===ve?(ve.left?(ot.right=ve.left,ot.right.parent=ot):ot.right=null,ve.left=ot,ot.parent=ve):(Lt?(ot.left=Lt,Lt.parent=ot):ot.left=null,_e.right=ot,ot.parent=_e)),zt?(ve.right=zt,zt.parent=ve):ve.right=null,_e.left=ve,ve.parent=_e)},f.prototype.replace=function(_e,ve){_e.parent?_e===_e.parent.left?_e.parent.left=ve:_e.parent.right=ve:this._root=ve,ve&&(ve.parent=_e.parent)},f.prototype.minNode=function(_e){if(_e===void 0&&(_e=this._root),_e)for(;_e.left;)_e=_e.left;return _e},f.prototype.maxNode=function(_e){if(_e===void 0&&(_e=this._root),_e)for(;_e.right;)_e=_e.right;return _e},f.prototype.insert=function(_e,ve){var ot=this._root,Rt=null,zt=this._compare;if(this._noDuplicates)for(;ot;){if(Rt=ot,zt(ot.key,_e)===0)return;ot=zt(ot.key,_e)<0?ot.right:ot.left}else for(;ot;)Rt=ot,ot=zt(ot.key,_e)<0?ot.right:ot.left;return ot={key:_e,data:ve,left:null,right:null,parent:Rt},Rt?zt(Rt.key,ot.key)<0?Rt.right=ot:Rt.left=ot:this._root=ot,this.splay(ot),this._size++,ot},f.prototype.find=function(_e){for(var ve=this._root,ot=this._compare;ve;){var Rt=ot(ve.key,_e);if(Rt<0)ve=ve.right;else{if(!(Rt>0))return ve;ve=ve.left}}return null},f.prototype.contains=function(_e){for(var ve=this._root,ot=this._compare;ve;){var Rt=ot(_e,ve.key);if(Rt===0)return!0;ve=Rt<0?ve.left:ve.right}return!1},f.prototype.remove=function(_e){var ve=this.find(_e);if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var ot=this.minNode(ve.right);ot.parent!==ve&&(this.replace(ot,ot.right),ot.right=ve.right,ot.right.parent=ot),this.replace(ve,ot),ot.left=ve.left,ot.left.parent=ot}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},f.prototype.removeNode=function(_e){if(!_e)return!1;if(this.splay(_e),_e.left)if(_e.right){var ve=this.minNode(_e.right);ve.parent!==_e&&(this.replace(ve,ve.right),ve.right=_e.right,ve.right.parent=ve),this.replace(_e,ve),ve.left=_e.left,ve.left.parent=ve}else this.replace(_e,_e.left);else this.replace(_e,_e.right);return this._size--,!0},f.prototype.erase=function(_e){var ve=this.find(_e);if(ve){this.splay(ve);var ot=ve.left,Rt=ve.right,zt=null;ot&&(ot.parent=null,zt=this.maxNode(ot),this.splay(zt),this._root=zt),Rt&&(ot?zt.right=Rt:this._root=Rt,Rt.parent=zt),this._size--}},f.prototype.pop=function(){var _e=this._root,ve=null;if(_e){for(;_e.left;)_e=_e.left;ve={key:_e.key,data:_e.data},this.remove(_e.key)}return ve},f.prototype.next=function(_e){var ve=_e;if(ve)if(ve.right)for(ve=ve.right;ve&&ve.left;)ve=ve.left;else for(ve=_e.parent;ve&&ve.right===_e;)_e=ve,ve=ve.parent;return ve},f.prototype.prev=function(_e){var ve=_e;if(ve)if(ve.left)for(ve=ve.left;ve&&ve.right;)ve=ve.right;else for(ve=_e.parent;ve&&ve.left===_e;)_e=ve,ve=ve.parent;return ve},f.prototype.forEach=function(_e){for(var ve=this._root,ot=[],Rt=!1,zt=0;!Rt;)ve?(ot.push(ve),ve=ve.left):ot.length>0?(_e(ve=ot.pop(),zt++),ve=ve.right):Rt=!0;return this},f.prototype.range=function(_e,ve,ot,Rt){for(var zt=[],Lt=this._compare,Jt=this._root;zt.length!==0||Jt;)if(Jt)zt.push(Jt),Jt=Jt.left;else{if(Lt((Jt=zt.pop()).key,ve)>0)break;if(Lt(Jt.key,_e)>=0&&ot.call(Rt,Jt))return this;Jt=Jt.right}return this},f.prototype.keys=function(){for(var _e=this._root,ve=[],ot=[],Rt=!1;!Rt;)_e?(ve.push(_e),_e=_e.left):ve.length>0?(_e=ve.pop(),ot.push(_e.key),_e=_e.right):Rt=!0;return ot},f.prototype.values=function(){for(var _e=this._root,ve=[],ot=[],Rt=!1;!Rt;)_e?(ve.push(_e),_e=_e.left):ve.length>0?(_e=ve.pop(),ot.push(_e.data),_e=_e.right):Rt=!0;return ot},f.prototype.at=function(_e){for(var ve=this._root,ot=[],Rt=!1,zt=0;!Rt;)if(ve)ot.push(ve),ve=ve.left;else if(ot.length>0){if(ve=ot.pop(),zt===_e)return ve;zt++,ve=ve.right}else Rt=!0;return null},f.prototype.load=function(_e,ve,ot){if(_e===void 0&&(_e=[]),ve===void 0&&(ve=[]),ot===void 0&&(ot=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Rt=_e.length;return ot&&S(_e,ve,0,Rt-1,this._compare),this._root=_(null,_e,ve,0,Rt),this._size=Rt,this},f.prototype.min=function(){var _e=this.minNode(this._root);return _e?_e.key:null},f.prototype.max=function(){var _e=this.maxNode(this._root);return _e?_e.key:null},f.prototype.isEmpty=function(){return this._root===null},y.size.get=function(){return this._size},f.createTree=function(_e,ve,ot,Rt,zt){return new f(ot,zt).load(_e,ve,Rt)},Object.defineProperties(f.prototype,y);var A=0,k=1,j=2,R=3,L=0,H=1,W=2,J=3;function Q(_e,ve,ot){ve===null?(_e.inOut=!1,_e.otherInOut=!0):(_e.isSubject===ve.isSubject?(_e.inOut=!ve.inOut,_e.otherInOut=ve.otherInOut):(_e.inOut=!ve.otherInOut,_e.otherInOut=ve.isVertical()?!ve.inOut:ve.inOut),ve&&(_e.prevInResult=!ae(ve,ot)||ve.isVertical()?ve.prevInResult:ve));var Rt=ae(_e,ot);_e.resultTransition=Rt?function(zt,Lt){var Jt,yr=!zt.inOut,Vr=!zt.otherInOut;switch(Lt){case L:Jt=yr&&Vr;break;case H:Jt=yr||Vr;break;case J:Jt=yr^Vr;break;case W:Jt=zt.isSubject?yr&&!Vr:Vr&&!yr}return Jt?1:-1}(_e,ot):0}function ae(_e,ve){switch(_e.type){case A:switch(ve){case L:return!_e.otherInOut;case H:return _e.otherInOut;case W:return _e.isSubject&&_e.otherInOut||!_e.isSubject&&!_e.otherInOut;case J:return!0}break;case j:return ve===L||ve===H;case R:return ve===W;case k:return!1}return!1}var de=function(_e,ve,ot,Rt,zt){this.left=ve,this.point=_e,this.otherEvent=ot,this.isSubject=Rt,this.type=zt||A,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},he={inResult:{configurable:!0}};function fe(_e,ve){return _e[0]===ve[0]&&_e[1]===ve[1]}de.prototype.isBelow=function(_e){var ve=this.point,ot=this.otherEvent.point;return this.left?(ve[0]-_e[0])*(ot[1]-_e[1])-(ot[0]-_e[0])*(ve[1]-_e[1])>0:(ot[0]-_e[0])*(ve[1]-_e[1])-(ve[0]-_e[0])*(ot[1]-_e[1])>0},de.prototype.isAbove=function(_e){return!this.isBelow(_e)},de.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},he.inResult.get=function(){return this.resultTransition!==0},de.prototype.clone=function(){var _e=new de(this.point,this.left,this.otherEvent,this.isSubject,this.type);return _e.contourId=this.contourId,_e.resultTransition=this.resultTransition,_e.prevInResult=this.prevInResult,_e.isExteriorRing=this.isExteriorRing,_e.inOut=this.inOut,_e.otherInOut=this.otherInOut,_e},Object.defineProperties(de.prototype,he);var Me=11102230246251565e-32,Ae=134217729,ke=(3+8*Me)*Me;function Le(_e,ve,ot,Rt,zt){var Lt,Jt,yr,Vr,$r=ve[0],jr=Rt[0],jn=0,gi=0;jr>$r==jr>-$r?(Lt=$r,$r=ve[++jn]):(Lt=jr,jr=Rt[++gi]);var Ir=0;if(jn<_e&&gi<ot)for(jr>$r==jr>-$r?(yr=Lt-((Jt=$r+Lt)-$r),$r=ve[++jn]):(yr=Lt-((Jt=jr+Lt)-jr),jr=Rt[++gi]),Lt=Jt,yr!==0&&(zt[Ir++]=yr);jn<_e&&gi<ot;)jr>$r==jr>-$r?(yr=Lt-((Jt=Lt+$r)-(Vr=Jt-Lt))+($r-Vr),$r=ve[++jn]):(yr=Lt-((Jt=Lt+jr)-(Vr=Jt-Lt))+(jr-Vr),jr=Rt[++gi]),Lt=Jt,yr!==0&&(zt[Ir++]=yr);for(;jn<_e;)yr=Lt-((Jt=Lt+$r)-(Vr=Jt-Lt))+($r-Vr),$r=ve[++jn],Lt=Jt,yr!==0&&(zt[Ir++]=yr);for(;gi<ot;)yr=Lt-((Jt=Lt+jr)-(Vr=Jt-Lt))+(jr-Vr),jr=Rt[++gi],Lt=Jt,yr!==0&&(zt[Ir++]=yr);return Lt===0&&Ir!==0||(zt[Ir++]=Lt),Ir}function Be(_e){return new Float64Array(_e)}var st=33306690738754716e-32,Ge=22204460492503146e-32,ft=11093356479670487e-47,wt=Be(4),xt=Be(8),At=Be(12),kt=Be(16),it=Be(4);function Tt(_e,ve,ot){var Rt=function(zt,Lt,Jt,yr,Vr,$r){var jr=(Lt-$r)*(Jt-Vr),jn=(zt-Vr)*(yr-$r),gi=jr-jn;if(jr===0||jn===0||jr>0!=jn>0)return gi;var Ir=Math.abs(jr+jn);return Math.abs(gi)>=st*Ir?gi:-function(ti,$n,An,di,Jn,Gn,Xn){var Mn,Rr,Rn,fi,dr,nn,Qn,vi,ri,Ki,zn,Gi,qa,zo,Io,Ha,ou,Xi,uo=ti-Jn,No=An-Jn,ma=$n-Gn,Yo=di-Gn;wt[0]=(Io=(vi=uo-(Qn=(nn=Ae*uo)-(nn-uo)))*(Ki=Yo-(ri=(nn=Ae*Yo)-(nn-Yo)))-((zo=uo*Yo)-Qn*ri-vi*ri-Qn*Ki))-((zn=Io-(ou=(vi=ma-(Qn=(nn=Ae*ma)-(nn-ma)))*(Ki=No-(ri=(nn=Ae*No)-(nn-No)))-((Ha=ma*No)-Qn*ri-vi*ri-Qn*Ki)))+(dr=Io-zn))+(dr-ou),wt[1]=(qa=zo-((Gi=zo+zn)-(dr=Gi-zo))+(zn-dr))-((zn=qa-Ha)+(dr=qa-zn))+(dr-Ha),wt[2]=Gi-((Xi=Gi+zn)-(dr=Xi-Gi))+(zn-dr),wt[3]=Xi;var iy=function(Yqe,e4){for(var t4=e4[0],yM=1;yM<4;yM++)t4+=e4[yM];return t4}(0,wt),yx=Ge*Xn;if(iy>=yx||-iy>=yx||(Mn=ti-(uo+(dr=ti-uo))+(dr-Jn),Rn=An-(No+(dr=An-No))+(dr-Jn),Rr=$n-(ma+(dr=$n-ma))+(dr-Gn),fi=di-(Yo+(dr=di-Yo))+(dr-Gn),Mn===0&&Rr===0&&Rn===0&&fi===0)||(yx=ft*Xn+ke*Math.abs(iy),(iy+=uo*fi+Yo*Mn-(ma*Rn+No*Rr))>=yx||-iy>=yx))return iy;it[0]=(Io=(vi=Mn-(Qn=(nn=Ae*Mn)-(nn-Mn)))*(Ki=Yo-(ri=(nn=Ae*Yo)-(nn-Yo)))-((zo=Mn*Yo)-Qn*ri-vi*ri-Qn*Ki))-((zn=Io-(ou=(vi=Rr-(Qn=(nn=Ae*Rr)-(nn-Rr)))*(Ki=No-(ri=(nn=Ae*No)-(nn-No)))-((Ha=Rr*No)-Qn*ri-vi*ri-Qn*Ki)))+(dr=Io-zn))+(dr-ou),it[1]=(qa=zo-((Gi=zo+zn)-(dr=Gi-zo))+(zn-dr))-((zn=qa-Ha)+(dr=qa-zn))+(dr-Ha),it[2]=Gi-((Xi=Gi+zn)-(dr=Xi-Gi))+(zn-dr),it[3]=Xi;var iae=Le(4,wt,4,it,xt);it[0]=(Io=(vi=uo-(Qn=(nn=Ae*uo)-(nn-uo)))*(Ki=fi-(ri=(nn=Ae*fi)-(nn-fi)))-((zo=uo*fi)-Qn*ri-vi*ri-Qn*Ki))-((zn=Io-(ou=(vi=ma-(Qn=(nn=Ae*ma)-(nn-ma)))*(Ki=Rn-(ri=(nn=Ae*Rn)-(nn-Rn)))-((Ha=ma*Rn)-Qn*ri-vi*ri-Qn*Ki)))+(dr=Io-zn))+(dr-ou),it[1]=(qa=zo-((Gi=zo+zn)-(dr=Gi-zo))+(zn-dr))-((zn=qa-Ha)+(dr=qa-zn))+(dr-Ha),it[2]=Gi-((Xi=Gi+zn)-(dr=Xi-Gi))+(zn-dr),it[3]=Xi;var oae=Le(iae,xt,4,it,At);it[0]=(Io=(vi=Mn-(Qn=(nn=Ae*Mn)-(nn-Mn)))*(Ki=fi-(ri=(nn=Ae*fi)-(nn-fi)))-((zo=Mn*fi)-Qn*ri-vi*ri-Qn*Ki))-((zn=Io-(ou=(vi=Rr-(Qn=(nn=Ae*Rr)-(nn-Rr)))*(Ki=Rn-(ri=(nn=Ae*Rn)-(nn-Rn)))-((Ha=Rr*Rn)-Qn*ri-vi*ri-Qn*Ki)))+(dr=Io-zn))+(dr-ou),it[1]=(qa=zo-((Gi=zo+zn)-(dr=Gi-zo))+(zn-dr))-((zn=qa-Ha)+(dr=qa-zn))+(dr-Ha),it[2]=Gi-((Xi=Gi+zn)-(dr=Xi-Gi))+(zn-dr),it[3]=Xi;var aae=Le(oae,At,4,it,kt);return kt[aae-1]}(zt,Lt,Jt,yr,Vr,$r,Ir)}(_e[0],_e[1],ve[0],ve[1],ot[0],ot[1]);return Rt>0?-1:Rt<0?1:0}function Xe(_e,ve){var ot=_e.point,Rt=ve.point;return ot[0]>Rt[0]?1:ot[0]<Rt[0]?-1:ot[1]!==Rt[1]?ot[1]>Rt[1]?1:-1:function(zt,Lt,Jt,yr){return zt.left!==Lt.left?zt.left?1:-1:Tt(Jt,zt.otherEvent.point,Lt.otherEvent.point)!==0?zt.isBelow(Lt.otherEvent.point)?-1:1:!zt.isSubject&&Lt.isSubject?1:-1}(_e,ve,ot)}function at(_e,ve,ot){var Rt=new de(ve,!1,_e,_e.isSubject),zt=new de(ve,!0,_e.otherEvent,_e.isSubject);return fe(_e.point,_e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",_e),Rt.contourId=zt.contourId=_e.contourId,Xe(zt,_e.otherEvent)>0&&(_e.otherEvent.left=!0,zt.left=!1),_e.otherEvent.otherEvent=zt,_e.otherEvent=Rt,ot.push(zt),ot.push(Rt),ot}function Mt(_e,ve){return _e[0]*ve[1]-_e[1]*ve[0]}function St(_e,ve){return _e[0]*ve[0]+_e[1]*ve[1]}function ar(_e,ve,ot){var Rt=function(Vr,$r,jr,jn,gi){var Ir=[$r[0]-Vr[0],$r[1]-Vr[1]],ti=[jn[0]-jr[0],jn[1]-jr[1]];function $n(nn,Qn,vi){return[nn[0]+Qn*vi[0],nn[1]+Qn*vi[1]]}var An=[jr[0]-Vr[0],jr[1]-Vr[1]],di=Mt(Ir,ti),Jn=di*di,Gn=St(Ir,Ir);if(Jn>0){var Xn=Mt(An,ti)/di;if(Xn<0||Xn>1)return null;var Mn=Mt(An,Ir)/di;return Mn<0||Mn>1?null:Xn===0||Xn===1?[$n(Vr,Xn,Ir)]:Mn===0||Mn===1?[$n(jr,Mn,ti)]:[$n(Vr,Xn,Ir)]}if((Jn=(di=Mt(An,Ir))*di)>0)return null;var Rr=St(Ir,An)/Gn,Rn=Rr+St(Ir,ti)/Gn,fi=Math.min(Rr,Rn),dr=Math.max(Rr,Rn);return fi<=1&&dr>=0?fi===1?[$n(Vr,fi>0?fi:0,Ir)]:dr===0?[$n(Vr,dr<1?dr:1,Ir)]:[$n(Vr,fi>0?fi:0,Ir),$n(Vr,dr<1?dr:1,Ir)]:null}(_e.point,_e.otherEvent.point,ve.point,ve.otherEvent.point),zt=Rt?Rt.length:0;if(zt===0||zt===1&&(fe(_e.point,ve.point)||fe(_e.otherEvent.point,ve.otherEvent.point))||zt===2&&_e.isSubject===ve.isSubject)return 0;if(zt===1)return fe(_e.point,Rt[0])||fe(_e.otherEvent.point,Rt[0])||at(_e,Rt[0],ot),fe(ve.point,Rt[0])||fe(ve.otherEvent.point,Rt[0])||at(ve,Rt[0],ot),1;var Lt=[],Jt=!1,yr=!1;return fe(_e.point,ve.point)?Jt=!0:Xe(_e,ve)===1?Lt.push(ve,_e):Lt.push(_e,ve),fe(_e.otherEvent.point,ve.otherEvent.point)?yr=!0:Xe(_e.otherEvent,ve.otherEvent)===1?Lt.push(ve.otherEvent,_e.otherEvent):Lt.push(_e.otherEvent,ve.otherEvent),Jt&&yr||Jt?(ve.type=k,_e.type=ve.inOut===_e.inOut?j:R,Jt&&!yr&&at(Lt[1].otherEvent,Lt[0].point,ot),2):yr?(at(Lt[0],Lt[1].point,ot),3):Lt[0]!==Lt[3].otherEvent?(at(Lt[0],Lt[1].point,ot),at(Lt[1],Lt[2].point,ot),3):(at(Lt[0],Lt[1].point,ot),at(Lt[3].otherEvent,Lt[2].point,ot),3)}function Kt(_e,ve){if(_e===ve)return 0;if(Tt(_e.point,_e.otherEvent.point,ve.point)!==0||Tt(_e.point,_e.otherEvent.point,ve.otherEvent.point)!==0)return fe(_e.point,ve.point)?_e.isBelow(ve.otherEvent.point)?-1:1:_e.point[0]===ve.point[0]?_e.point[1]<ve.point[1]?-1:1:Xe(_e,ve)===1?ve.isAbove(_e.point)?-1:1:_e.isBelow(ve.point)?-1:1;if(_e.isSubject!==ve.isSubject)return _e.isSubject?-1:1;var ot=_e.point,Rt=ve.point;return ot[0]===Rt[0]&&ot[1]===Rt[1]?(ot=_e.otherEvent.point)[0]===(Rt=ve.otherEvent.point)[0]&&ot[1]===Rt[1]?0:_e.contourId>ve.contourId?1:-1:Xe(_e,ve)===1?1:-1}var _t=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Pt(_e,ve,ot,Rt){var zt,Lt=_e+1,Jt=ve[_e].point,yr=ve.length;for(Lt<yr&&(zt=ve[Lt].point);Lt<yr&&zt[0]===Jt[0]&&zt[1]===Jt[1];){if(!ot[Lt])return Lt;++Lt<yr&&(zt=ve[Lt].point)}for(Lt=_e-1;ot[Lt]&&Lt>Rt;)Lt--;return Lt}_t.prototype.isExterior=function(){return this.holeOf==null};var rr=Nt,Bt=Nt;function Nt(_e,ve){if(!(this instanceof Nt))return new Nt(_e,ve);if(this.data=_e||[],this.length=this.data.length,this.compare=ve||qt,this.length>0)for(var ot=(this.length>>1)-1;ot>=0;ot--)this._down(ot)}function qt(_e,ve){return _e<ve?-1:_e>ve?1:0}Nt.prototype={push:function(_e){this.data.push(_e),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var _e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),_e}},peek:function(){return this.data[0]},_up:function(_e){for(var ve=this.data,ot=this.compare,Rt=ve[_e];_e>0;){var zt=_e-1>>1,Lt=ve[zt];if(ot(Rt,Lt)>=0)break;ve[_e]=Lt,_e=zt}ve[_e]=Rt},_down:function(_e){for(var ve=this.data,ot=this.compare,Rt=this.length>>1,zt=ve[_e];_e<Rt;){var Lt=1+(_e<<1),Jt=Lt+1,yr=ve[Lt];if(Jt<this.length&&ot(ve[Jt],yr)<0&&(Lt=Jt,yr=ve[Jt]),ot(yr,zt)>=0)break;ve[_e]=yr,_e=Lt}ve[_e]=zt}},rr.default=Bt;var pr=Math.max,gr=Math.min,Pr=0;function Ar(_e,ve,ot,Rt,zt,Lt){var Jt,yr,Vr,$r,jr,jn;for(Jt=0,yr=_e.length-1;Jt<yr;Jt++)if($r=_e[Jt+1],jr=new de(Vr=_e[Jt],!1,void 0,ve),jn=new de($r,!1,jr,ve),jr.otherEvent=jn,Vr[0]!==$r[0]||Vr[1]!==$r[1]){jr.contourId=jn.contourId=ot,Lt||(jr.isExteriorRing=!1,jn.isExteriorRing=!1),Xe(jr,jn)>0?jn.left=!0:jr.left=!0;var gi=Vr[0],Ir=Vr[1];zt[0]=gr(zt[0],gi),zt[1]=gr(zt[1],Ir),zt[2]=pr(zt[2],gi),zt[3]=pr(zt[3],Ir),Rt.push(jr),Rt.push(jn)}}var Qr=[];function Ur(_e,ve,ot){typeof _e[0][0][0]=="number"&&(_e=[_e]),typeof ve[0][0][0]=="number"&&(ve=[ve]);var Rt=function(Ir,ti,$n){var An=null;return Ir.length*ti.length==0&&($n===L?An=Qr:$n===W?An=Ir:$n!==H&&$n!==J||(An=Ir.length===0?ti:Ir)),An}(_e,ve,ot);if(Rt)return Rt===Qr?null:Rt;var zt=[1/0,1/0,-1/0,-1/0],Lt=[1/0,1/0,-1/0,-1/0],Jt=function(Ir,ti,$n,An,di){var Jn,Gn,Xn,Mn,Rr,Rn,fi=new rr(null,Xe);for(Xn=0,Mn=Ir.length;Xn<Mn;Xn++)for(Rr=0,Rn=(Jn=Ir[Xn]).length;Rr<Rn;Rr++)(Gn=Rr===0)&&Pr++,Ar(Jn[Rr],!0,Pr,fi,$n,Gn);for(Xn=0,Mn=ti.length;Xn<Mn;Xn++)for(Rr=0,Rn=(Jn=ti[Xn]).length;Rr<Rn;Rr++)Gn=Rr===0,di===W&&(Gn=!1),Gn&&Pr++,Ar(Jn[Rr],!1,Pr,fi,An,Gn);return fi}(_e,ve,zt,Lt,ot);if(Rt=function(Ir,ti,$n,An,di){var Jn=null;return($n[0]>An[2]||An[0]>$n[2]||$n[1]>An[3]||An[1]>$n[3])&&(di===L?Jn=Qr:di===W?Jn=Ir:di!==H&&di!==J||(Jn=Ir.concat(ti))),Jn}(_e,ve,zt,Lt,ot))return Rt===Qr?null:Rt;for(var yr=function(Ir){var ti,$n,An=function(Xn){var Mn,Rr,Rn,fi,dr=[];for(Rr=0,Rn=Xn.length;Rr<Rn;Rr++)((Mn=Xn[Rr]).left&&Mn.inResult||!Mn.left&&Mn.otherEvent.inResult)&&dr.push(Mn);for(var nn=!1;!nn;)for(nn=!0,Rr=0,Rn=dr.length;Rr<Rn;Rr++)Rr+1<Rn&&Xe(dr[Rr],dr[Rr+1])===1&&(fi=dr[Rr],dr[Rr]=dr[Rr+1],dr[Rr+1]=fi,nn=!1);for(Rr=0,Rn=dr.length;Rr<Rn;Rr++)(Mn=dr[Rr]).otherPos=Rr;for(Rr=0,Rn=dr.length;Rr<Rn;Rr++)(Mn=dr[Rr]).left||(fi=Mn.otherPos,Mn.otherPos=Mn.otherEvent.otherPos,Mn.otherEvent.otherPos=fi);return dr}(Ir),di={},Jn=[],Gn=function(){if(!di[ti]){var Xn=Jn.length,Mn=function(dr,nn,Qn){var vi=new _t;if(dr.prevInResult!=null){var ri=dr.prevInResult,Ki=ri.outputContourId;if(ri.resultTransition>0){var zn=nn[Ki];if(zn.holeOf!=null){var Gi=zn.holeOf;nn[Gi].holeIds.push(Qn),vi.holeOf=Gi,vi.depth=nn[Ki].depth}else nn[Ki].holeIds.push(Qn),vi.holeOf=Ki,vi.depth=nn[Ki].depth+1}else vi.holeOf=null,vi.depth=nn[Ki].depth}else vi.holeOf=null,vi.depth=0;return vi}(An[ti],Jn,Xn),Rr=function(dr){di[dr]=!0,dr<An.length&&An[dr]&&(An[dr].outputContourId=Xn)},Rn=ti,fi=ti;for(Mn.points.push(An[ti].point);Rr(Rn),Rr(Rn=An[Rn].otherPos),Mn.points.push(An[Rn].point),!((Rn=Pt(Rn,An,di,fi))==fi||Rn>=An.length)&&An[Rn];);Jn.push(Mn)}};for(ti=0,$n=An.length;ti<$n;ti++)Gn();return Jn}(function(Ir,ti,$n,An,di,Jn){for(var Gn,Xn,Mn,Rr=new f(Kt),Rn=[],fi=Math.min(An[2],di[2]);Ir.length!==0;){var dr=Ir.pop();if(Rn.push(dr),Jn===L&&dr.point[0]>fi||Jn===W&&dr.point[0]>An[2])break;if(dr.left){Xn=Gn=Rr.insert(dr),Gn=Gn!==(Mn=Rr.minNode())?Rr.prev(Gn):null,Xn=Rr.next(Xn);var nn=Gn?Gn.key:null;if(Q(dr,nn,Jn),Xn&&ar(dr,Xn.key,Ir)===2&&(Q(dr,nn,Jn),Q(Xn.key,dr,Jn)),Gn&&ar(Gn.key,dr,Ir)===2){var Qn=Gn;Q(nn,(Qn=Qn!==Mn?Rr.prev(Qn):null)?Qn.key:null,Jn),Q(dr,nn,Jn)}}else Xn=Gn=Rr.find(dr=dr.otherEvent),Gn&&Xn&&(Gn=Gn!==Mn?Rr.prev(Gn):null,Xn=Rr.next(Xn),Rr.remove(dr),Xn&&Gn&&ar(Gn.key,Xn.key,Ir))}return Rn}(Jt,0,0,zt,Lt,ot)),Vr=[],$r=0;$r<yr.length;$r++){var jr=yr[$r];if(jr.isExterior()){for(var jn=[jr.points],gi=0;gi<jr.holeIds.length;gi++)jn.push(yr[jr.holeIds[gi]].points);Vr.push(jn)}}return Vr}var Kn={UNION:H,DIFFERENCE:W,INTERSECTION:L,XOR:J};s.diff=function(_e,ve){return Ur(_e,ve,W)},s.intersection=function(_e,ve){return Ur(_e,ve,L)},s.operations=Kn,s.union=function(_e,ve){return Ur(_e,ve,H)},s.xor=function(_e,ve){return Ur(_e,ve,J)},Object.defineProperty(s,"__esModule",{value:!0})})(i)}(0,UN.exports)),UN.exports);/**
* martinez v0.7.4
* Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
*
* @author Alex Milevski <info@w8r.name>
* @license MIT
* @preserve
*/function TS(l,i,s,d){const f=[],y=d===0?(_,S,A,k,j,R)=>{_.push(new ut(R,A+(R-S)/(k-S)*(j-A)))}:(_,S,A,k,j,R)=>{_.push(new ut(S+(R-A)/(j-A)*(k-S),R))};for(const _ of l){const S=[];for(const A of _){if(A.length<=2)continue;const k=[];for(let L=0;L<A.length-1;L++){const H=A[L].x,W=A[L].y,J=A[L+1].x,Q=A[L+1].y,ae=d===0?H:W,de=d===0?J:Q;ae<i?de>i&&y(k,H,W,J,Q,i):ae>s?de<s&&y(k,H,W,J,Q,s):k.push(A[L]),de<i&&ae>=i&&y(k,H,W,J,Q,i),de>s&&ae<=s&&y(k,H,W,J,Q,s)}let j=A[A.length-1];const R=d===0?j.x:j.y;R>=i&&R<=s&&k.push(j),k.length&&(j=k[k.length-1],k[0].x===j.x&&k[0].y===j.y||k.push(k[0]),S.push(k))}S.length&&f.push(S)}return f}function ine(l,i){const s=fP(l),d=fP([i]),f=VN.intersection(s,d);return f==null?[]:$N(f)}function one(l,i){let s=fP(l,65536);for(;i.valid();i.next()){const[d,f]=i.get(),y=d.x*65536,_=d.y*65536,S=f.x*65536,A=f.y*65536,k=S-y,j=A-_,R=Math.hypot(k,j),L=Math.trunc(j/R*3),H=-Math.trunc(k/R*3);s=VN.diff(s,[[[y,_],[S,A],[S+L,A+H],[y+L,_+H],[y,_]]])}return $N(s,1/65536)}function fP(l,i=1){return[l.map(s=>s.map(d=>[d.x*i,d.y*i]))]}function $N(l,i=1){return l.map(s=>s.map((d,f)=>{const y=d.map(_=>new ut(_[0]*i,_[1]*i).round());return f>0&&y.reverse(),y}))}class pP{constructor(i,s){this.layoutVertexArray=new Ma,this.indexArray=new ii,this.lineIndexArray=new xl,this.triangleSegments=new ui,this.lineSegments=new ui,this.programConfigurations=new ls(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new Yu)}update(i,s,d,f,y,_,S,A){this.programConfigurations.updatePaintArrays(i,s,y,d,f,_,S,A)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,$re.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,Gre.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,s,d,f,y,_,S){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,s,d,f,y,_,void 0,S)}}class mP{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new pP(i,!1),this.elevationBufferData=new pP(i,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview}updateFootprints(i,s){}populate(i,s,d,f){this.hasPattern=hP("fill",this.layers,this.pixelRatio,s);const y=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:S,id:A,index:k,sourceLayerIndex:j}of i){const R=this.layers[0]._featureFilter.needGeometry,L=Ze(S,R);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),L,d))continue;const H=y?y.evaluate(L,{},d,s.availableImages):void 0,W={id:A,properties:S.properties,type:S.type,sourceLayerIndex:j,index:k,geometry:R?L.geometry:nt(S,d,f),patterns:{},sortKey:H};_.push(W)}y&&_.sort((S,A)=>S.sortKey-A.sortKey);for(const S of _){const{geometry:A,index:k,sourceLayerIndex:j}=S;if(this.hasPattern){const R=dP("fill",this.layers,S,this.zoom,this.pixelRatio,s);this.patternFeatures.push(R)}else this.addFeature(S,A,k,d,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(i[k].feature,A,k,j,this.index)}}update(i,s,d,f,y,_,S){this.bufferData.update(i,s,d,f,y,_,S,this.worldview),this.elevationBufferData.update(i,s,d,f,y,_,S,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,s,d,f,y,_,S,this.worldview)}addFeatures(i,s,d,f,y,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,s,d,f,_,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,s,d,f,y,_=[],S,A){const k=U0(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,k,f,d,A):this.addGeometry(k,this.bufferData),this.bufferData.populatePaintArrays(i,d,y,_,f,S,this.worldview),this.elevationBufferData.populatePaintArrays(i,d,y,_,f,S,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(i,s,d,f,y){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(s,d,f,y,this.worldview))}addElevatedRoadFeature(i,s,d,f,y){const _=new Array,S=rn.getElevationFeature(i,y);if(!S)return void this.addGeometry(s,this.bufferData);{const k=this.clipPolygonsToTile(s,1);k.length>0&&_.push({polygons:k,elevationFeature:S,elevationTileID:d})}const A={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},d),featureIndex:f};for(const k of _)if(k.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new us(k.elevationTileID,this.layers,this.zoom,this.lut));const R=k.elevationFeature.isTunnel();let L=0;i.properties.hasOwnProperty(nr)&&(L=+i.properties[nr]);for(const H of k.polygons)this.elevatedStructures.addPortalCandidates(k.elevationFeature.id,H,R,k.elevationFeature,L)}k.elevationFeature.constantHeight==null&&(k.polygons=this.prepareElevatedPolygons(k.polygons,k.elevationFeature,k.elevationTileID));const j=new xn(d,k.elevationTileID);this.addElevatedGeometry(k.polygons,j,k.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,f,A)}}addElevatedGeometry(i,s,d,f,y,_){const S={elevation:d,elevationSampler:s,bias:f,index:y,featureInfo:_},[A,k]=this.addGeometry(i,this.elevationBufferData,S);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:A,max:k}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,A),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,k))}addGeometry(i,s,d){let f=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,_=null;d&&(_=d.elevationSampler.constantElevation(d.elevation,d.bias),_!=null&&(f=_,y=_));const S=(A,k,j)=>{if(d!=null)if(k.push(A),_!=null)s.elevatedLayoutVertexArray.emplaceBack(_),j.push(_);else{const R=d.elevationSampler.pointElevation(A,d.elevation,d.bias);s.elevatedLayoutVertexArray.emplaceBack(R),j.push(R),f=Math.min(f,R),y=Math.max(y,R)}};for(const A of i){let k=0;for(const he of A)k+=he.length;const j=s.triangleSegments.prepareSegment(k,s.layoutVertexArray,s.indexArray),R=j.vertexLength,L=[],H=[],W=[],J=[],Q=[],ae=s.layoutVertexArray.length;for(const he of A){if(he.length===0)continue;he!==A[0]&&H.push(L.length/2);const fe=s.lineSegments.prepareSegment(he.length,s.layoutVertexArray,s.lineIndexArray),Me=fe.vertexLength;d&&Q.push(s.layoutVertexArray.length-ae),S(he[0],W,J),s.layoutVertexArray.emplaceBack(he[0].x,he[0].y),s.lineIndexArray.emplaceBack(Me+he.length-1,Me),L.push(he[0].x),L.push(he[0].y);for(let Ae=1;Ae<he.length;Ae++)S(he[Ae],W,J),s.layoutVertexArray.emplaceBack(he[Ae].x,he[Ae].y),s.lineIndexArray.emplaceBack(Me+Ae-1,Me+Ae),L.push(he[Ae].x),L.push(he[Ae].y);fe.vertexLength+=he.length,fe.primitiveLength+=he.length}const de=Vg(L,H);for(let he=0;he<de.length;he+=3)s.indexArray.emplaceBack(R+de[he],R+de[he+1],R+de[he+2]);if(de.length>0&&d&&this.elevationMode==="hd-road-base"){const he=d.elevation.isTunnel(),fe=d.elevation.safeArea,Me=this.elevatedStructures.addVertices(W,J);this.elevatedStructures.addTriangles(de,Me,he);const Ae=Q.length;if(Ae>0){for(let ke=0;ke<Ae-1;ke++)this.elevatedStructures.addRenderableRing(d.index,Q[ke]+Me,Q[ke+1]-Q[ke],he,fe,d.featureInfo);this.elevatedStructures.addRenderableRing(d.index,Q[Ae-1]+Me,W.length-Q[Ae-1],he,fe,d.featureInfo)}}j.vertexLength+=k,j.primitiveLength+=de.length/3}return[f,y]}prepareElevatedPolygons(i,s,d){const f=1/Ee(d),y=[];for(const _ of i){const S=one(_,new mn(s,f));y.push(...S)}return y}clipPolygonsToTile(i,s){const d=-s,f=-s,y=Dt+s,_=Dt+s;let S=0;const A=[],k=[];for(;S<i.length;S++){const L=i[S],H=Pv(L);(H.min.x>=d&&H.max.x<=y&&H.min.y>=f&&H.max.y<=_?A:k).push(L)}if(A.length===i.length)return i;const j=[new ut(d,f),new ut(y,f),new ut(y,_),new ut(d,_),new ut(d,f)],R=A;for(const L of k)R.push(...ine(L,j));return R}}let GN,qN,HN,WN;Wt(mP,"FillBucket",{omit:["layers","patternFeatures"]}),Wt(pP,"FillBufferData"),Wt(us,"ElevatedStructures");class ES{constructor(i,s,d,f){if(this.triangleCount=s.length/3,this.min=new ut(0,0),this.max=new ut(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[y,_]=[i[0].clone(),i[0].clone()];for(let R=1;R<i.length;++R){const L=i[R];y.x=Math.min(y.x,L.x),y.y=Math.min(y.y,L.y),_.x=Math.max(_.x,L.x),_.y=Math.max(_.y,L.y)}if(f){const R=Math.ceil(Math.max(_.x-y.x,_.y-y.y)/f);d=Math.max(d,R)}if(d===0)return;this.min=y,this.max=_;const S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);const A=Math.max(S.x,S.y)/d;this.cellsX=Math.max(1,Math.ceil(S.x/A)),this.cellsY=Math.max(1,Math.ceil(S.y/A)),this.xScale=1/A,this.yScale=1/A;const k=[];for(let R=0;R<this.triangleCount;R++){const L=i[s[3*R+0]].sub(this.min),H=i[s[3*R+1]].sub(this.min),W=i[s[3*R+2]].sub(this.min),J=nu(Math.floor(Math.min(L.x,H.x,W.x)),this.xScale,this.cellsX),Q=nu(Math.floor(Math.max(L.x,H.x,W.x)),this.xScale,this.cellsX),ae=nu(Math.floor(Math.min(L.y,H.y,W.y)),this.yScale,this.cellsY),de=nu(Math.floor(Math.max(L.y,H.y,W.y)),this.yScale,this.cellsY),he=new ut(0,0),fe=new ut(0,0),Me=new ut(0,0),Ae=new ut(0,0);for(let ke=ae;ke<=de;++ke){he.y=fe.y=ke*A,Me.y=Ae.y=(ke+1)*A;for(let Le=J;Le<=Q;++Le)he.x=Me.x=Le*A,fe.x=Ae.x=(Le+1)*A,(Xo(L,H,W,he,fe,Ae)||Xo(L,H,W,he,Ae,Me))&&k.push({cellIdx:ke*this.cellsX+Le,triIdx:R})}}if(k.length===0)return;k.sort((R,L)=>R.cellIdx-L.cellIdx||R.triIdx-L.triIdx);let j=0;for(;j<k.length;){const R=k[j].cellIdx,L={start:this.payload.length,len:0};for(;j<k.length&&k[j].cellIdx===R;)++L.len,this.payload.push(k[j++].triIdx);this.cells[R]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,s){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const d=nu(i.x-this.min.x,this.xScale,this.cellsX),f=nu(i.y-this.min.y,this.yScale,this.cellsY),y=this.cells[f*this.cellsX+d];if(y){this._lazyInitLookup();for(let _=0;_<y.len;_++){const S=this.payload[y.start+_],A=Math.floor(S/8),k=1<<S%8;if(!(this.lookup[A]&k)&&(this.lookup[A]|=k,s.push(S),s.length===this.triangleCount))return}}}query(i,s,d){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>s.x||i.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const f=nu(i.x-this.min.x,this.xScale,this.cellsX),y=nu(s.x-this.min.x,this.xScale,this.cellsX),_=nu(i.y-this.min.y,this.yScale,this.cellsY),S=nu(s.y-this.min.y,this.yScale,this.cellsY);for(let A=_;A<=S;A++)for(let k=f;k<=y;k++){const j=this.cells[A*this.cellsX+k];if(j)for(let R=0;R<j.len;R++){const L=this.payload[j.start+R],H=Math.floor(L/8),W=1<<L%8;if(!(this.lookup[H]&W)&&(this.lookup[H]|=W,d.push(L),d.length===this.triangleCount))return}}}}function nu(l,i,s){return Math.max(0,Math.min(s-1,Math.floor(l*i)))}Wt(ES,"TriangleGridIndex");class ZN{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=i.worldview}updateFootprints(i,s){for(const d of this.footprints)s.push({footprint:d,id:i})}populate(i,s,d,f){const y=[];for(const{feature:_,id:S,index:A,sourceLayerIndex:k}of i){const j=this.layers[0]._featureFilter.needGeometry,R=Ze(_,j);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),R,d))continue;const L={id:S,properties:_.properties,type:_.type,sourceLayerIndex:k,index:A,geometry:j?R.geometry:nt(_,d,f),patterns:{}};y.push(L)}for(const _ of y){const{geometry:S,index:A,sourceLayerIndex:k}=_;this.addFeature(_,S,A,d,{},s.availableImages,s.brightness),s.featureIndex.insert(i[A].feature,S,A,k,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,s,d,f,y,_,S){}destroy(){}addFeature(i,s,d,f,y,_=[],S){for(const A of U0(s,2)){const k=[],j=[],R=[],L=new ut(1/0,1/0),H=new ut(-1/0,-1/0);for(const Q of A)if(Q.length!==0){Q!==A[0]&&R.push(j.length/2);for(let ae=0;ae<Q.length;ae++)j.push(Q[ae].x),j.push(Q[ae].y),k.push(Q[ae]),L.x=Math.min(L.x,Q[ae].x),L.y=Math.min(L.y,Q[ae].y),H.x=Math.max(H.x,Q[ae].x),H.y=Math.max(H.y,Q[ae].y)}const W=Vg(j,R),J=new ES(k,W,8,256);this.footprints.push({vertices:k,indices:W,grid:J,min:L,max:H})}}}Wt(ZN,"ClipBucket",{omit:["layers"]});const ane=Yr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sne=Yr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),lne=Yr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),cne=Yr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),une=Yr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),hne=Yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:dne}=ane,V0=Number.MAX_SAFE_INTEGER,KN=V0-1;function XN(l,i,s,d){return l.order<i||l.order===V0||!(l.clipMask&s)||function(f,y){return y.length!==0&&y.find(_=>_===f)===void 0}(d,l.clipScope)}function AS(l,i){return l.x-i.x||l.y-i.y}function YN(l,i){return AS(l.min,i.min)===0&&AS(l.max,i.max)===0}function gP(l,i){return!(l.min.x>i.max.x||l.max.x<i.min.x||l.min.y>i.max.y||l.max.y<i.min.y)}function kS(l,i){if(l.length!==i.length)return!1;for(let s=0;s<l.length;s++)if(l[s].sourceId!==i[s].sourceId||!YN(l[s],i[s])||l[s].order!==i[s].order||l[s].clipMask!==i[s].clipMask||!Wn(l[s].clipScope,i[s].clipScope))return!1;return!0}function JN(l,i,s){const d=1/Dt,f=1/(1<<s.canonical.z),y=(i.x*d+s.canonical.x)*f+s.wrap,_=(i.y*d+s.canonical.y)*f;return{min:new ut((l.x*d+s.canonical.x)*f+s.wrap,(l.y*d+s.canonical.y)*f),max:new ut(y,_)}}function fne(l,i,s){const d=1<<s.canonical.z,f=((i.x-s.wrap)*d-s.canonical.x)*Dt,y=(i.y*d-s.canonical.y)*Dt;return{min:new ut(((l.x-s.wrap)*d-s.canonical.x)*Dt,(l.y*d-s.canonical.y)*Dt),max:new ut(f,y)}}function yP(l,i,s,d,f,y,_){const S=l.indices,A=l.vertices,k=[];for(let j=d;j<d+f;j+=3){const R=i[s[j+0]+y],L=i[s[j+1]+y],H=i[s[j+2]+y],W=Math.min(R.x,L.x,H.x),J=Math.max(R.x,L.x,H.x),Q=Math.min(R.y,L.y,H.y),ae=Math.max(R.y,L.y,H.y);k.length=0,l.grid.query(new ut(W,Q),new ut(J,ae),k);for(let de=0;de<k.length;de++){const he=k[de];if(Xo(A[S[3*he+0]],A[S[3*he+1]],A[S[3*he+2]],R,L,H,_))return!0}}return!1}function QN(l,i,s,d){if(!l||!s)return!1;let f=l.vertices;if(!i.canonical.equals(d.canonical)||i.wrap!==d.wrap){if(s.vertices.length<l.vertices.length)return QN(s,d,l,i);const y=i.canonical,_=d.canonical,S=Math.pow(2,_.z-y.z);f=l.vertices.map(A=>new ut((A.x+y.x*Dt)*S-_.x*Dt,(A.y+y.y*Dt)*S-_.y*Dt))}return yP(s,f,l.indices,0,l.indices.length,0,0)}function eF(l,i,s,d){const f=Math.pow(2,d.z-s.z);return new ut((l+s.x*Dt)*f-d.x*Dt,(i+s.y*Dt)*f-d.y*Dt)}function _P(l,i){const s=[];i.grid.queryPoint(l,s);const d=i.indices,f=i.vertices;for(let y=0;y<s.length;y++){const _=s[y];if(oi([f[d[3*_+0]],f[d[3*_+1]],f[d[3*_+2]]],l))return!0}return!1}const vP=[new ut(0,0),new ut(Dt,0),new ut(Dt,Dt),new ut(0,Dt)];function tF(l,i){const s=[];let d=[];if(!i||l.length<2)return[l];if(l.length===2)return Vn(l[0],l[1],vP)?[l]:[];for(let f=0;f<l.length+2;f++){const y=l[f%l.length],_=l[(f+1)%l.length],S=Vn(f===0?l[l.length-1]:l[(f-1)%l.length],y,vP),A=Vn(y,_,vP),k=S||A;k&&d.push(y),k&&A||d.length>0&&(d.length>1&&s.push(d),d=[])}return d.length>1&&s.push(d),s}const xP=yt.types,pne=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],mne=["fill-extrusion-flood-light-ground-radius"],gne=Math.pow(2,13),yne=Math.pow(2,15)-1,rF=new ut(0,1),Cd=2147483648;function $0(l,i,s,d,f,y,_,S){l.emplaceBack((i<<1)+_,(s<<1)+y,(Math.floor(d*gne)<<1)+f,Math.round(S))}function G0(l,i,s){l.emplaceBack(i.x*Dt,i.y*Dt,s?1:0)}function CS(l,i,s,d,f,y){l.emplaceBack(i.x,i.y,(s.x<<1)+d,(s.y<<1)+f,y)}function q0(l,i,s){l.emplaceBack(i.x,i.y,i.z,s[0]*16384,s[1]*16384,s[2]*16384)}class nF{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class iF{constructor(){this.centroidXY=new ut(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ut(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ut(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new ut(this.max.x-this.min.x,this.max.y-this.min.y)}}class oF{constructor(){this.acc=new ut(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,s){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=s.x,i.min.y=i.max.y=s.y)}appendEdge(i,s,d){this.accCount++,this.acc._add(s);let f=!!this.borders;s.x<i.min.x?(i.min.x=s.x,f=!0):s.x>i.max.x&&(i.max.x=s.x,f=!0),s.y<i.min.y?(i.min.y=s.y,f=!0):s.y>i.max.y&&(i.max.y=s.y,f=!0),((s.x===0||s.x===Dt)&&s.x===d.x)!=((s.y===0||s.y===Dt)&&s.y===d.y)&&this.processBorderOverlap(s,d),f&&this.checkBorderIntersection(s,d)}checkBorderIntersection(i,s){s.x<0!=i.x<0&&this.addBorderIntersection(0,lr(s.y,i.y,(0-s.x)/(i.x-s.x))),s.x>Dt!=i.x>Dt&&this.addBorderIntersection(1,lr(s.y,i.y,(Dt-s.x)/(i.x-s.x))),s.y<0!=i.y<0&&this.addBorderIntersection(2,lr(s.x,i.x,(0-s.y)/(i.y-s.y))),s.y>Dt!=i.y>Dt&&this.addBorderIntersection(3,lr(s.x,i.x,(Dt-s.y)/(i.y-s.y)))}addBorderIntersection(i,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[i];s<d[0]&&(d[0]=s),s>d[1]&&(d[1]=s)}processBorderOverlap(i,s){if(i.x===s.x){if(i.y===s.y)return;const d=i.x===0?0:1;this.addBorderIntersection(d,s.y),this.addBorderIntersection(d,i.y)}else{const d=i.y===0?2:3;this.addBorderIntersection(d,s.x),this.addBorderIntersection(d,i.x)}}centroid(){return this.accCount===0?new ut(0,0):new ut(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,s)=>i+ +(s[0]!==Number.MAX_VALUE),0):0}}function aF(l,i){const s=l.add(i)._unit(),d=xe(l.x*s.x+l.y*s.y,-1,1);var f,y,_;return f=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(f)))/4*yne*((y=l).x*(_=i).y-y.y*_.x<0?-1:1)}const _ne=[l=>l.x<0,l=>l.x>Dt,l=>l.y<0,l=>l.y>Dt];function vne(l,i,s,d){const f=[4];if(d===0)return f;s._mult(d);const y=l.sub(s),_=i.sub(s),S=[l,i,y,_];for(let A=0;A<4;A++)for(const k of S)if(_ne[A](k)){f.push(A);break}return f}class bP{constructor(i){this.vertexArray=new Ig,this.indexArray=new ii,this.programConfigurations=new ls(i.layers,{zoom:i.zoom,lut:i.lut},s=>mne.includes(s)),this._segments=new ui,this.hiddenByLandmarkVertexArray=new zg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ui}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,s,d,f=!1){const y=i.length;if(y>2){let _=Math.max(0,this._segments.get().length-1);const S=this._segments._prepareSegment(4*y,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let A;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const k=i[0],j=i[1];A=aF(k.sub(i[y-1])._perp()._unit(),j.sub(k)._perp()._unit())}for(let k=0;k<y;k++){const j=k===y-1?0:k+1,R=i[k],L=i[j],H=i[j===y-1?0:j+1],W=L.sub(R)._perp()._unit(),J=aF(W,H.sub(L)._perp()._unit()),Q=A,ae=J;if(wP(R,L,s)||f&&cF(R,s)&&cF(L,s)){A=J;continue}const de=S.vertexLength;CS(this.vertexArray,R,L,1,1,Q),CS(this.vertexArray,R,L,1,0,Q),CS(this.vertexArray,R,L,0,1,ae),CS(this.vertexArray,R,L,0,0,ae),S.vertexLength+=4;const he=vne(R,L,W,d);for(const fe of he)this._segmentToGroundQuads[_].push({id:de,region:fe}),this._segmentToRegionTriCounts[_][fe]+=2,S.primitiveLength+=2;A=J}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),s=i.length;for(let d=0;d<s;d++)this._segmentToGroundQuads[d].sort((f,y)=>f.region-y.region);for(let d=0;d<s;d++){const f=this._segmentToGroundQuads[d],y=i[d],_=this._segmentToRegionTriCounts[d];_.reduce((A,k)=>A+k,0);let S=0;for(let A=0;A<=4;A++){const k=_[A];if(k!==0){let j=this.regionSegments[A];j||(j=this.regionSegments[A]=new ui);const R={vertexOffset:y.vertexOffset,primitiveOffset:y.primitiveOffset+S,vertexLength:y.vertexLength,primitiveLength:k};j.get().push(R)}S+=k}for(let A=0;A<f.length;A++){const k=f[A].id;this.indexArray.emplaceBack(k,k+1,k+3),this.indexArray.emplaceBack(k,k+3,k+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,s,d,f,y,_,S){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,s,d,f,y,_,void 0,S)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,sne.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,s,d,f,y,_,S,A){this.hasData()&&this.programConfigurations.updatePaintArrays(i,s,d,f,y,_,S,A)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&Cd))}updateHiddenByLandmarkRange(i,s,d){if(!this.hasData())return;const f=s+i;if(s!==0){for(let y=i;y<f;++y)this.hiddenByLandmarkVertexArray.emplace(y,d?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,une.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const s=this.regionSegments[i];s&&s.destroy()}}}}class PS{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ii,this.footprintVertices=new Ma,this.footprintSegments=[],this.layoutVertexArray=new md,this.centroidVertexArray=new cS,this.wallVertexArray=new hS,this.indexArray=new ii,this.programConfigurations=new ls(i.layers,{zoom:i.zoom,lut:i.lut},s=>pne.includes(s)),this.segments=new ui,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new bP(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview}updateFootprints(i,s){}populate(i,s,d,f){this.features=[],this.hasPattern=hP("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ee(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:y,id:_,index:S,sourceLayerIndex:A}of i){const k=this.layers[0]._featureFilter.needGeometry,j=Ze(y,k);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),j,d))continue;const R={id:_,sourceLayerIndex:A,index:S,geometry:k?j.geometry:nt(y,d,f),properties:y.properties,type:y.type,patterns:{}},L=this.layoutVertexArray.length,H=xP[R.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:y.id,feature:dP("fill-extrusion",this.layers,R,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(const W of R.geometry)for(const J of tF(W,H))this.addFeature(y.id,R,[J],S,d,{},s.availableImages,f,s.brightness);else this.addFeature(y.id,R,R.geometry,S,d,{},s.availableImages,f,s.brightness);s.featureIndex.insert(y,R.geometry,S,A,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,s,d,f,y,_){for(const{featureId:S,feature:A}of this.features){const k=xP[A.type]==="Polygon",{geometry:j}=A;if(this.wallMode)for(const R of j)for(const L of tF(R,k))this.addFeature(S,A,[L],A.index,s,d,f,y,_);else this.addFeature(S,A,j,A.index,s,d,f,y,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,s,d,f,y,_,S){this.programConfigurations.updatePaintArrays(i,s,y,d,f,_,S,this.worldview),this.groundEffect.update(i,s,y,d,f,_,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,dne),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,cne.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,hne.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,lne.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,s,d,f,y,_,S,A,k){const j=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,R=[new ut(0,0),new ut(Dt,Dt)],L=A.projection,H=L.name==="globe",W=this.wallMode||xP[s.type]==="Polygon",J=new oF;J.centroidDataIndex=this.centroidData.length;const Q=new iF;Q.buildingId=i,s.properties&&s.properties.hasOwnProperty("building_id")&&(Q.buildingId=s.properties.building_id);const ae=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},y)<=0,de=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},y);let he;if(Q.height=de,Q.vertexArrayOffset=this.layoutVertexArray.length,Q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,H&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new jg),this.wallMode){if(H)return void Wr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(d.length!==1)return;he=function(Ge){const ft=Ge[0].x===Ge[Ge.length-1].x&&Ge[0].y===Ge[Ge.length-1].y;(function(_t){let Pt=0;const rr=_t.length;for(let Bt=0;Bt<rr;Bt++)Pt+=(_t[(Bt+1)%rr].x-_t[Bt].x)*(_t[(Bt+1)%rr].y+_t[Bt].y);return Pt>=0})(Ge)||(Ge=Ge.reverse());const wt={geometry:[],joinNormals:[],indices:[]},xt=[],At=[],kt=[];let it=Ge.length;for(;it>=2&&Ge[it-1].equals(Ge[it-2]);)it--;if(it<(ft?3:2))return wt;let Tt,Xe,at,Mt,St,ar=0;for(;ar<it-1&&Ge[ar].equals(Ge[ar+1]);)ar++;ft&&(Tt=Ge[it-2],St=Ge[ar].sub(Tt)._unit()._perp());for(let _t=ar;_t<it;_t++){if(at=_t===it-1?ft?Ge[ar+1]:void 0:Ge[_t+1],at&&Ge[_t].equals(at))continue;St&&(Mt=St),Tt&&(Xe=Tt),Tt=Ge[_t],St=at?at.sub(Tt)._unit()._perp():Mt,Mt=Mt||St;let Pt=Mt.add(St);Pt.x===0&&Pt.y===0||Pt._unit();const rr=Pt.x*St.x+Pt.y*St.y,Bt=rr!==0?1/rr:1/0,Nt=Mt.x*St.y-Mt.y*St.x>0;let qt="miter";const pr=2;qt==="miter"&&Bt>pr&&(qt="bevel"),qt==="bevel"&&(Bt>100&&(qt="flipbevel"),Bt<pr&&(qt="miter"));const gr=(Pr,Ar,Qr,Ur)=>{const Kn=new ut(Pr.x,Pr.y),_e=new ut(Pr.x,Pr.y);Kn.x+=Ar.x*Ur,Kn.y+=Ar.y*Ur,_e.x-=Ar.x*Math.max(Qr,1),_e.y-=Ar.y*Math.max(Qr,1),kt.push(Ar),xt.push(Kn),At.push(_e)};if(qt==="miter")Pt._mult(Bt),gr(Tt,Pt,0,0);else if(qt==="flipbevel")Pt=St.mult(-1),gr(Tt,Pt,0,0),gr(Tt,Pt.mult(-1),0,0);else{const Pr=-Math.sqrt(Bt*Bt-1),Ar=Nt?Pr:0,Qr=Nt?0:Pr;Xe&&gr(Tt,Mt,Ar,Qr),at&&gr(Tt,St,Ar,Qr)}}wt.geometry=[...xt,...At.reverse(),xt[0]],wt.joinNormals=[...kt,...kt.reverse(),kt[kt.length-1]];const Kt=wt.geometry.length-1;for(let _t=0;_t<Kt/2;_t++)if(_t+1<Kt/2){let Pt=_t,rr=_t+1,Bt=Kt-1-_t,Nt=Kt-2-_t;Pt=Pt===0?Kt-1:Pt-1,rr=rr===0?Kt-1:rr-1,Bt=Bt===0?Kt-1:Bt-1,Nt=Nt===0?Kt-1:Nt-1,wt.indices.push(Bt),wt.indices.push(rr),wt.indices.push(Pt),wt.indices.push(Bt),wt.indices.push(Nt),wt.indices.push(rr)}return wt}(d[0]),d=[he.geometry]}const fe=(Ge,ft)=>Ge<(ft.length-1)/2||Ge===ft.length-1,Me=this.wallMode?[d]:U0(d,500);for(let Ge=Me.length-1;Ge>=0;Ge--){const ft=Me[Ge];(ft.length===0||(Ae=ft[0]).every(wt=>wt.x<=0)||Ae.every(wt=>wt.x>=Dt)||Ae.every(wt=>wt.y<=0)||Ae.every(wt=>wt.y>=Dt))&&Me.splice(Ge,1)}var Ae;let ke;if(H)ke=fF(Me,R,y);else{ke=[];for(const Ge of Me)ke.push({polygon:Ge,bounds:R})}const Le=W?this.edgeRadius:0,Be=Le>0&&this.zoom<17,st=(Ge,ft)=>{if(Ge.length===0)return!1;const wt=Ge[Ge.length-1];return ft.x===wt.x&&ft.y===wt.y};for(const{polygon:Ge,bounds:ft}of ke){let wt=0,xt=0;for(const Tt of Ge)W&&!Tt[0].equals(Tt[Tt.length-1])&&Tt.push(Tt[0]),xt+=W?Tt.length-1:Tt.length;const At=this.segments.prepareSegment((W?5:4)*xt,this.layoutVertexArray,this.indexArray);Q.footprintSegIdx<0&&(Q.footprintSegIdx=this.footprintSegments.length),Q.polygonSegIdx<0&&(Q.polygonSegIdx=this.polygonSegments.length);const kt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},it=new nF;if(it.vertexOffset=this.footprintVertices.length,it.indexOffset=3*this.footprintIndices.length,it.ringIndices=[],W){const Tt=[],Xe=[];wt=At.vertexLength;for(let Mt=0;Mt<Ge.length;Mt++){const St=Ge[Mt];St.length&&Mt!==0&&Xe.push(Tt.length/2);const ar=[];let Kt,_t;Kt=St[1].sub(St[0])._perp()._unit(),it.ringIndices.push(St.length-1);for(let Pt=1;Pt<St.length;Pt++){const rr=St[Pt],Bt=St[Pt===St.length-1?1:Pt+1],Nt=rr.clone();if(Le){_t=Bt.sub(rr)._perp()._unit();const qt=Kt.add(_t)._unit(),pr=Le*Math.min(4,1/(Kt.x*qt.x+Kt.y*qt.y));Nt.x+=pr*qt.x,Nt.y+=pr*qt.y,Nt.x=Math.round(Nt.x),Nt.y=Math.round(Nt.y),Kt=_t}if(!ae||Le!==0&&!Be||st(ar,Nt)||ar.push(Nt),$0(this.layoutVertexArray,Nt.x,Nt.y,0,0,1,1,0),this.wallMode){const qt=fe(Pt,St);G0(this.wallVertexArray,he.joinNormals[Pt],!qt)}At.vertexLength++,this.footprintVertices.emplaceBack(rr.x,rr.y),Tt.push(rr.x,rr.y),H&&q0(this.layoutVertexExtArray,L.projectTilePoint(Nt.x,Nt.y,y),L.upVector(y,Nt.x,Nt.y))}ae&&(Le===0||Be)&&(ar.length!==0&&st(ar,ar[0])&&ar.pop(),this.groundEffect.addData(ar,ft,j))}const at=this.wallMode?he.indices:Vg(Tt,Xe);for(let Mt=0;Mt<at.length;Mt+=3)this.footprintIndices.emplaceBack(it.vertexOffset+at[Mt+0],it.vertexOffset+at[Mt+1],it.vertexOffset+at[Mt+2]),this.indexArray.emplaceBack(wt+at[Mt],wt+at[Mt+2],wt+at[Mt+1]),At.primitiveLength++;it.indexCount+=at.length,it.vertexCount+=this.footprintVertices.length-it.vertexOffset}for(let Tt=0;Tt<Ge.length;Tt++){const Xe=Ge[Tt];J.startRing(Q,Xe[0]);let at=Xe.length>4&&uF(Xe[Xe.length-2],Xe[0],Xe[1]),Mt=Le?xne(Xe[Xe.length-2],Xe[0],Xe[1],Le):0;const St=[];let ar,Kt,_t;Kt=Xe[1].sub(Xe[0])._perp()._unit();let Pt=!0;for(let rr=1,Bt=0;rr<Xe.length;rr++){let Nt=Xe[rr-1],qt=Xe[rr];const pr=Xe[rr===Xe.length-1?1:rr+1];if(J.appendEdge(Q,qt,Nt),wP(qt,Nt,ft)){Le&&(Kt=pr.sub(qt)._perp()._unit(),Pt=!Pt);continue}const gr=qt.sub(Nt)._perp(),Pr=gr.x/(Math.abs(gr.x)+Math.abs(gr.y)),Ar=gr.y>0?1:0,Qr=Nt.dist(qt);if(Bt+Qr>32768&&(Bt=0),Le){_t=pr.sub(qt)._perp()._unit();let ve=lF(Nt,qt,pr,sF(Kt,_t),Le);isNaN(ve)&&(ve=0);const ot=qt.sub(Nt)._unit();Nt=Nt.add(ot.mult(Mt))._round(),qt=qt.add(ot.mult(-ve))._round(),Mt=ve,Kt=_t,ae&&this.zoom>=17&&(st(St,Nt)||St.push(Nt),st(St,qt)||St.push(qt))}const Ur=At.vertexLength,Kn=Xe.length>4&&uF(Nt,qt,pr);let _e=hF(Bt,at,Pt);if($0(this.layoutVertexArray,Nt.x,Nt.y,Pr,Ar,0,0,_e),$0(this.layoutVertexArray,Nt.x,Nt.y,Pr,Ar,0,1,_e),this.wallMode){const ve=fe(rr-1,Xe),ot=he.joinNormals[rr-1];G0(this.wallVertexArray,ot,ve),G0(this.wallVertexArray,ot,ve)}if(Bt+=Qr,_e=hF(Bt,Kn,!Pt),at=Kn,$0(this.layoutVertexArray,qt.x,qt.y,Pr,Ar,0,0,_e),$0(this.layoutVertexArray,qt.x,qt.y,Pr,Ar,0,1,_e),this.wallMode){const ve=fe(rr,Xe),ot=he.joinNormals[rr];G0(this.wallVertexArray,ot,ve),G0(this.wallVertexArray,ot,ve)}if(At.vertexLength+=4,this.indexArray.emplaceBack(Ur+0,Ur+1,Ur+2),this.indexArray.emplaceBack(Ur+1,Ur+3,Ur+2),At.primitiveLength+=2,Le){const ve=wt+(rr===1?Xe.length-2:rr-2),ot=rr===1?wt:ve+1;if(this.indexArray.emplaceBack(Ur+1,ve,Ur+3),this.indexArray.emplaceBack(ve,ot,Ur+3),At.primitiveLength+=2,ar===void 0&&(ar=Ur),!wP(pr,Xe[rr],ft)){const Rt=rr===Xe.length-1?ar:At.vertexLength;this.indexArray.emplaceBack(Ur+2,Ur+3,Rt),this.indexArray.emplaceBack(Ur+3,Rt+1,Rt),this.indexArray.emplaceBack(Ur+3,ot,Rt+1),At.primitiveLength+=3}Pt=!Pt}if(H){const ve=this.layoutVertexExtArray,ot=L.projectTilePoint(Nt.x,Nt.y,y),Rt=L.projectTilePoint(qt.x,qt.y,y),zt=L.upVector(y,Nt.x,Nt.y),Lt=L.upVector(y,qt.x,qt.y);q0(ve,ot,zt),q0(ve,ot,zt),q0(ve,Rt,Lt),q0(ve,Rt,Lt)}}W&&(wt+=Xe.length-1),ae&&Le&&this.zoom>=17&&(St.length!==0&&st(St,St[0])&&St.pop(),this.groundEffect.addData(St,ft,j,Le>0))}this.footprintSegments.push(it),kt.triangleCount=this.indexArray.length-kt.triangleArrayOffset,this.polygonSegments.push(kt),++Q.footprintSegLen,++Q.polygonSegLen}if(Q.vertexCount=this.layoutVertexArray.length-Q.vertexArrayOffset,Q.groundVertexCount=this.groundEffect.vertexArray.length-Q.groundVertexArrayOffset,Q.vertexCount!==0){if(Q.centroidXY=J.borders?rF:this.encodeCentroid(J,Q),this.centroidData.push(Q),J.borders){this.featuresOnBorder.push(J);const Ge=this.featuresOnBorder.length-1;for(let ft=0;ft<J.borders.length;ft++)J.borders[ft][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ft].push(Ge)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,_,S,y,k,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,f,_,S,y,k,this.worldview),this.maxHeight=Math.max(this.maxHeight,de)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((s,d)=>this.featuresOnBorder[s].borders[i][0]-this.featuresOnBorder[d].borders[i][0])}splitToSubtiles(){const i=[];for(let S=0;S<this.centroidData.length;S++){const A=this.centroidData[S],k=+(A.min.y+A.max.y>Dt),j=2*k+(+(A.min.x+A.max.x>Dt)^k);for(let R=0;R<A.polygonSegLen;R++){const L=A.polygonSegIdx+R;i.push({centroidIdx:S,subtile:j,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const s=new ii;i.sort((S,A)=>S.triangleSegmentIdx===A.triangleSegmentIdx?S.subtile-A.subtile:S.triangleSegmentIdx-A.triangleSegmentIdx);let d=0,f=0,y=0;for(const S of i){if(S.triangleSegmentIdx!==d)break;y++}const _=i.length;for(;f!==i.length;){d=i[f].triangleSegmentIdx;let S=0,A=f,k=f;for(let j=A;j<y&&i[j].subtile===S;j++)k++;for(;A!==y;){const j=i[A];S=j.subtile;const R=this.centroidData[j.centroidIdx].min.clone(),L=this.centroidData[j.centroidIdx].max.clone(),H={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let W=A;W<k;W++){const J=i[W],Q=this.polygonSegments[J.polygonSegmentIdx],ae=this.centroidData[J.centroidIdx].min,de=this.centroidData[J.centroidIdx].max,he=this.indexArray.uint16;for(let fe=Q.triangleArrayOffset;fe<Q.triangleArrayOffset+Q.triangleCount;fe++)s.emplaceBack(he[3*fe],he[3*fe+1],he[3*fe+2]);H.primitiveLength+=Q.triangleCount,R.x=Math.min(R.x,ae.x),R.y=Math.min(R.y,ae.y),L.x=Math.max(L.x,de.x),L.y=Math.max(L.y,de.y)}H.primitiveLength>0&&this.triangleSubSegments.push({segment:H,min:R,max:L}),A=k;for(let W=A;W<y&&i[W].subtile===i[A].subtile;W++)k++}f=y;for(let j=f;j<_&&i[j].triangleSegmentIdx===i[f].triangleSegmentIdx;j++)y++}s._trim(),this.indexArray=s}getVisibleSegments(i,s,d){const f=new ui;if(this.wallMode){for(const J of this.triangleSubSegments)f.segments.push(J.segment);return f}let y=0,_=0;const S=1<<i.canonical.z;if(s){const J=s.getMinMaxForTile(i);J&&(y=J.min,_=J.max)}_+=this.maxHeight;const A=i.toUnwrapped();let k;const j=[A.canonical.x/S+A.wrap,A.canonical.y/S],R=[(A.canonical.x+1)/S+A.wrap,(A.canonical.y+1)/S],L=(J,Q,ae)=>[J[0]*(1-ae[0])+Q[0]*ae[0],J[1]*(1-ae[1])+Q[1]*ae[1]],H=[],W=[];for(const J of this.triangleSubSegments){H[0]=J.min.x/Dt,H[1]=J.min.y/Dt,W[0]=J.max.x/Dt,W[1]=J.max.y/Dt;const Q=L(j,R,H),ae=L(j,R,W);if(new kr([Q[0],Q[1],y],[ae[0],ae[1],_]).intersectsPrecise(d)===0){k&&(f.segments.push(k),k=void 0);continue}const de=J.segment;k&&k.vertexOffset!==de.vertexOffset&&(f.segments.push(k),k=void 0),k?(k.vertexLength+=de.vertexLength,k.primitiveLength+=de.primitiveLength):k={vertexOffset:de.vertexOffset,primitiveLength:de.primitiveLength,vertexLength:de.vertexLength,primitiveOffset:de.primitiveOffset,sortKey:void 0,vaos:{}}}return k&&f.segments.push(k),f}encodeCentroid(i,s){const d=i.centroid(),f=s.span(),y=Math.min(7,Math.round(f.x*this.tileToMeter/10)),_=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new ut(xe(d.x,1,Dt-1)<<3|y,xe(d.y,1,Dt-1)<<3|_)}encodeBorderCentroid(i){if(!i.borders)return new ut(0,0);const s=i.borders,d=Number.MAX_VALUE;if(s[0][0]!==d||s[1][0]!==d){const f=s[0][0]!==d?0:1;return new ut(6|(s[0][0]!==d?0:65528),(s[f][0]+s[f][1])/2<<3|6)}{const f=s[2][0]!==d?2:3;return new ut((s[f][0]+s[f][1])/2<<3|6,6|(s[2][0]!==d?0:65528))}}showCentroid(i){const s=this.centroidData[i.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const s=i.vertexArrayOffset,d=i.vertexCount+i.vertexArrayOffset,f=i.flags&Cd?rF:i.centroidXY,y=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==f.y||y!==f.x){for(let _=s;_<d;++_)this.centroidVertexArray.emplace(_,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,s,d){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const f=s.getReplacementRegionsForTile(i.toUnwrapped());if(kS(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const y=[];for(const _ of this.activeReplacements){if(_.order<d)continue;const S=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));if(_.footprint.buildingId){const A=_.footprint.buildingId;for(const k of this.centroidData)k.buildingId===A&&(k.flags|=Cd)}else for(const A of this.centroidData)if(!(A.flags&Cd||_.min.x>A.max.x||A.min.x>_.max.x||_.min.y>A.max.y||A.min.y>_.max.y))for(let k=0;k<A.footprintSegLen;k++){const j=this.footprintSegments[A.footprintSegIdx+k];if(y.length=0,bne(this.footprintVertices,j.vertexOffset,j.vertexCount,_.footprintTileId.canonical,i.canonical,y),yP(_.footprint,y,this.footprintIndices.uint16,j.indexOffset,j.indexCount,-j.vertexOffset,-S)){A.flags|=Cd;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,s,d){let f=!1;for(let y=0;y<d.footprintSegLen;y++){const _=this.footprintSegments[d.footprintSegIdx+y];let S=0;for(const A of _.ringIndices){for(let k=S,j=A+S-1;k<A+S;j=k++){const R=this.footprintVertices.int16[2*(k+_.vertexOffset)+0],L=this.footprintVertices.int16[2*(k+_.vertexOffset)+1],H=this.footprintVertices.int16[2*(j+_.vertexOffset)+1];L>s!=H>s&&i<(this.footprintVertices.int16[2*(j+_.vertexOffset)+0]-R)*(s-L)/(H-L)+R&&(f=!f)}S=A}}return f}getHeightAtTileCoord(i,s){let d=Number.NEGATIVE_INFINITY,f=!0;const y=4*(i+Dt)*Dt+(s+Dt);if(this.partLookup.hasOwnProperty(y)){const _=this.partLookup[y];return _?{height:_.height,hidden:!!(_.flags&Cd)}:void 0}for(const _ of this.centroidData)i>_.max.x||_.min.x>i||s>_.max.y||_.min.y>s||_.height<=d||this.footprintContainsPoint(i,s,_)&&(d=_.height,this.partLookup[y]=_,f=!!(_.flags&Cd));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:f};this.partLookup[y]=void 0}}function sF(l,i){const s=l.add(i)._unit();return l.x*s.x+l.y*s.y}function xne(l,i,s,d){const f=i.sub(l)._perp()._unit(),y=s.sub(i)._perp()._unit();return lF(l,i,s,sF(f,y),d)}function lF(l,i,s,d,f){const y=Math.sqrt(1-d*d);return Math.min(l.dist(i)/3,i.dist(s)/3,f*y/d)}function wP(l,i,s){return l.x<s[0].x&&i.x<s[0].x||l.x>s[1].x&&i.x>s[1].x||l.y<s[0].y&&i.y<s[0].y||l.y>s[1].y&&i.y>s[1].y}function cF(l,i){return l.x<i[0].x||l.x>i[1].x||l.y<i[0].y||l.y>i[1].y}function uF(l,i,s){if(l.x<0||l.x>=Dt||i.x<0||i.x>=Dt||s.x<0||s.x>=Dt)return!1;const d=s.sub(i),f=d.perp(),y=l.sub(i);return(d.x*y.x+d.y*y.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(y.x*y.x+y.y*y.y))>-.866&&f.x*y.x+f.y*y.y<0}function hF(l,i,s){const d=i?2|l:-3&l;return s?1|d:-2&d}function dF(){const l=Math.PI/32,i=Math.tan(l),s=z;return s*Math.sqrt(1+2*i*i)-s}function fF(l,i,s){const d=1<<s.z,f=pe(s.x/d),y=pe((s.x+1)/d),_=me(s.y/d),S=me((s.y+1)/d);return function(A,k,j,R,L=0,H){const W=[];if(!A.length||!j||!R)return W;const J=(Ae,ke)=>{for(const Le of Ae)W.push({polygon:Le,bounds:ke})},Q=Math.ceil(Math.log2(j)),ae=Math.ceil(Math.log2(R)),de=Q-ae,he=[];for(let Ae=0;Ae<Math.abs(de);Ae++)he.push(de>0?0:1);for(let Ae=0;Ae<Math.min(Q,ae);Ae++)he.push(0),he.push(1);let fe=A;if(fe=TS(fe,k[0].y-L,k[1].y+L,1),fe=TS(fe,k[0].x-L,k[1].x+L,0),!fe.length)return W;const Me=[];for(he.length?Me.push({polygons:fe,bounds:k,depth:0}):J(fe,k);Me.length;){const Ae=Me.pop(),ke=Ae.depth,Le=he[ke],Be=Ae.bounds[0],st=Ae.bounds[1],Ge=Le===0?Be.x:Be.y,ft=Le===0?st.x:st.y,wt=H?H(Le,Ge,ft):.5*(Ge+ft),xt=TS(Ae.polygons,Ge-L,wt+L,Le),At=TS(Ae.polygons,wt-L,ft+L,Le);if(xt.length){const kt=[Be,new ut(Le===0?wt:st.x,Le===1?wt:st.y)];he.length>ke+1?Me.push({polygons:xt,bounds:kt,depth:ke+1}):J(xt,kt)}if(At.length){const kt=[new ut(Le===0?wt:Be.x,Le===1?wt:Be.y),st];he.length>ke+1?Me.push({polygons:At,bounds:kt,depth:ke+1}):J(At,kt)}}return W}(l,i,Math.ceil((y-f)/11.25),Math.ceil((_-S)/11.25),1,(A,k,j)=>{if(A===0)return .5*(k+j);{const R=me((s.y+k/Dt)/d);return(ie(.5*(me((s.y+j/Dt)/d)+R))*d-s.y)*Dt}})}function bne(l,i,s,d,f,y){const _=Math.pow(2,d.z-f.z);for(let S=0;S<s;S++){let A=l.int16[2*(S+i)+0],k=l.int16[2*(S+i)+1];A=(A+f.x*Dt)*_-d.x*Dt,k=(k+f.y*Dt)*_-d.y*Dt,y.push(new ut(A,k))}}let pF,mF;Wt(PS,"FillExtrusionBucket",{omit:["layers","features"]}),Wt(iF,"PartData"),Wt(nF,"FootprintSegment"),Wt(oF,"BorderCentroidData"),Wt(bP,"GroundEffect");class wp extends ut{constructor(i,s,d){super(i,s),this.z=d}}class gF extends wp{constructor(i,s,d,f){super(i,s,d),this.w=f}}function yF(l,i,s,d){const f=s==="x"?"y":"x",y=(d-l[s])/(i[s]-l[s]);l[f]=Math.round(l[f]+(i[f]-l[f])*y),l[s]=d,l.hasOwnProperty("z")&&(l.z=lr(l.z,i.z,y)),l.hasOwnProperty("w")&&(l.w=lr(l.w,i.w,y))}function _F(l,i,s,d){const f=s,y=d;for(const _ of["x","y"]){let S=l,A=i;S[_]>=A[_]&&(S=i,A=l),S[_]<f&&A[_]>f&&yF(S,A,_,f),S[_]<y&&A[_]>y&&yF(A,S,_,y)}}function MS(l,i,s,d,f,y){const _=[];for(let S=0;S<l.length;S++){const A=l[S];let k;const j=_.length;let R=0;for(let L=0;L<A.length-1;L++){let H=A[L],W=A[L+1],J=0;const Q=R;let ae,de;y&&(J=Math.hypot(W.x-H.x,W.y-H.y),R+=J,ae=H,de=W),H.x<i&&W.x<i||(H.x<i?H=new ut(i,H.y+(i-H.x)/(W.x-H.x)*(W.y-H.y))._round():W.x<i&&(W=new ut(i,H.y+(i-H.x)/(W.x-H.x)*(W.y-H.y))._round()),H.y<s&&W.y<s||(H.y<s?H=new ut(H.x+(s-H.y)/(W.y-H.y)*(W.x-H.x),s)._round():W.y<s&&(W=new ut(H.x+(s-H.y)/(W.y-H.y)*(W.x-H.x),s)._round()),H.x>=d&&W.x>=d||(H.x>=d?H=new ut(d,H.y+(d-H.x)/(W.x-H.x)*(W.y-H.y))._round():W.x>=d&&(W=new ut(d,H.y+(d-H.x)/(W.x-H.x)*(W.y-H.y))._round()),H.y>=f&&W.y>=f||(H.y>=f?H=new ut(H.x+(f-H.y)/(W.y-H.y)*(W.x-H.x),f)._round():W.y>=f&&(W=new ut(H.x+(f-H.y)/(W.y-H.y)*(W.x-H.x),f)._round()),k&&H.equals(k[k.length-1])||(k=[H],_.push(k),y&&y.push({progress:{min:Q+vF(ae,de,H)*J,max:1},parentIndex:S,prevPoint:ae,nextPoint:de})),k.push(W),y&&(y[y.length-1].progress.max=Q+vF(ae,de,W)*J,y[y.length-1].nextPoint=de)))))}if(y&&R>0)for(let L=j;L<_.length;L++)y[L].progress.min/=R,y[L].progress.max/=R}return _}function wne(l,i,s,d,f){if(l.length<2)return void d.push(l);const y=[];for(;i.valid();){const[k,j]=i.get();for(let R=0;R<l.length-1;R++){const L=l[R],H=l[R+1],W=pa(L,H,k,j);if(W){const[J]=W,Q=new ut(lr(L.x,H.x,J),lr(L.y,H.y,J));y.push({t:R+J,distance:0,point:Q})}}i.next()}if(y.length===0)return void d.push(l);y.sort((k,j)=>k.t-j.t);let _=0,S=0,A=[];for(d.push(A);_!==l.length;){if(S===y.length){for(;_!==l.length;)A.length!==0&&A[A.length-1].equals(l[_])||A.push(l[_]),_++;break}y[S].t<=_?(A.length!==0&&A[A.length-1].equals(y[S].point)||A.push(y[S].point),Math.trunc(y[S].t),S++):(A.length!==0&&A[A.length-1].equals(l[_])||A.push(l[_]),_++)}}function vF(l,i,s){return l.x!==i.x?(s.x-l.x)/(i.x-l.x):l.y!==i.y?(s.y-l.y)/(i.y-l.y):0}function H0(l,i){return l.x*i.x+l.y*i.y}function xF(l,i){if(l.length===1){let s=0;const d=i[s++];let f;for(;!f||d.equals(f);)if(f=i[s++],!f)return 1/0;for(;s<i.length;s++){const y=i[s],_=l[0],S=f.sub(d),A=y.sub(d),k=_.sub(d),j=H0(S,S),R=H0(S,A),L=H0(A,A),H=H0(k,S),W=H0(k,A),J=j*L-R*R,Q=(L*H-R*W)/J,ae=(j*W-R*H)/J,de=d.z*(1-Q-ae)+f.z*Q+y.z*ae;if(isFinite(de))return de}return 1/0}{let s=1/0;for(const d of i)s=Math.min(s,d.z);return s}}function bF(l,i,s,d,f,y,_,S){const A=_*f.getElevationAt(l,i,!0,!0),k=y[0]!==0,j=k?y[1]===0?_*(y[0]/7-450):_*function(R,L,H){const W=Math.floor(L[0]/8),J=Math.floor(L[1]/8),Q=10*(L[0]-8*W),ae=10*(L[1]-8*J),de=R.getElevationAt(W,J,!0,!0),he=R.getMeterToDEM(H),fe=Math.floor(.5*(Q*he-1)),Me=Math.floor(.5*(ae*he-1)),Ae=R.tileCoordToPixel(W,J),ke=2*fe+1,Le=2*Me+1,Be=function(At,kt,it,Tt,Xe){return[At.getElevationAtPixel(kt,it,!0),At.getElevationAtPixel(kt+Xe,it,!0),At.getElevationAtPixel(kt,it+Xe,!0),At.getElevationAtPixel(kt+Tt,it+Xe,!0)]}(R,Ae.x-fe,Ae.y-Me,ke,Le),st=Math.abs(Be[0]-Be[1]),Ge=Math.abs(Be[2]-Be[3]),ft=Math.abs(Be[0]-Be[2])+Math.abs(Be[1]-Be[3]),wt=Math.min(.25,.5*he*(st+Ge)/ke),xt=Math.min(.25,.5*he*ft/Le);return de+Math.max(wt*Q,xt*ae)}(f,y,S):A;return{base:A+(s===0?-1:s),top:k?Math.max(j+d,A+s+2):A+d}}class Sne{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Tne{constructor(){this.tasks={},this.taskQueue=[],_r(["process"],this),this.invoker=new Sne(this.process),this.nextId=0}add(i,s){const d=this.nextId++,f=function({type:y,isSymbolTile:_,zoom:S}){return S=S||0,y==="message"?0:y!=="maybePrepare"||_?y!=="parseTile"||_?y==="parseTile"&&_?300-S:y==="maybePrepare"&&_?400-S:500:200-S:100-S}(s);if(f===0){try{i()}finally{}return null}return this.tasks[d]={fn:i,metadata:s,priority:f,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const s=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let i=null,s=1/0;for(let f=0;f<this.taskQueue.length;f++){const y=this.tasks[this.taskQueue[f]];y.priority<s&&(s=y.priority,i=f)}if(i===null)return null;const d=this.taskQueue[i];return this.taskQueue.splice(i,1),d}remove(){this.invoker.remove()}}class wF{constructor(i,s,d){this.target=i,this.parent=s,this.mapId=d,this.callbacks={},this.cancelCallbacks={},_r(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Tne}send(i,s,d,f,y=!1,_){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=_,this.callbacks[S]=d);const A=new Set;return this.target.postMessage({id:S,type:i,hasCallback:!!d,targetMapId:f,mustQueue:y,sourceMapId:this.mapId,data:Xl(s,A)},A),{cancel:()=>{d&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(i){const s=i.data;if(!s)return;const d=s.id;if(d&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const f=this.cancelCallbacks[d];delete this.cancelCallbacks[d],f&&f.cancel()}else if(s.mustQueue||Dn(self)){const f=this.callbacks[d],y=this.scheduler.add(()=>this.processTask(d,s),f&&f.metadata||{type:"message"});y&&(this.cancelCallbacks[d]=y)}else this.processTask(d,s)}processTask(i,s){if(delete this.cancelCallbacks[i],s.type==="<response>"){const d=this.callbacks[i];delete this.callbacks[i],d&&(s.error?d(Pa(s.error)):d(null,Pa(s.data)))}else{const d=new Set,f=s.hasCallback?(_,S)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?Xl(_):null,data:Xl(S,d)},d)}:()=>{},y=Pa(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,y,f);else if(this.parent.getWorkerSource){const _=s.type.split("."),{source:S,scope:A}=y;this.parent.getWorkerSource(s.sourceMapId,_[0],S,A)[_[1]](y,f)}else f(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var W0={workerUrl:"",workerClass:null,workerParams:void 0};const SP="mapboxgl_preloaded_worker_pool";class Sp{constructor(){this.active={}}acquire(i,s=Sp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;)this.workers.push(W0.workerClass!=null?new W0.workerClass:new self.Worker(W0.workerUrl,W0.workerParams));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[SP]}numActive(){return Object.keys(this.active).length}}Sp.workerCount=2;class Gg{constructor(i,s,d="Worker",f=Sp.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=gt();const y=this.workerPool.acquire(this.id,f);for(let _=0;_<y.length;_++){const S=new Gg.Actor(y[_],s,this.id);S.name=`${d} ${_}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,s,d){Ue(this.actors,(f,y)=>{f.send(i,s,y)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Z0,TP;function IS(){return Z0||(Z0=new Sp),Z0}Gg.Actor=wF;class Ene{constructor(i){this.module=i}createIntArray(i){const s=new Int32Array(i),d=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heap32.set(s,d/s.BYTES_PER_ELEMENT),d}createFloatArray(i){const s=new Float32Array(i),d=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heapF32.set(s,d/s.BYTES_PER_ELEMENT),d}createStringBuffer(i){const s=this.module.malloc(i.length+1);for(let d=0;d<i.length;++d)this.module.heapU8[s+d]=i.charCodeAt(d);return this.module.heapU8[s+i.length]=0,s}readStringBuffer(i){let s="";for(;this.module.heapU8[i]!==0;)s+=String.fromCharCode(this.module.heapU8[i]),++i;return s}setStyle(i){const s=i.entranceColorRgb,d=i.facadeGlazingColorRgb,f=i.roofColorRgb,y=i.wallColorRgb,_=i.normalScale;this.module.setStyle(s[0],s[1],s[2],d[0],d[1],d[2],f[0],f[1],f[2],y[0],y[1],y[2],_[0],_[1],_[2],i.tileToMeters)}setAOOptions(i,s){this.module.setAOOptions(i?1:0,s)}setMetricOptions(i,s){this.module.setMetricOptions(i?1:0,s)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,s){this.module.setFacadeOptions(i,s?1:0)}setFauxFacadeOptions(i,s,d){this.module.setFauxFacadeOptions(i?1:0,s?1:0,d)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,s){for(const S of i){const A=this.createStringBuffer(S.roofType),k=[0],j=[];for(const H of S.coordinates)if(Array.isArray(H)){for(const W of H)j.push(W.x),j.push(W.y);k.push(j.length)}const R=this.createIntArray(k),L=this.createFloatArray(j);this.module.addFeature(S.id,S.sourceId,S.minHeight,S.height,A,S.roofType.length,L,R,k.length-1),this.module.free(A),this.module.free(R),this.module.free(L)}for(const S of s){let A;A=S.entrances?JSON.parse(S.entrances):[];const k=this.createFloatArray(A),j=[];for(const L of S.coordinates)j.push(L.x),j.push(L.y);const R=this.createFloatArray(j);this.module.addFacade(S.sourceId,S.crossPerc,S.distanceToRoad,k,A.length,R,j.length),this.module.free(k),this.module.free(R)}if(!this.module.generateMesh()){const S=this.module.getLastError();return this.readStringBuffer(S)}const d=this.module.getMeshCount(),f=new Array(d);for(let S=0;S<d;S++){const A=this.module.getPositionsPtr(S),k=this.module.getPositionsLength(S),j=new Float32Array(this.module.heapF32.buffer,A,k),R=this.module.getNormalsPtr(S),L=this.module.getNormalsLength(S),H=new Float32Array(this.module.heapF32.buffer,R,L),W=this.module.getColorsPtr(S),J=this.module.getColorsLength(S),Q=new Uint8Array(this.module.heapU8.buffer,W,J),ae=this.module.getAOPtr(S),de=this.module.getAOLength(S),he=new Float32Array(this.module.heapF32.buffer,ae,de),fe=this.module.getUVPtr(S),Me=this.module.getUVLength(S),Ae=new Float32Array(this.module.heapF32.buffer,fe,Me),ke=this.module.getFauxFacadePtr(S),Le=this.module.getFauxFacadeLength(S),Be=new Uint8Array(this.module.heapU8.buffer,ke,Le),st=this.module.getIndicesPtr(S),Ge=this.module.getIndicesLength(S),ft=new Int32Array(this.module.heap32.buffer,st,Ge),wt=this.module.getBuildingPart(S),xt=this.readStringBuffer(wt);f[S]={positions:j,normals:H,colors:Q,ao:he,uv:Ae,isFauxFacade:Be,indices:ft,buildingPart:xt}}const y=this.module.getRingCount(),_=[];for(let S=0;S<y;S++){const A=this.module.getRingPtr(S),k=this.module.getRingLength(S),j=new Float32Array(this.module.heapF32.buffer,A,k);_.push(j)}return{meshes:f,modifiedPolygonRings:_}}}let OS,EP,Jl,qg,AP,Hg=null,Wg=null,SF=null,jS=null;function TF(){return Dn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:EP||Mo.DRACO_URL}function EF(){if(Dn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(qg)return qg;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return qg=WebAssembly.validate(l)?Mo.MESHOPT_SIMD_URL:Mo.MESHOPT_URL,qg}function Ane(){return jS}const RS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},kne={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},K0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function AF(l,i,s){const d=s.json.bufferViews.length,f=s.buffers.length;i.bufferView=d,s.json.bufferViews[d]={buffer:f,byteLength:l.byteLength},s.buffers[f]=l}const kP="KHR_draco_mesh_compression";function Cne(l,i){const s=l.extensions&&l.extensions[kP];if(!s)return;const d=new Jl.Decoder,f=MF(i,s.bufferView),y=new Jl.Mesh;if(!d.DecodeArrayToMesh(f,f.byteLength,y))throw new Error("Failed to decode Draco mesh");const _=i.json.accessors[l.indices],S=RS[_.componentType],A=_.count*S.BYTES_PER_ELEMENT,k=Jl._malloc(A);S===Uint16Array?d.GetTrianglesUInt16Array(y,A,k):d.GetTrianglesUInt32Array(y,A,k),AF(Jl.memory.buffer.slice(k,k+A),_,i),Jl._free(k);for(const j of Object.keys(s.attributes)){const R=d.GetAttributeByUniqueId(y,s.attributes[j]),L=i.json.accessors[l.attributes[j]],H=kne[L.componentType],W=L.count*K0[L.type]*RS[L.componentType].BYTES_PER_ELEMENT,J=Jl._malloc(W);d.GetAttributeDataArrayForAllPoints(y,R,Jl[H],W,J),AF(Jl.memory.buffer.slice(J,J+W),L,i),Jl._free(J)}d.destroy(),y.destroy(),delete l.extensions[kP]}const DS="EXT_meshopt_compression";function Pne(l,i){if(!l.extensions||!l.extensions[DS])return;const s=l.extensions[DS],d=new Uint8Array(i.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),f=new Uint8Array(s.count*s.byteStride);AP.decodeGltfBuffer(f,s.count,s.byteStride,d,s.mode,s.filter),l.buffer=i.buffers.length,l.byteOffset=0,i.buffers[l.buffer]=f.buffer,delete l.extensions[DS]}const kF=1179937895,CF=new TextDecoder("utf8");function PF(l,i){return new URL(l,i).href}function Mne(l,i,s,d){return fetch(PF(l.uri,d)).then(f=>f.arrayBuffer()).then(f=>{i.buffers[s]=f})}function MF(l,i){const s=l.json.bufferViews[i];return new Uint8Array(l.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function Ine(l,i,s,d){if(l.uri){const f=PF(l.uri,d);return fetch(f).then(y=>y.blob()).then(y=>createImageBitmap(y)).then(y=>{i.images[s]=y})}if(l.bufferView!==void 0){const f=MF(i,l.bufferView),y=new Blob([f],{type:l.mimeType});return createImageBitmap(y).then(_=>{i.images[s]=_})}}function IF(l,i=0,s){const d={json:null,images:[],buffers:[]};if(new Uint32Array(l,i,1)[0]===kF){const j=new Uint32Array(l,i);let R=2;const L=(j[R++]>>2)-3,H=j[R++]>>2;if(R++,d.json=JSON.parse(CF.decode(j.subarray(R,R+H))),R+=H,R<L){const W=j[R++];R++;const J=i+(R<<2);d.buffers[0]=l.slice(J,J+W)}}else d.json=JSON.parse(CF.decode(new Uint8Array(l,i)));const{buffers:f,images:y,meshes:_,extensionsUsed:S,bufferViews:A}=d.json;let k=Promise.resolve();if(f){const j=[];for(let R=0;R<f.length;R++){const L=f[R];L.uri?j.push(Mne(L,d,R,s)):d.buffers[R]||(d.buffers[R]=null)}k=Promise.all(j)}return k.then(()=>{const j=[],R=S&&S.includes(kP),L=S&&S.includes(DS);if(R&&j.push(function(){if(!Jl)return OS??(OS=function(H){let W,J=null;function Q(){W=new Uint8Array(J.buffer)}function ae(){throw new Error("Unexpected Draco error.")}const de={a:{a:ae,d:function(he,fe,Me){return W.copyWithin(he,fe,fe+Me)},c:function(he){const fe=W.length,Me=Math.max(he>>>0,Math.ceil(1.2*fe)),Ae=Math.ceil((Me-fe)/65536);try{return J.grow(Ae),Q(),!0}catch{return!1}},b:ae}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(H,de):H.then(he=>he.arrayBuffer()).then(he=>WebAssembly.instantiate(he,de))).then(he=>{const{Rb:fe,Qb:Me,P:Ae,T:ke,X:Le,Ja:Be,La:st,Qa:Ge,Va:ft,Wa:wt,eb:xt,jb:At,f:kt,e:it,yb:Tt,zb:Xe,Ab:at,Bb:Mt,Db:St,Gb:ar}=he.instance.exports;J=it;const Kt=(()=>{let _t=0,Pt=0,rr=0,Bt=0;return Nt=>{rr&&(fe(Bt),fe(_t),Pt+=rr,rr=_t=0),_t||(Pt+=128,_t=Me(Pt));const qt=Nt.length+7&-8;let pr=_t;qt>=Pt&&(rr=qt,pr=Bt=Me(qt));for(let gr=0;gr<Nt.length;gr++)W[pr+gr]=Nt[gr];return pr}})();return Q(),kt(),{memory:it,_free:fe,_malloc:Me,Mesh:class{constructor(){this.ptr=Ae()}destroy(){ke(this.ptr)}},Decoder:class{constructor(){this.ptr=Be()}destroy(){At(this.ptr)}DecodeArrayToMesh(_t,Pt,rr){const Bt=Kt(_t),Nt=st(this.ptr,Bt,Pt,rr.ptr);return!!Le(Nt)}GetAttributeByUniqueId(_t,Pt){return{ptr:Ge(this.ptr,_t.ptr,Pt)}}GetTrianglesUInt16Array(_t,Pt,rr){ft(this.ptr,_t.ptr,Pt,rr)}GetTrianglesUInt32Array(_t,Pt,rr){wt(this.ptr,_t.ptr,Pt,rr)}GetAttributeDataArrayForAllPoints(_t,Pt,rr,Bt,Nt){xt(this.ptr,_t.ptr,Pt.ptr,rr,Bt,Nt)}},DT_INT8:Tt(),DT_UINT8:Xe(),DT_INT16:at(),DT_UINT16:Mt(),DT_UINT32:St(),DT_FLOAT32:ar()}})}(fetch(TF())),OS.then(H=>{Jl=H,OS=void 0}))}()),L&&j.push(function(){if(AP)return;const H=function(W){let J;const Q=WebAssembly.instantiateStreaming(W,{}).then(he=>{J=he.instance,J.exports.__wasm_call_ctors()}),ae={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},de={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Q,supported:!0,decodeGltfBuffer(he,fe,Me,Ae,ke,Le){(function(Be,st,Ge,ft,wt,xt,At){const kt=Be.exports.sbrk,it=ft+3&-4,Tt=kt(it*wt),Xe=kt(xt.length),at=new Uint8Array(Be.exports.memory.buffer);at.set(xt,Xe);const Mt=st(Tt,ft,wt,Xe,xt.length);if(Mt===0&&At&&At(Tt,it,wt),Ge.set(at.subarray(Tt,Tt+ft*wt)),kt(Tt-kt(0)),Mt!==0)throw new Error(`Malformed buffer data: ${Mt}`)})(J,J.exports[de[ke]],he,fe,Me,Ae,J.exports[ae[Le]])}}}(fetch(EF()));return H.ready.then(()=>{AP=H})}()),y)for(let H=0;H<y.length;H++)j.push(Ine(y[H],d,H,s));return(j.length?Promise.all(j):Promise.resolve()).then(()=>{if(R&&_)for(const{primitives:H}of _)for(const W of H)Cne(W,d);if(L&&_&&A)for(const H of A)Pne(H,d);return d})})}function CP(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function PP(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class MP{constructor(i,s,d,f){this.context=i,this.format=d,this.useMipmap=f&&f.useMipmap,this.texture=i.gl.createTexture(),this.update(s,{premultiply:f&&f.premultiply})}update(i,s){const d=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,f=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:y}=this,{gl:_}=y,{x:S,y:A}=s&&s.position?s.position:{x:0,y:0},k=S+d,j=A+f;!this.size||this.size[0]===k&&this.size[1]===j||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!s||s.premultiply!==!1));const R=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&k>0&&j>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(k,j)))+1:1;_.texStorage2D(_.TEXTURE_2D,L,this.format,k,j),this.size=[k,j]}if(this.size)if(R)_.texSubImage2D(_.TEXTURE_2D,0,S,A,CP(this.format),PP(this.format),i);else{const L=i.data;L&&_.texSubImage2D(_.TEXTURE_2D,0,S,A,d,f,CP(this.format),PP(this.format),L)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(i,s,d=!1){const{context:f}=this,{gl:y}=f;y.bindTexture(y.TEXTURE_2D,this.texture),i!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap&&!d?i===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),s!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(i,s,d,f,y){const{context:_}=this,{gl:S}=_;S.bindTexture(S.TEXTURE_2D,this.texture),s!==this.magFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,s),this.magFilter=s),i!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,this.useMipmap?i===S.NEAREST?S.NEAREST_MIPMAP_NEAREST:S.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),d!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,d),this.wrapS=d),f!==this.wrapT&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,f),this.wrapT=f),y!==this.compareMode&&(y?(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_FUNC,y)):S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.NONE),this.compareMode=y)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class X0{constructor(i,s){this.context=i,this.texture=s}bind(i,s){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,i),this.minFilter=i),s!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrapS=s)}}const One=Yr([{name:"a_pos_3f",components:3,type:"Float32"}]),jne=Yr([{name:"a_color_3f",components:3,type:"Float32"}]),Rne=Yr([{name:"a_color_4f",components:4,type:"Float32"}]),Dne=Yr([{name:"a_uv_2f",components:2,type:"Float32"}]),Lne=Yr([{name:"a_normal_3f",components:3,type:"Float32"}]),zne=Yr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Nne=Yr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function OF(l,i){const s=LS(l.projection,l.zoom,l.width,l.height),d=function(y,_,S,A,k){const j=new q(S.lng-180*Pd,S.lat),R=new q(S.lng+180*Pd,S.lat),L=y.project(j.lng,j.lat),H=y.project(R.lng,R.lat),W=-Math.atan2(H.y-L.y,H.x-L.x),J=Ve.fromLngLat(S);J.y=xe(J.y,-1+Pd,1-Pd);const Q=J.toLngLat(),ae=y.project(Q.lng,Q.lat),de=Ve.fromLngLat(Q);de.x+=Pd;const he=de.toLngLat(),fe=y.project(he.lng,he.lat),Me=RF(fe.x-ae.x,fe.y-ae.y,W),Ae=Ve.fromLngLat(Q);Ae.y+=Pd;const ke=Ae.toLngLat(),Le=y.project(ke.lng,ke.lat),Be=RF(Le.x-ae.x,Le.y-ae.y,W),st=Math.abs(Me.x)/Math.abs(Be.y),Ge=N([]);se(Ge,Ge,-W*(1-(k?0:A)));const ft=N([]);return X(ft,ft,[1,1-(1-st)*A,1]),ft[4]=-Be.x/Be.y*A,se(ft,ft,W),V(ft,Ge,ft),ft}(l.projection,0,l.center,s,i),f=jF(l);return X(d,d,[f,f,1]),d}function jF(l){const i=l.projection,s=LS(l.projection,l.zoom,l.width,l.height),d=IP(i,l.center),f=IP(i,q.convert(i.center));return Math.pow(2,d*s+(1-s)*f)}function LS(l,i,s,d,f=1/0){const y=l.range;if(!y)return 0;const _=Math.min(f,Math.max(s,d)),S=Math.log(_/1024)/Math.LN2;return Fe(y[0]+S,y[1]+S,i)}const Pd=1/4e4;function IP(l,i){const s=xe(i.lat,-we,we),d=new q(i.lng-180*Pd,s),f=new q(i.lng+180*Pd,s),y=l.project(d.lng,s),_=l.project(f.lng,s),S=Ve.fromLngLat(d),A=Ve.fromLngLat(f),k=_.x-y.x,j=_.y-y.y,R=A.x-S.x,L=A.y-S.y,H=Math.sqrt((R*R+L*L)/(k*k+j*j));return Math.log(H)/Math.LN2}function RF(l,i,s){const d=Math.cos(s),f=Math.sin(s);return{x:l*d-i*f,y:l*f+i*d}}function DF(l,i,s){N(l),se(l,l,Br(i[2])),Y(l,l,Br(i[0])),ne(l,l,Br(i[1])),X(l,l,s),V(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function zS(l,i,s,d,f,y,_,S){const A=[s[0]-i[0],s[1]-i[1],0],k=[d[0]-i[0],d[1]-i[1],0];if(Ye(A)<1e-12||Ye(k)<1e-12)return xo(l);const j=br([],A,k);Er(j,j),lt(k,d,i),A[2]=(y-f)*S,k[2]=(_-f)*S;const R=A;return br(R,A,k),Er(R,R),Ys(l,j,R)}function OP(l,i,s=!1){const d=Ad(i.zoom),f=function(y,_,S){const A=_.worldSize,k=[y[12],y[13],y[14]],j=me(k[1]/A),R=pe(k[0]/A),L=N([]),H=ue(1,j)*A,W=ue(1,0)*A*be(j,_.zoom),J=1/aP(A);let Q=W*J;if(S){const fe=LS(_.projection,_.zoom,_.width,_.height,1024);Q=J*_.projection.pixelSpaceConversion(_.center.lat,A,fe)}const ae=I(j,R);He(ae,ae,mt([],Er([],ae),H*Q*k[2]));const de=function(fe){const Me=[fe[0],fe[1],fe[2]];let Ae=[0,1,0];const ke=br([],Ae,Me);return br(Ae,Me,ke),xr(Ae)===0&&(Ae=[0,1,0],br(ke,Me,Ae)),Er(ke,ke),Er(Ae,Ae),Er(Me,Me),[ke[0],ke[1],ke[2],0,Ae[0],Ae[1],Ae[2],0,Me[0],Me[1],Me[2],0,fe[0],fe[1],fe[2],1]}(ae);X(L,L,[Q,Q,Q*H]),U(L,L,[-k[0],-k[1],-k[2]]);const he=V([],_.globeMatrix,de);return V(he,he,L),V(he,he,y),he}(l,i,s);if(d>0){const y=function(_,S){const A=S.worldSize,k=ue(1,0)*A*be(S.center.lat,S.zoom)/aP(A),j=ue(1,S.center.lat)*A,R=N([]);return ne(R,R,Br(S.center.lng)),Y(R,R,Br(S.center.lat)),U(R,R,[0,0,Ko]),X(R,R,[k,k,k*j]),U(R,R,[S.point.x-.5*A,S.point.y-.5*A,0]),V(R,R,_),V(R,S.globeMatrix,R)}(l,i);return function(_,S,A){const k=(W,J,Q)=>{const ae=Ye(W),de=Ye(J),he=eh(W,J,Q);return mt(he,he,1/Ye(he)*lr(ae,de,Q))},j=k([_[0],_[1],_[2]],[S[0],S[1],S[2]],A),R=k([_[4],_[5],_[6]],[S[4],S[5],S[6]],A),L=k([_[8],_[9],_[10]],[S[8],S[9],S[10]],A),H=eh([_[12],_[13],_[14]],[S[12],S[13],S[14]],A);return[j[0],j[1],j[2],0,R[0],R[1],R[2],0,L[0],L[1],L[2],0,H[0],H[1],H[2],1]}(f,y,d)}return f}function LF(l,i,s,d){const f=kr.projectAabbCorners(d,s);let y=Number.MAX_VALUE,_=-1;for(let k=0;k<f.length;++k){const j=f[k];j[0]=(.5*j[0]+.5)*i.width,j[1]=(.5-.5*j[1])*i.height,j[2]<y&&(_=k,y=j[2])}const S=k=>new ut(f[k][0],f[k][1]);let A;switch(_){case 0:case 6:A=[S(1),S(5),S(4),S(7),S(3),S(2),S(1)];break;case 1:case 7:A=[S(0),S(4),S(5),S(6),S(2),S(3),S(0)];break;case 3:case 5:A=[S(1),S(0),S(4),S(7),S(6),S(2),S(1)];break;default:A=[S(1),S(5),S(6),S(7),S(3),S(0),S(1)]}if(Ei(l,A))return y}const Tp=64,Zg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function zF(l,i,s,d,f,y,_,S,A,k=!1){const j=s.zoom,R=s.project(d),L=be(d.lat,j),H=1/L;N(l),U(l,l,[R.x+_[0]*H,R.y+_[1]*H,_[2]]);let W=1,J=1;const Q=s.worldSize;if(k){if(s.projection.name==="mercator"){let fe=0;s.elevation&&(fe=s.elevation.getAtPointOrZero(new Ve(R.x/Q,R.y/Q),0));const Me=Bi([],[R.x,R.y,fe,1],s.projMatrix)[3]/s.cameraToCenterDistance;W=Me,J=Me*be(s.center.lat,j)}else if(s.projection.name==="globe"){const fe=OP(l,s),Me=[0,0,0,1];Bi(Me,Me,V([],s.projMatrix,fe));const Ae=Me[3]/s.cameraToCenterDistance,ke=Ad(j),Le=s.projection.pixelsPerMeter(d.lat,Q)*be(d.lat,j),Be=s.projection.pixelsPerMeter(s.center.lat,Q)*be(s.center.lat,j);W=Ae/lr(Le,Pe(s.center.lat),ke),J=Ae*L/Le,W*=Be,J*=Be}}else W=H;X(l,l,[W,W,J]);const ae=[...l],de=i.orientation,he=[];if(DF(he,[de[0]+f[0],de[1]+f[1],de[2]+f[2]],y),V(l,ae,he),S&&s.elevation){let fe=0;const Me=[];if(A&&s.elevation){fe=function(ke,Le,Be,st,Ge){const ft=Le.elevation;if(!ft)return 0;const wt=kr.projectAabbCorners(Be,st),xt=ue(1,Ge.lat)*Le.worldSize,At=function(Pt,rr){const Bt=[0,0,1],Nt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const qt of Nt){const pr=Pt[qt.corners[0]],gr=Pt[qt.corners[1]],Pr=Pt[qt.corners[2]],Ar=[gr[0]-pr[0],gr[1]-pr[1],rr*(gr[2]-pr[2])],Qr=br(Ar,Ar,[Pr[0]-pr[0],Pr[1]-pr[1],rr*(Pr[2]-pr[2])]);Er(Qr,Qr),qt.dotProductWithUp=Ft(Qr,Bt)}return Nt.sort((qt,pr)=>qt.dotProductWithUp-pr.dotProductWithUp),Nt[0].corners}(wt,xt),kt=wt[At[0]],it=wt[At[1]],Tt=wt[At[2]],Xe=wt[At[3]],at=ft.getAtPointOrZero(new Ve(kt[0]/Le.worldSize,kt[1]/Le.worldSize),0),Mt=ft.getAtPointOrZero(new Ve(it[0]/Le.worldSize,it[1]/Le.worldSize),0),St=ft.getAtPointOrZero(new Ve(Tt[0]/Le.worldSize,Tt[1]/Le.worldSize),0),ar=ft.getAtPointOrZero(new Ve(Xe[0]/Le.worldSize,Xe[1]/Le.worldSize),0),Kt=(at+ar)/2,_t=(Mt+St)/2;return Kt>_t?Mt<St?zS(ke,it,Xe,kt,Mt,ar,at,xt):zS(ke,Tt,kt,Xe,St,at,ar,xt):at<ar?zS(ke,kt,it,Tt,at,Mt,St,xt):zS(ke,Xe,Tt,it,ar,St,Mt,xt),Math.max(Kt,_t)}(Me,s,i.aabb,l,d);const Ae=V([],je([],Me),he);V(l,ae,Ae)}else fe=s.elevation.getAtPointOrZero(new Ve(R.x/Q,R.y/Q),0);fe!==0&&(l[14]+=fe)}}function Y0(l,i,s=!1){l.uploaded||(l.gfxTexture=new MP(i,l.image,s?i.gl.R8:i.gl.RGBA8,{useMipmap:l.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function Fne(l,i,s){l.indexBuffer=i.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=i.createVertexBuffer(l.vertexArray,One.members,!1,!0),l.normalArray&&(l.normalBuffer=i.createVertexBuffer(l.normalArray,Lne.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=i.createVertexBuffer(l.texcoordArray,Dne.members,!1,!0)),l.colorArray&&(l.colorBuffer=i.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?jne:Rne).members,!1,!0)),l.featureArray&&(l.pbrBuffer=i.createVertexBuffer(l.featureArray,Nne.members,!0)),l.segments=ui.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const d=l.material;d.pbrMetallicRoughness.baseColorTexture&&Y0(d.pbrMetallicRoughness.baseColorTexture,i),d.pbrMetallicRoughness.metallicRoughnessTexture&&Y0(d.pbrMetallicRoughness.metallicRoughnessTexture,i),d.normalTexture&&Y0(d.normalTexture,i),d.occlusionTexture&&Y0(d.occlusionTexture,i,s),d.emissionTexture&&Y0(d.emissionTexture,i)}function jP(l,i,s){if(l.meshes)for(const d of l.meshes)Fne(d,i,s);if(l.children)for(const d of l.children)jP(d,i,s)}function NS(l){if(l.meshes)for(const i of l.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(l.children)for(const i of l.children)NS(i)}function RP(l){if(l.meshes)for(const s of l.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((i=s.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(l.children)for(const s of l.children)RP(s)}function Ep(l,i){const s=l.json.bufferViews[i.bufferView],d=RS[i.componentType];return new d(l.buffers[s.buffer],(i.byteOffset||0)+(s.byteOffset||0),i.count*(s.byteStride&&s.byteStride!==K0[i.type]*d.BYTES_PER_ELEMENT?s.byteStride/d.BYTES_PER_ELEMENT:K0[i.type]))}function DP(l,i,s,d){const f=RS[i.componentType],y=function(j){switch(j){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),_=l.json.bufferViews[i.bufferView],S=_.byteStride?_.byteStride/f.BYTES_PER_ELEMENT:K0[i.type],A=s.float32,k=A.length/s.capacity;for(let j=0,R=0;j<i.count*S;j+=S,R+=k)for(let L=0;L<k;L++)A[R+L]=d[j+L]*y;s._trim()}function Bne(l,i,s){const d=l.indices,f=l.attributes,y={};y.indexArray=new ii;const _=i.json.accessors[d],S=_.count/3;y.indexArray.reserve(S);const A=Ep(i,_);for(let L=0;L<S;L++)y.indexArray.emplaceBack(A[3*L],A[3*L+1],A[3*L+2]);y.indexArray._trim(),y.vertexArray=new as;const k=i.json.accessors[f.POSITION];y.vertexArray.reserve(k.count);const j=Ep(i,k);for(let L=0;L<k.count;L++)y.vertexArray.emplaceBack(j[3*L],j[3*L+1],j[3*L+2]);if(y.vertexArray._trim(),y.aabb=new kr(k.min,k.max),y.centroid=function(L,H){const W=[0,0,0],J=L.length;if(J>0){for(let Q=0;Q<J;Q++){const ae=3*L[Q];W[0]+=H[ae],W[1]+=H[ae+1],W[2]+=H[ae+2]}W[0]/=J,W[1]/=J,W[2]/=J}return W}(A,j),f.COLOR_0!==void 0){const L=i.json.accessors[f.COLOR_0],H=K0[L.type],W=Ep(i,L);y.colorArray=H===3?new as:new Yc,y.colorArray.resize(L.count),DP(i,L,y.colorArray,W)}if(f.NORMAL!==void 0){y.normalArray=new as;const L=i.json.accessors[f.NORMAL];y.normalArray.resize(L.count);const H=Ep(i,L);DP(i,L,y.normalArray,H)}if(f.TEXCOORD_0!==void 0&&s.length>0){y.texcoordArray=new Jc;const L=i.json.accessors[f.TEXCOORD_0];y.texcoordArray.resize(L.count);const H=Ep(i,L);DP(i,L,y.texcoordArray,H)}if(f._FEATURE_ID_RGBA4444!==void 0){const L=i.json.accessors[f._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(y.featureData=Ep(i,L))}f._FEATURE_RGBA4444!==void 0&&(y.featureData=new Uint32Array(Ep(i,i.json.accessors[f._FEATURE_RGBA4444]).buffer));const R=l.material;return y.material=function(L,H){const{emissiveFactor:W=[0,0,0],alphaMode:J="OPAQUE",alphaCutoff:Q=.5,normalTexture:ae,occlusionTexture:de,emissiveTexture:he,doubleSided:fe}=L,{baseColorFactor:Me=[1,1,1,1],metallicFactor:Ae=1,roughnessFactor:ke=1,baseColorTexture:Le,metallicRoughnessTexture:Be}=L.pbrMetallicRoughness||{},st=de?H[de.index]:void 0;if(de&&de.extensions&&de.extensions.KHR_texture_transform&&st){const Ge=de.extensions.KHR_texture_transform;st.offsetScale=[Ge.offset[0],Ge.offset[1],Ge.scale[0],Ge.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Tn(...Me),metallicFactor:Ae,roughnessFactor:ke,baseColorTexture:Le?H[Le.index]:void 0,metallicRoughnessTexture:Be?H[Be.index]:void 0},doubleSided:fe,emissiveFactor:new Tn(...W),alphaMode:J,alphaCutoff:Q,normalTexture:ae?H[ae.index]:void 0,occlusionTexture:st,emissionTexture:he?H[he.index]:void 0,defined:L.defined===void 0}}(R!==void 0?i.json.materials[R]:{defined:!1},s),y}function NF(l,i,s){const{matrix:d,rotation:f,translation:y,scale:_,mesh:S,extras:A,children:k}=l,j={};if(j.matrix=d||function(R,L,H,W){var J=L[0],Q=L[1],ae=L[2],de=L[3],he=J+J,fe=Q+Q,Me=ae+ae,Ae=J*he,ke=J*fe,Le=J*Me,Be=Q*fe,st=Q*Me,Ge=ae*Me,ft=de*he,wt=de*fe,xt=de*Me,At=W[0],kt=W[1],it=W[2];return R[0]=(1-(Be+Ge))*At,R[1]=(ke+xt)*At,R[2]=(Le-wt)*At,R[3]=0,R[4]=(ke-xt)*kt,R[5]=(1-(Ae+Ge))*kt,R[6]=(st+ft)*kt,R[7]=0,R[8]=(Le+wt)*it,R[9]=(st-ft)*it,R[10]=(1-(Ae+Be))*it,R[11]=0,R[12]=H[0],R[13]=H[1],R[14]=H[2],R[15]=1,R}([],f||[0,0,0,1],y||[0,0,0],_||[1,1,1]),S!==void 0){j.meshes=s[S];const R=j.anchor=[0,0];for(const L of j.meshes){const{min:H,max:W}=L.aabb;R[0]+=H[0]+W[0],R[1]+=H[1]+W[1]}R[0]=Math.floor(R[0]/j.meshes.length/2),R[1]=Math.floor(R[1]/j.meshes.length/2)}if(A&&(A.id&&(j.id=A.id),A.lights&&(j.lights=function(R){if(!R.length)return[];const L=function(ae){const de=atob(ae),he=new Uint8Array(de.length);for(let fe=0;fe<de.length;fe++)he[fe]=de.codePointAt(fe);return he}(R),H=[],W=L.length/24,J=new Uint16Array(L.buffer),Q=new Float32Array(L.buffer);for(let ae=0;ae<W;ae++){const de=J[2*ae*6]/30,he=J[2*ae*6+1]/30,fe=J[2*ae*6+10]/100,Me=Q[6*ae+1],Ae=Q[6*ae+2],ke=Q[6*ae+3],Le=Q[6*ae+4],Be=ke-Me,st=Le-Ae,Ge=Math.hypot(Be,st);H.push({pos:[Me+.5*Be,Ae+.5*st,he],normal:[st/Ge,-Be/Ge,0],width:Ge,height:de,depth:fe,points:[Me,Ae,ke,Le]})}return H}(A.lights))),k){const R=[];for(const L of k)R.push(NF(i.json.nodes[L],i,s));j.children=R}return j}function Une(l){if(l.vertices.length===0||l.indices.length===0)return null;const i=new ES(l.vertices,l.indices,8,256),[s,d]=[i.min.clone(),i.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:i,min:s,max:d}}function Vne(l){if(!l.extras||!l.extras.ground)return null;const i=l.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const s=i[0];if(!s||!Array.isArray(s)||s.length===0)return null;const d=[];for(const _ of s){if(!Array.isArray(_)||_.length!==2)continue;const S=_[0],A=_[1];typeof S=="number"&&typeof A=="number"&&d.push(new ut(S,A))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let f=0;for(let _=0;_<d.length;_++){const S=d[_],A=d[(_+1)%d.length],k=d[(_+2)%d.length];f+=(S.x-A.x)*(k.y-A.y)-(k.x-A.x)*(S.y-A.y)}f>0&&d.reverse();const y=Vg(d.flatMap(_=>[_.x,_.y]),[]);return y.length===0?null:{vertices:d,indices:y}}function $ne(l,i){const s=[],d=[];let f=0;const y=[];for(const _ of l){f=s.length;const S=_.vertexArray.float32,A=_.indexArray.uint16;for(let k=0;k<_.vertexArray.length;k++)y[0]=S[3*k+0],y[1]=S[3*k+1],y[2]=S[3*k+2],Qt(y,y,i),s.push(new ut(y[0],y[1]));for(let k=0;k<3*_.indexArray.length;k++)d.push(A[k]+f)}if(d.length%3!=0)return null;for(let _=0;_<d.length;_+=3){const S=s[d[_+0]],A=s[d[_+1]],k=s[d[_+2]];(S.x-A.x)*(k.y-A.y)-(k.x-A.x)*(S.y-A.y)>0&&([d[_+1],d[_+2]]=[d[_+2],d[_+1]])}return{vertices:s,indices:d}}function FF(l){const i=function(A,k){const j=[],R=WebGL2RenderingContext;if(A.json.textures)for(const L of A.json.textures){const H={magFilter:R.LINEAR,minFilter:R.NEAREST,wrapS:R.REPEAT,wrapT:R.REPEAT};L.sampler!==void 0&&Object.assign(H,A.json.samplers[L.sampler]),j.push({image:k[L.source],sampler:H,uploaded:!1})}return j}(l,l.images),s=function(A,k){const j=[];for(const R of A.json.meshes){const L=[];for(const H of R.primitives)L.push(Bne(H,A,k));j.push(L)}return j}(l,i),{scenes:d,scene:f,nodes:y}=l.json,_=d?d[f||0].nodes:y,S=[];for(const A of _)S.push(NF(y[A],l,s));return function(A,k,j){const R={},L=new Set;for(let H=0;H<A.length;H++){const W=j[k[H]];if(!W.extras)continue;const J=W.extras["mapbox:footprint:version"],Q=W.extras["mapbox:footprint:id"];(J||Q)&&L.add(H),J==="1.0.0"&&Q&&(R[Q]=H)}for(let H=0;H<A.length;H++){if(L.has(H))continue;const W=A[H],J=j[k[H]];if(!J.extras)continue;let Q=null;W.id in R&&(Q=$ne(A[R[W.id]].meshes,W.matrix)),Q||(Q=Vne(J)),Q&&(W.footprint=Une(Q))}if(L.size>0){const H=Array.from(L.values()).sort((W,J)=>W-J);for(let W=H.length-1;W>=0;W--)A.splice(H[W],1)}}(S,_,l.json.nodes),S}function Gne(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const i=l.vertexArray.float32,s=l.aabb.min[0]-1,d=l.aabb.min[1]-1,f=Tp/(l.aabb.max[0]-s+2),y=Tp/(l.aabb.max[1]-d+2);for(let _=0;_<i.length;_+=3){const S=i[_+2],A=(i[_+0]-s)*f|0,k=(i[_+1]-d)*y|0;S>l.heightmap[k*Tp+A]&&(l.heightmap[k*Tp+A]=S)}}function BF(l,i,s,d,f){s.reserve(s.length+4*l.length),d.reserve(d.length+10*l.length),f.reserve(f.length+10*l.length);let y=d.length;for(const _ of l){const S=Math.min(10,Math.max(4,1.3*_.height))*i,A=[-_.normal[1],_.normal[0],0],k=Math.min(.29,.1*_.width/_.depth),j=_.width-2*_.depth*i*(k+.01),R=ct([],_.pos,A,j/2),L=ct([],_.pos,A,-j/2),H=[R[0],R[1],R[2]+_.height],W=[L[0],L[1],L[2]+_.height],J=ct([],_.normal,A,k);mt(J,J,S);const Q=ct([],_.normal,A,-k);mt(Q,Q,S),He(J,R,J),He(Q,L,Q),R[2]+=.1,L[2]+=.1,d.emplaceBack(J[0],J[1],J[2]),d.emplaceBack(Q[0],Q[1],Q[2]),d.emplaceBack(R[0],R[1],R[2]),d.emplaceBack(L[0],L[1],L[2]),d.emplaceBack(H[0],H[1],H[2]),d.emplaceBack(W[0],W[1],W[2]),d.emplaceBack(R[0],R[1],R[2]),d.emplaceBack(L[0],L[1],L[2]),d.emplaceBack(J[0],J[1],J[2]),d.emplaceBack(Q[0],Q[1],Q[2]);const ae=j/S/2;f.emplaceBack(-ae-k,-1,ae,.8),f.emplaceBack(ae+k,-1,ae,.8),f.emplaceBack(-ae,0,ae,1.3),f.emplaceBack(ae,0,ae,1.3),f.emplaceBack(ae+k,-.8,ae,.7),f.emplaceBack(ae+k,-.8,ae,.7),f.emplaceBack(0,0,ae,1.3),f.emplaceBack(0,0,ae,1.3),f.emplaceBack(ae+k,-1.2,ae,.8),f.emplaceBack(ae+k,-1.2,ae,.8),s.emplaceBack(6+y,4+y,8+y),s.emplaceBack(7+y,9+y,5+y),s.emplaceBack(0+y,1+y,2+y),s.emplaceBack(1+y,3+y,2+y),y+=10}}function qne(l,i){const s={};s.indexArray=new ii,s.vertexArray=new as,s.colorArray=new Yc,BF(l,i,s.indexArray,s.vertexArray,s.colorArray);const d={defined:!0};d.emissiveFactor=Tn.black;const f={};return f.baseColorFactor=Tn.white,d.pbrMetallicRoughness=f,s.material=d,s.aabb=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}const UF=Yr([{name:"a_pos_3f",components:3,type:"Float32"}]),Hne=Yr([{name:"a_normal_3",components:3,type:"Int16"}]),VF=Yr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Wne=Yr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),$F=yt.types,LP=32767;function Zne(l,i){const s=Dt+i;for(const d of l)for(const f of d)if(f.x<-i||f.x>s||f.y<-i||f.y>s)return!1;return!0}class GF{constructor(i){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.layoutVertexArray=new as,this.layoutNormalArray=new pd,this.layoutColorArray=new xl,this.indexArray=new ii,this.indexArrayForConflation=new ii,this.entranceBloom={layoutVertexArray:new as,layoutVertexBuffer:null,layoutAttenuationArray:new Yc,layoutAttenuationBuffer:null,layoutColorArray:new xl,layoutColorBuffer:null,indexArray:new ii,indexArrayForConflation:new ii,indexBuffer:null,segmentsBucket:new ui},this.programConfigurations=new ls(i.layers,{zoom:i.zoom,lut:i.lut}),this.segmentsBucket=new ui,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=i.projection,this.groundEffect=new bP(i)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(i,s){for(const d of this.footprints)s.push({footprint:d,id:i})}prepare(){return function(){if(jS!=null||SF!=null)return null;if(Wg!=null)return Wg;const i=fetch(Mo.BUILDING_GEN_URL);return Wg=function(s){let d,f,y,_;function S(){d=new Uint8Array(_.buffer),f=new Int32Array(_.buffer),y=new Float32Array(_.buffer)}function A(){throw new Error("Unexpected BuildingGen error.")}const k=()=>{},j={a:{a:A,f:function(R){const L=d.length,H=Math.max(R>>>0,Math.ceil(1.2*L)),W=Math.ceil((H-L)/65536);try{return _.grow(W),S(),!0}catch{return!1}},g:A,b:k,c:k,d:k,e:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,j):s.then(R=>R.arrayBuffer()).then(R=>WebAssembly.instantiate(R,j))).then(R=>{const L=R.instance.exports;return(0,L.g)(),_=L.f,S(),new Ene({setStyle:L.h,setAOOptions:L.i,setMetricOptions:L.j,setStructuralOptions:L.k,setFacadeOptions:L.l,setFauxFacadeOptions:L.m,setFacadeClassifierOptions:L.n,addFeature:L.o,addFacade:L.p,generateMesh:L.q,getLastError:L.r,getMeshCount:L.s,getPositionsPtr:L.t,getPositionsLength:L.u,getNormalsPtr:L.v,getNormalsLength:L.w,getColorsPtr:L.x,getColorsLength:L.y,getAOPtr:L.z,getAOLength:L.A,getUVPtr:L.B,getUVLength:L.C,getFauxFacadePtr:L.D,getFauxFacadeLength:L.E,getIndicesPtr:L.F,getIndicesLength:L.G,getBuildingPart:L.H,getRingCount:L.I,getRingPtr:L.J,getRingLength:L.K,free:L.L,malloc:L.M,heapU8:d,heap32:f,heapF32:y})})}(i).then(s=>(Wg=null,jS=s,jS)).catch(s=>{Wr("Could not load building-gen"),Wg=null,SF=s}),Wg}()}populate(i,s,d,f){const y=Ane();if(!y)return;const _=Ee(d);this.tileToMeter=_,this.brightness=s.brightness,y.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,_],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:_,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),y.setAOOptions(!1,.3),y.setMetricOptions(!1,16),y.setStructuralOptions(!0),y.setFacadeOptions(4,!0),y.setFauxFacadeOptions(!1,!1,1),y.setFacadeClassifierOptions(3);const S=new Map;for(const{feature:A}of i){if($F[A.type]!=="LineString")continue;const k=this.layers[0]._featureFilter.needGeometry,j=Ze(A,k);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),j,d))continue;const R=k?j.geometry:nt(A,d,f),L=[];for(const Q of R)for(const ae of Q)L.push({x:ae.x,y:ae.y});const H={coordinates:L,crossPerc:A.properties.cross_perc,distanceToRoad:A.properties.distance_to_road,entrances:A.properties.entrances,sourceId:0},W=A.properties.source_id;let J=S.get(W);J||(J=[],S.set(W,J)),J.push(H)}this.maxHeight=0;for(const{feature:A,index:k}of i){if($F[A.type]==="LineString")continue;const j=this.layers[0]._featureFilter.needGeometry,R=Ze(A,j);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),R,d))continue;const L=j?R.geometry:nt(A,d,f),H=U0(L,500);if(!Zne(L,163))continue;const W=this.layers[0],J=W.layout.get("building-base").evaluate(A,{},d),Q=W.layout.get("building-height").evaluate(A,{},d),ae=W.layout.get("building-roof-shape").evaluate(A,{},d),de=W.paint.get("building-ambient-occlusion-intensity"),he=W.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(ae==="flat")continue;const fe=A.properties.source_id;let Me;Me=S.has(fe)?S.get(fe):[];const Ae=[],ke=new ut(1/0,1/0),Le=new ut(-1/0,-1/0);for(const _t of H)if(_t.length>0){const Pt=[];for(const rr of _t){const Bt=[];for(let Nt=rr.length-1;Nt>=0;Nt--){const qt=rr[Nt];Bt.push({x:qt.x,y:qt.y}),ke.x=Math.min(ke.x,qt.x),ke.y=Math.min(ke.y,qt.y),Le.x=Math.max(Le.x,qt.x),Le.y=Math.max(Le.y,qt.y)}Pt.push(Bt)}Ae.push({id:A.id,height:Q,minHeight:J,sourceId:0,roofType:ae,coordinates:Pt})}const Be=y.generateMesh(Ae,Me);if(typeof Be=="string"||Be.meshes.length===0||Be.modifiedPolygonRings.length===0)continue;let st=0;for(const _t of Be.meshes)st+=_t.positions.length/3;const Ge=this.segmentsBucket.prepareSegment(st,this.layoutVertexArray,this.indexArray),ft=[];let wt=null,xt=0,At=-1;const kt=this.indexArray.length;let it=0;for(const _t of Be.meshes){const Pt=this.layoutVertexArray.length;if(_t.buildingPart==="entrance"){const Bt=new Array;for(let gr=0;gr<_t.indices.length;gr+=12){const Pr=_t.positions[gr+0],Ar=_t.positions[gr+1],Qr=_t.positions[gr+3],Ur=_t.positions[gr+4],Kn=_t.positions[gr+2],_e=_t.positions[gr+8]-Kn,ve=1,ot=Qr-Pr,Rt=Ur-Ar,zt=Math.hypot(ot,Rt);Bt.push({pos:[Pr+.5*ot,Ar+.5*Rt,Kn],normal:[Rt/zt,-ot/zt,0],width:zt,height:_e,depth:ve,points:[Pr,Ar,Qr,Ur]})}const Nt=this.entranceBloom.segmentsBucket.prepareSegment(10*Bt.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),qt=this.entranceBloom.layoutVertexArray.length;xt=this.entranceBloom.indexArray.length,BF(Bt,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const pr=this.entranceBloom.layoutVertexArray.length-qt;At=this.entranceBloom.indexArray.length-xt;for(let gr=0;gr<pr;gr++)this.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Nt.vertexLength+=pr,Nt.primitiveLength+=At,wt={part:_t.buildingPart,vertexOffset:qt,vertexLength:pr}}for(let Bt=0;Bt<_t.positions.length;Bt+=3)it=Math.max(it,_t.positions[Bt+2]),this.layoutVertexArray.emplaceBack(_t.positions[Bt],_t.positions[Bt+1],_t.positions[Bt+2]);for(let Bt=0;Bt<_t.normals.length;Bt+=3)this.layoutNormalArray.emplaceBack(_t.normals[Bt+0]*LP,_t.normals[Bt+1]*LP,_t.normals[Bt+2]*LP);for(let Bt=0;Bt<_t.ao.length;Bt++)this.layoutAOArray.push(_t.ao[Bt]);for(let Bt=0;Bt<_t.colors.length;Bt+=3){const Nt=1+(_t.ao[Bt/3]-1)*de;this.layoutColorArray.emplaceBack(_t.colors[Bt]*Nt<<8|_t.colors[Bt+1]*Nt,_t.colors[Bt+2]*Nt<<8)}const rr=Ge.vertexLength;for(let Bt=0;Bt<_t.indices.length;Bt+=3)this.indexArray.emplaceBack(rr+_t.indices[Bt],rr+_t.indices[Bt+1],rr+_t.indices[Bt+2]);Ge.vertexLength+=_t.positions.length/3,Ge.primitiveLength+=_t.indices.length/3,(_t.buildingPart==="roof"||_t.buildingPart==="wall"||_t.buildingPart==="facade_glazing"||_t.buildingPart==="entrance")&&ft.push({part:_t.buildingPart,vertexOffset:Pt,vertexLength:_t.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,it),this.buildingFeatures.push({feature:R,segment:Ge,parts:ft,buildingBloom:wt});const Tt=this.indexArray.length-kt,Xe=[],at=[],Mt=new ut(1/0,1/0),St=new ut(-1/0,-1/0),ar=this.groundEffect.vertexArray.length;for(const _t of Be.modifiedPolygonRings){const Pt=[],rr=new ut(1/0,1/0),Bt=new ut(-1/0,-1/0);for(let Nt=0;Nt<_t.length;Nt+=2){const qt=_t.length-Nt-2;rr.x=Math.min(rr.x,_t[qt]),rr.y=Math.min(rr.y,_t[qt+1]),Bt.x=Math.max(Bt.x,_t[qt]),Bt.y=Math.max(Bt.y,_t[qt+1]);const pr=new ut(_t[qt],_t[qt+1]);Pt.push(pr),Xe.push(pr.x,pr.y),at.push(pr.clone())}Mt.x=Math.min(Mt.x,rr.x),Mt.y=Math.min(Mt.y,rr.y),St.x=Math.max(St.x,Bt.x),St.y=Math.max(St.y,Bt.y),this.groundEffect.addData(Pt,[rr,Bt],he)}const Kt=this.groundEffect.vertexArray.length-ar;(ke.x<0||Le.x>Dt||ke.y<0||Le.y>Dt)&&this.featuresOnBorder.push({featureId:A.id,footprintIndex:this.footprints.length});{const _t=Vg(Xe,null,2),Pt=new ES(at,_t,8,256);let rr=A.id;A.properties&&A.properties.hasOwnProperty("building_id")&&(rr=A.properties.building_id),this.footprints.push({vertices:at,indices:_t,grid:Pt,min:Mt,max:St,buildingId:rr,hiddenFlags:0,indicesOffset:kt,indicesLength:Tt,bloomIndicesOffset:xt,bloomIndicesLength:At,groundEffectVertexOffset:ar,groundEffectVertexLength:Kt,segment:Ge,height:it})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,k,{},s.availableImages,d,s.brightness),this.groundEffect.addPaintPropertiesData(A,k,{},s.availableImages,d,s.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(i,s,d,f,y,_,S){this.programConfigurations.updatePaintArrays(i,s,y,d,f,_,S),this.groundEffect.update(i,s,y,d,f,_,S)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,UF.members),this.layoutNormalBuffer=i.createVertexBuffer(this.layoutNormalArray,Hne.members),this.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(this.entranceBloom.layoutVertexArray,UF.members),this.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,Wne.members),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(i,s,d=!0){let f=!1;const y=d?s:0,_=0|(d?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const S of i){const A=this.footprints[S],k=A.hiddenFlags&_|y;A.hiddenFlags!==k&&(A.hiddenFlags=k,f=!0,this.groundEffect.updateHiddenByLandmarkRange(A.groundEffectVertexOffset,A.groundEffectVertexLength,A.hiddenFlags!==0))}return f&&(this.indexArrayForConflationUploaded=!1),f}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),!this.indexArrayForConflationUploaded&&this.indexArray.length!==0){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const s of this.footprints){const d=s.indicesOffset+s.indicesLength;if(s.hiddenFlags!==0){for(let y=s.indicesOffset;y<d;y++)this.indexArrayForConflation.uint16[3*y+0]=0,this.indexArrayForConflation.uint16[3*y+1]=0,this.indexArrayForConflation.uint16[3*y+2]=0;const f=s.bloomIndicesOffset+s.bloomIndicesLength;for(let y=s.bloomIndicesOffset;y<f;y++)this.entranceBloom.indexArrayForConflation.uint16[3*y+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*y+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*y+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=i.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=i.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(i){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=i.createVertexBuffer(this.layoutColorArray,VF.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=i.createVertexBuffer(this.entranceBloom.layoutColorArray,VF.members,!0)}evaluate(i){const s=i.paint.get("building-ambient-occlusion-intensity");for(const d of this.buildingFeatures){const f=d.feature;f.properties["building-part"]="roof";const y=i.paint.get("building-color").evaluate(f,{},this.canonical),_=i.paint.get("building-emissive-strength").evaluate(f,{},this.canonical);f.properties["building-part"]="wall";const S=i.paint.get("building-color").evaluate(f,{},this.canonical),A=i.paint.get("building-emissive-strength").evaluate(f,{},this.canonical);f.properties["building-part"]="window";const k=i.paint.get("building-color").evaluate(f,{},this.canonical),j=i.paint.get("building-emissive-strength").evaluate(f,{},this.canonical);f.properties["building-part"]="door";const R=i.paint.get("building-color").evaluate(f,{},this.canonical),L=i.paint.get("building-emissive-strength").evaluate(f,{},this.canonical);for(const W of d.parts){let J,Q=y;W.part==="roof"?(Q=y,J=_):W.part==="wall"?(Q=S,J=A):W.part==="facade_glazing"?(Q=k,J=j):W.part==="entrance"&&(Q=R,J=L),J=xe(J,0,1);for(let ae=0;ae<W.vertexLength;ae++){const de=W.vertexOffset+ae,he=1+(this.layoutAOArray[de]-1)*s;this.layoutColorArray.emplace(de,Q.r*he*255<<8|Q.g*he*255,Q.b*he*255<<8|255*J)}}const H=d.buildingBloom;if(H)for(let W=0;W<H.vertexLength;W++)this.bloomGeometry.layoutColorArray.emplace(H.vertexOffset+W,255*R.r<<8|255*R.g,255*R.b<<8|51*L)}}needsEvaluation(i,s){const d=i.transform.projectionOptions,f=i.style.getBrightness();return!(this.uploaded&&d.name===this.projection.name&&this.brightness===f||(this.projection=d,this.brightness=f,0))}updateReplacement(i,s,d){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const f=s.getReplacementRegionsForTile(i.toUnwrapped());if(kS(this.activeReplacements,f))return;this.activeReplacements=f;for(const _ of this.footprints)_.hiddenFlags&=-2;const y=[];for(const _ of this.activeReplacements){if(_.order<=KN)continue;const S=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));for(const A of this.footprints)A.min.x>_.max.x||A.max.x<_.min.x||A.min.y>_.max.y||A.max.y<_.min.y||(y.length=0,Kne(A.vertices,0,A.vertices.length,_.footprintTileId.canonical,i.canonical,y),yP(_.footprint,y,A.indices,0,A.indices.length,0,-S)&&(A.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(i,s){let d=Number.NEGATIVE_INFINITY,f=!0;const y=4*(i+Dt)*Dt+(s+Dt);if(this.footprintLookup.hasOwnProperty(y)){const S=this.footprintLookup[y];return S?{height:S.height,hidden:S.hiddenFlags!==0}:void 0}const _=new ut(i,s);for(const S of this.footprints)i>S.max.x||S.min.x>i||s>S.max.y||S.min.y>s||S.height<=d||_P(_,S)&&(d=S.height,this.footprintLookup[y]=S,f=S.hiddenFlags!==0);if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:f};this.footprintLookup[y]=void 0}}function Kne(l,i,s,d,f,y){const _=Math.pow(2,d.z-f.z);for(let S=0;S<s;S++){let A=l[S+i].x,k=l[S+i].y;A=(A+f.x*Dt)*_-d.x*Dt,k=(k+f.y*Dt)*_-d.y*Dt,y.push(new ut(A,k))}}let qF,HF;Wt(GF,"BuildingBucket",{omit:["layers"]});const Xne=Yr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Yne=Yr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Jne}=Xne,Qne=Yr([{name:"a_packed",components:3,type:"Float32"}]),{members:eie}=Qne,tie=Yr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:rie}=tie;class WF{constructor(i,s){this.width=i,this.height=s,this.nextRow=0,this.image=new kd({width:i,height:s}),this.positions={},this.uploaded=!1}getDash(i,s){const d=this.getKey(i,s);return this.positions[d]}trim(){const i=this.width,s=this.height=sr(this.nextRow);this.image.resize({width:i,height:s})}getKey(i,s){return i.join(",")+s}getDashRanges(i,s,d){const f=[];let y=i.length%2==1?-i[i.length-1]*d:0,_=i[0]*d,S=!0;f.push({left:y,right:_,isDash:S,zeroLength:i[0]===0});let A=i[0];for(let k=1;k<i.length;k++){S=!S;const j=i[k];y=A*d,A+=j,_=A*d,f.push({left:y,right:_,isDash:S,zeroLength:j===0})}return f}addRoundDash(i,s,d){const f=s/2;for(let y=-d;y<=d;y++){const _=this.width*(this.nextRow+d+y);let S=0,A=i[S];for(let k=0;k<this.width;k++){k/A.right>1&&(A=i[++S]);const j=Math.abs(k-A.left),R=Math.abs(k-A.right),L=Math.min(j,R);let H;const W=y/d*(f+1);if(A.isDash){const J=f-Math.abs(W);H=Math.sqrt(L*L+J*J)}else H=f-Math.sqrt(L*L+W*W);this.image.data[_+k]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(i,s){for(let A=i.length-1;A>=0;--A){const k=i[A],j=i[A+1];k.zeroLength?i.splice(A,1):j&&j.isDash===k.isDash&&(j.left=k.left,i.splice(A,1))}const d=i[0],f=i[i.length-1];d.isDash===f.isDash&&(d.left=f.left-this.width,f.right=d.right+this.width);const y=this.width*this.nextRow;let _=0,S=i[_];for(let A=0;A<this.width;A++){A/S.right>1&&(S=i[++_]);const k=Math.abs(A-S.left),j=Math.abs(A-S.right),R=Math.min(k,j);this.image.data[y+A]=Math.max(0,Math.min(255,(S.isDash?R:-R)+s+128))}}addDash(i,s){const d=this.getKey(i,s);if(this.positions[d])return this.positions[d];const f=s==="round",y=f?7:0,_=2*y+1;if(this.nextRow+_>this.height)return Wr("LineAtlas out of space"),null;i.length===0&&i.push(1);let S=0;for(let j=0;j<i.length;j++)i[j]<0&&(Wr("Negative value is found in line dasharray, replacing values with 0"),i[j]=0),S+=i[j];if(S!==0){const j=this.width/S,R=this.getDashRanges(i,this.width,j);f?this.addRoundDash(R,j,y):this.addRegularDash(R,s==="square"?.5*j:0)}const A=this.nextRow+y;this.nextRow+=_;const k={tl:[A,y],br:[S,0]};return this.positions[d]=k,k}}Wt(WF,"LineAtlas");const nie=yt.types,iie=Math.cos(Math.PI/180*37.5),oie=Math.cos(Math.PI/180*5);class zP{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Og,this.layoutVertexArray2=new as,this.patternVertexArray=new as,this.indexArray=new ii,this.programConfigurations=new ls(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new ui,this.maxLineLength=0,this.zOffsetVertexArray=new as,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:Dt/64,this.worldview=i.worldview}updateFootprints(i,s){}populate(i,s,d,f){this.hasPattern=hP("line",this.layers,this.pixelRatio,s);const y=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ee(d);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const L=this.layers[0].layout.get("line-z-offset"),H=L.isConstant()&&!L.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&H?"none":"offset",this.elevationType==="offset"&&_==="none"&&Wr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&S!==void 0;const A=[];for(const{feature:L,id:H,index:W,sourceLayerIndex:J}of i){const Q=this.layers[0]._featureFilter.needGeometry,ae=Ze(L,Q);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),ae,d))continue;const de=y?y.evaluate(ae,{},d):void 0,he={id:H,properties:L.properties,type:L.type,sourceLayerIndex:J,index:W,geometry:Q?ae.geometry:nt(L,d,f),patterns:{},sortKey:de};A.push(he)}y&&A.sort((L,H)=>L.sortKey-H.sortKey);const{lineAtlas:k,featureIndex:j}=s,R=this.addConstantDashes(k);for(const L of A){const{geometry:H,index:W,sourceLayerIndex:J}=L;if(R&&this.addFeatureDashes(L,k),this.hasPattern){const Q=dP("line",this.layers,L,this.zoom,this.pixelRatio,s);this.patternFeatures.push(Q)}else this.addFeature(L,H,W,d,k.positions,s.availableImages,s.brightness,s.elevationFeatures);j.insert(i[W].feature,H,W,J,this.index)}}addConstantDashes(i){let s=!1;for(const d of this.layers){const f=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(f.kind!=="constant"||y.kind!=="constant")s=!0;else{const _=y.value,S=f.value;if(!S)continue;i.addDash(S,_)}}return s}addFeatureDashes(i,s){const d=this.zoom;for(const f of this.layers){const y=f.paint.get("line-dasharray").value,_=f.layout.get("line-cap").value;if(y.kind==="constant"&&_.kind==="constant")continue;let S,A;if(y.kind==="constant"){if(S=y.value,!S)continue}else S=y.evaluate({zoom:d},i);A=_.kind==="constant"?_.value:_.evaluate({zoom:d},i),s.addDash(S,A),i.patterns[f.id]=[s.getKey(S,A)]}}update(i,s,d,f,y,_,S,A){this.programConfigurations.updatePaintArrays(i,s,y,d,f,_,S,A)}addFeatures(i,s,d,f,y,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,s,d,f,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,eie)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,rie)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,Yne.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Jne),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,s,d,f,y,_,S,A){const k=this.layers[0].layout,j=k.get("line-join").evaluate(i,{}),R=k.get("line-cap").evaluate(i,{}),L=k.get("line-miter-limit"),H=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i,this.zOffsetValue=k.get("line-z-offset").value;const W=this.layers[0].paint.get("line-width").value;if(W.kind!=="constant"&&W.isLineProgressConstant===!1&&(this.variableWidthValue=W),this.elevationType==="road"){const J=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,s,f,A,j,R,L,H)){const[Q,ae]=this.clipRuntimeLinesToTile(s,1);for(let de=0;de<Q.length;de++){const he=Q[de],fe=ae[de],Me={progress:{min:fe.progress.min,max:fe.progress.max},nextDir:this.computeSegNextDir(fe,he),prevDir:this.computeSegPrevDir(fe,he)};this.addLine(he,i,f,j,R,L,H,Me)}this.fillNonElevatedRoadSegment(J)}}else for(const J of s)this.addLine(J,i,f,j,R,L,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,y,_,f,S,void 0,this.worldview)}computeSegNextDir(i,s){return i.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(i,s){return s[1].sub(i.prevPoint).unit()}clipLinesToTile(i,s){return MS(i,-s,-s,Dt+s,Dt+s)}clipRuntimeLinesToTile(i,s){const d=[];return[MS(i,-s,-s,Dt+s,Dt+s,d),d]}addElevatedRoadFeature(i,s,d,f,y,_,S,A){const k=[],j=rn.getElevationFeature(i,f);if(j){const R=this.clipLinesToTile(s,1),L=this.prepareElevatedLines(R,j,d);for(const H of L)k.push({geometry:H,elevation:j,elevationTileID:d,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(k.length===0)return!1;for(const R of k){const L=this.layoutVertexArray.length;this.addLine(R.geometry,i,d,y,_,S,A);const H=new xn(d,R.elevationTileID);if(R.elevation)for(let W=L;W<this.layoutVertexArray.length;W++){const J=new ut(this.layoutVertexArray.int16[6*W]>>1,this.layoutVertexArray.int16[6*W+1]>>1),Q=H.pointElevation(J,R.elevation,.05);this.updateHeightRange(Q),this.zOffsetVertexArray.emplaceBack(Q,0,0)}else this.fillNonElevatedRoadSegment(L)}return!0}prepareElevatedLines(i,s,d){if(s.constantHeight!=null)return i;const f=[],y=1/Ee(d);for(const _ of i)wne(_,new mn(s,y),0,f);return f}fillNonElevatedRoadSegment(i){for(let s=i;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,s,d,f,y,_,S,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const k=f==="none";this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const j=A&&A.progress.min>0,R=A&&A.progress.max<1;if(this.lineClips){let Le={min:this.lineClips.start,max:this.lineClips.end},Be=1;if(A){const ft=this.lineClips.end-this.lineClips.start;Le=function(wt,xt,At){return{min:If(wt.min,xt,At),max:If(wt.max,xt,At)}}(A.progress,{min:0,max:1},Le),ft>0&&(Be=(Le.max-Le.min)/ft)}const st=+s.properties.mapbox_clip_feature_len,Ge=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(st)||Number.isNaN(Ge)){for(let wt=0;wt<i.length-1;wt++)this.totalDistance+=i[wt].dist(i[wt+1]);const ft=this.totalDistance/(Le.max-Le.min);this.totalFeatureLength=Number.isFinite(ft)?ft:0,this.lineClips.start=Le.min,this.lineClips.end=Le.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=st,this.distance=Ge*Be,this.lineClips.start=Le.min,this.lineClips.end=Le.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const L=nie[s.type]==="Polygon";let H=i.length;for(;H>=2&&i[H-1].equals(i[H-2]);)H--;let W=0;for(;W<H-1&&i[W].equals(i[W+1]);)W++;if(H<(L?3:2))return;f==="bevel"&&(_=1.05);const J=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray);let Q,ae,de,he,fe,Me,Ae,ke;A&&A.prevDir&&(Me=A.prevDir.perp()),A&&A.nextDir&&(Ae=A.nextDir.perp()),this.e1=this.e2=-1,L&&(Q=i[H-2],fe=i[W].sub(Q)._unit()._perp());for(let Le=W;Le<H;Le++){if(de=Le===H-1?L?i[W+1]:void 0:i[Le+1],de&&i[Le].equals(de))continue;fe&&(he=fe),Q&&(ae=Q),Q=i[Le],ke=this.evaluateLineProgressFeatures(ae?ae.dist(Q):0),fe=de?de.sub(Q)._unit()._perp():he,he=he||fe;const Be=ae&&de;let st=Be?f:L||k?"butt":y;const Ge=he.x*fe.x+he.y*fe.y;if(k){const Xe=function(at){if(at.patternJoinNone){const Mt=at.segmentPoints.length/2,St=at.lineSoFar-at.segmentStart;for(let ar=0;ar<Mt;++ar){const Kt=at.segmentPoints[2*ar+1],_t=Math.round(at.segmentPoints[2*ar])+.5+.25*Kt;at.patternVertexArray.emplaceBack(_t,St,at.segmentStart),at.patternVertexArray.emplaceBack(_t,St,at.segmentStart)}at.segmentPoints.length=0}at.e1=at.e2=-1};if(Be&&Ge<oie){this.updateDistance(ae,Q),this.addCurrentVertex(Q,he,1,1,J,ke),Xe(this),this.addCurrentVertex(Q,fe,-1,-1,J,ke);continue}if(ae){if(!de){this.updateDistance(ae,Q),this.addCurrentVertex(Q,he,1,1,J,ke),Xe(this);continue}st="miter"}}let ft=he.add(fe);ft.x===0&&ft.y===0||ft._unit();const wt=ft.x*fe.x+ft.y*fe.y,xt=wt!==0?1/wt:1/0,At=2*Math.sqrt(2-2*wt),kt=wt<iie&&ae&&de,it=he.x*fe.y-he.y*fe.x>0,Tt=this.overscaling<=16?15*Dt/(512*this.overscaling):0;if(Be&&st==="round"){if(xt<S)st="miter";else if(xt<=2){const Xe=NP(Q,-10,Dt+10);st=this.elevationType==="offset"&&(Xe||this.hasCrossSlope)?"miter":"fakeround"}}if(st==="miter"&&xt>_&&(st="bevel"),st==="bevel"&&(xt>2&&(st="flipbevel"),xt<_&&(st="miter")),ae&&!(st==="miter"&&kt)&&this.updateDistance(ae,Q),st==="miter")if(kt){const Xe=Q.dist(ae);if(Xe>2*Tt){const Mt=Q.sub(Q.sub(ae)._mult(Tt/Xe)._round());this.updateDistance(ae,Mt),this.addCurrentVertex(Mt,he,0,0,J,ke),ae=Mt}this.updateDistance(ae,Q),ft._mult(xt),this.addCurrentVertex(Q,ft,0,0,J,ke);const at=Q.dist(de);if(at>2*Tt){const Mt=Q.add(de.sub(Q)._mult(Tt/at)._round());this.updateDistance(Q,Mt),this.addCurrentVertex(Mt,fe,0,0,J,ke),Q=Mt}}else ft._mult(xt),this.addCurrentVertex(Q,ft,0,0,J,ke);else if(st==="flipbevel"){if(xt>100)ft=fe.mult(-1);else{const Xe=xt*he.add(fe).mag()/he.sub(fe).mag();ft._perp()._mult(Xe*(it?-1:1))}this.addCurrentVertex(Q,ft,0,0,J,ke),this.addCurrentVertex(Q,ft.mult(-1),0,0,J,ke)}else if(st==="bevel"||st==="fakeround"){ke!=null&&ae&&this.addCurrentVertex(Q,Ae||he,-1,-1,J,ke);const Xe=Q.dist(ae)<=2*Tt&&st!=="bevel",at=ft.mult(it?1:-1);at._mult(xt);const Mt=fe.mult(it?-1:1),St=he.mult(it?-1:1),ar=this.evaluateLineProgressFeatures(this.distance);if(ke==null&&(this.addHalfVertex(Q,at.x,at.y,!1,!it,0,J,ar),Xe||this.addHalfVertex(Q,at.x+2*St.x,at.y+2*St.y,!1,it,0,J,ar)),st==="fakeround"){const Kt=Math.round(180*At/Math.PI/20);this.addHalfVertex(Q,St.x,St.y,!1,it,0,J,ar);for(let _t=0;_t<Kt;_t++){let Pt=_t/Kt;if(Pt!==.5){const Bt=Pt-.5;Pt+=Pt*Bt*(Pt-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*Bt*Bt+(.848013+Ge*(.215638*Ge-1.06021)))}const rr=Mt.sub(St)._mult(Pt)._add(St)._unit();this.addHalfVertex(Q,rr.x,rr.y,!1,it,0,J,ar)}this.addHalfVertex(Q,Mt.x,Mt.y,!1,it,0,J,ar)}Xe||ke!=null||this.addHalfVertex(Q,at.x+2*Mt.x,at.y+2*Mt.y,!1,it,0,J,ar),ke!=null&&de&&this.addCurrentVertex(Q,Me||fe,1,1,J,ke)}else if(st==="butt")this.addCurrentVertex(Q,ft,0,0,J,ke);else if(st==="square"){if(!ae){const Xe=j?0:-1;this.addCurrentVertex(Q,ft,Xe,Xe,J,ke)}if(this.addCurrentVertex(Q,ft,0,0,J,ke),ae){const Xe=R?0:1;this.addCurrentVertex(Q,ft,Xe,Xe,J,ke)}}else if(st==="round"){if(ae){const Xe=!Be&&Ae?Ae:he;this.addCurrentVertex(Q,Xe,0,0,J,ke),!Be&&R||this.addCurrentVertex(Q,Xe,1,1,J,ke,!0)}if(de){const Xe=!Be&&Me?Me:fe;!Be&&j||this.addCurrentVertex(Q,Xe,-1,-1,J,ke,!0),this.addCurrentVertex(Q,Xe,0,0,J,ke)}}}}addVerticesTo(i,s,d,f,y,_,S,A,k,j){const R=(s.w-i.w)/this.tessellationStep|0;let L=0;const H=this.scaledDistance;if(R>1){this.lineSoFar=i.w;const J=(s.x-i.x)/R,Q=(s.y-i.y)/R,ae=(s.z-i.z)/R,de=(s.w-i.w)/R;for(let he=1;he<R;++he){i.x+=J,i.y+=Q,i.z+=ae,this.lineSoFar+=de,L+=de;const fe=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(i,d,f,j,!1,S,k,fe),this.addHalfVertex(i,y,_,j,!0,-A,k,fe)}}this.lineSoFar=s.w,this.scaledDistance=H;const W=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,d,f,j,!1,S,k,W),this.addHalfVertex(s,y,_,j,!0,-A,k,W)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):Wr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(i,s,d,f,y,_,S=!1){const A=s.x+s.y*d,k=s.y-s.x*d,j=s.y*f-s.x,R=-s.y-s.x*f;if(_!=null){const L=this.elevationType==="offset",H=-10,W=Dt+10,J=_.zOffset,Q=new gF(i.x,i.y,J,this.lineSoFar),ae=!!L&&NP(i,H,W),de=this.lineSoFar,he=this.distance;if(this.currentVertex)if(ae){const fe=this.currentVertexIsOutside,Me=this.currentVertex,Ae=new gF(i.x,i.y,J,this.lineSoFar);if(_F(Me,Ae,H,W),!NP(Ae,H,W)){if(fe){this.e1=this.e2=-1,this.distance-=Me.dist(Q),this.lineSoFar=Me.w;const ke=this.evaluateLineProgressFeatures(Me.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Me,A,k,S,!1,d,y,ke),this.addHalfVertex(Me,j,R,S,!0,-f,y,ke),this.prevDistance=this.distance}this.distance=this.prevDistance+Me.dist(Ae),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Me,Ae,A,k,j,R,d,f,y,S),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const fe=this.currentVertex;if(this.currentVertexIsOutside){_F(fe,Q,H,W),this.e1=this.e2=-1,this.distance-=fe.dist(Q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=fe.w;const Me=this.evaluateLineProgressFeatures(fe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(fe,A,k,S,!1,d,y,Me),this.addHalfVertex(fe,j,R,S,!0,-f,y,Me),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(fe,Q,A,k,j,R,d,f,y,S)}else ae||(this.addHalfVertex(i,A,k,S,!1,d,y,_),this.addHalfVertex(i,j,R,S,!0,-f,y,_));this.currentVertex=Q,this.currentVertexIsOutside=ae,this.lineSoFar=de}else this.addHalfVertex(i,A,k,S,!1,d,y,_),this.addHalfVertex(i,j,R,S,!0,-f,y,_)}addHalfVertex({x:i,y:s},d,f,y,_,S,A,k){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((i<<1)+(y?1:0),(s<<1)+(_?1:0),Math.round(63*d)+128,Math.round(63*f)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const R=lr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,R)}const j=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),A.primitiveLength++),_?this.e2=j:this.e1=j,k!=null&&this.zOffsetVertexArray.emplaceBack(k.zOffset,k.variableWidth,k.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,s){this.prevDistance=this.distance,this.distance+=i.dist(s),this.updateScaledDistance()}}function NP(l,i,s){return l.x<i||l.x>s||l.y<i||l.y>s}let ZF,KF;function XF(l,i,s){return i*(Dt/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}Wt(zP,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const YF=(l,i,s)=>(1-s)*l+s*i;function JF(l,i){return 1/XF(l,1,i.tileZoom)}function QF(l,i,s,d){return l.translatePosMatrix(d||i.tileID.projMatrix,i,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const e5=l=>{const i=[];t5(l)&&i.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const s=l.paint.get("line-trim-offset");s[0]===0&&s[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const d=l.layout.get("line-join").constantOr("miter")==="none",f=!!l.paint.get("line-pattern").constantOr(1);return d&&f&&i.push("LINE_JOIN_NONE"),i};function t5(l){const i=l.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}let FP;const r5=()=>FP||(FP={layout:ZF||(ZF=new wi({"line-cap":new $t($e.layout_line["line-cap"]),"line-join":new $t($e.layout_line["line-join"]),"line-miter-limit":new It($e.layout_line["line-miter-limit"]),"line-round-limit":new It($e.layout_line["line-round-limit"]),"line-sort-key":new $t($e.layout_line["line-sort-key"]),"line-z-offset":new $t($e.layout_line["line-z-offset"]),"line-elevation-reference":new It($e.layout_line["line-elevation-reference"]),"line-cross-slope":new It($e.layout_line["line-cross-slope"]),visibility:new It($e.layout_line.visibility),"line-width-unit":new It($e.layout_line["line-width-unit"])})),paint:KF||(KF=new wi({"line-opacity":new $t($e.paint_line["line-opacity"]),"line-color":new $t($e.paint_line["line-color"]),"line-translate":new It($e.paint_line["line-translate"]),"line-translate-anchor":new It($e.paint_line["line-translate-anchor"]),"line-width":new $t($e.paint_line["line-width"]),"line-gap-width":new $t($e.paint_line["line-gap-width"]),"line-offset":new $t($e.paint_line["line-offset"]),"line-blur":new $t($e.paint_line["line-blur"]),"line-dasharray":new $t($e.paint_line["line-dasharray"]),"line-pattern":new $t($e.paint_line["line-pattern"]),"line-pattern-cross-fade":new It($e.paint_line["line-pattern-cross-fade"]),"line-gradient":new ud($e.paint_line["line-gradient"]),"line-trim-offset":new It($e.paint_line["line-trim-offset"]),"line-trim-fade-range":new It($e.paint_line["line-trim-fade-range"]),"line-trim-color":new It($e.paint_line["line-trim-color"]),"line-emissive-strength":new It($e.paint_line["line-emissive-strength"]),"line-border-width":new $t($e.paint_line["line-border-width"]),"line-border-color":new $t($e.paint_line["line-border-color"]),"line-occlusion-opacity":new It($e.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},FP);class aie extends $t{possiblyEvaluate(i,s){return s=new On(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(i,s)}evaluate(i,s,d,f){return s=Qe({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(i,s,d,f)}}let J0;function n5(l,i){return i>0?i+2*l:l}const sie=Yr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lie=Yr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),cie=Yr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const uie=Yr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),hie=Yr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),die=Yr([{name:"a_texb",components:2,type:"Uint16"}]),fie=Yr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pie=Yr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const i5=Yr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mie=Yr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yr([{name:"triangle",components:3,type:"Uint16"}]),Yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Yr([{type:"Float32",name:"offsetX"}]),Yr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var To=24;function gie(l,i,s){return l.sections.forEach(d=>{d.text=function(f,y,_){const S=y.layout.get("text-transform").evaluate(_,{});return S==="uppercase"?f=f.toLocaleUpperCase():S==="lowercase"&&(f=f.toLocaleLowerCase()),_l.applyArabicShaping&&(f=_l.applyArabicShaping(f)),f}(d.text,i,s)}),l}const Q0={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function yie(l){return l==="︶"||l==="﹈"||l==="︸"||l==="﹄"||l==="﹂"||l==="︾"||l==="︼"||l==="︺"||l==="︘"||l==="﹀"||l==="︐"||l==="︓"||l==="︔"||l==="｀"||l==="￣"||l==="︑"||l==="︒"}function _ie(l){return l==="︵"||l==="﹇"||l==="︷"||l==="﹃"||l==="﹁"||l==="︽"||l==="︻"||l==="︹"||l==="︗"||l==="︿"}const BP=4294967296,o5=1/BP,a5=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let FS=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,i,s=this.length){for(;this.pos<s;){const d=this.readVarint(),f=d>>3,y=this.pos;this.type=7&d,l(f,i,this),this.pos===y&&this.skip(d)}return i}readMessage(l,i){return this.readFields(l,i,this.readVarint()+this.pos)}readFixed32(){const l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){const l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*BP;return this.pos+=8,l}readSFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*BP;return this.pos+=8,l}readFloat(){const l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){const l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){const i=this.buf;let s,d;return d=i[this.pos++],s=127&d,d<128?s:(d=i[this.pos++],s|=(127&d)<<7,d<128?s:(d=i[this.pos++],s|=(127&d)<<14,d<128?s:(d=i[this.pos++],s|=(127&d)<<21,d<128?s:(d=i[this.pos],s|=(15&d)<<28,function(f,y,_){const S=_.buf;let A,k;if(k=S[_.pos++],A=(112&k)>>4,k<128||(k=S[_.pos++],A|=(127&k)<<3,k<128)||(k=S[_.pos++],A|=(127&k)<<10,k<128)||(k=S[_.pos++],A|=(127&k)<<17,k<128)||(k=S[_.pos++],A|=(127&k)<<24,k<128)||(k=S[_.pos++],A|=(1&k)<<31,k<128))return vie(f,A,y);throw new Error("Expected varint not more than 10 bytes")}(s,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){const l=this.readVarint()+this.pos,i=this.pos;return this.pos=l,l-i>=12&&a5?a5.decode(this.buf.subarray(i,l)):function(s,d,f){let y="",_=d;for(;_<f;){const S=s[_];let A,k,j,R=null,L=S>239?4:S>223?3:S>191?2:1;if(_+L>f)break;L===1?S<128&&(R=S):L===2?(A=s[_+1],(192&A)==128&&(R=(31&S)<<6|63&A,R<=127&&(R=null))):L===3?(A=s[_+1],k=s[_+2],(192&A)==128&&(192&k)==128&&(R=(15&S)<<12|(63&A)<<6|63&k,(R<=2047||R>=55296&&R<=57343)&&(R=null))):L===4&&(A=s[_+1],k=s[_+2],j=s[_+3],(192&A)==128&&(192&k)==128&&(192&j)==128&&(R=(15&S)<<18|(63&A)<<12|(63&k)<<6|63&j,(R<=65535||R>=1114112)&&(R=null))),R===null?(R=65533,L=1):R>65535&&(R-=65536,y+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),y+=String.fromCharCode(R),_+=L}return y}(this.buf,i,l)}readBytes(){const l=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,l);return this.pos=l,i}readPackedVarint(l=[],i){const s=this.readPackedEnd();for(;this.pos<s;)l.push(this.readVarint(i));return l}readPackedSVarint(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFloat());return l}readPackedDouble(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){const i=7&l;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(l,i){this.writeVarint(l<<3|i)}realloc(l){let i=this.length||16;for(;i<this.pos+l;)i*=2;if(i!==this.length){const s=new Uint8Array(i);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*o5),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*o5),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?function(i,s){let d,f;if(i>=0?(d=i%4294967296|0,f=i/4294967296|0):(d=~(-i%4294967296),f=~(-i/4294967296),4294967295^d?d=d+1|0:(d=0,f=f+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(y,_,S){S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,S.buf[S.pos]=127&(y>>>=7)}(d,0,s),function(y,_){const S=(7&y)<<4;_.buf[_.pos++]|=S|((y>>>=3)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y)))))}(f,s)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;const i=this.pos;this.pos=function(d,f,y){for(let _,S,A=0;A<f.length;A++){if(_=f.charCodeAt(A),_>55295&&_<57344){if(!S){_>56319||A+1===f.length?(d[y++]=239,d[y++]=191,d[y++]=189):S=_;continue}if(_<56320){d[y++]=239,d[y++]=191,d[y++]=189,S=_;continue}_=S-55296<<10|_-56320|65536,S=null}else S&&(d[y++]=239,d[y++]=191,d[y++]=189,S=null);_<128?d[y++]=_:(_<2048?d[y++]=_>>6|192:(_<65536?d[y++]=_>>12|224:(d[y++]=_>>18|240,d[y++]=_>>12&63|128),d[y++]=_>>6&63|128),d[y++]=63&_|128)}return y}(this.buf,l,this.pos);const s=this.pos-i;s>=128&&s5(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){const i=l.length;this.writeVarint(i),this.realloc(i);for(let s=0;s<i;s++)this.buf[this.pos++]=l[s]}writeRawMessage(l,i){this.pos++;const s=this.pos;l(i,this);const d=this.pos-s;d>=128&&s5(s,d,this),this.pos=s-1,this.writeVarint(d),this.pos+=d}writeMessage(l,i,s){this.writeTag(l,2),this.writeRawMessage(i,s)}writePackedVarint(l,i){i.length&&this.writeMessage(l,xie,i)}writePackedSVarint(l,i){i.length&&this.writeMessage(l,bie,i)}writePackedBoolean(l,i){i.length&&this.writeMessage(l,Tie,i)}writePackedFloat(l,i){i.length&&this.writeMessage(l,wie,i)}writePackedDouble(l,i){i.length&&this.writeMessage(l,Sie,i)}writePackedFixed32(l,i){i.length&&this.writeMessage(l,Eie,i)}writePackedSFixed32(l,i){i.length&&this.writeMessage(l,Aie,i)}writePackedFixed64(l,i){i.length&&this.writeMessage(l,kie,i)}writePackedSFixed64(l,i){i.length&&this.writeMessage(l,Cie,i)}writeBytesField(l,i){this.writeTag(l,2),this.writeBytes(i)}writeFixed32Field(l,i){this.writeTag(l,5),this.writeFixed32(i)}writeSFixed32Field(l,i){this.writeTag(l,5),this.writeSFixed32(i)}writeFixed64Field(l,i){this.writeTag(l,1),this.writeFixed64(i)}writeSFixed64Field(l,i){this.writeTag(l,1),this.writeSFixed64(i)}writeVarintField(l,i){this.writeTag(l,0),this.writeVarint(i)}writeSVarintField(l,i){this.writeTag(l,0),this.writeSVarint(i)}writeStringField(l,i){this.writeTag(l,2),this.writeString(i)}writeFloatField(l,i){this.writeTag(l,5),this.writeFloat(i)}writeDoubleField(l,i){this.writeTag(l,1),this.writeDouble(i)}writeBooleanField(l,i){this.writeVarintField(l,+i)}};function vie(l,i,s){return s?4294967296*i+(l>>>0):4294967296*(i>>>0)+(l>>>0)}function s5(l,i,s){const d=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));s.realloc(d);for(let f=s.pos-1;f>=l;f--)s.buf[f+d]=s.buf[f]}function xie(l,i){for(let s=0;s<l.length;s++)i.writeVarint(l[s])}function bie(l,i){for(let s=0;s<l.length;s++)i.writeSVarint(l[s])}function wie(l,i){for(let s=0;s<l.length;s++)i.writeFloat(l[s])}function Sie(l,i){for(let s=0;s<l.length;s++)i.writeDouble(l[s])}function Tie(l,i){for(let s=0;s<l.length;s++)i.writeBoolean(l[s])}function Eie(l,i){for(let s=0;s<l.length;s++)i.writeFixed32(l[s])}function Aie(l,i){for(let s=0;s<l.length;s++)i.writeSFixed32(l[s])}function kie(l,i){for(let s=0;s<l.length;s++)i.writeFixed64(l[s])}function Cie(l,i){for(let s=0;s<l.length;s++)i.writeSFixed64(l[s])}const UP=3;function Pie(l,i,s){i.glyphs=[],l===1&&s.readMessage(Mie,i)}function Mie(l,i,s){if(l===3){const{id:d,bitmap:f,width:y,height:_,left:S,top:A,advance:k}=s.readMessage(Iie,{});i.glyphs.push({id:d,bitmap:new kd({width:y+2*UP,height:_+2*UP},f),metrics:{width:y,height:_,left:S,top:A,advance:k}})}else l===4?i.ascender=s.readSVarint():l===5&&(i.descender=s.readSVarint())}function Iie(l,i,s){l===1?i.id=s.readVarint():l===2?i.bitmap=s.readBytes():l===3?i.width=s.readVarint():l===4?i.height=s.readVarint():l===5?i.left=s.readSVarint():l===6?i.top=s.readSVarint():l===7&&(i.advance=s.readVarint())}const l5=UP,hs={horizontal:1,vertical:2,horizontalOnly:3};class ex{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,s){const d=new ex;return d.scale=i||1,d.fontStack=s,d}static forImage(i){const s=new ex;return s.image=i,s}}class Kg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,s,d){const f=new Kg;for(let y=0;y<i.sections.length;y++){const _=i.sections[y];_.image?f.addImageSection(_,d):f.addTextSection(_,s)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(s,d){let f="";for(let y=0;y<s.length;y++){const _=s.charCodeAt(y+1)||null,S=s.charCodeAt(y-1)||null;f+=!d&&(_&&Eg(_)&&!Q0[s[y+1]]||S&&Eg(S)&&!Q0[s[y-1]])||!Q0[s[y]]?s[y]:Q0[s[y]]}return f}(this.text,i)}trim(){let i=0;for(let d=0;d<this.text.length&&BS[this.text.charCodeAt(d)];d++)i++;let s=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&BS[this.text.charCodeAt(d)];d--)s--;this.text=this.text.substring(i,s),this.sectionIndex=this.sectionIndex.slice(i,s)}substring(i,s){const d=new Kg;return d.text=this.text.substring(i,s),d.sectionIndex=this.sectionIndex.slice(i,s),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,s)=>Math.max(i,this.sections[s].scale),0)}addTextSection(i,s){this.text+=i.text,this.sections.push(ex.forText(i.scale,i.fontStack||s));const d=this.sections.length-1;for(let f=0;f<i.text.length;++f)this.sectionIndex.push(d)}addImageSection(i,s){const d=i.image?i.image.getPrimary():null;if(!d)return void Wr("Can't add FormattedSection with an empty image.");d.scaleSelf(s);const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCodePoint(f),this.sections.push(ex.forImage(d)),this.sectionIndex.push(this.sections.length-1)):Wr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function VP(l,i,s,d,f,y,_,S,A,k,j,R,L,H,W,J=1){const Q=Kg.fromFeature(l,f,J);R===hs.vertical&&Q.verticalizePunctuation(L);let ae=[];const de=function(ke,Le,Be,st,Ge,ft){if(!ke)return[];const wt=[],xt=function(Tt,Xe,at,Mt,St,ar){let Kt=0;for(let _t=0;_t<Tt.length();_t++){const Pt=Tt.getSection(_t);Kt+=c5(Tt.getCodePoint(_t),Pt,Mt,St,Xe,ar)}return Kt/Math.max(1,Math.ceil(Kt/at))}(ke,Le,Be,st,Ge,ft),At=ke.text.indexOf("​")>=0;let kt=0;for(let Tt=0;Tt<ke.length();Tt++){const Xe=ke.getSection(Tt),at=ke.getCodePoint(Tt);if(BS[at]||(kt+=c5(at,Xe,st,Ge,Le,ft)),Tt<ke.length()-1){const Mt=!((it=at)<11904||!(hr["Bopomofo Extended"](it)||hr.Bopomofo(it)||hr["CJK Compatibility Forms"](it)||hr["CJK Compatibility Ideographs"](it)||hr["CJK Compatibility"](it)||hr["CJK Radicals Supplement"](it)||hr["CJK Strokes"](it)||hr["CJK Symbols and Punctuation"](it)||hr["CJK Unified Ideographs Extension A"](it)||hr["CJK Unified Ideographs"](it)||hr["Enclosed CJK Letters and Months"](it)||hr["Halfwidth and Fullwidth Forms"](it)||hr.Hiragana(it)||hr["Ideographic Description Characters"](it)||hr["Kangxi Radicals"](it)||hr["Katakana Phonetic Extensions"](it)||hr.Katakana(it)||hr["Vertical Forms"](it)||hr["Yi Radicals"](it)||hr["Yi Syllables"](it)));(Oie[at]||Mt||Xe.image)&&wt.push(h5(Tt+1,kt,xt,wt,jie(at,ke.getCodePoint(Tt+1),Mt&&At),!1))}}var it;return d5(h5(ke.length(),kt,xt,wt,0,!0))}(Q,k,y,i,d,H),{processBidirectionalText:he,processStyledBidirectionalText:fe}=_l;if(he&&Q.sections.length===1){const ke=he(Q.toString(),de);for(const Le of ke){const Be=new Kg;Be.text=Le,Be.sections=Q.sections;for(let st=0;st<Le.length;st++)Be.sectionIndex.push(0);ae.push(Be)}}else if(fe){const ke=fe(Q.text,Q.sectionIndex,de);for(const Le of ke){const Be=new Kg;Be.text=Le[0],Be.sectionIndex=Le[1],Be.sections=Q.sections,ae.push(Be)}}else ae=function(ke,Le){const Be=[],st=ke.text;let Ge=0;for(const ft of Le)Be.push(ke.substring(Ge,ft)),Ge=ft;return Ge<st.length&&Be.push(ke.substring(Ge,st.length)),Be}(Q,de);const Me=[],Ae={positionedLines:Me,text:Q.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ke,Le,Be,st,Ge,ft,wt,xt,At,kt,it,Tt){let Xe=0,at=0,Mt=0;const St=xt==="right"?1:xt==="left"?0:.5;let ar=!1;for(const Nt of Ge){const qt=Nt.getSections();for(const pr of qt){if(pr.image)continue;const gr=Le[pr.fontStack];if(gr&&(ar=gr.ascender!==void 0&&gr.descender!==void 0,!ar))break}if(!ar)break}let Kt=0;for(const Nt of Ge){Nt.trim();const qt=Nt.getMaxScale(),pr=(qt-1)*To,gr={positionedGlyphs:[],lineOffset:0};ke.positionedLines[Kt]=gr;const Pr=gr.positionedGlyphs;let Ar=0;if(!Nt.length()){at+=ft,++Kt;continue}let Qr=0,Ur=0;for(let _e=0;_e<Nt.length();_e++){const ve=Nt.getSection(_e),ot=Nt.getSectionIndex(_e),Rt=Nt.getCodePoint(_e);let zt=ve.scale,Lt=null,Jt=null,yr=null,Vr=To,$r=0,jr=At;jr===hs.vertical&&((_t=Rt)===12312||_t===12313||_t===12316||_t===12540||_t===12448)&&(jr=hs.horizontal);const jn=!(jr===hs.horizontal||!it&&!Tg(Rt)||it&&(BS[Rt]||X1(Rt)));if(ve.image){const gi=st.get(ve.image.toString());if(!gi)continue;yr=ve.image,ke.iconsInText=ke.iconsInText||!0,Jt=gi.paddedRect;const Ir=gi.displaySize;zt=zt*To/Tt,Lt={width:Ir[0],height:Ir[1],left:0,top:-l5,advance:jn?Ir[1]:Ir[0],localGlyph:!1},$r=ar?-Lt.height*zt:qt*To-17-Ir[1]*zt,Vr=Lt.advance;const ti=(jn?Ir[0]:Ir[1])*zt-To*qt;ti>0&&ti>Ar&&(Ar=ti)}else{const gi=Be[ve.fontStack];if(!gi)continue;gi[Rt]&&(Jt=gi[Rt]);const Ir=Le[ve.fontStack];if(!Ir)continue;const ti=Ir.glyphs[Rt];if(!ti)continue;if(Lt=ti.metrics,Vr=Rt!==8203?To:0,ar){const $n=Ir.ascender!==void 0?Math.abs(Ir.ascender):0,An=Ir.descender!==void 0?Math.abs(Ir.descender):0,di=($n+An)*zt;Qr<di&&(Qr=di,Ur=($n-An)/2*zt),$r=-$n*zt}else $r=(qt-zt)*To-17}jn?(ke.verticalizable=!0,Pr.push({glyph:Rt,image:yr,x:Xe,y:at+$r,vertical:jn,scale:zt,localGlyph:Lt.localGlyph,fontStack:ve.fontStack,sectionIndex:ot,metrics:Lt,rect:Jt}),Xe+=Vr*zt+kt):(Pr.push({glyph:Rt,image:yr,x:Xe,y:at+$r,vertical:jn,scale:zt,localGlyph:Lt.localGlyph,fontStack:ve.fontStack,sectionIndex:ot,metrics:Lt,rect:Jt}),Xe+=Lt.advance*zt+kt)}Pr.length!==0&&(Mt=Math.max(Xe-kt,Mt),ar?f5(Pr,St,Ar,Ur,ft*qt/2):f5(Pr,St,Ar,0,ft/2)),Xe=0;const Kn=ft*qt+Ar;gr.lineOffset=Math.max(Ar,pr),at+=Kn,++Kt}var _t;const Pt=at,{horizontalAlign:rr,verticalAlign:Bt}=$P(wt);(function(Nt,qt,pr,gr,Pr,Ar){const Qr=(qt-pr)*Pr,Ur=-Ar*gr;for(const Kn of Nt)for(const _e of Kn.positionedGlyphs)_e.x+=Qr,_e.y+=Ur})(ke.positionedLines,St,rr,Bt,Mt,Pt),ke.top+=-Bt*Pt,ke.bottom=ke.top+Pt,ke.left+=-rr*Mt,ke.right=ke.left+Mt,ke.hasBaseline=ar}(Ae,i,s,d,ae,_,S,A,R,k,L,W),!function(ke){for(const Le of ke)if(Le.positionedGlyphs.length!==0)return!1;return!0}(Me))return Ae}const BS={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Oie={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function c5(l,i,s,d,f,y){if(i.image){const _=d.get(i.image.toString());return _?_.displaySize[0]*i.scale*To/y+f:0}{const _=s[i.fontStack],S=_&&_.glyphs[l];return S?S.metrics.advance*i.scale+f:0}}function u5(l,i,s,d){const f=Math.pow(l-i,2);return d?l<i?f/2:2*f:f+Math.abs(s)*s}function jie(l,i,s){let d=0;return l===10&&(d-=1e4),s&&(d+=150),l!==40&&l!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function h5(l,i,s,d,f,y){let _=null,S=u5(i,s,f,y);for(const A of d){const k=u5(i-A.x,s,f,y)+A.badness;k<=S&&(_=A,S=k)}return{index:l,x:i,priorBreak:_,badness:S}}function d5(l){return l?d5(l.priorBreak).concat(l.index):[]}function $P(l){let i=.5,s=.5;switch(l){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:i,verticalAlign:s}}function f5(l,i,s,d,f){if(!(i||s||d||f))return;const y=l.length-1,_=l[y],S=(_.x+_.metrics.advance*_.scale)*i;for(let A=0;A<=y;A++)l[A].x-=S,l[A].y+=s+d+f}function p5(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function Rie(l,i,s,d){const{horizontalAlign:f,verticalAlign:y}=$P(d),_=s[0]-l.displaySize[0]*f,S=s[1]-l.displaySize[1]*y;return{imagePrimary:l,imageSecondary:i,top:S,bottom:S+l.displaySize[1],left:_,right:_+l.displaySize[0]}}function m5(l,i,s,d,f,y){const _=l.imagePrimary;let S;if(_.content){const Q=_.content,ae=_.pixelRatio||1;S=[Q[0]/ae,Q[1]/ae,_.displaySize[0]-Q[2]/ae,_.displaySize[1]-Q[3]/ae]}const A=i.left*y,k=i.right*y;let j,R,L,H;s==="width"||s==="both"?(H=f[0]+A-d[3],R=f[0]+k+d[1]):(H=f[0]+(A+k-_.displaySize[0])/2,R=H+_.displaySize[0]);const W=i.top*y,J=i.bottom*y;return s==="height"||s==="both"?(j=f[1]+W-d[0],L=f[1]+J+d[2]):(j=f[1]+(W+J-_.displaySize[1])/2,L=j+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:j,right:R,bottom:L,left:H,collisionPadding:S}}function g5(l){return!l.imagePrimary.stretchX}function y5(l){return!l.imagePrimary.stretchY}function _5(l){return{width:l.right-l.left,height:l.bottom-l.top}}const iu=128;function v5(l,i,s){const{expression:d}=i;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new On(l+1,{worldview:s}))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:y}=d;let _=0;for(;_<f.length&&f[_]<=l;)_++;_=Math.max(0,_-1);let S=_;for(;S<f.length&&f[S]<l+1;)S++;S=Math.min(f.length-1,S);const A=f[_],k=f[S];return d.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:k,interpolationType:y}:{kind:"camera",minZoom:A,maxZoom:k,minSize:d.evaluate(new On(A,{worldview:s})),maxSize:d.evaluate(new On(k,{worldview:s})),interpolationType:y}}}function GP(l,{uSize:i,uSizeT:s},{lowerSize:d,upperSize:f}){return l.kind==="source"?d/iu:l.kind==="composite"?lr(d/iu,f/iu,s):i}function tx(l,i,s=1){let d=0,f=0;if(l.kind==="constant")f=l.layoutSize*s;else if(l.kind!=="source"){const{interpolationType:y,minZoom:_,maxZoom:S}=l,A=y?xe(Ca.interpolationFactor(y,i,_,S),0,1):0;l.kind==="camera"?f=lr(l.minSize,l.maxSize,A)*s:d=A*s}return{uSizeT:d,uSize:f}}class th extends ut{constructor(i,s,d,f,y){super(i,s),this.angle=f,this.z=d,y!==void 0&&(this.segment=y)}clone(){return new th(this.x,this.y,this.z,this.angle,this.segment)}}function x5(l,i,s,d,f){if(i.segment===void 0)return!0;let y=i,_=i.segment+1,S=0;for(;S>-s/2;){if(_--,_<0)return!1;S-=l[_].dist(y),y=l[_]}S+=l[_].dist(l[_+1]),_++;const A=[];let k=0;for(;S<s/2;){const j=l[_],R=l[_+1];if(!R)return!1;let L=l[_-1].angleTo(j)-j.angleTo(R);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:S,angleDelta:L}),k+=L;S-A[0].distance>d;)k-=A.shift().angleDelta;if(k>f)return!1;_++,S+=j.dist(R)}return!0}function b5(l){let i=0;for(let s=0;s<l.length-1;s++)i+=l[s].dist(l[s+1]);return i}function w5(l,i,s){return l?.6*i*s:0}function S5(l,i){return Math.max(l?l.right-l.left:0,i?i.right-i.left:0)}function Die(l,i,s,d,f,y){const _=w5(s,f,y),S=S5(s,d)*y;let A=0;const k=b5(l)/2;for(let j=0;j<l.length-1;j++){const R=l[j],L=l[j+1],H=R.dist(L);if(A+H>k){const W=(k-A)/H,J=lr(R.x,L.x,W),Q=lr(R.y,L.y,W),ae=new th(J,Q,0,L.angleTo(R),j);return!_||x5(l,ae,S,_,i)?ae:void 0}A+=H}}function Lie(l,i,s,d,f,y,_,S,A){const k=w5(d,y,_),j=S5(d,f),R=j*_,L=l[0].x===0||l[0].x===A||l[0].y===0||l[0].y===A;return i-R<i/4&&(i=R+i/4),T5(l,L?i/2*S%i:(j/2+2*y)*_*S%i,i,k,s,R,L,!1,A)}function T5(l,i,s,d,f,y,_,S,A){const k=y/2,j=b5(l);let R=0,L=i-s,H=[];for(let W=0;W<l.length-1;W++){const J=l[W],Q=l[W+1],ae=J.dist(Q),de=Q.angleTo(J);for(;L+s<R+ae;){L+=s;const he=(L-R)/ae,fe=lr(J.x,Q.x,he),Me=lr(J.y,Q.y,he);if(fe>=0&&fe<A&&Me>=0&&Me<A&&L-k>=0&&L+k<=j){const Ae=new th(fe,Me,0,de,W);d&&!x5(l,Ae,y,d,f)||H.push(Ae)}}R+=ae}return S||H.length||_||(H=T5(l,R/2,s,d,f,y,_,!0,A)),H}function E5(l){let i=0,s=0;for(const _ of l)i+=_.w*_.h,s=Math.max(s,_.w);l.sort((_,S)=>S.h-_.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),s),h:1/0}];let f=0,y=0;for(const _ of l)for(let S=d.length-1;S>=0;S--){const A=d[S];if(!(_.w>A.w||_.h>A.h)){if(_.x=A.x,_.y=A.y,y=Math.max(y,_.y+_.h),f=Math.max(f,_.x+_.w),_.w===A.w&&_.h===A.h){const k=d.pop();k&&S<d.length&&(d[S]=k)}else _.h===A.h?(A.x+=_.w,A.w-=_.w):_.w===A.w?(A.y+=_.h,A.h-=_.h):(d.push({x:A.x+_.w,y:A.y,w:A.w-_.w,h:_.h}),A.y+=_.h,A.h-=_.h);break}}return{w:f,h:y,fill:i/(f*y)||0}}Wt(th,"Anchor");const Ap=1;class rx{static getImagePositionScale(i,s,d){if(s&&i&&i.options&&i.options.transform){const f=i.options.transform;return{x:f.a,y:f.d}}return{x:d,y:d}}constructor(i,s,d,f){this.paddedRect=i;const{pixelRatio:y,version:_,stretchX:S,stretchY:A,content:k,sdf:j,usvg:R}=s;this.pixelRatio=y,this.stretchX=S,this.stretchY=A,this.content=k,this.version=_,this.padding=d,this.sdf=j,this.usvg=R,this.scale=rx.getImagePositionScale(f,R,y)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function qP(l,i,s){const d=Kl.parse(l),f=function(y,_,S=[1,1]){return{x:0,y:0,w:(y.data?y.data.width:y.width*S[0])+2*_,h:(y.data?y.data.height:y.height*S[1])+2*_}}(i,s,[d.options.transform.a,d.options.transform.d]);return{bin:f,imagePosition:new rx(f,i,s,d),imageVariant:d}}class A5{constructor(i,s,d){const f=new Map,y=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(i,f,Ap,_),this.addImages(s,y,2,_);const{w:S,h:A}=E5(_),k=new Lo({width:S||1,height:A||1});for(const[j,R]of i.entries()){const L=f.get(j).paddedRect;Lo.copy(R.data,k,{x:0,y:0},{x:L.x+Ap,y:L.y+Ap},R.data,d,R.sdf)}for(const[j,R]of s.entries()){const L=y.get(j),H=L.paddedRect;let W=L.padding;const J=H.x+W,Q=H.y+W,ae=R.data.width,de=R.data.height;W=W>1?W-1:W,Lo.copy(R.data,k,{x:0,y:0},{x:J,y:Q},R.data,d),Lo.copy(R.data,k,{x:0,y:de-W},{x:J,y:Q-W},{width:ae,height:W},d),Lo.copy(R.data,k,{x:0,y:0},{x:J,y:Q+de},{width:ae,height:W},d),Lo.copy(R.data,k,{x:ae-W,y:0},{x:J-W,y:Q},{width:W,height:de},d),Lo.copy(R.data,k,{x:0,y:0},{x:J+ae,y:Q},{width:W,height:de},d),Lo.copy(R.data,k,{x:ae-W,y:de-W},{x:J-W,y:Q-W},{width:W,height:W},d),Lo.copy(R.data,k,{x:0,y:de-W},{x:J+ae,y:Q-W},{width:W,height:W},d),Lo.copy(R.data,k,{x:0,y:0},{x:J+ae,y:Q+de},{width:W,height:W},d),Lo.copy(R.data,k,{x:ae-W,y:0},{x:J-W,y:Q+de},{width:W,height:W},d)}this.lut=d,this.image=k,this.iconPositions=f,this.patternPositions=y}addImages(i,s,d,f){for(const[y,_]of i.entries()){const{bin:S,imagePosition:A,imageVariant:k}=qP(y,_,d);s.set(y,A),f.push(S),_.hasRenderCallback&&this.haveRenderCallbacks.push(k.id)}}patchUpdatedImages(i,s,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>i.hasImage(f,d)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const f of i.getUpdatedImages(d)){for(const y of this.iconPositions.keys()){const _=Kl.parse(y);if(Ba.isEqual(_.id,f)){const S=i.getImage(f,d);this.patchUpdatedImage(this.iconPositions.get(y),S,s)}}for(const y of this.patternPositions.keys()){const _=Kl.parse(y);if(Ba.isEqual(_.id,f)){const S=i.getImage(f,d);this.patchUpdatedImage(this.patternPositions.get(y),S,s)}}}}patchUpdatedImage(i,s,d){if(!i||!s||i.version===s.version)return;i.version=s.version;const[f,y]=i.tl,_=i.sdf;if(this.lut||_){const S={width:s.data.width,height:s.data.height},A=new Lo(S);Lo.copy(s.data,A,{x:0,y:0},{x:0,y:0},S,this.lut,_),d.update(A,{position:{x:f,y}})}else d.update(s.data,{position:{x:f,y}})}}Wt(rx,"ImagePosition"),Wt(A5,"ImageAtlas");const nx=1e20;function k5(l,i,s,d,f,y,_,S,A){for(let k=i;k<i+d;k++)C5(l,s*y+k,y,f,_,S,A);for(let k=s;k<s+f;k++)C5(l,k*y+i,1,d,_,S,A)}function C5(l,i,s,d,f,y,_){y[0]=0,_[0]=-nx,_[1]=nx,f[0]=l[i];for(let S=1,A=0,k=0;S<d;S++){f[S]=l[i+S*s];const j=S*S;do{const R=y[A];k=(f[S]-f[R]+j-R*R)/(S-R)/2}while(k<=_[A]&&--A>-1);A++,y[A]=S,_[A]=k,_[A+1]=nx}for(let S=0,A=0;S<d;S++){for(;_[A+1]<S;)A++;const k=y[A],j=S-k;l[i+S*s]=f[k]+j*j}}const Ql=2,HP={none:0,ideographs:1,all:2};class Xg{constructor(i,s,d){this.requestManager=i,this.localGlyphMode=s,this.localFontFamily=d,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,s){const d=[],f=this.url||Mo.GLYPHS_URL;for(const y in i)for(const _ of i[y])d.push({stack:y,id:_});Ue(d,({stack:y,id:_},S)=>{let A=this.entries[y];A||(A=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=A.glyphs[_];if(k!==void 0)return void S(null,{stack:y,id:_,glyph:k});if(k=this._tinySDF(A,y,_),k)return A.glyphs[_]=k,void S(null,{stack:y,id:_,glyph:k});const j=Math.floor(_/256);if(256*j>65535)return Wr("glyphs > 65535 not supported"),void S(null,{stack:y,id:_,glyph:k});if(A.ranges[j])return void S(null,{stack:y,id:_,glyph:k});let R=A.requests[j];R||(R=A.requests[j]=[],Xg.loadGlyphRange(y,j,f,this.requestManager,(L,H)=>{if(H){A.ascender=H.ascender,A.descender=H.descender;for(const W in H.glyphs)this._doesCharSupportLocalGlyph(+W)||(A.glyphs[+W]=H.glyphs[+W]);A.ranges[j]=!0}for(const W of R)W(L,H);delete A.requests[j]})),R.push((L,H)=>{L?S(L):H&&S(null,{stack:y,id:_,glyph:H.glyphs[_]||null})})},(y,_)=>{if(y)s(y);else if(_){const S={};for(const{stack:A,id:k,glyph:j}of _)S[A]===void 0&&(S[A]={}),S[A].glyphs===void 0&&(S[A].glyphs={}),S[A].glyphs[k]=j&&{id:j.id,bitmap:j.bitmap.clone(),metrics:j.metrics},S[A].ascender=this.entries[A].ascender,S[A].descender=this.entries[A].descender;s(null,S)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==HP.none&&(this.localGlyphMode===HP.all?!!this.localFontFamily:!!this.localFontFamily&&(hr["CJK Unified Ideographs"](i)||hr["Hangul Syllables"](i)||hr.Hiragana(i)||hr.Katakana(i)||hr["CJK Symbols and Punctuation"](i)||hr["CJK Unified Ideographs Extension A"](i)||hr["CJK Unified Ideographs Extension B"](i)||hr.Osage(i)))}_tinySDF(i,s,d){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(d))return;let y=i.tinySDF;if(!y){let J="400";/bold/i.test(s)?J="900":/medium/i.test(s)?J="500":/light/i.test(s)&&(J="200"),y=i.tinySDF=new Xg.TinySDF({fontFamily:f,fontWeight:J,fontSize:24*Ql,buffer:3*Ql,radius:8*Ql}),y.fontWeight=J}if(this.localGlyphs[y.fontWeight][d])return this.localGlyphs[y.fontWeight][d];const _=String.fromCodePoint(d),{data:S,width:A,height:k,glyphWidth:j,glyphHeight:R,glyphLeft:L,glyphTop:H,glyphAdvance:W}=y.draw(_);return this.localGlyphs[y.fontWeight][d]={id:d,bitmap:new kd({width:A,height:k},S),metrics:{width:j/Ql,height:R/Ql,left:L/Ql,top:H/Ql-27,advance:W/Ql,localGlyph:!0}}}}Xg.loadGlyphRange=function(l,i,s,d,f){const y=256*i,_=y+255,S=d.transformRequest(d.normalizeGlyphsURL(s).replace("{fontstack}",l).replace("{range}",`${y}-${_}`),Nf.Glyphs);Ff(S,(A,k)=>{if(A)f(A);else if(k){const j={},R=function(L){return new FS(L).readFields(Pie,{})}(k);for(const L of R.glyphs)j[L.id]=L;f(null,{glyphs:j,ascender:R.ascender,descender:R.descender})}})},Xg.TinySDF=class{constructor({fontSize:l=24,buffer:i=3,radius:s=8,cutoff:d=.25,fontFamily:f="sans-serif",fontWeight:y="normal",fontStyle:_="normal"}={}){this.buffer=i,this.cutoff=d,this.radius=s;const S=this.size=l+4*i,A=this._createCanvas(S),k=this.ctx=A.getContext("2d",{willReadFrequently:!0});k.font=`${_} ${y} ${l}px ${f}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(l){const i=document.createElement("canvas");return i.width=i.height=l,i}draw(l){const{width:i,actualBoundingBoxAscent:s,actualBoundingBoxDescent:d,actualBoundingBoxLeft:f,actualBoundingBoxRight:y}=this.ctx.measureText(l),_=Math.ceil(s),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-f))),A=Math.min(this.size-this.buffer,_+Math.ceil(d)),k=S+2*this.buffer,j=A+2*this.buffer,R=Math.max(k*j,0),L=new Uint8ClampedArray(R),H={data:L,width:k,height:j,glyphWidth:S,glyphHeight:A,glyphTop:_,glyphLeft:0,glyphAdvance:i};if(S===0||A===0)return H;const{ctx:W,buffer:J,gridInner:Q,gridOuter:ae}=this;W.clearRect(J,J,S,A),W.fillText(l,J,J+_);const de=W.getImageData(J,J,S,A);ae.fill(nx,0,R),Q.fill(0,0,R);for(let he=0;he<A;he++)for(let fe=0;fe<S;fe++){const Me=de.data[4*(he*S+fe)+3]/255;if(Me===0)continue;const Ae=(he+J)*k+fe+J;if(Me===1)ae[Ae]=0,Q[Ae]=nx;else{const ke=.5-Me;ae[Ae]=ke>0?ke*ke:0,Q[Ae]=ke<0?ke*ke:0}}k5(ae,0,0,k,j,k,this.f,this.v,this.z),k5(Q,J,J,S,A,k,this.f,this.v,this.z);for(let he=0;he<R;he++){const fe=Math.sqrt(ae[he])-Math.sqrt(Q[he]);L[he]=Math.round(255-255*(fe/this.radius+this.cutoff))}return H}};const Md=Ap;function P5(l,i){return l+i[1]-i[0]}function M5(l,i,s,d,f=1){const y=[],_=l.imagePrimary,S=_.pixelRatio,A=_.paddedRect.w-2*Md,k=_.paddedRect.h-2*Md,j=(l.right-l.left)*f,R=(l.bottom-l.top)*f,L=_.stretchX||[[0,A]],H=_.stretchY||[[0,k]],W=L.reduce(P5,0),J=H.reduce(P5,0),Q=A-W,ae=k-J;let de=0,he=W,fe=0,Me=J,Ae=0,ke=Q,Le=0,Be=ae;if(_.content&&d){const Ge=_.content;de=US(L,0,Ge[0]),fe=US(H,0,Ge[1]),he=US(L,Ge[0],Ge[2]),Me=US(H,Ge[1],Ge[3]),Ae=Ge[0]-de,Le=Ge[1]-fe,ke=Ge[2]-Ge[0]-he,Be=Ge[3]-Ge[1]-Me}const st=(Ge,ft,wt,xt)=>{const At=VS(Ge.stretch-de,he,j,l.left*f),kt=$S(Ge.fixed-Ae,ke,Ge.stretch,W),it=VS(ft.stretch-fe,Me,R,l.top*f),Tt=$S(ft.fixed-Le,Be,ft.stretch,J),Xe=VS(wt.stretch-de,he,j,l.left*f),at=$S(wt.fixed-Ae,ke,wt.stretch,W),Mt=VS(xt.stretch-fe,Me,R,l.top*f),St=$S(xt.fixed-Le,Be,xt.stretch,J),ar=new ut(At,it),Kt=new ut(Xe,it),_t=new ut(Xe,Mt),Pt=new ut(At,Mt),rr=new ut(kt/S,Tt/S),Bt=new ut(at/S,St/S),Nt=i*Math.PI/180;if(Nt){const Qr=Math.sin(Nt),Ur=Math.cos(Nt),Kn=[Ur,-Qr,Qr,Ur];ar._matMult(Kn),Kt._matMult(Kn),Pt._matMult(Kn),_t._matMult(Kn)}const qt=Ge.stretch+Ge.fixed,pr=wt.stretch+wt.fixed,gr=ft.stretch+ft.fixed,Pr=xt.stretch+xt.fixed,Ar=l.imageSecondary;return{tl:ar,tr:Kt,bl:Pt,br:_t,texPrimary:{x:_.paddedRect.x+Md+qt,y:_.paddedRect.y+Md+gr,w:pr-qt,h:Pr-gr},texSecondary:Ar?{x:Ar.paddedRect.x+Md+qt,y:Ar.paddedRect.y+Md+gr,w:pr-qt,h:Pr-gr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:rr,pixelOffsetBR:Bt,minFontScaleX:ke/S/j,minFontScaleY:Be/S/R,isSDF:s}};if(d&&(_.stretchX||_.stretchY)){const Ge=I5(L,Q,W),ft=I5(H,ae,J);for(let wt=0;wt<Ge.length-1;wt++){const xt=Ge[wt],At=Ge[wt+1];for(let kt=0;kt<ft.length-1;kt++)y.push(st(xt,ft[kt],At,ft[kt+1]))}}else y.push(st({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:k+1}));return y}function US(l,i,s){let d=0;for(const f of l)d+=Math.max(i,Math.min(s,f[1]))-Math.max(i,Math.min(s,f[0]));return d}function I5(l,i,s){const d=[{fixed:-Md,stretch:0}];for(const[f,y]of l){const _=d[d.length-1];d.push({fixed:f-_.stretch,stretch:_.stretch}),d.push({fixed:f-_.stretch,stretch:_.stretch+(y-f)})}return d.push({fixed:i+Md,stretch:s}),d}function VS(l,i,s,d){return l/i*s+d}function $S(l,i,s,d){return l-i*s/d}function zie(l,i,s,d){const f=i+l.positionedLines[d].lineOffset;return d===0?s+f/2:s+(f+(i+l.positionedLines[d-1].lineOffset))/2}function Nie(l,i=1,s=!1){let d=1/0,f=1/0,y=-1/0,_=-1/0;const S=l[0];for(let H=0;H<S.length;H++){const W=S[H];(!H||W.x<d)&&(d=W.x),(!H||W.y<f)&&(f=W.y),(!H||W.x>y)&&(y=W.x),(!H||W.y>_)&&(_=W.y)}const A=Math.min(y-d,_-f);let k=A/2;const j=new Qm([],Fie);if(A===0)return new ut(d,f);for(let H=d;H<y;H+=A)for(let W=f;W<_;W+=A)j.push(new Yg(H+k,W+k,k,l));let R=function(H){let W=0,J=0,Q=0;const ae=H[0];for(let de=0,he=ae.length,fe=he-1;de<he;fe=de++){const Me=ae[de],Ae=ae[fe],ke=Me.x*Ae.y-Ae.x*Me.y;J+=(Me.x+Ae.x)*ke,Q+=(Me.y+Ae.y)*ke,W+=3*ke}return new Yg(J/W,Q/W,0,H)}(l),L=j.length;for(;j.length;){const H=j.pop();(H.d>R.d||!R.d)&&(R=H,s&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,L)),H.max-R.d<=i||(k=H.h/2,j.push(new Yg(H.p.x-k,H.p.y-k,k,l)),j.push(new Yg(H.p.x+k,H.p.y-k,k,l)),j.push(new Yg(H.p.x-k,H.p.y+k,k,l)),j.push(new Yg(H.p.x+k,H.p.y+k,k,l)),L+=4)}return s&&(console.log(`num probes: ${L}`),console.log(`best distance: ${R.d}`)),R.p}function Fie(l,i){return i.max-l.max}class Yg{constructor(i,s,d,f){this.p=new ut(i,s),this.h=d,this.d=function(y,_){let S=!1,A=1/0;for(let k=0;k<_.length;k++){const j=_[k];for(let R=0,L=j.length,H=L-1;R<L;H=R++){const W=j[R],J=j[H];W.y>y.y!=J.y>y.y&&y.x<(J.x-W.x)*(y.y-W.y)/(J.y-W.y)+W.x&&(S=!S),A=Math.min(A,js(y,W,J))}}return(S?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const Bie=Object.keys,WP=Number.POSITIVE_INFINITY,Uie=Math.sqrt(2);function O5(l,[i,s]){let d=0,f=0;if(s===WP){i<0&&(i=0);const y=i/Uie;switch(l){case"top-right":case"top-left":f=y-7;break;case"bottom-right":case"bottom-left":f=7-y;break;case"bottom":f=7-i;break;case"top":f=i-7}switch(l){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=i;break;case"right":d=-i}}else{switch(i=Math.abs(i),s=Math.abs(s),l){case"top-right":case"top-left":case"top":f=s-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-s}switch(l){case"top-right":case"bottom-right":case"right":d=-i;break;case"top-left":case"bottom-left":case"left":d=i}}return[d,f]}function GS(l,i,s,d,f,y,_,S,A){if(!i||!i.usvg)return;const k=_5(d),j=_5(f),R=y!=="both"&&y!=="width"||!g5(d)?1:j.width/k.width,L=y!=="both"&&y!=="height"||!y5(d)?1:j.height/k.height;s.scaleSelf(R,L);const H=s.toString();_.set(H,s),S.set(H,i);const{imagePosition:W}=qP(H,i,Ap);A.set(H,W)}function j5(l,i,s,d,f,y,_,S,A){if(!l)return;const k=function(j,R,L,H,W,J){if(j.kind==="camera")return j.maxSize;if(j.kind==="composite"){const Q=R.possiblyEvaluate(new On(j.maxZoom,{worldview:J}),L).evaluate(W,{},L),ae=R.possiblyEvaluate(new On(j.minZoom,{worldview:J}),L).evaluate(W,{},L);return Math.max(Q,ae)}return R.possiblyEvaluate(new On(H,{worldview:J})).evaluate(W,{},L)}(i,s,d,f,y,A);return l.scaleSelf(k*S*_)}function R5(l,i,s,d,f,y,_,S,A){return{iconPrimary:j5(l.getPrimary(),i,s,d,f,y,_,S,A),iconSecondary:j5(l.getSecondary(),i,s,d,f,y,_,S,A)}}function Vie(l,i,s){if(!i)return;const d=s.get(l.toString()),f=s.get(i.toString());f&&(d.paddedRect.w===f.paddedRect.w&&d.paddedRect.h===f.paddedRect.h||Wr(`Mismatch in icon variant sizes: ${l.toString()} and ${i.toString()}`),d.usvg!==f.usvg&&Wr(`Mismatch in icon variant image types: ${l.id} and ${i.id}`))}function D5(l,i,s,d){if(!l)return;const f=i.get(s.toString());if(l.imagePrimary=f,d){const y=i.get(d.toString());l.imageSecondary=y}}function $ie(l,i){for(const s in l.horizontal)L5(l.horizontal[s],i);L5(l.vertical,i)}function L5(l,i){if(l){for(const s of l.positionedLines)for(const d of s.positionedGlyphs)if(d.image!==null){const f=d.image.toString();d.rect=i.get(f).paddedRect}}}function ZP(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gie(l,i,s,d,f,y,_,S,A){const k=KP(y.horizontal)||y.vertical,j=s.get("icon-text-fit-padding").evaluate(d,{},f);let R,L=i;return i&&A!=="none"&&(l.allowVerticalPlacement&&y.vertical&&(R=m5(i,y.vertical,A,j,S,_)),k&&(L=m5(i,k,A,j,S,_))),{defaultShapedIcon:L,verticallyShapedIcon:R}}function qie(l,i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q,ae,de,he){let fe=_.textMaxSize.evaluate(i,{},L);fe===void 0?fe=S*_.textScaleFactor:fe*=_.textScaleFactor;const Me=l.layers[0].layout,Ae=KP(s.horizontal)||s.vertical,ke=H.name==="globe",Le=To,Be=l.tilePixelRatio*fe/Le,st=(kt=l.overscaling,l.zoom>18&&kt>2&&(kt>>=1),Math.max(Dt/(512*kt),1)*Me.get("symbol-spacing")),Ge=Me.get("text-padding")*l.tilePixelRatio,ft=Me.get("icon-padding")*l.tilePixelRatio,wt=Br(Me.get("text-max-angle")),xt=Me.get("icon-rotation-alignment")==="map"&&he!=="point",At=st/2;var kt;l.hasAnyIconTextFit===!1&&Q!=="none"&&(l.hasAnyIconTextFit=!0);const it=i.properties?+i.properties[er]:null,Tt=it&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(it):65535,Xe=(at,Mt,St)=>{if(Mt.x<0||Mt.x>=Dt||Mt.y<0||Mt.y>=Dt)return;let ar=null;if(ke){const{x:Kt,y:_t,z:Pt}=H.projectTilePoint(Mt.x,Mt.y,St);ar={anchor:new th(Kt,_t,Pt,0,void 0),up:H.upVector(St,Mt.x,Mt.y)}}(function(Kt,_t,Pt,rr,Bt,Nt,qt,pr,gr,Pr,Ar,Qr,Ur,Kn,_e,ve,ot,Rt,zt,Lt,Jt,yr,Vr,$r,jr,jn,gi,Ir,ti){const $n=Kt.addToLineVertexArray(_t,rr);let An,di,Jn,Gn,Xn,Mn,Rr,Rn=0,fi=0,dr=0,nn=0,Qn=-1,vi=-1;const ri={};let Ki=Wh("");const zn=Pt?Pt.anchor:_t,Gi=Ir!=="none";let qa=0,zo=0;if(gr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Xi=gr.layout.get("text-offset").evaluate(Jt,{},jr);qa=Xi[0]*To,zo=Xi[1]*To}else qa=gr.layout.get("text-radial-offset").evaluate(Jt,{},jr)*To,zo=WP;if(Kt.allowVerticalPlacement&&Bt.vertical){const Xi=Bt.vertical;if(_e)Mn=XP(Xi),pr&&(Rr=XP(pr));else{const uo=gr.layout.get("text-rotate").evaluate(Jt,{},jr)+90;Jn=qS(Pr,zn,_t,Ar,Qr,Ur,Xi,Kn,uo,ve),pr&&(Gn=qS(Pr,zn,_t,Ar,Qr,Ur,pr,Rt,uo))}}if(Nt){const Xi=Kt.iconSizeData,uo=gr.layout.get("icon-rotate").evaluate(Jt,{},jr),No=M5(Nt,uo,Vr,Gi,yr.iconScaleFactor),ma=pr?M5(pr,uo,Vr,Gi,yr.iconScaleFactor):void 0;di=qS(Pr,zn,_t,Ar,Qr,Ur,Nt,Rt,uo,null),Rn=4*No.length;let Yo=null;Xi.kind==="source"?(Yo=[iu*gr.layout.get("icon-size").evaluate(Jt,{},jr)*yr.iconScaleFactor],Yo[0]>Id&&Wr(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${ix}. Reduce your "icon-size".`)):Xi.kind==="composite"&&(Yo=[iu*yr.compositeIconSizes[0].evaluate(Jt,{},jr)*yr.iconScaleFactor,iu*yr.compositeIconSizes[1].evaluate(Jt,{},jr)*yr.iconScaleFactor],(Yo[0]>Id||Yo[1]>Id)&&Wr(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${ix}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,No,Yo,Lt,zt,Jt,void 0,Pt,_t,$n.lineStartIndex,$n.lineLength,-1,$r,jr,jn,gi),Qn=Kt.icon.placedSymbolArray.length-1,ma&&(fi=4*ma.length,Kt.addSymbols(Kt.icon,ma,Yo,Lt,zt,Jt,hs.vertical,Pt,_t,$n.lineStartIndex,$n.lineLength,-1,$r,jr,jn,gi),vi=Kt.icon.placedSymbolArray.length-1)}for(const Xi in Bt.horizontal){const uo=Xi,No=Bt.horizontal[uo];An||(Ki=Wh(No.text),_e?Xn=XP(No):An=qS(Pr,zn,_t,Ar,Qr,Ur,No,Kn,gr.layout.get("text-rotate").evaluate(Jt,{},jr),ve));const ma=No.positionedLines.length===1;if(dr+=z5(Kt,Pt,_t,No,qt,gr,_e,Jt,ve,$n,Bt.vertical?hs.horizontal:hs.horizontalOnly,ma?Bie(Bt.horizontal):[uo],ri,Qn,yr,$r,jr,jn),ma)break}Bt.vertical&&(nn+=z5(Kt,Pt,_t,Bt.vertical,qt,gr,_e,Jt,ve,$n,hs.vertical,["vertical"],ri,vi,yr,$r,jr,jn));let Io=-1;const Ha=(Xi,uo)=>Xi?Math.max(Xi,uo):uo;Io=Ha(Xn,Io),Io=Ha(Mn,Io),Io=Ha(Rr,Io);const ou=Io>-1?1:0;Kt.glyphOffsetArray.length>=65535&&Wr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Jt.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,Jt.sortKey),Kt.symbolInstances.emplaceBack(_t.x,_t.y,zn.x,zn.y,zn.z,ri.right>=0?ri.right:-1,ri.center>=0?ri.center:-1,ri.left>=0?ri.left:-1,ri.vertical>=0?ri.vertical:-1,Qn,vi,Ki,An!==void 0?An:Kt.collisionBoxArray.length,An!==void 0?An+1:Kt.collisionBoxArray.length,Jn!==void 0?Jn:Kt.collisionBoxArray.length,Jn!==void 0?Jn+1:Kt.collisionBoxArray.length,di!==void 0?di:Kt.collisionBoxArray.length,di!==void 0?di+1:Kt.collisionBoxArray.length,Gn||Kt.collisionBoxArray.length,Gn?Gn+1:Kt.collisionBoxArray.length,Ar,dr,nn,Rn,fi,ou,0,qa,zo,Io,0,Gi?1:0,ti)})(l,Mt,ar,at,s,d,y,f,l.layers[0],l.collisionBoxArray,i.index,i.sourceLayerIndex,l.index,Ge,de,k,0,ft,xt,ae,i,_,j,R,L,W,J,Q,Tt)};if(he==="line")for(const at of MS(i.geometry,0,0,Dt,Dt)){const Mt=Lie(at,st,wt,s.vertical||Ae,d,Le,Be,l.overscaling,Dt);for(const St of Mt)Ae&&Hie(l,Ae.text,At,St)||Xe(at,St,L)}else if(he==="line-center"){for(const at of i.geometry)if(at.length>1){const Mt=Die(at,wt,s.vertical||Ae,d,Le,Be);Mt&&Xe(at,Mt,L)}}else if(i.type==="Polygon")for(const at of U0(i.geometry,0)){const Mt=Nie(at,16);Xe(at[0],new th(Mt.x,Mt.y,0,0,void 0),L)}else if(i.type==="LineString")for(const at of i.geometry)Xe(at,new th(at[0].x,at[0].y,0,0,void 0),L);else if(i.type==="Point")for(const at of i.geometry)for(const Mt of at)Xe([Mt],new th(Mt.x,Mt.y,0,0,void 0),L)}const ix=255,Id=ix*iu;function z5(l,i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q,ae){const de=function(Me,Ae,ke,Le,Be,st,Ge,ft){const wt=[];if(Ae.positionedLines.length===0)return wt;const xt=Le.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,At=function(at){const Mt=at[0],St=at[1],ar=Mt*St;return ar>0?[Mt,-St]:ar<0?[-Mt,St]:Mt===0?[St,Mt]:[St,-Mt]}(ke);let kt=Math.abs(Ae.top-Ae.bottom);for(const at of Ae.positionedLines)kt-=at.lineOffset;const it=Ae.positionedLines.length,Tt=kt/it;let Xe=Ae.top-ke[1];for(let at=0;at<it;++at){const Mt=Ae.positionedLines[at];Xe=zie(Ae,Tt,Xe,at);for(const St of Mt.positionedGlyphs){if(!St.rect)continue;const ar=St.rect||{};let Kt=l5+1,_t=!0,Pt=1,rr=0;if(St.image){const Jt=Ge.get(St.image.toString());if(!Jt)continue;if(Jt.sdf){Wr("SDF images are not supported in formatted text and will be ignored.");continue}_t=!1,Pt=Jt.pixelRatio,Kt=Ap/Pt}const Bt=(Be||ft)&&St.vertical,Nt=St.metrics.advance*St.scale/2,qt=St.metrics,pr=St.rect;if(pr===null)continue;ft&&Ae.verticalizable&&(rr=St.image?Nt-St.metrics.width*St.scale/2:0);const gr=Be?[St.x+Nt,St.y]:[0,0];let Pr=[0,0],Ar=[0,0],Qr=!1;Be||(Bt?(Ar=[St.x+Nt+At[0],St.y+At[1]-rr],Qr=!0):Pr=[St.x+Nt+ke[0],St.y+ke[1]-rr]);const Ur=pr.w*St.scale/(Pt*(St.localGlyph?Ql:1)),Kn=pr.h*St.scale/(Pt*(St.localGlyph?Ql:1));let _e,ve,ot,Rt;if(Bt){const Jt=St.y-Xe,yr=new ut(-Nt,Nt-Jt),Vr=-Math.PI/2,$r=new ut(...Ar);_e=new ut(-Nt+Pr[0],Pr[1]),_e._rotateAround(Vr,yr)._add($r),_e.x+=-Jt+Nt,_e.y-=(qt.left-Kt)*St.scale;const jr=St.image?qt.advance*St.scale:To*St.scale,jn=String.fromCodePoint(St.glyph);yie(jn)?_e.x+=(1-Kt)*St.scale:_ie(jn)?_e.x+=jr-qt.height*St.scale+(-Kt-1)*St.scale:_e.x+=St.image||qt.width+2*Kt===pr.w&&qt.height+2*Kt===pr.h?(jr-Kn)/2:(jr-(qt.height+2*Kt)*St.scale)/2,ve=new ut(_e.x,_e.y-Ur),ot=new ut(_e.x+Kn,_e.y),Rt=new ut(_e.x+Kn,_e.y-Ur)}else{const Jt=(qt.left-Kt)*St.scale-Nt+Pr[0],yr=(-qt.top-Kt)*St.scale+Pr[1],Vr=Jt+Ur,$r=yr+Kn;_e=new ut(Jt,yr),ve=new ut(Vr,yr),ot=new ut(Jt,$r),Rt=new ut(Vr,$r)}if(xt){let Jt;Jt=Be?new ut(0,0):Qr?new ut(At[0],At[1]):new ut(ke[0],ke[1]),_e._rotateAround(xt,Jt),ve._rotateAround(xt,Jt),ot._rotateAround(xt,Jt),Rt._rotateAround(xt,Jt)}const zt=new ut(0,0),Lt=new ut(0,0);wt.push({tl:_e,tr:ve,bl:ot,br:Rt,texPrimary:ar,texSecondary:void 0,writingMode:Ae.writingMode,glyphOffset:gr,sectionIndex:St.sectionIndex,isSDF:_t,pixelOffsetTL:zt,pixelOffsetBR:Lt,minFontScaleX:0,minFontScaleY:0})}}return wt}(0,d,A,y,_,S,f,l.allowVerticalPlacement),he=l.textSizeData;let fe=null;he.kind==="source"?(fe=[iu*y.layout.get("text-size").evaluate(S,{},Q)*W.textScaleFactor],fe[0]>Id&&Wr(`${l.layerIds[0]}: Value for "text-size" is >= ${ix}. Reduce your "text-size".`)):he.kind==="composite"&&(fe=[iu*W.compositeTextSizes[0].evaluate(S,{},Q)*W.textScaleFactor,iu*W.compositeTextSizes[1].evaluate(S,{},Q)*W.textScaleFactor],(fe[0]>Id||fe[1]>Id)&&Wr(`${l.layerIds[0]}: Value for "text-size" is >= ${ix}. Reduce your "text-size".`)),l.addSymbols(l.text,de,fe,A,_,S,j,i,s,k.lineStartIndex,k.lineLength,H,J,Q,ae,!1);for(const Me of R)L[Me]=l.text.placedSymbolArray.length-1;return 4*de.length}function KP(l){for(const i in l)return l[i];return null}function qS(l,i,s,d,f,y,_,S,A,k){let j=_.top,R=_.bottom,L=_.left,H=_.right;if(p5(_)&&_.collisionPadding){const W=_.collisionPadding;L-=W[0],j-=W[1],H+=W[2],R+=W[3]}if(A){const W=new ut(L,j),J=new ut(H,j),Q=new ut(L,R),ae=new ut(H,R),de=Br(A);let he=new ut(0,0);k&&(he=new ut(k[0],k[1])),W._rotateAround(de,he),J._rotateAround(de,he),Q._rotateAround(de,he),ae._rotateAround(de,he),L=Math.min(W.x,J.x,Q.x,ae.x),H=Math.max(W.x,J.x,Q.x,ae.x),j=Math.min(W.y,J.y,Q.y,ae.y),R=Math.max(W.y,J.y,Q.y,ae.y)}return l.emplaceBack(i.x,i.y,i.z,s.x,s.y,L,j,H,R,S,d,f,y),l.length-1}function XP(l){p5(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const i=l.bottom-l.top;return i>0?Math.max(10,i):null}function Hie(l,i,s,d){const f=l.compareText;if(i in f){const y=f[i];for(let _=y.length-1;_>=0;_--)if(d.dist(y[_])<s)return!0}else f[i]=[];return f[i].push(d),!1}function N5(l,i){const s=l.fovAboveCenter,d=l.elevation?l.elevation.getMinElevationBelowMSL()*i:0,f=(l._camera.position[2]*l.worldSize-d)/Math.cos(l._pitch),y=Math.sin(s)*f/Math.sin(Math.max(Math.PI/2-l._pitch-s,.01));let _=Math.sin(l._pitch)*y+f;const S=f*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let A=Math.max(l.zoom-17,0);l.isOrthographic&&(A/=10),_*=1+A}return Math.min(1.01*_,S)}function ox(l,i){if(!i.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:i};const s=Math.pow(2,-l.z),d=l.x*s,f=(l.x+1)*s,y=l.y*s,_=(l.y+1)*s,S=pe(d),A=pe(f),k=me(y),j=me(_),R=i.project(S,k),L=i.project(A,k),H=i.project(A,j),W=i.project(S,j);let J=Math.min(R.x,L.x,H.x,W.x),Q=Math.min(R.y,L.y,H.y,W.y),ae=Math.max(R.x,L.x,H.x,W.x),de=Math.max(R.y,L.y,H.y,W.y);const he=s/16;function fe(Ae,ke,Le,Be,st,Ge){const ft=(Le+st)/2,wt=(Be+Ge)/2,xt=i.project(pe(ft),me(wt)),At=Math.max(0,J-xt.x,Q-xt.y,xt.x-ae,xt.y-de);J=Math.min(J,xt.x),ae=Math.max(ae,xt.x),Q=Math.min(Q,xt.y),de=Math.max(de,xt.y),At>he&&(fe(Ae,xt,Le,Be,ft,wt),fe(xt,ke,ft,wt,st,Ge))}fe(R,L,d,y,f,y),fe(L,H,f,y,f,_),fe(H,W,f,_,d,_),fe(W,R,d,_,d,y),J-=he,Q-=he,ae+=he,de+=he;const Me=1/Math.max(ae-J,de-Q);return{scale:Me,x:J*Me,y:Q*Me,x2:ae*Me,y2:de*Me,projection:i}}function F5(l,{x:i,y:s},d=0){return new ut(((i-d)*l.scale-l.x)*Dt,(s*l.scale-l.y)*Dt)}const Wie=N(new Float32Array(16));class Od{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,s){return{x:0,y:0,z:0}}unproject(i,s){return new q(0,0)}projectTilePoint(i,s,d){return{x:i,y:s,z:0}}locationPoint(i,s,d,f=!0){return i._coordinatePoint(i.locationCoordinate(s,d),f)}pixelsPerMeter(i,s){return ue(1,i)*s}pixelSpaceConversion(i,s,d){return 1}farthestPixelDistance(i){return N5(i,i.pixelsPerMeter)}pointCoordinate(i,s,d,f){const y=i.horizonLineFromTop(!1),_=new ut(s,Math.max(y,d));return i.rayIntersectionCoordinate(i.pointRayIntersection(_,f))}pointCoordinate3D(i,s,d){const f=new ut(s,d);if(i.elevation)return i.elevation.pointCoordinate(f);{const y=this.pointCoordinate(i,f.x,f.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(i,s){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,s.x,s.y);const d=i.horizonLineFromTop();return s.y<d}createInversionMatrix(i,s){return Wie}createTileMatrix(i,s,d){let f,y,_;const S=d.canonical,A=N(new Float64Array(16));if(this.isReprojectedInTileSpace){const k=ox(S,this);f=1,y=k.x+d.wrap*k.scale,_=k.y,X(A,A,[f/k.scale,f/k.scale,i.pixelsPerMeter/s])}else f=s/i.zoomScale(S.z),y=(S.x+Math.pow(2,S.z)*d.wrap)*f,_=S.y*f;return U(A,A,[y,_,0]),X(A,A,[f/Dt,f/Dt,1]),A}upVector(i,s,d){return[0,0,1]}upVectorScale(i,s,d){return{metersToTile:1}}}class Zie extends Od{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[s,d]=this.parallels=i.parallels||[29.5,45.5],f=Math.sin(Br(s));this.n=(f+Math.sin(Br(d)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(i,s){const{n:d,c:f,r0:y}=this,_=Br(i-this.center[0]),S=Br(s),A=Math.sqrt(f-2*d*Math.sin(S))/d;return{x:A*Math.sin(_*d),y:A*Math.cos(_*d)-y,z:0}}unproject(i,s){const{n:d,c:f,r0:y}=this,_=y+s;let S=Math.atan2(i,Math.abs(_))*Math.sign(_);_*d<0&&(S-=Math.PI*Math.sign(i)*Math.sign(_));const A=Br(this.center[0])*d;S=et(S,-Math.PI-A,Math.PI-A);const k=xe(qe(S/d)+this.center[0],-180,180),j=Math.asin(xe((f-(i*i+_*_)*d*d)/(2*d),-1,1)),R=xe(qe(j),-we,we);return new q(k,R)}}const ax=1.340264,sx=-.081106,lx=893e-6,cx=.003796,HS=Math.sqrt(3)/2;class Kie extends Od{project(i,s){s=s/180*Math.PI,i=i/180*Math.PI;const d=Math.asin(HS*Math.sin(s)),f=d*d,y=f*f*f;return{x:.5*(i*Math.cos(d)/(HS*(ax+3*sx*f+y*(7*lx+9*cx*f)))/Math.PI+.5),y:1-.5*(d*(ax+sx*f+y*(lx+cx*f))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let d=s=(2*(1-s)-1)*Math.PI,f=d*d,y=f*f*f;for(let j,R,L,H=0;H<12&&(R=d*(ax+sx*f+y*(lx+cx*f))-s,L=ax+3*sx*f+y*(7*lx+9*cx*f),j=R/L,d=xe(d-j,-Math.PI/3,Math.PI/3),f=d*d,y=f*f*f,!(Math.abs(j)<1e-12));++H);const _=HS*i*(ax+3*sx*f+y*(7*lx+9*cx*f))/Math.cos(d),S=Math.asin(Math.sin(d)/HS),A=xe(180*_/Math.PI,-180,180),k=xe(180*S/Math.PI,-we,we);return new q(A,k)}}class Xie extends Od{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){return{x:.5+i/360,y:.5-s/360,z:0}}unproject(i,s){const d=360*(i-.5),f=xe(360*(.5-s),-we,we);return new q(d,f)}}const Jg=Math.PI/2;function WS(l){return Math.tan((Jg+l)/2)}class Yie extends Od{constructor(i){super(i),this.center=i.center||[0,30];const[s,d]=this.parallels=i.parallels||[30,30];let f=Br(s),y=Br(d);this.southernCenter=f+y<0,this.southernCenter&&(f=-f,y=-y);const _=Math.cos(f),S=WS(f);this.n=f===y?Math.sin(f):Math.log(_/Math.cos(y))/Math.log(WS(y)/S),this.f=_*Math.pow(WS(f),this.n)/this.n}project(i,s){s=Br(s),this.southernCenter&&(s=-s),i=Br(i-this.center[0]);const d=1e-6,{n:f,f:y}=this;y>0?s<-Jg+d&&(s=-Jg+d):s>Jg-d&&(s=Jg-d);const _=y/Math.pow(WS(s),f);let S=_*Math.sin(f*i),A=y-_*Math.cos(f*i);return S=.5*(S/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:S,y:this.southernCenter?A:1-A,z:0}}unproject(i,s){i=(2*i-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:d,f}=this,y=f-s,_=Math.sign(y),S=Math.sign(d)*Math.sqrt(i*i+y*y);let A=Math.atan2(i,Math.abs(y))*_;y*d<0&&(A-=Math.PI*Math.sign(i)*_);const k=xe(qe(A/d)+this.center[0],-180,180),j=xe(qe(2*Math.atan(Math.pow(f/S,1/d))-Jg),-we,we);return new q(k,this.southernCenter?-j:j)}}class B5 extends Od{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,s){return{x:re(i),y:ie(s),z:0}}unproject(i,s){const d=pe(i),f=me(s);return new q(d,f)}}const U5=Br(we);class Jie extends Od{project(i,s){const d=(s=Br(s))*s,f=d*d;return{x:.5*((i=Br(i))*(.8707-.131979*d+f*(f*(.003971*d-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+d*(.015085+f*(.028874*d-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let d=s=(2*(1-s)-1)*Math.PI,f=25,y=0,_=d*d;do{_=d*d;const k=_*_;y=(d*(1.007226+_*(.015085+k*(.028874*_-.044475-.005916*k)))-s)/(1.007226+_*(.045255+k*(.259866*_-.311325-.005916*11*k))),d=xe(d-y,-U5,U5)}while(Math.abs(y)>1e-6&&--f>0);_=d*d;const S=xe(qe(i/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),A=qe(d);return new q(S,A)}}const V5=Br(we);class Qie extends Od{project(i,s){s=Br(s),i=Br(i);const d=Math.cos(s),f=2/Math.PI,y=Math.acos(d*Math.cos(i/2)),_=Math.sin(y)/y,S=.5*(i*f+2*d*Math.sin(i/2)/_)||0,A=.5*(s+Math.sin(s)/_)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(i,s){let d=i=(2*i-.5)*Math.PI,f=s=(2*(1-s)-1)*Math.PI,y=25;const _=1e-6;let S=0,A=0;do{const k=Math.cos(f),j=Math.sin(f),R=2*j*k,L=j*j,H=k*k,W=Math.cos(d/2),J=Math.sin(d/2),Q=2*W*J,ae=J*J,de=1-H*W*W,he=de?1/de:0,fe=de?Math.acos(k*W)*Math.sqrt(1/de):0,Me=.5*(2*fe*k*J+2*d/Math.PI)-i,Ae=.5*(fe*j+f)-s,ke=.5*he*(H*ae+fe*k*W*L)+1/Math.PI,Le=he*(Q*R/4-fe*j*J),Be=.125*he*(R*J-fe*j*H*Q),st=.5*he*(L*W+fe*ae*k)+.5,Ge=Le*Be-st*ke;S=(Ae*Le-Me*st)/Ge,A=(Me*Be-Ae*ke)/Ge,d=xe(d-S,-Math.PI,Math.PI),f=xe(f-A,-V5,V5)}while((Math.abs(S)>_||Math.abs(A)>_)&&--y>0);return new q(qe(d),qe(f))}}class $5 extends Od{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Br(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){const{scale:d,cosPhi:f}=this;return{x:Br(i)*f*d+.5,y:-Math.sin(Br(s))/f*d+.5,z:0}}unproject(i,s){const{scale:d,cosPhi:f}=this,y=-(s-.5)/d,_=xe(qe((i-.5)/d)/f,-180,180),S=Math.asin(xe(y*f,-1,1)),A=xe(qe(S),-we,we);return new q(_,A)}}class eoe extends B5{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,s,d){const f=D0(i,s,d);return Qt(f,f,bS(ru(d))),{x:f[0],y:f[1],z:f[2]}}locationPoint(i,s,d){const f=I(s.lat,s.lng),y=Er([],f),_=d?i._centerAltitude+d:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(s),i._centerAltitude):i._centerAltitude;ct(f,f,y,ue(1,0)*Dt*_);const S=N(new Float64Array(16));return V(S,i.pixelMatrix,i.globeMatrix),Qt(f,f,S),new ut(f[0],f[1])}pixelsPerMeter(i,s){return ue(1,0)*s}pixelSpaceConversion(i,s,d){const f=ue(1,i)*s,y=lr(ue(1,45)*s,f,d);return this.pixelsPerMeter(i,s)/y}createTileMatrix(i,s,d){const f=oP(ru(d.canonical));return V(new Float64Array(16),i.globeMatrix,f)}createInversionMatrix(i,s){const{center:d}=i,f=bS(ru(s));return ne(f,f,Br(d.lng)),Y(f,f,Br(d.lat)),X(f,f,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(i,s,d,f){return pN(i,s,d,!0)||new Ve(0,0)}pointCoordinate3D(i,s,d){const f=this.pointCoordinate(i,s,d,0);return[f.x,f.y,f.z]}isPointAboveHorizon(i,s){return!pN(i,s.x,s.y,!1)}farthestPixelDistance(i){const s=function(f,y){const _=f.cameraToCenterDistance,S=f._centerAltitude*y,A=f._camera,k=f._camera.forward(),j=He([],mt([],k,-_),[0,0,S]),R=f.worldSize/(2*Math.PI),L=[0,0,-R],H=f.width/f.height,W=Math.tan(f.fovAboveCenter),J=mt([],A.up(),W),Q=mt([],A.right(),W*H),ae=Er([],He([],He([],k,J),Q)),de=[];let he;if(new hn(j,ae).closestPointOnSphere(L,R,de)){const fe=He([],de,L),Me=Kr([],fe,j);he=Math.cos(f.fovAboveCenter)*Ye(Me)}else{const fe=Kr([],j,L),Me=Kr([],L,j);Er(Me,Me);const Ae=Ye(fe)-R;he=Math.sqrt(Ae*(Ae+2*R));const ke=Math.acos(he/(R+Ae))-Math.acos(Ft(k,Me));he*=Math.cos(ke)}return 1.01*he}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),d=Ad(i.zoom);if(d>0){const f=N5(i,ue(1,i.center.lat)*i.worldSize),y=i.worldSize/(2*Math.PI),_=Math.max(i.width,i.height)/i.worldSize*Math.PI;return lr(s,f+y*(1-Math.cos(_)),Math.pow(d,10))}return s}upVector(i,s,d){return D0(s,d,i,1)}upVectorScale(i){return{metersToTile:_S(xS(ru(i)))}}}function G5(l){const i=l.parallels,s=!!i&&Math.abs(i[0]+i[1])<.01;switch(l.name){case"mercator":return new B5(l);case"equirectangular":return new Xie(l);case"naturalEarth":return new Jie(l);case"equalEarth":return new Kie(l);case"winkelTripel":return new Qie(l);case"albers":return s?new $5(l):new Zie(l);case"lambertConformalConic":return s?new $5(l):new Yie(l);case"globe":return new eoe(l)}throw new Error(`Invalid projection name: ${l.name}`)}const toe=yt.types,roe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ZS(l,i,s,d,f,y,_,S,A,k,j,R,L){const H=S?Math.min(Id,Math.round(S[0])):0,W=S?Math.min(Id,Math.round(S[1])):0;l.emplaceBack(i,s,Math.round(32*d),Math.round(32*f),y,_,(H<<1)+(A?1:0),W,16*k,16*j,256*R,256*L)}function KS(l,i,s){l.emplaceBack(i,s)}function XS(l,i,s,d,f,y,_){l.emplaceBack(i,s,d,f,y,_)}const YS=(l,i,s,d)=>{for(let f=0;f<i;f++)l.emplaceBack(s[0],s[1],s[2],d[0],d[1],d[2])};function JS(l,i,s,d,f){l.emplaceBack(i,s,d,f),l.emplaceBack(i,s,d,f),l.emplaceBack(i,s,d,f),l.emplaceBack(i,s,d,f)}function noe(l){for(const i of l.sections)if(GC(i.text))return!0;return!1}class YP{constructor(i){this.layoutVertexArray=new Rg,this.indexArray=new ii,this.programConfigurations=i,this.segments=new ui,this.dynamicLayoutVertexArray=new Yc,this.opacityVertexArray=new _0,this.placedSymbolArray=new pp,this.iconTransitioningVertexArray=new xl,this.globeExtVertexArray=new yd,this.zOffsetVertexArray=new Yu,this.orientationVertexArray=new b0}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(i,s,d,f,y){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,sie.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,cie.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,roe,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,die.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,lie.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||y)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,uie.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,hie.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||f)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Wt(YP,"SymbolBuffers");class JP{constructor(i,s,d){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new d,this.segments=new ui,this.collisionVertexArray=new vd,this.collisionVertexArrayExt=new Yc}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,fie.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,pie.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Wt(JP,"CollisionBuffers");class QS{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=N([]),this.placementViewportMatrix=N([]);const s=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.textSizeData=v5(this.zoom,s["text-size"],this.worldview),this.iconSizeData=v5(this.zoom,s["icon-size"],this.worldview);const d=this.layers[0].layout,f=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(_=>hs[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new YP(new ls(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new YP(new ls(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new P0,this.lineVertexArray=new sS,this.symbolInstances=new aS}calculateGlyphDependencies(i,s,d,f,y){for(const _ of i){const S=_.codePointAt(0);if(S===void 0)break;if(s[S]=!0,f&&y&&S<=65535){const A=Q0[_];A&&(s[A.charCodeAt(0)]=!0)}}}updateFootprints(i,s){}updateReplacement(i,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const d=s.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!kS(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(i,s,d,f){const y=this.layers[0],_=y.layout,S=this.projection.name==="globe",A=_.get("text-font"),k=_.get("text-field"),j=_.get("icon-image"),[R,L]=_.get("icon-size-scale-range"),H=xe(s.scaleFactor||1,R,L),W=(k.value.kind!=="constant"||k.value.value instanceof ca&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),J=j.value.kind!=="constant"||!!j.value.value||Object.keys(j.parameters).length>0,Q=_.get("symbol-sort-key");if(this.features=[],!W&&!J)return;const ae=s.iconDependencies,de=s.glyphDependencies,he=s.availableImages,fe=new On(this.zoom,{worldview:this.worldview});for(const{feature:Me,id:Ae,index:ke,sourceLayerIndex:Le}of i){const Be=y._featureFilter.needGeometry,st=Ze(Me,Be);if(!y._featureFilter.filter(fe,st,d))continue;if(Be||(st.geometry=nt(Me,d,f)),S&&Me.type!==1&&d.z<=5){const At=st.geometry,kt=.98078528056,it=(Tt,Xe)=>Ft(D0(Tt.x,Tt.y,d,1),D0(Xe.x,Xe.y,d,1))<kt;for(let Tt=0;Tt<At.length;Tt++)At[Tt]=pt(At[Tt],it)}let Ge,ft;if(W){const At=y.getValueAndResolveTokens("text-field",st,d,he),kt=ca.factory(At);noe(kt)&&(this.hasRTLText=!0),(!this.hasRTLText||h0()==="unavailable"||this.hasRTLText&&_l.isParsed())&&(Ge=gie(kt,y,st))}if(J){const At=y.getValueAndResolveTokens("icon-image",st,d,he);ft=typeof At=="string"?ka.build(At):At}if(!Ge&&!ft)continue;const wt=this.sortFeaturesByKey?Q.evaluate(st,{},d):void 0,xt={id:Ae,text:Ge,icon:ft,index:ke,sourceLayerIndex:Le,geometry:st.geometry,properties:Me.properties,type:toe[Me.type],sortKey:wt};if(this.features.push(xt),ft){const At=this.layers[0]._unevaluatedLayout._values,{iconPrimary:kt,iconSecondary:it}=R5(ft,this.iconSizeData,At["icon-size"],d,this.zoom,xt,this.pixelRatio,H,this.worldview),Tt=kt.id.toString();if(ae.has(Tt)?ae.get(Tt).push(kt):ae.set(Tt,[kt]),it){this.hasAnySecondaryIcon=!0;const Xe=it.id.toString();ae.has(Xe)?ae.get(Xe).push(it):ae.set(Xe,[it])}}if(Ge){const At=A.evaluate(st,{},d).join(","),kt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(hs.vertical)>=0;for(const it of Ge.sections)if(it.image){const Tt=it.image.getPrimary().scaleSelf(this.pixelRatio),Xe=Tt.id.toString(),at=ae.get(Xe)||[];at.push(Tt),ae.set(Xe,at)}else{const Tt=s0(Ge.toString()),Xe=it.fontStack||At,at=de[Xe]=de[Xe]||{};this.calculateGlyphDependencies(it.text,at,kt,this.allowVerticalPlacement,Tt)}}}if(_.get("symbol-placement")==="line"&&(this.features=function(Me){const Ae={},ke={},Le=[];let Be=0;function st(xt){Le.push(Me[xt]),Be++}function Ge(xt,At,kt){const it=ke[xt];return delete ke[xt],ke[At]=it,Le[it].geometry[0].pop(),Le[it].geometry[0]=Le[it].geometry[0].concat(kt[0]),it}function ft(xt,At,kt){const it=Ae[At];return delete Ae[At],Ae[xt]=it,Le[it].geometry[0].shift(),Le[it].geometry[0]=kt[0].concat(Le[it].geometry[0]),it}function wt(xt,At,kt){const it=kt?At[0][At[0].length-1]:At[0][0];return`${xt}:${it.x}:${it.y}`}for(let xt=0;xt<Me.length;xt++){const At=Me[xt],kt=At.geometry,it=At.text?At.text.toString():null;if(!it){st(xt);continue}const Tt=wt(it,kt),Xe=wt(it,kt,!0);if(Tt in ke&&Xe in Ae&&ke[Tt]!==Ae[Xe]){const at=ft(Tt,Xe,kt),Mt=Ge(Tt,Xe,Le[at].geometry);delete Ae[Tt],delete ke[Xe],ke[wt(it,Le[Mt].geometry,!0)]=Mt,Le[at].geometry=null}else Tt in ke?Ge(Tt,Xe,kt):Xe in Ae?ft(Tt,Xe,kt):(st(xt),Ae[Tt]=Be-1,ke[Xe]=Be-1)}return Le.filter(xt=>xt.geometry)}(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Me of s.elevationFeatures)this.elevationFeatureIdToIndex.set(Me.id,this.elevationFeatures.length),this.elevationFeatures.push(Me)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Me,Ae)=>Me.sortKey-Ae.sortKey)}update(i,s,d,f,y,_,S){this.text.programConfigurations.updatePaintArrays(i,s,y,d,f,_,S,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,s,y,d,f,_,S,this.worldview)}updateRoadElevation(i){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1;const d=Ee(i),f=1/d;let y=!1,_=!1;for(let S=0;S<this.symbolInstances.length;S++){const A=this.symbolInstances.get(S),k=Oe(1,0,0),j=Oe(0,1,0),{numHorizontalGlyphVertices:R,numVerticalGlyphVertices:L,numIconVertices:H,numVerticalIconVertices:W}=A,J=R>0||L>0,Q=H>0,ae=this.elevationFeatures[A.elevationFeatureIndex];if(ae){const de=new ut(A.tileAnchorX,A.tileAnchorY),he=.075+ae.pointElevation(de);A.zOffset!==he&&(s=!0,A.zOffset=he);const fe=ae.computeSlopeNormal(de,f),Me=Ys(wa(),Oe(0,0,1),fe);Ut(k,k,Me),Ut(j,j,Me),k[2]*=d,j[2]*=d,k[0]===1&&k[1]===0&&k[2]===0&&j[0]===0&&j[1]===1&&j[2]===0||(y=y||J,_=_||Q)}if(J&&(YS(this.text.orientationVertexArray,R,k,j),YS(this.text.orientationVertexArray,L,k,j)),Q){const{placedIconSymbolIndex:de,verticalPlacedIconSymbolIndex:he}=A;de>=0&&YS(this.icon.orientationVertexArray,H,k,j),he>=0&&YS(this.icon.orientationVertexArray,W,k,j)}}y||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(y,_,S)=>{d+=_,d>y.length&&y.resize(d);for(let A=-_;A<0;A++)y.emplace(A+d,S)},s=(y,_,S)=>{f+=_,f>y.length&&y.resize(f);for(let A=-_;A<0;A++)y.emplace(A+f,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,f=0;for(let y=0;y<this.symbolInstances.length;y++){const _=this.symbolInstances.get(y),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:A,numIconVertices:k}=_,j=_.zOffset,R=k>0;if((S>0||A>0)&&(i(this.text.zOffsetVertexArray,S,j),i(this.text.zOffsetVertexArray,A,j)),R){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:H}=_;L>=0&&s(this.icon.zOffsetVertexArray,k,j),H>=0&&s(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,j)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=G5(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,s){const d=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:f,y}of s)this.lineVertexArray.emplaceBack(f,y);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,s,d,f,y,_,S,A,k,j,R,L,H,W,J,Q){const ae=i.indexArray,de=i.layoutVertexArray,he=i.globeExtVertexArray,fe=i.segments.prepareSegment(4*s.length,de,ae,this.canOverlap?_.sortKey:void 0),Me=this.glyphOffsetArray.length,Ae=fe.vertexLength,ke=this.allowVerticalPlacement&&S===hs.vertical?Math.PI/2:0,Le=_.text&&_.text.sections;for(let st=0;st<s.length;st++){const{tl:Ge,tr:ft,bl:wt,br:xt,texPrimary:At,texSecondary:kt,pixelOffsetTL:it,pixelOffsetBR:Tt,minFontScaleX:Xe,minFontScaleY:at,glyphOffset:Mt,isSDF:St,sectionIndex:ar}=s[st],Kt=fe.vertexLength,_t=Mt[1];if(ZS(de,k.x,k.y,Ge.x,_t+Ge.y,At.x,At.y,d,St,it.x,it.y,Xe,at),ZS(de,k.x,k.y,ft.x,_t+ft.y,At.x+At.w,At.y,d,St,Tt.x,it.y,Xe,at),ZS(de,k.x,k.y,wt.x,_t+wt.y,At.x,At.y+At.h,d,St,it.x,Tt.y,Xe,at),ZS(de,k.x,k.y,xt.x,_t+xt.y,At.x+At.w,At.y+At.h,d,St,Tt.x,Tt.y,Xe,at),A){const{x:Pt,y:rr,z:Bt}=A.anchor,[Nt,qt,pr]=A.up;XS(he,Pt,rr,Bt,Nt,qt,pr),XS(he,Pt,rr,Bt,Nt,qt,pr),XS(he,Pt,rr,Bt,Nt,qt,pr),XS(he,Pt,rr,Bt,Nt,qt,pr),JS(i.dynamicLayoutVertexArray,Pt,rr,Bt,ke)}else JS(i.dynamicLayoutVertexArray,k.x,k.y,k.z,ke);if(Q){const Pt=kt||At;KS(i.iconTransitioningVertexArray,Pt.x,Pt.y),KS(i.iconTransitioningVertexArray,Pt.x+Pt.w,Pt.y),KS(i.iconTransitioningVertexArray,Pt.x,Pt.y+Pt.h),KS(i.iconTransitioningVertexArray,Pt.x+Pt.w,Pt.y+Pt.h)}ae.emplaceBack(Kt,Kt+1,Kt+2),ae.emplaceBack(Kt+1,Kt+2,Kt+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mt[0]),st!==s.length-1&&ar===s[st+1].sectionIndex||i.programConfigurations.populatePaintArrays(de.length,_,_.index,{},H,W,J,Le&&Le[ar],this.worldview)}const Be=A?A.anchor:k;i.placedSymbolArray.emplaceBack(Be.x,Be.y,Be.z,k.x,k.y,Me,this.glyphOffsetArray.length-Me,Ae,j,R,k.segment,d?d[0]:0,d?d[1]:0,f[0],f[1],S,0,0,0,L,0)}_commitLayoutVertex(i,s,d,f,y,_,S){i.emplaceBack(s,d,f,y,_,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(i,s,d,f,y,_,S){const A=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),k=A.vertexLength,j=S.tileAnchorX,R=S.tileAnchorY;for(let H=0;H<4;H++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,s,i.padding,S.zOffset),this._commitLayoutVertex(d.layoutVertexArray,f,y,_,j,R,new ut(i.x1,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,f,y,_,j,R,new ut(i.x2,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,f,y,_,j,R,new ut(i.x2,i.y2)),this._commitLayoutVertex(d.layoutVertexArray,f,y,_,j,R,new ut(i.x1,i.y2)),A.vertexLength+=4;const L=d.indexArray;L.emplaceBack(k,k+1),L.emplaceBack(k+1,k+2),L.emplaceBack(k+2,k+3),L.emplaceBack(k+3,k),A.primitiveLength+=4}_addTextDebugCollisionBoxes(i,s,d,f,y,_){for(let S=f;S<y;S++){const A=d.get(S),k=this.getSymbolInstanceTextSize(i,_,s,S);this._addCollisionDebugVertices(A,k,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(i,s,d,f,y,_){for(let S=f;S<y;S++){const A=d.get(S),k=this.getSymbolInstanceIconSize(i,s,_.placedIconSymbolIndex);this._addCollisionDebugVertices(A,k,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}generateCollisionDebugBuffers(i,s,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new JP(Dg,i5.members,xl),this.iconCollisionBox=new JP(Dg,i5.members,xl);const f=tx(this.iconSizeData,i),y=tx(this.textSizeData,i,d);for(let _=0;_<this.symbolInstances.length;_++){const S=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(y,i,s,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(y,i,s,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,s,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,s,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(i,s,d,f){const y=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:f),_=GP(this.textSizeData,i,y)/To;return this.tilePixelRatio*_}getSymbolInstanceIconSize(i,s,d){const f=this.icon.placedSymbolArray.get(d),y=GP(this.iconSizeData,i,f);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(i,s,d,f){i.emplaceBack(s,-d,-d,f),i.emplaceBack(s,d,-d,f),i.emplaceBack(s,d,d,f),i.emplaceBack(s,-d,d,f)}_updateTextDebugCollisionBoxes(i,s,d,f,y,_,S){for(let A=f;A<y;A++){const k=d.get(A),j=this.getSymbolInstanceTextSize(i,_,s,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,j,k.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(i,s,d,f,y,_,S){for(let A=f;A<y;A++){const k=d.get(A),j=this.getSymbolInstanceIconSize(i,s,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,j,k.padding,_.zOffset)}}updateCollisionDebugBuffers(i,s,d,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=tx(this.iconSizeData,i,f),_=tx(this.textSizeData,i,d);for(let S=0;S<this.symbolInstances.length;S++){const A=this.symbolInstances.get(S);this._updateTextDebugCollisionBoxes(_,i,s,A.textBoxStartIndex,A.textBoxEndIndex,A,d),this._updateTextDebugCollisionBoxes(_,i,s,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,d),this._updateIconDebugCollisionBoxes(y,i,s,A.iconBoxStartIndex,A.iconBoxEndIndex,A,f),this._updateIconDebugCollisionBoxes(y,i,s,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,s,d,f,y,_,S,A,k){const j={};if(s<d){const{x1:R,y1:L,x2:H,y2:W,padding:J,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe,featureIndex:Me}=i.get(s);j.textBox={x1:R,y1:L,x2:H,y2:W,padding:J,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe},j.textFeatureIndex=Me}if(f<y){const{x1:R,y1:L,x2:H,y2:W,padding:J,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe,featureIndex:Me}=i.get(f);j.verticalTextBox={x1:R,y1:L,x2:H,y2:W,padding:J,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe},j.verticalTextFeatureIndex=Me}if(_<S){const{x1:R,y1:L,x2:H,y2:W,padding:J,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe,featureIndex:Me}=i.get(_);j.iconBox={x1:R,y1:L,x2:H,y2:W,padding:J,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe},j.iconFeatureIndex=Me}if(A<k){const{x1:R,y1:L,x2:H,y2:W,padding:J,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe,featureIndex:Me}=i.get(A);j.verticalIconBox={x1:R,y1:L,x2:H,y2:W,padding:J,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:fe},j.verticalIconFeatureIndex=Me}return j}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const d=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,s){const d=i.placedSymbolArray.get(s),f=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<f;y+=4)i.indexArray.emplaceBack(y,y+1,y+2),i.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(i),d=Math.cos(i),f=[],y=[],_=[];for(let S=0;S<this.symbolInstances.length;++S){_.push(S);const A=this.symbolInstances.get(S);f.push(0|Math.round(s*A.tileAnchorX+d*A.tileAnchorY)),y.push(A.featureIndex)}return _.sort((S,A)=>f[S]-f[A]||y[A]-y[S]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,s){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===s?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const d=this.symbolInstances.get(s);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:k}=d;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&y!==f&&this.addIndicesForPlacedSymbol(this.text,y),_>=0&&_!==y&&_!==f&&this.addIndicesForPlacedSymbol(this.text,_),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let q5,H5,QP;Wt(QS,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),QS.addDynamicAttributes=JS;class W5{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Kh,this.defaultValue=i}evaluate(i){if(i.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wt(W5,"FormatSectionOverride",{omit:["defaultValue"]});const eM=()=>QP||(QP={layout:q5||(q5=new wi({"symbol-placement":new It($e.layout_symbol["symbol-placement"]),"symbol-spacing":new It($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It($e.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new It($e.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new It($e.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new It($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new It($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new It($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t($e.layout_symbol["icon-size"]),"icon-size-scale-range":new It($e.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new $t($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t($e.layout_symbol["icon-image"]),"icon-rotate":new $t($e.layout_symbol["icon-rotate"]),"icon-padding":new It($e.layout_symbol["icon-padding"]),"icon-keep-upright":new It($e.layout_symbol["icon-keep-upright"]),"icon-offset":new $t($e.layout_symbol["icon-offset"]),"icon-anchor":new $t($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It($e.layout_symbol["text-rotation-alignment"]),"text-field":new $t($e.layout_symbol["text-field"]),"text-font":new $t($e.layout_symbol["text-font"]),"text-size":new $t($e.layout_symbol["text-size"]),"text-size-scale-range":new It($e.layout_symbol["text-size-scale-range"]),"text-max-width":new $t($e.layout_symbol["text-max-width"]),"text-line-height":new $t($e.layout_symbol["text-line-height"]),"text-letter-spacing":new $t($e.layout_symbol["text-letter-spacing"]),"text-justify":new $t($e.layout_symbol["text-justify"]),"text-radial-offset":new $t($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It($e.layout_symbol["text-variable-anchor"]),"text-anchor":new $t($e.layout_symbol["text-anchor"]),"text-max-angle":new It($e.layout_symbol["text-max-angle"]),"text-writing-mode":new It($e.layout_symbol["text-writing-mode"]),"text-rotate":new $t($e.layout_symbol["text-rotate"]),"text-padding":new It($e.layout_symbol["text-padding"]),"text-keep-upright":new It($e.layout_symbol["text-keep-upright"]),"text-transform":new $t($e.layout_symbol["text-transform"]),"text-offset":new $t($e.layout_symbol["text-offset"]),"text-allow-overlap":new It($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new It($e.layout_symbol["text-ignore-placement"]),"text-optional":new It($e.layout_symbol["text-optional"]),visibility:new It($e.layout_symbol.visibility)})),paint:H5||(H5=new wi({"icon-opacity":new $t($e.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new $t($e.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new $t($e.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new $t($e.paint_symbol["text-emissive-strength"]),"icon-color":new $t($e.paint_symbol["icon-color"]),"icon-halo-color":new $t($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t($e.paint_symbol["icon-halo-blur"]),"icon-translate":new It($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new It($e.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new It($e.paint_symbol["icon-image-cross-fade"]),"text-opacity":new $t($e.paint_symbol["text-opacity"]),"text-occlusion-opacity":new $t($e.paint_symbol["text-occlusion-opacity"]),"text-color":new $t($e.paint_symbol["text-color"],{runtimeType:Ua,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new $t($e.paint_symbol["text-halo-color"]),"text-halo-width":new $t($e.paint_symbol["text-halo-width"]),"text-halo-blur":new $t($e.paint_symbol["text-halo-blur"]),"text-translate":new It($e.paint_symbol["text-translate"]),"text-translate-anchor":new It($e.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new It($e.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new It($e.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new It($e.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new It($e.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new $t($e.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},QP);class eT extends Zo{constructor(i,s,d,f){super(i,eM(),s,d,f),this._colorAdjustmentMatrix=N([]),this.hasInitialOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,s){super.recalculate(i,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const f=[];for(const y of d)f.indexOf(y)<0&&f.push(y);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,s,d,f){return this._saturation===i&&this._contrast===s&&this._brightnessMin===d&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(y,_,S,A){y=qo(y),_=Ea(_);const k=B(),j=y/3,R=1-2*j,L=[R,j,j,0,j,R,j,0,j,j,R,0,0,0,0,1],H=.5-.5*_,W=A-S;return V(k,[W,0,0,0,0,W,0,0,0,0,W,0,S,S,S,1],[_,0,0,0,0,_,0,0,0,0,_,0,H,H,H,1]),V(k,k,L),k}(i,s,d,f),this._saturation=i,this._contrast=s,this._brightnessMin=d,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,s,d,f){const y=this.layout.get(i).evaluate(s,{},d,f),_=this._unevaluatedLayout._values[i];return _.isDataDriven()||n0(_.value)||!y?y:function(S,A){return A.replace(/{([^{}]+)}/g,(k,j)=>j in S?String(S[j]):"")}(s.properties,y)}createBucket(i){return new QS(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of eM().paint.overridableProperties){if(!eT.hasPaintOverride(this.layout,i))continue;const s=this.paint.get(i),d=new W5(s),f=new r0(d,s.property.specification,this.scope,this.options);let y=null;y=s.value.kind==="constant"||s.value.kind==="source"?new wg("source",f):new Hc("composite",f,s.value.zoomStops,s.value.interpolationType),this.paint._values[i]=new Xu(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(i,s,d){return!(!this.layout||s.isDataDriven()||d.isDataDriven())&&eT.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,s){const d=i.get("text-field"),f=eM().paint.properties[s];let y=!1;const _=S=>{for(const A of S)if(f.overrides&&f.overrides.hasOverride(A))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof ca)_(d.value.value.sections);else if(d.value.kind==="source"){const S=k=>{y||(k instanceof mr&&Ht(k.value)===qf?_(k.value.sections):k instanceof Yh?_(k.sections):k.eachChild(S))},A=d.value;A._styleExpression&&S(A._styleExpression.expression)}return y}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,s,d){return{config:new da(this,{zoom:s,lut:d}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Z5,K5,X5,Y5;var tM=Yr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function tT(l,i,s,d,f,y,_,S){const A=[l,i,1,s,d,1,f,y,1],k=[_,S,1],j=O([],A),[R,L,H]=Sr(k,k,j);return D(A,A,[R,0,0,0,L,0,0,0,H])}function J5(l,i,s,d,f,y,_,S){const A=function(k,j,R,L,H,W,J,Q){const ae=tT(0,0,1,0,1,1,0,1),de=tT(k,j,R,L,H,W,J,Q);return D(de,de,O([],ae))}(l,i,s,d,f,y,_,S);return[A[2]/A[8]/Dt,A[5]/A[8]/Dt]}function rT(l){return[l[0],Math.min(Math.max(l[1],-we),we)]}class Q5 extends Fu{constructor(i,s,d,f){super(),this.id=i,this.dispatcher=d,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=s,this._dirty=!1}load(i,s){if(this._loaded=s||!1,this.fire(new Wl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=Uf(this.map._requestManager.transformRequest(this.url,Nf.Image),(d,f)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new ns(d)):f&&(this.image=f instanceof HTMLImageElement?Qs.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new X0(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Wl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof X0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=i[0][1],d=i[0][1];for(const y of i)y[1]>d&&(d=y[1]),y[1]<s&&(s=y[1]);const f=(d+s)/2;if(f>we?this.onNorthPole=!0:f<-we&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const y=i.map(Ve.fromLngLat);this.tileID=function(_){let S=1/0,A=1/0,k=-1/0,j=-1/0;for(const J of _)S=Math.min(S,J.x),A=Math.min(A,J.y),k=Math.max(k,J.x),j=Math.max(j,J.y);const R=Math.max(k-S,j-A),L=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),H=Math.pow(2,L);let W=Math.floor((S+k)/2*H);return W>1&&(W-=1),new Oa(L,W,Math.floor((A+j)/2*H))}(y),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Wl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof X0||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const ae in this.tiles){const de=this.tiles[ae];de.state!=="loaded"&&(de.state="loaded",de.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=ox(new Oa(0,0,0),this.map.transform.projection),d=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ae){const de=ae[1].x-ae[0].x,he=ae[1].y-ae[0].y,fe=ae[2].x-ae[1].x,Me=ae[2].y-ae[1].y,Ae=ae[3].x-ae[2].x,ke=ae[3].y-ae[2].y,Le=ae[0].x-ae[3].x,Be=ae[0].y-ae[3].y,st=de*Me-fe*he,Ge=fe*ke-Ae*Me,ft=Ae*Be-Le*ke,wt=Le*he-de*Be;return st>0&&Ge>0&&ft>0&&wt>0||st<0&&Ge<0&&ft<0&&wt<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=ox(this.tileID,this.map.transform.projection),[y,_,S,A]=this.coordinates.map(ae=>{const de=f.projection.project(ae[0],ae[1]);return F5(f,de)._round()});this.perspectiveTransform=J5(y.x,y.y,_.x,_.y,S.x,S.y,A.x,A.y);const k=this._boundsArray=new md;k.emplaceBack(y.x,y.y,0,0),k.emplaceBack(_.x,_.y,Dt,0),k.emplaceBack(A.x,A.y,0,Dt),k.emplaceBack(S.x,S.y,Dt,Dt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(k,tM.members),this.boundsSegments=ui.simpleSegment(0,0,4,2);const j=[],R=[rT((L=this.coordinates)[0]),rT(L[1]),rT(L[2]),rT(L[3])];var L;const[H,W,J,Q]=function(ae){let de=ae[0][0],he=de,fe=ae[0][1],Me=fe;for(let Ae=1;Ae<ae.length;Ae++)ae[Ae][0]<de?de=ae[Ae][0]:ae[Ae][0]>he&&(he=ae[Ae][0]),ae[Ae][1]<fe?fe=ae[Ae][1]:ae[Ae][1]>Me&&(Me=ae[Ae][1]);return[de,fe,he-de,Me-fe]}(R);{const ae=new md,[de,he,fe,Me]=function(it){let Tt=it[0].x,Xe=Tt,at=it[0].y,Mt=at;for(let St=1;St<it.length;St++)it[St].x<Tt?Tt=it[St].x:it[St].x>Xe&&(Xe=it[St].x),it[St].y<at?at=it[St].y:it[St].y>Mt&&(Mt=it[St].y);return[Tt,at,Xe-Tt,Mt-at]}(d),Ae=it=>[(it.x-de)/fe,(it.y-he)/Me],[ke,Le,Be,st]=d.map(Ae),Ge=function(it,Tt,Xe,at,Mt,St,ar,Kt){const _t=tT(0,0,1,0,1,1,0,1);return D(_t,_t,O([],tT(it,Tt,Xe,at,Mt,St,ar,Kt)))}(ke[0],ke[1],Le[0],Le[1],Be[0],Be[1],st[0],st[1]);this.elevatedGlobePerspectiveTransform=J5(ke[0],ke[1],Le[0],Le[1],Be[0],Be[1],st[0],st[1]);const ft=(it,Tt)=>{j.push(it.lng);const Xe=Math.round((it.lng-H)/J*Dt),at=Math.round((it.lat-W)/Q*Dt),Mt=Ae(Tt),St=Sr([],[Mt[0],Mt[1],1],Ge),ar=Math.round(St[0]/St[2]*Dt),Kt=Math.round(St[1]/St[2]*Dt);ae.emplaceBack(Xe,at,ar,Kt)},wt=d[3].x-d[0].x,xt=d[3].y-d[0].y,At=d[2].x-d[1].x,kt=d[2].y-d[1].y;for(let it=0;it<65;it++){const Tt=it/64,Xe=[d[0].x+Tt*wt,d[0].y+Tt*xt],at=[d[1].x+Tt*At,d[1].y+Tt*kt],Mt=at[0]-Xe[0],St=at[1]-Xe[1];for(let ar=0;ar<65;ar++){const Kt=ar/64,_t={x:Xe[0]+Mt*Kt,y:Xe[1]+St*Kt};ft(s.projection.unproject(_t.x,_t.y),_t)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(ae,tM.members)}{this.maxLongitudeTriangleSize=0;let ae=[],de=new ii;const he=(fe,Me,Ae)=>{de.emplaceBack(fe,Me,Ae);const ke=j[fe],Le=j[Me],Be=j[Ae],st=Math.min(Math.min(ke,Le),Be),Ge=Math.max(Math.max(ke,Le),Be)-st;Ge>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ge),ae.push(st+Ge/2)};for(let fe=0;fe<64;fe++)for(let Me=0;Me<64;Me++){const Ae=65*fe+Me,ke=Ae+1,Le=Ae+65,Be=Le+1;he(Ae,Le,ke),he(ke,Le,Be)}[ae,de]=function(fe,Me){const Ae=Array.from({length:fe.length},(Be,st)=>st);Ae.sort((Be,st)=>fe[Be]-fe[st]);const ke=[],Le=new ii;for(let Be=0;Be<Ae.length;Be++){const st=Ae[Be];ke.push(fe[st]);const Ge=3*st,ft=Ge+1;Le.emplaceBack(Me.uint16[Ge],Me.uint16[ft],Me.uint16[ft+1])}return[ke,Le]}(ae,de),this.elevatedGlobeTrianglesCenterLongitudes=ae,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(de)}this.elevatedGlobeSegments=ui.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,J/Dt,0,Q/Dt,0,0,W,H,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const s=this.map.painter.context,d=s.gl;!this._dirty||this.texture instanceof X0||(this.texture?this.texture.update(this.image):(this.texture=new MP(s,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(s)}loadTile(i,s){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},s(null)):(i.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let f=(y=i+180)+360*Math.round((d[0]-y)/360);var y;const _=new ui,S=(R,L)=>{_.segments.push({vertexOffset:0,primitiveOffset:R,vertexLength:s.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-f)<=A){const R=wo(d,0,d.length,f+A);return R===d.length||S(R,ci(d,R+1,d.length,f+360-A)-R),_}f<d[0]&&(f+=360);const k=ci(d,0,d.length,f-A);if(k===d.length)return S(0,d.length),_;S(0,k-0);const j=wo(d,k+1,d.length,f+A);return j!==d.length&&S(j,d.length-j),_}}const ioe=(Math.pow(256,2)-1)/16907520;class eB extends Zo{constructor(i,s,d,f){super(i,{layout:X5||(X5=new wi({visibility:new It($e.layout_raster.visibility)})),paint:Y5||(Y5=new wi({"raster-opacity":new It($e.paint_raster["raster-opacity"]),"raster-color":new ud($e.paint_raster["raster-color"]),"raster-color-mix":new It($e.paint_raster["raster-color-mix"]),"raster-color-range":new It($e.paint_raster["raster-color-range"]),"raster-hue-rotate":new It($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It($e.paint_raster["raster-brightness-max"]),"raster-saturation":new It($e.paint_raster["raster-saturation"]),"raster-contrast":new It($e.paint_raster["raster-contrast"]),"raster-resampling":new It($e.paint_raster["raster-resampling"]),"raster-fade-duration":new It($e.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new It($e.paint_raster["raster-emissive-strength"]),"raster-array-band":new It($e.paint_raster["raster-array-band"]),"raster-elevation":new It($e.paint_raster["raster-elevation"]),"raster-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},s,d,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof Q5&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[d,f]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(f)||d===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=L0({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,f])}}let tB,rB,nB,iB,oB;class aB extends Zo{constructor(i,s,d,f){super(i,{layout:tB||(tB=new wi({visibility:new It($e["layout_raster-particle"].visibility)})),paint:rB||(rB=new wi({"raster-particle-array-band":new It($e["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new It($e["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ud($e["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new It($e["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new It($e["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new It($e["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new It($e["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new It($e["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},s,d,f),this._updateColorRamp(),this.lastInvalidatedAt=Qs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=L0({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Qs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class ooe extends Zo{constructor(i,s){super(i,{},s,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function rM(l,i,s){const d=[0,0,1],f=xo([]);return kc(f,f,s?-Br(l)+Math.PI:Br(l)),$l(f,f,-Br(i)),Ut(d,d,f),Er(d,d)}const sB={None:0,Model:1,Symbol:2,FillExtrusion:4};class nT{constructor(i,s,d,f){this.message=(i?`${i}: `:"")+d,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function nM(l,i){const s=l.indexOf("://")===-1;try{return new URL(l,s&&i?"http://example.com":void 0),!0}catch{return!1}}class lB{constructor(i,s){this.feature=i,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class cB{constructor(){this.instancedDataArray=new Lg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class iM{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs}updateFootprints(i,s){}populate(i,s,d,f){this.tileToMeter=Ee(d);const y=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:S,index:A,sourceLayerIndex:k}of i){const j=S??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),R=Ze(_,y);if(!this.layers[0]._featureFilter.filter(new On(this.zoom,{worldview:this.worldview}),R,d))continue;const L={id:j,sourceLayerIndex:k,index:A,geometry:y?R.geometry:nt(_,d,f),properties:_.properties,type:_.type,patterns:{}},H=this.addFeature(L,L.geometry,R);H&&s.featureIndex.insert(_,L.geometry,A,k,this.index,this.instancesPerModel[H].instancedDataArray.length,Dt/32)}this.lookup=null}update(i,s,d,f){for(const y in this.instancesPerModel){const _=this.instancesPerModel[y];for(const S in i)_.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(_.features[_.idToFeaturesIndex[S]],i[S],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const s in this.instancesPerModel){const d=this.instancesPerModel[s];for(const f of d.features){const y=this.layers[0],_=f.feature,S=this.canonical,A=y.paint.get("model-rotation").evaluate(_,{},S),k=y.paint.get("model-scale").evaluate(_,{},S),j=y.paint.get("model-translation").evaluate(_,{},S);Jr(f.rotation,A)&&Jr(f.scale,k)&&Jr(f.translation,j)||(this.evaluate(f,f.featureStates,d,!0),i=!0)}}return i}updateReplacement(i,s,d,f){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const y=s.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(kS(this.activeReplacements,y))return!1;this.activeReplacements=y;let _=!1;for(const S in this.instancesPerModel){const A=this.instancesPerModel[S],k=A.instancedDataArray;for(const j of A.features){const R=j.instancedDataOffset,L=j.instancedDataCount;for(let H=0;H<L;H++){const W=16*(H+R);let J=k.float32[W+0];const Q=J>Dt;J=Q?J-Dt:J;const ae=Math.floor(J),de=k.float32[W+1];let he=!1;for(const fe of this.activeReplacements)if(!XN(fe,d,sB.Model,f)&&!(fe.min.x>ae||ae>fe.max.x||fe.min.y>de||de>fe.max.y)&&(he=_P(eF(ae,de,i.canonical,fe.footprintTileId.canonical),fe.footprint),he))break;k.float32[W]=he?J+Dt:J,_=_||he!==Q}}}return _}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const s in this.instancesPerModel){const d=this.instancesPerModel[s];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=i.createVertexBuffer(d.instancedDataArray,zne.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const d=this.instancesPerModel[s];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris&&this.modelsRequested)for(const s of this.modelUris)i.removeModel(s,"",!0)}addFeature(i,s,d){const f=this.layers[0],y=f.layout.get("model-id").evaluate(d,{},this.canonical);if(!y)return Wr(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),y;(nM(y,!1)||this.styleDefinedModelURLs[y]!==void 0)&&(this.modelUris.includes(y)||this.modelUris.push(y)),this.instancesPerModel[y]||(this.instancesPerModel[y]=new cB);const _=this.instancesPerModel[y],S=_.instancedDataArray,A=new lB(d,S.length);for(const k of s)for(const j of k){if(j.x<0||j.x>=Dt||j.y<0||j.y>=Dt)continue;const R=(this.lookupDim-1)/Dt,L=this.lookupDim*(j.y*R|0)+j.x*R|0;if(this.lookup){if(this.lookup[L]!==0)continue;this.lookup[L]=1}this.instanceCount++;const H=S.length;S.resize(H+1),_.instancesEvaluatedElevation.push(0),S.float32[16*H]=j.x,S.float32[16*H+1]=j.y}return A.instancedDataCount=_.instancedDataArray.length-A.instancedDataOffset,A.instancedDataCount>0&&(i.id&&(_.idToFeaturesIndex[i.id]=_.features.length),_.features.push(A),this.evaluate(A,{},_,!1)),y}getModelUris(){return this.modelUris}evaluate(i,s,d,f){const y=this.layers[0],_=i.feature,S=this.canonical,A=i.rotation=y.paint.get("model-rotation").evaluate(_,s,S),k=i.scale=y.paint.get("model-scale").evaluate(_,s,S),j=i.translation=y.paint.get("model-translation").evaluate(_,s,S),R=y.paint.get("model-color").evaluate(_,s,S);R.a=y.paint.get("model-color-mix-intensity").evaluate(_,s,S);const L=[];this.maxVerticalOffset<j[2]&&(this.maxVerticalOffset=j[2]),this.maxScale=Math.max(Math.max(this.maxScale,k[0]),Math.max(k[1],k[2])),DF(L,A,k);const H=Math.round(100*R.a)+R.b/1.05;for(let W=0;W<i.instancedDataCount;++W){const J=i.instancedDataOffset+W,Q=16*J,ae=d.instancedDataArray.float32;let de=0;f&&(de=ae[Q+6]-d.instancesEvaluatedElevation[J]);const he=0|ae[Q+1];ae[Q]=(0|ae[Q])+R.r/1.05,ae[Q+1]=he+R.g/1.05,ae[Q+2]=H,ae[Q+3]=1/(S.z>10?this.tileToMeter:Ee(S,he)),ae[Q+4]=j[0],ae[Q+5]=j[1],ae[Q+6]=j[2]+de,ae[Q+7]=L[0],ae[Q+8]=L[1],ae[Q+9]=L[2],ae[Q+10]=L[4],ae[Q+11]=L[5],ae[Q+12]=L[6],ae[Q+13]=L[8],ae[Q+14]=L[9],ae[Q+15]=L[10],d.instancesEvaluatedElevation[J]=j[2]}}}let uB,hB;Wt(iM,"ModelBucket",{omit:["layers"]}),Wt(cB,"PerModelAttributes"),Wt(lB,"ModelFeature");class Qg{constructor(i,s,d){this._demTile=i,this._dem=this._demTile.dem,this._scale=s,this._offset=d}static create(i,s,d){const f=d||i.findDEMTileFor(s);if(!f||!f.dem)return;const y=f.dem,_=f.tileID,S=1<<s.canonical.z-_.canonical.z;return new Qg(f,y.dim/Dt/S,[(s.canonical.x/S-_.canonical.x)*y.dim,(s.canonical.y/S-_.canonical.y)*y.dim])}tileCoordToPixel(i,s){const d=s*this._scale+this._offset[1];return new ut(Math.floor(i*this._scale+this._offset[0]),Math.floor(d))}getElevationAt(i,s,d,f){const y=i*this._scale+this._offset[0],_=s*this._scale+this._offset[1],S=Math.floor(y),A=Math.floor(_),k=this._dem;return f=!!f,d?lr(lr(k.get(S,A,f),k.get(S,A+1,f),_-A),lr(k.get(S+1,A,f),k.get(S+1,A+1,f),_-A),y-S):k.get(S,A,f)}getElevationAtPixel(i,s,d){return this._dem.get(i,s,!!d)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*ue(1,i)*this._dem.stride}}const oM=new Float32Array(262144),kp=new Uint8Array(262144);function dB(l){let i=0;if(l.meshes)for(const s of l.meshes)i=Math.max(i,s.aabb.max[2]);if(l.children)for(const s of l.children)i=Math.max(i,dB(s));return i}function fB(l,i,s){if(l.meshes)for(const d of l.meshes){if(d.aabb.min[0]===1/0)continue;const f=kr.applyTransform(d.aabb,l.matrix);s.insert(i,f.min[0],f.min[1],f.max[0],f.max[1])}if(l.children)for(const d of l.children)fB(d,i,s)}const pB=["","wall","door","roof","window","lamp","logo"];class mB{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:dB(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const s=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==i&&(d.transformedAabb=kr.applyTransformFast(d.aabb,this.node.matrix),s.encapsulate(d.transformedAabb)),i++;this.aabb=s}return this.aabb}}class iT{constructor(i,s,d,f,y,_,S,A){this.id=d,this.layers=i,this.layerIds=this.layers.map(k=>k.fqid),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.modelTraits|=Zg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=Zg.HasMapboxMeshFeatures),y&&(this.modelTraits|=Zg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=A,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const k of s)this.nodesInfo.push(new mB(k)),fB(k,S.featureIndexArray.length,S.grid),S.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,S.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(i,s){for(const d of this.getNodesInfo()){const f=d.node;f.footprint&&s.push({footprint:f.footprint,id:i})}}update(i){const s=Object.keys(i).length!==0;if(s&&!this.stateDependentLayers.length)return;const d=s?this.stateDependentLayers:this.layers;if(!Wn(i,this.states))for(const f of d)this.evaluate(f,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const d of s){const f=d.node;this.uploaded?this.updatePbrBuffer(f):jP(f,i,!0)}for(const d of s)NS(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let s=!1;if(!i.meshes)return s;for(const d of i.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),s=!0);return s}needsReEvaluation(i,s,d){const f=i.transform.projectionOptions,y=i.style.getBrightness(),_=this.brightness!==y;if(!this.uploaded||this.dirty||f.name!==this.projection.name||ux(d.paint.get("model-color").value,_)||ux(d.paint.get("model-color-mix-intensity").value,_)||ux(d.paint.get("model-roughness").value,_)||ux(d.paint.get("model-emissive-strength").value,_)||ux(d.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=f,this.brightness=y;const S=this.getNodesInfo();for(const A of S)A.state=null;return!0}return!1}evaluateTransform(i,s){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const d=this.getNodesInfo(),f=this.id.canonical;for(const y of d){const _=y.feature;y.evaluatedTranslation=s.paint.get("model-translation").evaluate(_,{},f),y.evaluatedScale=s.paint.get("model-scale").evaluate(_,{},f)}}evaluate(i,s){const d=this.getNodesInfo();for(const f of d){if(!f.node.meshes)continue;const y=f.feature,_=s&&s[y.id];if(Wn(_,f.state))continue;f.state=structuredClone(_);const S=f.node.meshes&&f.node.meshes[0].featureData,A=f.evaluatedColor[2],k=f.evaluatedRMEA[2],j=this.id.canonical;if(f.hasTranslucentParts=!1,S){for(let R=0;R<pB.length;R++){const L=pB[R];L.length&&(y.properties.part=L);const H=i.paint.get("model-color").evaluate(y,_,j).toPremultipliedRenderColor(null),W=i.paint.get("model-color-mix-intensity").evaluate(y,_,j);f.evaluatedColor[R]=[H.r,H.g,H.b,W],f.evaluatedRMEA[R][0]=i.paint.get("model-roughness").evaluate(y,_,j),f.evaluatedRMEA[R][2]=i.paint.get("model-emissive-strength").evaluate(y,_,j),f.evaluatedRMEA[R][3]=H.a,f.emissionHeightBasedParams[R]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(y,_,j),!f.hasTranslucentParts&&H.a<1&&(f.hasTranslucentParts=!0)}delete y.properties.part,soe(f,A!==f.evaluatedColor[2]||k!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(y,_,j);f.evaluatedTranslation=i.paint.get("model-translation").evaluate(y,_,j),f.evaluatedScale=i.paint.get("model-scale").evaluate(y,_,j),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,s,d,f){const y=i.findDEMTileFor(d);if(y&&(y.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(y.dem&&y.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=y.tileID.overscaledZ;const _=Qg.create(i,d,y);if(!_)return;this.modelTraits&Zg.HasMapboxMeshFeatures&&this.updateDEM(i,_,d,f);for(const S of this.getNodesInfo()){const A=S.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const k=A.footprint.vertices;let j=_.getElevationAt(k[0].x,k[0].y,!0,!0);for(let R=1;R<k.length;R++)j=Math.min(j,_.getElevationAt(k[R].x,k[R].y,!0,!0));A.elevation=j}}this.terrainTile=y.tileID.canonical,this.terrainExaggeration=s}}updateDEM(i,s,d,f){let y=s._dem._modifiedForSources[f];if(y===void 0&&(s._dem._modifiedForSources[f]=[],y=s._dem._modifiedForSources[f]),y.includes(d.canonical))return;const _=s._dem.dim;y.push(d.canonical);let S=!1;for(const A of this.getNodesInfo()){const k=A.node;if(!k.footprint||!k.footprint.grid)continue;const j=k.footprint.grid,R=s.tileCoordToPixel(j.min.x,j.min.y),L=s.tileCoordToPixel(j.max.x,j.max.y),H=Math.min(Math.min(_-L.y,R.x),Math.min(R.y,_-L.x));if(H<0)continue;const W=xe(H,2,5);let J=Math.max(0,R.x-W),Q=Math.max(0,R.y-W),ae=Math.min(L.x+W,_-1),de=Math.min(L.y+W,_-1);for(let Ae=Q;Ae<=de;++Ae)for(let ke=J;ke<=ae;++ke)kp[Ae*_+ke]=255;let he=0,fe=0;for(let Ae=0;Ae<j.cellsY;++Ae)for(let ke=0;ke<j.cellsX;++ke){if(!j.cells[Ae*j.cellsX+ke])continue;const Le=s.tileCoordToPixel(j.min.x+ke/j.xScale,j.min.y+Ae/j.yScale),Be=s.tileCoordToPixel(j.min.x+(ke+1)/j.xScale,j.min.y+(Ae+1)/j.yScale);for(let st=Le.y;st<=Math.min(Be.y+1,_-1);++st)for(let Ge=Le.x;Ge<=Math.min(Be.x+1,_-1);++Ge)kp[st*_+Ge]===255&&(kp[st*_+Ge]=0,he+=s.getElevationAtPixel(Ge,st),fe++)}const Me=he/fe;J=Math.max(1,R.x-W),Q=Math.max(1,R.y-W),ae=Math.min(L.x+W,_-2),de=Math.min(L.y+W,_-2),S=!0;for(let Ae=Q;Ae<=de;++Ae)for(let ke=J;ke<=ae;++ke)kp[Ae*_+ke]===0&&(oM[Ae*_+ke]=s._dem.set(ke,Ae,Me));for(let Ae=1;Ae<W;++Ae){J=Math.max(1,R.x-Ae),Q=Math.max(1,R.y-Ae),ae=Math.min(L.x+Ae,_-2),de=Math.min(L.y+Ae,_-2);for(let ke=Q;ke<=de;++ke)for(let Le=J;Le<=ae;++Le){const Be=ke*_+Le;if(kp[Be]===255){let st=0,Ge=0,ft=-1,wt=-1;for(let xt=-1;xt<=1;++xt)for(let At=-1;At<=1;++At){const kt=(ke+xt)*_+Le+At;if(kp[kt]>=Ae)continue;const it=oM[kt],Tt=Math.abs(it);Tt>Ge&&(st=it,Ge=Tt,ft=At,wt=xt)}if(Ge>.1){const xt=1-(Ae+.5*Math.abs(ft*wt))/W;let At=s._dem.get(Le,ke)+st*xt;const kt=s._dem.get(Le+ft,ke+wt),it=s._dem.get(Le-ft,ke-wt,!0);(At-kt)*(At-it)>0&&(At=(kt+it)/2),oM[Be]=s._dem.set(Le,ke,At),kp[Be]=Ae}}}}}S&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=Qs.now())}setFilter(i){this.filter=i?hd(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new On(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const s of i)NS(s.node),RP(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const d=s.getReplacementRegionsForTile(i.toUnwrapped());for(const f of this.getNodesInfo()){const y=f.node.footprint;f.hiddenByReplacement=!!y&&!d.find(_=>_.footprint===y)}}getHeightAtTileCoord(i,s){const d=[],f=[0,0,0],y=N([]);for(const _ of this.getNodesInfo()){const S=_.node.meshes[0],A=S.transformedAabb;if(i<A.min[0]||s<A.min[1]||i>A.max[0]||s>A.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};G(y,_.node.matrix),f[0]=i,f[1]=s,Qt(f,f,y);const k=(f[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*Tp|0,j=Math.min(63,(f[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*Tp|0)*Tp+Math.min(63,k),R=S.heightmap[j];if(!(R<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:R,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new ut(i,s),new ut(i,s),d),d.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function ux(l,i){return l instanceof wg&&!l.isLightConstant&&i}function aoe(l,i,s,d,f,y,_,S){let A=(61440&i|(61440&i)>>4)>>8,k=(3840&i|(3840&i)>>4)>>4,j=240&i|(240&i)>>4;s[3]>0&&(A=lr(A,255*s[0],s[3]),k=lr(k,255*s[1],s[3]),j=lr(j,255*s[2],s[3]));const R=A<<8|k,L=j<<8|Math.floor(255*d[3]),H=function(Ae){const ke=xe(Ae,0,2);return Math.min(Math.round(.5*ke*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],W=xe(f[0],0,1),J=xe(f[1],0,1),Q=xe(f[2],0,1),ae=xe(f[3],0,1);let de,he,fe,Me;if(W!==J&&_!==y&&J!==W){const Ae=_-y;he=1/(Ae*(J-W)),fe=-(y+Ae*W)/(Ae*(J-W));const ke=xe(f[4],-1,1);Me=Math.pow(10,ke),de=255*Q<<8|255*ae}else de=65535,he=0,fe=1,Me=1;if(l.emplaceBack(R,L,H,de,he,fe,Me),S){const Ae=S.length;S.clear();for(let ke=0;ke<Ae;ke++)S.emplaceBack(R,L,H,de,he,fe,Me)}}function soe(l,i,s){const d=l.node;let f=0;const y=s&Zg.HasMeshoptCompression;for(const _ of d.meshes){if(d.lights&&d.lightMeshIndex===f||!_.featureData)continue;_.featureArray=new bd,_.featureArray.reserve(_.featureData.length);let S=i;for(const A of _.featureData){const k=y?65535&A:A>>16&65535,j=y?A>>16&65535:65535&A,R=(15&j)<8?15&j:0,L=l.evaluatedRMEA[R],H=l.evaluatedColor[R],W=l.emissionHeightBasedParams[R];let J;if(S&&R===2&&d.lights&&(J=new bd,J.resize(10*d.lights.length)),aoe(_.featureArray,k,H,L,W,_.aabb.min[2],_.aabb.max[2],J),J&&S){S=!1;const Q=d.meshes[d.lightMeshIndex];Q.featureArray=J,Q.featureArray._trim()}}_.featureArray._trim(),f++}}function gB(l,i,s,d){const f=1<<l.z;i.lat=me((d/Dt+l.y)/f),i.lng=pe((s/Dt+l.x)/f)}function loe(l,i,s,d){const f=l.getNodesInfo()[i];if(!f||f.hiddenByReplacement||!f.node.meshes)return;let y=Number.MAX_VALUE;const _=f.node,S=s.tile,A=d.calculatePosMatrix(S.tileID.toUnwrapped(),d.worldSize),k=f.evaluatedScale;let j=0;d.elevation&&_.elevation&&(j=_.elevation*d.elevation.exaggeration()),U(A,A,[(_.anchor?_.anchor[0]:0)*(k[0]-1),(_.anchor?_.anchor[1]:0)*(k[1]-1),j]),X(A,A,k);const R=s.queryGeometry,L=R.isPointQuery()?R.screenBounds:R.screenGeometry,H=function(J){const Q=V([],A,J.matrix);V(Q,d.expandedFarZProjMatrix,Q);for(let ae=0;ae<J.meshes.length;++ae){const de=J.meshes[ae];if(ae===J.lightMeshIndex)continue;const he=LF(L,d,Q,de.aabb);he!=null&&(y=Math.min(he,y))}if(J.children)for(const ae of J.children)H(ae)};if(H(_),y===Number.MAX_VALUE)return;const W=new q(0,0);return gB(S.tileID.canonical,W,f.node.anchor[0],f.node.anchor[1]),{intersectionZ:y,position:W,feature:f.feature}}Wt(iT,"Tiled3dModelBucket",{omit:["layers"]}),Wt(mB,"Tiled3dModelFeature");const coe={circle:class extends Zo{constructor(l,i,s,d){super(l,{layout:Td||(Td=new wi({"circle-sort-key":new $t($e.layout_circle["circle-sort-key"]),"circle-elevation-reference":new It($e.layout_circle["circle-elevation-reference"]),visibility:new It($e.layout_circle.visibility)})),paint:Ed||(Ed=new wi({"circle-radius":new $t($e.paint_circle["circle-radius"]),"circle-color":new $t($e.paint_circle["circle-color"]),"circle-blur":new $t($e.paint_circle["circle-blur"]),"circle-opacity":new $t($e.paint_circle["circle-opacity"]),"circle-translate":new It($e.paint_circle["circle-translate"]),"circle-translate-anchor":new It($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t($e.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new It($e.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,s,d)}createBucket(l){return new Ln(l)}queryRadius(l){const i=l;return _i("circle-radius",this,i)+_i("circle-stroke-width",this,i)+Ia(this.paint.get("circle-translate"))}queryIntersectsFeature(l,i,s,d,f,y,_,S){const A=Qc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,l.pixelToTileUnitsFactor),k=this.paint.get("circle-radius").evaluate(i,s)+this.paint.get("circle-stroke-width").evaluate(i,s);return SN(l,d,y,_,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,k)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,i,s){const d=wN(this);return{config:new da(this,{zoom:i,lut:s}),defines:d,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Zo{createBucket(l){return new EN(l)}constructor(l,i,s,d){super(l,{layout:AN||(AN=new wi({visibility:new It($e.layout_heatmap.visibility)})),paint:kN||(kN=new wi({"heatmap-radius":new $t($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ud($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It($e.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,s,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=L0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return _i("heatmap-radius",this,l)}queryIntersectsFeature(l,i,s,d,f,y,_,S){const A=this.paint.get("heatmap-radius").evaluate(i,s);return SN(l,d,y,_,S,!0,!0,new ut(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,i,s){return l==="heatmap"?{config:new da(this,{zoom:i,lut:s}),overrideFog:!1}:{}}},hillshade:class extends Zo{constructor(l,i,s,d){super(l,{layout:CN||(CN=new wi({visibility:new It($e.layout_hillshade.visibility)})),paint:PN||(PN=new wi({"hillshade-illumination-direction":new It($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It($e.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new It($e.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,s,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,i,s){return{overrideFog:!1}}},fill:class extends Zo{constructor(l,i,s,d){super(l,{layout:GN||(GN=new wi({"fill-sort-key":new $t($e.layout_fill["fill-sort-key"]),visibility:new It($e.layout_fill.visibility),"fill-elevation-reference":new It($e.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new $t($e.layout_fill["fill-construct-bridge-guard-rail"])})),paint:qN||(qN=new wi({"fill-antialias":new It($e.paint_fill["fill-antialias"]),"fill-opacity":new $t($e.paint_fill["fill-opacity"]),"fill-color":new $t($e.paint_fill["fill-color"]),"fill-outline-color":new $t($e.paint_fill["fill-outline-color"]),"fill-translate":new It($e.paint_fill["fill-translate"]),"fill-translate-anchor":new It($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new $t($e.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new It($e.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new It($e.paint_fill["fill-emissive-strength"]),"fill-z-offset":new $t($e.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new $t($e.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new $t($e.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,s,d)}getProgramIds(){const l=this.paint.get("fill-pattern"),i=l&&l.constantOr(1),s=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(l,i,s){return{config:new da(this,{zoom:i,lut:s}),overrideFog:!1}}recalculate(l,i){super.recalculate(l,i);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new mP(l)}queryRadius(){return Ia(this.paint.get("fill-translate"))}queryIntersectsFeature(l,i,s,d,f,y){return!l.queryGeometry.isAboveHorizon&&ji(Qu(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,l.pixelToTileUnitsFactor),d)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?i&&!l:i}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Zo{constructor(l,i,s,d){super(l,{layout:pF||(pF=new wi({visibility:new It($e["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new It($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:mF||(mF=new wi({"fill-extrusion-opacity":new It($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $t($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new It($e["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new $t($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new It($e["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new It($e["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new It($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new It($e["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new It($e["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new $t($e["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new $t($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new It($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new It($e["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new It($e["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new It($e["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new $t($e["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new $t($e["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new It($e["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,s,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new PS(l)}queryRadius(){return Ia(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,i,s,d,f,y,_,S,A){const k=Qc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,l.pixelToTileUnitsFactor),j=this.paint.get("fill-extrusion-height").evaluate(i,s),R=this.paint.get("fill-extrusion-base").evaluate(i,s),L=[0,0],H=S&&y.elevation,W=y.elevation?y.elevation.exaggeration():1,J=l.tile.getBucket(this);if(H&&J instanceof PS){const fe=J.centroidVertexArray,Me=A+1;Me<fe.length&&(L[0]=fe.geta_centroid_pos0(Me),L[1]=fe.geta_centroid_pos1(Me))}if(L[0]===0&&L[1]===1)return!1;y.projection.name==="globe"&&(d=fF([d],[new ut(0,0),new ut(Dt,Dt)],l.tileID.canonical).map(fe=>fe.polygon).flat());const Q=H?S:null,[ae,de]=function(fe,Me,Ae,ke,Le,Be,st,Ge,ft,wt,xt){return fe.projection.name==="globe"?function(At,kt,it,Tt,Xe,at,Mt,St,ar,Kt,_t){const Pt=[],rr=[],Bt=At.projection.upVectorScale(_t,At.center.lat,At.worldSize).metersToTile,Nt=[0,0,0,1],qt=[0,0,0,1],pr=(Pr,Ar,Qr,Ur)=>{Pr[0]=Ar,Pr[1]=Qr,Pr[2]=Ur,Pr[3]=1},gr=dF();it>0&&(it+=gr),Tt+=gr;for(const Pr of kt){const Ar=[],Qr=[];for(const Ur of Pr){const Kn=Ur.x+Xe.x,_e=Ur.y+Xe.y,ve=At.projection.projectTilePoint(Kn,_e,_t),ot=At.projection.upVector(_t,Ur.x,Ur.y);let Rt=it,zt=Tt;if(Mt){const Lt=bF(Kn,_e,it,Tt,Mt,St,ar,Kt);Rt+=Lt.base,zt+=Lt.top}it!==0?pr(Nt,ve.x+ot[0]*Bt*Rt,ve.y+ot[1]*Bt*Rt,ve.z+ot[2]*Bt*Rt):pr(Nt,ve.x,ve.y,ve.z),pr(qt,ve.x+ot[0]*Bt*zt,ve.y+ot[1]*Bt*zt,ve.z+ot[2]*Bt*zt),Qt(Nt,Nt,at),Qt(qt,qt,at),Ar.push(new wp(Nt[0],Nt[1],Nt[2])),Qr.push(new wp(qt[0],qt[1],qt[2]))}Pt.push(Ar),rr.push(Qr)}return[Pt,rr]}(fe,Me,Ae,ke,Le,Be,st,Ge,ft,wt,xt):st?function(At,kt,it,Tt,Xe,at,Mt,St,ar){const Kt=[],_t=[],Pt=[0,0,0,1];for(const rr of At){const Bt=[],Nt=[];for(const qt of rr){const pr=qt.x+Tt.x,gr=qt.y+Tt.y,Pr=bF(pr,gr,kt,it,at,Mt,St,ar);Pt[0]=pr,Pt[1]=gr,Pt[2]=Pr.base,Pt[3]=1,Bi(Pt,Pt,Xe),Pt[3]=Math.max(Pt[3],1e-5);const Ar=new wp(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);Pt[0]=pr,Pt[1]=gr,Pt[2]=Pr.top,Pt[3]=1,Bi(Pt,Pt,Xe),Pt[3]=Math.max(Pt[3],1e-5);const Qr=new wp(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);Bt.push(Ar),Nt.push(Qr)}Kt.push(Bt),_t.push(Nt)}return[Kt,_t]}(Me,Ae,ke,Le,Be,st,Ge,ft,wt):function(At,kt,it,Tt,Xe){const at=[],Mt=[],St=Xe[8]*kt,ar=Xe[9]*kt,Kt=Xe[10]*kt,_t=Xe[11]*kt,Pt=Xe[8]*it,rr=Xe[9]*it,Bt=Xe[10]*it,Nt=Xe[11]*it;for(const qt of At){const pr=[],gr=[];for(const Pr of qt){const Ar=Pr.x+Tt.x,Qr=Pr.y+Tt.y,Ur=Xe[0]*Ar+Xe[4]*Qr+Xe[12],Kn=Xe[1]*Ar+Xe[5]*Qr+Xe[13],_e=Xe[2]*Ar+Xe[6]*Qr+Xe[14],ve=Xe[3]*Ar+Xe[7]*Qr+Xe[15],ot=Ur+St,Rt=Kn+ar,zt=_e+Kt,Lt=Math.max(ve+_t,1e-5),Jt=Ur+Pt,yr=Kn+rr,Vr=_e+Bt,$r=Math.max(ve+Nt,1e-5);pr.push(new wp(ot/Lt,Rt/Lt,zt/Lt)),gr.push(new wp(Jt/$r,yr/$r,Vr/$r))}at.push(pr),Mt.push(gr)}return[at,Mt]}(Me,Ae,ke,Le,Be)}(y,d,R,j,k,_,Q,L,W,y.center.lat,l.tileID.canonical),he=l.queryGeometry;return function(fe,Me,Ae){let ke=1/0;ji(Ae,Me)&&(ke=xF(Ae,Me[0]));for(let Le=0;Le<Me.length;Le++){const Be=Me[Le],st=fe[Le];for(let Ge=0;Ge<Be.length-1;Ge++){const ft=Be[Ge],wt=[ft,Be[Ge+1],st[Ge+1],st[Ge],ft];Ei(Ae,wt)&&(ke=Math.min(ke,xF(Ae,wt)))}}return ke!==1/0&&ke}(ae,de,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends Zo{constructor(l,i,s,d){super(l,{layout:qF||(qF=new wi({visibility:new It($e.layout_building.visibility),"building-facade":new $t($e.layout_building["building-facade"]),"building-facade-floors":new $t($e.layout_building["building-facade-floors"]),"building-facade-window":new $t($e.layout_building["building-facade-window"]),"building-roof-shape":new $t($e.layout_building["building-roof-shape"]),"building-height":new $t($e.layout_building["building-height"]),"building-base":new $t($e.layout_building["building-base"])})),paint:HF||(HF=new wi({"building-opacity":new It($e.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new It($e.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new It($e.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new It($e.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new It($e.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new It($e.paint_building["building-vertical-scale"]),"building-cast-shadows":new It($e.paint_building["building-cast-shadows"]),"building-color":new $t($e.paint_building["building-color"]),"building-emissive-strength":new $t($e.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new It($e.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new It($e.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,s,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new GF(l)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}},line:class extends Zo{constructor(l,i,s,d){const f=r5();super(l,f,i,s,d),f.layout&&(this.layout=new rl(f.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof tp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,i){super.recalculate(l,i),this.paint._values["line-floorwidth"]=(()=>{if(J0)return J0;const s=r5();return J0=new aie(s.paint.properties["line-width"].specification),J0.useIntegerZoom=!0,J0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new zP(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,i,s){const d=e5(this);return{config:new da(this,{zoom:i,lut:s}),defines:d,overrideFog:!1}}queryRadius(l){const i=l,s=n5(_i("line-width",this,i),_i("line-gap-width",this,i)),d=_i("line-offset",this,i);return s/2+Math.abs(d)+Ia(this.paint.get("line-translate"))}queryIntersectsFeature(l,i,s,d,f,y){if(l.queryGeometry.isAboveHorizon)return!1;const _=Qu(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,l.pixelToTileUnitsFactor),S=l.pixelToTileUnitsFactor/2*n5(this.paint.get("line-width").evaluate(i,s),this.paint.get("line-gap-width").evaluate(i,s)),A=this.paint.get("line-offset").evaluate(i,s);return A&&(d=function(k,j){const R=[],L=new ut(0,0);for(let H=0;H<k.length;H++){const W=k[H],J=[];for(let Q=0;Q<W.length;Q++){const ae=W[Q],de=W[Q+1],he=Q===0?L:ae.sub(W[Q-1])._unit()._perp(),fe=Q===W.length-1?L:de.sub(ae)._unit()._perp(),Me=he._add(fe)._unit();Me._mult(1/(Me.x*fe.x+Me.y*fe.y)),J.push(Me._mult(j)._add(ae))}R.push(J)}return R}(d,A*l.pixelToTileUnitsFactor)),function(k,j,R){for(let L=0;L<j.length;L++){const H=j[L];if(k.length>=3){for(let W=0;W<H.length;W++)if(oi(k,H[W]))return!0}if(Do(k,H,R))return!0}return!1}(_,d,S)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:eT,background:class extends Zo{constructor(l,i,s,d){super(l,{layout:Z5||(Z5=new wi({visibility:new It($e.layout_background.visibility)})),paint:K5||(K5=new wi({"background-pitch-alignment":new It($e.paint_background["background-pitch-alignment"]),"background-color":new It($e.paint_background["background-color"]),"background-pattern":new It($e.paint_background["background-pattern"]),"background-opacity":new It($e.paint_background["background-opacity"]),"background-emissive-strength":new It($e.paint_background["background-emissive-strength"]),"background-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,s,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,i,s){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:eB,"raster-particle":aB,sky:class extends Zo{constructor(l,i,s,d){super(l,{layout:nB||(nB=new wi({visibility:new It($e.layout_sky.visibility)})),paint:iB||(iB=new wi({"sky-type":new It($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new It($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new It($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new It($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new It($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new ud($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new It($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new It($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new It($e.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,s,d),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=L0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(l,i){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),f=!d,y=l.style.light,_=y.properties.get("position");return f&&y.properties.get("anchor")==="viewport"&&Wr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?rM(_.azimuthal,90-_.polar,i):rM(d[0],90-d[1],i)}const s=this.paint.get("sky-gradient-center");return rM(s[0],90-s[1],i)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends Zo{constructor(l,i,s,d){super(l,{paint:oB||(oB=new wi({}))},i,null)}},model:class extends Zo{constructor(l,i,s,d){super(l,{layout:uB||(uB=new wi({visibility:new It($e.layout_model.visibility),"model-id":new $t($e.layout_model["model-id"])})),paint:hB||(hB=new wi({"model-opacity":new $t($e.paint_model["model-opacity"]),"model-rotation":new $t($e.paint_model["model-rotation"]),"model-scale":new $t($e.paint_model["model-scale"]),"model-translation":new $t($e.paint_model["model-translation"]),"model-color":new $t($e.paint_model["model-color"]),"model-color-mix-intensity":new $t($e.paint_model["model-color-mix-intensity"]),"model-type":new It($e.paint_model["model-type"]),"model-cast-shadows":new It($e.paint_model["model-cast-shadows"]),"model-receive-shadows":new It($e.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new It($e.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new $t($e.paint_model["model-emissive-strength"]),"model-roughness":new $t($e.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new $t($e.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new It($e.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new It($e.paint_model["model-front-cutoff"]),"model-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,s,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new iM(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof iT?Dt-1:0}queryIntersectsFeature(l,i,s,d,f,y){if(!this.modelManager)return!1;const _=this.modelManager,S=l.tile.getBucket(this);if(!(S&&S instanceof iM))return!1;for(const A in S.instancesPerModel){const k=S.instancesPerModel[A],j=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(k.idToFeaturesIndex.hasOwnProperty(j)){const R=k.features[k.idToFeaturesIndex[j]],L=_.getModel(A,this.scope);if(!L)return!1;let H=B();const W=new q(0,0),J=S.canonical;let Q=Number.MAX_VALUE;for(let ae=0;ae<R.instancedDataCount;++ae){const de=16*(R.instancedDataOffset+ae),he=k.instancedDataArray.float32,fe=[he[de+4],he[de+5],he[de+6]];gB(J,W,he[de],0|he[de+1]),zF(H,L,y,W,R.rotation,R.scale,fe,!1,!1,!1),y.projection.name==="globe"&&(H=OP(H,y));const Me=V([],y.projMatrix,H),Ae=l.queryGeometry,ke=LF(Ae.isPointQuery()?Ae.screenBounds:Ae.screenGeometry,y,Me,L.aabb);ke!=null&&(Q=Math.min(ke,Q))}return Q!==Number.MAX_VALUE&&Q}}return!1}_handleOverridablePaintPropertyUpdate(l,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const i=this._transitionablePaint._values[l];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof Hc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Zo{constructor(l,i,s,d){super(l,{layout:HN||(HN=new wi({"clip-layer-types":new It($e.layout_clip["clip-layer-types"]),"clip-layer-scope":new It($e.layout_clip["clip-layer-scope"])})),paint:WN||(WN=new wi({}))},i,s,d)}recalculate(l,i){super.recalculate(l,i)}createBucket(l){return new ZN(l)}is3D(l){return!0}}},aM=new Tn(0,0,0),sM={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},lM={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},oT={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},uoe={PAINT_ORDER_FILL_AND_STROKE:1},hx={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},yB={MASK_TYPE_LUMINANCE:1};function hoe(l,i,s){l===1&&i.icons.push(function(d,f){return function(y){if(y.usvg_tree.height||(y.usvg_tree.height=y.usvg_tree.width),!y.metadata)return y;const{metadata:_}=y;if(_.content_area){const{content_area:S}=_;S.top==null&&(S.top=S.left),S.width==null&&(S.width=y.usvg_tree.width),S.height==null&&(S.height=S.width)}return _.stretch_x&&_.stretch_x.length&&_B(_,"x"),_.stretch_y&&_.stretch_y.length&&_B(_,"y"),y}(d.readFields(doe,{name:void 0},f))}(s,s.readVarint()+s.pos))}function _B(l,i){const s=[],d=l[`stretch_${i}`];let f=null;for(let y=0;y<d.length;y++)f===null?f=s.length===0?d[0]:s[s.length-1][1]+d[y]:(s.push([f,f+d[y]]),f=null);l[`stretch_${i}_areas`]=s}function doe(l,i,s){l===1?i.name=s.readString():l===2?i.metadata=function(d,f){return d.readFields(foe,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},f)}(s,s.readVarint()+s.pos):l===3&&(i.usvg_tree=function(d,f){return d.readFields(goe,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},f)}(s,s.readVarint()+s.pos),i.data="usvg_tree")}function foe(l,i,s){l===1?i.stretch_x=s.readPackedVarint():l===2?i.stretch_y=s.readPackedVarint():l===3?i.content_area=function(d,f){return d.readFields(poe,{left:0},f)}(s,s.readVarint()+s.pos):l===4&&i.variables.push(function(d,f){return d.readFields(moe,{name:void 0},f)}(s,s.readVarint()+s.pos))}function poe(l,i,s){l===1?i.left=s.readVarint():l===2?i.width=s.readVarint():l===3?i.top=s.readVarint():l===4&&(i.height=s.readVarint())}function moe(l,i,s){l===1?i.name=s.readString():l===2&&(i.rgb_color=lT(s.readVarint()),i.value="rgb_color")}function goe(l,i,s){l===1?i.width=i.height=s.readVarint():l===2?i.height=s.readVarint():l===3?i.children.push(aT(s,s.readVarint()+s.pos)):l===4?i.linear_gradients.push(function(d,f){return d.readFields(Soe,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},f)}(s,s.readVarint()+s.pos)):l===5?i.radial_gradients.push(function(d,f){return d.readFields(Eoe,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},f)}(s,s.readVarint()+s.pos)):l===7?i.clip_paths.push(function(d,f){return d.readFields(Aoe,{children:[]},f)}(s,s.readVarint()+s.pos)):l===8&&i.masks.push(function(d,f){const y=d.readFields(koe,{left:0,width:20,mask_type:yB.MASK_TYPE_LUMINANCE,children:[]},f);return y.height==null&&(y.height=y.width),y.top==null&&(y.top=y.left),y}(s,s.readVarint()+s.pos))}function aT(l,i){return l.readFields(yoe,{},i)}function yoe(l,i,s){l===1?(i.group=function(d,f){return d.readFields(_oe,{opacity:255,children:[]},f)}(s,s.readVarint()+s.pos),i.node="group"):l===2&&(i.path=function(d,f){return d.readFields(xoe,{paint_order:1,commands:[],step:1,diffs:[],rule:sM.PATH_RULE_NON_ZERO},f)}(s,s.readVarint()+s.pos),i.node="path")}function _oe(l,i,s){l===1?i.transform=sT(s,s.readVarint()+s.pos):l===2?i.opacity=s.readVarint():l===5?i.clip_path_idx=s.readVarint():l===6?i.mask_idx=s.readVarint():l===7&&i.children.push(aT(s,s.readVarint()+s.pos))}function sT(l,i){return l.readFields(voe,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function voe(l,i,s){l===1?i.sx=s.readFloat():l===2?i.ky=s.readFloat():l===3?i.kx=s.readFloat():l===4?i.sy=s.readFloat():l===5?i.tx=s.readFloat():l===6&&(i.ty=s.readFloat())}function xoe(l,i,s){l===1?i.fill=function(d,f){return d.readFields(boe,{rgb_color:aM,paint:"rgb_color",opacity:255},f)}(s,s.readVarint()+s.pos):l===2?i.stroke=function(d,f){return d.readFields(woe,{rgb_color:aM,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},f)}(s,s.readVarint()+s.pos):l===3?i.paint_order=s.readVarint():l===5?s.readPackedVarint(i.commands):l===6?i.step=s.readFloat():l===7?s.readPackedSVarint(i.diffs):l===8&&(i.rule=s.readVarint())}function boe(l,i,s){l===1?(i.rgb_color=lT(s.readVarint()),i.paint="rgb_color"):l===2?(i.linear_gradient_idx=s.readVarint(),i.paint="linear_gradient_idx"):l===3?(i.radial_gradient_idx=s.readVarint(),i.paint="radial_gradient_idx"):l===5&&(i.opacity=s.readVarint())}function lT(l){return new Tn((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function woe(l,i,s){l===1?(i.rgb_color=lT(s.readVarint()),i.paint="rgb_color"):l===2?(i.linear_gradient_idx=s.readVarint(),i.paint="linear_gradient_idx"):l===3?(i.radial_gradient_idx=s.readVarint(),i.paint="radial_gradient_idx"):l===5?s.readPackedFloat(i.dasharray):l===6?i.dashoffset=s.readFloat():l===7?i.miterlimit=s.readFloat():l===8?i.opacity=s.readVarint():l===9?i.width=s.readFloat():l===10?i.linecap=s.readVarint():l===11&&(i.linejoin=s.readVarint())}function Soe(l,i,s){l===1?i.transform=sT(s,s.readVarint()+s.pos):l===2?i.spread_method=s.readVarint():l===3?i.stops.push(vB(s,s.readVarint()+s.pos)):l===4?i.x1=s.readFloat():l===5?i.y1=s.readFloat():l===6?i.x2=s.readFloat():l===7&&(i.y2=s.readFloat())}function vB(l,i){return l.readFields(Toe,{offset:0,opacity:255,rgb_color:aM},i)}function Toe(l,i,s){l===1?i.offset=s.readFloat():l===2?i.opacity=s.readVarint():l===3&&(i.rgb_color=lT(s.readVarint()))}function Eoe(l,i,s){l===1?i.transform=sT(s,s.readVarint()+s.pos):l===2?i.spread_method=s.readVarint():l===3?i.stops.push(vB(s,s.readVarint()+s.pos)):l===4?i.cx=s.readFloat():l===5?i.cy=s.readFloat():l===6?i.r=s.readFloat():l===7?i.fx=s.readFloat():l===8?i.fy=s.readFloat():l===9&&(i.fr=s.readFloat())}function Aoe(l,i,s){l===1?i.transform=sT(s,s.readVarint()+s.pos):l===2?i.clip_path_idx=s.readVarint():l===3&&i.children.push(aT(s,s.readVarint()+s.pos))}function koe(l,i,s){l===1?i.left=i.top=s.readFloat():l===2?i.width=i.height=s.readFloat():l===3?i.top=s.readFloat():l===4?i.height=s.readFloat():l===5?i.mask_type=s.readVarint():l===6?i.mask_idx=s.readVarint():l===7&&i.children.push(aT(s,s.readVarint()+s.pos))}class Coe{static calculate(i={},s=[]){const d=new Map,f=new Map;if(Object.keys(i).length===0)return d;s.forEach(y=>{f.set(y.name,y.rgb_color||new Tn(0,0,0))});for(const[y,_]of Object.entries(i))f.has(y)?d.set(f.get(y).toString(),_):console.warn(`Ignoring unknown image variable "${y}"`);return d}}function ey(l,i=255,s){const d=i/255,f=l.toString(),y=s.has(f)?s.get(f).clone():l.clone();return y.a*=d,y.toString()}function dx(l,i){if(!$m()){const s=document.createElement("canvas");return s.width=l,s.height=i,s}return new OffscreenCanvas(l,i)}function Poe(l,i){const s=Coe.calculate(i.params,l.metadata?l.metadata.variables:[]),d=l.usvg_tree,f=d.width,y=d.height,_=i.transform?i.transform:new DOMMatrix,S=Math.max(1,Math.round(f*_.a)),A=Math.max(1,Math.round(y*_.d)),k=new DOMMatrix([S/f,0,0,A/y,0,0]),j=dx(S,A).getContext("2d");return cM(j,k,d,d,s),j.getImageData(0,0,S,A)}function cM(l,i,s,d,f){for(const y of d.children)xB(l,i,s,y,f)}function xB(l,i,s,d,f){d.group?(l.save(),function(y,_,S,A,k){const j=A.mask_idx!=null?S.masks[A.mask_idx]:null,R=A.clip_path_idx!=null?S.clip_paths[A.clip_path_idx]:null;if(A.transform&&(_=ty(A.transform).preMultiplySelf(_)),!function(W,J,Q){return W.opacity!==255||J||Q}(A,R!=null,j!=null))return void cM(y,_,S,A,k);const L=dx(y.canvas.width,y.canvas.height),H=L.getContext("2d");cM(H,_,S,A,k),R&&kB(H,_,S,R),j&&CB(H,_,S,j,k),y.globalAlpha=A.opacity/255,y.drawImage(L,0,0)}(l,i,s,d.group,f),l.restore()):d.path&&(l.save(),function(y,_,S,A,k){y.setTransform(_),A.paint_order===uoe.PAINT_ORDER_FILL_AND_STROKE?(bB(y,S,A,k),SB(y,S,A,k)):(SB(y,S,A,k),bB(y,S,A,k))}(l,i,s,d.path,f),l.restore())}function bB(l,i,s,d){const f=s.fill;if(!f)return;const y=f.opacity/255;switch(l.save(),l.beginPath(),PB(s,l),f.paint){case"rgb_color":l.fillStyle=ey(f.rgb_color,f.opacity,d);break;case"linear_gradient_idx":{const _=i.linear_gradients[f.linear_gradient_idx];_.transform&&l.setTransform(ty(_.transform).preMultiplySelf(l.getTransform())),l.fillStyle=TB(l,_,y,d);break}case"radial_gradient_idx":{const _=i.radial_gradients[f.radial_gradient_idx];_.transform&&l.setTransform(ty(_.transform).preMultiplySelf(l.getTransform())),l.fillStyle=EB(l,_,y,d)}}l.fill(wB(s)),l.restore()}function wB(l){return l.rule===sM.PATH_RULE_NON_ZERO?"nonzero":l.rule===sM.PATH_RULE_EVEN_ODD?"evenodd":void 0}function SB(l,i,s,d){const f=s.stroke;if(!f)return;const y=MB(s);l.lineWidth=f.width,l.miterLimit=f.miterlimit,l.setLineDash(f.dasharray),l.lineDashOffset=f.dashoffset;const _=f.opacity/255;switch(f.paint){case"rgb_color":l.strokeStyle=ey(f.rgb_color,f.opacity,d);break;case"linear_gradient_idx":l.strokeStyle=TB(l,i.linear_gradients[f.linear_gradient_idx],_,d,!0);break;case"radial_gradient_idx":l.strokeStyle=EB(l,i.radial_gradients[f.radial_gradient_idx],_,d,!0)}switch(f.linejoin){case oT.LINE_JOIN_MITER_CLIP:case oT.LINE_JOIN_MITER:l.lineJoin="miter";break;case oT.LINE_JOIN_ROUND:l.lineJoin="round";break;case oT.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(f.linecap){case lM.LINE_CAP_BUTT:l.lineCap="butt";break;case lM.LINE_CAP_ROUND:l.lineCap="round";break;case lM.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(y)}function TB(l,i,s,d,f=!1){if(i.stops.length===1){const L=i.stops[0];return ey(L.rgb_color,L.opacity*s,d)}const{x1:y,y1:_,x2:S,y2:A}=i;let k=new DOMPoint(y,_),j=new DOMPoint(S,A);if(f){const L=ty(i.transform);k=L.transformPoint(k),j=L.transformPoint(j)}const R=l.createLinearGradient(k.x,k.y,j.x,j.y);for(const L of i.stops)R.addColorStop(L.offset,ey(L.rgb_color,L.opacity*s,d));return R}function EB(l,i,s,d,f=!1){if(i.stops.length===1){const ae=i.stops[0];return ey(ae.rgb_color,ae.opacity*s,d)}const y=ty(i.transform),{fx:_,fy:S,fr:A,cx:k,cy:j,r:R}=i;let L=new DOMPoint(_,S),H=new DOMPoint(k,j),W=A,J=R;if(f){L=y.transformPoint(L),H=y.transformPoint(H);const ae=(y.a+y.d)/2;W=A*ae,J=i.r*ae}const Q=l.createRadialGradient(L.x,L.y,W,H.x,H.y,J);for(const ae of i.stops)Q.addColorStop(ae.offset,ey(ae.rgb_color,ae.opacity*s,d));return Q}function AB(l,i,s,d){const f=d.transform?ty(d.transform).preMultiplySelf(i):i,y=dx(l.canvas.width,l.canvas.height),_=y.getContext("2d");for(const A of d.children)if(A.group)AB(_,f,s,A.group);else if(A.path){const k=A.path,j=new Path2D;j.addPath(MB(k),f),_.fill(j,wB(k))}const S=d.clip_path_idx!=null?s.clip_paths[d.clip_path_idx]:null;S&&kB(_,f,s,S),l.globalCompositeOperation="source-over",l.drawImage(y,0,0)}function kB(l,i,s,d){const f=dx(l.canvas.width,l.canvas.height);AB(f.getContext("2d"),i,s,d),l.globalCompositeOperation="destination-in",l.drawImage(f,0,0)}function CB(l,i,s,d,f){if(d.children.length===0)return;const y=d.mask_idx!=null?s.masks[d.mask_idx]:null;y&&CB(l,i,s,y,f);const _=l.canvas.width,S=l.canvas.height,A=dx(_,S),k=A.getContext("2d"),j=d.width,R=d.height,L=d.left,H=d.top,W=new Path2D,J=new Path2D;J.rect(L,H,j,R),W.addPath(J,i),k.clip(W);for(const de of d.children)xB(k,i,s,de,f);const Q=k.getImageData(0,0,_,S),ae=Q.data;if(d.mask_type===yB.MASK_TYPE_LUMINANCE)for(let de=0;de<ae.length;de+=4)ae[de+3]=ae[de+3]/255*(.2126*ae[de]+.7152*ae[de+1]+.0722*ae[de+2]);k.putImageData(Q,0,0),l.globalCompositeOperation="destination-in",l.drawImage(A,0,0)}function ty(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function PB(l,i){const s=l.step;let d=l.diffs[0]*s,f=l.diffs[1]*s;i.moveTo(d,f);for(let y=0,_=2;y<l.commands.length;y++)switch(l.commands[y]){case hx.PATH_COMMAND_MOVE:d+=l.diffs[_++]*s,f+=l.diffs[_++]*s,i.moveTo(d,f);break;case hx.PATH_COMMAND_LINE:d+=l.diffs[_++]*s,f+=l.diffs[_++]*s,i.lineTo(d,f);break;case hx.PATH_COMMAND_QUAD:{const S=d+l.diffs[_++]*s,A=f+l.diffs[_++]*s;d=S+l.diffs[_++]*s,f=A+l.diffs[_++]*s,i.quadraticCurveTo(S,A,d,f);break}case hx.PATH_COMMAND_CUBIC:{const S=d+l.diffs[_++]*s,A=f+l.diffs[_++]*s,k=S+l.diffs[_++]*s,j=A+l.diffs[_++]*s;d=k+l.diffs[_++]*s,f=j+l.diffs[_++]*s,i.bezierCurveTo(S,A,k,j,d,f);break}case hx.PATH_COMMAND_CLOSE:i.closePath()}return i}function MB(l){return PB(l,new Path2D)}class cT{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const s=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,s),s}put(i,s){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,s)}delete(i){this.cache.delete(i)}}Wt(cT,"LRUCache");class uM{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new Lo(i,i.data)}getFromCache(i,s,d){return this.cacheMap.has(d)||this.cacheMap.set(d,new cT(150)),this.cacheMap.get(d).get(fd(i.toString(),s))}setInCache(i,s,d,f){this.cacheDependenciesMap.has(f)||this.cacheDependenciesMap.set(f,new Map),this.cacheMap.has(f)||this.cacheMap.set(f,new cT(150));const y=this.cacheDependenciesMap.get(f),_=fd(i.id.toString(),d);y.get(_)||y.set(_,new Set);const S=this.cacheMap.get(f),A=i.toString();y.get(_).add(A),S.put(fd(i.toString(),d),s)}removeImagesFromCacheByIds(i,s,d=0){if(!this.cacheMap.has(d)||!this.cacheDependenciesMap.has(d))return;const f=this.cacheMap.get(d),y=this.cacheDependenciesMap.get(d);for(const _ of i){const S=fd(_.toString(),s);if(y.has(S)){for(const A of y.get(S))f.delete(A);y.delete(S)}}}rasterize(i,s,d,f,y=Poe){const _=this.getFromCache(i,d,f);if(_)return _.clone();const S=y(s.icon,i.options),A=uM._getImage(S);return this.setInCache(i,A,d,f),A.clone()}}class IB{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,s){const d=this.toIdx(i,s);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(i,s){return this.leaves[this.toIdx(i,s)]}toIdx(i,s){return s*this.size+i}}function OB(l,i,s,d){let f=0,y=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(d[_])<1e-15){if(s[_]<l[_]||s[_]>i[_])return null}else{const S=1/d[_];let A=(l[_]-s[_])*S,k=(i[_]-s[_])*S;if(A>k){const j=A;A=k,k=j}if(A>f&&(f=A),k<y&&(y=k),f>y)return null}return f}function jB(l,i,s,d,f,y,_,S,A,k,j){const R=d-l,L=f-i,H=y-s,W=_-l,J=S-i,Q=A-s,ae=j[1]*Q-j[2]*J,de=j[2]*W-j[0]*Q,he=j[0]*J-j[1]*W,fe=R*ae+L*de+H*he;if(Math.abs(fe)<1e-15)return null;const Me=1/fe,Ae=k[0]-l,ke=k[1]-i,Le=k[2]-s,Be=(Ae*ae+ke*de+Le*he)*Me;if(Be<0||Be>1)return null;const st=ke*H-Le*L,Ge=Le*R-Ae*H,ft=Ae*L-ke*R,wt=(j[0]*st+j[1]*Ge+j[2]*ft)*Me;return wt<0||Be+wt>1?null:(W*st+J*Ge+Q*ft)*Me}function RB(l,i,s){return(l-i)/(s-i)}function DB(l,i,s,d,f,y,_,S,A){const k=1<<s,j=y-d,R=_-f,L=(l+1)/k*j+d,H=(i+0)/k*R+f,W=(i+1)/k*R+f;S[0]=(l+0)/k*j+d,S[1]=H,A[0]=L,A[1]=W}class LB{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(y){const _=Math.ceil(Math.log2(y.dim/8)),S=[];let A=Math.ceil(Math.pow(2,_));const k=1/A,j=(H,W,J,Q,ae)=>{const de=Q?1:0,he=(H+1)*J-de,fe=W*J,Me=(W+1)*J-de;ae[0]=H*J,ae[1]=fe,ae[2]=he,ae[3]=Me};let R=new IB(A);const L=[];for(let H=0;H<A*A;H++){j(H%A,Math.floor(H/A),k,!1,L);const W=jd(L[0],L[1],y),J=jd(L[2],L[1],y),Q=jd(L[2],L[3],y),ae=jd(L[0],L[3],y);R.minimums.push(Math.min(W,J,Q,ae)),R.maximums.push(Math.max(W,J,Q,ae)),R.leaves.push(1)}for(S.push(R),A/=2;A>=1;A/=2){const H=S[S.length-1];R=new IB(A);for(let W=0;W<A*A;W++){j(W%A,Math.floor(W/A),2,!0,L);const J=H.getElevation(L[0],L[1]),Q=H.getElevation(L[2],L[1]),ae=H.getElevation(L[2],L[3]),de=H.getElevation(L[0],L[3]),he=H.isLeaf(L[0],L[1]),fe=H.isLeaf(L[2],L[1]),Me=H.isLeaf(L[2],L[3]),Ae=H.isLeaf(L[0],L[3]),ke=Math.min(J.min,Q.min,ae.min,de.min),Le=Math.max(J.max,Q.max,ae.max,de.max),Be=he&&fe&&Me&&Ae;R.maximums.push(Le),R.minimums.push(ke),R.leaves.push(Le-ke<=5&&Be?1:0)}S.push(R)}return S}(this.dem),d=s.length-1,f=s[d];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(s,0,0,d,0)}raycastRoot(i,s,d,f,y,_,S=1){return OB([i,s,-100],[d,f,this.maximums[0]*S],y,_)}raycast(i,s,d,f,y,_,S=1){if(!this.nodeCount)return null;const A=this.raycastRoot(i,s,d,f,y,_,S);if(A==null)return null;const k=[],j=[],R=[],L=[],H=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:W,t:J,nodex:Q,nodey:ae,depth:de}=H.pop();if(this.leaves[W]){DB(Q,ae,de,i,s,d,f,R,L);const fe=1<<de,Me=(Q+0)/fe,Ae=(Q+1)/fe,ke=(ae+0)/fe,Le=(ae+1)/fe,Be=jd(Me,ke,this.dem)*S,st=jd(Ae,ke,this.dem)*S,Ge=jd(Ae,Le,this.dem)*S,ft=jd(Me,Le,this.dem)*S,wt=jB(R[0],R[1],Be,L[0],R[1],st,L[0],L[1],Ge,y,_),xt=jB(L[0],L[1],Ge,R[0],L[1],ft,R[0],R[1],Be,y,_),At=Math.min(wt!==null?wt:Number.MAX_VALUE,xt!==null?xt:Number.MAX_VALUE);if(At!==Number.MAX_VALUE)return At;{const kt=ct([],y,_,J);if(zB(Be,st,ft,Ge,RB(kt[0],R[0],L[0]),RB(kt[1],R[1],L[1]))>=kt[2])return J}continue}let he=0;for(let fe=0;fe<this._siblingOffset.length;fe++){DB((Q<<1)+this._siblingOffset[fe][0],(ae<<1)+this._siblingOffset[fe][1],de+1,i,s,d,f,R,L),R[2]=-100,L[2]=this.maximums[this.childOffsets[W]+fe]*S;const Me=OB(R,L,y,_);if(Me!=null){const Ae=Me;k[fe]=Ae;let ke=!1;for(let Le=0;Le<he&&!ke;Le++)Ae>=k[j[Le]]&&(j.splice(Le,0,fe),ke=!0);ke||(j[he]=fe),he++}}for(let fe=0;fe<he;fe++){const Me=j[fe];H.push({idx:this.childOffsets[W]+Me,t:k[Me],nodex:(Q<<1)+this._siblingOffset[Me][0],nodey:(ae<<1)+this._siblingOffset[Me][1],depth:de+1})}}return null}_addNode(i,s,d){return this.minimums.push(i),this.maximums.push(s),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(i,s,d,f,y){if(i[f].isLeaf(s,d)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const _=f-1,S=i[_];let A=0,k=0;for(let j=0;j<this._siblingOffset.length;j++){const R=2*s+this._siblingOffset[j][0],L=2*d+this._siblingOffset[j][1],H=S.getElevation(R,L),W=S.isLeaf(R,L),J=this._addNode(H.min,H.max,W);W&&(A|=1<<j),k||(k=J)}for(let j=0;j<this._siblingOffset.length;j++)A&1<<j||this._construct(i,2*s+this._siblingOffset[j][0],2*d+this._siblingOffset[j][1],_,k+j)}}function zB(l,i,s,d,f,y){return lr(lr(l,s,y),lr(i,d,y),f)}function jd(l,i,s){const d=s.dim,f=xe(l*d-.5,0,d-1),y=xe(i*d-.5,0,d-1),_=Math.floor(f),S=Math.floor(y),A=Math.min(_+1,d-1),k=Math.min(S+1,d-1);return zB(s.get(_,S),s.get(A,S),s.get(_,k),s.get(A,k),f-_,y-S)}const Moe={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Ioe(l,i,s){return(256*l*256+256*i+s)/10-1e4}function Ooe(l,i,s){return 256*l+i+s/256-32768}class uT{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,s,d,f=!1){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void Wr(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const y=this.dim=s.height-2,_=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let A=0;A<y;A++)_[this._idx(-1,A)]=_[this._idx(0,A)],_[this._idx(y,A)]=_[this._idx(y-1,A)],_[this._idx(A,-1)]=_[this._idx(A,0)],_[this._idx(A,y)]=_[this._idx(A,y-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(y,-1)]=_[this._idx(y-1,0)],_[this._idx(-1,y)]=_[this._idx(0,y-1)],_[this._idx(y,y)]=_[this._idx(y-1,y-1)]}const S=d==="terrarium"?Ooe:Ioe;for(let A=0;A<_.length;++A){const k=4*A;this.floatView[A]=S(this.pixels[k],this.pixels[k+1],this.pixels[k+2])}this._timestamp=Qs.now()}_buildQuadTree(){this._tree=new LB(this)}get(i,s,d=!1){d&&(i=xe(i,-1,this.dim),s=xe(s,-1,this.dim));const f=this._idx(i,s);return this.floatView[f]}set(i,s,d){const f=this._idx(i,s),y=this.floatView[f];return this.floatView[f]=d,d-y}static getUnpackVector(i){return Moe[i]}_idx(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)}static pack(i,s){const d=[0,0,0,0],f=uT.getUnpackVector(s);let y=Math.floor((i+f[3])/f[2]);return d[2]=y%256,y=Math.floor(y/256),d[1]=y%256,y=Math.floor(y/256),d[0]=y,d}getPixels(){return new ON({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,s,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,y=s*this.dim+this.dim,_=d*this.dim,S=d*this.dim+this.dim;switch(s){case-1:f=y-1;break;case 1:y=f+1}switch(d){case-1:_=S-1;break;case 1:S=_+1}const A=-s*this.dim,k=-d*this.dim;for(let j=_;j<S;j++)for(let R=f;R<y;R++){const L=4*this._idx(R,j),H=4*this._idx(R+A,j+k);this.pixels[L+0]=i.pixels[H+0],this.pixels[L+1]=i.pixels[H+1],this.pixels[L+2]=i.pixels[H+2],this.pixels[L+3]=i.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function joe(l,i,s){l===1?i.headerLength=s.readFixed32():l===2?i.x=s.readVarint():l===3?i.y=s.readVarint():l===4?i.z=s.readVarint():l===5&&i.layers.push(function(d,f){return d.readFields(Noe,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(s,s.readVarint()+s.pos))}function Roe(l,i,s){l===1?(i.delta_filter=function(d,f){return d.readFields(Doe,{blockSize:0},f)}(s,s.readVarint()+s.pos),i.filter="delta_filter"):l===2?(s.readVarint(),i.filter="zigzag_filter"):l===3?(s.readVarint(),i.filter="bitshuffle_filter"):l===4&&(s.readVarint(),i.filter="byteshuffle_filter")}function Doe(l,i,s){l===1&&(i.blockSize=s.readVarint())}function Loe(l,i,s){l===1?(s.readVarint(),i.codec="gzip_data"):l===2?(s.readVarint(),i.codec="jpeg_image"):l===3?(s.readVarint(),i.codec="webp_image"):l===4&&(s.readVarint(),i.codec="png_image")}function zoe(l,i,s){let d=0,f=0;l===1?i.firstByte=s.readFixed64():l===2?i.lastByte=s.readFixed64():l===3?i.filters.push(function(y,_){return y.readFields(Roe,{},_)}(s,s.readVarint()+s.pos)):l===4?i.codec=function(y,_){return y.readFields(Loe,{},_)}(s,s.readVarint()+s.pos):l===5?f=s.readFloat():l===6?d=s.readFloat():l===7?i.bands.push(s.readString()):l===8?i.offset=s.readDouble():l===9&&(i.scale=s.readDouble()),i.offset===0&&(i.offset=f),i.scale===0&&(i.scale=d)}function Noe(l,i,s){l===1?i.version=s.readVarint():l===2?i.name=s.readString():l===3?i.units=s.readString():l===4?i.tileSize=s.readVarint():l===5?i.buffer=s.readVarint():l===6?i.pixelFormat=s.readVarint():l===7&&i.dataIndex.push(function(d,f){return d.readFields(zoe,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(s,s.readVarint()+s.pos))}function Foe(l,i,s){if(l===2)(function(d,f,y){d.readFields(Boe,y,f)})(s,s.readVarint()+s.pos,i);else if(l===3)throw new Error("Not implemented")}function Boe(l,i,s){if(l===1){let d=0;const f=s.readVarint()+s.pos;for(;s.pos<f;)i[d++]=s.readVarint()}}function Uoe(l,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let s=i[3];for(let d=2;d>=1;d--){const f=d===1?1:0,y=d===2?1:0;for(let _=0;_<i[0];_++){const S=i[1]*_;for(let A=f;A<i[1];A++){const k=i[2]*(A+S);for(let j=y;j<i[2];j++){const R=i[3]*(j+k);for(let L=0;L<i[3];L++){const H=R+L;l[H]+=l[H-s]}}}}s*=i[d]}return l}function Voe(l){for(let i=0,s=l.length;i<s;i++)l[i]=l[i]>>>1^-(1&l[i]);return l}function $oe(l,i){switch(i){case"uint32":return l;case"uint16":for(let s=0;s<l.length;s+=2){const d=l[s],f=l[s+1];l[s]=(240&d)>>4|(61440&d)>>8|(240&f)<<4|61440&f,l[s+1]=15&d|(3840&d)>>4|(15&f)<<8|(3840&f)<<4}return l;case"uint8":for(let s=0;s<l.length;s+=4){const d=l[s],f=l[s+1],y=l[s+2],_=l[s+3];l[s+0]=(192&d)>>6|(192&f)>>4|(192&y)>>2|192&_,l[s+1]=(48&d)>>4|(48&f)>>2|48&y|(48&_)<<2,l[s+2]=(12&d)>>2|12&f|(12&y)<<2|(12&_)<<4,l[s+3]=3&d|(3&f)<<2|(3&y)<<4|(3&_)<<6}return l;default:throw new Error(`Invalid pixel format, "${i}"`)}}Wt(uT,"DEMData"),Wt(LB,"DemMinMaxQuadTree",{omit:["dem"]});var nl=Uint8Array,fx=Uint16Array,Goe=Int32Array,NB=new nl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),FB=new nl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qoe=new nl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),BB=function(l,i){for(var s=new fx(31),d=0;d<31;++d)s[d]=i+=1<<l[d-1];var f=new Goe(s[30]);for(d=1;d<30;++d)for(var y=s[d];y<s[d+1];++y)f[y]=y-s[d]<<5|d;return{b:s,r:f}},UB=BB(NB,2),VB=UB.b,Hoe=UB.r;VB[28]=258,Hoe[258]=28;for(var Woe=BB(FB,0).b,$B=new fx(32768),ro=0;ro<32768;++ro){var ry=(43690&ro)>>1|(21845&ro)<<1;$B[ro]=((65280&(ry=(61680&(ry=(52428&ry)>>2|(13107&ry)<<2))>>4|(3855&ry)<<4))>>8|(255&ry)<<8)>>1}var px=function(l,i,s){for(var d=l.length,f=0,y=new fx(i);f<d;++f)l[f]&&++y[l[f]-1];var _,S=new fx(i);for(f=1;f<i;++f)S[f]=S[f-1]+y[f-1]<<1;_=new fx(1<<i);var A=15-i;for(f=0;f<d;++f)if(l[f])for(var k=f<<4|l[f],j=i-l[f],R=S[l[f]-1]++<<j,L=R|(1<<j)-1;R<=L;++R)_[$B[R]>>A]=k;return _},mx=new nl(288);for(ro=0;ro<144;++ro)mx[ro]=8;for(ro=144;ro<256;++ro)mx[ro]=9;for(ro=256;ro<280;++ro)mx[ro]=7;for(ro=280;ro<288;++ro)mx[ro]=8;var GB=new nl(32);for(ro=0;ro<32;++ro)GB[ro]=5;var Zoe=px(mx,9),Koe=px(GB,5),hM=function(l){for(var i=l[0],s=1;s<l.length;++s)l[s]>i&&(i=l[s]);return i},ec=function(l,i,s){var d=i/8|0;return(l[d]|l[d+1]<<8)>>(7&i)&s},dM=function(l,i){var s=i/8|0;return(l[s]|l[s+1]<<8|l[s+2]<<16)>>(7&i)},Xoe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],tc=function(l,i,s){var d=new Error(i||Xoe[l]);if(d.code=l,Error.captureStackTrace&&Error.captureStackTrace(d,tc),!s)throw d;return d},Yoe=new nl(0),Joe=typeof TextDecoder<"u"&&new TextDecoder;try{Joe.decode(Yoe,{stream:!0})}catch{}const Qoe={gzip_data:"gzip"};class wl extends Error{constructor(i){super(i),this.name="MRTError"}}const eae={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},qB={uint32:1,uint16:2,uint8:4},tae={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let fM;class hT{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const s=this.layers[i];if(!s)throw new wl(`Layer '${i}' not found`);return s}getHeaderLength(i){const s=new Uint8Array(i),d=new DataView(i);if(s[0]!==13)throw new wl("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(i){const s=new Uint8Array(i),d=this.getHeaderLength(i);if(s.length<d)throw new wl(`Expected header with length >= ${d} but got buffer of length ${s.length}`);const f=new fM(s.subarray(0,d)).readFields(joe,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new wl(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const y of f.layers)this.layers[y.name]=new HB(y,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const s=[],d=this.getLayer(i.layerName);for(let f of i.blockIndices){const y=d.dataIndex[f],_=y.firstByte-i.firstByte,S=y.lastByte-i.firstByte;if(d._blocksInProgress.has(f))continue;const A={layerName:d.name,firstByte:_,lastByte:S,pixelFormat:d.pixelFormat,blockIndex:f,blockShape:[y.bands.length].concat(d.bandShape),buffer:d.buffer,codec:y.codec.codec,filters:y.filters.map(k=>k.filter)};d._blocksInProgress.add(f),s.push(A)}return new WB(s,()=>{s.forEach(f=>d._blocksInProgress.delete(f.blockIndex))},(f,y)=>{if(s.forEach(_=>d._blocksInProgress.delete(_.blockIndex)),f)throw f;y.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class HB{constructor({version:i,name:s,units:d,tileSize:f,pixelFormat:y,buffer:_,dataIndex:S},A){if(this.version=i,this.version!==1)throw new wl(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=s,this.units=d,this.tileSize=f,this.buffer=_,this.pixelFormat=eae[y],this.dataIndex=S,this.bandShape=[f+2*_,f+2*_,qB[this.pixelFormat]],this._decodedBlocks=new cT(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return qB[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const s=i.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,i.data)}getBlockForBand(i){let s=0;switch(typeof i){case"string":for(const[d,f]of this.dataIndex.entries()){for(const[y,_]of f.bands.entries())if(_===i)return{bandIndex:s+y,blockIndex:d,blockBandIndex:y};s+=f.bands.length}break;case"number":for(const[d,f]of this.dataIndex.entries()){if(i>=s&&i<s+f.bands.length)return{bandIndex:i,blockIndex:d,blockBandIndex:i-s};s+=f.bands.length}break;default:throw new wl(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let s=1/0,d=-1/0;const f=[],y=new Set;for(const _ of i){const{blockIndex:S}=this.getBlockForBand(_);if(S<0)throw new wl(`Invalid band: ${JSON.stringify(_)}`);const A=this.dataIndex[S];f.includes(S)||f.push(S),y.add(S),s=Math.min(s,A.firstByte),d=Math.max(d,A.lastByte)}if(y.size>this.cacheSize)throw new wl(`Number of blocks to decode (${y.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:d,blockIndices:f}}hasBand(i){const{blockIndex:s}=this.getBlockForBand(i);return s>=0}hasDataForBand(i){const{blockIndex:s}=this.getBlockForBand(i);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(i){const{blockIndex:s,blockBandIndex:d}=this.getBlockForBand(i);if(s<0)throw new wl(`Band not found: ${JSON.stringify(i)}`);const f=this._decodedBlocks.get(s.toString());if(!f)throw new wl(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const y=this.dataIndex[s],_=this.bandShape.reduce((k,j)=>k*j,1),S=d*_,A=f.subarray(S,S+_);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:y.offset,scale:y.scale}}}hT.setPbf=function(l){fM=l};class WB{constructor(i,s,d){this.tasks=i,this._onCancel=s,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,s){this._finalized||(this._onComplete(i,s),this._finalized=!0)}}hT.performDecoding=function(l,i){const s=new Uint8Array(l);return Promise.all(i.tasks.map(d=>{const{layerName:f,firstByte:y,lastByte:_,pixelFormat:S,blockShape:A,blockIndex:k,filters:j,codec:R}=d,L=s.subarray(y,_+1),H=new Uint32Array(A[0]*A[1]*A[2]);let W;if(R!=="gzip_data")throw new wl(`Unhandled codec: ${R}`);return W=function(J,Q){if(!globalThis.DecompressionStream&&Q==="gzip_data")return Promise.resolve(((fe=function(ke){ke[0]==31&&ke[1]==139&&ke[2]==8||tc(6,"invalid gzip data");var Le=ke[3],Be=10;4&Le&&(Be+=2+(ke[10]|ke[11]<<8));for(var st=(Le>>3&1)+(Le>>4&1);st>0;st-=!ke[Be++]);return Be+(2&Le)}(he=J))+8>he.length&&tc(6,"invalid gzip data"),function(ke,Le,Be,st){var Ge=ke.length;if(!Ge||Le.f&&!Le.l)return Be||new nl(0);var ft=!Be,wt=ft||Le.i!=2,xt=Le.i;ft&&(Be=new nl(3*Ge));var At,kt,it=function(di){var Jn=Be.length;if(di>Jn){var Gn=new nl(Math.max(2*Jn,di));Gn.set(Be),Be=Gn}},Tt=Le.f||0,Xe=Le.p||0,at=Le.b||0,Mt=Le.l,St=Le.d,ar=Le.m,Kt=Le.n,_t=8*Ge;do{if(!Mt){Tt=ec(ke,Xe,1);var Pt=ec(ke,Xe+1,3);if(Xe+=3,!Pt){var rr=ke[(_e=4+((Xe+7)/8|0))-4]|ke[_e-3]<<8,Bt=_e+rr;if(Bt>Ge){xt&&tc(0);break}wt&&it(at+rr),Be.set(ke.subarray(_e,Bt),at),Le.b=at+=rr,Le.p=Xe=8*Bt,Le.f=Tt;continue}if(Pt==1)Mt=Zoe,St=Koe,ar=9,Kt=5;else if(Pt==2){var Nt=ec(ke,Xe,31)+257,qt=ec(ke,Xe+10,15)+4,pr=Nt+ec(ke,Xe+5,31)+1;Xe+=14;for(var gr=new nl(pr),Pr=new nl(19),Ar=0;Ar<qt;++Ar)Pr[qoe[Ar]]=ec(ke,Xe+3*Ar,7);Xe+=3*qt;var Qr=hM(Pr),Ur=(1<<Qr)-1,Kn=px(Pr,Qr);for(Ar=0;Ar<pr;){var _e,ve=Kn[ec(ke,Xe,Ur)];if(Xe+=15&ve,(_e=ve>>4)<16)gr[Ar++]=_e;else{var ot=0,Rt=0;for(_e==16?(Rt=3+ec(ke,Xe,3),Xe+=2,ot=gr[Ar-1]):_e==17?(Rt=3+ec(ke,Xe,7),Xe+=3):_e==18&&(Rt=11+ec(ke,Xe,127),Xe+=7);Rt--;)gr[Ar++]=ot}}var zt=gr.subarray(0,Nt),Lt=gr.subarray(Nt);ar=hM(zt),Kt=hM(Lt),Mt=px(zt,ar),St=px(Lt,Kt)}else tc(1);if(Xe>_t){xt&&tc(0);break}}wt&&it(at+131072);for(var Jt=(1<<ar)-1,yr=(1<<Kt)-1,Vr=Xe;;Vr=Xe){var $r=(ot=Mt[dM(ke,Xe)&Jt])>>4;if((Xe+=15&ot)>_t){xt&&tc(0);break}if(ot||tc(2),$r<256)Be[at++]=$r;else{if($r==256){Vr=Xe,Mt=null;break}var jr=$r-254;$r>264&&(jr=ec(ke,Xe,(1<<(Ir=NB[Ar=$r-257]))-1)+VB[Ar],Xe+=Ir);var jn=St[dM(ke,Xe)&yr],gi=jn>>4;if(jn||tc(3),Xe+=15&jn,Lt=Woe[gi],gi>3){var Ir=FB[gi];Lt+=dM(ke,Xe)&(1<<Ir)-1,Xe+=Ir}if(Xe>_t){xt&&tc(0);break}wt&&it(at+131072);var ti=at+jr;if(at<Lt){var $n=0-Lt,An=Math.min(Lt,ti);for($n+at<0&&tc(3);at<An;++at)Be[at]=(void 0)[$n+at]}for(;at<ti;++at)Be[at]=Be[at-Lt]}}Le.l=Mt,Le.p=Vr,Le.b=at,Le.f=Tt,Mt&&(Tt=1,Le.m=ar,Le.d=St,Le.n=Kt)}while(!Tt);return at!=Be.length&&ft?(At=Be,((kt=at)==null||kt>At.length)&&(kt=At.length),new nl(At.subarray(0,kt))):Be.subarray(0,at)}(he.subarray(fe,-8),{i:2},new nl(((ae=he)[(de=ae.length)-4]|ae[de-3]<<8|ae[de-2]<<16|ae[de-1]<<24)>>>0))));var ae,de,he,fe;const Me=Qoe[Q];if(!Me)throw new Error(`Unhandled codec: ${Q}`);const Ae=new globalThis.DecompressionStream(Me);return new Response(new Blob([J]).stream().pipeThrough(Ae)).arrayBuffer().then(ke=>new Uint8Array(ke))}(L,R).then(J=>(function(Q,ae){Q.readFields(Foe,ae)}(new fM(J),H),new tae[S](H.buffer))),W.then(J=>{for(let Q=j.length-1;Q>=0;Q--)switch(j[Q]){case"delta_filter":Uoe(J,A);break;case"zigzag_filter":Voe(J);break;case"bitshuffle_filter":$oe(J,S);break;default:throw new wl(`Unhandled filter "${j[Q]}"`)}return{layerName:f,blockIndex:k,data:J}}).catch(J=>{throw J})}))},Wt(WB,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Wt(hT,"MapboxRasterTile"),Wt(HB,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class ZB{constructor(i){this._stringToNumber={},this._numberToString=[];for(let s=0;s<i.length;s++){const d=i[s];this._stringToNumber[d]=s,this._numberToString[s]=d}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const rae=["id","tile","layer","source","sourceLayer","state"];class ny{constructor(i,s,d,f,y){this.type="Feature",this._vectorTileFeature=i,this._z=s,this._x=d,this._y=f,this.properties=i.properties,this.id=y}clone(){const i=new ny(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of rae)this[s]!==void 0&&(i[s]=this[s]);return i}}class KB{constructor(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Wc(Dt,16,0),this.featureIndexArray=new lS,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,s,d,f,y,_=0,S=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,f,y,_);const k=this.grid;for(let j=0;j<s.length;j++){const R=s[j],L=[1/0,1/0,-1/0,-1/0];for(let H=0;H<R.length;H++){const W=R[H];L[0]=Math.min(L[0],W.x),L[1]=Math.min(L[1],W.y),L[2]=Math.max(L[2],W.x),L[3]=Math.max(L[3],W.y)}S!==0&&(L[0]-=S,L[1]-=S,L[2]+=S,L[3]+=S),L[0]<Dt&&L[1]<Dt&&L[2]>=0&&L[3]>=0&&k.insert(A,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ir(new FS(this.rawTileData)).layers,this.sourceLayerCoder=new ZB(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,s){const{tilespaceGeometry:d,transform:f,tileTransform:y,pixelPosMatrix:_,availableImages:S,worldview:A}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const k=d.bufferedTilespaceBounds,j=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,(W,J,Q,ae)=>Ri(d.bufferedTilespaceGeometry,W,J,Q,ae));j.sort(nae);let R=null;f.elevation&&j.length>0&&(R=Qg.create(f.elevation,this.tileID));const L={};let H;for(let W=0;W<j.length;W++){const J=j[W];if(J===H)continue;H=J;const Q=this.featureIndexArray.get(J);let ae=null;this.is3DTile?this.loadMatchingModelFeature(L,Q,i,d,f,A):this.loadMatchingFeature(L,Q,i,S,A,(de,he,fe,Me=0)=>(ae||(ae=nt(de,this.tileID.canonical,y)),he.queryIntersectsFeature(d,de,fe,ae,this.z,f,_,R,Me)))}return L}loadMatchingFeature(i,s,d,f,y,_){const{featureIndex:S,bucketIndex:A,sourceLayerIndex:k,layoutVertexArrayOffset:j}=s,R=this.bucketLayerIDs[A],L=d.layers,H=Object.keys(L);if(H.length&&!Hr(H,R))return;const W=d.sourceCache,J=this.sourceLayerCoder.decode(k),Q=this.vtLayers[J].feature(S),ae=this.getId(Q,J);for(let de=0;de<R.length;de++){const he=R[de];if(!L[he])continue;const{styleLayer:fe,targets:Me}=L[he];let Ae={};ae!==void 0&&(Ae=W.getFeatureState(fe.sourceLayer,ae));const ke=!_||_(Q,fe,Ae,j);if(!ke)continue;const Le=new ny(Q,this.z,this.x,this.y,ae);Le.tile=this.tileID.canonical,Le.state=Ae;let Be=this.serializedLayersCache.get(he);Be||(Be=fe.serialize(),Be.id=he,this.serializedLayersCache.set(he,Be)),Le.source=Be.source,Le.sourceLayer=Be["source-layer"],Le.layer=Qe({},Be),Le.layer.paint=XB(Be.paint,fe.paint,Q,Ae,f),Le.layer.layout=XB(Be.layout,fe.layout,Q,Ae,f);let st=!1;for(const Ge of Me){this.updateFeatureProperties(Le,Ge);const{filter:ft}=Ge;if(ft){if(Q.properties=Le.properties,ft.needGeometry){const wt=Ze(Q,!0);if(!ft.filter(new On(this.tileID.overscaledZ,{worldview:y}),wt,this.tileID.canonical))continue}else if(!ft.filter(new On(this.tileID.overscaledZ,{worldview:y}),Q))continue}st=!0,Ge.targetId&&this.addFeatureVariant(Le,Ge)}st&&this.appendToResult(i,he,S,Le,ke)}}loadMatchingModelFeature(i,s,d,f,y,_){const{featureIndex:S,bucketIndex:A}=s,k=this.bucketLayerIDs[A],j=d.layers,R=Object.keys(j);if(!R.length||Hr(R,k))for(let L=0;L<k.length;L++){const H=k[L],{styleLayer:W,targets:J}=j[H];if(W.type!=="model")continue;const Q=f.tile,ae=Q.getBucket(W);if(!(ae&&ae instanceof iT))continue;const de=loe(ae,S,f,y);if(!de)continue;const{z:he,x:fe,y:Me}=Q.tileID.canonical,{feature:Ae,intersectionZ:ke,position:Le}=de;let Be={};Ae.id!==void 0&&(Be=d.sourceCache.getFeatureState(W.sourceLayer,Ae.id));const st=new ny({},he,fe,Me,Ae.id);st.tile=this.tileID.canonical,st.state=Be,st.properties=Ae.properties,st.geometry={type:"Point",coordinates:[Le.lng,Le.lat]};let Ge=this.serializedLayersCache.get(H);Ge||(Ge=W.serialize(),Ge.id=H,this.serializedLayersCache.set(H,Ge)),st.source=Ge.source,st.sourceLayer=Ge["source-layer"],st.layer=Qe({},Ge);let ft=!1;for(const wt of J){this.updateFeatureProperties(st,wt);const{filter:xt}=wt;if(xt){if(Ae.properties=st.properties,xt.needGeometry){if(!xt.filter(new On(this.tileID.overscaledZ,{worldview:_}),Ae,this.tileID.canonical))continue}else if(!xt.filter(new On(this.tileID.overscaledZ,{worldview:_}),Ae))continue}ft=!0,wt.targetId&&this.addFeatureVariant(st,wt)}ft&&this.appendToResult(i,H,S,st,ke)}}updateFeatureProperties(i,s,d){if(s.properties){const f={};for(const y in s.properties){const _=s.properties[y].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,d);_!=null&&(f[y]=_)}i.properties=f}}addFeatureVariant(i,s,d){const f={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(f.properties=i.properties),i.variants=i.variants||{},i.variants[s.targetId]=i.variants[s.targetId]||[],i.variants[s.targetId].push(f)}appendToResult(i,s,d,f,y){let _=i[s];_===void 0&&(_=i[s]=[]),_.push({featureIndex:d,feature:f,intersectionZ:y})}lookupSymbolFeatures(i,s,d,f,y,_){const S={};this.loadVTLayers();for(const A of i)this.loadMatchingFeature(S,{bucketIndex:s,sourceLayerIndex:d,featureIndex:A,layoutVertexArrayOffset:0},f,y,_);return S}loadFeature(i){const{featureIndex:s,sourceLayerIndex:d}=i;this.loadVTLayers();const f=this.sourceLayerCoder.decode(d),y=this.vtFeatures[f];if(y[s])return y[s];const _=this.vtLayers[f].feature(s);return y[s]=_,_}hasLayer(i){for(const s of this.bucketLayerIDs)for(const d of s)if(i===d)return!0;return!1}getId(i,s){let d=i.id;if(this.promoteId){const f=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(f!=null)if(Array.isArray(f)){if(!this.promoteIdExpression){const y=Zu(f);if(y.result!=="success"){const _=y.value.map(S=>`${S.key}: ${S.message}`).join(", ");return void Wr(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=y.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Xf),d=this.promoteIdExpression.evaluate({zoom:0},i)}else d=i.properties[f];typeof d=="boolean"&&(d=Number(d))}return d}}function XB(l,i,s,d,f){return Tr(l,(y,_)=>{const S=i instanceof rl?i.get(_):null;return S&&S.evaluate?S.evaluate(s,d,void 0,f):S})}function nae(l,i){return i-l}Wt(KB,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const YB=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pM{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,d]=new Uint8Array(i,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=d>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const y=YB[15&d];if(!y)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(i,2,1),[S]=new Uint32Array(i,4,1);return new pM(S,_,y,i)}constructor(i,s=64,d=Float64Array,f){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=d,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const y=YB.indexOf(this.ArrayType),_=2*i*this.ArrayType.BYTES_PER_ELEMENT,S=i*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-S%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${d}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+A,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+_+S+A),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+A,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=i)}add(i,s){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=i,this.coords[this._pos++]=s,d}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return mM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,s,d,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:_,nodeSize:S}=this,A=[0,y.length-1,0],k=[];for(;A.length;){const j=A.pop()||0,R=A.pop()||0,L=A.pop()||0;if(R-L<=S){for(let Q=L;Q<=R;Q++){const ae=_[2*Q],de=_[2*Q+1];ae>=i&&ae<=d&&de>=s&&de<=f&&k.push(y[Q])}continue}const H=L+R>>1,W=_[2*H],J=_[2*H+1];W>=i&&W<=d&&J>=s&&J<=f&&k.push(y[H]),(j===0?i<=W:s<=J)&&(A.push(L),A.push(H-1),A.push(1-j)),(j===0?d>=W:f>=J)&&(A.push(H+1),A.push(R),A.push(1-j))}return k}within(i,s,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:_}=this,S=[0,f.length-1,0],A=[],k=d*d;for(;S.length;){const j=S.pop()||0,R=S.pop()||0,L=S.pop()||0;if(R-L<=_){for(let Q=L;Q<=R;Q++)QB(y[2*Q],y[2*Q+1],i,s)<=k&&A.push(f[Q]);continue}const H=L+R>>1,W=y[2*H],J=y[2*H+1];QB(W,J,i,s)<=k&&A.push(f[H]),(j===0?i-d<=W:s-d<=J)&&(S.push(L),S.push(H-1),S.push(1-j)),(j===0?i+d>=W:s+d>=J)&&(S.push(H+1),S.push(R),S.push(1-j))}return A}}function mM(l,i,s,d,f,y){if(f-d<=s)return;const _=d+f>>1;JB(l,i,_,d,f,y),mM(l,i,s,d,_-1,1-y),mM(l,i,s,_+1,f,1-y)}function JB(l,i,s,d,f,y){for(;f>d;){if(f-d>600){const k=f-d+1,j=s-d+1,R=Math.log(k),L=.5*Math.exp(2*R/3),H=.5*Math.sqrt(R*L*(k-L)/k)*(j-k/2<0?-1:1);JB(l,i,s,Math.max(d,Math.floor(s-j*L/k+H)),Math.min(f,Math.floor(s+(k-j)*L/k+H)),y)}const _=i[2*s+y];let S=d,A=f;for(gx(l,i,d,s),i[2*f+y]>_&&gx(l,i,d,f);S<A;){for(gx(l,i,S,A),S++,A--;i[2*S+y]<_;)S++;for(;i[2*A+y]>_;)A--}i[2*d+y]===_?gx(l,i,d,A):(A++,gx(l,i,A,f)),A<=s&&(d=A+1),s<=A&&(f=A-1)}}function gx(l,i,s,d){gM(l,s,d),gM(i,2*s,2*d),gM(i,2*s+1,2*d+1)}function gM(l,i,s){const d=l[i];l[i]=l[s],l[s]=d}function QB(l,i,s,d){const f=l-s,y=i-d;return f*f+y*y}o.$=So,o.A=Wl,o.B=Kl,o.C=fd,o.D=Gg,o.E=Fu,o.F=2,o.G=rx,o.H=E5,o.I=Ba,o.J=Lc,o.K=class extends nT{},o.L=Bu,o.M=tS,o.N=xg,o.O=vg,o.P=ut,o.Q=q1,o.R=Nf,o.S=n0,o.T=MP,o.U=cp,o.V=nT,o.W=i0,o.X=Zu,o.Y=og,o.Z=id,o._=nd,o.a=function(l){return Mo.API_CDN_URL_REGEX.test(l)},o.a$=gt,o.a0=Av,o.a1=up,o.a2=bg,o.a3=G1,o.a4=function(l){const i=l.value;let s=[];if(!i)return s;const d=Lc(i);return d!=="string"?(s=s.concat([new nT(l.key,i,`string expected, "${d}" found`)]),s):(nM(i,!0)||(s=s.concat([new nT(l.key,i,`invalid url "${i}"`)])),s)},o.a5=$e,o.a6=lp,o.a7=wi,o.a8=It,o.a9=class{constructor(l){this.specification=l}possiblyEvaluate(l,i){return Wi(l.expression.evaluate(i))}interpolate(l,i,s){return{x:lr(l.x,i.x,s),y:lr(l.y,i.y,s),z:lr(l.z,i.z,s),azimuthal:lr(l.azimuthal,i.azimuthal,s),polar:lr(l.polar,i.polar,s)}}},o.aA=Bi,o.aB=Ko,o.aC=oi,o.aD=re,o.aE=dt,o.aF=function(l,i){const s={};for(let d=0;d<i.length;d++){const f=i[d];f in l&&(s[f]=l[f])}return s},o.aG=$,o.aH=ie,o.aI=class{constructor(l){this.entries={},this.scheduler=l}request(l,i,s,d){const f=this.entries[l]=this.entries[l]||{callbacks:[]};if(f.result){const[y,_]=f.result;return this.scheduler?this.scheduler.add(()=>{d(y,_)},i):d(y,_),()=>{}}return f.callbacks.push(d),f.cancel||(f.cancel=s((y,_)=>{f.result=[y,_];for(const S of f.callbacks)this.scheduler?this.scheduler.add(()=>{S(y,_)},i):S(y,_);setTimeout(()=>delete this.entries[l],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(y=>y!==d),f.callbacks.length||(f.cancel(),delete this.entries[l]))}}},o.aJ=function(l,i,s){const d=JSON.stringify(l.request);return l.data&&(this.deduped.entries[d]={result:[null,l.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},f=>{const y=Ff(l.request,(_,S,A,k)=>{_?f(_):S&&f(null,{vectorTile:s?void 0:new ir(new FS(S)),rawData:S,cacheControl:A,expires:k})});return()=>{y.cancel(),f()}},i)},o.aK=function(l){bv++,bv>Hl&&(l.getActor().send("enforceCacheSizeLimit",el),bv=0)},o.aL=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},o.aM=$i,o.aN=eB,o.aO=aB,o.aP=Q5,o.aQ=function(l,i){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){i(null,s)};for(let d=0;d<l.length;d++){const f=document.createElement("source");SC(l[d])||(s.crossOrigin="Anonymous"),f.src=l[d],s.appendChild(f)}return{cancel:()=>{}}},o.aR=X0,o.aS=function(l){return fetch(l).then(i=>i.arrayBuffer()).then(i=>IF(i,0,l))},o.aT=FF,o.aU=class{constructor(l,i,s,d){this.id=l,this.position=i!=null?new q(i[0],i[1]):new q(0,0),this.orientation=s??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,i){if(V(l.matrix,i,l.matrix),l.meshes)for(const s of l.meshes){const d=kr.applyTransformFast(s.aabb,l.matrix);this.aabb.encapsulate(d)}if(l.children)for(const s of l.children)this._applyTransformations(s,l.matrix)}computeBoundsAndApplyParent(){const l=N([]);for(const i of this.nodes)this._applyTransformations(i,l)}computeModelMatrix(l,i,s,d,f,y,_=!1){zF(this.matrix,this,l.transform,this.position,i,s,d,f,y,_)}upload(l){if(!this.uploaded){for(const i of this.nodes)jP(i,l);for(const i of this.nodes)NS(i);this.uploaded=!0}}destroy(){for(const l of this.nodes)RP(l)}},o.aV=_r,o.aW=ox,o.aX=pe,o.aY=me,o.aZ=md,o.a_=ii,o.aa=On,o.ab=Hc,o.ac=Ve,o.ad=Qt,o.ae=Ye,o.af=Fe,o.ag=rl,o.ah=Ad,o.ai=lr,o.aj=Dt,o.ak=v1,o.al=Br,o.am=Tn,o.an=class{constructor(l){this.specification=l}possiblyEvaluate(l,i){return function([s,d]){const f=Wi([1,s,d]);return{x:f.x,y:f.y,z:f.z}}(l.expression.evaluate(i))}interpolate(l,i,s){return{x:lr(l.x,i.x,s),y:lr(l.y,i.y,s),z:lr(l.z,i.z,s)}}},o.ao=function(l,i,s=0,d=!0){const f=new ut(s,s),y=l.sub(f),_=i.add(f),S=[y,new ut(_.x,y.y),_,new ut(y.x,_.y)];return d&&S.push(y.clone()),S},o.ap=function(l,i){const s=[];for(let d=0;d<l.length;d++){const f=et(d-1,-1,l.length-1),y=et(d+1,-1,l.length-1),_=l[d],S=l[y],A=l[f].sub(_).unit(),k=S.sub(_).unit(),j=k.angleWithSep(A.x,A.y),R=A.add(k).unit().mult(-1*i/Math.sin(j/2));s.push(_.add(R))}return s},o.aq=F5,o.ar=Ri,o.as=function(l,i,s=0){return Oe(((i.x-s)*l.scale-l.x)*Dt,(i.y*l.scale-l.y)*Dt,Te(i.z,i.y))},o.at=Kr,o.au=Er,o.av=hn,o.aw=XF,o.ax=function(l){let i=1/0,s=1/0,d=-1/0,f=-1/0;for(const y of l)i=Math.min(i,y.x),s=Math.min(s,y.y),d=Math.max(d,y.x),f=Math.max(f,y.y);return{min:new ut(i,s),max:new ut(d,f)}},o.ay=xe,o.az=V,o.b=function(l){return Mo.API_FONTS_REGEX.test(l)},o.b$=ZP,o.b0=oS,o.b1=QS,o.b2=function(){_l.isLoading()||_l.isLoaded()||h0()!=="deferred"||J1()},o.b3=hd,o.b4=Ze,o.b5=ny,o.b6=pn,o.b7=zP,o.b8=mP,o.b9=nt,o.bA=function(l,i){const{x:s,y:d}=l.point,f=vN(s,d,l.worldSize/l._pixelsPerMercatorPixel,0,0);return V(f,f,oP(ru(i)))},o.bB=T,o.bC=Nn,o.bD=function(l,i){return Math.hypot(i[0]-l[0],i[1]-l[1],i[2]-l[2])},o.bE=ct,o.bF=br,o.bG=Ft,o.bH=tx,o.bI=hs,o.bJ=GP,o.bK=function(l,i,s,d,f){const y=5*i+2;l.float32[y+0]=s,l.float32[y+1]=d,l.float32[y+2]=f},o.bL=JS,o.bM=sa,o.bN=Js,o.bO=Ts,o.bP=Ta,o.bQ=et,o.bR=function(l,i,s,d){var f=new w(4);return f[0]=l,f[1]=i,f[2]=s,f[3]=d,f},o.bS=MS,o.bT=Ei,o.bU=To,o.bV=XN,o.bW=sB,o.bX=eF,o.bY=_P,o.bZ=$P,o.b_=O5,o.ba=Ma,o.bb=E0,o.bc=fN,o.bd=ui,o.be=Vg,o.bf=tM,o.bg=function(l,i){const s=Ad(i.zoom);if(s===0)return ru(l);const d=vS(l),f=iP(d),y=re(d.getWest())*i.worldSize,_=re(d.getEast())*i.worldSize,S=ie(d.getNorth())*i.worldSize,A=ie(d.getSouth())*i.worldSize,k=[y,S,0],j=[_,S,0],R=[y,A,0],L=[_,A,0],H=G([],i.globeMatrix);return Qt(k,k,H),Qt(j,j,H),Qt(R,R,H),Qt(L,L,H),f[0]=eh(f[0],R,s),f[1]=eh(f[1],L,s),f[2]=eh(f[2],j,s),f[3]=eh(f[3],k,s),kr.fromPoints(f)},o.bh=bS,o.bi=G,o.bj=D0,o.bk=eh,o.bl=pd,o.bm=Rre,o.bn=le,o.bo=U,o.bp=hT,o.bq=FS,o.br=Ff,o.bs=function(l,i){const s=[];for(const d in l)d in i||s.push(d);return s},o.bt=Ue,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=Wn,o.bw=function(l){var i=new w(16);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],i},o.bx=N,o.by=se,o.bz=B,o.c=Bm,o.c$=45,o.c0=pM,o.c1=mt,o.c2=Fi,o.c3=xo,o.c4=function(l,i,s){s*=.5;var d=i[0],f=i[1],y=i[2],_=i[3],S=Math.sin(s),A=Math.cos(s);return l[0]=d*A+f*S,l[1]=f*A-d*S,l[2]=y*A+_*S,l[3]=_*A-y*S,l},o.c5=$l,o.c6=pi,o.c7=function(l,i){return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l[3]=i[3],l},o.c8=je,o.c9=function(l,i,s,d,f){var y,_=1/Math.tan(i/2);return l[0]=_/s,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=_,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,f!=null&&f!==1/0?(l[10]=(f+d)*(y=1/(d-f)),l[14]=2*f*d*y):(l[10]=-1,l[14]=-2*d),l},o.cA=Oa,o.cB=gN,o.cC=function(l,i,s,d,f,y,_,S,A){if(A.name==="globe")return gN(l,i,new Oa(s,d,f),!1);const k=ox({z:s,x:d,y:f},A);return new kr([(y+k.x/k.scale)*i,i*(k.y/k.scale),_],[(y+k.x2/k.scale)*i,i*(k.y2/k.scale),S])},o.cD=function(l,i,s){return l[0]=Math.min(i[0],s[0]),l[1]=Math.min(i[1],s[1]),l[2]=Math.min(i[2],s[2]),l[3]=Math.min(i[3],s[3]),l},o.cE=function(l,i,s){return l[0]=Math.max(i[0],s[0]),l[1]=Math.max(i[1],s[1]),l[2]=Math.max(i[2],s[2]),l[3]=Math.max(i[3],s[3]),l},o.cF=function(l){const i=Math.round((l+45+360)%360/90)%4;return oe[i]},o.cG=we,o.cH=Co,o.cI=a,o.cJ=function(l){const i=N(new Float64Array(16));V(i,l.pixelMatrix,l.globeMatrix);const s=[0,b,0],d=[0,E,0];return Qt(s,s,i),Qt(d,d,i),[s[0]>0&&s[0]<=l.width&&s[1]>0&&s[1]<=l.height&&!sP(l,new q(l.center.lat,90)),d[0]>0&&d[0]<=l.width&&d[1]>0&&d[1]<=l.height&&!sP(l,new q(l.center.lat,-90))]},o.cK=function(l,i){const{scale:s}=l.tileTransform,d=s*Dt/(l.tileSize*Math.pow(2,i.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return function(f,y,_){var S=y[1],A=y[2],k=y[3],j=_[0],R=_[1];return f[0]=y[0]*j,f[1]=S*j,f[2]=A*R,f[3]=k*R,f}(new Float32Array(4),i.inverseAdjustmentMatrix,[d,d])},o.cL=LS,o.cM=ze,o.cN=OF,o.cO=function(l){const i=OF(l,!0);return T([],[i[0],i[1],i[4],i[5]])},o.cP=X,o.cQ=Zn,o.cR=Y,o.cS=function(l){const{x:i,y:s}=l.point,{lng:d,lat:f}=l._center;return vN(i,s,l.worldSize,d,f)},o.cT=rt,o.cU=qe,o.cV=Ds,o.cW=Vn,o.cX=m,o.cY=function(l,i,s){let d=0;for(let f=0;f<2;++f)l[f]>0&&(d+=(l[f]-0)*(l[f]-0)),i[f]<0&&(d+=(0-i[f])*(0-i[f]));return d},o.cZ=function(l){return l*l*l*l*l},o.c_=ee,o.ca=function(l,i,s,d,f,y,_){var S=1/(i-s),A=1/(d-f),k=1/(y-_);return l[0]=-2*S,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*A,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*k,l[11]=0,l[12]=(i+s)*S,l[13]=(f+d)*A,l[14]=(_+y)*k,l[15]=1,l},o.cb=ue,o.cc=function(l,i,s){l[4*i+0]=s[0],l[4*i+1]=s[1],l[4*i+2]=s[2],l[4*i+3]=s[3]},o.cd=Ug,o.ce=wd,o.cf=Ii,o.cg=bl,o.ch=_p,o.ci=q,o.cj=G5,o.ck=function(){var l=new w(4);return w!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},o.cl=function(l,i,s){var d=i[0],f=i[1],y=i[2],_=i[3],S=Math.sin(s),A=Math.cos(s);return l[0]=d*A+y*S,l[1]=f*A+_*S,l[2]=d*-S+y*A,l[3]=f*-S+_*A,l},o.cm=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]&&l[3]===i[3]},o.cn=Jr,o.co=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},o.cp=Xs,o.cq=Ut,o.cr=tu,o.cs=3,o.ct=2,o.cu=7,o.cv=6,o.cw=Yt,o.cx=Ce,o.cy=hi,o.cz=jF,o.d=function(l){return Mo.API_TILEJSON_REGEX.test(l)},o.d$=(l,i,s,d,f,y,_,S,A,k)=>{const j=l.transform,R=j.calculatePixelsToTileUnitsMatrix(i),L=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",H=j.pitch<15?YF(.07,.7,xe((14-j.zoom)/5,0,1)):.07;return{u_matrix:QF(l,i,s,d),u_pixels_to_tile_units:R,u_device_pixel_ratio:y,u_width_scale:_,u_floor_width_scale:S,u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:t5(s)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:JF(i,l.transform),u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:H,u_tile_to_meter:Ee(i.tileID.canonical,0),u_ground_shadow_factor:k}},o.d0=yp,o.d1=function(l,i,s){const d=Math.sqrt(l*l+i*i+s*s),f=d>0?Math.acos(s/d)*Go:0;let y=l!==0||i!==0?Math.atan2(-i,-l)*Go+90:0;return y<0&&(y+=360),[d,y,f]},o.d2=Oe,o.d3=Wi,o.d4=Ee,o.d5=He,o.d6=kr,o.d7=lt,o.d8=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},o.d9=nM,o.dA=vS,o.dB=function(l){const i=we-5;l=xe(l,-i,i)/i*90;const s=Math.pow(Math.abs(Math.sin(Br(l))),3);return Math.round(s*(x.length-1))},o.dC=function(l,i,s,d){const f=i.getNorth(),y=i.getSouth(),_=i.getWest(),S=i.getEast(),A=1<<l.z,k=S-_,j=f-y,R=k/g,L=-j/x[s],H=[0,R,0,L,0,0,f,_,0];if(l.z>0){const W=180/d;D(H,H,[W/k+1,0,0,0,W/j+1,0,-.5*W/R,.5*W/L,1])}return H[2]=A,H[5]=l.x,H[8]=l.y,H},o.dD=ru,o.dE=function(l,i,s){const d=N(new Float64Array(16)),f=(i/(1<<l)-.5)*Math.PI*2;return ne(d,s.globeMatrix,f),Float32Array.from(d)},o.dF=class{isDataAvailableAtPoint(l){const i=this._source();if(this.isUsingMockSource()||!i||l.y<0||l.y>1)return!1;const s=i.getSource().maxzoom,d=1<<s,f=Math.floor(l.x),y=Math.floor((l.x-f)*d),_=Math.floor(l.y*d),S=this.findDEMTileFor(new $i(s,f,s,y,_));return!(!S||!S.dem)}getAtPointOrZero(l,i=0){return this.getAtPoint(l,i)||0}getAtPoint(l,i,s=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const d=this._source();if(!d||l.y<0||l.y>1)return i;const f=d.getSource().maxzoom,y=1<<f,_=Math.floor(l.x),S=l.x-_,A=new $i(f,_,f,Math.floor(S*y),Math.floor(l.y*y)),k=this.findDEMTileFor(A);if(!k||!k.dem)return i;const j=k.dem,R=1<<k.tileID.canonical.z,L=(S*R-k.tileID.canonical.x)*j.dim,H=(l.y*R-k.tileID.canonical.y)*j.dim,W=Math.floor(L),J=Math.floor(H);return(s?this.exaggeration():1)*lr(lr(j.get(W,J),j.get(W,J+1),H-J),lr(j.get(W+1,J),j.get(W+1,J+1),H-J),L-W)}getAtTileOffset(l,i,s){const d=1<<l.canonical.z;return this.getAtPointOrZero(new Ve(l.wrap+(l.canonical.x+i/Dt)/d,(l.canonical.y+s/Dt)/d))}getAtTileOffsetFunc(l,i,s,d){return f=>{const y=this.getAtTileOffset(l,f.x,f.y),_=d.upVector(l.canonical,f.x,f.y);return mt(_,_,y*d.upVectorScale(l.canonical,i,s).metersToTile),_}}getForTilePoints(l,i,s,d){if(this.isUsingMockSource())return!1;const f=Qg.create(this,l,d);return!!f&&(i.forEach(y=>{y[2]=this.exaggeration()*f.getElevationAt(y[0],y[1],s)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(l);if(!i||!i.dem)return null;const s=i.dem.tree,d=i.tileID,f=1<<l.canonical.z-d.canonical.z;let y=l.canonical.x/f-d.canonical.x,_=l.canonical.y/f-d.canonical.y,S=0;for(let A=0;A<l.canonical.z-d.canonical.z&&!s.leaves[S];A++){y*=2,_*=2;const k=2*Math.floor(_)+Math.floor(y);S=s.childOffsets[S]+k,y%=1,_%=1}return{min:this.exaggeration()*s.minimums[S],max:this.exaggeration()*s.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,i,s){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let i=!1,s=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const f of l){const y=this.getMinMaxForTile(f.tileID);y&&(s=Math.min(s,y.min),d=Math.max(d,y.max),i=!0)}return i?{min:s,max:d}:null}},o.dG=ON,o.dH=_S,o.dI=function(l,i){return[Math.pow(l[0],2.2)*i,Math.pow(l[1],2.2)*i,Math.pow(l[2],2.2)*i]},o.dJ=M,o.dK=function(l,i){var s=Math.sin(i),d=Math.cos(i);return l[0]=d,l[1]=s,l[2]=0,l[3]=-s,l[4]=d,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},o.dL=Sr,o.dM=_N,o.dN=Ea,o.dO=qo,o.dP=256,o.dQ=function(l,i){const s=[0,0,0];return Qt(s,s,bS(ru(i.canonical))),Qt(s,s,l),s},o.dR=l=>({u_matrix:new _p(l),u_texsize:new bl(l),u_pixels_to_tile_units:new j0(l),u_device_pixel_ratio:new Ii(l),u_width_scale:new Ii(l),u_floor_width_scale:new Ii(l),u_image:new Ug(l),u_units_to_pixels:new bl(l),u_tile_units_to_pixels:new Ii(l),u_alpha_discard_threshold:new Ii(l),u_trim_offset:new bl(l),u_trim_fade_range:new bl(l),u_trim_color:new yp(l),u_emissive_strength:new Ii(l),u_zbias_factor:new Ii(l),u_tile_to_meter:new Ii(l),u_ground_shadow_factor:new wd(l),u_pattern_transition:new Ii(l)}),o.dS=l=>({u_matrix:new _p(l),u_pixels_to_tile_units:new j0(l),u_device_pixel_ratio:new Ii(l),u_width_scale:new Ii(l),u_floor_width_scale:new Ii(l),u_units_to_pixels:new bl(l),u_dash_image:new Ug(l),u_gradient_image:new Ug(l),u_image_height:new Ii(l),u_texsize:new bl(l),u_tile_units_to_pixels:new Ii(l),u_alpha_discard_threshold:new Ii(l),u_trim_offset:new bl(l),u_trim_fade_range:new bl(l),u_trim_color:new yp(l),u_emissive_strength:new Ii(l),u_zbias_factor:new Ii(l),u_tile_to_meter:new Ii(l),u_ground_shadow_factor:new wd(l)}),o.dT=l=>({u_camera_to_center_distance:new Ii(l),u_extrude_scale:new j0(l),u_device_pixel_ratio:new Ii(l),u_matrix:new _p(l),u_inv_rot_matrix:new _p(l),u_merc_center:new bl(l),u_tile_id:new wd(l),u_zoom_transition:new Ii(l),u_up_dir:new wd(l),u_emissive_strength:new Ii(l)}),o.dU=_d,o.dV=mie,o.dW=wN,o.dX=(l,i,s,d,f,y)=>{const _=l.transform,S=_.projection.name==="globe";let A;if(y.paint.get("circle-pitch-alignment")==="map")if(S){const j=_N(_.zoom,i.canonical)*_._pixelsPerMercatorPixel;A=Float32Array.from([j,0,0,j])}else A=_.calculatePixelsToTileUnitsMatrix(s);else A=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(_.projection),u_matrix:l.translatePosMatrix(i.projMatrix,s,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Qs.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:Fre,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:y.paint.get("circle-emissive-strength")};if(S){k.u_inv_rot_matrix=d,k.u_merc_center=f,k.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],k.u_zoom_transition=Ad(_.zoom);const j=f[0]*Dt,R=f[1]*Dt;k.u_up_dir=_.projection.upVector(new Oa(0,0,0),j,R)}return k},o.dY=e5,o.dZ=ka,o.d_=(l,i,s,d,f,y,_,S,A,k)=>{const j=l.transform,R=j.pitch<15?YF(.07,.7,xe((14-j.zoom)/5,0,1)):.07,L=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:QF(l,i,s,d),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:j.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:f,u_width_scale:y,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:JF(i,j),u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:Ee(i.tileID.canonical,0),u_ground_shadow_factor:A,u_pattern_transition:k}},o.da=function(l,i){return l.readFields(hoe,{icons:[]},i)},o.db=IS,o.dc=Xg,o.dd=HP,o.de=Gm,o.df=Y1,o.dg=As,o.dh=Wh,o.di=zr,o.dj=function(l){const i=l.indexOf(hp);return i>=0?l.slice(0,i):l},o.dk=function(l){return l.indexOf(hp)>=0},o.dl=function(l){const i=l.lastIndexOf(hp);return i>=0?l.slice(i+1):""},o.dm=function(l){const i=[],s=l.id;return s===void 0&&i.push({message:`layers.${s}: missing required property "id"`}),l.render===void 0&&i.push({message:`layers.${s}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&i.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),i},o.dn=function(l,i,s,d){return l.type==="custom"?new ooe(l,i):new coe[l.type](l,i,s,d)},o.dp=Gr,o.dq=function(l){const i=l.indexOf(hp);return i>=0?l.slice(i+1):""},o.dr=class extends ny{constructor(l,i){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},o.ds=u0,o.dt=qh,o.du=function(l){return l({pluginStatus:ha,pluginURL:Zc}),u0.on("pluginStateChange",l),l},o.dv=O0,o.dw=class extends Is{constructor(l){super(l),this.current=JC}set(l,i,s){if(this.fetchUniformLocation(l,i)){for(let d=0;d<9;d++)if(s[d]!==this.current[d]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},o.dx=ce,o.dy=function(l,i,s){const d=Ad(s.zoom),f=l.style.map._antialias,y=l.terrain&&l.terrain.exaggeration()>0;return d===0&&!f&&!y},o.dz=function(l){const i=l.pixelsPerMeter,s=i/ue(1,l.center.lat),d=N(new Float64Array(16));return U(d,d,[l.point.x,l.point.y,0]),X(d,d,[s,s,i]),Float32Array.from(d)},o.e=Mo,o.e$=h0,o.e0=sr,o.e1=L0,o.e2=Te,o.e3=Ore,o.e4=PS,o.e5=dF,o.e6=Cd,o.e7=450,o.e8=7,o.e9=be,o.eA=function(l,i,s,d,f,y,_,S,A,k,j,R,L,H,W,J){var Q=new w(16);return Q[0]=l,Q[1]=i,Q[2]=s,Q[3]=d,Q[4]=f,Q[5]=y,Q[6]=_,Q[7]=S,Q[8]=A,Q[9]=k,Q[10]=j,Q[11]=R,Q[12]=L,Q[13]=H,Q[14]=W,Q[15]=J,Q},o.eB=z,o.eC=S0,o.eD=fp,o.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ut(1/0,1/0),max:new ut(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,i=!1){const s=JN(new ut(0,0),new ut(Dt,Dt),l),d=[];if(i&&!gP(s,this._globalClipBounds))return d;for(const f of this._activeRegions){if(f.hiddenByOverlap||!gP(s,f))continue;const y=fne(f.min,f.max,l);d.push({min:y.min,max:y.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return d}setSources(l){this._setSources(l.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const s=[];for(const d of i.cache.getVisibleCoordinates()){const f=i.cache.getTile(d).buckets[i.layer];f&&f.updateFootprints(d.toUnwrapped(),s)}return s},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(l){const i=l.getFootprints();if(i.length===0)return;const s=l.getOrder(),d=l.getClipMask(),f=l.getClipScope();for(const y of i){if(!y.footprint)continue;const _=JN(y.footprint.min,y.footprint.max,y.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:y.id,footprint:y.footprint,order:s,clipMask:d,clipScope:f})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,s)=>i.priority-s.priority||AS(i.min,s.min)||AS(i.max,s.max)||i.order-s.order||i.clipMask-s.clipMask||function(d,f){const y=(_,S)=>_+S;return d.length-f.length||d.reduce(y,"").localeCompare(f.reduce(y,""))}(i.clipScope,s.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let i=0;for(;!l&&i!==this._activeRegions.length;){const s=this._activeRegions[i],d=this._prevRegions[i];l=s.priority!==d.priority||!YN(s,d)||s.order!==d.order||s.clipMask!==d.clipMask||!Wn(s.clipScope,d.clipScope),++i}}if(l){++this._updateTime;for(const s of this._activeRegions)s.order!==V0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const i=s=>{const d=this._activeRegions;if(s>=d.length)return s;const f=d[s].priority;for(;s<d.length&&d[s].priority===f;)++s;return s};if(this._sourceIds.length>1){let s=0,d=i(s);for(;s!==d;){let f=s;const y=s;for(;f!==d;){const _=this._activeRegions[f];_.hiddenByOverlap=!1;for(let S=0;S<y;S++){const A=this._activeRegions[S];if(!A.hiddenByOverlap&&_.order===V0&&gP(_,A)&&(_.hiddenByOverlap=QN(_.footprint,_.tileId,A.footprint,A.tileId),_.hiddenByOverlap))break}++f}s=d,d=i(s)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=l.length-1;i>=0;i--)this._addSource(l[i]);this._computeReplacement()}},o.eF=V0,o.eG=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,i){const s=new Ma,d=new ii,f=[],y=l+1+2,_=i[0]+1,S=i[0]+1+(1+i.length),A=(k,j,R)=>{let L=k===y-1?k-2:k===0?k:k-1;return L+=R?24575:0,[L,j]};for(let k=0;k<y;++k)s.emplaceBack(...A(k,0,!0));for(let k=0;k<_;++k)for(let j=0;j<y;++j)s.emplaceBack(...A(j,k,(j===0||j===y-1)&&!0));for(let k=0;k<i.length;++k){const j=i[k];for(let R=0;R<y;++R)s.emplaceBack(...A(R,j,!0))}for(let k=0;k<i.length;++k){const j=d.length,R=i[k]+1+2,L=new ii;for(let J=0;J<R-1;J++){const Q=J===R-2,ae=Q?y*(S-i.length+k-J):y;for(let de=0;de<y-1;de++){const he=J*y+de;J===0||Q||de===0||de===y-2?(L.emplaceBack(he+1,he,he+ae),L.emplaceBack(he+ae,he+ae+1,he+1)):(d.emplaceBack(he+1,he,he+ae),d.emplaceBack(he+ae,he+ae+1,he+1))}}const H=ui.simpleSegment(0,j,s.length,d.length-j);for(let J=0;J<L.uint16.length;J+=3)d.emplaceBack(L.uint16[J],L.uint16[J+1],L.uint16[J+2]);const W=ui.simpleSegment(0,j,s.length,d.length-j);f.push({withoutSkirts:H,withSkirts:W})}return{vertices:s,indices:d,segments:f}}_createGrid(l){const i=this._fillGridMeshWithLods(g,x);this._gridSegments=i.segments,this._gridBuffer=l.createVertexBuffer(i.vertices,fN.members),this._gridIndexBuffer=l.createIndexBuffer(i.indices,!0)}_createPoles(l){const i=new ii;for(let _=0;_<=g;_++)i.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=l.createIndexBuffer(i,!0);const s=new Ju,d=new Ju,f=new Ju,y=new Ju;this._poleSegments=[];for(let _=0,S=0;_<m;_++){const A=360/(1<<_);s.emplaceBack(0,-Ko,0,.5,0),d.emplaceBack(0,-Ko,0,.5,1),f.emplaceBack(0,-Ko,0,.5,.5),y.emplaceBack(0,-Ko,0,.5,.5);for(let k=0;k<=g;k++){let j=k/g,R=0;const L=lr(0,A,j),[H,W,J]=P(zre,Nre,L,Ko);s.emplaceBack(H,W,J,j,R),d.emplaceBack(H,W,J,j,1-R);const Q=Br(L);j=.5+.5*Math.sin(Q),R=.5+.5*Math.cos(Q),f.emplaceBack(H,W,J,j,R),y.emplaceBack(H,W,J,j,1-R)}this._poleSegments.push(ui.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(s,yS,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(d,yS,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(f,yS,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(y,yS,!1)}getGridBuffers(l,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},o.eH=KN,o.eI=ye,o.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eK=Ie,o.eL=Se,o.eM=function(l,i,s){return l[0]=i[0]/s[0],l[1]=i[1]/s[1],l[2]=i[2]/s[2],l},o.eN=In,o.eO=I,o.eP=xr,o.eQ=tt,o.eR=function([l,i,s]){const d=Math.hypot(l,i,s),f=Math.atan2(l,s),y=.5*Math.PI-Math.acos(-i/d);return new q(qe(f),qe(y))},o.eS=Hi,o.eT=IP,o.eU=function(l){const i=l.navigator?l.navigator.userAgent:null;return!!function(s){if(bi==null){const d=s.navigator?s.navigator.userAgent:null;bi=!!s.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return bi}(l)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eV=function(l,i){el=l,Hl=i},o.eW=sP,o.eX=xN,o.eY=function(l){const i=[0,0,0],s=N(new Float64Array(16));return V(s,l.pixelMatrix,l.globeMatrix),Qt(i,i,s),new ut(i[0],i[1])},o.eZ=function(){const l=Z0;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(SP),Z0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.e_=function(){IS().acquire(SP)},o.ea=function(l,i){if(l===i){var s=i[1],d=i[2],f=i[3],y=i[6],_=i[7],S=i[11];l[1]=i[4],l[2]=i[8],l[3]=i[12],l[4]=s,l[6]=i[9],l[7]=i[13],l[8]=d,l[9]=y,l[11]=i[14],l[12]=f,l[13]=_,l[14]=S}else l[0]=i[0],l[1]=i[4],l[2]=i[8],l[3]=i[12],l[4]=i[1],l[5]=i[5],l[6]=i[9],l[7]=i[13],l[8]=i[2],l[9]=i[6],l[10]=i[10],l[11]=i[14],l[12]=i[3],l[13]=i[7],l[14]=i[11],l[15]=i[15];return l},o.eb=ioe,o.ec=Yr,o.ed=A0,o.ee=256,o.ef=oP,o.eg=as,o.eh=ne,o.ei=function(l,i){return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[4],l[4]=i[5],l[5]=i[6],l[6]=i[8],l[7]=i[9],l[8]=i[10],l},o.ej=Ju,o.ek=w0,o.el=U1,o.em=function(l,i,s,d,f){return xe((l-i)/(s-i)*(f-d)+d,d,f)},o.en=kc,o.eo=function(l,i){var s=i[0],d=i[1],f=i[2],y=i[3],_=i[4],S=i[5],A=i[6],k=i[7],j=i[8],R=j*_-S*k,L=-j*y+S*A,H=k*y-_*A,W=s*R+d*L+f*H;return W?(l[0]=R*(W=1/W),l[1]=(-j*d+f*k)*W,l[2]=(S*d-f*_)*W,l[3]=L*W,l[4]=(j*s-f*A)*W,l[5]=(-S*s+f*y)*W,l[6]=H*W,l[7]=(-k*s+d*A)*W,l[8]=(_*s-d*y)*W,l):null},o.ep=2,o.eq=tn,o.er=OP,o.es=[1,1,1],o.et=class{constructor(l,i,s,d){this.context=l,this.format=d,this.size=s,this.texture=l.gl.createTexture();const[f,y,_]=this.size,{gl:S}=l;S.bindTexture(S.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),S.texImage3D(S.TEXTURE_3D,0,this.format,f,y,_,0,CP(this.format),PP(this.format),i.data)}bind(l,i){const{context:s}=this,{gl:d}=s;d.bindTexture(d.TEXTURE_3D,this.texture),l!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,l),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,l),this.minFilter=l),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},o.eu=Qg,o.ev=$o,o.ew=function(l,i,s,d){var f=i[0],y=i[1],_=i[2],S=i[3];return l[0]=f+d*(s[0]-f),l[1]=y+d*(s[1]-y),l[2]=_+d*(s[2]-_),l[3]=S+d*(s[3]-S),l},o.ex=Zg,o.ey=xl,o.ez=Jc,o.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(i,s)=>String.fromCharCode(+("0x"+s))))},o.f0=function(l,i,s=!1){if(ha===Va.deferred||ha===Va.loading||ha===Va.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Zc=Qs.resolveURL(l),ha=Va.deferred,l0=i,c0(),s||J1()},o.f1=function(l){qg=Qs.resolveURL(l),Hg||(Hg=new Gg(IS(),new Fu)),Hg.broadcast("setMeshoptUrl",qg)},o.f2=EF,o.f3=function(l){EP=Qs.resolveURL(l),Hg||(Hg=new Gg(IS(),new Fu)),Hg.broadcast("setDracoUrl",EP)},o.f4=TF,o.f5=W0,o.f6=function(l){const i=Du();if(!i)return;const s=i.delete(ql);l&&s.then(()=>l()).catch(l)},o.f7=Sp,o.f8=Wt,o.f9=kd,o.fa=Ql,o.fb=ZB,o.fc=KB,o.fd=WF,o.fe=er,o.ff="hd_road_elevation",o.fg=rn,o.fh=Tr,o.fi=bp,o.fj=qP,o.fk=Ap,o.fl=function(l,i,s,d,f,y,_,S=1,A,k,j){l.createArrays(),l.tilePixelRatio=Dt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const R=l.layers[0].layout,L=l.layers[0]._unevaluatedLayout._values,H={};H.scaleFactor=S,H.textSizeScaleRange=R.get("text-size-scale-range"),H.iconSizeScaleRange=R.get("icon-size-scale-range");const[W,J]=H.textSizeScaleRange,[Q,ae]=H.iconSizeScaleRange;H.textScaleFactor=xe(H.scaleFactor,W,J),H.iconScaleFactor=xe(H.scaleFactor,Q,ae);const de=L["text-size"],he=L["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:Be,maxZoom:st}=l.textSizeData;H.compositeTextSizes=[de.possiblyEvaluate(new On(Be,{worldview:j}),y),de.possiblyEvaluate(new On(st,{worldview:j}),y)]}if(l.iconSizeData.kind==="composite"){const{minZoom:Be,maxZoom:st}=l.iconSizeData;H.compositeIconSizes=[he.possiblyEvaluate(new On(Be,{worldview:j}),y),he.possiblyEvaluate(new On(st,{worldview:j}),y)]}H.layoutTextSize=de.possiblyEvaluate(new On(_+1,{worldview:j}),y),H.layoutIconSize=he.possiblyEvaluate(new On(_+1,{worldview:j}),y),H.textMaxSize=de.possiblyEvaluate(new On(18,{worldview:j}),y);const fe=R.get("symbol-placement"),Me=R.get("text-rotation-alignment")==="map"&&fe!=="point",Ae=R.get("text-size");let ke=!1;const Le=[];for(const Be of l.features){const st=R.get("text-font").evaluate(Be,{},y).join(","),Ge=Ae.evaluate(Be,{},y)*H.textScaleFactor,ft=H.layoutTextSize.evaluate(Be,{},y)*H.textScaleFactor,wt=H.layoutIconSize.evaluate(Be,{},y)*H.iconScaleFactor,xt={horizontal:{},vertical:void 0},At=Be.text;let kt,it=[0,0];if(At){const qt=At.toString(),pr=R.get("text-letter-spacing").evaluate(Be,{},y)*To,gr=R.get("text-line-height").evaluate(Be,{},y)*To,Pr=UC(qt)?pr:0,Ar=R.get("text-anchor").evaluate(Be,{},y),Qr=R.get("text-variable-anchor");if(!Qr){const ot=R.get("text-radial-offset").evaluate(Be,{},y);if(ot)it=O5(Ar,[ot*To,WP]);else{const Rt=R.get("text-offset").evaluate(Be,{},y);it=[Rt[0]*To,Rt[1]*To]}}let Ur=Me?"center":R.get("text-justify").evaluate(Be,{},y);const Kn=fe==="point",_e=Kn?R.get("text-max-width").evaluate(Be,{},y)*To:1/0,ve=ot=>{l.allowVerticalPlacement&&s0(qt)&&(xt.vertical=VP(At,i,s,f,st,_e,gr,Ar,ot,Pr,it,hs.vertical,!0,ft,Ge,A))};if(!Me&&Qr){const ot=Ur==="auto"?Qr.map(zt=>ZP(zt)):[Ur];let Rt=!1;for(let zt=0;zt<ot.length;zt++){const Lt=ot[zt];if(!xt.horizontal[Lt])if(Rt)xt.horizontal[Lt]=xt.horizontal[0];else{const Jt=VP(At,i,s,f,st,_e,gr,"center",Lt,Pr,it,hs.horizontal,!1,ft,Ge,A);Jt&&(xt.horizontal[Lt]=Jt,Rt=Jt.positionedLines.length===1)}}ve("left")}else{if(Ur==="auto"&&(Ur=ZP(Ar)),Kn||R.get("text-writing-mode").indexOf("horizontal")>=0||!s0(qt)){const ot=VP(At,i,s,f,st,_e,gr,Ar,Ur,Pr,it,hs.horizontal,!1,ft,Ge,A);ot&&(xt.horizontal[Ur]=ot)}ve(Kn?"left":Ur)}}let Tt,Xe,at,Mt,St,ar,Kt=!1;const _t=R.get("icon-text-fit").evaluate(Be,{},y);if(Be.icon&&Be.icon.hasPrimary()){const qt=R5(Be.icon,l.iconSizeData,L["icon-size"],y,l.zoom,Be,A,H.iconScaleFactor,j);Tt=qt.iconPrimary,at=qt.iconSecondary;const pr=Tt.toString();if(Xe=d.get(pr),Xe&&(St=R.get("icon-offset").evaluate(Be,{},y),ar=R.get("icon-anchor").evaluate(Be,{},y),kt=Rie(f.get(pr),at?f.get(at.toString()):void 0,St,ar),Kt=Xe.sdf,l.sdfIcons===void 0?l.sdfIcons=Xe.sdf:l.sdfIcons!==Xe.sdf&&Wr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xe.pixelRatio!==l.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),at){const gr=at.toString();Mt=d.get(gr)}}ke=ke||!(!Be.icon||!Be.icon.hasSecondary());const Pt=KP(xt.horizontal)||xt.vertical;l.iconsInText||(l.iconsInText=!!Pt&&Pt.iconsInText);const rr=ft*H.textScaleFactor/To,{defaultShapedIcon:Bt,verticallyShapedIcon:Nt}=Gie(l,kt,R,Be,y,xt,rr,St,_t);_t!=="none"&&kt&&(g5(kt)||y5(kt))&&(GS(0,Xe,Tt,kt,Bt,_t,k,d,f),GS(0,Mt,at,kt,Bt,_t,k,d,f),Nt&&(GS(0,Xe,Tt,kt,Nt,_t,k,d,f),GS(0,Mt,at,kt,Nt,_t,k,d,f))),kt=Bt,Le.push({feature:Be,shapedTextOrientations:xt,shapedText:Pt,shapedIcon:kt,iconPrimary:Tt,iconSecondary:at,iconOffset:St,iconAnchor:ar,verticallyShapedIcon:Nt,layoutTextSize:ft,layoutIconSize:wt,textOffset:it,isSDFIcon:Kt,iconTextFit:_t})}return{featureData:Le,sizes:H,hasAnySecondaryIcon:ke,textAlongLine:Me,symbolPlacement:fe}},o.fm=A5,o.fn=function(l,i,s,d,f,y,_,S,A,k){const{featureData:j,hasAnySecondaryIcon:R,sizes:L,textAlongLine:H,symbolPlacement:W}=i;for(const J of j){const{shapedIcon:Q,verticallyShapedIcon:ae,feature:de,shapedTextOrientations:he,shapedText:fe,layoutTextSize:Me,textOffset:Ae,isSDFIcon:ke,iconPrimary:Le,iconSecondary:Be,iconTextFit:st,iconOffset:Ge}=J;D5(Q,k.iconPositions,Le,Be),D5(ae,k.iconPositions,Le,Be),$ie(he,k.iconPositions),Vie(Le,Be,k.iconPositions),(fe||Q)&&qie(l,de,he,Q,ae,A,L,Me,0,Ae,ke,d,f,_,S,R,st,Ge,H,W)}s&&l.generateCollisionDebugBuffers(y,l.collisionBoxArray,L.textScaleFactor)},o.fo=ir,o.fp=uT,o.fq=yt,o.fr=function(l){let i=0;if(new Uint32Array(l,0,1)[0]!==kF){const s=new Uint32Array(l,0,7),[,,d,f,y,_]=s;i=s.byteLength+f+y+_+y,(d!==l.byteLength||i>=l.byteLength)&&Wr("Invalid b3dm header information.")}return IF(l,i)},o.fs=function(l,i){const s=FF(l);for(const d of s){for(const f of d.meshes)Gne(f);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(qne(d.lights,i)))}return s},o.ft=iT,o.fu=Dn,o.fv=wF,o.fw=_l,o.fx=Va,o.fy=function(l){$h(),jc?.then(i=>{i.keys().then(s=>{for(let d=0;d<s.length-l;d++)i.delete(s[d]).catch(f=>Wr(f.message))}).catch(s=>Wr(s.message))}).catch(i=>Wr(i.message))},o.g=function(l,i){return qh(Qe(l,{method:"GET"}),i)},o.h=Qe,o.i=function(l){return Mo.API_STYLE_REGEX.test(l)&&!Bm(l)},o.j=function(l){return l.indexOf("mapbox:")===0},o.k=Oc,o.l=wv,o.m=function(l){return decodeURIComponent(atob(l).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.n=function(l,i){return qh(Qe(l,{type:"json"}),i)},o.o=Uf,o.p=function(l,i){return qh(Qe(l,{method:"POST"}),i)},o.q=Qs,o.r=Lo,o.s=function(l){try{const i=self[l];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=$m,o.u=function(){return function l(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},o.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},o.w=Wr,o.x=function(){return TP||(TP=new Sp),TP},o.y=uM,o.z=ns}),h(["./shared"],function(o){function v(qe){const oe=qe?qe.url.toString():void 0;return oe?performance.getEntriesByName(oe):[]}function w(qe){if(typeof qe=="number"||typeof qe=="boolean"||typeof qe=="string"||qe==null)return JSON.stringify(qe);if(Array.isArray(qe)){let ce="[";for(const ye of qe)ce+=`${w(ye)},`;return`${ce}]`}let oe="{";for(const ce of Object.keys(qe).sort())oe+=`${ce}:${w(qe[ce])},`;return`${oe}}`}function T(qe){let oe="";for(const ce of o.bu)oe+=`/${w(qe[ce])}`;return oe}class M{constructor(oe){this.keyCache={},this._layers={},this._layerConfigs={},oe&&this.replace(oe)}replace(oe,ce){this._layerConfigs={},this._layers={},this.update(oe,[],ce)}update(oe,ce,ye){this._options=ye;for(const xe of oe)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=o.dn(xe,this.scope,null,this._options)).compileFilter(ye),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of ce)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const Ie=function(xe,Fe){const et={};for(let Qe=0;Qe<xe.length;Qe++){const Ot=xe[Qe];let gt=Fe&&Fe[Ot.id];gt||(Ot.type==="symbol"?gt=Ot.id:(gt=T(Ot),Ot.type==="line"&&Ot.paint&&function _r(Tr){return typeof Tr=="string"&&Tr==="line-progress"||(Array.isArray(Tr)?Tr.some(_r):!(!Tr||typeof Tr!="object")&&Object.values(Tr).some(_r))}(Ot.paint["line-width"])&&(gt+=`/${w(Ot.paint["line-width"])}`))),Fe&&(Fe[Ot.id]=gt);let sr=et[gt];sr||(sr=et[gt]=[]),sr.push(Ot)}const Ue=[];for(const Qe in et)Ue.push(et[Qe]);return Ue}(Object.values(this._layerConfigs),this.keyCache);for(const xe of Ie){const Fe=xe.map(sr=>this._layers[sr.id]),et=Fe[0];if(et.visibility==="none")continue;const Ue=et.source||"";let Qe=this.familiesBySource[Ue];Qe||(Qe=this.familiesBySource[Ue]={});const Ot=et.sourceLayer||"_geojsonTileLayer";let gt=Qe[Ot];gt||(gt=Qe[Ot]=[]),gt.push(Fe)}}}const O=1*o.fa;class D{constructor(oe){const ce={},ye=[];for(const et in oe){const Ue=oe[et],Qe=ce[et]={};for(const Ot in Ue.glyphs){const gt=Ue.glyphs[+Ot];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const sr=gt.metrics.localGlyph?O:1,_r={x:0,y:0,w:gt.bitmap.width+2*sr,h:gt.bitmap.height+2*sr};ye.push(_r),Qe[Ot]=_r}}const{w:Ie,h:xe}=o.H(ye),Fe=new o.f9({width:Ie||1,height:xe||1});for(const et in oe){const Ue=oe[et];for(const Qe in Ue.glyphs){const Ot=Ue.glyphs[+Qe];if(!Ot||Ot.bitmap.width===0||Ot.bitmap.height===0)continue;const gt=ce[et][Qe],sr=Ot.metrics.localGlyph?O:1;o.f9.copy(Ot.bitmap,Fe,{x:0,y:0},{x:gt.x+sr,y:gt.y+sr},Ot.bitmap)}}this.image=Fe,this.positions=ce}}o.f8(D,"GlyphAtlas");class B{constructor(oe){this.tileID=new o.aM(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.lut=oe.lut,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.scope=oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.request&&oe.request.collectResourceTiming,this.promoteId=oe.promoteId,this.isSymbolTile=oe.isSymbolTile,this.tileTransform=o.aW(oe.tileID.canonical,oe.projection),this.projection=oe.projection,this.worldview=oe.worldview,this.localizableLayerIds=oe.localizableLayerIds,this.brightness=oe.brightness,this.extraShadowCaster=!!oe.extraShadowCaster,this.tessellationStep=oe.tessellationStep,this.scaleFactor=oe.scaleFactor,this.worldview=oe.worldview}parse(oe,ce,ye,Ie,xe,Fe){this.status="parsing",this.data=oe,this.collisionBoxArray=new o.b0;const et=new o.fb(Object.keys(oe.layers).sort()),Ue=new o.fc(this.tileID,this.promoteId);Ue.bucketLayerIDs=[];const Qe={},Ot=new o.fd(256,256),gt={featureIndex:Ue,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ot,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},sr=[],_r=ce.familiesBySource[this.source];for(const Gr in _r){const zr=oe.layers[Gr];if(!zr)continue;let Hr=!1,Un=!1,Wr=!1;for(const Dn of _r[Gr])Dn[0].type==="symbol"?Hr=!0:Un=!0,Dn[0].is3D()&&Dn[0].type!=="model"&&(Wr=!0);if(this.extraShadowCaster&&!Wr||this.isSymbolTile===!0&&!Hr||this.isSymbolTile===!1&&!Un)continue;zr.version===1&&o.w(`Vector tile source "${this.source}" layer "${Gr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ti=et.encode(Gr),to=[];let Wi=!1;for(let Dn=0,pn=0;Dn<zr.length;Dn++){const bi=zr.feature(Dn),pi=Ue.getId(bi,Gr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Gr)){const ci=bi.properties?bi.properties.worldview:null;if(this.worldview&&typeof ci=="string")if(ci==="all")bi.properties.$localized=!0;else{if(!ci.split(",").includes(this.worldview))continue;bi.properties.$localized=!0,bi.properties.worldview=this.worldview}}!Wi&&bi.properties&&bi.properties.hasOwnProperty(o.fe)&&(Wi=!0),to.push({feature:bi,id:pi,index:pn,sourceLayerIndex:Ti}),pn++}Wi&&!gt.elevationFeatures&&oe.layers.hasOwnProperty(o.ff)&&(gt.elevationFeatures=o.fg.parseFrom(oe.layers[o.ff],this.canonical));for(const Dn of _r[Gr]){const pn=Dn[0];if(this.extraShadowCaster&&(!pn.is3D()||pn.type==="model")||this.isSymbolTile!==void 0&&pn.type==="symbol"!==this.isSymbolTile||pn.minzoom&&this.zoom<Math.floor(pn.minzoom)||pn.maxzoom&&this.zoom>=pn.maxzoom||pn.visibility==="none")continue;N(Dn,this.zoom,gt.brightness,ye,this.worldview);const bi=Qe[pn.id]=pn.createBucket({index:Ue.bucketLayerIDs.length,layers:Dn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ti,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ie,worldview:this.worldview});Ue.bucketLayerIDs.push(Dn.map(ci=>o.C(ci.id,ci.scope)));let pi=bi.prepare?bi.prepare():null;pi!=null?(pi=pi.then(()=>bi.populate(to,gt,this.tileID.canonical,this.tileTransform)),sr.push(pi)):bi.populate(to,gt,this.tileID.canonical,this.tileTransform)}}const Tr=()=>{let Gr,zr,Hr,Un,Wr,Ti;Ot.trim();const to={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Wi=()=>{if(Gr)return this.status="done",Fe(Gr);if(this.extraShadowCaster)this.status="done",Fe(null,{buckets:Object.values(Qe).filter(pn=>!pn.isEmpty()),featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:gt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(zr&&Hr&&Un){const pn=new D(zr),bi=new Map;for(const[wo,Ea]of Hr.entries()){const{imagePosition:qo}=o.fj(wo,Ea,o.fk);bi.set(wo,qo)}const pi={};for(const wo in Qe){const Ea=Qe[wo];Ea instanceof o.b1&&(N(Ea.layers,this.zoom,gt.brightness,ye,this.worldview),pi[wo]=o.fl(Ea,zr,pn.positions,Hr,bi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Wr,this.worldview))}const ci={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(xe,Hr,Wr,()=>{ci.iconsPending=!1,Dn(pi,pn,ci)}),this.rasterizeIfNeeded(xe,Un,Ti,()=>{ci.patternsPending=!1,Dn(pi,pn,ci)})}},Dn=(pn,bi,pi,ci)=>{if(pi.iconsPending||pi.patternsPending)return;const wo=new o.fm(Hr,Un,this.lut);for(const Ea in Qe){const qo=Qe[Ea];if(Ea in pn)o.fn(qo,pn[Ea],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Hr,wo);else if(qo.hasPattern&&(qo instanceof o.b7||qo instanceof o.b8||qo instanceof o.e4)){N(qo.layers,this.zoom,gt.brightness,ye,this.worldview);const If=Object.fromEntries(wo.patternPositions);qo.addFeatures(gt,this.tileID.canonical,If,ye,this.tileTransform,this.brightness)}}this.status="done",Fe(null,{buckets:Object.values(Qe).filter(Ea=>!Ea.isEmpty()),featureIndex:Ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bi.image,lineAtlas:Ot,imageAtlas:wo,brightness:gt.brightness})};if(!this.extraShadowCaster){const pn=o.fh(gt.glyphDependencies,ci=>Object.keys(ci).map(Number));Object.keys(pn).length?xe.send("getGlyphs",{uid:this.uid,stacks:pn},(ci,wo)=>{Gr||(Gr=ci,zr=wo,Wi())},void 0,!1,to):zr={};const bi=Array.from(gt.iconDependencies.keys()).map(ci=>o.I.parse(ci));bi.length?xe.send("getImages",{images:bi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ci,wo)=>{Gr||(Gr=ci,Hr=new Map,Wr=this.updateImageMapAndGetImageTaskQueue(Hr,wo,gt.iconDependencies),Wi())},void 0,!1,to):(Hr=new Map,Wr=new Map);const pi=Array.from(gt.patternDependencies.keys()).map(ci=>o.I.parse(ci));pi.length?xe.send("getImages",{images:pi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ci,wo)=>{Gr||(Gr=ci,Un=new Map,Ti=this.updateImageMapAndGetImageTaskQueue(Un,wo,gt.patternDependencies),Wi())},void 0,!1,to):(Un=new Map,Ti=new Map)}if(gt.elevationFeatures&&gt.elevationFeatures.length>0){const pn=[];for(const pi of Object.values(Qe))if(pi instanceof o.b8){const ci=pi.getUnevaluatedPortalGraph();ci&&pn.push(ci)}const bi=o.fi.evaluate(pn);for(const pi of Object.values(Qe))if(pi instanceof o.b8){const ci=oe.layers[et.decode(pi.sourceLayerIndex)];pi.setEvaluatedPortalGraph(bi,ci,this.tileID.canonical,gt.availableImages,gt.brightness)}}Wi()};sr.length>0?Promise.allSettled(sr).then(Tr).catch(Fe):Tr()}rasterizeIfNeeded(oe,ce,ye,Ie){Array.from(ce.values()).some(xe=>xe.usvg)?this.rasterize(oe,ce,ye,Ie):Ie()}updateImageMapAndGetImageTaskQueue(oe,ce,ye){const Ie=new Map;for(const xe of ce.keys()){const Fe=ye.get(xe)||[];for(const et of Fe){const Ue=et.toString(),Qe=ce.get(et.id.toString());Qe.usvg?Ie.has(Ue)||(Ie.set(Ue,et),oe.set(Ue,Object.assign({},Qe))):oe.set(Ue,Qe)}}return Ie}rasterize(oe,ce,ye,Ie){this.rasterizeTask=oe.send("rasterizeImages",{scope:this.scope,tasks:ye},(xe,Fe)=>{if(!xe)for(const[et,Ue]of Fe.entries()){const Qe=Object.assign(ce.get(et),{data:Ue});ce.set(et,Qe)}Ie()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function N(qe,oe,ce,ye,Ie){const xe=new o.aa(oe,{brightness:ce,worldview:Ie});for(const Fe of qe)Fe.recalculate(xe,ye)}class G extends o.E{constructor(oe,ce,ye,Ie,xe,Fe,et){super(),this.actor=oe,this.layerIndex=ce,this.availableImages=ye,this.availableModels=Ie,this.loadVectorData=Fe||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(oe.scheduler),this.isSpriteLoaded=xe,this.scheduler=oe.scheduler,this.brightness=et}loadTile(oe,ce){const ye=oe.uid,Ie=oe&&oe.request,xe=Ie&&Ie.collectResourceTiming,Fe=this.loading[ye]=new B(oe);Fe.abort=this.loadVectorData(oe,(et,Ue)=>{const Qe=!this.loading[ye];if(delete this.loading[ye],Fe.cancelRasterize(),Qe||et||!Ue)return Fe.status="done",Qe||(this.loaded[ye]=Fe),ce(et);const Ot=Ue.rawData,gt={};Ue.expires&&(gt.expires=Ue.expires),Ue.cacheControl&&(gt.cacheControl=Ue.cacheControl),Fe.vectorTile=Ue.vectorTile||new o.fo(new o.bq(Ot));const sr=()=>{Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(_r,Tr)=>{if(_r||!Tr)return ce(_r);const Gr={};if(xe){const zr=v(Ie);zr.length>0&&(Gr.resourceTiming=JSON.parse(JSON.stringify(zr)))}ce(null,o.h({rawTileData:Ot.slice(0)},Tr,gt,Gr))})};this.isSpriteLoaded?sr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(sr,{type:"parseTile",isSymbolTile:oe.isSymbolTile,zoom:oe.tileZoom}):sr()}),this.loaded=this.loaded||{},this.loaded[ye]=Fe})}reloadTile(oe,ce){const ye=this.loaded,Ie=oe.uid;if(ye&&ye[Ie]){const xe=ye[Ie];xe.scaleFactor=oe.scaleFactor,xe.showCollisionBoxes=oe.showCollisionBoxes,xe.projection=oe.projection,xe.brightness=oe.brightness,xe.tileTransform=o.aW(oe.tileID.canonical,oe.projection),xe.extraShadowCaster=oe.extraShadowCaster,xe.lut=oe.lut,xe.worldview=oe.worldview;const Fe=(et,Ue)=>{const Qe=xe.reloadCallback;Qe&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Qe)),ce(et,Ue)};xe.status==="parsing"?xe.reloadCallback=Fe:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe):Fe())}else ce(null,void 0)}abortTile(oe,ce){const ye=oe.uid,Ie=this.loading[ye];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[ye]),ce()}removeTile(oe,ce){const ye=this.loaded,Ie=oe.uid;ye&&ye[Ie]&&delete ye[Ie],ce()}}class V{loadTile(oe,ce){const{uid:ye,encoding:Ie,rawImageData:xe,padding:Fe}=oe,et=ImageBitmap&&xe instanceof ImageBitmap?this.getImageData(xe,Fe):xe;ce(null,new o.fp(ye,et,Ie,Fe<1))}reloadTile(oe,ce){ce(null,null)}abortTile(oe,ce){ce()}removeTile(oe,ce){ce()}getImageData(oe,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);const ye=this.offscreenCanvasContext.getImageData(-ce,-ce,oe.width+2*ce,oe.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}o.bp.setPbf(o.bq);class U{constructor(oe){this._mrt=new o.bp(oe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=oe.uid,this.tileID=oe.tileID,this.source=oe.source}parse(oe,ce){const ye=this._mrt;this.status="parsing",this._entireBuffer=oe;try{ye.parseHeader(oe),this._isHeaderLoaded=!0;const Ie=[];for(const xe in ye.layers){const Fe=ye.getLayer(xe),et=Fe.getDataRange(Fe.getBandList()),Ue=ye.createDecodingTask(et),Qe=oe.slice(et.firstByte,et.lastByte+1),Ot=o.bp.performDecoding(Qe,Ue).then(gt=>Ue.complete(null,gt)).catch(gt=>Ue.complete(gt,null));Ie.push(Ot)}Promise.allSettled(Ie).then(()=>ce(null,ye)).catch(xe=>ce(xe))}catch(Ie){ce(Ie)}}}class X{constructor(oe){this.actor=oe,this.loading={},this.loaded={}}loadTile(oe,ce){const ye=oe.uid,Ie=oe.request,xe=this.loading[ye]=new U(oe),{cancel:Fe}=o.br(Ie,(et,Ue,Qe,Ot)=>{const gt=!this.loading[ye];if(delete this.loading[ye],gt||et||!Ue)return xe.status="done",gt||(this.loaded[ye]=xe),ce(et);xe.parse(Ue,(sr,_r)=>{if(sr||!_r)return ce(sr);ce(null,_r,Qe,Ot)}),this.loaded[ye]=xe});xe.abort=Fe}reloadTile(oe,ce){ce(null,void 0)}abortTile(oe,ce){const ye=oe.uid,Ie=this.loading[ye];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[ye]),ce()}removeTile(oe,ce){const ye=oe.uid;this.loaded[ye]&&delete this.loaded[ye],ce()}decodeRasterArray(oe,ce){o.bp.performDecoding(oe.buffer,oe.task).then(ye=>ce(null,ye)).catch(ye=>ce(ye))}}const Y=o.fq.prototype.toGeoJSON;class ne{constructor(oe){this._feature=oe,this.extent=o.aj,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const ce of this._feature.geometry)oe.push([new o.P(ce[0],ce[1])]);return oe}{const oe=[];for(const ce of this._feature.geometry){const ye=[];for(const Ie of ce)ye.push(new o.P(Ie[0],Ie[1]));oe.push(ye)}return oe}}toGeoJSON(oe,ce,ye){return Y.call(this,oe,ce,ye)}}class se{constructor(oe,ce){this.name=oe,this.extent=o.aj,this.length=ce.length,this._jsonFeatures=ce}feature(oe){return new ne(this._jsonFeatures[oe])}}class le{constructor(oe){this.layers={},this.extent=o.aj;for(const ce of Object.keys(oe))this.layers[ce]=new se(ce,oe[ce])}}const ge=64/4096,je=128;class ze{constructor(){this.features=new Map}clear(){this.features.clear()}load(oe=[],ce){for(const ye of oe){const Ie=ye.id;if(Ie==null)continue;let xe=this.features.get(Ie);xe&&this.updateCache(xe,ce),ye.geometry?(xe=Ke(ye),this.updateCache(xe,ce),this.features.set(Ie,xe)):this.features.delete(Ie),this.updateCache(xe,ce)}}updateCache(oe,ce){for(const{canonical:ye,uid:Ie}of Object.values(ce)){const{z:xe,x:Fe,y:et}=ye;Ce(oe,Math.pow(2,xe),Fe,et)&&delete ce[Ie]}}getTile(oe,ce,ye){const Ie=Math.pow(2,oe),xe=[];for(const Fe of this.features.values())Ce(Fe,Ie,ce,ye)&&xe.push(He(Fe,Ie,ce,ye));return{features:xe}}getFeatures(){return[...this.features.values()]}}function Ce({minX:qe,minY:oe,maxX:ce,maxY:ye},Ie,xe,Fe){return qe<(xe+1+ge)/Ie&&oe<(Fe+1+ge)/Ie&&ce>(xe-ge)/Ie&&ye>(Fe-ge)/Ie}function Ke(qe){const{id:oe,geometry:ce,properties:ye}=qe;if(!ce)return;if(ce.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ie,coordinates:xe}=ce,Fe={id:oe,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},et=Fe.geometry;if(Ie==="Point")Ye(xe,et,Fe);else if(Ie==="MultiPoint")for(const Ue of xe)Ye(Ue,et,Fe);else if(Ie==="LineString")Fe.type=2,Oe(xe,et,Fe);else if(Ie==="MultiLineString")Fe.type=2,tt(xe,et,Fe);else if(Ie==="Polygon")Fe.type=3,tt(xe,et,Fe,!0);else{if(Ie!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Fe.type=3;for(const Ue of xe)tt(Ue,et,Fe,!0)}return Fe}function Ye([qe,oe],ce,ye){const Ie=o.aD(qe);let xe=o.aH(oe);xe=xe<0?0:xe>1?1:xe,ce.push(Ie,xe),ye.minX=Math.min(ye.minX,Ie),ye.minY=Math.min(ye.minY,xe),ye.maxX=Math.max(ye.maxX,Ie),ye.maxY=Math.max(ye.maxY,xe)}function Oe(qe,oe,ce,ye=!1,Ie=!1){const xe=[];for(const Fe of qe)Ye(Fe,xe,ce);oe.push(xe),ye&&function(Fe,et){let Ue=0;for(let Qe=0,Ot=Fe.length,gt=Ot-2;Qe<Ot;gt=Qe,Qe+=2)Ue+=(Fe[Qe]-Fe[gt])*(Fe[Qe+1]+Fe[gt+1]);if(Ue>0===et)for(let Qe=0,Ot=Fe.length;Qe<Ot/2;Qe+=2){const gt=Fe[Qe],sr=Fe[Qe+1];Fe[Qe]=Fe[Ot-2-Qe],Fe[Qe+1]=Fe[Ot-1-Qe],Fe[Ot-2-Qe]=gt,Fe[Ot-1-Qe]=sr}}(xe,Ie)}function tt(qe,oe,ce,ye=!1){for(let Ie=0;Ie<qe.length;Ie++)Oe(qe[Ie],oe,ce,ye,Ie===0)}function He(qe,oe,ce,ye){const{id:Ie,type:xe,geometry:Fe,tags:et}=qe,Ue=[];if(xe===1)(function(Qe,Ot,gt,sr,_r){for(let Tr=0;Tr<Qe.length;Tr+=2){const Gr=Math.round(o.aj*(Qe[Tr+0]*Ot-gt)),zr=Math.round(o.aj*(Qe[Tr+1]*Ot-sr));_r.push([Gr,zr])}})(Fe,oe,ce,ye,Ue);else for(const Qe of Fe)lt(Qe,oe,ce,ye,Ue);return{id:Ie,type:xe,geometry:Ue,tags:et}}function lt(qe,oe,ce,ye,Ie){const xe=-je,Fe=o.aj+je;let et;for(let Ue=0;Ue<qe.length-2;Ue+=2){let Qe=Math.round(o.aj*(qe[Ue+0]*oe-ce)),Ot=Math.round(o.aj*(qe[Ue+1]*oe-ye)),gt=Math.round(o.aj*(qe[Ue+2]*oe-ce)),sr=Math.round(o.aj*(qe[Ue+3]*oe-ye));const _r=gt-Qe,Tr=sr-Ot;Qe<xe&&gt<xe||(Qe<xe?(Ot+=Math.round(Tr*((xe-Qe)/_r)),Qe=xe):gt<xe&&(sr=Ot+Math.round(Tr*((xe-Qe)/_r)),gt=xe),Ot<xe&&sr<xe||(Ot<xe?(Qe+=Math.round(_r*((xe-Ot)/Tr)),Ot=xe):sr<xe&&(gt=Qe+Math.round(_r*((xe-Ot)/Tr)),sr=xe),Qe>=Fe&&gt>=Fe||(Qe>=Fe?(Ot+=Math.round(Tr*((Fe-Qe)/_r)),Qe=Fe):gt>=Fe&&(sr=Ot+Math.round(Tr*((Fe-Qe)/_r)),gt=Fe),Ot>=Fe&&sr>=Fe||(Ot>=Fe?(Qe+=Math.round(_r*((Fe-Ot)/Tr)),Ot=Fe):sr>=Fe&&(gt=Qe+Math.round(_r*((Fe-Ot)/Tr)),sr=Fe),et&&Qe===et[et.length-1][0]&&Ot===et[et.length-1][1]||(et=[[Qe,Ot]],Ie.push(et)),et.push([gt,sr])))))}}function rt({name:qe,features:oe},ce){ce.writeStringField(1,qe),ce.writeVarintField(5,o.aj);const ye=new Map,Ie=new Map,xe={keys:ye,values:Ie,feature:null};for(const Fe of oe)xe.feature=Fe,ce.writeMessage(2,ht,xe);for(const Fe of ye.keys())ce.writeStringField(3,Fe);for(const Fe of Ie.keys())ce.writeMessage(4,xr,Fe)}function ht(qe,oe){const ce=qe.feature;ce.id===void 0||isNaN(+ce.id)||oe.writeVarintField(1,+ce.id),ce.tags&&oe.writeMessage(2,vt,qe),oe.writeVarintField(3,ce.type),oe.writeMessage(4,Vt,ce)}function vt({keys:qe,values:oe,feature:ce},ye){for(const Ie of Object.keys(ce.tags)){let xe=ce.tags[Ie];if(xe===null)continue;let Fe=qe.get(Ie);Fe===void 0&&(Fe=qe.size,qe.set(Ie,Fe)),ye.writeVarint(Fe);const et=typeof xe;et!=="string"&&et!=="boolean"&&et!=="number"&&(xe=JSON.stringify(xe));let Ue=oe.get(xe);Ue===void 0&&(Ue=oe.size,oe.set(xe,Ue)),ye.writeVarint(Ue)}}function mt(qe,oe){return(oe<<3)+(7&qe)}function ct(qe){return qe<<1^qe>>31}function Vt(qe,oe){const{geometry:ce,type:ye}=qe;let Ie=0,xe=0;if(ye===1){oe.writeVarint(mt(1,ce.length));for(const Fe of ce){const et=Fe[0]-Ie,Ue=Fe[1]-xe;oe.writeVarint(ct(et)),oe.writeVarint(ct(Ue)),Ie+=et,xe+=Ue}}else for(const Fe of ce){oe.writeVarint(mt(1,1));const et=Fe.length-(ye===3?1:0);for(let Ue=0;Ue<et;Ue++){Ue===1&&oe.writeVarint(mt(2,et-1));const Qe=Fe[Ue][0]-Ie,Ot=Fe[Ue][1]-xe;oe.writeVarint(ct(Qe)),oe.writeVarint(ct(Ot)),Ie+=Qe,xe+=Ot}ye===3&&oe.writeVarint(mt(7,1))}}function xr(qe,oe){const ce=typeof qe;ce==="string"?oe.writeStringField(1,qe):ce==="boolean"?oe.writeBooleanField(7,qe):ce==="number"&&(qe%1!=0?oe.writeDoubleField(3,qe):qe<0?oe.writeSVarintField(6,qe):oe.writeVarintField(5,qe))}const tn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:qe=>qe},Er=Math.fround||(Ft=new Float32Array(1),qe=>(Ft[0]=+qe,Ft[0]));var Ft;const br=3,Yt=5,Qt=6;class Sr{constructor(oe){this.options=Object.assign(Object.create(tn),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:ce,minZoom:ye,maxZoom:Ie}=this.options;ce&&console.time("total time");const xe=`prepare ${oe.length} points`;ce&&console.time(xe),this.points=oe;const Fe=[];for(let Ue=0;Ue<oe.length;Ue++){const Qe=oe[Ue];if(!Qe.geometry)continue;const[Ot,gt]=Qe.geometry.coordinates,sr=Er(Jr(Ot)),_r=Er(Kr(gt));Fe.push(sr,_r,1/0,Ue,-1,1),this.options.reduce&&Fe.push(0)}let et=this.trees[Ie+1]=this._createTree(Fe);ce&&console.timeEnd(xe);for(let Ue=Ie;Ue>=ye;Ue--){const Qe=+Date.now();et=this.trees[Ue]=this._createTree(this._cluster(et,Ue)),ce&&console.log("z%d: %d clusters in %dms",Ue,et.numItems,+Date.now()-Qe)}return ce&&console.timeEnd("total time"),this}getClusters(oe,ce){let ye=((oe[0]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,oe[1]));let xe=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)ye=-180,xe=180;else if(ye>xe){const gt=this.getClusters([ye,Ie,180,Fe],ce),sr=this.getClusters([-180,Ie,xe,Fe],ce);return gt.concat(sr)}const et=this.trees[this._limitZoom(ce)],Ue=et.range(Jr(ye),Kr(Fe),Jr(xe),Kr(Ie)),Qe=et.data,Ot=[];for(const gt of Ue){const sr=this.stride*gt;Ot.push(Qe[sr+Yt]>1?Ut(Qe,sr,this.clusterProps):this.points[Qe[sr+br]])}return Ot}getChildren(oe){const ce=this._getOriginId(oe),ye=this._getOriginZoom(oe),Ie="No cluster with the specified id.",xe=this.trees[ye];if(!xe)throw new Error(Ie);const Fe=xe.data;if(ce*this.stride>=Fe.length)throw new Error(Ie);const et=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),Ue=xe.within(Fe[ce*this.stride],Fe[ce*this.stride+1],et),Qe=[];for(const Ot of Ue){const gt=Ot*this.stride;Fe[gt+4]===oe&&Qe.push(Fe[gt+Yt]>1?Ut(Fe,gt,this.clusterProps):this.points[Fe[gt+br]])}if(Qe.length===0)throw new Error(Ie);return Qe}getLeaves(oe,ce,ye){const Ie=[];return this._appendLeaves(Ie,oe,ce=ce||10,ye=ye||0,0),Ie}getTile(oe,ce,ye){const Ie=this.trees[this._limitZoom(oe)],xe=Math.pow(2,oe),{extent:Fe,radius:et}=this.options,Ue=et/Fe,Qe=(ye-Ue)/xe,Ot=(ye+1+Ue)/xe,gt={features:[]};return this._addTileFeatures(Ie.range((ce-Ue)/xe,Qe,(ce+1+Ue)/xe,Ot),Ie.data,ce,ye,xe,gt),ce===0&&this._addTileFeatures(Ie.range(1-Ue/xe,Qe,1,Ot),Ie.data,xe,ye,xe,gt),ce===xe-1&&this._addTileFeatures(Ie.range(0,Qe,Ue/xe,Ot),Ie.data,-1,ye,xe,gt),gt.features.length?gt:null}getClusterExpansionZoom(oe){let ce=this._getOriginZoom(oe)-1;for(;ce<=this.options.maxZoom;){const ye=this.getChildren(oe);if(ce++,ye.length!==1)break;oe=ye[0].properties.cluster_id}return ce}_appendLeaves(oe,ce,ye,Ie,xe){const Fe=this.getChildren(ce);for(const et of Fe){const Ue=et.properties;if(Ue&&Ue.cluster?xe+Ue.point_count<=Ie?xe+=Ue.point_count:xe=this._appendLeaves(oe,Ue.cluster_id,ye,Ie,xe):xe<Ie?xe++:oe.push(et),oe.length===ye)break}return xe}_createTree(oe){const ce=new o.c0(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<oe.length;ye+=this.stride)ce.add(oe[ye],oe[ye+1]);return ce.finish(),ce.data=oe,ce}_addTileFeatures(oe,ce,ye,Ie,xe,Fe){for(const et of oe){const Ue=et*this.stride,Qe=ce[Ue+Yt]>1;let Ot,gt,sr;if(Qe)Ot=Nn(ce,Ue,this.clusterProps),gt=ce[Ue],sr=ce[Ue+1];else{const Gr=this.points[ce[Ue+br]];Ot=Gr.properties;const[zr,Hr]=Gr.geometry.coordinates;gt=Jr(zr),sr=Kr(Hr)}const _r={type:1,geometry:[[Math.round(this.options.extent*(gt*xe-ye)),Math.round(this.options.extent*(sr*xe-Ie))]],tags:Ot};let Tr;Tr=Qe||this.options.generateId?ce[Ue+br]:this.points[ce[Ue+br]].id,Tr!==void 0&&(_r.id=Tr),Fe.features.push(_r)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,ce){const{radius:ye,extent:Ie,reduce:xe,minPoints:Fe}=this.options,et=ye/(Ie*Math.pow(2,ce)),Ue=oe.data,Qe=[],Ot=this.stride;for(let gt=0;gt<Ue.length;gt+=Ot){if(Ue[gt+2]<=ce)continue;Ue[gt+2]=ce;const sr=Ue[gt],_r=Ue[gt+1],Tr=oe.within(Ue[gt],Ue[gt+1],et),Gr=Ue[gt+Yt];let zr=Gr;for(const Hr of Tr){const Un=Hr*Ot;Ue[Un+2]>ce&&(zr+=Ue[Un+Yt])}if(zr>Gr&&zr>=Fe){let Hr,Un=sr*Gr,Wr=_r*Gr,Ti=-1;const to=(gt/Ot<<5)+(ce+1)+this.points.length;for(const Wi of Tr){const Dn=Wi*Ot;if(Ue[Dn+2]<=ce)continue;Ue[Dn+2]=ce;const pn=Ue[Dn+Yt];Un+=Ue[Dn]*pn,Wr+=Ue[Dn+1]*pn,Ue[Dn+4]=to,xe&&(Hr||(Hr=this._map(Ue,gt,!0),Ti=this.clusterProps.length,this.clusterProps.push(Hr)),xe(Hr,this._map(Ue,Dn)))}Ue[gt+4]=to,Qe.push(Un/zr,Wr/zr,1/0,to,-1,zr),xe&&Qe.push(Ti)}else{for(let Hr=0;Hr<Ot;Hr++)Qe.push(Ue[gt+Hr]);if(zr>1)for(const Hr of Tr){const Un=Hr*Ot;if(!(Ue[Un+2]<=ce)){Ue[Un+2]=ce;for(let Wr=0;Wr<Ot;Wr++)Qe.push(Ue[Un+Wr])}}}}return Qe}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,ce,ye){if(oe[ce+Yt]>1){const Fe=this.clusterProps[oe[ce+Qt]];return ye?Object.assign({},Fe):Fe}const Ie=this.points[oe[ce+br]].properties,xe=this.options.map(Ie);return ye&&xe===Ie?Object.assign({},xe):xe}}function Ut(qe,oe,ce){return{type:"Feature",id:qe[oe+br],properties:Nn(qe,oe,ce),geometry:{type:"Point",coordinates:[(ye=qe[oe],360*(ye-.5)),In(qe[oe+1])]}};var ye}function Nn(qe,oe,ce){const ye=qe[oe+Yt],Ie=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,xe=qe[oe+Qt],Fe=xe===-1?{}:Object.assign({},ce[xe]);return Object.assign(Fe,{cluster:!0,cluster_id:qe[oe+br],point_count:ye,point_count_abbreviated:Ie})}function Jr(qe){return qe/360+.5}function Kr(qe){const oe=Math.sin(qe*Math.PI/180),ce=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ce<0?0:ce>1?1:ce}function In(qe){const oe=(180-360*qe)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function Fi(qe,oe,ce,ye){let Ie=ye;const xe=oe+(ce-oe>>1);let Fe,et=ce-oe;const Ue=qe[oe],Qe=qe[oe+1],Ot=qe[ce],gt=qe[ce+1];for(let sr=oe+3;sr<ce;sr+=3){const _r=$o(qe[sr],qe[sr+1],Ue,Qe,Ot,gt);if(_r>Ie)Fe=sr,Ie=_r;else if(_r===Ie){const Tr=Math.abs(sr-xe);Tr<et&&(Fe=sr,et=Tr)}}Ie>ye&&(Fe-oe>3&&Fi(qe,oe,Fe,ye),qe[Fe+2]=Ie,ce-Fe>3&&Fi(qe,Fe,ce,ye))}function $o(qe,oe,ce,ye,Ie,xe){let Fe=Ie-ce,et=xe-ye;if(Fe!==0||et!==0){const Ue=((qe-ce)*Fe+(oe-ye)*et)/(Fe*Fe+et*et);Ue>1?(ce=Ie,ye=xe):Ue>0&&(ce+=Fe*Ue,ye+=et*Ue)}return Fe=qe-ce,et=oe-ye,Fe*Fe+et*et}function Co(qe,oe,ce,ye){const Ie={id:qe??null,type:oe,geometry:ce,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Hi(Ie,ce);else if(oe==="Polygon")Hi(Ie,ce[0]);else if(oe==="MultiLineString")for(const xe of ce)Hi(Ie,xe);else if(oe==="MultiPolygon")for(const xe of ce)Hi(Ie,xe[0]);return Ie}function Hi(qe,oe){for(let ce=0;ce<oe.length;ce+=3)qe.minX=Math.min(qe.minX,oe[ce]),qe.minY=Math.min(qe.minY,oe[ce+1]),qe.maxX=Math.max(qe.maxX,oe[ce]),qe.maxY=Math.max(qe.maxY,oe[ce+1])}function Bi(qe,oe,ce,ye){if(!oe.geometry)return;const Ie=oe.geometry.coordinates;if(Ie&&Ie.length===0)return;const xe=oe.geometry.type,Fe=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let et=[],Ue=oe.id;if(ce.promoteId?Ue=oe.properties[ce.promoteId]:ce.generateId&&(Ue=ye||0),xe==="Point")wa(Ie,et);else if(xe==="MultiPoint")for(const Qe of Ie)wa(Qe,et);else if(xe==="LineString")xo(Ie,et,Fe,!1);else if(xe==="MultiLineString"){if(ce.lineMetrics){for(const Qe of Ie)et=[],xo(Qe,et,Fe,!1),qe.push(Co(Ue,"LineString",et,oe.properties));return}$l(Ie,et,Fe,!1)}else if(xe==="Polygon")$l(Ie,et,Fe,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const Qe of oe.geometry.geometries)Bi(qe,{id:Ue,geometry:Qe,properties:oe.properties},ce,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Qe of Ie){const Ot=[];$l(Qe,Ot,Fe,!0),et.push(Ot)}}qe.push(Co(Ue,xe,et,oe.properties))}function wa(qe,oe){oe.push(kc(qe[0]),Ci(qe[1]),0)}function xo(qe,oe,ce,ye){let Ie,xe,Fe=0;for(let Ue=0;Ue<qe.length;Ue++){const Qe=kc(qe[Ue][0]),Ot=Ci(qe[Ue][1]);oe.push(Qe,Ot,0),Ue>0&&(Fe+=ye?(Ie*Ot-Qe*xe)/2:Math.sqrt(Math.pow(Qe-Ie,2)+Math.pow(Ot-xe,2))),Ie=Qe,xe=Ot}const et=oe.length-3;oe[2]=1,Fi(oe,0,et,ce),oe[et+2]=1,oe.size=Math.abs(Fe),oe.start=0,oe.end=oe.size}function $l(qe,oe,ce,ye){for(let Ie=0;Ie<qe.length;Ie++){const xe=[];xo(qe[Ie],xe,ce,ye),oe.push(xe)}}function kc(qe){return qe/360+.5}function Ci(qe){const oe=Math.sin(qe*Math.PI/180),ce=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ce<0?0:ce>1?1:ce}function bo(qe,oe,ce,ye,Ie,xe,Fe,et){if(ye/=oe,xe>=(ce/=oe)&&Fe<ye)return qe;if(Fe<ce||xe>=ye)return null;const Ue=[];for(const Qe of qe){const Ot=Qe.geometry;let gt=Qe.type;const sr=Ie===0?Qe.minX:Qe.minY,_r=Ie===0?Qe.maxX:Qe.maxY;if(sr>=ce&&_r<ye){Ue.push(Qe);continue}if(_r<ce||sr>=ye)continue;let Tr=[];if(gt==="Point"||gt==="MultiPoint")ju(Ot,Tr,ce,ye,Ie);else if(gt==="LineString")Xs(Ot,Tr,ce,ye,Ie,!1,et.lineMetrics);else if(gt==="MultiLineString")Po(Ot,Tr,ce,ye,Ie,!1);else if(gt==="Polygon")Po(Ot,Tr,ce,ye,Ie,!0);else if(gt==="MultiPolygon")for(const Gr of Ot){const zr=[];Po(Gr,zr,ce,ye,Ie,!0),zr.length&&Tr.push(zr)}if(Tr.length){if(et.lineMetrics&&gt==="LineString"){for(const Gr of Tr)Ue.push(Co(Qe.id,gt,Gr,Qe.tags));continue}gt!=="LineString"&&gt!=="MultiLineString"||(Tr.length===1?(gt="LineString",Tr=Tr[0]):gt="MultiLineString"),gt!=="Point"&&gt!=="MultiPoint"||(gt=Tr.length===3?"Point":"MultiPoint"),Ue.push(Co(Qe.id,gt,Tr,Qe.tags))}}return Ue.length?Ue:null}function ju(qe,oe,ce,ye,Ie){for(let xe=0;xe<qe.length;xe+=3){const Fe=qe[xe+Ie];Fe>=ce&&Fe<=ye&&sa(oe,qe[xe],qe[xe+1],qe[xe+2])}}function Xs(qe,oe,ce,ye,Ie,xe,Fe){let et=Ys(qe);const Ue=Ie===0?Ts:la;let Qe,Ot,gt=qe.start;for(let zr=0;zr<qe.length-3;zr+=3){const Hr=qe[zr],Un=qe[zr+1],Wr=qe[zr+2],Ti=qe[zr+3],to=qe[zr+4],Wi=Ie===0?Hr:Un,Dn=Ie===0?Ti:to;let pn=!1;Fe&&(Qe=Math.sqrt(Math.pow(Hr-Ti,2)+Math.pow(Un-to,2))),Wi<ce?Dn>ce&&(Ot=Ue(et,Hr,Un,Ti,to,ce),Fe&&(et.start=gt+Qe*Ot)):Wi>ye?Dn<ye&&(Ot=Ue(et,Hr,Un,Ti,to,ye),Fe&&(et.start=gt+Qe*Ot)):sa(et,Hr,Un,Wr),Dn<ce&&Wi>=ce&&(Ot=Ue(et,Hr,Un,Ti,to,ce),pn=!0),Dn>ye&&Wi<=ye&&(Ot=Ue(et,Hr,Un,Ti,to,ye),pn=!0),!xe&&pn&&(Fe&&(et.end=gt+Qe*Ot),oe.push(et),et=Ys(qe)),Fe&&(gt+=Qe)}let sr=qe.length-3;const _r=qe[sr],Tr=qe[sr+1],Gr=Ie===0?_r:Tr;Gr>=ce&&Gr<=ye&&sa(et,_r,Tr,qe[sr+2]),sr=et.length-3,xe&&sr>=3&&(et[sr]!==et[0]||et[sr+1]!==et[1])&&sa(et,et[0],et[1],et[2]),et.length&&oe.push(et)}function Ys(qe){const oe=[];return oe.size=qe.size,oe.start=qe.start,oe.end=qe.end,oe}function Po(qe,oe,ce,ye,Ie,xe){for(const Fe of qe)Xs(Fe,oe,ce,ye,Ie,xe,!1)}function sa(qe,oe,ce,ye){qe.push(oe,ce,ye)}function Ts(qe,oe,ce,ye,Ie,xe){const Fe=(xe-oe)/(ye-oe);return sa(qe,xe,ce+(Ie-ce)*Fe,1),Fe}function la(qe,oe,ce,ye,Ie,xe){const Fe=(xe-ce)/(Ie-ce);return sa(qe,oe+(ye-oe)*Fe,xe,1),Fe}function Js(qe,oe){const ce=[];for(let ye=0;ye<qe.length;ye++){const Ie=qe[ye],xe=Ie.type;let Fe;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Fe=Sa(Ie.geometry,oe);else if(xe==="MultiLineString"||xe==="Polygon"){Fe=[];for(const et of Ie.geometry)Fe.push(Sa(et,oe))}else if(xe==="MultiPolygon"){Fe=[];for(const et of Ie.geometry){const Ue=[];for(const Qe of et)Ue.push(Sa(Qe,oe));Fe.push(Ue)}}ce.push(Co(Ie.id,xe,Fe,Ie.tags))}return ce}function Sa(qe,oe){const ce=[];ce.size=qe.size,qe.start!==void 0&&(ce.start=qe.start,ce.end=qe.end);for(let ye=0;ye<qe.length;ye+=3)ce.push(qe[ye]+oe,qe[ye+1],qe[ye+2]);return ce}function Cc(qe,oe){if(qe.transformed)return qe;const ce=1<<qe.z,ye=qe.x,Ie=qe.y;for(const xe of qe.features){const Fe=xe.geometry,et=xe.type;if(xe.geometry=[],et===1)for(let Ue=0;Ue<Fe.length;Ue+=2)xe.geometry.push(Yn(Fe[Ue],Fe[Ue+1],oe,ce,ye,Ie));else for(let Ue=0;Ue<Fe.length;Ue++){const Qe=[];for(let Ot=0;Ot<Fe[Ue].length;Ot+=2)Qe.push(Yn(Fe[Ue][Ot],Fe[Ue][Ot+1],oe,ce,ye,Ie));xe.geometry.push(Qe)}}return qe.transformed=!0,qe}function Yn(qe,oe,ce,ye,Ie,xe){return[Math.round(ce*(qe*ye-Ie)),Math.round(ce*(oe*ye-xe))]}function Pc(qe,oe,ce,ye,Ie){const xe=oe===Ie.maxZoom?0:Ie.tolerance/((1<<oe)*Ie.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:qe.length,source:null,x:ce,y:ye,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of qe)Mc(Fe,et,xe,Ie);return Fe}function Mc(qe,oe,ce,ye){const Ie=oe.geometry,xe=oe.type,Fe=[];if(qe.minX=Math.min(qe.minX,oe.minX),qe.minY=Math.min(qe.minY,oe.minY),qe.maxX=Math.max(qe.maxX,oe.maxX),qe.maxY=Math.max(qe.maxY,oe.maxY),xe==="Point"||xe==="MultiPoint")for(let et=0;et<Ie.length;et+=3)Fe.push(Ie[et],Ie[et+1]),qe.numPoints++,qe.numSimplified++;else if(xe==="LineString")Ta(Fe,Ie,qe,ce,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let et=0;et<Ie.length;et++)Ta(Fe,Ie[et],qe,ce,xe==="Polygon",et===0);else if(xe==="MultiPolygon")for(let et=0;et<Ie.length;et++){const Ue=Ie[et];for(let Qe=0;Qe<Ue.length;Qe++)Ta(Fe,Ue[Qe],qe,ce,!0,Qe===0)}if(Fe.length){let et=oe.tags||null;if(xe==="LineString"&&ye.lineMetrics){et={};for(const Qe in oe.tags)et[Qe]=oe.tags[Qe];et.mapbox_clip_start=Ie.start/Ie.size,et.mapbox_clip_end=Ie.end/Ie.size}const Ue={geometry:Fe,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:et};oe.id!==null&&(Ue.id=oe.id),qe.features.push(Ue)}}function Ta(qe,oe,ce,ye,Ie,xe){const Fe=ye*ye;if(ye>0&&oe.size<(Ie?Fe:ye))return void(ce.numPoints+=oe.length/3);const et=[];for(let Ue=0;Ue<oe.length;Ue+=3)(ye===0||oe[Ue+2]>Fe)&&(ce.numSimplified++,et.push(oe[Ue],oe[Ue+1])),ce.numPoints++;Ie&&function(Ue,Qe){let Ot=0;for(let gt=0,sr=Ue.length,_r=sr-2;gt<sr;_r=gt,gt+=2)Ot+=(Ue[gt]-Ue[_r])*(Ue[gt+1]+Ue[_r+1]);if(Ot>0===Qe)for(let gt=0,sr=Ue.length;gt<sr/2;gt+=2){const _r=Ue[gt],Tr=Ue[gt+1];Ue[gt]=Ue[sr-2-gt],Ue[gt+1]=Ue[sr-1-gt],Ue[sr-2-gt]=_r,Ue[sr-1-gt]=Tr}}(et,xe),qe.push(et)}const Gl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Es{constructor(oe,ce){const ye=(ce=this.options=function(xe,Fe){for(const et in Fe)xe[et]=Fe[et];return xe}(Object.create(Gl),ce)).debug;if(ye&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ie=function(xe,Fe){const et=[];if(xe.type==="FeatureCollection")for(let Ue=0;Ue<xe.features.length;Ue++)Bi(et,xe.features[Ue],Fe,Ue);else Bi(et,xe.type==="Feature"?xe:{geometry:xe},Fe);return et}(oe,ce);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ie=function(xe,Fe){const et=Fe.buffer/Fe.extent;let Ue=xe;const Qe=bo(xe,1,-1-et,et,0,-1,2,Fe),Ot=bo(xe,1,1-et,2+et,0,-1,2,Fe);return(Qe||Ot)&&(Ue=bo(xe,1,-et,1+et,0,-1,2,Fe)||[],Qe&&(Ue=Js(Qe,1).concat(Ue)),Ot&&(Ue=Ue.concat(Js(Ot,-1)))),Ue}(Ie,ce),Ie.length&&this.splitTile(Ie,0,0,0),ye&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,ce,ye,Ie,xe,Fe,et){const Ue=[oe,ce,ye,Ie],Qe=this.options,Ot=Qe.debug;for(;Ue.length;){Ie=Ue.pop(),ye=Ue.pop(),ce=Ue.pop(),oe=Ue.pop();const gt=1<<ce,sr=Ic(ce,ye,Ie);let _r=this.tiles[sr];if(!_r&&(Ot>1&&console.time("creation"),_r=this.tiles[sr]=Pc(oe,ce,ye,Ie,Qe),this.tileCoords.push({z:ce,x:ye,y:Ie}),Ot)){Ot>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ye,Ie,_r.numFeatures,_r.numPoints,_r.numSimplified),console.timeEnd("creation"));const pn=`z${ce}`;this.stats[pn]=(this.stats[pn]||0)+1,this.total++}if(_r.source=oe,xe==null){if(ce===Qe.indexMaxZoom||_r.numPoints<=Qe.indexMaxPoints)continue}else{if(ce===Qe.maxZoom||ce===xe)continue;if(xe!=null){const pn=xe-ce;if(ye!==Fe>>pn||Ie!==et>>pn)continue}}if(_r.source=null,oe.length===0)continue;Ot>1&&console.time("clipping");const Tr=.5*Qe.buffer/Qe.extent,Gr=.5-Tr,zr=.5+Tr,Hr=1+Tr;let Un=null,Wr=null,Ti=null,to=null,Wi=bo(oe,gt,ye-Tr,ye+zr,0,_r.minX,_r.maxX,Qe),Dn=bo(oe,gt,ye+Gr,ye+Hr,0,_r.minX,_r.maxX,Qe);oe=null,Wi&&(Un=bo(Wi,gt,Ie-Tr,Ie+zr,1,_r.minY,_r.maxY,Qe),Wr=bo(Wi,gt,Ie+Gr,Ie+Hr,1,_r.minY,_r.maxY,Qe),Wi=null),Dn&&(Ti=bo(Dn,gt,Ie-Tr,Ie+zr,1,_r.minY,_r.maxY,Qe),to=bo(Dn,gt,Ie+Gr,Ie+Hr,1,_r.minY,_r.maxY,Qe),Dn=null),Ot>1&&console.timeEnd("clipping"),Ue.push(Un||[],ce+1,2*ye,2*Ie),Ue.push(Wr||[],ce+1,2*ye,2*Ie+1),Ue.push(Ti||[],ce+1,2*ye+1,2*Ie),Ue.push(to||[],ce+1,2*ye+1,2*Ie+1)}}getTile(oe,ce,ye){oe=+oe,ce=+ce,ye=+ye;const Ie=this.options,{extent:xe,debug:Fe}=Ie;if(oe<0||oe>24)return null;const et=1<<oe,Ue=Ic(oe,ce=ce+et&et-1,ye);if(this.tiles[Ue])return Cc(this.tiles[Ue],xe);Fe>1&&console.log("drilling down to z%d-%d-%d",oe,ce,ye);let Qe,Ot=oe,gt=ce,sr=ye;for(;!Qe&&Ot>0;)Ot--,gt>>=1,sr>>=1,Qe=this.tiles[Ic(Ot,gt,sr)];return Qe&&Qe.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",Ot,gt,sr),console.time("drilling down")),this.splitTile(Qe.source,Ot,gt,sr,oe,ce,ye),Fe>1&&console.timeEnd("drilling down"),this.tiles[Ue]?Cc(this.tiles[Ue],xe):null):null}}function Ic(qe,oe,ce){return 32*((1<<qe)*ce+oe)+qe}function ut(qe,oe){const ce=qe.tileID.canonical;if(!this._geoJSONIndex)return void oe(null,null);const ye=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!ye)return void oe(null,null);const Ie=Qe=>Qe.tags&&"3d_elevation_id"in Qe.tags&&"source"in Qe.tags&&Qe.tags.source==="elevation",xe=ye.features.filter(Qe=>Ie(Qe));let Fe={_geojsonTileLayer:ye.features};xe.length>0&&(Fe={_geojsonTileLayer:ye.features.filter(Qe=>!Ie(Qe)),hd_road_elevation:xe});const et=new le(Fe),Ue=function(Qe){const Ot=new o.bq;for(const gt of Object.keys(Qe))Ot.writeMessage(3,rt,{name:gt,features:Qe[gt]});return Ot.finish()}(Fe).buffer;oe(null,{vectorTile:et,rawData:Ue})}class Wn extends G{constructor(oe,ce,ye,Ie,xe,Fe,et){super(oe,ce,ye,Ie,xe,ut,et),Fe&&(this.loadGeoJSON=Fe),this._dynamicIndex=new ze}loadData(oe,ce){const ye=oe&&oe.request,Ie=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(oe,(xe,Fe)=>{if(xe||!Fe)return ce(xe);if(typeof Fe!="object")return ce(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{try{if(oe.filter){const Ue=o.X(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));Fe.features=Fe.features.filter(Qe=>Ue.value.evaluate({zoom:0},Qe))}oe.dynamic?(Fe.type==="Feature"&&(Fe={type:"FeatureCollection",features:[Fe]}),oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Fe.features,this.loaded),oe.cluster&&(Fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=oe.cluster?new Sr(function({superclusterOptions:Ue,clusterProperties:Qe}){if(!Qe||!Ue)return Ue;const Ot={},gt={},sr={accumulated:null,zoom:0},_r={properties:null},Tr=Object.keys(Qe);for(const Gr of Tr){const[zr,Hr]=Qe[Gr],Un=o.X(Hr),Wr=o.X(typeof zr=="string"?[zr,["accumulated"],["get",Gr]]:zr);Ot[Gr]=Un.value,gt[Gr]=Wr.value}return Ue.map=Gr=>{_r.properties=Gr;const zr={};for(const Hr of Tr)zr[Hr]=Ot[Hr].evaluate(sr,_r);return zr},Ue.reduce=(Gr,zr)=>{_r.properties=zr;for(const Hr of Tr)sr.accumulated=Gr[Hr],Gr[Hr]=gt[Hr].evaluate(sr,_r)},Ue}(oe)).load(Fe.features):oe.dynamic?this._dynamicIndex:function(Ue,Qe){return new Es(Ue,Qe)}(Fe,oe.geojsonVtOptions)}catch(Ue){return ce(Ue)}const et={};if(Ie){const Ue=v(ye);Ue&&(et.resourceTiming={},et.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Ue)))}ce(null,et)}})}reloadTile(oe,ce){const ye=this.loaded;return ye&&ye[oe.uid]?oe.partial?ce(null,void 0):super.reloadTile(oe,ce):this.loadTile(oe,ce)}loadGeoJSON(oe,ce){if(oe.request)o.n(oe.request,ce);else{if(typeof oe.data!="string")return ce(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ce(null,JSON.parse(oe.data))}catch{return ce(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(oe,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(ye){ce(ye)}}getClusterChildren(oe,ce){try{ce(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(ye){ce(ye)}}getClusterLeaves(oe,ce){try{ce(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(ye){ce(ye)}}}class Pi{constructor(oe,ce,ye){this.tileID=new o.aM(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=oe.projection,this.brightness=ce,this.worldview=ye}parse(oe,ce,ye,Ie){this.status="parsing";const xe=new o.aM(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Fe=[],et=ce.familiesBySource[ye.source],Ue=new o.fc(xe,ye.promoteId);Ue.bucketLayerIDs=[],Ue.is3DTile=!0,o.fr(oe).then(Qe=>{if(!Qe)return Ie(new Error("Could not parse tile"));const Ot=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Qe.json.asset.extras&&Qe.json.asset.extras.MAPBOX_mesh_features,gt=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("EXT_meshopt_compression"),sr=new o.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const _r in et)for(const Tr of et[_r]){const Gr=Tr[0];Ue.bucketLayerIDs.push(Tr.map(Un=>o.C(Un.id,Un.scope))),Gr.recalculate(sr,[]);const zr=o.fs(Qe,1/o.d4(ye.tileID.canonical)),Hr=new o.ft(Tr,zr,xe,Ot,gt,this.brightness,Ue,this.worldview);Ot||(Hr.needsUpload=!0),Fe.push(Hr),Hr.evaluate(Gr)}this.status="done",Ie(null,{buckets:Fe,featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Qe=>Ie(new Error(Qe.message)))}}class Go{constructor(oe,ce,ye,Ie,xe,Fe,et,Ue){this.actor=oe,this.layerIndex=ce,this.availableImages=ye,this.availableModels=Ie,this.brightness=et,this.loading={},this.loaded={},this.worldview=Ue}loadTile(oe,ce){const ye=oe.uid,Ie=this.loading[ye]=new Pi(oe,this.brightness,this.worldview);o.br(oe.request,(xe,Fe)=>{const et=!this.loading[ye];return delete this.loading[ye],et||xe?(Ie.status="done",et||(this.loaded[ye]=Ie),ce(xe)):Fe&&Fe.byteLength!==0?void Ie.parse(Fe,this.layerIndex,oe,(Ue,Qe)=>{Ie.status="done",this.loaded=this.loaded||{},this.loaded[ye]=Ie,Ue||!Qe?ce(Ue):ce(null,Qe)}):(Ie.status="done",this.loaded[ye]=Ie,ce())})}reloadTile(oe,ce){const ye=this.loaded,Ie=oe.uid;if(ye&&ye[Ie]){const xe=ye[Ie];xe.projection=oe.projection,xe.brightness=oe.brightness;const Fe=(et,Ue)=>{xe.reloadCallback&&(delete xe.reloadCallback,this.loadTile(oe,ce)),ce(et,Ue)};xe.status==="parsing"?xe.reloadCallback=Fe:xe.status==="done"&&this.loadTile(oe,ce)}}abortTile(oe,ce){const ye=oe.uid;this.loading[ye]&&delete this.loading[ye],ce()}removeTile(oe,ce){const ye=this.loaded,Ie=oe.uid;ye&&ye[Ie]&&delete ye[Ie],ce()}}class Br{constructor(oe){this.self=oe,this.actor=new o.fv(oe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cj({name:"mercator"}),this.workerSourceTypes={vector:G,geojson:Wn,"raster-dem":V,"raster-array":X,"batched-model":Go},this.workerSources={},this.self.registerWorkerSource=(ce,ye)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=ye},this.self.registerRTLTextPlugin=ce=>{if(o.fw.isParsed())throw new Error("RTL text plugin already registered.");o.fw.setState({pluginStatus:o.fx.parsed,pluginURL:o.fw.getPluginURL()}),o.fw.applyArabicShaping=ce.applyArabicShaping,o.fw.processBidirectionalText=ce.processBidirectionalText,o.fw.processStyledBidirectionalText=ce.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(oe,ce,ye){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.availableModels[oe],delete this.workerSources[oe],ye()}checkIfReady(oe,ce,ye){ye()}setReferrer(oe,ce){this.referrer=ce}spriteLoaded(oe,ce){this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={});const{scope:ye,isLoaded:Ie}=ce;if(this.isSpriteLoaded[oe][ye]=Ie,this.workerSources[oe]&&this.workerSources[oe][ye])for(const xe in this.workerSources[oe][ye]){const Fe=this.workerSources[oe][ye][xe];for(const et in Fe){const Ue=Fe[et];Ue instanceof G&&(Ue.isSpriteLoaded=Ie,Ue.fire(new o.A("isSpriteLoaded")))}}}setImages(oe,ce,ye){this.availableImages[oe]||(this.availableImages[oe]={});const{scope:Ie,images:xe}=ce;if(this.availableImages[oe][Ie]=xe,this.workerSources[oe]&&this.workerSources[oe][Ie]){for(const Fe in this.workerSources[oe][Ie]){const et=this.workerSources[oe][Ie][Fe];for(const Ue in et)et[Ue].availableImages=xe}ye()}else ye()}setModels(oe,{scope:ce,models:ye},Ie){if(this.availableModels[oe]||(this.availableModels[oe]={}),this.availableModels[oe][ce]=ye,this.workerSources[oe]&&this.workerSources[oe][ce]){for(const xe in this.workerSources[oe][ce]){const Fe=this.workerSources[oe][ce][xe];for(const et in Fe)Fe[et].availableModels=ye}Ie()}else Ie()}setProjection(oe,ce){this.projections[oe]=o.cj(ce)}setBrightness(oe,ce,ye){this.brightness=ce,ye()}setWorldview(oe,ce,ye){this.worldview=ce,ye()}setLayers(oe,ce,ye){this.getLayerIndex(oe,ce.scope).replace(ce.layers,ce.options),ye()}updateLayers(oe,ce,ye){this.getLayerIndex(oe,ce.scope).update(ce.layers,ce.removedIds,ce.options),ye()}loadTile(oe,ce,ye){ce.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,ce.type,ce.source,ce.scope).loadTile(ce,ye)}decodeRasterArray(oe,ce,ye){this.getWorkerSource(oe,ce.type,ce.source,ce.scope).decodeRasterArray(ce,ye)}reloadTile(oe,ce,ye){ce.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,ce.type,ce.source,ce.scope).reloadTile(ce,ye)}abortTile(oe,ce,ye){this.getWorkerSource(oe,ce.type,ce.source,ce.scope).abortTile(ce,ye)}removeTile(oe,ce,ye){this.getWorkerSource(oe,ce.type,ce.source,ce.scope).removeTile(ce,ye)}removeSource(oe,ce,ye){if(!(this.workerSources[oe]&&this.workerSources[oe][ce.scope]&&this.workerSources[oe][ce.scope][ce.type]&&this.workerSources[oe][ce.scope][ce.type][ce.source]))return;const Ie=this.workerSources[oe][ce.scope][ce.type][ce.source];delete this.workerSources[oe][ce.scope][ce.type][ce.source],Ie.removeSource!==void 0?Ie.removeSource(ce,ye):ye()}loadWorkerSource(oe,ce,ye){try{this.self.importScripts(ce.url),ye()}catch(Ie){ye(Ie.toString())}}syncRTLPluginState(oe,ce,ye){if(o.fw.isParsed())ye(null,!0);else if(o.fw.isParsing())this.rtlPluginParsingListeners.push(ye);else try{o.fw.setState(ce);const Ie=o.fw.getPluginURL();!o.fw.isLoaded()||o.fw.isParsed()||o.fw.isParsing()||Ie==null||(o.fw.setState({pluginStatus:o.fx.parsing,pluginURL:o.fw.getPluginURL()}),this.self.importScripts(Ie),o.fw.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(Ie){ye(Ie.toString())}}setDracoUrl(oe,ce){this.dracoUrl=ce}getAvailableImages(oe,ce){this.availableImages[oe]||(this.availableImages[oe]={});let ye=this.availableImages[oe][ce];return ye||(ye=[]),ye}getAvailableModels(oe,ce){this.availableModels[oe]||(this.availableModels[oe]={});let ye=this.availableModels[oe][ce];return ye||(ye={}),ye}getLayerIndex(oe,ce){this.layerIndexes[oe]||(this.layerIndexes[oe]={});let ye=this.layerIndexes[oe][ce];return ye||(ye=this.layerIndexes[oe][ce]=new M,ye.scope=ce),ye}getWorkerSource(oe,ce,ye,Ie){const xe=this.workerSources;return xe[oe]||(xe[oe]={}),xe[oe][Ie]||(xe[oe][Ie]={}),xe[oe][Ie][ce]||(xe[oe][Ie][ce]={}),this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),xe[oe][Ie][ce][ye]||(xe[oe][Ie][ce][ye]=new this.workerSourceTypes[ce]({send:(Fe,et,Ue,Qe,Ot,gt)=>this.actor.send(Fe,et,Ue,oe,Ot,gt),scheduler:this.actor.scheduler},this.getLayerIndex(oe,Ie),this.getAvailableImages(oe,Ie),this.getAvailableModels(oe,Ie),this.isSpriteLoaded[oe][Ie],void 0,this.brightness,this.worldview)),xe[oe][Ie][ce][ye]}rasterizeImagesWorker(oe,ce,ye){const Ie=new Map;for(const[xe,{image:Fe,imageVariant:et}]of ce.tasks.entries()){const Ue=this.imageRasterizer.rasterize(et,Fe,ce.scope,oe);Ie.set(xe,Ue)}ye(void 0,Ie)}removeRasterizedImages(oe,ce,ye){this.imageRasterizer.removeImagesFromCacheByIds(ce.imageIds,ce.scope,oe),ye()}enforceCacheSizeLimit(oe,ce){o.fy(ce)}getWorkerPerformanceMetrics(oe,ce,ye){ye(void 0,void 0)}}return o.fu(self)&&(self.worker=new Br(self)),Br}),h(["./shared"],function(o){var v="3.14.0";const w={create:"create",load:"load",fullLoad:"fullLoad"},T={mark(m){performance.mark(m)},measure(m,a,u){performance.measure(m,a,u)}};function M(m){const a=m.name.split("?")[0];return o.a(a)&&a.includes("mapbox-gl.js")?"javascript":o.a(a)&&a.includes("mapbox-gl.css")?"css":o.b(a)?"fontRange":o.c(a)?"sprite":o.i(a)?"style":o.d(a)?"tilejson":"other"}var O,D={},B=function(){if(O)return D;function m(g){return!a(g)}function a(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,E,P=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(P);try{E=new Worker(I),b=!0}catch{b=!1}return E&&E.terminate(),URL.revokeObjectURL(I),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var E=b.getContext("2d");if(!E)return!1;var P=E.getImageData(0,0,1,1);return P&&P.width===b.width}()?(u[x=g&&g.failIfMajorPerformanceCaveat]===void 0&&(u[x]=function(b){var E,P=function(I){var z=document.createElement("canvas"),F=Object.create(m.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=I,z.getContext("webgl2",F)}(b);if(!P)return!1;try{E=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!E||P.isContextLost())&&(P.shaderSource(E,"void main() {}"),P.compileShader(E),P.getShaderParameter(E,P.COMPILE_STATUS)===!0)}(x)),u[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}O=1,D.supported=m,D.notSupportedReason=a;var u={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},D}();function N(m,a,u){const g=document.createElement(m);return a!=null&&(g.className=a),u&&u.appendChild(g),g}function G(m,a,u){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(a))g.setAttributeNS(null,x,String(a[x]));return u&&u.appendChild(g),g}const V=typeof document<"u"?document.documentElement&&document.documentElement.style:null,U=V&&V.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;function Y(){V&&U&&(X=V[U],V[U]="none")}function ne(){V&&U&&(V[U]=X)}function se(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",se,!0)}function le(){window.addEventListener("click",se,!0),window.setTimeout(()=>{window.removeEventListener("click",se,!0)},0)}function ge(m,a){const u=m.getBoundingClientRect();return Ce(m,u,a)}function je(m,a){const u=m.getBoundingClientRect(),g=[];for(let x=0;x<a.length;x++)g.push(Ce(m,u,a[x]));return g}function ze(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function Ce(m,a,u){const g=m.offsetWidth===a.width?1:m.offsetWidth/a.width;return new o.P((u.clientX-a.left)*g,(u.clientY-a.top)*g)}const Ke="01",Ye="NO_ACCESS_TOKEN";class Oe{constructor(a,u,g){this._transformRequestFn=a,this._customAccessToken=u,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const a=function(){let u="";for(let g=0;g<10;g++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ke,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}}normalizeStyleURL(a,u){if(!o.j(a))return a;const g=He(a);return g.params.push(`sdk=js-${v}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeGlyphsURL(a,u){if(!o.j(a))return a;const g=He(a);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeModelURL(a,u){if(!o.j(a))return a;const g=He(a);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeSourceURL(a,u,g,x){if(!o.j(a))return a;const b=He(a);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),g&&b.params.push(`language=${g}`),x&&b.params.push(`worldview=${x}`),this._makeAPIURL(b,this._customAccessToken||u)}normalizeIconsetURL(a,u){const g=He(a);return o.j(a)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||u)):lt(g)}normalizeSpriteURL(a,u,g,x){const b=He(a);return o.j(a)?(b.path=`/styles/v1${b.path}/sprite${u}${g}`,this._makeAPIURL(b,this._customAccessToken||x)):(b.path+=`${u}${g}`,lt(b))}normalizeTileURL(a,u,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!o.j(a))return a;const x=He(a);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||g&&x.authority!=="raster"&&g===512?"@2x":""}${o.l.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${o.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${o.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${o.e.TILE_URL_VERSION}${x.path}`);const b=this._customAccessToken||function(E){for(const P of E){const I=P.match(/^access_token=(.*)$/);if(I)return I[1]}return null}(x.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,b)}canonicalizeTileURL(a,u){const g=He(a);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return a;let x="mapbox://";g.path.match(/^\/raster\/v1\//)?x+=`raster/${g.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${g.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${g.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let b=g.params;return u&&(b=b.filter(E=>!E.match(/^access_token=/))),b.length&&(x+=`?${b.join("&")}`),x}canonicalizeTileset(a,u){const g=!!u&&o.j(u),x=[];for(const b of a.tiles||[])o.k(b)?x.push(this.canonicalizeTileURL(b,g)):x.push(b);return x}_makeAPIURL(a,u){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=He(o.e.API_URL);if(a.protocol=x.protocol,a.authority=x.authority,a.protocol==="http"){const b=a.params.indexOf("secure");b>=0&&a.params.splice(b,1)}if(x.path!=="/"&&(a.path=`${x.path}${a.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return lt(a);if(u=u||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return a.params=a.params.filter(b=>b.indexOf("access_token")===-1),a.params.push(`access_token=${u||""}`),lt(a)}}const tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function He(m){const a=m.match(tt);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function lt(m){const a=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${a}`}const rt="mapbox.eventData";function ht(m){if(!m)return null;const a=m.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(o.m(a[1]))}catch{return null}}class vt{constructor(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(a){const u=ht(o.e.ACCESS_TOKEN);let g="";return g=u&&u.u?o.f(u.u):o.e.ACCESS_TOKEN||"",a?`${rt}.${a}:${g}`:`${rt}:${g}`}fetchEventData(){const a=o.s("localStorage"),u=this.getStorageKey(),g=this.getStorageKey("uuid");if(a)try{const x=localStorage.getItem(u);x&&(this.eventData=JSON.parse(x));const b=localStorage.getItem(g);b&&(this.anonId=b)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const a=o.s("localStorage"),u=this.getStorageKey(),g=this.getStorageKey("uuid"),x=this.anonId;if(a&&x)try{localStorage.setItem(g,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(u,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(a){}postEvent(a,u,g,x){if(!o.e.EVENTS_URL)return;const b=He(o.e.EVENTS_URL);b.params.push(`access_token=${x||o.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(a).toISOString()},P=u?o.h(E,u):E,I={url:lt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=o.p(I,z=>{this.pendingRequest=null,g(z),this.saveEventData(),this.processRequests(x)})}queueRequest(a,u){this.queue.push(a),this.processRequests(u)}}const mt=new class extends vt{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,a){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(u=>o.j(u)||o.k(u))&&this.queueRequest(Date.now(),a)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const a=ht(o.e.ACCESS_TOKEN),u=a?a.u:o.e.ACCESS_TOKEN;let g=u!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),g=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),E=new Date(x),P=(x-this.eventData.lastSuccess)/864e5;g=g||P>=1||P<-1||b.getDate()!==E.getDate()}else g=!0;g?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ke,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=x,this.eventData.tokenU=u)},m):this.processRequests()}},ct=mt.postTurnstileEvent.bind(mt),Vt=new class extends vt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,a,u,g){this.skuToken=a,this.errorCb=g,o.e.EVENTS_URL&&(u||o.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(Ye)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:u}=this.queue.shift();a&&this.success[a]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ke,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):a&&(this.success[a]=!0)},m))}remove(){this.errorCb=null}},xr=Vt.postMapLoadEvent.bind(Vt),tn=new class extends vt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let a=this.mapInstanceIdMap.get(m);return a||(a=o.u(),this.mapInstanceIdMap.set(m,a)),a}getEventId(m){const a=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,a+1),a}postStyleLoadEvent(m,a){const{map:u,style:g,importedStyles:x}=a;if(!o.e.EVENTS_URL||!m&&!o.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(u),E={mapInstanceId:b,eventId:this.getEventId(b),style:g};x.length&&(E.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:E},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,payload:u}=this.queue.shift();this.postEvent(a,u,()=>{},m)}},Er=tn.postStyleLoadEvent.bind(tn),Ft=new class extends vt{constructor(){super("gljs.performance")}postPerformanceEvent(m,a){o.e.EVENTS_URL&&(m||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:a},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,performanceData:u}=this.queue.shift(),g=function(x){const b=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),P=function(K){const te={};if(K){for(const ee in K)if(ee!=="other")for(const re of K[ee]){const ie=`${ee}ResolveRangeMin`,ue=`${ee}ResolveRangeMax`,pe=`${ee}RequestCount`,me=`${ee}RequestCachedCount`;te[ie]=Math.min(te[ie]||1/0,re.startTime),te[ue]=Math.max(te[ue]||-1/0,re.responseEnd);const Te=we=>{te[we]===void 0&&(te[we]=0),++te[we]};re.transferSize!==void 0&&re.transferSize===0&&Te(me),Te(pe)}}return te}(function(K,te){const ee={};if(K)for(const re of K){const ie=te(re);ee[ie]===void 0&&(ee[ie]=[]),ee[ie].push(re)}return ee}(b,M)),I=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=z?z.effectiveType:void 0,q={counters:[],metadata:[],attributes:[]},$=(K,te,ee)=>{ee!=null&&K.push({name:te,value:ee.toString()})};for(const K in P)$(q.counters,K,P[K]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&($(q.counters,"interactionRangeMin",x.interactionRange[0]),$(q.counters,"interactionRangeMax",x.interactionRange[1])),E)for(const K of Object.keys(w)){const te=w[K],ee=E.find(re=>re.name===te);ee&&$(q.counters,te,ee.startTime)}return $(q.counters,"visibilityHidden",x.visibilityHidden),$(q.attributes,"style",function(K){if(K)for(const te of K){const ee=te.name.split("?")[0];if(o.i(ee)){const re=ee.split("/").slice(-2);if(re.length===2)return`mapbox://styles/${re[0]}/${re[1]}`}}}(b)),$(q.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),$(q.attributes,"fogEnabled",x.fogEnabled?"true":"false"),$(q.attributes,"projection",x.projection),$(q.attributes,"zoom",x.zoom),$(q.metadata,"devicePixelRatio",I),$(q.metadata,"connectionEffectiveType",F),$(q.metadata,"navigatorUserAgent",navigator.userAgent),$(q.metadata,"screenWidth",window.screen.width),$(q.metadata,"screenHeight",window.screen.height),$(q.metadata,"windowWidth",window.innerWidth),$(q.metadata,"windowHeight",window.innerHeight),$(q.metadata,"mapWidth",x.width/I),$(q.metadata,"mapHeight",x.height/I),$(q.metadata,"webglRenderer",x.renderer),$(q.metadata,"webglVendor",x.vendor),$(q.metadata,"sdkVersion",v),$(q.metadata,"sdkIdentifier","mapbox-gl-js"),q}(u);for(const x of g.metadata);for(const x of g.counters);for(const x of g.attributes);this.postEvent(a,g,()=>{},m)}},br=Ft.postPerformanceEvent.bind(Ft),Yt=new class extends vt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,a,u,g){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const x=He(o.e.API_URL+o.e.SESSION_PATH);x.params.push(`sku=${a||""}`),x.params.push(`access_token=${g||o.e.ACCESS_TOKEN||""}`);const b={url:lt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(b,E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,a,u,g){this.skuToken=a,this.errorCb=g,o.e.SESSION_PATH&&o.e.API_URL&&(u||o.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(Ye)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:u}=this.queue.shift();a&&this.success[a]||this.getSession(u,this.skuToken,g=>{g?this.errorCb(g):a&&(this.success[a]=!0)},m)}remove(){this.errorCb=null}},Qt=Yt.getSessionAPI.bind(Yt),Sr=new Set;function Ut(m,a){a?Sr.add(m):Sr.delete(m)}class Nn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,u){this._updatedSourceCaches[a]=u,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){const u=a.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(a.id),this.setDirty()}removeLayer(a){const u=a.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][a.id]=a,this._updatedLayers[u].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){const a={};for(const u in this._updatedLayers)a[u]=a[u]||{},a[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)a[u]=a[u]||{},a[u].removedIds=Object.keys(this._removedLayers[u]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(a){return this._updatedImages[a]?Array.from(this._updatedImages[a].values()):[]}updateImage(a,u){this._updatedImages[u]=this._updatedImages[u]||new Set,this._updatedImages[u].add(o.I.toString(a)),this.setDirty()}resetUpdatedImages(a){this._updatedImages[a]&&this._updatedImages[a].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Jr(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class Kr extends o.E{constructor(a){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=a,a!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(a){this.loaded.set(a,!1),this.imageProviders.set(a,new Map),this.images.set(a,new Map),this.updatedImages.set(a,new Set),this.callbackDispatchedThisFrame.set(a,new Set),this.patterns.set(a,new Map),this.atlasImage.set(a,new o.r({width:1,height:1}))}removeScope(a){this.loaded.delete(a),this.imageProviders.delete(a),this.images.delete(a),this.updatedImages.delete(a),this.callbackDispatchedThisFrame.delete(a),this.patterns.delete(a),this.atlasImage.delete(a);const u=this.atlasTexture.get(a);u&&(u.destroy(),this.atlasTexture.delete(a))}addImageProvider(a,u){this.imageProviders.has(u)||this.imageProviders.set(u,new Map),this.imageProviders.get(u).set(a.id,a)}removeImageProvider(a,u){this.imageProviders.has(u)&&this.imageProviders.get(u).delete(a)}getPendingImageProviders(){const a=[];for(const u of this.imageProviders.values())for(const g of u.values())g.hasPendingRequests()&&a.push(g);return a}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const a of this.loaded.keys())if(!this.loaded.get(a))return!1;return!0}setLoaded(a,u){if(this.loaded.get(u)!==a&&(this.loaded.set(u,a),a)){for(const{ids:g,callback:x}of this.requestors)this._notify(g,u,x);this.requestors=[]}}hasImage(a,u){return!!this.getImage(a,u)}getImage(a,u){return this.images.get(u).get(a.toString())}addImage(a,u,g){this._validate(a,g)&&this.images.get(u).set(a.toString(),g)}_validate(a,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new o.z(new Error(`Image "${a.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new o.z(new Error(`Image "${a.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new o.z(new Error(`Image "${a.name}" has invalid "content" value`))),g=!1),g}_validateStretch(a,u){if(!a)return!0;let g=0;for(const x of a){if(x[0]<g||x[1]<x[0]||u<x[1])return!1;g=x[1]}return!0}_validateContent(a,u){return a?a.length!==4||!u.usvg&&(a[0]<0||u.data.width<a[0]||a[1]<0||u.data.height<a[1]||a[2]<0||u.data.width<a[2]||a[3]<0||u.data.height<a[3])?!1:!(a[2]<a[0]||a[3]<a[1]):!0}updateImage(a,u,g){const x=this.images.get(u).get(a.toString());g.version=x.version+1,this.images.get(u).set(a.toString(),g),this.updatedImages.get(u).add(a),this.removeFromImageRasterizerCache(a,u)}clearUpdatedImages(a){this.updatedImages.get(a).clear()}removeFromImageRasterizerCache(a,u){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[a],scope:u}):this.imageRasterizer.removeImagesFromCacheByIds([a],u))}removeImage(a,u){const g=this.images.get(u),x=g.get(a.toString());g.delete(a.toString()),this.patterns.get(u).delete(a.toString()),this.removeFromImageRasterizerCache(a,u),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(a){return Array.from(this.images.get(a).keys()).map(u=>o.I.from(u))}getImages(a,u,g){const x=[],b=[],E=this.imageProviders.get(u);for(const F of a){if(!F.iconsetId){x.push(F);continue}const q=E.get(F.iconsetId);q&&(this.getImage(F,u)?b.push(F):q.addPendingRequest(F))}if(x.length===0)return void this._notify(b,u,g);let P=!0;const I=!!this.loaded.get(u),z=this.images.get(u);if(!I)for(const F of x)z.has(F.toString())||(P=!1);I||P?this._notify(x,u,g):this.requestors.push({ids:x,scope:u,callback:g})}rasterizeImages(a,u){const g=new Map,{tasks:x,scope:b}=a;for(const[E,P]of x.entries()){const I=this.getImage(P.id,b);I&&g.set(E,{image:I,imageVariant:P})}this._rasterizeImages(b,g,u)}_rasterizeImages(a,u,g){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:u,scope:a},g);else{const x=new Map;for(const[b,{image:E,imageVariant:P}]of u.entries())x.set(b,this.imageRasterizer.rasterize(P,E,a,0));g(void 0,x)}}getUpdatedImages(a){return this.updatedImages.get(a)||new Set}_notify(a,u,g){const x=this.images.get(u),b=new Map;for(const E of a){if(!x.get(E.toString())){if(E.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:E.name}))}const P=x.get(E.toString());if(!P){o.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const I={data:P.usvg?null:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,usvg:P.usvg,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:!!(P.userImage&&P.userImage.render)};P.usvg&&Object.assign(I,{width:P.icon.usvg_tree.width,height:P.icon.usvg_tree.height}),b.set(o.I.toString(E),I)}g(null,b)}getPixelSize(a){const{width:u,height:g}=this.atlasImage.get(a);return{width:u,height:g}}getPattern(a,u,g){const x=a.toString(),b=this.patterns.get(u),E=b.get(x),P=this.getImage(a,u);if(!P)return null;if(E){if(E.position.version===P.version)return E.position;E.position.version=P.version}else{if(P.usvg&&!P.data){const I=this.getPatternInFlightId(x,u);if(this.patternsInFlight.has(I))return null;this.patternsInFlight.add(I);const z=new o.B(a).scaleSelf(o.q.devicePixelRatio),F=new Map([[z.toString(),{image:P,imageVariant:z}]]);return this._rasterizeImages(u,F,(q,$)=>this.storePatternImage(z,u,P,g,$)),null}this.storePattern(a,u,P)}return this._updatePatternAtlas(u,g),b.get(x).position}getPatternInFlightId(a,u){return o.C(a,u)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(a,u,g,x,b){const E=a.toString(),P=b?b.get(E):void 0;P&&(g.data=P,this.storePattern(a.id,u,g),this._updatePatternAtlas(u,x),this.patternsInFlight.delete(this.getPatternInFlightId(a.id.toString(),u)))}storePattern(a,u,g){const x={w:g.data.width+2*o.F,h:g.data.height+2*o.F,x:0,y:0},b=new o.G(x,g,o.F);this.patterns.get(u).set(a.toString(),{bin:x,position:b})}destroyAtlasTextures(){for(const a of this.atlasTexture.values())a&&a.destroy();this.atlasTexture.clear()}bind(a,u){const g=a.gl;let x=this.atlasTexture.get(u);x?this.dirty&&(x.update(this.atlasImage.get(u)),this.dirty=!1):(x=new o.T(a,this.atlasImage.get(u),g.RGBA8),this.atlasTexture.set(u,x)),x.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(a,u){const g=this.patterns.get(a),x=Array.from(g.values()).map(({bin:z})=>z),{w:b,h:E}=o.H(x),P=this.atlasImage.get(a);P.resize({width:b||1,height:E||1});const I=this.images.get(a);for(const[z,{bin:F,position:q}]of g.entries()){let $=q.padding;const K=F.x+$,te=F.y+$,ee=I.get(z).data,re=ee.width,ie=ee.height;$=$>1?$-1:$,o.r.copy(ee,P,{x:0,y:0},{x:K,y:te},{width:re,height:ie},u),o.r.copy(ee,P,{x:0,y:ie-$},{x:K,y:te-$},{width:re,height:$},u),o.r.copy(ee,P,{x:0,y:0},{x:K,y:te+ie},{width:re,height:$},u),o.r.copy(ee,P,{x:re-$,y:0},{x:K-$,y:te},{width:$,height:ie},u),o.r.copy(ee,P,{x:0,y:0},{x:K+re,y:te},{width:$,height:ie},u),o.r.copy(ee,P,{x:re-$,y:ie-$},{x:K-$,y:te-$},{width:$,height:$},u),o.r.copy(ee,P,{x:0,y:ie-$},{x:K+re,y:te-$},{width:$,height:$},u),o.r.copy(ee,P,{x:0,y:0},{x:K+re,y:te+ie},{width:$,height:$},u),o.r.copy(ee,P,{x:re-$,y:0},{x:K-$,y:te+ie},{width:$,height:$},u)}this.dirty=!0}beginFrame(){for(const a of this.images.keys())this.callbackDispatchedThisFrame.set(a,new Set)}dispatchRenderCallbacks(a,u){const g=this.images.get(u);for(const x of a){if(this.callbackDispatchedThisFrame.get(u).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(u).add(x.toString());const b=g.get(x.toString());Jr(b)&&this.updateImage(x,u,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function In(m){const a=m.key,u=m.value,g=m.valueSpec||{},x=m.objectElementValidators||{},b=m.style,E=m.styleSpec;let P=[];const I=o.J(u);if(I!=="object")return[new o.V(a,u,`object expected, ${I} found`)];for(const z in u){const F=z.split(".")[0];let q;x[F]?q=x[F]:g[F]?q=Yn:x["*"]?q=x["*"]:g["*"]&&(q=Yn),q?P=P.concat(q({key:(a&&`${a}.`)+z,value:u[z],valueSpec:g[F]||g["*"],style:b,styleSpec:E,object:u,objectKey:z},u)):P.push(new o.K(a,u[z],`unknown property "${z}"`))}for(const z in g)x[z]||g[z].required&&g[z].default===void 0&&u[z]===void 0&&P.push(new o.V(a,u,`missing required property "${z}"`));return P}function Fi(m){const a=m.value,u=m.valueSpec,g=m.style,x=m.styleSpec,b=m.key,E=m.arrayElementValidator||Yn;if(o.J(a)!=="array")return[new o.V(b,a,`array expected, ${o.J(a)} found`)];if(u.length&&a.length!==u.length)return[new o.V(b,a,`array length ${u.length} expected, length ${a.length} found`)];if(u["min-length"]&&a.length<u["min-length"])return[new o.V(b,a,`array length at least ${u["min-length"]} expected, length ${a.length} found`)];let P={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};x.$version<7&&(P.function=u.function),o.J(u.value)==="object"&&(P=u.value);let I=[];for(let z=0;z<a.length;z++)I=I.concat(E({array:a,arrayIndex:z,value:a[z],valueSpec:P,style:g,styleSpec:x,key:`${b}[${z}]`},!0));return I}function $o(m){const a=m.key,u=m.value,g=m.valueSpec;let x=o.J(u);if(x==="number"&&u!=u&&(x="NaN"),x!=="number")return[new o.V(a,u,`number expected, ${x} found`)];if("minimum"in g){let b=g.minimum;if(o.J(g.minimum)==="array"&&(b=g.minimum[m.arrayIndex]),u<b)return[new o.V(a,u,`${u} is less than the minimum value ${b}`)]}if("maximum"in g){let b=g.maximum;if(o.J(g.maximum)==="array"&&(b=g.maximum[m.arrayIndex]),u>b)return[new o.V(a,u,`${u} is greater than the maximum value ${b}`)]}return[]}function Co(m){const a=m.valueSpec,u=o.M(m.value.type);let g,x,b,E={};const P=u!=="categorical"&&m.value.property===void 0,I=!P,z=o.J(m.value.stops)==="array"&&o.J(m.value.stops[0])==="array"&&o.J(m.value.stops[0][0])==="object",F=In({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(K){if(u==="identity")return[new o.V(K.key,K.value,'identity function may not have a "stops" property')];let te=[];const ee=K.value;return te=te.concat(Fi({key:K.key,value:ee,valueSpec:K.valueSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:q})),o.J(ee)==="array"&&ee.length===0&&te.push(new o.V(K.key,ee,"array must have at least one stop")),te},default:function(K){return Yn({key:K.key,value:K.value,valueSpec:a,style:K.style,styleSpec:K.styleSpec})}}});return u==="identity"&&P&&F.push(new o.V(m.key,m.value,'missing required property "property"')),u==="identity"||m.value.stops||F.push(new o.V(m.key,m.value,'missing required property "stops"')),u==="exponential"&&m.valueSpec.expression&&!o.N(m.valueSpec)&&F.push(new o.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(I&&!o.O(m.valueSpec)?F.push(new o.V(m.key,m.value,"property functions not supported")):P&&!o.Q(m.valueSpec)&&F.push(new o.V(m.key,m.value,"zoom functions not supported"))),u!=="categorical"&&!z||m.value.property!==void 0||F.push(new o.V(m.key,m.value,'"property" property is required')),F;function q(K){let te=[];const ee=K.value,re=K.key;if(o.J(ee)!=="array")return[new o.V(re,ee,`array expected, ${o.J(ee)} found`)];if(ee.length!==2)return[new o.V(re,ee,`array length 2 expected, length ${ee.length} found`)];if(z){if(o.J(ee[0])!=="object")return[new o.V(re,ee,`object expected, ${o.J(ee[0])} found`)];if(ee[0].zoom===void 0)return[new o.V(re,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new o.V(re,ee,"object stop key must have value")];const ie=o.M(ee[0].zoom);if(typeof ie!="number")return[new o.V(re,ee[0].zoom,"stop zoom values must be numbers")];if(b&&b>ie)return[new o.V(re,ee[0].zoom,"stop zoom values must appear in ascending order")];ie!==b&&(b=ie,x=void 0,E={}),te=te.concat(In({key:`${re}[0]`,value:ee[0],valueSpec:{zoom:{}},style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:$o,value:$}}))}else te=te.concat($({key:`${re}[0]`,value:ee[0],style:K.style,styleSpec:K.styleSpec},ee));return o.S(o.U(ee[1]))?te.concat([new o.V(`${re}[1]`,ee[1],"expressions are not allowed in function stops.")]):te.concat(Yn({key:`${re}[1]`,value:ee[1],valueSpec:a,style:K.style,styleSpec:K.styleSpec}))}function $(K,te){const ee=o.J(K.value),re=o.M(K.value),ie=K.value!==null?K.value:te;if(g){if(ee!==g)return[new o.V(K.key,ie,`${ee} stop domain type must match previous stop domain type ${g}`)]}else g=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new o.V(K.key,ie,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&u!=="categorical"){let ue=`number expected, ${ee} found`;return o.O(a)&&u===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(K.key,ie,ue)]}return u!=="categorical"||ee!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?u!=="categorical"&&ee==="number"&&typeof re=="number"&&typeof x=="number"&&x!==void 0&&re<x?[new o.V(K.key,ie,"stop domain values must appear in ascending order")]:(x=re,u==="categorical"&&re in E?[new o.V(K.key,ie,"stop domain values must be unique")]:(E[re]=!0,[])):[new o.V(K.key,ie,`integer expected, found ${String(re)}`)]}}function Hi(m){const a=(m.expressionContext==="property"?o.W:o.X)(o.U(m.value),m.valueSpec);if(a.result==="error")return a.value.map(g=>new o.V(`${m.key}${g.key}`,m.value,g.message));const u=a.value.expression||a.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!u.outputDefined())return[new o.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!o.Y(u))return[new o.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return Bi(u,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!o.Z(u,["zoom","feature-state"]))return[new o.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!o._(u))return[new o.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bi(m,a){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(const x of a.valueSpec.expression.parameters)u.delete(x);if(u.size===0)return[];const g=[];return m instanceof o.$&&u.has(m.name)?[new o.V(a.key,a.value,`["${m.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(m.eachChild(x=>{g.push(...Bi(x,a))}),g)}function wa(m){const a=m.key,u=m.value,g=m.valueSpec,x=[];return Array.isArray(g.values)?g.values.indexOf(o.M(u))===-1&&x.push(new o.V(a,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(o.M(u))===-1&&x.push(new o.V(a,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),x}function xo(m){return o.a1(o.U(m.value))?Hi(o.L({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):$l(m)}function $l(m){const a=m.value,u=m.key;if(o.J(a)!=="array")return[new o.V(u,a,`array expected, ${o.J(a)} found`)];const g=m.styleSpec;let x,b=[];if(a.length<1)return[new o.V(u,a,"filter array must have at least 1 element")];switch(b=b.concat(wa({key:`${u}[0]`,value:a[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),o.M(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&o.M(a[1])==="$type"&&b.push(new o.V(u,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&b.push(new o.V(u,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(x=o.J(a[1]),x!=="string"&&b.push(new o.V(`${u}[1]`,a[1],`string expected, ${x} found`)));for(let E=2;E<a.length;E++)x=o.J(a[E]),o.M(a[1])==="$type"?b=b.concat(wa({key:`${u}[${E}]`,value:a[E],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&b.push(new o.V(`${u}[${E}]`,a[E],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let E=1;E<a.length;E++)b=b.concat($l({key:`${u}[${E}]`,value:a[E],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":x=o.J(a[1]),a.length!==2?b.push(new o.V(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):x!=="string"&&b.push(new o.V(`${u}[1]`,a[1],`string expected, ${x} found`))}return b}function kc(m,a){const u=m.key,g=m.style,x=m.layer,b=m.styleSpec,E=m.value,P=m.objectKey,I=b[`${a}_${m.layerType}`];if(!I)return[];const z=P.match(/^(.*)-use-theme$/);if(a==="paint"&&z&&I[z[1]])return o.S(E)?[].concat(Yn({key:m.key,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:b,expressionContext:"property",propertyType:a,propertyKey:P})):Yn({key:u,value:E,valueSpec:{type:"string"},style:g,styleSpec:b});const F=P.match(/^(.*)-transition$/);if(a==="paint"&&F&&I[F[1]]&&I[F[1]].transition)return Yn({key:u,value:E,valueSpec:b.transition,style:g,styleSpec:b});const q=m.valueSpec||I[P];if(!q)return[new o.K(u,E,`unknown property "${P}"`)];let $;if(o.J(E)==="string"&&o.O(q)&&!q.tokens&&($=/^{([^}]+)}$/.exec(E))){const te=`\`{ "type": "identity", "property": ${$?JSON.stringify($[1]):'"_"'} }\``;return[new o.V(u,E,`"${P}" does not support interpolation syntax
Use an identity property function instead: ${te}.`)]}const K=[];if(m.layerType==="symbol")P!=="text-field"||!g||g.glyphs||g.imports||K.push(new o.V(u,E,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&o.a2(o.U(E))&&o.M(E.type)==="identity"&&K.push(new o.V(u,E,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&a==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&o.O(q)&&(o.a3(q)||o.Q(q))){const te=o.W(o.U(E),q),ee=te.value.expression||te.value._styleExpression.expression;ee&&!o.Z(ee,["measure-light"])&&(P==="model-emissive-strength"&&o._(ee)&&o.Y(ee)||K.push(new o.V(u,E,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return K.concat(Yn({key:m.key,value:E,valueSpec:q,style:g,styleSpec:b,expressionContext:"property",propertyType:a,propertyKey:P}))}function Ci(m){return kc(m,"paint")}function bo(m){return kc(m,"layout")}function ju(m){let a=[];const u=m.value,g=m.key,x=m.style,b=m.styleSpec;u.type||u.ref||a.push(new o.V(g,u,'either "type" or "ref" is required'));let E=o.M(u.type);const P=o.M(u.ref);if(u.id){const I=o.M(u.id);for(let z=0;z<m.arrayIndex;z++){const F=x.layers[z];o.M(F.id)===I&&a.push(new o.V(g,u.id,`duplicate layer id "${u.id}", previously used at line ${F.id.__line__}`))}}if("ref"in u){let I;["type","source","source-layer","filter","layout"].forEach(z=>{z in u&&a.push(new o.V(g,u[z],`"${z}" is prohibited for ref layers`))}),x.layers.forEach(z=>{o.M(z.id)===P&&(I=z)}),I?I.ref?a.push(new o.V(g,u.ref,"ref cannot reference another ref layer")):E=o.M(I.type):typeof P=="string"&&a.push(new o.V(g,u.ref,`ref layer "${P}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(u.source){const I=x.sources&&x.sources[u.source],z=I&&o.M(I.type);I?z==="vector"&&E==="raster"?a.push(new o.V(g,u.source,`layer "${u.id}" requires a raster source`)):z==="raster"&&E!=="raster"?a.push(new o.V(g,u.source,`layer "${u.id}" requires a vector source`)):z!=="vector"||u["source-layer"]?z==="raster-dem"&&E!=="hillshade"?a.push(new o.V(g,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&u.paint&&(u.paint["line-gradient"]||u.paint["line-trim-offset"])&&z==="geojson"&&!I.lineMetrics?a.push(new o.V(g,u,`layer "${u.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&z!=="raster-array"&&a.push(new o.V(g,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):a.push(new o.V(g,u.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new o.V(g,u,`layer "${u.id}" must specify a "source-layer"`)):a.push(new o.V(g,u.source,`source "${u.source}" not found`))}else a.push(new o.V(g,u,'missing required property "source"'));return a=a.concat(In({key:g,value:u,valueSpec:b.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Yn({key:`${g}.type`,value:u.type,valueSpec:b.layer.type,style:m.style,styleSpec:m.styleSpec,object:u,objectKey:"type"}),filter:I=>xo(o.L({layerType:E},I)),layout:I=>In({layer:u,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":z=>bo(o.L({layerType:E},z))}}),paint:I=>In({layer:u,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":z=>Ci(o.L({layerType:E,layer:u},z))}})}})),a}function Xs(m){const a=m.value,u=m.key,g=o.J(a);return g!=="string"?[new o.V(u,a,`string expected, ${g} found`)]:[]}const Ys={promoteId:function m({key:a,value:u}){if(o.J(u)==="string")return Xs({key:a,value:u});if(Array.isArray(u)){const g=[],x=o.U(u),b=o.X(x);return b.result==="error"&&b.value.forEach(E=>{g.push(new o.V(`${a}${E.key}`,null,`${E.message}`))}),o.Z(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new o.V(`${a}`,null,"promoteId expression should be only feature dependent")),g}{const g=[];for(const x in u)g.push(...m({key:`${a}.${x}`,value:u[x]}));return g}}};function Po(m){const a=m.value,u=m.key,g=m.styleSpec,x=m.style;if(!a.type)return[new o.V(u,a,'"type" is required')];const b=o.M(a.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(a.url||a.tiles||E.push(new o.K(u,a,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(In({key:u,value:a,valueSpec:g[`source_${b.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:Ys})),E;case"geojson":if(E=In({key:u,value:a,valueSpec:g.source_geojson,style:x,styleSpec:g,objectElementValidators:Ys}),a.cluster)for(const P in a.clusterProperties){const[I,z]=a.clusterProperties[P],F=typeof I=="string"?[I,["accumulated"],["get",P]]:I;E.push(...Hi({key:`${u}.${P}.map`,value:z,expressionContext:"cluster-map"})),E.push(...Hi({key:`${u}.${P}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return E;case"video":return In({key:u,value:a,valueSpec:g.source_video,style:x,styleSpec:g});case"image":return In({key:u,value:a,valueSpec:g.source_image,style:x,styleSpec:g});case"canvas":return[new o.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wa({key:`${u}.type`,value:a.type,valueSpec:{values:sa(g)}})}}function sa(m){return m.source.reduce((a,u)=>{const g=m[u];return g.type.type==="enum"&&(a=a.concat(Object.keys(g.type.values))),a},[])}function Ts(m){const a=m.value,u=m.styleSpec,g=u.light,x=m.style;let b=[];const E=o.J(a);if(a===void 0)return b;if(E!=="object")return b=b.concat([new o.V("light",a,`object expected, ${E} found`)]),b;for(const P in a){const I=P.match(/^(.*)-transition$/),z=P.match(/^(.*)-use-theme$/);b=b.concat(z&&g[z[1]]?Yn({key:P,value:a[P],valueSpec:{type:"string"},style:x,styleSpec:u}):I&&g[I[1]]&&g[I[1]].transition?Yn({key:P,value:a[P],valueSpec:u.transition,style:x,styleSpec:u}):g[P]?Yn({key:P,value:a[P],valueSpec:g[P],style:x,styleSpec:u}):[new o.V(P,a[P],`unknown property "${P}"`)])}return b}function la(m){const a=m.value;let u=[];if(!a)return u;const g=o.J(a);if(g!=="object")return u=u.concat([new o.V("light-3d",a,`object expected, ${g} found`)]),u;const x=m.styleSpec,b=x["light-3d"],E=m.key,P=m.style,I=m.style.lights;for(const q of["type","id"])if(!(q in a))return u=u.concat([new o.V("light-3d",a,`missing property ${q} on light`)]),u;if(a.type&&I)for(let q=0;q<m.arrayIndex;q++){const $=o.M(a.type),K=I[q];o.M(K.type)===$&&u.push(new o.V(E,a.id,`duplicate light type "${a.type}", previously defined at line ${K.id.__line__}`))}const z=`properties_light_${a.type}`;if(!(z in x))return u=u.concat([new o.V("light-3d",a,`Invalid light type ${a.type}`)]),u;const F=x[z];for(const q in a)if(q==="properties"){const $=a[q],K=o.J($);if(K!=="object")return u=u.concat([new o.V("properties",$,`object expected, ${K} found`)]),u;for(const te in $){const ee=te.match(/^(.*)-transition$/),re=te.match(/^(.*)-use-theme$/);u=u.concat(re&&F[re[1]]?Yn({key:q,value:$[te],valueSpec:{type:"string"},style:P,styleSpec:x}):ee&&F[ee[1]]&&F[ee[1]].transition?Yn({key:q,value:a[q],valueSpec:x.transition,style:P,styleSpec:x}):F[te]?Yn({key:te,value:$[te],valueSpec:F[te],style:P,styleSpec:x}):[new o.K(m.key,$[te],`unknown property "${te}"`)])}}else u=u.concat(b[q]?Yn({key:q,value:a[q],valueSpec:b[q],style:P,styleSpec:x}):[new o.K(q,a[q],`unknown property "${q}"`)]);return u}function Js(m){const a=m.value,u=m.key,g=m.style,x=m.styleSpec,b=x.terrain;let E=[];const P=o.J(a);if(a===void 0||P==="null")return E;if(P!=="object")return E=E.concat([new o.V("terrain",a,`object expected, ${P} found`)]),E;for(const I in a){const z=I.match(/^(.*)-transition$/),F=I.match(/^(.*)-use-theme$/);E=E.concat(F&&b[F[1]]?Yn({key:I,value:a[I],valueSpec:{type:"string"},style:g,styleSpec:x}):z&&b[z[1]]&&b[z[1]].transition?Yn({key:I,value:a[I],valueSpec:x.transition,style:g,styleSpec:x}):b[I]?Yn({key:I,value:a[I],valueSpec:b[I],style:g,styleSpec:x}):[new o.K(I,a[I],`unknown property "${I}"`)])}if(a.source){const I=g.sources&&g.sources[a.source],z=I&&o.M(I.type);I?z!=="raster-dem"&&E.push(new o.V(u,a.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):E.push(new o.V(u,a.source,`source "${a.source}" not found`))}else E.push(new o.V(u,a,'terrain is missing required property "source"'));return E}function Sa(m){const a=m.value,u=m.style,g=m.styleSpec,x=g.fog;let b=[];const E=o.J(a);if(a===void 0)return b;if(E!=="object")return b=b.concat([new o.V("fog",a,`object expected, ${E} found`)]),b;for(const P in a){const I=P.match(/^(.*)-transition$/),z=P.match(/^(.*)-use-theme$/);b=b.concat(z&&x[z[1]]?Yn({key:P,value:a[P],valueSpec:{type:"string"},style:u,styleSpec:g}):I&&x[I[1]]&&x[I[1]].transition?Yn({key:P,value:a[P],valueSpec:g.transition,style:u,styleSpec:g}):x[P]?Yn({key:P,value:a[P],valueSpec:x[P],style:u,styleSpec:g}):[new o.K(P,a[P],`unknown property "${P}"`)])}return b}const Cc={"*":()=>[],array:Fi,boolean:function(m){const a=m.value,u=m.key,g=o.J(a);return g!=="boolean"?[new o.V(u,a,`boolean expected, ${g} found`)]:[]},number:$o,color:function(m){const a=m.key,u=m.value,g=o.J(u);return g!=="string"?[new o.V(a,u,`color expected, ${g} found`)]:o.a0.parseCSSColor(u)===null?[new o.V(a,u,`color expected, "${u}" found`)]:[]},enum:wa,filter:xo,function:Co,layer:ju,object:In,source:Po,model:o.a4,light:Ts,"light-3d":la,terrain:Js,fog:Sa,string:Xs,formatted:function(m){return Xs(m).length===0?[]:Hi(m)},resolvedImage:function(m){return Xs(m).length===0?[]:Hi(m)},projection:function(m){const a=m.value,u=m.styleSpec,g=u.projection,x=m.style;let b=[];const E=o.J(a);if(E==="object")for(const P in a)b=b.concat(Yn({key:P,value:a[P],valueSpec:g[P],style:x,styleSpec:u}));else E!=="string"&&(b=b.concat([new o.V("projection",a,`object or string expected, ${E} found`)]));return b},import:function(m){const{value:a,styleSpec:u}=m,{data:g,...x}=a;Object.defineProperty(x,"__line__",{value:a.__line__,enumerable:!1});let b=In(o.L({},m,{value:x,valueSpec:u.import}));return o.M(x.id)===""&&b.push(new o.V(`${m.key}.id`,x,"import id can't be an empty string")),g&&(b=b.concat(Mc(g,u,{key:`${m.key}.data`}))),b},iconset:function(m){const a=m.value,u=m.key,g=m.styleSpec,x=m.style;if(!a.type)return[new o.V(u,a,'"type" is required')];const b=o.M(a.type);let E=[];if(E=E.concat(In({key:u,value:a,valueSpec:g[`iconset_${b}`],style:x,styleSpec:g})),b==="source"&&a.source){const P=x.sources&&x.sources[a.source],I=P&&o.M(P.type);P?I!=="raster-array"&&E.push(new o.V(u,a.source,`iconset cannot be used with a source of type ${String(I)}, it only be used with a "raster-array" source type`)):E.push(new o.V(u,a.source,`source "${a.source}" not found`))}return E}};function Yn(m,a=!1){const u=m.value,g=m.valueSpec,x=m.styleSpec;if(g.expression&&o.a2(o.M(u)))return Co(m);if(g.expression&&o.S(o.U(u)))return Hi(m);if(g.type&&Cc[g.type]){const b=Cc[g.type](m);return a===!0&&b.length>0&&o.J(m.value)==="array"?Hi(m):b}return In(o.L({},m,{valueSpec:g.type?x[g.type]:g}))}function Pc(m){const a=m.value,u=m.key,g=Xs(m);return g.length||(a.indexOf("{fontstack}")===-1&&g.push(new o.V(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&g.push(new o.V(u,a,'"glyphs" url must include a "{range}" token'))),g}function Mc(m,a=o.a5,u={}){return Yn({key:u.key||"",value:m,valueSpec:a.$root,styleSpec:a,style:m,objectElementValidators:{glyphs:Pc,"*":()=>[]}})}function Ta(m,a=o.a5){return Ie(Mc(m,a))}const Gl=m=>Ie(Po(m)),Es=m=>Ie(Ts(m)),Ic=m=>Ie(la(m)),ut=m=>Ie(Js(m)),Wn=m=>Ie(Sa(m)),Pi=m=>Ie(function(a){const u=a.value,g=a.style,x=a.styleSpec,b=x.snow;let E=[];const P=o.J(u);if(u===void 0)return E;if(P!=="object")return E=E.concat([new o.V("snow",u,`object expected, ${P} found`)]),E;for(const I in u){const z=I.match(/^(.*)-transition$/);E=E.concat(z&&b[z[1]]&&b[z[1]].transition?Yn({key:I,value:u[I],valueSpec:x.transition,style:g,styleSpec:x}):b[I]?Yn({key:I,value:u[I],valueSpec:b[I],style:g,styleSpec:x}):[new o.K(I,u[I],`unknown property "${I}"`)])}return E}(m)),Go=m=>Ie(function(a){const u=a.value,g=a.style,x=a.styleSpec,b=x.rain;let E=[];const P=o.J(u);if(u===void 0)return E;if(P!=="object")return E=E.concat([new o.V("rain",u,`object expected, ${P} found`)]),E;for(const I in u){const z=I.match(/^(.*)-transition$/);E=E.concat(z&&b[z[1]]&&b[z[1]].transition?Yn({key:I,value:u[I],valueSpec:x.transition,style:g,styleSpec:x}):b[I]?Yn({key:I,value:u[I],valueSpec:b[I],style:g,styleSpec:x}):[new o.K(I,u[I],`unknown property "${I}"`)])}return E}(m)),Br=m=>Ie(ju(m)),qe=m=>Ie(xo(m)),oe=m=>Ie(Ci(m)),ce=m=>Ie(bo(m)),ye=m=>Ie(o.a4(m));function Ie(m){return m.slice().sort((a,u)=>a.line&&u.line?a.line-u.line:0)}function xe(m,a){let u=!1;if(a&&a.length)for(const g of a)g instanceof o.K?o.w(g.message):(m.fire(new o.z(new Error(g.message))),u=!0);return u}let Fe;class et extends o.E{constructor(a,u="flat"){super(),this._transitionable=new o.a6(Fe||(Fe=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(a,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,u,g={}){this._validate(Es,a,g)||(this._transitionable.setTransitionOrValue(a),this.id=u)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,g){return(!g||g.validate!==!1)&&xe(this,a.call(Ta,o.h({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Ue=class extends o.E{constructor(m,a,u,g,x){super(),this.scope=u,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),u,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a,this.worldview=x}get(){return this._transitionable.serialize()}set(m,a){this._transitionable.setTransitionOrValue(m,a)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new o.aa(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const a=m.value.expression;if(!a)return null;let u=-1,g=-1,x=1;for(const b of a.zoomStops)x=a.evaluate(new o.aa(b,{worldview:this.worldview})),x>.01?(u=b,g=-1):g=b;return x<.01&&u>0&&g>u?[u,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof o.ab}};const Qe=45,Ot=65,gt=.05;function sr(m,a,u,g){const x=o.af(Qe,Ot,u),[b,E]=_r(m,g);let P=1-Math.min(1,Math.exp((a-b)/(E-b)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*x*m.alpha}function _r(m,a){const u=.5/Math.tan(.5*a);return[m.range[0]+u,m.range[1]+u]}function Tr(m,a,u,g,x){const b=o.ad([],[a,u,g],x.mercatorFogMatrix);return sr(m,o.ae(b),x.pitch,x._fov)}function Gr(m,a,u,g,x,b,E){const P=[[u,g,0],[x,g,0],[x,b,0],[u,b,0]];let I=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const F of P){const q=o.ad([],F,a),$=o.ae(q);I=Math.min(I,$),z=Math.max(z,$)}return[sr(m,I,E.pitch,E._fov),sr(m,z,E.pitch,E._fov)]}class zr extends o.E{constructor(a,u,g,x){super();const b=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(b,g,new Map(x)),this.set(a,x),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new o.ag(b),this.scope=g}get state(){const a=this._transform,u=a.projection.name==="globe",g=o.ah(a.zoom),x=this.properties.get("range"),b=[.5,3];return{range:u?[o.ai(b[0],x[0],g),o.ai(b[1],x[1],g)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,u,g={}){if(this._validate(Wn,a,g))return;const x=o.h({},a);for(const b of Object.keys(o.a5.fog))x[b]===void 0&&(x[b]=o.a5.fog[b].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(Qe,Ot,a))*u.a}getOpacityAtLatLng(a,u){return this._transform.projection.supportsFog?function(g,x,b){const E=o.ac.fromLngLat(x),P=b.elevation?b.elevation.getAtPointOrZero(E):0;return Tr(g,E.x,E.y,P,b)}(this.state,a,u):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(a.toUnwrapped());return Gr(this.state,u,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(a,u,g,x,b){return this._transform.projection.supportsFog?Gr(this.state,a,u,g,x,b,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?_r(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const g of u){const x=a.points[g];let b;if(x[2]>=0)b=x;else{const E=a.points[g-4];b=o.ak(E,x,E[2]/(E[2]-x[2]))}if(Tr(this.state,b[0],b[1],0,this._transform)>=gt)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,g){return(!g||g.validate!==!1)&&xe(this,a.call(Ta,o.h({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Hr,Un,Wr,Ti,to=class extends o.E{constructor(m,a,u,g){super();const x=Hr||(Hr=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(x,u,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(x),this.scope=u}get state(){const m=this.properties.get("opacity"),a=this.properties.get("color"),u=this.properties.get("direction"),g=o.al(u[0]),x=-Math.max(o.al(u[1]),.01),b=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette"),P=this.properties.get("vignette-color");return P.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(a.r,a.g,a.b,a.a*m),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(m,a,u={}){if(this._validate(Pi,m,u))return;const g=o.h({},m);for(const x of Object.keys(o.a5.snow))g[x]===void 0&&(g[x]=o.a5.snow[x].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,a,u){return(!u||u.validate!==!1)&&xe(this,m.call(Ta,o.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},Wi=class extends o.E{constructor(m,a,u,g){super();const x=Un||(Un=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(x,u,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(x),this.scope=u}get state(){const m=this.properties.get("opacity"),a=this.properties.get("color"),u=this.properties.get("direction"),g=o.al(u[0]),x=-Math.max(o.al(u[1]),.01),b=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(a.r,a.g,a.b,a.a*m),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(m,a,u={}){if(this._validate(Go,m,u))return;const g=o.h({},m);for(const x of Object.keys(o.a5.rain))g[x]===void 0&&(g[x]=o.a5.rain[x].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,a,u){return(!u||u.validate!==!1)&&xe(this,m.call(Ta,o.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class Dn extends o.E{constructor(a,u,g,x){super(),this.scope=g,this._options=a,this.properties=new o.ag(u),this._transitionable=new o.a6(u,g,new Map(x)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,u){this._options=a,this._transitionable.setTransitionOrValue(a.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class pn{constructor(a,u,g){this.screenBounds=a,this.cameraPoint=g.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(a,u){let g,x;if(a instanceof o.P||typeof a[0]=="number"){const b=o.P.convert(a);g=[b],x=u.isPointAboveHorizon(b)}else{const b=o.P.convert(a[0]),E=o.P.convert(a[1]),P=b.add(E)._div(2);g=[b,E],x=o.ao(b,E).every(I=>u.isPointAboveHorizon(I))&&u.isPointAboveHorizon(P)}return new pn(g,x,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.ao(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(x[3]=this.cameraPoint)),o.ap(x,a)}bufferedCameraGeometryGlobe(a){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.ao(u,g,a),b=this.cameraPoint.clone();switch(3*((b.y>u.y)+(b.y>g.y))+((b.x>u.x)+(b.x>g.x))){case 0:x[0]=b,x[4]=b.clone();break;case 1:x.splice(1,0,b);break;case 2:x[1]=b;break;case 3:x.splice(4,0,b);break;case 5:x.splice(2,0,b);break;case 6:x[3]=b;break;case 7:x.splice(3,0,b);break;case 8:x[2]=b}return x}containsTile(a,u,g,x=0){const b=a.queryPadding/u._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(b,u):this._bufferedScreenMercator(b,u);let P=a.tileID.wrap+(E.unwrapped?x:0);const I=E.polygon.map(re=>o.aq(a.tileTransform,re,P));if(!o.ar(I,0,0,o.aj,o.aj))return;P=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const z=this.screenGeometryMercator.polygon.map(re=>o.as(a.tileTransform,re,P)),F=z.map(re=>new o.P(re[0],re[1])),q=u.getFreeCameraOptions().position||new o.ac(0,0,0),$=o.as(a.tileTransform,q,P),K=z.map(re=>{const ie=o.at(re,re,$);return o.au(ie,ie),new o.av($,ie)}),te=o.aw(a,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:K,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(ee=o.ax(I),ee.min.x=o.ay(ee.min.x,0,o.aj),ee.min.y=o.ay(ee.min.y,0,o.aj),ee.max.x=o.ay(ee.max.x,0,o.aj),ee.max.y=o.ay(ee.max.y,0,o.aj),ee),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:te};var ee}_bufferedScreenMercator(a,u){const g=ci(a);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),u):{polygon:this.bufferedScreenGeometry(a).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(a,u){const g=ci(a);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),u):{polygon:this.bufferedCameraGeometry(a).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=x,x}}_projectAndResample(a,u){const g=function(b,E){const P=o.az([],E.pixelMatrix,E.globeMatrix),I=[0,-o.aB,0,1],z=[0,o.aB,0,1],F=[0,0,0,1];o.aA(I,I,P),o.aA(z,z,P),o.aA(F,F,P);const q=new o.P(I[0]/I[3],I[1]/I[3]),$=new o.P(z[0]/z[3],z[1]/z[3]),K=o.aC(b,q)&&I[3]<F[3],te=o.aC(b,$)&&z[3]<F[3];if(!K&&!te)return null;const ee=function(Pe,be,Se){for(let Ee=1;Ee<Pe.length;Ee++){const Ve=pi(be.pointCoordinate3D(Pe[Ee-1]).x),De=pi(be.pointCoordinate3D(Pe[Ee]).x);if(Se<0){if(Ve<De)return{idx:Ee,t:-Ve/(De-1-Ve)}}else if(De<Ve)return{idx:Ee,t:(1-Ve)/(De+1-Ve)}}return null}(b,E,K?-1:1);if(!ee)return null;const{idx:re,t:ie}=ee;let ue=re>1?bi(b.slice(0,re),E):[],pe=re<b.length?bi(b.slice(re),E):[];ue=ue.map(Pe=>new o.P(pi(Pe.x),Pe.y)),pe=pe.map(Pe=>new o.P(pi(Pe.x),Pe.y));const me=[...ue];me.length===0&&me.push(pe[pe.length-1]);const Te=o.ai(me[me.length-1].y,(pe.length===0?ue[0]:pe[0]).y,ie);let we;return we=K?[new o.P(0,Te),new o.P(0,0),new o.P(1,0),new o.P(1,Te)]:[new o.P(1,Te),new o.P(1,1),new o.P(0,1),new o.P(0,Te)],me.push(...we),pe.length===0?me.push(ue[0]):me.push(...pe),{polygon:me.map(Pe=>new o.ac(Pe.x,Pe.y)),unwrapped:!1}}(a,u);if(g)return g;const x=function(b,E){let P=!1,I=-1/0,z=0;for(let q=0;q<b.length-1;q++)b[q].x>I&&(I=b[q].x,z=q);for(let q=0;q<b.length-1;q++){const $=(z+q)%(b.length-1),K=b[$],te=b[$+1];Math.abs(K.x-te.x)>.5&&(K.x<te.x?(K.x+=1,$===0&&(b[b.length-1].x+=1)):(te.x+=1,$+1===b.length-1&&(b[0].x+=1)),P=!0)}const F=o.aD(E.center.lng);return P&&F<Math.abs(F-1)&&b.forEach(q=>{q.x-=1}),{polygon:b,unwrapped:P}}(bi(a,u).map(b=>new o.P(pi(b.x),b.y)),u);return{polygon:x.polygon.map(b=>new o.ac(b.x,b.y)),unwrapped:x.unwrapped}}}function bi(m,a){return o.aE(m,u=>{const g=a.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function pi(m){return m<0?1+m%1:m%1}function ci(m){return 100*m|0}function wo(m,a,u,g,x){const b=function(P,I){if(P)return x(P);if(I){if(m.url&&I.tiles&&m.tiles&&delete m.tiles,I.variants){if(!Array.isArray(I.variants))return x(new Error("variants must be an array"));for(const F of I.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return x(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){I=o.h(I,F);break}}}const z=o.aF(o.h({},I,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=a.canonicalizeTileset(z,m.url),x(null,z)}},E=function(P,I,z){if(!P)return null;if(!I&&!z)return P;z=z||P.worldview_default;const F=Object.values(P.language||{});if(F.length===0)return null;const q=Object.values(P.worldview||{});if(q.length===0)return null;const $=F.every(te=>te===I),K=q.every(te=>te===z);return $&&K?P:I in(P.language_options||{})||z in(P.worldview_options||{})?null:P.language_options&&P.worldview_options?P:null}(m.data,u,g);return E?o.q.frame(()=>b(null,E)):m.url?o.n(a.transformRequest(a.normalizeSourceURL(m.url,null,u,g),o.R.Source),b):o.q.frame(()=>{const{data:P,...I}=m;b(null,I)})}function Ea(m,a){const u=Math.pow(2,a.z),g=Math.floor(o.aD(m.getWest())*u),x=Math.floor(o.aH(m.getNorth())*u),b=Math.ceil(o.aD(m.getEast())*u),E=Math.ceil(o.aH(m.getSouth())*u);return a.x>=g&&a.x<b&&a.y>=x&&a.y<E}class qo{constructor(a,u,g){this.bounds=a?o.aG.convert(this.validateBounds(a)):null,this.minzoom=u||0,this.maxzoom=g||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}addExtraBounds(a){if(a){this.extraBounds||(this.extraBounds=[]);for(const u of a)this.extraBounds.push(o.aG.convert(this.validateBounds(u)))}}contains(a){if(a.z>this.maxzoom||a.z<this.minzoom||this.bounds&&!Ea(this.bounds,a))return!1;if(!this.extraBounds)return!0;for(const u of this.extraBounds)if(Ea(u,a))return!0;return!1}static fromTileJSON(a){if(!a.bounds&&!a.extra_bounds)return null;const u=new qo(a.bounds,a.minzoom,a.maxzoom);return u.addExtraBounds(a.extra_bounds),u}}class If extends o.E{constructor(a,u,g,x){if(super(),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.h(this,o.aF(u,["url","scheme","tileSize","promoteId"])),this._options=o.h({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new o.aI}load(a){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=wo(this._options,this.map._requestManager,u,g,(x,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new o.z(x));else if(b){if(o.h(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of b.vector_layers)this.vectorLayerIds.push(E.id),b.worldview&&b.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=qo.fromTileJSON(b),ct(b.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}a&&a(x)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}loadTile(a,u){const g=a.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(g),b=this.map._requestManager.transformRequest(x,o.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,P=E?{image:E.image.clone()}:null,I={request:b,data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,lut:P,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&o.j(g)&&(I.localizableLayerIds=this.localizableLayerIds),I.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=u:a.request=a.actor.send("reloadTile",I,z.bind(this));else if(a.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",I,z.bind(this),void 0,!0);else{const F=o.aJ.call({deduped:this._deduped},I,(q,$)=>{q||!$?z.call(this,q):(I.data={cacheControl:$.cacheControl,expires:$.expires,rawData:$.rawData.slice(0)},a.actor&&a.actor.send("loadTile",I,z.bind(this),void 0,!0))},!0);a.request={cancel:F}}function z(F,q){return delete a.request,a.aborted?u(null):F&&F.status!==404?u(F):(q&&q.resourceTiming&&(a.resourceTiming=q.resourceTiming),this.map._refreshExpiredTiles&&q&&a.setExpiryData(q),a.loadVectorData(q,this.map.painter),o.aK(this.dispatcher),u(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,u){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Mo extends o.E{constructor(a,u,g,x){super(),this.id=a,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.h({type:"raster"},u),o.h(this,o.aF(u,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const u=this.map.getWorldview();this._tileJSONRequest=wo(this._options,this.map._requestManager,null,u,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new o.z(g)):x&&(o.h(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=qo.fromTileJSON(x),ct(x.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),a&&a(g)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,u){const g=o.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);a.request=o.o(this.map._requestManager.transformRequest(x,o.R.Tile),(b,E,P,I)=>(delete a.request,a.aborted?(a.state="unloaded",u(null)):b?(a.state="errored",u(b)):E?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:P,expires:I}),a.setTexture(E,this.map.painter),a.state="loaded",o.aK(this.dispatcher),void u(null)):u(null)))}abortTile(a,u){a.request&&(a.request.cancel(),delete a.request),u&&u()}unloadTile(a,u){a.texture&&a.texture instanceof o.T?(a.destroy(!0),a.texture&&a.texture instanceof o.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Oc extends Mo{constructor(a,u,g,x){super(a,u,g,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.h({type:"raster-array"},u)}triggerRepaint(a){const u=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);u&&u.enabled&&g&&u._clearRenderCacheForTile(g.id,a.tileID),this.map.triggerRepaint()}loadTile(a,u){const g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(g,o.R.Tile),b={request:x,uid:a.uid,tileID:a.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};a.source=this.id,a.scope=this.scope,a.requestParams=x,a.actor||(a.actor=this.dispatcher.getActor());const E=(P,I,z,F)=>{if(delete a.request,a.aborted)return a.state="unloaded",u(null);if(P)return P.name==="AbortError"?void 0:(a.state="errored",u(P));if(this.map._refreshExpiredTiles&&I&&a.setExpiryData({cacheControl:z,expires:F}),this.partial)a.state="empty";else{if(!I)return u(null);a.state="loaded",a._isHeaderLoaded=!0,a._mrt=I}u(null)};a.request=this.partial?a.fetchHeader(void 0,E.bind(this)):a.actor.send("loadTile",b,E.bind(this),void 0,!0)}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,u){const g=a.texturePerLayer;if(a.flushAllQueues(),g.size){a.destroy(!0);for(const x of g.values())this.map.painter.saveTileTexture(x)}else a.destroy()}prepareTile(a,u,g,x){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBand(u,g,x,(b,E)=>{if(b)return a.state="errored",this.fire(new o.z(b)),void this.triggerRepaint(a);E&&(a._isHeaderLoaded=!0,a.setTexturePerLayer(g,E,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:b})=>b===a),g=u&&u.fields,x=g&&g.bands&&g.bands;return x?x[0]:0}getTextureDescriptor(a,u,g){if(!a)return;const x=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let b=null;u instanceof o.aN?b=u.paint.get("raster-array-band"):u instanceof o.aO&&(b=u.paint.get("raster-particle-array-band"));const E=b||this.getInitialBand(x);if(E==null)return;if(!a.textureDescriptorPerLayer.get(u.id))return void this.prepareTile(a,x,u.id,E);if(a.updateNeeded(u.id,E)&&!g)return;const P=a.textureDescriptorPerLayer.get(u.id);return Object.assign({},P,{texture:a.texturePerLayer.get(u.id)})}getImages(a,u){const g=new Map;for(const x of a)for(const b of u){const[E,P]=b.split("/"),I=x.getLayer(E);if(!I||!I.hasBand(P)||!I.hasDataForBand(P))continue;const{bytes:z,tileSize:F,buffer:q}=I.getBandView(P),$=F+2*q,K={data:new o.r({width:$,height:$},z),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(b,K)}return g}}const Bm={vector:If,raster:Mo,"raster-dem":class extends Mo{constructor(m,a,u,g){super(m,a,u,g),this.type="raster-dem",this.maxzoom=22,this._options=o.h({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(m,a){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,b){x&&(m.state="errored",a(x)),b&&(m.dem=b,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",a(null))}m.request=o.o(this.map._requestManager.transformRequest(u,o.R.Tile),function(x,b,E,P){if(delete m.request,m.aborted)m.state="unloaded",a(null);else if(x)m.state="errored",a(x);else if(b){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:E,expires:P});const I=ImageBitmap&&b instanceof ImageBitmap&&o.t(),z=1-(b.width-o.aL(b.width))/2;z<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const F=I?b:o.q.getImageData(b,z),q={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:z};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",q,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const a=m.canonical,u=Math.pow(2,a.z),g=(a.x-1+u)%u,x=a.x===0?m.wrap-1:m.wrap,b=(a.x+1+u)%u,E=a.x+1===u?m.wrap+1:m.wrap,P={};return P[new o.aM(m.overscaledZ,x,a.z,g,a.y).key]={backfilled:!1},P[new o.aM(m.overscaledZ,E,a.z,b,a.y).key]={backfilled:!1},a.y>0&&(P[new o.aM(m.overscaledZ,x,a.z,g,a.y-1).key]={backfilled:!1},P[new o.aM(m.overscaledZ,m.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},P[new o.aM(m.overscaledZ,E,a.z,b,a.y-1).key]={backfilled:!1}),a.y+1<u&&(P[new o.aM(m.overscaledZ,x,a.z,g,a.y+1).key]={backfilled:!1},P[new o.aM(m.overscaledZ,m.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},P[new o.aM(m.overscaledZ,E,a.z,b,a.y+1).key]={backfilled:!1}),P}},"raster-array":Oc,geojson:class extends o.E{constructor(m,a,u,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=a.data,this._options=o.h({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.minzoom!==void 0&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const x=o.aj/this.tileSize;this.workerOptions=o.h({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*x,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*x,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.aj,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*x,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const a=new Map;for(const u of this._data.features)a.set(u.id,u);for(const u of m.features)a.set(u.id,u);this._data.features=[...a.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},a),this}getClusterChildren(m,a){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},a),this}getClusterLeaves(m,a,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:a,offset:u},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const a=o.h({append:m},this.workerOptions);a.scope=this.scope;const u=this._data;typeof u=="string"?(a.request=this.map._requestManager.transformRequest(o.q.resolveURL(u),o.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(g,x)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new o.z(g));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(b.resourceTiming=x.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new o.A("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=o.C(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,a){const u=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,x=g?{image:g.image.clone()}:null,b=this._partialReload,E={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview()};m.request=this.actor.send(u,E,(P,I)=>b&&!I?(m.state="loaded",a(null)):(delete m.request,m.destroy(),m.aborted?a(null):P?a(P):(m.loadVectorData(I,this.map.painter,u==="reloadTile"),a(null))),void 0,u==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,a){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(m,a,u,g){super(m,a,u,g),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const a of m.urls)this.urls.push(this.map._requestManager.transformRequest(a,o.R.Source).url);o.aQ(this.urls,(a,u)=>{this._loaded=!0,a?this.fire(new o.z(a)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const a=this.video.seekable;m<a.start(0)||m>a.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,a=m.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(m,this.video,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(m,a,u,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=a}load(){const m=[];for(const a in this._options.models){const u=this._options.models[a],g=o.aS(this.map._requestManager.transformRequest(u.uri,o.R.Model).url).then(x=>{if(!x)return;const b=o.aT(x),E=new o.aU(a,u.position,u.orientation,b);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(x=>{this.fire(new o.z(new Error(`Could not load model ${a} from ${u.uri}: ${x.message}`)))});m.push(g)}Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${a.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,a){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(m,a,u,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=wo(this._options,this.map._requestManager,a,u,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new o.z(g))):x&&(o.h(this,x),x.bounds&&(this.tileBounds=new qo(x.bounds,this.minzoom,this.maxzoom)),ct(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,a){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,o.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=a;else{if(m.buckets){const b=Object.values(m.buckets);for(const E of b)E.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,x.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,x.bind(this),void 0,!0);function x(b,E){return m.aborted?a(null):b&&b.status!==404?a(b):(this.map._refreshExpiredTiles&&E&&m.setExpiryData(E),m.loadModelData(E,this.map.painter),m.state="loaded",void a(null))}}serialize(){return o.h({},this._options)}},canvas:class extends o.aP{constructor(m,a,u,g){super(m,a,u,g),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(b=>typeof b!="number"))||this.fire(new o.z(new o.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${m}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(a,this.canvas,a.gl.RGBA8,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends o.E{constructor(m,a,u,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=a,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new qo(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),o.h(this,o.aF(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:a,y:u,z:g}=m.canonical;return this._implementation.hasTile({x:a,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,a){const{x:u,y:g,z:x}=m.tileID.canonical,b=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:u,y:g,z:x},{signal:b.signal})).then(function(E){return delete m.request,m.aborted?(m.state="unloaded",a(null)):E===void 0?(m.state="errored",a(null)):E===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(E)?(this.loadTileData(m,E),m.state="loaded",void a(null)):(m.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(E=>{E.name!=="AbortError"&&(m.state="errored",a(E))}),m.request.cancel=()=>b.abort()}loadTileData(m,a){m.setTexture(a,this.map.painter)}unloadTile(m,a){if(m.texture&&m.texture instanceof o.T?(m.destroy(!0),m.texture&&m.texture instanceof o.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:u,y:g,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:x})}a&&a()}abortTile(m,a){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),a&&a()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=o.C(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},Of=function(m,a,u,g){const x=new Bm[a.type](m,a,u,g);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return o.aV(["load","abort","unload","serialize","prepare"],x),x};function jf(m,a,u=""){return`${u}:${a.id||""}:${a.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:x,importId:b}=g;return`featureset:${x}${b?`:import:${b}`:""}`}}(m.target)}`}function Um(m,a,u,g=""){if(m.uniqueFeatureID){const x=jf(m,a,g);if(u.has(x))return!0;u.add(x)}return!1}function Vm(m,a,u,g,x=!1){const b=a.sourceCache.transform,E=a.sourceCache.tilesIn(m,a.has3DLayers,x);E.sort($m);const P=[];for(const I of E){const z=I.tile.queryRenderedFeatures(a,I,u,g,b,x);Object.keys(z).length&&P.push({wrappedTileID:I.tile.tileID.wrapped().key,queryResults:z})}return P.length===0?{}:function(I){const z={},F={};for(const q of I){const $=q.queryResults,K=q.wrappedTileID,te=F[K]=F[K]||{};for(const ee in $){const re=$[ee],ie=te[ee]=te[ee]||{},ue=z[ee]=z[ee]||[];for(const pe of re)ie[pe.featureIndex]||(ie[pe.featureIndex]=!0,ue.push(pe))}}return z}(P)}function Ru(m,a,u,g,x,b){const E={},P=g.queryRenderedSymbols(m),I=[];for(const z of Object.keys(P).map(Number))I.push(x[z]);I.sort($m);for(const z of I){const F=z.featureIndex.lookupSymbolFeatures(P[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,a,u,b);for(const q in F){const $=E[q]=E[q]||[],K=F[q];K.sort((te,ee)=>{const re=z.featureSortOrder;if(re){const ie=re.indexOf(te.featureIndex);return re.indexOf(ee.featureIndex)-ie}return ee.featureIndex-te.featureIndex});for(const te of K)$.push(te)}}return E}function Rf(m,a){const u=m.getRenderableIds().map(b=>m.getTileByID(b)),g=[],x={};for(let b=0;b<u.length;b++){const E=u[b],P=E.tileID.canonical.key;x[P]||(x[P]=!0,E.querySourceFeatures(g,a))}return g}function $m(m,a){const u=m.tileID,g=a.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function Qs(m,a){const u={};if(!a)return u;for(const g of m){const x=g.layerIds.map(b=>a.getLayer(b)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(b=>x.filter(E=>E.id===b)[0]));for(const b of x)u[b.fqid]=g}}return u}const rs=32,As=33,ql=new Uint16Array(8184);for(let m=0;m<2046;m++){let a=m+2,u=0,g=0,x=0,b=0,E=0,P=0;for(1&a?x=b=E=rs:u=g=P=rs;(a>>=1)>1;){const z=u+x>>1,F=g+b>>1;1&a?(x=u,b=g,u=E,g=P):(u=x,g=b,x=E,b=P),E=z,P=F}const I=4*m;ql[I+0]=u,ql[I+1]=g,ql[I+2]=x,ql[I+3]=b}const el=new Uint16Array(2178),Hl=new Uint8Array(1089),Df=new Uint16Array(1089);function jc(m){return m===0?-.03125:m===32?.03125:0}const Lf={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class Du{constructor(a,u,g,x,b,E){this.tileID=a,this.uid=o.a$(),this.uses=0,this.tileSize=u,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=E}registerFadeDuration(a){const u=a+this.timeAdded;u<o.q.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,u,g){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=Qs(a.buckets,u.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const b=this.buckets[x];if(b instanceof o.b1){if(this.hasSymbolBuckets=!0,!g)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const b=this.buckets[x];if(b instanceof o.b1&&b.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const x in this.buckets){const b=this.buckets[x],E=u.style.getOwnLayer(x);if(!E)continue;const P=E.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,P)}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas),this._lastUpdatedBrightness=a.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(a,u,g){a&&(a.resourceTiming&&(this.resourceTiming=a.resourceTiming),this.buckets=Object.assign({},this.buckets,Qs(a.buckets,u.style)),a.featureIndex&&(this.latestFeatureIndex=a.featureIndex))}getBucket(a){return this.buckets[a.fqid]}upload(a){for(const x in this.buckets){const b=this.buckets[x];b.uploadPending()&&b.upload(a)}const u=a.gl,g=this.imageAtlas;g&&!g.uploaded&&(this.imageAtlasTexture=new o.T(a,g.image,u.RGBA8,{useMipmap:!!g.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(a,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(a,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(a,u,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture,g),!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=u.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(u,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(a,u,g,x,b,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const P=function(I,z){const F=o.bn([],[.5*I.width,.5*-I.height,1]);return o.bo(F,F,[1,-1,0]),o.az(F,F,I.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(F)}(b,this.tileID);return this.latestFeatureIndex.query(a,{tilespaceGeometry:u,pixelPosMatrix:P,transform:x,availableImages:g,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(a,u){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const x=g.loadVTLayers(),b=u?u.sourceLayer:"",E=x._geojsonTileLayer||x[b];if(!E)return;const P=o.b3(u&&u.filter),{z:I,x:z,y:F}=this.tileID.canonical,q={z:I,x:z,y:F};for(let $=0;$<E.length;$++){const K=E.feature($);if(P.needGeometry){const re=o.b4(K,!0);if(!P.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),re,this.tileID.canonical))continue}else if(!P.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),K))continue;const te=g.getId(K,b),ee=new o.b5(K,I,z,F,te);ee.tile=q,a.push(ee)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(a){const u=this.expirationTime;if(a.cacheControl){const g=o.b6(a.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const g=Date.now();let x=!1;if(this.expirationTime>g)x=!1;else if(u)if(this.expirationTime<u)x=!0;else{const b=this.expirationTime-u;b?this.expirationTime=g+Math.max(b,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(a){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&a&&this.updateBuckets(a)}updateBuckets(a,u){if(!this.latestFeatureIndex||!a.style)return;const g=this.latestFeatureIndex.loadVTLayers(),x=a.style.listImages(),b=a.style.getBrightness();for(const E in this.buckets){if(!a.style.hasLayer(E))continue;const P=this.buckets[E],I=P.layers[0],z=I.sourceLayer||"_geojsonTileLayer",F=g[z],q=a.style.getLayerSourceCache(I);let $={};q&&($=q._state.getState(z,void 0));const K=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},te=Object.keys($).length>0&&!u;te&&!P.stateDependentLayers.length&&!u||P.update($,F,x,K,te?P.stateDependentLayers:P.layers,u,b),(P instanceof o.b7||P instanceof o.b8)&&a._terrain&&a._terrain.enabled&&q&&P.uploadPending()&&a._terrain._clearRenderCacheForTile(q.id,this.tileID);const ee=a&&a.style&&a.style.getOwnLayer(E);ee&&(this.queryPadding=Math.max(this.queryPadding,ee.queryRadius(P)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=o.q.now()+a}setTexture(a,u){const g=u.context,x=g.gl;this.texture=this.texture||u.getTileTexture(a.width),this.texture&&this.texture instanceof o.T?this.texture.update(a):(this.texture=new o.T(g,a,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(a,u){const g={};for(const x of u)g[x]=!0;this.dependencies[a]=g}hasDependency(a,u){for(const g of a){const x=this.dependencies[g];if(x){for(const b of u)if(x[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const g=o.b9(Lf,this.tileID.canonical,this.tileTransform)[0],x=new o.ba,b=new o.bb;for(let E=0;E<g.length;E++){const{x:P,y:I}=g[E];x.emplaceBack(P,I),b.emplaceBack(E)}b.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(b),this._tileDebugBuffer=a.createVertexBuffer(x,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,x.length,b.length)}_makeTileBoundsBuffers(a,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const g=o.b9(Lf,this.tileID.canonical,this.tileTransform)[0];let x,b;if(this.isRaster){const E=function(P,I){const z=o.aW(P,I),F=Math.pow(2,P.z);for(let re=0;re<As;re++)for(let ie=0;ie<As;ie++){const ue=o.aX((P.x+(ie+jc(ie))/rs)/F),pe=o.aY((P.y+(re+jc(re))/rs)/F),me=I.project(ue,pe),Te=re*As+ie;el[2*Te+0]=Math.round((me.x*z.scale-z.x)*o.aj),el[2*Te+1]=Math.round((me.y*z.scale-z.y)*o.aj)}Hl.fill(0),Df.fill(0);for(let re=2045;re>=0;re--){const ie=4*re,ue=ql[ie+0],pe=ql[ie+1],me=ql[ie+2],Te=ql[ie+3],we=ue+me>>1,Pe=pe+Te>>1,be=we+Pe-pe,Se=Pe+ue-we,Ee=pe*As+ue,Ve=Te*As+me,De=Pe*As+we,dt=Math.hypot((el[2*Ee+0]+el[2*Ve+0])/2-el[2*De+0],(el[2*Ee+1]+el[2*Ve+1])/2-el[2*De+1])>=16;Hl[De]=Hl[De]||(dt?1:0),re<1022&&(Hl[De]=Hl[De]||Hl[(pe+Se>>1)*As+(ue+be>>1)]||Hl[(Te+Se>>1)*As+(me+be>>1)])}const q=new o.aZ,$=new o.a_;let K=0;function te(re,ie){const ue=ie*As+re;return Df[ue]===0&&(q.emplaceBack(el[2*ue+0],el[2*ue+1],re*o.aj/rs,ie*o.aj/rs),Df[ue]=++K),Df[ue]-1}function ee(re,ie,ue,pe,me,Te){const we=re+ue>>1,Pe=ie+pe>>1;if(Math.abs(re-me)+Math.abs(ie-Te)>1&&Hl[Pe*As+we])ee(me,Te,re,ie,we,Pe),ee(ue,pe,me,Te,we,Pe);else{const be=te(re,ie),Se=te(ue,pe),Ee=te(me,Te);$.emplaceBack(be,Se,Ee)}}return ee(0,0,rs,rs,rs,0),ee(rs,rs,0,0,0,rs),{vertices:q,indices:$}}(this.tileID.canonical,u);x=E.vertices,b=E.indices}else{x=new o.aZ,b=new o.a_;for(const{x:P,y:I}of g)x.emplaceBack(P,I,0,0);const E=o.be(x.int16.subarray(0,4*x.length),void 0,4);for(let P=0;P<E.length;P+=3)b.emplaceBack(E[P],E[P+1],E[P+2])}this._tileBoundsBuffer=a.createVertexBuffer(x,o.bf.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(b),this._tileBoundsSegments=o.bd.simpleSegment(0,0,x.length,b.length)}_makeGlobeTileDebugBuffers(a,u){const g=u.projection;if(!g||g.name!=="globe"||u.freezeTileCoverage)return;const x=this.tileID.canonical,b=o.bg(x,u),E=o.bh(b),P=o.ah(u.zoom);let I;P>0&&(I=o.bi(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,x,u,E,I,P),this._makeGlobeTileDebugTextBuffer(a,x,u,E,I,P)}_globePoint(a,u,g,x,b,E,P){let I=o.bj(a,u,g);if(E){const z=1<<g.z,F=o.aD(x.center.lng),q=o.aH(x.center.lat),$=(g.x+.5)/z-F;let K=0;$>.5?K=-1:$<-.5&&(K=1);let te=(a/o.aj+g.x)/z+K,ee=(u/o.aj+g.y)/z;te=(te-F)*x._pixelsPerMercatorPixel+F,ee=(ee-q)*x._pixelsPerMercatorPixel+q;const re=[te*x.worldSize,ee*x.worldSize,0];o.ad(re,re,E),I=o.bk(I,re,P)}return o.ad(I,I,b)}_makeGlobeTileDebugBorderBuffer(a,u,g,x,b,E){const P=new o.ba,I=new o.bb,z=new o.bl,F=($,K,te,ee,re)=>{const ie=(te-$)/(re-1),ue=(ee-K)/(re-1),pe=P.length;for(let me=0;me<re;me++){const Te=$+me*ie,we=K+me*ue;P.emplaceBack(Te,we);const Pe=this._globePoint(Te,we,u,g,x,b,E);z.emplaceBack(Pe[0],Pe[1],Pe[2]),I.emplaceBack(pe+me)}},q=o.aj;F(0,0,q,0,16),F(q,0,q,q,16),F(q,q,0,q,16),F(0,q,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(I),this._tileDebugBuffer=a.createVertexBuffer(P,o.bc.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(z,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,P.length,I.length)}_makeGlobeTileDebugTextBuffer(a,u,g,x,b,E){const P=o.aj/4,I=new o.ba,z=new o.a_,F=new o.bl,q=25;z.reserve(32),I.reserve(q),F.reserve(q);const $=(K,te)=>q*K+te;for(let K=0;K<q;K++){const te=K*P;for(let ee=0;ee<q;ee++){const re=ee*P;I.emplaceBack(re,te);const ie=this._globePoint(re,te,u,g,x,b,E);F.emplaceBack(ie[0],ie[1],ie[2])}}for(let K=0;K<4;K++)for(let te=0;te<4;te++){const ee=$(K,te),re=$(K,te+1),ie=$(K+1,te),ue=$(K+1,te+1);z.emplaceBack(ee,re,ie),z.emplaceBack(ie,re,ue)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(z),this._tileDebugTextBuffer=a.createVertexBuffer(I,o.bc.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(F,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,q,32)}destroy(a=!1){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!a&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class $h extends Du{constructor(a,u,g,x,b){super(a,u,g,x,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(a){return this._mrt&&this._mrt.getLayer(a)}setTexturePerLayer(a,u,g){const x=g.context,b=x.gl;let E=this.texturePerLayer.get(a)||g.getTileTexture(u.width);E&&E instanceof o.T?E.update(u,{premultiply:!1}):E=new o.T(x,u,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(a)||this.texturePerLayer.set(a,E)}flushQueues(a){const u=this._workQueuePerLayer.get(a)||[],g=this._fetchQueuePerLayer.get(a)||[];for(;u.length;)u.pop()();for(;g.length;)g.pop()()}flushAllQueues(){for(const a of this._workQueuePerLayer.keys()){const u=this._workQueuePerLayer.get(a)||[];for(;u.length;)u.pop()()}for(const a of this._fetchQueuePerLayer.keys()){const u=this._fetchQueuePerLayer.get(a)||[];for(;u.length;)u.pop()()}}fetchHeader(a=16384,u){const g=this._mrt=new o.bp(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(a-1)}});return this.entireBuffer=null,this.request=o.br(x,(b,E,P,I)=>{if(b)u(b);else try{const z=g.getHeaderLength(E);if(z>a)return void(this.request=this.fetchHeader(z,u));g.parseHeader(E),this._isHeaderLoaded=!0;let F=0;for(const q of Object.values(g.layers))F=Math.max(F,q.dataIndex[q.dataIndex.length-1].lastByte);E.byteLength>=F&&(this.entireBuffer=E),u(null,this.entireBuffer||E,P,I)}catch(z){u(z)}}),this.request}fetchBand(a,u,g,x){const b=this._mrt;if(!this._isHeaderLoaded||!b)return void x(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void x(new Error("Can't fetch tile band without an actor"));let P;const I=($,K)=>{if(P.complete($,K),$)return void x($);this.updateTextureDescriptor(a,u,g);const te=this.textureDescriptorPerLayer.get(u);x(null,te&&te.img)},z=($,K)=>{if($)return x($);const te=E.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:K,task:P},I,void 0,!0),ee=this._workQueuePerLayer.get(u)||[];ee.push(()=>{te&&te.cancel(),P.cancel()}),this._workQueuePerLayer.has(u)||this._workQueuePerLayer.set(u,ee)},F=b.getLayer(a);if(!F)return void x(new Error(`Unknown sourceLayer "${a}"`));if(F.hasDataForBand(g)){this.updateTextureDescriptor(a,u,g);const $=this.textureDescriptorPerLayer.get(u);return void x(null,$?$.img:null)}const q=F.getDataRange([g]);if(P=b.createDecodingTask(q),!P||P.tasks.length)if(this.flushQueues(u),this.entireBuffer)z(null,this.entireBuffer.slice(q.firstByte,q.lastByte+1));else{const $=Object.assign({},this.requestParams,{headers:{Range:`bytes=${q.firstByte}-${q.lastByte}`}}),K=o.br($,z),te=this._fetchQueuePerLayer.get(u)||[];te.push(()=>{K.cancel(),P.cancel()}),this._fetchQueuePerLayer.has(u)||this._fetchQueuePerLayer.set(u,te)}else x(null)}updateNeeded(a,u){return(!this.textureDescriptorPerLayer.get(a)||this.textureDescriptorPerLayer.get(a).band!==u)&&this.state!=="errored"}updateTextureDescriptor(a,u,g){if(!this._mrt)return;const x=this._mrt.getLayer(a);if(!x||!x.hasBand(g)||!x.hasDataForBand(g))return;const{bytes:b,tileSize:E,buffer:P,offset:I,scale:z}=x.getBandView(g),F=E+2*P,q=new o.r({width:F,height:F},b),$=this.texturePerLayer.get(u);$&&$ instanceof o.T&&$.update(q,{premultiply:!1}),this.textureDescriptorPerLayer.set(u,{layer:a,band:g,img:q,buffer:P,offset:I,tileSize:E,format:x.pixelFormat,mix:[z,256*z,65536*z,16777216*z]})}destroy(a=!1){if(super.destroy(a),delete this._mrt,!a)for(const u of this.texturePerLayer.values())u&&u instanceof o.T&&u.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class bv{constructor(a,u){this.max=a,this.onRemove=u,this.reset()}reset(){for(const a in this.data)for(const u of this.data[a])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(a,u,g){const x=a.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const b={value:u,timeout:void 0};if(g!==void 0&&(b.timeout=setTimeout(()=>{this.remove(a,b)},g)),this.data[x].push(b),this.order.push(x),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const u=this.data[a].shift();return u.timeout&&clearTimeout(u.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),u.value}getByKey(a){const u=this.data[a];return u?u[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,u){if(!this.has(a))return this;const g=a.wrapped().key,x=u===void 0?0:this.data[g].indexOf(u),b=this.data[g][x];return this.data[g].splice(x,1),b.timeout&&clearTimeout(b.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(b.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(a){const u=[];for(const g in this.data)for(const x of this.data[g])a(x.value)||u.push(x);for(const g of u)this.remove(g.value.tileID,g)}}class wv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,u,g){const x=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][x]=this.stateChanges[a][x]||{},o.h(this.stateChanges[a][x],g),this.deletedStates[a]===null){this.deletedStates[a]={};for(const b in this.state[a])b!==x&&(this.deletedStates[a][b]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][x]===null){this.deletedStates[a][x]={};for(const b in this.state[a][x])g[b]||(this.deletedStates[a][x][b]=null)}else for(const b in g)this.deletedStates[a]&&this.deletedStates[a][x]&&this.deletedStates[a][x][b]===null&&delete this.deletedStates[a][x][b]}removeFeatureState(a,u,g){if(this.deletedStates[a]===null)return;const x=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},g&&u!==void 0)this.deletedStates[a][x]!==null&&(this.deletedStates[a][x]=this.deletedStates[a][x]||{},this.deletedStates[a][x][g]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][x])for(g in this.deletedStates[a][x]={},this.stateChanges[a][x])this.deletedStates[a][x][g]=null;else this.deletedStates[a][x]=null;else this.deletedStates[a]=null}getState(a,u){const g=this.state[a]||{},x=this.stateChanges[a]||{},b=this.deletedStates[a];if(b===null)return{};if(u!==void 0){const P=String(u),I=o.h({},g[P],x[P]);if(b){const z=b[u];if(z===null)return{};for(const F in z)delete I[F]}return I}const E=o.h({},g,x);if(b)for(const P in b)delete E[P];return E}initializeTileState(a,u){a.refreshFeatureState(u)}coalesceChanges(a,u){const g={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const b={};for(const E in this.stateChanges[x])this.state[x][E]||(this.state[x][E]={}),o.h(this.state[x][E],this.stateChanges[x][E]),b[E]=this.state[x][E];g[x]=b}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const b={};if(this.deletedStates[x]===null)for(const E in this.state[x])b[E]={},this.state[x][E]={};else for(const E in this.deletedStates[x]){if(this.deletedStates[x][E]===null)this.state[x][E]={};else if(this.state[x][E])for(const P of Object.keys(this.deletedStates[x][E]))delete this.state[x][E][P];b[E]=this.state[x][E]}g[x]=g[x]||{},o.h(g[x],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const x in a)a[x].refreshFeatureState(u)}}class Aa extends o.E{constructor(a,u,g){super(),this.id=a,this._onlySymbols=g,u.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new bv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new wv,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(a){this.map=a,this._minTileCacheSize=this._minTileCacheSize===void 0&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles)if(!this._tiles[a].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,u){return a.isSymbolTile=this._onlySymbols,a.isExtraShadowCaster=this._shadowCasterTiles[a.tileID.key],this._source.loadTile(a,u)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a)}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a)}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const g=this._tiles[u];g.upload(a),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Lu).map(a=>a.key)}getRenderableIds(a,u){const g=[];for(const x in this._tiles)this._isIdRenderable(+x,a,u)&&g.push(this._tiles[x]);return a?g.sort((x,b)=>{const E=x.tileID,P=b.tileID,I=new o.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),z=new o.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-P.overscaledZ||z.y-I.y||z.x-I.x}).map(x=>x.tileID.key):g.map(x=>x.tileID).sort(Lu).map(x=>x.key)}hasRenderableParent(a){const u=this.findLoadedParent(a,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(a,u,g){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(u||!this._tiles[a].holdingForFade())&&(g||!this._shadowCasterTiles[a])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(+a,"reloading")}}_reloadTile(a,u){const g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=u),this._loadTile(g,this._tileLoaded.bind(this,g,a,u)))}_tileLoaded(a,u,g,x){if(x)if(a.state="errored",x.status!==404)this._source.fire(new o.z(x,{tile:a}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:a})),!(a.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else a.timeAdded=o.q.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(u,a),this._source.type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id}))}_backfillDEM(a){const u=this.getRenderableIds();for(let x=0;x<u.length;x++){const b=u[x];if(a.neighboringTiles&&a.neighboringTiles[b]){const E=this.getTileByID(b);g(a,E),g(E,a)}}function g(x,b){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let E=b.tileID.canonical.x-x.tileID.canonical.x;const P=b.tileID.canonical.y-x.tileID.canonical.y,I=Math.pow(2,x.tileID.canonical.z),z=b.tileID.key;E===0&&P===0||Math.abs(P)>1||(Math.abs(E)>1&&(Math.abs(E+I)===1?E+=I:Math.abs(E-I)===1&&(E-=I)),b.dem&&x.dem&&(x.dem.backfillBorder(b.dem,E,P),x.neighboringTiles&&x.neighboringTiles[z]&&(x.neighboringTiles[z].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,u,g,x){for(const b in this._tiles){let E=this._tiles[b];if(x[b]||!E.hasData()||E.tileID.overscaledZ<=u||E.tileID.overscaledZ>g)continue;let P=E.tileID;for(;E&&E.tileID.overscaledZ>u+1;){const z=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[z.key],E&&E.hasData()&&(P=z)}let I=P;for(;I.overscaledZ>u;)if(I=I.scaledTo(I.overscaledZ-1),a[I.key]){x[P.key]=P;break}}}findLoadedParent(a,u){if(a.key in this._loadedParentTiles){const g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=u?g:null}for(let g=a.overscaledZ-1;g>=u;g--){const x=a.scaledTo(g),b=this._getLoadedTile(x);if(b)return b}}_getLoadedTile(a){const u=this._tiles[a.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,u){u=u||this._source.tileSize;const g=Math.ceil(a.width/u)+1,x=Math.ceil(a.height/u)+1,b=Math.floor(g*x*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(P)}handleWrapJump(a){const u=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,u){const g={};for(const x in this._tiles){const b=this._tiles[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),g[b.tileID.key]=b}this._tiles=g;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(a,u,g,x,b){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(a,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let P,I=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const $=z.attenuationRange()[0],K=Math.floor($)-Math.log2(z.getDemUpscale());I>K&&(I=K)}if(this.used||this.usedForTerrain){if(this._source.tileID)P=a.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new o.aM($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y));else if(this.tileCoverLift!==0){const $=a.clone();$.tileCoverLift=this.tileCoverLift,P=$.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&a.projection.name==="globe"&&(P.push(new o.aM(1,0,1,0,0)),P.push(new o.aM(1,0,1,1,0)),P.push(new o.aM(1,0,1,0,1)),P.push(new o.aM(1,0,1,1,1)))}else if(P=a.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const $=this._source.hasTile.bind(this._source);P=P.filter(K=>$(K))}}else P=[];if(P.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!zf(this._source.type)){const $=a.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),K=Math.min($,this._source.maxzoom);if(E){const te=a.extendTileCover(P,K);for(const ee of te)P.push(ee)}else if(b){const te=a.extendTileCoverToNearPlane(P,this.transform.getFrustum(K),K);for(const ee of te)P.push(ee)}else if(this.castsShadows&&x){const te=a.extendTileCover(P,K,x);for(const ee of te)this._shadowCasterTiles[ee.key]=!0,P.push(ee)}}const F=this._updateRetainedTiles(P);if(zf(this._source.type)&&P.length!==0){const $={},K={},te=Object.keys(F);for(const re of te){const ie=F[re],ue=this._tiles[re];if(!ue||ue.fadeEndTime&&ue.fadeEndTime<=o.q.now())continue;const pe=this.findLoadedParent(ie,Math.max(ie.overscaledZ-Aa.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),$[pe.tileID.key]=pe.tileID),K[re]=ie}const ee=P[P.length-1].overscaledZ;for(const re in this._tiles){const ie=this._tiles[re];if(F[re]||!ie.hasData())continue;let ue=ie.tileID;for(;ue.overscaledZ>ee;){ue=ue.scaledTo(ue.overscaledZ-1);const pe=this._tiles[ue.key];if(pe&&pe.hasData()&&K[ue.key]){F[re]=ie.tileID;break}}}for(const re in $)F[re]||(this._coveredTiles[re]=!0,F[re]=$[re])}for(const $ in F)this._tiles[$].clearFadeHold();const q=o.bs(this._tiles,F);for(const $ of q){const K=this._tiles[$];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(+$)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const u={};if(a.length===0)return u;const g={},x=a.reduce((z,F)=>Math.min(z,F.overscaledZ),1/0),b=a[0].overscaledZ,E=Math.max(b-Aa.maxOverzooming,this._source.minzoom),P=Math.max(b+Aa.maxUnderzooming,this._source.minzoom),I={};for(const z of a){const F=this._addTile(z);u[z.key]=z,F.hasData()||x<this._source.maxzoom&&(I[z.key]=z)}this._retainLoadedChildren(I,x,P,u);for(const z of a){let F=this._tiles[z.key];if(F.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const $=z.children(this._source.maxzoom)[0],K=this.getTile($);if(K&&K.hasData()){u[$.key]=$;continue}}else{const $=z.children(this._source.maxzoom);if(u[$[0].key]&&u[$[1].key]&&u[$[2].key]&&u[$[3].key])continue}let q=F.wasRequested();for(let $=z.overscaledZ-1;$>=E;--$){const K=z.scaledTo($);if(g[K.key]||(g[K.key]=!0,F=this.getTile(K),!F&&q&&(F=this._addTile(K)),F&&(u[K.key]=K,q=F.wasRequested(),F.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const u=[];let g,x=this._tiles[a].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){g=this._loadedParentTiles[x.key];break}u.push(x.key);const b=x.scaledTo(x.overscaledZ-1);if(g=this._getLoadedTile(b),g)break;x=b}for(const b of u)this._loadedParentTiles[b]=g}}_addTile(a){let u=this._tiles[a.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[a.key]||this._reloadTile(a.key,"reloading"),u;u=this._cache.getAndRemove(a),u&&(this._setTileReloadTimer(a.key,u),u.tileID=a,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,u)));const g=!!u;if(!g){const x=this.map?this.map.painter:null,b=this._source.tileSize*a.overscaleFactor();u=this._source.type==="raster-array"?new $h(a,b,this.transform.tileZoom,x,this._isRaster):new Du(a,b,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(u,this._tileLoaded.bind(this,u,a.key,u.state))}return u.uses++,this._tiles[a.key]=u,g||this._source.fire(new o.A("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(a,u){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const g=u.getExpiryTimeout();g&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},g))}_removeTile(a){const u=this._tiles[a];u&&(u.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,u,g){const x=[],b=this.transform;if(!b)return x;const E=b.projection.name==="globe",P=o.aD(b.center.lng);for(const I in this._tiles){const z=this._tiles[I];if(g&&z.clearQueryDebugViz(),z.holdingForFade())continue;let F;if(E){const q=z.tileID.canonical;if(q.z===0){const $=[Math.abs(o.ay(P,...Gh(q,-1))-P),Math.abs(o.ay(P,...Gh(q,1))-P)];F=[0,2*$.indexOf(Math.min(...$))-1]}else{const $=[Math.abs(o.ay(P,...Gh(q,-1))-P),Math.abs(o.ay(P,...Gh(q,0))-P),Math.abs(o.ay(P,...Gh(q,1))-P)];F=[$.indexOf(Math.min(...$))-1]}}else F=[0];for(const q of F){const $=a.containsTile(z,b,u,q);$&&x.push($)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(a){return this._getRenderableCoordinates(a)}_getRenderableCoordinates(a,u){const g=this.getRenderableIds(a,u).map(b=>this._tiles[b].tileID),x=this.transform.projection.name==="globe";for(const b of g)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=x?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return g}sortCoordinatesByDistance(a){const u=a.slice(),g=this.transform._camera.position,x=this.transform._camera.forward(),b={};for(const E of u){const P=1/(1<<E.canonical.z);b[E.key]=((E.canonical.x+.5)*P+E.wrap-g[0])*x[0]+((E.canonical.y+.5)*P-g[1])*x[1]-g[2]*x[2]}return u.sort((E,P)=>b[E.key]-b[P.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(zf(this._source.type))for(const a in this._tiles){const u=this._tiles[a];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(a,u,g){this._state.updateState(a=a||"_geojsonTileLayer",u,g)}removeFeatureState(a,u,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",u,g)}getFeatureState(a,u){return this._state.getState(a=a||"_geojsonTileLayer",u)}setDependencies(a,u,g){const x=this._tiles[a];x&&x.setDependencies(u,g)}reloadTilesForDependencies(a,u){for(const g in this._tiles)this._tiles[g].hasDependency(a,u)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(a,u))}_preloadTiles(a,u){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(a,u))};return void this._source.on("data",I)}const g=new Map,x=Array.isArray(a)?a:[a],b=this.map.painter.terrain,E=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const I of x){const z=I.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of z)g.set(F.key,F);this.usedForTerrain&&I.updateElevation(!1)}const P=Array.from(g.values());o.bt(P,(I,z)=>{const F=new Du(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,q=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),z(q,F)})},u)}}function Lu(m,a){const u=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*a.wrap)-+(a.wrap<0);return m.overscaledZ-a.overscaledZ||g-u||a.canonical.y-m.canonical.y||a.canonical.x-m.canonical.x}function zf(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function Gh(m,a){const u=1<<m.z;return[m.x/u+a,(m.x+1)/u+a]}Aa.maxOverzooming=10,Aa.maxUnderzooming=3;class f1{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const a=!1,u=!1;for(const g in this.style._mergedLayers){const x=this.style._mergedLayers[g];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:a,visibilityChanged:u});else if(x.type==="model"){const b=this.style.getLayerSource(x);b&&b.type==="batched-model"&&this.layers.push({layer:x,visible:a,visibilityChanged:u})}}}onNewFrame(a){this.layersGotHidden=!1;for(const u of this.layers){const g=u.layer;let x=!1;g.type==="fill-extrusion"?x=!g.isHidden(a)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="building"?x=!g.isHidden(a)&&g.paint.get("building-opacity")>0:g.type==="model"&&(x=!g.isHidden(a)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&u.visible,u.visible=x}}updateZOffset(a,u){this.currentBuildingBuckets=[];for(const x of this.layers){const b=x.layer,E=this.style.getLayerSourceCache(b);let P=1;b.type==="fill-extrusion"?P=x.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(P=x.visible?b.paint.get("building-vertical-scale"):0);let I=E?E.getTile(u):null;if(!I&&E)for(const z in E._tiles){const F=E._tiles[z];if(u.canonical.isChildOf(F.tileID.canonical)){I=F;break}}this.currentBuildingBuckets.push({bucket:I?I.getBucket(b):null,tileID:I?I.tileID:u,verticalScale:P})}a.hasAnyZOffset=!1;let g=!1;for(let x=0;x<a.symbolInstances.length;x++){const b=a.symbolInstances.get(x),E=b.zOffset,P=this._getHeightAtTileOffset(u,b.tileAnchorX,b.tileAnchorY);b.zOffset=P!==Number.NEGATIVE_INFINITY?P:E,g||E===b.zOffset||(g=!0),a.hasAnyZOffset||b.zOffset===0||(a.hasAnyZOffset=!0)}g&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,u,g,x){let b=u,E=g;if(a.canonical.z!==x.canonical.z){const P=x.canonical,I=1/(1<<a.canonical.z-P.z);b=(u+a.canonical.x*o.aj)*I-P.x*o.aj|0,E=(g+a.canonical.y*o.aj)*I-P.y*o.aj|0}return{tileX:b,tileY:E}}_getHeightAtTileOffset(a,u,g){let x,b;for(let E=0;E<this.layers.length;++E){const P=this.layers[E].layer;if(P.type!=="fill-extrusion"&&P.type!=="building")continue;const{bucket:I,tileID:z,verticalScale:F}=this.currentBuildingBuckets[E];if(!I)continue;const{tileX:q,tileY:$}=this._mapCoordToOverlappingTile(a,u,g,z),K=I.getHeightAtTileCoord(q,$);K&&K.height!==void 0&&(K.hidden?x=K.height:b=Math.max(K.height*F,b||0))}if(b!==void 0)return b;for(let E=0;E<this.layers.length;++E){const P=this.layers[E];if(P.layer.type!=="model"||!P.visible)continue;const{bucket:I,tileID:z}=this.currentBuildingBuckets[E];if(!I)continue;const{tileX:F,tileY:q}=this._mapCoordToOverlappingTile(a,u,g,z),$=I.getHeightAtTileCoord(F,q);if($&&!$.hidden)return $.height===void 0&&x!==void 0?Math.min($.maxHeight,x)*$.verticalScale:$.height?$.height*$.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function p1(m,a){const u={};for(const g in m)g!=="ref"&&(u[g]=m[g]);return o.bu.forEach(g=>{g in a&&(u[g]=a[g])}),u}function Nf(m){m=m.slice();const a=Object.create(null);for(let u=0;u<m.length;u++)a[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=p1(m[u],a[m[u].ref]));return m}const on={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Gm(m,a,u){u.push({command:on.addSource,args:[m,a[m]]})}function qh(m,a,u){a.push({command:on.removeSource,args:[m]}),u[m]=!0}function Ff(m,a,u,g){qh(m,u,g),Gm(m,a,u)}function SC(m,a,u){let g;for(g in m[u])if(m[u].hasOwnProperty(g)&&g!=="data"&&!o.bv(m[u][g],a[u][g]))return!1;for(g in a[u])if(a[u].hasOwnProperty(g)&&g!=="data"&&!o.bv(m[u][g],a[u][g]))return!1;return!0}function Bf(m,a,u,g,x,b){let E;for(E in a=a||{},m=m||{})m.hasOwnProperty(E)&&(o.bv(m[E],a[E])||u.push({command:b,args:[g,E,a[E],x]}));for(E in a)a.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(o.bv(m[E],a[E])||u.push({command:b,args:[g,E,a[E],x]}))}function zu(m){return m.id}function Rc(m,a){return m[a.id]=a,m}function Uf(m,a,u){const g=a.createTileMatrix(m,m.worldSize,u.toUnwrapped());return o.az(new Float32Array(16),m.projMatrix,g)}function m1(m,a,u){if(a.projection.name===u.projection.name)return m.projMatrix;const g=u.clone();return g.setProjection(a.projection),Uf(g,a.getProjection(),m)}function qm(m,a,u){return a.name===u.projection.name?m.projMatrix:Uf(u,a,m)}class g1{constructor(a,u){this.reset(a,u)}reset(a,u){this.points=a||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=o.ay(a,0,1);let u=1,g=this._distances[u];const x=a*this.paddedLength+this.padding;for(;g<x&&u<this._distances.length;)g=this._distances[++u];const b=u-1,E=this._distances[b],P=g-E,I=P>0?(x-E)/P:0;return this.points[b].mult(1-I).add(this.points[u].mult(I))}}class Hh{constructor(a,u,g){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(a/g),this.yCellCount=Math.ceil(u/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=u,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,u,g,x,b){this._forEachCell(u,g,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(a,u,g,x){this._forEachCell(u-x,g-x,u+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(u),this.circles.push(g),this.circles.push(x)}_insertBoxCell(a,u,g,x,b,E){this.boxCells[b].push(E)}_insertCircleCell(a,u,g,x,b,E){this.circleCells[b].push(E)}_query(a,u,g,x,b,E){if(g<0||a>this.width||x<0||u>this.height)return!b&&[];const P=[];if(a<=0&&u<=0&&this.width<=g&&this.height<=x){if(b)return!0;for(let I=0;I<this.boxKeys.length;I++)P.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const z=this.circles[3*I],F=this.circles[3*I+1],q=this.circles[3*I+2];P.push({key:this.circleKeys[I],x1:z-q,y1:F-q,x2:z+q,y2:F+q})}return E?P.filter(E):P}return this._forEachCell(a,u,g,x,this._queryCell,P,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?P.length>0:P}_queryCircle(a,u,g,x,b){const E=a-g,P=a+g,I=u-g,z=u+g;if(P<0||E>this.width||z<0||I>this.height)return!x&&[];const F=[];return this._forEachCell(E,I,P,z,this._queryCellCircle,F,{hitTest:x,circle:{x:a,y:u,radius:g},seenUids:{box:{},circle:{}}},b),x?F.length>0:F}query(a,u,g,x,b){return this._query(a,u,g,x,!1,b)}hitTest(a,u,g,x,b){return this._query(a,u,g,x,!0,b)}hitTestCircle(a,u,g,x){return this._queryCircle(a,u,g,!0,x)}_queryCell(a,u,g,x,b,E,P,I){const z=P.seenUids,F=this.boxCells[b];if(F!==null){const $=this.bboxes;for(const K of F)if(!z.box[K]){z.box[K]=!0;const te=4*K;if(a<=$[te+2]&&u<=$[te+3]&&g>=$[te+0]&&x>=$[te+1]&&(!I||I(this.boxKeys[K]))){if(P.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[K],x1:$[te],y1:$[te+1],x2:$[te+2],y2:$[te+3]})}}}const q=this.circleCells[b];if(q!==null){const $=this.circles;for(const K of q)if(!z.circle[K]){z.circle[K]=!0;const te=3*K;if(this._circleAndRectCollide($[te],$[te+1],$[te+2],a,u,g,x)&&(!I||I(this.circleKeys[K]))){if(P.hitTest)return E.push(!0),!0;{const ee=$[te],re=$[te+1],ie=$[te+2];E.push({key:this.circleKeys[K],x1:ee-ie,y1:re-ie,x2:ee+ie,y2:re+ie})}}}}}_queryCellCircle(a,u,g,x,b,E,P,I){const z=P.circle,F=P.seenUids,q=this.boxCells[b];if(q!==null){const K=this.bboxes;for(const te of q)if(!F.box[te]){F.box[te]=!0;const ee=4*te;if(this._circleAndRectCollide(z.x,z.y,z.radius,K[ee+0],K[ee+1],K[ee+2],K[ee+3])&&(!I||I(this.boxKeys[te])))return E.push(!0),!0}}const $=this.circleCells[b];if($!==null){const K=this.circles;for(const te of $)if(!F.circle[te]){F.circle[te]=!0;const ee=3*te;if(this._circlesCollide(K[ee],K[ee+1],K[ee+2],z.x,z.y,z.radius)&&(!I||I(this.circleKeys[te])))return E.push(!0),!0}}}_forEachCell(a,u,g,x,b,E,P,I){const z=this._convertToXCellCoord(a),F=this._convertToYCellCoord(u),q=this._convertToXCellCoord(g),$=this._convertToYCellCoord(x);for(let K=z;K<=q;K++)for(let te=F;te<=$;te++)if(b.call(this,a,u,g,x,this.xCellCount*te+K,E,P,I))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,u,g,x,b,E){const P=x-a,I=b-u,z=g+E;return z*z>P*P+I*I}_circleAndRectCollide(a,u,g,x,b,E,P){const I=(E-x)/2,z=Math.abs(a-(x+I));if(z>I+g)return!1;const F=(P-b)/2,q=Math.abs(u-(b+F));if(q>F+g)return!1;if(z<=I||q<=F)return!0;const $=z-I,K=q-F;return $*$+K*K<=g*g}}const Nu={unknown:0,flipRequired:1,flipNotRequired:2},y1=Math.tan(85*Math.PI/180);function Vf(m,a,u,g,x,b,E){const P=o.bz();if(u)if(b.name==="globe"){const I=o.bA(x,a);o.az(P,P,I)}else{const I=o.bB([],E);P[0]=I[0],P[1]=I[1],P[4]=I[2],P[5]=I[3],g||o.by(P,P,x.angle)}else o.az(P,x.labelPlaneMatrix,m);return P}function Wh(m,a,u,g,x,b,E){const P=Vf(m,a,u,g,x,b,E);return b.name==="globe"&&u||(P[2]=P[6]=P[10]=P[14]=0),P}function Wl(m,a,u,g,x,b,E){if(u){if(b.name==="globe"){const P=Vf(m,a,u,g,x,b,E);return o.bi(P,P),o.az(P,m,P),P}{const P=o.bw(m),I=o.bx([]);return I[0]=E[0],I[1]=E[1],I[4]=E[2],I[5]=E[3],o.az(P,P,I),g||o.by(P,P,-x.angle),P}}return x.glCoordMatrix}function ns(m,a,u,g){const x=[m,a,u,1];u?o.aA(x,x,g):_1(x,x,g);const b=x[3];return x[0]/=b,x[1]/=b,x[2]/=b,x}function Sv(m,a){return Math.min(.5+m/a*.5,1.5)}function Tv(m,a){const u=m[0]/m[3],g=m[1]/m[3];return u>=-a[0]&&u<=a[0]&&g>=-a[1]&&g<=a[1]}function Fu(m,a,u,g,x,b,E,P,I,z){const F=u.transform,q=g?m.textSizeData:m.iconSizeData,$=o.bH(q,u.transform.zoom),K=F.projection.name==="globe",te=[256/u.width*2+1,256/u.height*2+1],ee=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ee.clear();let re=null;K&&(re=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const ie=m.lineVertexArray,ue=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,pe=u.transform.width/u.transform.height;let me,Te=!1;for(let we=0;we<ue.length;we++){const Pe=ue.get(we),{numGlyphs:be,writingMode:Se}=Pe;if(Se!==o.bI.vertical||Te||me===o.bI.horizontal||(Te=!0),me=Se,(Pe.hidden||Se===o.bI.vertical)&&!Te){Zh(be,ee);continue}Te=!1;const Ee=new o.P(Pe.tileAnchorX,Pe.tileAnchorY);let{x:Ve,y:De,z:dt}=F.projection.projectTilePoint(Ee.x,Ee.y,z.canonical);if(I){const[tr,ir,Zt]=I(Ee);Ve+=tr,De+=ir,dt+=Zt}const Je=[Ve,De,dt,1];if(o.aA(Je,Je,a),!Tv(Je,te)){Zh(be,ee);continue}const pt=Je[3],Ct=Sv(u.transform.getCameraToCenterDistance(F.projection),pt),We=o.bJ(q,$,Pe),Re=E?We/Ct:We*Ct,nt=ns(Ve,De,dt,x);if(nt[3]<=0){Zh(be,ee);continue}let Ze={};const yt=o.al(m.layers[0].layout.get("text-max-angle")),bt=Math.cos(yt),Et=E?null:I,jt=Hm(Pe,Re,!1,P,a,x,b,m.glyphOffsetArray,ie,ee,re,nt,Ee,Ze,pe,Et,F.projection,z,E,bt);Te=jt.useVertical,Et&&jt.needsFlipping&&(Ze={}),(jt.notEnoughRoom||Te||jt.needsFlipping&&Hm(Pe,Re,!0,P,a,x,b,m.glyphOffsetArray,ie,ee,re,nt,Ee,Ze,pe,Et,F.projection,z,E,bt).notEnoughRoom)&&Zh(be,ee)}g?(m.text.dynamicLayoutVertexBuffer.updateData(ee),re&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(re)):(m.icon.dynamicLayoutVertexBuffer.updateData(ee),re&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(re))}function Ba(m,a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re){const{lineStartIndex:ie,glyphStartIndex:ue,segment:pe}=P,me=ue+P.numGlyphs,Te=ie+P.lineLength,we=a.getoffsetX(ue),Pe=a.getoffsetX(me-1),be=$f(m*we,u,g,x,b,E,pe,ie,Te,I,z,F,q,$,!0,K,te,ee,re);if(!be)return null;const Se=$f(m*Pe,u,g,x,b,E,pe,ie,Te,I,z,F,q,$,!0,K,te,ee,re);return Se?{first:be,last:Se}:null}function Ev(m,a,u,g){return m===o.bI.horizontal&&Math.abs(g)>Math.abs(u)?{useVertical:!0}:m===o.bI.vertical?g>0?{needsFlipping:!0}:null:a!==Nu.unknown&&function(x,b){return x===0||Math.abs(b/x)>y1}(u,g)?a===Nu.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function Hm(m,a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re,ie,ue,pe){const me=a/24,Te=m.lineOffsetX*me,we=m.lineOffsetY*me,{lineStartIndex:Pe,glyphStartIndex:be,numGlyphs:Se,segment:Ee,writingMode:Ve,flipState:De}=m,dt=Pe+m.lineLength,Je=pt=>{if(F){const[nt,Ze,yt]=pt.up,bt=z.length;o.bK(F,bt+0,nt,Ze,yt),o.bK(F,bt+1,nt,Ze,yt),o.bK(F,bt+2,nt,Ze,yt),o.bK(F,bt+3,nt,Ze,yt)}const[Ct,We,Re]=pt.point;o.bL(z,Ct,We,Re,pt.angle)};if(Se>1){const pt=Ba(me,P,Te,we,u,q,$,m,I,b,K,ee,!1,re,ie,ue,pe);if(!pt)return{notEnoughRoom:!0};if(g&&!u){let[Ct,We,Re]=pt.first.point,[nt,Ze,yt]=pt.last.point;[Ct,We]=ns(Ct,We,Re,E),[nt,Ze]=ns(nt,Ze,yt,E);const bt=Ev(Ve,De,(nt-Ct)*te,Ze-We);if(m.flipState=bt&&bt.needsFlipping?Nu.flipRequired:Nu.flipNotRequired,bt)return bt}Je(pt.first);for(let Ct=be+1;Ct<be+Se-1;Ct++){const We=$f(me*P.getoffsetX(Ct),Te,we,u,q,$,Ee,Pe,dt,I,b,K,ee,!1,!1,re,ie,ue,pe);if(!We)return z.length-=4*(Ct-be),{notEnoughRoom:!0};Je(We)}Je(pt.last)}else{if(g&&!u){const Ct=ns($.x,$.y,0,x),We=Pe+Ee+1,Re=new o.P(I.getx(We),I.gety(We)),nt=ns(Re.x,Re.y,0,x),Ze=nt[3]>0?nt:Tn($,Re,Ct,1,x,void 0,re,ie.canonical),yt=Ev(Ve,De,(Ze[0]-Ct[0])*te,Ze[1]-Ct[1]);if(m.flipState=yt&&yt.needsFlipping?Nu.flipRequired:Nu.flipNotRequired,yt)return yt}const pt=$f(me*P.getoffsetX(be),Te,we,u,q,$,Ee,Pe,dt,I,b,K,ee,!1,!1,re,ie,ue,pe);if(!pt)return{notEnoughRoom:!0};Je(pt)}return{}}function Av(m,a,u,g,x){const{x:b,y:E,z:P}=g.projectTilePoint(m.x,m.y,a);if(!x)return ns(b,E,P,u);const[I,z,F]=x(m);return ns(b+I,E+z,P+F,u)}function Tn(m,a,u,g,x,b,E,P){const I=Av(m.sub(a)._unit()._add(m),P,x,E,b);return o.at(I,u,I),o.au(I,I),o.bE(I,u,I,g)}function $f(m,a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re,ie,ue){const pe=g?m-a:m+a;let me=pe>0?1:-1,Te=0;g&&(me*=-1,Te=Math.PI),me<0&&(Te+=Math.PI);let we=P+E+(me>0?0:1)|0,Pe=x,be=x,Se=0,Ee=0;const Ve=Math.abs(pe),De=[],dt=[];let Je=b,pt=Je,Ct=o.bC([]);const We=()=>Tn(pt,Je,be,Ve-Se+1,F,$,ee,re.canonical);for(;Se+Ee<=Ve;){if(we+=me,we<P||we>=I)return null;if(be=Pe,pt=Je,De.push(be),K&&dt.push(pt),Je=new o.P(z.getx(we),z.gety(we)),Pe=q[we],!Pe){const Zt=Av(Je,re.canonical,F,ee,$);Pe=Zt[3]>0?q[we]=Zt:We()}Se+=Ee;const tr=o.at([],Pe,be),ir=o.bD(be,Pe);if(u&&ir>0&&Ee>0&&o.bG(Ct,tr)/(Ee*ir)<ue)return null;Ee=ir,Ct=tr}te&&$&&(q[we]&&(Pe=We(),Ee=o.bD(be,Pe),Ct=o.at([],Pe,be)),q[we]=Pe);const Re=(Ve-Se)/Ee,nt=Je.sub(pt)._mult(Re)._add(pt),Ze=o.bE([],be,Ct,Re);let yt=[0,0,1],bt=Ct[0],Et=Ct[1];if(ie&&(yt=ee.upVector(re.canonical,nt.x,nt.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const tr=[yt[2],0,-yt[0]],ir=o.bF([],yt,tr);o.au(tr,tr),o.au(ir,ir),bt=o.bG(Ct,tr),Et=o.bG(Ct,ir)}if(u){const tr=o.bF([],yt,Ct);o.au(tr,tr),o.bE(Ze,Ze,tr,u*me)}const jt=Te+Math.atan2(Et,bt);return De.push(Ze),K&&dt.push(nt),{point:Ze,angle:jt,path:De,tilePath:dt,up:yt}}function Zh(m,a){const u=a.length,g=u+4*m;a.resize(g),a.float32.fill(-1/0,4*u,4*g)}function _1(m,a,u){const g=a[0],x=a[1];return m[0]=u[0]*g+u[4]*x+u[12],m[1]=u[1]*g+u[5]*x+u[13],m[3]=u[3]*g+u[7]*x+u[15],m}const lr=100;class v1{constructor(a,u,g=new Hh(a.width+200,a.height+200,25),x=new Hh(a.width+200,a.height+200,25)){this.transform=a,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+lr,this.screenBottomBoundary=a.height+lr,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=u}placeCollisionBox(a,u,g,x,b,E,P,I,z,F,q){let $=g.projectedAnchorX,K=g.projectedAnchorY,te=g.projectedAnchorZ;const ee=g.tileAnchorX,re=g.tileAnchorY,ie=g.elevation,ue=g.tileID,pe=a.getProjection();if(ie&&ue){const[dt,Je,pt]=pe.upVector(ue.canonical,g.tileAnchorX,g.tileAnchorY),Ct=pe.upVectorScale(ue.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$+=dt*ie*Ct,K+=Je*ie*Ct,te+=pt*ie*Ct}const me=a.projection.name==="globe",Te=a.projection.name==="globe"?o.ah(this.transform.zoom):0;if(ue&&me&&Te<1&&!E){const dt=1<<ue.canonical.z,Je=o.bM(ee,re);o.bN(Je,Je,1/o.aj),o.bO(Je,Je,o.bM(ue.canonical.x,ue.canonical.y)),o.bN(Je,Je,1/dt),o.bP(Je,Je,o.bM(x[0],x[1])),Je[0]=o.bQ(Je[0],-.5,.5),o.bN(Je,Je,o.aj);const pt=o.bR(Je[0],Je[1],o.aj/(2*Math.PI),1);o.aA(pt,pt,b),$=o.ai($,pt[0],Te),K=o.ai(K,pt[1],Te),te=o.ai(te,pt[2],Te)}const we=this.projectAndGetPerspectiveRatio(F,$,K,te,g.tileID,pe.name==="globe"||!!ie||this.transform.pitch>0,pe),Pe=z*we.perspectiveRatio,be=(g.x1*u+P.x-g.padding)*Pe+we.point.x,Se=(g.y1*u+P.y-g.padding)*Pe+we.point.y,Ee=(g.x2*u+P.x+g.padding)*Pe+we.point.x,Ve=(g.y2*u+P.y+g.padding)*Pe+we.point.y,De=we.perspectiveRatio<=.55||we.occluded;return!this.isInsideGrid(be,Se,Ee,Ve)||!I&&this.grid.hitTest(be,Se,Ee,Ve,q)||De?{box:[],offscreen:!1,occluded:we.occluded}:{box:[be,Se,Ee,Ve],offscreen:this.isOffscreen(be,Se,Ee,Ve),occluded:!1}}placeCollisionCircles(a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee){const re=[],ie=this.transform.elevation,ue=a.getProjection(),pe=ie?ie.getAtTileOffsetFunc(ee,this.transform.center.lat,this.transform.worldSize,ue):null,me=new o.P(g.tileAnchorX,g.tileAnchorY);let{x:Te,y:we,z:Pe}=ue.projectTilePoint(me.x,me.y,ee.canonical);if(pe){const[yt,bt,Et]=pe(me);Te+=yt,we+=bt,Pe+=Et}const be=ue.name==="globe",Se=this.projectAndGetPerspectiveRatio(P,Te,we,Pe,ee,be||!!ie||this.transform.pitch>0,ue),{perspectiveRatio:Ee}=Se,Ve=(q?E/Ee:E*Ee)/o.bU,De=ns(Te,we,Pe,I),dt=g.lineOffsetX*Ve,Je=g.lineOffsetY*Ve,pt=o.al(a.layers[0].layout.get("text-max-angle")),Ct=Math.cos(pt),We=Se.signedDistanceFromCamera>0?Ba(Ve,b,dt,Je,!1,De,me,g,x,I,{},ie&&!q?pe:null,q&&!!ie,ue,ee,q,Ct):null;let Re=!1,nt=!1,Ze=!0;if(We&&!Se.occluded){const yt=.5*K*Ee+te,bt=new o.P(-100,-100),Et=new o.P(this.screenRightBoundary,this.screenBottomBoundary),jt=new g1,{first:tr,last:ir}=We,Zt=tr.path.length;let er=[];for(let Cr=Zt-1;Cr>=1;Cr--)er.push(tr.path[Cr]);for(let Cr=1;Cr<ir.path.length;Cr++)er.push(ir.path[Cr]);const nr=2.5*yt;z&&(er=er.map(([Cr,Nr,Cn],vr)=>(pe&&!be&&(Cn=pe(vr<Zt-1?tr.tilePath[Zt-1-vr]:ir.tilePath[vr-Zt+2])[2]),ns(Cr,Nr,Cn,z))),er.some(Cr=>Cr[3]<=0)&&(er=[]));let wr=[];if(er.length>0){let Cr=1/0,Nr=-1/0,Cn=1/0,vr=-1/0;for(const un of er)Cr=Math.min(Cr,un[0]),Cn=Math.min(Cn,un[1]),Nr=Math.max(Nr,un[0]),vr=Math.max(vr,un[1]);Nr>=bt.x&&Cr<=Et.x&&vr>=bt.y&&Cn<=Et.y&&(wr=[er.map(un=>new o.P(un[0],un[1]))],(Cr<bt.x||Nr>Et.x||Cn<bt.y||vr>Et.y)&&(wr=o.bS(wr,bt.x,bt.y,Et.x,Et.y)))}for(const Cr of wr){jt.reset(Cr,.25*yt);let Nr=0;Nr=jt.length<=.5*yt?1:Math.ceil(jt.paddedLength/nr)+1;for(let Cn=0;Cn<Nr;Cn++){const vr=Cn/Math.max(Nr-1,1),un=jt.lerp(vr),hn=un.x+lr,Zn=un.y+lr;re.push(hn,Zn,yt,0);const Mr=hn-yt,an=Zn-yt,cn=hn+yt,vn=Zn+yt;if(Ze=Ze&&this.isOffscreen(Mr,an,cn,vn),nt=nt||this.isInsideGrid(Mr,an,cn,vn),!u&&this.grid.hitTestCircle(hn,Zn,yt,$)&&(Re=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!F&&Re||!nt?[]:re,offscreen:Ze,collisionDetected:Re,occluded:Se.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let g=1/0,x=1/0,b=-1/0,E=-1/0;for(const F of a){const q=new o.P(F.x+lr,F.y+lr);g=Math.min(g,q.x),x=Math.min(x,q.y),b=Math.max(b,q.x),E=Math.max(E,q.y),u.push(q)}const P=this.grid.query(g,x,b,E).concat(this.ignoredGrid.query(g,x,b,E)),I={},z={};for(const F of P){const q=F.key;if(I[q.bucketInstanceId]===void 0&&(I[q.bucketInstanceId]={}),I[q.bucketInstanceId][q.featureIndex])continue;const $=[new o.P(F.x1,F.y1),new o.P(F.x2,F.y1),new o.P(F.x2,F.y2),new o.P(F.x1,F.y2)];o.bT(u,$)&&(I[q.bucketInstanceId][q.featureIndex]=!0,z[q.bucketInstanceId]===void 0&&(z[q.bucketInstanceId]=[]),z[q.bucketInstanceId].push(q.featureIndex))}return z}insertCollisionBox(a,u,g,x,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:b},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,u,g,x,b){const E=u?this.ignoredGrid:this.grid,P={bucketInstanceId:g,featureIndex:x,collisionGroupID:b};for(let I=0;I<a.length;I+=4)E.insertCircle(P,a[I],a[I+1],a[I+2])}projectAndGetPerspectiveRatio(a,u,g,x,b,E,P){const I=[u,g,x,1];let z=!1;x||this.transform.pitch>0?(o.aA(I,I,a),this.fogState&&b&&P.name!=="globe"&&(z=function(q,$,K,te,ee,re){const ie=re.calculateFogTileMatrix(ee),ue=[$,K,te];return o.ad(ue,ue,ie),sr(q,o.ae(ue),re.pitch,re._fov)}(this.fogState,u,g,x,b.toUnwrapped(),this.transform)>.9)):_1(I,I,a);const F=I[3];return{point:new o.P((I[0]/F+1)/2*this.transform.width+lr,(-I[1]/F+1)/2*this.transform.height+lr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/F*.5,1.5),signedDistanceFromCamera:F,occluded:E&&I[2]>F||z}}isOffscreen(a,u,g,x){return g<lr||a>=this.screenRightBoundary||x<lr||u>this.screenBottomBoundary}isInsideGrid(a,u,g,x){return g>=0&&a<this.gridRightBoundary&&x>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const a=o.bx([]);return o.bo(a,a,[-100,-100,0]),a}}class Gf{constructor(a,u,g,x){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?u:-u))):x&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Bu{constructor(a,u,g,x,b,E=!1){this.text=new Gf(a?a.text:null,u,g,b),this.icon=new Gf(a?a.icon:null,u,x,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class is{constructor(a,u,g,x=!1){this.text=a,this.icon=u,this.skipFade=g,this.clipped=x}}class kv{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class Kh{constructor(a,u,g,x,b){this.bucketInstanceId=a,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=b}}class or{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const u=++this.maxGroupID;this.collisionGroups[a]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[a]}}function yn(m,a,u,g,x){const{horizontalAlign:b,verticalAlign:E}=o.bZ(m),P=-(b-.5)*a,I=-(E-.5)*u,z=o.b_(m,g);return new o.P(P+z[0]*x,I+z[1]*x)}function _n(m,a,u,g,x){const b=new o.P(m,a);return u&&b._rotate(g?x:-x),b}class Ua{constructor(a,u,g,x,b,E){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new v1(this.transform,b),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new or(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,u,g,x,b=1){const E=g.getBucket(u),P=g.latestFeatureIndex;if(!E||!P||u.fqid!==E.layerIds[0])return;const I=E.layers[0].layout,z=E.layers[0].paint,F=g.collisionBoxArray,q=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),$=g.tileSize/o.aj,K=g.tileID.toUnwrapped();this.transform.setProjection(E.projection);const te=(ee=g.tileID,re=E.getProjection(),ie=this.transform,re.name===this.projection?ie.calculateProjMatrix(ee.toUnwrapped()):Uf(ie,re,ee));var ee,re,ie;const ue=I.get("text-pitch-alignment")==="map",pe=I.get("text-rotation-alignment")==="map";u.compileFilter(u.options);const me=u.dynamicFilter(),Te=u.dynamicFilterNeedsFeature(),we=this.transform.calculatePixelsToTileUnitsMatrix(g),Pe=Wh(te,g.tileID.canonical,ue,pe,this.transform,E.getProjection(),we);let be=null;const Se=E.getProjection().createInversionMatrix(this.transform,g.tileID.canonical);if(ue){const Re=Wl(te,g.tileID.canonical,ue,pe,this.transform,E.getProjection(),we);be=o.az([],this.transform.labelPlaneMatrix,Re)}let Ee=null;me&&g.latestFeatureIndex&&(Ee={unwrappedTileID:K,dynamicFilter:me,dynamicFilterNeedsFeature:Te}),this.retainedQueryData[E.bucketInstanceId]=new Kh(E.bucketInstanceId,P,E.sourceLayerIndex,E.index,g.tileID);const[Ve,De]=E.layers[0].layout.get("text-size-scale-range"),dt=o.ay(b,Ve,De),[Je,pt]=I.get("icon-size-scale-range"),Ct=o.ay(b,Je,pt),We={bucket:E,layout:I,paint:z,posMatrix:te,invMatrix:Se,mercatorCenter:[o.aD(this.transform.center.lng),o.aH(this.transform.center.lat)],textLabelPlaneMatrix:Pe,labelToScreenMatrix:be,clippingData:Ee,scale:q,textPixelRatio:$,holdingForFade:g.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:o.bH(E.textSizeData,this.transform.zoom,dt),partiallyEvaluatedIconSize:o.bH(E.iconSizeData,this.transform.zoom,Ct),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(x)for(const Re of E.sortKeyRanges){const{sortKey:nt,symbolInstanceStart:Ze,symbolInstanceEnd:yt}=Re;a.push({sortKey:nt,symbolInstanceStart:Ze,symbolInstanceEnd:yt,parameters:We})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:We})}attemptAnchorPlacement(a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re,ie,ue,pe,me,Te){const{textOffset0:we,textOffset1:Pe,crossTileID:be}=ee,Se=[we,Pe],Ee=yn(a,E,P,Se,I),Ve=this.collisionIndex.placeCollisionBox(ie,I,u,g,x,b,_n(Ee.x,Ee.y,z,F,this.transform.angle),te,q,$,K.predicate);if(pe){const De=ie.getSymbolInstanceIconSize(Te,this.transform.zoom,ee.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ie,De,pe,g,x,b,_n(Ee.x,Ee.y,z,F,this.transform.angle),te,q,$,K.predicate).box.length===0)return}if(Ve.box.length>0){let De;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(De=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:Se,width:E,height:P,anchor:a,textScale:I,prevAnchor:De},this.markUsedJustification(ie,a,ee,ue),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ue,ee),this.placedOrientations[be]=ue),{shift:Ee,placedGlyphBoxes:Ve}}}placeLayerBucketPart(a,u,g,x,b=1){const{bucket:E,layout:P,paint:I,posMatrix:z,textLabelPlaneMatrix:F,labelToScreenMatrix:q,clippingData:$,textPixelRatio:K,mercatorCenter:te,invMatrix:ee,holdingForFade:re,collisionBoxArray:ie,partiallyEvaluatedTextSize:ue,partiallyEvaluatedIconSize:pe,collisionGroup:me,latestFeatureIndex:Te}=a.parameters,we=P.get("text-optional"),Pe=P.get("icon-optional"),be=P.get("text-allow-overlap"),Se=P.get("icon-allow-overlap"),Ee=P.get("text-rotation-alignment")==="map",Ve=P.get("icon-rotation-alignment")==="map",De=P.get("text-pitch-alignment")==="map",dt=I.get("symbol-z-offset"),Je=P.get("symbol-elevation-reference")==="sea",pt=P.get("symbol-placement"),[Ct,We]=P.get("text-size-scale-range"),[Re,nt]=P.get("icon-size-scale-range"),Ze=o.ay(b,Ct,We),yt=o.ay(b,Re,nt),bt=P.get("text-variable-anchor"),Et=Ee&&pt!=="point",jt=Ve&&pt!=="point",tr=bt&&E.hasTextData(),ir=E.hasIconTextFit()&&tr&&E.hasIconData();this.transform.setProjection(E.projection);const Zt=tr||Et,er=jt||ir;let nr=be&&(Se||!E.hasIconData()||Pe),wr=Se&&(be||!E.hasTextData()||we);const Cr=!dt.isConstant();!E.collisionArrays&&ie&&E.deserializeCollisionBoxes(ie),g&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,ie,Ze,yt);const Nr=(vr,un,hn)=>{const{crossTileID:Zn,numVerticalGlyphVertices:Mr}=vr;let an=null;if($&&$.dynamicFilterNeedsFeature||Cr){const oi=this.retainedQueryData[E.bucketInstanceId];an=Te.loadFeature({featureIndex:vr.featureIndex,bucketIndex:oi.bucketIndex,sourceLayerIndex:oi.sourceLayerIndex,layoutVertexArrayOffset:0})}if($&&!(0,$.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},an,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new o.P(vr.tileAnchorX,vr.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[Zn]=new is(!1,!1,!1,!0),void u.add(Zn);const cn=dt.evaluate(an,{});if(u.has(Zn))return;if(re)return void(this.placements[Zn]=new is(!1,!1,!1));let vn=!1,hi=!1,kr=!0,mn=!1,mi=!1,rn=null,xn={box:null,offscreen:null,occluded:null},Ln={box:null},Ei=null,Oi=null,ji=null,Do=0,cs=0,$a=0;hn.textFeatureIndex?Do=hn.textFeatureIndex:vr.useRuntimeCollisionCircles&&(Do=vr.featureIndex),hn.verticalTextFeatureIndex&&(cs=hn.verticalTextFeatureIndex);const fa=oi=>{oi.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Ri=this.transform.elevation;oi.elevation=Je?cn:cn+(Ri?Ri.getAtTileOffset(oi.tileID,oi.tileAnchorX,oi.tileAnchorY):0),oi.elevation+=vr.zOffset},pa=hn.textBox;if(pa){fa(pa);const oi=Vn=>{let Di=o.bI.horizontal;if(E.allowVerticalPlacement&&!Vn&&this.prevPlacement){const Xo=this.prevPlacement.placedOrientations[Zn];Xo&&(this.placedOrientations[Zn]=Xo,Di=Xo,this.markUsedOrientation(E,Di,vr))}return Di},Ri=(Vn,Di)=>{if(E.allowVerticalPlacement&&Mr>0&&hn.verticalTextBox){for(const Xo of E.writingModes)if(Xo===o.bI.vertical?(xn=Di(),Ln=xn):xn=Vn(),xn&&xn.box&&xn.box.length)break}else xn=Vn()};if(bt){let Vn=bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Zn]){const _i=this.prevPlacement.variableOffsets[Zn];Vn.indexOf(_i.anchor)>0&&(Vn=Vn.filter(Ia=>Ia!==_i.anchor),Vn.unshift(_i.anchor))}const Di=(_i,Ia,Qu)=>{const Qc=E.getSymbolInstanceTextSize(ue,vr,this.transform.zoom,un),Td=(_i.x2-_i.x1)*Qc+2*_i.padding,Ed=(_i.y2-_i.y1)*Qc+2*_i.padding,eu=vr.hasIconTextFit&&!Se?Ia:null;eu&&fa(eu);let Oa={box:[],offscreen:!1,occluded:!1};const tu=be?2*Vn.length:Vn.length;for(let $i=0;$i<tu;++$i){const Ds=this.attemptAnchorPlacement(Vn[$i%Vn.length],_i,te,ee,Zt,Td,Ed,Qc,Ee,De,K,z,me,$i>=Vn.length,vr,un,E,Qu,eu,ue,pe);if(Ds&&(Oa=Ds.placedGlyphBoxes,Oa&&Oa.box&&Oa.box.length)){vn=!0,rn=Ds.shift;break}}return Oa};Ri(()=>Di(pa,hn.iconBox,o.bI.horizontal),()=>{const _i=hn.verticalTextBox;return _i&&fa(_i),E.allowVerticalPlacement&&!(xn&&xn.box&&xn.box.length)&&Mr>0&&_i?Di(_i,hn.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}}),xn&&(vn=xn.box,kr=xn.offscreen,mn=xn.occluded);const Xo=oi(!(!xn||!xn.box));if(!vn&&this.prevPlacement){const _i=this.prevPlacement.variableOffsets[Zn];_i&&(this.variableOffsets[Zn]=_i,this.markUsedJustification(E,_i.anchor,vr,Xo))}}else{const Vn=(Di,Xo)=>{const _i=E.getSymbolInstanceTextSize(ue,vr,this.transform.zoom,un,b),Ia=this.collisionIndex.placeCollisionBox(E,_i,Di,te,ee,Zt,new o.P(0,0),be,K,z,me.predicate);return Ia&&Ia.box&&Ia.box.length&&(this.markUsedOrientation(E,Xo,vr),this.placedOrientations[Zn]=Xo),Ia};Ri(()=>Vn(pa,o.bI.horizontal),()=>{const Di=hn.verticalTextBox;return E.allowVerticalPlacement&&Mr>0&&Di?(fa(Di),Vn(Di,o.bI.vertical)):{box:null,offscreen:null,occluded:null}}),oi(!!(xn&&xn.box&&xn.box.length))}}if(Ei=xn,vn=Ei&&Ei.box&&Ei.box.length>0,kr=Ei&&Ei.offscreen,mn=Ei&&Ei.occluded,vr.useRuntimeCollisionCircles){const oi=E.text.placedSymbolArray.get(vr.centerJustifiedTextSymbolIndex>=0?vr.centerJustifiedTextSymbolIndex:vr.verticalPlacedTextSymbolIndex),Ri=o.bJ(E.textSizeData,ue,oi),Vn=P.get("text-padding");Oi=this.collisionIndex.placeCollisionCircles(E,be,oi,E.lineVertexArray,E.glyphOffsetArray,Ri,z,F,q,g,De,me.predicate,vr.collisionCircleDiameter*Ri/o.bU,Vn,this.retainedQueryData[E.bucketInstanceId].tileID),vn=be||Oi.circles.length>0&&!Oi.collisionDetected,kr=kr&&Oi.offscreen,mn=Oi.occluded}if(hn.iconFeatureIndex&&($a=hn.iconFeatureIndex),hn.iconBox){const oi=Ri=>{fa(Ri);const Vn=vr.hasIconTextFit&&rn?_n(rn.x,rn.y,Ee,De,this.transform.angle):new o.P(0,0),Di=E.getSymbolInstanceIconSize(pe,this.transform.zoom,vr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Di,Ri,te,ee,er,Vn,Se,K,z,me.predicate)};Ln&&Ln.box&&Ln.box.length&&hn.verticalIconBox?(ji=oi(hn.verticalIconBox),hi=ji.box.length>0):(ji=oi(hn.iconBox),hi=ji.box.length>0),kr=kr&&ji.offscreen,mi=ji.occluded}const Ga=we||vr.numHorizontalGlyphVertices===0&&Mr===0,js=Pe||vr.numIconVertices===0;if(Ga||js?js?Ga||(hi=hi&&vn):vn=hi&&vn:hi=vn=hi&&vn,vn&&Ei&&Ei.box&&this.collisionIndex.insertCollisionBox(Ei.box,P.get("text-ignore-placement"),E.bucketInstanceId,Ln&&Ln.box&&cs?cs:Do,me.ID),hi&&ji&&this.collisionIndex.insertCollisionBox(ji.box,P.get("icon-ignore-placement"),E.bucketInstanceId,$a,me.ID),Oi&&(vn&&this.collisionIndex.insertCollisionCircles(Oi.circles,P.get("text-ignore-placement"),E.bucketInstanceId,Do,me.ID),g)){const oi=E.bucketInstanceId;let Ri=this.collisionCircleArrays[oi];Ri===void 0&&(Ri=this.collisionCircleArrays[oi]=new kv);for(let Vn=0;Vn<Oi.circles.length;Vn+=4)Ri.circles.push(Oi.circles[Vn+0]),Ri.circles.push(Oi.circles[Vn+1]),Ri.circles.push(Oi.circles[Vn+2]),Ri.circles.push(Oi.collisionDetected?1:0)}const Rs=E.projection.name!=="globe";nr=nr&&(Rs||!mn),wr=wr&&(Rs||!mi),this.placements[Zn]=new is(vn||nr,hi||wr,kr||E.justReloaded),u.add(Zn)},Cn=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,Cn),E.elevationType==="road"&&E.updateRoadElevation(Cn.canonical),E.updateZOffset(),E.sortFeaturesByY){const vr=E.getSortedSymbolIndexes(this.transform.angle);for(let un=vr.length-1;un>=0;--un){const hn=vr[un];Nr(E.symbolInstances.get(hn),hn,E.collisionArrays[hn])}E.hasAnyZOffset&&o.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const vr=E.getSortedIndexesByZOffset();for(let un=0;un<vr.length;++un){const hn=vr[un];Nr(E.symbolInstances.get(hn),hn,E.collisionArrays[hn])}}else for(let vr=a.symbolInstanceStart;vr<a.symbolInstanceEnd;vr++)Nr(E.symbolInstances.get(vr),vr,E.collisionArrays[vr]);if(g&&E.bucketInstanceId in this.collisionCircleArrays){const vr=this.collisionCircleArrays[E.bucketInstanceId];o.bi(vr.invProjMatrix,z),vr.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(a,u,g,x){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:I,crossTileID:z}=g,F=o.b$(u),q=x===o.bI.vertical?I:F==="left"?b:F==="center"?E:F==="right"?P:-1;b>=0&&(a.text.placedSymbolArray.get(b).crossTileID=q>=0&&b!==q?0:z),E>=0&&(a.text.placedSymbolArray.get(E).crossTileID=q>=0&&E!==q?0:z),P>=0&&(a.text.placedSymbolArray.get(P).crossTileID=q>=0&&P!==q?0:z),I>=0&&(a.text.placedSymbolArray.get(I).crossTileID=q>=0&&I!==q?0:z)}markUsedOrientation(a,u,g){const x=u===o.bI.horizontal||u===o.bI.horizontalOnly?u:0,b=u===o.bI.vertical?u:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:z}=g,F=a.text.placedSymbolArray;E>=0&&(F.get(E).placedOrientation=x),P>=0&&(F.get(P).placedOrientation=x),I>=0&&(F.get(I).placedOrientation=x),z>=0&&(F.get(z).placedOrientation=b)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const x=u?u.symbolFadeChange(a):1,b=u?u.opacities:{},E=u?u.variableOffsets:{},P=u?u.placedOrientations:{};for(const I in this.placements){const z=this.placements[I],F=b[I];F?(this.opacities[I]=new Bu(F,x,z.text,z.icon,null,z.clipped),g=g||z.text!==F.text.placed||z.icon!==F.icon.placed):(this.opacities[I]=new Bu(null,x,z.text,z.icon,z.skipFade,z.clipped),g=g||z.text||z.icon)}for(const I in b){const z=b[I];if(!this.opacities[I]){const F=new Bu(z,x,!1,!1);F.isHidden()||(this.opacities[I]=F,g=g||z.text.placed||z.icon.placed)}}for(const I in E)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=E[I]);for(const I in P)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=P[I]);g?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:a)}updateLayerOpacities(a,u,g,x){const b=new Set;for(const E of u){const P=E.getBucket(a);P&&E.latestFeatureIndex&&a.fqid===P.layerIds[0]&&(this.updateBucketOpacities(P,b,E,E.collisionBoxArray,g,x,E.tileID,a.scope),P.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(P,E.tileID),P.elevationType==="road"&&P.updateRoadElevation(E.tileID.canonical),P.updateZOffset())}}updateBucketOpacities(a,u,g,x,b,E,P,I){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const z=a.layers[0].layout,F=a.layers[0].paint,q=!!a.layers[0].dynamicFilter(),$=new Bu(null,0,!1,!1,!0),K=z.get("text-allow-overlap"),te=z.get("icon-allow-overlap"),ee=z.get("text-variable-anchor"),re=z.get("text-rotation-alignment")==="map",ie=z.get("text-pitch-alignment")==="map",ue=F.get("symbol-z-offset"),pe=z.get("symbol-elevation-reference")==="sea",me=!ue.isConstant(),Te=new Bu(null,0,K&&(te||!a.hasIconData()||z.get("icon-optional")),te&&(K||!a.hasTextData()||z.get("text-optional")),!0);!a.collisionArrays&&x&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(x);const we=(be,Se,Ee)=>{for(let Ve=0;Ve<Se/4;Ve++)be.opacityVertexArray.emplaceBack(Ee)};let Pe=0;E&&a.updateReplacement(P,E);for(let be=0;be<a.symbolInstances.length;be++){const Se=a.symbolInstances.get(be),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Ve,crossTileID:De,numIconVertices:dt,tileAnchorX:Je,tileAnchorY:pt}=Se;let Ct=null;const We=this.retainedQueryData[a.bucketInstanceId];me&&Se&&We&&(Ct=g.latestFeatureIndex.loadFeature({featureIndex:Se.featureIndex,bucketIndex:We.bucketIndex,sourceLayerIndex:We.sourceLayerIndex,layoutVertexArrayOffset:0}));const Re=ue.evaluate(Ct,{}),nt=u.has(De);let Ze=this.opacities[De];nt?Ze=$:Ze||(Ze=Te,this.opacities[De]=Ze),u.add(De);const yt=Ee>0||Ve>0,bt=dt>0,Et=this.placedOrientations[De],jt=Et===o.bI.vertical,tr=Et===o.bI.horizontal||Et===o.bI.horizontalOnly;!yt&&!bt||Ze.isHidden()||Pe++;let ir=!1;if((yt||bt)&&E)for(const Zt of a.activeReplacements){if(o.bV(Zt,b,o.bW.Symbol,I)||Zt.min.x>Je||Je>Zt.max.x||Zt.min.y>pt||pt>Zt.max.y)continue;const er=o.bX(Je,pt,P.canonical,Zt.footprintTileId.canonical);if(ir=o.bY(er,Zt.footprint),ir)break}if(yt){const Zt=ir?Dc:Xh(Ze.text);we(a.text,Ee,jt?Dc:Zt),we(a.text,Ve,tr?Dc:Zt);const er=Ze.text.isHidden(),{leftJustifiedTextSymbolIndex:nr,centerJustifiedTextSymbolIndex:wr,rightJustifiedTextSymbolIndex:Cr,verticalPlacedTextSymbolIndex:Nr}=Se,Cn=a.text.placedSymbolArray,vr=er||jt?1:0;nr>=0&&(Cn.get(nr).hidden=vr),wr>=0&&(Cn.get(wr).hidden=vr),Cr>=0&&(Cn.get(Cr).hidden=vr),Nr>=0&&(Cn.get(Nr).hidden=er||tr?1:0);const un=this.variableOffsets[De];un&&this.markUsedJustification(a,un.anchor,Se,Et);const hn=this.placedOrientations[De];hn&&(this.markUsedJustification(a,"left",Se,hn),this.markUsedOrientation(a,hn,Se))}if(bt){const Zt=ir?Dc:Xh(Ze.icon),{placedIconSymbolIndex:er,verticalPlacedIconSymbolIndex:nr}=Se,wr=a.icon.placedSymbolArray,Cr=Ze.icon.isHidden()?1:0;er>=0&&(we(a.icon,dt,jt?Dc:Zt),wr.get(er).hidden=Cr),nr>=0&&(we(a.icon,Se.numVerticalIconVertices,tr?Dc:Zt),wr.get(nr).hidden=Cr)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Zt=a.collisionArrays[be];if(Zt){let er=new o.P(0,0),nr=!0;if(Zt.textBox||Zt.verticalTextBox){if(ee){const Cr=this.variableOffsets[De];Cr?(er=yn(Cr.anchor,Cr.width,Cr.height,Cr.textOffset,Cr.textScale),re&&er._rotate(ie?this.transform.angle:-this.transform.angle)):nr=!1}q&&(nr=!Ze.clipped),Zt.textBox&&Zl(a.textCollisionBox.collisionVertexArray,Ze.text.placed,!nr||jt,Re,pe,er.x,er.y),Zt.verticalTextBox&&Zl(a.textCollisionBox.collisionVertexArray,Ze.text.placed,!nr||tr,Re,pe,er.x,er.y)}const wr=nr&&!!(!tr&&Zt.verticalIconBox);Zt.iconBox&&Zl(a.iconCollisionBox.collisionVertexArray,Ze.icon.placed,wr,Re,pe,Se.hasIconTextFit?er.x:0,Se.hasIconTextFit?er.y:0),Zt.verticalIconBox&&Zl(a.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!wr,Re,pe,Se.hasIconTextFit?er.x:0,Se.hasIconTextFit?er.y:0)}}}if(a.fullyClipped=Pe===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=be.invProjMatrix,a.placementViewportMatrix=be.viewportMatrix,a.collisionCircleArray=be.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>a}setStale(){this.stale=!0}}function Zl(m,a,u,g,x,b,E){m.emplaceBack(a?1:0,u?1:0,b||0,E||0,g,x?1:0),m.emplaceBack(a?1:0,u?1:0,b||0,E||0,g,x?1:0),m.emplaceBack(a?1:0,u?1:0,b||0,E||0,g,x?1:0),m.emplaceBack(a?1:0,u?1:0,b||0,E||0,g,x?1:0)}const En=Math.pow(2,25),Wm=Math.pow(2,24),qf=Math.pow(2,17),Hf=Math.pow(2,16),Ho=Math.pow(2,9),Zi=Math.pow(2,8),TC=Math.pow(2,1);function Xh(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const a=m.placed?1:0,u=Math.floor(127*m.opacity);return u*En+a*Wm+u*qf+a*Hf+u*Ho+a*Zi+u*TC+a}const Dc=0;class Wf{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,u,g,x,b,E){const P=this._bucketParts;for(;this._currentTileIndex<a.length;)if(u.getBucketParts(P,x,a[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((I,z)=>I.sortKey-z.sortKey));this._currentPartIndex<P.length;){const I=P[this._currentPartIndex];if(u.placeLayerBucketPart(I,this._seenCrossTileIDs,g,I.symbolInstanceStart===0,E),this._currentPartIndex++,b())return!0}return!1}}class Zm{constructor(a,u,g,x,b,E,P,I,z){this.placement=new Ua(a,b,E,P,I,z),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(a,u,g,x,b){const E=o.q.now(),P=()=>{const I=o.q.now()-E;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=u[a[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=z)&&(!I.maxzoom||I.maxzoom>z)){const F=I,q=F.layout.get("symbol-z-elevate"),$=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,K=F.layout.get("symbol-z-order"),te=K==="viewport-y"||K==="auto"&&!(K!=="viewport-y"&&$),ee=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),re=te&&ee,ie=this._inProgressLayer=this._inProgressLayer||new Wf(F),ue=o.C(I.source,I.scope);if(ie.continuePlacement(q||re?x[ue]:g[ue],this.placement,this._showCollisionBoxes,I,P,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Zf=512/o.aj/2;class Km{constructor(a,u,g){this.tileID=a,this.bucketInstanceId=g,this.index=new o.c0(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=a.canonical.x*o.aj,b=a.canonical.y*o.aj;for(let E=0;E<u.length;E++){const{key:P,crossTileID:I,tileAnchorX:z,tileAnchorY:F}=u.get(E),q=Math.floor((x+z)*Zf),$=Math.floor((b+F)*Zf);this.index.add(q,$),this.keys.push(P),this.crossTileIDs.push(I)}this.index.finish()}findMatches(a,u,g){const x=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),b=Zf/Math.pow(2,u.canonical.z-this.tileID.canonical.z),E=u.canonical.x*o.aj,P=u.canonical.y*o.aj;for(let I=0;I<a.length;I++){const z=a.get(I);if(z.crossTileID)continue;const{key:F,tileAnchorX:q,tileAnchorY:$}=z,K=Math.floor((E+q)*b),te=Math.floor((P+$)*b),ee=this.index.range(K-x,te-x,K+x,te+x).sort((re,ie)=>re-ie);for(const re of ee){const ie=this.crossTileIDs[re];if(this.keys[re]===F&&!g.has(ie)){g.add(ie),z.crossTileID=ie;break}}}}}class ca{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const u=Math.round((a-this.lng)/360);if(u!==0)for(const g in this.indexes){const x=this.indexes[g],b={};for(const E in x){const P=x[E];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+u),b[P.tileID.key]=P}this.indexes[g]=b}this.lng=a}addBucket(a,u,g){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const x=this.usedCrossTileIDs[a.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>a.overscaledZ)for(const P in E){const I=E[P];I.tileID.isChildOf(a)&&I.findMatches(u.symbolInstances,a,x)}else{const P=E[a.scaledTo(Number(b)).key];P&&P.findMatches(u.symbolInstances,a,x)}}for(let b=0;b<u.symbolInstances.length;b++){const E=u.symbolInstances.get(b);E.crossTileID||(E.crossTileID=g.generate(),x.add(E.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Km(a,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(a,u){for(const g of u.crossTileIDs)this.usedCrossTileIDs[a].delete(g)}removeStaleBuckets(a){let u=!1;for(const g in this.indexes){const x=this.indexes[g];for(const b in x)a[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[b]),delete x[b],u=!0)}return u}}class ka{constructor(){this.layerIndexes={},this.crossTileIDs=new ca,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,u,g,x){let b=this.layerIndexes[a.fqid];b===void 0&&(b=this.layerIndexes[a.fqid]=new Kl);let E=!1;const P={};x.name!=="globe"&&b.handleWrapJump(g);for(const I of u){const z=I.getBucket(a);z&&a.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(I.tileID,z,this.crossTileIDs)&&(E=!0),P[z.bucketInstanceId]=!0)}return b.removeStaleBuckets(P)&&(E=!0),E}pruneUnusedLayers(a){const u={};a.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const Uu=771;class Or{constructor(a,u,g,x){this.blendFunction=a,this.blendColor=u.toNonPremultipliedRenderColor(null),this.mask=g,this.blendEquation=x}}Or.Replace=[1,0,1,0],Or.disabled=new Or(Or.Replace,o.am.transparent,[!1,!1,!1,!1]),Or.unblended=new Or(Or.Replace,o.am.transparent,[!0,!0,!0,!0]),Or.alphaBlended=new Or([1,Uu,1,Uu],o.am.transparent,[!0,!0,!0,!0]),Or.alphaBlendedNonPremultiplied=new Or([770,Uu,770,Uu],o.am.transparent,[!0,!0,!0,!0]),Or.multiply=new Or([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class Ht{constructor(a,u,g){this.func=a,this.mask=u,this.range=g}}Ht.ReadOnly=!1,Ht.ReadWrite=!0,Ht.disabled=new Ht(519,Ht.ReadOnly,[0,1]);const ks=7680;class mr{constructor(a,u,g,x,b,E){this.test=a,this.ref=u,this.mask=g,this.fail=x,this.depthFail=b,this.pass=E}}mr.disabled=new mr({func:519,mask:0},0,0,ks,ks,ks);const Vi=1029,Kf=2305;class ur{constructor(a,u,g){this.enable=a,this.mode=u,this.frontFace=g}}function Yh(m,a){const u=o.c6(m,3);o.c8(m,a),o.cc(m,3,u)}function Jh(m,a){const u=o.c3([]);return o.c4(u,u,-a),o.c5(u,u,-m),u}function Lc(m,a){const u=[m[0],m[1],0],g=[a[0],a[1],0];if(o.ae(u)>=1e-15){const E=o.au([],u);o.c1(g,E,o.bG(g,E)),a[0]=g[0],a[1]=g[1]}const x=o.bF([],a,m);if(o.c2(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return Jh(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),b)}ur.disabled=new ur(!1,Vi,Kf),ur.backCCW=new ur(!0,Vi,Kf),ur.backCW=new ur(!0,Vi,2304),ur.frontCW=new ur(!0,1028,2304),ur.frontCCW=new ur(!0,1028,Kf);class x1{constructor(a,u){this.position=a,this.orientation=u}get position(){return this._position}set position(a){if(a){const u=a instanceof o.ac?a:new o.ac(a[0],a[1],a[2]);this._renderWorldCopies&&(u.x=o.bQ(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(a,u){if(this.orientation=null,!this.position)return;const g=this.position,x=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(a)):0,b=o.ac.fromLngLat(a,x),E=[b.x-g.x,b.y-g.y,b.z-g.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Lc(E,u)}setPitchBearing(a,u){this.orientation=Jh(o.al(a),o.al(-u))}}class Cs{constructor(a,u){this._transform=o.bx([]),this.orientation=u,this.position=a}get mercatorPosition(){const a=this.position;return new o.ac(a[0],a[1],a[2])}get position(){const a=o.c6(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var u;a&&o.cc(this._transform,3,[(u=a)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||o.c3([]),a&&Yh(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,u){this._orientation=Jh(a,u),Yh(this._transform,this._orientation)}forward(){const a=o.c6(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=o.c6(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=o.c6(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,u){const g=new Float64Array(16);return o.bi(g,this.getWorldToCamera(a,u)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,u,g){const x=this.position;o.c1(x,x,-a);const b=new Float64Array(16);return o.bn(b,[g,g,g]),o.bo(b,b,x),b[10]*=u,b}getWorldToCamera(a,u){const g=new Float64Array(16),x=new Float64Array(4),b=this.position;return o.c7(x,this._orientation),o.c1(b,b,-a),o.c8(g,x),o.bo(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(a,u,g,x){const b=new Float64Array(16);return o.c9(b,a,u,g,x),b}getCameraToClipOrthographic(a,u,g,x,b,E){const P=new Float64Array(16);return o.ca(P,a,u,g,x,b,E),P}getDistanceToElevation(a,u=!1){const g=a===0?0:o.cb(a,u?o.aY(this.position[1]):this.position[1]),x=this.forward();return(g-this.position[2])/x[2]}clone(){return new Cs([...this.position],[...this.orientation])}}const ua={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Xf{constructor(a=0,u=0,g=0,x=0){if(isNaN(a)||a<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=u,this.left=g,this.right=x}interpolate(a,u,g){return u.top!=null&&a.top!=null&&(this.top=o.ai(a.top,u.top,g)),u.bottom!=null&&a.bottom!=null&&(this.bottom=o.ai(a.bottom,u.bottom,g)),u.left!=null&&a.left!=null&&(this.left=o.ai(a.left,u.left,g)),u.right!=null&&a.right!=null&&(this.right=o.ai(a.right,u.right,g)),this}getCenter(a,u){const g=o.ay((this.left+a-this.right)/2,0,a),x=o.ay((this.top+u-this.bottom)/2,0,u);return new o.P(g,x)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Xf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const So=15;class Cv{constructor(a,u,g,x,b,E,P){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=a||0,this._maxZoom=u||22,this._minPitch=g??0,this._maxPitch=x??60,this.setProjection(E),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new o.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Xf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Cs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const a=new Cv(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a._allowWorldUnderZoom=this._allowWorldUnderZoom,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<So}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,u=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(a||g)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=o.cj(this.projectionOptions);const g=this.getProjection(),x=!o.bv(u,g);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cj({name:"mercator"});const u=a!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bQ(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const u=-a*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=o.ck(),o.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const u=o.ay(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=o.al(a),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const u=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){const a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const a=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(a)}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,b=0;for(let E=0;E<u.length;E++){const P=new o.P(u[E][0]*this.width,g+u[E][1]*(this.height-g)),I=a.pointCoordinate(P);if(!I)continue;const z=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);x+=I[3]*z,b+=z}return b===0?NaN:x/b}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,x=this._mercatorZfromZoom(a),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-g,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let g;g=a.z<this._camera.position[2]?[u.x,u.y,u.z]:[a.x,a.y,a.z];const x=o.ae(o.at([],this._camera.position,g));return o.ay(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let u=!1;if(a.orientation&&!o.cm(a.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(a.orientation)),a.position){const g=[a.position.x,a.position.y,a.position.z];o.cn(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,u=new x1;return u.position=new o.ac(a[0],a[1],a[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(a){if(!o.co(a))return!1;o.cp(a,a);const u=o.cq([],[0,0,-1],a),g=o.cq([],[0,-1,0],a);if(g[2]<0)return!1;const x=Lc(u,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(a){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;a[2]=o.ay(a[2],x/g,x/u),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,u,g){this._unmodified=!1,this._edgeInsets.interpolate(a,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const u=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(a){const u=[new o.cr(0,a)];if(this.renderWorldCopies){const g=this.pointCoordinate(new o.P(0,0)),x=this.pointCoordinate(new o.P(this.width,0)),b=this.pointCoordinate(new o.P(this.width,this.height)),E=this.pointCoordinate(new o.P(0,this.height)),P=Math.floor(Math.min(g.x,x.x,b.x,E.x)),I=Math.floor(Math.max(g.x,x.x,b.x,E.x)),z=1;for(let F=P-z;F<=I+z;F++)F!==0&&u.push(new o.cr(F,a))}return u}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(a,u,g){let x=[];const b=g!=null,E=!b;if(E&&this.zoom<u||b&&g[0]===0&&g[1]===0)return x;const P=new Set,I=(F,q,$,K,te)=>{const ee=o.cV(q,F,$,K,te);P.has(ee)||(x.push(new o.aM(F,q,$,K,te)),P.add(ee))};for(let F=0;F<a.length;F++){const q=a[F];if(E&&q.canonical.z!==u)continue;const $=q.canonical,K=q.overscaledZ,te=q.wrap,ee=1<<$.z,re=$.x+1<ee,ie=$.x>0,ue=$.y+1<ee,pe=$.y>0,me=q.wrap-(ie?0:1),Te=q.wrap+(re?0:1),we=ie?$.x-1:ee-1,Pe=re?$.x+1:0;if(b)g[0]<0?(I(K,Te,$.z,Pe,$.y),g[1]<0&&ue&&(I(K,te,$.z,$.x,$.y+1),I(K,Te,$.z,Pe,$.y+1)),g[1]>0&&pe&&(I(K,te,$.z,$.x,$.y-1),I(K,Te,$.z,Pe,$.y-1))):g[0]>0?(I(K,me,$.z,we,$.y),g[1]<0&&ue&&(I(K,te,$.z,$.x,$.y+1),I(K,me,$.z,we,$.y+1)),g[1]>0&&pe&&(I(K,te,$.z,$.x,$.y-1),I(K,me,$.z,we,$.y-1))):g[1]<0&&ue?I(K,te,$.z,$.x,$.y+1):pe&&I(K,te,$.z,$.x,$.y-1);else{const be=q.visibleQuadrants;1&be&&(I(K,me,$.z,we,$.y),pe&&(I(K,te,$.z,$.x,$.y-1),I(K,me,$.z,we,$.y-1))),2&be&&(I(K,Te,$.z,Pe,$.y),pe&&(I(K,te,$.z,$.x,$.y-1),I(K,Te,$.z,Pe,$.y-1))),4&be&&(I(K,me,$.z,we,$.y),ue&&(I(K,te,$.z,$.x,$.y+1),I(K,me,$.z,we,$.y+1))),8&be&&(I(K,Te,$.z,Pe,$.y),ue&&(I(K,te,$.z,$.x,$.y+1),I(K,Te,$.z,Pe,$.y+1)))}}const z=[];for(const F of x)x.some(q=>F.isChildOf(q))||z.push(F);if(x=z.filter(F=>!a.some(q=>!!(F.overscaledZ<u&&q.isChildOf(F))||F.equals(q)||F.isChildOf(q))),E){const F=1<<u,q=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=[F*q.x,F*q.y],K=4,te=K*K;x=x.filter(ee=>{const re=ee.canonical.x+.5-$[0],ie=ee.canonical.y+.5-$[1];return re*re+ie*ie<te})}return x}extendTileCoverToNearPlane(a,u,g){const x=[],b=new Set;for(const ue of a)b.add(ue.key);const E=(ue,pe,me,Te,we)=>{const Pe=o.cV(pe,ue,me,Te,we);b.has(Pe)||(x.push(new o.aM(ue,pe,me,Te,we)),b.add(Pe))},P=a.reduce((ue,pe)=>Math.max(ue,pe.overscaledZ),g),I=1<<g,z=[new o.P(0,0),new o.P(o.aj,0),new o.P(o.aj,o.aj),new o.P(0,o.aj)],F=new o.P(0,0),q=new o.P(0,0),$=(ue,pe)=>{const me=Math.floor(ue[0]),Te=Math.floor(ue[1]),we=(ue[0]-me)*o.aj,Pe=(ue[1]-Te)*o.aj,be=Math.floor(pe[0]),Se=Math.floor(pe[1]),Ee=(pe[0]-be)*o.aj,Ve=(pe[1]-Se)*o.aj;for(let De=-1;De<=1;De++){const dt=me+De;if(!(dt<0||dt>=I)){F.x=we-De*o.aj,q.x=Ee-(dt-be)*o.aj;for(let Je=-1;Je<=1;Je++){const pt=Te+Je;F.y=Pe-Je*o.aj,q.y=Ve-(pt-Se)*o.aj,o.cW(F,q,z)&&E(P,0,g,dt,pt)}}}},K=u.points,te=K[o.cs],ee=K[o.ct],re=this._projectToGround(te,K[o.cu]),ie=this._projectToGround(ee,K[o.cv]);return $(te,re),$(ee,ie),x}_projectToGround(a,u){return o.cw(o.cx(),a,u,a[2]/(a[2]-u[2]))}coveringTiles(a){let u=this.coveringZoomLevel(a);const g=u,x=this.elevation&&this.elevation.exaggeration(),b=x&&!a.isTerrainDEM,E=this.projection.name==="mercator";if(a.minzoom!==void 0&&u<a.minzoom)return[];a.maxzoom!==void 0&&u>a.maxzoom&&(u=a.maxzoom);const P=this.locationCoordinate(this.center),I=this.center.lat,z=1<<u,F=[z*P.x,z*P.y,0],q=this.projection.name==="globe",$=!q,K=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,$),te=q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=z*o.cb(1,this.center.lat),re=this._camera.position[2]/o.cb(1,this.center.lat),ie=[z*te.x,z*te.y,re*($?1:ee)],ue=q||x,pe=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),me=this.isLODDisabled(!0)?u:0;let Te;if(this._elevation&&a.isTerrainDEM)Te=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();Te=Re?Re.max:this._centerAltitude}else Te=this._centerAltitude;const we=a.isTerrainDEM?-Te:this._elevation?this._elevation.getMinElevationBelowMSL():0,Pe=this.projection.isReprojectedInTileSpace?o.cz(this):1,be=Re=>{const nt=new o.ac(Re.x+25e-6,Re.y,Re.z),Ze=new o.ac(Re.x,Re.y+25e-6,Re.z),yt=Re.toLngLat(),bt=nt.toLngLat(),Et=Ze.toLngLat(),jt=this.locationCoordinate(yt),tr=this.locationCoordinate(bt),ir=this.locationCoordinate(Et),Zt=Math.hypot(tr.x-jt.x,tr.y-jt.y),er=Math.hypot(ir.x-jt.x,ir.y-jt.y);return Math.sqrt(Zt*er)*Pe/25e-6},Se=Re=>{const nt=Te,Ze=we;return{aabb:o.cC(this,z,0,0,0,Re,Ze,nt,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:nt,wrap:Re,fullyVisible:!1}},Ee=[];let Ve=[];const De=u,dt=a.reparseOverscaled?g:u,Je=(re-this._centerAltitude)*ee,pt=Re=>{if(!this._elevation||!Re.tileID||!E)return;const nt=this._elevation.getMinMaxForTile(Re.tileID),Ze=Re.aabb;nt?(Ze.min[2]=nt.min,Ze.max[2]=nt.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(Re.shouldSplit=We(Re),Re.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Ct=(Re,nt)=>{if(.707*nt<Re)return 1;const Ze=nt/Re;return Ze/(1.4144271570014144+(Math.pow(1.1,Ze-1.4144271570014144+1)-1)/(1.1-1)-1)},We=Re=>{if(Re.zoom<me)return!0;if(Re.zoom===De)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const nt=Re.aabb.distanceX(ie),Ze=Re.aabb.distanceY(ie);let yt=Je,bt=1;if(q){yt=Re.aabb.distanceZ(ie);const nr=Math.pow(2,Re.zoom),wr=o.aY((Re.y+1)/nr),Cr=o.aY(Re.y/nr),Nr=Math.min(Math.max(I,wr),Cr),Cn=o.c_(Nr)/o.c_(I);if(bt=Nr===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Cn/this._mercatorScaleRatio),this.zoom<=o.cX&&Re.zoom===De-1&&Cn>=.9)return!0}else if(b&&(yt=Re.aabb.distanceZ(ie)*ee),this.projection.isReprojectedInTileSpace&&g<=5){const nr=Math.pow(2,Re.zoom),wr=be(new o.ac((Re.x+.5)/nr,(Re.y+.5)/nr));bt=wr>.85?1:wr}if(!E){const nr=Math.sqrt(nt*nt+Ze*Ze+yt*yt);let wr=(1<<De-Re.zoom)*pe*bt;return wr*=Ct(Math.max(yt,Je),nr),nr<wr}let Et=Number.MAX_VALUE,jt=0;const tr=Re.aabb.getCorners(),ir=[];for(const nr of tr){o.at(ir,nr,ie),q||(b?ir[2]*=ee:ir[2]=Je);const wr=o.bG(ir,this._camera.forward());wr<Et&&(Et=wr,jt=Math.abs(ir[2]))}let Zt=(1<<De-Re.zoom)*pe*bt;if(Zt*=Ct(Math.max(jt,Je),Et),Et<Zt)return!0;const er=Re.aabb.closestPoint(F);return er[0]===F[0]&&er[1]===F[1]};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Ee.push(Se(-Re)),Ee.push(Se(Re));for(Ee.push(Se(0));Ee.length>0;){const Re=Ee.pop(),nt=Re.x,Ze=Re.y;let yt=Re.fullyVisible;const bt=()=>this.projection.name==="globe"&&(Re.y===0||Re.y===(1<<Re.zoom)-1);if(!yt){let Et=ue?Re.aabb.intersects(K):Re.aabb.intersectsFlat(K);if(Et===0&&bt()){const jt=new o.cA(Re.zoom,nt,Ze);Et=o.cB(this,z,jt,!0).intersects(K)}if(Et===0)continue;yt=Et===2}if(Re.zoom!==De&&We(Re))for(let Et=0;Et<4;Et++){const jt=(nt<<1)+Et%2,tr=(Ze<<1)+(Et>>1),ir={aabb:E?Re.aabb.quadrant(Et):o.cC(this,z,Re.zoom+1,jt,tr,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:jt,y:tr,wrap:Re.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};b&&!q&&(ir.tileID=new o.aM(Re.zoom+1===De?dt:Re.zoom+1,Re.wrap,Re.zoom+1,jt,tr),pt(ir)),Ee.push(ir)}else{const Et=Re.zoom===De?dt:Re.zoom;if(a.minzoom&&a.minzoom>Et)continue;let jt=0;if(!yt){let er=ue?Re.aabb.intersectsPrecise(K):Re.aabb.intersectsPreciseFlat(K);if(er===0&&bt()){const nr=new o.cA(Re.zoom,nt,Ze);er=o.cB(this,z,nr,!0).intersectsPrecise(K)}if(er===0)continue;if(a.calculateQuadrantVisibility)if(K.containsPoint(Re.aabb.center))jt=15;else for(let nr=0;nr<4;nr++)Re.aabb.quadrant(nr).intersects(K)!==0&&(jt|=1<<nr)}const tr=F[0]-(.5+nt+(Re.wrap<<Re.zoom))*(1<<u-Re.zoom),ir=F[1]-.5-Ze,Zt=Re.tileID?Re.tileID:new o.aM(Et,Re.wrap,Re.zoom,nt,Ze);a.calculateQuadrantVisibility&&(Zt.visibleQuadrants=jt),Ve.push({tileID:Zt,distanceSq:tr*tr+ir*ir})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,nt=this.horizonLineFromTop();Ve=Ve.filter(Ze=>{const yt=[0,0,0,1],bt=[o.aj,o.aj,0,1],Et=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());o.aA(yt,yt,Et),o.aA(bt,bt,Et);const jt=o.cD([],yt,bt),tr=o.cE([],yt,bt),ir=o.cY(jt,tr);if(ir===0)return!0;let Zt=!1;const er=this._elevation;if(er&&ir>Re&&nt!==0){const nr=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let wr;a.isTerrainDEM||(wr=er.getMinMaxForTile(Ze.tileID)),wr||(wr={min:we,max:Te});const Cr=o.cF(this.rotation),Nr=[Cr[0]*o.aj,Cr[1]*o.aj,wr.max];o.ad(Nr,Nr,nr),Zt=(1-Nr[1])*this.height*.5<nt}return ir<Re||Zt})}return Ve.sort((Re,nt)=>Re.distanceSq-nt.distanceSq).map(Re=>Re.tileID)}resize(a,u){this.width=a,this.height=u,this.pixelsToGLUnits=[2/a,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const u=o.ay(a.lat,-o.cG,o.cG),g=this.projection.project(a.lng,u);return new o.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,u){let g,x;const b=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;g=(u.x-b.x)/P,x=(u.y-b.y)/P}else{const P=this.pointCoordinate(u),I=this.pointCoordinate(b);g=P.x-I.x,x=P.y-I.y}const E=this.locationCoordinate(a);this.setLocation(new o.ac(E.x-g,E.y-x))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a,u){return this.projection.locationPoint(this,a,u)}locationPoint3D(a,u){return this.projection.locationPoint(this,a,u,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a,u){return this.coordinateLocation(this.pointCoordinate3D(a,u))}locationCoordinate(a,u){const g=u?o.cb(u,a.lat):void 0,x=this.projection.project(a.lng,a.lat);return new o.ac(x.x,x.y,g)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,u){const g=u??this._centerAltitude,x=[a.x,a.y,0,1],b=[a.x,a.y,1,1];o.aA(x,x,this.pixelMatrixInverse),o.aA(b,b,this.pixelMatrixInverse);const E=b[3];o.cH(x,x,1/x[3]),o.cH(b,b,1/E);const P=x[2],I=b[2];return{p0:x,p1:b,t:P===I?0:(g-P)/(I-P)}}screenPointToMercatorRay(a){const u=[a.x,a.y,0,1],g=[a.x,a.y,1,1];return o.aA(u,u,this.pixelMatrixInverse),o.aA(g,g,this.pixelMatrixInverse),o.cH(u,u,1/u[3]),o.cH(g,g,1/g[3]),u[2]=o.cb(u[2],this._center.lat)*this.worldSize,g[2]=o.cb(g[2],this._center.lat)*this.worldSize,o.cH(u,u,1/this.worldSize),o.cH(g,g,1/this.worldSize),new o.av([u[0],u[1],u[2]],o.au([],o.at([],g,u)))}rayIntersectionCoordinate(a){const{p0:u,p1:g,t:x}=a,b=o.cb(u[2],this._center.lat),E=o.cb(g[2],this._center.lat);return new o.ac(o.ai(u[0],g[0],x)/this.worldSize,o.ai(u[1],g[1],x)/this.worldSize,o.ai(b,E,x))}pointCoordinate(a,u=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,u)}pointCoordinate3D(a,u){if(!this.elevation)return this.pointCoordinate(a,u);let g=this.projection.pointCoordinate3D(this,a.x,a.y);if(g)return new o.ac(g[0],g[1],g[2]);let x=0,b=this.horizonLineFromTop();if(a.y>b)return this.pointCoordinate(a,u);const E=.02*b,P=a.clone();for(let I=0;I<10&&b-x>E;I++){P.y=o.ai(x,b,.66);const z=this.projection.pointCoordinate3D(this,P.x,P.y);z?(b=P.y,g=z):x=P.y}return g?new o.ac(g[0],g[1],g[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=o.cI)return!this.isPointAboveHorizon(a);const u=this.pointCoordinate(a);return u.y>=0&&u.y<=1}_coordinatePoint(a,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,x=[a.x*this.worldSize,a.y*this.worldSize,g+a.toAltitude(),1];return o.aA(x,x,this.pixelMatrix),x[3]>0?new o.P(x[0]/x[3],x[1]/x[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:u}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,b=this.pointLocation3D(new o.P(u,a)),E=this.pointLocation3D(new o.P(x,a)),P=this.pointLocation3D(new o.P(x,g)),I=this.pointLocation3D(new o.P(u,g));let z=Math.min(b.lng,E.lng,P.lng,I.lng),F=Math.max(b.lng,E.lng,P.lng,I.lng),q=Math.min(b.lat,E.lat,P.lat,I.lat),$=Math.max(b.lat,E.lat,P.lat,I.lat);const K=Math.pow(2,-this.zoom)/16*270,te=this.projection.name==="globe"?1:4,ee=(re,ie,ue,pe,me)=>{const Te=(re+ue)/2,we=(ie+pe)/2,Pe=new o.P(Te,we),{lng:be,lat:Se}=this.pointLocation3D(Pe),Ee=Math.max(0,z-be,q-Se,be-F,Se-$);z=Math.min(z,be),F=Math.max(F,be),q=Math.min(q,Se),$=Math.max($,Se),(me<te||Ee>K)&&(ee(re,ie,Te,we,me+1),ee(Te,we,ue,pe,me+1))};if(ee(u,a,x,a,1),ee(x,a,x,g,1),ee(x,g,u,g,1),ee(u,g,u,a,1),this.projection.name==="globe"){const[re,ie]=o.cJ(this);re?($=90,F=180,z=-180):ie&&(q=-90,F=180,z=-180)}return new o.aG(new o.ci(z,q),new o.ci(F,$))}_getBoundsRectangular(a,u){const{top:g,left:x}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,P=new o.P(x,g),I=new o.P(E,g),z=new o.P(E,b),F=new o.P(x,b);let q=this.pointCoordinate(P,a),$=this.pointCoordinate(I,a);const K=this.pointCoordinate(z,u),te=this.pointCoordinate(F,u),ee=(re,ie)=>(ie.y-re.y)/(ie.x-re.x);return q.y>1&&$.y>=0?q=new o.ac((1-te.y)/ee(te,q)+te.x,1):q.y<0&&$.y<=1&&(q=new o.ac(-te.y/ee(te,q)+te.x,0)),$.y>1&&q.y>=0?$=new o.ac((1-K.y)/ee(K,$)+K.x,1):$.y<0&&q.y<=1&&($=new o.ac(-K.y/ee(K,$)+K.x,0)),new o.aG().extend(this.coordinateLocation(q)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(K))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=a.visibleDemTiles.reduce((g,x)=>{if(x.dem){const b=x.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*a.exaggeration(),u.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return a?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-o.cG,this.maxLat=o.cG,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aD(this.minLng)*this.tileSize,this.worldMaxX=o.aD(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,u){return this.projection.createTileMatrix(this,u,a)}calculateDistanceTileData(a){const u=a.key,g=this._distanceTileDataCache;if(g[u])return g[u];const x=a.canonical,b=1/this.height,E=this.cameraWorldSize,P=E/this.zoomScale(x.z),I=(x.x+Math.pow(2,x.z)*a.wrap)*P,z=x.y*P,F=this.point;F.x*=E/this.worldSize,F.y*=E/this.worldSize;const q=this.angle,$=Math.sin(-q),K=-Math.cos(-q);return g[u]={bearing:[$,K],center:[(F.x-I)*b,(F.y-z)*b],scale:P/o.aj*b},g[u]}calculateFogTileMatrix(a){const u=a.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return o.az(x,this.worldToFogMatrix,x),g[u]=new Float32Array(x),g[u]}calculateProjMatrix(a,u=!1,g=!1){const x=a.key;let b;if(b=g?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,b[x])return b[x];const E=this.calculatePosMatrix(a,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,o.az(E,P,E),b[x]=new Float32Array(E),b[x]}calculatePixelsToTileUnitsMatrix(a){const u=a.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const x=o.cK(a,this);return g[u]=x,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,u=o.bn([],[a,a,a]);return o.az(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const u=o.cb(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),x=this._camera.forward(),b=o.cb(1,this._center.lat);g[2]/=b,x[2]/=b,o.au(x,x);const E=a.raycast(g,x,a.exaggeration());if(E){const P=o.bE([],g,x,E),I=new o.ac(P[0],P[1],o.cb(P[2],o.aY(P[1]))),z=(I.z+o.ae([I.x-g[0],I.y-g[1],I.z-g[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const u=this._elevation,g=o.cb(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(g),b=u.getAtPointOrZero(new o.ac(...x)),E=this.pixelsPerMeter/this.worldSize*b,P=this._minimumHeightOverTerrain(),I=x[2]-E;if(I<=P)if(I<0||a){const z=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],z.z-x[2]],q=o.ae(F);F[2]-=(P-I)/this._pixelsPerMercatorPixel;const $=o.ae(F);if($===0)return;o.c1(F,F,q/$*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],z.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const $=this.center;return $.lat=o.ay($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&($.lng=o.ay($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const u=this._unmodified,{x:g,y:x}=this.point;let b=0,E=g,P=x;const I=this.width/2,z=this.height/2,F=this.worldMinY*this.scale,q=this.worldMaxY*this.scale;if(x-z<F&&(P=F+z),x+z>q&&(P=q-z),q-F<this.height&&(b=Math.max(b,this.height/(q-F)),P=(q+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,te=this.worldSize/2-($+K)/2;E=(g+te+this.worldSize)%this.worldSize-te,E-I<$&&(E=$+I),E+I>K&&(E=K-I),K-$<this.width&&(b=Math.max(b,this.width/(K-$)),E=(K+$)/2)}E===g&&P===x||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(E,P))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,u=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cb(1,this.center.lat)/o.cb(1,o.c$));const x=o.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?g:1,E=this._camera.getWorldToCamera(this.worldSize,b);let P;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-a.x/this.width,I[9]=2*a.y/this.height,this.isOrthographic){let Se=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ee=Se*this.aspect,Ve=-Ee,De=-Se;Ee-=a.x,Ve-=a.x,Se+=a.y,De+=a.y,P=this._camera.getCameraToClipOrthographic(Ve,Ee,De,Se,this._nearZ,this._farZ),((dt,Je,pt,Ct)=>{for(let We=0;We<16;We++)dt[We]=o.ai(Je[We],pt[We],Ct)})(P,P,I,o.cZ(this.pitch>=So?1:this.pitch/So))}else P=I;const z=o.cM([],I,E);let F=o.cM([],P,E);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Ee=o.bx([]);o.bo(Ee,Ee,[Se.x*this.worldSize,Se.y*this.worldSize,0]),o.az(Ee,Ee,o.cN(this)),o.bo(Ee,Ee,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),o.az(F,F,Ee),o.az(z,z,Ee),this.inverseAdjustmentMatrix=o.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cP([],F,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=F,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),u){const Se=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Se[8]=2*-a.x/this.width,Se[9]=2*a.y/this.height,this.expandedFarZProjMatrix=o.cM([],Se,E)}else this.expandedFarZProjMatrix=this.projMatrix;const q=o.bi([],P);this.frustumCorners=o.cQ.fromInvProjectionMatrix(q,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const $=new Float32Array(16);o.bx($),o.cP($,$,[1,-1,1]),o.cR($,$,this._pitch),o.by($,$,this.angle);const K=o.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(K);const te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;K[8]=2*-a.x/this.width,K[9]=2*(a.y+te)/this.height,this.skyboxMatrix=o.az($,K,$);const ee=this.point,re=ee.x,ie=ee.y,ue=this.width%2/2,pe=this.height%2/2,me=Math.cos(this.angle),Te=Math.sin(this.angle),we=re-Math.round(re)+me*ue+Te*pe,Pe=ie-Math.round(ie)+me*pe+Te*ue,be=new Float64Array(F);if(o.bo(be,be,[we>.5?we-1:we,Pe>.5?Pe-1:Pe,0]),this.alignedProjMatrix=be,F=o.bz(),o.cP(F,F,[this.width/2,-this.height/2,1]),o.bo(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=o.bz(),o.cP(F,F,[1,-1,1]),o.bo(F,F,[-1,-1,0]),o.cP(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},F=o.bi(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cS(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(Se,Se,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,b=[a,a,u];o.c1(b,b,x),o.c1(g,g,-1),o.cT(g,g,b);const E=o.bz();o.bo(E,E,g),o.cP(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,u,x)}_computeCameraPosition(a){const u=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-a/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-g[0]*b,x.y/this.worldSize-g[1]*b,a/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],x=a[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(b=Math.min((u-g)/x,1)),this._camera.position=o.bE([],this._camera.position,a,b),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),b=o.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),P=Math.max((a[2]-b)/Math.cos(g),E),I=this._zoomFromMercatorZ(P);o.bE(a,a,u,P),this._pitch=o.ay(g,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bQ(x,-Math.PI,Math.PI),this._setZoom(o.ay(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,a)*this.tileSize))}zoomFromMercatorZAdjusted(a){let u=0,g=o.cI,x=0,b=1/0;for(;g-u>1e-6&&g>u;){const E=u+.5*(g-u),P=this.tileSize*Math.pow(2,E),I=this.getCameraToCenterDistance(this.projection,E,P),z=this.scaleZoom(I/(Math.max(0,a)*this.tileSize)),F=Math.abs(E-z);F<b&&(b=F,x=E),E<z?u=E:g=E}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,u){const g=Math.min(a.x,u.x),x=Math.max(a.x,u.x),b=Math.min(a.y,u.y),E=Math.max(a.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new o.P(g,b),new o.P(x,E),new o.P(g,E),new o.P(x,b)],I=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const F of P){const q=this.pointRayIntersection(F);if(q.t<0)return!0;const $=this.rayIntersectionCoordinate(q);if($.x<I||$.y<0||$.x>z||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(a,u){const g=o.ae(o.at([],this._camera.position,a)),x=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const a=function([u,g,x],b){const E=[u,g,x,1];o.aA(E,E,b);const P=E[3]=Math.max(E[3],1e-6);return E[0]/=P,E[1]/=P,E[2]/=P,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,a))}}getCameraToCenterDistance(a,u=this.zoom,g=this.worldSize){const x=o.cL(a,u,this.width,this.height,1024),b=a.pixelSpaceConversion(this.center.lat,g,x);let E=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(E=o.ai(1,E,o.cZ(this.pitch>=So?1:this.pitch/So))),E}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(a,a,this.globeMatrix),a}getFrustum(a){return o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}const yl=(m,a)=>{if(a>0&&m.terrain&&o.w("Cutoff is currently disabled on terrain"),a<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=m.transform,g=Math.max(Math.abs(u._zoom-(m.minCutoffZoom-1)),1),x=u.isLODDisabled(!1)?o.af(60,45,u.pitch):o.af(30,15,u.pitch),b=u._farZ-u._nearZ,E=a*u.height,P=((1-(I=x))*u.cameraToCenterDistance+I*(u._farZ+E))*g;var I;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(P-u._nearZ)/b,(P-E-u._nearZ)/b]}}},Wo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Yf{constructor(a,u){this.aabb=a,this.lastCascade=u}}class EC{add(a,u){const g=this.receivers[a.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],u.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],u.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],u.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],u.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],u.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],u.max[2])):this.receivers[a.key]=new Yf(u,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,u,g){const x=o.d6.fromPoints(a.points);let b=0;for(const E in this.receivers){const P=this.receivers[E];if(!P||!x.intersectsAabb(P.aabb))continue;P.aabb.min=x.closestPoint(P.aabb.min),P.aabb.max=x.closestPoint(P.aabb.max);const I=P.aabb.getCorners();for(let z=0;z<g.length;z++){let F=!0;for(const q of I){const $=[q[0]*u,q[1]*u,q[2]];if(o.ad($,$,g[z].matrix),$[0]<-1||$[0]>1||$[1]<-1||$[1]>1){F=!1;break}}if(P.lastCascade=z,b=Math.max(b,z),F)break}}return b+1}}class AC{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new EC,this._depthMode=new Ht(a.context.gl.LEQUAL,Ht.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,a.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),a.tp.registerParameter(Wo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(Wo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),a.tp.registerParameter(Wo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),a.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,u){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;const x=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||x<=0||(this._shadowLayerCount=g.style.order.reduce((te,ee)=>{const re=g.style._mergedLayers[ee];return te+(re.hasShadowPass()&&!re.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=g.context,E=Wo.shadowMapResolution,P=Wo.shadowMapResolution;if(this._cascades.length===0||Wo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let te=0;te<Wo.cascadeCount;++te){const ee=g._shadowMapDebug,re=b.gl,ie=b.createFramebuffer(E,P,ee,"texture"),ue=new o.T(b,{width:E,height:P,data:null},re.DEPTH_COMPONENT16);if(ie.depthAttachment.set(ue.texture),ee){const pe=new o.T(b,{width:E,height:P,data:null},re.RGBA8);ie.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:ie,texture:ue,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cy,scale:0})}}this.shadowDirection=Qh(u);let I=0;if(a.elevation){const te=a.elevation,ee=[1e4,-1e4];te.visibleDemTiles.filter(re=>re.dem).forEach(re=>{const ie=re.dem.tree;ee[0]=Math.min(ee[0],ie.minimums[0]),ee[1]=Math.max(ee[1],ie.maximums[0])}),ee[0]!==1e4&&(I=(ee[1]-ee[0])*te.exaggeration())}const z=1.5*a.cameraToCenterDistance,F=3*z,q=new Float64Array(16);for(let te=0;te<this._cascades.length;++te){const ee=this._cascades[te];let re=a.height/50,ie=1;Wo.cascadeCount===1?ie=F:te===0?ie=z:(re=z,ie=F);const[ue,pe]=ed(a,this.shadowDirection,re,ie,Wo.shadowMapResolution,I);ee.scale=a.scale,ee.matrix=ue,ee.boundingSphereRadius=pe,o.bi(q,ee.matrix),ee.frustum=o.cy.fromInvProjectionMatrix(q,1,0,!0),ee.far=ie}const $=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[$].far,this._cascades[$].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Wo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Wo.shadowMapResolution,this._uniformValues.u_shadowmap_0=ua.ShadowMap0,this._uniformValues.u_shadowmap_1=ua.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const K=g.transform.elevation;for(const te of this._groundShadowTiles){let ee={min:0,max:0};if(K){const re=K.getMinMaxForTile(te);re&&(ee=re)}this.addShadowReceiver(te.toUnwrapped(),ee.min,ee.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,u){if(!this.enabled)return;const g=this.painter,x=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),x.viewport.set([0,0,Wo.shadowMapResolution,Wo.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){g.currentShadowCascade=b,x.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),x.clear({color:o.am.white,depth:1});for(const E of a.order){const P=a._mergedLayers[E];if(!P.hasShadowPass()||P.isHidden(g.transform.zoom))continue;const I=a.getLayerSourceCache(P),z=I?u[I.id]:void 0;(P.type==="model"||z&&z.length)&&g.renderLayer(g,I,P,z)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const a=this.painter,u=a.style,g=a.context,x=g.gl,b=u.directionalLight,E=u.ambientLight;if(!b||!E)return;const P=[],I=yl(a,a.longestCutoffRange);I.shouldRenderCutoff&&P.push("RENDER_CUTOFF"),P.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&P.push("NORMAL_OFFSET");const z=Vu(u,b,E),F=new Ht(x.LEQUAL,Ht.ReadOnly,a.depthRangeFor3D),q=new mr({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const $ of this._groundShadowTiles){const K=$.toUnwrapped(),te=a.isTileAffectedByFog($),ee=a.getOrCreateProgram("groundShadow",{defines:P,overrideFog:te});this.setupShadows(K,ee),a.uploadCommonUniforms(g,ee,K,null,I);const re={u_matrix:a.transform.calculateProjMatrix(K),u_ground_shadow_factor:z};ee.draw(a,x.TRIANGLES,F,q,Or.multiply,ur.disabled,re,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,null,a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Or.unblended:Or.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){const u=this.painter.transform,g=u.calculatePosMatrix(a,u.worldSize);return o.az(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(a){return o.az(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}setupShadows(a,u,g){if(!this.enabled)return;const x=this.painter.transform,b=this.painter.context,E=b.gl,P=this._uniformValues,I=new Float64Array(16),z=x.calculatePosMatrix(a,x.worldSize);for(let F=0;F<this._cascades.length;F++)o.az(I,this._cascades[F].matrix,z),P[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),b.activeTexture.set(E.TEXTURE0+ua.ShadowMap0+F),this._cascades[F].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);if(this.useNormalOffset=!!g,this.useNormalOffset){const F=o.d4(a.canonical),q=2/x.tileSize*o.aj/Wo.shadowMapResolution,$=q*this._cascades[0].boundingSphereRadius,K=q*this._cascades[this._cascades.length-1].boundingSphereRadius,te=(g==="vector-tile"?1:3)*function(ee,re,ie,ue,pe){const me=o.ay((ee-22)/-22,0,1);return .125*(1-me)+4*me}(x.zoom);P.u_shadow_normal_offset=[F,$*te,K*te],P.u_shadow_bias=[1e-4,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(b,P)}setupShadowsFromMatrix(a,u,g=!1){if(!this.enabled)return;const x=this.painter.context,b=x.gl,E=this._uniformValues,P=new Float64Array(16);for(let I=0;I<Wo.cascadeCount;I++)o.az(P,this._cascades[I].matrix,a),E[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),x.activeTexture.set(b.TEXTURE0+ua.ShadowMap0+I),this._cascades[I].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=g,g){const I=Wo.normalOffset;E.u_shadow_normal_offset=[1,I,I],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(x,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,u,g,x){if(x[2]>=0)return{};const b=function(I,z,F){const q=F/(1<<I.canonical.z);return new o.d6([I.canonical.x*q+I.wrap*F,I.canonical.y*q+I.wrap*F,0],[(I.canonical.x+1)*q+I.wrap*F,(I.canonical.y+1)*q+I.wrap*F,z])}(a,u,g).getCorners(),E=u/-x[2];x[0]<0?(o.d5(b[0],b[0],[x[0]*E,0,0]),o.d5(b[3],b[3],[x[0]*E,0,0])):x[0]>0&&(o.d5(b[1],b[1],[x[0]*E,0,0]),o.d5(b[2],b[2],[x[0]*E,0,0])),x[1]<0?(o.d5(b[0],b[0],[0,x[1]*E,0]),o.d5(b[1],b[1],[0,x[1]*E,0])):x[1]>0&&(o.d5(b[2],b[2],[0,x[1]*E,0]),o.d5(b[3],b[3],[0,x[1]*E,0]));const P={};return P.vertices=b,P.planes=[zc(b[1],b[0],b[4]),zc(b[2],b[1],b[5]),zc(b[3],b[2],b[6]),zc(b[0],b[3],b[7])],P}addShadowReceiver(a,u,g){this._receivers.add(a,o.d6.fromTileIdAndHeight(a,u,g))}getMaxCascadeForTile(a){const u=this._receivers.get(a);return u&&u.lastCascade?u.lastCascade:0}}function zc(m,a,u){const g=o.at([],u,a),x=o.at([],m,a),b=o.bF([],g,x),E=o.ae(b);return E===0?[0,0,1,0]:(o.c1(b,b,1/E),[b[0],b[1],b[2],-o.bG(b,a)])}function Qh(m){const a=m.properties.get("direction"),u=o.d1(a.x,a.y,a.z);u[2]=o.ay(u[2],0,75);const g=o.d3([u[0],u[1],u[2]]);return o.d2(g.x,g.y,g.z)}function Vu(m,a,u){const g=a.properties.get("color-use-theme")==="none",x=a.properties.get("color"),b=a.properties.get("intensity"),E=a.properties.get("direction"),P=[E.x,E.y,E.z],I=u.properties.get("color-use-theme")==="none",z=u.properties.get("color"),F=u.properties.get("intensity"),q=Math.max(o.bG([0,0,1],P),0),$=[0,0,0];o.c1($,z.toPremultipliedRenderColor(I?null:m.getLut(a.scope)).toArray01Linear().slice(0,3),F);const K=[0,0,0];return o.c1(K,x.toPremultipliedRenderColor(g?null:m.getLut(u.scope)).toArray01Linear().slice(0,3),q*b),o.d8([$[0]>0?$[0]/($[0]+K[0]):0,$[1]>0?$[1]/($[1]+K[1]):0,$[2]>0?$[2]/($[2]+K[2]):0])}function ed(m,a,u,g,x,b){const E=m.zoom,P=m.scale,I=m.worldSize,z=1/I,F=m.aspect,q=Math.sqrt(1+F*F)*Math.tan(.5*m.fovX),$=q*q,K=g-u,te=g+u;let ee,re;$>K/te?(ee=g,re=g*q):(ee=.5*te*(1+$),re=.5*Math.sqrt(K*K+2*(g*g+u*u)*$+te*te*$*$));const ie=m.projection.pixelsPerMeter(m.center.lat,I),ue=m._camera.getCameraToWorldMercator(),pe=[0,0,-ee*z];o.ad(pe,pe,ue);let me=re*z;const Te=m._edgeInsets;if(!(Te.left===0&&Te.top===0&&Te.right===0&&Te.bottom===0||Te.left===Te.right&&Te.top===Te.bottom)){const yt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ie:1),bt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,u,g);bt[8]=2*-m.centerOffset.x/m.width,bt[9]=2*m.centerOffset.y/m.height;const Et=new Float64Array(16);o.cM(Et,bt,yt);const jt=new Float64Array(16);o.bi(jt,Et);const tr=o.cy.fromInvProjectionMatrix(jt,I,E,!0);for(const ir of tr.points){const Zt=((we=ir)[0]/=P,we[1]/=P,we[2]=o.cb(we[2],m._center.lat),we);me=Math.max(me,o.c2(o.d7([],pe,Zt)))}}var we;me*=x/(x-1);const Pe=Math.acos(a[2]),be=Math.atan2(-a[0],-a[1]),Se=new Cs;Se.position=pe,Se.setPitchBearing(Pe,be);const Ee=Se.getWorldToCamera(I,ie),Ve=me*I,De=Math.min(m._mercatorZfromZoom(17)*I*-2,-2*Ve),dt=Se.getCameraToClipOrthographic(-Ve,Ve,-Ve,Ve,De,(Ve+b*ie)/a[2]),Je=new Float64Array(16);o.az(Je,dt,Ee);const pt=o.d2(Math.floor(1e6*pe[0])/1e6*I,Math.floor(1e6*pe[1])/1e6*I,0),Ct=.5*x,We=[0,0,0];o.ad(We,pt,Je),o.c1(We,We,Ct);const Re=[Math.floor(We[0]),Math.floor(We[1]),Math.floor(We[2])],nt=[0,0,0];o.at(nt,We,Re),o.c1(nt,nt,-1/Ct);const Ze=new Float64Array(16);return o.bx(Ze),o.bo(Ze,Ze,nt),o.az(Je,Ze,Je),[Je,Ve]}class b1 extends o.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(a,u){return o.aS(this.requestManager.transformRequest(u,o.R.Model).url).then(g=>{if(!g)return;const x=o.aT(g),b=new o.aU(a,void 0,void 0,x);return b.computeBoundsAndApplyParent(),b}).catch(g=>{if(g&&g.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${a} from ${u}: ${g.message}`)))})}load(a,u,g={forceReload:!1}){this.models[u]||(this.models[u]={});const x=Object.keys(a),b=[],E=[];for(const P of x){const I=a[P];this.hasURLBeenRequested(I)&&!g.forceReload||(this.modelByURL[I]={modelId:P,scope:u},b.push(this.loadModel(P,I)),E.push(P)),this.models[u][P]||(this.models[u][P]={model:null,numReferences:1})}this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+E.length,Promise.allSettled(b).then(P=>{for(let I=0;I<P.length;I++){const{status:z}=P[I];if(z==="rejected")continue;const{value:F}=P[I];this.models[u][E[I]]||(this.models[u][E[I]]={model:null,numReferences:1}),this.models[u][E[I]].model=F}this.numModelsLoading[u]-=E.length,this.fire(new o.A("data",{dataType:"style"}))}).catch(P=>{this.fire(new o.z(new Error(`Could not load models: ${P.message}`)))})}isLoaded(){for(const a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,u,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(a,u):this.getModelByURL(this.modelUris[u][a]))}getModel(a,u){return this.models[u]||(this.models[u]={}),this.models[u][a]?this.models[u][a].model:void 0}getModelByURL(a){if(!a)return null;const u=this.modelByURL[a];return u?this.models[u.scope][u.modelId].model:null}hasModelBeenAdded(a,u){return this.models[u]&&this.models[u][a]!==void 0}getModelURIs(a){return this.modelUris[a]||{}}addModel(a,u,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const x=this.requestManager.normalizeModelURL(u);if((this.hasModel(a,g,{exactIdMatch:!0})||this.hasModelBeenAdded(a,g))&&this.modelUris[g][a]===x)this.models[g][a].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:b,modelId:E}=this.modelByURL[x];this.models[b][E].numReferences++}else this.modelUris[g][a]=x,this.load({[a]:this.modelUris[g][a]},g)}addModelURLs(a,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const g=this.modelUris[u];for(const x in a)g[x]=this.requestManager.normalizeModelURL(a[x])}reloadModels(a){this.load(this.modelUris[a],a,{forceReload:!0})}addModelsFromBucket(a,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const g={};for(const x of a)this.hasModel(x,u,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[u][x].numReferences++:this.modelUris[u][x]&&!this.hasURLBeenRequested(x)?g[x]=this.modelUris[u][x]:!this.hasURLBeenRequested(x)&&o.d9(x,!1)&&(this.modelUris[u][x]=this.requestManager.normalizeModelURL(x),g[x]=this.modelUris[u][x]);this.load(g,u)}hasURLBeenRequested(a){return this.modelByURL[a]!==void 0}removeModel(a,u,g=!1,x=!1){if(this.models[u]&&this.models[u][a]&&(this.models[u][a].numReferences--,this.models[u][a].numReferences===0||x)){const b=this.modelUris[u][a];g||delete this.modelUris[u][a],delete this.modelByURL[b];const E=this.models[u][a].model;if(!E)return;delete this.models[u][a],E.destroy()}}destroy(){for(const a of Object.keys(this.models))for(const u of Object.keys(this.models[a])){const g=this.models[a][u].model;delete this.models[a][u],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,u){this.models[u]||(this.models[u]={});for(const g in this.models[u])this.models[u][g].model&&this.models[u][g].model.upload(a.context)}}const Xm=new o.a7({data:new o.a8(o.a5.colorTheme.data)});class Pv{constructor(a){this._scope=a,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(a){const u=this._makeBuildingsQueryArea(a),g=this._makeFloorsQueryArea(a),x=a.queryRenderedFeatures(u,this._buildingQueryParams).filter(P=>P.properties.shape_type==="building").reduce((P,I)=>{const z=I.properties.id;return I.properties.shape_type!=="building"||P.some(F=>F.properties.id===z)||P.push(I),P},[]),b=a.queryRenderedFeatures(g,this._floorQueryParams).filter(P=>P.properties.shape_type==="floor").reduce((P,I)=>{const z=I.properties.id;return I.properties.shape_type!=="floor"||P.some(F=>F.properties.id===z)||P.push(I),P},[]),E=[a.getCenter().lng,a.getCenter().lat];return{floors:b,building:this._findBuildingAtCenter(E,x)||(x.length>0?x[0]:null)}}_makeBuildingsQueryArea(a){const u=a.transform.width,g=a.transform.height,x=Math.min(u,g),b=x*(1/8),E=x*(1/8),P=.5*(u-b),I=.5*(g-E);return[new o.P(P,I),new o.P(P+b,I+E)]}_makeFloorsQueryArea(a){const u=a.transform.width,g=a.transform.height,x=u*(2/3),b=g*(2/3),E=.5*(u-x),P=.5*(g-b);return[new o.P(E,P),new o.P(E+x,P+b)]}_findBuildingAtCenter(a,u){for(const g of u)if(g.geometry.type==="Polygon"&&this._pointInPolygon(a,g.geometry.coordinates[0]))return g;return null}_pointInPolygon(a,u){let g=!1;for(let x=0,b=u.length-1;x<u.length;b=x++){const E=u[x][0],P=u[x][1],I=u[b][1];P>a[1]!=I>a[1]&&a[0]<(u[b][0]-E)*(a[1]-P)/(I-P)+E&&(g=!g)}return g}}class Nc{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(a){this._selectedBuildingId=a}setFloors(a){if(this._floors=a.filter(u=>u.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(u=>u.properties.id).includes(this._selectedFloorId)){const u=this._floors.map(g=>({id:g.properties.id,level:g.properties.floor_level})).reduce((g,x)=>{const b=Math.abs(g.level-1),E=Math.abs(x.level-1);return E<b||E===b&&x.level>g.level?x:g});this._selectedFloorId=u.id}}setFloorId(a){this._selectedFloorId=a}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const kC={"mbx-indoor-level-selected":{default:["literal",[]]}};function w1(m){return m=m||{},Object.assign(m,kC)}class CC extends o.E{constructor(a){super(),o.aV(["_onLoad","_onMove"],this),this._map=a,this._floorSelectionState=new Nc,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(a=>{a.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=a.scope,this._indoorDataQuery=new Pv(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const a=this._indoorDataQuery.execute(this._map);a&&a.floors.length!==0?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(a)):this._clearIndoorData()}_selectFloors(a){if(a.building)this._floorSelectionState.setBuildingId(a.building.properties.id),this._floorSelectionState.setFloors(a.floors),this._updateUI();else{const u=this._floorSelectionState.getSelectedFloorId();if(u&&a.floors.some(g=>g.properties.id===u))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const a=this._floorSelectionState.getCurrentBuildingFloors().map(g=>({id:g.properties.id,name:g.properties.name,shortName:g.properties.floor_level,levelOrder:g.properties.floor_level})),u=this._floorSelectionState.getSelectedFloorId();u?(this._updateIndoorConfig(),this.fire(new o.A("indoorupdate",{selectedFloorId:u,floors:a}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const a=this._floorSelectionState.getSelectedFloorId();a?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[a]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(a){this._floorSelectionState.setFloorId(a),this._updateIndoorConfig()}}function S1(m){if(!m.metadata||!m.metadata.content_area)return;const a=o.q.devicePixelRatio,{left:u,top:g,width:x,height:b}=m.metadata.content_area,E=u*a,P=g*a;return[E,P,E+x*a,P+b*a]}function T1(m){if(m)return m.map(([a,u])=>[a*o.q.devicePixelRatio,u*o.q.devicePixelRatio])}class Mv{constructor(a,u,g){this.id=a,this.scope=u,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(a){this.missingRequests.has(a.name)||this.pendingRequests.has(a.name)||this.pendingRequests.add(a.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const a=new Map;if(!this.sourceCache.loaded())return a;const u=this.sourceCache.getVisibleCoordinates();if(u.length===0)return a;const g=this.sourceCache.getSource();if(!(g instanceof Oc))return a;const x=u.map(E=>this.sourceCache.getTile(E)),b=g.getImages(x,Array.from(this.pendingRequests));for(const[E,P]of b)a.set(o.I.from({name:E,iconsetId:this.id}),P),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),a}}const Fc=(m,a)=>xe(m,a&&a.filter(u=>u.identifier!=="source.canvas")),E1=o.aF(on,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),A1=o.aF(on,["setCenter","setZoom","setBearing","setPitch"]),Ym=new Set(["background","sky","slot","custom"]),Bc={version:8,layers:[],sources:{}},Jf={duration:300,delay:0};class Ps extends o.E{constructor(a,u={}){super(),this.map=a,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=o.h({},Jf),this._buildingIndex=new f1(this),this.crossTileSymbolIndex=new ka,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new Nn,this.dispatcher=u.dispatcher?u.dispatcher:new o.D(o.db(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new Kr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new o.dc(a._requestManager,u.localFontFamily?o.dd.all:u.localIdeographFontFamily?o.dd.ideographs:o.dd.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new b1(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:u.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",o.de());const g=this;this._rtlTextPluginCallback=Ps.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,E)=>{if(o.df(b),E&&E.every(P=>P))for(const P in g._sourceCaches){const I=g._sourceCaches[P],z=I.getSource().type;z!=="vector"&&z!=="geojson"||I.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getOwnSource(x.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const P=this._layers[E];P.source===b.id&&this._validateLayer(P)}})}load(a){return a?(typeof a=="string"?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if(typeof a=="string"){if(o.j(a))return a;const u=o.dg(a);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${o.dh(JSON.stringify(a))}`}_diffStyle(a,u,g){this.globalId=this._getGlobalId(a);const x=(b,E)=>{try{E(null,this.setState(b,g))}catch(P){E(P,!1)}};if(typeof a=="string"){const b=this.map._requestManager.normalizeStyleURL(a),E=this.map._requestManager.transformRequest(b,o.R.Style);o.n(E,(P,I)=>{P?this.fire(new o.z(P)):I&&x(I,u)})}else typeof a=="object"&&x(a,u)}loadURL(a,u={}){this.fire(new o.A("dataloading",{dataType:"style"}));const g=typeof u.validate=="boolean"?u.validate:!o.j(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,u.accessToken),this.resolvedImports.add(a);const x=this.importsCache.get(a);if(x)return this._load(x,g);const b=this.map._requestManager.transformRequest(a,o.R.Style);this._request=o.n(b,(E,P)=>{if(this._request=null,E)this.fire(new o.z(E));else if(P)return this.importsCache.set(a,P),this._load(P,g)})}loadJSON(a,u={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=o.q.frame(()=>{this._request=null,this._load(a,u.validate!==!1)})}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load(Bc,!1)}_loadImports(a,u,g){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const b of a){const E=this._createFragmentStyle(b),P=new Promise(F=>{E.once("style.import.load",F),E.once("error",F)}).then(()=>this.mergeAll());if(x.push(P),this.resolvedImports.has(b.url)){E.loadEmpty();continue}const I=b.data||this.importsCache.get(b.url);I?(E.loadJSON(I,{validate:u}),this._isInternalStyle(I)&&(E.globalId=null)):b.url?E.loadURL(b.url,{validate:u}):E.loadEmpty();const z={style:E,id:b.id,config:b.config};if(g){const F=this.fragments.findIndex(({id:q})=>q===g);this.fragments=this.fragments.slice(0,F).concat(z).concat(this.fragments.slice(F))}else this.fragments.push(z)}return Promise.allSettled(x)}getImportGlobalIds(a=this,u=new Set){for(const g of a.fragments)g.style.globalId&&u.add(g.style.globalId),this.getImportGlobalIds(g.style,u);return[...u.values()]}_createFragmentStyle(a){const u=this.scope?o.C(a.id,this.scope):a.id;let g;const x=this._initialConfig&&this._initialConfig[u];(a.config||x)&&(g=o.h({},a.config,x));const b=new Ps(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:a["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&a.fragment!==!1)}_load(a,u){const g=a.indoor?w1(a.schema):a.schema;if(this._isInternalStyle(a)){const E=o.h({},Bc,{imports:[{id:"basemap",data:a,url:""}]});return void this._load(E,u)}if(this.updateConfig(this._config,g),u&&Fc(this,Ta(a)))return;this._loaded=!0,this.stylesheet=o.di(a);const x=()=>{for(const z in a.sources)this.addSource(z,a.sources[z],{validate:!1,isInitialLoad:!0});if(a.iconsets)for(const z in a.iconsets)this.addIconset(z,a.iconsets[z]);a.sprite?this._loadIconset(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&a.glyphs&&this.glyphManager.setURL(a.glyphs);const E=Nf(this.stylesheet.layers);if(this._order=E.map(z=>z.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new et(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new et(this.stylesheet.light)),this._layers={};for(const z of E){const F=o.dn(z,this.scope,this._styleColorTheme.lut,this.options);F.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const q=this.getOwnLayerSourceCache(F),$=!!this.directionalLight&&this.directionalLight.shadowsEnabled();q&&F.canCastShadows()&&$&&(q.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const P=this.stylesheet.terrain;P&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(P,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const I=this.isRootStyle();a.imports?this._loadImports(a.imports,u).then(()=>{this._reloadImports(),this.fire(new o.A(I?"style.load":"style.import.load"))}).catch(z=>{this.fire(new o.z(new Error("Failed to load imports",z))),this.fire(new o.A(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.A(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const E=this._evaluateColorThemeData(b);this._loadColorTheme(E).then(()=>{x()}).catch(P=>{o.w(`Couldn't load color theme from the stylesheet: ${P}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let a,u,g,x,b,E,P,I,z,F;const q={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle($=>{if($.stylesheet){if($.light!=null&&(a=$.light),$.stylesheet.lights)for(const K of $.stylesheet.lights)K.type==="ambient"&&$.ambientLight!=null&&(u=$.ambientLight),K.type==="directional"&&$.directionalLight!=null&&(g=$.directionalLight);x=this._prioritizeTerrain(x,$.terrain,$.stylesheet.terrain),$.stylesheet.fog&&$.fog!=null&&(b=$.fog),$.stylesheet.snow&&$.snow!=null&&(E=$.snow),$.stylesheet.rain&&$.rain!=null&&(P=$.rain),$.stylesheet.camera!=null&&(F=$.stylesheet.camera),$.stylesheet.projection!=null&&(I=$.stylesheet.projection),$.stylesheet.transition!=null&&(z=$.stylesheet.transition),q[$.scope]=$._styleColorTheme}}),this.light=a,this.ambientLight=u,this.directionalLight=g,this.fog=b,this.snow=E,this.rain=P,this._styleColorThemeForScope=q,x===null?delete this.terrain:this.terrain=x,this.camera=F||{"camera-projection":"perspective"},this.projection=I||{name:"mercator"},this.transition=o.h({},Jf,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(a){const u=g=>{for(const x of g.fragments)u(x.style);a(g)};u(this)}_prioritizeTerrain(a,u,g){const x=a&&a.drapeRenderMode===0;return g===null?u&&u.drapeRenderMode===0?u:x?a:null:u!=null&&(!a||x||u&&u.drapeRenderMode===1)?u:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{a=this._prioritizeTerrain(a,u.terrain,u.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(a=u.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){const a={},u={},g={};this.forEachFragmentStyle(x=>{for(const b in x._sourceCaches){const E=o.C(b,x.scope);a[E]=x._sourceCaches[b]}for(const b in x._otherSourceCaches){const E=o.C(b,x.scope);u[E]=x._otherSourceCaches[b]}for(const b in x._symbolSourceCaches){const E=o.C(b,x.scope);g[E]=x._symbolSourceCaches[b]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=g}mergeLayers(){const a={},u=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const E of b._order){const P=b._layers[E];if(P.type==="slot"){const I=o.dj(E);if(a[I])continue;a[I]=[]}P.slot&&a[P.slot]?a[P.slot].push(P):u.push(P)}}),this._mergedOrder=[];const x=(b=[])=>{for(const E of b)if(E.type==="slot"){const P=o.dj(E.id);a[P]&&x(a[P]),this._mergedSlots.push(P)}else{const P=o.C(E.id,E.scope);this._mergedOrder.push(P),g[P]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};x(u),this._mergedOrder.sort((b,E)=>{const P=g[b],I=g[E];return P.hasInitialOcclusionOpacityProperties?I.is3D(!!this.terrain)?1:0:P.is3D(!!this.terrain)&&I.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=o.h({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(a){return a.data?function(u,g,x,b){const E=o.h({},g);for(const I of Object.keys(o.a5.colorTheme))E[I]===void 0&&(E[I]=o.a5.colorTheme[I].default);const P=new o.a6(Xm,u,new Map(x));return P.setTransitionOrValue(E,x),P.untransitioned().possiblyEvaluate(new o.aa(0,{worldview:void 0}))}(this.scope,a,this.options).get("data"):null}_loadColorTheme(a){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,x)=>{const b="data:image/png;base64,";if(!a||a.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let E=a;E.startsWith(b)||(E=b+E);const P=o.I.from("mapbox-reserved-lut"),I=new Image;I.src=E,I.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},I.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void g();this._styleColorTheme.lutLoading=!1;const{width:z,height:F,data:q}=o.q.getImageData(I);if(F>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==F*F)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(P)&&this.removeImage(P),this.addImage(P,{data:new o.r({width:z,height:F},q),pixelRatio:1,sdf:!1,usvg:!1,version:0});const $=this.imageManager.getImage(P,this.scope);$?(this._styleColorTheme.lut={image:$.data,data:a},g()):x(new Error("Missing LUT image."))}})}getLut(a){const u=this._styleColorThemeForScope[a];return u?u.lut:null}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(u,g,x){let b,E,P;const I=o.q.devicePixelRatio>1?"@2x":"";let z=o.n(g.transformRequest(g.normalizeSpriteURL(u,I,".json"),o.R.SpriteJSON),($,K)=>{z=null,P||(P=$,b=K,q())}),F=o.o(g.transformRequest(g.normalizeSpriteURL(u,I,".png"),o.R.SpriteImage),($,K)=>{F=null,P||(P=$,E=K,q())});function q(){if(P)x(P);else if(b&&E){const $=o.q.getImageData(E),K={};for(const te in b){const{width:ee,height:re,x:ie,y:ue,sdf:pe,pixelRatio:me,stretchX:Te,stretchY:we,content:Pe}=b[te],be=new o.r({width:ee,height:re});o.r.copy($,be,{x:ie,y:ue},{x:0,y:0},{width:ee,height:re},null),K[te]={data:be,pixelRatio:me,sdf:pe,stretchX:Te,stretchY:we,content:Pe,usvg:!1}}x(null,K)}}return{cancel(){z&&(z.cancel(),z=null),F&&(F.cancel(),F=null)}}}(a,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new o.z(u));else if(g){const x=new Map;for(const b in g)x.set(o.I.from(b),g[b]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))})}addIconset(a,u){if(u.type==="sprite")return void this._loadSprite(u.url);const g=this.getOwnSourceCache(u.source);if(!g)return void this.fire(new o.z(new Error(`Source "${u.source}" as specified by iconset "${a}" does not exist and cannot be used as an iconset source`)));const x=g.getSource();if(x.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${u.source}" as specified by iconset "${a}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const b=new Mv(a,this.scope,g);this.imageManager.addImageProvider(b,this.scope)}removeIconset(a){this.imageManager.removeImageProvider(a,this.scope)}_loadIconset(a){if(!o.j(a)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(a);const u=this.map._spriteFormat==="auto";var g,x;this._spriteRequest=(x=(b,E)=>{if(this._spriteRequest=null,b)u?this._loadSprite(a):this.fire(new o.z(b));else if(E){const P=new Map;for(const I in E)P.set(o.I.from(I),E[I]);this.addImages(P)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(a),o.R.Iconset),(b,E)=>{if(b)return void x(b);const P={},I=o.da(new o.bq(E));for(const z of I.icons){const F={version:1,pixelRatio:o.q.devicePixelRatio,content:S1(z),stretchX:z.metadata?T1(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?T1(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};P[z.name]=F}x(null,P)}))}_validateLayer(a){const u=this.getOwnSource(a.source);if(!u)return;const g=a.sourceLayer;g&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(g)===-1)&&this.fire(new o.z(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,u)=>{const g=this.fragments[u];return g&&g.style&&(a.data=g.style.serialize()),a})}_serializeSources(){const a={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();a[g.id]||(a[g.id]=g.serialize())}return a}_serializeLayers(a){const u=[];for(const g of a){const x=this._layers[g];x&&x.type!=="custom"&&u.push(x.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(a){return a?this.order:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){const u=this.getOwnLayer(a);if(u)return u;this.fire(new o.z(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){const u=this.getOwnSource(a);if(u)return u;this.fire(new o.z(new Error(`The source '${a}' does not exist in the map's style.`)))}precompilePrograms(a,u){const g=this.map.painter;if(g)for(let x=a.minzoom||0;x<(a.maxzoom||25.5);x++){const b=a.getProgramIds();if(b)for(const E of b){const P=a.getDefaultProgramParams(E,u.zoom,this._styleColorTheme.lut);P&&(g.style=this,this.fog&&(g._fogVisible=!0,P.overrideFog=!0,g.getOrCreateProgram(E,P)),g._fogVisible=!1,P.overrideFog=!1,g.getOrCreateProgram(E,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,g.getOrCreateProgram(E,P)))}}}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);const u=this.calculateLightsBrightness();a.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u)),a.worldview!==this._worldview&&(this._worldview=a.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const g=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const P=this._changes.getLayerUpdatesByScope();for(const I in P){const{updatedIds:z,removedIds:F}=P[I];(z||F)&&(this._updateWorkerLayers(I,z,F),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this.snow&&this.snow.updateTransitions(a),this.rain&&this.rain.updateTransitions(a),this._changes.reset()}const b={};for(const P in this._mergedSourceCaches){const I=this._mergedSourceCaches[P];b[P]=I.used,I.used=!1,I.tileCoverLift=0}for(const P of this._mergedOrder){const I=this._mergedLayers[P];if(I.recalculate(a,this._availableImages),!I.isHidden(a.zoom)){const z=this.getLayerSourceCache(I);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,a)}):this.precompilePrograms(I,a))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const P of E)P.sourceCache.used=!0;for(const P in b){const I=this._mergedSourceCaches[P];b[P]!==I.used&&I.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.snow&&this.snow.recalculate(a),this.rain&&this.rain.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const a=this.imageManager.getPendingImageProviders();for(const u of a){const g=u.resolvePendingRequests(),x=this.getFragmentStyle(u.scope);x&&x.addImages(g)}}_updateTilesForChangedImages(){const a={};for(const u in this._mergedSourceCaches){const g=this._mergedSourceCaches[u].getSource().scope;a[g]=a[g]||this._changes.getUpdatedImages(g),a[g].length!==0&&this._mergedSourceCaches[u].reloadTilesForDependencies(["icons","patterns"],a[g])}for(const u in a)this._changes.resetUpdatedImages(u)}_updateWorkerLayers(a,u,g){const x=this.getFragmentStyle(a);x&&this.dispatcher.broadcast("updateLayers",{layers:u?x._serializeLayers(u):[],scope:a,removedIds:g||[],options:x.options})}setState(a,u){if(this._checkLoaded(),Fc(this,Ta(a)))return!1;(a=o.di(a)).layers=Nf(a.layers);const g=function(E,P){if(!E)return[{command:on.setStyle,args:[P]}];let I=[];try{if(!o.bv(E.version,P.version))return[{command:on.setStyle,args:[P]}];if(o.bv(E.center,P.center)||I.push({command:on.setCenter,args:[P.center]}),o.bv(E.zoom,P.zoom)||I.push({command:on.setZoom,args:[P.zoom]}),o.bv(E.bearing,P.bearing)||I.push({command:on.setBearing,args:[P.bearing]}),o.bv(E.pitch,P.pitch)||I.push({command:on.setPitch,args:[P.pitch]}),o.bv(E.sprite,P.sprite)||I.push({command:on.setSprite,args:[P.sprite]}),o.bv(E.glyphs,P.glyphs)||I.push({command:on.setGlyphs,args:[P.glyphs]}),o.bv(E.imports,P.imports)||function(K=[],te=[],ee){te=te||[];const re=(K=K||[]).map(zu),ie=te.map(zu),ue=K.reduce(Rc,{}),pe=te.reduce(Rc,{}),me=re.slice();let Te,we,Pe,be;for(Te=0,we=0;Te<re.length;Te++)Pe=re[Te],pe.hasOwnProperty(Pe)?we++:(ee.push({command:on.removeImport,args:[Pe]}),me.splice(me.indexOf(Pe,we),1));for(Te=0,we=0;Te<ie.length;Te++)Pe=ie[ie.length-1-Te],me[me.length-1-Te]!==Pe&&(ue.hasOwnProperty(Pe)?(ee.push({command:on.removeImport,args:[Pe]}),me.splice(me.lastIndexOf(Pe,me.length-we),1)):we++,be=me[me.length-Te],ee.push({command:on.addImport,args:[pe[Pe],be]}),me.splice(me.length-Te,0,Pe));for(const Se of te){const Ee=ue[Se.id];Ee&&(delete Ee.data,o.bv(Ee,Se)||ee.push({command:on.updateImport,args:[Se.id,Se]}))}}(E.imports,P.imports,I),o.bv(E.transition,P.transition)||I.push({command:on.setTransition,args:[P.transition]}),o.bv(E.light,P.light)||I.push({command:on.setLight,args:[P.light]}),o.bv(E.fog,P.fog)||I.push({command:on.setFog,args:[P.fog]}),o.bv(E.snow,P.snow)||I.push({command:on.setSnow,args:[P.snow]}),o.bv(E.rain,P.rain)||I.push({command:on.setRain,args:[P.rain]}),o.bv(E.projection,P.projection)||I.push({command:on.setProjection,args:[P.projection]}),o.bv(E.lights,P.lights)||I.push({command:on.setLights,args:[P.lights]}),o.bv(E.camera,P.camera)||I.push({command:on.setCamera,args:[P.camera]}),o.bv(E.iconsets,P.iconsets)||function(K,te,ee){let re;for(re in te=te||{},K=K||{})K.hasOwnProperty(re)&&(te.hasOwnProperty(re)||ee.push({command:on.removeIconset,args:[re]}));for(re in te){if(!te.hasOwnProperty(re))continue;const ie=te[re];K.hasOwnProperty(re)?o.bv(K[re],ie)||(ee.push({command:on.removeIconset,args:[re]}),ee.push({command:on.addIconset,args:[re,ie]})):ee.push({command:on.addIconset,args:[re,ie]})}}(E.iconsets,P.iconsets,I),!o.bv(E["color-theme"],P["color-theme"]))return[{command:on.setStyle,args:[P]}];const z={},F=[];(function(K,te,ee,re){let ie;for(ie in te=te||{},K=K||{})K.hasOwnProperty(ie)&&(te.hasOwnProperty(ie)||qh(ie,ee,re));for(ie in te){if(!te.hasOwnProperty(ie))continue;const ue=te[ie];K.hasOwnProperty(ie)?o.bv(K[ie],ue)||(K[ie].type==="geojson"&&ue.type==="geojson"&&SC(K,te,ie)?ee.push({command:on.setGeoJSONSourceData,args:[ie,ue.data]}):Ff(ie,te,ee,re)):Gm(ie,te,ee)}})(E.sources,P.sources,F,z);const q=[];E.layers&&E.layers.forEach(K=>{K.source&&z[K.source]?I.push({command:on.removeLayer,args:[K.id]}):q.push(K)});let $=E.terrain;$&&z[$.source]&&(I.push({command:on.setTerrain,args:[void 0]}),$=void 0),I=I.concat(F),o.bv($,P.terrain)||I.push({command:on.setTerrain,args:[P.terrain]}),function(K,te,ee){te=te||[];const re=(K=K||[]).map(zu),ie=te.map(zu),ue=K.reduce(Rc,{}),pe=te.reduce(Rc,{}),me=re.slice(),Te=Object.create(null);let we,Pe,be,Se,Ee,Ve,De;for(we=0,Pe=0;we<re.length;we++)be=re[we],pe.hasOwnProperty(be)?Pe++:(ee.push({command:on.removeLayer,args:[be]}),me.splice(me.indexOf(be,Pe),1));for(we=0,Pe=0;we<ie.length;we++)be=ie[ie.length-1-we],me[me.length-1-we]!==be&&(ue.hasOwnProperty(be)?(ee.push({command:on.removeLayer,args:[be]}),me.splice(me.lastIndexOf(be,me.length-Pe),1)):Pe++,Ve=me[me.length-we],ee.push({command:on.addLayer,args:[pe[be],Ve]}),me.splice(me.length-we,0,be),Te[be]=!0);for(we=0;we<ie.length;we++)if(be=ie[we],Se=ue[be],Ee=pe[be],!Te[be]&&!o.bv(Se,Ee))if(o.bv(Se.source,Ee.source)&&o.bv(Se["source-layer"],Ee["source-layer"])&&o.bv(Se.type,Ee.type)){for(De in Bf(Se.layout,Ee.layout,ee,be,null,on.setLayoutProperty),Bf(Se.paint,Ee.paint,ee,be,null,on.setPaintProperty),o.bv(Se.slot,Ee.slot)||ee.push({command:on.setSlot,args:[be,Ee.slot]}),o.bv(Se.filter,Ee.filter)||ee.push({command:on.setFilter,args:[be,Ee.filter]}),o.bv(Se.minzoom,Ee.minzoom)&&o.bv(Se.maxzoom,Ee.maxzoom)||ee.push({command:on.setLayerZoomRange,args:[be,Ee.minzoom,Ee.maxzoom]}),Se)Se.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?Bf(Se[De],Ee[De],ee,be,De.slice(6),on.setPaintProperty):o.bv(Se[De],Ee[De])||ee.push({command:on.setLayerProperty,args:[be,De,Ee[De]]}));for(De in Ee)Ee.hasOwnProperty(De)&&!Se.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?Bf(Se[De],Ee[De],ee,be,De.slice(6),on.setPaintProperty):o.bv(Se[De],Ee[De])||ee.push({command:on.setLayerProperty,args:[be,De,Ee[De]]}))}else ee.push({command:on.removeLayer,args:[be]}),Ve=me[me.lastIndexOf(be)+1],ee.push({command:on.addLayer,args:[Ee,Ve]})}(q,P.layers,I)}catch(z){console.warn("Unable to compute style diff:",z),I=[{command:on.setStyle,args:[P]}]}return I}(this.serialize(),a).filter(E=>!(E.command in A1));if(g.length===0)return!1;const x=g.filter(E=>!(E.command in E1));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);const b=[];return g.forEach(E=>{b.push(this[E.command](...E.args))}),u&&Promise.all(b).then(u).catch(u),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(a){if(a.size===0)return this;for(const[u,g]of a.entries()){if(this.getImage(u))return this.fire(new o.z(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,this.scope,g),this._changes.updateImage(u,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(a,u){return this.getImage(a)?this.fire(new o.z(new Error(`An image with the name "${a.name}" already exists.`))):(this.imageManager.addImage(a,this.scope,u),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(a,u,g=!1){this.imageManager.updateImage(a,this.scope,u),g&&(this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(a){return this.modelManager.addModelURLs(a,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(a,u,g={}){return this._checkLoaded(),this._validate(ye,`models.${a}`,u,null,g)||(this.modelManager.addModel(a,u,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope,!1,!0),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,u,g={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error(`There is already a source with ID "${a}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(Gl,`sources.${a}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const x=Of(a,u,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const b=E=>{const P=(E?"symbol:":"other:")+x.id,I=o.C(P,this.scope),z=this._sourceCaches[P]=new Aa(I,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=z,z.onAdd(this.map)};b(!1),u.type!=="vector"&&u.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();const u=this.getOwnSource(a);if(!u)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===a)return this.fire(new o.z(new Error(`Source "${a}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new o.z(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([b,E])=>E.type==="source"&&E.source===a);if(x)return this.fire(new o.z(new Error(`Source "${a}" cannot be removed while iconset "${x[0]}" is using it.`)))}const g=this.getOwnSourceCaches(a);for(const x of g){const b=o.dj(x.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(x.id),x.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,u){this._checkLoaded(),this.getOwnSource(a).setData(u),this._changes.setDirty()}getOwnSource(a){const u=this.getOwnSourceCache(a);return u&&u.getSource()}getOwnSources(){const a=[];for(const u in this._otherSourceCaches){const g=this.getOwnSourceCache(u);g&&a.push(g.getSource())}return a}areTilesLoaded(){const a=this._mergedSourceCaches;for(const u in a){const g=a[u]._tiles;for(const x in g){const b=g[x];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const b of a){if(this._validate(Ic,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(b),E.updateTransitions(u)}else this.ambientLight=new Dn(b,Wr||(Wr=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(b),E.updateTransitions(u)}else this.directionalLight=new Dn(b,Ti||(Ti=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=Object.assign(u,{worldview:this.map.getWorldview()}),x=new o.aa(this.z||0,g);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const a=this.directionalLight,u=this.ambientLight;if(!a||!u)return;const g=$=>.2126*($[0]<=.03928?$[0]/12.92:Math.pow(($[0]+.055)/1.055,2.4))+.7152*($[1]<=.03928?$[1]/12.92:Math.pow(($[1]+.055)/1.055,2.4))+.0722*($[2]<=.03928?$[2]/12.92:Math.pow(($[2]+.055)/1.055,2.4)),x=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=a.properties.get("intensity"),E=a.properties.get("direction"),P=1-o.d1(E.x,E.y,E.z)[2]/90,I=g(x)*b*P,z=u.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=u.properties.get("intensity"),q=g(z)*F;return Number(((I+q)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(a==null||a===""&&this.isRootStyle())return this;if(o.dk(a)){const u=o.dl(a),g=this.fragments.find(({id:b})=>b===u);if(!g)return;const x=o.dj(a);return g.style.getFragmentStyle(x)}{const u=this.fragments.find(({id:g})=>g===a);return u?u.style:void 0}}setFeaturesetSelectors(a){if(!a)return;const u={},g=(x,b="")=>`${x}::${b}`;this._featuresetSelectors={};for(const x in a){const b=this._featuresetSelectors[x]=[];for(const E of a[x].selectors){if(E.featureNamespace){const I=this.getOwnLayer(E.layer);if(!I){o.w(`Layer is undefined for selector: ${E.layer}`);continue}const z=g(I.source,I.sourceLayer);if(z in u&&u[z]!==E.featureNamespace){o.w(`"featureNamespace ${E.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}u[z]=E.featureNamespace}let P;if(E.properties)for(const I in E.properties){const z=o.X(E.properties[I]);z.result==="success"&&(P=P||{},P[I]=z.value)}b.push({layerId:E.layer,namespace:E.featureNamespace,properties:P,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(a){const u=this.getFragmentStyle(a);if(!u||!u.stylesheet.featuresets)return[];const g=[];for(const x in u.stylesheet.featuresets)g.push({featuresetId:x,importId:u.scope?u.scope:void 0});return g}getFeaturesetLayers(a,u){const g=this.getFragmentStyle(u),x=g.stylesheet.featuresets;if(!x||!x[a])return this.fire(new o.z(new Error(`The featureset '${a}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const E of x[a].selectors){const P=g.getOwnLayer(E.layer);P&&b.push(P)}return b}getConfigProperty(a,u){const g=this.getFragmentStyle(a);if(!g)return null;const x=o.C(u,g.scope),b=g.options.get(x),E=b?b.value||b.default:null;return E?E.serialize():null}setConfigProperty(a,u,g){const x=this.getFragmentStyle(a);if(!x)return;const b=x.stylesheet.indoor?w1(x.stylesheet.schema):x.stylesheet.schema;if(!b||!b[u])return;const E=o.X(g);if(E.result!=="success")return void Fc(this,E.value);const P=E.value.expression,I=o.C(u,x.scope),z=x.options.get(I);if(!z)return;let F;const{minValue:q,maxValue:$,stepValue:K,type:te,values:ee}=b[u],re=o.X(b[u].default);re.result==="success"&&(F=re.value.expression),F?(this.options.set(I,Object.assign({},z,{value:P,default:F,minValue:q,maxValue:$,stepValue:K,type:te,values:ee})),this.updateConfigDependencies(u)):this.fire(new o.z(new Error(`No schema defined for the config option "${u}" in the "${a}" fragment.`)))}getConfig(a){const u=this.getFragmentStyle(a);if(!u)return null;const g=u.stylesheet.schema;if(!g)return null;const x={};for(const b in g){const E=o.C(b,u.scope),P=u.options.get(E),I=P?P.value||P.default:null;x[b]=I?I.serialize():null}return x}setConfig(a,u){const g=this.getFragmentStyle(a);g&&(g.updateConfig(u,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){const u=this.getFragmentStyle(a);return u?u.stylesheet.schema:null}setSchema(a,u){const g=this.getFragmentStyle(a);g&&(g.stylesheet.schema=u,g.updateConfig(g._config,u),this.updateConfigDependencies())}updateConfig(a,u){if(this._config=a,a||u)if(u)for(const g in u){let x,b;const E=o.X(u[g].default);if(E.result==="success"&&(x=E.value.expression),a&&a[g]!==void 0){const $=o.X(a[g]);$.result==="success"&&(b=$.value.expression)}const{minValue:P,maxValue:I,stepValue:z,type:F,values:q}=u[g];if(x){const $=o.C(g,this.scope);this.options.set($,{default:x,value:b,minValue:P,maxValue:I,stepValue:z,type:F,values:q})}else this.fire(new o.z(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(a){for(const u of this._configDependentLayers){const g=this.getLayer(u);if(g){if(a&&!g.configDependencies.has(a))continue;g.possiblyEvaluateVisibility(),this._updateLayer(g)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(u=>{const g=u._styleColorTheme.colorThemeOverride?u._styleColorTheme.colorThemeOverride:u._styleColorTheme.colorTheme;if(g){const x=u._evaluateColorThemeData(g);(!u._styleColorTheme.lut&&x!==""||u._styleColorTheme.lut&&x!==u._styleColorTheme.lut.data)&&u.setColorTheme(g)}}),this._changes.setDirty()}addLayer(a,u,g={}){this._checkLoaded();const x=a.id;if(this._layers[x])return void this.fire(new o.z(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(a.type==="custom"){if(Fc(this,o.dm(a)))return;b=o.dn(a,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof a.source=="object"&&(this.addSource(x,a.source),a=o.di(a),a=o.h(a,{source:x})),this._validate(Br,`layers.${x}`,a,{arrayIndex:-1},g))return;b=o.dn(a,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let E=this._order.length;if(u){const F=this._order.indexOf(u);if(F===-1)return void this.fire(new o.z(new Error(`Layer with id "${u}" does not exist on this map.`)));b.slot===this._layers[u].slot?E=F:o.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const P=this.getOwnLayerSourceCache(b),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&b.canCastShadows()&&I&&(P.castsShadows=!0);const z=this._changes.getRemovedLayer(b);if(z&&b.source&&P&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const F=o.C(b.source,b.scope);z.type!==b.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),P.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(a,u){this._checkLoaded();const g=this._checkLayer(a);if(!g||a===u)return;const x=this._order.indexOf(a);this._order.splice(x,1);let b=this._order.length;if(u){const E=this._order.indexOf(u);if(E===-1)return void this.fire(new o.z(new Error(`Layer with id "${u}" does not exist on this map.`)));g.slot===this._layers[u].slot?b=E:o.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();const u=this._checkLayer(a);if(!u)return;u.setEventedParent(null);const g=this._order.indexOf(a);this._order.splice(g,1),delete this._layers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const x=this.getOwnLayerSourceCache(u);if(x&&x.castsShadows){let b=!1;for(const E in this._layers)if(this._layers[E].source===u.source&&this._layers[E].canCastShadows()){b=!0;break}x.castsShadows=b}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(const u in this._layers)if(this._layers[u].type===a)return!0;return!1}setLayerZoomRange(a,u,g){this._checkLoaded();const x=this._checkLayer(a);x&&(x.minzoom===u&&x.maxzoom===g||(u!=null&&(x.minzoom=u),g!=null&&(x.maxzoom=g),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(a,u){this._checkLoaded();const g=this._checkLayer(a);g&&g.slot!==u&&(g.slot=u,this._updateLayer(g))}setFilter(a,u,g={}){this._checkLoaded();const x=this._checkLayer(a);if(x&&!o.bv(x.filter,u))return u==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(qe,`layers.${x.id}.filter`,u,{layerType:x.type},g)||(x.filter=o.di(u),this._updateLayer(x)))}getFilter(a){const u=this._checkLayer(a);if(u)return o.di(u.filter)}setLayoutProperty(a,u,g,x={}){this._checkLoaded();const b=this._checkLayer(a);if(b&&!o.bv(b.getLayoutProperty(u),g)){if(g!=null&&(!x||x.validate!==!1)&&Fc(b,ce.call(Ta,{key:`layers.${a}.layout.${u}`,layerType:b.type,objectKey:u,value:g,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(u,g),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(a,u){const g=this._checkLayer(a);if(g)return g.getLayoutProperty(u)}setPaintProperty(a,u,g,x={}){this._checkLoaded();const b=this._checkLayer(a);if(!b||o.bv(b.getPaintProperty(u),g)||g!=null&&(!x||x.validate!==!1)&&Fc(b,oe.call(Ta,{key:`layers.${a}.paint.${u}`,layerType:b.type,objectKey:u,value:g,styleSpec:o.a5})))return;const E=b.setPaintProperty(u,g);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),E&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(a,u){const g=this._checkLayer(a);if(g)return g.getPaintProperty(u)}setFeatureState(a,u){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:I,importId:z}=a.target,F=this.getFragmentStyle(z),q=F.getFeaturesetLayers(I);for(const{source:$,sourceLayer:K}of q)F.setFeatureState({id:a.id,source:$,sourceLayer:K},u)}else if("layerId"in a.target){const{layerId:I}=a.target,z=this.getLayer(I);this.setFeatureState({id:a.id,source:z.source,sourceLayer:z.sourceLayer},u)}return}const g=a.source,x=a.sourceLayer,b=this._checkSource(g);if(!b)return;const E=b.type;if(E==="geojson"&&x)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(g);for(const I of P)I.setFeatureState(x,a.id,u)}removeFeatureState(a,u){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:I,importId:z}=a.target,F=this.getFragmentStyle(z),q=F.getFeaturesetLayers(I);for(const{source:$,sourceLayer:K}of q)F.removeFeatureState({id:a.id,source:$,sourceLayer:K},u)}else if("layerId"in a.target){const{layerId:I}=a.target,z=this.getLayer(I);this.removeFeatureState({id:a.id,source:z.source,sourceLayer:z.sourceLayer},u)}return}const g=a.source,x=this._checkSource(g);if(!x)return;const b=x.type,E=b==="vector"?a.sourceLayer:void 0;if(b==="vector"&&!E)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(g);for(const I of P)I.removeFeatureState(E,a.id,u)}getFeatureState(a){if(this._checkLoaded(),"target"in a){let b;if("featuresetId"in a.target){const{featuresetId:E,importId:P}=a.target,I=this.getFragmentStyle(P),z=I.getFeaturesetLayers(E);for(const{source:F,sourceLayer:q}of z){const $=I.getFeatureState({id:a.id,source:F,sourceLayer:q});if($&&!b)b=$;else if(!o.bv(b,$))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in a.target){const{layerId:E}=a.target,P=this.getLayer(E);b=this.getFeatureState({id:a.id,source:P.source,sourceLayer:P.sourceLayer})}return b}const u=a.source,g=a.sourceLayer,x=this._checkSource(u);if(x){if(x.type!=="vector"||g)return a.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(g,a.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=o.h({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return o.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const a=this.getTerrain(),u=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return o.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(a){for(const u of Object.values(this._mergedLayers))a(u)&&this._updateLayer(u)}_updateLayer(a){this._changes.updateLayer(a);const u=this.getLayerSourceCache(a),g=o.C(a.source,a.scope),x=this._changes.getUpdatedSourceCaches();a.source&&!x[g]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),u.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const u=P=>this._mergedLayers[P].is3D(!!this.terrain),g=this.order,x={},b=[];for(let P=g.length-1;P>=0;P--){const I=g[P];if(u(I)){x[I]=P;for(const z of a){const F=z[I];if(F)for(const q of F)b.push(q)}}}b.sort((P,I)=>I.intersectionZ-P.intersectionZ);const E=[];for(let P=g.length-1;P>=0;P--){const I=g[P];if(u(I))for(let z=b.length-1;z>=0;z--){const F=b[z].feature;if(F.layer&&x[F.layer.id]<P)break;E.push(F),b.pop()}else for(const z of a){const F=z[I];if(F)for(const q of F)E.push(q.feature)}}return E}queryRenderedFeatures(a,u,g){let x;u&&!Array.isArray(u)&&u.filter&&(this._validate(qe,"queryRenderedFeatures.filter",u.filter,null,u),x=o.b3(u.filter));const b={},E=F=>{if(Ym.has(F.type))return;const q=this.getOwnLayerSourceCache(F),$=b[q.id]=b[q.id]||{sourceCache:q,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&($.has3DLayers=!0),$.layers[F.fqid]=$.layers[F.fqid]||{styleLayer:F,targets:[]},$.layers[F.fqid].targets.push({filter:x})};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const F of u.layers){const q=this._layers[F];if(!q)return this.fire(new o.z(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];E(q)}}else for(const F in this._layers)E(this._layers[F]);const P=this._queryRenderedFeatures(a,b,g),I=this._flattenAndSortRenderedFeatures(P),z=[];for(const F of I)o.dq(F.layer.id)===this.scope&&z.push(F);return z}queryRenderedFeatureset(a,u,g){let x;u&&!Array.isArray(u)&&u.filter&&(this._validate(qe,"queryRenderedFeatures.filter",u.filter,null,u),x=o.b3(u.filter));const b="mock",E=[];if(u&&u.target)E.push(Object.assign({},u,{targetId:b,filter:x}));else{const F=this.getFeaturesetDescriptors();for(const q of F)E.push({targetId:b,filter:x,target:q});for(const{style:q}of this.fragments){const $=q.getFeaturesetDescriptors();for(const K of $)E.push({targetId:b,filter:x,target:K})}}const P=this.queryRenderedTargets(a,E,g),I=[],z=new Set;for(const F of P)for(const q of F.variants[b])Um(q,F,z)||I.push(new o.dr(F,q));return I}queryRenderedTargets(a,u,g){const x={},b=(P,I,z,F)=>{const q=x[I.id]=x[I.id]||{sourceCache:I,layers:{},has3DLayers:!1};if(q.layers[P.fqid]=q.layers[P.fqid]||{styleLayer:P,targets:[]},P.is3D(!!this.terrain)&&(q.has3DLayers=!0),!F)return z.uniqueFeatureID=!1,void q.layers[P.fqid].targets.push(z);q.layers[P.fqid].targets.push(Object.assign({},z,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const P of u)if("featuresetId"in P.target){const{featuresetId:I,importId:z}=P.target,F=this.getFragmentStyle(z);if(!F||!F._featuresetSelectors)continue;const q=F._featuresetSelectors[I];if(!q){this.fire(new o.z(new Error(`The featureset '${I}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const $ of q){const K=F.getOwnLayer($.layerId);K&&!Ym.has(K.type)&&b(K,F.getOwnLayerSourceCache(K),P,$)}}else if("layerId"in P.target){const{layerId:I}=P.target,z=this.getLayer(I);if(!z||Ym.has(z.type))continue;b(z,this.getLayerSourceCache(z),P)}const E=this._queryRenderedFeatures(a,x,g);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(a,u,g){const x=[],b=!!this.map._showQueryGeometry,E=pn.createFromScreenPoints(a,g);for(const P in u){const I=Vm(E,u[P],this._availableImages,g,b);Object.keys(I).length&&x.push(I)}if(this.placement)for(const P in u){if(!u[P].sourceCache._onlySymbols)continue;const I=Ru(E.screenGeometry,u[P],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(I).length&&x.push(I)}return x}querySourceFeatures(a,u){const g=u&&u.filter;g&&this._validate(qe,"querySourceFeatures.filter",g,null,u);let x=[];const b=this.getOwnSourceCaches(a);for(const E of b)x=x.concat(Rf(E,u));return x}addSourceType(a,u,g){return Ps.getSourceType(a)?g(new Error(`A source type called "${a}" already exists.`)):(Ps.setSourceType(a,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:u.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,u,g={}){this._checkLoaded();const x=this.light.getLight();let b=!1;for(const P in a)if(!o.bv(a[P],x[P])){b=!0;break}if(!b)return;const E=this._getTransitionParameters();this.light.setLight(a,u,g),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(a,u=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),u===0&&delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=a;const x=a.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){const P="terrain-dem-src";this.addSource(P,g.source),g=o.di(g),g=o.h(g,{source:P})}const b=o.h({},g),E={};if(this.terrain&&x){b.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(E.style=P.serialize())}if(this._validate(ut,"terrain",b,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&u!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,u),this.fire(new o.A("data",{dataType:"style"}))}else{const b=this.terrain,E=b.get();for(const P of Object.keys(o.a5.terrain))!g.hasOwnProperty(P)&&o.a5.terrain[P].default&&(g[P]=o.a5.terrain[P].default);for(const P in a)if(!o.bv(a[P],E[P])){b.set(a,this.options),this.stylesheet.terrain=a;const I=this._getTransitionParameters({duration:0});b.updateTransitions(I),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const u=this.fog=new zr(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_createSnow(a){const u=this.snow=new to(a,this.map.transform,this.scope,this.options);this.stylesheet.snow=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_createRain(a){const u=this.rain=new Wi(a,this.map.transform,this.scope,this.options);this.stylesheet.rain=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!o.bv(u.get(),a)){u.set(a,this.options),this.stylesheet.fog=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createFog(a);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(a){if(this._checkLoaded(),!a)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const u=this.snow;if(!o.bv(u.get(),a)){u.set(a,this.options),this.stylesheet.snow=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createSnow(a);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(a){if(this._checkLoaded(),!a)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const u=this.rain;if(!o.bv(u.get(),a)){u.set(a,this.options),this.stylesheet.rain=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createRain(a);this._markersNeedUpdate=!0}_reloadColorTheme(){const a=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},u=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!u)return this._styleColorTheme.lut=null,void a();const g=this._evaluateColorThemeData(u);this._loadColorTheme(g).then(()=>{this.fire(new o.A("colorthemeset")),a()}).catch(x=>{o.w(`Couldn't set color theme: ${x}`)})}setColorTheme(a){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=a,this._reloadColorTheme()}setImportColorTheme(a,u){const g=this.getFragmentStyle(a);g&&(g._styleColorTheme.colorThemeOverride=u,g._reloadColorTheme())}_getTransitionParameters(a){return{now:o.q.now(),transition:o.h(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;const a=[],u=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?a.push(g):u.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...u)}_createTerrain(a,u){const g=this.terrain=new Ue(a,u,this.scope,this.options,this.map.getWorldview());u===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});g.updateTransitions(x)}_force3DLayerUpdate(){for(const a in this._layers){const u=this._layers[a];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const u=this._layers[a];u.type==="symbol"&&this._updateLayer(u)}}_validate(a,u,g,x,b={}){if(b&&b.validate===!1)return!1;const E=o.h({},this.serialize());return Fc(this,a.call(Ta,o.h({key:u,style:E,value:g,styleSpec:o.a5},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(a){const u=this.getSourceCaches(a);for(const g of u)g.clearTiles()}clearSources(){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}clearLayers(){for(const a in this._mergedLayers){const u=this._mergedLayers[a];u._clear&&u._clear()}}reloadSource(a){const u=this.getSourceCaches(a);for(const g of u)g.resume(),g.reload()}reloadSources(){for(const a of this.getSources())a.reload&&a.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(a=>{a.modelManager.reloadModels(a.scope)})}updateSources(a){let u;this.directionalLight&&(u=Qh(this.directionalLight));const g=new Set;for(const x in this._mergedLayers){const b=this._mergedLayers[x];b.hasElevation()&&!g.has(b.source)&&g.add(b.source)}for(const x in this._mergedSourceCaches){const b=this._mergedSourceCaches[x],E=g.has(b._source.id);b.update(a,void 0,void 0,u,E)}}_generateCollisionBoxes(){for(const a in this._sourceCaches){const u=this._sourceCaches[a];u.resume(),u.reload()}}_updatePlacement(a,u,g,x,b,E,P=!1){let I=!1,z=!1;const F={},q={};for(const $ of this._mergedOrder){const K=this._mergedLayers[$];if(K.type!=="symbol")continue;const te=o.C(K.source,K.scope);let ee=F[te];if(!ee){const ie=this.getLayerSourceCache(K);if(!ie)continue;const ue=ie.getRenderableIds(!0).map(pe=>ie.getTileByID(pe));q[te]=ue.slice(),ee=F[te]=ue.sort((pe,me)=>me.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(me.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer(K,ee,u.center.lng,u.projection);I=I||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),P=P||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),u.zoom))&&(this.pauseablePlacement=new Zm(u,this._mergedOrder,P,g,x,b,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,q,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),z=!0),I&&this.pauseablePlacement.placement.setStale()),z||I){this._buildingIndex.onNewFrame(u.zoom);for(let $=0;$<this._mergedOrder.length;$++){const K=this._mergedLayers[this._mergedOrder[$]];if(K.type!=="symbol")continue;const te=this.isLayerClipped(K);this.placement.updateLayerOpacities(K,F[o.C(K.source,K.scope)],$,te?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,u){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:b})=>b===a.id)!==-1)return void this.fire(new o.z(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!u)return g.push(a),this._loadImports([a],!0);const x=g.findIndex(({id:b})=>b===u);return x===-1&&this.fire(new o.z(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,x).concat(a).concat(g.slice(x)),this._loadImports([a],!0,u)}updateImport(a,u){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(a);return x===-1?this:typeof u=="string"?(this.setImportUrl(a,u),this):(u.url&&u.url!==g[x].url&&this.setImportUrl(a,u.url),o.bv(u.config,g[x].config)||this.setImportConfig(a,u.config,u.data.schema),o.bv(u.data,g[x].data)||this.setImportData(a,u.data),this)}moveImport(a,u){this._checkLoaded();let g=this.stylesheet.imports||[];const x=this.getImportIndex(a);if(x===-1)return this;const b=this.getImportIndex(u);if(b===-1)return this;const E=g[x],P=this.fragments[x];return g=g.filter(({id:I})=>I!==a),this.fragments=this.fragments.filter(({id:I})=>I!==a),this.stylesheet.imports=g.slice(0,b).concat(E).concat(g.slice(b)),this.fragments=this.fragments.slice(0,b).concat(P).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(a,u){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(a);if(x===-1)return this;g[x].url=u;const b=this.fragments[x];return b.style=this._createFragmentStyle(g[x]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(u),this}setImportData(a,u){this._checkLoaded();const g=this.getImportIndex(a),x=this.stylesheet.imports||[];return g===-1?this:u?(this.fragments[g].style.setState(u),this._reloadImports(),this):(delete x[g].data,this.setImportUrl(a,x[g].url))}setImportConfig(a,u,g){this._checkLoaded();const x=this.getImportIndex(a),b=this.stylesheet.imports||[];if(x===-1)return this;u?b[x].config=u:delete b[x].config;const E=this.fragments[x];g&&E.style.stylesheet&&(E.style.stylesheet.schema=g);const P=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=u,E.style.updateConfig(u,P),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();const u=this.stylesheet.imports||[],g=this.getImportIndex(a);g!==-1&&(u.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(a){const u=(this.stylesheet.imports||[]).findIndex(g=>g.id===a);return u===-1&&this.fire(new o.z(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),u}getLayer(a){return this._mergedLayers[a]}getSources(){const a=[];for(const u in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[u];g&&a.push(g.getSource())}return a}getSource(a,u){const g=this.getSourceCache(a,u);return g&&g.getSource()}getLayerSource(a){const u=this.getLayerSourceCache(a);return u&&u.getSource()}getSourceCache(a,u){const g=o.C(a,u);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(a){const u=o.C(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(a){if(a==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[a]&&u.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&u.push(this._mergedSymbolSourceCaches[a]),u}updateSourceCaches(){const a=this._changes.getUpdatedSourceCaches();for(const u in a){const g=a[u];g==="reload"?this.reloadSource(u):g==="clear"&&this.clearSource(u)}}updateLayers(a){const u=this._changes.getUpdatedPaintProperties();for(const g of u){const x=this.getLayer(g);x&&x.updateTransitions(a)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(a){this.stylesheet.glyphs=a,this.glyphManager.setURL(a)}getImages(a,u,g){this.imageManager.getImages(u.images,u.scope,g),this._updateTilesForChangedImages();const x=E=>{if(E){const P=u.images.map(I=>o.I.toString(I));E.setDependencies(u.tileID.key,u.type,P)}},b=o.C(u.source,u.scope);x(this._mergedOtherSourceCaches[b]),x(this._mergedSymbolSourceCaches[b]),u.images.some(E=>E.iconsetId)&&this.fire(new o.A("data",{dataType:"style"}))}rasterizeImages(a,u,g){this.imageManager.rasterizeImages(u,g)}getGlyphs(a,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(a,u,g){return o.dt(u,g)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){const u=[];return this._otherSourceCaches[a]&&u.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&u.push(this._symbolSourceCaches[a]),u}_isSourceCacheLoaded(a){const u=this.getOwnSourceCaches(a);return u.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${a}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(a,u){if(!this._clipLayerPresent&&a.type!=="fill-extrusion"&&a.type!=="building")return!1;const g=a.type==="fill-extrusion"&&(a.sourceLayer==="building"||a.sourceLayer==="procedural_buildings"),x=a.type==="building";if(a.is3D(!!this.terrain)){if(g||x||u&&u.type==="batched-model"||a.type==="model")return!0}else if(a.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ps.getSourceType=function(m){return Bm[m]},Ps.setSourceType=function(m,a){Bm[m]=a},Ps.registerForPluginStateChange=o.du;var Iv=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,td=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,rd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ov="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Jm=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,os=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Dt=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jv=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,eg=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,tg=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Qf=[];tl(Iv,Qf),tl(rd,Qf),tl(td,Qf);const $u={"_prelude_fog.vertex.glsl":os,"_prelude_terrain.vertex.glsl":Jm,"_prelude_shadow.vertex.glsl":eg,"_prelude_fog.fragment.glsl":Qm,"_prelude_shadow.fragment.glsl":tg,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Dt,"_prelude_raster_particle.glsl":jv},Ms={};Xr("",Jm),Xr(Qm,os),Xr(tg,eg),Xr(Dt,""),Xr(jv,"");const rg=Xr(td,rd),Uc=Iv;var ep={background:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Xr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Xr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Xr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Xr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Xr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Xr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Xr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Xr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Xr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Xr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Xr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Xr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Xr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Xr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Xr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Xr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Xr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Xr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ov),skyboxGradient:Xr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ov),skyboxCapture:Xr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Xr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Xr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Xr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Xr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Xr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Xr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Xr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Xr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function tl(m,a){const u=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of u)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=g.split(" ");for(const b of x)a.includes(b)||a.push(b)}}function Xr(m,a){const u=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=a.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(z=>{const F=z.split(" ");return F[F.length-1]}),x=[...new Set(x)]);const b={},E=[],P=[];if(m=m.replace(u,(z,F)=>(P.push(F),"")),(a=a.replace(u,(z,F)=>(E.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...Qf];tl(m,I),tl(a,I);for(const z of[...E,...P])$u[z]||console.error(`Undefined include: ${z}`),Ms[z]||(Ms[z]=[],tl($u[z],Ms[z])),I=[...I,...Ms[z]];return{fragmentSource:m=m.replace(g,(z,F,q,$,K)=>(b[K]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${K}
in ${q} ${$} ${K};
#else
uniform ${q} ${$} u_${K};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${K}
    ${q} ${$} ${K} = u_${K};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${q} ${$} ${K};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(g,(z,F,q,$,K)=>{const te=$==="float"?"vec2":$,ee=K.match(/color/)?"color":te;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${K}
in ${q} ${$} a_${K};
#endif
`:b[K]?F==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${q} ${te} a_${K};
out ${q} ${$} ${K};
#else
uniform ${q} ${$} u_${K};
#endif
`:F==="initialize"?ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${q} ${$} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${ee}(a_${K}, u_${K}_t);
#else
    ${q} ${$} ${K} = u_${K};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${q} ${$} a_${K};
    out ${q} ${$} ${K};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${K} = a_${K};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${q} ${te} a_${K};
#else
uniform ${q} ${$} u_${K};
#endif
`:F==="define-instanced"?ee==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${K}0;
in vec4 a_${K}1;
in vec4 a_${K}2;
in vec4 a_${K}3;
#else
uniform ${q} ${$} u_${K};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${q} ${te} a_${K};
#else
uniform ${q} ${$} u_${K};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${q} ${$} ${K} = a_${K};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${q} ${$} ${K} = a_${K};
#else
    ${q} ${$} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${q} ${$} ${K} = unpack_mix_${ee}(a_${K}, u_${K}_t);
#else
    ${q} ${$} ${K} = u_${K};
#endif
`}),staticAttributes:x,usedDefines:I,vertexIncludes:E,fragmentIncludes:P}}class PC{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,u,g,x,b,E,P,I){this.context=a;let z=this.boundPaintVertexBuffers.length!==x.length;for(let q=0;!z&&q<x.length;q++)this.boundPaintVertexBuffers[q]!==x[q]&&(z=!0);let F=this.boundDynamicVertexBuffers.length!==P.length;for(let q=0;!F&&q<P.length;q++)this.boundDynamicVertexBuffers[q]!==P[q]&&(F=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||z||F||this.boundIndexBuffer!==b||this.boundVertexOffset!==E)this.freshBind(u,g,x,b,E,P,I);else{a.bindVertexArrayOES.set(this.vao);for(const q of P)q&&(q.bind(),I&&q.instanceCount&&q.setVertexAttribDivisor(a.gl,u,I));b&&b.dynamicDraw&&b.bind()}}freshBind(a,u,g,x,b,E,P){const I=a.numAttributes,z=this.context,F=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=E,u.enableAttributes(F,a),u.bind(),u.setVertexAttribPointers(F,a,b);for(const q of g)q.enableAttributes(F,a),q.bind(),q.setVertexAttribPointers(F,a,b);for(const q of E)q&&(q.enableAttributes(F,a),q.bind(),q.setVertexAttribPointers(F,a,b),P&&q.instanceCount&&q.setVertexAttribDivisor(F,a,P));x&&x.bind(),z.currentNumAttributes=I}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Rv(m,a){const u=Math.pow(2,a.canonical.z),g=a.canonical.y;return[new o.ac(0,g/u).toLngLat().lat,new o.ac(0,(g+1)/u).toLngLat().lat]}function MC(m,a,u,g,x,b,E){const P=m.context,I=P.gl,z=u.hillshadeFBO;if(!z)return;m.prepareDrawTile();const F=m.isTileAffectedByFog(a),q=m.getOrCreateProgram("hillshade",{overrideFog:F});P.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,z.colorAttachment.get());const $=((re,ie,ue,pe)=>{const me=ue.paint.get("hillshade-shadow-color"),Te=ue.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",we=ue.paint.get("hillshade-highlight-color"),Pe=ue.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",be=ue.paint.get("hillshade-accent-color"),Se=ue.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ee=ue.paint.get("hillshade-emissive-strength");let Ve=o.al(ue.paint.get("hillshade-illumination-direction"));if(ue.paint.get("hillshade-illumination-anchor")==="viewport")Ve-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const dt=re.style.directionalLight.properties.get("direction"),Je=o.d1(dt.x,dt.y,dt.z);Ve=o.al(Je[1])}const De=!re.options.moving;return{u_matrix:pe||re.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),De),u_image:0,u_latrange:Rv(0,ie.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),Ve],u_shadow:me.toPremultipliedRenderColor(Te?null:ue.lut),u_highlight:we.toPremultipliedRenderColor(Pe?null:ue.lut),u_emissive_strength:Ee,u_accent:be.toPremultipliedRenderColor(Se?null:ue.lut)}})(m,u,g,m.terrain?a.projMatrix:null);m.uploadCommonUniforms(P,q,a.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:te,tileBoundsSegments:ee}=m.getTileBoundsBuffers(u);q.draw(m,I.TRIANGLES,x,b,E,ur.disabled,$,g.id,K,te,ee)}function Dv(m,a,u){if(!a.needsDEMTextureUpload)return;const g=m.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(u.stride);const b=u.getPixels();a.demTexture?a.demTexture.update(b,{premultiply:!1}):a.demTexture=new o.T(g,b,x.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function k1(m,a,u){const g=m.context,x=g.gl;if(!a.dem)return;const b=a.dem;if(g.activeTexture.set(x.TEXTURE1),Dv(m,a,b),!a.demTexture)return;a.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const E=b.dim;g.activeTexture.set(x.TEXTURE0);let P=a.hillshadeFBO;if(!P){const $=new o.T(g,{width:E,height:E,data:null},x.RGBA8);$.bind(x.LINEAR,x.CLAMP_TO_EDGE),P=a.hillshadeFBO=g.createFramebuffer(E,E,!0,"renderbuffer"),P.colorAttachment.set($.texture)}g.bindFramebuffer.set(P.framebuffer),g.viewport.set([0,0,E,E]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:z,tileBoundsSegments:F}=m.getMercatorTileBoundsBuffers(),q=[];m.linearFloatFilteringSupported()&&q.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:q}).draw(m,x.TRIANGLES,Ht.disabled,mr.disabled,Or.unblended,ur.disabled,(($,K)=>{const te=K.stride,ee=o.bz();return o.ca(ee,0,o.aj,-o.aj,0,0,1),o.bo(ee,ee,[0,-o.aj,0]),{u_matrix:ee,u_image:1,u_dimension:[te,te],u_zoom:$.overscaledZ}})(a.tileID,b),u.id,I,z,F),a.needsHillshadePrepare=!1}class li{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class IC extends li{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(a){const u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class OC extends li{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class jC extends li{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class RC extends li{getDefault(){return[!0,!0,!0,!0]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class C1 extends li{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class DC extends li{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class ng extends li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const u=this.current;(a.func!==u.func||a.ref!==u.ref||a.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class LC extends li{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class P1 extends li{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=a,this.dirty=!1}}class Lv extends li{getDefault(){return[0,1]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class ig extends li{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=a,this.dirty=!1}}class zv extends li{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Gu extends li{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.BLEND):u.disable(u.BLEND),this.current=a,this.dirty=!1}}class nd extends li{getDefault(){const a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class og extends li{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(a){const u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class ag extends li{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class id extends li{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=a,this.dirty=!1}}class M1 extends li{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Nv extends li{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let I1=class extends li{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class od extends li{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class sg extends li{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class lg extends li{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Fv extends li{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class cg extends li{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class tp extends li{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class O1 extends li{getDefault(){return null}set(a){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class j1 extends li{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class R1 extends li{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class ad extends li{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class D1 extends li{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Bv extends li{constructor(a,u){super(a),this.context=a,this.parent=u}getDefault(){return null}}class zC extends Bv{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class L1 extends Bv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Uv extends Bv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Vv extends L1{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const $v=(m,a,u)=>({u_matrix:m,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:u}),ug=(m,a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:x,u_merc_center:b,u_image0:0,u_frustum_tl:E,u_frustum_tr:P,u_frustum_br:I,u_frustum_bl:z,u_globe_pos:F,u_globe_radius:q,u_viewport:$,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:K,u_far_z_cutoff:te});function Gv(m,a){return m!=null&&a!=null&&!(!m.hasData()||!a.hasData())&&m.demTexture!=null&&a.demTexture!=null&&m.tileID.key!==a.tileID.key}const qu=new class{constructor(){this.operations={}}newMorphing(m,a,u,g,x){if(m in this.operations){const b=this.operations[m];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[m]={startTime:g,phase:0,duration:x,from:a,to:u,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const a=this.operations[m];return{from:a.from,to:a.to,phase:a.phase}}update(m){for(const a in this.operations){const u=this.operations[a];for(u.phase=(m-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,m)){delete this.operations[a];break}}}_nextOp(m,a){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=a,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},z1={0:null,1:"TERRAIN_VERTEX_MORPHING"};function sd(m,a,u){if(a===0)return 0;const g=a<1&&u===514?.25/a:1;return 6*Math.pow(1.5,22-m)*Math.max(a,1)*g}function rp(m,a){const u=1<<m.z;return!a&&(m.x===0||m.x===u-1)||m.y===0||m.y===u-1}const hg=m=>({u_matrix:m});function Ca(m,a,u,g,x){if(x>0){const b=o.q.now(),E=(b-m.timeAdded)/x,P=a?(b-a.timeAdded)/x:-1,I=u.getSource(),z=g.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),F=!a||Math.abs(a.tileID.overscaledZ-z)>Math.abs(m.tileID.overscaledZ-z),q=F&&m.refreshedUponExpiration?1:o.ay(F?E:1-P,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),a?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}class qv extends Aa{constructor(a){const u=Of("mock-dem",{type:"raster-dem",maxzoom:a.transform.maxZoom},a.style.dispatcher,a.style);super("mock-dem",u,!1),u.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,u){a.state="loaded",u(null)}}class dg extends Aa{constructor(a){const u=Of("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},a.style.dispatcher,a.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,u,g){if(a.freezeTileCoverage)return;this.transform=a;const x=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const P=new Du(E,this._source.tileSize*E.overscaleFactor(),a.tileZoom,void 0,void 0,this._source.worldview);P.state="loaded",this._tiles[E.key]=P}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(a){const u=this.proxyCachedFBO[a];if(u!==void 0){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class np extends o.aM{constructor(a,u,g){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class fg extends o.dF{constructor(a,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,b]=function(I){const z=new o.ba,F=new o.a_,q=131;z.reserve(17161),F.reserve(33800);const $=o.aj/128,K=o.aj+$/2,te=K+$;for(let re=-$;re<te;re+=$)for(let ie=-$;ie<te;ie+=$){const ue=ie<0||ie>K||re<0||re>K?24575:0,pe=o.ay(Math.round(ie),0,o.aj),me=o.ay(Math.round(re),0,o.aj);z.emplaceBack(pe+ue,me)}const ee=(re,ie)=>{const ue=ie*q+re;F.emplaceBack(ue+1,ue,ue+q),F.emplaceBack(ue+q,ue+q+1,ue+1)};for(let re=1;re<129;re++)for(let ie=1;ie<129;ie++)ee(ie,re);return[0,129].forEach(re=>{for(let ie=0;ie<130;ie++)ee(ie,re),ee(re,ie)}),[z,F,32768]}(),E=a.context;this.gridBuffer=E.createVertexBuffer(g,o.bc.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=o.bd.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new dg(u.map),this.orthoMatrix=o.bz(),o.ca(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const P=E.gl;this._overlapStencilMode=new mr({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new qv(u.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,u,g){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);const x=a.terrain.properties,b=a.terrain.drapeRenderMode===0,E=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const P=a.terrain&&a.terrain.scope,I=x.get("source"),z=b?this._mockSourceCache:a.getSourceCache(I,P);if(!z)return void o.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=z,this._attenuationRange=a.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(u):x.get("exaggeration"),!u.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const q=this.getScaledDemTileSize();this.sourceCache.update(u,q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),u.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(a){if(this._attenuationRange&&a.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(a.zoom);const u=this._previousCameraAltitude,g=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=g;const x=u!=null?g-u:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const b=a.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(b);let P=b-this._previousZoom;const I=this._previousUpdateTimestamp;let z=b;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(b-z)>.5&&(P=.5*(b-z+P)),P*x<0&&(z+=P)),this._evaluationZoom=z;const F=E.getExaggeration(z),q=F===E.getExaggeration(Math.max(0,z-.1));if(q&&Math.abs(F-this._exaggeration)<.01)return F;let $=Math.min(.1,.00375*(this._updateTimestamp-I));return(q||F<.1||Math.abs(P)<1e-4)&&($=Math.min(.2,4*$)),o.ai(this._exaggeration,F,$)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=u.getIds().map(I=>{const z=u.getTileByID(I).tileID;return z.projMatrix=g.calculateProjMatrix(z.toUnwrapped()),z});(function(I,z){const F=z.transform.pointCoordinate(z.transform.getCameraPoint()),q=new o.P(F.x,F.y);I.sort(($,K)=>{if(K.overscaledZ-$.overscaledZ)return K.overscaledZ-$.overscaledZ;const te=new o.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),ee=new o.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),re=q.mult(1<<$.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(te)-re.distSqr(ee)})})(x,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const I in E){const z=E[I];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,a[I],b),z.usedForTerrain))continue;const F=a[I];z.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[u.id]=x.map(I=>new np(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const z=this.terrainTileForTile[I.key];if(!z)continue;const F=z.tileID.key;F in P||(this._visibleDemTiles.push(z),P[F]=F)}}_assignTerrainTiles(a){this._initializing||a.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const a=this.painter.context,u=a.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(a.activeTexture.set(u.TEXTURE1),Dv(this.painter,x,b))}}_prepareDemTileUniforms(a,u,g,x){if(!u||u.demTexture==null)return!1;const b=a.tileID.canonical,E=Math.pow(2,u.tileID.canonical.z-b.z),P=x||"";return g[`u_dem_tl${P}`]=[b.x*E%1,b.y*E%1],g[`u_dem_scale${P}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let a=0;const u=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const b=x.dem.tree.minimums[0];return b>0&&a++,g+b},0);return a?u/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,u=a.gl;a.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),x=new o.dG({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new o.T(a,x,u.R32F,{premultiply:!1}),b}setupElevationDraw(a,u,g){const x=this.painter.context,b=x.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let P=null,I=null,z=1;if(g&&g.morphing&&this._useVertexMorphing){const K=g.morphing.srcDemTile,te=g.morphing.dstDemTile;z=g.morphing.phase,K&&te&&(this._prepareDemTileUniforms(a,K,E,"_prev")&&(I=K),this._prepareDemTileUniforms(a,te,E)&&(P=te))}const F=K=>K&&K.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let q=null;var $;if(this.enabled?I&&P?(q=P.demTexture,x.activeTexture.set(b.TEXTURE4),I.demTexture.bind(F(I),b.CLAMP_TO_EDGE),E.u_dem_lerp=z):(P=this.terrainTileForTile[a.tileID.key],q=this._prepareDemTileUniforms(a,P,E)?P.demTexture:this.emptyDEMTexture):q=this.emptyDEMTexture,x.activeTexture.set(b.TEXTURE2),q&&(E.u_dem_size=($=q).size[0]===1?1:$.size[0]-2,q.bind(F(P),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,u,E),g&&g.useMeterToDem&&P){const K=(1<<P.tileID.canonical.z)*o.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=K}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(x,E),this.painter.transform.projection.name==="globe"){const K=this.globeUniformValues(this.painter.transform,a.tileID.canonical,g&&g.useDenormalizedUpVectorScale);u.setGlobeUniformValues(x,K)}}globeUniformValues(a,u,g){const x=a.projection;return{u_tile_tl_up:x.upVector(u,0,0),u_tile_tr_up:x.upVector(u,o.aj,0),u_tile_br_up:x.upVector(u,o.aj,o.aj),u_tile_bl_up:x.upVector(u,0,o.aj),u_tile_up_scale:g?o.dH(1):x.upVectorScale(u,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const u=this.painter,g=this.painter.context;a.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,b,E,P,I){if(x.transform.projection.name==="globe")(function(z,F,q,$,K){const te=z.context,ee=te.gl;let re,ie;const ue=z.transform,pe=o.dy(z,te,ue),me=(dt,Je)=>{if(ie===Je)return;const pt=[z1[Je],"PROJECTION_GLOBE_VIEW"];pe&&pt.push("CUSTOM_ANTIALIASING");const Ct=z.isTileAffectedByFog(dt);re=z.getOrCreateProgram("globeRaster",{defines:pt,overrideFog:Ct}),ie=Je},Te=z.colorModeForRenderPass(),we=new Ht(ee.LEQUAL,Ht.ReadWrite,z.depthRangeFor3D);qu.update(K);const Pe=o.dz(ue),be=[o.aD(ue.center.lng),o.aH(ue.center.lat)],Se=z.globeSharedBuffers,Ee=[ue.width*o.q.devicePixelRatio,ue.height*o.q.devicePixelRatio],Ve=Float32Array.from(ue.globeMatrix),De={useDenormalizedUpVectorScale:!0};{const dt=z.transform,Je=sd(dt.zoom,F.exaggeration(),F.sourceCache._source.tileSize);ie=-1;const pt=ee.TRIANGLES;for(const Ct of $){const We=q.getTile(Ct),Re=mr.disabled,nt=F.prevTerrainTileForTile[Ct.key],Ze=F.terrainTileForTile[Ct.key];Gv(nt,Ze)&&qu.newMorphing(Ct.key,nt,Ze,K,250),te.activeTexture.set(ee.TEXTURE0),We.texture&&We.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const yt=qu.getMorphValuesForProxy(Ct.key),bt=yt?1:0;yt&&o.L(De,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:o.dx(yt.phase)}});const Et=o.dA(Ct.canonical),jt=o.dB(Et.getCenter().lat),tr=o.dC(Ct.canonical,Et,jt,dt.worldSize/dt._pixelsPerMercatorPixel),ir=o.bh(o.dD(Ct.canonical)),Zt=ug(dt.expandedFarZProjMatrix,Ve,Pe,ir,o.ah(dt.zoom),be,dt.frustumCorners.TL,dt.frustumCorners.TR,dt.frustumCorners.BR,dt.frustumCorners.BL,dt.globeCenterInViewSpace,dt.globeRadius,Ee,Je,dt._farZ,tr);if(me(Ct,bt),re&&(F.setupElevationDraw(We,re,De),z.uploadCommonUniforms(te,re,Ct.toUnwrapped()),Se)){const[er,nr,wr]=Se.getGridBuffers(jt,Je!==0);re.draw(z,pt,we,Re,Te,ur.backCCW,Zt,"globe_raster",er,nr,wr)}}}if(Se&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const dt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&dt.push("CUSTOM_ANTIALIASING"),re=z.getOrCreateProgram("globeRaster",{defines:dt});for(const Je of $){const{x:pt,y:Ct,z:We}=Je.canonical,Re=Ct===0,nt=Ct===(1<<We)-1,[Ze,yt,bt,Et]=Se.getPoleBuffers(We,!1);if(Et&&(Re||nt)){const jt=q.getTile(Je);te.activeTexture.set(ee.TEXTURE0),jt.texture&&jt.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);let tr=o.dE(We,pt,ue);const ir=o.bh(o.dD(Je.canonical)),Zt=(er,nr)=>er.draw(z,ee.TRIANGLES,we,mr.disabled,Te,ur.disabled,ug(ue.expandedFarZProjMatrix,tr,tr,ir,0,be,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,Ee,0,ue._farZ),"globe_pole_raster",nr,bt,Et);F.setupElevationDraw(jt,re,De),z.uploadCommonUniforms(te,re,Je.toUnwrapped()),Re&&z.renderDefaultNorthPole&&Zt(re,Ze),nt&&z.renderDefaultSouthPole&&(tr=o.cP(o.bz(),tr,[1,-1,1]),Zt(re,yt))}}}})(x,b,E,P,I);else{const z=x.context,F=z.gl;let q,$;const K=x.shadowRenderer,te=yl(x,x.longestCutoffRange),ee=Te=>{if($===Te)return;const we=[];we.push(z1[Te]),te.shouldRenderCutoff&&we.push("RENDER_CUTOFF"),K&&(we.push("RENDER_SHADOWS","DEPTH_TEXTURE"),K.useNormalOffset&&we.push("NORMAL_OFFSET")),q=x.getOrCreateProgram("terrainRaster",{defines:we}),$=Te},re=x.colorModeForRenderPass(),ie=new Ht(F.LEQUAL,Ht.ReadWrite,x.depthRangeFor3D);qu.update(I);const ue=x.transform,pe=sd(ue.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let me=[0,0,0];if(K){const Te=x.style.directionalLight,we=x.style.ambientLight;Te&&we&&(me=Vu(x.style,Te,we))}{$=-1;const Te=F.TRIANGLES,[we,Pe]=[b.gridIndexBuffer,b.gridSegments];for(const be of P){const Se=E.getTile(be),Ee=mr.disabled,Ve=b.prevTerrainTileForTile[be.key],De=b.terrainTileForTile[be.key];Gv(Ve,De)&&qu.newMorphing(be.key,Ve,De,I,250),z.activeTexture.set(F.TEXTURE0),Se.texture&&Se.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const dt=qu.getMorphValuesForProxy(be.key),Je=dt?1:0;let pt;dt&&(pt={morphing:{srcDemTile:dt.from,dstDemTile:dt.to,phase:o.dx(dt.phase)}});const Ct=$v(be.projMatrix,rp(be.canonical,ue.renderWorldCopies)?pe/10:pe,me);if(ee(Je),!q)continue;b.setupElevationDraw(Se,q,pt);const We=be.toUnwrapped();K&&K.setupShadows(We,q),x.uploadCommonUniforms(z,q,We,null,te),q.draw(x,Te,ie,Ee,re,ur.backCCW,Ct,"terrain_raster",b.gridBuffer,we,Pe)}}}}(u,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),P=u.style.order,I=[];let z=0;for(const F of b){const q=x.getTileByID(F.proxyTileKey),$=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][a]:void 0,K=$!==void 0?x.renderCache[$]:this.pool[z++],te=$!==void 0;if(q.texture=K.tex,te&&!K.dirty){I.push(q.tileID);continue}let ee;g.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(g.clear({color:o.am.transparent,stencil:0}),K.dirty=!1);for(let re=E.start;re<=E.end;++re){const ie=u.style._mergedLayers[P[re]];if(ie.isHidden(u.transform.zoom))continue;const ue=u.style.getLayerSourceCache(ie),pe=ue?this.proxyToSource[F.key][ue.id]:[F];if(!pe)continue;const me=pe;g.viewport.set([0,0,K.fb.width,K.fb.height]),ee!==(ue?ue.id:null)&&(this._setupStencil(K,pe,ie,ue),ee=ue?ue.id:null),u.renderLayer(u,ue,ie,me)}if(this._drapedRenderBatches.length===0)for(const re of this._pendingGroundEffectLayers){const ie=u.style._mergedLayers[P[re]];if(ie.isHidden(u.transform.zoom))continue;const ue=u.style.getLayerSourceCache(ie),pe=ue?this.proxyToSource[F.key][ue.id]:[F];if(!pe)continue;const me=pe;g.viewport.set([0,0,K.fb.width,K.fb.height]),ee!==(ue?ue.id:null)&&(this._setupStencil(K,pe,ie,ue),ee=ue?ue.id:null),u.renderLayer(u,ue,ie,me)}this.renderedToTile?(K.dirty=!0,I.push(q.tileID)):te||--z,z===5&&(z=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),E.end+1}postRender(){}isLayerOrderingCorrect(a){const u=a.order.length;let g=-1,x=u;for(let b=0;b<u;++b)this._style.isLayerDraped(a._mergedLayers[a.order[b]])?g=Math.max(g,b):x=Math.min(x,b);return x>g}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{a=Math.min(a,u.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,u,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,P=1<<E.overscaledZ,{x:I,y:z}=E.canonical,F=I/P,q=(I+1)/P,$=z/P,K=(z+1)/P;return{minx:F,miny:$,maxx:q,maxy:K,t:b.dem.tree.raycastRoot(F,$,q,K,a,u,g),tile:b}});x.sort((b,E)=>(b.t!==null?b.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const b of x){if(b.t==null)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,a,u,g);if(E!=null)return E}return null}_createFBO(){const a=this.painter.context,u=a.gl,g=this.drapeBufferSize;a.activeTexture.set(u.TEXTURE0);const x=new o.T(a,{width:g[0],height:g[1],data:null},u.RGBA8);x.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=a.createFramebuffer(g[0],g[1],!0,null);return b.colorAttachment.set(x.texture),b.depthAttachment=new Vv(a,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const u=this._style._mergedLayers[a],g=u.isHidden(this.painter.transform.zoom);return u.type==="hillshade"||u.type==="custom"?!g&&u.shouldRedrape():!g&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const g of this._style.getSources())if(g instanceof If){a=!0;break}if(!a)return;const u={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],b=this._style.getLayerSourceCache(x);if(b&&!u[b.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof o.ab){u[b.id]=!0;for(const E of this.proxyCoords){const P=this.proxyToSource[E.key][b.id];if(P)for(const I of P)this._clearRenderCacheForTile(b.id,I)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof Mo){a=!0;break}if(!a)return;const u={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],b=this._style.getLayerSourceCache(x);if(!b||u[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const E=x.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const I=this.proxyToSource[P.key][b.id];if(I)for(const z of I){const F=Ca(b.getTile(z),b.findLoadedParent(z,0),b,this.painter.transform,E);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(b.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const a=this._style.order,u=a.length;if(u===0)return;const g=[];this._pendingGroundEffectLayers=[];let x,b=0,E=this._style._mergedLayers[a[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<u;)E=this._style._mergedLayers[a[b]];for(;b<u;++b){const P=this._style._mergedLayers[a[b]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?x===void 0&&(x=b):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),x!==void 0&&(g.push({start:x,end:b-1}),x=void 0)))}if(x!==void 0&&g.push({start:x,end:b-1}),g.length!==0){const P=g[g.length-1];this._pendingGroundEffectLayers.every(I=>I>P.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(a){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const E=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let P=0;P<E.length;++P){const I=Object.values(E[P]);u.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let E=g.length-1;E>=0;E--){const P=g[E];if(u.getTileByID(P.key),u.proxyCachedFBO[P.key]!==void 0){const I=a[P.key],z=this.proxyToSource[P.key];let F=0;for(const q in z){const $=z[q],K=I[q];if(!K||K.length!==$.length||$.some((te,ee)=>te!==K[ee]||x[q]&&x[q].hasOwnProperty(te.key))){F=-1;break}++F}for(const q in u.proxyCachedFBO[P.key])u.renderCache[u.proxyCachedFBO[P.key][q]].dirty=F<0||F!==Object.values(I).length}}const b=[...this._drapedRenderBatches];b.sort((E,P)=>P.end-P.start-(E.end-E.start));for(const E of b)for(const P of g){if(u.proxyCachedFBO[P.key])continue;let I=u.renderCachePool.pop();I===void 0&&u.renderCache.length<50&&(I=u.renderCache.length,u.renderCache.push(this._createFBO())),I!==void 0&&(u.proxyCachedFBO[P.key]={},u.proxyCachedFBO[P.key][E.start]=I,u.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(a,u,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let P;if(g.isTileClipped())P=u.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):mr.disabled}_renderTileClippingMasks(a,u){const g=this.painter,x=this.painter.context,b=x.gl;g._tileClippingMaskIDs={},x.setColorMode(Or.disabled),x.setDepthMode(Ht.disabled);const E=g.getOrCreateProgram("clippingMask");for(const P of a){const I=g._tileClippingMaskIDs[P.key]=--u;E.draw(g,b.TRIANGLES,Ht.disabled,new mr({func:b.ALWAYS,mask:0},I,255,b.KEEP,b.KEEP,b.REPLACE),Or.disabled,ur.disabled,hg(P.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(a){const u=this.painter.transform;if(a.x<0||a.x>u.width||a.y<0||a.y>u.height)return null;const g=[a.x,a.y,1,1];o.aA(g,g,u.pixelMatrixInverse),o.cH(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const x=u._camera.position,b=o.cb(1,u.center.lat),E=[x[0],x[1],x[2]/b,0],P=o.d7([],g.slice(0,3),E);o.au(P,P);const I=this.raycast(E,P,this._exaggeration);return I!==null&&I?(o.bE(E,E,P,I),E[3]=E[2],E[2]*=b,E):null}_setupProxiedCoordsForOrtho(a,u,g){if(a.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(a,u,g);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const x=this.proxiedCoords[a.id]=[],b=this.proxyCoords;for(let I=0;I<b.length;I++){const z=b[I],F=this._findTileCoveringTileID(z,a);if(F){const q=this._createProxiedId(z,F,g[z.key]&&g[z.key][a.id]);x.push(q),this.proxyToSource[z.key][a.id]=[q]}}let E=!1;const P=new Set;for(let I=0;I<u.length;I++){const z=a.getTile(u[I]);if(!z||!z.hasData())continue;const F=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==z.tileID.canonical.z){const q=this.proxyToSource[F.tileID.key][a.id],$=this._createProxiedId(F.tileID,z,g[F.tileID.key]&&g[F.tileID.key][a.id]);q?q.splice(q.length-1,0,$):this.proxyToSource[F.tileID.key][a.id]=[$];const K=this.proxyToSource[F.tileID.key][a.id];P.has(K)||P.add(K),x.push($),E=!0}}if(this._sourceTilesOverlap[a.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const I of P)I.sort((z,F)=>F.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(a,u,g){if(!a.getSource().loaded())return;const x=this.proxiedCoords[a.id]=[],b=this.proxyCoords,E=a.getSource(),P=E.tileID;if(!P)return;const I=new o.P(P.x,P.y)._div(1<<P.z),z=E.coordinates.map(o.ac.fromLngLat).reduce((q,$)=>(q.min.x=Math.min(q.min.x,$.x-I.x),q.min.y=Math.min(q.min.y,$.y-I.y),q.max.x=Math.max(q.max.x,$.x-I.x),q.max.y=Math.max(q.max.y,$.y-I.y),q),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(q,$)=>{const K=q.wrap+q.canonical.x/(1<<q.canonical.z),te=q.canonical.y/(1<<q.canonical.z),ee=o.aj/(1<<q.canonical.z),re=$.wrap+$.canonical.x/(1<<$.canonical.z),ie=$.canonical.y/(1<<$.canonical.z);return K+ee<re+z.min.x||K>re+z.max.x||te+ee<ie+z.min.y||te>ie+z.max.y};for(let q=0;q<b.length;q++){const $=b[q];for(let K=0;K<u.length;K++){const te=a.getTile(u[K]);if(!te||!te.hasData()||F($,te.tileID))continue;const ee=this._createProxiedId($,te,g[$.key]&&g[$.key][a.id]),re=this.proxyToSource[$.key][a.id];re?re.push(ee):this.proxyToSource[$.key][a.id]=[ee],x.push(ee)}}}_createProxiedId(a,u,g){let x=this.orthoMatrix;if(g){const b=g.find(E=>E.key===u.tileID.key);if(b)return b}if(u.tileID.key!==a.key){const b=a.canonical.z-u.tileID.canonical.z;let E,P,I;x=o.bz();const z=u.tileID.wrap-a.wrap<<a.overscaledZ;b>0?(E=o.aj>>b,P=E*((u.tileID.canonical.x<<b)-a.canonical.x+z),I=E*((u.tileID.canonical.y<<b)-a.canonical.y)):(E=o.aj<<-b,P=o.aj*(u.tileID.canonical.x-(a.canonical.x+z<<-b)),I=o.aj*(u.tileID.canonical.y-(a.canonical.y<<-b))),o.ca(x,0,E,0,E,0,1),o.bo(x,x,[P,I,0])}return new np(u.tileID,a.key,x)}_findTileCoveringTileID(a,u){let g=u.getTile(a);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[u.id],b=x[a.key];if(g=b?u.getTileByID(b):null,g&&g.hasData()||b===null)return g;let E=g?g.tileID:a,P=E.overscaledZ;const I=u.getSource().minzoom,z=[];if(!b){const q=u.getSource().maxzoom;if(a.canonical.z>=q){const $=a.canonical.z-q;u.getSource().reparseOverscaled?(P=Math.max(a.canonical.z+2,u.transform.tileZoom),E=new o.aM(P,a.wrap,q,a.canonical.x>>$,a.canonical.y>>$)):$!==0&&(P=q,E=new o.aM(P,a.wrap,q,a.canonical.x>>$,a.canonical.y>>$))}E.key!==a.key&&(z.push(E.key),g=u.getTile(E))}const F=q=>{z.forEach($=>{x[$]=q}),z.length=0};for(P-=1;P>=I&&(!g||!g.hasData());P--){g&&F(g.tileID.key);const q=E.calculateScaledKey(P);if(g=u.getTileByID(q),g&&g.hasData())break;const $=x[q];if($===null)break;$===void 0?z.push(q):g=u.getTileByID($)}return F(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,u){let g=this._tilesDirty[a];g||(g=this._tilesDirty[a]={}),g[u.key]=!0}}function Hv(m,a,u){const g=function(P,I,z){const F=o.bG(I,P),q=o.bG(z,[.2126,.7152,.0722]),$=(te,ee,re)=>(1-re)*te+re*ee,K=$(1-.3*Math.min(q,1),1,Math.min(F+1,1));return $(.92,1,Math.asin(o.ay(I[2],-1,1))/Math.PI+.5)*K}(m,[0,0,1],a),x=[0,0,0];o.c1(x,u.slice(0,3),g);const b=[0,0,0];o.c1(b,a.slice(0,3),m[2]);const E=[0,0,0];return o.d5(E,x,b),o.d8(E)}const Wv=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],pg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class mg{static cacheKey(a,u,g,x){let b=`${u}${x?x.cacheKey:""}`;for(const E of g)a.usedDefines.includes(E)&&(b+=`/${E}`);return b}constructor(a,u,g,x,b,E){const P=a.gl;this.program=P.createProgram(),this.configuration=x,this.name=u,this.fixedDefines=[...E];const I=x?x.getBinderAttributes():[],z=(g.staticAttributes||[]).concat(I);let F=x?x.defines():[];F=F.concat(E.map(re=>`#define ${re}`));const q=`#version 300 es
`;let $=q+F.concat("precision mediump float;",Uc,rg.fragmentSource).join(`
`);for(const re of g.fragmentIncludes)$+=`
${$u[re]}`;$+=`
${g.fragmentSource}`;let K=q+F.concat("precision highp float;",Uc,rg.vertexSource).join(`
`);for(const re of g.vertexIncludes)K+=`
${$u[re]}`;this.forceManualRenderingForInstanceIDShaders=a.forceManualRenderingForInstanceIDShaders&&g.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(K+=`
uniform int u_instanceID;
`),K+=`
${g.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(K=K.replaceAll("gl_InstanceID","u_instanceID"));const te=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(te,$),P.compileShader(te),P.attachShader(this.program,te);const ee=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(ee,K),P.compileShader(ee),P.attachShader(this.program,ee),this.attributes={},this.numAttributes=z.length;for(let re=0;re<this.numAttributes;re++)if(z[re]){const ie=z[re].startsWith("a_")?z[re]:`a_${z[re]}`;P.bindAttribLocation(this.program,re,ie),this.attributes[ie]=re}P.linkProgram(this.program),P.deleteShader(ee),P.deleteShader(te),this.fixedUniforms=b(a),this.binderUniforms=x?x.getUniforms(a):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(re=>({u_instanceID:new o.cd(re)}))(a)),(E.includes("TERRAIN")||u.indexOf("symbol")!==-1||u.indexOf("circle")!==-1)&&(this.terrainUniforms=(re=>({u_dem:new o.cd(re),u_dem_prev:new o.cd(re),u_dem_tl:new o.cg(re),u_dem_scale:new o.cf(re),u_dem_tl_prev:new o.cg(re),u_dem_scale_prev:new o.cf(re),u_dem_size:new o.cf(re),u_dem_lerp:new o.cf(re),u_exaggeration:new o.cf(re),u_depth:new o.cd(re),u_depth_size_inv:new o.cg(re),u_depth_range_unpack:new o.cg(re),u_occluder_half_size:new o.cf(re),u_occlusion_depth_offset:new o.cf(re),u_meter_to_dem:new o.cf(re),u_label_plane_matrix_inv:new o.ch(re)}))(a)),E.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new o.ce(re),u_tile_tr_up:new o.ce(re),u_tile_br_up:new o.ce(re),u_tile_bl_up:new o.ce(re),u_tile_up_scale:new o.cf(re)}))(a)),E.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new o.ch(re),u_fog_range:new o.cg(re),u_fog_color:new o.d0(re),u_fog_horizon_blend:new o.cf(re),u_fog_vertical_limit:new o.cg(re),u_fog_temporal_offset:new o.cf(re),u_frustum_tl:new o.ce(re),u_frustum_tr:new o.ce(re),u_frustum_br:new o.ce(re),u_frustum_bl:new o.ce(re),u_globe_pos:new o.ce(re),u_globe_radius:new o.cf(re),u_globe_transition:new o.cf(re),u_is_globe:new o.cd(re),u_viewport:new o.cg(re)}))(a)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(re=>({u_cutoff_params:new o.d0(re)}))(a)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(re=>({u_lighting_ambient_color:new o.ce(re),u_lighting_directional_dir:new o.ce(re),u_lighting_directional_color:new o.ce(re),u_ground_radiance:new o.ce(re)}))(a)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(re=>({u_light_matrix_0:new o.ch(re),u_light_matrix_1:new o.ch(re),u_fade_range:new o.cg(re),u_shadow_normal_offset:new o.ce(re),u_shadow_intensity:new o.cf(re),u_shadow_texel_size:new o.cf(re),u_shadow_map_resolution:new o.cf(re),u_shadow_direction:new o.ce(re),u_shadow_bias:new o.ce(re),u_shadowmap_0:new o.cd(re),u_shadowmap_1:new o.cd(re)}))(a))}}setTerrainUniformValues(a,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const x in u)g[x]&&g[x].set(this.program,x,u[x])}}setGlobeUniformValues(a,u){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const x in u)g[x]&&g[x].set(this.program,x,u[x])}}setFogUniformValues(a,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}setCutoffUniformValues(a,u){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}setLightsUniformValues(a,u){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}setShadowUniformValues(a,u){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;a.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}_drawDebugWireframe(a,u,g,x,b,E,P,I,z,F){const q=a.options.wireframe;if(q.terrain===!1&&q.layers2D===!1&&q.layers3D===!1)return;const $=a.context;if(!(!(!q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!q.layers2D||a._terrain&&a._terrain.renderingToTexture||!Wv.includes(this.name))||!(!q.layers3D||!pg.includes(this.name))))return;const K=$.gl,te=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,b,$);if(!te)return;const ee=[...this.fixedDefines];ee.push("DEBUG_WIREFRAME");const re=a.getOrCreateProgram(this.name,{config:this.configuration,defines:ee});$.program.set(re.program);const ie=(me,Te,we)=>{if(Te[me]&&we[me])for(const Pe in Te[me])we[me][Pe]&&we[me][Pe].set(we.program,Pe,Te[me][Pe].current)};z&&z.setUniforms(re.program,$,re.binderUniforms,P,{zoom:I}),ie("fixedUniforms",this,re),ie("terrainUniforms",this,re),ie("globeUniforms",this,re),ie("fogUniforms",this,re),ie("lightsUniforms",this,re),ie("shadowUniforms",this,re),te.bind(),$.setColorMode(new Or([K.ONE,K.ONE_MINUS_SRC_ALPHA,K.ZERO,K.ONE],o.am.transparent,[!0,!0,!0,!1])),$.setDepthMode(new Ht(u.func===K.LESS?K.LEQUAL:u.func,Ht.ReadOnly,u.range)),$.setStencilMode(mr.disabled);const ue=3*E.primitiveLength*2,pe=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const me=F||1;for(let Te=0;Te<me;++Te)re.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),K.drawElements(K.LINES,ue,K.UNSIGNED_SHORT,pe)}else F&&F>1?K.drawElementsInstanced(K.LINES,ue,K.UNSIGNED_SHORT,pe,F):K.drawElements(K.LINES,ue,K.UNSIGNED_SHORT,pe);b.bind(),$.program.set(this.program),$.setDepthMode(u),$.setStencilMode(g),$.setColorMode(x)}checkUniforms(a,u,g){if(this.fixedDefines.includes(u)){for(const x of Object.keys(g))if(!g[x].initialized)throw new Error(`Program '${this.name}', from draw '${a}': uniform ${x} not set but required by ${u} being defined`)}}draw(a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re){const ie=a.context,ue=ie.gl;if(this.failedToCreate)return;ie.program.set(this.program),ie.setDepthMode(g),ie.setStencilMode(x),ie.setColorMode(b),ie.setCullFace(E);for(const Te of Object.keys(this.fixedUniforms))this.fixedUniforms[Te].set(this.program,Te,P[Te]);te&&te.setUniforms(this.program,ie,this.binderUniforms,$,{zoom:K});const pe={[ue.POINTS]:1,[ue.LINES]:2,[ue.TRIANGLES]:3,[ue.LINE_STRIP]:1}[u];this.checkUniforms(I,"RENDER_SHADOWS",this.shadowUniforms);const me=re&&re>0?1:void 0;for(const Te of q.get()){const we=Te.vaos||(Te.vaos={});if((we[I]||(we[I]=new PC)).bind(ie,this,z,te?te.getPaintVertexBuffers():[],F,Te.vertexOffset,ee||[],me),this.forceManualRenderingForInstanceIDShaders){const Pe=re||1;for(let be=0;be<Pe;++be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),F?ue.drawElements(u,Te.primitiveLength*pe,ue.UNSIGNED_SHORT,Te.primitiveOffset*pe*2):ue.drawArrays(u,Te.vertexOffset,Te.vertexLength)}else re&&re>1?ue.drawElementsInstanced(u,Te.primitiveLength*pe,ue.UNSIGNED_SHORT,Te.primitiveOffset*pe*2,re):F?ue.drawElements(u,Te.primitiveLength*pe,ue.UNSIGNED_SHORT,Te.primitiveOffset*pe*2):ue.drawArrays(u,Te.vertexOffset,Te.vertexLength);u===ue.TRIANGLES&&F&&this._drawDebugWireframe(a,g,x,b,F,Te,$,K,te,re)}}}function gg(m,a,u=0){const g=Math.pow(2,a.tileID.overscaledZ),x=a.tileSize*Math.pow(2,m.transform.tileZoom)/g,b=x*(a.tileID.canonical.x+a.tileID.wrap*g),E=x*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(a,1,m.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E],u_pattern_transition:u}}const Hu={terrain:0,flat:1},Zv=o.bz(),Kv=(m,a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re,ie)=>{const ue=a.style.light,pe=ue.properties.get("position"),me=[pe.x,pe.y,pe.z],Te=o.dJ();ue.properties.get("anchor")==="viewport"&&(o.dK(Te,-a.transform.angle),o.dL(me,me,Te));const we=ue.properties.get("color").toPremultipliedRenderColor(null),Pe=a.transform,be={u_matrix:m,u_lightpos:me,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[we.r,we.g,we.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zv,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Hu[z],u_base_type:Hu[F],u_ao:x,u_edge_radius:b,u_width_scale:E,u_flood_light_color:te,u_vertical_scale:ee,u_flood_light_intensity:re,u_ground_shadow_factor:ie};return Pe.projection.name==="globe"&&(be.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],be.u_zoom_transition=q,be.u_inv_rot_matrix=K,be.u_merc_center=$,be.u_up_dir=Pe.projection.upVector(new o.cA(0,0,0),$[0]*o.aj,$[1]*o.aj),be.u_height_lift=I),be},N1=(m,a,u,g,x,b)=>({u_matrix:m,u_edge_radius:a,u_width_scale:u,u_vertical_scale:g,u_height_type:Hu[x],u_base_type:Hu[b]}),ld=(m,a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re,ie)=>{const ue=Kv(m,a,u,g,x,b,E,P,z,F,q,$,K,te,ee,re,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,P.overscaledZ)/I.tileSize/8};return o.h(ue,gg(a,I,ie),pe)},F1=(m,a,u)=>({u_matrix:m,u_emissive_strength:a,u_ground_shadow_factor:u}),B1=(m,a,u,g,x,b=0)=>o.h(F1(m,a,x),gg(u,g,b)),NC=(m,a,u,g)=>({u_matrix:m,u_world:u,u_emissive_strength:a,u_ground_shadow_factor:g}),FC=(m,a,u,g,x,b,E=0)=>o.h(B1(m,a,u,g,b,E),{u_world:x}),BC=(m,a)=>({u_matrix:m,u_ground_shadow_factor:a}),yg=(m,a,u,g,x)=>({u_matrix:m,u_camera_pos:[a[0],a[1],a[2]],u_depth_bias:u,u_height_scale:g,u_reset_depth:x}),Xv=(m,a)=>({u_matrix:m,u_normal_matrix:a,u_opacity:1}),Yv=m=>({u_matrix:m}),U1=m=>({u_matrix:m}),cd=(m,a,u,g,x,b,E,P)=>{const I=o.aj/b.tileSize;return{u_matrix:m,u_inv_rot_matrix:a,u_camera_to_center_distance:u.getCameraToCenterDistance(P),u_extrude_scale:[u.pixelsToGLUnits[0]/I,u.pixelsToGLUnits[1]/I],u_zoom_transition:g,u_tile_id:E,u_merc_center:x}},Jv=(m,a,u=1)=>({u_matrix:m,u_color:a,u_overlay:0,u_overlay_scale:u}),V1=o.bz(),$1=(m,a,u,g,x,b,E)=>{const P=m.transform,I=P.projection.name==="globe",z=I?o.dM(P.zoom,a.canonical)*P._pixelsPerMercatorPixel:o.aw(u,1,b),F={u_matrix:a.projMatrix,u_extrude_scale:z,u_intensity:E,u_inv_rot_matrix:V1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){F.u_inv_rot_matrix=g,F.u_merc_center=x,F.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],F.u_zoom_transition=o.ah(P.zoom);const q=x[0]*o.aj,$=x[1]*o.aj;F.u_up_dir=P.projection.upVector(new o.cA(0,0,0),q,$)}return F};function _g(m,[a,u,g,x],[b,E]){if(b===E)return[0,0,0,0];const P=255*(m-1)/(m*(E-b));return[a*P,u*P,g*P,x*P]}function Vc(m,a,[u,g]){return u===g?0:.5/m+(a-u)*(m-1)/(m*(g-u))}const Qv=(m,a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re,ie,ue,pe,me)=>({u_matrix:m,u_normalize_matrix:a,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity*q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:q.paint.get("raster-brightness-min"),u_brightness_high:q.paint.get("raster-brightness-max"),u_saturation_factor:o.dO(q.paint.get("raster-saturation")),u_contrast_factor:o.dN(q.paint.get("raster-contrast")),u_spin_weights:$c(q.paint.get("raster-hue-rotate")),u_perspective_transform:$,u_raster_elevation:K,u_zoom_transition:E,u_merc_center:P,u_cutoff_params:I,u_colorization_mix:_g(o.dP,ee,ie),u_colorization_offset:Vc(o.dP,re,ie),u_color_ramp:te,u_texture_offset:[pe/(ue+2*pe),ue/(ue+2*pe)],u_texture_res:[ue+2*pe,ue+2*pe],u_emissive_strength:me});function $c(m){m*=Math.PI/180;const a=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*a-u+1)/3,(Math.sqrt(3)*a-u+1)/3]}const Gc=.05,vg=(m,a,u,g,x,b,E,P,I,z,F,q)=>({u_matrix:m,u_normalize_matrix:a,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:q,u_zoom_transition:E,u_merc_center:P,u_cutoff_params:I}),G1=(m,a,u,g,x,b,E,P,I,z)=>({u_particle_texture:m,u_particle_texture_side_len:a,u_tile_offset:u,u_velocity:g,u_color_ramp:b,u_velocity_res:x,u_max_speed:E,u_uv_offset:P,u_data_scale:[255*I[0],255*I[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Gc,Gc]}),q1=(m,a,u,g,x,b,E,P,I,z)=>({u_particle_texture:m,u_particle_texture_side_len:a,u_velocity:u,u_velocity_res:g,u_max_speed:x,u_speed_factor:b,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:P,u_data_scale:[255*I[0],255*I[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Gc,Gc]}),xg=o.bz(),bg=(m,a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re,ie,ue,pe,me,Te,we,Pe)=>{const be=x.transform,Se={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(ue),u_rotate_symbol:+u,u_aspect_ratio:be.width/be.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:P,u_is_text:+z,u_elevation_from_sea:I?1:0,u_pitch_with_map:+g,u_texsize:F,u_texsize_icon:q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xg,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xg,u_up_vector:[0,-1,0],u_color_adj_mat:Te,u_icon_transition:we||0,u_gamma_scale:g?x.transform.getCameraToCenterDistance(ue)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Pe||1,u_ground_shadow_factor:pe,u_inv_matrix:o.bi(o.bz(),E),u_normal_scale:me};return ue.name==="globe"&&(Se.u_tile_id=[K.canonical.x,K.canonical.y,1<<K.canonical.z],Se.u_zoom_transition=te,Se.u_inv_rot_matrix=re,Se.u_merc_center=ee,Se.u_camera_forward=be._camera.forward(),Se.u_ecef_origin=o.dQ(be.globeMatrix,K.toUnwrapped()),Se.u_tile_matrix=Float32Array.from(be.globeMatrix),Se.u_up_vector=ie),Se},H1=(m,a,u,g)=>({u_matrix:m,u_emissive_strength:a,u_opacity:u,u_color:g}),e0=(m,a,u,g,x,b,E,P,I)=>o.h(function(z,F,q,$,K,te){const{width:ee,height:re}=$.imageManager.getPixelSize(F),ie=Math.pow(2,te.tileID.overscaledZ),ue=te.tileSize*Math.pow(2,$.transform.tileZoom)/ie,pe=ue*(te.tileID.canonical.x+te.tileID.wrap*ie),me=ue*te.tileID.canonical.y;return{u_image:0,u_pattern_tl:q.tl,u_pattern_br:q.br,u_texsize:[ee,re],u_pattern_size:q.displaySize,u_pattern_units_to_pixels:K?[$.transform.width,-1*$.transform.height]:[1/o.aw(te,1,$.transform.tileZoom),1/o.aw(te,1,$.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,me>>16],u_pixel_coord_lower:[65535&pe,65535&me]}}(0,b,E,g,P,I),{u_matrix:m,u_emissive_strength:a,u_opacity:u}),Wu=new Float32Array(o.bx([])),t0=(m,a,u,g,x,b,E,P,I,z,F,q,$,K=[0,0,0],te)=>{const ee=x.style.light,re=ee.properties.get("position"),ie=[-re.x,-re.y,re.z],ue=o.dJ();ee.properties.get("anchor")==="viewport"&&(o.dK(ue,-x.transform.angle),o.dL(ie,ie,ue));const pe=F.alphaMode==="MASK",me=ee.properties.get("color").toNonPremultipliedRenderColor(null),Te=$.paint.get("model-ambient-occlusion-intensity"),we=$.paint.get("model-color").constantOr(o.am.white).toNonPremultipliedRenderColor(null);return we.a=$.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:m,u_lighting_matrix:a,u_normal_matrix:u,u_node_matrix:g||Wu,u_lightpos:ie,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_camera_pos:K,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:P.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:I,u_roughnessFactor:z,u_baseColorTexture:ua.BaseColor,u_metallicRoughnessTexture:ua.MetallicRoughness,u_normalTexture:ua.Normal,u_occlusionTexture:ua.Occlusion,u_emissionTexture:ua.Emission,u_lutTexture:ua.LUT,u_color_mix:we.toArray01(),u_aoIntensity:Te,u_emissive_strength:q,u_occlusionTextureTransform:te||[0,0,0,0]}},W1=(m,a=Wu,u=Wu)=>({u_matrix:m,u_instance:a,u_node_matrix:u}),Z1={fillExtrusion:m=>({u_matrix:new o.ch(m),u_lightpos:new o.ce(m),u_lightintensity:new o.cf(m),u_lightcolor:new o.ce(m),u_vertical_gradient:new o.cf(m),u_opacity:new o.cf(m),u_edge_radius:new o.cf(m),u_width_scale:new o.cf(m),u_ao:new o.cg(m),u_height_type:new o.cd(m),u_base_type:new o.cd(m),u_tile_id:new o.ce(m),u_zoom_transition:new o.cf(m),u_inv_rot_matrix:new o.ch(m),u_merc_center:new o.cg(m),u_up_dir:new o.ce(m),u_height_lift:new o.cf(m),u_flood_light_color:new o.ce(m),u_vertical_scale:new o.cf(m),u_flood_light_intensity:new o.cf(m),u_ground_shadow_factor:new o.ce(m)}),fillExtrusionDepth:m=>({u_matrix:new o.ch(m),u_edge_radius:new o.cf(m),u_width_scale:new o.cf(m),u_vertical_scale:new o.cf(m),u_height_type:new o.cd(m),u_base_type:new o.cd(m)}),fillExtrusionPattern:m=>({u_matrix:new o.ch(m),u_lightpos:new o.ce(m),u_lightintensity:new o.cf(m),u_lightcolor:new o.ce(m),u_vertical_gradient:new o.cf(m),u_height_factor:new o.cf(m),u_edge_radius:new o.cf(m),u_width_scale:new o.cf(m),u_ao:new o.cg(m),u_height_type:new o.cd(m),u_base_type:new o.cd(m),u_tile_id:new o.ce(m),u_zoom_transition:new o.cf(m),u_inv_rot_matrix:new o.ch(m),u_merc_center:new o.cg(m),u_up_dir:new o.ce(m),u_height_lift:new o.cf(m),u_image:new o.cd(m),u_texsize:new o.cg(m),u_pixel_coord_upper:new o.cg(m),u_pixel_coord_lower:new o.cg(m),u_tile_units_to_pixels:new o.cf(m),u_opacity:new o.cf(m),u_pattern_transition:new o.cf(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new o.ch(m),u_opacity:new o.cf(m),u_ao_pass:new o.cf(m),u_meter_to_tile:new o.cf(m),u_ao:new o.cg(m),u_flood_light_intensity:new o.cf(m),u_flood_light_color:new o.ce(m),u_attenuation:new o.cf(m),u_edge_radius:new o.cf(m),u_fb:new o.cd(m),u_fb_size:new o.cf(m),u_dynamic_offset:new o.cf(m)}),fill:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_ground_shadow_factor:new o.ce(m)}),fillPattern:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_image:new o.cd(m),u_texsize:new o.cg(m),u_pixel_coord_upper:new o.cg(m),u_pixel_coord_lower:new o.cg(m),u_tile_units_to_pixels:new o.cf(m),u_ground_shadow_factor:new o.ce(m),u_pattern_transition:new o.cf(m)}),fillOutline:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_world:new o.cg(m),u_ground_shadow_factor:new o.ce(m)}),fillOutlinePattern:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_world:new o.cg(m),u_image:new o.cd(m),u_texsize:new o.cg(m),u_pixel_coord_upper:new o.cg(m),u_pixel_coord_lower:new o.cg(m),u_tile_units_to_pixels:new o.cf(m),u_ground_shadow_factor:new o.ce(m),u_pattern_transition:new o.cf(m)}),building:m=>({u_matrix:new o.ch(m),u_normal_matrix:new o.ch(m),u_opacity:new o.cf(m)}),buildingBloom:m=>({u_matrix:new o.ch(m)}),buildingDepth:m=>({u_matrix:new o.ch(m)}),elevatedStructuresDepth:m=>({u_matrix:new o.ch(m),u_depth_bias:new o.cf(m)}),elevatedStructures:m=>({u_matrix:new o.ch(m),u_ground_shadow_factor:new o.ce(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new o.ch(m),u_camera_pos:new o.ce(m),u_depth_bias:new o.cf(m),u_height_scale:new o.cf(m),u_reset_depth:new o.cf(m)}),circle:o.dT,collisionBox:m=>({u_matrix:new o.ch(m),u_inv_rot_matrix:new o.ch(m),u_camera_to_center_distance:new o.cf(m),u_extrude_scale:new o.cg(m),u_zoom_transition:new o.cf(m),u_merc_center:new o.cg(m),u_tile_id:new o.ce(m)}),collisionCircle:m=>({u_matrix:new o.ch(m),u_inv_matrix:new o.ch(m),u_camera_to_center_distance:new o.cf(m),u_viewport_size:new o.cg(m)}),debug:m=>({u_color:new o.dv(m),u_matrix:new o.ch(m),u_overlay:new o.cd(m),u_overlay_scale:new o.cf(m)}),clippingMask:m=>({u_matrix:new o.ch(m)}),heatmap:m=>({u_extrude_scale:new o.cf(m),u_intensity:new o.cf(m),u_matrix:new o.ch(m),u_inv_rot_matrix:new o.ch(m),u_merc_center:new o.cg(m),u_tile_id:new o.ce(m),u_zoom_transition:new o.cf(m),u_up_dir:new o.ce(m)}),heatmapTexture:m=>({u_image:new o.cd(m),u_color_ramp:new o.cd(m),u_opacity:new o.cf(m)}),hillshade:m=>({u_matrix:new o.ch(m),u_image:new o.cd(m),u_latrange:new o.cg(m),u_light:new o.cg(m),u_shadow:new o.dv(m),u_highlight:new o.dv(m),u_emissive_strength:new o.cf(m),u_accent:new o.dv(m)}),hillshadePrepare:m=>({u_matrix:new o.ch(m),u_image:new o.cd(m),u_dimension:new o.cg(m),u_zoom:new o.cf(m)}),line:o.dS,linePattern:o.dR,raster:m=>({u_matrix:new o.ch(m),u_normalize_matrix:new o.ch(m),u_globe_matrix:new o.ch(m),u_merc_matrix:new o.ch(m),u_grid_matrix:new o.dw(m),u_tl_parent:new o.cg(m),u_scale_parent:new o.cf(m),u_fade_t:new o.cf(m),u_opacity:new o.cf(m),u_image0:new o.cd(m),u_image1:new o.cd(m),u_brightness_low:new o.cf(m),u_brightness_high:new o.cf(m),u_saturation_factor:new o.cf(m),u_contrast_factor:new o.cf(m),u_spin_weights:new o.ce(m),u_perspective_transform:new o.cg(m),u_raster_elevation:new o.cf(m),u_zoom_transition:new o.cf(m),u_merc_center:new o.cg(m),u_cutoff_params:new o.d0(m),u_colorization_mix:new o.d0(m),u_colorization_offset:new o.cf(m),u_color_ramp:new o.cd(m),u_texture_offset:new o.cg(m),u_texture_res:new o.cg(m),u_emissive_strength:new o.cf(m)}),rasterParticle:m=>({u_matrix:new o.ch(m),u_normalize_matrix:new o.ch(m),u_globe_matrix:new o.ch(m),u_merc_matrix:new o.ch(m),u_grid_matrix:new o.dw(m),u_tl_parent:new o.cg(m),u_scale_parent:new o.cf(m),u_fade_t:new o.cf(m),u_opacity:new o.cf(m),u_image0:new o.cd(m),u_image1:new o.cd(m),u_raster_elevation:new o.cf(m),u_zoom_transition:new o.cf(m),u_merc_center:new o.cg(m),u_cutoff_params:new o.d0(m)}),rasterParticleTexture:m=>({u_texture:new o.cd(m),u_opacity:new o.cf(m)}),rasterParticleDraw:m=>({u_particle_texture:new o.cd(m),u_particle_texture_side_len:new o.cf(m),u_tile_offset:new o.cg(m),u_velocity:new o.cd(m),u_color_ramp:new o.cd(m),u_velocity_res:new o.cg(m),u_max_speed:new o.cf(m),u_uv_offset:new o.cg(m),u_data_scale:new o.cg(m),u_data_offset:new o.cf(m),u_particle_pos_scale:new o.cf(m),u_particle_pos_offset:new o.cg(m)}),rasterParticleUpdate:m=>({u_particle_texture:new o.cd(m),u_particle_texture_side_len:new o.cf(m),u_velocity:new o.cd(m),u_velocity_res:new o.cg(m),u_max_speed:new o.cf(m),u_speed_factor:new o.cf(m),u_reset_rate:new o.cf(m),u_rand_seed:new o.cf(m),u_uv_offset:new o.cg(m),u_data_scale:new o.cg(m),u_data_offset:new o.cf(m),u_particle_pos_scale:new o.cf(m),u_particle_pos_offset:new o.cg(m)}),symbol:m=>({u_is_size_zoom_constant:new o.cd(m),u_is_size_feature_constant:new o.cd(m),u_size_t:new o.cf(m),u_size:new o.cf(m),u_camera_to_center_distance:new o.cf(m),u_rotate_symbol:new o.cd(m),u_aspect_ratio:new o.cf(m),u_fade_change:new o.cf(m),u_matrix:new o.ch(m),u_label_plane_matrix:new o.ch(m),u_coord_matrix:new o.ch(m),u_is_text:new o.cd(m),u_elevation_from_sea:new o.cd(m),u_pitch_with_map:new o.cd(m),u_texsize:new o.cg(m),u_texsize_icon:new o.cg(m),u_texture:new o.cd(m),u_texture_icon:new o.cd(m),u_gamma_scale:new o.cf(m),u_device_pixel_ratio:new o.cf(m),u_tile_id:new o.ce(m),u_zoom_transition:new o.cf(m),u_inv_rot_matrix:new o.ch(m),u_merc_center:new o.cg(m),u_camera_forward:new o.ce(m),u_tile_matrix:new o.ch(m),u_up_vector:new o.ce(m),u_ecef_origin:new o.ce(m),u_is_halo:new o.cd(m),u_icon_transition:new o.cf(m),u_color_adj_mat:new o.ch(m),u_scale_factor:new o.cf(m),u_ground_shadow_factor:new o.ce(m),u_inv_matrix:new o.ch(m),u_normal_scale:new o.cf(m)}),background:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_opacity:new o.cf(m),u_color:new o.dv(m)}),backgroundPattern:m=>({u_matrix:new o.ch(m),u_emissive_strength:new o.cf(m),u_opacity:new o.cf(m),u_image:new o.cd(m),u_pattern_tl:new o.cg(m),u_pattern_br:new o.cg(m),u_texsize:new o.cg(m),u_pattern_size:new o.cg(m),u_pixel_coord_upper:new o.cg(m),u_pixel_coord_lower:new o.cg(m),u_pattern_units_to_pixels:new o.cg(m)}),terrainRaster:m=>({u_matrix:new o.ch(m),u_image0:new o.cd(m),u_skirt_height:new o.cf(m),u_ground_shadow_factor:new o.ce(m)}),skybox:m=>({u_matrix:new o.ch(m),u_sun_direction:new o.ce(m),u_cubemap:new o.cd(m),u_opacity:new o.cf(m),u_temporal_offset:new o.cf(m)}),skyboxGradient:m=>({u_matrix:new o.ch(m),u_color_ramp:new o.cd(m),u_center_direction:new o.ce(m),u_radius:new o.cf(m),u_opacity:new o.cf(m),u_temporal_offset:new o.cf(m)}),skyboxCapture:m=>({u_matrix_3f:new o.dw(m),u_sun_direction:new o.ce(m),u_sun_intensity:new o.cf(m),u_color_tint_r:new o.d0(m),u_color_tint_m:new o.d0(m),u_luminance:new o.cf(m)}),globeRaster:m=>({u_proj_matrix:new o.ch(m),u_globe_matrix:new o.ch(m),u_normalize_matrix:new o.ch(m),u_merc_matrix:new o.ch(m),u_zoom_transition:new o.cf(m),u_merc_center:new o.cg(m),u_image0:new o.cd(m),u_grid_matrix:new o.dw(m),u_skirt_height:new o.cf(m),u_far_z_cutoff:new o.cf(m),u_frustum_tl:new o.ce(m),u_frustum_tr:new o.ce(m),u_frustum_br:new o.ce(m),u_frustum_bl:new o.ce(m),u_globe_pos:new o.ce(m),u_globe_radius:new o.cf(m),u_viewport:new o.cg(m)}),globeAtmosphere:m=>({u_frustum_tl:new o.ce(m),u_frustum_tr:new o.ce(m),u_frustum_br:new o.ce(m),u_frustum_bl:new o.ce(m),u_horizon:new o.cf(m),u_transition:new o.cf(m),u_fadeout_range:new o.cf(m),u_color:new o.d0(m),u_high_color:new o.d0(m),u_space_color:new o.d0(m),u_temporal_offset:new o.cf(m),u_horizon_angle:new o.cf(m)}),model:m=>({u_matrix:new o.ch(m),u_lighting_matrix:new o.ch(m),u_normal_matrix:new o.ch(m),u_node_matrix:new o.ch(m),u_lightpos:new o.ce(m),u_lightintensity:new o.cf(m),u_lightcolor:new o.ce(m),u_camera_pos:new o.ce(m),u_opacity:new o.cf(m),u_baseColorFactor:new o.d0(m),u_emissiveFactor:new o.d0(m),u_metallicFactor:new o.cf(m),u_roughnessFactor:new o.cf(m),u_baseTextureIsAlpha:new o.cd(m),u_alphaMask:new o.cd(m),u_alphaCutoff:new o.cf(m),u_baseColorTexture:new o.cd(m),u_metallicRoughnessTexture:new o.cd(m),u_normalTexture:new o.cd(m),u_occlusionTexture:new o.cd(m),u_emissionTexture:new o.cd(m),u_lutTexture:new o.cd(m),u_color_mix:new o.d0(m),u_aoIntensity:new o.cf(m),u_emissive_strength:new o.cf(m),u_occlusionTextureTransform:new o.d0(m)}),modelDepth:m=>({u_matrix:new o.ch(m),u_instance:new o.ch(m),u_node_matrix:new o.ch(m)}),groundShadow:m=>({u_matrix:new o.ch(m),u_ground_shadow_factor:new o.ce(m)}),stars:m=>({u_matrix:new o.ch(m),u_up:new o.ce(m),u_right:new o.ce(m),u_intensity_multiplier:new o.cf(m)}),snowParticle:m=>({u_modelview:new o.ch(m),u_projection:new o.ch(m),u_time:new o.cf(m),u_cam_pos:new o.ce(m),u_velocityConeAperture:new o.cf(m),u_velocity:new o.cf(m),u_horizontalOscillationRadius:new o.cf(m),u_horizontalOscillationRate:new o.cf(m),u_boxSize:new o.cf(m),u_billboardSize:new o.cf(m),u_simpleShapeParameters:new o.cg(m),u_screenSize:new o.cg(m),u_thinningCenterPos:new o.cg(m),u_thinningShape:new o.ce(m),u_thinningAffectedRatio:new o.cf(m),u_thinningParticleOffset:new o.cf(m),u_particleColor:new o.d0(m),u_direction:new o.ce(m)}),rainParticle:m=>({u_modelview:new o.ch(m),u_projection:new o.ch(m),u_time:new o.cf(m),u_cam_pos:new o.ce(m),u_texScreen:new o.cd(m),u_velocityConeAperture:new o.cf(m),u_velocity:new o.cf(m),u_boxSize:new o.cf(m),u_rainDropletSize:new o.cg(m),u_distortionStrength:new o.cf(m),u_rainDirection:new o.ce(m),u_color:new o.d0(m),u_screenSize:new o.cg(m),u_thinningCenterPos:new o.cg(m),u_thinningShape:new o.ce(m),u_thinningAffectedRatio:new o.cf(m),u_thinningParticleOffset:new o.cf(m),u_shapeDirectionalPower:new o.cf(m),u_shapeNormalPower:new o.cf(m),u_mode:new o.cf(m)}),vignette:m=>({u_vignetteShape:new o.ce(m),u_vignetteColor:new o.d0(m)}),occlusion:m=>({u_matrix:new o.ch(m),u_anchorPos:new o.ce(m),u_screenSizePx:new o.cg(m),u_occluderSizePx:new o.cg(m),u_color:new o.d0(m)})};class qc{constructor(a,u,g,x){this.id=qc.uniqueIdxCounter,qc.uniqueIdxCounter++,this.context=a;const b=a.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||x||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=qc.uniqueIdxCounter,qc.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}qc.uniqueIdxCounter=0;const r0={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class n0{constructor(a,u,g,x,b,E){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=x,this.instanceCount=E,this.context=a;const P=a.gl;this.buffer=P.createBuffer(),a.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||b||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,u){for(let g=0;g<this.attributes.length;g++){const x=u.attributes[this.attributes[g].name];x!==void 0&&a.enableVertexAttribArray(x)}}setVertexAttribPointers(a,u,g){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],E=u.attributes[b.name];E!==void 0&&a.vertexAttribPointer(E,b.components,a[r0[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(a,u,g){for(let x=0;x<this.attributes.length;x++){const b=u.attributes[this.attributes[x].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(b,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Zu{constructor(a,u,g,x,b){this.context=a,this.width=u,this.height=g;const E=this.framebuffer=a.gl.createFramebuffer();x&&(this.colorAttachment=new zC(a,E)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new L1(a,E):new Uv(a,E))}destroy(){const a=this.context.gl;if(this.colorAttachment){const u=this.colorAttachment.get();u&&a.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&a.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&a.deleteTexture(u)}a.deleteFramebuffer(this.framebuffer)}}class wg{constructor(a,u){this.gl=a,this.clearColor=new IC(this),this.clearDepth=new OC(this),this.clearStencil=new jC(this),this.colorMask=new RC(this),this.depthMask=new C1(this),this.stencilMask=new DC(this),this.stencilFunc=new ng(this),this.stencilOp=new LC(this),this.stencilTest=new P1(this),this.depthRange=new Lv(this),this.depthTest=new ig(this),this.depthFunc=new zv(this),this.blend=new Gu(this),this.blendFunc=new nd(this),this.blendColor=new og(this),this.blendEquation=new ag(this),this.cullFace=new id(this),this.cullFaceSide=new M1(this),this.frontFace=new Nv(this),this.program=new I1(this),this.activeTexture=new od(this),this.viewport=new sg(this),this.bindFramebuffer=new lg(this),this.bindRenderbuffer=new Fv(this),this.bindTexture=new cg(this),this.bindVertexBuffer=new tp(this),this.bindElementBuffer=new O1(this),this.bindVertexArrayOES=new j1(this),this.pixelStoreUnpack=new R1(this),this.pixelStoreUnpackPremultiplyAlpha=new ad(this),this.pixelStoreUnpackFlipY=new D1(this),this.options=u?Object.assign({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=u&&!!u.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,u,g){return new qc(this,a,u,g)}createVertexBuffer(a,u,g,x,b){return new n0(this,a,u,g,x,b)}createRenderbuffer(a,u,g){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,a,u,g),this.bindRenderbuffer.set(null),b}createFramebuffer(a,u,g,x){return new Zu(this,a,u,g,x)}clear({color:a,depth:u,stencil:g,colorMask:x}){const b=this.gl;let E=0;a&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(a.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),u!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),g!==void 0&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),b.clear(E)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){o.bv(a.blendFunction,Or.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Hc;function i0(m,a,u,g,x,b,E){const P=m.context,I=P.gl,z=m.transform,F=[o.aD(z.center.lng),o.aH(z.center.lat)],q=u.layout.get("symbol-placement"),$=u.layout.get("text-variable-anchor"),K=u.layout.get("icon-rotation-alignment")==="map",te=u.layout.get("text-rotation-alignment")==="map",ee=q!=="point",re=[];let ie=0,ue=0;for(let Se=0;Se<g.length;Se++){const Ee=g[Se],Ve=a.getTile(Ee),De=Ve.getBucket(u);if(!De)continue;const dt=De.getProjection().createInversionMatrix(z,Ee.canonical),Je=[],pt=m1(Ee,De,z),Ct=!E&&K&&ee,We=E&&te&&ee,Re=$&&De.hasTextData(),nt=De.hasIconTextFit()&&Re&&De.hasIconData(),Ze=Ct||We||E&&Re||nt,yt=De.projection.name==="globe",bt=yt?o.ah(z.zoom):0;yt&&(Je.push("PROJECTION_GLOBE_VIEW"),Ze&&Je.push("PROJECTED_POS_ON_VIEWPORT"));const Et=m.getOrCreateProgram("collisionBox",{defines:Je});let jt=pt;x[0]===0&&x[1]===0||(jt=m.translatePosMatrix(pt,Ve,x,b));const tr=E?De.textCollisionBox:De.iconCollisionBox,ir=De.collisionCircleArray;if(ir.length>0){const er=o.bz(),nr=jt;o.cM(er,De.placementInvProjMatrix,z.glCoordMatrix),o.cM(er,er,De.placementViewportMatrix),re.push({circleArray:ir,circleOffset:ue,transform:nr,invTransform:er,projection:De.getProjection()}),ie+=ir.length/4,ue=ie}if(!tr)continue;m.terrain&&m.terrain.setupElevationDraw(Ve,Et);const Zt=yt?[Ee.canonical.x,Ee.canonical.y,1<<Ee.canonical.z]:[0,0,0];Et.draw(m,I.LINES,Ht.disabled,mr.disabled,m.colorModeForRenderPass(),ur.disabled,cd(jt,dt,z,bt,F,Ve,Zt,De.getProjection()),u.id,tr.layoutVertexBuffer,tr.indexBuffer,tr.segments,null,z.zoom,null,[tr.collisionVertexBuffer,tr.collisionVertexBufferExt])}if(!E||!re.length)return;const pe=m.getOrCreateProgram("collisionCircle"),me=new o.dU;me.resize(4*ie),me._trim();let Te=0;for(const Se of re)for(let Ee=0;Ee<Se.circleArray.length/4;Ee++){const Ve=4*Ee,De=Se.circleArray[Ve+0],dt=Se.circleArray[Ve+1],Je=Se.circleArray[Ve+2],pt=Se.circleArray[Ve+3];me.emplace(Te++,De,dt,Je,pt,0),me.emplace(Te++,De,dt,Je,pt,1),me.emplace(Te++,De,dt,Je,pt,2),me.emplace(Te++,De,dt,Je,pt,3)}(!Hc||Hc.length<2*ie)&&(Hc=function(Se){const Ee=2*Se,Ve=new o.a_;Ve.resize(Ee),Ve._trim();for(let De=0;De<Ee;De++){const dt=6*De;Ve.uint16[dt+0]=4*De+0,Ve.uint16[dt+1]=4*De+1,Ve.uint16[dt+2]=4*De+2,Ve.uint16[dt+3]=4*De+2,Ve.uint16[dt+4]=4*De+3,Ve.uint16[dt+5]=4*De+0}return Ve}(ie));const we=P.createIndexBuffer(Hc,!0),Pe=P.createVertexBuffer(me,o.dV.members,!0);for(const Se of re){const Ee={u_matrix:Se.transform,u_inv_matrix:Se.invTransform,u_camera_to_center_distance:(be=z).getCameraToCenterDistance(Se.projection),u_viewport_size:[be.width,be.height]};pe.draw(m,I.TRIANGLES,Ht.disabled,mr.disabled,m.colorModeForRenderPass(),ur.disabled,Ee,u.id,Pe,we,o.bd.simpleSegment(0,2*Se.circleOffset,Se.circleArray.length,Se.circleArray.length/2),null,z.zoom)}var be;Pe.destroy(),we.destroy()}const Ku=o.bz();function ip(m){const a=m._camera.getWorldToCamera(m.worldSize,1),u=o.az([],a,m.globeMatrix);o.bi(u,u);const g=[0,0,0],x=[0,1,0,0];return o.aA(x,x,u),g[0]=x[0],g[1]=x[1],g[2]=x[2],o.au(g,g),g}function o0({width:m,height:a,anchor:u,textOffset:g,textScale:x},b){const{horizontalAlign:E,verticalAlign:P}=o.bZ(u),I=-(E-.5)*m,z=-(P-.5)*a,F=o.b_(u,g);return new o.P((I/x+F[0])*b,(z/x+F[1])*b)}function K1(m,a,u,g,x,b,E,P,I,z){const F=m.text.placedSymbolArray,q=m.text.dynamicLayoutVertexArray,$=m.icon.dynamicLayoutVertexArray,K={},te=m.getProjection(),ee=qm(E,te,x),re=x.elevation,ie=te.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;q.clear();for(let ue=0;ue<F.length;ue++){const pe=F.get(ue),{tileAnchorX:me,tileAnchorY:Te,numGlyphs:we}=pe,Pe=pe.hidden||!pe.crossTileID||m.allowVerticalPlacement&&!pe.placedOrientation?null:g[pe.crossTileID];if(Pe){let be=0,Se=0,Ee=0;if(re){const nt=re?re.getAtTileOffset(E,me,Te):0,[Ze,yt,bt]=te.upVector(E.canonical,me,Te);be=nt*Ze*ie,Se=nt*yt*ie,Ee=nt*bt*ie}let[Ve,De,dt,Je]=ns(pe.projectedAnchorX+be,pe.projectedAnchorY+Se,pe.projectedAnchorZ+Ee,u?ee:b);const pt=Sv(x.getCameraToCenterDistance(te),Je);let Ct=o.bJ(m.textSizeData,I,pe)*pt/o.bU;u&&(Ct*=m.tilePixelRatio/P);const We=o0(Pe,Ct);u?({x:Ve,y:De,z:dt}=te.projectTilePoint(me+We.x,Te+We.y,E.canonical),[Ve,De,dt]=ns(Ve+be,De+Se,dt+Ee,b)):(a&&We._rotate(-x.angle),Ve+=We.x,De+=We.y,dt=0);const Re=m.allowVerticalPlacement&&pe.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let nt=0;nt<we;nt++)o.bL(q,Ve,De,dt,Re);z&&pe.associatedIconIndex>=0&&(K[pe.associatedIconIndex]={x:Ve,y:De,z:dt,angle:Re})}else Zh(we,q)}if(z){$.clear();const ue=m.icon.placedSymbolArray;for(let pe=0;pe<ue.length;pe++){const me=ue.get(pe),{numGlyphs:Te}=me,we=K[pe];if(me.hidden||!we)Zh(Te,$);else{const{x:Pe,y:be,z:Se,angle:Ee}=we;for(let Ve=0;Ve<Te;Ve++)o.bL($,Pe,be,Se,Ee)}}m.icon.dynamicLayoutVertexBuffer.updateData($)}m.text.dynamicLayoutVertexBuffer.updateData(q)}function a0(m,a,u,g,x,b,E={}){const P=u.paint.get("icon-translate"),I=u.paint.get("text-translate"),z=u.paint.get("icon-translate-anchor"),F=u.paint.get("text-translate-anchor"),q=u.layout.get("icon-rotation-alignment"),$=u.layout.get("text-rotation-alignment"),K=u.layout.get("icon-pitch-alignment"),te=u.layout.get("text-pitch-alignment"),ee=u.layout.get("icon-keep-upright"),re=u.layout.get("text-keep-upright"),ie=u.paint.get("icon-color-saturation"),ue=u.paint.get("icon-color-contrast"),pe=u.paint.get("icon-color-brightness-min"),me=u.paint.get("icon-color-brightness-max"),Te=u.layout.get("symbol-elevation-reference")==="sea",we=m.context,Pe=we.gl,be=m.transform,Se=q==="map",Ee=$==="map",Ve=K==="map",De=te==="map",dt=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Je=!1;const pt=m.depthModeForSublayer(0,Ht.ReadOnly),Ct=new Ht(m.context.gl.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D),We=[o.aD(be.center.lng),o.aH(be.center.lat)],Re=u.layout.get("text-variable-anchor"),nt=be.projection.name==="globe",Ze=[],yt=[0,-1,0];for(const bt of g){const Et=a.getTile(bt),jt=Et.getBucket(u);if(!jt||jt.projection.name==="mercator"&&nt||jt.fullyClipped)continue;const tr=jt.projection.name==="globe",ir=tr?o.ah(be.zoom):0,Zt=qm(bt,jt.getProjection(),be),er=be.calculatePixelsToTileUnitsMatrix(Et),nr=Re&&jt.hasTextData(),wr=jt.hasIconTextFit()&&nr&&jt.hasIconData(),Cr=jt.getProjection().createInversionMatrix(be,bt.canonical),Nr=(1<<Et.tileID.canonical.z)*o.aj/m.transform.worldSize,Cn=kr=>{let mn=[0,0,0];if(kr){const mi=m.style.directionalLight,rn=m.style.ambientLight;mi&&rn&&(mn=Vu(m.style,mi,rn))}return mn},vr=kr=>{be.depthOcclusionForSymbolsAndCircles&&(u.hasInitialOcclusionOpacityProperties||m.terrain)&&(kr.push("DEPTH_D24"),kr.push("DEPTH_OCCLUSION"))},un=()=>{const kr=Se&&u.layout.get("symbol-placement")!=="point",mn=[];vr(mn);const mi=kr||wr,rn=jt.elevationType==="road",xn=m.shadowRenderer,Ln=rn&&Ve&&!!xn&&xn.enabled,Ei=Cn(Ln),Oi=rn&&Ve&&!m.terrain?Ct:pt,ji=u.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&Ve&&mn.push("PITCH_WITH_MAP_TERRAIN"),tr&&(mn.push("PROJECTION_GLOBE_VIEW"),mi&&mn.push("PROJECTED_POS_ON_VIEWPORT")),ji>0&&jt.hasAnySecondaryIcon&&mn.push("ICON_TRANSITION"),!jt.icon.zOffsetVertexBuffer||rn&&m.terrain||mn.push("Z_OFFSET"),ie===0&&ue===0&&pe===0&&me===1||mn.push("COLOR_ADJUSTMENT"),jt.sdfIcons&&mn.push("RENDER_SDF"),Ln&&mn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),rn&&Ve&&!m.terrain&&jt.icon.orientationVertexBuffer&&mn.push("ELEVATED_ROADS");const Do=jt.icon.programConfigurations.get(u.id),cs=m.getOrCreateProgram("symbol",{config:Do,defines:mn}),$a=Et.imageAtlasTexture?Et.imageAtlasTexture.size:[0,0],fa=jt.iconSizeData,pa=o.bH(fa,be.zoom),Ga=Ve||!be.isOrthographic,js=Vf(Zt,Et.tileID.canonical,Ve,Se,be,jt.getProjection(),er),Rs=Wl(Zt,Et.tileID.canonical,Ve,Se,be,jt.getProjection(),er),oi=m.translatePosMatrix(Rs,Et,P,z,!0),Ri=m.translatePosMatrix(Zt,Et,P,z),Vn=mi?Ku:js,Di=Se&&!Ve&&!kr;let Xo=yt;!nt&&!be.mercatorFromTransition||Se||(Xo=ip(be));const _i=tr?Xo:yt,Ia=u.getColorAdjustmentMatrix(ie,ue,pe,me),Qu=bg(fa.kind,pa,Di,Ve,m,Ri,Vn,oi,Te,!1,$a,[0,0],0,bt,ir,We,Cr,_i,jt.getProjection(),Ei,Nr,Ia,ji,null),Qc=Et.imageAtlasTexture?Et.imageAtlasTexture:null,Td=u.layout.get("icon-size").constantOr(0)!==1||jt.iconsNeedLinear,Ed=jt.sdfIcons||m.options.rotating||m.options.zooming||Td||Ga?Pe.LINEAR:Pe.NEAREST,eu=jt.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,Oa=m.terrain&&Ve&&kr?o.bi(o.bz(),js):Ku;if(kr&&jt.icon){const tu=be.elevation,$i=tu?tu.getAtTileOffsetFunc(bt,be.center.lat,be.worldSize,jt.getProjection()):null,Ds=Wh(Zt,Et.tileID.canonical,Ve,Se,be,jt.getProjection(),er);Fu(jt,Zt,m,!1,Ds,Rs,Ve,ee,$i,bt)}return{program:cs,buffers:jt.icon,uniformValues:Qu,atlasTexture:Qc,atlasTextureIcon:null,atlasInterpolation:Ed,atlasInterpolationIcon:null,isSDF:jt.sdfIcons,hasHalo:eu,depthMode:Oi,tile:Et,renderWithShadows:Ln,labelPlaneMatrixInv:Oa}},hn=()=>{const kr=Ee&&u.layout.get("symbol-placement")!=="point",mn=[],mi=kr||Re||wr,rn=jt.elevationType==="road",xn=m.shadowRenderer,Ln=rn&&De&&!!xn&&xn.enabled,Ei=Cn(Ln),Oi=rn&&De&&!m.terrain?Ct:pt;m.terrainRenderModeElevated()&&De&&mn.push("PITCH_WITH_MAP_TERRAIN"),tr&&(mn.push("PROJECTION_GLOBE_VIEW"),mi&&mn.push("PROJECTED_POS_ON_VIEWPORT")),!jt.text.zOffsetVertexBuffer||rn&&m.terrain||mn.push("Z_OFFSET"),jt.iconsInText&&mn.push("RENDER_TEXT_AND_SYMBOL"),mn.push("RENDER_SDF"),Ln&&mn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),rn&&De&&!m.terrain&&jt.text.orientationVertexBuffer&&mn.push("ELEVATED_ROADS"),vr(mn);const ji=jt.text.programConfigurations.get(u.id),Do=m.getOrCreateProgram("symbol",{config:ji,defines:mn});let cs,$a=[0,0],fa=null;const pa=jt.textSizeData;jt.iconsInText&&($a=Et.imageAtlasTexture?Et.imageAtlasTexture.size:[0,0],fa=Et.imageAtlasTexture?Et.imageAtlasTexture:null,cs=De||!be.isOrthographic||m.options.rotating||m.options.zooming||pa.kind==="composite"||pa.kind==="camera"?Pe.LINEAR:Pe.NEAREST);const Ga=Et.glyphAtlasTexture?Et.glyphAtlasTexture.size:[0,0],js=u.layout.get("text-size-scale-range"),Rs=o.ay(m.scaleFactor,js[0],js[1]),oi=o.bH(pa,be.zoom,Rs),Ri=Vf(Zt,Et.tileID.canonical,De,Ee,be,jt.getProjection(),er),Vn=Wl(Zt,Et.tileID.canonical,De,Ee,be,jt.getProjection(),er),Di=m.translatePosMatrix(Vn,Et,I,F,!0),Xo=m.translatePosMatrix(Zt,Et,I,F),_i=mi?Ku:Ri,Ia=Ee&&!De&&!kr;let Qu=yt;!nt&&!be.mercatorFromTransition||Ee||(Qu=ip(be));const Qc=bg(pa.kind,oi,Ia,De,m,Xo,_i,Di,Te,!0,Ga,$a,0,bt,ir,We,Cr,tr?Qu:yt,jt.getProjection(),Ei,Nr,null,null,Rs),Td=Et.glyphAtlasTexture?Et.glyphAtlasTexture:null,Ed=Pe.LINEAR,eu=u.paint.get("text-halo-width").constantOr(1)!==0,Oa=m.terrain&&De&&kr?o.bi(o.bz(),Ri):Ku;if(kr&&jt.text){const tu=be.elevation,$i=tu?tu.getAtTileOffsetFunc(bt,be.center.lat,be.worldSize,jt.getProjection()):null,Ds=Wh(Zt,Et.tileID.canonical,De,Ee,be,jt.getProjection(),er);Fu(jt,Zt,m,!0,Ds,Vn,De,re,$i,bt)}return{program:Do,buffers:jt.text,uniformValues:Qc,atlasTexture:Td,atlasTextureIcon:fa,atlasInterpolation:Ed,atlasInterpolationIcon:cs,isSDF:!0,hasHalo:eu,depthMode:Oi,tile:Et,renderWithShadows:Ln,labelPlaneMatrixInv:Oa}},Zn=jt.icon.segments.get().length,Mr=jt.text.segments.get().length,an=Zn&&!E.onlyText?un():null,cn=Mr&&!E.onlyIcons?hn():null,vn=u.paint.get("icon-opacity").constantOr(1),hi=u.paint.get("text-opacity").constantOr(1);if(dt&&jt.canOverlap){Je=!0;const kr=vn&&!E.onlyText?jt.icon.segments.get():[],mn=hi&&!E.onlyIcons?jt.text.segments.get():[];for(const mi of kr)Ze.push({segments:new o.bd([mi]),sortKey:mi.sortKey,state:an});for(const mi of mn)Ze.push({segments:new o.bd([mi]),sortKey:mi.sortKey,state:cn})}else E.onlyText||Ze.push({segments:vn?jt.icon.segments:new o.bd([]),sortKey:0,state:an}),E.onlyIcons||Ze.push({segments:hi?jt.text.segments:new o.bd([]),sortKey:0,state:cn})}Je&&Ze.sort((bt,Et)=>bt.sortKey-Et.sortKey);for(const bt of Ze){const Et=bt.state;if(Et)if(m.terrain?m.terrain.setupElevationDraw(Et.tile,Et.program,{useDepthForOcclusion:be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Et.labelPlaneMatrixInv}):m.setupDepthForOcclusion(be.depthOcclusionForSymbolsAndCircles,Et.program),we.activeTexture.set(Pe.TEXTURE0),Et.atlasTexture&&Et.atlasTexture.bind(Et.atlasInterpolation,Pe.CLAMP_TO_EDGE,!0),Et.atlasTextureIcon&&(we.activeTexture.set(Pe.TEXTURE1),Et.atlasTextureIcon&&Et.atlasTextureIcon.bind(Et.atlasInterpolationIcon,Pe.CLAMP_TO_EDGE,!0)),Et.renderWithShadows&&m.shadowRenderer.setupShadows(Et.tile.tileID.toUnwrapped(),Et.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,Et.program),Et.hasHalo){const jt=Et.uniformValues;jt.u_is_halo=1,Wc(Et.buffers,bt.segments,u,m,Et.program,Et.depthMode,x,b,jt,2),jt.u_is_halo=0}else{if(Et.isSDF){const jt=Et.uniformValues;Et.hasHalo&&(jt.u_is_halo=1,Wc(Et.buffers,bt.segments,u,m,Et.program,Et.depthMode,x,b,jt,1)),jt.u_is_halo=0}Wc(Et.buffers,bt.segments,u,m,Et.program,Et.depthMode,x,b,Et.uniformValues,1)}}}function Wc(m,a,u,g,x,b,E,P,I,z){const F=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];x.draw(g,g.context.gl.TRIANGLES,b,E,P,ur.disabled,I,u.id,m.layoutVertexBuffer,m.indexBuffer,a,u.paint,g.transform.zoom,m.programConfigurations.get(u.id),F,z)}function op(m,a){const u=1<<m.canonical.z,g=(a.x*u-m.canonical.x-m.wrap*u)*o.aj,x=(a.y*u-m.canonical.y)*o.aj,b=o.e2(a.z,a.y);return o.d2(g,x,b)}function Wt(m,a,u,g,x){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const b=m.context.gl,E=new Ht(m.context.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D),P=new Ht(m.context.gl.GREATER,Ht.ReadWrite,m.depthRangeFor3D),I=function(K){const te=o.cU(K.pitch);let ee=.01;return K.isOrthographic&&(ee=o.ai(1e-4,ee,o.cZ(te>=So?1:te/So))),2*ee}(m.transform),z=m.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",q=m.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),$=m.getOrCreateProgram(F);for(const K of g){const te=a.getTile(K),ee=te.getBucket(u);if(!ee)continue;const re=ee.elevatedStructures;if(!re)continue;const ie=ee.elevationBufferData.heightRange,ue=op(K.toUnwrapped(),z),pe=m.translatePosMatrix(K.projMatrix,te,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));let me,Te,we,Pe;if(x==="initialize"){if(!ie||ie.min>=1||re.depthSegments.segments[0].primitiveLength===0)continue;me=yg(pe,ue,I,1,0),Te=E,we=re.depthSegments,Pe=q}else if(x==="reset"){if(!ie||ie.min>=0||re.maskSegments.segments[0].primitiveLength===0)continue;me=yg(pe,ue,0,0,1),Te=P,we=re.maskSegments,Pe=q}else if(x==="geometry"){if(re.depthSegments.segments[0].primitiveLength===0)continue;me=yg(pe,ue,I,1,0),Te=E,we=re.depthSegments,Pe=$}Pe.draw(m,b.TRIANGLES,Te,mr.disabled,Or.disabled,ur.disabled,me,u.id,re.vertexBuffer,re.indexBuffer,we,u.paint,m.transform.zoom)}}function Sg(m,a,u){const{painter:g,sourceCache:x,layer:b,coords:E,colorMode:P,elevationType:I,terrainEnabled:z,pass:F}=m,q=g.context.gl,$=b.paint.get("fill-pattern"),K=b.paint.get("fill-pattern-cross-fade"),te=$.constantOr(null);let ee=I;I!=="road"||a&&!z||(ee="none");const re=ee==="road",ie=m.painter.shadowRenderer,ue=re&&!!ie&&ie.enabled,pe=new Ht(g.context.gl.LEQUAL,Ht.ReadOnly,g.depthRangeFor3D);let me=[0,0,0];if(ue){const Pe=g.style.directionalLight,be=g.style.ambientLight;Pe&&be&&(me=Vu(g.style,Pe,be))}const Te=$&&$.constantOr(1),we=(Pe,be)=>{let Se,Ee,Ve,De,dt;be?(Se=Te&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ve=q.LINES):(Se=Te?"fillPattern":"fill",Ve=q.TRIANGLES);for(const Je of E){const pt=x.getTile(Je);if(Te&&!pt.patternsLoaded())continue;const Ct=pt.getBucket(b);if(!Ct)continue;const We=a?Ct.elevationBufferData:Ct.bufferData;if(We.isEmpty())continue;g.prepareDrawTile();const Re=We.programConfigurations.get(b.id),nt=g.isTileAffectedByFog(Je),Ze=[],yt=[];re&&(Ze.push("ELEVATED_ROADS"),yt.push(We.elevatedLayoutVertexBuffer)),ue&&Ze.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Te&&(g.context.activeTexture.set(q.TEXTURE0),pt.imageAtlasTexture&&pt.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Re.updatePaintBuffers());let bt=!1;if(te&&pt.imageAtlas){const Zt=pt.imageAtlas,er=o.dZ.from(te),nr=er.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),wr=er.getSecondary(),Cr=Zt.patternPositions.get(nr),Nr=wr?Zt.patternPositions.get(wr.scaleSelf(o.q.devicePixelRatio).toString()):null;bt=!!Cr&&!!Nr,Cr&&Re.setConstantPatternPositions(Cr,Nr)}K>0&&(bt||Re.getPatternTransitionVertexBuffer("fill-pattern"))&&Ze.push("FILL_PATTERN_TRANSITION");const Et=g.getOrCreateProgram(Se,{config:Re,overrideFog:nt,defines:Ze}),jt=g.translatePosMatrix(Je.projMatrix,pt,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));ue&&ie.setupShadows(pt.tileID.toUnwrapped(),Et,"vector-tile");const tr=b.paint.get("fill-emissive-strength");if(be){De=We.lineIndexBuffer,dt=We.lineSegments;const Zt=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[q.drawingBufferWidth,q.drawingBufferHeight];Ee=Se==="fillOutlinePattern"&&Te?FC(jt,tr,g,pt,Zt,me,K):NC(jt,tr,Zt,me)}else De=We.indexBuffer,dt=We.triangleSegments,Ee=Te?B1(jt,tr,g,pt,me,K):F1(jt,tr,me);g.uploadCommonUniforms(g.context,Et,Je.toUnwrapped());let ir=Pe;(I==="road"&&!z||I==="offset")&&(ir=pe),Et.draw(g,Ve,ir,u||g.stencilModeForClipping(Je),P,ur.disabled,Ee,b.id,We.layoutVertexBuffer,De,dt,b.paint,g.transform.zoom,Re,yt)}};g.renderPass===F&&we(g.depthModeForSublayer(1,g.renderPass==="opaque"?Ht.ReadWrite:Ht.ReadOnly),!1),ee==="none"&&g.renderPass==="translucent"&&b.paint.get("fill-antialias")&&we(g.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Ht.ReadOnly),!0)}function ap(m,a,u,g,x,b,E,P){u.resetLayerRenderingStats(m);const I=m.context,z=I.gl,F=m.transform,q=u.paint.get("fill-extrusion-pattern"),$=u.paint.get("fill-extrusion-pattern-cross-fade"),K=q.constantOr(null),te=q.constantOr(1),ee=u.paint.get("fill-extrusion-opacity"),re=m.style.enable3dLights(),ie=u.paint.get(re&&!te?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ue=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),ie],pe=u.layout.get("fill-extrusion-edge-radius"),me=pe>0&&!u.paint.get("fill-extrusion-rounded-roof"),Te=me?0:pe,we=F.projection.name==="globe"?o.e5():0,Pe=F.projection.name==="globe",be=Pe?o.ah(F.zoom):0,Se=[o.aD(F.center.lng),o.aH(F.center.lat)],Ee=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ve=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ee?null:u.lut).toArray01().slice(0,3),De=u.paint.get("fill-extrusion-flood-light-intensity"),dt=u.paint.get("fill-extrusion-vertical-scale"),Je=u.paint.get("fill-extrusion-line-width").constantOr(1)!==0,pt=u.paint.get("fill-extrusion-height-alignment"),Ct=u.paint.get("fill-extrusion-base-alignment"),We=yl(m,u.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let nt;Pe&&Re.push("PROJECTION_GLOBE_VIEW"),ue[0]>0&&Re.push("FAUX_AO"),me&&Re.push("ZERO_ROOF_RADIUS"),P&&Re.push("HAS_CENTROID"),De>0&&Re.push("FLOOD_LIGHT"),We.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),Je&&Re.push("RENDER_WALL_MODE");const Ze=m.renderPass==="shadow",yt=m.shadowRenderer,bt=Ze&&!!yt,Et=Ze?ur.disabled:ur.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let jt=[0,0,0];if(yt){const Zt=m.style.directionalLight,er=m.style.ambientLight;Zt&&er&&(jt=Vu(m.style,Zt,er)),Ze||(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),yt.useNormalOffset&&Re.push("NORMAL_OFFSET")),nt=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const tr=bt?"fillExtrusionDepth":te?"fillExtrusionPattern":"fillExtrusion",ir=u.getLayerRenderingStats();for(const Zt of g){const er=a.getTile(Zt),nr=er.getBucket(u);if(!nr||nr.projection.name!==F.projection.name)continue;let wr=!1;yt&&(wr=yt.getMaxCascadeForTile(Zt.toUnwrapped())===0);const Cr=m.isTileAffectedByFog(Zt),Nr=nr.programConfigurations.get(u.id);let Cn=!1;if(K&&er.imageAtlas){const cn=er.imageAtlas,vn=o.dZ.from(K),hi=vn.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),kr=vn.getSecondary(),mn=cn.patternPositions.get(hi),mi=kr?cn.patternPositions.get(kr.scaleSelf(o.q.devicePixelRatio).toString()):null;Cn=!!mn&&!!mi,mn&&Nr.setConstantPatternPositions(mn,mi)}$>0&&(Cn||Nr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Re.push("FILL_EXTRUSION_PATTERN_TRANSITION");const vr=m.getOrCreateProgram(tr,{config:Nr,defines:wr?nt:Re,overrideFog:Cr});if(m.terrain&&m.terrain.setupElevationDraw(er,vr,{useMeterToDem:!0}),!nr.centroidVertexBuffer){const cn=vr.attributes.a_centroid_pos;cn!==void 0&&z.vertexAttrib2f(cn,0,0)}!Ze&&yt&&yt.setupShadows(er.tileID.toUnwrapped(),vr,"vector-tile"),te&&(m.context.activeTexture.set(z.TEXTURE0),er.imageAtlasTexture&&er.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Nr.updatePaintBuffers());const un=u.paint.get("fill-extrusion-vertical-gradient"),hn=1/nr.tileToMeter;let Zn;if(Ze&&yt){if(Tg(er.tileID,nr.maxHeight,m))continue;const cn=yt.calculateShadowPassMatrixFromTile(er.tileID.toUnwrapped());Zn=N1(cn,Te,hn,dt,pt,Ct)}else{const cn=m.translatePosMatrix(Zt.expandedProjMatrix,er,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),vn=F.projection.createInversionMatrix(F,Zt.canonical);Zn=te?ld(cn,m,un,ee,ue,Te,hn,Zt,er,we,pt,Ct,be,Se,vn,Ve,dt,$):Kv(cn,m,un,ee,ue,Te,hn,Zt,we,pt,Ct,be,Se,vn,Ve,dt,De,jt)}m.uploadCommonUniforms(I,vr,Zt.toUnwrapped(),null,We);let Mr=nr.segments;if(F.projection.name==="mercator"&&!Ze&&(Mr=nr.getVisibleSegments(er.tileID,m.terrain,m.transform.getFrustum(0)),!Mr.get().length))continue;if(ir)if(Ze)for(const cn of Mr.get())ir.numRenderedVerticesInShadowPass+=cn.primitiveLength;else for(const cn of Mr.get())ir.numRenderedVerticesInTransparentPass+=cn.primitiveLength;const an=[];(m.terrain||P)&&an.push(nr.centroidVertexBuffer),Pe&&an.push(nr.layoutVertexExtBuffer),Je&&an.push(nr.wallVertexBuffer),vr.draw(m,I.gl.TRIANGLES,x,b,E,Et,Zn,u.id,nr.layoutVertexBuffer,nr.indexBuffer,Mr,u.paint,m.transform.zoom,Nr,an)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class Xl{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Pa(m,a,u,g,x,b,E,P,I,z,F,q,$,K,te,ee,re,ie,ue,pe){const me=a.context,Te=me.gl,we=a.transform,Pe=a.transform.zoom,be=[],Se=m.translate,Ee=m.translateAnchor,Ve=m.edgeRadius,De=yl(a,m.cutoffFadeRange);F==="clear"?(be.push("CLEAR_SUBPASS"),pe&&(be.push("CLEAR_FROM_TEXTURE"),me.activeTexture.set(Te.TEXTURE0),pe.bind(Te.LINEAR,Te.CLAMP_TO_EDGE))):F==="sdf"&&be.push("SDF_SUBPASS"),ie&&be.push("HAS_CENTROID"),De.shouldRenderCutoff&&be.push("RENDER_CUTOFF");const dt=(Je,pt,Ct,We,Re)=>{const nt=pt.programConfigurations.get(g.id),Ze=a.isTileAffectedByFog(Je),yt=a.getOrCreateProgram("fillExtrusionGroundEffect",{config:nt,defines:be,overrideFog:Ze}),bt=((jt,tr,ir,Zt,er,nr,wr,Cr,Nr,Cn,vr)=>({u_matrix:tr,u_opacity:ir,u_ao_pass:Zt?1:0,u_meter_to_tile:er,u_ao:nr,u_flood_light_intensity:wr,u_flood_light_color:Cr,u_attenuation:Nr,u_edge_radius:Cn,u_fb:0,u_fb_size:vr,u_dynamic_offset:1}))(0,We,q,z,Re,[$,K*Re],te,ee,re,Pe>=17?0:Ve*Re,pe?pe.size[0]:0),Et=[];ie&&Et.push(pt.hiddenByLandmarkVertexBuffer),a.uploadCommonUniforms(me,yt,Je.toUnwrapped(),null,De),yt.draw(a,me.gl.TRIANGLES,b,E,P,I,bt,g.id,pt.vertexBuffer,pt.indexBuffer,Ct,g.paint,Pe,nt,Et)};for(const Je of x){const pt=u.getTile(Je),Ct=pt.getBucket(g);if(!Ct||Ct.projection.name!==we.projection.name||!Ct.groundEffect||Ct.groundEffect&&!Ct.groundEffect.hasData())continue;const We=Ct.groundEffect,Re=1/Ct.tileToMeter;{const nt=a.translatePosMatrix(Je.projMatrix,pt,Se,Ee),Ze=We.getDefaultSegment();dt(Je,We,Ze,nt,Re)}if(ue)for(let nt=0;nt<4;nt++){const Ze=o.e3[nt](Je),yt=u.getTile(Ze);if(!yt)continue;const bt=yt.getBucket(g);if(!bt||bt.projection.name!==we.projection.name||!bt.groundEffect||bt.groundEffect&&!bt.groundEffect.hasData())continue;const Et=bt.groundEffect;let jt,tr;nt===0?(jt=[-o.aj,0,0],tr=1):nt===1?(jt=[o.aj,0,0],tr=0):nt===2?(jt=[0,-o.aj,0],tr=3):(jt=[0,o.aj,0],tr=2);const ir=Et.regionSegments[tr];if(!ir)continue;const Zt=new Float32Array(16);o.bo(Zt,Je.projMatrix,jt),dt(Je,Et,ir,a.translatePosMatrix(Zt,pt,Se,Ee),Re)}}}function hr(m,a,u,g,x,b,E){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const P=b?b.findDEMTileFor(u):null;if(!(P&&P.dem||E))return;b&&P&&P.dem&&g.selfDEMTileTimestamp!==P.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=P.dem._timestamp);const I=ie=>new o.P(Math.ceil((ie+o.e7)*o.e8),0),z=ie=>{const ue=a.getSource().minzoom,pe=Te=>{const we=a.getTileByID(Te);if(we&&we.hasData())return we.getBucket(x)},me=[0,-1,1];for(const Te of me){if(ie.overscaledZ+Te<ue)continue;const we=pe(ie.calculateScaledKey(ie.overscaledZ+Te));if(we)return we}},F=[0,0,0],q=(ie,ue)=>(F[0]=Math.min(ie.min.y,ue.min.y),F[1]=Math.max(ie.max.y,ue.max.y),F[2]=o.aj-ue.min.x>ie.max.x?ue.min.x-o.aj:ie.max.x,F),$=(ie,ue)=>(F[0]=Math.min(ie.min.x,ue.min.x),F[1]=Math.max(ie.max.x,ue.max.x),F[2]=o.aj-ue.min.y>ie.max.y?ue.min.y-o.aj:ie.max.y,F),K=[(ie,ue)=>q(ie,ue),(ie,ue)=>q(ue,ie),(ie,ue)=>$(ie,ue),(ie,ue)=>$(ue,ie)],te=(ie,ue,pe,me,Te,we,Pe)=>{if(!b)return 0;const be=[[we?pe:ie,we?ie:pe,0],[we?pe:ue,we?ue:pe,0]],Se=Pe<0?o.aj+Pe:Pe,Ee=[we?Se:(ie+ue)/2,we?(ie+ue)/2:Se,0];return pe===0&&Pe<0||pe!==0&&Pe>0?b.getForTilePoints(Te,[Ee],!0,me):be.push(Ee),b.getForTilePoints(u,be,!0,P),Math.max(be[0][2],be[1][2],Ee[2])/b.exaggeration()};for(let ie=0;ie<4;ie++){const ue=g.borderFeatureIndices[ie];if(ue.length===0)continue;const pe=o.e3[ie](u),me=z(pe);if(!(me&&me instanceof o.e4))continue;const Te=b?b.findDEMTileFor(pe):null;if(!(Te&&Te.dem||E)||(b&&Te&&Te.dem&&g.borderDEMTileTimestamp[ie]!==Te.dem._timestamp&&(g.borderDoneWithNeighborZ[ie]=-1,g.borderDEMTileTimestamp[ie]=Te.dem._timestamp),g.borderDoneWithNeighborZ[ie]===me.canonical.z))continue;me.centroidVertexArray.length===0&&me.createCentroidsBuffer();const we=(ie<2?1:5)-ie,Pe=me.borderDoneWithNeighborZ[we]!==g.canonical.z,be=me.borderFeatureIndices[we];let Se=0;if(g.canonical.z!==me.canonical.z){for(const Ee of ue)g.showCentroid(g.featuresOnBorder[Ee]);if(Pe)for(const Ee of be)me.showCentroid(me.featuresOnBorder[Ee]);g.borderDoneWithNeighborZ[ie]=me.canonical.z,me.borderDoneWithNeighborZ[we]=g.canonical.z}for(const Ee of ue){const Ve=g.featuresOnBorder[Ee],De=g.centroidData[Ve.centroidDataIndex],dt=Ve.borders[ie];let Je;for(;Se<be.length;){Je=me.featuresOnBorder[be[Se]];const pt=Je.borders[we];if(pt[1]>dt[0]+3||pt[0]>dt[0]-3)break;me.showCentroid(Je),Se++}if(Je&&Se<be.length){const pt=Se;let Ct=0;for(;!(Je.borders[we][0]>dt[1]-3)&&(Ct++,++Se!==be.length);)Je=me.featuresOnBorder[be[Se]];Je=me.featuresOnBorder[be[pt]];let We=!1;if(Ct>=1){const Ze=Je.borders[we];Math.abs(dt[0]-Ze[0])<3&&Math.abs(dt[1]-Ze[1])<3&&(Ct=1,We=!0,Se=pt+1)}else if(Ct===0){g.showCentroid(Ve);continue}const Re=me.centroidData[Je.centroidDataIndex];E&&We&&(((ee=De).flags|(re=Re).flags)&o.e6?(ee.flags|=o.e6,re.flags|=o.e6):(ee.flags&=~o.e6,re.flags&=~o.e6));const nt=Ve.intersectsCount()>1||Je.intersectsCount()>1;if(Ct>1)Se=pt,De.centroidXY=Re.centroidXY=new o.P(0,0);else if(Te&&Te.dem&&!nt){const Ze=K[ie](De,Re),yt=ie%2?o.aj-1:0,bt=te(Ze[0],Math.min(o.aj-1,Ze[1]),yt,Te,pe,ie<2,Ze[2]);De.centroidXY=Re.centroidXY=I(bt)}else nt?De.centroidXY=Re.centroidXY=new o.P(0,0):(De.centroidXY=g.encodeBorderCentroid(Ve),Re.centroidXY=me.encodeBorderCentroid(Je));g.writeCentroidToBuffer(De),me.writeCentroidToBuffer(Re)}else g.showCentroid(Ve)}g.borderDoneWithNeighborZ[ie]=me.canonical.z,me.borderDoneWithNeighborZ[we]=g.canonical.z}var ee,re;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const s0=[1,0,0],UC=[0,1,0],VC=[0,0,1];function Tg(m,a,u){const g=u.transform,x=u.shadowRenderer;if(!x)return!0;const b=m.toUnwrapped(),E=g.tileSize*x._cascades[u.currentShadowCascade].scale;let P=a;if(g.elevation){const ee=g.elevation.getMinMaxForTile(m);ee&&(P+=ee.max)}const I=[...x.shadowDirection];I[2]=-I[2];const z=x.computeSimplifiedTileShadowVolume(b,P,E,I);if(!z)return!1;const F=[s0,UC,VC,I,[I[0],0,I[2]],[0,I[1],I[2]]],q=g.projection.name==="globe",$=g.scaleZoom(E),K=o.cy.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,$,!q),te=x.getCurrentCascadeFrustum();return K.intersectsPrecise(z.vertices,z.planes,F)===0||te.intersectsPrecise(z.vertices,z.planes,F)===0}function Eg(m){const{painter:a,source:u,layer:g,coords:x}=m,b=m.defines,E=a.context,P=a.renderPass==="shadow",I=a.renderPass==="light-beam",z=a.shadowRenderer;let F;z&&(F=b.concat(["SHADOWS_SINGLE_CASCADE"]));const q=o.e9(a.transform.center.lat,a.transform.zoom);for(const $ of x){const K=u.getTile($),te=K.getBucket(g);if(!te)continue;let ee=!1;z&&(ee=z.getMaxCascadeForTile($.toUnwrapped())===0);const re=te.programConfigurations.get(g.id);let ie,ue,pe=a.translatePosMatrix($.expandedProjMatrix,K,[0,0],"map");if(pe=o.cP(o.bz(),pe,[1,1,m.verticalScale]),P&&z){if(Tg(K.tileID,te.maxHeight*q,a))continue;let me=z.calculateShadowPassMatrixFromTile(K.tileID.toUnwrapped());me=o.cP(o.bz(),me,[1,1,m.verticalScale]),ue=U1(me),ie=a.getOrCreateProgram("buildingDepth",{config:re,defines:ee?F:b,overrideFog:!1})}else if(I)ie=a.getOrCreateProgram("buildingBloom",{config:re,defines:ee?F:b,overrideFog:!1}),ue=Yv(pe);else{const me=a.transform.calculatePosMatrix($.toUnwrapped(),a.transform.worldSize);o.cP(me,me,[1,1,m.verticalScale]);const Te=o.bz();o.cP(Te,me,[1,-1,1/q]),o.bi(Te,Te),o.ea(Te,Te),ue=Xv(pe,Te),ie=a.getOrCreateProgram("building",{config:re,defines:ee?F:b,overrideFog:!1}),z&&z.setupShadowsFromMatrix(me,ie,!0)}if(a.uploadCommonUniforms(E,ie,$.toUnwrapped(),null,null),I){const me=te.bloomGeometry;ie.draw(a,E.gl.TRIANGLES,m.depthMode,mr.disabled,m.blendMode,ur.disabled,ue,g.id,me.layoutVertexBuffer,me.indexBuffer,me.segmentsBucket,g.paint,a.transform.zoom,re,[me.layoutAttenuationBuffer,me.layoutColorBuffer])}else ie.draw(a,E.gl.TRIANGLES,m.depthMode,mr.disabled,m.blendMode,P?ur.disabled:ur.backCW,ue,g.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,g.paint,a.transform.zoom,re,[te.layoutNormalBuffer,te.layoutColorBuffer])}}function X1(m){return[m[0]*o.eb,m[1]*o.eb,m[2]*o.eb,0]}function Ag(m,a,u,g,x,b,E,P,I){const z=g.getSource(),F=u.globeSharedBuffers;if(!F)return;let q,$,K;if(a&&(q=g.getTile(a)),z instanceof o.aP?($=z.texture,K=o.dE(0,0,u.transform)):q&&a&&($=q.texture,K=o.dE(a.canonical.z,a.canonical.x,u.transform)),!$||!K)return;m||(K=o.cP(o.bz(),K,[1,-1,1]));const te=u.context,ee=te.gl,re=x.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR,ie=u.colorModeForDrapableLayerRenderPass(b),ue=E.defines;ue.push("GLOBE_POLES");const pe=new Ht(ee.LEQUAL,Ht.ReadWrite,u.depthRangeFor3D),me=Float32Array.from(u.transform.expandedFarZProjMatrix),Te=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),te.activeTexture.set(ee.TEXTURE0),$.bind(re,ee.CLAMP_TO_EDGE),te.activeTexture.set(ee.TEXTURE1),$.bind(re,ee.CLAMP_TO_EDGE),"useMipmap"in $&&te.extTextureFilterAnisotropic&&u.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,te.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,te.extTextureFilterAnisotropicMax);const[we,Pe,be,Se]=a?F.getPoleBuffers(a.canonical.z,!1):F.getPoleBuffers(0,!0),Ee=x.paint.get("raster-elevation");let Ve;m?(Ve=we,u.renderDefaultNorthPole=Ee!==0):(Ve=Pe,u.renderDefaultSouthPole=Ee!==0);const De=X1(E.mix),dt=((pt,Ct,We,Re,nt,Ze,yt,bt,Et,jt,tr,ir,Zt)=>Qv(pt,Ct,We,new Float32Array(16),new Float32Array(9),[0,0],Re,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],bt,2,jt,tr,ir,1,0,Zt))(me,Te,K,o.ah(u.transform.zoom),0,x,0,Ee,0,De,E.offset,E.range,b),Je=u.getOrCreateProgram("raster",{defines:ue});u.uploadCommonUniforms(te,Je,null),Je.draw(u,ee.TRIANGLES,pe,I,ie,P,dt,x.id,Ve,be,Se)}function $C(m){const a=m._nearZ,u=m.projection.farthestPixelDistance(m),g=u-a,x=.2*m.height,b=a+x;return[a,u,(b-x-a)/g,(b-a)/g]}function GC(m,a,u,g){if(m)return a instanceof Oc&&m instanceof $h?a.getTextureDescriptor(m,u,!0):{texture:m.texture,mix:X1(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Va=o.ec([{name:"a_index",type:"Int16",components:1}]);class l0{constructor(a,u,g,x){const b={width:g[0],height:g[1],data:null},E=a.gl;this.targetColorTexture=new o.T(a,b,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(a,b,E.RGBA8,{useMipmap:!1}),this.context=a,this.updateParticleTexture(u,x),this.lastInvalidatedAt=0}updateParticleTexture(a,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,x=u.width*u.height;this.particleTexture0=new o.T(this.context,u,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,u,g.RGBA8,{premultiply:!1,useMipmap:!1});const b=new o.ed;b.reserve(x);for(let E=0;E<x;E++)b.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(b,Va.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ha(m,a,u){if(!m)return null;const g=a.getTextureDescriptor(m,u,!0);if(!g)return null;let{texture:x,mix:b,offset:E,tileSize:P,buffer:I,format:z}=g;if(!x||!z)return null;let F=!1;return z==="uint32"&&(F=!0,b[3]=0,b=_g(o.ee,b,[0,u.paint.get("raster-particle-max-speed")]),E=Vc(o.ee,E,[0,u.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[I/(P+2*I),P/(P+2*I)],tileSize:P,scalarData:F,scale:b,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Zc(m){const a=m._nearZ,u=m.projection.farthestPixelDistance(m),g=u-a,x=.2*m.height,b=a+x;return[a,u,(b-x-a)/g,(b-a)/g]}const Y1=new o.am(1,0,0,1),c0=new o.am(0,1,0,1),u0=new o.am(0,0,1,1),h0=new o.am(1,0,1,1),J1=new o.am(0,1,1,1);function _l(m,a,u,g,x,b){for(let E=0;E<u.length;E++)if(x){const P=new o.am(g.r*.8,g.g*.8,g.b*.8,1);On(m,a,u[E],g,-1,-1,b),On(m,a,u[E],g,-1,1,b),On(m,a,u[E],g,1,1,b),On(m,a,u[E],g,1,-1,b),On(m,a,u[E],P,0,0,b)}else On(m,a,u[E],g,0,0,b)}function On(m,a,u,g,x,b,E){const P=m.context,I=m.transform,z=P.gl,F=I.projection.name==="globe",q=F?["PROJECTION_GLOBE_VIEW"]:[];let $=o.bw(u.projMatrix);if(F&&o.ah(I.zoom)>0){const De=o.bg(u.canonical,I),dt=o.ef(De);$=o.az(new Float32Array(16),I.globeMatrix,dt),o.az($,I.projMatrix,$)}const K=o.bz();K[12]+=2*x/(o.q.devicePixelRatio*I.width),K[13]+=2*b/(o.q.devicePixelRatio*I.height),o.az($,K,$);const te=m.getOrCreateProgram("debug",{defines:q}),ee=a.getTileByID(u.key);m.terrain&&m.terrain.setupElevationDraw(ee,te);const re=Ht.disabled,ie=mr.disabled,ue=m.colorModeForRenderPass(),pe="$debug";P.activeTexture.set(z.TEXTURE0),m.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),F?ee._makeGlobeTileDebugBuffers(m.context,I):ee._makeDebugTileBoundsBuffers(m.context,I.projection);const me=ee._tileDebugBuffer||m.debugBuffer,Te=ee._tileDebugIndexBuffer||m.debugIndexBuffer,we=ee._tileDebugSegments||m.debugSegments;if(te.draw(m,z.LINE_STRIP,re,ie,ue,ur.disabled,Jv($,g.toPremultipliedRenderColor(null)),pe,me,Te,we,null,null,null,[ee._globeTileDebugBorderBuffer]),E){const De=ee.latestRawTileData,dt=Math.floor((De&&De.byteLength||0)/1024);let Je=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Je+=` => ${u.overscaledZ}`),Je+=` ${ee.state}`,Je+=` ${dt}kb`,function(pt,Ct){pt.initDebugOverlayCanvas();const We=pt.debugOverlayCanvas,Re=pt.context.gl,nt=pt.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,We.width,We.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(Ct,5,5),nt.strokeText(Ct,5,5),pt.debugOverlayTexture.update(We),pt.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(m,Je)}const Pe=a.getTile(u).tileSize,be=512/Math.min(Pe,512)*(u.overscaledZ/I.zoom)*.5,Se=ee._tileDebugTextBuffer||m.debugBuffer,Ee=ee._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ve=ee._tileDebugTextSegments||m.debugSegments;te.draw(m,z.TRIANGLES,re,ie,Or.alphaBlended,ur.disabled,Jv($,o.am.transparent.toPremultipliedRenderColor(null),be),pe,Se,Ee,Ve,null,null,null,[ee._globeTileDebugTextBuffer])}function sp(m,a,u,g){lp(m,0,a+u/2,m.transform.width,u,g)}function kg(m,a,u,g){lp(m,a-u/2,0,u,m.transform.height,g)}function lp(m,a,u,g,x,b){const E=m.context,P=E.gl;P.enable(P.SCISSOR_TEST),P.scissor(a*o.q.devicePixelRatio,u*o.q.devicePixelRatio,g*o.q.devicePixelRatio,x*o.q.devicePixelRatio),E.clear({color:b}),P.disable(P.SCISSOR_TEST)}const Q1=o.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:eS}=Q1;function Kc(m,a,u,g){m.emplaceBack(a,u,g)}class Xu{constructor(a){this.vertexArray=new o.eg,this.indices=new o.a_,Kc(this.vertexArray,-1,-1,1),Kc(this.vertexArray,1,-1,1),Kc(this.vertexArray,-1,1,1),Kc(this.vertexArray,1,1,1),Kc(this.vertexArray,-1,-1,-1),Kc(this.vertexArray,1,-1,-1),Kc(this.vertexArray,-1,1,-1),Kc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,eS),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function rl(m,a,u,g,x,b){const E=m.context.gl,P=a.paint.get("sky-atmosphere-color"),I=a.paint.get("sky-atmosphere-halo-color"),z=a.paint.get("sky-atmosphere-sun-intensity"),F=((q,$,K,te,ee)=>({u_matrix_3f:q,u_sun_direction:$,u_sun_intensity:K,u_color_tint_r:[te.r,te.g,te.b,te.a],u_color_tint_m:[ee.r,ee.g,ee.b,ee.a],u_luminance:5e-5}))(o.ei(o.dJ(),g),x,z,P.toPremultipliedRenderColor(null),I.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,a.skyboxTexture,0),u.draw(m,E.TRIANGLES,Ht.disabled,mr.disabled,Or.unblended,ur.frontCW,F,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const It=o.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class $t{constructor(a){const u=new o.ej;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const g=new o.a_;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(u,It.members),this.indexBuffer=a.createIndexBuffer(g),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ud=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class wi{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class $e{constructor(a){this.colorModeAlphaBlendedWriteRGB=new Or([1,Uu,1,Uu],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Or([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new wi,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){const u=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new $t(u);const g=this.params.sizeRange,x=this.params.intensityRange,b=function(F){const q=o.el(30),$=[];for(let K=0;K<F;++K){const te=2*Math.PI*q(),ee=Math.acos(1-2*q())-.5*Math.PI;$.push(o.d2(Math.cos(ee)*Math.cos(te),Math.cos(ee)*Math.sin(te),Math.sin(ee)))}return $}(this.params.starsCount),E=o.el(300),P=new o.ek,I=new o.a_;let z=0;for(let F=0;F<b.length;++F){const q=o.c1([],b[F],200),$=Math.max(0,1+.01*g*(1*E()-.5)),K=Math.max(0,1+.01*x*(1*E()-.5));P.emplaceBack(q[0],q[1],q[2],-1,-1,$,K),P.emplaceBack(q[0],q[1],q[2],1,-1,$,K),P.emplaceBack(q[0],q[1],q[2],1,1,$,K),P.emplaceBack(q[0],q[1],q[2],-1,1,$,K),I.emplaceBack(z+0,z+1,z+2),I.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=u.createVertexBuffer(P,ud.members),this.starsIdx=u.createIndexBuffer(I),this.starsSegments=o.bd.simpleSegment(0,0,P.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,u){const g=a.context,x=g.gl,b=a.transform,E=new Ht(x.LEQUAL,Ht.ReadOnly,[0,1]),P=o.ah(b.zoom),I=a.style.getLut(u.scope),z=u.properties.get("color-use-theme")==="none",F=u.properties.get("color").toNonPremultipliedRenderColor(z?null:I).toArray01(),q=u.properties.get("high-color-use-theme")==="none",$=u.properties.get("high-color").toNonPremultipliedRenderColor(q?null:I).toArray01(),K=u.properties.get("space-color-use-theme")==="none",te=u.properties.get("space-color").toNonPremultipliedRenderColor(K?null:I).toArray01(),ee=5e-4,re=o.em(u.properties.get("horizon-blend"),0,1,ee,.25),ie=o.dy(a,g,b)&&re===ee?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,ue=a.frameCounter/1e3%1,pe=o.ae(b.globeCenterInViewSpace),me=Math.sqrt(Math.pow(pe,2)-Math.pow(ie,2)),Te=Math.acos(me/pe),we=Pe=>{const be=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Pe&&be.push("ALPHA_PASS");const Se=a.getOrCreateProgram("globeAtmosphere",{defines:be}),Ee=((De,dt,Je,pt,Ct,We,Re,nt,Ze,yt,bt,Et)=>({u_frustum_tl:De,u_frustum_tr:dt,u_frustum_br:Je,u_frustum_bl:pt,u_horizon:Ct,u_transition:We,u_fadeout_range:Re,u_color:nt,u_high_color:Ze,u_space_color:yt,u_temporal_offset:bt,u_horizon_angle:Et}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,P,re,F,$,te,ue,Te);a.uploadCommonUniforms(g,Se);const Ve=this.atmosphereBuffer;Ve&&Se.draw(a,x.TRIANGLES,E,mr.disabled,Pe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ur.backCW,Ee,Pe?"atmosphere_glow_alpha":"atmosphere_glow",Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)};we(!1),we(!0)}drawStars(a,u){const g=o.ay(u.properties.get("star-intensity"),0,1);if(g===0)return;const x=a.context,b=x.gl,E=a.transform,P=a.getOrCreateProgram("stars"),I=o.c3([]);o.c5(I,I,-E._pitch),o.c4(I,I,-E.angle),o.c5(I,I,o.al(E._center.lat)),o.en(I,I,-o.al(E._center.lng));const z=o.c8(new Float32Array(16),I),F=o.az([],E.starsProjMatrix,z),q=o.ei([],z),$=o.eo([],q),K=[0,1,0];o.dL(K,K,$),o.c1(K,K,this.params.sizeMultiplier);const te=[1,0,0];o.dL(te,te,$),o.c1(te,te,this.params.sizeMultiplier);const ee=(re=K,ie=te,ue=g,{u_matrix:Float32Array.from(F),u_up:re,u_right:ie,u_intensity_multiplier:ue});var re,ie,ue;a.uploadCommonUniforms(x,P),this.starsVx&&this.starsIdx&&P.draw(a,b.TRIANGLES,Ht.disabled,mr.disabled,this.colorModeAlphaBlendedWriteRGB,ur.disabled,ee,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class tS{constructor(){this.visibleTiles=[]}updateBorders(a,u){const g=[],x=[],b=a._getRenderableCoordinates(!1,!0);for(const I of b){const z=a.getTile(I);if(!z.hasData())continue;const F=z.getBucket(u);F&&(F.isEmpty()||(g.push(I.key),x.push({bucket:F,tileID:I.canonical})))}let E=g.length!==this.visibleTiles.length;if(!E){g.sort();for(let I=0;I<g.length;I++)if(g[I]!==this.visibleTiles[I]){E=!0;break}}if(!E)return;const P=new Set;this.visibleTiles=g,x.sort((I,z)=>I.tileID.z-z.tileID.z||I.tileID.x-z.tileID.x||I.tileID.y-z.tileID.y);for(const I of x){const z=new Array,F=new Array,q=I.bucket;for(const $ of q.featuresOnBorder)P.has($.featureId)?F.push($.footprintIndex):(P.add($.featureId),z.push($.footprintIndex));q.updateFootprintHiddenFlags(z,o.ep,!1),q.updateFootprintHiddenFlags(F,o.ep,!0)}}}function cp(m,a){const u=[...m],g=a.cameraWorldSizeForFog/a.worldSize,x=o.bx([]);return o.cP(x,x,[g,g,1]),o.az(u,x,u),o.az(u,a.worldToFogMatrix,u),u}function up(m,a,u,g,x){const b=u.material,E=g.context,{baseColorTexture:P,metallicRoughnessTexture:I}=b.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:F,emissionTexture:q}=b;function $(te,ee,re){if(te&&(m.push(ee),E.activeTexture.set(E.gl.TEXTURE0+re),te.gfxTexture)){const{minFilter:ie,magFilter:ue,wrapS:pe,wrapT:me}=te.sampler;te.gfxTexture.bindExtraParam(ie,ue,pe,me)}}$(P,"HAS_TEXTURE_u_baseColorTexture",ua.BaseColor),$(I,"HAS_TEXTURE_u_metallicRoughnessTexture",ua.MetallicRoughness),$(z,"HAS_TEXTURE_u_normalTexture",ua.Normal),$(F,"HAS_TEXTURE_u_occlusionTexture",ua.Occlusion),$(q,"HAS_TEXTURE_u_emissionTexture",ua.Emission),x&&(x.texture||(x.texture=new o.et(g.context,x.image,[x.image.height,x.image.height,x.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+ua.LUT),x.texture&&x.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(u.texcoordBuffer)),u.colorBuffer&&(m.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(u.colorBuffer)),u.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(u.normalBuffer)),u.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(u.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||m.push("DIFFUSE_SHADED");const K=g.shadowRenderer;K&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),K.useNormalOffset&&m.push("NORMAL_OFFSET"))}function hd(m,a,u,g,x,b){const E=u.paint.get("model-opacity").constantOr(1),P=a.context,I=new Ht(a.context.gl.LEQUAL,Ht.ReadWrite,a.depthRangeFor3D),z=a.transform,F=m.mesh,q=F.material,$=q.pbrMetallicRoughness,K=a.style.fog;let te;te=a.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:o.az([],g.zScaleMatrix,m.nodeModelMatrix),o.az(te,g.negCameraPosMatrix,te);const ee=o.bi([],te);o.ea(ee,ee);const re=u.paint.get("model-color-use-theme").constantOr("default")==="none",ie=u.paint.get("model-emissive-strength").constantOr(0),ue=t0(new Float32Array(m.worldViewProjection),new Float32Array(te),new Float32Array(ee),null,a,E,$.baseColorFactor,q.emissiveFactor,$.metallicFactor,$.roughnessFactor,q,ie,u),pe={defines:[]},me=[],Te=a.shadowRenderer;Te&&(Te.useNormalOffset=!1),up(pe.defines,me,F,a,re?null:u.lut);let we=null;if(K){const Se=cp(m.nodeModelMatrix,a.transform);if(we=new Float32Array(Se),z.projection.name!=="globe"){const Ee=F.aabb.min,Ve=F.aabb.max,[De,dt]=K.getOpacityForBounds(Se,Ee[0],Ee[1],Ve[0],Ve[1]);pe.overrideFog=De>=gt||dt>=gt}}const Pe=yl(a,u.paint.get("model-cutoff-fade-range"));Pe.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const be=a.getOrCreateProgram("model",pe);a.uploadCommonUniforms(P,be,null,we,Pe),a.renderPass!=="shadow"&&Te&&Te.setupShadowsFromMatrix(m.nodeModelMatrix,be),be.draw(a,P.gl.TRIANGLES,I,x,b,F.material.doubleSided?ur.disabled:ur.backCCW,ue,u.id,F.vertexBuffer,F.indexBuffer,F.segments,u.paint,a.transform.zoom,void 0,me)}function d0(m,a,u,g,x,b,E){let P;P=m.projection.name==="globe"?o.er(u,m):[...u],o.az(P,P,a.matrix);const I=o.az([],g,P);if(a.meshes)for(const z of a.meshes){if(z.material.alphaMode!=="BLEND"){E.push({mesh:z,depth:0,modelIndex:x,worldViewProjection:I,nodeModelMatrix:P});continue}const F=o.ad([],z.centroid,I);!m.isOrthographic&&F[2]<=0||b.push({mesh:z,depth:F[2],modelIndex:x,worldViewProjection:I,nodeModelMatrix:P})}if(a.children)for(const z of a.children)d0(m,z,u,g,x,b,E)}function Cg(m,a,u,g){const x=u.shadowRenderer;if(!x)return;const b=x.getShadowPassDepthMode(),E=x.getShadowPassColorMode(),P=x.calculateShadowPassMatrixFromMatrix(a),I=W1(P);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,b,mr.disabled,E,ur.backCCW,I,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,u.transform.zoom,void 0,void 0)}function dd(m,a,u){const g=a.updateZoomBasedPaintProperties(),x=function(b,E,P){let I,z,F,q=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&q>0){const $=b.terrain,K=$.findDEMTileFor(P);K&&K.dem?I=o.eu.create($,P,K):q=0}if(q===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),q===E.validForExaggeration&&(q===0||I&&I._demTile&&I._demTile.tileID===E.validForDEMTile.id&&I._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const $ in E.instancesPerModel){const K=E.instancesPerModel[$];for(let te=0;te<K.instancedDataArray.length;++te){const ee=(I?q*I.getElevationAt(0|K.instancedDataArray.float32[16*te],0|K.instancedDataArray.float32[16*te+1],!0,!0):0)+K.instancesEvaluatedElevation[te];K.instancedDataArray.float32[16*te+6]=ee,z=z?Math.min(E.terrainElevationMin,ee):ee,F=F?Math.max(E.terrainElevationMax,ee):ee}}return E.terrainElevationMin=z||0,E.terrainElevationMax=F||0,E.validForExaggeration=q,E.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,a,u);(g||x)&&(a.uploaded=!1,a.upload(m.context))}const vl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d6([0,0,0],[o.aj,o.aj,0])};function qC(m,a){const u=1<<m.canonical.z,g=a.getFreeCameraOptions().position,x=a.elevation,b=m.canonical.x/u,E=(m.canonical.x+1)/u,P=m.canonical.y/u,I=(m.canonical.y+1)/u;let z=a._centerAltitude;if(x){const K=x.getMinMaxForTile(m);K&&K.max>z&&(z=K.max)}const F=o.ay(g.x,b,E)-g.x,q=o.ay(g.y,P,I)-g.y,$=o.cb(z,a.center.lat)-g.z;return a._zoomFromMercatorZ(Math.sqrt(F*F+q*q+$*$))}function f0(m,a,u,g,x,b,E){const P=m.context,I=m.renderPass==="shadow",z=m.shadowRenderer,F=I&&z?z.getShadowPassDepthMode():new Ht(P.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D),q=m.isTileAffectedByFog(b);if(u.meshes)for(const $ of u.meshes){const K=["MODEL_POSITION_ON_GPU"],te=[];let ee,re,ie;g.instancedDataArray.length>20&&K.push("INSTANCED_ARRAYS");const ue=yl(m,a.paint.get("model-cutoff-fade-range"));if(ue.shouldRenderCutoff&&K.push("RENDER_CUTOFF"),I&&z)ee=m.getOrCreateProgram("modelDepth",{defines:K}),re=W1(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(u.matrix)),ie=z.getShadowPassColorMode();else{up(K,te,$,m,a.paint.get("model-color-use-theme").constantOr("default")==="none"?null:a.lut),ee=m.getOrCreateProgram("model",{defines:K,overrideFog:q});const me=$.material,Te=me.pbrMetallicRoughness,we=a.paint.get("model-opacity").constantOr(1),Pe=a.paint.get("model-emissive-strength").constantOr(0);re=t0(b.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,m,we,Te.baseColorFactor,me.emissiveFactor,Te.metallicFactor,Te.roughnessFactor,me,Pe,a,x),z&&(E.shadowUniformsInitialized?ee.setShadowUniformValues(P,z.getShadowUniformValues()):(z.setupShadows(b.toUnwrapped(),ee,"model-tile"),E.shadowUniformsInitialized=!0)),ie=ue.shouldRenderCutoff||we<1||me.alphaMode!=="OPAQUE"?Or.alphaBlended:Or.unblended}m.uploadCommonUniforms(P,ee,b.toUnwrapped(),null,ue);const pe=$.material.doubleSided?ur.disabled:ur.backCCW;if(g.instancedDataArray.length>20)te.push(g.instancedDataBuffer),ee.draw(m,P.gl.TRIANGLES,F,mr.disabled,ie,pe,re,a.id,$.vertexBuffer,$.indexBuffer,$.segments,a.paint,m.transform.zoom,void 0,te,g.instancedDataArray.length);else{const me=I?"u_instance":"u_normal_matrix";for(let Te=0;Te<g.instancedDataArray.length;++Te)re[me]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Te,16),ee.draw(m,P.gl.TRIANGLES,F,mr.disabled,ie,pe,re,a.id,$.vertexBuffer,$.indexBuffer,$.segments,a.paint,m.transform.zoom,void 0,te)}}if(u.children)for(const $ of u.children)f0(m,a,$,g,x,b,E)}const Pg=[1,-1,1];function p0(m,a,u,g){if(!u.modelManager)return!0;const x=u.modelManager;if(!u.shadowRenderer)return!0;const b=u.shadowRenderer,E=a.aabb;let P=!0,I=m.maxHeight;if(I===0){let F=0;for(const q in m.instancesPerModel){const $=x.getModel(q,g);$?F=Math.max(F,Math.max(Math.max($.aabb.max[0],$.aabb.max[1]),$.aabb.max[2])):P=!1}I=m.maxScale*F*1.41+m.maxVerticalOffset,P&&(m.maxHeight=I)}E.max[2]=I,E.min[2]+=m.terrainElevationMin,E.max[2]+=m.terrainElevationMax,o.ad(E.min,E.min,a.tileMatrix),o.ad(E.max,E.max,a.tileMatrix);const z=E.intersects(b.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=z===2),z===0}function rS(m,a){const u=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],x=m.uniformValues.u_cutoff_params[2],b=m.uniformValues.u_cutoff_params[3];return g===u||b===x?1:o.ay(((a-u)/(g-u)-x)/(b-x),0,1)}function nS(m,a,u,g){if(a.pitch<20)return 1;const x=a.getWorldToCameraMatrix();o.az(x,x,m);const b=o.bR(u.min[0],u.min[1],u.min[2],1);let E=o.aA(o.ev(),b,x),P=E,I=E;b[1]=u.max[1],E=o.aA(o.ev(),b,x),P=E[1]<P[1]?E:P,I=E[1]>I[1]?E:I,b[0]=u.max[0],E=o.aA(o.ev(),b,x),P=E[1]<P[1]?E:P,I=E[1]>I[1]?E:I,b[1]=u.min[1],E=o.aA(o.ev(),b,x),P=E[1]<P[1]?E:P,I=E[1]>I[1]?E:I;const z=o.ay(g[0],0,1),F=100*a.pixelsPerMeter*o.ay(g[1],0,1),q=o.ay(g[2],0,1),$=o.ew(o.ev(),P,I,z),K=Math.tan(.5*a.fovX),te=-$[2]*K;if(F===0)return $[1]<-Math.abs(te)?q:1;const ee=(-Math.abs(te)-$[1])/F,re=(ue,pe,me)=>(1-me)*ue+me*pe,ie=o.ay(re(1,q,ee),q,1);return re(1,ie,o.ay((a.pitch-20)/20,0,1))}class Mg{}class hp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,u,g){{const q=this._storage.get(u.id);if(q)return q.lastUsedFrameIdx=a,q.buf}const x=g.gl,b=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),E=new ArrayBuffer(b),P=new Int16Array(E);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const I=new o.ey;for(let q=0;q<b/2;q+=3){const $=P[q],K=P[q+1],te=P[q+2];I.emplaceBack($,K),I.emplaceBack(K,te),I.emplaceBack(te,$)}const z=g.bindVertexArrayOES.current,F=new Mg;return F.buf=new qc(g,I),F.lastUsedFrameIdx=a,this._storage.set(u.id,F),g.bindVertexArrayOES.set(z),F.buf}update(a){for(const[u,g]of this._storage)a-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(u))}destroy(){for(const[a,u]of this._storage)u.buf.destroy(),this._storage.delete(a)}}class fd{constructor(a){this.occluderSize=30,this.depthOffset=-1e-4,a.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),a.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const iS=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class HC{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Zo{constructor(a,u){this.revealStart=11,this.revealRange=2,a.registerParameter(this,[...u,"Reveal"],"revealStart",{min:0,max:17,step:.05}),a.registerParameter(this,[...u,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const WC=o.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class dp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(a,u){const g=a.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new o.ez,P=new o.a_;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),P.emplaceBack(0,1,2),P.emplaceBack(0,2,3),this.vignetteVx=a.context.createVertexBuffer(E,WC.members),this.vignetteIdx=a.context.createIndexBuffer(P)}const x=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){a.uploadCommonUniforms(a.context,g);const E={u_vignetteShape:(b={vignetteShape:[u.start,u.range,Math.pow(10,u.fadePower)],vignetteColor:[u.color.r,u.color.g,u.color.b,u.color.a*u.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};g.draw(a,a.context.gl.TRIANGLES,Ht.disabled,mr.disabled,Or.alphaBlended,ur.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,x)}var b}}class ei{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(a,u){const g=a.getFreeCameraOptions().position,x=g.toAltitude(),b=g.toLngLat(),E=o.al(b.lng),P=o.al(b.lat),I=a.pixelsPerMeter/u,z=E*o.eB,F=o.eB*Math.log(Math.tan(Math.PI/4+P/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const q=-this._offsetYPrev+F,$=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*I,this._accumulatedOffsetY+=q*I,this._accumulatedElevation+=$*I,this._offsetXPrev=z,this._offsetYPrev=F,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Yr(m,a){return[-(m[0]-Math.floor(m[0]/a)*a),-(m[1]-Math.floor(m[1]/a)*a),-(m[2]-Math.floor(m[2]/a)*a)]}function m0(m){const a=o.el(1323123451230),u=[];for(let g=0;g<m;++g){const x=2*a()-1,b=2*a()-1,E=2*a()-1;u.push(o.d2(x,b,E))}return u}function Ma(m,a,u,g,x){const b=o.ay((x-u)/(g-u),0,1);return(1-b)*m+b*a}class pd{constructor(a){this._movement=new ei,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new dp,this._ppmScaleFactor=a}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(a,u){const g=a.transform;this._movement.update(g,this._ppmScaleFactor);const x=g.starsProjMatrix,b=o.c3([]);o.c5(b,b,o.al(90)-g._pitch),o.c4(b,b,-g.angle);const E=o.c8(new Float32Array(16),b),P=o.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),I=o.ea([],P),z=o.az([],I,E),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*u,this._prevTime=F,{projectionMatrix:x,modelviewMatrix:z}}}class md extends pd{constructor(a){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Zo(a.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(a){const u=a.context;if(!this.particlesVx){const g=m0(this.particlesCount),x=new o.eC,b=new o.a_;let E=0;const P=o.el(1323123451230);for(let I=0;I<g.length;++I){const z=g[I],F=[2*P()-1,P(),P(),P()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...F),x.emplaceBack(z[0],z[1],z[2],1,-1,...F),x.emplaceBack(z[0],z[1],z[2],1,1,...F),x.emplaceBack(z[0],z[1],z[2],-1,1,...F),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=u.createVertexBuffer(x,iS.members),this.particlesIdx=u.createIndexBuffer(b)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.rain)return;const u=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=a.transform.zoom;if(u.revealStart>g)return;const x=Ma(0,1,u.revealStart,u.revealStart+u.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let E=[-b.direction.x,b.direction.y,-100];o.au(E,E);const P=structuredClone(this._vignetteParams);P.strength*=x,b.overrideStyleParameters||(b.intensity=a.style.rain.state.density,b.timeFactor=a.style.rain.state.intensity,b.color=structuredClone(a.style.rain.state.color),E=structuredClone(a.style.rain.state.direction),b.screenThinning.intensity=a.style.rain.state.centerThinning,b.dropletSizeX=a.style.rain.state.dropletSize[0],b.dropletSizeYScale=a.style.rain.state.dropletSize[1]/a.style.rain.state.dropletSize[0],b.distortionStrength=100*a.style.rain.state.distortionStrength,P.strength=1,P.color=structuredClone(a.style.rain.state.vignetteColor));const I=this.updateOnRender(a,b.timeFactor),z=a.context,F=z.gl,q=a.transform;this.screenTexture&&this.screenTexture.size[0]===a.width&&this.screenTexture.size[1]===a.height||(this.screenTexture=new o.T(z,{width:a.width,height:a.height,data:null},F.RGBA8)),b.distortionStrength>0&&(z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,a.width,a.height));const $=a.getOrCreateProgram("rainParticle");a.uploadCommonUniforms(z,$),z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const K=[b.color.r,b.color.g,b.color.b,b.color.a],te=(ee,re)=>{const ie=Yr(this._movement.getPosition(),ee),ue=b.dropletSizeX,pe=b.dropletSizeX*b.dropletSizeYScale,me=a.width/2,Te=a.height/2,we=Ma(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Pe=Ma(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),be=Ma(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Se=(Ee={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:ee,rainDropletSize:[ue,pe],distortionStrength:b.distortionStrength,rainDirection:E,color:K,screenSize:[q.width,q.height],thinningCenterPos:[me,Te],thinningShape:[we,Pe,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:re?0:1},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_texScreen:0,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_boxSize:Ee.boxSize,u_rainDropletSize:Ee.rainDropletSize,u_distortionStrength:Ee.distortionStrength,u_rainDirection:Ee.rainDirection,u_color:Ee.color,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_shapeDirectionalPower:Ee.shapeDirectionalPower,u_shapeNormalPower:Ee.shapeNormalPower,u_mode:Ee.mode});var Ee;const Ve=Math.round(b.intensity*this.particlesCount),De=o.bd.simpleSegment(0,0,4*Ve,2*Ve);$.draw(a,F.TRIANGLES,Ht.disabled,mr.disabled,Or.alphaBlended,ur.disabled,Se,"rain_particles",this.particlesVx,this.particlesIdx,De)};b.distortionStrength>0&&te(b.boxSize,!0),te(b.boxSize,!1),this._vignette.draw(a,P)}}const Yu=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class g0 extends pd{constructor(a){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Zo(a.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(a){const u=a.context;if(!this.particlesVx){const g=m0(this.particlesCount),x=new o.eD,b=new o.a_;let E=0;const P=o.el(1323123451230);for(let I=0;I<g.length;++I){const z=g[I],F=P(),q=P(),$=P(),K=[I/g.length,F,q,$],te=[P(),P()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...K,...te),x.emplaceBack(z[0],z[1],z[2],1,-1,...K,...te),x.emplaceBack(z[0],z[1],z[2],1,1,...K,...te),x.emplaceBack(z[0],z[1],z[2],-1,1,...K,...te),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=u.createVertexBuffer(x,Yu.members),this.particlesIdx=u.createIndexBuffer(b)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.snow)return;const u=structuredClone(this._params);let g=[-u.direction.x,u.direction.y,-100];o.au(g,g);const x=structuredClone(this._vignetteParams),b=u.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=a.transform.zoom;if(b.revealStart>E)return;const P=Ma(0,1,b.revealStart,b.revealStart+b.revealRange,E);x.strength*=P,u.overrideStyleParameters||(u.intensity=a.style.snow.state.density,u.timeFactor=a.style.snow.state.intensity,u.color=structuredClone(a.style.snow.state.color),g=structuredClone(a.style.snow.state.direction),u.screenThinning.intensity=a.style.snow.state.centerThinning,u.billboardSize=2.79*a.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(a.style.snow.state.vignetteColor));const I=this.updateOnRender(a,u.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=a.context,F=z.gl,q=a.transform,$=a.getOrCreateProgram("snowParticle");a.uploadCommonUniforms(z,$),((K,te,ee)=>{const re=Yr(this._movement.getPosition(),K),ie=q.width/2,ue=q.height/2,pe=Ma(0,ee.screenThinning.start,0,1,ee.screenThinning.intensity),me=Ma(.001,ee.screenThinning.range,0,1,ee.screenThinning.intensity),Te=Ma(0,ee.screenThinning.particleOffset,0,1,ee.screenThinning.intensity),we=(Pe={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:ee.velocityConeAperture,velocity:ee.velocity,horizontalOscillationRadius:ee.horizontalOscillationRadius,horizontalOscillationRate:ee.horizontalOscillationRate,boxSize:K,billboardSize:1*ee.billboardSize,simpleShapeParameters:[ee.shapeFadeStart,ee.shapeFadePower],screenSize:[q.width,q.height],thinningCenterPos:[ie,ue],thinningShape:[pe,me,Math.pow(10,ee.screenThinning.fadePower)],thinningAffectedRatio:ee.screenThinning.affectedRatio,thinningParticleOffset:Te,color:[ee.color.r,ee.color.g,ee.color.b,ee.color.a],direction:g},{u_modelview:Float32Array.from(Pe.modelview),u_projection:Float32Array.from(Pe.projection),u_time:Pe.time,u_cam_pos:Pe.camPos,u_velocityConeAperture:Pe.velocityConeAperture,u_velocity:Pe.velocity,u_horizontalOscillationRadius:Pe.horizontalOscillationRadius,u_horizontalOscillationRate:Pe.horizontalOscillationRate,u_boxSize:Pe.boxSize,u_billboardSize:Pe.billboardSize,u_simpleShapeParameters:Pe.simpleShapeParameters,u_screenSize:Pe.screenSize,u_thinningCenterPos:Pe.thinningCenterPos,u_thinningShape:Pe.thinningShape,u_thinningAffectedRatio:Pe.thinningAffectedRatio,u_thinningParticleOffset:Pe.thinningParticleOffset,u_particleColor:Pe.color,u_direction:Pe.direction});var Pe;const be=Math.round(ee.intensity*this.particlesCount),Se=o.bd.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&$.draw(a,F.TRIANGLES,Ht.disabled,mr.disabled,Or.alphaBlended,ur.disabled,we,"snow_particles",this.particlesVx,this.particlesIdx,Se)})(u.boxSize,0,u),this._vignette.draw(a,x)}}const y0={symbol:function(m,a,u,g,x){if(m.renderPass!=="translucent")return;const b=mr.disabled,E=m.colorModeForRenderPass(),P=u.layout.get("text-variable-anchor"),I=u.layout.get("text-size-scale-range"),z=o.ay(m.scaleFactor,I[0],I[1]);P&&function($,K,te,ee,re,ie,ue,pe){const me=K.transform,Te=re==="map",we=ie==="map";for(const Pe of $){const be=ee.getTile(Pe),Se=be.getBucket(te);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const Ee=o.bH(Se.textSizeData,me.zoom,pe),Ve=qm(Pe,Se.getProjection(),me),De=me.calculatePixelsToTileUnitsMatrix(be),dt=Vf(Ve,be.tileID.canonical,we,Te,me,Se.getProjection(),De),Je=Se.hasIconTextFit()&&Se.hasIconData();Ee&&K1(Se,Te,we,ue,me,dt,Pe,Math.pow(2,me.zoom-be.tileID.overscaledZ),Ee,Je)}}(g,m,u,a,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),x,z);const F=u.paint.get("icon-opacity").constantOr(1)!==0,q=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||q)?a0(m,a,u,g,b,E):(F&&a0(m,a,u,g,b,E,{onlyIcons:!0}),q&&a0(m,a,u,g,b,E,{onlyText:!0})),a.map.showCollisionBoxes&&(i0(m,a,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),i0(m,a,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,u,g){if(m.renderPass!=="translucent")return;const x=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),E=u.paint.get("circle-stroke-opacity"),P=u.layout.get("circle-sort-key").constantOr(1)!==void 0,I=u.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;const z=m.context,F=z.gl,q=m.transform,$=!(!m.terrain||!m.terrain.enabled),K=u.layout.get("circle-elevation-reference"),te=m.depthModeForSublayer(0,Ht.ReadOnly),ee=new Ht(m.context.gl.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D),re=K==="none"||$?te:ee,ie=mr.disabled,ue=m.colorModeForDrapableLayerRenderPass(I),pe=q.projection.name==="globe",me=[o.aD(q.center.lng),o.aH(q.center.lat)],Te=[];for(let Pe=0;Pe<g.length;Pe++){const be=g[Pe],Se=a.getTile(be),Ee=Se.getBucket(u);if(!Ee||Ee.projection.name!==q.projection.name)continue;const Ve=Ee.programConfigurations.get(u.id),De=Ee.layoutVertexBuffer,dt=Ee.globeExtVertexBuffer,Je=Ee.indexBuffer,pt=o.dW(u),Ct=[dt],We=m.isTileAffectedByFog(be);pe&&pt.push("PROJECTION_GLOBE_VIEW"),pt.push("DEPTH_D24"),m.terrain&&q.depthOcclusionForSymbolsAndCircles&&pt.push("DEPTH_OCCLUSION"),Ee.hasElevation&&!m.terrain&&(pt.push("ELEVATED_ROADS"),Ct.push(Ee.elevatedLayoutVertexBuffer));const Re=m.getOrCreateProgram("circle",{config:Ve,defines:pt,overrideFog:We}),nt=q.projection.createInversionMatrix(q,be.canonical),Ze={programConfiguration:Ve,program:Re,layoutVertexBuffer:De,dynamicBuffers:Ct,indexBuffer:Je,uniformValues:o.dX(m,be,Se,nt,me,u),tile:Se};if(P){const yt=Ee.segments.get();for(const bt of yt)Te.push({segments:new o.bd([bt]),sortKey:bt.sortKey,state:Ze})}else Te.push({segments:Ee.segments,sortKey:0,state:Ze})}P&&Te.sort((Pe,be)=>Pe.sortKey-be.sortKey);const we={useDepthForOcclusion:q.depthOcclusionForSymbolsAndCircles};for(const Pe of Te){const{programConfiguration:be,program:Se,layoutVertexBuffer:Ee,dynamicBuffers:Ve,indexBuffer:De,uniformValues:dt,tile:Je}=Pe.state,pt=Pe.segments;m.terrain&&m.terrain.setupElevationDraw(Je,Se,we),m.uploadCommonUniforms(z,Se,Je.tileID.toUnwrapped()),Se.draw(m,F.TRIANGLES,re,ie,ue,ur.disabled,dt,u.id,Ee,De,pt,u.paint,q.zoom,be,Ve)}},heatmap:function(m,a,u,g){if(u.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,b=x.gl,E=mr.disabled,P=new Or([b.ONE,b.ONE,b.ONE,b.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(K,te,ee,re){const ie=K.gl,ue=te.width*re,pe=te.height*re;K.activeTexture.set(ie.TEXTURE1),K.viewport.set([0,0,ue,pe]);let me=ee.heatmapFbo;if(!me||me&&(me.width!==ue||me.height!==pe)){me&&me.destroy();const Te=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,Te),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),me=ee.heatmapFbo=K.createFramebuffer(ue,pe,!0,null),function(we,Pe,be,Se,Ee,Ve){const De=we.gl;De.texImage2D(De.TEXTURE_2D,0,we.extRenderToTextureHalfFloat?De.RGBA16F:De.RGBA,Ee,Ve,0,De.RGBA,we.extRenderToTextureHalfFloat?De.HALF_FLOAT:De.UNSIGNED_BYTE,null),Se.colorAttachment.set(be)}(K,0,Te,me,ue,pe)}else ie.bindTexture(ie.TEXTURE_2D,me.colorAttachment.get()),K.bindFramebuffer.set(me.framebuffer)})(x,m,u,m.transform.projection.name==="globe"?.5:.25),x.clear({color:o.am.transparent});const I=m.transform,z=I.projection.name==="globe",F=z?["PROJECTION_GLOBE_VIEW"]:[],q=z?ur.frontCCW:ur.disabled,$=[o.aD(I.center.lng),o.aH(I.center.lat)];for(let K=0;K<g.length;K++){const te=g[K];if(a.hasRenderableParent(te))continue;const ee=a.getTile(te),re=ee.getBucket(u);if(!re||re.projection.name!==I.projection.name)continue;const ie=m.isTileAffectedByFog(te),ue=re.programConfigurations.get(u.id),pe=m.getOrCreateProgram("heatmap",{config:ue,defines:F,overrideFog:ie}),{zoom:me}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ee,pe),m.uploadCommonUniforms(x,pe,te.toUnwrapped());const Te=I.projection.createInversionMatrix(I,te.canonical);pe.draw(m,b.TRIANGLES,Ht.disabled,E,P,q,$1(m,te,ee,Te,$,me,u.paint.get("heatmap-intensity")),u.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,u.paint,m.transform.zoom,ue,z?[re.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,b){const E=x.context,P=E.gl,I=b.heatmapFbo;if(!I)return;E.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,I.colorAttachment.get()),E.activeTexture.set(P.TEXTURE1);let z=b.colorRampTexture;z||(z=b.colorRampTexture=new o.T(E,b.colorRamp,P.RGBA8)),z.bind(P.LINEAR,P.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,P.TRIANGLES,Ht.disabled,mr.disabled,x.colorModeForRenderPass(),ur.disabled,((F,q,$,K)=>({u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(m,u))},line:function(m,a,u,g){if(m.renderPass!=="translucent")return;const x=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const E=u.paint.get("line-emissive-strength"),P=u.paint.get("line-occlusion-opacity"),I=u.layout.get("line-elevation-reference"),z=u.layout.get("line-width-unit")==="meters",F=I==="sea",q=!(!m.terrain||!m.terrain.enabled),$=m.context,K=$.gl;if(u.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const te=u.layout.get("line-cross-slope"),ee=te!==void 0,re=te<1,ie=m.colorModeForDrapableLayerRenderPass(E),ue=m.terrain&&m.terrain.renderingToTexture,pe=ue?1:o.q.devicePixelRatio,me=u.paint.get("line-dasharray"),Te=me.constantOr(1),we=u.layout.get("line-cap"),Pe=me.constantOr(null),be=we.constantOr(null),Se=u.paint.get("line-pattern"),Ee=Se.constantOr(1),Ve=u.paint.get("line-pattern-cross-fade"),De=Se.constantOr(null),dt=u.paint.get("line-opacity").constantOr(1);let Je=!Ee&&dt!==1||m.depthOcclusion&&P>0&&P<1;const pt=u.paint.get("line-gradient"),Ct=Ee?"linePattern":"line",We=o.dY(u);let Re;if(ue&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Je=!1),P!==0&&m.depthOcclusion){const bt=u.paint._values["line-opacity"];bt&&bt.value&&bt.value.kind==="constant"?Re=bt.value:o.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&We.push("VARIABLE_LINE_WIDTH");const nt=(bt,Et,jt,tr,ir,Zt)=>{for(const er of bt){const nr=a.getTile(er);if(Ee&&!nr.patternsLoaded())continue;const wr=nr.getBucket(u);if(!wr||wr.elevationType!=="none"&&!ir||wr.elevationType==="none"&&ir)continue;m.prepareDrawTile();const Cr=[...Et],Nr=m.shadowRenderer,Cn=wr.elevationType==="road"&&!!Nr&&Nr.enabled;let vr=[0,0,0];if(Cn){const rn=m.style.directionalLight,xn=m.style.ambientLight;rn&&xn&&(vr=Vu(m.style,rn,xn)),Cr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const un=wr.programConfigurations.get(u.id);let hn=!1;if(De&&nr.imageAtlas){const rn=o.dZ.from(De),xn=rn.getPrimary().scaleSelf(pe).toString(),Ln=nr.imageAtlas.patternPositions.get(xn),Ei=rn.getSecondary(),Oi=Ei?nr.imageAtlas.patternPositions.get(Ei.scaleSelf(pe).toString()):null;hn=!!Ln&&!!Oi,Ln&&un.setConstantPatternPositions(Ln,Oi)}Ve>0&&(hn||un.getPatternTransitionVertexBuffer("line-pattern"))&&Cr.push("LINE_PATTERN_TRANSITION");const Zn=m.isTileAffectedByFog(er),Mr=m.getOrCreateProgram(Ct,{config:un,defines:Cr,overrideFog:Zn});if(!Ee&&Pe&&be&&nr.lineAtlas){const rn=nr.lineAtlas.getDash(Pe,be);rn&&un.setConstantPatternPositions(rn)}Cn&&Nr.setupShadows(nr.tileID.toUnwrapped(),Mr,"vector-tile");let[an,cn]=u.paint.get("line-trim-offset");(be==="round"||be==="square")&&an!==cn&&(an===0&&(an-=1),cn===1&&(cn+=1));const vn=ue?er.projMatrix:null,hi=z?1/wr.tileToMeter/o.aw(nr,1,m.transform.zoom):1,kr=z?1/wr.tileToMeter/o.aw(nr,1,Math.floor(m.transform.zoom)):1,mn=Ee?o.d_(m,nr,u,vn,pe,hi,kr,[an,cn],vr,Ve):o.d$(m,nr,u,vn,wr.lineClipsArray.length,pe,hi,kr,[an,cn],vr);if(pt){const rn=wr.gradients[u.id];let xn=rn.texture;if(u.gradientVersion!==rn.version){let Ln=256;if(u.stepInterpolant){const Ei=a.getSource().maxzoom,Oi=er.canonical.z===Ei?Math.ceil(1<<m.transform.maxZoom-er.canonical.z):1;Ln=o.ay(o.e0(wr.maxLineLength/o.aj*1024*Oi),256,$.maxTextureSize)}rn.gradient=o.e1({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Ln,image:rn.gradient||void 0,clips:wr.lineClipsArray}),rn.texture?rn.texture.update(rn.gradient):rn.texture=new o.T($,rn.gradient,K.RGBA8),rn.version=u.gradientVersion,xn=rn.texture}$.activeTexture.set(K.TEXTURE1),xn.bind(u.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}Te&&($.activeTexture.set(K.TEXTURE0),nr.lineAtlasTexture&&nr.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),un.updatePaintBuffers()),Ee&&($.activeTexture.set(K.TEXTURE0),nr.imageAtlasTexture&&nr.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),un.updatePaintBuffers()),ir&&!F&&m.terrain.setupElevationDraw(nr,Mr),m.uploadCommonUniforms($,Mr,er.toUnwrapped());const mi=rn=>{Re!=null&&(Re.value=dt*P),Mr.draw(m,K.TRIANGLES,jt,rn,ie,ur.disabled,mn,u.id,wr.layoutVertexBuffer,wr.indexBuffer,wr.segments,u.paint,m.transform.zoom,un,[wr.layoutVertexBuffer2,wr.patternVertexBuffer,wr.zOffsetVertexBuffer]),Re!=null&&(Re.value=dt)};if(Je&&!ir){const rn=m.stencilModeForClipping(er).ref;rn===0&&ue&&$.clear({stencil:0});const xn={func:K.EQUAL,mask:255};mn.u_alpha_discard_threshold=.8,mi(new mr(xn,rn,255,K.KEEP,K.KEEP,K.INVERT)),mn.u_alpha_discard_threshold=0,mi(new mr(xn,rn,255,K.KEEP,K.KEEP,K.KEEP))}else mn.u_alpha_discard_threshold=Je&&ir&&Zt?.8:0,mi(ir?tr:m.stencilModeForClipping(er))}};let Ze=m.depthModeForSublayer(0,Ht.ReadOnly);const yt=new Ht(m.depthOcclusion?K.GREATER:K.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D);if(u.hasNonElevatedBuckets){const bt=!ue&&m.terrain;P!==0&&bt?o.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has line-z-offset enabled.`):bt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${u.id}.`):nt(g,We,Ze,mr.disabled,!1,!0)}if(u.hasElevatedBuckets){I==="hd-road-markup"?q||(Ze=yt,We.push("ELEVATED_ROADS")):(We.push("ELEVATED"),Ze=yt,ee&&We.push(re?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&We.push("ELEVATION_REFERENCE_SEA"));const bt=Je?m.stencilModeFor3D():mr.disabled;m.forceTerrainMode=!0,nt(g,We,Ze,bt,!0,!0),Je&&nt(g,We,Ze,bt,!0,!1),m.forceTerrainMode=!1}Je&&(m.resetStencilClippingMasks(),ue&&$.clear({stencil:0})),P===0||m.depthOcclusion||ue||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,a,u,g){const x=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const E=u.paint.get("fill-emissive-strength"),P=m.colorModeForDrapableLayerRenderPass(E),I=u.paint.get("fill-pattern"),z=m.opaquePassEnabledForLayer()&&!I.constantOr(1)&&x.constantOr(o.am.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let F="none";u.layout.get("fill-elevation-reference")!=="none"?F="road":u.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const q=!(!m.terrain||!m.terrain.enabled),$={painter:m,sourceCache:a,layer:u,coords:g,colorMode:P,elevationType:F,terrainEnabled:q,pass:z};if(m.renderPass!=="shadow")if(F!=="offset"){if(Sg($,!1),F==="road"){const K=!q&&m.renderPass==="translucent";K&&Wt(m,a,u,g,"geometry"),Sg($,!0,mr.disabled),K&&function(te){const{painter:ee,sourceCache:re,layer:ie,coords:ue,colorMode:pe}=te,me=ee.context.gl,Te=te.painter.shadowRenderer,we=!!Te&&Te.enabled,Pe=new Ht(ee.context.gl.LEQUAL,Ht.ReadOnly,ee.depthRangeFor3D);let be=[0,0,0];if(we){const Ee=ee.style.directionalLight,Ve=ee.style.ambientLight;Ee&&Ve&&(be=Vu(ee.style,Ee,Ve))}const Se=Ee=>{for(const Ve of ue){const De=re.getTile(Ve),dt=De.getBucket(ie);if(!dt)continue;const Je=dt.elevatedStructures;if(!Je)continue;let pt,Ct;if(Ee?(pt=Je.renderableBridgeSegments,Ct=Je.bridgeProgramConfigurations.get(ie.id)):(pt=Je.renderableTunnelSegments,Ct=Je.tunnelProgramConfigurations.get(ie.id)),!pt||pt.segments[0].primitiveLength===0)continue;Ct.updatePaintBuffers(),ee.prepareDrawTile();const We=ee.isTileAffectedByFog(Ve),Re=[];we&&Re.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const nt=ee.getOrCreateProgram("elevatedStructures",{config:Ct,overrideFog:We,defines:Re}),Ze=ee.translatePosMatrix(Ve.projMatrix,De,ie.paint.get("fill-translate"),ie.paint.get("fill-translate-anchor"));we&&Te.setupShadows(De.tileID.toUnwrapped(),nt,"vector-tile");const yt=BC(Ze,be);ee.uploadCommonUniforms(ee.context,nt,Ve.toUnwrapped()),nt.draw(ee,me.TRIANGLES,Pe,mr.disabled,pe,ur.backCCW,yt,ie.id,Je.vertexBuffer,Je.indexBuffer,pt,ie.paint,ee.transform.zoom,Ct,[Je.vertexBufferNormal])}};Se(!0),Se(!1)}($)}}else Sg($,!1,m.stencilModeFor3D());else m.shadowRenderer&&F==="road"&&!q&&function(K){const{painter:te,sourceCache:ee,layer:re,coords:ie}=K,ue=te.context.gl,pe=K.painter.shadowRenderer;for(const me of ie){const Te=ee.getTile(me),we=Te.getBucket(re);if(!we)continue;const Pe=we.elevatedStructures;if(!Pe||!Pe.shadowCasterSegments||Pe.shadowCasterSegments.segments[0].primitiveLength===0)continue;te.prepareDrawTile();const be=we.bufferData.programConfigurations.get(re.id),Se=te.isTileAffectedByFog(me),Ee=te.getOrCreateProgram("elevatedStructuresDepth",{config:be,overrideFog:Se}),Ve=pe.calculateShadowPassMatrixFromTile(Te.tileID.toUnwrapped());te.uploadCommonUniforms(te.context,Ee,me.toUnwrapped());const De={u_matrix:Ve,u_depth_bias:0};Ee.draw(te,ue.TRIANGLES,pe.getShadowPassDepthMode(),mr.disabled,pe.getShadowPassColorMode(),ur.disabled,De,re.id,Pe.vertexBuffer,Pe.indexBuffer,Pe.shadowCasterSegments,re.paint,te.transform.zoom,be)}}($)},"fill-extrusion":function(m,a,u,g){const x=u.paint.get("fill-extrusion-opacity"),b=m.context,E=b.gl,P=m.terrain,I=P&&P.renderingToTexture;if(x===0)return;const z=m.conflationActive&&m.style.isLayerClipped(u,a.getSource()),F=m.style.order.indexOf(u.fqid);if(z&&function(q,$,K,te,ee){for(const re of te){const ie=$.getTile(re).getBucket(K);ie&&(ie.updateReplacement(re,q.replacementSource,ee),ie.uploadCentroid(q.context))}}(m,a,u,g,F),P||z)for(const q of g){const $=a.getTile(q).getBucket(u);$&&hr(m.context,a,q,$,u,P,z)}if(m.renderPass==="shadow"&&m.shadowRenderer){const q=m.shadowRenderer;if(P&&x<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const $=q.getShadowPassDepthMode(),K=q.getShadowPassColorMode();ap(m,a,u,g,$,mr.disabled,K,z)}else if(m.renderPass==="translucent"){const q=!u.paint.get("fill-extrusion-pattern").constantOr(1),$=u.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!I&&$.a!==0){const K=new Ht(m.context.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D);x===1&&q?ap(m,a,u,g,K,mr.disabled,Or.unblended,z):(ap(m,a,u,g,K,mr.disabled,Or.disabled,z),ap(m,a,u,g,K,m.stencilModeFor3D(),m.colorModeForRenderPass(),z),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&q&&(!P&&m.transform.projection.name!=="globe"||I)){const K=u.paint.get("fill-extrusion-opacity"),te=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),ee=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=u.paint.get("fill-extrusion-flood-light-intensity"),ie=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ue=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ie?null:u.lut).toArray01().slice(0,3),pe=te>0&&ee>0,me=re>0,Te=(be,Se,Ee)=>(1-Ee)*be+Ee*Se,we=new Xl;we.translate=u.paint.get("fill-extrusion-translate"),we.translateAnchor=u.paint.get("fill-extrusion-translate-anchor"),we.edgeRadius=u.layout.get("fill-extrusion-edge-radius"),we.cutoffFadeRange=u.paint.get("fill-extrusion-cutoff-fade-range");const Pe=be=>{const Se=m.depthModeForSublayer(1,Ht.ReadOnly,E.LEQUAL,!0),Ee=u.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ve=Te(.1,3,Ee),De=m._showOverdrawInspector;if(!De){const dt=new mr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Je=new Or([E.ONE,E.ONE,E.ONE,E.ONE],o.am.transparent,[!1,!1,!1,!0],E.MIN);Pa(we,m,a,u,g,Se,dt,Je,ur.disabled,be,"sdf",K,te,ee,re,ue,Ve,z,!1)}{const dt=De?mr.disabled:new mr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Je=De?m.colorModeForRenderPass():new Or([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],o.am.transparent,[!0,!0,!0,!0]);Pa(we,m,a,u,g,Se,dt,Je,ur.disabled,be,"color",K,te,ee,re,ue,Ve,z,!1)}};if(I){const be=(Se,Ee,Ve)=>{const De=m.depthModeForSublayer(1,Ht.ReadOnly,E.LEQUAL,!1),dt=u.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Je=Te(.1,3,dt);{const pt=new Or([E.ONE,E.ONE,E.ONE,E.ONE],o.am.transparent,[!1,!1,!1,!0]);Pa(we,m,a,u,g,De,mr.disabled,pt,ur.disabled,Se,"clear",K,te,ee,re,ue,Je,z,Ee)}{const pt=new mr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Ct=new Or([E.ONE,E.ONE,E.ONE,E.ONE],o.am.transparent,[!1,!1,!1,!0],E.MIN);Pa(we,m,a,u,g,De,pt,Ct,ur.disabled,Se,"sdf",K,te,ee,re,ue,Je,z,Ee)}{const pt=Se?E.ZERO:E.ONE_MINUS_DST_ALPHA,Ct=new mr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),We=new Or([pt,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],o.am.transparent,[!0,!0,!0,!0]);Pa(we,m,a,u,g,De,Ct,We,ur.disabled,Se,"color",K,te,ee,re,ue,Je,z,Ee)}{const pt=new Or([E.ONE,E.ONE,E.ONE,Se?E.ZERO:E.ONE],o.am.transparent,[!1,!1,!1,!0],Se?E.FUNC_ADD:E.MAX);Pa(we,m,a,u,g,De,mr.disabled,pt,ur.disabled,Se,"clear",K,te,ee,re,ue,Je,z,Ee,Ve)}};if(pe||me){let Se;if(m.prepareDrawTile(),P){const Ee=P.drapeBufferSize[0],Ve=P.drapeBufferSize[1];Se=P.framebufferCopyTexture,Se&&(!Se||Se.size[0]===Ee&&Se.size[1]===Ve)||(Se&&Se.destroy(),Se=P.framebufferCopyTexture=new o.T(b,new o.r({width:Ee,height:Ve}),E.RGBA8)),Se.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,Ee,Ve)}pe&&be(!0,!1,Se),me&&be(!1,!0,Se)}}else pe&&Pe(!0),me&&Pe(!1),(pe||me)&&m.resetStencilClippingMasks()}}},building:function(m,a,u,g){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const x=u.paint.get("building-ambient-occlusion-ground-intensity"),b=u.paint.get("building-ambient-occlusion-ground-radius"),E=u.paint.get("building-ambient-occlusion-ground-attenuation");let P=x>0&&b>0,I=!0;const z=u.paint.get("building-vertical-scale");z<1&&(I=!1);const F=m.conflationActive&&m.style.isLayerClipped(u,a.getSource()),q=m.style.order.indexOf(u.fqid);if(function($,K,te,ee,re,ie){for(const ue of ie){const pe=K.getTile(ue).getBucket(te);pe&&(re&&pe.updateReplacement(ue,$.replacementSource,ee),pe.uploadUpdatedIndexBuffer($.context))}}(m,a,u,q,F,g),function($,K,te,ee){for(const re of ee){const ie=K.getTile(re).getBucket(te);ie&&ie.needsEvaluation($,te)&&(ie.evaluate(te),ie.uploadUpdatedColorBuffer($.context))}}(m,a,u,g),u.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const $=m.shadowRenderer,K=[],te=$.getShadowPassDepthMode();Eg({painter:m,source:a,layer:u,coords:g,defines:K,blendMode:$.getShadowPassColorMode(),depthMode:te,verticalScale:z})}else if(m.renderPass==="translucent"){P&&function(ee,re,ie,ue,pe,me,Te,we,Pe,be,Se,Ee,Ve){const De=ee.context.gl,dt=ee.depthModeForSublayer(1,Ht.ReadOnly,De.LEQUAL,!0),Je=.1*(1-(pt=Se))+3*pt;var pt;const Ct=ee._showOverdrawInspector,We=Ee,Re=new Xl;Ct||Pa(Re,ee,re,ie,ue,dt,new mr({func:De.ALWAYS,mask:255},255,255,De.KEEP,De.KEEP,De.REPLACE),new Or([De.ONE,De.ONE,De.ONE,De.ONE],o.am.transparent,[!1,!1,!1,!0],De.MIN),ur.disabled,pe,"sdf",1,Te,we,0,be,Je,We,!1);{const nt=Ct?mr.disabled:new mr({func:De.EQUAL,mask:255},255,255,De.KEEP,De.DECR,De.DECR),Ze=Ct?ee.colorModeForRenderPass():new Or([De.ONE_MINUS_DST_ALPHA,De.DST_ALPHA,De.ONE,De.ONE],o.am.transparent,[!0,!0,!0,!0]);Pa(Re,ee,re,ie,ue,dt,nt,Ze,ur.disabled,pe,"color",1,Te,we,0,be,Je,We,!1)}}(m,a,u,g,!0,0,x,b,0,[0,0,0],E,F);let $=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];I&&($=$.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer.useNormalOffset&&($=$.concat("NORMAL_OFFSET"));const K=new Ht(m.context.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D),te=m.colorModeForRenderPass();Eg({painter:m,source:a,layer:u,coords:g,defines:$,blendMode:te,depthMode:K,verticalScale:z})}else if(m.renderPass==="light-beam"){const $=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],K=new Ht(m.context.gl.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D);Eg({painter:m,source:a,layer:u,coords:g,defines:$,blendMode:Or.alphaBlended,depthMode:K,verticalScale:z})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,a,u,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const x=m.context,b=m.terrain&&m.terrain.renderingToTexture,[E,P]=m.renderPass!=="translucent"||b?[{},g]:m.stencilConfigForOverlap(g);for(const I of P){const z=a.getTile(I);if(z.needsHillshadePrepare&&m.renderPass==="offscreen")k1(m,z,u);else if(m.renderPass==="translucent"){const F=m.depthModeForSublayer(0,Ht.ReadOnly),q=u.paint.get("hillshade-emissive-strength"),$=m.colorModeForDrapableLayerRenderPass(q),K=b&&m.terrain?m.terrain.stencilModeForRTTOverlap(I):E[I.overscaledZ];MC(m,I,z,u,F,K,$)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,a,u,g,x,b){if(m.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const E=m.transform.projection.name==="globe",P=u.paint.get("raster-elevation")!==0,I=P&&E;if(m.renderElevatedRasterBackface&&!I)return;const z=m.context,F=z.gl,q=a.getSource(),$=function(we,Pe,be,Se){const Ee=Pe.paint.get("raster-color"),Ve=we.type==="raster-array",De=[],dt=Pe.paint.get("raster-resampling"),Je=Pe.paint.get("raster-color-mix");let pt=Pe.paint.get("raster-color-range");const Ct=[Je[0],Je[1],Je[2],0],We=Je[3];let Re=dt==="nearest"?Se.NEAREST:Se.LINEAR;if(Ve&&(De.push("RASTER_ARRAY"),Ee||De.push("RASTER_COLOR"),dt==="linear"&&De.push("RASTER_ARRAY_LINEAR"),Re=Se.NEAREST,!pt&&we.rasterLayers)){const nt=we.rasterLayers.find(({id:Ze})=>Ze===Pe.sourceLayer);nt&&nt.fields&&nt.fields.range&&(pt=nt.fields.range)}if(pt=pt||[0,1],Ee){De.push("RASTER_COLOR"),be.activeTexture.set(Se.TEXTURE2),Pe.updateColorRamp(pt);let nt=Pe.colorRampTexture;nt||(nt=Pe.colorRampTexture=new o.T(be,Pe.colorRamp,Se.RGBA8)),nt.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}return{mix:Ct,range:pt,offset:We,defines:De,resampling:Re}}(q,u,z,F);if(q instanceof o.aP&&!g.length&&!E)return;const K=u.paint.get("raster-emissive-strength"),te=m.colorModeForDrapableLayerRenderPass(K),ee=m.terrain&&m.terrain.renderingToTexture,re=!m.options.moving,ie=u.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(q instanceof o.aP&&!g.length&&(q.onNorthPole||q.onSouthPole)){const we=P?m.stencilModeFor3D():mr.disabled;return void Ag(!!q.onNorthPole,null,m,a,u,K,$,ur.disabled,we)}if(!g.length)return;const[ue,pe]=q instanceof o.aP||ee?[{},g]:m.stencilConfigForOverlap(g),me=pe[pe.length-1].overscaledZ;I&&$.defines.push("PROJECTION_GLOBE_VIEW"),P&&$.defines.push("RENDER_CUTOFF");const Te=(we,Pe,be)=>{for(const Se of we){const Ee=Se.toUnwrapped(),Ve=a.getTile(Se);if(ee&&(!Ve||!Ve.hasData()))continue;z.activeTexture.set(F.TEXTURE0);const De=GC(Ve,q,u,$);if(!De||!De.texture)continue;const{texture:dt,mix:Je,offset:pt,tileSize:Ct,buffer:We}=De;let Re,nt;ee?(Re=Ht.disabled,nt=Se.projMatrix):P?(Re=new Ht(F.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D),nt=E?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Ee,re)):(Re=m.depthModeForSublayer(Se.overscaledZ-me,u.paint.get("raster-opacity")===1?Ht.ReadWrite:Ht.ReadOnly,F.LESS),nt=m.transform.calculateProjMatrix(Ee,re));const Ze=m.terrain&&ee?m.terrain.stencilModeForRTTOverlap(Se):ue[Se.overscaledZ],yt=b?0:u.paint.get("raster-fade-duration");Ve.registerFadeDuration(yt);const bt=a.findLoadedParent(Se,0),Et=Ca(Ve,bt,a,m.transform,yt);let jt,tr;m.terrain&&m.terrain.prepareDrawTile(),z.activeTexture.set(F.TEXTURE0),dt.bind(ie,F.CLAMP_TO_EDGE),z.activeTexture.set(F.TEXTURE1),bt?(bt.texture&&bt.texture.bind(ie,F.CLAMP_TO_EDGE),jt=Math.pow(2,bt.tileID.overscaledZ-Ve.tileID.overscaledZ),tr=[Ve.tileID.canonical.x*jt%1,Ve.tileID.canonical.y*jt%1]):dt.bind(ie,F.CLAMP_TO_EDGE),"useMipmap"in dt&&z.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const ir=m.transform;let Zt;const er=P?$C(ir):[0,0,0,0];let nr,wr,Cr,Nr,Cn,vr=0;if(I&&q instanceof o.aP&&q.coordinates.length>3)nr=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0)))),wr=Float32Array.from(ir.globeMatrix),Cr=Float32Array.from(o.dz(ir)),Nr=[o.aD(ir.center.lng),o.aH(ir.center.lat)],Zt=q.elevatedGlobePerspectiveTransform,Cn=q.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const Mr=o.dA(Se.canonical);vr=o.dB(Mr.getCenter().lat),nr=Float32Array.from(o.bh(o.dD(Se.canonical))),wr=Float32Array.from(ir.globeMatrix),Cr=Float32Array.from(o.dz(ir)),Nr=[o.aD(ir.center.lng),o.aH(ir.center.lat)],Zt=[0,0],Cn=Float32Array.from(o.dC(Se.canonical,Mr,vr,ir.worldSize/ir._pixelsPerMercatorPixel))}else Zt=q instanceof o.aP?q.perspectiveTransform:[0,0],nr=new Float32Array(16),wr=new Float32Array(9),Cr=new Float32Array(16),Nr=[0,0],Cn=new Float32Array(9);const un=Qv(nt,nr,wr,Cr,Cn,tr||[0,0],o.ah(m.transform.zoom),Nr,er,jt||1,Et,u,Zt,P?u.paint.get("raster-elevation"):0,2,Je,pt,$.range,Ct,We,K),hn=m.isTileAffectedByFog(Se),Zn=m.getOrCreateProgram("raster",{defines:$.defines,overrideFog:hn});if(m.uploadCommonUniforms(z,Zn,Ee),q instanceof o.aP){const Mr=q.elevatedGlobeVertexBuffer,an=q.elevatedGlobeIndexBuffer;if(ee||!E)q.boundsBuffer&&q.boundsSegments&&Zn.draw(m,F.TRIANGLES,Re,mr.disabled,te,ur.disabled,un,u.id,q.boundsBuffer,m.quadTriangleIndexBuffer,q.boundsSegments);else if(Mr&&an){const cn=ir.zoom<=o.cX?q.elevatedGlobeSegments:q.getSegmentsForLongitude(ir.center.lng);cn&&Zn.draw(m,F.TRIANGLES,Re,mr.disabled,te,Pe,un,u.id,Mr,an,cn)}}else if(I){Re=new Ht(F.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D);const Mr=m.globeSharedBuffers;if(Mr){const[an,cn,vn]=Mr.getGridBuffers(vr,!1);Zn.draw(m,F.TRIANGLES,Re,be||Ze,m.colorModeForRenderPass(),Pe,un,u.id,an,cn,vn)}}else{const{tileBoundsBuffer:Mr,tileBoundsIndexBuffer:an,tileBoundsSegments:cn}=m.getTileBoundsBuffers(Ve);Zn.draw(m,F.TRIANGLES,Re,Ze,te,ur.disabled,un,u.id,Mr,an,cn)}}if(!(q instanceof o.aP)&&I)for(const Se of we){const Ee=Se.canonical.y===(1<<Se.canonical.z)-1;Se.canonical.y===0&&Ag(!0,Se,m,a,u,K,$,Pe,be||mr.disabled),Ee&&Ag(!1,Se,m,a,u,K,$,Pe===ur.frontCW?ur.backCW:ur.frontCW,be||mr.disabled)}};I?Te(pe,m.renderElevatedRasterBackface?ur.backCW:ur.frontCW,m.stencilModeFor3D()):Te(pe,ur.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,a,u,g,x,b){m.renderPass==="offscreen"&&function(E,P,I,z){if(!z.length)return;const F=E.context,q=F.gl,$=P.getSource();if(!($ instanceof Oc))return;const K=Math.ceil(Math.sqrt(I.paint.get("raster-particle-count")));let te=I.particlePositionRGBAImage;if(!te||te.width!==K){const pe=function(me){const Te=me*me,we=new Uint8Array(4*Te),Pe=function(Se){return Se|=0,Se=Math.imul(2747636419^Se,2654435769),Se=Math.imul(Se^Se>>>16,2654435769),((Se=Math.imul(Se^Se>>>16,2654435769))>>>0)/4294967296},be=1/1.1;for(let Se=0;Se<Te;Se++){const Ee=be*(Pe(2*Se+0)+Gc),Ve=be*(Pe(2*Se+1)+Gc),De=255*Ee%1,dt=255*Ve%1,Je=De,pt=Ve-dt/255,Ct=dt;we[4*Se+0]=255*(Ee-De/255),we[4*Se+1]=255*Je,we[4*Se+2]=255*pt,we[4*Se+3]=255*Ct}return we}(K);te=I.particlePositionRGBAImage=new o.r({width:K,height:K},pe)}let ee=I.particleFramebuffer;ee?ee.width!==K&&(ee.destroy(),ee=I.particleFramebuffer=F.createFramebuffer(K,K,!0,null)):ee=I.particleFramebuffer=F.createFramebuffer(K,K,!0,null);const re=[];for(const pe of z){const me=P.getTile(pe);if(!(me instanceof $h))continue;const Te=ha(me,$,I);if(!Te)continue;const we=[me.tileSize,me.tileSize];let Pe=I.tileFramebuffer;Pe||(Pe=I.tileFramebuffer=F.createFramebuffer(we[0],we[1],!0,null));let be=me.rasterParticleState;be||(be=me.rasterParticleState=new l0(F,pe,we,te));const Se=be.update(I.lastInvalidatedAt);be.particleTextureDimension!==K&&be.updateParticleTexture(pe,te);const Ee=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=Ee;const Ve=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=Ve,re.push([pe,Te,be,Se])}if(re.length===0)return;const ie=o.q.now(),ue=I.previousDrawTimestamp?.001*(ie-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=ie,I.hasColorMap()){F.activeTexture.set(q.TEXTURE0+2);let pe=I.colorRampTexture;pe||(pe=I.colorRampTexture=new o.T(F,I.colorRamp,q.RGBA8)),pe.bind(q.LINEAR,q.CLAMP_TO_EDGE)}F.bindFramebuffer.set(I.tileFramebuffer.framebuffer),function(pe,me,Te){const we=pe.context,Pe=we.gl,be=me.tileFramebuffer;we.activeTexture.set(Pe.TEXTURE0);const Se={u_texture:0,u_opacity:1.05*(Ve=me.paint.get("raster-particle-fade-opacity-factor"))/(Ve+.05)},Ee=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ve;for(const De of Te){const[,,dt,Je]=De;be.colorAttachment.set(dt.targetColorTexture.texture),we.viewport.set([0,0,be.width,be.height]),we.clear({color:o.am.transparent}),Je&&(dt.backgroundColorTexture.bind(Pe.NEAREST,Pe.CLAMP_TO_EDGE),Ee.draw(pe,Pe.TRIANGLES,Ht.disabled,mr.disabled,Or.alphaBlended,ur.disabled,Se,me.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(E,I,re),function(pe,me,Te,we){const Pe=pe.context,be=Pe.gl,Se=Te.tileFramebuffer,Ee=pe.transform.projection.name==="globe",Ve=Te.paint.get("raster-particle-max-speed");for(const De of we){const[dt,Je,pt]=De;Pe.activeTexture.set(be.TEXTURE0+0),Je.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Se.colorAttachment.set(pt.targetColorTexture.texture);const Ct=pe.getOrCreateProgram("rasterParticleDraw",{defines:Je.defines,overrideFog:!1});Pe.activeTexture.set(be.TEXTURE0+1);const We=Je.scalarData?[]:[0,1,2,3].map(Ze=>o.e3[Ze](dt));We.push(dt);const Re=dt.canonical.x,nt=dt.canonical.y;for(const Ze of We){const yt=me.getTile(Ee?Ze.wrapped():Ze);if(!yt)continue;const bt=yt.rasterParticleState;if(!bt)continue;const Et=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-dt.wrap),jt=Ze.canonical.y;bt.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const tr=G1(1,bt.particleTexture0.size[0],[Et-Re,jt-nt],0,Je.texture.size,2,Ve,Je.textureOffset,Je.scale,Je.offset);Ct.draw(pe,be.POINTS,Ht.disabled,mr.disabled,Or.alphaBlended,ur.disabled,tr,Te.id,bt.particleIndexBuffer,void 0,bt.particleSegment)}}}(E,P,I,re),F.bindFramebuffer.set(I.particleFramebuffer.framebuffer),function(pe,me,Te,we){const Pe=pe.context,be=Pe.gl,Se=me.paint.get("raster-particle-max-speed"),Ee=we*me.paint.get("raster-particle-speed-factor")*.15,Ve=function(dt){return Math.pow(dt,6)}(.01+1*me.paint.get("raster-particle-reset-rate-factor")),De=me.particleFramebuffer;Pe.viewport.set([0,0,De.width,De.height]);for(const dt of Te){const[,Je,pt]=dt;Pe.activeTexture.set(be.TEXTURE0+0),Je.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Pe.activeTexture.set(be.TEXTURE0+1);const Ct=pt.particleTexture0;Ct.bind(be.NEAREST,be.CLAMP_TO_EDGE);const We=q1(1,Ct.size[0],0,Je.texture.size,Se,Ee,Ve,Je.textureOffset,Je.scale,Je.offset);De.colorAttachment.set(pt.particleTexture1.texture),Pe.clear({color:o.am.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:Je.defines}).draw(pe,be.TRIANGLES,Ht.disabled,mr.disabled,Or.unblended,ur.disabled,We,me.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(E,I,re,ue)}(m,a,u,g),m.renderPass==="translucent"&&(function(E,P,I,z,F){const q=E.context,$=q.gl,K=P.getSource().tileSize,te=5*(1-o.af(o.cI,o.cI+1,E.transform.zoom))*K+I.paint.get("raster-particle-elevation"),ee=!E.options.moving,re=E.transform.projection.name==="globe";if(!z.length)return;const[ie,ue]=E.stencilConfigForOverlap(z),pe=[];re&&pe.push("PROJECTION_GLOBE_VIEW");const me=E.stencilModeFor3D();for(const Te of ue){const we=Te.toUnwrapped(),Pe=P.getTile(Te);if(!Pe.rasterParticleState)continue;const be=Pe.rasterParticleState,Se=100;Pe.registerFadeDuration(Se);const Ee=P.findLoadedParent(Te,0),Ve=Ca(Pe,Ee,P,E.transform,Se);let De,dt;E.terrain&&E.terrain.prepareDrawTile(),q.activeTexture.set($.TEXTURE0),be.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),q.activeTexture.set($.TEXTURE1),Ee&&Ee.rasterParticleState?(Ee.rasterParticleState.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),De=Math.pow(2,Ee.tileID.overscaledZ-Pe.tileID.overscaledZ),dt=[Pe.tileID.canonical.x*De%1,Pe.tileID.canonical.y*De%1]):be.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const Je=re?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(we,ee),pt=E.transform,Ct=Zc(pt),We=o.dA(Te.canonical),Re=o.dB(We.getCenter().lat);let nt,Ze,yt,bt,Et;re?(nt=Float32Array.from(o.bh(o.dD(Te.canonical))),Ze=Float32Array.from(pt.globeMatrix),yt=Float32Array.from(o.dz(pt)),bt=[o.aD(pt.center.lng),o.aH(pt.center.lat)],Et=Float32Array.from(o.dC(Te.canonical,We,Re,pt.worldSize/pt._pixelsPerMercatorPixel))):(nt=new Float32Array(16),Ze=new Float32Array(9),yt=new Float32Array(16),bt=[0,0],Et=new Float32Array(9));const jt=vg(Je,nt,Ze,yt,Et,dt||[0,0],o.ah(E.transform.zoom),bt,Ct,De||1,Ve,te),tr=E.isTileAffectedByFog(Te),ir=E.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:tr});if(E.uploadCommonUniforms(q,ir,we),re){const Zt=new Ht($.LEQUAL,Ht.ReadOnly,E.depthRangeFor3D),er=0,nr=E.globeSharedBuffers;if(nr){const[wr,Cr,Nr]=nr.getGridBuffers(Re,er!==0);ir.draw(E,$.TRIANGLES,Zt,me,Or.alphaBlended,E.renderElevatedRasterBackface?ur.frontCCW:ur.backCCW,jt,I.id,wr,Cr,Nr)}}else{const Zt=E.depthModeForSublayer(0,Ht.ReadOnly),er=ie[Te.overscaledZ],{tileBoundsBuffer:nr,tileBoundsIndexBuffer:wr,tileBoundsSegments:Cr}=E.getTileBoundsBuffers(Pe);ir.draw(E,$.TRIANGLES,Zt,er,Or.alphaBlended,ur.disabled,jt,I.id,nr,wr,Cr)}}E.resetStencilClippingMasks()}(m,a,u,g),m.style.map.triggerRepaint())},background:function(m,a,u,g){const x=u.paint.get("background-color"),b=u.paint.get("background-color-use-theme").constantOr("default")==="none",E=u.paint.get("background-opacity"),P=u.paint.get("background-emissive-strength"),I=u.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const z=m.context,F=z.gl,q=m.transform,$=q.tileSize,K=u.paint.get("background-pattern");let te;if(K!==void 0&&(K===null||(te=m.imageManager.getPattern(o.I.from(K.toString()),u.scope,m.style.getLut(u.scope)),!te)))return;const ee=!K&&x.a===1&&E===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ee)return;const re=mr.disabled,ie=m.depthModeForSublayer(0,ee==="opaque"?Ht.ReadWrite:Ht.ReadOnly),ue=m.colorModeForDrapableLayerRenderPass(P),pe=K?"backgroundPattern":"background";let me,Te=g;if(Te||(me=m.getBackgroundTiles(),Te=Object.values(me).map(we=>we.tileID)),K&&(z.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context,u.scope)),I){const we=m.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),Pe=new Float32Array(o.bx([])),be=new o.aM(0,0,0,0,0),Se=K?e0(Pe,P,E,m,0,u.scope,te,I,{tileID:be,tileSize:$}):H1(Pe,P,E,x.toPremultipliedRenderColor(b?null:u.lut));we.draw(m,F.TRIANGLES,ie,re,ue,ur.disabled,Se,u.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const we of Te){const Pe=m.isTileAffectedByFog(we),be=m.getOrCreateProgram(pe,{overrideFog:Pe}),Se=we.toUnwrapped(),Ee=g?we.projMatrix:m.transform.calculateProjMatrix(Se);m.prepareDrawTile();const Ve=a?a.getTile(we):me?me[we.key]:new Du(we,$,q.zoom,m),De=K?e0(Ee,P,E,m,0,u.scope,te,I,{tileID:we,tileSize:$}):H1(Ee,P,E,x.toPremultipliedRenderColor(b?null:u.lut));m.uploadCommonUniforms(z,be,Se);const{tileBoundsBuffer:dt,tileBoundsIndexBuffer:Je,tileBoundsSegments:pt}=m.getTileBoundsBuffers(Ve);be.draw(m,F.TRIANGLES,ie,re,ue,ur.disabled,De,u.id,dt,Je,pt)}},sky:function(m,a,u){const g=m._atmosphere?o.ah(m.transform.zoom):1,x=u.paint.get("sky-opacity")*g;if(x===0)return;const b=m.context,E=u.paint.get("sky-type"),P=new Ht(b.gl.LEQUAL,Ht.ReadOnly,[0,1]),I=m.frameCounter/1e3%1;E==="atmosphere"?m.renderPass==="offscreen"?u.needsSkyboxCapture(m)&&(function(z,F,q,$){const K=z.context,te=K.gl;let ee=F.skyboxFbo;if(!ee){ee=F.skyboxFbo=K.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Xu(K),F.skyboxTexture=K.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,F.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let pe=0;pe<6;++pe)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(ee.framebuffer),K.viewport.set([0,0,32,32]);const re=F.getCenter(z,!0),ie=z.getOrCreateProgram("skyboxCapture"),ue=new Float64Array(16);o.bx(ue),o.eh(ue,ue,.5*-Math.PI),rl(z,F,ie,ue,re,0),o.bx(ue),o.eh(ue,ue,.5*Math.PI),rl(z,F,ie,ue,re,1),o.bx(ue),o.cR(ue,ue,.5*-Math.PI),rl(z,F,ie,ue,re,2),o.bx(ue),o.cR(ue,ue,.5*Math.PI),rl(z,F,ie,ue,re,3),o.bx(ue),rl(z,F,ie,ue,re,4),o.bx(ue),o.eh(ue,ue,Math.PI),rl(z,F,ie,ue,re,5),K.viewport.set([0,0,z.width,z.height])}(m,u),u.markSkyboxValid(m)):m.renderPass==="sky"&&function(z,F,q,$,K){const te=z.context,ee=te.gl,re=z.transform,ie=z.getOrCreateProgram("skybox");te.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,F.skyboxTexture);const ue=((pe,me,Te,we,Pe)=>({u_matrix:pe,u_sun_direction:me,u_cubemap:0,u_opacity:we,u_temporal_offset:Pe}))(re.skyboxMatrix,F.getCenter(z,!1),0,$,K);z.uploadCommonUniforms(te,ie),ie.draw(z,ee.TRIANGLES,q,mr.disabled,z.colorModeForRenderPass(),ur.backCW,ue,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,u,P,x,I):E==="gradient"&&m.renderPass==="sky"&&function(z,F,q,$,K){const te=z.context,ee=te.gl,re=z.transform,ie=z.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Xu(te)),te.activeTexture.set(ee.TEXTURE0);let ue=F.colorRampTexture;ue||(ue=F.colorRampTexture=new o.T(te,F.colorRamp,ee.RGBA8)),ue.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const pe=((me,Te,we,Pe,be)=>({u_matrix:me,u_color_ramp:0,u_center_direction:Te,u_radius:o.al(we),u_opacity:Pe,u_temporal_offset:be}))(re.skyboxMatrix,F.getCenter(z,!1),F.paint.get("sky-gradient-radius"),$,K);z.uploadCommonUniforms(te,ie),ie.draw(z,ee.TRIANGLES,q,mr.disabled,z.colorModeForRenderPass(),ur.backCW,pe,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,u,P,x,I)},custom:function(m,a,u,g){const x=m.context,b=u.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&u.isDraped(a)){if(m.renderPass==="offscreen"){const E=b.prerender;if(E){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const P=m.transform.pointMerc;E.call(b,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.ah(m.transform.zoom),[P.x,P.y],m.transform.pixelsPerMeterRatio)}else E.call(b,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const P=b.renderToTile;if(P){const I=g[0].canonical,z={x:I.x+g[0].wrap*(b.wrapTileId?0:1<<I.z),y:I.y,z:I.z};x.setDepthMode(Ht.disabled),x.setStencilMode(mr.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),P.call(b,x.gl,z),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(mr.disabled);const E=b.renderingMode==="3d"?new Ht(m.context.gl.LEQUAL,Ht.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Ht.ReadOnly);if(x.setDepthMode(E),m.transform.projection.name==="globe"){const P=m.transform.pointMerc;b.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.ah(m.transform.zoom),[P.x,P.y],m.transform.pixelsPerMeterRatio)}else b.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,a,u,g){if(m.renderPass==="opaque")return;const x=u.paint.get("model-opacity").constantOr(1);if(x===0)return;const b=u.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!b||m.terrain&&x<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const E=m.shadowRenderer,P=u.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,P||(E.enabled=!1));const I=()=>{E&&(E.useNormalOffset=!0,P||(E.enabled=!0))},z=a.getSource();if(m.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(ie,ue,pe,me,Te){const we=ie.transform;if(we.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${we.projection.name} projection is not yet implemented`);const Pe=we.getFreeCameraOptions().position;if(!ie.modelManager)return;const be=ie.modelManager;pe.modelManager=be;const Se=ie.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ee=pe._unevaluatedLayout._values["model-id"],Ve=Object.assign({},pe.layout.get("model-id").parameters),De=ie.style.order.indexOf(pe.fqid);for(const dt of me){const Je=ue.getTile(dt).getBucket(pe);if(!Je||Je.projection.name!==we.projection.name)continue;const pt=Je.getModelUris();pt&&!Je.modelsRequested&&(be.addModelsFromBucket(pt,Te),Je.modelsRequested=!0);const Ct=qC(dt,we);Ve.zoom=Ct;const We=Ee.possiblyEvaluate(Ve);if(dd(ie,Je,dt),vl.shadowUniformsInitialized=!1,vl.useSingleShadowCascade=!!Se&&Se.getMaxCascadeForTile(dt.toUnwrapped())===0,ie.renderPass==="shadow"&&Se){if(ie.currentShadowCascade===1&&Je.isInsideFirstShadowMapFrustum)continue;const Ze=we.calculatePosMatrix(dt.toUnwrapped(),we.worldSize);if(vl.tileMatrix.set(Ze),vl.shadowTileMatrix=Float32Array.from(Se.calculateShadowPassMatrixFromMatrix(Ze)),vl.aabb.min.fill(0),vl.aabb.max[0]=vl.aabb.max[1]=o.aj,vl.aabb.max[2]=0,p0(Je,vl,ie,pe.scope))continue}const Re=1<<dt.canonical.z,nt=[((Pe.x-dt.wrap)*Re-dt.canonical.x)*o.aj,(Pe.y*Re-dt.canonical.y)*o.aj,Pe.z*Re*o.aj];ie.conflationActive&&Object.keys(Je.instancesPerModel).length>0&&ie.style.isLayerClipped(pe,ue.getSource())&&Je.updateReplacement(dt,ie.replacementSource,De,Te)&&(Je.uploaded=!1,Je.upload(ie.context));for(let Ze in Je.instancesPerModel){const yt=Je.instancesPerModel[Ze];yt.features.length>0&&(Ze=We.evaluate(yt.features[0].feature,{}));const bt=be.getModel(Ze,Te);if(bt||be.hasURLBeenRequested(Ze)||Je.modelUris.includes(Ze)||(Je.modelUris.push(Ze),Je.modelsRequested=!1),bt&&bt.uploaded)for(const Et of bt.nodes)f0(ie,pe,Et,yt,nt,dt,vl)}}}(m,a,u,g,z.type==="vector"?u.scope:""),void I();if(!z.loaded())return;if(z.type==="batched-model")return function(ie,ue,pe,me){pe.resetLayerRenderingStats(ie);const Te=ie.context,we=ie.transform,Pe=ie.style.fog,be=ie.shadowRenderer;if(we.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${we.projection.name} projection is not yet implemented`);const Se=ie.transform.getFreeCameraOptions().position,Ee=o.c1([],[Se.x,Se.y,Se.z],ie.transform.worldSize),Ve=o.eq([],Ee),De=o.bx([]),dt=o.e9(we.center.lat,we.zoom),Je=o.bn([],[1,1,1/dt]);o.bo(De,De,Ve);const pt=pe.paint.get("model-opacity").constantOr(1),Ct=new Ht(Te.gl.LEQUAL,Ht.ReadWrite,ie.depthRangeFor3D),We=new Ht(Te.gl.LEQUAL,Ht.ReadOnly,ie.depthRangeFor3D),Re=new o.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),nt=ie.renderPass==="shadow",Ze=nt&&be?be.getCurrentCascadeFrustum():we.getFrustum(we.scaleZoom(we.worldSize)),yt=pe.paint.get("model-front-cutoff"),bt=yt[2]<1,Et=yl(ie,pe.paint.get("model-cutoff-fade-range")),jt=pe.getLayerRenderingStats();(function(tr,ir,Zt,er){const nr=tr.terrain?tr.terrain.exaggeration():0,wr=tr.transform.zoom;for(const Cr of er){const Nr=ir.getTile(Cr).getBucket(Zt);Nr&&(Nr.setFilter(Zt.filter),tr.conflationActive&&Nr.updateReplacement(Cr,tr.replacementSource),Nr.evaluateTransform(tr,Zt),tr.terrain&&nr>0&&Nr.elevationUpdate(tr.terrain,nr,Cr,Zt.source),Nr.needsReEvaluation(tr,wr,Zt)&&Nr.evaluate(Zt))}})(ie,ue,pe,me),function(){let tr,ir,Zt;bt?(tr=me.length-1,ir=-1,Zt=-1):(tr=0,ir=me.length,Zt=1);const er=new Float64Array(16),nr=o.cx(),wr=new o.P(0,0);for(let Cr=tr;Cr!==ir;Cr+=Zt){const Nr=me[Cr],Cn=ue.getTile(Nr).getBucket(pe);if(!Cn||!Cn.uploaded)continue;let vr=!1;be&&(vr=be.getMaxCascadeForTile(Nr.toUnwrapped())===0);const un=we.calculatePosMatrix(Nr.toUnwrapped(),we.worldSize),hn=Cn.modelTraits;!nt&&bt&&(o.bi(er,un),o.ad(nr,Ee,er),wr.x=nr[0],wr.y=nr[1]);const Zn=[];Cn.setFilter(pe.filter);for(const Mr of Cn.getNodesInfo()){if(Mr.hiddenByReplacement||!Mr.node.meshes)continue;const an=Mr.node;let cn=0;ie.terrain&&an.elevation&&(cn=an.elevation*ie.terrain.exaggeration());const vn=(()=>{const Do=Mr.aabb;return Re.min=[...Do.min],Re.max=[...Do.max],Re.min[2]+=cn,Re.max[2]+=cn,o.ad(Re.min,Re.min,un),o.ad(Re.max,Re.max,un),Re})(),hi=Mr.evaluatedScale;if(hi[0]<=1&&hi[1]<=1&&hi[2]<=1&&vn.intersects(Ze)===0)continue;if(!nt&&bt){const Do=.16666666666666666;Mr.cameraCollisionOpacity=Ee[0]>vn.min[0]&&Ee[0]<vn.max[0]&&Ee[1]>vn.min[1]&&Ee[1]<vn.max[1]&&Ee[2]*dt<vn.max[2]&&an.footprint&&o.bY(wr,an.footprint)?Math.max(Mr.cameraCollisionOpacity-Do,0):Math.min(1,Mr.cameraCollisionOpacity+Do)}const kr=[...un],mn=1/o.d4(Nr.canonical),mi=an.anchor?an.anchor[0]:0,rn=an.anchor?an.anchor[1]:0;o.bo(kr,kr,[mi*(hi[0]-1)+Mr.evaluatedTranslation[0]*mn,rn*(hi[1]-1)+Mr.evaluatedTranslation[1]*mn,cn+Mr.evaluatedTranslation[2]]),o.cn(hi,o.es)||o.cP(kr,kr,hi);const xn=o.az([],kr,an.matrix),Ln=o.az([],we.expandedFarZProjMatrix,xn),Ei=o.az([],we.expandedFarZProjMatrix,kr),Oi=o.aA([],[mi,rn,cn,1],Ln)[2];an.hidden=!1;let ji=pt;nt||(bt&&(ji*=Mr.cameraCollisionOpacity,ji*=nS(kr,we,Mr.aabb,yt)),ji*=rS(Et,Oi)),ji!==0?Zn.push({nodeInfo:Mr,depth:Oi,opacity:ji,wvpForNode:Ln,wvpForTile:Ei,nodeModelMatrix:xn,tileModelMatrix:kr}):an.hidden=!0}nt||Zn.sort((Mr,an)=>!bt||Mr.opacity===1&&an.opacity===1?Mr.depth<an.depth?-1:1:Mr.opacity===1?-1:an.opacity===1?1:Mr.depth>an.depth?-1:1);for(const Mr of Zn){const an=Mr.nodeInfo,cn=an.node;let vn=o.az([],Je,Mr.tileModelMatrix);o.az(vn,De,vn);const hi=o.bi([],vn);o.ea(hi,hi),o.cP(hi,hi,Pg),vn=o.az(vn,vn,cn.matrix);const kr=ie.renderPass==="light-beam",mn=pe.paint.get("model-color-use-theme").constantOr("default")==="none",mi=hn&o.ex.HasMapboxMeshFeatures,rn=mi?0:an.evaluatedRMEA[0][2];for(let xn=0;xn<cn.meshes.length;++xn){const Ln=cn.meshes[xn],Ei=xn===cn.lightMeshIndex;let Oi=Mr.wvpForNode;if(Ei){if(!kr&&!ie.terrain&&ie.shadowRenderer){ie.currentLayer<ie.firstLightBeamLayer&&(ie.firstLightBeamLayer=ie.currentLayer);continue}Oi=Mr.wvpForTile}else if(kr)continue;const ji={defines:[]},Do=[];if(!nt&&be&&(be.useNormalOffset=!!Ln.normalBuffer),up(ji.defines,Do,Ln,ie,mn?null:pe.lut),mi||ji.defines.push("DIFFUSE_SHADED"),vr&&ji.defines.push("SHADOWS_SINGLE_CASCADE"),jt&&(nt?jt.numRenderedVerticesInShadowPass+=Ln.vertexArray.length:jt.numRenderedVerticesInTransparentPass+=Ln.vertexArray.length),nt){Cg(Ln,Mr.nodeModelMatrix,ie,pe);continue}let cs=null;if(Pe){const Rs=cp(Mr.nodeModelMatrix,ie.transform);if(cs=new Float32Array(Rs),we.projection.name!=="globe"){const oi=Ln.aabb.min,Ri=Ln.aabb.max,[Vn,Di]=Pe.getOpacityForBounds(Rs,oi[0],oi[1],Ri[0],Ri[1]);ji.overrideFog=Vn>=gt||Di>=gt}}const $a=Ln.material;let fa;$a.occlusionTexture&&$a.occlusionTexture.offsetScale&&(fa=$a.occlusionTexture.offsetScale,ji.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const pa=ie.getOrCreateProgram("model",ji);!nt&&be&&be.setupShadowsFromMatrix(Mr.tileModelMatrix,pa,be.useNormalOffset),ie.uploadCommonUniforms(Te,pa,null,cs);const Ga=$a.pbrMetallicRoughness;Ga.metallicFactor=.9,Ga.roughnessFactor=.5;const js=t0(new Float32Array(Oi),new Float32Array(vn),new Float32Array(hi),new Float32Array(cn.matrix),ie,Mr.opacity,Ga.baseColorFactor,$a.emissiveFactor,Ga.metallicFactor,Ga.roughnessFactor,$a,rn,pe,[0,0,0],fa);!Ei&&(an.hasTranslucentParts||Mr.opacity<1)&&pa.draw(ie,Te.gl.TRIANGLES,Ct,mr.disabled,Or.disabled,ur.backCCW,js,pe.id,Ln.vertexBuffer,Ln.indexBuffer,Ln.segments,pe.paint,ie.transform.zoom,void 0,Do),pa.draw(ie,Te.gl.TRIANGLES,Ei?We:Ct,mr.disabled,Ei||Mr.opacity<1||an.hasTranslucentParts?Or.alphaBlended:Or.unblended,ur.backCCW,js,pe.id,Ln.vertexBuffer,Ln.indexBuffer,Ln.segments,pe.paint,ie.transform.zoom,void 0,Do)}}}}()}(m,a,u,g),void I();if(z.type!=="model")return;const F=z.getModels(),q=[],$=m.transform.getFreeCameraOptions().position,K=o.c1([],[$.x,$.y,$.z],m.transform.worldSize);o.eq(K,K);const te=[],ee=[];let re=0;for(const ie of F){const ue=u.paint.get("model-rotation").constantOr(null),pe=u.paint.get("model-scale").constantOr(null),me=u.paint.get("model-translation").constantOr(null);ie.computeModelMatrix(m,ue,pe,me,!0,!0,!1);const Te=o.bx([]),we=o.e9(ie.position.lat,m.transform.zoom),Pe=o.bn([],[1,1,1/we]);o.bo(Te,Te,K),q.push({zScaleMatrix:Pe,negCameraPosMatrix:Te});for(const be of ie.nodes)d0(m.transform,be,ie.matrix,m.transform.expandedFarZProjMatrix,re,te,ee);re++}if(te.sort((ie,ue)=>ue.depth-ie.depth),m.renderPass!=="shadow"){if(x===1)for(const ie of ee)hd(ie,m,u,q[ie.modelIndex],mr.disabled,m.colorModeForRenderPass());else{for(const ie of ee)hd(ie,m,u,q[ie.modelIndex],mr.disabled,Or.disabled);for(const ie of ee)hd(ie,m,u,q[ie.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const ie of te)hd(ie,m,u,q[ie.modelIndex],mr.disabled,m.colorModeForRenderPass());I()}else{for(const ie of ee)Cg(ie.mesh,ie.nodeModelMatrix,m,u);for(const ie of te)Cg(ie.mesh,ie.nodeModelMatrix,m,u);I()}}},Ig={line:function(m,a,u){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(a){const g=a.getVisibleCoordinates();for(const x of g){const b=a.getTile(x).getBucket(m);if(b&&(b.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,a,u){const g=a.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,g.type==="vector"?m.scope:""));if(g.type==="batched-model"||g.type!=="model")return;const x=g.getModels();for(const b of x)b.upload(u.context)},raster:function(m,a,u){const g=a.getSource();if(!(g instanceof Oc&&g.loaded()))return;const x=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const b=m.paint.get("raster-array-band")||g.getInitialBand(x);if(b==null)return;const E=a.getIds().map(P=>a.getTileByID(P));for(const P of E)P.updateNeeded(m.id,b)&&g.prepareTile(P,x,m.id,b)},"raster-particle":function(m,a,u){const g=a.getSource();if(!(g instanceof Oc&&g.loaded()))return;const x=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const b=m.paint.get("raster-particle-array-band")||g.getInitialBand(x);if(b==null)return;const E=a.getIds().map(P=>a.getTileByID(P));for(const P of E)P.updateNeeded(m.id,b)&&g.prepareTile(P,x,m.id,b)}},Og={fill:Wt},as={fill:function(m,a,u,g){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const x=m.context.gl,b=new Ht(x.LEQUAL,Ht.ReadOnly,m.depthRangeFor3D),E=new mr({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),P=m.transform.getFreeCameraOptions().position,I=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const z of g){const F=a.getTile(z),q=F.getBucket(u);if(!q)continue;const $=q.elevatedStructures;if(!$||$.depthSegments.segments[0].primitiveLength===0)continue;const K=op(z.toUnwrapped(),P),te=m.translatePosMatrix(z.projMatrix,F,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),ee=yg(te,K,0,1,0);I.draw(m,x.TRIANGLES,b,E,Or.disabled,ur.disabled,ee,u.id,$.vertexBuffer,$.indexBuffer,$.depthSegments,u.paint,m.transform.zoom)}}};class Xc{constructor(a,u,g,x,b,E){this.context=new wg(a,u),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const P=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const z of P)this._debugParams.enabledLayers[z]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const z of P)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],z);this.occlusionParams=new fd(b),this.setup(),this.numSublayers=Aa.maxUnderzooming+Aa.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new AC(this),this._wireframeDebugCache=new hp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,I,a.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=E}updateTerrain(a,u){const g=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fg(this,a));const x=this._terrain;this.transform.elevation=g?x:null,x.update(a,this.transform,u),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(a){const u=a.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=u.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const b=g+.78*(x-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(a){a&&!this._terrain&&(this._terrain=new fg(this,this.style)),this._forceTerrainMode=a}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,u){if(this.width=a*o.q.devicePixelRatio,this.height=u*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const a=this.context,u=new o.ba;u.emplaceBack(0,0),u.emplaceBack(o.aj,0),u.emplaceBack(0,o.aj),u.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=a.createVertexBuffer(u,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const g=new o.ba;g.emplaceBack(0,0),g.emplaceBack(o.aj,0),g.emplaceBack(0,o.aj),g.emplaceBack(o.aj,o.aj),this.debugBuffer=a.createVertexBuffer(g,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const x=new o.ba;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(x,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const b=new o.aZ;b.emplaceBack(0,0,0,0),b.emplaceBack(o.aj,0,o.aj,0),b.emplaceBack(0,o.aj,0,o.aj),b.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=a.createVertexBuffer(b,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const E=new o.a_;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(E);const P=new o.bb;for(const z of[0,1,3,2,0])P.emplaceBack(z);this.debugIndexBuffer=a.createIndexBuffer(P),this.emptyTexture=new o.T(a,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA8),this.identityMat=o.bz();const I=this.context.gl;this.stencilClearMode=new mr({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,Ht.disabled,this.stencilClearMode,Or.disabled,ur.disabled,hg(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,u,g){if(!u||this.currentStencilSource===u.id||!a.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const I of g)if(this._tileClippingMaskIDs[I.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=u.id;const x=this.context,b=x.gl;this.nextStencilID+g.length>256&&this.clearStencil(),x.setColorMode(Or.disabled),x.setDepthMode(Ht.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of g){const I=u.getTile(P),z=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:q,tileBoundsSegments:$}=this.getTileBoundsBuffers(I);E.draw(this,b.TRIANGLES,Ht.disabled,new mr({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),Or.disabled,ur.disabled,hg(P.projMatrix),"$clipping",F,q,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,u=this.context.gl;return new mr({func:u.NOTEQUAL,mask:255},a,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const u=this.context.gl;return new mr({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(a){const u=this.context.gl,g=a.sort((E,P)=>P.overscaledZ-E.overscaledZ),x=g[g.length-1].overscaledZ,b=g[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let P=0;P<b;P++)E[P+x]=new mr({func:u.GEQUAL,mask:255},P+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[E,g]}return[{[x]:mr.disabled},g]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new Or([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Or.unblended:Or.alphaBlended}colorModeForDrapableLayerRenderPass(a){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Or([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,a===void 0?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,u,g,x=!1){if(this.depthOcclusion)return new Ht(this.context.gl.GREATER,Ht.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Ht.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new Ht(g||this.context.gl.LEQUAL,u,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const a=this.context.gl,u=Math.ceil(this.width),g=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),b=a.getParameter(a.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===u&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),u!==0&&g!==0&&(this.depthFBO=new Zu(this.context,u,g,!1,"texture"),this.depthTexture=new o.T(this.context,{width:u,height:g,data:null},a.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),a.bindTexture(a.TEXTURE_2D,b),this.depthFBO&&(a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),a.blitFramebuffer(0,0,u,g,0,0,u,g,a.DEPTH_BUFFER_BIT,a.NEAREST),a.bindFramebuffer(a.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((a,u)=>a+u/this._fpsHistory.length,0))}render(a,u){const g=o.q.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=u;const x=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(b).filter(We=>{const Re=x[We];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]});let P=E(),I=!1,z=!1,F=null;for(const We of P){const Re=x[We];Re.type==="circle"?I=!0:Re.type==="building"?F=Re:Re.type==="symbol"&&(Re.hasInitialOcclusionOpacityProperties?z=!0:I=!0)}let q=P.map(We=>x[We]);const $=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let K=0,te=!1;for(const We in $){const Re=$[We];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++K)}let ee=!1;for(const We of q)We.isHidden(this.transform.zoom)||(We.type==="clip"&&(ee=!0),this.prepareLayer(We));const re={},ie={},ue={},pe={},me={};for(const We in $){const Re=$[We];re[We]=Re.getVisibleCoordinates(),ie[We]=re[We].slice().reverse(),ue[We]=Re.getVisibleCoordinates(!0).reverse(),pe[We]=Re.getShadowCasterCoordinates(),me[We]=Re.sortCoordinatesByDistance(re[We])}const Te=We=>{const Re=this.style.getLayerSourceCache(We);return Re&&Re.used?Re.getSource():null};if(K||ee||this._clippingActiveLastFrame){const We=[],Re=[];let nt=0;for(const Ze of q)this.isSourceForClippingOrConflation(Ze,Te(Ze))&&(We.push(Ze),Re.push(nt)),nt++;if(We&&(ee||We.length>1)||this._clippingActiveLastFrame){ee=!1;const Ze=[];for(let yt=0;yt<We.length;yt++){const bt=We[yt],Et=Re[yt],jt=this.style.getLayerSourceCache(bt);if(!jt||!jt.used||!jt.getSource().usedInConflation&&bt.type!=="clip"&&bt.type!=="building")continue;let tr=o.eF,ir=o.bW.None;const Zt=[];let er=!0;if(bt.type==="building")tr=o.eH;else if(bt.type==="clip"){tr=Et;for(const nr of bt.layout.get("clip-layer-types"))ir|=nr==="model"?o.bW.Model:nr==="symbol"?o.bW.Symbol:o.bW.FillExtrusion;for(const nr of bt.layout.get("clip-layer-scope"))Zt.push(nr);bt.isHidden(this.transform.zoom)?er=!1:ee=!0}er&&Ze.push({layer:bt.fqid,cache:jt,order:tr,clipMask:ir,clipScope:Zt})}this.replacementSource.setSources(Ze),te=!0}}this._clippingActiveLastFrame=ee,te||this.replacementSource.clear(),this.conflationActive=te,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let We=0;We<q.length;We++){const Re=q[We],nt=Re.cutoffRange();if(this.longestCutoffRange=Math.max(nt,this.longestCutoffRange),nt>0){const Ze=Te(Re);Ze&&(this.minCutoffZoom=Math.max(Ze.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=We),this._lastOcclusionLayer=We)}const we=this.style&&this.style.fog;we?(this._fogVisible=we.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ue),this.opaquePassCutoff=0,P=E(),q=P.map(We=>x[We]));const Pe=this._shadowRenderer;if(Pe){Pe.updateShadowParameters(this.transform,this.style.directionalLight);for(const We in $)for(const Re of re[We]){let nt={min:0,max:0};this.terrain&&(nt=this.terrain.getMinMaxForTile(Re)||nt),Pe.addShadowReceiver(Re.toUnwrapped(),nt.min,nt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new $e(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Se=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(be&&!this._snow&&(this._snow=new g0(this)),!be&&this._snow&&(this._snow.destroy(),delete this._snow),Se&&!this._rain&&(this._rain=new md(this)),!Se&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),F){this.buildingTileBorderManager||(this.buildingTileBorderManager=new tS);const We=this.style.getLayerSourceCache(F);this.buildingTileBorderManager.updateBorders(We,F)}if(!Sr.has(this.context.gl))return;this.renderPass="offscreen";for(const We of q){const Re=a.getLayerSourceCache(We);if(!We.hasOffscreenPass()||We.isHidden(this.transform.zoom))continue;const nt=Re?ie[Re.id]:void 0;(We.type==="custom"||We.type==="raster"||We.type==="raster-particle"||We.isSky()||nt&&nt.length)&&this.renderLayer(this,Re,We,nt)}this.depthRangeFor3D=[0,1-(q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,pe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ee=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ve=(()=>{if(u.showOverdrawInspector)return o.am.black;const We=this.style.fog;if(We&&this.transform.projection.supportsFog){const Re=this.style.getLut(We.scope);if(!Ee){const nt=We.properties.get("color-use-theme")==="none",Ze=We.properties.get("color").toNonPremultipliedRenderColor(nt?null:Re).toArray01();return new o.am(...Ze)}if(Ee){const nt=We.properties.get("space-color-use-theme")==="none",Ze=We.properties.get("space-color").toNonPremultipliedRenderColor(nt?null:Re).toArray01();return new o.am(...Ze)}}return o.am.transparent})();if(this.context.clear({color:Ve,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=P.length-1;this.currentLayer>=0;this.currentLayer--){const We=q[this.currentLayer],Re=a.getLayerSourceCache(We);if(We.isSky())continue;const nt=Re?(We.is3D(b)?me:ie)[Re.id]:void 0;this._renderTileClippingMasks(We,Re,nt),this.renderLayer(this,Re,We,nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const We=q[this.currentLayer],Re=a.getLayerSourceCache(We);We.isSky()&&this.renderLayer(this,Re,We,Re?ie[Re.id]:void 0)}function De(We,Re){let nt;return Re&&(nt=(We.type==="symbol"?ue:We.is3D(b)?me:ie)[Re.id]),nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<P.length;){const We=q[this.currentLayer];if(We.type==="raster"||We.type==="raster-particle"){const Re=a.getLayerSourceCache(We);this.renderLayer(this,Re,We,De(We,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let dt=0;Pe&&(dt=Pe.getShadowCastingLayerCount());let Je=!1,pt=-1;for(let We=0;We<P.length;++We){const Re=q[We];Re.isHidden(this.transform.zoom)||Re.is3D(b)&&(pt=We)}z&&pt===-1&&(I=!0);let Ct=!1;for(;this.currentLayer<P.length;){const We=q[this.currentLayer],Re=a.getLayerSourceCache(We);if(We.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(We)){if(We.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ct&&We.is3D(b)&&!b){const nt=this.currentLayer,Ze=yt=>{for(this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const bt=q[this.currentLayer];if(Og[bt.type]){const Et=this.style.getLayerSourceCache(bt);Og[bt.type](this,Et,bt,De(bt,Et),yt)}}};Ze("initialize"),Ze("reset"),this.currentLayer=nt,Ct=!0}if(I&&!Je&&this.terrain&&!this.transform.isOrthographic&&(Je=!0,this.blitDepth()),z&&pt!==-1&&this.currentLayer===pt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(We,Re,Re?re[Re.id]:void 0),this.renderLayer(this,Re,We,De(We,Re)),!this.terrain&&Pe&&dt>0&&We.hasShadowPass()&&--dt==0){{this.clearStencil(),this.resetStencilClippingMasks();const nt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const Ze=q[this.currentLayer];if(as[Ze.type]){const yt=this.style.getLayerSourceCache(Ze);as[Ze.type](this,yt,Ze,De(Ze,yt))}}this.currentLayer=nt}if(Pe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=nt;this.currentLayer++){const Ze=q[this.currentLayer];if(!Ze.hasLightBeamPass())continue;const yt=a.getLayerSourceCache(Ze);this.renderLayer(this,yt,Ze,yt?ie[yt.id]:void 0)}this.currentLayer=nt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const nt=this.currentLayer;this.depthOcclusion=!0;for(const Ze of this.layersWithOcclusionOpacity){this.currentLayer=Ze;const yt=q[this.currentLayer],bt=a.getLayerSourceCache(yt),Et=bt?ie[bt.id]:void 0;this.terrain||this._renderTileClippingMasks(yt,bt,bt?re[bt.id]:void 0),this.renderLayer(this,bt,yt,Et)}this.depthOcclusion=!1,this.currentLayer=nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let We=null;q.forEach(Re=>{const nt=a.getLayerSourceCache(Re);nt&&!Re.isHidden(this.transform.zoom)&&nt.getVisibleCoordinates().length&&(!We||We.getSource().maxzoom<nt.getSource().maxzoom)&&(We=nt)}),We&&this.options.showTileBoundaries&&_l(this,We,We.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&_l(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(We){const Re=We.transform.padding;sp(We,We.transform.height-(Re.top||0),3,Y1),sp(We,Re.bottom||0,3,c0),kg(We,Re.left||0,3,u0),kg(We,We.transform.width-(Re.right||0),3,h0);const nt=We.transform.centerPoint;(function(Ze,yt,bt,Et){lp(Ze,yt-1,bt-10,2,20,Et),lp(Ze,yt-10,bt-1,20,2,Et)})(We,nt.x,We.transform.height-nt.y,J1)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),te||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);const{unsupportedLayers:u}=this.transform.projection,g=!u||!u.includes(a.type);if(Ig[a.type]&&(g||this.terrain&&a.type==="custom")){const x=this.style.getLayerSourceCache(a);Ig[a.type](a,x,this)}this.gpuTimingEnd()}renderLayer(a,u,g,x){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(g.type)&&(!a.terrain||g.type!=="custom")||g.type==="clip"||y0[g.type](a,u,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,g=this.context.gl;let x=this.gpuTimers[a.id];x||(x=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:g.createQuery()}),x.calls++,g.beginQuery(u.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,u=this.context.gl,g=u.createQuery();this.deferredRenderGpuTimeQueries.push(g),u.beginQuery(a.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const u={};for(const g in a){const x=a[g],b=this.context.extTimerQuery,E=b.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(x.query),u[g]=E}return u}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.gl;let g=0;for(const x of a)g+=u.getQueryParameter(x,u.QUERY_RESULT)/1e6,u.deleteQuery(x);return g}translatePosMatrix(a,u,g,x,b){if(!g[0]&&!g[1])return a;const E=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const z=Math.sin(E),F=Math.cos(E);g=[g[0]*F-g[1]*z,g[0]*z+g[1]*F]}const P=[b?g[0]:o.aw(u,g[0],this.transform.zoom),b?g[1]:o.aw(u,g[1],this.transform.zoom),0],I=new Float32Array(16);return o.bo(I,a,P),I}saveTileTexture(a){if(a.context!==this.context)return;const u=a.size[0],g=this._tileTextures[u];g?g.push(a):this._tileTextures[u]=[a]}getTileTexture(a){const u=this._tileTextures[a];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,u,g){const x=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,b=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||x||u!==void 0&&!u||b.push("FOG","FOG_DITHERING"),x&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(a,u){this.cache=this.cache||{};const g=u&&u.defines||[],x=u&&u.config,b=this.currentGlobalDefines(a,u&&u.overrideFog,u&&u.overrideRtt).concat(g),E=mg.cacheKey(ep[a],a,b,x);return this.cache[E]||(this.cache[E]=new mg(this.context,a,ep[a],x,Z1[a],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,u){if(this.style.enable3dLights()){const g=this.style.directionalLight,x=this.style.ambientLight;if(g&&x){const b=((E,P,I)=>{const z=E.properties.get("direction"),F=E.properties.get("color-use-theme")==="none",q=E.properties.get("color").toNonPremultipliedRenderColor(F?null:I.getLut(E.scope)).toArray01(),$=E.properties.get("intensity"),K=P.properties.get("color-use-theme")==="none",te=P.properties.get("color").toNonPremultipliedRenderColor(K?null:I.getLut(P.scope)).toArray01(),ee=P.properties.get("intensity"),re=[z.x,z.y,z.z],ie=o.dI(te,ee),ue=o.dI(q,$);return{u_lighting_ambient_color:ie,u_lighting_directional_dir:re,u_lighting_directional_color:ue,u_ground_radiance:Hv(re,ue,ie)}})(g,x,this.style);u.setLightsUniformValues(a,b)}}}uploadCommonUniforms(a,u,g,x,b){if(this.uploadCommonLightUniforms(a,u),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const P=E.getOpacity(this.transform.pitch),I=((z,F,q,$,K,te,ee,re,ie,ue,pe,me)=>{const Te=z.transform,we=F.properties.get("color-use-theme")==="none",Pe=F.properties.get("color").toNonPremultipliedRenderColor(we?null:z.style.getLut(F.scope)).toArray01();Pe[3]=$;const be=z.frameCounter/1e3%1,[Se,Ee]=F.properties.get("vertical-range");return{u_fog_matrix:q?Te.calculateFogTileMatrix(q):me||z.identityMat,u_fog_range:F.getFovAdjustedRange(Te._fov),u_fog_color:Pe,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Se,Ee),Ee],u_fog_temporal_offset:be,u_frustum_tl:K,u_frustum_tr:te,u_frustum_br:ee,u_frustum_bl:re,u_globe_pos:ie,u_globe_radius:ue,u_viewport:pe,u_globe_transition:o.ah(Te.zoom),u_is_globe:+(Te.projection.name==="globe")}})(this,E,g,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],x);u.setFogUniformValues(a,I)}b&&u.setCutoffUniformValues(a,b.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,u=a.createTexture();return a.bindTexture(a.TEXTURE_2D,u),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const x of g)u[x.key]=a[x.key]||new Du(x,512,this.transform.tileZoom,this,void 0,this.worldview);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(a,u){return!(!a.is3D(!(!this.terrain||!this.terrain.enabled))||a.type!=="clip"&&a.type!=="building"&&(a.minzoom&&a.minzoom>this.transform.zoom||(this.style._clipLayerPresent||a.sourceLayer!=="building"&&a.sourceLayer!=="procedural_buildings")&&(!u||u.type!=="batched-model")))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[a.key];return u||(this._cachedTileFogOpacities[a.key]=u=this.style.fog.getOpacityForTile(a)),u[0]>=gt||u[1]>=gt}setupDepthForOcclusion(a,u,g){const x=this.context,b=x.gl,E=!!g;var P;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(b.TEXTURE3),a&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((P=this.depthRangeFor3D)[1]-P[0]),-1-2*P[0]/(P[1]-P[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),x.activeTexture.set(b.TEXTURE0),E||u.setTerrainUniformValues(x,g)}}function gd(m,a){let u=!1,g=null;const x=()=>{g=null,u&&(m(),g=setTimeout(x,a),u=!1)};return()=>(u=!0,g||x(),g)}class jg{constructor(a){this._hashName=a&&encodeURIComponent(a),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=gd(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const u=Rg(a);if(this._hashName){const g=this._hashName;let x=!1;const b=location.hash.slice(1).split("&").map(E=>{const P=E.split("=")[0];return P===g?(x=!0,`${P}=${u}`):E}).filter(E=>E);return x||b.push(`${g}=${u}`),`#${b.join("&")}`}return`#${u}`}_getCurrentHash(){const a=location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(Number(g)))){const g=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(u[3]||0):a.getBearing();return a.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Rg(m,a){const u=m.getCenter(),g=Math.round(100*m.getZoom())/100,x=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),E=Math.round(u.lng*b)/b,P=Math.round(u.lat*b)/b,I=m.getBearing(),z=m.getPitch();let F=a?`/${E}/${P}/${g}`:`${g}/${P}/${E}`;return(I||z)&&(F+="/"+Math.round(10*I)/10),z&&(F+=`/${Math.round(z)}`),F}const yd={linearity:.3,easing:o.eI(0,0,.3,1)},Yc=o.h({deceleration:2500,maxSpeed:1400},yd),_0=o.h({deceleration:20,maxSpeed:1400},yd),xl=o.h({deceleration:1e3,maxSpeed:360},yd),v0=o.h({deceleration:1e3,maxSpeed:90},yd);class Dg{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,u=o.q.now();for(;a.length>0&&u-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(u.pan.mag()){const b=vd(u.pan.mag(),g,o.h({},Yc,a||{}));x.offset=u.pan.mult(b.amount/u.pan.mag()),x.center=this._map.transform.center,_d(x,b)}if(u.zoom){const b=vd(u.zoom,g,_0);x.zoom=this._map.transform.zoom+b.amount,_d(x,b)}if(u.bearing){const b=vd(u.bearing,g,xl);x.bearing=this._map.transform.bearing+o.ay(b.amount,-179,179),_d(x,b)}if(u.pitch){const b=vd(u.pitch,g,v0);x.pitch=this._map.transform.pitch+b.amount,_d(x,b)}if(x.zoom||x.bearing){const b=u.pinchAround===void 0?u.around:u.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function _d(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function vd(m,a,u){const{maxSpeed:g,linearity:x,deceleration:b}=u,E=o.ay(m*x/(a/1e3),-g,g),P=Math.abs(E)/(b*x);return{easing:u.easing,duration:1e3*P,amount:E*(P/2)}}class ii extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g,x={}){const b=ge(u.getCanvasContainer(),g),E=u.unproject(b);super(a,o.h({point:b,lngLat:E,originalEvent:g},x)),this._defaultPrevented=!1,this.target=u}}class xd extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g){const x=a==="touchend"?g.changedTouches:g.touches,b=je(u.getCanvasContainer(),x),E=b.map(I=>u.unproject(I)),P=b.reduce((I,z,F,q)=>I.add(z.div(q.length)),new o.P(0,0));super(a,{points:b,point:P,lngLats:E,lngLat:u.unproject(P),originalEvent:g}),this._defaultPrevented=!1}}class x0 extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class b0{constructor(a,u){this._map=a,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new x0(this._map,a))}mousedown(a,u){return this._mousedownPos=u,this._firePreventable(new ii(a.type,this._map,a))}mouseup(a){this._map.fire(new ii(a.type,this._map,a))}preclick(a){const u=o.h({},a);u.type="preclick",this._map.fire(new ii(u.type,this._map,u))}click(a,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(a),this._map.fire(new ii(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new ii(a.type,this._map,a))}mouseover(a){this._map.fire(new ii(a.type,this._map,a))}mouseout(a){this._map.fire(new ii(a.type,this._map,a))}touchstart(a){return this._firePreventable(new xd(a.type,this._map,a))}touchmove(a){this._map.fire(new xd(a.type,this._map,a))}touchend(a){this._map.fire(new xd(a.type,this._map,a))}touchcancel(a){this._map.fire(new xd(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ju{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new ii(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ii("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new ii(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class w0{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,u){this.isEnabled()&&a.shiftKey&&a.button===0&&(Y(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(a,u){if(!this._active)return;const g=u,x=this._startPos,b=this._lastPos;if(!x||!b||b.equals(g)||!this._box&&g.dist(x)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=N("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const E=Math.min(x.x,g.x),P=Math.max(x.x,g.x),I=Math.min(x.y,g.y),z=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${I}px)`,this._box.style.width=P-E+"px",this._box.style.height=z-I+"px")})}mouseupWindow(a,u){if(!this._active)return;const g=this._startPos,x=u;if(g&&a.button===0){if(this.reset(),le(),g.x!==x.x||g.y!==x.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:a})),{cameraAnimation:b=>b.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ne(),delete this._startPos,delete this._lastPos}_fireEvent(a,u){return this._map.fire(new o.A(a,{originalEvent:u}))}}function fp(m,a){const u={};for(let g=0;g<m.length;g++)u[m[g].identifier]=a[g];return u}class S0{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const b=new o.P(0,0);for(const E of x)b._add(E);return b.div(x.length)}(u),this.touches=fp(g,u)))}touchmove(a,u,g){if(this.aborted||!this.centroid)return;const x=fp(g,u);for(const b in this.touches){const E=x[b];(!E||E.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(a,u,g){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Jc{constructor(a){this.singleTap=new S0(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,u,g){this.singleTap.touchstart(a,u,g)}touchmove(a,u,g){this.singleTap.touchmove(a,u,g)}touchend(a,u,g){const x=this.singleTap.touchend(a,u,g);if(x){const b=a.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(b&&E||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class T0{constructor(){this._zoomIn=new Jc({numTouches:1,numTaps:2}),this._zoomOut=new Jc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,u,g){this._zoomIn.touchstart(a,u,g),this._zoomOut.touchstart(a,u,g)}touchmove(a,u,g){this._zoomIn.touchmove(a,u,g),this._zoomOut.touchmove(a,u,g)}touchend(a,u,g){const x=this._zoomIn.touchend(a,u,g),b=this._zoomOut.touchend(a,u,g);return x?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:a})}):b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const E0={0:1,2:2},Lg={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class bd{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,u){return!1}_move(a,u){return{}}mousedown(a,u){if(this._lastPoint)return;const g=ze(a);this._correctButton(a,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(a,u){const g=this._lastPoint;if(g){if(a.preventDefault(),this._eventButton!=null&&function(x,b){const E=E0[b];return x.buttons===void 0||(x.buttons&E)!==E}(a,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}}mouseupWindow(a){this._lastPoint&&ze(a)===this._eventButton&&(this._moved&&le(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class A0 extends bd{mousedown(a,u){super.mousedown(a,u),this._lastPoint&&(this._active=!0)}_correctButton(a,u){return u===0&&!a.ctrlKey}_move(a,u){return{around:u,panDelta:u.sub(a)}}}class zg extends bd{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?Lg[a.pitchRotateKey]:void 0}_correctButton(a,u){return this._pitchRotateKey?u===0&&a[this._pitchRotateKey]:u===0&&a.ctrlKey||u===2}_move(a,u){const g=.8*(u.x-a.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class k0 extends bd{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?Lg[a.pitchRotateKey]:void 0}_correctButton(a,u){return this._pitchRotateKey?u===0&&a[this._pitchRotateKey]:u===0&&a.ctrlKey||u===2}_move(a,u){const g=-.5*(u.y-a.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class oS{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(a,u,g){return this._calculateTransform(a,u,g)}touchmove(a,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!o.eJ())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,u,g)}}touchend(a,u,g){this._calculateTransform(a,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,u,g){g.length>0&&(this._active=!0);const x=fp(g,u),b=new o.P(0,0),E=new o.P(0,0);let P=0;for(const z in x){const F=x[z],q=this._touches[z];q&&(b._add(F),E._add(F.sub(q)),P++,x[z]=F)}if(this._touches=x,P<this._minTouches||!E.mag())return;const I=E.div(P);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(P),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ng{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,u,g){return{}}touchstart(a,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(a,u,g){const x=this._firstTwoTouches;if(!x)return;a.preventDefault();const[b,E]=x,P=pp(g,u,b),I=pp(g,u,E);if(!P||!I)return;const z=this._aroundCenter?null:P.add(I).div(2);return this._move([P,I],z,a)}touchend(a,u,g){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,E=pp(g,u,x),P=pp(g,u,b);E&&P||(this._active&&le(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function pp(m,a,u){for(let g=0;g<m.length;g++)if(m[g].identifier===u)return a[g]}function C0(m,a){return Math.log(m/a)/Math.LN2}class aS extends Ng{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,u){const g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(C0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:C0(this._distance,g),pinchAround:u}}}function P0(m,a){return 180*m.angleWith(a)/Math.PI}class sS extends Ng{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,u){const g=this._vector;if(this._vector=a[0].sub(a[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:P0(this._vector,g),pinchAround:u}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const u=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const x=P0(a,g);return Math.abs(x)<u}}function Fg(m){return Math.abs(m.y)>Math.abs(m.x)}class lS extends Ng{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Fg(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,u,g){const x=this._lastPoints;if(!x)return;const b=a[0].sub(x[0]),E=a[1].sub(x[1]);return this._map._cooperativeGestures&&!o.eJ()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5})}gestureBeginsVertically(a,u,g){if(this._valid!==void 0)return this._valid;const x=a.mag()>=2,b=u.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=a.y>0==u.y>0;return Fg(a)&&Fg(u)&&E}}const cS={panStep:100,bearingStep:15,pitchStep:10};class uS{constructor(){const a=cS;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let u=0,g=0,x=0,b=0,E=0;switch(a.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:a.shiftKey?g=-1:(a.preventDefault(),b=-1);break;case 39:a.shiftKey?g=1:(a.preventDefault(),b=1);break;case 38:a.shiftKey?x=1:(a.preventDefault(),E=-1);break;case 40:a.shiftKey?x=-1:(a.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:P=>{const I=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:hS,zoom:u?Math.round(I)+u*(a.shiftKey?2:1):I,bearing:P.getBearing()+g*this._bearingStep,pitch:P.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:P.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hS(m){return m*(2-m)}const dS=4.000244140625,ZC=1/450;class KC{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ZC,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||o.eJ()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const g=o.q.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,u!==0&&u%dS==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=u,this._timeout=window.setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(x*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),a.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=a,this._delta-=u,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=ge(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>dS?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&F!==0&&(F=1/F);const q=u(),$=Math.pow(2,q),K=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(K*F))),this._type==="wheel"&&(this._startZoom=q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:u(),x=this._startZoom,b=this._easing;let E,P=!1;if(this._type==="wheel"&&x&&b){const z=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),F=b(z);E=o.ai(x,g,F),z<1?this._frameId||(this._frameId=!0):P=!0}else E=g,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=E-u();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let u=o.eK;if(this._prevEase){const g=this._prevEase,x=(o.q.now()-g.start)/g.duration,b=g.easing(x+.01)-g.easing(x),E=.27/Math.sqrt(b*b+1e-4)*.01,P=Math.sqrt(.0729-E*E);u=o.eI(E,P,.25,1)}return this._prevEase={start:o.q.now(),duration:a,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ui{constructor(a,u){this._clickZoom=a,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fS{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,u){return a.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(a.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class XC{constructor(){this._tap=new Jc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,u,g){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(a,u,g))}touchmove(a,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=u[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,a.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(a,u,g)}touchend(a,u,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(a,u,g)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class M0{constructor(a,u,g){this._el=a,this._mousePan=u,this._touchPan=g}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class YC{constructor(a,u,g){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mp{constructor(a,u,g,x){this._el=a,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gp=m=>m.zoom||m.drag||m.pitch||m.rotate;class I0 extends o.A{}class Bg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,u){const g=o.at([],u,a);this.radius=o.ae(g[2]<0?o.eM([],g,this.constants):[g[0],g[1],0])}projectRay(a){o.eM(a,a,this.constants),o.au(a,a),o.eN(a,a,this.constants);const u=o.c1([],a,this.radius);if(u[2]>0){const g=o.c1([],[0,0,1],o.bG(u,[0,0,1])),x=o.c1([],o.au([],[u[0],u[1],0]),this.radius),b=o.d5([],u,o.c1([],o.at([],o.d5([],x,g),u),2));u[0]=b[0],u[1]=b[1]}return u}}function Is(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Ug{constructor(a,u){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dg(a),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Bg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),o.aV(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,b,E]of this._listeners){const P=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(b,P,E)}}destroy(){for(const[a,u,g]of this._listeners){const x=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(u,x,g)}}_addDefaultHandlers(a){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new b0(u,a));const x=u.boxZoom=new w0(u,a);this._add("boxZoom",x);const b=new T0,E=new fS;u.doubleClickZoom=new ui(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const P=new XC;this._add("tapDragZoom",P);const I=u.touchPitch=new lS(u);this._add("touchPitch",I);const z=new zg(a),F=new k0(a);u.dragRotate=new YC(a,z,F),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const q=new A0(a),$=new oS(u,a);u.dragPan=new M0(g,q,$),this._add("mousePan",q),this._add("touchPan",$,["touchZoom","touchRotate"]);const K=new sS,te=new aS;u.touchZoomRotate=new mp(g,te,K,P),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ju(u));const ee=u.scrollZoom=new KC(u,this);this._add("scrollZoom",ee,["mousePan"]);const re=u.keyboard=new uS;this._add("keyboard",re);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[ie]&&u[ie].enable(a[ie])}_add(a,u,g){this._handlers.push({handlerName:a,handler:u,allowed:g}),this._handlersById[a]=u}stop(a){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,u,g){for(const x in a)if(x!==g&&(!u||u.indexOf(x)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const u=[];for(const g of a)this._el.contains(g.target)&&u.push(g);return u}handleEvent(a,u){this._updatingCamera=!0;const g=a.type==="renderFrame",x=g?void 0:a,b={needsRenderFrame:!1},E={},P={},I=a.touches?this._getMapTouches(a.touches):void 0,z=I?je(this._el,I):g?void 0:ge(this._el,a);for(const{handlerName:$,handler:K,allowed:te}of this._handlers){if(!K.isEnabled())continue;let ee;this._blockedByActive(P,te,$)?K.reset():K[u||a.type]&&(ee=K[u||a.type](a,z,I),this.mergeHandlerResult(b,E,ee,$,x),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||K.isActive())&&(P[$]=K)}const F={};for(const $ in this._previousActiveHandlers)P[$]||(F[$]=x);this._previousActiveHandlers=P,(Object.keys(F).length||Is(b))&&(this._changes.push([b,E,F]),this._triggerRenderFrame()),(Object.keys(P).length||Is(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=b;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(a,u,g,x,b){if(!g)return;o.h(a,g);const E={handlerName:x,originalEvent:g.originalEvent||b};g.zoomDelta!==void 0&&(u.zoom=E),g.panDelta!==void 0&&(u.drag=E),g.pitchDelta!==void 0&&(u.pitch=E),g.bearingDelta!==void 0&&(u.rotate=E)}_applyChanges(){const a={},u={},g={};for(const[x,b,E]of this._changes)x.panDelta&&(a.panDelta=(a.panDelta||new o.P(0,0))._add(x.panDelta)),x.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(a.around=x.around),x.aroundCoord!==void 0&&(a.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(a.pinchAround=x.pinchAround),x.noInertia&&(a.noInertia=x.noInertia),o.h(u,b),o.h(g,E);this._updateMapTransform(a,u,g),this._changes=[]}_updateMapTransform(a,u,g){const x=this._map,b=x.transform,E=ue=>[ue.x,ue.y,ue.z];if((ue=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!Is(a)){const ue=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),ue!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&x._stop(!0),!Is(a))return void this._fireEvents(u,g,!0);let{panDelta:P,zoomDelta:I,bearingDelta:z,pitchDelta:F,around:q,aroundCoord:$,pinchAround:K}=a;b._isCameraConstrained&&(I>0&&(I=0),b._isCameraConstrained=!1),K!==void 0&&(q=K),(I||(ue=>u[ue]&&!this._eventsInProgress[ue])("drag"))&&q&&(this._dragOrigin=E(b.pointCoordinate3D(q)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),q=q||x.transform.centerPoint,z&&(b.bearing+=z),F&&(b.pitch+=F),b._updateCameraState();const te=[0,0,0];if(P)if(b.projection.name==="mercator"){const ue=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(q).dir),pe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(q.sub(P)).dir);te[0]=pe[0]-ue[0],te[1]=pe[1]-ue[1]}else{const ue=b.pointCoordinate(q);if(b.projection.name==="globe"){P=P.rotate(-b.angle);const pe=b._pixelsPerMercatorPixel/b.worldSize;te[0]=-P.x*o.eL(o.aY(ue.y))*pe,te[1]=-P.y*o.eL(b.center.lat)*pe}else{const pe=b.pointCoordinate(q.sub(P));ue&&pe&&(te[0]=pe.x-ue.x,te[1]=pe.y-ue.y)}}const ee=b.zoom,re=[0,0,0];if(I){const ue=E($||b.pointCoordinate3D(q)),pe={dir:o.au([],o.at([],ue,b._camera.position))};if(pe.dir[2]<0){const me=b.zoomDeltaToMovement(ue,I);o.c1(re,pe.dir,me)}}const ie=o.d5(te,te,re);b._translateCameraConstrained(ie),I&&Math.abs(b.zoom-ee)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(u,g,!0)}_fireEvents(a,u,g){const x=gp(this._eventsInProgress),b=gp(a),E={};for(const F in a){const{originalEvent:q}=a[F];this._eventsInProgress[F]||(E[`${F}start`]=q),this._eventsInProgress[F]=a[F]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const F in E)this._fireEvent(F,E[F]);b&&this._fireEvent("move",b.originalEvent);for(const F in a){const{originalEvent:q}=a[F];this._fireEvent(F,q)}const P={};let I;for(const F in this._eventsInProgress){const{handlerName:q,originalEvent:$}=this._eventsInProgress[F];this._handlersById[q].isActive()||(delete this._eventsInProgress[F],I=u[q]||$,P[`${F}end`]=I)}for(const F in P)this._fireEvent(F,P[F]);const z=gp(this._eventsInProgress);if(g&&(x||b)&&!z){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;F?(q(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:I})):(this._map.fire(new o.A("moveend",{originalEvent:I})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,u){this._map.fire(new o.A(a,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new I0("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ii="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class bl extends o.E{constructor(a,u){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(a,u){return this.jumpTo({center:a},u)}panBy(a,u,g){return a=o.P.convert(a).mult(-1),this.panTo(this.transform.center,o.h({offset:a},u),g)}panTo(a,u,g){return this.easeTo(o.h({center:a},u),g)}getZoom(){return this.transform.zoom}setZoom(a,u){return this.jumpTo({zoom:a},u),this}zoomTo(a,u,g){return this.easeTo(o.h({zoom:a},u),g)}zoomIn(a,u){return this.zoomTo(this.getZoom()+1,a,u),this}zoomOut(a,u){return this.zoomTo(this.getZoom()-1,a,u),this}getBearing(){return this.transform.bearing}setBearing(a,u){return this.jumpTo({bearing:a},u),this}getPadding(){return this.transform.padding}setPadding(a,u){return this.jumpTo({padding:a},u),this}rotateTo(a,u,g){return this.easeTo(o.h({bearing:a},u),g)}resetNorth(a,u){return this.rotateTo(0,o.h({duration:1e3},a),u),this}resetNorthPitch(a,u){return this.easeTo(o.h({bearing:0,pitch:0,duration:1e3},a),u),this}snapToNorth(a,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,u):this}getPitch(){return this.transform.pitch}setPitch(a,u){return this.jumpTo({pitch:a},u),this}cameraForBounds(a,u){a=o.aG.convert(a);const g=u&&u.bearing||0,x=u&&u.pitch||0,b=a.getNorthWest(),E=a.getSouthEast();return this._cameraForBounds(this.transform,b,E,g,x,u)}_extendPadding(a){const u={top:0,right:0,bottom:0,left:0};return a==null?o.h({},u,this.transform.padding):typeof a=="number"?{top:a,bottom:a,right:a,left:a}:o.h({},u,a)}_extendCameraOptions(a){return(a=o.h({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,u){const g=u.max[0]-u.min[0],x=u.max[1]-u.min[1];return g/x>a.aspect?g/(2*Math.tan(.5*a.fovX)*a.aspect):x/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,u,g,x,b,E){const P=a.clone(),I=this._extendCameraOptions(E);P.bearing=x,P.pitch=b;const z=o.ci.convert(u),F=o.ci.convert(g),q=.5*(z.lat+F.lat),$=.5*(z.lng+F.lng),K=o.eO(q,$),te=o.au([],K),ee=o.au([],o.bF([],te,[0,1,0])),re=o.bF([],ee,te),ie=[ee[0],ee[1],ee[2],0,re[0],re[1],re[2],0,te[0],te[1],te[2],0,0,0,0,1],ue=[K,o.eO(z.lat,z.lng),o.eO(F.lat,z.lng),o.eO(F.lat,F.lng),o.eO(z.lat,F.lng),o.eO(q,z.lng),o.eO(q,F.lng),o.eO(z.lat,$),o.eO(F.lat,$)];let pe=o.d6.fromPoints(ue.map(Ze=>[o.bG(ee,Ze),o.bG(re,Ze),o.bG(te,Ze)]));const me=o.ad([],pe.center,ie);o.eP(me)===0&&o.eQ(me,0,0,1),o.au(me,me),o.c1(me,me,o.aB),P.center=o.eR(me);const Te=P.getWorldToCameraMatrix(),we=o.bi(new Float64Array(16),Te);pe=o.d6.applyTransform(pe,o.az([],Te,ie));const Pe=this._extendAABB(pe,P,I,x);if(!Pe)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=Pe,o.ad(me,me,Te);const be=.5*(pe.max[2]-pe.min[2]),Se=this._minimumAABBFrustumDistance(P,pe),Ee=o.c1([],[0,0,1],be),Ve=o.d5(Ee,me,Ee),De=Se+(P.pitch===0?0:o.bD(me,Ve)),dt=P.globeCenterInViewSpace,Je=o.at([],me,[dt[0],dt[1],dt[2]]);o.au(Je,Je),o.c1(Je,Je,De);const pt=o.d5([],me,Je);o.ad(pt,pt,we);const Ct=o.eB/o.aB,We=o.ae(pt),Re=o.cb(Math.max(We*Ct-o.eB,Number.EPSILON),0),nt=Math.min(P.zoomFromMercatorZAdjusted(Re),I.maxZoom);return nt>.5*(o.cX+o.cI)?(P.setProjection({name:"mercator"}),P.zoom=nt,this._cameraForBounds(P,u,g,x,b,E)):{center:P.center,zoom:nt,bearing:x,pitch:b}}_extendAABB(a,u,g,x){const b=.5*((g.padding.left||0)+(g.padding.right||0)),E=.5*((g.padding.top||0)+(g.padding.bottom||0)),P=E,I=b,z=b,F=E,q=u.width-(I+z),$=u.height-(P+F),K=o.at([],a.max,a.min),te=Math.min(q/K[0],$/K[1]),ee=Math.min(u.scaleZoom(u.scale*te),g.maxZoom);if(isNaN(ee))return null;const re=u.scale/u.zoomScale(ee),ie=new o.d6([a.min[0]-I*re,a.min[1]-F*re,a.min[2]],[a.max[0]+z*re,a.max[1]+P*re,a.max[2]]),ue=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new o.P(g.offset.x,g.offset.y):o.P.convert(g.offset)).rotate(-o.al(x));return ie.center[0]-=ue.x*re,ie.center[1]+=ue.y*re,ie}queryTerrainElevation(a,u){const g=this.transform.elevation;return g?(u=o.h({},{exaggerated:!0},u),g.getAtPoint(o.ac.fromLngLat(a),null,u.exaggerated)):null}_cameraForBounds(a,u,g,x,b,E){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,u,g,x,b,E);const P=a.clone(),I=this._extendCameraOptions(E);P.bearing=x,P.pitch=b;const z=o.ci.convert(u),F=o.ci.convert(g),q=new o.ci(z.lng,F.lat),$=new o.ci(F.lng,z.lat),K=P.project(z),te=P.project(F),ee=this.queryTerrainElevation(z),re=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(q),ue=this.queryTerrainElevation($),pe=[[K.x,K.y,Math.min(ee||0,re||0,ie||0,ue||0)],[te.x,te.y,Math.max(ee||0,re||0,ie||0,ue||0)]];let me=o.d6.fromPoints(pe);const Te=P.getWorldToCameraMatrix(),we=o.bi(new Float64Array(16),Te);me=o.d6.applyTransform(me,Te);const Pe=this._extendAABB(me,P,I,x);if(!Pe)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Pe;const be=.5*o.at([],me.max,me.min)[2],Se=this._minimumAABBFrustumDistance(P,me),Ee=[0,0,1,0];o.aA(Ee,Ee,Te),o.eS(Ee,Ee);const Ve=o.c1([],Ee,Se+be),De=o.d5([],me.center,Ve);o.ad(me.center,me.center,we),o.ad(De,De,we);const dt=P.unproject(new o.P(me.center[0],me.center[1])),Je=o.eT(P.projection,dt),pt=Math.pow(2,Je),Ct=Math.min(P._zoomFromMercatorZ(De[2]*P.pixelsPerMeter*pt/P.worldSize),I.maxZoom);return P.mercatorFromTransition&&Ct<.5*(o.cX+o.cI)?(P.setProjection({name:"globe"}),P.zoom=Ct,this._cameraForBounds(P,u,g,x,b,E)):{center:dt,zoom:Ct,bearing:x,pitch:b}}fitBounds(a,u,g){const x=this.cameraForBounds(a,u);return this._fitInternal(x,u,g)}fitScreenCoordinates(a,u,g,x,b){const E=o.P.convert(a),P=o.P.convert(u),I=new o.P(Math.min(E.x,P.x),Math.min(E.y,P.y)),z=new o.P(Math.max(E.x,P.x),Math.max(E.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,P))return this;const F=this.transform.pointLocation3D(I),q=this.transform.pointLocation3D(z),$=this.transform.pointLocation3D(new o.P(I.x,z.y)),K=this.transform.pointLocation3D(new o.P(z.x,I.y)),te=[Math.min(F.lng,q.lng,$.lng,K.lng),Math.min(F.lat,q.lat,$.lat,K.lat)],ee=[Math.max(F.lng,q.lng,$.lng,K.lng),Math.max(F.lat,q.lat,$.lat,K.lat)],re=x&&x.pitch?x.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,te,ee,g,re,x);return this._fitInternal(ie,x,b)}_fitInternal(a,u,g){return a?(u=o.h(a,u)).linear?this.easeTo(u,g):this.flyTo(u,g):this}jumpTo(a,u){this.stop();const g=a.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,E=!1;"zoom"in a&&g.zoom!==+a.zoom&&(x=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=o.ci.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(b=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(E=!0,g.pitch=+a.pitch);const P=typeof a.padding=="number"?this._extendPadding(a.padding):a.padding;if(a.padding!=null&&!g.isPaddingEqual(P))if(a.retainPadding===!1){const I=g.clone();I.padding=P,g.setLocationAtPoint(g.center,I.centerPoint)}else g.padding=P;return a.preloadOnly?(this._preloadTiles(g),this):(this.fire(new o.A("movestart",u)).fire(new o.A("move",u)),x&&this.fire(new o.A("zoomstart",u)).fire(new o.A("zoom",u)).fire(new o.A("zoomend",u)),b&&this.fire(new o.A("rotatestart",u)).fire(new o.A("rotate",u)).fire(new o.A("rotateend",u)),E&&this.fire(new o.A("pitchstart",u)).fire(new o.A("pitch",u)).fire(new o.A("pitchend",u)),this.fire(new o.A("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Ii),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return o.w(Ii),this;this.stop();const x=g.zoom,b=g.pitch,E=g.bearing;g.setFreeCameraOptions(a);const P=x!==g.zoom,I=b!==g.pitch,z=E!==g.bearing;return this.fire(new o.A("movestart",u)).fire(new o.A("move",u)),P&&this.fire(new o.A("zoomstart",u)).fire(new o.A("zoom",u)).fire(new o.A("zoomend",u)),z&&this.fire(new o.A("rotatestart",u)).fire(new o.A("rotate",u)).fire(new o.A("rotateend",u)),I&&this.fire(new o.A("pitchstart",u)).fire(new o.A("pitch",u)).fire(new o.A("pitchend",u)),this.fire(new o.A("moveend",u)),this}easeTo(a,u){this._stop(!1,a.easeId),((a=o.h({offset:[0,0],duration:500,easing:o.eK},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const g=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),P=this.getPadding(),I="zoom"in a?+a.zoom:x,z="bearing"in a?this._normalizeBearing(a.bearing,b):b,F="pitch"in a?+a.pitch:E,q=this._extendPadding(a.padding),$=o.P.convert(a.offset);let K,te,ee;if(g.projection.name==="globe"){const Ee=o.ac.fromLngLat(g.center),Ve=$.rotate(-g.angle);Ee.x+=Ve.x/g.worldSize,Ee.y+=Ve.y/g.worldSize;const De=Ee.toLngLat(),dt=o.ci.convert(a.center||De);this._normalizeCenter(dt),K=g.centerPoint.add(Ve),te=new o.P(Ee.x,Ee.y).mult(g.worldSize),ee=new o.P(o.aD(dt.lng),o.aH(dt.lat)).mult(g.worldSize).sub(te)}else{K=g.centerPoint.add($);const Ee=g.pointLocation(K),Ve=o.ci.convert(a.center||Ee);this._normalizeCenter(Ve),te=g.project(Ee),ee=g.project(Ve).sub(te)}const re=g.zoomScale(I-x);let ie,ue;a.around&&(ie=o.ci.convert(a.around),ue=g.locationPoint(ie));const pe=this._zooming||I!==x,me=this._rotating||b!==z,Te=this._pitching||F!==E,we=!g.isPaddingEqual(q),Pe=a.retainPadding===!1?g.clone():g,be=Ee=>Ve=>{if(pe&&(Ee.zoom=o.ai(x,I,Ve)),me&&(Ee.bearing=o.ai(b,z,Ve)),Te&&(Ee.pitch=o.ai(E,F,Ve)),we&&(Pe.interpolatePadding(P,q,Ve),K=Pe.centerPoint.add($)),ie)Ee.setLocationAtPoint(ie,ue);else{const De=Ee.zoomScale(Ee.zoom-x),dt=I>x?Math.min(2,re):Math.max(.5,re),Je=Math.pow(dt,1-Ve),pt=Ee.unproject(te.add(ee.mult(Ve*Je)).mult(De));Ee.setLocationAtPoint(Ee.renderWorldCopies?pt.wrap():pt,K)}return a.preloadOnly||this._fireMoveEvents(u),Ee};if(a.preloadOnly){const Ee=this._emulate(be,a.duration,g);return this._preloadTiles(Ee),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=me,this._pitching=Te,this._padding=we,this._easeId=a.easeId,this._prepareEase(u,a.noMoveStart,Se),this._ease(be(g),Ee=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(u,Ee)},a),this}_prepareEase(a,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||g.moving||this.fire(new o.A("movestart",a)),this._zooming&&!g.zooming&&this.fire(new o.A("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new o.A("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new o.A("pitchstart",a))}_fireMoveEvents(a){this.fire(new o.A("move",a)),this._zooming&&this.fire(new o.A("zoom",a)),this._rotating&&this.fire(new o.A("rotate",a)),this._pitching&&this.fire(new o.A("pitch",a))}_afterEase(a,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new o.A("zoomend",a)),x&&this.fire(new o.A("rotateend",a)),b&&this.fire(new o.A("pitchend",a)),this.fire(new o.A("moveend",a))}flyTo(a,u){if(this._prefersReducedMotion(a)){const Ze=o.aF(a,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ze,u)}this.stop(),a=o.h({offset:[0,0],speed:1.2,curve:1.42,easing:o.eK},a);const g=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),P=this.getPadding(),I="zoom"in a?o.ay(+a.zoom,g.minZoom,g.maxZoom):x,z="bearing"in a?this._normalizeBearing(a.bearing,b):b,F="pitch"in a?+a.pitch:E,q=this._extendPadding(a.padding),$=g.zoomScale(I-x),K=o.P.convert(a.offset);let te=g.centerPoint.add(K);const ee=g.pointLocation(te),re=o.ci.convert(a.center||ee);this._normalizeCenter(re);const ie=g.project(ee),ue=g.project(re).sub(ie);let pe=a.curve;const me=Math.max(g.width,g.height),Te=me/$,we=ue.mag();if("minZoom"in a){const Ze=o.ay(Math.min(a.minZoom,x,I),g.minZoom,g.maxZoom),yt=me/g.zoomScale(Ze-x);pe=Math.sqrt(yt/we*2)}const Pe=pe*pe;function be(Ze){const yt=(Te*Te-me*me+(Ze?-1:1)*Pe*Pe*we*we)/(2*(Ze?Te:me)*Pe*we);return Math.log(Math.sqrt(yt*yt+1)-yt)}function Se(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ee(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Ve=be(0);let De=function(Ze){return Ee(Ve)/Ee(Ve+pe*Ze)},dt=function(Ze){return me*((Ee(Ve)*(Se(yt=Ve+pe*Ze)/Ee(yt))-Se(Ve))/Pe)/we;var yt},Je=(be(1)-Ve)/pe;if(Math.abs(we)<1e-6||!isFinite(Je)){if(Math.abs(me-Te)<1e-6)return this.easeTo(a,u);const Ze=Te<me?-1:1;Je=Math.abs(Math.log(Te/me))/pe,dt=function(){return 0},De=function(yt){return Math.exp(Ze*pe*yt)}}a.duration="duration"in a?+a.duration:1e3*Je/("screenSpeed"in a?+a.screenSpeed/pe:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const pt=b!==z,Ct=F!==E,We=!g.isPaddingEqual(q),Re=a.retainPadding===!1?g.clone():g,nt=Ze=>yt=>{const bt=yt*Je,Et=1/De(bt);Ze.zoom=yt===1?I:x+Ze.scaleZoom(Et),pt&&(Ze.bearing=o.ai(b,z,yt)),Ct&&(Ze.pitch=o.ai(E,F,yt)),We&&(Re.interpolatePadding(P,q,yt),te=Re.centerPoint.add(K));const jt=yt===1?re:Ze.unproject(ie.add(ue.mult(dt(bt))).mult(Et));return Ze.setLocationAtPoint(Ze.renderWorldCopies?jt.wrap():jt,te),Ze._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(u),Ze};if(a.preloadOnly){const Ze=this._emulate(nt,a.duration,g);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=pt,this._pitching=Ct,this._padding=We,this._prepareEase(u,!1),this._ease(nt(g),()=>this._afterEase(u),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!a){const g=this.handlers;g&&g.stop(!1)}return this}_ease(a,u,g){g.animate===!1||g.duration===0?(a(1),u()):(this._easeStart=o.q.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,u){a=o.bQ(a,-180,180);const g=Math.abs(a-u);return Math.abs(a-360-u)<g&&(a-=360),Math.abs(a+360-u)<g&&(a+=360),a}_normalizeCenter(a){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const g=a.lng-u.center.lng;a.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,u,g){const x=Math.ceil(15*u/1e3),b=[],E=a(g.clone());for(let P=0;P<=x;P++){const I=E(P/x);b.push(I.clone())}return b}_preloadTiles(a,u){}}class wd{constructor(a={}){this.options=a,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const u=this.options&&this.options.compact,g=a._getUIString("AttributionControl.ToggleAttribution");this._map=a,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=N("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const x=N("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",g),this._innerContainer=N("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(a){const g=u.reduce((x,b,E)=>(b.value&&(x+=`${b.key}=${b.value}${E<u.length-1?"&":""}`),x),"?");a.href=`${o.e.FEEDBACK_URL}/${g}#${Rg(this._map,!0)}`,a.rel="noopener nofollow"}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const u=this._map.style._mergedSourceCaches;for(const x in u){const b=u[x];if(b.used){const E=b.getSource();E.attribution&&a.indexOf(E.attribution)<0&&a.push(E.attribution)}}a.sort((x,b)=>x.length-b.length),a=a.filter((x,b)=>{for(let E=b+1;E<a.length;E++)if(a[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const g=a.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,a.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yp{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=N("div","mapboxgl-ctrl");const u=N("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const u in a){const g=a[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class O0{constructor(){o.aV(["_onIndoorUpdate"],this)}onAdd(a){return this._map=a,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",u=>this._onIndoorUpdate({selectedFloorId:u.selectedFloorId,floors:u.floors})),this._container}_createButton(a,u){const g=N("button",a,this._container);return g.type="button",g.addEventListener("click",u),g}_setButtonTitle(a,u){this._map&&(a.setAttribute("aria-label",u),a.innerHTML=`<strong>${u}</strong>`,a.firstElementChild&&a.firstElementChild.setAttribute("title",u))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(a){if(!a||!a.floors)return void(this._container.style.display="none");const u=this._model;this._model=a,this._container.style.display="inline-block";const g=a.floors.sort((x,b)=>x.levelOrder-b.levelOrder);u?(Array.from(this._container.children).forEach(x=>x.remove()),this.addCurrentFloors(g)):this.addCurrentFloors(g)}addCurrentFloors(a){for(const u of a){const g=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(u.id),Array.from(this._container.children).forEach(x=>{x.classList.remove("mapboxgl-ctrl-level-button-selected")}),g.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(g,u.shortName),this._model&&u.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(u.id),g.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(g)}}}class pS{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const u=++this._id;return this._queue.push({callback:a,id:u,cancelled:!1}),u}remove(a){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const x of g)if(x.id===a)return void(x.cancelled=!0)}run(a=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class _p{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const u=o.dx((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,u,g){this._start=this.getValue(u),this._end=a,this._startTime=u,this._endTime=u+g}}const JC={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class mS extends o.A{constructor(a,u,g,x){const{point:b,lngLat:E,originalEvent:P,target:I}=a;super(a.type,{point:b,lngLat:E,originalEvent:P,target:I}),this.preventDefault=()=>{a.preventDefault()},this.id=u,this.interaction=g,this.feature=x}}class j0{constructor(a){this.map=a,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(a,u){if(this.typeById.has(a))throw new Error(`Interaction id "${a}" already exists.`);const g=u.filter;let x=u.type;g&&this.filters.set(a,o.b3(g)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const b=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(a,u)):b.size===0&&this.map.on(x,this.handleType),b.size===0&&this.interactionsByType.set(x,b),b.set(a,u),this.typeById.set(a,x)}get(a){const u=this.typeById.get(a);if(!u)return;const g=this.interactionsByType.get(u);return g?g.get(a):void 0}remove(a){const u=this.typeById.get(a);if(!u)return;this.typeById.delete(a),this.filters.delete(a);const g=this.interactionsByType.get(u);g&&(g.delete(a),u==="mouseenter"||u==="mouseleave"?(this.delegatedInteractions.delete(a),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(u,this.handleType))}queryTargets(a,u){const g=[];for(const[x,b]of u)b.target&&g.push({targetId:x,target:b.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(a,g,this.map.transform)}handleMove(a){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const u=this.queryTargets(a.point,Array.from(this.delegatedInteractions).reverse());u.length&&(a.type="mouseenter",this.handleType(a,u));const g=new Map;for(const[x,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||g.set(b.id,b);g.size&&(a.type="mouseleave",this.handleType(a,Array.from(g.values())))}handleOut(a){const u=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);u.length&&(a.type="mouseleave",this.handleType(a,u)),this.hoveredFeatures.clear()}handleType(a,u){const g=a.type==="mouseenter";if(g&&!this.interactionsByType.has(a.type))return void o.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(a.type)).reverse(),b=!!u;u=u||this.queryTargets(a.point,x);let E=!1;const P=new Set;for(const I of u){for(const[z,F]of x){if(!F.target)continue;const q=I.variants?I.variants[z]:null;if(q){for(const $ of q){if(Um($,I,P,z))continue;const K=new o.dr(I,$),te=jf($,I,z);b&&(K.state=this.map.getFeatureState(K));const ee=g?this.prevHoveredFeatures.get(te):null,re=new mS(a,z,F,K),ie=ee?ee.stop:F.handler(re);if(g&&this.hoveredFeatures.set(te,{feature:I,stop:ie}),ie!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[I,z]of x){const{handler:F,target:q}=z;if(!q&&F(new mS(a,I,z,null))!==!1)break}}}function R0(m,a){if(Array.isArray(m)&&Array.isArray(a)){const u=new Set(m),g=new Set(a);return u.size===g.size&&m.every(x=>g.has(x))}return o.bv(m,a)}const vp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Sd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yl{constructor(a,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new zg({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,g&&(this.mousePitch=new k0({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(a,u){this.mouseRotate.mousedown(a,u),this.mousePitch&&this.mousePitch.mousedown(a,u),Y()}move(a,u){const g=this.map,x=this.mouseRotate.mousemoveWindow(a,u),b=x&&x.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const E=this.mousePitch.mousemoveWindow(a,u),P=E&&E.pitchDelta;P&&g.setPitch(g.getPitch()+P)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ne(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(o.h({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),ge(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,ge(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=je(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=je(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Os(m,a,u){if(m=new o.ci(m.lng,m.lat),a){const g=new o.ci(m.lng-360,m.lat),x=new o.ci(m.lng+360,m.lat),b=360*Math.ceil(Math.abs(m.lng-u.center.lng)/360),E=u.locationPoint3D(m).distSqr(a),P=a.x<0||a.y<0||a.x>u.width||a.y>u.height;u.locationPoint3D(g).distSqr(a)<E&&(P||Math.abs(g.lng-u.center.lng)<b)?m=g:u.locationPoint3D(x).distSqr(a)<E&&(P||Math.abs(x.lng-u.center.lng)<b)&&(m=x)}for(;Math.abs(m.lng-u.center.lng)>180;){const g=u.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const ss={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},da={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class ls extends o.E{constructor(a,u){super(),(a instanceof HTMLElement||u)&&(a=o.h({element:a},u)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:x="#3FB1CE",scale:b=1,draggable:E=!1,clickTolerance:P=0,rotation:I=da.rotation,rotationAlignment:z=da.rotationAlignment,pitchAlignment:F=da.pitchAlignment,occludedOpacity:q=da.occludedOpacity,altitude:$=da.altitude}=a||{};this._anchor=g,this._color=x,this._scale=b,this._draggable=E,this._clickTolerance=P,this._rotation=I,this._rotationAlignment=z,this._pitchAlignment=F,this._occludedOpacity=q,this._altitude=$,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),a&&a.element?(this._element=a.element,this._offset=o.P.convert(a&&a.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(a&&a.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ee=>{ee.preventDefault()}),this._element.addEventListener("mousedown",ee=>{ee.preventDefault()});const K=this._element.classList;for(const ee in ss)K.remove(`mapboxgl-marker-anchor-${ee}`);K.add(`mapboxgl-marker-anchor-${this._anchor}`);const te=a&&a.className?a.className.trim().split(/\s+/):[];K.add(...te),this._popup=null}_createDefaultMarker(){const a=N("div"),u=G("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},a);if(this._altitude===0){const g=G("radialGradient",{id:"shadowGradient"},G("defs",{},u));G("stop",{offset:"10%","stop-opacity":.4},g),G("stop",{offset:"100%","stop-opacity":.05},g),G("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u)}return G("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),G("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),G("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),a}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=o.ci.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(a){return a===this._altitude||(this._defaultMarker&&(this._altitude===0&&a!==0||this._altitude!==0&&a===0)&&(this._element=this._createDefaultMarker()),this._altitude=a||da.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,a._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const u=a.code,g=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(a){const u=a.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,u=this._pos;if(!a||!u)return!1;const g=a.unproject(u,this._altitude),x=a.getFreeCameraOptions();if(!x.position)return!1;const b=x.position.toLngLat();return b.distanceTo(g)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const u=this._pos;if(!u||u.x<0||u.x>a.transform.width||u.y<0||u.y>a.transform.height)return void this._clearFadeTimer();const g=a.unproject(u,this._altitude);let x;a._showingGlobe()&&o.eW(a.transform,this._lngLat)?x=0:(x=1-a._queryFogOpacity(g),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${ss[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const a=this._pos,u=this._map,g=this.getPitchAlignment();if(!u||!a||g!=="map")return"";if(!u._showingGlobe()){const I=u.getPitch();return I?`rotateX(${I}deg)`:""}const x=o.cU(o.eX(u.transform,this._lngLat)),b=a.sub(o.eY(u.transform)),E=Math.abs(b.x)+Math.abs(b.y);if(E===0)return"";const P=x/E;return`rotateX(${-b.y*P}deg) rotateY(${b.x*P}deg)`}_calculateZTransform(){const a=this._pos,u=this._map;if(!u||!a)return"";let g=0;const x=this.getRotationAlignment();if(x==="map")if(u._showingGlobe()){const b=u.project(new o.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=u.project(new o.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);g=o.cU(Math.atan2(E.y,E.x))-90}else g=-u.getBearing();else if(x==="horizon"){const b=o.af(4,6,u.getZoom()),E=o.eY(u.transform);E.y+=b*u.transform.height;const P=a.sub(E),I=o.cU(Math.atan2(P.y,P.x));g=(I>90?I-270:I+90)*(1-b)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Os(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat,this._altitude),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=o.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){const u=this._map;if(!u)return;const g=this._pointerdownPos,x=this._positionDelta;if(g&&x){if(!this._isDragging){const b=this._clickTolerance||u._clickTolerance;if(a.point.dist(g)<b)return;this._isDragging=!0}this._pos=a.point.sub(x),this._lngLat=u.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(a){const u=this._map,g=this._pos;u&&g&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(g),this._pointerdownPos=a.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const u=this._map;return u&&(a?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||da.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||da.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||da.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||da.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const QC={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},eP={maxWidth:100,unit:"metric"},tP={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},rP={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},gS=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ko(m=new o.P(0,0),a="bottom"){if(typeof m=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(a){case"top":return new o.P(0,m);case"top-left":return new o.P(u,u);case"top-right":return new o.P(-u,u);case"bottom":return new o.P(0,-m);case"bottom-left":return new o.P(u,-u);case"bottom-right":return new o.P(-u,-u);case"left":return new o.P(m,0);case"right":return new o.P(-m,0)}return new o.P(0,0)}return m instanceof o.P||Array.isArray(m)?o.P.convert(m):o.P.convert(m[a]||[0,0])}return{version:v,supported:B.supported,setRTLTextPlugin:o.f0,getRTLTextPluginStatus:o.e$,Map:class extends bl{constructor(m){T.mark(w.create);const a=m;if((m=o.h({},vp,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&o.eU(window)&&(m.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Cv(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new pS,this._domRenderTaskQueue=new pS,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.h({},JC,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new _p(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Oe(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const u=document.getElementById(m.container);if(!u)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=u}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new HC),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ug(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||o.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new CC(this),m.hash&&(this._hash=new jg(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const u=m.bounds;u&&(this.resize(),this.fitBounds(u,o.h({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new wd({customAttribution:m.customAttribution})),this._logoControl=new yp,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new o.A(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new o.A(`${u.dataType}dataloading`,u))}),this._interactions=new j0(this)}_getMapId(){return this._mapId}addControl(m,a){if(a===void 0&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[a];return a.indexOf("bottom")!==-1?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new o.A("movestart",m)).fire(new o.A("move",m)),this.fire(new o.A("resize",m)),a&&this.fire(new o.A("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(o.aG.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(a=>a.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(a=>a==="auto"?navigator.language:a):m}setLanguage(m){const a=this._parseLanguage(m);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,a=m.projection.name;let u;a==="globe"&&m.zoom>=o.cI?(m.setMercatorFromTransition(),u=!0):a==="mercator"&&m.zoom<o.cI&&(m.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,a){return this._updateProjection(m||a||{name:"mercator"})}_updateProjection(m){let a;return a=m.name==="globe"&&this.transform.zoom>=o.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),a&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,a){return this.transform.locationPoint3D(o.ci.convert(m),a)}unproject(m,a){return this.transform.pointLocation3D(o.P.convert(m),a)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,a,u){const g=x=>{let b=[];if(Array.isArray(a)){const E=a.filter(P=>this.getLayer(P));b=E.length?this.queryRenderedFeatures(x,{layers:E}):[]}else b=this.queryRenderedFeatures(x,{target:a});return b};if(m==="mouseenter"||m==="mouseover"){let x=!1;return{listener:u,targets:a,delegates:{mousemove:b=>{const E=g(b.point);E.length?x||(x=!0,u.call(this,new ii(m,this,b.originalEvent,{features:E}))):x=!1},mouseout:()=>{x=!1}}}}if(m==="mouseleave"||m==="mouseout"){let x=!1;return{listener:u,targets:a,delegates:{mousemove:b=>{g(b.point).length?x=!0:x&&(x=!1,u.call(this,new ii(m,this,b.originalEvent)))},mouseout:b=>{x&&(x=!1,u.call(this,new ii(m,this,b.originalEvent)))}}}}{const x=b=>{const E=g(b.point);E.length&&(b.features=E,u.call(this,b),delete b.features)};return{listener:u,targets:a,delegates:{[m]:x}}}}on(m,a,u){if(typeof a=="function"||u===void 0)return super.on(m,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const g=this._createDelegatedListener(m,a,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(m,a,u){if(typeof a=="function"||u===void 0)return super.once(m,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const g=this._createDelegatedListener(m,a,u);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(m,a,u){if(typeof a=="function"||u===void 0)return super.off(m,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(x=>{for(let b=0;b<x.length;b++){const E=x[b];if(E.listener===u&&R0(E.targets,a)){for(const P in E.delegates)this.off(P,E.delegates[P]);return x.splice(b,1),this}}})(g),this}queryRenderedFeatures(m,a){if(!this.style)return[];if(m===void 0||m instanceof o.P||Array.isArray(m)||a!==void 0||(a=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!a){const b=this.style.queryRenderedFeatures(m,void 0,this.transform),E=this.style.queryRenderedFeatureset(m,void 0,this.transform);return b.concat(E)}let u=!0;if(a.target&&(u=this._isTargetValid(a.target),u&&!a.layers))return this.style.queryRenderedFeatureset(m,a,this.transform);let g=!0;if(a.layers&&Array.isArray(a.layers)){for(const b of a.layers)if(!this._isValidId(b)){g=!1;break}if(g&&!a.target)return this.style.queryRenderedFeatures(m,a,this.transform)}let x=[];return g&&(x=x.concat(this.style.queryRenderedFeatures(m,a,this.transform))),u&&(x=x.concat(this.style.queryRenderedFeatureset(m,a,this.transform))),x}querySourceFeatures(m,a){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,a)}isPointOnSurface(m){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&o.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(m))}addInteraction(m,a){return this._interactions.add(m,a),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,a){return a=o.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&m&&a.diff!==!1&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(m,(u,g)=>{if(u){const x=typeof u=="string"?u:u instanceof Error?u.message:u.error;o.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(m,a)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(m,a))}_getUIString(m){const a=this._locale[m];if(a==null)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const u=o.h({},a);a&&a.config&&(u.initialConfig=a.config,delete u.config),this.style=new Ps(this,u).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ps(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.dk(m)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const a of m)if(!this._isValidId(a))return!1;return!0}return this._isTargetValid(m)}addSource(m,a){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,a,u){this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,u)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,a,{pixelRatio:u=1,sdf:g=!1,stretchX:x,stretchY:b,content:E}={}){this._lazyInitEmptyStyle();const P=o.I.from(m);if(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){const{width:I,height:z,data:F}=o.q.getImageData(a);this.style.addImage(P,{data:new o.r({width:I,height:z},F),pixelRatio:u,stretchX:x,stretchY:b,content:E,sdf:g,version:0,usvg:!1})}else if(a.width===void 0||a.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:z}=a,F=a;this.style.addImage(P,{data:new o.r({width:I,height:z},new Uint8Array(F.data)),pixelRatio:u,stretchX:x,stretchY:b,content:E,sdf:g,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}updateImage(m,a){this._lazyInitEmptyStyle();const u=o.I.from(m),g=this.style.getImage(u);if(!g)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?o.q.getImageData(a):a,{width:b,height:E,data:P}=x;if(b===void 0||E===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||E!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${b}, ${E})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const I=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);let z=!1;g.usvg?(g.data=new o.r({width:b,height:E},new Uint8Array(P)),g.usvg=!1,g.icon=void 0,z=!0):g.data.replace(P,I),this.style.updateImage(u,g,z)}hasImage(m){return m?!!this.style&&!!this.style.getImage(o.I.from(m)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(o.I.from(m))}loadImage(m,a){o.o(this._requestManager.transformRequest(m,o.R.Image),(u,g)=>{a(u,g instanceof HTMLImageElement?o.q.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,a){this._lazyInitEmptyStyle(),this.style.addModel(m,a)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,a){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)):this}getSlot(m){const a=this.getLayer(m);return a&&a.slot||null}setSlot(m,a){return this.style.setSlot(m,a),this.style.mergeLayers(),this._update(!0)}addImport(m,a){return this.style.addImport(m,a).catch(u=>this.fire(new o.z(new Error("Failed to add import",u)))),this}updateImport(m,a){return typeof a!="string"&&a.id!==m?(this.removeImport(m),this.addImport(a)):(this.style.updateImport(m,a),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,a){return this.style.moveImport(m,a),this._update(!0)}moveLayer(m,a){return this._isValidId(m)?(this.style.moveLayer(m,a),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const a=this.style.getOwnLayer(m);return a?a.type==="custom"?a.implementation:a.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,a,u){return this._isValidId(m)?(this.style.setLayerZoomRange(m,a,u),this._update(!0)):this}setFilter(m,a,u={}){return this._isValidId(m)?(this.style.setFilter(m,a,u),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,a,u,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,a,u,g),this._update(!0)):this}getPaintProperty(m,a){return this._isValidId(m)?this.style.getPaintProperty(m,a):null}setLayoutProperty(m,a,u,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,a,u,g),this._update(!0)):this}getLayoutProperty(m,a){return this._isValidId(m)?this.style.getLayoutProperty(m,a):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,a){return this.style.setSchema(m,a),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,a){return this.style.setConfig(m,a),this._update(!0)}getConfigProperty(m,a){return this.style.getConfigProperty(m,a)}setConfigProperty(m,a,u){return this.style.setConfigProperty(m,a,u),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const a=m[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,a){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,a),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.ci.convert(m),this.transform):0}setFeatureState(m,a){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,a),this._update())}removeFeatureState(m,a){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,a),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.indoor.selectFloor(m)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new O0),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let u,g,x,b=this._container;for(;b&&(!g||!x);){const E=window.getComputedStyle(b).transform;E&&E!=="none"&&(u=E.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(g=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(x=u[3])),b=b.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=x?Math.abs(a/x):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=N("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=N("div","mapboxgl-canvas-container",m);this._canvas=N("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=N("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{g[x]=N("div",`mapboxgl-ctrl-${x}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a){const u=o.q.devicePixelRatio||1;this._canvas.width=u*Math.ceil(m),this._canvas.height=u*Math.ceil(a),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const a=this._markers.indexOf(m);a!==-1&&this._markers.splice(a,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const a=this._popups.indexOf(m);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const m=o.h({},B.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",m);a?(Ut(a,!0),this.painter=new Xc(a,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.l.testSupport(a)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let a;this.fire(new o.A("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,g=o.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=x.createQuery(),x.beginQuery(u.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,F=this.transform.pitch,q=o.q.now(),$=new o.aa(z,{now:q,fadeDuration:b,pitch:F,transition:this.style.transition,worldview:this._worldview});this.style.update($)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g);const P=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),P&&(this._placementDirty=P.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,T.mark(w.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const z=o.q.now()-g;x.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const F=x.getQueryParameter(a,x.QUERY_RESULT)/1e6;x.deleteQuery(a),this.fire(new o.A("gpu-timing-frame",{cpuTime:z,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(z);this.fire(new o.A("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(z);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:F}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(I||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,T.mark(w.fullLoad),this._performanceMetricsCollection&&br(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const a of this._markers)m&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!m||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(m,a=!1){const u=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(a||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const x=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const E=Math.abs(x-b);if(E>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(b),u(b);this._averageElevation.easeTo(b,m,300)}else if(E>1e-4)return this._averageElevation.jumpTo(b),u(b)}return!!this._averageElevation.isEasing(m)&&u(this._averageElevation.getValue(m))}_authenticate(){Qt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===Ye||m.status===401)){const a=this.painter.context.gl;Ut(a,!1),this._logoControl instanceof yp&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),xr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Er(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function x(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const E=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,E),E}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(x(m),a.canvasCopies.map(x),a.timeStamps)}_canvasPixelComparison(m,a,u){let g=u[1]-u[0];const x=m.length/4;for(let b=0;b<a.length;b++){const E=a[b];let P=0;for(let I=0;I<E.length;I+=4)E[I]===m[I]&&E[I+1]===m[I+1]&&E[I+2]===m[I+2]&&E[I+3]===m[I+3]&&(P+=1);g+=(u[b+2]-u[b+1])*(1-P/x)}return g}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Sr.delete(this.painter.context.gl),Yt.remove(),Vt.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=o.q.frame(a=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(a)}))}_preloadTiles(m){const a=this.style?this.style.getSourceCaches():[];return o.bt(a,(u,g)=>u._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,a){o.eV(m,a)}get version(){return v}},NavigationControl:class{constructor(m={}){this.options=o.h({},Sd,m),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),N("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),N("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:a}):u.resetNorth({},{originalEvent:a}))}),this._compassIcon=N("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const a=m.getZoom(),u=a===m.getMaxZoom(),g=a===m.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yl(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,a){const u=N("button",m,this._container);return u.type="button",u.addEventListener("click",a),u}_setButtonTitle(m,a){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${a}`);m.setAttribute("aria-label",u),m.firstElementChild&&m.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends o.E{constructor(m={}){super();const a=navigator.geolocation;this.options=o.h({geolocation:a},QC,m),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=gd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const a=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,m(u)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>a(u.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),u=m.coords;return!!a&&(u.longitude<a.getWest()||u.longitude>a.getEast()||u.latitude<a.getSouth()||u.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",m)),this._finish()}}_updateCamera(m){const a=new o.ci(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,g=this._map.getBearing(),x=o.h({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(u),x,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new o.ci(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,a=o.cb(1,m._center.lat)*m.worldSize,u=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=N("button","mapboxgl-ctrl-geolocate",this._container),N("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N("div","mapboxgl-user-location"),this._dotElement.appendChild(N("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(N("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ls({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=N("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ls({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:wd,ScaleControl:class{constructor(m={}){this.options=o.h({},eP,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,a=this._map,u=a._containerHeight/2,g=a._containerWidth/2-m/2,x=a.unproject([g,u]),b=a.unproject([g+m,u]),E=x.distanceTo(b);if(this.options.unit==="imperial"){const P=3.2808*E;P>5280?this._setScale(m,P/5280,"mile"):this._setScale(m,P,"foot")}else this.options.unit==="nautical"?this._setScale(m,E/1852,"nautical-mile"):E>=1e3?this._setScale(m,E/1e3,"kilometer"):this._setScale(m,E,"meter")}_setScale(m,a,u){this._map._requestDomTask(()=>{const g=function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let P=b/E;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(I){const z=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*z)/z}(P),E*P}(a),x=g/a;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(g):`${g}&nbsp;${tP[u]}`,this._container.style.width=m*x+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=N("button","mapboxgl-ctrl-fullscreen",this._controlContainer);N("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:O0,Popup:class extends o.E{constructor(m){super(),this.options=o.h(Object.create(rP),m),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=o.ci.convert(m),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const a=document.createDocumentFragment(),u=document.createElement("body");let g;for(u.innerHTML=m;g=u.firstChild,g;)a.appendChild(g);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=N("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(m),this.options.closeButton){const u=this._closeButton=N("button","mapboxgl-popup-close-button",a);u.type="button",u.setAttribute("aria-label","Close popup"),u.innerHTML='<span aria-hidden="true">&#215;</span>',u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let a;return this._classList.delete(m)?a=!1:(this._classList.add(m),a=!0),this._updateClassList(),a}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const a=this._map,u=this._container,g=this._pos;if(!a||!u||!g)return"bottom";const x=u.offsetWidth,b=u.offsetHeight,E=g.x<x/2,P=g.x>a.transform.width-x/2;if(g.y+m<b)return E?"top-left":P?"top-right":"top";if(g.y>a.transform.height-b){if(E)return"bottom-left";if(P)return"bottom-right"}return E?"left":P?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),m.className=a.join(" ")}_update(m){const a=this._map,u=this._content;if(!a||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=N("div","mapboxgl-popup",a.getContainer()),this._tip=N("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Os(this._lngLat,this._pos,a.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m instanceof o.P?m:a.project(this._lngLat,this._altitude),b=Ko(this.options.offset),E=this._anchor=this._getAnchor(b.y),P=Ko(this.options.offset,E),I=x.add(P).round();a._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${ss[E]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&a._showingGlobe()){const x=o.eW(a.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(gS);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:ls,Style:Ps,LngLat:o.ci,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:x1,Evented:o.E,config:o.e,prewarm:o.e_,clearPrewarmedResources:o.eZ,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(m){o.e.ACCESS_TOKEN=m},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(m){o.e.API_URL=m},get workerCount(){return o.f7.workerCount},set workerCount(m){o.f7.workerCount=m},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){o.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){o.f6(m)},get workerUrl(){return o.f5.workerUrl},set workerUrl(m){o.f5.workerUrl=m},get workerClass(){return o.f5.workerClass},set workerClass(m){o.f5.workerClass=m},get workerParams(){return o.f5.workerParams},set workerParams(m){o.f5.workerParams=m},get dracoUrl(){return o.f4()},set dracoUrl(m){o.f3(m)},get meshoptUrl(){return o.f2()},set meshoptUrl(m){o.f1(m)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var p=c;return p})})(sZ);var ppe=sZ.exports;const E2=ki(ppe),iU=e=>{let t;const r=new Set,n=(o,v)=>{const w=typeof o=="function"?o(t):o;if(!Object.is(w,t)){const T=t;t=v??(typeof w!="object"||w===null)?w:Object.assign({},t,w),r.forEach(M=>M(t,T))}},c=()=>t,h={setState:n,getState:c,getInitialState:()=>p,subscribe:o=>(r.add(o),()=>r.delete(o))},p=t=e(n,c,h);return h},mpe=e=>e?iU(e):iU,gpe=e=>e;function ype(e,t=gpe){const r=Ne.useSyncExternalStore(e.subscribe,Ne.useCallback(()=>t(e.getState()),[e,t]),Ne.useCallback(()=>t(e.getInitialState()),[e,t]));return Ne.useDebugValue(r),r}const oU=e=>{const t=mpe(e),r=n=>ype(t,n);return Object.assign(r,t),r},cZ=e=>e?oU(e):oU,vo=cZ((e,t)=>({preschools:[],filteredPreschools:[],selectedPreschool:null,searchFilters:{},isLoading:!1,mapCenter:[15.2,62.4],mapZoom:4.9,showClusters:!0,heatmapType:"density",heatmapIntensity:1,showHeatmap:!1,layerVisibility:{heatmap:!1,clusters:!0,markers:!0,communeBorders:!1},visiblePreschools:[],listContext:"viewport",listSortOrder:"distance",selectedCommune:null,statisticsData:null,showStatistics:!1,performanceMode:"high",searchBoxCollapsed:!1,listPanelCollapsed:!1,searchTerm:"",updatePreschool:r=>e(n=>({preschools:n.preschools.map(c=>c.id===r.id?r:c)})),setPreschools:r=>{console.log(`Setting ${r.length} preschools in store`),e({preschools:r}),t().applyFilters(),e({lastUpdated:Date.now()})},setFilteredPreschools:r=>e({filteredPreschools:r}),setSelectedPreschool:r=>e({selectedPreschool:r}),setSearchFilters:r=>{const n=t(),c={...n.searchFilters,...r};e({searchFilters:c}),n.applyFilters();const h=t();if(r.kommuner&&r.kommuner.length>0)if(r.kommuner.length===1){const p=r.kommuner[0],o=_pe(p);if(o)e({mapCenter:o,mapZoom:11});else{const v=h.filteredPreschools.filter(w=>w.kommun===p);if(v.length>0){const w=v.map(M=>M.latitud).filter(Boolean),T=v.map(M=>M.longitud).filter(Boolean);if(w.length>0){const M=w.reduce((V,U)=>V+U,0)/w.length,O=T.reduce((V,U)=>V+U,0)/T.length,D=Math.max(...w)-Math.min(...w),B=Math.max(...T)-Math.min(...T),N=Math.max(D,B);let G=12;N<.005?G=15:N<.01?G=14:N<.02?G=13:N<.05?G=12:G=11,e({mapCenter:[O,M],mapZoom:G})}}}}else{const p=h.filteredPreschools,o=p.map(w=>w.latitud).filter(Boolean),v=p.map(w=>w.longitud).filter(Boolean);if(o.length>0){const w=o.reduce((N,G)=>N+G,0)/o.length,T=v.reduce((N,G)=>N+G,0)/v.length,M=Math.max(...o)-Math.min(...o),O=Math.max(...v)-Math.min(...v),D=Math.max(M,O);let B=8;D<.05?B=11:D<.1?B=10:D<.3?B=9:D<.5?B=8:D<1?B=7:B=6,e({mapCenter:[T,w],mapZoom:B})}}else if(r.center&&r.nearbyMode)e({mapCenter:r.center,mapZoom:13});else if(r.query&&!r.kommuner){const p=h.filteredPreschools;if(p.length>0)if(p.length===1){const o=p[0];o.longitud&&o.latitud&&e({mapCenter:[o.longitud,o.latitud],mapZoom:15})}else{const o=p.map(w=>w.latitud).filter(Boolean),v=p.map(w=>w.longitud).filter(Boolean);if(o.length>0){const w=o.reduce((N,G)=>N+G,0)/o.length,T=v.reduce((N,G)=>N+G,0)/v.length,M=Math.max(...o)-Math.min(...o),O=Math.max(...v)-Math.min(...v),D=Math.max(M,O);let B=12;D<.005?B=15:D<.01?B=14:D<.02?B=13:D<.05?B=12:D<.1?B=11:B=10,e({mapCenter:[T,w],mapZoom:B})}}}else if(h.filteredPreschools.length>0&&Object.keys(c).length>0){const p=h.filteredPreschools,o=p.map(w=>w.latitud).filter(Boolean),v=p.map(w=>w.longitud).filter(Boolean);if(o.length>0&&v.length>0){const w=o.reduce((N,G)=>N+G,0)/o.length,T=v.reduce((N,G)=>N+G,0)/v.length,M=Math.max(...o)-Math.min(...o),O=Math.max(...v)-Math.min(...v),D=Math.max(M,O);let B=10;D<.01?B=15:D<.05?B=13:D<.1?B=11:D<.5?B=9:B=7,e({mapCenter:[T,w],mapZoom:B})}}},clearFilters:()=>{e({searchFilters:{},mapCenter:[15,62],mapZoom:5}),t().applyFilters()},clearSearchFilters:()=>{e({searchFilters:{},mapCenter:[15,62],mapZoom:5}),t().applyFilters()},clearSpecificFilter:r=>{const n=t(),c={...n.searchFilters};delete c[r],r==="nearbyMode"?(delete c.center,delete c.radius,e({searchFilters:c,mapCenter:[15,62],mapZoom:5})):e({searchFilters:c}),n.applyFilters()},get hasActiveFilters(){const r=t().searchFilters;return!!(r.kommuner&&r.kommuner.length>0||r.huvudman&&r.huvudman!=="alla"||r.maxChildren&&r.maxChildren<200||r.nearbyMode||r.radius&&r.center||r.query&&r.query.trim().length>0||r.minPersonaltäthet||r.maxPersonaltäthet||r.minExamen||r.maxExamen||r.minBarngrupper||r.maxBarngrupper||r.travelTime)},setLoading:r=>e({isLoading:r}),setMapCenter:r=>e({mapCenter:r}),setMapZoom:r=>e({mapZoom:r}),setShowClusters:r=>e({showClusters:r}),setHeatmapType:r=>e({heatmapType:r}),setHeatmapIntensity:r=>e({heatmapIntensity:r}),setShowHeatmap:r=>e({showHeatmap:r}),setLayerVisibility:(r,n)=>{e(c=>({layerVisibility:{...c.layerVisibility,[r]:n}}))},setSelectedCommune:r=>e({selectedCommune:r}),setStatisticsData:r=>e({statisticsData:r}),setShowStatistics:r=>e({showStatistics:r}),setVisiblePreschools:r=>e({visiblePreschools:r}),setListContext:r=>e({listContext:r}),setListSortOrder:r=>e({listSortOrder:r}),updateVisiblePreschoolsFromViewport:r=>{const{filteredPreschools:n,listSortOrder:c}=t(),h=n.filter(p=>{if(!p.latitud||!p.longitud)return!1;const o=p.latitud,v=p.longitud;return o>=r.south&&o<=r.north&&v>=r.west&&v<=r.east});if(h.length<1e3)switch(c){case"rating":h.sort((p,o)=>(o.google_rating||0)-(p.google_rating||0));break;case"name":h.sort((p,o)=>p.namn.localeCompare(o.namn));break;case"quality":h.sort((p,o)=>(o.andel_med_förskollärarexamen||0)-(p.andel_med_förskollärarexamen||0));break}e({visiblePreschools:h})},setPerformanceMode:r=>e({performanceMode:r}),setSearchBoxCollapsed:r=>e({searchBoxCollapsed:r}),setListPanelCollapsed:r=>e({listPanelCollapsed:r}),setSearchTerm:r=>e({searchTerm:r}),applyFilters:()=>{const{preschools:r,searchFilters:n}=t(),c=r.filter(h=>{if(n.query){const p=n.query.toLowerCase(),o=h.namn.toLowerCase().includes(p),v=h.kommun.toLowerCase().includes(p);if(!o&&!v)return!1}if(n.maxChildren&&h.antal_barn&&h.antal_barn>n.maxChildren||n.kommuner&&n.kommuner.length>0&&!n.kommuner.includes(h.kommun))return!1;if(n.huvudman){const p=n.huvudman==="Fristående"?"Enskild":n.huvudman;if(h.huvudman!==p)return!1}if(n.minPersonaltäthet&&(!h.personaltäthet||h.personaltäthet<n.minPersonaltäthet)||n.maxPersonaltäthet&&(!h.personaltäthet||h.personaltäthet>n.maxPersonaltäthet)||n.minExamen&&(!h.andel_med_förskollärarexamen||h.andel_med_förskollärarexamen<n.minExamen)||n.maxExamen&&(!h.andel_med_förskollärarexamen||h.andel_med_förskollärarexamen>n.maxExamen)||n.minBarngrupper&&h.antal_barngrupper<n.minBarngrupper||n.maxBarngrupper&&h.antal_barngrupper>n.maxBarngrupper)return!1;if(n.radius&&n.center){const[p,o]=Array.isArray(n.center)?n.center:"lng"in n.center?[n.center.lng,n.center.lat]:[n.center.lon,n.center.lat],v=aU(o,p,h.latitud,h.longitud),w=n.radius/1e3;if(v>w)return!1}if(n.travelTime){const p=n.travelTime.userLocation.lat,o=n.travelTime.userLocation.lng,v=aU(p,o,h.latitud,h.longitud),w={walking:5,bicycling:15,driving:30,transit:20}[n.travelTime.transportMode];if(v/w*60>n.travelTime.maxMinutes)return!1}return!0});e({filteredPreschools:c}),console.log(`🔍 Applied filters, ${c.length} preschools match criteria`)}}));function aU(e,t,r,n){const c=LT(r-e),h=LT(n-t),p=Math.sin(c/2)*Math.sin(c/2)+Math.cos(LT(e))*Math.cos(LT(r))*Math.sin(h/2)*Math.sin(h/2);return 6371*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))}function LT(e){return e*(Math.PI/180)}function _pe(e){return{Stockholm:[18.0686,59.3293],Göteborg:[11.9746,57.7089],Malmö:[13.0034,55.605],Uppsala:[17.6389,59.8585],Västerås:[16.5554,59.6099],Örebro:[15.2066,59.2741],Linköping:[15.6214,58.4108],Helsingborg:[12.6945,56.0465],Jönköping:[14.1618,57.7826],Norrköping:[16.1926,58.5877],Lund:[13.191,55.7047],Umeå:[20.263,63.8258],Gävle:[17.1414,60.6749],Borås:[12.9401,57.721],Eskilstuna:[16.5077,59.3706],Södertälje:[17.6253,59.1955],Karlstad:[13.5034,59.3793],Täby:[18.0631,59.4439],Växjö:[14.8059,56.8777],Halmstad:[12.858,56.6745],Sundsvall:[17.3063,62.3908],Luleå:[22.1567,65.5848],Trollhättan:[12.2886,58.2837],Östersund:[14.6357,63.1792],Borlänge:[15.4357,60.4858],Falun:[15.6356,60.6066],Skövde:[13.8454,58.3914],Karlskrona:[15.5866,56.1612],Kristianstad:[14.1591,56.0294],Kalmar:[16.3614,56.6634],Vänersborg:[12.3225,58.3789],Varberg:[12.2504,57.1057],Trelleborg:[13.1567,55.3753],Åkersberga:[18.2878,59.4797],Visby:[18.2948,57.6348],Mora:[14.5389,61.0088],Sandviken:[16.7725,60.6184],Kiruna:[20.2253,67.8558],Kungälv:[11.9746,57.8737],Partille:[11.9989,57.7396],Mölndal:[12.0134,57.6554],Lerum:[12.2691,57.7706],Stenungsund:[11.8263,58.0706],Ale:[12.0465,57.9378],Alingsås:[12.5344,57.9304],Vårgårda:[12.8162,58.0356],Herrljunga:[13.0239,58.0916],Tranemo:[13.3454,57.4886],Svenljunga:[13.1064,57.4976],Vara:[12.9584,58.2596],Götene:[13.4234,58.3896],Tibro:[12.5264,58.4236],Lidköping:[13.1577,58.5052],Mariestad:[13.8238,58.7096],Kungsbacka:[12.0784,57.4866]}[e]||null}const i3=Z.createContext({});function Xw(e){const t=Z.useRef(null);return t.current===null&&(t.current=e()),t.current}const o3=typeof window<"u",a3=o3?Z.useLayoutEffect:Z.useEffect,ik=Z.createContext(null);function s3(e,t){e.indexOf(t)===-1&&e.push(t)}function l3(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const Ph=(e,t,r)=>r>t?t:r<e?e:r;let c3=()=>{};const Mh={},uZ=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function hZ(e){return typeof e=="object"&&e!==null}const dZ=e=>/^0[^.\s]+$/u.test(e);function u3(e){let t;return()=>(t===void 0&&(t=e()),t)}const Dl=e=>e,vpe=(e,t)=>r=>t(e(r)),Yw=(...e)=>e.reduce(vpe),Qb=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n};class h3{constructor(){this.subscriptions=[]}add(t){return s3(this.subscriptions,t),()=>l3(this.subscriptions,t)}notify(t,r,n){const c=this.subscriptions.length;if(c)if(c===1)this.subscriptions[0](t,r,n);else for(let h=0;h<c;h++){const p=this.subscriptions[h];p&&p(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const xu=e=>e*1e3,bu=e=>e/1e3;function fZ(e,t){return t?e*(1e3/t):0}const pZ=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,xpe=1e-7,bpe=12;function wpe(e,t,r,n,c){let h,p,o=0;do p=t+(r-t)/2,h=pZ(p,n,c)-e,h>0?r=p:t=p;while(Math.abs(h)>xpe&&++o<bpe);return p}function Jw(e,t,r,n){if(e===t&&r===n)return Dl;const c=h=>wpe(h,0,1,e,r);return h=>h===0||h===1?h:pZ(c(h),t,n)}const mZ=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,gZ=e=>t=>1-e(1-t),yZ=Jw(.33,1.53,.69,.99),d3=gZ(yZ),_Z=mZ(d3),vZ=e=>(e*=2)<1?.5*d3(e):.5*(2-Math.pow(2,-10*(e-1))),f3=e=>1-Math.sin(Math.acos(e)),xZ=gZ(f3),bZ=mZ(f3),Spe=Jw(.42,0,1,1),Tpe=Jw(0,0,.58,1),wZ=Jw(.42,0,.58,1),Epe=e=>Array.isArray(e)&&typeof e[0]!="number",SZ=e=>Array.isArray(e)&&typeof e[0]=="number",Ape={linear:Dl,easeIn:Spe,easeInOut:wZ,easeOut:Tpe,circIn:f3,circInOut:bZ,circOut:xZ,backIn:d3,backInOut:_Z,backOut:yZ,anticipate:vZ},kpe=e=>typeof e=="string",sU=e=>{if(SZ(e)){c3(e.length===4);const[t,r,n,c]=e;return Jw(t,r,n,c)}else if(kpe(e))return Ape[e];return e},zT=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Cpe(e,t){let r=new Set,n=new Set,c=!1,h=!1;const p=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function v(T){p.has(T)&&(w.schedule(T),e()),T(o)}const w={schedule:(T,M=!1,O=!1)=>{const D=O&&c?r:n;return M&&p.add(T),D.has(T)||D.add(T),T},cancel:T=>{n.delete(T),p.delete(T)},process:T=>{if(o=T,c){h=!0;return}c=!0,[r,n]=[n,r],r.forEach(v),r.clear(),c=!1,h&&(h=!1,w.process(T))}};return w}const Ppe=40;function TZ(e,t){let r=!1,n=!0;const c={delta:0,timestamp:0,isProcessing:!1},h=()=>r=!0,p=zT.reduce((V,U)=>(V[U]=Cpe(h),V),{}),{setup:o,read:v,resolveKeyframes:w,preUpdate:T,update:M,preRender:O,render:D,postRender:B}=p,N=()=>{const V=Mh.useManualTiming?c.timestamp:performance.now();r=!1,Mh.useManualTiming||(c.delta=n?1e3/60:Math.max(Math.min(V-c.timestamp,Ppe),1)),c.timestamp=V,c.isProcessing=!0,o.process(c),v.process(c),w.process(c),T.process(c),M.process(c),O.process(c),D.process(c),B.process(c),c.isProcessing=!1,r&&t&&(n=!1,e(N))},G=()=>{r=!0,n=!0,c.isProcessing||e(N)};return{schedule:zT.reduce((V,U)=>{const X=p[U];return V[U]=(Y,ne=!1,se=!1)=>(r||G(),X.schedule(Y,ne,se)),V},{}),cancel:V=>{for(let U=0;U<zT.length;U++)p[zT[U]].cancel(V)},state:c,steps:p}}const{schedule:co,cancel:Ih,state:La,steps:XM}=TZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Dl,!0);let A2;function Mpe(){A2=void 0}const Vs={now:()=>(A2===void 0&&Vs.set(La.isProcessing||Mh.useManualTiming?La.timestamp:performance.now()),A2),set:e=>{A2=e,queueMicrotask(Mpe)}},EZ=e=>t=>typeof t=="string"&&t.startsWith(e),p3=EZ("--"),Ipe=EZ("var(--"),m3=e=>Ipe(e)?Ope.test(e.split("/*")[0].trim()):!1,Ope=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,rv={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},ew={...rv,transform:e=>Ph(0,1,e)},NT={...rv,default:1},yb=e=>Math.round(e*1e5)/1e5,g3=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function jpe(e){return e==null}const Rpe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,y3=(e,t)=>r=>!!(typeof r=="string"&&Rpe.test(r)&&r.startsWith(e)||t&&!jpe(r)&&Object.prototype.hasOwnProperty.call(r,t)),AZ=(e,t,r)=>n=>{if(typeof n!="string")return n;const[c,h,p,o]=n.match(g3);return{[e]:parseFloat(c),[t]:parseFloat(h),[r]:parseFloat(p),alpha:o!==void 0?parseFloat(o):1}},Dpe=e=>Ph(0,255,e),YM={...rv,transform:e=>Math.round(Dpe(e))},Qp={test:y3("rgb","red"),parse:AZ("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+YM.transform(e)+", "+YM.transform(t)+", "+YM.transform(r)+", "+yb(ew.transform(n))+")"};function Lpe(e){let t="",r="",n="",c="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),c=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),c=e.substring(4,5),t+=t,r+=r,n+=n,c+=c),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:c?parseInt(c,16)/255:1}}const mj={test:y3("#"),parse:Lpe,transform:Qp.transform},Qw=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Bd=Qw("deg"),wu=Qw("%"),bn=Qw("px"),zpe=Qw("vh"),Npe=Qw("vw"),lU={...wu,parse:e=>wu.parse(e)/100,transform:e=>wu.transform(e*100)},Ly={test:y3("hsl","hue"),parse:AZ("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+wu.transform(yb(t))+", "+wu.transform(yb(r))+", "+yb(ew.transform(n))+")"},Bo={test:e=>Qp.test(e)||mj.test(e)||Ly.test(e),parse:e=>Qp.test(e)?Qp.parse(e):Ly.test(e)?Ly.parse(e):mj.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Qp.transform(e):Ly.transform(e),getAnimatableNone:e=>{const t=Bo.parse(e);return t.alpha=0,Bo.transform(t)}},Fpe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Bpe(e){return isNaN(e)&&typeof e=="string"&&(e.match(g3)?.length||0)+(e.match(Fpe)?.length||0)>0}const kZ="number",CZ="color",Upe="var",Vpe="var(",cU="${}",$pe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function tw(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},c=[];let h=0;const p=t.replace($pe,o=>(Bo.test(o)?(n.color.push(h),c.push(CZ),r.push(Bo.parse(o))):o.startsWith(Vpe)?(n.var.push(h),c.push(Upe),r.push(o)):(n.number.push(h),c.push(kZ),r.push(parseFloat(o))),++h,cU)).split(cU);return{values:r,split:p,indexes:n,types:c}}function PZ(e){return tw(e).values}function MZ(e){const{split:t,types:r}=tw(e),n=t.length;return c=>{let h="";for(let p=0;p<n;p++)if(h+=t[p],c[p]!==void 0){const o=r[p];o===kZ?h+=yb(c[p]):o===CZ?h+=Bo.transform(c[p]):h+=c[p]}return h}}const Gpe=e=>typeof e=="number"?0:Bo.test(e)?Bo.getAnimatableNone(e):e;function qpe(e){const t=PZ(e);return MZ(e)(t.map(Gpe))}const _f={test:Bpe,parse:PZ,createTransformer:MZ,getAnimatableNone:qpe};function JM(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Hpe({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let c=0,h=0,p=0;if(!t)c=h=p=r;else{const o=r<.5?r*(1+t):r+t-r*t,v=2*r-o;c=JM(v,o,e+1/3),h=JM(v,o,e),p=JM(v,o,e-1/3)}return{red:Math.round(c*255),green:Math.round(h*255),blue:Math.round(p*255),alpha:n}}function dE(e,t){return r=>r>0?t:e}const go=(e,t,r)=>e+(t-e)*r,QM=(e,t,r)=>{const n=e*e,c=r*(t*t-n)+n;return c<0?0:Math.sqrt(c)},Wpe=[mj,Qp,Ly],Zpe=e=>Wpe.find(t=>t.test(e));function uU(e){const t=Zpe(e);if(!t)return!1;let r=t.parse(e);return t===Ly&&(r=Hpe(r)),r}const hU=(e,t)=>{const r=uU(e),n=uU(t);if(!r||!n)return dE(e,t);const c={...r};return h=>(c.red=QM(r.red,n.red,h),c.green=QM(r.green,n.green,h),c.blue=QM(r.blue,n.blue,h),c.alpha=go(r.alpha,n.alpha,h),Qp.transform(c))},gj=new Set(["none","hidden"]);function Kpe(e,t){return gj.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function Xpe(e,t){return r=>go(e,t,r)}function _3(e){return typeof e=="number"?Xpe:typeof e=="string"?m3(e)?dE:Bo.test(e)?hU:Qpe:Array.isArray(e)?IZ:typeof e=="object"?Bo.test(e)?hU:Ype:dE}function IZ(e,t){const r=[...e],n=r.length,c=e.map((h,p)=>_3(h)(h,t[p]));return h=>{for(let p=0;p<n;p++)r[p]=c[p](h);return r}}function Ype(e,t){const r={...e,...t},n={};for(const c in r)e[c]!==void 0&&t[c]!==void 0&&(n[c]=_3(e[c])(e[c],t[c]));return c=>{for(const h in n)r[h]=n[h](c);return r}}function Jpe(e,t){const r=[],n={color:0,var:0,number:0};for(let c=0;c<t.values.length;c++){const h=t.types[c],p=e.indexes[h][n[h]],o=e.values[p]??0;r[c]=o,n[h]++}return r}const Qpe=(e,t)=>{const r=_f.createTransformer(t),n=tw(e),c=tw(t);return n.indexes.var.length===c.indexes.var.length&&n.indexes.color.length===c.indexes.color.length&&n.indexes.number.length>=c.indexes.number.length?gj.has(e)&&!c.values.length||gj.has(t)&&!n.values.length?Kpe(e,t):Yw(IZ(Jpe(n,c),c.values),r):dE(e,t)};function OZ(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?go(e,t,r):_3(e)(e,t)}const eme=e=>{const t=({timestamp:r})=>e(r);return{start:(r=!0)=>co.update(t,r),stop:()=>Ih(t),now:()=>La.isProcessing?La.timestamp:Vs.now()}},jZ=(e,t,r=10)=>{let n="";const c=Math.max(Math.round(t/r),2);for(let h=0;h<c;h++)n+=Math.round(e(h/(c-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},fE=2e4;function v3(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<fE;)t+=r,n=e.next(t);return t>=fE?1/0:t}function tme(e,t=100,r){const n=r({...e,keyframes:[0,t]}),c=Math.min(v3(n),fE);return{type:"keyframes",ease:h=>n.next(c*h).value/t,duration:bu(c)}}const rme=5;function RZ(e,t,r){const n=Math.max(t-rme,0);return fZ(r-e(n),t-n)}const Eo={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},eI=.001;function nme({duration:e=Eo.duration,bounce:t=Eo.bounce,velocity:r=Eo.velocity,mass:n=Eo.mass}){let c,h,p=1-t;p=Ph(Eo.minDamping,Eo.maxDamping,p),e=Ph(Eo.minDuration,Eo.maxDuration,bu(e)),p<1?(c=w=>{const T=w*p,M=T*e,O=T-r,D=yj(w,p),B=Math.exp(-M);return eI-O/D*B},h=w=>{const T=w*p*e,M=T*r+r,O=Math.pow(p,2)*Math.pow(w,2)*e,D=Math.exp(-T),B=yj(Math.pow(w,2),p);return(-c(w)+eI>0?-1:1)*((M-O)*D)/B}):(c=w=>{const T=Math.exp(-w*e),M=(w-r)*e+1;return-eI+T*M},h=w=>{const T=Math.exp(-w*e),M=(r-w)*(e*e);return T*M});const o=5/e,v=ome(c,h,o);if(e=xu(e),isNaN(v))return{stiffness:Eo.stiffness,damping:Eo.damping,duration:e};{const w=Math.pow(v,2)*n;return{stiffness:w,damping:p*2*Math.sqrt(n*w),duration:e}}}const ime=12;function ome(e,t,r){let n=r;for(let c=1;c<ime;c++)n=n-e(n)/t(n);return n}function yj(e,t){return e*Math.sqrt(1-t*t)}const ame=["duration","bounce"],sme=["stiffness","damping","mass"];function dU(e,t){return t.some(r=>e[r]!==void 0)}function lme(e){let t={velocity:Eo.velocity,stiffness:Eo.stiffness,damping:Eo.damping,mass:Eo.mass,isResolvedFromDuration:!1,...e};if(!dU(e,sme)&&dU(e,ame))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(r*1.2),c=n*n,h=2*Ph(.05,1,1-(e.bounce||0))*Math.sqrt(c);t={...t,mass:Eo.mass,stiffness:c,damping:h}}else{const r=nme(e);t={...t,...r,mass:Eo.mass},t.isResolvedFromDuration=!0}return t}function pE(e=Eo.visualDuration,t=Eo.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:c}=r;const h=r.keyframes[0],p=r.keyframes[r.keyframes.length-1],o={done:!1,value:h},{stiffness:v,damping:w,mass:T,duration:M,velocity:O,isResolvedFromDuration:D}=lme({...r,velocity:-bu(r.velocity||0)}),B=O||0,N=w/(2*Math.sqrt(v*T)),G=p-h,V=bu(Math.sqrt(v/T)),U=Math.abs(G)<5;n||(n=U?Eo.restSpeed.granular:Eo.restSpeed.default),c||(c=U?Eo.restDelta.granular:Eo.restDelta.default);let X;if(N<1){const ne=yj(V,N);X=se=>{const le=Math.exp(-N*V*se);return p-le*((B+N*V*G)/ne*Math.sin(ne*se)+G*Math.cos(ne*se))}}else if(N===1)X=ne=>p-Math.exp(-V*ne)*(G+(B+V*G)*ne);else{const ne=V*Math.sqrt(N*N-1);X=se=>{const le=Math.exp(-N*V*se),ge=Math.min(ne*se,300);return p-le*((B+N*V*G)*Math.sinh(ge)+ne*G*Math.cosh(ge))/ne}}const Y={calculatedDuration:D&&M||null,next:ne=>{const se=X(ne);if(D)o.done=ne>=M;else{let le=ne===0?B:0;N<1&&(le=ne===0?xu(B):RZ(X,ne,se));const ge=Math.abs(le)<=n,je=Math.abs(p-se)<=c;o.done=ge&&je}return o.value=o.done?p:se,o},toString:()=>{const ne=Math.min(v3(Y),fE),se=jZ(le=>Y.next(ne*le).value,ne,30);return ne+"ms "+se},toTransition:()=>{}};return Y}pE.applyToOptions=e=>{const t=tme(e,100,pE);return e.ease=t.ease,e.duration=xu(t.duration),e.type="keyframes",e};function _j({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:c=10,bounceStiffness:h=500,modifyTarget:p,min:o,max:v,restDelta:w=.5,restSpeed:T}){const M=e[0],O={done:!1,value:M},D=ge=>o!==void 0&&ge<o||v!==void 0&&ge>v,B=ge=>o===void 0?v:v===void 0||Math.abs(o-ge)<Math.abs(v-ge)?o:v;let N=r*t;const G=M+N,V=p===void 0?G:p(G);V!==G&&(N=V-M);const U=ge=>-N*Math.exp(-ge/n),X=ge=>V+U(ge),Y=ge=>{const je=U(ge),ze=X(ge);O.done=Math.abs(je)<=w,O.value=O.done?V:ze};let ne,se;const le=ge=>{D(O.value)&&(ne=ge,se=pE({keyframes:[O.value,B(O.value)],velocity:RZ(X,ge,O.value),damping:c,stiffness:h,restDelta:w,restSpeed:T}))};return le(0),{calculatedDuration:null,next:ge=>{let je=!1;return!se&&ne===void 0&&(je=!0,Y(ge),le(ge)),ne!==void 0&&ge>=ne?se.next(ge-ne):(!je&&Y(ge),O)}}}function cme(e,t,r){const n=[],c=r||Mh.mix||OZ,h=e.length-1;for(let p=0;p<h;p++){let o=c(e[p],e[p+1]);if(t){const v=Array.isArray(t)?t[p]||Dl:t;o=Yw(v,o)}n.push(o)}return n}function DZ(e,t,{clamp:r=!0,ease:n,mixer:c}={}){const h=e.length;if(c3(h===t.length),h===1)return()=>t[0];if(h===2&&t[0]===t[1])return()=>t[1];const p=e[0]===e[1];e[0]>e[h-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=cme(t,n,c),v=o.length,w=T=>{if(p&&T<e[0])return t[0];let M=0;if(v>1)for(;M<e.length-2&&!(T<e[M+1]);M++);const O=Qb(e[M],e[M+1],T);return o[M](O)};return r?T=>w(Ph(e[0],e[h-1],T)):w}function ume(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const c=Qb(0,t,n);e.push(go(r,1,c))}}function hme(e){const t=[0];return ume(t,e.length-1),t}function dme(e,t){return e.map(r=>r*t)}function fme(e,t){return e.map(()=>t||wZ).splice(0,e.length-1)}function _b({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const c=Epe(n)?n.map(sU):sU(n),h={done:!1,value:t[0]},p=dme(r&&r.length===t.length?r:hme(t),e),o=DZ(p,t,{ease:Array.isArray(c)?c:fme(t,c)});return{calculatedDuration:e,next:v=>(h.value=o(v),h.done=v>=e,h)}}const pme=e=>e!==null;function x3(e,{repeat:t,repeatType:r="loop"},n,c=1){const h=e.filter(pme),p=c<0||t&&r!=="loop"&&t%2===1?0:h.length-1;return!p||n===void 0?h[p]:n}const mme={decay:_j,inertia:_j,tween:_b,keyframes:_b,spring:pE};function LZ(e){typeof e.type=="string"&&(e.type=mme[e.type])}class b3{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,r){return this.finished.then(t,r)}}const gme=e=>e/100;class w3 extends b3{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==Vs.now()&&this.tick(Vs.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;LZ(t);const{type:r=_b,repeat:n=0,repeatDelay:c=0,repeatType:h,velocity:p=0}=t;let{keyframes:o}=t;const v=r||_b;v!==_b&&typeof o[0]!="number"&&(this.mixKeyframes=Yw(gme,OZ(o[0],o[1])),o=[0,100]);const w=v({...t,keyframes:o});h==="mirror"&&(this.mirroredGenerator=v({...t,keyframes:[...o].reverse(),velocity:-p})),w.calculatedDuration===null&&(w.calculatedDuration=v3(w));const{calculatedDuration:T}=w;this.calculatedDuration=T,this.resolvedDuration=T+c,this.totalDuration=this.resolvedDuration*(n+1)-c,this.generator=w}updateTime(t){const r=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(t,r=!1){const{generator:n,totalDuration:c,mixKeyframes:h,mirroredGenerator:p,resolvedDuration:o,calculatedDuration:v}=this;if(this.startTime===null)return n.next(0);const{delay:w=0,keyframes:T,repeat:M,repeatType:O,repeatDelay:D,type:B,onUpdate:N,finalKeyframe:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-c/this.speed,this.startTime)),r?this.currentTime=t:this.updateTime(t);const V=this.currentTime-w*(this.playbackSpeed>=0?1:-1),U=this.playbackSpeed>=0?V<0:V>c;this.currentTime=Math.max(V,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=c);let X=this.currentTime,Y=n;if(M){const ge=Math.min(this.currentTime,c)/o;let je=Math.floor(ge),ze=ge%1;!ze&&ge>=1&&(ze=1),ze===1&&je--,je=Math.min(je,M+1),je%2&&(O==="reverse"?(ze=1-ze,D&&(ze-=D/o)):O==="mirror"&&(Y=p)),X=Ph(0,1,ze)*o}const ne=U?{done:!1,value:T[0]}:Y.next(X);h&&(ne.value=h(ne.value));let{done:se}=ne;!U&&v!==null&&(se=this.playbackSpeed>=0?this.currentTime>=c:this.currentTime<=0);const le=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&se);return le&&B!==_j&&(ne.value=x3(T,this.options,G,this.speed)),N&&N(ne.value),le&&this.finish(),ne}then(t,r){return this.finished.then(t,r)}get duration(){return bu(this.calculatedDuration)}get time(){return bu(this.currentTime)}set time(t){t=xu(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(Vs.now());const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=bu(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=eme,startTime:r}=this.options;this.driver||(this.driver=t(c=>this.tick(c))),this.options.onPlay?.();const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=r??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Vs.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function yme(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const em=e=>e*180/Math.PI,vj=e=>{const t=em(Math.atan2(e[1],e[0]));return xj(t)},_me={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:vj,rotateZ:vj,skewX:e=>em(Math.atan(e[1])),skewY:e=>em(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},xj=e=>(e=e%360,e<0&&(e+=360),e),fU=vj,pU=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),mU=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),vme={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:pU,scaleY:mU,scale:e=>(pU(e)+mU(e))/2,rotateX:e=>xj(em(Math.atan2(e[6],e[5]))),rotateY:e=>xj(em(Math.atan2(-e[2],e[0]))),rotateZ:fU,rotate:fU,skewX:e=>em(Math.atan(e[4])),skewY:e=>em(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function bj(e){return e.includes("scale")?1:0}function wj(e,t){if(!e||e==="none")return bj(t);const r=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,c;if(r)n=vme,c=r;else{const o=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=_me,c=o}if(!c)return bj(t);const h=n[t],p=c[1].split(",").map(bme);return typeof h=="function"?h(p):p[h]}const xme=(e,t)=>{const{transform:r="none"}=getComputedStyle(e);return wj(r,t)};function bme(e){return parseFloat(e.trim())}const nv=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],iv=new Set(nv),gU=e=>e===rv||e===bn,wme=new Set(["x","y","z"]),Sme=nv.filter(e=>!wme.has(e));function Tme(e){const t=[];return Sme.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}const lm={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>wj(t,"x"),y:(e,{transform:t})=>wj(t,"y")};lm.translateX=lm.x;lm.translateY=lm.y;const cm=new Set;let Sj=!1,Tj=!1,Ej=!1;function zZ(){if(Tj){const e=Array.from(cm).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),r=new Map;t.forEach(n=>{const c=Tme(n);c.length&&(r.set(n,c),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const c=r.get(n);c&&c.forEach(([h,p])=>{n.getValue(h)?.set(p)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}Tj=!1,Sj=!1,cm.forEach(e=>e.complete(Ej)),cm.clear()}function NZ(){cm.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Tj=!0)})}function Eme(){Ej=!0,NZ(),zZ(),Ej=!1}class S3{constructor(t,r,n,c,h,p=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=n,this.motionValue=c,this.element=h,this.isAsync=p}scheduleResolve(){this.state="scheduled",this.isAsync?(cm.add(this),Sj||(Sj=!0,co.read(NZ),co.resolveKeyframes(zZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:n,motionValue:c}=this;if(t[0]===null){const h=c?.get(),p=t[t.length-1];if(h!==void 0)t[0]=h;else if(n&&r){const o=n.readValue(r,p);o!=null&&(t[0]=o)}t[0]===void 0&&(t[0]=p),c&&h===void 0&&c.set(t[0])}yme(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),cm.delete(this)}cancel(){this.state==="scheduled"&&(cm.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Ame=e=>e.startsWith("--");function kme(e,t,r){Ame(t)?e.style.setProperty(t,r):e.style[t]=r}const Cme=u3(()=>window.ScrollTimeline!==void 0),Pme={};function Mme(e,t){const r=u3(e);return()=>Pme[t]??r()}const FZ=Mme(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),rb=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,yU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:rb([0,.65,.55,1]),circOut:rb([.55,0,1,.45]),backIn:rb([.31,.01,.66,-.59]),backOut:rb([.33,1.53,.69,.99])};function BZ(e,t){if(e)return typeof e=="function"?FZ()?jZ(e,t):"ease-out":SZ(e)?rb(e):Array.isArray(e)?e.map(r=>BZ(r,t)||yU.easeOut):yU[e]}function Ime(e,t,r,{delay:n=0,duration:c=300,repeat:h=0,repeatType:p="loop",ease:o="easeOut",times:v}={},w=void 0){const T={[t]:r};v&&(T.offset=v);const M=BZ(o,c);Array.isArray(M)&&(T.easing=M);const O={delay:n,duration:c,easing:Array.isArray(M)?"linear":M,fill:"both",iterations:h+1,direction:p==="reverse"?"alternate":"normal"};return w&&(O.pseudoElement=w),e.animate(T,O)}function UZ(e){return typeof e=="function"&&"applyToOptions"in e}function Ome({type:e,...t}){return UZ(e)&&FZ()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class jme extends b3{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:r,name:n,keyframes:c,pseudoElement:h,allowFlatten:p=!1,finalKeyframe:o,onComplete:v}=t;this.isPseudoElement=!!h,this.allowFlatten=p,this.options=t,c3(typeof t.type!="string");const w=Ome(t);this.animation=Ime(r,n,c,w,h),w.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!h){const T=x3(c,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(T):kme(r,n,T),this.animation.cancel()}v?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return bu(Number(t))}get time(){return bu(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=xu(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&Cme()?(this.animation.timeline=t,Dl):r(this)}}const VZ={anticipate:vZ,backInOut:_Z,circInOut:bZ};function Rme(e){return e in VZ}function Dme(e){typeof e.ease=="string"&&Rme(e.ease)&&(e.ease=VZ[e.ease])}const _U=10;class Lme extends jme{constructor(t){Dme(t),LZ(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:r,onUpdate:n,onComplete:c,element:h,...p}=this.options;if(!r)return;if(t!==void 0){r.set(t);return}const o=new w3({...p,autoplay:!1}),v=xu(this.finishedTime??this.time);r.setWithVelocity(o.sample(v-_U).value,o.sample(v).value,_U),o.stop()}}const vU=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(_f.test(e)||e==="0")&&!e.startsWith("url("));function zme(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function Nme(e,t,r,n){const c=e[0];if(c===null)return!1;if(t==="display"||t==="visibility")return!0;const h=e[e.length-1],p=vU(c,t),o=vU(h,t);return!p||!o?!1:zme(e)||(r==="spring"||UZ(r))&&n}function Aj(e){e.duration=0,e.type}const Fme=new Set(["opacity","clipPath","filter","transform"]),Bme=u3(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Ume(e){const{motionValue:t,name:r,repeatDelay:n,repeatType:c,damping:h,type:p}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:o,transformTemplate:v}=t.owner.getProps();return Bme()&&r&&Fme.has(r)&&(r!=="transform"||!v)&&!o&&!n&&c!=="mirror"&&h!==0&&p!=="inertia"}const Vme=40;class $me extends b3{constructor({autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:c=0,repeatDelay:h=0,repeatType:p="loop",keyframes:o,name:v,motionValue:w,element:T,...M}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Vs.now();const O={autoplay:t,delay:r,type:n,repeat:c,repeatDelay:h,repeatType:p,name:v,motionValue:w,element:T,...M},D=T?.KeyframeResolver||S3;this.keyframeResolver=new D(o,(B,N,G)=>this.onKeyframesResolved(B,N,O,!G),v,w,T),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,r,n,c){this.keyframeResolver=void 0;const{name:h,type:p,velocity:o,delay:v,isHandoff:w,onUpdate:T}=n;this.resolvedAt=Vs.now(),Nme(t,h,p,o)||((Mh.instantAnimations||!v)&&T?.(x3(t,n,r)),t[0]=t[t.length-1],Aj(n),n.repeat=0);const M={startTime:c?this.resolvedAt?this.resolvedAt-this.createdAt>Vme?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...n,keyframes:t},O=!w&&Ume(M)?new Lme({...M,element:M.motionValue.owner.current}):new w3(M);O.finished.then(()=>this.notifyFinished()).catch(Dl),this.pendingTimeline&&(this.stopTimeline=O.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=O}get finished(){return this._animation?this.animation.finished:this._finished}then(t,r){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Eme()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const Gme=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function qme(e){const t=Gme.exec(e);if(!t)return[,];const[,r,n,c]=t;return[`--${r??n}`,c]}function $Z(e,t,r=1){const[n,c]=qme(e);if(!n)return;const h=window.getComputedStyle(t).getPropertyValue(n);if(h){const p=h.trim();return uZ(p)?parseFloat(p):p}return m3(c)?$Z(c,t,r+1):c}function T3(e,t){return e?.[t]??e?.default??e}const GZ=new Set(["width","height","top","left","right","bottom",...nv]),Hme={test:e=>e==="auto",parse:e=>e},qZ=e=>t=>t.test(e),HZ=[rv,bn,wu,Bd,Npe,zpe,Hme],xU=e=>HZ.find(qZ(e));function Wme(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||dZ(e):!0}const Zme=new Set(["brightness","contrast","saturate","opacity"]);function Kme(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(g3)||[];if(!n)return e;const c=r.replace(n,"");let h=Zme.has(t)?1:0;return n!==r&&(h*=100),t+"("+h+c+")"}const Xme=/\b([a-z-]*)\(.*?\)/gu,kj={..._f,getAnimatableNone:e=>{const t=e.match(Xme);return t?t.map(Kme).join(" "):e}},bU={...rv,transform:Math.round},Yme={rotate:Bd,rotateX:Bd,rotateY:Bd,rotateZ:Bd,scale:NT,scaleX:NT,scaleY:NT,scaleZ:NT,skew:Bd,skewX:Bd,skewY:Bd,distance:bn,translateX:bn,translateY:bn,translateZ:bn,x:bn,y:bn,z:bn,perspective:bn,transformPerspective:bn,opacity:ew,originX:lU,originY:lU,originZ:bn},E3={borderWidth:bn,borderTopWidth:bn,borderRightWidth:bn,borderBottomWidth:bn,borderLeftWidth:bn,borderRadius:bn,radius:bn,borderTopLeftRadius:bn,borderTopRightRadius:bn,borderBottomRightRadius:bn,borderBottomLeftRadius:bn,width:bn,maxWidth:bn,height:bn,maxHeight:bn,top:bn,right:bn,bottom:bn,left:bn,padding:bn,paddingTop:bn,paddingRight:bn,paddingBottom:bn,paddingLeft:bn,margin:bn,marginTop:bn,marginRight:bn,marginBottom:bn,marginLeft:bn,backgroundPositionX:bn,backgroundPositionY:bn,...Yme,zIndex:bU,fillOpacity:ew,strokeOpacity:ew,numOctaves:bU},Jme={...E3,color:Bo,backgroundColor:Bo,outlineColor:Bo,fill:Bo,stroke:Bo,borderColor:Bo,borderTopColor:Bo,borderRightColor:Bo,borderBottomColor:Bo,borderLeftColor:Bo,filter:kj,WebkitFilter:kj},WZ=e=>Jme[e];function ZZ(e,t){let r=WZ(e);return r!==kj&&(r=_f),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const Qme=new Set(["auto","none","0"]);function ege(e,t,r){let n=0,c;for(;n<e.length&&!c;){const h=e[n];typeof h=="string"&&!Qme.has(h)&&tw(h).values.length&&(c=e[n]),n++}if(c&&r)for(const h of t)e[h]=ZZ(r,c)}class tge extends S3{constructor(t,r,n,c,h){super(t,r,n,c,h,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let w=t[v];if(typeof w=="string"&&(w=w.trim(),m3(w))){const T=$Z(w,r.current);T!==void 0&&(t[v]=T),v===t.length-1&&(this.finalKeyframe=w)}}if(this.resolveNoneKeyframes(),!GZ.has(n)||t.length!==2)return;const[c,h]=t,p=xU(c),o=xU(h);if(p!==o)if(gU(p)&&gU(o))for(let v=0;v<t.length;v++){const w=t[v];typeof w=="string"&&(t[v]=parseFloat(w))}else lm[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,n=[];for(let c=0;c<t.length;c++)(t[c]===null||Wme(t[c]))&&n.push(c);n.length&&ege(t,n,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=lm[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const c=r[r.length-1];c!==void 0&&t.getValue(n,c).jump(c,!1)}measureEndState(){const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const c=t.getValue(r);c&&c.jump(this.measuredOrigin,!1);const h=n.length-1,p=n[h];n[h]=lm[r](t.measureViewportBox(),window.getComputedStyle(t.current)),p!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=p),this.removedTransforms?.length&&this.removedTransforms.forEach(([o,v])=>{t.getValue(o).set(v)}),this.resolveNoneKeyframes()}}function rge(e,t,r){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const c=document.querySelectorAll(e);return c?Array.from(c):[]}return Array.from(e)}const KZ=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function XZ(e){return hZ(e)&&"offsetHeight"in e}const wU=30,nge=e=>!isNaN(parseFloat(e)),vb={current:void 0};class ige{constructor(t,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{const c=Vs.now();if(this.updatedAt!==c&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const h of this.dependents)h.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=Vs.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=nge(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new h3);const n=this.events[t].add(r);return t==="change"?()=>{n(),co.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return vb.current&&vb.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const t=Vs.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>wU)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,wU);return fZ(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function vm(e,t){return new ige(e,t)}const{schedule:A3}=TZ(queueMicrotask,!1),sc={x:!1,y:!1};function YZ(){return sc.x||sc.y}function oge(e){return e==="x"||e==="y"?sc[e]?null:(sc[e]=!0,()=>{sc[e]=!1}):sc.x||sc.y?null:(sc.x=sc.y=!0,()=>{sc.x=sc.y=!1})}function JZ(e,t){const r=rge(e),n=new AbortController,c={passive:!0,...t,signal:n.signal};return[r,c,()=>n.abort()]}function SU(e){return!(e.pointerType==="touch"||YZ())}function age(e,t,r={}){const[n,c,h]=JZ(e,r),p=o=>{if(!SU(o))return;const{target:v}=o,w=t(v,o);if(typeof w!="function"||!v)return;const T=M=>{SU(M)&&(w(M),v.removeEventListener("pointerleave",T))};v.addEventListener("pointerleave",T,c)};return n.forEach(o=>{o.addEventListener("pointerenter",p,c)}),h}const QZ=(e,t)=>t?e===t?!0:QZ(e,t.parentElement):!1,k3=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,sge=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function lge(e){return sge.has(e.tagName)||e.tabIndex!==-1}const k2=new WeakSet;function TU(e){return t=>{t.key==="Enter"&&e(t)}}function tI(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const cge=(e,t)=>{const r=e.currentTarget;if(!r)return;const n=TU(()=>{if(k2.has(r))return;tI(r,"down");const c=TU(()=>{tI(r,"up")}),h=()=>tI(r,"cancel");r.addEventListener("keyup",c,t),r.addEventListener("blur",h,t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function EU(e){return k3(e)&&!YZ()}function uge(e,t,r={}){const[n,c,h]=JZ(e,r),p=o=>{const v=o.currentTarget;if(!EU(o))return;k2.add(v);const w=t(v,o),T=(D,B)=>{window.removeEventListener("pointerup",M),window.removeEventListener("pointercancel",O),k2.has(v)&&k2.delete(v),EU(D)&&typeof w=="function"&&w(D,{success:B})},M=D=>{T(D,v===window||v===document||r.useGlobalTarget||QZ(v,D.target))},O=D=>{T(D,!1)};window.addEventListener("pointerup",M,c),window.addEventListener("pointercancel",O,c)};return n.forEach(o=>{(r.useGlobalTarget?window:o).addEventListener("pointerdown",p,c),XZ(o)&&(o.addEventListener("focus",v=>cge(v,c)),!lge(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),h}function eK(e){return hZ(e)&&"ownerSVGElement"in e}function hge(e){return eK(e)&&e.tagName==="svg"}function dge(...e){const t=!Array.isArray(e[0]),r=t?0:-1,n=e[0+r],c=e[1+r],h=e[2+r],p=e[3+r],o=DZ(c,h,p);return t?o(n):o}const es=e=>!!(e&&e.getVelocity),fge=[...HZ,Bo,_f],pge=e=>fge.find(qZ(e)),ok=Z.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class mge extends Z.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=r.offsetParent,c=XZ(n)&&n.offsetWidth||0,h=this.props.sizeRef.current;h.height=r.offsetHeight||0,h.width=r.offsetWidth||0,h.top=r.offsetTop,h.left=r.offsetLeft,h.right=c-h.width-h.left}return null}componentDidUpdate(){}render(){return this.props.children}}function gge({children:e,isPresent:t,anchorX:r,root:n}){const c=Z.useId(),h=Z.useRef(null),p=Z.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=Z.useContext(ok);return Z.useInsertionEffect(()=>{const{width:v,height:w,top:T,left:M,right:O}=p.current;if(t||!h.current||!v||!w)return;const D=r==="left"?`left: ${M}`:`right: ${O}`;h.current.dataset.motionPopId=c;const B=document.createElement("style");o&&(B.nonce=o);const N=n??document.head;return N.appendChild(B),B.sheet&&B.sheet.insertRule(`
          [data-motion-pop-id="${c}"] {
            position: absolute !important;
            width: ${v}px !important;
            height: ${w}px !important;
            ${D}px !important;
            top: ${T}px !important;
          }
        `),()=>{N.contains(B)&&N.removeChild(B)}},[t]),C.jsx(mge,{isPresent:t,childRef:h,sizeRef:p,children:Z.cloneElement(e,{ref:h})})}const yge=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:c,presenceAffectsLayout:h,mode:p,anchorX:o,root:v})=>{const w=Xw(_ge),T=Z.useId();let M=!0,O=Z.useMemo(()=>(M=!1,{id:T,initial:t,isPresent:r,custom:c,onExitComplete:D=>{w.set(D,!0);for(const B of w.values())if(!B)return;n&&n()},register:D=>(w.set(D,!1),()=>w.delete(D))}),[r,w,n]);return h&&M&&(O={...O}),Z.useMemo(()=>{w.forEach((D,B)=>w.set(B,!1))},[r]),Z.useEffect(()=>{!r&&!w.size&&n&&n()},[r]),p==="popLayout"&&(e=C.jsx(gge,{isPresent:r,anchorX:o,root:v,children:e})),C.jsx(ik.Provider,{value:O,children:e})};function _ge(){return new Map}function tK(e=!0){const t=Z.useContext(ik);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:c}=t,h=Z.useId();Z.useEffect(()=>{if(e)return c(h)},[e]);const p=Z.useCallback(()=>e&&n&&n(h),[h,n,e]);return!r&&n?[!1,p]:[!0]}const FT=e=>e.key||"";function AU(e){const t=[];return Z.Children.forEach(e,r=>{Z.isValidElement(r)&&t.push(r)}),t}const Tc=({children:e,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:c=!0,mode:h="sync",propagate:p=!1,anchorX:o="left",root:v})=>{const[w,T]=tK(p),M=Z.useMemo(()=>AU(e),[e]),O=p&&!w?[]:M.map(FT),D=Z.useRef(!0),B=Z.useRef(M),N=Xw(()=>new Map),[G,V]=Z.useState(M),[U,X]=Z.useState(M);a3(()=>{D.current=!1,B.current=M;for(let se=0;se<U.length;se++){const le=FT(U[se]);O.includes(le)?N.delete(le):N.get(le)!==!0&&N.set(le,!1)}},[U,O.length,O.join("-")]);const Y=[];if(M!==G){let se=[...M];for(let le=0;le<U.length;le++){const ge=U[le],je=FT(ge);O.includes(je)||(se.splice(le,0,ge),Y.push(ge))}return h==="wait"&&Y.length&&(se=Y),X(AU(se)),V(M),null}const{forceRender:ne}=Z.useContext(i3);return C.jsx(C.Fragment,{children:U.map(se=>{const le=FT(se),ge=p&&!w?!1:M===U||O.includes(le),je=()=>{if(N.has(le))N.set(le,!0);else return;let ze=!0;N.forEach(Ce=>{Ce||(ze=!1)}),ze&&(ne?.(),X(B.current),p&&T?.(),n&&n())};return C.jsx(yge,{isPresent:ge,initial:!D.current||r?void 0:!1,custom:t,presenceAffectsLayout:c,mode:h,root:v,onExitComplete:ge?void 0:je,anchorX:o,children:se},le)})})},rK=Z.createContext({strict:!1}),kU={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},v_={};for(const e in kU)v_[e]={isEnabled:t=>kU[e].some(r=>!!t[r])};function vge(e){for(const t in e)v_[t]={...v_[t],...e[t]}}const xge=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function mE(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||xge.has(e)}let nK=e=>!mE(e);function bge(e){typeof e=="function"&&(nK=t=>t.startsWith("on")?!mE(t):e(t))}try{bge(require("@emotion/is-prop-valid").default)}catch{}function wge(e,t,r){const n={};for(const c in e)c==="values"&&typeof e.values=="object"||(nK(c)||r===!0&&mE(c)||!t&&!mE(c)||e.draggable&&c.startsWith("onDrag"))&&(n[c]=e[c]);return n}const ak=Z.createContext({});function sk(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function rw(e){return typeof e=="string"||Array.isArray(e)}const C3=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],P3=["initial",...C3];function lk(e){return sk(e.animate)||P3.some(t=>rw(e[t]))}function iK(e){return!!(lk(e)||e.variants)}function Sge(e,t){if(lk(e)){const{initial:r,animate:n}=e;return{initial:r===!1||rw(r)?r:void 0,animate:rw(n)?n:void 0}}return e.inherit!==!1?t:{}}function Tge(e){const{initial:t,animate:r}=Sge(e,Z.useContext(ak));return Z.useMemo(()=>({initial:t,animate:r}),[CU(t),CU(r)])}function CU(e){return Array.isArray(e)?e.join(" "):e}const nw={};function Ege(e){for(const t in e)nw[t]=e[t],p3(t)&&(nw[t].isCSSVariable=!0)}function oK(e,{layout:t,layoutId:r}){return iv.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!nw[e]||e==="opacity")}const Age={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},kge=nv.length;function Cge(e,t,r){let n="",c=!0;for(let h=0;h<kge;h++){const p=nv[h],o=e[p];if(o===void 0)continue;let v=!0;if(typeof o=="number"?v=o===(p.startsWith("scale")?1:0):v=parseFloat(o)===0,!v||r){const w=KZ(o,E3[p]);if(!v){c=!1;const T=Age[p]||p;n+=`${T}(${w}) `}r&&(t[p]=w)}}return n=n.trim(),r?n=r(t,c?"":n):c&&(n="none"),n}function M3(e,t,r){const{style:n,vars:c,transformOrigin:h}=e;let p=!1,o=!1;for(const v in t){const w=t[v];if(iv.has(v)){p=!0;continue}else if(p3(v)){c[v]=w;continue}else{const T=KZ(w,E3[v]);v.startsWith("origin")?(o=!0,h[v]=T):n[v]=T}}if(t.transform||(p||r?n.transform=Cge(t,e.transform,r):n.transform&&(n.transform="none")),o){const{originX:v="50%",originY:w="50%",originZ:T=0}=h;n.transformOrigin=`${v} ${w} ${T}`}}const I3=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function aK(e,t,r){for(const n in t)!es(t[n])&&!oK(n,r)&&(e[n]=t[n])}function Pge({transformTemplate:e},t){return Z.useMemo(()=>{const r=I3();return M3(r,t,e),Object.assign({},r.vars,r.style)},[t])}function Mge(e,t){const r=e.style||{},n={};return aK(n,r,e),Object.assign(n,Pge(e,t)),n}function Ige(e,t){const r={},n=Mge(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const Oge={offset:"stroke-dashoffset",array:"stroke-dasharray"},jge={offset:"strokeDashoffset",array:"strokeDasharray"};function Rge(e,t,r=1,n=0,c=!0){e.pathLength=1;const h=c?Oge:jge;e[h.offset]=bn.transform(-n);const p=bn.transform(t),o=bn.transform(r);e[h.array]=`${p} ${o}`}function sK(e,{attrX:t,attrY:r,attrScale:n,pathLength:c,pathSpacing:h=1,pathOffset:p=0,...o},v,w,T){if(M3(e,o,w),v){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:M,style:O}=e;M.transform&&(O.transform=M.transform,delete M.transform),(O.transform||M.transformOrigin)&&(O.transformOrigin=M.transformOrigin??"50% 50%",delete M.transformOrigin),O.transform&&(O.transformBox=T?.transformBox??"fill-box",delete M.transformBox),t!==void 0&&(M.x=t),r!==void 0&&(M.y=r),n!==void 0&&(M.scale=n),c!==void 0&&Rge(M,c,h,p,!1)}const lK=()=>({...I3(),attrs:{}}),cK=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Dge(e,t,r,n){const c=Z.useMemo(()=>{const h=lK();return sK(h,t,cK(n),e.transformTemplate,e.style),{...h.attrs,style:{...h.style}}},[t]);if(e.style){const h={};aK(h,e.style,e),c.style={...h,...c.style}}return c}const Lge=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function O3(e){return typeof e!="string"||e.includes("-")?!1:!!(Lge.indexOf(e)>-1||/[A-Z]/u.test(e))}function zge(e,t,r,{latestValues:n},c,h=!1){const p=(O3(e)?Dge:Ige)(t,n,c,e),o=wge(t,typeof e=="string",h),v=e!==Z.Fragment?{...o,...p,ref:r}:{},{children:w}=t,T=Z.useMemo(()=>es(w)?w.get():w,[w]);return Z.createElement(e,{...v,children:T})}function PU(e){const t=[{},{}];return e?.values.forEach((r,n)=>{t[0][n]=r.get(),t[1][n]=r.getVelocity()}),t}function j3(e,t,r,n){if(typeof t=="function"){const[c,h]=PU(n);t=t(r!==void 0?r:e.custom,c,h)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[c,h]=PU(n);t=t(r!==void 0?r:e.custom,c,h)}return t}function C2(e){return es(e)?e.get():e}function Nge({scrapeMotionValuesFromProps:e,createRenderState:t},r,n,c){return{latestValues:Fge(r,n,c,e),renderState:t()}}function Fge(e,t,r,n){const c={},h=n(e,{});for(const O in h)c[O]=C2(h[O]);let{initial:p,animate:o}=e;const v=lk(e),w=iK(e);t&&w&&!v&&e.inherit!==!1&&(p===void 0&&(p=t.initial),o===void 0&&(o=t.animate));let T=r?r.initial===!1:!1;T=T||p===!1;const M=T?o:p;if(M&&typeof M!="boolean"&&!sk(M)){const O=Array.isArray(M)?M:[M];for(let D=0;D<O.length;D++){const B=j3(e,O[D]);if(B){const{transitionEnd:N,transition:G,...V}=B;for(const U in V){let X=V[U];if(Array.isArray(X)){const Y=T?X.length-1:0;X=X[Y]}X!==null&&(c[U]=X)}for(const U in N)c[U]=N[U]}}}return c}const uK=e=>(t,r)=>{const n=Z.useContext(ak),c=Z.useContext(ik),h=()=>Nge(e,t,n,c);return r?h():Xw(h)};function R3(e,t,r){const{style:n}=e,c={};for(const h in n)(es(n[h])||t.style&&es(t.style[h])||oK(h,e)||r?.getValue(h)?.liveStyle!==void 0)&&(c[h]=n[h]);return c}const Bge=uK({scrapeMotionValuesFromProps:R3,createRenderState:I3});function hK(e,t,r){const n=R3(e,t,r);for(const c in e)if(es(e[c])||es(t[c])){const h=nv.indexOf(c)!==-1?"attr"+c.charAt(0).toUpperCase()+c.substring(1):c;n[h]=e[c]}return n}const Uge=uK({scrapeMotionValuesFromProps:hK,createRenderState:lK}),Vge=Symbol.for("motionComponentSymbol");function zy(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function $ge(e,t,r){return Z.useCallback(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):zy(r)&&(r.current=n))},[t])}const D3=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Gge="framerAppearId",dK="data-"+D3(Gge),fK=Z.createContext({});function qge(e,t,r,n,c){const{visualElement:h}=Z.useContext(ak),p=Z.useContext(rK),o=Z.useContext(ik),v=Z.useContext(ok).reducedMotion,w=Z.useRef(null);n=n||p.renderer,!w.current&&n&&(w.current=n(e,{visualState:t,parent:h,props:r,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:v}));const T=w.current,M=Z.useContext(fK);T&&!T.projection&&c&&(T.type==="html"||T.type==="svg")&&Hge(w.current,r,c,M);const O=Z.useRef(!1);Z.useInsertionEffect(()=>{T&&O.current&&T.update(r,o)});const D=r[dK],B=Z.useRef(!!D&&!window.MotionHandoffIsComplete?.(D)&&window.MotionHasOptimisedAnimation?.(D));return a3(()=>{T&&(O.current=!0,window.MotionIsMounted=!0,T.updateFeatures(),T.scheduleRenderMicrotask(),B.current&&T.animationState&&T.animationState.animateChanges())}),Z.useEffect(()=>{T&&(!B.current&&T.animationState&&T.animationState.animateChanges(),B.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(D)}),B.current=!1),T.enteringChildren=void 0)}),T}function Hge(e,t,r,n){const{layoutId:c,layout:h,drag:p,dragConstraints:o,layoutScroll:v,layoutRoot:w,layoutCrossfade:T}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:pK(e.parent)),e.projection.setOptions({layoutId:c,layout:h,alwaysMeasureLayout:!!p||o&&zy(o),visualElement:e,animationType:typeof h=="string"?h:"both",initialPromotionConfig:n,crossfade:T,layoutScroll:v,layoutRoot:w})}function pK(e){if(e)return e.options.allowProjection!==!1?e.projection:pK(e.parent)}function rI(e,{forwardMotionProps:t=!1}={},r,n){r&&vge(r);const c=O3(e)?Uge:Bge;function h(o,v){let w;const T={...Z.useContext(ok),...o,layoutId:Wge(o)},{isStatic:M}=T,O=Tge(o),D=c(o,M);if(!M&&o3){Zge();const B=Kge(T);w=B.MeasureLayout,O.visualElement=qge(e,D,T,n,B.ProjectionNode)}return C.jsxs(ak.Provider,{value:O,children:[w&&O.visualElement?C.jsx(w,{visualElement:O.visualElement,...T}):null,zge(e,o,$ge(D,O.visualElement,v),D,M,t)]})}h.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const p=Z.forwardRef(h);return p[Vge]=e,p}function Wge({layoutId:e}){const t=Z.useContext(i3).id;return t&&e!==void 0?t+"-"+e:e}function Zge(e,t){Z.useContext(rK).strict}function Kge(e){const{drag:t,layout:r}=v_;if(!t&&!r)return{};const n={...t,...r};return{MeasureLayout:t?.isEnabled(e)||r?.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function Xge(e,t){if(typeof Proxy>"u")return rI;const r=new Map,n=(h,p)=>rI(h,p,e,t),c=(h,p)=>n(h,p);return new Proxy(c,{get:(h,p)=>p==="create"?n:(r.has(p)||r.set(p,rI(p,void 0,e,t)),r.get(p))})}function mK({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function Yge({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Jge(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function nI(e){return e===void 0||e===1}function Cj({scale:e,scaleX:t,scaleY:r}){return!nI(e)||!nI(t)||!nI(r)}function Up(e){return Cj(e)||gK(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function gK(e){return MU(e.x)||MU(e.y)}function MU(e){return e&&e!=="0%"}function gE(e,t,r){const n=e-r,c=t*n;return r+c}function IU(e,t,r,n,c){return c!==void 0&&(e=gE(e,c,n)),gE(e,r,n)+t}function Pj(e,t=0,r=1,n,c){e.min=IU(e.min,t,r,n,c),e.max=IU(e.max,t,r,n,c)}function yK(e,{x:t,y:r}){Pj(e.x,t.translate,t.scale,t.originPoint),Pj(e.y,r.translate,r.scale,r.originPoint)}const OU=.999999999999,jU=1.0000000000001;function Qge(e,t,r,n=!1){const c=r.length;if(!c)return;t.x=t.y=1;let h,p;for(let o=0;o<c;o++){h=r[o],p=h.projectionDelta;const{visualElement:v}=h.options;v&&v.props.style&&v.props.style.display==="contents"||(n&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Fy(e,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),p&&(t.x*=p.x.scale,t.y*=p.y.scale,yK(e,p)),n&&Up(h.latestValues)&&Fy(e,h.latestValues))}t.x<jU&&t.x>OU&&(t.x=1),t.y<jU&&t.y>OU&&(t.y=1)}function Ny(e,t){e.min=e.min+t,e.max=e.max+t}function RU(e,t,r,n,c=.5){const h=go(e.min,e.max,c);Pj(e,t,r,h,n)}function Fy(e,t){RU(e.x,t.x,t.scaleX,t.scale,t.originX),RU(e.y,t.y,t.scaleY,t.scale,t.originY)}function _K(e,t){return mK(Jge(e.getBoundingClientRect(),t))}function eye(e,t,r){const n=_K(e,r),{scroll:c}=t;return c&&(Ny(n.x,c.offset.x),Ny(n.y,c.offset.y)),n}const DU=()=>({translate:0,scale:1,origin:0,originPoint:0}),By=()=>({x:DU(),y:DU()}),LU=()=>({min:0,max:0}),jo=()=>({x:LU(),y:LU()}),Mj={current:null},vK={current:!1};function tye(){if(vK.current=!0,!!o3)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Mj.current=e.matches;e.addEventListener("change",t),t()}else Mj.current=!1}const rye=new WeakMap;function nye(e,t,r){for(const n in t){const c=t[n],h=r[n];if(es(c))e.addValue(n,c);else if(es(h))e.addValue(n,vm(c,{owner:e}));else if(h!==c)if(e.hasValue(n)){const p=e.getValue(n);p.liveStyle===!0?p.jump(c):p.hasAnimated||p.set(c)}else{const p=e.getStaticValue(n);e.addValue(n,vm(p!==void 0?p:c,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const zU=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class iye{scrapeMotionValuesFromProps(t,r,n){return{}}constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:c,blockInitialAnimation:h,visualState:p},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=S3,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const O=Vs.now();this.renderScheduledAt<O&&(this.renderScheduledAt=O,co.render(this.render,!1,!0))};const{latestValues:v,renderState:w}=p;this.latestValues=v,this.baseTarget={...v},this.initialValues=r.initial?{...v}:{},this.renderState=w,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=c,this.options=o,this.blockInitialAnimation=!!h,this.isControllingVariants=lk(r),this.isVariantNode=iK(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:T,...M}=this.scrapeMotionValuesFromProps(r,{},this);for(const O in M){const D=M[O];v[O]!==void 0&&es(D)&&D.set(v[O])}}mount(t){this.current=t,rye.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),vK.current||tye(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Mj.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Ih(this.notifyUpdate),Ih(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const r=this.features[t];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=iv.has(t);n&&this.onBindTransform&&this.onBindTransform();const c=r.on("change",p=>{this.latestValues[t]=p,this.props.onUpdate&&co.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let h;window.MotionCheckAppearSync&&(h=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{c(),h&&h(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in v_){const r=v_[t];if(!r)continue;const{isEnabled:n,Feature:c}=r;if(!this.features[t]&&c&&n(this.props)&&(this.features[t]=new c(this)),this.features[t]){const h=this.features[t];h.isMounted?h.update():(h.mount(),h.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):jo()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<zU.length;n++){const c=zU[n];this.propEventSubscriptions[c]&&(this.propEventSubscriptions[c](),delete this.propEventSubscriptions[c]);const h="on"+c,p=t[h];p&&(this.propEventSubscriptions[c]=this.on(c,p))}this.prevMotionValues=nye(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const n=this.values.get(t);r!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=vm(r===null?void 0:r,{owner:this}),this.addValue(t,n)),n}readValue(t,r){let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(uZ(n)||dZ(n))?n=parseFloat(n):!pge(n)&&_f.test(r)&&(n=ZZ(t,r)),this.setBaseTarget(t,es(n)?n.get():n)),es(n)?n.get():n}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const h=j3(this.props,r,this.presenceContext?.custom);h&&(n=h[t])}if(r&&n!==void 0)return n;const c=this.getBaseTargetFromProps(this.props,t);return c!==void 0&&!es(c)?c:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new h3),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}scheduleRenderMicrotask(){A3.render(this.render)}}class xK extends iye{constructor(){super(...arguments),this.KeyframeResolver=tge}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;es(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function bK(e,{style:t,vars:r},n,c){const h=e.style;let p;for(p in t)h[p]=t[p];c?.applyProjectionStyles(h,n);for(p in r)h.setProperty(p,r[p])}function oye(e){return window.getComputedStyle(e)}class aye extends xK{constructor(){super(...arguments),this.type="html",this.renderInstance=bK}readValueFromInstance(t,r){if(iv.has(r))return this.projection?.isProjecting?bj(r):xme(t,r);{const n=oye(t),c=(p3(r)?n.getPropertyValue(r):n[r])||0;return typeof c=="string"?c.trim():c}}measureInstanceViewportBox(t,{transformPagePoint:r}){return _K(t,r)}build(t,r,n){M3(t,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,r,n){return R3(t,r,n)}}const wK=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function sye(e,t,r,n){bK(e,t,void 0,n);for(const c in t.attrs)e.setAttribute(wK.has(c)?c:D3(c),t.attrs[c])}class lye extends xK{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=jo}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(iv.has(r)){const n=WZ(r);return n&&n.default||0}return r=wK.has(r)?r:D3(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,n){return hK(t,r,n)}build(t,r,n){sK(t,r,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(t,r,n,c){sye(t,r,n,c)}mount(t){this.isSVGTag=cK(t.tagName),super.mount(t)}}const cye=(e,t)=>O3(e)?new lye(t):new aye(t,{allowProjection:e!==Z.Fragment});function t_(e,t,r){const n=e.getProps();return j3(n,t,r!==void 0?r:n.custom,e)}const Ij=e=>Array.isArray(e);function uye(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,vm(r))}function hye(e){return Ij(e)?e[e.length-1]||0:e}function dye(e,t){const r=t_(e,t);let{transitionEnd:n={},transition:c={},...h}=r||{};h={...h,...n};for(const p in h){const o=hye(h[p]);uye(e,p,o)}}function fye(e){return!!(es(e)&&e.add)}function Oj(e,t){const r=e.getValue("willChange");if(fye(r))return r.add(t);if(!r&&Mh.WillChange){const n=new Mh.WillChange("auto");e.addValue("willChange",n),n.add(t)}}function SK(e){return e.props[dK]}const pye=e=>e!==null;function mye(e,{repeat:t,repeatType:r="loop"},n){const c=e.filter(pye),h=t&&r!=="loop"&&t%2===1?0:c.length-1;return c[h]}const gye={type:"spring",stiffness:500,damping:25,restSpeed:10},yye=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),_ye={type:"keyframes",duration:.8},vye={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},xye=(e,{keyframes:t})=>t.length>2?_ye:iv.has(e)?e.startsWith("scale")?yye(t[1]):gye:vye;function bye({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:c,repeat:h,repeatType:p,repeatDelay:o,from:v,elapsed:w,...T}){return!!Object.keys(T).length}const L3=(e,t,r,n={},c,h)=>p=>{const o=T3(n,e)||{},v=o.delay||n.delay||0;let{elapsed:w=0}=n;w=w-xu(v);const T={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-w,onUpdate:O=>{t.set(O),o.onUpdate&&o.onUpdate(O)},onComplete:()=>{p(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:h?void 0:c};bye(o)||Object.assign(T,xye(e,T)),T.duration&&(T.duration=xu(T.duration)),T.repeatDelay&&(T.repeatDelay=xu(T.repeatDelay)),T.from!==void 0&&(T.keyframes[0]=T.from);let M=!1;if((T.type===!1||T.duration===0&&!T.repeatDelay)&&(Aj(T),T.delay===0&&(M=!0)),(Mh.instantAnimations||Mh.skipAnimations)&&(M=!0,Aj(T),T.delay=0),T.allowFlatten=!o.type&&!o.ease,M&&!h&&t.get()!==void 0){const O=mye(T.keyframes,o);if(O!==void 0){co.update(()=>{T.onUpdate(O),T.onComplete()});return}}return o.isSync?new w3(T):new $me(T)};function wye({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function TK(e,t,{delay:r=0,transitionOverride:n,type:c}={}){let{transition:h=e.getDefaultTransition(),transitionEnd:p,...o}=t;n&&(h=n);const v=[],w=c&&e.animationState&&e.animationState.getState()[c];for(const T in o){const M=e.getValue(T,e.latestValues[T]??null),O=o[T];if(O===void 0||w&&wye(w,T))continue;const D={delay:r,...T3(h||{},T)},B=M.get();if(B!==void 0&&!M.isAnimating&&!Array.isArray(O)&&O===B&&!D.velocity)continue;let N=!1;if(window.MotionHandoffAnimation){const V=SK(e);if(V){const U=window.MotionHandoffAnimation(V,T,co);U!==null&&(D.startTime=U,N=!0)}}Oj(e,T),M.start(L3(T,M,O,e.shouldReduceMotion&&GZ.has(T)?{type:!1}:D,e,N));const G=M.animation;G&&v.push(G)}return p&&Promise.all(v).then(()=>{co.update(()=>{p&&dye(e,p)})}),v}function EK(e,t,r,n=0,c=1){const h=Array.from(e).sort((v,w)=>v.sortNodePosition(w)).indexOf(t),p=e.size,o=(p-1)*n;return typeof r=="function"?r(h,p):c===1?h*n:o-h*n}function jj(e,t,r={}){const n=t_(e,t,r.type==="exit"?e.presenceContext?.custom:void 0);let{transition:c=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(c=r.transitionOverride);const h=n?()=>Promise.all(TK(e,n,r)):()=>Promise.resolve(),p=e.variantChildren&&e.variantChildren.size?(v=0)=>{const{delayChildren:w=0,staggerChildren:T,staggerDirection:M}=c;return Sye(e,t,v,w,T,M,r)}:()=>Promise.resolve(),{when:o}=c;if(o){const[v,w]=o==="beforeChildren"?[h,p]:[p,h];return v().then(()=>w())}else return Promise.all([h(),p(r.delay)])}function Sye(e,t,r=0,n=0,c=0,h=1,p){const o=[];for(const v of e.variantChildren)v.notify("AnimationStart",t),o.push(jj(v,t,{...p,delay:r+(typeof n=="function"?0:n)+EK(e.variantChildren,v,n,c,h)}).then(()=>v.notify("AnimationComplete",t)));return Promise.all(o)}function Tye(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const c=t.map(h=>jj(e,h,r));n=Promise.all(c)}else if(typeof t=="string")n=jj(e,t,r);else{const c=typeof t=="function"?t_(e,t,r.custom):t;n=Promise.all(TK(e,c,r))}return n.then(()=>{e.notify("AnimationComplete",t)})}function AK(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}const Eye=P3.length;function kK(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?kK(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<Eye;r++){const n=P3[r],c=e.props[n];(rw(c)||c===!1)&&(t[n]=c)}return t}const Aye=[...C3].reverse(),kye=C3.length;function Cye(e){return t=>Promise.all(t.map(({animation:r,options:n})=>Tye(e,r,n)))}function Pye(e){let t=Cye(e),r=NU(),n=!0;const c=v=>(w,T)=>{const M=t_(e,T,v==="exit"?e.presenceContext?.custom:void 0);if(M){const{transition:O,transitionEnd:D,...B}=M;w={...w,...B,...D}}return w};function h(v){t=v(e)}function p(v){const{props:w}=e,T=kK(e.parent)||{},M=[],O=new Set;let D={},B=1/0;for(let G=0;G<kye;G++){const V=Aye[G],U=r[V],X=w[V]!==void 0?w[V]:T[V],Y=rw(X),ne=V===v?U.isActive:null;ne===!1&&(B=G);let se=X===T[V]&&X!==w[V]&&Y;if(se&&n&&e.manuallyAnimateOnMount&&(se=!1),U.protectedKeys={...D},!U.isActive&&ne===null||!X&&!U.prevProp||sk(X)||typeof X=="boolean")continue;const le=Mye(U.prevProp,X);let ge=le||V===v&&U.isActive&&!se&&Y||G>B&&Y,je=!1;const ze=Array.isArray(X)?X:[X];let Ce=ze.reduce(c(V),{});ne===!1&&(Ce={});const{prevResolvedValues:Ke={}}=U,Ye={...Ke,...Ce},Oe=He=>{ge=!0,O.has(He)&&(je=!0,O.delete(He)),U.needsAnimating[He]=!0;const lt=e.getValue(He);lt&&(lt.liveStyle=!1)};for(const He in Ye){const lt=Ce[He],rt=Ke[He];if(D.hasOwnProperty(He))continue;let ht=!1;Ij(lt)&&Ij(rt)?ht=!AK(lt,rt):ht=lt!==rt,ht?lt!=null?Oe(He):O.add(He):lt!==void 0&&O.has(He)?Oe(He):U.protectedKeys[He]=!0}U.prevProp=X,U.prevResolvedValues=Ce,U.isActive&&(D={...D,...Ce}),n&&e.blockInitialAnimation&&(ge=!1);const tt=se&&le;ge&&(!tt||je)&&M.push(...ze.map(He=>{const lt={type:V};if(typeof He=="string"&&n&&!tt&&e.manuallyAnimateOnMount&&e.parent){const{parent:rt}=e,ht=t_(rt,He);if(rt.enteringChildren&&ht){const{delayChildren:vt}=ht.transition||{};lt.delay=EK(rt.enteringChildren,e,vt)}}return{animation:He,options:lt}}))}if(O.size){const G={};if(typeof w.initial!="boolean"){const V=t_(e,Array.isArray(w.initial)?w.initial[0]:w.initial);V&&V.transition&&(G.transition=V.transition)}O.forEach(V=>{const U=e.getBaseTarget(V),X=e.getValue(V);X&&(X.liveStyle=!0),G[V]=U??null}),M.push({animation:G})}let N=!!M.length;return n&&(w.initial===!1||w.initial===w.animate)&&!e.manuallyAnimateOnMount&&(N=!1),n=!1,N?t(M):Promise.resolve()}function o(v,w){if(r[v].isActive===w)return Promise.resolve();e.variantChildren?.forEach(M=>M.animationState?.setActive(v,w)),r[v].isActive=w;const T=p(v);for(const M in r)r[M].protectedKeys={};return T}return{animateChanges:p,setActive:o,setAnimateFunction:h,getState:()=>r,reset:()=>{r=NU(),n=!0}}}function Mye(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!AK(t,e):!1}function jp(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function NU(){return{animate:jp(!0),whileInView:jp(),whileHover:jp(),whileTap:jp(),whileDrag:jp(),whileFocus:jp(),exit:jp()}}class wf{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Iye extends wf{constructor(t){super(t),t.animationState||(t.animationState=Pye(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();sk(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Oye=0;class jye extends wf{constructor(){super(...arguments),this.id=Oye++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const c=this.node.animationState.setActive("exit",!t);r&&!t&&c.then(()=>{r(this.id)})}mount(){const{register:t,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Rye={animation:{Feature:Iye},exit:{Feature:jye}};function iw(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function e1(e){return{point:{x:e.pageX,y:e.pageY}}}const Dye=e=>t=>k3(t)&&e(t,e1(t));function xb(e,t,r,n){return iw(e,t,Dye(r),n)}const CK=1e-4,Lye=1-CK,zye=1+CK,PK=.01,Nye=0-PK,Fye=0+PK;function gs(e){return e.max-e.min}function Bye(e,t,r){return Math.abs(e-t)<=r}function FU(e,t,r,n=.5){e.origin=n,e.originPoint=go(t.min,t.max,e.origin),e.scale=gs(r)/gs(t),e.translate=go(r.min,r.max,e.origin)-e.originPoint,(e.scale>=Lye&&e.scale<=zye||isNaN(e.scale))&&(e.scale=1),(e.translate>=Nye&&e.translate<=Fye||isNaN(e.translate))&&(e.translate=0)}function bb(e,t,r,n){FU(e.x,t.x,r.x,n?n.originX:void 0),FU(e.y,t.y,r.y,n?n.originY:void 0)}function BU(e,t,r){e.min=r.min+t.min,e.max=e.min+gs(t)}function Uye(e,t,r){BU(e.x,t.x,r.x),BU(e.y,t.y,r.y)}function UU(e,t,r){e.min=t.min-r.min,e.max=e.min+gs(t)}function wb(e,t,r){UU(e.x,t.x,r.x),UU(e.y,t.y,r.y)}function kl(e){return[e("x"),e("y")]}const MK=({current:e})=>e?e.ownerDocument.defaultView:null,VU=(e,t)=>Math.abs(e-t);function Vye(e,t){const r=VU(e.x,t.x),n=VU(e.y,t.y);return Math.sqrt(r**2+n**2)}class IK{constructor(t,r,{transformPagePoint:n,contextWindow:c=window,dragSnapToOrigin:h=!1,distanceThreshold:p=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=oI(this.lastMoveEventInfo,this.history),D=this.startEvent!==null,B=Vye(O.offset,{x:0,y:0})>=this.distanceThreshold;if(!D&&!B)return;const{point:N}=O,{timestamp:G}=La;this.history.push({...N,timestamp:G});const{onStart:V,onMove:U}=this.handlers;D||(V&&V(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),U&&U(this.lastMoveEvent,O)},this.handlePointerMove=(O,D)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=iI(D,this.transformPagePoint),co.update(this.updatePoint,!0)},this.handlePointerUp=(O,D)=>{this.end();const{onEnd:B,onSessionEnd:N,resumeAnimation:G}=this.handlers;if(this.dragSnapToOrigin&&G&&G(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const V=oI(O.type==="pointercancel"?this.lastMoveEventInfo:iI(D,this.transformPagePoint),this.history);this.startEvent&&B&&B(O,V),N&&N(O,V)},!k3(t))return;this.dragSnapToOrigin=h,this.handlers=r,this.transformPagePoint=n,this.distanceThreshold=p,this.contextWindow=c||window;const o=e1(t),v=iI(o,this.transformPagePoint),{point:w}=v,{timestamp:T}=La;this.history=[{...w,timestamp:T}];const{onSessionStart:M}=r;M&&M(t,oI(v,this.history)),this.removeListeners=Yw(xb(this.contextWindow,"pointermove",this.handlePointerMove),xb(this.contextWindow,"pointerup",this.handlePointerUp),xb(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Ih(this.updatePoint)}}function iI(e,t){return t?{point:t(e.point)}:e}function $U(e,t){return{x:e.x-t.x,y:e.y-t.y}}function oI({point:e},t){return{point:e,delta:$U(e,OK(t)),offset:$U(e,$ye(t)),velocity:Gye(t,.1)}}function $ye(e){return e[0]}function OK(e){return e[e.length-1]}function Gye(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const c=OK(e);for(;r>=0&&(n=e[r],!(c.timestamp-n.timestamp>xu(t)));)r--;if(!n)return{x:0,y:0};const h=bu(c.timestamp-n.timestamp);if(h===0)return{x:0,y:0};const p={x:(c.x-n.x)/h,y:(c.y-n.y)/h};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function qye(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?go(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?go(r,e,n.max):Math.min(e,r)),e}function GU(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function Hye(e,{top:t,left:r,bottom:n,right:c}){return{x:GU(e.x,r,c),y:GU(e.y,t,n)}}function qU(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function Wye(e,t){return{x:qU(e.x,t.x),y:qU(e.y,t.y)}}function Zye(e,t){let r=.5;const n=gs(e),c=gs(t);return c>n?r=Qb(t.min,t.max-n,e.min):n>c&&(r=Qb(e.min,e.max-c,t.min)),Ph(0,1,r)}function Kye(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const Rj=.35;function Xye(e=Rj){return e===!1?e=0:e===!0&&(e=Rj),{x:HU(e,"left","right"),y:HU(e,"top","bottom")}}function HU(e,t,r){return{min:WU(e,t),max:WU(e,r)}}function WU(e,t){return typeof e=="number"?e:e[t]||0}const Yye=new WeakMap;class Jye{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=jo(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:r=!1,distanceThreshold:n}={}){const{presenceContext:c}=this.visualElement;if(c&&c.isPresent===!1)return;const h=M=>{const{dragSnapToOrigin:O}=this.getProps();O?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(e1(M).point)},p=(M,O)=>{const{drag:D,dragPropagation:B,onDragStart:N}=this.getProps();if(D&&!B&&(this.openDragLock&&this.openDragLock(),this.openDragLock=oge(D),!this.openDragLock))return;this.latestPointerEvent=M,this.latestPanInfo=O,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),kl(V=>{let U=this.getAxisMotionValue(V).get()||0;if(wu.test(U)){const{projection:X}=this.visualElement;if(X&&X.layout){const Y=X.layout.layoutBox[V];Y&&(U=gs(Y)*(parseFloat(U)/100))}}this.originPoint[V]=U}),N&&co.postRender(()=>N(M,O)),Oj(this.visualElement,"transform");const{animationState:G}=this.visualElement;G&&G.setActive("whileDrag",!0)},o=(M,O)=>{this.latestPointerEvent=M,this.latestPanInfo=O;const{dragPropagation:D,dragDirectionLock:B,onDirectionLock:N,onDrag:G}=this.getProps();if(!D&&!this.openDragLock)return;const{offset:V}=O;if(B&&this.currentDirection===null){this.currentDirection=Qye(V),this.currentDirection!==null&&N&&N(this.currentDirection);return}this.updateAxis("x",O.point,V),this.updateAxis("y",O.point,V),this.visualElement.render(),G&&G(M,O)},v=(M,O)=>{this.latestPointerEvent=M,this.latestPanInfo=O,this.stop(M,O),this.latestPointerEvent=null,this.latestPanInfo=null},w=()=>kl(M=>this.getAnimationState(M)==="paused"&&this.getAxisMotionValue(M).animation?.play()),{dragSnapToOrigin:T}=this.getProps();this.panSession=new IK(t,{onSessionStart:h,onStart:p,onMove:o,onSessionEnd:v,resumeAnimation:w},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,distanceThreshold:n,contextWindow:MK(this.visualElement)})}stop(t,r){const n=t||this.latestPointerEvent,c=r||this.latestPanInfo,h=this.isDragging;if(this.cancel(),!h||!c||!n)return;const{velocity:p}=c;this.startAnimation(p);const{onDragEnd:o}=this.getProps();o&&co.postRender(()=>o(n,c))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:c}=this.getProps();if(!n||!BT(t,c,this.currentDirection))return;const h=this.getAxisMotionValue(t);let p=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(p=qye(p,this.constraints[t],this.elastic[t])),h.set(p)}resolveConstraints(){const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,c=this.constraints;t&&zy(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=Hye(n.layoutBox,t):this.constraints=!1,this.elastic=Xye(r),c!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&kl(h=>{this.constraints!==!1&&this.getAxisMotionValue(h)&&(this.constraints[h]=Kye(n.layoutBox[h],this.constraints[h]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!zy(t))return!1;const n=t.current,{projection:c}=this.visualElement;if(!c||!c.layout)return!1;const h=eye(n,c.root,this.visualElement.getTransformPagePoint());let p=Wye(c.layout.layoutBox,h);if(r){const o=r(Yge(p));this.hasMutatedConstraints=!!o,o&&(p=mK(o))}return p}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:c,dragTransition:h,dragSnapToOrigin:p,onDragTransitionEnd:o}=this.getProps(),v=this.constraints||{},w=kl(T=>{if(!BT(T,r,this.currentDirection))return;let M=v&&v[T]||{};p&&(M={min:0,max:0});const O=c?200:1e6,D=c?40:1e7,B={type:"inertia",velocity:n?t[T]:0,bounceStiffness:O,bounceDamping:D,timeConstant:750,restDelta:1,restSpeed:10,...h,...M};return this.startAxisValueAnimation(T,B)});return Promise.all(w).then(o)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return Oj(this.visualElement,t),n.start(L3(t,n,0,r,this.visualElement,!1))}stopAnimation(){kl(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){kl(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps();return n[r]||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){kl(r=>{const{drag:n}=this.getProps();if(!BT(r,n,this.currentDirection))return;const{projection:c}=this.visualElement,h=this.getAxisMotionValue(r);if(c&&c.layout){const{min:p,max:o}=c.layout.layoutBox[r];h.set(t[r]-go(p,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!zy(r)||!n||!this.constraints)return;this.stopAnimation();const c={x:0,y:0};kl(p=>{const o=this.getAxisMotionValue(p);if(o&&this.constraints!==!1){const v=o.get();c[p]=Zye({min:v,max:v},this.constraints[p])}});const{transformTemplate:h}=this.visualElement.getProps();this.visualElement.current.style.transform=h?h({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),kl(p=>{if(!BT(p,t,null))return;const o=this.getAxisMotionValue(p),{min:v,max:w}=this.constraints[p];o.set(go(v,w,c[p]))})}addListeners(){if(!this.visualElement.current)return;Yye.set(this.visualElement,this);const t=this.visualElement.current,r=xb(t,"pointerdown",v=>{const{drag:w,dragListener:T=!0}=this.getProps();w&&T&&this.start(v)}),n=()=>{const{dragConstraints:v}=this.getProps();zy(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:c}=this.visualElement,h=c.addEventListener("measure",n);c&&!c.layout&&(c.root&&c.root.updateScroll(),c.updateLayout()),co.read(n);const p=iw(window,"resize",()=>this.scalePositionWithinConstraints()),o=c.addEventListener("didUpdate",({delta:v,hasLayoutChanged:w})=>{this.isDragging&&w&&(kl(T=>{const M=this.getAxisMotionValue(T);M&&(this.originPoint[T]+=v[T].translate,M.set(M.get()+v[T].translate))}),this.visualElement.render())});return()=>{p(),r(),h(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:c=!1,dragConstraints:h=!1,dragElastic:p=Rj,dragMomentum:o=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:c,dragConstraints:h,dragElastic:p,dragMomentum:o}}}function BT(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function Qye(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class e_e extends wf{constructor(t){super(t),this.removeGroupControls=Dl,this.removeListeners=Dl,this.controls=new Jye(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Dl}unmount(){this.removeGroupControls(),this.removeListeners()}}const ZU=e=>(t,r)=>{e&&co.postRender(()=>e(t,r))};class t_e extends wf{constructor(){super(...arguments),this.removePointerDownListener=Dl}onPointerDown(t){this.session=new IK(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:MK(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:c}=this.node.getProps();return{onSessionStart:ZU(t),onStart:ZU(r),onMove:n,onEnd:(h,p)=>{delete this.session,c&&co.postRender(()=>c(h,p))}}}mount(){this.removePointerDownListener=xb(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const P2={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function KU(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const zx={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(bn.test(e))e=parseFloat(e);else return e;const r=KU(e,t.target.x),n=KU(e,t.target.y);return`${r}% ${n}%`}},r_e={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,c=_f.parse(e);if(c.length>5)return n;const h=_f.createTransformer(e),p=typeof c[0]!="number"?1:0,o=r.x.scale*t.x,v=r.y.scale*t.y;c[0+p]/=o,c[1+p]/=v;const w=go(o,v,.5);return typeof c[2+p]=="number"&&(c[2+p]/=w),typeof c[3+p]=="number"&&(c[3+p]/=w),h(c)}};let aI=!1;class n_e extends Z.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:c}=this.props,{projection:h}=t;Ege(i_e),h&&(r.group&&r.group.add(h),n&&n.register&&c&&n.register(h),aI&&h.root.didUpdate(),h.addEventListener("animationComplete",()=>{this.safeToRemove()}),h.setOptions({...h.options,onExitComplete:()=>this.safeToRemove()})),P2.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:c,isPresent:h}=this.props,{projection:p}=n;return p&&(p.isPresent=h,aI=!0,c||t.layoutDependency!==r||r===void 0||t.isPresent!==h?p.willUpdate():this.safeToRemove(),t.isPresent!==h&&(h?p.promote():p.relegate()||co.postRender(()=>{const o=p.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),A3.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:c}=t;aI=!0,c&&(c.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(c),n&&n.deregister&&n.deregister(c))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function jK(e){const[t,r]=tK(),n=Z.useContext(i3);return C.jsx(n_e,{...e,layoutGroup:n,switchLayoutGroup:Z.useContext(fK),isPresent:t,safeToRemove:r})}const i_e={borderRadius:{...zx,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:zx,borderTopRightRadius:zx,borderBottomLeftRadius:zx,borderBottomRightRadius:zx,boxShadow:r_e};function o_e(e,t,r){const n=es(e)?e:vm(e);return n.start(L3("",n,t,r)),n.animation}const a_e=(e,t)=>e.depth-t.depth;class s_e{constructor(){this.children=[],this.isDirty=!1}add(t){s3(this.children,t),this.isDirty=!0}remove(t){l3(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(a_e),this.isDirty=!1,this.children.forEach(t)}}function l_e(e,t){const r=Vs.now(),n=({timestamp:c})=>{const h=c-r;h>=t&&(Ih(n),e(h-t))};return co.setup(n,!0),()=>Ih(n)}const RK=["TopLeft","TopRight","BottomLeft","BottomRight"],c_e=RK.length,XU=e=>typeof e=="string"?parseFloat(e):e,YU=e=>typeof e=="number"||bn.test(e);function u_e(e,t,r,n,c,h){c?(e.opacity=go(0,r.opacity??1,h_e(n)),e.opacityExit=go(t.opacity??1,0,d_e(n))):h&&(e.opacity=go(t.opacity??1,r.opacity??1,n));for(let p=0;p<c_e;p++){const o=`border${RK[p]}Radius`;let v=JU(t,o),w=JU(r,o);v===void 0&&w===void 0||(v||(v=0),w||(w=0),v===0||w===0||YU(v)===YU(w)?(e[o]=Math.max(go(XU(v),XU(w),n),0),(wu.test(w)||wu.test(v))&&(e[o]+="%")):e[o]=w)}(t.rotate||r.rotate)&&(e.rotate=go(t.rotate||0,r.rotate||0,n))}function JU(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const h_e=DK(0,.5,xZ),d_e=DK(.5,.95,Dl);function DK(e,t,r){return n=>n<e?0:n>t?1:r(Qb(e,t,n))}function QU(e,t){e.min=t.min,e.max=t.max}function Sl(e,t){QU(e.x,t.x),QU(e.y,t.y)}function eV(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function tV(e,t,r,n,c){return e-=t,e=gE(e,1/r,n),c!==void 0&&(e=gE(e,1/c,n)),e}function f_e(e,t=0,r=1,n=.5,c,h=e,p=e){if(wu.test(t)&&(t=parseFloat(t),t=go(p.min,p.max,t/100)-p.min),typeof t!="number")return;let o=go(h.min,h.max,n);e===h&&(o-=t),e.min=tV(e.min,t,r,o,c),e.max=tV(e.max,t,r,o,c)}function rV(e,t,[r,n,c],h,p){f_e(e,t[r],t[n],t[c],t.scale,h,p)}const p_e=["x","scaleX","originX"],m_e=["y","scaleY","originY"];function nV(e,t,r,n){rV(e.x,t,p_e,r?r.x:void 0,n?n.x:void 0),rV(e.y,t,m_e,r?r.y:void 0,n?n.y:void 0)}function iV(e){return e.translate===0&&e.scale===1}function LK(e){return iV(e.x)&&iV(e.y)}function oV(e,t){return e.min===t.min&&e.max===t.max}function g_e(e,t){return oV(e.x,t.x)&&oV(e.y,t.y)}function aV(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function zK(e,t){return aV(e.x,t.x)&&aV(e.y,t.y)}function sV(e){return gs(e.x)/gs(e.y)}function lV(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class y_e{constructor(){this.members=[]}add(t){s3(this.members,t),t.scheduleRender()}remove(t){if(l3(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(c=>t===c);if(r===0)return!1;let n;for(let c=r;c>=0;c--){const h=this.members[c];if(h.isPresent!==!1){n=h;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:c}=t.options;c===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function __e(e,t,r){let n="";const c=e.x.translate/t.x,h=e.y.translate/t.y,p=r?.z||0;if((c||h||p)&&(n=`translate3d(${c}px, ${h}px, ${p}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:w,rotate:T,rotateX:M,rotateY:O,skewX:D,skewY:B}=r;w&&(n=`perspective(${w}px) ${n}`),T&&(n+=`rotate(${T}deg) `),M&&(n+=`rotateX(${M}deg) `),O&&(n+=`rotateY(${O}deg) `),D&&(n+=`skewX(${D}deg) `),B&&(n+=`skewY(${B}deg) `)}const o=e.x.scale*t.x,v=e.y.scale*t.y;return(o!==1||v!==1)&&(n+=`scale(${o}, ${v})`),n||"none"}const sI=["","X","Y","Z"],v_e=1e3;let x_e=0;function lI(e,t,r,n){const{latestValues:c}=t;c[e]&&(r[e]=c[e],t.setStaticValue(e,0),n&&(n[e]=0))}function NK(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=SK(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:c,layoutId:h}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",co,!(c||h))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&NK(n)}function FK({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:c}){return class{constructor(h={},p=t?.()){this.id=x_e++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(S_e),this.nodes.forEach(k_e),this.nodes.forEach(C_e),this.nodes.forEach(T_e)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=h,this.root=p?p.root||p:this,this.path=p?[...p.path,p]:[],this.parent=p,this.depth=p?p.depth+1:0;for(let o=0;o<this.path.length;o++)this.path[o].shouldResetTransform=!0;this.root===this&&(this.nodes=new s_e)}addEventListener(h,p){return this.eventHandlers.has(h)||this.eventHandlers.set(h,new h3),this.eventHandlers.get(h).add(p)}notifyListeners(h,...p){const o=this.eventHandlers.get(h);o&&o.notify(...p)}hasListeners(h){return this.eventHandlers.has(h)}mount(h){if(this.instance)return;this.isSVG=eK(h)&&!hge(h),this.instance=h;const{layoutId:p,layout:o,visualElement:v}=this.options;if(v&&!v.current&&v.mount(h),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(o||p)&&(this.isLayoutDirty=!0),e){let w,T=0;const M=()=>this.root.updateBlockedByResize=!1;co.read(()=>{T=window.innerWidth}),e(h,()=>{const O=window.innerWidth;O!==T&&(T=O,this.root.updateBlockedByResize=!0,w&&w(),w=l_e(M,250),P2.hasAnimatedSinceResize&&(P2.hasAnimatedSinceResize=!1,this.nodes.forEach(hV)))})}p&&this.root.registerSharedNode(p,this),this.options.animate!==!1&&v&&(p||o)&&this.addEventListener("didUpdate",({delta:w,hasLayoutChanged:T,hasRelativeLayoutChanged:M,layout:O})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const D=this.options.transition||v.getDefaultTransition()||j_e,{onLayoutAnimationStart:B,onLayoutAnimationComplete:N}=v.getProps(),G=!this.targetLayout||!zK(this.targetLayout,O),V=!T&&M;if(this.options.layoutRoot||this.resumeFrom||V||T&&(G||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const U={...T3(D,"layout"),onPlay:B,onComplete:N};(v.shouldReduceMotion||this.options.layoutRoot)&&(U.delay=0,U.type=!1),this.startAnimation(U),this.setAnimationOrigin(w,V)}else T||hV(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=O})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const h=this.getStack();h&&h.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ih(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(P_e),this.animationId++)}getTransformTemplate(){const{visualElement:h}=this.options;return h&&h.getProps().transformTemplate}willUpdate(h=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&NK(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const T=this.path[w];T.shouldResetTransform=!0,T.updateScroll("snapshot"),T.options.layoutRoot&&T.willUpdate(!1)}const{layoutId:p,layout:o}=this.options;if(p===void 0&&!o)return;const v=this.getTransformTemplate();this.prevTransformTemplateValue=v?v(this.latestValues,""):void 0,this.updateSnapshot(),h&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(cV);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(uV);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(A_e),this.nodes.forEach(b_e),this.nodes.forEach(w_e)):this.nodes.forEach(uV),this.clearAllSnapshots();const h=Vs.now();La.delta=Ph(0,1e3/60,h-La.timestamp),La.timestamp=h,La.isProcessing=!0,XM.update.process(La),XM.preRender.process(La),XM.render.process(La),La.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,A3.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(E_e),this.sharedNodes.forEach(M_e)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,co.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){co.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!gs(this.snapshot.measuredBox.x)&&!gs(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let o=0;o<this.path.length;o++)this.path[o].updateScroll();const h=this.layout;this.layout=this.measure(!1),this.layoutCorrected=jo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:p}=this.options;p&&p.notify("LayoutMeasure",this.layout.layoutBox,h?h.layoutBox:void 0)}updateScroll(h="measure"){let p=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===h&&(p=!1),p&&this.instance){const o=n(this.instance);this.scroll={animationId:this.root.animationId,phase:h,isRoot:o,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:o}}}resetTransform(){if(!c)return;const h=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,p=this.projectionDelta&&!LK(this.projectionDelta),o=this.getTransformTemplate(),v=o?o(this.latestValues,""):void 0,w=v!==this.prevTransformTemplateValue;h&&this.instance&&(p||Up(this.latestValues)||w)&&(c(this.instance,v),this.shouldResetTransform=!1,this.scheduleRender())}measure(h=!0){const p=this.measurePageBox();let o=this.removeElementScroll(p);return h&&(o=this.removeTransform(o)),R_e(o),{animationId:this.root.animationId,measuredBox:p,layoutBox:o,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:h}=this.options;if(!h)return jo();const p=h.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(D_e))){const{scroll:o}=this.root;o&&(Ny(p.x,o.offset.x),Ny(p.y,o.offset.y))}return p}removeElementScroll(h){const p=jo();if(Sl(p,h),this.scroll?.wasRoot)return p;for(let o=0;o<this.path.length;o++){const v=this.path[o],{scroll:w,options:T}=v;v!==this.root&&w&&T.layoutScroll&&(w.wasRoot&&Sl(p,h),Ny(p.x,w.offset.x),Ny(p.y,w.offset.y))}return p}applyTransform(h,p=!1){const o=jo();Sl(o,h);for(let v=0;v<this.path.length;v++){const w=this.path[v];!p&&w.options.layoutScroll&&w.scroll&&w!==w.root&&Fy(o,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),Up(w.latestValues)&&Fy(o,w.latestValues)}return Up(this.latestValues)&&Fy(o,this.latestValues),o}removeTransform(h){const p=jo();Sl(p,h);for(let o=0;o<this.path.length;o++){const v=this.path[o];if(!v.instance||!Up(v.latestValues))continue;Cj(v.latestValues)&&v.updateSnapshot();const w=jo(),T=v.measurePageBox();Sl(w,T),nV(p,v.latestValues,v.snapshot?v.snapshot.layoutBox:void 0,w)}return Up(this.latestValues)&&nV(p,this.latestValues),p}setTargetDelta(h){this.targetDelta=h,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(h){this.options={...this.options,...h,crossfade:h.crossfade!==void 0?h.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==La.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(h=!1){const p=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=p.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=p.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=p.isSharedProjectionDirty);const o=!!this.resumingFrom||this!==p;if(!(h||o&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:v,layoutId:w}=this.options;if(!(!this.layout||!(v||w))){if(this.resolvedRelativeTargetAt=La.timestamp,!this.targetDelta&&!this.relativeTarget){const T=this.getClosestProjectingParent();T&&T.layout&&this.animationProgress!==1?(this.relativeParent=T,this.forceRelativeParentToResolveTarget(),this.relativeTarget=jo(),this.relativeTargetOrigin=jo(),wb(this.relativeTargetOrigin,this.layout.layoutBox,T.layout.layoutBox),Sl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=jo(),this.targetWithTransforms=jo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Uye(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Sl(this.target,this.layout.layoutBox),yK(this.target,this.targetDelta)):Sl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const T=this.getClosestProjectingParent();T&&!!T.resumingFrom==!!this.resumingFrom&&!T.options.layoutScroll&&T.target&&this.animationProgress!==1?(this.relativeParent=T,this.forceRelativeParentToResolveTarget(),this.relativeTarget=jo(),this.relativeTargetOrigin=jo(),wb(this.relativeTargetOrigin,this.target,T.target),Sl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Cj(this.parent.latestValues)||gK(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const h=this.getLead(),p=!!this.resumingFrom||this!==h;let o=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(o=!1),p&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(o=!1),this.resolvedRelativeTargetAt===La.timestamp&&(o=!1),o)return;const{layout:v,layoutId:w}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(v||w))return;Sl(this.layoutCorrected,this.layout.layoutBox);const T=this.treeScale.x,M=this.treeScale.y;Qge(this.layoutCorrected,this.treeScale,this.path,p),h.layout&&!h.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(h.target=h.layout.layoutBox,h.targetWithTransforms=jo());const{target:O}=h;if(!O){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(eV(this.prevProjectionDelta.x,this.projectionDelta.x),eV(this.prevProjectionDelta.y,this.projectionDelta.y)),bb(this.projectionDelta,this.layoutCorrected,O,this.latestValues),(this.treeScale.x!==T||this.treeScale.y!==M||!lV(this.projectionDelta.x,this.prevProjectionDelta.x)||!lV(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",O))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(h=!0){if(this.options.visualElement?.scheduleRender(),h){const p=this.getStack();p&&p.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=By(),this.projectionDelta=By(),this.projectionDeltaWithTransform=By()}setAnimationOrigin(h,p=!1){const o=this.snapshot,v=o?o.latestValues:{},w={...this.latestValues},T=By();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!p;const M=jo(),O=o?o.source:void 0,D=this.layout?this.layout.source:void 0,B=O!==D,N=this.getStack(),G=!N||N.members.length<=1,V=!!(B&&!G&&this.options.crossfade===!0&&!this.path.some(O_e));this.animationProgress=0;let U;this.mixTargetDelta=X=>{const Y=X/1e3;dV(T.x,h.x,Y),dV(T.y,h.y,Y),this.setTargetDelta(T),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(wb(M,this.layout.layoutBox,this.relativeParent.layout.layoutBox),I_e(this.relativeTarget,this.relativeTargetOrigin,M,Y),U&&g_e(this.relativeTarget,U)&&(this.isProjectionDirty=!1),U||(U=jo()),Sl(U,this.relativeTarget)),B&&(this.animationValues=w,u_e(w,v,this.latestValues,Y,V,G)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Y},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(h){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Ih(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=co.update(()=>{P2.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=vm(0)),this.currentAnimation=o_e(this.motionValue,[0,1e3],{...h,velocity:0,isSync:!0,onUpdate:p=>{this.mixTargetDelta(p),h.onUpdate&&h.onUpdate(p)},onStop:()=>{},onComplete:()=>{h.onComplete&&h.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const h=this.getStack();h&&h.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(v_e),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const h=this.getLead();let{targetWithTransforms:p,target:o,layout:v,latestValues:w}=h;if(!(!p||!o||!v)){if(this!==h&&this.layout&&v&&BK(this.options.animationType,this.layout.layoutBox,v.layoutBox)){o=this.target||jo();const T=gs(this.layout.layoutBox.x);o.x.min=h.target.x.min,o.x.max=o.x.min+T;const M=gs(this.layout.layoutBox.y);o.y.min=h.target.y.min,o.y.max=o.y.min+M}Sl(p,o),Fy(p,w),bb(this.projectionDeltaWithTransform,this.layoutCorrected,p,w)}}registerSharedNode(h,p){this.sharedNodes.has(h)||this.sharedNodes.set(h,new y_e),this.sharedNodes.get(h).add(p);const o=p.options.initialPromotionConfig;p.promote({transition:o?o.transition:void 0,preserveFollowOpacity:o&&o.shouldPreserveFollowOpacity?o.shouldPreserveFollowOpacity(p):void 0})}isLead(){const h=this.getStack();return h?h.lead===this:!0}getLead(){const{layoutId:h}=this.options;return h?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:h}=this.options;return h?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:h}=this.options;if(h)return this.root.sharedNodes.get(h)}promote({needsReset:h,transition:p,preserveFollowOpacity:o}={}){const v=this.getStack();v&&v.promote(this,o),h&&(this.projectionDelta=void 0,this.needsReset=!0),p&&this.setOptions({transition:p})}relegate(){const h=this.getStack();return h?h.relegate(this):!1}resetSkewAndRotation(){const{visualElement:h}=this.options;if(!h)return;let p=!1;const{latestValues:o}=h;if((o.z||o.rotate||o.rotateX||o.rotateY||o.rotateZ||o.skewX||o.skewY)&&(p=!0),!p)return;const v={};o.z&&lI("z",h,v,this.animationValues);for(let w=0;w<sI.length;w++)lI(`rotate${sI[w]}`,h,v,this.animationValues),lI(`skew${sI[w]}`,h,v,this.animationValues);h.render();for(const w in v)h.setStaticValue(w,v[w]),this.animationValues&&(this.animationValues[w]=v[w]);h.scheduleRender()}applyProjectionStyles(h,p){if(!this.instance||this.isSVG)return;if(!this.isVisible){h.visibility="hidden";return}const o=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,h.visibility="",h.opacity="",h.pointerEvents=C2(p?.pointerEvents)||"",h.transform=o?o(this.latestValues,""):"none";return}const v=this.getLead();if(!this.projectionDelta||!this.layout||!v.target){this.options.layoutId&&(h.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,h.pointerEvents=C2(p?.pointerEvents)||""),this.hasProjected&&!Up(this.latestValues)&&(h.transform=o?o({},""):"none",this.hasProjected=!1);return}h.visibility="";const w=v.animationValues||v.latestValues;this.applyTransformsToTarget();let T=__e(this.projectionDeltaWithTransform,this.treeScale,w);o&&(T=o(w,T)),h.transform=T;const{x:M,y:O}=this.projectionDelta;h.transformOrigin=`${M.origin*100}% ${O.origin*100}% 0`,v.animationValues?h.opacity=v===this?w.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:w.opacityExit:h.opacity=v===this?w.opacity!==void 0?w.opacity:"":w.opacityExit!==void 0?w.opacityExit:0;for(const D in nw){if(w[D]===void 0)continue;const{correct:B,applyTo:N,isCSSVariable:G}=nw[D],V=T==="none"?w[D]:B(w[D],v);if(N){const U=N.length;for(let X=0;X<U;X++)h[N[X]]=V}else G?this.options.visualElement.renderState.vars[D]=V:h[D]=V}this.options.layoutId&&(h.pointerEvents=v===this?C2(p?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(h=>h.currentAnimation?.stop()),this.root.nodes.forEach(cV),this.root.sharedNodes.clear()}}}function b_e(e){e.updateLayout()}function w_e(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=e.layout,{animationType:c}=e.options,h=t.source!==e.layout.source;c==="size"?kl(T=>{const M=h?t.measuredBox[T]:t.layoutBox[T],O=gs(M);M.min=r[T].min,M.max=M.min+O}):BK(c,t.layoutBox,r)&&kl(T=>{const M=h?t.measuredBox[T]:t.layoutBox[T],O=gs(r[T]);M.max=M.min+O,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[T].max=e.relativeTarget[T].min+O)});const p=By();bb(p,r,t.layoutBox);const o=By();h?bb(o,e.applyTransform(n,!0),t.measuredBox):bb(o,r,t.layoutBox);const v=!LK(p);let w=!1;if(!e.resumeFrom){const T=e.getClosestProjectingParent();if(T&&!T.resumeFrom){const{snapshot:M,layout:O}=T;if(M&&O){const D=jo();wb(D,t.layoutBox,M.layoutBox);const B=jo();wb(B,r,O.layoutBox),zK(D,B)||(w=!0),T.options.layoutRoot&&(e.relativeTarget=B,e.relativeTargetOrigin=D,e.relativeParent=T)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:o,layoutDelta:p,hasLayoutChanged:v,hasRelativeLayoutChanged:w})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function S_e(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function T_e(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function E_e(e){e.clearSnapshot()}function cV(e){e.clearMeasurements()}function uV(e){e.isLayoutDirty=!1}function A_e(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function hV(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function k_e(e){e.resolveTargetDelta()}function C_e(e){e.calcProjection()}function P_e(e){e.resetSkewAndRotation()}function M_e(e){e.removeLeadSnapshot()}function dV(e,t,r){e.translate=go(t.translate,0,r),e.scale=go(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function fV(e,t,r,n){e.min=go(t.min,r.min,n),e.max=go(t.max,r.max,n)}function I_e(e,t,r,n){fV(e.x,t.x,r.x,n),fV(e.y,t.y,r.y,n)}function O_e(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const j_e={duration:.45,ease:[.4,0,.1,1]},pV=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),mV=pV("applewebkit/")&&!pV("chrome/")?Math.round:Dl;function gV(e){e.min=mV(e.min),e.max=mV(e.max)}function R_e(e){gV(e.x),gV(e.y)}function BK(e,t,r){return e==="position"||e==="preserve-aspect"&&!Bye(sV(t),sV(r),.2)}function D_e(e){return e!==e.root&&e.scroll?.wasRoot}const L_e=FK({attachResizeListener:(e,t)=>iw(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),cI={current:void 0},UK=FK({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!cI.current){const e=new L_e({});e.mount(window),e.setOptions({layoutScroll:!0}),cI.current=e}return cI.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),z_e={pan:{Feature:t_e},drag:{Feature:e_e,ProjectionNode:UK,MeasureLayout:jK}};function yV(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",r==="Start");const c="onHover"+r,h=n[c];h&&co.postRender(()=>h(t,e1(t)))}class N_e extends wf{mount(){const{current:t}=this.node;t&&(this.unmount=age(t,(r,n)=>(yV(this.node,n,"Start"),c=>yV(this.node,c,"End"))))}unmount(){}}class F_e extends wf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Yw(iw(this.node.current,"focus",()=>this.onFocus()),iw(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function _V(e,t,r){const{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",r==="Start");const c="onTap"+(r==="End"?"":r),h=n[c];h&&co.postRender(()=>h(t,e1(t)))}class B_e extends wf{mount(){const{current:t}=this.node;t&&(this.unmount=uge(t,(r,n)=>(_V(this.node,n,"Start"),(c,{success:h})=>_V(this.node,c,h?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Dj=new WeakMap,uI=new WeakMap,U_e=e=>{const t=Dj.get(e.target);t&&t(e)},V_e=e=>{e.forEach(U_e)};function $_e({root:e,...t}){const r=e||document;uI.has(r)||uI.set(r,{});const n=uI.get(r),c=JSON.stringify(t);return n[c]||(n[c]=new IntersectionObserver(V_e,{root:e,...t})),n[c]}function G_e(e,t,r){const n=$_e(t);return Dj.set(e,r),n.observe(e),()=>{Dj.delete(e),n.unobserve(e)}}const q_e={some:0,all:1};class H_e extends wf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:c="some",once:h}=t,p={root:r?r.current:void 0,rootMargin:n,threshold:typeof c=="number"?c:q_e[c]},o=v=>{const{isIntersecting:w}=v;if(this.isInView===w||(this.isInView=w,h&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:T,onViewportLeave:M}=this.node.getProps(),O=w?T:M;O&&O(v)};return G_e(this.node.current,p,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(W_e(t,r))&&this.startObserver()}unmount(){}}function W_e({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const Z_e={inView:{Feature:H_e},tap:{Feature:B_e},focus:{Feature:F_e},hover:{Feature:N_e}},K_e={layout:{ProjectionNode:UK,MeasureLayout:jK}},X_e={...Rye,...Z_e,...z_e,...K_e},Fr=Xge(X_e,cye);function VK(e){const t=Xw(()=>vm(e)),{isStatic:r}=Z.useContext(ok);if(r){const[,n]=Z.useState(e);Z.useEffect(()=>t.on("change",n),[])}return t}function $K(e,t){const r=VK(t()),n=()=>r.set(t());return n(),a3(()=>{const c=()=>co.preRender(n,!1,!0),h=e.map(p=>p.on("change",c));return()=>{h.forEach(p=>p()),Ih(n)}}),r}function Y_e(e){vb.current=[],e();const t=$K(vb.current,e);return vb.current=void 0,t}function hI(e,t,r,n){if(typeof e=="function")return Y_e(e);const c=typeof t=="function"?t:dge(t,r,n);return Array.isArray(e)?vV(e,c):vV([e],([h])=>c(h))}function vV(e,t){const r=Xw(()=>[]);return $K(e,()=>{r.length=0;const n=e.length;for(let c=0;c<n;c++)r[c]=e[c].get();return t(r)})}const kn=Z.forwardRef(({className:e,...t},r)=>C.jsx("div",{ref:r,className:ln("rounded-xl border bg-card text-card-foreground shadow-soft transition-all duration-300",e),...t}));kn.displayName="Card";const r_=Z.forwardRef(({className:e,...t},r)=>C.jsx("div",{ref:r,className:ln("flex flex-col space-y-2 p-6",e),...t}));r_.displayName="CardHeader";const n_=Z.forwardRef(({className:e,...t},r)=>C.jsx("h3",{ref:r,className:ln("text-2xl font-heading font-semibold leading-none tracking-tight",e),...t}));n_.displayName="CardTitle";const GK=Z.forwardRef(({className:e,...t},r)=>C.jsx("p",{ref:r,className:ln("text-sm text-muted-foreground",e),...t}));GK.displayName="CardDescription";const Cl=Z.forwardRef(({className:e,...t},r)=>C.jsx("div",{ref:r,className:ln("p-6 pt-0",e),...t}));Cl.displayName="CardContent";const J_e=Z.forwardRef(({className:e,...t},r)=>C.jsx("div",{ref:r,className:ln("flex items-center p-6 pt-0",e),...t}));J_e.displayName="CardFooter";const Q_e=Y_("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:scale-105",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:shadow-lg",outline:"border border-input bg-background/50 hover:bg-accent hover:text-accent-foreground hover:shadow-md hover:scale-105",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:shadow-md",ghost:"hover:bg-accent hover:text-accent-foreground hover:scale-105",link:"text-primary underline-offset-4 hover:underline hover:scale-105",glass:"bg-white/10 backdrop-blur-md border border-white/20 text-white hover:bg-white/20 hover:shadow-lg",gradient:"bg-gradient-primary text-primary-foreground hover:shadow-glow hover:scale-105"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),qr=Z.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...c},h)=>{const p=n?Vle:"button";return C.jsx(p,{className:ln(Q_e({variant:t,size:r,className:e})),ref:h,...c})});qr.displayName="Button";const eve=Y_("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function sn({className:e,variant:t,...r}){return C.jsx("div",{className:ln(eve({variant:t}),e),...r})}const tve=({rating:e,reviewCount:t=0,showReviewCount:r=!0,size:n="md",className:c})=>{const h={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},p={sm:"text-xs",md:"text-sm",lg:"text-base"};return C.jsxs("div",{className:ln("flex items-center gap-2",c),children:[C.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((o,v)=>C.jsx(bs,{className:ln(h[n],v<Math.floor(e)?"text-yellow-400 fill-yellow-400":v<e?"text-yellow-400 fill-yellow-400/50":"text-muted-foreground")},v))}),C.jsx("span",{className:ln("font-medium",p[n]),children:e.toFixed(1)}),r&&t>0&&C.jsxs("span",{className:ln("text-muted-foreground",p[n]),children:["(",t," ",t===1?"recension":"recensioner",")"]})]})},rve=({onClickOutside:e,children:t,className:r="",disabled:n=!1})=>{const c=Z.useRef(null);return Z.useEffect(()=>{if(n)return;const h=p=>{c.current&&!c.current.contains(p.target)&&e()};return document.addEventListener("mousedown",h,!0),()=>{document.removeEventListener("mousedown",h,!0)}},[e,n]),C.jsx("div",{ref:c,className:r,children:t})},nve=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>tv(async()=>{const{default:n}=await Promise.resolve().then(()=>ov);return{default:n}}).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)};class z3 extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class ive extends z3{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class xV extends z3{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class bV extends z3{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Lj;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(Lj||(Lj={}));var ove=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function o(T){try{w(n.next(T))}catch(M){p(M)}}function v(T){try{w(n.throw(T))}catch(M){p(M)}}function w(T){T.done?h(T.value):c(T.value).then(o,v)}w((n=n.apply(e,[])).next())})};class ave{constructor(t,{headers:r={},customFetch:n,region:c=Lj.Any}={}){this.url=t,this.headers=r,this.region=c,this.fetch=nve(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,r={}){var n;return ove(this,void 0,void 0,function*(){try{const{headers:c,method:h,body:p}=r;let o={},{region:v}=r;v||(v=this.region);const w=new URL(`${this.url}/${t}`);v&&v!=="any"&&(o["x-region"]=v,w.searchParams.set("forceFunctionRegion",v));let T;p&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)&&(typeof Blob<"u"&&p instanceof Blob||p instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",T=p):typeof p=="string"?(o["Content-Type"]="text/plain",T=p):typeof FormData<"u"&&p instanceof FormData?T=p:(o["Content-Type"]="application/json",T=JSON.stringify(p)));const M=yield this.fetch(w.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),c),body:T}).catch(N=>{throw new ive(N)}),O=M.headers.get("x-relay-error");if(O&&O==="true")throw new xV(M);if(!M.ok)throw new bV(M);let D=((n=M.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),B;return D==="application/json"?B=yield M.json():D==="application/octet-stream"?B=yield M.blob():D==="text/event-stream"?B=M:D==="multipart/form-data"?B=yield M.formData():B=yield M.text(),{data:B,error:null,response:M}}catch(c){return{data:null,error:c,response:c instanceof bV||c instanceof xV?c.context:void 0}}})}}var Bs={},N3={},ck={},t1={},uk={},hk={},sve=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},x_=sve();const lve=x_.fetch,qK=x_.fetch.bind(x_),HK=x_.Headers,cve=x_.Request,uve=x_.Response,ov=Object.freeze(Object.defineProperty({__proto__:null,Headers:HK,Request:cve,Response:uve,default:qK,fetch:lve},Symbol.toStringTag,{value:"Module"})),hve=uae(ov);var dk={};Object.defineProperty(dk,"__esModule",{value:!0});let dve=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};dk.default=dve;var WK=za&&za.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(hk,"__esModule",{value:!0});const fve=WK(hve),pve=WK(dk);let mve=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=fve.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var h,p,o,v;let w=null,T=null,M=null,O=c.status,D=c.statusText;if(c.ok){if(this.method!=="HEAD"){const G=await c.text();G===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&!((h=this.headers.get("Accept"))===null||h===void 0)&&h.includes("application/vnd.pgrst.plan+text")?T=G:T=JSON.parse(G))}const B=(p=this.headers.get("Prefer"))===null||p===void 0?void 0:p.match(/count=(exact|planned|estimated)/),N=(o=c.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");B&&N&&N.length>1&&(M=parseInt(N[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(T)&&(T.length>1?(w={code:"PGRST116",details:`Results contain ${T.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},T=null,M=null,O=406,D="Not Acceptable"):T.length===1?T=T[0]:T=null)}else{const B=await c.text();try{w=JSON.parse(B),Array.isArray(w)&&c.status===404&&(T=[],w=null,O=200,D="OK")}catch{c.status===404&&B===""?(O=204,D="No Content"):w={message:B}}if(w&&this.isMaybeSingle&&!((v=w?.details)===null||v===void 0)&&v.includes("0 rows")&&(w=null,O=200,D="OK"),w&&this.shouldThrowOnError)throw new pve.default(w)}return{error:w,data:T,count:M,status:O,statusText:D}});return this.shouldThrowOnError||(n=n.catch(c=>{var h,p,o;return{error:{message:`${(h=c?.name)!==null&&h!==void 0?h:"FetchError"}: ${c?.message}`,details:`${(p=c?.stack)!==null&&p!==void 0?p:""}`,hint:"",code:`${(o=c?.code)!==null&&o!==void 0?o:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};hk.default=mve;var gve=za&&za.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(uk,"__esModule",{value:!0});const yve=gve(hk);let _ve=class extends yve.default{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:c=n}={}){const h=c?`${c}.order`:"order",p=this.url.searchParams.get(h);return this.url.searchParams.set(h,`${p?`${p},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const c=typeof n>"u"?"offset":`${n}.offset`,h=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(c,`${e}`),this.url.searchParams.set(h,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:c=!1,format:h="text"}={}){var p;const o=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,c?"wal":null].filter(Boolean).join("|"),v=(p=this.headers.get("Accept"))!==null&&p!==void 0?p:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${h}; for="${v}"; options=${o};`),h==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};uk.default=_ve;var vve=za&&za.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t1,"__esModule",{value:!0});const xve=vve(uk);let bve=class extends xve.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let c="";n==="plain"?c="pl":n==="phrase"?c="ph":n==="websearch"&&(c="w");const h=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${c}fts${h}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};t1.default=bve;var wve=za&&za.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ck,"__esModule",{value:!0});const Nx=wve(t1);let Sve=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let c=!1;const h=(e??"*").split("").map(p=>/\s/.test(p)&&!c?"":(p==='"'&&(c=!c),p)).join("");return this.url.searchParams.set("select",h),r&&this.headers.append("Prefer",`count=${r}`),new Nx.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var n;const c="POST";if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const h=e.reduce((p,o)=>p.concat(Object.keys(o)),[]);if(h.length>0){const p=[...new Set(h)].map(o=>`"${o}"`);this.url.searchParams.set("columns",p.join(","))}}return new Nx.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:c=!0}={}){var h;const p="POST";if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((v,w)=>v.concat(Object.keys(w)),[]);if(o.length>0){const v=[...new Set(o)].map(w=>`"${w}"`);this.url.searchParams.set("columns",v.join(","))}}return new Nx.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}update(e,{count:t}={}){var r;const n="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Nx.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:e}={}){var t;const r="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Nx.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};ck.default=Sve;var ZK=za&&za.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(N3,"__esModule",{value:!0});const Tve=ZK(ck),Eve=ZK(t1);let Ave=class KK{constructor(t,{headers:r={},schema:n,fetch:c}={}){this.url=t,this.headers=new Headers(r),this.schemaName=n,this.fetch=c}from(t){const r=new URL(`${this.url}/${t}`);return new Tve.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new KK(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:n=!1,get:c=!1,count:h}={}){var p;let o;const v=new URL(`${this.url}/rpc/${t}`);let w;n||c?(o=n?"HEAD":"GET",Object.entries(r).filter(([M,O])=>O!==void 0).map(([M,O])=>[M,Array.isArray(O)?`{${O.join(",")}}`:`${O}`]).forEach(([M,O])=>{v.searchParams.append(M,O)})):(o="POST",w=r);const T=new Headers(this.headers);return h&&T.set("Prefer",`count=${h}`),new Eve.default({method:o,url:v,headers:T,schema:this.schemaName,body:w,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}};N3.default=Ave;var av=za&&za.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Bs,"__esModule",{value:!0});Bs.PostgrestError=Bs.PostgrestBuilder=Bs.PostgrestTransformBuilder=Bs.PostgrestFilterBuilder=Bs.PostgrestQueryBuilder=Bs.PostgrestClient=void 0;const XK=av(N3);Bs.PostgrestClient=XK.default;const YK=av(ck);Bs.PostgrestQueryBuilder=YK.default;const JK=av(t1);Bs.PostgrestFilterBuilder=JK.default;const QK=av(uk);Bs.PostgrestTransformBuilder=QK.default;const eX=av(hk);Bs.PostgrestBuilder=eX.default;const tX=av(dk);Bs.PostgrestError=tX.default;var kve=Bs.default={PostgrestClient:XK.default,PostgrestQueryBuilder:YK.default,PostgrestFilterBuilder:JK.default,PostgrestTransformBuilder:QK.default,PostgrestBuilder:eX.default,PostgrestError:tX.default};const{PostgrestClient:Cve,PostgrestQueryBuilder:rHe,PostgrestFilterBuilder:nHe,PostgrestTransformBuilder:iHe,PostgrestBuilder:oHe,PostgrestError:aHe}=kve;class Pve{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge"))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const r=parseInt(process.versions.node.split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const Mve="2.15.1",Ive=`realtime-js/${Mve}`,Ove="1.0.0",zj=1e4,jve=1e3,Rve=100;var Sb;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Sb||(Sb={}));var ea;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(ea||(ea={}));var dc;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(dc||(dc={}));var Nj;(function(e){e.websocket="websocket"})(Nj||(Nj={}));var Wp;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Wp||(Wp={}));class Dve{constructor(){this.HEADER_LENGTH=1}decode(t,r){return t.constructor===ArrayBuffer?r(this._binaryDecode(t)):r(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const r=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,r,n)}_decodeBroadcast(t,r,n){const c=r.getUint8(1),h=r.getUint8(2);let p=this.HEADER_LENGTH+2;const o=n.decode(t.slice(p,p+c));p=p+c;const v=n.decode(t.slice(p,p+h));p=p+h;const w=JSON.parse(n.decode(t.slice(p,t.byteLength)));return{ref:null,topic:o,event:v,payload:w}}}class rX{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Yi;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Yi||(Yi={}));const wV=(e,t,r={})=>{var n;const c=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(t).reduce((h,p)=>(h[p]=Lve(p,e,t,c),h),{})},Lve=(e,t,r,n)=>{const c=t.find(o=>o.name===e),h=c?.type,p=r[e];return h&&!n.includes(h)?nX(h,p):Fj(p)},nX=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return Bve(t,r)}switch(e){case Yi.bool:return zve(t);case Yi.float4:case Yi.float8:case Yi.int2:case Yi.int4:case Yi.int8:case Yi.numeric:case Yi.oid:return Nve(t);case Yi.json:case Yi.jsonb:return Fve(t);case Yi.timestamp:return Uve(t);case Yi.abstime:case Yi.date:case Yi.daterange:case Yi.int4range:case Yi.int8range:case Yi.money:case Yi.reltime:case Yi.text:case Yi.time:case Yi.timestamptz:case Yi.timetz:case Yi.tsrange:case Yi.tstzrange:return Fj(t);default:return Fj(t)}},Fj=e=>e,zve=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Nve=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Fve=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Bve=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let c;const h=e.slice(1,r);try{c=JSON.parse("["+h+"]")}catch{c=h?h.split(","):[]}return c.map(p=>nX(t,p))}return e},Uve=e=>typeof e=="string"?e.replace(" ","T"):e,iX=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class dI{constructor(t,r,n={},c=zj){this.channel=t,this.event=r,this.payload=n,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var SV;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(SV||(SV={}));class Tb{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},c=>{const{onJoin:h,onLeave:p,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Tb.syncState(this.state,c,h,p),this.pendingDiffs.forEach(v=>{this.state=Tb.syncDiff(this.state,v,h,p)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},c=>{const{onJoin:h,onLeave:p,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(c):(this.state=Tb.syncDiff(this.state,c,h,p),o())}),this.onJoin((c,h,p)=>{this.channel._trigger("presence",{event:"join",key:c,currentPresences:h,newPresences:p})}),this.onLeave((c,h,p)=>{this.channel._trigger("presence",{event:"leave",key:c,currentPresences:h,leftPresences:p})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,c){const h=this.cloneDeep(t),p=this.transformState(r),o={},v={};return this.map(h,(w,T)=>{p[w]||(v[w]=T)}),this.map(p,(w,T)=>{const M=h[w];if(M){const O=T.map(G=>G.presence_ref),D=M.map(G=>G.presence_ref),B=T.filter(G=>D.indexOf(G.presence_ref)<0),N=M.filter(G=>O.indexOf(G.presence_ref)<0);B.length>0&&(o[w]=B),N.length>0&&(v[w]=N)}else o[w]=T}),this.syncDiff(h,{joins:o,leaves:v},n,c)}static syncDiff(t,r,n,c){const{joins:h,leaves:p}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),c||(c=()=>{}),this.map(h,(o,v)=>{var w;const T=(w=t[o])!==null&&w!==void 0?w:[];if(t[o]=this.cloneDeep(v),T.length>0){const M=t[o].map(D=>D.presence_ref),O=T.filter(D=>M.indexOf(D.presence_ref)<0);t[o].unshift(...O)}n(o,T,v)}),this.map(p,(o,v)=>{let w=t[o];if(!w)return;const T=v.map(M=>M.presence_ref);w=w.filter(M=>T.indexOf(M.presence_ref)<0),t[o]=w,c(o,w,v),w.length===0&&delete t[o]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const c=t[n];return"metas"in c?r[n]=c.metas.map(h=>(h.presence_ref=h.phx_ref,delete h.phx_ref,delete h.phx_ref_prev,h)):r[n]=c,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var TV;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(TV||(TV={}));var Eb;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Eb||(Eb={}));var uh;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(uh||(uh={}));class F3{constructor(t,r={config:{}},n){this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=ea.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new dI(this,dc.join,this.params,this.timeout),this.rejoinTimer=new rX(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ea.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ea.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=ea.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ea.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=ea.errored,this.rejoinTimer.scheduleTimeout())}),this._on(dc.reply,{},(c,h)=>{this._trigger(this._replyEventName(h),c)}),this.presence=new Tb(this),this.broadcastEndpointURL=iX(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(t,r=this.timeout){var n,c;if(this.socket.isConnected()||this.socket.connect(),this.state==ea.closed){const{config:{broadcast:h,presence:p,private:o}}=this.params,v=(c=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(O=>O.filter))!==null&&c!==void 0?c:[],w=!!this.bindings[Eb.PRESENCE]&&this.bindings[Eb.PRESENCE].length>0,T={},M={broadcast:h,presence:Object.assign(Object.assign({},p),{enabled:w}),postgres_changes:v,private:o};this.socket.accessTokenValue&&(T.access_token=this.socket.accessTokenValue),this._onError(O=>t?.(uh.CHANNEL_ERROR,O)),this._onClose(()=>t?.(uh.CLOSED)),this.updateJoinPayload(Object.assign({config:M},T)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:O})=>{var D;if(this.socket.setAuth(),O===void 0){t?.(uh.SUBSCRIBED);return}else{const B=this.bindings.postgres_changes,N=(D=B?.length)!==null&&D!==void 0?D:0,G=[];for(let V=0;V<N;V++){const U=B[V],{filter:{event:X,schema:Y,table:ne,filter:se}}=U,le=O&&O[V];if(le&&le.event===X&&le.schema===Y&&le.table===ne&&le.filter===se)G.push(Object.assign(Object.assign({},U),{id:le.id}));else{this.unsubscribe(),this.state=ea.errored,t?.(uh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=G,t&&t(uh.SUBSCRIBED);return}}).receive("error",O=>{this.state=ea.errored,t?.(uh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(O).join(", ")||"error")))}).receive("timeout",()=>{t?.(uh.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===ea.joined&&t===Eb.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async send(t,r={}){var n,c;if(!this._canPush()&&t.type==="broadcast"){const{event:h,payload:p}=t,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:h,payload:p,private:this.private}]})};try{const v=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((c=v.body)===null||c===void 0?void 0:c.cancel()),v.ok?"ok":"error"}catch(v){return v.name==="AbortError"?"timed out":"error"}}else return new Promise(h=>{var p,o,v;const w=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((v=(o=(p=this.params)===null||p===void 0?void 0:p.config)===null||o===void 0?void 0:o.broadcast)===null||v===void 0)&&v.ack)&&h("ok"),w.receive("ok",()=>h("ok")),w.receive("error",()=>h("error")),w.receive("timeout",()=>h("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=ea.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(dc.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(c=>{n=new dI(this,dc.leave,{},t),n.receive("ok",()=>{r(),c("ok")}).receive("timeout",()=>{r(),c("timed out")}).receive("error",()=>{c("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ea.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const c=new AbortController,h=setTimeout(()=>c.abort(),n),p=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:c.signal}));return clearTimeout(h),p}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let c=new dI(this,t,r,n);return this._canPush()?c.send():this._addToPushBuffer(c),c}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Rve){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var c,h;const p=t.toLocaleLowerCase(),{close:o,error:v,leave:w,join:T}=dc;if(n&&[o,v,w,T].indexOf(p)>=0&&n!==this._joinRef())return;let M=this._onMessage(p,r,n);if(r&&!M)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(p)?(c=this.bindings.postgres_changes)===null||c===void 0||c.filter(O=>{var D,B,N;return((D=O.filter)===null||D===void 0?void 0:D.event)==="*"||((N=(B=O.filter)===null||B===void 0?void 0:B.event)===null||N===void 0?void 0:N.toLocaleLowerCase())===p}).map(O=>O.callback(M,n)):(h=this.bindings[p])===null||h===void 0||h.filter(O=>{var D,B,N,G,V,U;if(["broadcast","presence","postgres_changes"].includes(p))if("id"in O){const X=O.id,Y=(D=O.filter)===null||D===void 0?void 0:D.event;return X&&((B=r.ids)===null||B===void 0?void 0:B.includes(X))&&(Y==="*"||Y?.toLocaleLowerCase()===((N=r.data)===null||N===void 0?void 0:N.type.toLocaleLowerCase()))}else{const X=(V=(G=O?.filter)===null||G===void 0?void 0:G.event)===null||V===void 0?void 0:V.toLocaleLowerCase();return X==="*"||X===((U=r?.event)===null||U===void 0?void 0:U.toLocaleLowerCase())}else return O.type.toLocaleLowerCase()===p}).map(O=>{if(typeof M=="object"&&"ids"in M){const D=M.data,{schema:B,table:N,commit_timestamp:G,type:V,errors:U}=D;M=Object.assign(Object.assign({},{schema:B,table:N,commit_timestamp:G,eventType:V,new:{},old:{},errors:U}),this._getPayloadRecords(D))}O.callback(M,n)})}_isClosed(){return this.state===ea.closed}_isJoined(){return this.state===ea.joined}_isJoining(){return this.state===ea.joining}_isLeaving(){return this.state===ea.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const c=t.toLocaleLowerCase(),h={type:c,filter:r,callback:n};return this.bindings[c]?this.bindings[c].push(h):this.bindings[c]=[h],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(c=>{var h;return!(((h=c.type)===null||h===void 0?void 0:h.toLocaleLowerCase())===n&&F3.isEqual(c.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(dc.close,{},t)}_onError(t){this._on(dc.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ea.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=wV(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=wV(t.columns,t.old_record)),r}}const EV=()=>{},UT={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Vve=[1e3,2e3,5e3,1e4],$ve=1e4,Gve=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class qve{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=zj,this.transport=null,this.heartbeatIntervalMs=UT.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=EV,this.ref=0,this.reconnectTimer=null,this.logger=EV,this.conn=null,this.sendBuffer=[],this.serializer=new Dve,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=c=>{let h;return c?h=c:typeof fetch>"u"?h=(...p)=>tv(async()=>{const{default:o}=await Promise.resolve().then(()=>ov);return{default:o}}).then(({default:o})=>o(...p)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):h=fetch,(...p)=>h(...p)},!(!((n=r?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${Nj.websocket}`,this.httpEndpoint=iX(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Pve.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ove}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},t?this.conn.close(t,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Sb.connecting:return Wp.Connecting;case Sb.open:return Wp.Open;case Sb.closing:return Wp.Closing;default:return Wp.Closed}}isConnected(){return this.connectionState()===Wp.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,c=this.getChannels().find(h=>h.topic===n);if(c)return c;{const h=new F3(`realtime:${t}`,r,this);return this.channels.push(h),h}}push(t){const{topic:r,event:n,payload:c,ref:h}=t,p=()=>{this.encode(t,o=>{var v;(v=this.conn)===null||v===void 0||v.send(o)})};this.log("push",`${r} ${n} (${h})`,c),this.isConnected()?p():this.sendBuffer.push(p)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(jve,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},UT.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{r.topic==="phoenix"&&r.event==="phx_reply"&&this.heartbeatCallback(r.payload.status==="ok"?"ok":"error"),r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:c,payload:h,ref:p}=r,o=p?`(${p})`:"",v=h.status||"";this.log("receive",`${v} ${n} ${c} ${o}`.trim(),h),this.channels.filter(w=>w._isMember(n)).forEach(w=>w._trigger(c,h,p)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(dc.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",c=new URLSearchParams(r);return`${t}${n}${c}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([Gve],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const c={access_token:r,version:Ive};r&&n.updateJoinPayload(c),n.joinedOnce&&n._isJoined()&&n._push(dc.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(c){this.log("error",`error in ${t} callback`,c)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new rX(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},UT.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,c,h,p,o,v,w;if(this.transport=(r=t?.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t?.timeout)!==null&&n!==void 0?n:zj,this.heartbeatIntervalMs=(c=t?.heartbeatIntervalMs)!==null&&c!==void 0?c:UT.HEARTBEAT_INTERVAL,this.worker=(h=t?.worker)!==null&&h!==void 0?h:!1,this.accessToken=(p=t?.accessToken)!==null&&p!==void 0?p:null,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(o=t?.reconnectAfterMs)!==null&&o!==void 0?o:T=>Vve[T-1]||$ve,this.encode=(v=t?.encode)!==null&&v!==void 0?v:(T,M)=>M(JSON.stringify(T)),this.decode=(w=t?.decode)!==null&&w!==void 0?w:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}class B3 extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function ta(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class Hve extends B3{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Bj extends B3{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}var Wve=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function o(T){try{w(n.next(T))}catch(M){p(M)}}function v(T){try{w(n.throw(T))}catch(M){p(M)}}function w(T){T.done?h(T.value):c(T.value).then(o,v)}w((n=n.apply(e,[])).next())})};const oX=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>tv(async()=>{const{default:n}=await Promise.resolve().then(()=>ov);return{default:n}}).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},Zve=()=>Wve(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield tv(()=>Promise.resolve().then(()=>ov))).Response:Response}),Uj=e=>{if(Array.isArray(e))return e.map(r=>Uj(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const c=r.replace(/([-_][a-z])/gi,h=>h.toUpperCase().replace(/[-_]/g,""));t[c]=Uj(n)}),t},Kve=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)};var Dm=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function o(T){try{w(n.next(T))}catch(M){p(M)}}function v(T){try{w(n.throw(T))}catch(M){p(M)}}function w(T){T.done?h(T.value):c(T.value).then(o,v)}w((n=n.apply(e,[])).next())})};const fI=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Xve=(e,t,r)=>Dm(void 0,void 0,void 0,function*(){const n=yield Zve();e instanceof n&&!r?.noResolveJson?e.json().then(c=>{const h=e.status||500,p=c?.statusCode||h+"";t(new Hve(fI(c),h,p))}).catch(c=>{t(new Bj(fI(c),c))}):t(new Bj(fI(e),e))}),Yve=(e,t,r,n)=>{const c={method:e,headers:t?.headers||{}};return e==="GET"||!n?c:(Kve(n)?(c.headers=Object.assign({"Content-Type":"application/json"},t?.headers),c.body=JSON.stringify(n)):c.body=n,t?.duplex&&(c.duplex=t.duplex),Object.assign(Object.assign({},c),r))};function r1(e,t,r,n,c,h){return Dm(this,void 0,void 0,function*(){return new Promise((p,o)=>{e(r,Yve(t,n,c,h)).then(v=>{if(!v.ok)throw v;return n?.noResolveJson?v:v.json()}).then(v=>p(v)).catch(v=>Xve(v,o,n))})})}function yE(e,t,r,n){return Dm(this,void 0,void 0,function*(){return r1(e,"GET",t,r,n)})}function uu(e,t,r,n,c){return Dm(this,void 0,void 0,function*(){return r1(e,"POST",t,n,c,r)})}function Vj(e,t,r,n,c){return Dm(this,void 0,void 0,function*(){return r1(e,"PUT",t,n,c,r)})}function Jve(e,t,r,n){return Dm(this,void 0,void 0,function*(){return r1(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function aX(e,t,r,n,c){return Dm(this,void 0,void 0,function*(){return r1(e,"DELETE",t,n,c,r)})}var ds=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function o(T){try{w(n.next(T))}catch(M){p(M)}}function v(T){try{w(n.throw(T))}catch(M){p(M)}}function w(T){T.done?h(T.value):c(T.value).then(o,v)}w((n=n.apply(e,[])).next())})};const Qve={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},AV={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class e0e{constructor(t,r={},n,c){this.url=t,this.headers=r,this.bucketId=n,this.fetch=oX(c)}uploadOrUpdate(t,r,n,c){return ds(this,void 0,void 0,function*(){try{let h;const p=Object.assign(Object.assign({},AV),c);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(p.upsert)});const v=p.metadata;typeof Blob<"u"&&n instanceof Blob?(h=new FormData,h.append("cacheControl",p.cacheControl),v&&h.append("metadata",this.encodeMetadata(v)),h.append("",n)):typeof FormData<"u"&&n instanceof FormData?(h=n,h.append("cacheControl",p.cacheControl),v&&h.append("metadata",this.encodeMetadata(v))):(h=n,o["cache-control"]=`max-age=${p.cacheControl}`,o["content-type"]=p.contentType,v&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),c?.headers&&(o=Object.assign(Object.assign({},o),c.headers));const w=this._removeEmptyFolders(r),T=this._getFinalPath(w),M=yield(t=="PUT"?Vj:uu)(this.fetch,`${this.url}/object/${T}`,h,Object.assign({headers:o},p?.duplex?{duplex:p.duplex}:{}));return{data:{path:w,id:M.Id,fullPath:M.Key},error:null}}catch(h){if(ta(h))return{data:null,error:h};throw h}})}upload(t,r,n){return ds(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,c){return ds(this,void 0,void 0,function*(){const h=this._removeEmptyFolders(t),p=this._getFinalPath(h),o=new URL(this.url+`/object/upload/sign/${p}`);o.searchParams.set("token",r);try{let v;const w=Object.assign({upsert:AV.upsert},c),T=Object.assign(Object.assign({},this.headers),{"x-upsert":String(w.upsert)});typeof Blob<"u"&&n instanceof Blob?(v=new FormData,v.append("cacheControl",w.cacheControl),v.append("",n)):typeof FormData<"u"&&n instanceof FormData?(v=n,v.append("cacheControl",w.cacheControl)):(v=n,T["cache-control"]=`max-age=${w.cacheControl}`,T["content-type"]=w.contentType);const M=yield Vj(this.fetch,o.toString(),v,{headers:T});return{data:{path:h,fullPath:M.Key},error:null}}catch(v){if(ta(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(t,r){return ds(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const c=Object.assign({},this.headers);r?.upsert&&(c["x-upsert"]="true");const h=yield uu(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:c}),p=new URL(this.url+h.url),o=p.searchParams.get("token");if(!o)throw new B3("No token returned by API");return{data:{signedUrl:p.toString(),path:t,token:o},error:null}}catch(n){if(ta(n))return{data:null,error:n};throw n}})}update(t,r,n){return ds(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return ds(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(c){if(ta(c))return{data:null,error:c};throw c}})}copy(t,r,n){return ds(this,void 0,void 0,function*(){try{return{data:{path:(yield uu(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(c){if(ta(c))return{data:null,error:c};throw c}})}createSignedUrl(t,r,n){return ds(this,void 0,void 0,function*(){try{let c=this._getFinalPath(t),h=yield uu(this.fetch,`${this.url}/object/sign/${c}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const p=n?.download?`&download=${n.download===!0?"":n.download}`:"";return h={signedUrl:encodeURI(`${this.url}${h.signedURL}${p}`)},{data:h,error:null}}catch(c){if(ta(c))return{data:null,error:c};throw c}})}createSignedUrls(t,r,n){return ds(this,void 0,void 0,function*(){try{const c=yield uu(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),h=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:c.map(p=>Object.assign(Object.assign({},p),{signedUrl:p.signedURL?encodeURI(`${this.url}${p.signedURL}${h}`):null})),error:null}}catch(c){if(ta(c))return{data:null,error:c};throw c}})}download(t,r){return ds(this,void 0,void 0,function*(){const n=typeof r?.transform<"u"?"render/image/authenticated":"object",c=this.transformOptsToQueryString(r?.transform||{}),h=c?`?${c}`:"";try{const p=this._getFinalPath(t);return{data:yield(yield yE(this.fetch,`${this.url}/${n}/${p}${h}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(p){if(ta(p))return{data:null,error:p};throw p}})}info(t){return ds(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield yE(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:Uj(n),error:null}}catch(n){if(ta(n))return{data:null,error:n};throw n}})}exists(t){return ds(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield Jve(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(ta(n)&&n instanceof Bj){const c=n.originalError;if([400,404].includes(c?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),c=[],h=r?.download?`download=${r.download===!0?"":r.download}`:"";h!==""&&c.push(h);const p=typeof r?.transform<"u"?"render/image":"object",o=this.transformOptsToQueryString(r?.transform||{});o!==""&&c.push(o);let v=c.join("&");return v!==""&&(v=`?${v}`),{data:{publicUrl:encodeURI(`${this.url}/${p}/public/${n}${v}`)}}}remove(t){return ds(this,void 0,void 0,function*(){try{return{data:yield aX(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(ta(r))return{data:null,error:r};throw r}})}list(t,r,n){return ds(this,void 0,void 0,function*(){try{const c=Object.assign(Object.assign(Object.assign({},Qve),r),{prefix:t||""});return{data:yield uu(this.fetch,`${this.url}/object/list/${this.bucketId}`,c,{headers:this.headers},n),error:null}}catch(c){if(ta(c))return{data:null,error:c};throw c}})}listV2(t,r){return ds(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield uu(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(ta(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const t0e="2.11.0",r0e={"X-Client-Info":`storage-js/${t0e}`};var hy=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function o(T){try{w(n.next(T))}catch(M){p(M)}}function v(T){try{w(n.throw(T))}catch(M){p(M)}}function w(T){T.done?h(T.value):c(T.value).then(o,v)}w((n=n.apply(e,[])).next())})};class n0e{constructor(t,r={},n,c){const h=new URL(t);c?.useNewHostname&&/supabase\.(co|in|red)$/.test(h.hostname)&&!h.hostname.includes("storage.supabase.")&&(h.hostname=h.hostname.replace("supabase.","storage.supabase.")),this.url=h.href,this.headers=Object.assign(Object.assign({},r0e),r),this.fetch=oX(n)}listBuckets(){return hy(this,void 0,void 0,function*(){try{return{data:yield yE(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(ta(t))return{data:null,error:t};throw t}})}getBucket(t){return hy(this,void 0,void 0,function*(){try{return{data:yield yE(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(ta(r))return{data:null,error:r};throw r}})}createBucket(t,r={public:!1}){return hy(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ta(n))return{data:null,error:n};throw n}})}updateBucket(t,r){return hy(this,void 0,void 0,function*(){try{return{data:yield Vj(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ta(n))return{data:null,error:n};throw n}})}emptyBucket(t){return hy(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(ta(r))return{data:null,error:r};throw r}})}deleteBucket(t){return hy(this,void 0,void 0,function*(){try{return{data:yield aX(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(ta(r))return{data:null,error:r};throw r}})}}class i0e extends n0e{constructor(t,r={},n,c){super(t,r,n,c)}from(t){return new e0e(this.url,this.headers,t,this.fetch)}}const o0e="2.56.0";let nb="";typeof Deno<"u"?nb="deno":typeof document<"u"?nb="web":typeof navigator<"u"&&navigator.product==="ReactNative"?nb="react-native":nb="node";const a0e={"X-Client-Info":`supabase-js-${nb}/${o0e}`},s0e={headers:a0e},l0e={schema:"public"},c0e={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},u0e={};var h0e=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function o(T){try{w(n.next(T))}catch(M){p(M)}}function v(T){try{w(n.throw(T))}catch(M){p(M)}}function w(T){T.done?h(T.value):c(T.value).then(o,v)}w((n=n.apply(e,[])).next())})};const d0e=e=>{let t;return e?t=e:typeof fetch>"u"?t=qK:t=fetch,(...r)=>t(...r)},f0e=()=>typeof Headers>"u"?HK:Headers,p0e=(e,t,r)=>{const n=d0e(r),c=f0e();return(h,p)=>h0e(void 0,void 0,void 0,function*(){var o;const v=(o=yield t())!==null&&o!==void 0?o:e;let w=new c(p?.headers);return w.has("apikey")||w.set("apikey",e),w.has("Authorization")||w.set("Authorization",`Bearer ${v}`),n(h,Object.assign(Object.assign({},p),{headers:w}))})};var m0e=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function o(T){try{w(n.next(T))}catch(M){p(M)}}function v(T){try{w(n.throw(T))}catch(M){p(M)}}function w(T){T.done?h(T.value):c(T.value).then(o,v)}w((n=n.apply(e,[])).next())})};function g0e(e){return e.endsWith("/")?e:e+"/"}function y0e(e,t){var r,n;const{db:c,auth:h,realtime:p,global:o}=e,{db:v,auth:w,realtime:T,global:M}=t,O={db:Object.assign(Object.assign({},v),c),auth:Object.assign(Object.assign({},w),h),realtime:Object.assign(Object.assign({},T),p),storage:{},global:Object.assign(Object.assign(Object.assign({},M),o),{headers:Object.assign(Object.assign({},(r=M?.headers)!==null&&r!==void 0?r:{}),(n=o?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>m0e(this,void 0,void 0,function*(){return""})};return e.accessToken?O.accessToken=e.accessToken:delete O.accessToken,O}const sX="2.71.1",wy=30*1e3,$j=3,pI=$j*wy,_0e="http://localhost:9999",v0e="supabase.auth.token",x0e={"X-Client-Info":`gotrue-js/${sX}`},Gj="X-Supabase-Api-Version",lX={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},b0e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,w0e=10*60*1e3;class U3 extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function Fn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class S0e extends U3{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function T0e(e){return Fn(e)&&e.name==="AuthApiError"}class cX extends U3{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Sf extends U3{constructor(t,r,n,c){super(t,n,c),this.name=r,this.status=n}}class Ud extends Sf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function E0e(e){return Fn(e)&&e.name==="AuthSessionMissingError"}class VT extends Sf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class $T extends Sf{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class GT extends Sf{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function A0e(e){return Fn(e)&&e.name==="AuthImplicitGrantRedirectError"}class kV extends Sf{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class qj extends Sf{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function mI(e){return Fn(e)&&e.name==="AuthRetryableFetchError"}class CV extends Sf{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class Hj extends Sf{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const _E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),PV=` 	
\r=`.split(""),k0e=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<PV.length;t+=1)e[PV[t].charCodeAt(0)]=-2;for(let t=0;t<_E.length;t+=1)e[_E[t].charCodeAt(0)]=t;return e})();function MV(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(_E[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(_E[n]),t.queuedBits-=6}}function uX(e,t,r){const n=k0e[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function IV(e){const t=[],r=p=>{t.push(String.fromCodePoint(p))},n={utf8seq:0,codepoint:0},c={queue:0,queuedBits:0},h=p=>{M0e(p,n,r)};for(let p=0;p<e.length;p+=1)uX(e.charCodeAt(p),c,h);return t.join("")}function C0e(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function P0e(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const c=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|c)+65536,r+=1}C0e(n,t)}}function M0e(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function I0e(e){const t=[],r={queue:0,queuedBits:0},n=c=>{t.push(c)};for(let c=0;c<e.length;c+=1)uX(e.charCodeAt(c),r,n);return new Uint8Array(t)}function O0e(e){const t=[];return P0e(e,r=>t.push(r)),new Uint8Array(t)}function j0e(e){const t=[],r={queue:0,queuedBits:0},n=c=>{t.push(c)};return e.forEach(c=>MV(c,r,n)),MV(null,r,n),t.join("")}function R0e(e){return Math.round(Date.now()/1e3)+e}function D0e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const ac=()=>typeof window<"u"&&typeof document<"u",Rp={tested:!1,writable:!1},hX=()=>{if(!ac())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Rp.tested)return Rp.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Rp.tested=!0,Rp.writable=!0}catch{Rp.tested=!0,Rp.writable=!1}return Rp.writable};function L0e(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((n,c)=>{t[c]=n})}catch{}return r.searchParams.forEach((n,c)=>{t[c]=n}),t}const dX=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>tv(async()=>{const{default:n}=await Promise.resolve().then(()=>ov);return{default:n}}).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},z0e=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Sy=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Dp=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Fd=async(e,t)=>{await e.removeItem(t)};class fk{constructor(){this.promise=new fk.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}fk.promiseConstructor=Promise;function gI(e){const t=e.split(".");if(t.length!==3)throw new Hj("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!b0e.test(t[r]))throw new Hj("JWT not in base64url format");return{header:JSON.parse(IV(t[0])),payload:JSON.parse(IV(t[1])),signature:I0e(t[2]),raw:{header:t[0],payload:t[1]}}}async function N0e(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function F0e(e,t){return new Promise((r,n)=>{(async()=>{for(let c=0;c<1/0;c++)try{const h=await e(c);if(!t(c,null,h)){r(h);return}}catch(h){if(!t(c,h)){n(h);return}}})()})}function B0e(e){return("0"+e.toString(16)).substr(-2)}function U0e(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let c=0;c<56;c++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,B0e).join("")}async function V0e(e){const t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(c=>String.fromCharCode(c)).join("")}async function $0e(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await V0e(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function dy(e,t,r=!1){const n=U0e();let c=n;r&&(c+="/PASSWORD_RECOVERY"),await Sy(e,`${t}-code-verifier`,c);const h=await $0e(n);return[h,n===h?"plain":"s256"]}const G0e=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function q0e(e){const t=e.headers.get(Gj);if(!t||!t.match(G0e))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function H0e(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function W0e(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Z0e=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function fy(e){if(!Z0e.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function yI(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function OV(e){return JSON.parse(JSON.stringify(e))}var K0e=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(e);c<n.length;c++)t.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(e,n[c])&&(r[n[c]]=e[n[c]]);return r};const Vp=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),X0e=[502,503,504];async function jV(e){var t;if(!z0e(e))throw new qj(Vp(e),0);if(X0e.includes(e.status))throw new qj(Vp(e),e.status);let r;try{r=await e.json()}catch(h){throw new cX(Vp(h),h)}let n;const c=q0e(e);if(c&&c.getTime()>=lX["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new CV(Vp(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new Ud}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((h,p)=>h&&typeof p=="string",!0))throw new CV(Vp(r),e.status,r.weak_password.reasons);throw new S0e(Vp(r),e.status||500,n)}const Y0e=(e,t,r,n)=>{const c={method:e,headers:t?.headers||{}};return e==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),c.body=JSON.stringify(n),Object.assign(Object.assign({},c),r))};async function ai(e,t,r,n){var c;const h=Object.assign({},n?.headers);h[Gj]||(h[Gj]=lX["2024-01-01"].name),n?.jwt&&(h.Authorization=`Bearer ${n.jwt}`);const p=(c=n?.query)!==null&&c!==void 0?c:{};n?.redirectTo&&(p.redirect_to=n.redirectTo);const o=Object.keys(p).length?"?"+new URLSearchParams(p).toString():"",v=await J0e(e,t,r+o,{headers:h,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(v):{data:Object.assign({},v),error:null}}async function J0e(e,t,r,n,c,h){const p=Y0e(t,n,c,h);let o;try{o=await e(r,Object.assign({},p))}catch(v){throw console.error(v),new qj(Vp(v),0)}if(o.ok||await jV(o),n?.noResolveJson)return o;try{return await o.json()}catch(v){await jV(v)}}function lh(e){var t;let r=null;rxe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=R0e(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function RV(e){const t=lh(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Xd(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Q0e(e){return{data:e,error:null}}function exe(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:c,verification_type:h}=e,p=K0e(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:r,hashed_token:n,redirect_to:c,verification_type:h},v=Object.assign({},p);return{data:{properties:o,user:v},error:null}}function txe(e){return e}function rxe(e){return e.access_token&&e.refresh_token&&e.expires_in}const _I=["global","local","others"];var nxe=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(e);c<n.length;c++)t.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(e,n[c])&&(r[n[c]]=e[n[c]]);return r};class ixe{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=dX(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,r=_I[0]){if(_I.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${_I.join(", ")}`);try{return await ai(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Fn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await ai(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Xd})}catch(n){if(Fn(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=nxe(t,["options"]),c=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(c.new_email=n?.newEmail,delete c.newEmail),await ai(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:c,headers:this.headers,xform:exe,redirectTo:r?.redirectTo})}catch(r){if(Fn(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await ai(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Xd})}catch(r){if(Fn(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,c,h,p,o,v;try{const w={nextPage:null,lastPage:0,total:0},T=await ai(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(h=(c=t?.perPage)===null||c===void 0?void 0:c.toString())!==null&&h!==void 0?h:""},xform:txe});if(T.error)throw T.error;const M=await T.json(),O=(p=T.headers.get("x-total-count"))!==null&&p!==void 0?p:0,D=(v=(o=T.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&v!==void 0?v:[];return D.length>0&&(D.forEach(B=>{const N=parseInt(B.split(";")[0].split("=")[1].substring(0,1)),G=JSON.parse(B.split(";")[1].split("=")[1]);w[`${G}Page`]=N}),w.total=parseInt(O)),{data:Object.assign(Object.assign({},M),w),error:null}}catch(w){if(Fn(w))return{data:{users:[]},error:w};throw w}}async getUserById(t){fy(t);try{return await ai(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Xd})}catch(r){if(Fn(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){fy(t);try{return await ai(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Xd})}catch(n){if(Fn(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){fy(t);try{return await ai(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Xd})}catch(n){if(Fn(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){fy(t.userId);try{const{data:r,error:n}=await ai(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:c=>({data:{factors:c},error:null})});return{data:r,error:n}}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async _deleteFactor(t){fy(t.userId),fy(t.id);try{return{data:await ai(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(Fn(r))return{data:null,error:r};throw r}}}function DV(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}function oxe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const py={debug:!!(globalThis&&hX()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class fX extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class axe extends fX{}async function sxe(e,t,r){py.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),py.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async c=>{if(c){py.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,c.name);try{return await r()}finally{py.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,c.name)}}else{if(t===0)throw py.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new axe(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(py.debug)try{const h=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(h,null,"  "))}catch(h){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",h)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}oxe();const lxe={url:_0e,storageKey:v0e,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:x0e,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function LV(e,t,r){return await r()}const my={};class ow{constructor(t){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ow.nextInstanceID,ow.nextInstanceID+=1,this.instanceID>0&&ac()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const c=Object.assign(Object.assign({},lxe),t);if(this.logDebugMessages=!!c.debug,typeof c.debug=="function"&&(this.logger=c.debug),this.persistSession=c.persistSession,this.storageKey=c.storageKey,this.autoRefreshToken=c.autoRefreshToken,this.admin=new ixe({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=dX(c.fetch),this.lock=c.lock||LV,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,c.lock?this.lock=c.lock:ac()&&!((r=globalThis?.navigator)===null||r===void 0)&&r.locks?this.lock=sxe:this.lock=LV,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(c.storage?this.storage=c.storage:hX()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=DV(this.memoryStorage)),c.userStorage&&(this.userStorage=c.userStorage)):(this.memoryStorage={},this.storage=DV(this.memoryStorage)),ac()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(h){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",h)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async h=>{this._debug("received broadcast notification from other tab or client",h),await this._notifyAllSubscribers(h.data.event,h.data.session,!1)})}this.initialize()}get jwks(){var t,r;return(r=(t=my[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){my[this.storageKey]=Object.assign(Object.assign({},my[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=my[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){my[this.storageKey]=Object.assign(Object.assign({},my[this.storageKey]),{cachedAt:t})}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${sX}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const r=L0e(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),ac()&&this.detectSessionInUrl&&n!=="none"){const{data:c,error:h}=await this._getSessionFromURL(r,n);if(h){if(this._debug("#_initialize()","error detecting session from URL",h),A0e(h)){const v=(t=h.details)===null||t===void 0?void 0:t.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:h}}return await this._removeSession(),{error:h}}const{session:p,redirectType:o}=c;return this._debug("#_initialize()","detected session in URL",p,"redirect type",o),await this._saveSession(p),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",p):await this._notifyAllSubscribers("SIGNED_IN",p)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Fn(r)?{error:r}:{error:new cX("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,c;try{const h=await ai(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(c=t?.options)===null||c===void 0?void 0:c.captchaToken}},xform:lh}),{data:p,error:o}=h;if(o||!p)return{data:{user:null,session:null},error:o};const v=p.session,w=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:w,session:v},error:null}}catch(h){if(Fn(h))return{data:{user:null,session:null},error:h};throw h}}async signUp(t){var r,n,c;try{let h;if("email"in t){const{email:T,password:M,options:O}=t;let D=null,B=null;this.flowType==="pkce"&&([D,B]=await dy(this.storage,this.storageKey)),h=await ai(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:O?.emailRedirectTo,body:{email:T,password:M,data:(r=O?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:O?.captchaToken},code_challenge:D,code_challenge_method:B},xform:lh})}else if("phone"in t){const{phone:T,password:M,options:O}=t;h=await ai(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:T,password:M,data:(n=O?.data)!==null&&n!==void 0?n:{},channel:(c=O?.channel)!==null&&c!==void 0?c:"sms",gotrue_meta_security:{captcha_token:O?.captchaToken}},xform:lh})}else throw new $T("You must provide either an email or phone number and a password");const{data:p,error:o}=h;if(o||!p)return{data:{user:null,session:null},error:o};const v=p.session,w=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:w,session:v},error:null}}catch(h){if(Fn(h))return{data:{user:null,session:null},error:h};throw h}}async signInWithPassword(t){try{let r;if("email"in t){const{email:h,password:p,options:o}=t;r=await ai(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:h,password:p,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:RV})}else if("phone"in t){const{phone:h,password:p,options:o}=t;r=await ai(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:h,password:p,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:RV})}else throw new $T("You must provide either an email or phone number and a password");const{data:n,error:c}=r;return c?{data:{user:null,session:null},error:c}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new VT}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:c})}catch(r){if(Fn(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(t){var r,n,c,h;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:(h=t.options)===null||h===void 0?void 0:h.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;if(r==="solana")return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(t){var r,n,c,h,p,o,v,w,T,M,O,D;let B,N;if("message"in t)B=t.message,N=t.signature;else{const{chain:G,wallet:V,statement:U,options:X}=t;let Y;if(ac())if(typeof V=="object")Y=V;else{const se=window;if("solana"in se&&typeof se.solana=="object"&&("signIn"in se.solana&&typeof se.solana.signIn=="function"||"signMessage"in se.solana&&typeof se.solana.signMessage=="function"))Y=se.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof V!="object"||!X?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Y=V}const ne=new URL((r=X?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in Y&&Y.signIn){const se=await Y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},X?.signInWithSolana),{version:"1",domain:ne.host,uri:ne.href}),U?{statement:U}:null));let le;if(Array.isArray(se)&&se[0]&&typeof se[0]=="object")le=se[0];else if(se&&typeof se=="object"&&"signedMessage"in se&&"signature"in se)le=se;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in le&&"signature"in le&&(typeof le.signedMessage=="string"||le.signedMessage instanceof Uint8Array)&&le.signature instanceof Uint8Array)B=typeof le.signedMessage=="string"?le.signedMessage:new TextDecoder().decode(le.signedMessage),N=le.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Y)||typeof Y.signMessage!="function"||!("publicKey"in Y)||typeof Y!="object"||!Y.publicKey||!("toBase58"in Y.publicKey)||typeof Y.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");B=[`${ne.host} wants you to sign in with your Solana account:`,Y.publicKey.toBase58(),...U?["",U,""]:[""],"Version: 1",`URI: ${ne.href}`,`Issued At: ${(c=(n=X?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&c!==void 0?c:new Date().toISOString()}`,...!((h=X?.signInWithSolana)===null||h===void 0)&&h.notBefore?[`Not Before: ${X.signInWithSolana.notBefore}`]:[],...!((p=X?.signInWithSolana)===null||p===void 0)&&p.expirationTime?[`Expiration Time: ${X.signInWithSolana.expirationTime}`]:[],...!((o=X?.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${X.signInWithSolana.chainId}`]:[],...!((v=X?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${X.signInWithSolana.nonce}`]:[],...!((w=X?.signInWithSolana)===null||w===void 0)&&w.requestId?[`Request ID: ${X.signInWithSolana.requestId}`]:[],...!((M=(T=X?.signInWithSolana)===null||T===void 0?void 0:T.resources)===null||M===void 0)&&M.length?["Resources",...X.signInWithSolana.resources.map(le=>`- ${le}`)]:[]].join(`
`);const se=await Y.signMessage(new TextEncoder().encode(B),"utf8");if(!se||!(se instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=se}}try{const{data:G,error:V}=await ai(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:B,signature:j0e(N)},!((O=t.options)===null||O===void 0)&&O.captchaToken?{gotrue_meta_security:{captcha_token:(D=t.options)===null||D===void 0?void 0:D.captchaToken}}:null),xform:lh});if(V)throw V;return!G||!G.session||!G.user?{data:{user:null,session:null},error:new VT}:(G.session&&(await this._saveSession(G.session),await this._notifyAllSubscribers("SIGNED_IN",G.session)),{data:Object.assign({},G),error:V})}catch(G){if(Fn(G))return{data:{user:null,session:null},error:G};throw G}}async _exchangeCodeForSession(t){const r=await Dp(this.storage,`${this.storageKey}-code-verifier`),[n,c]=(r??"").split("/");try{const{data:h,error:p}=await ai(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:lh});if(await Fd(this.storage,`${this.storageKey}-code-verifier`),p)throw p;return!h||!h.session||!h.user?{data:{user:null,session:null,redirectType:null},error:new VT}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:Object.assign(Object.assign({},h),{redirectType:c??null}),error:p})}catch(h){if(Fn(h))return{data:{user:null,session:null,redirectType:null},error:h};throw h}}async signInWithIdToken(t){try{const{options:r,provider:n,token:c,access_token:h,nonce:p}=t,o=await ai(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:c,access_token:h,nonce:p,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:lh}),{data:v,error:w}=o;return w?{data:{user:null,session:null},error:w}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new VT}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:w})}catch(r){if(Fn(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(t){var r,n,c,h,p;try{if("email"in t){const{email:o,options:v}=t;let w=null,T=null;this.flowType==="pkce"&&([w,T]=await dy(this.storage,this.storageKey));const{error:M}=await ai(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=v?.data)!==null&&r!==void 0?r:{},create_user:(n=v?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:w,code_challenge_method:T},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:M}}if("phone"in t){const{phone:o,options:v}=t,{data:w,error:T}=await ai(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(c=v?.data)!==null&&c!==void 0?c:{},create_user:(h=v?.shouldCreateUser)!==null&&h!==void 0?h:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(p=v?.channel)!==null&&p!==void 0?p:"sms"}});return{data:{user:null,session:null,messageId:w?.message_id},error:T}}throw new $T("You must provide either an email or phone number.")}catch(o){if(Fn(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var r,n;try{let c,h;"options"in t&&(c=(r=t.options)===null||r===void 0?void 0:r.redirectTo,h=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:p,error:o}=await ai(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:h}}),redirectTo:c,xform:lh});if(o)throw o;if(!p)throw new Error("An error occurred on token verification.");const v=p.session,w=p.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:w,session:v},error:null}}catch(c){if(Fn(c))return{data:{user:null,session:null},error:c};throw c}}async signInWithSSO(t){var r,n,c;try{let h=null,p=null;return this.flowType==="pkce"&&([h,p]=await dy(this.storage,this.storageKey)),await ai(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((c=t?.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:p}),headers:this.headers,xform:Q0e})}catch(h){if(Fn(h))return{data:null,error:h};throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new Ud;const{error:c}=await ai(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:c}})}catch(t){if(Fn(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:c,options:h}=t,{error:p}=await ai(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:c,gotrue_meta_security:{captcha_token:h?.captchaToken}},redirectTo:h?.emailRedirectTo});return{data:{user:null,session:null},error:p}}else if("phone"in t){const{phone:n,type:c,options:h}=t,{data:p,error:o}=await ai(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:c,gotrue_meta_security:{captcha_token:h?.captchaToken}}});return{data:{user:null,session:null,messageId:p?.message_id},error:o}}throw new $T("You must provide either an email or phone number and a type")}catch(r){if(Fn(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await c}catch{}})()),c}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const c=[...this.pendingInLock];await Promise.all(c),this.pendingInLock.splice(0,c.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Dp(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<pI:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const p=await Dp(this.userStorage,this.storageKey+"-user");p?.user?t.user=p.user:t.user=yI()}if(this.storage.isServer&&t.user){let p=this.suppressGetSessionWarning;t=new Proxy(t,{get:(o,v,w)=>(!p&&v==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),p=!0,this.suppressGetSessionWarning=!0),Reflect.get(o,v,w))})}return{data:{session:t},error:null}}const{session:c,error:h}=await this._callRefreshToken(t.refresh_token);return h?{data:{session:null},error:h}:{data:{session:c},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await ai(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Xd}):await this._useSession(async r=>{var n,c,h;const{data:p,error:o}=r;if(o)throw o;return!(!((n=p.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ud}:await ai(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(h=(c=p.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0,xform:Xd})})}catch(r){if(Fn(r))return E0e(r)&&(await this._removeSession(),await Fd(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:c,error:h}=n;if(h)throw h;if(!c.session)throw new Ud;const p=c.session;let o=null,v=null;this.flowType==="pkce"&&t.email!=null&&([o,v]=await dy(this.storage,this.storageKey));const{data:w,error:T}=await ai(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:v}),jwt:p.access_token,xform:Xd});if(T)throw T;return p.user=w.user,await this._saveSession(p),await this._notifyAllSubscribers("USER_UPDATED",p),{data:{user:p.user},error:null}})}catch(n){if(Fn(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ud;const r=Date.now()/1e3;let n=r,c=!0,h=null;const{payload:p}=gI(t.access_token);if(p.exp&&(n=p.exp,c=n<=r),c){const{session:o,error:v}=await this._callRefreshToken(t.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!o)return{data:{user:null,session:null},error:null};h=o}else{const{data:o,error:v}=await this._getUser(t.access_token);if(v)throw v;h={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(h),await this._notifyAllSubscribers("SIGNED_IN",h)}return{data:{user:h.user,session:h},error:null}}catch(r){if(Fn(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:p,error:o}=r;if(o)throw o;t=(n=p.session)!==null&&n!==void 0?n:void 0}if(!t?.refresh_token)throw new Ud;const{session:c,error:h}=await this._callRefreshToken(t.refresh_token);return h?{data:{user:null,session:null},error:h}:c?{data:{user:c.user,session:c},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Fn(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(t,r){try{if(!ac())throw new GT("No browser detected.");if(t.error||t.error_description||t.error_code)throw new GT(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new kV("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new GT("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new kV("No code detected.");const{data:U,error:X}=await this._exchangeCodeForSession(t.code);if(X)throw X;const Y=new URL(window.location.href);return Y.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Y.toString()),{data:{session:U.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:c,access_token:h,refresh_token:p,expires_in:o,expires_at:v,token_type:w}=t;if(!h||!o||!p||!w)throw new GT("No session defined in URL");const T=Math.round(Date.now()/1e3),M=parseInt(o);let O=T+M;v&&(O=parseInt(v));const D=O-T;D*1e3<=wy&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${D}s, should have been closer to ${M}s`);const B=O-M;T-B>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",B,O,T):T-B<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",B,O,T);const{data:N,error:G}=await this._getUser(h);if(G)throw G;const V={provider_token:n,provider_refresh_token:c,access_token:h,expires_in:M,expires_at:O,refresh_token:p,token_type:w,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:V,redirectType:t.type},error:null}}catch(n){if(Fn(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Dp(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:c,error:h}=r;if(h)return{error:h};const p=(n=c.session)===null||n===void 0?void 0:n.access_token;if(p){const{error:o}=await this.admin.signOut(p,t);if(o&&!(T0e(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return t!=="others"&&(await this._removeSession(),await Fd(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const r=D0e(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,c;try{const{data:{session:h},error:p}=r;if(p)throw p;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",h)),this._debug("INITIAL_SESSION","callback id",t,"session",h)}catch(h){await((c=this.stateChangeEmitters.get(t))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",h),console.error(h)}})}async resetPasswordForEmail(t,r={}){let n=null,c=null;this.flowType==="pkce"&&([n,c]=await dy(this.storage,this.storageKey,!0));try{return await ai(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:c,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(h){if(Fn(h))return{data:null,error:h};throw h}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async linkIdentity(t){var r;try{const{data:n,error:c}=await this._useSession(async h=>{var p,o,v,w,T;const{data:M,error:O}=h;if(O)throw O;const D=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(p=t.options)===null||p===void 0?void 0:p.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(v=t.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await ai(this.fetch,"GET",D,{headers:this.headers,jwt:(T=(w=M.session)===null||w===void 0?void 0:w.access_token)!==null&&T!==void 0?T:void 0})});if(c)throw c;return ac()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:t.provider,url:n?.url},error:null}}catch(n){if(Fn(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,c;const{data:h,error:p}=r;if(p)throw p;return await ai(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(c=(n=h.session)===null||n===void 0?void 0:n.access_token)!==null&&c!==void 0?c:void 0})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await F0e(async c=>(c>0&&await N0e(200*Math.pow(2,c-1)),this._debug(r,"refreshing attempt",c),await ai(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:lh})),(c,h)=>{const p=200*Math.pow(2,c);return h&&mI(h)&&Date.now()+p-n<wy})}catch(n){if(this._debug(r,"error",n),Fn(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),ac()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const c=await Dp(this.storage,this.storageKey);if(c&&this.userStorage){let p=await Dp(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!p&&(p={user:c.user},await Sy(this.userStorage,this.storageKey+"-user",p)),c.user=(t=p?.user)!==null&&t!==void 0?t:yI()}else if(c&&!c.user&&!c.user){const p=await Dp(this.storage,this.storageKey+"-user");p&&p?.user?(c.user=p.user,await Fd(this.storage,this.storageKey+"-user"),await Sy(this.storage,this.storageKey,c)):c.user=yI()}if(this._debug(n,"session from storage",c),!this._isValidSession(c)){this._debug(n,"session is not valid"),c!==null&&await this._removeSession();return}const h=((r=c.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<pI;if(this._debug(n,`session has${h?"":" not"} expired with margin of ${pI}s`),h){if(this.autoRefreshToken&&c.refresh_token){const{error:p}=await this._callRefreshToken(c.refresh_token);p&&(console.error(p),mI(p)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",p),await this._removeSession()))}}else if(c.user&&c.user.__isUserNotAvailableProxy===!0)try{const{data:p,error:o}=await this._getUser(c.access_token);!o&&p?.user?(c.user=p.user,await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(p){console.error("Error getting user data:",p),this._debug(n,"error getting user data, skipping SIGNED_IN notification",p)}else await this._notifyAllSubscribers("SIGNED_IN",c)}catch(c){this._debug(n,"error",c),console.error(c);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new Ud;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const c=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(c,"begin");try{this.refreshingDeferred=new fk;const{data:h,error:p}=await this._refreshAccessToken(t);if(p)throw p;if(!h.session)throw new Ud;await this._saveSession(h.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",h.session);const o={session:h.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(h){if(this._debug(c,"error",h),Fn(h)){const p={session:null,error:h};return mI(h)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(p),p}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(h),h}finally{this.refreshingDeferred=null,this._debug(c,"end")}}async _notifyAllSubscribers(t,r,n=!0){const c=`#_notifyAllSubscribers(${t})`;this._debug(c,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const h=[],p=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,r)}catch(v){h.push(v)}});if(await Promise.all(p),h.length>0){for(let o=0;o<h.length;o+=1)console.error(h[o]);throw h[0]}}finally{this._debug(c,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Sy(this.userStorage,this.storageKey+"-user",{user:r.user});const c=Object.assign({},r);delete c.user;const h=OV(c);await Sy(this.storage,this.storageKey,h)}else{const c=OV(r);await Sy(this.storage,this.storageKey,c)}}async _removeSession(){this._debug("#_removeSession()"),await Fd(this.storage,this.storageKey),await Fd(this.storage,this.storageKey+"-code-verifier"),await Fd(this.storage,this.storageKey+"-user"),this.userStorage&&await Fd(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ac()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),wy);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const c=Math.floor((n.expires_at*1e3-t)/wy);this._debug("#_autoRefreshTokenTick()",`access token expires in ${c} ticks, a tick lasts ${wy}ms, refresh threshold is ${$j} ticks`),c<=$j&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof fX)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ac()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const c=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&c.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&c.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[h,p]=await dy(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(h)}`,code_challenge_method:`${encodeURIComponent(p)}`});c.push(o.toString())}if(n?.queryParams){const h=new URLSearchParams(n.queryParams);c.push(h.toString())}return n?.skipBrowserRedirect&&c.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${c.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:c,error:h}=r;return h?{data:null,error:h}:await ai(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=c?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,c;const{data:h,error:p}=r;if(p)return{data:null,error:p};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:v,error:w}=await ai(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=h?.session)===null||n===void 0?void 0:n.access_token});return w?{data:null,error:w}:(t.factorType==="totp"&&!((c=v?.totp)===null||c===void 0)&&c.qr_code&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:c,error:h}=r;if(h)return{data:null,error:h};const{data:p,error:o}=await ai(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(n=c?.session)===null||n===void 0?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+p.expires_in},p)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",p),{data:p,error:o})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:c,error:h}=r;return h?{data:null,error:h}:await ai(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(n=c?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Fn(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=t?.factors||[],c=n.filter(p=>p.factor_type==="totp"&&p.status==="verified"),h=n.filter(p=>p.factor_type==="phone"&&p.status==="verified");return{data:{all:n,totp:c,phone:h},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var r,n;const{data:{session:c},error:h}=t;if(h)return{data:null,error:h};if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:p}=gI(c.access_token);let o=null;p.aal&&(o=p.aal);let v=o;((n=(r=c.user.factors)===null||r===void 0?void 0:r.filter(T=>T.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(v="aal2");const w=p.amr||[];return{data:{currentLevel:o,nextLevel:v,currentAuthenticationMethods:w},error:null}}))}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(o=>o.kid===t);if(n)return n;const c=Date.now();if(n=this.jwks.keys.find(o=>o.kid===t),n&&this.jwks_cached_at+w0e>c)return n;const{data:h,error:p}=await ai(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(p)throw p;return!h.keys||h.keys.length===0||(this.jwks=h,this.jwks_cached_at=c,n=h.keys.find(o=>o.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:O,error:D}=await this.getSession();if(D||!O.session)return{data:null,error:D};n=O.session.access_token}const{header:c,payload:h,signature:p,raw:{header:o,payload:v}}=gI(n);r?.allowExpired||H0e(h.exp);const w=!c.alg||c.alg.startsWith("HS")||!c.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(c.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!w){const{error:O}=await this.getUser(n);if(O)throw O;return{data:{claims:h,header:c,signature:p},error:null}}const T=W0e(c.alg),M=await crypto.subtle.importKey("jwk",w,T,!0,["verify"]);if(!await crypto.subtle.verify(T,M,p,O0e(`${o}.${v}`)))throw new Hj("Invalid JWT signature");return{data:{claims:h,header:c,signature:p},error:null}}catch(n){if(Fn(n))return{data:null,error:n};throw n}}}ow.nextInstanceID=0;const cxe=ow;class uxe extends cxe{constructor(t){super(t)}}var hxe=function(e,t,r,n){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function o(T){try{w(n.next(T))}catch(M){p(M)}}function v(T){try{w(n.throw(T))}catch(M){p(M)}}function w(T){T.done?h(T.value):c(T.value).then(o,v)}w((n=n.apply(e,[])).next())})};class dxe{constructor(t,r,n){var c,h,p;if(this.supabaseUrl=t,this.supabaseKey=r,!t)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const o=g0e(t),v=new URL(o);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const w=`sb-${v.hostname.split(".")[0]}-auth-token`,T={db:l0e,realtime:u0e,auth:Object.assign(Object.assign({},c0e),{storageKey:w}),global:s0e},M=y0e(n??{},T);this.storageKey=(c=M.auth.storageKey)!==null&&c!==void 0?c:"",this.headers=(h=M.global.headers)!==null&&h!==void 0?h:{},M.accessToken?(this.accessToken=M.accessToken,this.auth=new Proxy({},{get:(O,D)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(D)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((p=M.auth)!==null&&p!==void 0?p:{},this.headers,M.global.fetch),this.fetch=p0e(r,this._getAccessToken.bind(this),M.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},M.realtime)),this.rest=new Cve(new URL("rest/v1",v).href,{headers:this.headers,schema:M.db.schema,fetch:this.fetch}),this.storage=new i0e(this.storageUrl.href,this.headers,this.fetch,n?.storage),M.accessToken||this._listenForAuthEvents()}get functions(){return new ave(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,r;return hxe(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:c,storageKey:h,flowType:p,lock:o,debug:v},w,T){const M={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new uxe({url:this.authUrl.href,headers:Object.assign(Object.assign({},M),w),storageKey:h,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:c,flowType:p,lock:o,debug:v,fetch:T,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new qve(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const fxe=(e,t,r)=>new dxe(e,t,r);function pxe(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}pxe()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const mxe="https://zfeqsdtddvelapbrwlol.supabase.co",gxe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmZXFzZHRkZHZlbGFwYnJ3bG9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3Njk1NzIsImV4cCI6MjA3MDM0NTU3Mn0.EhgHQSRum7-ZglFq1aAl7vPMM_c0i54gs5eD1fN03UU",gn=fxe(mxe,gxe,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),yxe=({preschool:e,onClose:t,onViewDetails:r,nationalAverage:n})=>{const[c,h]=Z.useState([]),[p,o]=Z.useState(null),[v,w]=Z.useState(null),[T,M]=Z.useState(!1),[O,D]=Z.useState(0),B=Z.useRef(new Map);Z.useEffect(()=>{N(),G()},[e.id]);const N=async()=>{try{const U=B.current.get(e.id);if(U){h(U);return}const{data:X,error:Y}=await gn.from("preschool_images").select("image_url").eq("preschool_id",e.id).eq("image_type","google_places").limit(2).order("created_at");if(!Y&&X&&X.length>0){const ne=X.map(se=>se.image_url);B.current.set(e.id,ne),h(ne);return}if(e.latitud&&e.longitud)try{const{data:ne,error:se}=await gn.functions.invoke("google-places-enricher",{body:{preschoolId:e.id,lat:e.latitud,lng:e.longitud,address:e.adress,name:e.namn}});if(!se&&ne?.success){const{data:le}=await gn.from("preschool_images").select("image_url").eq("preschool_id",e.id).eq("image_type","google_places").limit(2).order("created_at");if(le&&le.length>0){const ge=le.map(je=>je.image_url);B.current.set(e.id,ge),h(ge)}}}catch(ne){console.error("Google Places enricher error:",ne)}}catch(U){console.error("Error fetching images:",U)}},G=async()=>{if(!(!e.latitud||!e.longitud)){M(!0),w(null);try{const{data:U,error:X}=await gn.functions.invoke("street-view-generator",{body:{lat:e.latitud,lng:e.longitud,size:"400x200"}});if(X)throw X;if(U?.success&&U?.data?.static_url)o(U.data.static_url);else throw new Error("No street view available")}catch(U){console.error("Street view error:",U),w("Gatuvy ej tillgänglig"),O<2&&setTimeout(()=>{D(X=>X+1),G()},1e3)}finally{M(!1)}}},V=(U,X,Y=!0)=>{const ne=U-X,se=ne/X*100;if(Math.abs(se)<5)return null;const le=Y?ne>0:ne<0;return C.jsxs(sn,{variant:le?"default":"secondary",className:"text-xs ml-1",children:[le?"↑":"↓"," ",Math.abs(se).toFixed(0),"%"]})};return C.jsx(rve,{onClickOutside:t,children:C.jsx(Fr.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.2},className:"fixed left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md mx-4",children:C.jsxs(kn,{className:"bg-card/95 backdrop-blur-sm border-border/50 shadow-lg",children:[C.jsxs("div",{className:"p-4 border-b border-border",children:[C.jsxs("div",{className:"flex items-start justify-between",children:[C.jsxs("div",{className:"flex-1",children:[C.jsx("h3",{className:"font-semibold text-lg text-foreground",children:e.namn}),C.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[C.jsx(sn,{variant:"outline",className:"text-xs",children:e.huvudman==="Enskild"?"Fristående":e.huvudman}),e.google_rating&&e.google_rating>=4.5&&C.jsx(sn,{variant:"default",className:"text-xs",children:"Toppenbetyg"})]})]}),C.jsx(qr,{onClick:t,variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:C.jsx(Qa,{className:"h-4 w-4"})})]}),e.google_rating&&C.jsx("div",{className:"mt-3",children:C.jsx(tve,{rating:e.google_rating,reviewCount:e.google_reviews_count||0,size:"sm"})})]}),C.jsxs("div",{className:"p-4 space-y-4",children:[p&&C.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-muted",children:[C.jsx("img",{src:p,alt:`Gatuvy för ${e.namn}`,className:"w-full h-24 object-cover cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>window.open(`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${e.latitud},${e.longitud}`,"_blank"),loading:"lazy"}),C.jsx("div",{className:"absolute top-2 right-2",children:C.jsxs(sn,{variant:"secondary",className:"text-xs bg-black/50 text-white border-none",children:[C.jsx($L,{className:"w-3 h-3 mr-1"}),"Gatuvy"]})})]}),T&&C.jsx("div",{className:"h-24 bg-muted rounded-lg flex items-center justify-center",children:C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[C.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-primary border-t-transparent rounded-full"}),"Laddar gatuvy..."]})}),v&&!p&&!T&&C.jsx("div",{className:"h-16 bg-muted rounded-lg flex items-center justify-center",children:C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-xs",children:[C.jsx(Bce,{className:"w-3 h-3"}),v]})}),C.jsxs("div",{className:"flex items-start gap-3",children:[C.jsx(Ws,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),C.jsxs("div",{className:"flex-1",children:[C.jsx("p",{className:"text-sm font-medium",children:e.adress}),C.jsx("p",{className:"text-xs text-muted-foreground",children:e.kommun})]})]}),c.length>0&&C.jsxs("div",{className:"mb-4",children:[C.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[C.jsx(Nce,{className:"w-4 h-4 text-muted-foreground"}),C.jsx("span",{className:"text-sm font-medium",children:"Bilder"})]}),C.jsx("div",{className:"grid grid-cols-2 gap-2",children:c.map((U,X)=>C.jsx("img",{src:U,alt:`${e.namn} bild ${X+1}`,className:"w-full h-20 object-cover rounded-md hover:scale-105 transition-transform duration-200 cursor-pointer",loading:"lazy",onClick:r},X))})]}),C.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(Rm,{className:"h-4 w-4 text-primary"}),C.jsxs("div",{className:"flex-1",children:[C.jsx("p",{className:"text-sm font-medium",children:e.antal_barn||"N/A"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Barn"}),n&&e.antal_barn&&V(e.antal_barn,n.avgChildren)]})]}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(bs,{className:"h-4 w-4 text-primary"}),C.jsxs("div",{className:"flex-1",children:[C.jsx("p",{className:"text-sm font-medium",children:e.personaltäthet?e.personaltäthet.toFixed(1):"N/A"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Personal"}),n&&e.personaltäthet&&V(e.personaltäthet,n.avgStaff,!1)]})]}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(BL,{className:"h-4 w-4 text-primary"}),C.jsxs("div",{className:"flex-1",children:[C.jsx("p",{className:"text-sm font-medium",children:e.andel_med_förskollärarexamen?`${e.andel_med_förskollärarexamen}%`:"N/A"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Lärarexamen"}),n&&e.andel_med_förskollärarexamen&&V(e.andel_med_förskollärarexamen,n.avgTeacherExam)]})]}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(jm,{className:"h-4 w-4 text-primary"}),C.jsxs("div",{className:"flex-1",children:[C.jsx("p",{className:"text-sm font-medium",children:e.antal_barngrupper}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Grupper"})]})]})]}),C.jsxs("div",{className:"flex gap-2 pt-2",children:[C.jsx(qr,{onClick:r,className:"flex-1",variant:"default",size:"sm",children:"Mer detaljer"}),C.jsx(qr,{onClick:()=>window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${e.adress}, ${e.kommun}`)}`,"_blank"),variant:"outline",size:"sm",children:"Vägbeskrivning"})]})]})]})})})};class pX{static async request(t){try{console.log(`🌐 API Manager: ${t.type} request to ${t.endpoint}`);const{data:r,error:n}=await gn.functions.invoke(this.FUNCTION_URL,{body:t});return n?(console.error("API Manager function error:",n),{success:!1,error:n.message}):(r.cached&&console.log(`📦 Using cached response for ${t.type}:${t.endpoint}`),r)}catch(r){return console.error("API Manager client error:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}static async googlePlaces(t,r,n=3600){return this.request({type:"google_places",endpoint:t,params:r,cache_duration:n})}static async googleMaps(t,r,n=3600){return this.request({type:"google_maps",endpoint:t,params:r,cache_duration:n})}static async mapbox(t,r,n=1800){return this.request({type:"mapbox",endpoint:t,params:r,cache_duration:n})}static async streetView(t,r,n=7200){return this.request({type:"street_view",endpoint:t,params:r,cache_duration:n})}static async enrichPreschool(t,r,n,c,h,p=0){try{console.log(`🏫 Enriching preschool ${t}: ${h}`);const{data:o,error:v}=await gn.functions.invoke("google-places-enricher",{body:{preschoolId:t,lat:r,lng:n,address:c,name:h,priority:p}});return v?(console.error("Preschool enrichment error:",v),{success:!1,error:v.message}):(console.log(`✅ Successfully enriched preschool ${t}`),o)}catch(o){return console.error("Preschool enrichment client error:",o),{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}static async downloadImages(t,r,n="google_places"){try{console.log(`🖼️  Downloading ${r.length} images for preschool ${t}`);const{data:c,error:h}=await gn.functions.invoke("image-downloader",{body:{preschool_id:t,images:r,image_type:n}});return h?(console.error("Image download error:",h),{success:!1,error:h.message}):(console.log(`✅ Successfully downloaded ${c.success_count}/${c.processed_count} images for preschool ${t}`),c)}catch(c){return console.error("Image download client error:",c),{success:!1,error:c instanceof Error?c.message:"Unknown error"}}}static async clearExpiredCache(){try{const{error:t}=await gn.from("api_cache").delete().lt("expires_at",new Date().toISOString());return t?(console.error("Cache cleanup error:",t),{success:!1,error:t.message}):(console.log("✅ Cleared expired cache entries"),{success:!0})}catch(t){return console.error("Cache cleanup client error:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}static async getCacheStats(){try{const{data:t,error:r}=await gn.from("api_cache").select("api_type, count(*)").gte("expires_at",new Date().toISOString());return r?(console.error("Cache stats error:",r),{success:!1,error:r.message}):{success:!0,data:t.reduce((n,c)=>(n[c.api_type]=c.count,n),{})}}catch(t){return console.error("Cache stats client error:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}}ab(pX,"FUNCTION_URL","api-manager");class _xe{constructor(){ab(this,"cache",new Map),ab(this,"CACHE_DURATION",5*60*1e3),ab(this,"STORAGE_KEY","preschool_cluster_cache"),this.loadFromStorage()}getCacheKey(t){return`zoom_${Math.round(t*2)/2}`}saveClusterState(t,r){const n=this.getCacheKey(t),c={zoom:t,clusters:r,timestamp:Date.now()};this.cache.set(n,c),this.saveToStorage(),console.log(`💾 Saved cluster cache for zoom ${t} with ${r.length} clusters`)}getClusterState(t){const r=this.getCacheKey(t),n=this.cache.get(r);return n?Date.now()-n.timestamp>this.CACHE_DURATION?(this.cache.delete(r),null):(console.log(`📦 Using cached clusters for zoom ${t}: ${n.clusters.length} clusters`),n):null}generateSwedishClusterApproximation(){return[{center:[18.0686,59.3293],count:850,bounds:{north:59.5,south:59.1,east:18.3,west:17.8},averageRating:4.2,totalChildren:12500,timestamp:Date.now()},{center:[11.9746,57.7089],count:420,bounds:{north:57.9,south:57.5,east:12.2,west:11.7},averageRating:4.1,totalChildren:6800,timestamp:Date.now()},{center:[13.0034,55.605],count:280,bounds:{north:55.8,south:55.4,east:13.3,west:12.7},averageRating:4,totalChildren:4200,timestamp:Date.now()},{center:[17.6389,59.8585],count:180,bounds:{north:60,south:59.7,east:17.9,west:17.4},averageRating:4.3,totalChildren:2800,timestamp:Date.now()},{center:[15.6214,58.4108],count:140,bounds:{north:58.6,south:58.2,east:15.9,west:15.3},averageRating:4.2,totalChildren:2100,timestamp:Date.now()},{center:[15.2066,59.2741],count:120,bounds:{north:59.4,south:59.1,east:15.5,west:14.9},averageRating:4.1,totalChildren:1900,timestamp:Date.now()},{center:[20.263,63.8258],count:85,bounds:{north:64,south:63.6,east:20.5,west:20},averageRating:4,totalChildren:1400,timestamp:Date.now()},{center:[16.5,60.6],count:95,bounds:{north:60.8,south:60.4,east:16.8,west:16.2},averageRating:4.1,totalChildren:1500,timestamp:Date.now()},{center:[14.8,56.9],count:165,bounds:{north:57.2,south:56.6,east:15.2,west:14.4},averageRating:4,totalChildren:2600,timestamp:Date.now()},{center:[13.5,59.4],count:110,bounds:{north:59.7,south:59.1,east:13.8,west:13.2},averageRating:4.1,totalChildren:1800,timestamp:Date.now()},{center:[17.3,62.4],count:75,bounds:{north:62.6,south:62.2,east:17.6,west:17},averageRating:4,totalChildren:1200,timestamp:Date.now()},{center:[22.15,65.58],count:65,bounds:{north:65.8,south:65.3,east:22.5,west:21.8},averageRating:4.2,totalChildren:1e3,timestamp:Date.now()}]}saveToStorage(){try{const t=Array.from(this.cache.entries());localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(t){console.warn("Failed to save cluster cache to storage:",t)}}loadFromStorage(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(t){const r=JSON.parse(t);this.cache=new Map(r),console.log(`📂 Loaded cluster cache with ${this.cache.size} entries`)}}catch(t){console.warn("Failed to load cluster cache from storage:",t)}}clearCache(){this.cache.clear(),localStorage.removeItem(this.STORAGE_KEY),console.log("🗑️ Cleared all cluster cache")}getCacheStats(){let t=0,r=Date.now();return this.cache.forEach(n=>{t+=n.clusters.length,n.timestamp<r&&(r=n.timestamp)}),{entries:this.cache.size,totalClusters:t,oldestEntry:r}}}const Fx=new _xe;function V3(e,t){const[r,n]=Z.useState(e);return Z.useEffect(()=>{const c=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(c)}},[e,t]),r}const vxe=e=>{const{updateVisiblePreschoolsFromViewport:t}=vo(),r=Z.useRef(0),n=Z.useRef(),c=Z.useCallback(()=>{if(!e)return;const p=Date.now();if(p-r.current<100)return;const o=e.getBounds();t({north:o.getNorth(),south:o.getSouth(),east:o.getEast(),west:o.getWest()}),r.current=p},[e,t]),h=V3(c,150);return Z.useEffect(()=>{if(!e)return;const p=()=>{n.current&&clearTimeout(n.current),c()},o=()=>{h()},v=()=>{c()};return e.on("moveend",p),e.on("move",o),e.on("zoomend",v),c(),()=>{e.off("moveend",p),e.off("move",o),e.off("zoomend",v),n.current&&clearTimeout(n.current)}},[e,c,h]),{updateViewport:c}},xxe="pk.eyJ1Ijoic2tvZ3N0YWRpc2FrIiwiYSI6ImNtY3BhaXRpMjA0ZGcycHBqNHM4dmlwOW0ifQ.KKHGGPnrZVjNjDdITF-_bw";E2.accessToken=xxe;const bxe=({className:e})=>{const t=Z.useRef(null),r=Z.useRef(null),[n,c]=Z.useState(!0),[h,p]=Z.useState(!1),[o,v]=Z.useState(null),{filteredPreschools:w,selectedPreschool:T,setSelectedPreschool:M,mapCenter:O,mapZoom:D,setMapCenter:B,setMapZoom:N,preschools:G,lastUpdated:V,updateVisiblePreschoolsFromViewport:U}=vo();vxe(r.current),Z.useEffect(()=>{console.log("🎯 Preloading Swedish cluster data for instant display...");const se=Fx.generateSwedishClusterApproximation();console.log(`📦 Preloaded ${se.length} cluster approximations for Sweden`)},[]),Z.useEffect(()=>{if(!t.current)return;r.current=new E2.Map({container:t.current,style:"mapbox://styles/mapbox/streets-v12",center:[15.2,62.4],zoom:4.9,minZoom:2,maxZoom:18,pitch:0,bearing:0,maxBounds:[[7,55],[25,70]]}),r.current.on("style.load",()=>{if(!r.current)return;console.log("🗺️ Mapbox style loaded, map is ready"),c(!1);const ge=r.current.getZoom();let je=Fx.getClusterState(ge);if(je)console.log("⚡ Using cached clusters for instant display"),X(je.clusters);else{console.log("🏃‍♂️ No cache found, using Swedish cluster approximation for instant display");const ze=Fx.generateSwedishClusterApproximation();X(ze)}setTimeout(()=>{if(r.current){const ze=r.current.getBounds();U({north:ze.getNorth(),south:ze.getSouth(),east:ze.getEast(),west:ze.getWest()}),console.log("🎯 Initial viewport preschools updated")}},1e3)}),r.current.addControl(new E2.NavigationControl,"top-right");const se=new E2.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});r.current.addControl(se,"top-right"),se.on("geolocate",ge=>{const{longitude:je,latitude:ze}=ge.coords;console.log(`User location detected: [${je}, ${ze}]`),B([je,ze]),N(13)});let le;return r.current.on("moveend",()=>{clearTimeout(le),le=setTimeout(()=>{if(!r.current)return;const ge=r.current.getCenter(),je=r.current.getZoom();B([ge.lng,ge.lat]),N(je);const ze=r.current.getBounds();U({north:ze.getNorth(),south:ze.getSouth(),east:ze.getEast(),west:ze.getWest()}),setTimeout(()=>{if(r.current&&r.current.getLayer("preschools-clusters")){const Ce=r.current.queryRenderedFeatures({layers:["preschools-clusters"]});if(Ce.length>0){const Ke=Ce.map(Ye=>({center:Ye.geometry.coordinates,count:Ye.properties.point_count,bounds:{north:Ye.geometry.coordinates[1]+.5,south:Ye.geometry.coordinates[1]-.5,east:Ye.geometry.coordinates[0]+.5,west:Ye.geometry.coordinates[0]-.5},averageRating:Ye.properties.avg_rating||4,totalChildren:Ye.properties.total_children||0,timestamp:Date.now()}));Fx.saveClusterState(je,Ke),console.log(`💾 Cached ${Ke.length} clusters for zoom ${je.toFixed(1)}`)}}},500),console.log("🗺️ Map moved - updated visible preschools for viewport")},300)}),()=>{r.current?.remove()}},[]);const X=Z.useCallback(se=>{if(!r.current||!r.current.isStyleLoaded())return;r.current.getLayer("cached-clusters")&&r.current.removeLayer("cached-clusters"),r.current.getLayer("cached-cluster-count")&&r.current.removeLayer("cached-cluster-count"),r.current.getSource("cached-clusters")&&r.current.removeSource("cached-clusters");const le={type:"FeatureCollection",features:se.map((ge,je)=>({type:"Feature",id:je,properties:{cluster_id:je,point_count:ge.count,point_count_abbreviated:ge.count>1e3?`${(ge.count/1e3).toFixed(1)}k`:ge.count.toString()},geometry:{type:"Point",coordinates:ge.center}}))};r.current.addSource("cached-clusters",{type:"geojson",data:le}),r.current.addLayer({id:"cached-clusters",type:"circle",source:"cached-clusters",paint:{"circle-color":["interpolate",["linear"],["get","point_count"],1,"#34d399",25,"#10b981",100,"#f59e0b",500,"#f97316",1e3,"#dc2626"],"circle-radius":["interpolate",["exponential",1.2],["get","point_count"],1,20,25,28,100,36,500,44,1e3,52],"circle-stroke-width":3,"circle-stroke-color":"#ffffff","circle-opacity":.8}}),r.current.addLayer({id:"cached-cluster-count",type:"symbol",source:"cached-clusters",layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":16},paint:{"text-color":"#ffffff"}}),console.log(`⚡ Added ${se.length} cached clusters for immediate display`)},[]),Y=Z.useMemo(()=>{const se=w.filter(le=>le.latitud!==null&&le.longitud!==null&&typeof le.latitud=="number"&&typeof le.longitud=="number"&&le.latitud>=55&&le.latitud<=69.1&&le.longitud>=10.9&&le.longitud<=24.2);return console.log(`📍 Valid preschools for map: ${se.length}/${w.length}`),se.length>0&&console.log(`✅ First preschool: ${se[0].namn} at [${se[0].longitud}, ${se[0].latitud}]`),se},[w]),ne=Z.useMemo(()=>{const se={type:"FeatureCollection",features:Y.map(le=>({type:"Feature",properties:{id:le.id,namn:le.namn,kommun:le.kommun,huvudman:le.huvudman,google_rating:le.google_rating||0},geometry:{type:"Point",coordinates:[le.longitud,le.latitud]}}))};return console.log(`🌍 Generated GeoJSON with ${se.features.length} features`),se},[Y]);return Z.useEffect(()=>{if(console.log(`🔄 Map useEffect triggered - valid preschools: ${Y.length}`),!r.current){console.log("❌ No map instance available");return}if(!r.current.isStyleLoaded()){console.log("⏳ Waiting for map style to load...");const ge=()=>{r.current?.isStyleLoaded()?(console.log("✅ Style loaded, adding preschools"),se()):setTimeout(ge,100)};ge();return}se();function se(){if(r.current){if(["cached-clusters","cached-cluster-count"].forEach(ge=>{r.current?.getLayer(ge)&&(r.current.removeLayer(ge),console.log(`🗑️ Removed cached layer: ${ge}`))}),r.current?.getSource("cached-clusters")&&(r.current.removeSource("cached-clusters"),console.log("🗑️ Removed cached clusters source")),["preschools-clusters","preschools-cluster-count","preschools-unclustered"].forEach(ge=>{r.current?.getLayer(ge)&&r.current.removeLayer(ge)}),r.current?.getSource("preschools")&&r.current.removeSource("preschools"),Y.length===0){console.log("No valid preschools to display on map");return}console.log(`🗺️ Replacing cached clusters with ${Y.length} real preschools`),r.current.addSource("preschools",{type:"geojson",data:ne,cluster:!0,clusterMaxZoom:13,clusterRadius:45,clusterProperties:{avg_rating:["/",["+",["get","google_rating"]],["get","point_count"]],total_children:["+",["get","antal_barn"]],preschool_count:["get","point_count"]}}),r.current.addLayer({id:"preschools-clusters",type:"circle",source:"preschools",filter:["has","point_count"],paint:{"circle-color":["interpolate",["linear"],["get","point_count"],1,"#34d399",25,"#10b981",100,"#f59e0b",500,"#f97316",1e3,"#dc2626"],"circle-radius":["interpolate",["exponential",1.2],["get","point_count"],1,20,25,28,100,36,500,44,1e3,52],"circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.85}}),r.current.addLayer({id:"preschools-cluster-count",type:"symbol",source:"preschools",filter:["has","point_count"],layout:{"text-field":"{point_count}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),r.current.addLayer({id:"preschools-unclustered",type:"circle",source:"preschools",filter:["!",["has","point_count"]],paint:{"circle-color":["case",[">",["get","google_rating"],4],"#10b981",[">",["get","google_rating"],3],"#f59e0b",["==",["get","google_rating"],0],"#6b7280","#ef4444"],"circle-radius":["interpolate",["exponential",1.5],["zoom"],10,6,15,10],"circle-stroke-width":["interpolate",["linear"],["zoom"],10,1,15,2],"circle-stroke-color":"#ffffff","circle-opacity":.9}}),r.current.on("click","preschools-unclustered",async ge=>{if(ge.features&&ge.features[0]){const je=ge.features[0].properties?.id,ze=w.find(Ce=>Ce.id===je);ze&&(v(ze),p(!0),ze.latitud&&ze.longitud&&!ze.google_rating&&(console.log(`🔄 Auto-enriching preschool: ${ze.namn}`),pX.enrichPreschool(ze.id,ze.latitud,ze.longitud,ze.adress||"",ze.namn,1)))}}),r.current.on("click","preschools-clusters",ge=>{const je=r.current.queryRenderedFeatures(ge.point,{layers:["preschools-clusters"]}),ze=je[0].properties.cluster_id;r.current.getSource("preschools").getClusterExpansionZoom(ze,(Ce,Ke)=>{Ce||r.current.easeTo({center:je[0].geometry.coordinates,zoom:Ke})})}),setTimeout(()=>{le()},1e3)}}function le(){if(!r.current)return;const ge=r.current.getZoom(),je=r.current.queryRenderedFeatures({layers:["preschools-clusters"]});if(je.length>0){const ze=je.map(Ce=>({center:Ce.geometry.coordinates,count:Ce.properties.point_count,bounds:{north:Ce.geometry.coordinates[1]+.5,south:Ce.geometry.coordinates[1]-.5,east:Ce.geometry.coordinates[0]+.5,west:Ce.geometry.coordinates[0]-.5},averageRating:Ce.properties.avg_rating||4,totalChildren:Ce.properties.total_children||0,timestamp:Date.now()}));Fx.saveClusterState(ge,ze),console.log(`💾 Saved ${ze.length} real clusters to cache for zoom ${ge.toFixed(1)}`)}}},[w,ne,V]),Z.useEffect(()=>{if(!r.current)return;const se=r.current.getCenter(),le=r.current.getZoom(),ge=Array.isArray(O)?O:[O.lng||O.lon,O.lat],[je,ze]=ge,Ce=Math.abs(se.lng-je)+Math.abs(se.lat-ze),Ke=Math.abs(le-D);(Ce>.01||Ke>.5)&&(console.log(`Flying to: [${je}, ${ze}] zoom: ${D}`),r.current.flyTo({center:[je,ze],zoom:D,duration:1e3}))},[O,D]),Z.useEffect(()=>{T&&r.current&&T.latitud&&T.longitud&&r.current.flyTo({center:[T.longitud,T.latitud],zoom:14,duration:1e3})},[T]),C.jsxs("div",{className:`relative ${e}`,children:[C.jsx(Tc,{children:h&&o&&C.jsx(yxe,{preschool:o,onClose:()=>{p(!1),v(null)},onViewDetails:()=>{M(o),p(!1),v(null)}})}),C.jsx("div",{ref:t,className:"w-full h-full rounded-lg overflow-hidden"}),n&&C.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-gradient-to-br from-primary/20 to-secondary/20 backdrop-blur-sm flex items-center justify-center rounded-lg",children:C.jsxs("div",{className:"text-center",children:[C.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-primary border-t-transparent rounded-full mx-auto mb-4"}),C.jsx("p",{className:"text-foreground font-medium",children:"Laddar karta över Sverige..."})]})})]})};class vI extends Ne.Component{constructor(t){super(t),ab(this,"retry",()=>{this.setState({hasError:!1,error:void 0})}),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error("ErrorBoundary caught an error:",t,r)}render(){if(this.state.hasError){if(this.props.fallback){const t=this.props.fallback;return C.jsx(t,{error:this.state.error,retry:this.retry})}return C.jsxs(kn,{className:"p-6 m-4 border-destructive/50",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[C.jsx(rue,{className:"h-6 w-6 text-destructive"}),C.jsx("h3",{className:"text-lg font-semibold text-destructive",children:"Något gick fel"})]}),C.jsx("p",{className:"text-muted-foreground mb-4",children:"Ett oväntat fel uppstod. Försök ladda om sidan eller kontakta support om problemet kvarstår."}),this.state.error&&C.jsxs("details",{className:"mb-4",children:[C.jsx("summary",{className:"text-sm text-muted-foreground cursor-pointer hover:text-foreground",children:"Teknisk information"}),C.jsx("pre",{className:"mt-2 text-xs bg-muted p-2 rounded overflow-auto",children:this.state.error.message})]}),C.jsxs(qr,{onClick:this.retry,variant:"outline",className:"w-full",children:[C.jsx(qd,{className:"h-4 w-4 mr-2"}),"Försök igen"]})]})}return this.props.children}}function Bx({className:e,...t}){return C.jsx("div",{className:ln("animate-pulse rounded-md bg-muted",e),...t})}const wxe=({className:e})=>C.jsx(kn,{className:`p-4 ${e}`,children:C.jsxs("div",{className:"space-y-3",children:[C.jsx(Bx,{className:"h-4 w-3/4"}),C.jsx(Bx,{className:"h-4 w-1/2"}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Bx,{className:"h-3 w-full"}),C.jsx(Bx,{className:"h-3 w-5/6"}),C.jsx(Bx,{className:"h-3 w-4/6"})]})]})}),zV=({children:e,fallback:t,className:r})=>C.jsx(Z.Suspense,{fallback:t||C.jsx(wxe,{className:r}),children:e}),Sxe=({children:e})=>{const[t,r]=Z.useState(navigator.onLine),[n,c]=Z.useState(!1);Z.useEffect(()=>{const p=()=>{r(!0),c(!1),XO({title:"Anslutning återställd",description:"Du är nu online igen",duration:3e3})},o=()=>{r(!1),c(!0),XO({title:"Ingen internetanslutning",description:"Kontrollera din anslutning för att få de senaste uppdateringarna",variant:"destructive",duration:5e3})};return window.addEventListener("online",p),window.addEventListener("offline",o),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",o)}},[]);const h=()=>{window.location.reload()};return C.jsxs(C.Fragment,{children:[n&&C.jsx(kn,{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-destructive/90 text-destructive-foreground border-destructive",children:C.jsxs("div",{className:"p-3 flex items-center gap-3",children:[C.jsx(nue,{className:"h-5 w-5"}),C.jsxs("div",{className:"flex-1",children:[C.jsx("p",{className:"text-sm font-medium",children:"Ingen internetanslutning"}),C.jsx("p",{className:"text-xs opacity-90",children:"Vissa funktioner kanske inte fungerar"})]}),C.jsxs(qr,{size:"sm",variant:"secondary",onClick:h,className:"h-8",children:[C.jsx(qd,{className:"h-4 w-4 mr-1"}),"Försök igen"]})]})}),e,C.jsx("div",{className:"fixed bottom-4 left-4 z-40"})]})},mX=Z.memo(({children:e})=>C.jsx(C.Fragment,{children:e}));mX.displayName="PerformanceOptimizer";var Txe=Z.createContext(void 0);function pk(e){const t=Z.useContext(Txe);return e||t||"ltr"}function Wj(e,[t,r]){return Math.min(r,Math.max(t,e))}function Exe(e,t){return Z.useReducer((r,n)=>t[r][n]??r,e)}var $3="ScrollArea",[gX,sHe]=wc($3),[Axe,Bl]=gX($3),yX=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:c,scrollHideDelay:h=600,...p}=e,[o,v]=Z.useState(null),[w,T]=Z.useState(null),[M,O]=Z.useState(null),[D,B]=Z.useState(null),[N,G]=Z.useState(null),[V,U]=Z.useState(0),[X,Y]=Z.useState(0),[ne,se]=Z.useState(!1),[le,ge]=Z.useState(!1),je=yi(t,Ce=>v(Ce)),ze=pk(c);return C.jsx(Axe,{scope:r,type:n,dir:ze,scrollHideDelay:h,scrollArea:o,viewport:w,onViewportChange:T,content:M,onContentChange:O,scrollbarX:D,onScrollbarXChange:B,scrollbarXEnabled:ne,onScrollbarXEnabledChange:se,scrollbarY:N,onScrollbarYChange:G,scrollbarYEnabled:le,onScrollbarYEnabledChange:ge,onCornerWidthChange:U,onCornerHeightChange:Y,children:C.jsx(fn.div,{dir:ze,...p,ref:je,style:{position:"relative","--radix-scroll-area-corner-width":V+"px","--radix-scroll-area-corner-height":X+"px",...e.style}})})});yX.displayName=$3;var _X="ScrollAreaViewport",vX=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:c,...h}=e,p=Bl(_X,r),o=Z.useRef(null),v=yi(t,o,p.onViewportChange);return C.jsxs(C.Fragment,{children:[C.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:c}),C.jsx(fn.div,{"data-radix-scroll-area-viewport":"",...h,ref:v,style:{overflowX:p.scrollbarXEnabled?"scroll":"hidden",overflowY:p.scrollbarYEnabled?"scroll":"hidden",...e.style},children:C.jsx("div",{ref:p.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});vX.displayName=_X;var Mu="ScrollAreaScrollbar",G3=Z.forwardRef((e,t)=>{const{forceMount:r,...n}=e,c=Bl(Mu,e.__scopeScrollArea),{onScrollbarXEnabledChange:h,onScrollbarYEnabledChange:p}=c,o=e.orientation==="horizontal";return Z.useEffect(()=>(o?h(!0):p(!0),()=>{o?h(!1):p(!1)}),[o,h,p]),c.type==="hover"?C.jsx(kxe,{...n,ref:t,forceMount:r}):c.type==="scroll"?C.jsx(Cxe,{...n,ref:t,forceMount:r}):c.type==="auto"?C.jsx(xX,{...n,ref:t,forceMount:r}):c.type==="always"?C.jsx(q3,{...n,ref:t}):null});G3.displayName=Mu;var kxe=Z.forwardRef((e,t)=>{const{forceMount:r,...n}=e,c=Bl(Mu,e.__scopeScrollArea),[h,p]=Z.useState(!1);return Z.useEffect(()=>{const o=c.scrollArea;let v=0;if(o){const w=()=>{window.clearTimeout(v),p(!0)},T=()=>{v=window.setTimeout(()=>p(!1),c.scrollHideDelay)};return o.addEventListener("pointerenter",w),o.addEventListener("pointerleave",T),()=>{window.clearTimeout(v),o.removeEventListener("pointerenter",w),o.removeEventListener("pointerleave",T)}}},[c.scrollArea,c.scrollHideDelay]),C.jsx(Sc,{present:r||h,children:C.jsx(xX,{"data-state":h?"visible":"hidden",...n,ref:t})})}),Cxe=Z.forwardRef((e,t)=>{const{forceMount:r,...n}=e,c=Bl(Mu,e.__scopeScrollArea),h=e.orientation==="horizontal",p=gk(()=>v("SCROLL_END"),100),[o,v]=Exe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return Z.useEffect(()=>{if(o==="idle"){const w=window.setTimeout(()=>v("HIDE"),c.scrollHideDelay);return()=>window.clearTimeout(w)}},[o,c.scrollHideDelay,v]),Z.useEffect(()=>{const w=c.viewport,T=h?"scrollLeft":"scrollTop";if(w){let M=w[T];const O=()=>{const D=w[T];M!==D&&(v("SCROLL"),p()),M=D};return w.addEventListener("scroll",O),()=>w.removeEventListener("scroll",O)}},[c.viewport,h,v,p]),C.jsx(Sc,{present:r||o!=="hidden",children:C.jsx(q3,{"data-state":o==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:Zr(e.onPointerEnter,()=>v("POINTER_ENTER")),onPointerLeave:Zr(e.onPointerLeave,()=>v("POINTER_LEAVE"))})})}),xX=Z.forwardRef((e,t)=>{const r=Bl(Mu,e.__scopeScrollArea),{forceMount:n,...c}=e,[h,p]=Z.useState(!1),o=e.orientation==="horizontal",v=gk(()=>{if(r.viewport){const w=r.viewport.offsetWidth<r.viewport.scrollWidth,T=r.viewport.offsetHeight<r.viewport.scrollHeight;p(o?w:T)}},10);return b_(r.viewport,v),b_(r.content,v),C.jsx(Sc,{present:n||h,children:C.jsx(q3,{"data-state":h?"visible":"hidden",...c,ref:t})})}),q3=Z.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,c=Bl(Mu,e.__scopeScrollArea),h=Z.useRef(null),p=Z.useRef(0),[o,v]=Z.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),w=EX(o.viewport,o.content),T={...n,sizes:o,onSizesChange:v,hasThumb:w>0&&w<1,onThumbChange:O=>h.current=O,onThumbPointerUp:()=>p.current=0,onThumbPointerDown:O=>p.current=O};function M(O,D){return Rxe(O,p.current,o,D)}return r==="horizontal"?C.jsx(Pxe,{...T,ref:t,onThumbPositionChange:()=>{if(c.viewport&&h.current){const O=c.viewport.scrollLeft,D=NV(O,o,c.dir);h.current.style.transform=`translate3d(${D}px, 0, 0)`}},onWheelScroll:O=>{c.viewport&&(c.viewport.scrollLeft=O)},onDragScroll:O=>{c.viewport&&(c.viewport.scrollLeft=M(O,c.dir))}}):r==="vertical"?C.jsx(Mxe,{...T,ref:t,onThumbPositionChange:()=>{if(c.viewport&&h.current){const O=c.viewport.scrollTop,D=NV(O,o);h.current.style.transform=`translate3d(0, ${D}px, 0)`}},onWheelScroll:O=>{c.viewport&&(c.viewport.scrollTop=O)},onDragScroll:O=>{c.viewport&&(c.viewport.scrollTop=M(O))}}):null}),Pxe=Z.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...c}=e,h=Bl(Mu,e.__scopeScrollArea),[p,o]=Z.useState(),v=Z.useRef(null),w=yi(t,v,h.onScrollbarXChange);return Z.useEffect(()=>{v.current&&o(getComputedStyle(v.current))},[v]),C.jsx(wX,{"data-orientation":"horizontal",...c,ref:w,sizes:r,style:{bottom:0,left:h.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:h.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":mk(r)+"px",...e.style},onThumbPointerDown:T=>e.onThumbPointerDown(T.x),onDragScroll:T=>e.onDragScroll(T.x),onWheelScroll:(T,M)=>{if(h.viewport){const O=h.viewport.scrollLeft+T.deltaX;e.onWheelScroll(O),kX(O,M)&&T.preventDefault()}},onResize:()=>{v.current&&h.viewport&&p&&n({content:h.viewport.scrollWidth,viewport:h.viewport.offsetWidth,scrollbar:{size:v.current.clientWidth,paddingStart:xE(p.paddingLeft),paddingEnd:xE(p.paddingRight)}})}})}),Mxe=Z.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...c}=e,h=Bl(Mu,e.__scopeScrollArea),[p,o]=Z.useState(),v=Z.useRef(null),w=yi(t,v,h.onScrollbarYChange);return Z.useEffect(()=>{v.current&&o(getComputedStyle(v.current))},[v]),C.jsx(wX,{"data-orientation":"vertical",...c,ref:w,sizes:r,style:{top:0,right:h.dir==="ltr"?0:void 0,left:h.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":mk(r)+"px",...e.style},onThumbPointerDown:T=>e.onThumbPointerDown(T.y),onDragScroll:T=>e.onDragScroll(T.y),onWheelScroll:(T,M)=>{if(h.viewport){const O=h.viewport.scrollTop+T.deltaY;e.onWheelScroll(O),kX(O,M)&&T.preventDefault()}},onResize:()=>{v.current&&h.viewport&&p&&n({content:h.viewport.scrollHeight,viewport:h.viewport.offsetHeight,scrollbar:{size:v.current.clientHeight,paddingStart:xE(p.paddingTop),paddingEnd:xE(p.paddingBottom)}})}})}),[Ixe,bX]=gX(Mu),wX=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:c,onThumbChange:h,onThumbPointerUp:p,onThumbPointerDown:o,onThumbPositionChange:v,onDragScroll:w,onWheelScroll:T,onResize:M,...O}=e,D=Bl(Mu,r),[B,N]=Z.useState(null),G=yi(t,je=>N(je)),V=Z.useRef(null),U=Z.useRef(""),X=D.viewport,Y=n.content-n.viewport,ne=na(T),se=na(v),le=gk(M,10);function ge(je){if(V.current){const ze=je.clientX-V.current.left,Ce=je.clientY-V.current.top;w({x:ze,y:Ce})}}return Z.useEffect(()=>{const je=ze=>{const Ce=ze.target;B?.contains(Ce)&&ne(ze,Y)};return document.addEventListener("wheel",je,{passive:!1}),()=>document.removeEventListener("wheel",je,{passive:!1})},[X,B,Y,ne]),Z.useEffect(se,[n,se]),b_(B,le),b_(D.content,le),C.jsx(Ixe,{scope:r,scrollbar:B,hasThumb:c,onThumbChange:na(h),onThumbPointerUp:na(p),onThumbPositionChange:se,onThumbPointerDown:na(o),children:C.jsx(fn.div,{...O,ref:G,style:{position:"absolute",...O.style},onPointerDown:Zr(e.onPointerDown,je=>{je.button===0&&(je.target.setPointerCapture(je.pointerId),V.current=B.getBoundingClientRect(),U.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",D.viewport&&(D.viewport.style.scrollBehavior="auto"),ge(je))}),onPointerMove:Zr(e.onPointerMove,ge),onPointerUp:Zr(e.onPointerUp,je=>{const ze=je.target;ze.hasPointerCapture(je.pointerId)&&ze.releasePointerCapture(je.pointerId),document.body.style.webkitUserSelect=U.current,D.viewport&&(D.viewport.style.scrollBehavior=""),V.current=null})})})}),vE="ScrollAreaThumb",SX=Z.forwardRef((e,t)=>{const{forceMount:r,...n}=e,c=bX(vE,e.__scopeScrollArea);return C.jsx(Sc,{present:r||c.hasThumb,children:C.jsx(Oxe,{ref:t,...n})})}),Oxe=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...c}=e,h=Bl(vE,r),p=bX(vE,r),{onThumbPositionChange:o}=p,v=yi(t,M=>p.onThumbChange(M)),w=Z.useRef(void 0),T=gk(()=>{w.current&&(w.current(),w.current=void 0)},100);return Z.useEffect(()=>{const M=h.viewport;if(M){const O=()=>{if(T(),!w.current){const D=Dxe(M,o);w.current=D,o()}};return o(),M.addEventListener("scroll",O),()=>M.removeEventListener("scroll",O)}},[h.viewport,T,o]),C.jsx(fn.div,{"data-state":p.hasThumb?"visible":"hidden",...c,ref:v,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:Zr(e.onPointerDownCapture,M=>{const O=M.target.getBoundingClientRect(),D=M.clientX-O.left,B=M.clientY-O.top;p.onThumbPointerDown({x:D,y:B})}),onPointerUp:Zr(e.onPointerUp,p.onThumbPointerUp)})});SX.displayName=vE;var H3="ScrollAreaCorner",TX=Z.forwardRef((e,t)=>{const r=Bl(H3,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?C.jsx(jxe,{...e,ref:t}):null});TX.displayName=H3;var jxe=Z.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,c=Bl(H3,r),[h,p]=Z.useState(0),[o,v]=Z.useState(0),w=!!(h&&o);return b_(c.scrollbarX,()=>{const T=c.scrollbarX?.offsetHeight||0;c.onCornerHeightChange(T),v(T)}),b_(c.scrollbarY,()=>{const T=c.scrollbarY?.offsetWidth||0;c.onCornerWidthChange(T),p(T)}),w?C.jsx(fn.div,{...n,ref:t,style:{width:h,height:o,position:"absolute",right:c.dir==="ltr"?0:void 0,left:c.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function xE(e){return e?parseInt(e,10):0}function EX(e,t){const r=e/t;return isNaN(r)?0:r}function mk(e){const t=EX(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function Rxe(e,t,r,n="ltr"){const c=mk(r),h=c/2,p=t||h,o=c-p,v=r.scrollbar.paddingStart+p,w=r.scrollbar.size-r.scrollbar.paddingEnd-o,T=r.content-r.viewport,M=n==="ltr"?[0,T]:[T*-1,0];return AX([v,w],M)(e)}function NV(e,t,r="ltr"){const n=mk(t),c=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,h=t.scrollbar.size-c,p=t.content-t.viewport,o=h-n,v=r==="ltr"?[0,p]:[p*-1,0],w=Wj(e,v);return AX([0,p],[0,o])(w)}function AX(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function kX(e,t){return e>0&&e<t}var Dxe=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function c(){const h={left:e.scrollLeft,top:e.scrollTop},p=r.left!==h.left,o=r.top!==h.top;(p||o)&&t(),r=h,n=window.requestAnimationFrame(c)}(),()=>window.cancelAnimationFrame(n)};function gk(e,t){const r=na(e),n=Z.useRef(0);return Z.useEffect(()=>()=>window.clearTimeout(n.current),[]),Z.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function b_(e,t){const r=na(t);xa(()=>{let n=0;if(e){const c=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return c.observe(e),()=>{window.cancelAnimationFrame(n),c.unobserve(e)}}},[e,r])}var CX=yX,Lxe=vX,zxe=TX;const Zj=Z.forwardRef(({className:e,children:t,...r},n)=>C.jsxs(CX,{ref:n,className:ln("relative overflow-hidden",e),...r,children:[C.jsx(Lxe,{className:"h-full w-full rounded-[inherit]",children:t}),C.jsx(PX,{}),C.jsx(zxe,{})]}));Zj.displayName=CX.displayName;const PX=Z.forwardRef(({className:e,orientation:t="vertical",...r},n)=>C.jsx(G3,{ref:n,orientation:t,className:ln("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:C.jsx(SX,{className:"relative flex-1 rounded-full bg-border"})}));PX.displayName=G3.displayName;var xI="rovingFocusGroup.onEntryFocus",Nxe={bubbles:!1,cancelable:!0},n1="RovingFocusGroup",[Kj,MX,Fxe]=LL(n1),[Bxe,IX]=wc(n1,[Fxe]),[Uxe,Vxe]=Bxe(n1),OX=Z.forwardRef((e,t)=>C.jsx(Kj.Provider,{scope:e.__scopeRovingFocusGroup,children:C.jsx(Kj.Slot,{scope:e.__scopeRovingFocusGroup,children:C.jsx($xe,{...e,ref:t})})}));OX.displayName=n1;var $xe=Z.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:c=!1,dir:h,currentTabStopId:p,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:v,onEntryFocus:w,preventScrollOnEntryFocus:T=!1,...M}=e,O=Z.useRef(null),D=yi(t,O),B=pk(h),[N,G]=ym({prop:p,defaultProp:o??null,onChange:v,caller:n1}),[V,U]=Z.useState(!1),X=na(w),Y=MX(r),ne=Z.useRef(!1),[se,le]=Z.useState(0);return Z.useEffect(()=>{const ge=O.current;if(ge)return ge.addEventListener(xI,X),()=>ge.removeEventListener(xI,X)},[X]),C.jsx(Uxe,{scope:r,orientation:n,dir:B,loop:c,currentTabStopId:N,onItemFocus:Z.useCallback(ge=>G(ge),[G]),onItemShiftTab:Z.useCallback(()=>U(!0),[]),onFocusableItemAdd:Z.useCallback(()=>le(ge=>ge+1),[]),onFocusableItemRemove:Z.useCallback(()=>le(ge=>ge-1),[]),children:C.jsx(fn.div,{tabIndex:V||se===0?-1:0,"data-orientation":n,...M,ref:D,style:{outline:"none",...e.style},onMouseDown:Zr(e.onMouseDown,()=>{ne.current=!0}),onFocus:Zr(e.onFocus,ge=>{const je=!ne.current;if(ge.target===ge.currentTarget&&je&&!V){const ze=new CustomEvent(xI,Nxe);if(ge.currentTarget.dispatchEvent(ze),!ze.defaultPrevented){const Ce=Y().filter(tt=>tt.focusable),Ke=Ce.find(tt=>tt.active),Ye=Ce.find(tt=>tt.id===N),Oe=[Ke,Ye,...Ce].filter(Boolean).map(tt=>tt.ref.current);DX(Oe,T)}}ne.current=!1}),onBlur:Zr(e.onBlur,()=>U(!1))})})}),jX="RovingFocusGroupItem",RX=Z.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:c=!1,tabStopId:h,children:p,...o}=e,v=hf(),w=h||v,T=Vxe(jX,r),M=T.currentTabStopId===w,O=MX(r),{onFocusableItemAdd:D,onFocusableItemRemove:B,currentTabStopId:N}=T;return Z.useEffect(()=>{if(n)return D(),()=>B()},[n,D,B]),C.jsx(Kj.ItemSlot,{scope:r,id:w,focusable:n,active:c,children:C.jsx(fn.span,{tabIndex:M?0:-1,"data-orientation":T.orientation,...o,ref:t,onMouseDown:Zr(e.onMouseDown,G=>{n?T.onItemFocus(w):G.preventDefault()}),onFocus:Zr(e.onFocus,()=>T.onItemFocus(w)),onKeyDown:Zr(e.onKeyDown,G=>{if(G.key==="Tab"&&G.shiftKey){T.onItemShiftTab();return}if(G.target!==G.currentTarget)return;const V=Hxe(G,T.orientation,T.dir);if(V!==void 0){if(G.metaKey||G.ctrlKey||G.altKey||G.shiftKey)return;G.preventDefault();let U=O().filter(X=>X.focusable).map(X=>X.ref.current);if(V==="last")U.reverse();else if(V==="prev"||V==="next"){V==="prev"&&U.reverse();const X=U.indexOf(G.currentTarget);U=T.loop?Wxe(U,X+1):U.slice(X+1)}setTimeout(()=>DX(U))}}),children:typeof p=="function"?p({isCurrentTabStop:M,hasTabStop:N!=null}):p})})});RX.displayName=jX;var Gxe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function qxe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Hxe(e,t,r){const n=qxe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return Gxe[n]}function DX(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function Wxe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var Zxe=OX,Kxe=RX,yk="Tabs",[Xxe,lHe]=wc(yk,[IX]),LX=IX(),[Yxe,W3]=Xxe(yk),zX=Z.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:c,defaultValue:h,orientation:p="horizontal",dir:o,activationMode:v="automatic",...w}=e,T=pk(o),[M,O]=ym({prop:n,onChange:c,defaultProp:h??"",caller:yk});return C.jsx(Yxe,{scope:r,baseId:hf(),value:M,onValueChange:O,orientation:p,dir:T,activationMode:v,children:C.jsx(fn.div,{dir:T,"data-orientation":p,...w,ref:t})})});zX.displayName=yk;var NX="TabsList",FX=Z.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...c}=e,h=W3(NX,r),p=LX(r);return C.jsx(Zxe,{asChild:!0,...p,orientation:h.orientation,dir:h.dir,loop:n,children:C.jsx(fn.div,{role:"tablist","aria-orientation":h.orientation,...c,ref:t})})});FX.displayName=NX;var BX="TabsTrigger",UX=Z.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:c=!1,...h}=e,p=W3(BX,r),o=LX(r),v=GX(p.baseId,n),w=qX(p.baseId,n),T=n===p.value;return C.jsx(Kxe,{asChild:!0,...o,focusable:!c,active:T,children:C.jsx(fn.button,{type:"button",role:"tab","aria-selected":T,"aria-controls":w,"data-state":T?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:v,...h,ref:t,onMouseDown:Zr(e.onMouseDown,M=>{!c&&M.button===0&&M.ctrlKey===!1?p.onValueChange(n):M.preventDefault()}),onKeyDown:Zr(e.onKeyDown,M=>{[" ","Enter"].includes(M.key)&&p.onValueChange(n)}),onFocus:Zr(e.onFocus,()=>{const M=p.activationMode!=="manual";!T&&!c&&M&&p.onValueChange(n)})})})});UX.displayName=BX;var VX="TabsContent",$X=Z.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:c,children:h,...p}=e,o=W3(VX,r),v=GX(o.baseId,n),w=qX(o.baseId,n),T=n===o.value,M=Z.useRef(T);return Z.useEffect(()=>{const O=requestAnimationFrame(()=>M.current=!1);return()=>cancelAnimationFrame(O)},[]),C.jsx(Sc,{present:c||T,children:({present:O})=>C.jsx(fn.div,{"data-state":T?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":v,hidden:!O,id:w,tabIndex:0,...p,ref:t,style:{...e.style,animationDuration:M.current?"0s":void 0},children:O&&h})})});$X.displayName=VX;function GX(e,t){return`${e}-trigger-${t}`}function qX(e,t){return`${e}-content-${t}`}var Jxe=zX,HX=FX,WX=UX,ZX=$X;const Z3=Jxe,_k=Z.forwardRef(({className:e,...t},r)=>C.jsx(HX,{ref:r,className:ln("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));_k.displayName=HX.displayName;const Su=Z.forwardRef(({className:e,...t},r)=>C.jsx(WX,{ref:r,className:ln("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));Su.displayName=WX.displayName;const Tu=Z.forwardRef(({className:e,...t},r)=>C.jsx(ZX,{ref:r,className:ln("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Tu.displayName=ZX.displayName;var K3="Progress",X3=100,[Qxe,cHe]=wc(K3),[ebe,tbe]=Qxe(K3),KX=Z.forwardRef((e,t)=>{const{__scopeProgress:r,value:n=null,max:c,getValueLabel:h=rbe,...p}=e;(c||c===0)&&!FV(c)&&console.error(nbe(`${c}`,"Progress"));const o=FV(c)?c:X3;n!==null&&!BV(n,o)&&console.error(ibe(`${n}`,"Progress"));const v=BV(n,o)?n:null,w=bE(v)?h(v,o):void 0;return C.jsx(ebe,{scope:r,value:v,max:o,children:C.jsx(fn.div,{"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":bE(v)?v:void 0,"aria-valuetext":w,role:"progressbar","data-state":JX(v,o),"data-value":v??void 0,"data-max":o,...p,ref:t})})});KX.displayName=K3;var XX="ProgressIndicator",YX=Z.forwardRef((e,t)=>{const{__scopeProgress:r,...n}=e,c=tbe(XX,r);return C.jsx(fn.div,{"data-state":JX(c.value,c.max),"data-value":c.value??void 0,"data-max":c.max,...n,ref:t})});YX.displayName=XX;function rbe(e,t){return`${Math.round(e/t*100)}%`}function JX(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function bE(e){return typeof e=="number"}function FV(e){return bE(e)&&!isNaN(e)&&e>0}function BV(e,t){return bE(e)&&!isNaN(e)&&e<=t&&e>=0}function nbe(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${X3}\`.`}function ibe(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${X3} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var QX=KX,obe=YX;const Y3=Z.forwardRef(({className:e,value:t,...r},n)=>C.jsx(QX,{ref:n,className:ln("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:C.jsx(obe,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Y3.displayName=QX.displayName;function eY(e){const t=Z.useRef({value:e,previous:e});return Z.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var vk="Switch",[abe,uHe]=wc(vk),[sbe,lbe]=abe(vk),tY=Z.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:c,defaultChecked:h,required:p,disabled:o,value:v="on",onCheckedChange:w,form:T,...M}=e,[O,D]=Z.useState(null),B=yi(t,X=>D(X)),N=Z.useRef(!1),G=O?T||!!O.closest("form"):!0,[V,U]=ym({prop:c,defaultProp:h??!1,onChange:w,caller:vk});return C.jsxs(sbe,{scope:r,checked:V,disabled:o,children:[C.jsx(fn.button,{type:"button",role:"switch","aria-checked":V,"aria-required":p,"data-state":oY(V),"data-disabled":o?"":void 0,disabled:o,value:v,...M,ref:B,onClick:Zr(e.onClick,X=>{U(Y=>!Y),G&&(N.current=X.isPropagationStopped(),N.current||X.stopPropagation())})}),G&&C.jsx(iY,{control:O,bubbles:!N.current,name:n,value:v,checked:V,required:p,disabled:o,form:T,style:{transform:"translateX(-100%)"}})]})});tY.displayName=vk;var rY="SwitchThumb",nY=Z.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,c=lbe(rY,r);return C.jsx(fn.span,{"data-state":oY(c.checked),"data-disabled":c.disabled?"":void 0,...n,ref:t})});nY.displayName=rY;var cbe="SwitchBubbleInput",iY=Z.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...c},h)=>{const p=Z.useRef(null),o=yi(p,h),v=eY(r),w=SW(t);return Z.useEffect(()=>{const T=p.current;if(!T)return;const M=window.HTMLInputElement.prototype,O=Object.getOwnPropertyDescriptor(M,"checked").set;if(v!==r&&O){const D=new Event("click",{bubbles:n});O.call(T,r),T.dispatchEvent(D)}},[v,r,n]),C.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...c,tabIndex:-1,ref:o,style:{...c.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});iY.displayName=cbe;function oY(e){return e?"checked":"unchecked"}var aY=tY,ube=nY;const sY=Z.forwardRef(({className:e,...t},r)=>C.jsx(aY,{className:ln("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:r,children:C.jsx(ube,{className:ln("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));sY.displayName=aY.displayName;const hbe=({onDataChange:e,isEnabled:t=!0}={})=>{const r=Z.useCallback((n,c)=>{console.log(`Admin Monitor: Critical change in ${c}:`,n),n.eventType==="INSERT"?fh.success(`Ny data tillagd i ${c}`,{description:`${n.eventType} operation utförd`,duration:5e3}):n.eventType==="UPDATE"?fh.info(`Data uppdaterad i ${c}`,{description:`Rad ${n.new?.id||"unknown"} modifierad`,duration:3e3}):n.eventType==="DELETE"&&fh.error(`Data borttagen från ${c}`,{description:`Rad ${n.old?.id||"unknown"} raderad`,duration:5e3}),e&&setTimeout(e,500)},[e]);return Z.useEffect(()=>{if(!t)return;console.log("Admin Real-time Monitor: Starting subscriptions");const n=gn.channel("admin_preschool_monitor").on("postgres_changes",{event:"*",schema:"public",table:"Förskolor"},v=>r(v,"Förskolor")).subscribe(),c=gn.channel("admin_google_monitor").on("postgres_changes",{event:"*",schema:"public",table:"preschool_google_data"},v=>r(v,"Google Data")).subscribe(),h=gn.channel("admin_image_monitor").on("postgres_changes",{event:"*",schema:"public",table:"preschool_images"},v=>r(v,"Preschool Images")).subscribe(),p=gn.channel("admin_favorites_monitor").on("postgres_changes",{event:"*",schema:"public",table:"user_favorites"},v=>{console.log("Admin Monitor: User favorites activity:",v),e&&setTimeout(e,1e3)}).subscribe(),o=gn.channel("admin_search_monitor").on("postgres_changes",{event:"*",schema:"public",table:"user_search_history"},v=>{console.log("Admin Monitor: Search activity:",v),e&&setTimeout(e,1e3)}).subscribe();return()=>{console.log("Admin Real-time Monitor: Cleaning up subscriptions"),gn.removeChannel(n),gn.removeChannel(c),gn.removeChannel(h),gn.removeChannel(p),gn.removeChannel(o)}},[t,r]),{isMonitoring:t}},dbe=()=>{const[e,t]=Z.useState(null),[r,n]=Z.useState(!0),{preschools:c}=vo(),h=()=>{if(!c.length)return;const p=c.length,o=c.filter(M=>M.latitud!==null&&M.longitud!==null&&M.latitud!==0&&M.longitud!==0).length,v=p-o,w=c.filter(M=>M.latitud===null||M.longitud===null||M.latitud===0||M.longitud===0).length,T={};c.forEach(M=>{T[M.kommun]||(T[M.kommun]={total:0,missing:0,percentage:0}),T[M.kommun].total++,(M.latitud===null||M.longitud===null||M.latitud===0||M.longitud===0)&&T[M.kommun].missing++}),Object.keys(T).forEach(M=>{const O=T[M];O.percentage=Math.round(O.missing/O.total*100)}),t({total:p,withCoordinates:o,missingCoordinates:v,needsGeocoding:w,byKommun:T}),n(!1)};return Z.useEffect(()=>{h()},[c]),{stats:e,isLoading:r,refresh:h}},fbe=Y_("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),lY=Z.forwardRef(({className:e,variant:t,...r},n)=>C.jsx("div",{ref:n,role:"alert",className:ln(fbe({variant:t}),e),...r}));lY.displayName="Alert";const pbe=Z.forwardRef(({className:e,...t},r)=>C.jsx("h5",{ref:r,className:ln("mb-1 font-medium leading-none tracking-tight",e),...t}));pbe.displayName="AlertTitle";const cY=Z.forwardRef(({className:e,...t},r)=>C.jsx("div",{ref:r,className:ln("text-sm [&_p]:leading-relaxed",e),...t}));cY.displayName="AlertDescription";const mbe=({missingCoordinatesCount:e,onComplete:t})=>{const[r,n]=Z.useState(!1),[c,h]=Z.useState(0),[p,o]=Z.useState(0),[v,w]=Z.useState(0),[T,M]=Z.useState(0),[O,D]=Z.useState(0),[B,N]=Z.useState([]),{preschools:G}=vo(),{toast:V}=DL(),U=async()=>{n(!0),h(0),o(0),w(0),N([]);try{const ne=G.filter(Ce=>Ce.latitud===null||Ce.longitud===null||Ce.latitud===0||Ce.longitud===0);if(ne.length===0){V({title:"Ingen bearbetning krävs",description:"Alla förskolor har redan koordinater."}),n(!1);return}const se=25,le=Math.ceil(ne.length/se);D(le),console.log(`Starting batch processing: ${ne.length} preschools in ${le} batches`);let ge=0,je=0;const ze=[];for(let Ce=0;Ce<le;Ce++){M(Ce+1);const Ke=Ce*se,Ye=Math.min(Ke+se,ne.length),Oe=ne.slice(Ke,Ye);console.log(`Processing batch ${Ce+1}/${le}: ${Oe.length} preschools`);const tt=Oe.map(He=>({id:He.id,Namn:He.namn,Adress:He.adress,Kommun:He.kommun,Postnummer:null,Latitud:He.latitud,Longitud:He.longitud}));try{const{data:He,error:lt}=await gn.functions.invoke("geocoding-service",{body:{preschools:tt}});lt?(console.error(`Batch ${Ce+1} error:`,lt),V({title:`Batch ${Ce+1} misslyckades`,description:lt.message,variant:"destructive"})):He&&(ge+=He.processed||0,je+=He.successful||0,ze.push(...He.results||[]),console.log(`Batch ${Ce+1} completed: ${He.successful}/${He.processed} successful`))}catch(He){console.error(`Batch ${Ce+1} exception:`,He),V({title:`Batch ${Ce+1} fel`,description:`Oväntat fel: ${He}`,variant:"destructive"})}o(ge),w(je),h(Math.round((Ce+1)/le*100)),Ce<le-1&&(console.log("Waiting 5 seconds before next batch..."),await new Promise(He=>setTimeout(He,5e3)))}N(ze),V({title:"Batch-bearbetning slutförd",description:`${je} av ${ge} förskolor bearbetades framgångsrikt.`}),t&&t()}catch(ne){console.error("Batch processing error:",ne),V({title:"Bearbetningsfel",description:`Ett fel uppstod: ${ne}`,variant:"destructive"})}finally{n(!1)}},X=()=>{n(!1),V({title:"Bearbetning stoppad",description:"Batch-bearbetningen har stoppats."})},Y=()=>{h(0),o(0),w(0),M(0),D(0),N([])};return C.jsxs(kn,{children:[C.jsxs(r_,{children:[C.jsxs(n_,{className:"flex items-center gap-2",children:[C.jsx(Ws,{className:"h-5 w-5"}),"Koordinat Batch-processor"]}),C.jsx(GK,{children:"Bearbeta förskolor som saknar koordinater i batch-operationer"})]}),C.jsxs(Cl,{className:"space-y-4",children:[e>0&&C.jsxs(lY,{children:[C.jsx(Ws,{className:"h-4 w-4"}),C.jsxs(cY,{children:[C.jsx("strong",{children:e})," förskolor saknar koordinater och behöver bearbetas."]})]}),r&&C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex justify-between text-sm",children:[C.jsxs("span",{children:["Batch ",T," av ",O]}),C.jsxs("span",{children:[v,"/",p," framgångsrika"]})]}),C.jsx(Y3,{value:c,className:"w-full"}),C.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[C.jsx("span",{children:"Bearbetar koordinater..."}),C.jsxs("span",{children:[c,"% färdigt"]})]})]}),C.jsx("div",{className:"flex gap-2",children:r?C.jsxs(qr,{variant:"destructive",onClick:X,className:"flex items-center gap-2",children:[C.jsx(Q9,{className:"h-4 w-4"}),"Stoppa bearbetning"]}):C.jsxs(C.Fragment,{children:[C.jsxs(qr,{onClick:U,disabled:e===0,className:"flex items-center gap-2",children:[C.jsx(J9,{className:"h-4 w-4"}),"Starta batch-bearbetning"]}),(p>0||B.length>0)&&C.jsxs(qr,{variant:"outline",onClick:Y,className:"flex items-center gap-2",children:[C.jsx(Jce,{className:"h-4 w-4"}),"Återställ"]})]})}),B.length>0&&C.jsxs("div",{className:"mt-4",children:[C.jsx("h4",{className:"font-medium mb-2",children:"Senaste resultat:"}),C.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:B.slice(-10).map((ne,se)=>C.jsxs("div",{className:"flex justify-between items-center text-sm",children:[C.jsx("span",{className:"truncate",children:ne.namn}),C.jsx(sn,{variant:ne.success?"default":"destructive",children:ne.success?"✓":"✗"})]},se))})]})]})]})};var bI=0;function uY(){Z.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??UV()),document.body.insertAdjacentElement("beforeend",e[1]??UV()),bI++,()=>{bI===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),bI--}},[])}function UV(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var wI="focusScope.autoFocusOnMount",SI="focusScope.autoFocusOnUnmount",VV={bubbles:!1,cancelable:!0},gbe="FocusScope",J3=Z.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:c,onUnmountAutoFocus:h,...p}=e,[o,v]=Z.useState(null),w=na(c),T=na(h),M=Z.useRef(null),O=yi(t,N=>v(N)),D=Z.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Z.useEffect(()=>{if(n){let N=function(X){if(D.paused||!o)return;const Y=X.target;o.contains(Y)?M.current=Y:Vd(M.current,{select:!0})},G=function(X){if(D.paused||!o)return;const Y=X.relatedTarget;Y!==null&&(o.contains(Y)||Vd(M.current,{select:!0}))},V=function(X){if(document.activeElement===document.body)for(const Y of X)Y.removedNodes.length>0&&Vd(o)};document.addEventListener("focusin",N),document.addEventListener("focusout",G);const U=new MutationObserver(V);return o&&U.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",N),document.removeEventListener("focusout",G),U.disconnect()}}},[n,o,D.paused]),Z.useEffect(()=>{if(o){GV.add(D);const N=document.activeElement;if(!o.contains(N)){const G=new CustomEvent(wI,VV);o.addEventListener(wI,w),o.dispatchEvent(G),G.defaultPrevented||(ybe(wbe(hY(o)),{select:!0}),document.activeElement===N&&Vd(o))}return()=>{o.removeEventListener(wI,w),setTimeout(()=>{const G=new CustomEvent(SI,VV);o.addEventListener(SI,T),o.dispatchEvent(G),G.defaultPrevented||Vd(N??document.body,{select:!0}),o.removeEventListener(SI,T),GV.remove(D)},0)}}},[o,w,T,D]);const B=Z.useCallback(N=>{if(!r&&!n||D.paused)return;const G=N.key==="Tab"&&!N.altKey&&!N.ctrlKey&&!N.metaKey,V=document.activeElement;if(G&&V){const U=N.currentTarget,[X,Y]=_be(U);X&&Y?!N.shiftKey&&V===Y?(N.preventDefault(),r&&Vd(X,{select:!0})):N.shiftKey&&V===X&&(N.preventDefault(),r&&Vd(Y,{select:!0})):V===U&&N.preventDefault()}},[r,n,D.paused]);return C.jsx(fn.div,{tabIndex:-1,...p,ref:O,onKeyDown:B})});J3.displayName=gbe;function ybe(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(Vd(n,{select:t}),document.activeElement!==r)return}function _be(e){const t=hY(e),r=$V(t,e),n=$V(t.reverse(),e);return[r,n]}function hY(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const c=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||c?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function $V(e,t){for(const r of e)if(!vbe(r,{upTo:t}))return r}function vbe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function xbe(e){return e instanceof HTMLInputElement&&"select"in e}function Vd(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&xbe(e)&&t&&e.select()}}var GV=bbe();function bbe(){let e=[];return{add(t){const r=e[0];t!==r&&r?.pause(),e=qV(e,t),e.unshift(t)},remove(t){e=qV(e,t),e[0]?.resume()}}}function qV(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function wbe(e){return e.filter(t=>t.tagName!=="A")}var Sbe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},gy=new WeakMap,qT=new WeakMap,HT={},TI=0,dY=function(e){return e&&(e.host||dY(e.parentNode))},Tbe=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=dY(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},Ebe=function(e,t,r,n){var c=Tbe(t,Array.isArray(e)?e:[e]);HT[r]||(HT[r]=new WeakMap);var h=HT[r],p=[],o=new Set,v=new Set(c),w=function(M){!M||o.has(M)||(o.add(M),w(M.parentNode))};c.forEach(w);var T=function(M){!M||v.has(M)||Array.prototype.forEach.call(M.children,function(O){if(o.has(O))T(O);else try{var D=O.getAttribute(n),B=D!==null&&D!=="false",N=(gy.get(O)||0)+1,G=(h.get(O)||0)+1;gy.set(O,N),h.set(O,G),p.push(O),N===1&&B&&qT.set(O,!0),G===1&&O.setAttribute(r,"true"),B||O.setAttribute(n,"true")}catch(V){console.error("aria-hidden: cannot operate on ",O,V)}})};return T(t),o.clear(),TI++,function(){p.forEach(function(M){var O=gy.get(M)-1,D=h.get(M)-1;gy.set(M,O),h.set(M,D),O||(qT.has(M)||M.removeAttribute(n),qT.delete(M)),D||M.removeAttribute(r)}),TI--,TI||(gy=new WeakMap,gy=new WeakMap,qT=new WeakMap,HT={})}},fY=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),c=Sbe(e);return c?(n.push.apply(n,Array.from(c.querySelectorAll("[aria-live], script"))),Ebe(n,c,r,"aria-hidden")):function(){return null}},du=function(){return du=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c])}return e},du.apply(this,arguments)};function pY(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(e);c<n.length;c++)t.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(e,n[c])&&(r[n[c]]=e[n[c]]);return r}function Abe(e,t,r){for(var n=0,c=t.length,h;n<c;n++)(h||!(n in t))&&(h||(h=Array.prototype.slice.call(t,0,n)),h[n]=t[n]);return e.concat(h||Array.prototype.slice.call(t))}var M2="right-scroll-bar-position",I2="width-before-scroll-bar",kbe="with-scroll-bars-hidden",Cbe="--removed-body-scroll-bar-size";function EI(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Pbe(e,t){var r=Z.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var c=r.value;c!==n&&(r.value=n,r.callback(n,c))}}}})[0];return r.callback=t,r.facade}var Mbe=typeof window<"u"?Z.useLayoutEffect:Z.useEffect,HV=new WeakMap;function Ibe(e,t){var r=Pbe(null,function(n){return e.forEach(function(c){return EI(c,n)})});return Mbe(function(){var n=HV.get(r);if(n){var c=new Set(n),h=new Set(e),p=r.current;c.forEach(function(o){h.has(o)||EI(o,null)}),h.forEach(function(o){c.has(o)||EI(o,p)})}HV.set(r,e)},[e]),r}function Obe(e){return e}function jbe(e,t){t===void 0&&(t=Obe);var r=[],n=!1,c={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(h){var p=t(h,n);return r.push(p),function(){r=r.filter(function(o){return o!==p})}},assignSyncMedium:function(h){for(n=!0;r.length;){var p=r;r=[],p.forEach(h)}r={push:function(o){return h(o)},filter:function(){return r}}},assignMedium:function(h){n=!0;var p=[];if(r.length){var o=r;r=[],o.forEach(h),p=r}var v=function(){var T=p;p=[],T.forEach(h)},w=function(){return Promise.resolve().then(v)};w(),r={push:function(T){p.push(T),w()},filter:function(T){return p=p.filter(T),r}}}};return c}function Rbe(e){e===void 0&&(e={});var t=jbe(null);return t.options=du({async:!0,ssr:!1},e),t}var mY=function(e){var t=e.sideCar,r=pY(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return Z.createElement(n,du({},r))};mY.isSideCarExport=!0;function Dbe(e,t){return e.useMedium(t),mY}var gY=Rbe(),AI=function(){},xk=Z.forwardRef(function(e,t){var r=Z.useRef(null),n=Z.useState({onScrollCapture:AI,onWheelCapture:AI,onTouchMoveCapture:AI}),c=n[0],h=n[1],p=e.forwardProps,o=e.children,v=e.className,w=e.removeScrollBar,T=e.enabled,M=e.shards,O=e.sideCar,D=e.noRelative,B=e.noIsolation,N=e.inert,G=e.allowPinchZoom,V=e.as,U=V===void 0?"div":V,X=e.gapMode,Y=pY(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),ne=O,se=Ibe([r,t]),le=du(du({},Y),c);return Z.createElement(Z.Fragment,null,T&&Z.createElement(ne,{sideCar:gY,removeScrollBar:w,shards:M,noRelative:D,noIsolation:B,inert:N,setCallbacks:h,allowPinchZoom:!!G,lockRef:r,gapMode:X}),p?Z.cloneElement(Z.Children.only(o),du(du({},le),{ref:se})):Z.createElement(U,du({},le,{className:v,ref:se}),o))});xk.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};xk.classNames={fullWidth:I2,zeroRight:M2};var Lbe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function zbe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Lbe();return t&&e.setAttribute("nonce",t),e}function Nbe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function Fbe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Bbe=function(){var e=0,t=null;return{add:function(r){e==0&&(t=zbe())&&(Nbe(t,r),Fbe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Ube=function(){var e=Bbe();return function(t,r){Z.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},yY=function(){var e=Ube(),t=function(r){var n=r.styles,c=r.dynamic;return e(n,c),null};return t},Vbe={left:0,top:0,right:0,gap:0},kI=function(e){return parseInt(e||"",10)||0},$be=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],c=t[e==="padding"?"paddingRight":"marginRight"];return[kI(r),kI(n),kI(c)]},Gbe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Vbe;var t=$be(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},qbe=yY(),i_="data-scroll-locked",Hbe=function(e,t,r,n){var c=e.left,h=e.top,p=e.right,o=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(kbe,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(o,"px ").concat(n,`;
  }
  body[`).concat(i_,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(c,`px;
    padding-top: `).concat(h,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(o,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(M2,` {
    right: `).concat(o,"px ").concat(n,`;
  }
  
  .`).concat(I2,` {
    margin-right: `).concat(o,"px ").concat(n,`;
  }
  
  .`).concat(M2," .").concat(M2,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(I2," .").concat(I2,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(i_,`] {
    `).concat(Cbe,": ").concat(o,`px;
  }
`)},WV=function(){var e=parseInt(document.body.getAttribute(i_)||"0",10);return isFinite(e)?e:0},Wbe=function(){Z.useEffect(function(){return document.body.setAttribute(i_,(WV()+1).toString()),function(){var e=WV()-1;e<=0?document.body.removeAttribute(i_):document.body.setAttribute(i_,e.toString())}},[])},Zbe=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,c=n===void 0?"margin":n;Wbe();var h=Z.useMemo(function(){return Gbe(c)},[c]);return Z.createElement(qbe,{styles:Hbe(h,!t,c,r?"":"!important")})},Xj=!1;if(typeof window<"u")try{var WT=Object.defineProperty({},"passive",{get:function(){return Xj=!0,!0}});window.addEventListener("test",WT,WT),window.removeEventListener("test",WT,WT)}catch{Xj=!1}var yy=Xj?{passive:!1}:!1,Kbe=function(e){return e.tagName==="TEXTAREA"},_Y=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!Kbe(e)&&r[t]==="visible")},Xbe=function(e){return _Y(e,"overflowY")},Ybe=function(e){return _Y(e,"overflowX")},ZV=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var c=vY(e,n);if(c){var h=xY(e,n),p=h[1],o=h[2];if(p>o)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},Jbe=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},Qbe=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},vY=function(e,t){return e==="v"?Xbe(t):Ybe(t)},xY=function(e,t){return e==="v"?Jbe(t):Qbe(t)},ewe=function(e,t){return e==="h"&&t==="rtl"?-1:1},twe=function(e,t,r,n,c){var h=ewe(e,window.getComputedStyle(t).direction),p=h*n,o=r.target,v=t.contains(o),w=!1,T=p>0,M=0,O=0;do{if(!o)break;var D=xY(e,o),B=D[0],N=D[1],G=D[2],V=N-G-h*B;(B||V)&&vY(e,o)&&(M+=V,O+=B);var U=o.parentNode;o=U&&U.nodeType===Node.DOCUMENT_FRAGMENT_NODE?U.host:U}while(!v&&o!==document.body||v&&(t.contains(o)||t===o));return(T&&Math.abs(M)<1||!T&&Math.abs(O)<1)&&(w=!0),w},ZT=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},KV=function(e){return[e.deltaX,e.deltaY]},XV=function(e){return e&&"current"in e?e.current:e},rwe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},nwe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},iwe=0,_y=[];function owe(e){var t=Z.useRef([]),r=Z.useRef([0,0]),n=Z.useRef(),c=Z.useState(iwe++)[0],h=Z.useState(yY)[0],p=Z.useRef(e);Z.useEffect(function(){p.current=e},[e]),Z.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(c));var N=Abe([e.lockRef.current],(e.shards||[]).map(XV)).filter(Boolean);return N.forEach(function(G){return G.classList.add("allow-interactivity-".concat(c))}),function(){document.body.classList.remove("block-interactivity-".concat(c)),N.forEach(function(G){return G.classList.remove("allow-interactivity-".concat(c))})}}},[e.inert,e.lockRef.current,e.shards]);var o=Z.useCallback(function(N,G){if("touches"in N&&N.touches.length===2||N.type==="wheel"&&N.ctrlKey)return!p.current.allowPinchZoom;var V=ZT(N),U=r.current,X="deltaX"in N?N.deltaX:U[0]-V[0],Y="deltaY"in N?N.deltaY:U[1]-V[1],ne,se=N.target,le=Math.abs(X)>Math.abs(Y)?"h":"v";if("touches"in N&&le==="h"&&se.type==="range")return!1;var ge=ZV(le,se);if(!ge)return!0;if(ge?ne=le:(ne=le==="v"?"h":"v",ge=ZV(le,se)),!ge)return!1;if(!n.current&&"changedTouches"in N&&(X||Y)&&(n.current=ne),!ne)return!0;var je=n.current||ne;return twe(je,G,N,je==="h"?X:Y)},[]),v=Z.useCallback(function(N){var G=N;if(!(!_y.length||_y[_y.length-1]!==h)){var V="deltaY"in G?KV(G):ZT(G),U=t.current.filter(function(ne){return ne.name===G.type&&(ne.target===G.target||G.target===ne.shadowParent)&&rwe(ne.delta,V)})[0];if(U&&U.should){G.cancelable&&G.preventDefault();return}if(!U){var X=(p.current.shards||[]).map(XV).filter(Boolean).filter(function(ne){return ne.contains(G.target)}),Y=X.length>0?o(G,X[0]):!p.current.noIsolation;Y&&G.cancelable&&G.preventDefault()}}},[]),w=Z.useCallback(function(N,G,V,U){var X={name:N,delta:G,target:V,should:U,shadowParent:awe(V)};t.current.push(X),setTimeout(function(){t.current=t.current.filter(function(Y){return Y!==X})},1)},[]),T=Z.useCallback(function(N){r.current=ZT(N),n.current=void 0},[]),M=Z.useCallback(function(N){w(N.type,KV(N),N.target,o(N,e.lockRef.current))},[]),O=Z.useCallback(function(N){w(N.type,ZT(N),N.target,o(N,e.lockRef.current))},[]);Z.useEffect(function(){return _y.push(h),e.setCallbacks({onScrollCapture:M,onWheelCapture:M,onTouchMoveCapture:O}),document.addEventListener("wheel",v,yy),document.addEventListener("touchmove",v,yy),document.addEventListener("touchstart",T,yy),function(){_y=_y.filter(function(N){return N!==h}),document.removeEventListener("wheel",v,yy),document.removeEventListener("touchmove",v,yy),document.removeEventListener("touchstart",T,yy)}},[]);var D=e.removeScrollBar,B=e.inert;return Z.createElement(Z.Fragment,null,B?Z.createElement(h,{styles:nwe(c)}):null,D?Z.createElement(Zbe,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function awe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const swe=Dbe(gY,owe);var Q3=Z.forwardRef(function(e,t){return Z.createElement(xk,du({},e,{ref:t,sideCar:swe}))});Q3.classNames=xk.classNames;var lwe=[" ","Enter","ArrowUp","ArrowDown"],cwe=[" ","Enter"],xm="Select",[bk,wk,uwe]=LL(xm),[sv,hHe]=wc(xm,[uwe,XA]),Sk=XA(),[hwe,Tf]=sv(xm),[dwe,fwe]=sv(xm),bY=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:c,onOpenChange:h,value:p,defaultValue:o,onValueChange:v,dir:w,name:T,autoComplete:M,disabled:O,required:D,form:B}=e,N=Sk(t),[G,V]=Z.useState(null),[U,X]=Z.useState(null),[Y,ne]=Z.useState(!1),se=pk(w),[le,ge]=ym({prop:n,defaultProp:c??!1,onChange:h,caller:xm}),[je,ze]=ym({prop:p,defaultProp:o,onChange:v,caller:xm}),Ce=Z.useRef(null),Ke=G?B||!!G.closest("form"):!0,[Ye,Oe]=Z.useState(new Set),tt=Array.from(Ye).map(He=>He.props.value).join(";");return C.jsx(Lde,{...N,children:C.jsxs(hwe,{required:D,scope:t,trigger:G,onTriggerChange:V,valueNode:U,onValueNodeChange:X,valueNodeHasChildren:Y,onValueNodeHasChildrenChange:ne,contentId:hf(),value:je,onValueChange:ze,open:le,onOpenChange:ge,dir:se,triggerPointerDownPosRef:Ce,disabled:O,children:[C.jsx(bk.Provider,{scope:t,children:C.jsx(dwe,{scope:e.__scopeSelect,onNativeOptionAdd:Z.useCallback(He=>{Oe(lt=>new Set(lt).add(He))},[]),onNativeOptionRemove:Z.useCallback(He=>{Oe(lt=>{const rt=new Set(lt);return rt.delete(He),rt})},[]),children:r})}),Ke?C.jsxs(qY,{"aria-hidden":!0,required:D,tabIndex:-1,name:T,autoComplete:M,value:je,onChange:He=>ze(He.target.value),disabled:O,form:B,children:[je===void 0?C.jsx("option",{value:""}):null,Array.from(Ye)]},tt):null]})})};bY.displayName=xm;var wY="SelectTrigger",SY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...c}=e,h=Sk(r),p=Tf(wY,r),o=p.disabled||n,v=yi(t,p.onTriggerChange),w=wk(r),T=Z.useRef("touch"),[M,O,D]=WY(N=>{const G=w().filter(X=>!X.disabled),V=G.find(X=>X.value===p.value),U=ZY(G,N,V);U!==void 0&&p.onValueChange(U.value)}),B=N=>{o||(p.onOpenChange(!0),D()),N&&(p.triggerPointerDownPosRef.current={x:Math.round(N.pageX),y:Math.round(N.pageY)})};return C.jsx(jW,{asChild:!0,...h,children:C.jsx(fn.button,{type:"button",role:"combobox","aria-controls":p.contentId,"aria-expanded":p.open,"aria-required":p.required,"aria-autocomplete":"none",dir:p.dir,"data-state":p.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":HY(p.value)?"":void 0,...c,ref:v,onClick:Zr(c.onClick,N=>{N.currentTarget.focus(),T.current!=="mouse"&&B(N)}),onPointerDown:Zr(c.onPointerDown,N=>{T.current=N.pointerType;const G=N.target;G.hasPointerCapture(N.pointerId)&&G.releasePointerCapture(N.pointerId),N.button===0&&N.ctrlKey===!1&&N.pointerType==="mouse"&&(B(N),N.preventDefault())}),onKeyDown:Zr(c.onKeyDown,N=>{const G=M.current!=="";!(N.ctrlKey||N.altKey||N.metaKey)&&N.key.length===1&&O(N.key),!(G&&N.key===" ")&&lwe.includes(N.key)&&(B(),N.preventDefault())})})})});SY.displayName=wY;var TY="SelectValue",EY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:c,children:h,placeholder:p="",...o}=e,v=Tf(TY,r),{onValueNodeHasChildrenChange:w}=v,T=h!==void 0,M=yi(t,v.onValueNodeChange);return xa(()=>{w(T)},[w,T]),C.jsx(fn.span,{...o,ref:M,style:{pointerEvents:"none"},children:HY(v.value)?C.jsx(C.Fragment,{children:p}):h})});EY.displayName=TY;var pwe="SelectIcon",AY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...c}=e;return C.jsx(fn.span,{"aria-hidden":!0,...c,ref:t,children:n||"▼"})});AY.displayName=pwe;var mwe="SelectPortal",kY=e=>C.jsx(VA,{asChild:!0,...e});kY.displayName=mwe;var bm="SelectContent",CY=Z.forwardRef((e,t)=>{const r=Tf(bm,e.__scopeSelect),[n,c]=Z.useState();if(xa(()=>{c(new DocumentFragment)},[]),!r.open){const h=n;return h?Om.createPortal(C.jsx(PY,{scope:e.__scopeSelect,children:C.jsx(bk.Slot,{scope:e.__scopeSelect,children:C.jsx("div",{children:e.children})})}),h):null}return C.jsx(MY,{...e,ref:t})});CY.displayName=bm;var lc=10,[PY,Ef]=sv(bm),gwe="SelectContentImpl",ywe=g_("SelectContent.RemoveScroll"),MY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:c,onEscapeKeyDown:h,onPointerDownOutside:p,side:o,sideOffset:v,align:w,alignOffset:T,arrowPadding:M,collisionBoundary:O,collisionPadding:D,sticky:B,hideWhenDetached:N,avoidCollisions:G,...V}=e,U=Tf(bm,r),[X,Y]=Z.useState(null),[ne,se]=Z.useState(null),le=yi(t,Ft=>Y(Ft)),[ge,je]=Z.useState(null),[ze,Ce]=Z.useState(null),Ke=wk(r),[Ye,Oe]=Z.useState(!1),tt=Z.useRef(!1);Z.useEffect(()=>{if(X)return fY(X)},[X]),uY();const He=Z.useCallback(Ft=>{const[br,...Yt]=Ke().map(Ut=>Ut.ref.current),[Qt]=Yt.slice(-1),Sr=document.activeElement;for(const Ut of Ft)if(Ut===Sr||(Ut?.scrollIntoView({block:"nearest"}),Ut===br&&ne&&(ne.scrollTop=0),Ut===Qt&&ne&&(ne.scrollTop=ne.scrollHeight),Ut?.focus(),document.activeElement!==Sr))return},[Ke,ne]),lt=Z.useCallback(()=>He([ge,X]),[He,ge,X]);Z.useEffect(()=>{Ye&&lt()},[Ye,lt]);const{onOpenChange:rt,triggerPointerDownPosRef:ht}=U;Z.useEffect(()=>{if(X){let Ft={x:0,y:0};const br=Qt=>{Ft={x:Math.abs(Math.round(Qt.pageX)-(ht.current?.x??0)),y:Math.abs(Math.round(Qt.pageY)-(ht.current?.y??0))}},Yt=Qt=>{Ft.x<=10&&Ft.y<=10?Qt.preventDefault():X.contains(Qt.target)||rt(!1),document.removeEventListener("pointermove",br),ht.current=null};return ht.current!==null&&(document.addEventListener("pointermove",br),document.addEventListener("pointerup",Yt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",br),document.removeEventListener("pointerup",Yt,{capture:!0})}}},[X,rt,ht]),Z.useEffect(()=>{const Ft=()=>rt(!1);return window.addEventListener("blur",Ft),window.addEventListener("resize",Ft),()=>{window.removeEventListener("blur",Ft),window.removeEventListener("resize",Ft)}},[rt]);const[vt,mt]=WY(Ft=>{const br=Ke().filter(Sr=>!Sr.disabled),Yt=br.find(Sr=>Sr.ref.current===document.activeElement),Qt=ZY(br,Ft,Yt);Qt&&setTimeout(()=>Qt.ref.current.focus())}),ct=Z.useCallback((Ft,br,Yt)=>{const Qt=!tt.current&&!Yt;(U.value!==void 0&&U.value===br||Qt)&&(je(Ft),Qt&&(tt.current=!0))},[U.value]),Vt=Z.useCallback(()=>X?.focus(),[X]),xr=Z.useCallback((Ft,br,Yt)=>{const Qt=!tt.current&&!Yt;(U.value!==void 0&&U.value===br||Qt)&&Ce(Ft)},[U.value]),tn=n==="popper"?Yj:IY,Er=tn===Yj?{side:o,sideOffset:v,align:w,alignOffset:T,arrowPadding:M,collisionBoundary:O,collisionPadding:D,sticky:B,hideWhenDetached:N,avoidCollisions:G}:{};return C.jsx(PY,{scope:r,content:X,viewport:ne,onViewportChange:se,itemRefCallback:ct,selectedItem:ge,onItemLeave:Vt,itemTextRefCallback:xr,focusSelectedItem:lt,selectedItemText:ze,position:n,isPositioned:Ye,searchRef:vt,children:C.jsx(Q3,{as:ywe,allowPinchZoom:!0,children:C.jsx(J3,{asChild:!0,trapped:U.open,onMountAutoFocus:Ft=>{Ft.preventDefault()},onUnmountAutoFocus:Zr(c,Ft=>{U.trigger?.focus({preventScroll:!0}),Ft.preventDefault()}),children:C.jsx(Hw,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:h,onPointerDownOutside:p,onFocusOutside:Ft=>Ft.preventDefault(),onDismiss:()=>U.onOpenChange(!1),children:C.jsx(tn,{role:"listbox",id:U.contentId,"data-state":U.open?"open":"closed",dir:U.dir,onContextMenu:Ft=>Ft.preventDefault(),...V,...Er,onPlaced:()=>Oe(!0),ref:le,style:{display:"flex",flexDirection:"column",outline:"none",...V.style},onKeyDown:Zr(V.onKeyDown,Ft=>{const br=Ft.ctrlKey||Ft.altKey||Ft.metaKey;if(Ft.key==="Tab"&&Ft.preventDefault(),!br&&Ft.key.length===1&&mt(Ft.key),["ArrowUp","ArrowDown","Home","End"].includes(Ft.key)){let Yt=Ke().filter(Qt=>!Qt.disabled).map(Qt=>Qt.ref.current);if(["ArrowUp","End"].includes(Ft.key)&&(Yt=Yt.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ft.key)){const Qt=Ft.target,Sr=Yt.indexOf(Qt);Yt=Yt.slice(Sr+1)}setTimeout(()=>He(Yt)),Ft.preventDefault()}})})})})})})});MY.displayName=gwe;var _we="SelectItemAlignedPosition",IY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...c}=e,h=Tf(bm,r),p=Ef(bm,r),[o,v]=Z.useState(null),[w,T]=Z.useState(null),M=yi(t,le=>T(le)),O=wk(r),D=Z.useRef(!1),B=Z.useRef(!0),{viewport:N,selectedItem:G,selectedItemText:V,focusSelectedItem:U}=p,X=Z.useCallback(()=>{if(h.trigger&&h.valueNode&&o&&w&&N&&G&&V){const le=h.trigger.getBoundingClientRect(),ge=w.getBoundingClientRect(),je=h.valueNode.getBoundingClientRect(),ze=V.getBoundingClientRect();if(h.dir!=="rtl"){const Qt=ze.left-ge.left,Sr=je.left-Qt,Ut=le.left-Sr,Nn=le.width+Ut,Jr=Math.max(Nn,ge.width),Kr=window.innerWidth-lc,In=Wj(Sr,[lc,Math.max(lc,Kr-Jr)]);o.style.minWidth=Nn+"px",o.style.left=In+"px"}else{const Qt=ge.right-ze.right,Sr=window.innerWidth-je.right-Qt,Ut=window.innerWidth-le.right-Sr,Nn=le.width+Ut,Jr=Math.max(Nn,ge.width),Kr=window.innerWidth-lc,In=Wj(Sr,[lc,Math.max(lc,Kr-Jr)]);o.style.minWidth=Nn+"px",o.style.right=In+"px"}const Ce=O(),Ke=window.innerHeight-lc*2,Ye=N.scrollHeight,Oe=window.getComputedStyle(w),tt=parseInt(Oe.borderTopWidth,10),He=parseInt(Oe.paddingTop,10),lt=parseInt(Oe.borderBottomWidth,10),rt=parseInt(Oe.paddingBottom,10),ht=tt+He+Ye+rt+lt,vt=Math.min(G.offsetHeight*5,ht),mt=window.getComputedStyle(N),ct=parseInt(mt.paddingTop,10),Vt=parseInt(mt.paddingBottom,10),xr=le.top+le.height/2-lc,tn=Ke-xr,Er=G.offsetHeight/2,Ft=G.offsetTop+Er,br=tt+He+Ft,Yt=ht-br;if(br<=xr){const Qt=Ce.length>0&&G===Ce[Ce.length-1].ref.current;o.style.bottom="0px";const Sr=w.clientHeight-N.offsetTop-N.offsetHeight,Ut=Math.max(tn,Er+(Qt?Vt:0)+Sr+lt),Nn=br+Ut;o.style.height=Nn+"px"}else{const Qt=Ce.length>0&&G===Ce[0].ref.current;o.style.top="0px";const Sr=Math.max(xr,tt+N.offsetTop+(Qt?ct:0)+Er)+Yt;o.style.height=Sr+"px",N.scrollTop=br-xr+N.offsetTop}o.style.margin=`${lc}px 0`,o.style.minHeight=vt+"px",o.style.maxHeight=Ke+"px",n?.(),requestAnimationFrame(()=>D.current=!0)}},[O,h.trigger,h.valueNode,o,w,N,G,V,h.dir,n]);xa(()=>X(),[X]);const[Y,ne]=Z.useState();xa(()=>{w&&ne(window.getComputedStyle(w).zIndex)},[w]);const se=Z.useCallback(le=>{le&&B.current===!0&&(X(),U?.(),B.current=!1)},[X,U]);return C.jsx(xwe,{scope:r,contentWrapper:o,shouldExpandOnScrollRef:D,onScrollButtonChange:se,children:C.jsx("div",{ref:v,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Y},children:C.jsx(fn.div,{...c,ref:M,style:{boxSizing:"border-box",maxHeight:"100%",...c.style}})})})});IY.displayName=_we;var vwe="SelectPopperPosition",Yj=Z.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:c=lc,...h}=e,p=Sk(r);return C.jsx(RW,{...p,...h,ref:t,align:n,collisionPadding:c,style:{boxSizing:"border-box",...h.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Yj.displayName=vwe;var[xwe,ez]=sv(bm,{}),Jj="SelectViewport",OY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...c}=e,h=Ef(Jj,r),p=ez(Jj,r),o=yi(t,h.onViewportChange),v=Z.useRef(0);return C.jsxs(C.Fragment,{children:[C.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),C.jsx(bk.Slot,{scope:r,children:C.jsx(fn.div,{"data-radix-select-viewport":"",role:"presentation",...c,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...c.style},onScroll:Zr(c.onScroll,w=>{const T=w.currentTarget,{contentWrapper:M,shouldExpandOnScrollRef:O}=p;if(O?.current&&M){const D=Math.abs(v.current-T.scrollTop);if(D>0){const B=window.innerHeight-lc*2,N=parseFloat(M.style.minHeight),G=parseFloat(M.style.height),V=Math.max(N,G);if(V<B){const U=V+D,X=Math.min(B,U),Y=U-X;M.style.height=X+"px",M.style.bottom==="0px"&&(T.scrollTop=Y>0?Y:0,M.style.justifyContent="flex-end")}}}v.current=T.scrollTop})})})]})});OY.displayName=Jj;var jY="SelectGroup",[bwe,wwe]=sv(jY),Swe=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,c=hf();return C.jsx(bwe,{scope:r,id:c,children:C.jsx(fn.div,{role:"group","aria-labelledby":c,...n,ref:t})})});Swe.displayName=jY;var RY="SelectLabel",DY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,c=wwe(RY,r);return C.jsx(fn.div,{id:c.id,...n,ref:t})});DY.displayName=RY;var wE="SelectItem",[Twe,LY]=sv(wE),zY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:c=!1,textValue:h,...p}=e,o=Tf(wE,r),v=Ef(wE,r),w=o.value===n,[T,M]=Z.useState(h??""),[O,D]=Z.useState(!1),B=yi(t,U=>v.itemRefCallback?.(U,n,c)),N=hf(),G=Z.useRef("touch"),V=()=>{c||(o.onValueChange(n),o.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return C.jsx(Twe,{scope:r,value:n,disabled:c,textId:N,isSelected:w,onItemTextChange:Z.useCallback(U=>{M(X=>X||(U?.textContent??"").trim())},[]),children:C.jsx(bk.ItemSlot,{scope:r,value:n,disabled:c,textValue:T,children:C.jsx(fn.div,{role:"option","aria-labelledby":N,"data-highlighted":O?"":void 0,"aria-selected":w&&O,"data-state":w?"checked":"unchecked","aria-disabled":c||void 0,"data-disabled":c?"":void 0,tabIndex:c?void 0:-1,...p,ref:B,onFocus:Zr(p.onFocus,()=>D(!0)),onBlur:Zr(p.onBlur,()=>D(!1)),onClick:Zr(p.onClick,()=>{G.current!=="mouse"&&V()}),onPointerUp:Zr(p.onPointerUp,()=>{G.current==="mouse"&&V()}),onPointerDown:Zr(p.onPointerDown,U=>{G.current=U.pointerType}),onPointerMove:Zr(p.onPointerMove,U=>{G.current=U.pointerType,c?v.onItemLeave?.():G.current==="mouse"&&U.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Zr(p.onPointerLeave,U=>{U.currentTarget===document.activeElement&&v.onItemLeave?.()}),onKeyDown:Zr(p.onKeyDown,U=>{v.searchRef?.current!==""&&U.key===" "||(cwe.includes(U.key)&&V(),U.key===" "&&U.preventDefault())})})})})});zY.displayName=wE;var ib="SelectItemText",NY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:c,...h}=e,p=Tf(ib,r),o=Ef(ib,r),v=LY(ib,r),w=fwe(ib,r),[T,M]=Z.useState(null),O=yi(t,V=>M(V),v.onItemTextChange,V=>o.itemTextRefCallback?.(V,v.value,v.disabled)),D=T?.textContent,B=Z.useMemo(()=>C.jsx("option",{value:v.value,disabled:v.disabled,children:D},v.value),[v.disabled,v.value,D]),{onNativeOptionAdd:N,onNativeOptionRemove:G}=w;return xa(()=>(N(B),()=>G(B)),[N,G,B]),C.jsxs(C.Fragment,{children:[C.jsx(fn.span,{id:v.textId,...h,ref:O}),v.isSelected&&p.valueNode&&!p.valueNodeHasChildren?Om.createPortal(h.children,p.valueNode):null]})});NY.displayName=ib;var FY="SelectItemIndicator",BY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return LY(FY,r).isSelected?C.jsx(fn.span,{"aria-hidden":!0,...n,ref:t}):null});BY.displayName=FY;var Qj="SelectScrollUpButton",UY=Z.forwardRef((e,t)=>{const r=Ef(Qj,e.__scopeSelect),n=ez(Qj,e.__scopeSelect),[c,h]=Z.useState(!1),p=yi(t,n.onScrollButtonChange);return xa(()=>{if(r.viewport&&r.isPositioned){let o=function(){const w=v.scrollTop>0;h(w)};const v=r.viewport;return o(),v.addEventListener("scroll",o),()=>v.removeEventListener("scroll",o)}},[r.viewport,r.isPositioned]),c?C.jsx($Y,{...e,ref:p,onAutoScroll:()=>{const{viewport:o,selectedItem:v}=r;o&&v&&(o.scrollTop=o.scrollTop-v.offsetHeight)}}):null});UY.displayName=Qj;var eR="SelectScrollDownButton",VY=Z.forwardRef((e,t)=>{const r=Ef(eR,e.__scopeSelect),n=ez(eR,e.__scopeSelect),[c,h]=Z.useState(!1),p=yi(t,n.onScrollButtonChange);return xa(()=>{if(r.viewport&&r.isPositioned){let o=function(){const w=v.scrollHeight-v.clientHeight,T=Math.ceil(v.scrollTop)<w;h(T)};const v=r.viewport;return o(),v.addEventListener("scroll",o),()=>v.removeEventListener("scroll",o)}},[r.viewport,r.isPositioned]),c?C.jsx($Y,{...e,ref:p,onAutoScroll:()=>{const{viewport:o,selectedItem:v}=r;o&&v&&(o.scrollTop=o.scrollTop+v.offsetHeight)}}):null});VY.displayName=eR;var $Y=Z.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...c}=e,h=Ef("SelectScrollButton",r),p=Z.useRef(null),o=wk(r),v=Z.useCallback(()=>{p.current!==null&&(window.clearInterval(p.current),p.current=null)},[]);return Z.useEffect(()=>()=>v(),[v]),xa(()=>{o().find(w=>w.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[o]),C.jsx(fn.div,{"aria-hidden":!0,...c,ref:t,style:{flexShrink:0,...c.style},onPointerDown:Zr(c.onPointerDown,()=>{p.current===null&&(p.current=window.setInterval(n,50))}),onPointerMove:Zr(c.onPointerMove,()=>{h.onItemLeave?.(),p.current===null&&(p.current=window.setInterval(n,50))}),onPointerLeave:Zr(c.onPointerLeave,()=>{v()})})}),Ewe="SelectSeparator",GY=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return C.jsx(fn.div,{"aria-hidden":!0,...n,ref:t})});GY.displayName=Ewe;var tR="SelectArrow",Awe=Z.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,c=Sk(r),h=Tf(tR,r),p=Ef(tR,r);return h.open&&p.position==="popper"?C.jsx(DW,{...c,...n,ref:t}):null});Awe.displayName=tR;var kwe="SelectBubbleInput",qY=Z.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const c=Z.useRef(null),h=yi(n,c),p=eY(t);return Z.useEffect(()=>{const o=c.current;if(!o)return;const v=window.HTMLSelectElement.prototype,w=Object.getOwnPropertyDescriptor(v,"value").set;if(p!==t&&w){const T=new Event("change",{bubbles:!0});w.call(o,t),o.dispatchEvent(T)}},[p,t]),C.jsx(fn.select,{...r,style:{...A9,...r.style},ref:h,defaultValue:t})});qY.displayName=kwe;function HY(e){return e===""||e===void 0}function WY(e){const t=na(e),r=Z.useRef(""),n=Z.useRef(0),c=Z.useCallback(p=>{const o=r.current+p;t(o),function v(w){r.current=w,window.clearTimeout(n.current),w!==""&&(n.current=window.setTimeout(()=>v(""),1e3))}(o)},[t]),h=Z.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return Z.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,c,h]}function ZY(e,t,r){const n=t.length>1&&Array.from(t).every(o=>o===t[0])?t[0]:t,c=r?e.indexOf(r):-1;let h=Cwe(e,Math.max(c,0));n.length===1&&(h=h.filter(o=>o!==r));const p=h.find(o=>o.textValue.toLowerCase().startsWith(n.toLowerCase()));return p!==r?p:void 0}function Cwe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var Pwe=bY,KY=SY,Mwe=EY,Iwe=AY,Owe=kY,XY=CY,jwe=OY,YY=DY,JY=zY,Rwe=NY,Dwe=BY,QY=UY,eJ=VY,tJ=GY;const rR=Pwe,nR=Mwe,SE=Z.forwardRef(({className:e,children:t,...r},n)=>C.jsxs(KY,{ref:n,className:ln("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,C.jsx(Iwe,{asChild:!0,children:C.jsx(Zw,{className:"h-4 w-4 opacity-50"})})]}));SE.displayName=KY.displayName;const rJ=Z.forwardRef(({className:e,...t},r)=>C.jsx(QY,{ref:r,className:ln("flex cursor-default items-center justify-center py-1",e),...t,children:C.jsx(qA,{className:"h-4 w-4"})}));rJ.displayName=QY.displayName;const nJ=Z.forwardRef(({className:e,...t},r)=>C.jsx(eJ,{ref:r,className:ln("flex cursor-default items-center justify-center py-1",e),...t,children:C.jsx(Zw,{className:"h-4 w-4"})}));nJ.displayName=eJ.displayName;const TE=Z.forwardRef(({className:e,children:t,position:r="popper",...n},c)=>C.jsx(Owe,{children:C.jsxs(XY,{ref:c,className:ln("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[C.jsx(rJ,{}),C.jsx(jwe,{className:ln("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),C.jsx(nJ,{})]})}));TE.displayName=XY.displayName;const Lwe=Z.forwardRef(({className:e,...t},r)=>C.jsx(YY,{ref:r,className:ln("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));Lwe.displayName=YY.displayName;const fu=Z.forwardRef(({className:e,children:t,...r},n)=>C.jsxs(JY,{ref:n,className:ln("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[C.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:C.jsx(Dwe,{children:C.jsx(Fce,{className:"h-4 w-4"})})}),C.jsx(Rwe,{children:t})]}));fu.displayName=JY.displayName;const zwe=Z.forwardRef(({className:e,...t},r)=>C.jsx(tJ,{ref:r,className:ln("-mx-1 my-1 h-px bg-muted",e),...t}));zwe.displayName=tJ.displayName;var Nwe="Label",iJ=Z.forwardRef((e,t)=>C.jsx(fn.label,{...e,ref:t,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));iJ.displayName=Nwe;var oJ=iJ;const Fwe=Y_("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),iR=Z.forwardRef(({className:e,...t},r)=>C.jsx(oJ,{ref:r,className:ln(Fwe(),e),...t}));iR.displayName=oJ.displayName;const Bwe=({isOpen:e,onClose:t})=>{const[r,n]=Z.useState(!1),[c,h]=Z.useState(0),[p,o]=Z.useState(10),[v,w]=Z.useState(!0),[T,M]=Z.useState([]),[O,D]=Z.useState("checking"),[B,N]=Z.useState(null),[G,V]=Z.useState(!1),{preschools:U}=vo(),{toast:X}=DL(),{stats:Y,isLoading:ne,refresh:se}=dbe(),le=U.filter(Oe=>Oe.latitud===null||Oe.longitud===null||Oe.latitud===0||Oe.longitud===0),ge=async()=>{V(!0);try{const{data:Oe,error:tt}=await gn.functions.invoke("admin-stats");if(tt)throw tt;Oe&&Oe.database&&N({database:{totalPreschools:Oe.database.totalPreschools,missingCoordinates:Oe.database.missingCoordinates,withGoogleData:Oe.database.withGoogleData,withImages:Oe.database.withImages,coordinatesCoverage:Oe.database.coordinatesCoverage,googleDataCoverage:Oe.database.googleDataCoverage,imagesCoverage:Oe.database.imagesCoverage,userFavorites:Oe.database.userFavorites,searchHistory:Oe.database.searchHistory,googleDataEntries:Oe.database.googleDataEntries,imagesCount:Oe.database.imagesCount},storage:Oe.storage,activity:Oe.activity,systemHealth:{databaseOnline:Oe.systemHealth.databaseOnline,lastUpdated:Oe.systemHealth.lastUpdated}})}catch(Oe){console.error("Failed to load admin stats:",Oe),X({title:"Fel",description:"Kunde inte ladda administrativa statistik via admin-stats funktion",variant:"destructive"});try{const{data:tt,count:He}=await gn.from("Förskolor").select("id",{count:"exact",head:!0}),{count:lt}=await gn.from("Förskolor").select("id",{count:"exact",head:!0}).or("Latitud.is.null,Longitud.is.null,Latitud.eq.0,Longitud.eq.0"),{count:rt}=await gn.from("preschool_google_data").select("id",{count:"exact",head:!0}),{count:ht}=await gn.from("preschool_images").select("id",{count:"exact",head:!0}),vt=He||0,mt=lt||0,ct=rt||0,Vt=ht||0;N({database:{totalPreschools:vt,missingCoordinates:mt,withGoogleData:ct,withImages:Vt,coordinatesCoverage:vt>0?(vt-mt)/vt*100:0,googleDataCoverage:vt>0?ct/vt*100:0,imagesCoverage:vt>0?Vt/vt*100:0},systemHealth:{databaseOnline:!0,lastUpdated:new Date().toISOString()}})}catch(tt){console.error("Fallback stats loading also failed:",tt)}}finally{V(!1)}};hbe({onDataChange:ge,isEnabled:e});const je=async()=>{D("checking");try{const{data:Oe,error:tt}=await gn.from("Förskolor").select("count").limit(1);if(tt)throw tt;D("online")}catch(Oe){console.error("API Status check failed:",Oe),D("offline")}},ze=async()=>{if(!r){n(!0),h(0),M([]);try{const Oe=await gn.functions.invoke("fix-missing-geocoding",{body:{batchSize:p,dryRun:v}});if(Oe.error)throw Oe.error;const tt=Oe.data;M(tt.results||[]),h(100),X({title:v?"Test slutförd":"Geocoding slutförd",description:`Bearbetade ${tt.processed} förskolor. ${tt.success} lyckades, ${tt.errors} misslyckades.`,variant:tt.success>0?"default":"destructive"}),!v&&tt.success>0&&await ge()}catch(Oe){console.error("Geocoding failed:",Oe),X({title:"Geocoding misslyckades",description:Oe.message,variant:"destructive"})}finally{n(!1)}}},Ce=()=>{n(!1),h(0)},Ke=()=>{M([]),h(0)},Ye=async()=>{if(!le.length){X({title:"Inga förskolor att bearbeta",description:"Alla förskolor har redan koordinater"});return}n(!0),M([]);try{const Oe=await gn.functions.invoke("geocoding-service",{body:{preschools:le.slice(0,p).map(He=>({id:He.id,Namn:He.namn,Adress:He.adress,Kommun:He.kommun,Latitud:He.latitud,Longitud:He.longitud}))}});if(Oe.error)throw Oe.error;const tt=Oe.data;M(tt.results||[]),X({title:"Avancerad geocoding slutförd",description:`${tt.successful}/${tt.processed} förskolor geocodade framgångsrikt`,variant:tt.successful>0?"default":"destructive"}),await ge()}catch(Oe){console.error("Advanced geocoding failed:",Oe),X({title:"Avancerad geocoding misslyckades",description:Oe.message,variant:"destructive"})}finally{n(!1)}};return Z.useEffect(()=>{e&&(je(),ge())},[e]),e?C.jsx(Tc,{children:C.jsxs(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 glass-nav",children:[C.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:t}),C.jsx(Fr.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"absolute top-4 left-4 right-4 bottom-4 max-w-6xl mx-auto",children:C.jsxs(kn,{className:"h-full glass-card border-0 shadow-lg",children:[C.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border/20",children:[C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx(GL,{className:"h-6 w-6 text-primary"}),C.jsx("h2",{className:"text-2xl font-heading font-bold",children:"Admin Panel"}),C.jsx(sn,{variant:O==="online"?"default":"destructive",children:O==="online"?"Online":O==="offline"?"Offline":"Kontrollerar..."})]}),C.jsx(qr,{onClick:t,variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover-scale",children:C.jsx(Qa,{className:"h-4 w-4"})})]}),C.jsx("div",{className:"flex-1 p-6",children:C.jsxs(Z3,{defaultValue:"overview",className:"h-full",children:[C.jsxs(_k,{className:"grid w-full grid-cols-3",children:[C.jsxs(Su,{value:"overview",children:[C.jsx(Ah,{className:"w-4 h-4 mr-2"}),"Översikt"]}),C.jsxs(Su,{value:"geocoding",children:[C.jsx(Ws,{className:"w-4 h-4 mr-2"}),"Koordinater"]}),C.jsxs(Su,{value:"system",children:[C.jsx(v6,{className:"w-4 h-4 mr-2"}),"System"]})]}),C.jsx(Tu,{value:"overview",className:"mt-6",children:C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:G?C.jsxs("div",{className:"col-span-full flex items-center justify-center py-12",children:[C.jsx(qd,{className:"h-8 w-8 animate-spin text-primary"}),C.jsx("span",{className:"ml-2 font-heading",children:"Laddar statistik..."})]}):B?C.jsxs(C.Fragment,{children:[C.jsxs(kn,{className:"p-6 card-hover",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[C.jsx(VL,{className:"h-8 w-8 text-primary"}),C.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Databas"})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Totalt förskolor:"}),C.jsx(sn,{variant:"secondary",children:B.database.totalPreschools.toLocaleString()})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Saknar koordinater:"}),C.jsx(sn,{variant:B.database.missingCoordinates>0?"destructive":"default",children:B.database.missingCoordinates.toLocaleString()})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Koordinattäckning:"}),C.jsxs(sn,{variant:"default",children:[B.database.coordinatesCoverage.toFixed(1),"%"]})]})]})]}),C.jsxs(kn,{className:"p-6 card-hover",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[C.jsx(bs,{className:"h-8 w-8 text-yellow-500"}),C.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Google Data"})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Med Google data:"}),C.jsx(sn,{variant:"secondary",children:B.database.withGoogleData.toLocaleString()})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Datatäckning:"}),C.jsxs(sn,{variant:"default",children:[B.database.googleDataCoverage.toFixed(1),"%"]})]})]})]}),C.jsxs(kn,{className:"p-6 card-hover",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[C.jsx(Wce,{className:"h-8 w-8 text-green-500"}),C.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Bilder"})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Med bilder:"}),C.jsx(sn,{variant:"secondary",children:B.database.withImages.toLocaleString()})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Bildtäckning:"}),C.jsxs(sn,{variant:"default",children:[B.database.imagesCoverage.toFixed(1),"%"]})]}),B.database.imagesCount&&C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Totalt bilder:"}),C.jsx(sn,{variant:"outline",children:B.database.imagesCount.toLocaleString()})]})]})]}),B.database.userFavorites!==void 0&&C.jsxs(kn,{className:"p-6 card-hover",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[C.jsx(Rm,{className:"h-8 w-8 text-blue-500"}),C.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Användaraktivitet"})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Favoriter:"}),C.jsx(sn,{variant:"secondary",children:B.database.userFavorites.toLocaleString()})]}),B.database.searchHistory!==void 0&&C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Sökhistorik:"}),C.jsx(sn,{variant:"secondary",children:B.database.searchHistory.toLocaleString()})]})]})]}),B.storage&&C.jsxs(kn,{className:"p-6 card-hover",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[C.jsx(Hce,{className:"h-8 w-8 text-purple-500"}),C.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Lagring"})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Total storlek:"}),C.jsx(sn,{variant:"secondary",children:B.storage.totalSizeFormatted})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Buckets:"}),C.jsx(sn,{variant:"outline",children:B.storage.buckets.length})]})]})]}),B.activity&&B.activity.recentLogs.length>0&&C.jsxs(kn,{className:"p-6 card-hover col-span-full",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[C.jsx(iE,{className:"h-8 w-8 text-orange-500"}),C.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Senaste aktivitet"})]}),C.jsx(Zj,{className:"h-40",children:C.jsx("div",{className:"space-y-2",children:B.activity.recentLogs.slice(0,5).map((Oe,tt)=>C.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-muted/30",children:[C.jsx("span",{className:"text-sm text-muted-foreground truncate",children:Oe.message}),C.jsx(sn,{variant:"outline",className:"text-xs",children:new Date(Oe.created_at).toLocaleTimeString()})]},tt))})})]})]}):C.jsx("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"Kunde inte ladda statistik"})})}),C.jsx(Tu,{value:"geocoding",className:"mt-6",children:C.jsxs("div",{className:"space-y-6",children:[C.jsx(kn,{className:"glass-popup",children:C.jsxs("div",{className:"p-6",children:[C.jsxs("div",{className:"flex items-center justify-between mb-4",children:[C.jsx("h3",{className:"text-xl font-heading font-semibold",children:"Koordinat-statistik"}),C.jsxs(qr,{variant:"outline",size:"sm",onClick:se,disabled:ne,className:"flex items-center gap-2",children:[C.jsx(qd,{className:`h-4 w-4 ${ne?"animate-spin":""}`}),"Uppdatera"]})]}),ne?C.jsxs("div",{className:"flex items-center justify-center py-8",children:[C.jsx(qd,{className:"h-6 w-6 animate-spin"}),C.jsx("span",{className:"ml-2",children:"Laddar koordinatstatistik..."})]}):Y?C.jsxs("div",{className:"space-y-4",children:[C.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[C.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[C.jsx("div",{className:"text-2xl font-bold",children:Y.total}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Totalt förskolor"})]}),C.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[C.jsx("div",{className:"text-2xl font-bold text-green-600",children:Y.withCoordinates}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Med koordinater"})]}),C.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[C.jsx("div",{className:"text-2xl font-bold text-red-600",children:Y.missingCoordinates}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Saknar koordinater"})]}),C.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[C.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(Y.withCoordinates/Y.total*100),"%"]}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Täckning"})]})]}),Object.entries(Y.byKommun).filter(([Oe,tt])=>tt.missing>0).length>0&&C.jsxs("div",{className:"space-y-2",children:[C.jsx("h4",{className:"font-medium",children:"Kommuner med saknade koordinater:"}),C.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Object.entries(Y.byKommun).filter(([Oe,tt])=>tt.missing>0).sort((Oe,tt)=>tt[1].missing-Oe[1].missing).slice(0,10).map(([Oe,tt])=>C.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-background/30 rounded",children:[C.jsx("span",{className:"truncate font-medium",children:Oe}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("span",{className:"text-red-600 font-semibold",children:tt.missing}),C.jsxs("span",{className:"text-muted-foreground",children:["av ",tt.total]}),C.jsxs(sn,{variant:"outline",children:[tt.percentage,"%"]})]})]},Oe))})]})]}):C.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Kunde inte ladda koordinatstatistik"})]})}),C.jsx(mbe,{missingCoordinatesCount:le.length,onComplete:()=>{ge(),se(),X({title:"Koordinater uppdaterade",description:"Förskoledata har uppdaterats med nya koordinater."})}}),C.jsx(kn,{className:"glass-popup",children:C.jsxs("div",{className:"p-6",children:[C.jsxs("div",{className:"flex items-center justify-between mb-6",children:[C.jsxs("div",{children:[C.jsx("h3",{className:"text-xl font-heading font-semibold mb-2",children:"Äldre geocoding-verktyg"}),C.jsx("p",{className:"text-muted-foreground",children:"Fallback-verktyg för manuell geocoding-hantering"})]}),C.jsxs(sn,{variant:le.length>0?"destructive":"default",children:[le.length," saknar koordinater"]})]}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[C.jsxs("div",{className:"space-y-4",children:[C.jsxs("div",{children:[C.jsx(iR,{htmlFor:"batch-size",className:"font-heading font-medium",children:"Antal per omgång"}),C.jsxs(rR,{value:p.toString(),onValueChange:Oe=>o(Number(Oe)),children:[C.jsx(SE,{children:C.jsx(nR,{})}),C.jsxs(TE,{children:[C.jsx(fu,{value:"5",children:"5 förskolor"}),C.jsx(fu,{value:"10",children:"10 förskolor"}),C.jsx(fu,{value:"20",children:"20 förskolor"}),C.jsx(fu,{value:"50",children:"50 förskolor"})]})]})]}),C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx(sY,{id:"dry-run",checked:v,onCheckedChange:w}),C.jsx(iR,{htmlFor:"dry-run",className:"font-heading font-medium",children:"Test-läge (sparar inte)"})]})]}),C.jsxs("div",{className:"space-y-4",children:[C.jsxs("div",{className:"flex gap-2",children:[C.jsx(qr,{onClick:ze,disabled:r||le.length===0,className:"flex-1 hover-scale",variant:v?"outline":"default",children:r?C.jsxs(C.Fragment,{children:[C.jsx(qd,{className:"w-4 h-4 mr-2 animate-spin"}),"Kör..."]}):C.jsxs(C.Fragment,{children:[C.jsx(J9,{className:"w-4 h-4 mr-2"}),v?"Testa":"Kör"," Geocoding"]})}),r&&C.jsx(qr,{onClick:Ce,variant:"destructive",size:"sm",className:"hover-scale",children:C.jsx(Q9,{className:"w-4 h-4"})})]}),C.jsxs(qr,{onClick:Ye,disabled:r||le.length===0,variant:"secondary",className:"w-full hover-scale",children:[C.jsx(Z9,{className:"w-4 h-4 mr-2"}),"Avancerad Geocoding"]})]})]}),c>0&&C.jsxs("div",{className:"mb-6",children:[C.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[C.jsx("span",{className:"font-heading font-medium",children:"Framsteg"}),C.jsxs("span",{children:[c.toFixed(0),"%"]})]}),C.jsx(Y3,{value:c,className:"h-2"})]}),T.length>0&&C.jsxs("div",{children:[C.jsxs("div",{className:"flex justify-between items-center mb-4",children:[C.jsxs("h4",{className:"font-heading font-medium",children:["Resultat (",T.length,")"]}),C.jsxs(qr,{onClick:Ke,variant:"ghost",size:"sm",className:"hover-scale",children:[C.jsx(Qa,{className:"w-4 h-4 mr-1"}),"Rensa"]})]}),C.jsx(Zj,{className:"h-64 rounded-lg border",children:C.jsx("div",{className:"p-4 space-y-2",children:T.map((Oe,tt)=>C.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background/50 hover:bg-background/70 transition-colors",children:[C.jsxs("div",{className:"flex items-center gap-3",children:[Oe.status==="success"?C.jsx(Uce,{className:"w-4 h-4 text-green-500"}):C.jsx(Vce,{className:"w-4 h-4 text-red-500"}),C.jsxs("div",{children:[C.jsx("div",{className:"font-heading font-medium text-sm",children:Oe.name}),Oe.coordinates&&C.jsxs("div",{className:"text-xs text-muted-foreground",children:[Oe.coordinates.lat.toFixed(4),", ",Oe.coordinates.lng.toFixed(4)]}),Oe.error&&C.jsx("div",{className:"text-xs text-red-500",children:Oe.error})]})]}),C.jsx(sn,{variant:Oe.status==="success"?"default":"destructive",children:Oe.updated?"Sparad":Oe.status==="success"?"Test":"Fel"})]},tt))})})]})]})})]})}),C.jsx(Tu,{value:"system",className:"mt-6",children:C.jsxs("div",{className:"grid gap-6",children:[C.jsxs(kn,{className:"p-6 card-hover",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[C.jsx(iE,{className:"h-6 w-6 text-primary"}),C.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Systemhälsa"})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("span",{className:"text-muted-foreground",children:"Databas:"}),C.jsx(sn,{variant:O==="online"?"default":"destructive",children:O==="online"?"Online":"Offline"})]}),B&&C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("span",{className:"text-muted-foreground",children:"Senast uppdaterad:"}),C.jsx("span",{className:"text-sm",children:new Date(B.systemHealth.lastUpdated).toLocaleString("sv-SE")})]})]})]}),C.jsxs(kn,{className:"p-6 card-hover",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[C.jsx(iue,{className:"h-6 w-6 text-primary"}),C.jsx("h3",{className:"font-heading font-semibold text-lg",children:"Verktyg"})]}),C.jsxs("div",{className:"flex gap-3",children:[C.jsxs(qr,{onClick:ge,disabled:G,variant:"outline",className:"hover-scale",children:[G?C.jsx(qd,{className:"w-4 h-4 mr-2 animate-spin"}):C.jsx(qd,{className:"w-4 h-4 mr-2"}),"Uppdatera statistik"]}),C.jsxs(qr,{onClick:je,variant:"outline",className:"hover-scale",children:[C.jsx(v6,{className:"w-4 h-4 mr-2"}),"Kontrollera API"]})]})]})]})})]})})]})})]})}):null},Uwe=({className:e})=>{const[t,r]=Z.useState(!1),{preschools:n,filteredPreschools:c,visiblePreschools:h,searchFilters:p,mapZoom:o}=vo(),v=Z.useMemo(()=>{const O=o>8?h:c;if(O.length===0)return null;const D=O.reduce((Y,ne)=>Y+(ne.antal_barn||0),0)/O.length,B=O.filter(Y=>Y.personaltäthet&&Y.personaltäthet>0),N=B.length>0?B.reduce((Y,ne)=>Y+ne.personaltäthet,0)/B.length:0,G=O.filter(Y=>Y.andel_med_förskollärarexamen!=null),V=G.length>0?G.reduce((Y,ne)=>Y+(ne.andel_med_förskollärarexamen||0),0)/G.length:0,U=O.filter(Y=>Y.huvudman==="Kommunal").length,X=O.filter(Y=>Y.huvudman==="Enskild").length;return{total:O.length,avgChildren:Math.round(D),avgStaff:Number(N.toFixed(1)),avgExam:Math.round(V),municipal:U,privatCount:X}},[c,h,o]),w=Z.useMemo(()=>{if(n.length===0)return null;const O=n.reduce((V,U)=>V+(U.antal_barn||0),0)/n.length,D=n.filter(V=>V.personaltäthet&&V.personaltäthet>0),B=D.length>0?D.reduce((V,U)=>V+U.personaltäthet,0)/D.length:0,N=n.filter(V=>V.andel_med_förskollärarexamen!=null),G=N.length>0?N.reduce((V,U)=>V+(U.andel_med_förskollärarexamen||0),0)/N.length:0;return{avgChildren:Math.round(O),avgStaff:Number(B.toFixed(1)),avgExam:Math.round(G)}},[n]),T=(O,D,B=!0)=>{if(Math.abs(O-D)<D*.05)return C.jsx(Y9,{className:"w-3 h-3 text-muted-foreground"});const N=O>D;return(B?N:!N)?C.jsx(jm,{className:"w-3 h-3 text-green-600"}):C.jsx(tue,{className:"w-3 h-3 text-orange-500"})},M=()=>p.kommuner&&p.kommuner.length>0?`${p.kommuner[0]} vs Riket`:o>8?"Synliga vs Riket":"Aktuellt urval vs Riket";return!v||!w?null:C.jsx("div",{className:`fixed bottom-4 right-4 z-60 ${e}`,children:C.jsx(Tc,{mode:"wait",children:t?C.jsx(Fr.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{duration:.3,ease:"easeInOut"},children:C.jsxs(kn,{className:"w-80 p-4 bg-card/95 backdrop-blur-xl border-border/50 shadow-2xl",children:[C.jsxs("div",{className:"flex items-center justify-between mb-3",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(Ah,{className:"w-4 h-4"}),C.jsx("h3",{className:"font-medium text-sm",children:M()})]}),C.jsx(qr,{onClick:()=>r(!1),variant:"ghost",size:"icon",className:"w-6 h-6 rounded-full",children:C.jsx(Qa,{className:"w-3 h-3"})})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsx("span",{className:"text-sm text-muted-foreground",children:"Förskolor"}),C.jsx(sn,{variant:"outline",className:"text-xs",children:v.total})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsx("span",{className:"text-sm",children:"Barn/förskola"}),C.jsxs("div",{className:"flex items-center gap-1",children:[T(v.avgChildren,w.avgChildren),C.jsx("span",{className:"text-sm font-medium",children:v.avgChildren}),C.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",w.avgChildren,")"]})]})]}),C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsx("span",{className:"text-sm",children:"Personaltäthet"}),C.jsxs("div",{className:"flex items-center gap-1",children:[T(v.avgStaff,w.avgStaff),C.jsx("span",{className:"text-sm font-medium",children:v.avgStaff}),C.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",w.avgStaff,")"]})]})]}),C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsx("span",{className:"text-sm",children:"Lärarexamen %"}),C.jsxs("div",{className:"flex items-center gap-1",children:[T(v.avgExam,w.avgExam),C.jsxs("span",{className:"text-sm font-medium",children:[v.avgExam,"%"]}),C.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",w.avgExam,"%)"]})]})]})]}),C.jsxs("div",{className:"border-t border-border/50 pt-3",children:[C.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Huvudman"}),C.jsxs("div",{className:"flex justify-between",children:[C.jsxs("div",{className:"text-center",children:[C.jsx("div",{className:"text-sm font-medium",children:v.municipal}),C.jsx("div",{className:"text-xs text-muted-foreground",children:"Kommunal"})]}),C.jsxs("div",{className:"text-center",children:[C.jsx("div",{className:"text-sm font-medium",children:v.privatCount}),C.jsx("div",{className:"text-xs text-muted-foreground",children:"Enskild"})]})]})]})]})]})},"popup"):C.jsx(Fr.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2}},"button")})})},Vwe=({className:e})=>{const{layerVisibility:t,heatmapType:r,heatmapIntensity:n,showHeatmap:c,setLayerVisibility:h,setHeatmapType:p,setHeatmapIntensity:o,setShowHeatmap:v}=vo();return C.jsx(Fr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:`absolute top-4 right-4 z-10 ${e}`})},YV="m 145.3125,527.5 0.5,3.75 -0.5,2.75 -1.4375,-1.1875 -2.125,-0.4375 -1.625,2.4375 2.125,3.0625 1.8125,1.25 0.0625,2.25 -1.4375,0.875 -0.6875,1.8125 0.875,1.1875 1.625,-0.625 0,1.5 -0.875,0.8125 -2.25,0.25 2.25,2.6875 0.5625,1.6875 -0.8125,2.75 -0.9375,2.5 -1.75,0.0625 0.3125,2.5 -1.9375,1.5 0.4375,2.25 -0.875,1.8125 0.9375,3 2.125,1 -2.25,3.375 -0.875,2.5 0.125,2.0625 -0.5625,2.5 -0.75,4.1875 0.9375,-0.5625 0.6875,1.1875 -0.8125,0.9375 -1.0625,-0.9375 -1.0625,4.6875 -1.875,0.4375 -1.125,2.25 -0.3125,1.375 0.0625,2.1875 -0.9375,0.375 -0.625,2.125 -1.0625,1.125 -0.9375,3.125 -0.8125,3.6875 -1.0625,4.0625 -1.375,2.875 -1.125,0.75 -1.5625,3.4375 -1.6875,-1.5 -2,1.1875 -1.1875,-0.4375 1.625,-1.5625 0.4375,-1.375 -1.3125,-1.125 -2.5625,0.4375 -0.875,-0.625 -1.6875,0.625 -1,1 -1.1875,-1.3125 -0.625,1.1875 -1.8125,1 -0.5625,-2 -1.0625,0.375 -2.3125,0.375 -1.75,-0.0625 -0.9375,-1.125 -1,1.125 -1.8125,0.0625 -2.625,0.125 -1.9375,0.25",$we=({phase:e,progress:t,markerCount:r})=>{const[n]=Z.useState(()=>{const h=[];for(let p=0;p<120;p++){const o=50+Math.random()*190,v=50+Math.random()*500;let w=o;v<200&&(w=100+Math.random()*90),v>400&&(w=70+Math.random()*150),h.push({id:p,x:w,y:v,size:1.2+Math.random()*.8,delay:Math.random()*.8})}return h}),c=Math.floor(t/100*n.length);return C.jsxs("div",{className:"relative w-32 h-72 mx-auto",children:[C.jsxs("svg",{viewBox:"0 0 290 660",className:"w-full h-full drop-shadow-xl",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.15))"},children:[C.jsx(Fr.path,{d:YV,fill:"none",stroke:"url(#swedenBorderGradient)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"2000",initial:{strokeDashoffset:2e3},animate:{strokeDashoffset:e==="drawing"?2e3-t*20:0},transition:{duration:0,ease:"linear"},style:{willChange:"stroke-dashoffset",transform:"translateZ(0)"},filter:"url(#borderGlow)"}),C.jsx(Fr.path,{d:YV,fill:"url(#swedenFillGradient)",stroke:"none",initial:{opacity:0,scale:.95},animate:{opacity:e==="filling"||e==="markers"||e==="complete"?.2:0,scale:e==="filling"||e==="markers"||e==="complete"?1:.95},transition:{duration:.6,ease:"easeOut"},filter:"url(#innerGlow)"}),e==="markers"&&n.slice(0,c).map(h=>C.jsxs(Fr.g,{style:{willChange:"transform, opacity",transform:"translateZ(0)"},children:[C.jsx(Fr.circle,{cx:h.x,cy:h.y,r:h.size,fill:"hsl(0, 80%, 60%)",initial:{scale:0,opacity:0,y:h.y+8},animate:{scale:1,opacity:.9,y:h.y},transition:{delay:h.delay*.02,duration:.25,type:"spring",stiffness:800,damping:30},style:{willChange:"transform, opacity",transform:"translateZ(0)"},filter:"url(#markerGlow)"}),C.jsx(Fr.circle,{cx:h.x,cy:h.y,r:"0",fill:"none",stroke:"hsl(0, 75%, 65%)",strokeWidth:"1",opacity:"0.6",initial:{r:0,opacity:0},animate:{r:[0,h.size*4,0],opacity:[0,.8,0]},transition:{delay:h.delay*.02+.15,duration:1,ease:"easeOut"},style:{willChange:"transform, opacity",transform:"translateZ(0)"}})]},h.id)),C.jsxs("defs",{children:[C.jsxs("linearGradient",{id:"swedenBorderGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[C.jsx("stop",{offset:"0%",stopColor:"hsl(210, 100%, 50%)"}),C.jsx("stop",{offset:"50%",stopColor:"hsl(220, 90%, 55%)"}),C.jsx("stop",{offset:"100%",stopColor:"hsl(230, 80%, 60%)"})]}),C.jsxs("linearGradient",{id:"swedenFillGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[C.jsx("stop",{offset:"0%",stopColor:"hsl(210, 50%, 75%)"}),C.jsx("stop",{offset:"50%",stopColor:"hsl(220, 40%, 80%)"}),C.jsx("stop",{offset:"100%",stopColor:"hsl(230, 30%, 85%)"})]}),C.jsxs("filter",{id:"borderGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[C.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),C.jsxs("feMerge",{children:[C.jsx("feMergeNode",{in:"coloredBlur"}),C.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),C.jsxs("filter",{id:"markerGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[C.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),C.jsxs("feMerge",{children:[C.jsx("feMergeNode",{in:"coloredBlur"}),C.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),C.jsxs("filter",{id:"innerGlow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[C.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),C.jsxs("feMerge",{children:[C.jsx("feMergeNode",{in:"coloredBlur"}),C.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]})]}),e==="markers"&&C.jsx(Fr.div,{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2 bg-white/95 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg border border-red-100",initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.3,type:"spring",stiffness:400},children:C.jsxs(Fr.span,{className:"text-sm font-bold text-red-600",initial:{opacity:.8,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.15},children:[r.toLocaleString("sv-SE")," förskolor"]},r)})]})},Gwe=({step:e,isActive:t,isCompleted:r,index:n})=>{const c=e.icon;return C.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.08,duration:.5,type:"spring",stiffness:400},className:"text-center relative",children:[C.jsxs(Fr.div,{className:"w-12 h-12 rounded-xl flex items-center justify-center mb-2 mx-auto relative overflow-hidden",style:{backgroundColor:r?e.color:t?`${e.color}15`:"hsl(0, 0%, 96%)",border:t?`2px solid ${e.color}`:"2px solid transparent"},animate:{boxShadow:t?[`0 4px 20px ${e.color}25`,`0 8px 30px ${e.color}35`,`0 4px 20px ${e.color}25`]:"0 2px 8px rgba(0,0,0,0.05)",scale:t?[1,1.05,1]:1},transition:{boxShadow:{duration:2,repeat:1/0},scale:{duration:.6}},children:[C.jsx(Fr.div,{animate:{rotate:t?[0,5,-5,0]:0,scale:r?1.1:1},transition:{rotate:{duration:1,repeat:t?1/0:0},scale:{duration:.3}},children:C.jsx(c,{className:"w-5 h-5",style:{color:r?"white":t?e.color:"hsl(0, 0%, 60%)"}})}),r&&!t&&C.jsx(Fr.div,{className:"absolute top-0 right-0 w-3 h-3 bg-green-500 rounded-full flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:600},children:C.jsx("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:C.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),C.jsx(Fr.p,{className:"text-xs font-medium mb-1",animate:{color:r||t?"hsl(0, 0%, 20%)":"hsl(0, 0%, 60%)"},children:e.label}),C.jsx(Fr.p,{className:"text-xs opacity-70",animate:{opacity:t?1:.5},children:e.detail})]})},qwe=({onComplete:e})=>{const[t,r]=Z.useState("hidden"),[n,c]=Z.useState(0),[h,p]=Z.useState(0),[o,v]=Z.useState(0),[w,T]=Z.useState(0),[M,O]=Z.useState(!1),[D,B]=Z.useState(!1),{preschools:N}=vo(),G=N.length>0?N.length:8739;Z.useEffect(()=>{const U=X=>{console.error("Animation error:",X),B(!0),setTimeout(e,100)};return window.addEventListener("error",U),()=>window.removeEventListener("error",U)},[e]),Z.useEffect(()=>{const U=setTimeout(()=>{console.warn("Animation taking too long, forcing completion"),e()},8e3);return()=>clearTimeout(U)},[e]);const V=[{label:"Hämtar förskolor",detail:`${G.toLocaleString("sv-SE")} enheter`,icon:sm,color:"hsl(0, 80%, 60%)"},{label:"Öppnar data",detail:"Betyg & information",icon:VL,color:"hsl(210, 90%, 55%)"},{label:"Skapar karta",detail:"Interaktiv visning",icon:Ws,color:"hsl(85, 60%, 50%)"}];return Z.useEffect(()=>{try{console.log("🚀 Starting loading animation - background data fetching is now active");const U=[{time:0,action:()=>O(!0)},{time:200,action:()=>{r("drawing"),p(0)}},{time:900,action:()=>{r("filling"),p(1)}},{time:1300,action:()=>{r("markers"),p(2)}},{time:2100,action:()=>r("complete")},{time:2200,action:()=>O(!1)},{time:2500,action:()=>{console.log("✅ Loading animation complete - map should display with preloaded data"),e()}}].map(({time:X,action:Y})=>setTimeout(()=>{try{Y()}catch(ne){console.error("Timeline action error:",ne),B(!0),e()}},X));return()=>U.forEach(clearTimeout)}catch(U){console.error("Animation setup error:",U),B(!0),setTimeout(e,100)}},[e]),Z.useEffect(()=>{if(!M)return;const U=Date.now(),X=2e3;let Y;const ne=()=>{const se=Date.now()-U,le=Math.min(se/X,1);let ge;le<.8?ge=1-Math.pow(1-le/.8,2.5):ge=.95+(le-.8)/.2*.05;const je=Math.floor(G*ge);T(je),le<1?Y=requestAnimationFrame(ne):T(G)};return Y=requestAnimationFrame(ne),()=>cancelAnimationFrame(Y)},[M,G]),Z.useEffect(()=>{let U,X=Date.now();const Y=()=>{const ne=Date.now()-X;let se=0,le=0;switch(t){case"drawing":se=Math.min(ne/700*100,100);break;case"filling":se=100;break;case"markers":const ge=ne-0,je=Math.min(ge/800,1);let ze;je<.7?ze=1-Math.pow(1-je/.7,3):ze=.99+(je-.7)/.3*.01,se=ze*100,le=Math.floor(G*ze),v(le);break;default:se=0}c(se),(t==="drawing"||t==="markers")&&(U=requestAnimationFrame(Y))};return(t==="drawing"||t==="markers")&&(X=Date.now(),U=requestAnimationFrame(Y)),()=>{U&&cancelAnimationFrame(U)}},[t,G]),C.jsx(Tc,{children:M&&C.jsx(Fr.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95,filter:"blur(8px)"},transition:{duration:.4,ease:[.25,.46,.45,.94]},className:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50/50 to-indigo-50/30",style:{willChange:"transform, opacity",transform:"translateZ(0)",backfaceVisibility:"hidden",perspective:"1000px"},children:C.jsxs("div",{className:"text-center max-w-sm mx-auto px-6",children:[C.jsx($we,{phase:t,progress:n,markerCount:o}),C.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.6},className:"mb-6 mt-6 text-center",children:[C.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent mb-3",children:"Sveriges Förskolor"}),C.jsxs(Fr.div,{className:"mb-3",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.5},children:[C.jsx(Fr.div,{className:"text-4xl font-bold font-mono text-blue-700 mb-1",initial:{opacity:.9,scale:.98},animate:{opacity:1,scale:1},transition:{duration:.1},style:{willChange:"transform, opacity",transform:"translateZ(0)"},children:w.toLocaleString("sv-SE")},w),C.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"förskolor laddade"})]}),C.jsx("p",{className:"text-xs text-gray-500",children:"Interaktiv karta över hela Sverige"})]}),C.jsx("div",{className:"grid grid-cols-3 gap-6 mb-6",children:V.map((U,X)=>C.jsx(Gwe,{step:U,isActive:h===X,isCompleted:h>X,index:X},X))}),C.jsx("div",{className:"w-64 h-1.5 bg-gray-200 rounded-full mx-auto overflow-hidden",children:C.jsx(Fr.div,{className:"h-full bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 rounded-full",initial:{width:0},animate:{width:`${Math.min((h+1)/V.length*100,100)}%`},transition:{duration:.6,ease:"easeOut"}})})]})})})},Hwe=({isMapVisible:e,children:t,onTransitionComplete:r})=>(Z.useEffect(()=>{if(e){const n=setTimeout(()=>{r?.()},1e3);return()=>clearTimeout(n)}},[e,r]),C.jsxs(Fr.div,{initial:{opacity:0,scale:.95},animate:{opacity:e?1:0,scale:e?1:.95},transition:{duration:1,ease:[.25,.46,.45,.94]},className:"relative w-full h-full",children:[t,C.jsx(Fr.div,{initial:{opacity:1},animate:{opacity:e?0:1},transition:{duration:.8,delay:.2},className:"absolute inset-0 bg-gradient-to-br from-background/80 via-background/60 to-background/40 pointer-events-none",style:{backdropFilter:"blur(2px)",background:"linear-gradient(135deg, hsl(var(--background)/0.8) 0%, hsl(var(--background)/0.6) 50%, hsl(var(--background)/0.4) 100%)"}})]})),Wwe=({children:e,onClick:t,className:r,variant:n="default",size:c="default",disabled:h=!1})=>C.jsx(Fr.div,{whileHover:{scale:1.02},whileTap:{scale:.98},transition:{type:"spring",stiffness:400,damping:17},children:C.jsx(qr,{onClick:t,variant:n,size:c,disabled:h,className:ln("transition-all duration-200 hover:shadow-glow",r),children:e})}),Tk=cZ((e,t)=>({selectedPreschools:[],isOpen:!1,addToComparison:r=>{const n=t().selectedPreschools;n.length>=5||n.find(c=>c.id===r.id)||e({selectedPreschools:[...n,r]})},removeFromComparison:r=>{const n=t().selectedPreschools;e({selectedPreschools:n.filter(c=>c.id!==r)})},clearComparison:()=>{e({selectedPreschools:[]})},isInComparison:r=>t().selectedPreschools.some(n=>n.id===r),setIsOpen:r=>{e({isOpen:r})}})),Zwe=()=>{const{selectedPreschools:e,removeFromComparison:t,clearComparison:r,setIsOpen:n}=Tk(),[c,h]=Z.useState(!1);if(e.length===0)return null;const p=T=>{const M=e.map(O=>O[T]).filter(O=>O!=null);return M.length>0?M.reduce((O,D)=>O+D,0)/M.length:0},o=p("antal_barn"),v=p("personaltäthet"),w=p("andel_med_förskollärarexamen");return C.jsx(Tc,{children:C.jsx(Fr.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"fixed bottom-4 right-4 z-50",children:C.jsxs(kn,{className:"bg-card/95 backdrop-blur-lg shadow-nordic border-border/50 p-4 max-w-sm",children:[C.jsxs("div",{className:"flex items-center justify-between mb-3",children:[C.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2",children:[C.jsx(Ah,{className:"w-4 h-4"}),"Jämförelse"]}),C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx(qr,{variant:"ghost",size:"sm",onClick:()=>h(!c),className:"h-6 w-6 p-0",children:C.jsx(jm,{className:"h-3 w-3"})}),C.jsx(qr,{variant:"ghost",size:"sm",onClick:r,className:"h-6 w-6 p-0",children:C.jsx(Qa,{className:"h-3 w-3"})})]})]}),c&&e.length>=2&&C.jsxs(Fr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-3 p-2 bg-muted/30 rounded-md space-y-1",children:[C.jsxs("div",{className:"flex items-center justify-between text-xs",children:[C.jsxs("span",{className:"flex items-center gap-1",children:[C.jsx(Rm,{className:"w-3 h-3"}),"Snitt barn:"]}),C.jsx("span",{className:"font-medium",children:o.toFixed(0)})]}),C.jsxs("div",{className:"flex items-center justify-between text-xs",children:[C.jsxs("span",{className:"flex items-center gap-1",children:[C.jsx(bs,{className:"w-3 h-3"}),"Personal:"]}),C.jsx("span",{className:"font-medium",children:v.toFixed(1)})]}),C.jsxs("div",{className:"flex items-center justify-between text-xs",children:[C.jsxs("span",{className:"flex items-center gap-1",children:[C.jsx(BL,{className:"w-3 h-3"}),"Examen:"]}),C.jsxs("span",{className:"font-medium",children:[w.toFixed(0),"%"]})]})]}),C.jsx("div",{className:"space-y-2 mb-4",children:e.map(T=>C.jsxs("div",{className:"flex items-center justify-between bg-muted/50 rounded-md p-2",children:[C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsx("p",{className:"text-xs font-medium truncate",children:T.namn}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("p",{className:"text-xs text-muted-foreground truncate",children:T.kommun}),T.google_rating&&C.jsxs(sn,{variant:"outline",className:"text-xs h-4 px-1",children:["★ ",T.google_rating.toFixed(1)]})]})]}),C.jsx(qr,{variant:"ghost",size:"sm",onClick:()=>t(T.id),className:"h-5 w-5 p-0 ml-2",children:C.jsx(Qa,{className:"h-3 w-3"})})]},T.id))}),C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs(sn,{variant:"secondary",className:"text-xs",children:[e.length,"/5"]}),e.length>=2&&C.jsxs(qr,{onClick:()=>n(!0),size:"sm",className:"text-xs",children:["Jämför ",e.length," förskolor"]})]})]})})})};var Ek="Dialog",[aJ,dHe]=wc(Ek),[Kwe,Ec]=aJ(Ek),sJ=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:c,onOpenChange:h,modal:p=!0}=e,o=Z.useRef(null),v=Z.useRef(null),[w,T]=ym({prop:n,defaultProp:c??!1,onChange:h,caller:Ek});return C.jsx(Kwe,{scope:t,triggerRef:o,contentRef:v,contentId:hf(),titleId:hf(),descriptionId:hf(),open:w,onOpenChange:T,onOpenToggle:Z.useCallback(()=>T(M=>!M),[T]),modal:p,children:r})};sJ.displayName=Ek;var lJ="DialogTrigger",cJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(lJ,r),h=yi(t,c.triggerRef);return C.jsx(fn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":c.open,"aria-controls":c.contentId,"data-state":nz(c.open),...n,ref:h,onClick:Zr(e.onClick,c.onOpenToggle)})});cJ.displayName=lJ;var tz="DialogPortal",[Xwe,uJ]=aJ(tz,{forceMount:void 0}),hJ=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:c}=e,h=Ec(tz,t);return C.jsx(Xwe,{scope:t,forceMount:r,children:Z.Children.map(n,p=>C.jsx(Sc,{present:r||h.open,children:C.jsx(VA,{asChild:!0,container:c,children:p})}))})};hJ.displayName=tz;var EE="DialogOverlay",dJ=Z.forwardRef((e,t)=>{const r=uJ(EE,e.__scopeDialog),{forceMount:n=r.forceMount,...c}=e,h=Ec(EE,e.__scopeDialog);return h.modal?C.jsx(Sc,{present:n||h.open,children:C.jsx(Jwe,{...c,ref:t})}):null});dJ.displayName=EE;var Ywe=g_("DialogOverlay.RemoveScroll"),Jwe=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(EE,r);return C.jsx(Q3,{as:Ywe,allowPinchZoom:!0,shards:[c.contentRef],children:C.jsx(fn.div,{"data-state":nz(c.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),wm="DialogContent",fJ=Z.forwardRef((e,t)=>{const r=uJ(wm,e.__scopeDialog),{forceMount:n=r.forceMount,...c}=e,h=Ec(wm,e.__scopeDialog);return C.jsx(Sc,{present:n||h.open,children:h.modal?C.jsx(Qwe,{...c,ref:t}):C.jsx(e1e,{...c,ref:t})})});fJ.displayName=wm;var Qwe=Z.forwardRef((e,t)=>{const r=Ec(wm,e.__scopeDialog),n=Z.useRef(null),c=yi(t,r.contentRef,n);return Z.useEffect(()=>{const h=n.current;if(h)return fY(h)},[]),C.jsx(pJ,{...e,ref:c,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Zr(e.onCloseAutoFocus,h=>{h.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:Zr(e.onPointerDownOutside,h=>{const p=h.detail.originalEvent,o=p.button===0&&p.ctrlKey===!0;(p.button===2||o)&&h.preventDefault()}),onFocusOutside:Zr(e.onFocusOutside,h=>h.preventDefault())})}),e1e=Z.forwardRef((e,t)=>{const r=Ec(wm,e.__scopeDialog),n=Z.useRef(!1),c=Z.useRef(!1);return C.jsx(pJ,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:h=>{e.onCloseAutoFocus?.(h),h.defaultPrevented||(n.current||r.triggerRef.current?.focus(),h.preventDefault()),n.current=!1,c.current=!1},onInteractOutside:h=>{e.onInteractOutside?.(h),h.defaultPrevented||(n.current=!0,h.detail.originalEvent.type==="pointerdown"&&(c.current=!0));const p=h.target;r.triggerRef.current?.contains(p)&&h.preventDefault(),h.detail.originalEvent.type==="focusin"&&c.current&&h.preventDefault()}})}),pJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:c,onCloseAutoFocus:h,...p}=e,o=Ec(wm,r),v=Z.useRef(null),w=yi(t,v);return uY(),C.jsxs(C.Fragment,{children:[C.jsx(J3,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:c,onUnmountAutoFocus:h,children:C.jsx(Hw,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":nz(o.open),...p,ref:w,onDismiss:()=>o.onOpenChange(!1)})}),C.jsxs(C.Fragment,{children:[C.jsx(t1e,{titleId:o.titleId}),C.jsx(n1e,{contentRef:v,descriptionId:o.descriptionId})]})]})}),rz="DialogTitle",mJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(rz,r);return C.jsx(fn.h2,{id:c.titleId,...n,ref:t})});mJ.displayName=rz;var gJ="DialogDescription",yJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(gJ,r);return C.jsx(fn.p,{id:c.descriptionId,...n,ref:t})});yJ.displayName=gJ;var _J="DialogClose",vJ=Z.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,c=Ec(_J,r);return C.jsx(fn.button,{type:"button",...n,ref:t,onClick:Zr(e.onClick,()=>c.onOpenChange(!1))})});vJ.displayName=_J;function nz(e){return e?"open":"closed"}var xJ="DialogTitleWarning",[fHe,bJ]=Ble(xJ,{contentName:wm,titleName:rz,docsSlug:"dialog"}),t1e=({titleId:e})=>{const t=bJ(xJ),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return Z.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},r1e="DialogDescriptionWarning",n1e=({contentRef:e,descriptionId:t})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${bJ(r1e).contentName}}.`;return Z.useEffect(()=>{const n=e.current?.getAttribute("aria-describedby");t&&n&&(document.getElementById(t)||console.warn(r))},[r,e,t]),null},wJ=sJ,i1e=cJ,SJ=hJ,Ak=dJ,kk=fJ,Ck=mJ,Pk=yJ,TJ=vJ;const o1e=wJ,a1e=SJ,EJ=Z.forwardRef(({className:e,...t},r)=>C.jsx(Ak,{ref:r,className:ln("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));EJ.displayName=Ak.displayName;const AJ=Z.forwardRef(({className:e,children:t,...r},n)=>C.jsxs(a1e,{children:[C.jsx(EJ,{}),C.jsxs(kk,{ref:n,className:ln("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,C.jsxs(TJ,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[C.jsx(Qa,{className:"h-4 w-4"}),C.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));AJ.displayName=kk.displayName;const kJ=({className:e,...t})=>C.jsx("div",{className:ln("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});kJ.displayName="DialogHeader";const CJ=Z.forwardRef(({className:e,...t},r)=>C.jsx(Ck,{ref:r,className:ln("text-lg font-semibold leading-none tracking-tight",e),...t}));CJ.displayName=Ck.displayName;const s1e=Z.forwardRef(({className:e,...t},r)=>C.jsx(Pk,{ref:r,className:ln("text-sm text-muted-foreground",e),...t}));s1e.displayName=Pk.displayName;const l1e=()=>{const{selectedPreschools:e,isOpen:t,setIsOpen:r,clearComparison:n}=Tk(),c=(v,w,T=!0)=>{const M=Math.min(...w.filter(N=>N>0)),O=Math.max(...w.filter(N=>N>0));if(M===O)return"bg-muted";const D=(v-M)/(O-M),B=T?D:1-D;return B>=.7?"bg-green-500":B>=.4?"bg-yellow-500":"bg-red-500"};if(!t||e.length<2)return null;const h=e.map(v=>v.google_rating||0),p=e.map(v=>v.personaltäthet||0),o=e.map(v=>v.andel_med_förskollärarexamen||0);return e.map(v=>v.antal_barn||0),C.jsx(o1e,{open:t,onOpenChange:r,children:C.jsxs(AJ,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[C.jsx(kJ,{children:C.jsxs(CJ,{className:"flex items-center gap-2",children:[C.jsx(Ah,{className:"w-5 h-5"}),"Jämför ",e.length," förskolor"]})}),C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"overflow-x-auto",children:C.jsxs("table",{className:"w-full border-collapse",children:[C.jsx("thead",{children:C.jsxs("tr",{className:"border-b",children:[C.jsx("th",{className:"text-left p-3 font-semibold",children:"Förskola"}),C.jsx("th",{className:"text-left p-3 font-semibold",children:"Huvudman"}),C.jsx("th",{className:"text-left p-3 font-semibold",children:"Kommun"}),C.jsx("th",{className:"text-left p-3 font-semibold",children:"Barn"})]})}),C.jsx("tbody",{children:e.map(v=>C.jsxs("tr",{className:"border-b",children:[C.jsx("td",{className:"p-3 font-medium",children:v.namn}),C.jsx("td",{className:"p-3",children:C.jsx(sn,{variant:"secondary",children:v.huvudman})}),C.jsx("td",{className:"p-3 text-muted-foreground",children:v.kommun}),C.jsx("td",{className:"p-3",children:v.antal_barn||"N/A"})]},v.id))})]})}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[C.jsxs(kn,{className:"p-4",children:[C.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[C.jsx(bs,{className:"w-4 h-4 text-yellow-500"}),"Google betyg"]}),C.jsx("div",{className:"space-y-3",children:e.map(v=>C.jsxs("div",{className:"space-y-1",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("span",{className:"text-sm font-medium truncate pr-2",children:v.namn}),C.jsx("span",{className:"text-sm font-bold",children:v.google_rating?.toFixed(1)||"N/A"})]}),v.google_rating&&C.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:C.jsx("div",{className:`h-2 rounded-full ${c(v.google_rating,h)}`,style:{width:`${v.google_rating/5*100}%`}})})]},v.id))})]}),C.jsxs(kn,{className:"p-4",children:[C.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[C.jsx(Rm,{className:"w-4 h-4 text-blue-500"}),"Personaltäthet"]}),C.jsx("div",{className:"space-y-3",children:e.map(v=>C.jsxs("div",{className:"space-y-1",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("span",{className:"text-sm font-medium truncate pr-2",children:v.namn}),C.jsx("span",{className:"text-sm font-bold",children:v.personaltäthet?.toFixed(1)||"N/A"})]}),v.personaltäthet&&C.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:C.jsx("div",{className:`h-2 rounded-full ${c(v.personaltäthet,p)}`,style:{width:`${Math.min(v.personaltäthet/Math.max(...p)*100,100)}%`}})})]},v.id))})]}),C.jsxs(kn,{className:"p-4",children:[C.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[C.jsx(K9,{className:"w-4 h-4 text-green-500"}),"Lärarexamen %"]}),C.jsx("div",{className:"space-y-3",children:e.map(v=>C.jsxs("div",{className:"space-y-1",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("span",{className:"text-sm font-medium truncate pr-2",children:v.namn}),C.jsxs("span",{className:"text-sm font-bold",children:[v.andel_med_förskollärarexamen?.toFixed(0),"% || 'N/A'"]})]}),v.andel_med_förskollärarexamen&&C.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:C.jsx("div",{className:`h-2 rounded-full ${c(v.andel_med_förskollärarexamen,o)}`,style:{width:`${v.andel_med_förskollärarexamen}%`}})})]},v.id))})]})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx(qr,{onClick:n,variant:"outline",children:"Rensa jämförelse"}),C.jsx(qr,{onClick:()=>r(!1),variant:"default",children:"Stäng"})]})]})]})})},c1e=wJ,u1e=i1e,h1e=SJ,PJ=Z.forwardRef(({className:e,...t},r)=>C.jsx(Ak,{className:ln("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));PJ.displayName=Ak.displayName;const d1e=Y_("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),MJ=Z.forwardRef(({side:e="right",className:t,children:r,...n},c)=>C.jsxs(h1e,{children:[C.jsx(PJ,{}),C.jsxs(kk,{ref:c,className:ln(d1e({side:e}),t),...n,children:[r,C.jsxs(TJ,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[C.jsx(Qa,{className:"h-4 w-4"}),C.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));MJ.displayName=kk.displayName;const f1e=Z.forwardRef(({className:e,...t},r)=>C.jsx(Ck,{ref:r,className:ln("text-lg font-semibold text-foreground",e),...t}));f1e.displayName=Ck.displayName;const p1e=Z.forwardRef(({className:e,...t},r)=>C.jsx(Pk,{ref:r,className:ln("text-sm text-muted-foreground",e),...t}));p1e.displayName=Pk.displayName;const m1e=()=>{const{filteredPreschools:e}=vo(),{selectedPreschools:t,setIsOpen:r}=Tk(),n=[{icon:tb,label:"Sök",action:()=>{const c=document.querySelector("[data-search-trigger]");c&&c.click()}},{icon:Kce,label:"Karta",action:()=>{window.scrollTo({top:0,behavior:"smooth"})}},{icon:Ah,label:"Statistik",action:()=>{const c=document.querySelector('[data-testid="statistics-button"]');c&&c.click()},badge:e.length},{icon:X9,label:"Jämför",action:()=>{t.length>0&&r(!0)},badge:t.length}];return C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-card border-t border-border md:hidden",children:C.jsx("div",{className:"grid grid-cols-4 gap-1 p-2",children:n.map(c=>C.jsxs(qr,{variant:"ghost",size:"sm",onClick:c.action,className:"flex flex-col items-center gap-1 h-auto p-2 relative",children:[C.jsx(c.icon,{className:"h-5 w-5"}),C.jsx("span",{className:"text-xs",children:c.label}),c.badge!==void 0&&c.badge>0&&C.jsx(sn,{variant:"secondary",className:"absolute -top-1 -right-1 h-5 w-5 p-0 text-xs flex items-center justify-center",children:c.badge>99?"99+":c.badge})]},c.label))})}),C.jsx("div",{className:"fixed top-0 left-0 right-0 z-40 bg-card/95 backdrop-blur border-b border-border md:hidden",children:C.jsxs("div",{className:"flex items-center justify-between p-4",children:[C.jsx("h1",{className:"text-lg font-bold",children:"Sveriges Förskolor"}),C.jsxs(c1e,{children:[C.jsx(u1e,{asChild:!0,children:C.jsx(qr,{variant:"ghost",size:"sm",children:C.jsx(Xce,{className:"h-5 w-5"})})}),C.jsx(MJ,{side:"right",className:"w-80",children:C.jsxs("div",{className:"space-y-4 mt-8",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx("h3",{className:"font-semibold",children:"Navigation"}),n.map(c=>C.jsxs(qr,{variant:"ghost",onClick:c.action,className:"w-full justify-start",children:[C.jsx(c.icon,{className:"h-4 w-4 mr-2"}),c.label,c.badge!==void 0&&c.badge>0&&C.jsx(sn,{variant:"secondary",className:"ml-auto",children:c.badge})]},c.label))]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx("h3",{className:"font-semibold",children:"Information"}),C.jsxs(qr,{variant:"ghost",className:"w-full justify-start",children:[C.jsx(Zce,{className:"h-4 w-4 mr-2"}),"Om tjänsten"]}),C.jsxs(qr,{variant:"ghost",className:"w-full justify-start",children:[C.jsx(GL,{className:"h-4 w-4 mr-2"}),"Inställningar"]})]})]})})]})]})})]})};var g1e=Array.isArray,Ks=g1e,y1e=typeof za=="object"&&za&&za.Object===Object&&za,IJ=y1e,_1e=IJ,v1e=typeof self=="object"&&self&&self.Object===Object&&self,x1e=_1e||v1e||Function("return this")(),Iu=x1e,b1e=Iu,w1e=b1e.Symbol,i1=w1e,JV=i1,OJ=Object.prototype,S1e=OJ.hasOwnProperty,T1e=OJ.toString,Ux=JV?JV.toStringTag:void 0;function E1e(e){var t=S1e.call(e,Ux),r=e[Ux];try{e[Ux]=void 0;var n=!0}catch{}var c=T1e.call(e);return n&&(t?e[Ux]=r:delete e[Ux]),c}var A1e=E1e,k1e=Object.prototype,C1e=k1e.toString;function P1e(e){return C1e.call(e)}var M1e=P1e,QV=i1,I1e=A1e,O1e=M1e,j1e="[object Null]",R1e="[object Undefined]",e8=QV?QV.toStringTag:void 0;function D1e(e){return e==null?e===void 0?R1e:j1e:e8&&e8 in Object(e)?I1e(e):O1e(e)}var Fh=D1e;function L1e(e){return e!=null&&typeof e=="object"}var Bh=L1e,z1e=Fh,N1e=Bh,F1e="[object Symbol]";function B1e(e){return typeof e=="symbol"||N1e(e)&&z1e(e)==F1e}var lv=B1e,U1e=Ks,V1e=lv,$1e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,G1e=/^\w*$/;function q1e(e,t){if(U1e(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||V1e(e)?!0:G1e.test(e)||!$1e.test(e)||t!=null&&e in Object(t)}var iz=q1e;function H1e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Af=H1e;const cv=ki(Af);var W1e=Fh,Z1e=Af,K1e="[object AsyncFunction]",X1e="[object Function]",Y1e="[object GeneratorFunction]",J1e="[object Proxy]";function Q1e(e){if(!Z1e(e))return!1;var t=W1e(e);return t==X1e||t==Y1e||t==K1e||t==J1e}var oz=Q1e;const Pn=ki(oz);var eSe=Iu,tSe=eSe["__core-js_shared__"],rSe=tSe,CI=rSe,t8=function(){var e=/[^.]+$/.exec(CI&&CI.keys&&CI.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function nSe(e){return!!t8&&t8 in e}var iSe=nSe,oSe=Function.prototype,aSe=oSe.toString;function sSe(e){if(e!=null){try{return aSe.call(e)}catch{}try{return e+""}catch{}}return""}var jJ=sSe,lSe=oz,cSe=iSe,uSe=Af,hSe=jJ,dSe=/[\\^$.*+?()[\]{}|]/g,fSe=/^\[object .+?Constructor\]$/,pSe=Function.prototype,mSe=Object.prototype,gSe=pSe.toString,ySe=mSe.hasOwnProperty,_Se=RegExp("^"+gSe.call(ySe).replace(dSe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function vSe(e){if(!uSe(e)||cSe(e))return!1;var t=lSe(e)?_Se:fSe;return t.test(hSe(e))}var xSe=vSe;function bSe(e,t){return e?.[t]}var wSe=bSe,SSe=xSe,TSe=wSe;function ESe(e,t){var r=TSe(e,t);return SSe(r)?r:void 0}var Lm=ESe,ASe=Lm,kSe=ASe(Object,"create"),Mk=kSe,r8=Mk;function CSe(){this.__data__=r8?r8(null):{},this.size=0}var PSe=CSe;function MSe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var ISe=MSe,OSe=Mk,jSe="__lodash_hash_undefined__",RSe=Object.prototype,DSe=RSe.hasOwnProperty;function LSe(e){var t=this.__data__;if(OSe){var r=t[e];return r===jSe?void 0:r}return DSe.call(t,e)?t[e]:void 0}var zSe=LSe,NSe=Mk,FSe=Object.prototype,BSe=FSe.hasOwnProperty;function USe(e){var t=this.__data__;return NSe?t[e]!==void 0:BSe.call(t,e)}var VSe=USe,$Se=Mk,GSe="__lodash_hash_undefined__";function qSe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=$Se&&t===void 0?GSe:t,this}var HSe=qSe,WSe=PSe,ZSe=ISe,KSe=zSe,XSe=VSe,YSe=HSe;function uv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}uv.prototype.clear=WSe;uv.prototype.delete=ZSe;uv.prototype.get=KSe;uv.prototype.has=XSe;uv.prototype.set=YSe;var JSe=uv;function QSe(){this.__data__=[],this.size=0}var eTe=QSe;function tTe(e,t){return e===t||e!==e&&t!==t}var az=tTe,rTe=az;function nTe(e,t){for(var r=e.length;r--;)if(rTe(e[r][0],t))return r;return-1}var Ik=nTe,iTe=Ik,oTe=Array.prototype,aTe=oTe.splice;function sTe(e){var t=this.__data__,r=iTe(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():aTe.call(t,r,1),--this.size,!0}var lTe=sTe,cTe=Ik;function uTe(e){var t=this.__data__,r=cTe(t,e);return r<0?void 0:t[r][1]}var hTe=uTe,dTe=Ik;function fTe(e){return dTe(this.__data__,e)>-1}var pTe=fTe,mTe=Ik;function gTe(e,t){var r=this.__data__,n=mTe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var yTe=gTe,_Te=eTe,vTe=lTe,xTe=hTe,bTe=pTe,wTe=yTe;function hv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}hv.prototype.clear=_Te;hv.prototype.delete=vTe;hv.prototype.get=xTe;hv.prototype.has=bTe;hv.prototype.set=wTe;var Ok=hv,STe=Lm,TTe=Iu,ETe=STe(TTe,"Map"),sz=ETe,n8=JSe,ATe=Ok,kTe=sz;function CTe(){this.size=0,this.__data__={hash:new n8,map:new(kTe||ATe),string:new n8}}var PTe=CTe;function MTe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var ITe=MTe,OTe=ITe;function jTe(e,t){var r=e.__data__;return OTe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var jk=jTe,RTe=jk;function DTe(e){var t=RTe(this,e).delete(e);return this.size-=t?1:0,t}var LTe=DTe,zTe=jk;function NTe(e){return zTe(this,e).get(e)}var FTe=NTe,BTe=jk;function UTe(e){return BTe(this,e).has(e)}var VTe=UTe,$Te=jk;function GTe(e,t){var r=$Te(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var qTe=GTe,HTe=PTe,WTe=LTe,ZTe=FTe,KTe=VTe,XTe=qTe;function dv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}dv.prototype.clear=HTe;dv.prototype.delete=WTe;dv.prototype.get=ZTe;dv.prototype.has=KTe;dv.prototype.set=XTe;var lz=dv,RJ=lz,YTe="Expected a function";function cz(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(YTe);var r=function(){var n=arguments,c=t?t.apply(this,n):n[0],h=r.cache;if(h.has(c))return h.get(c);var p=e.apply(this,n);return r.cache=h.set(c,p)||h,p};return r.cache=new(cz.Cache||RJ),r}cz.Cache=RJ;var DJ=cz;const JTe=ki(DJ);var QTe=DJ,e2e=500;function t2e(e){var t=QTe(e,function(n){return r.size===e2e&&r.clear(),n}),r=t.cache;return t}var r2e=t2e,n2e=r2e,i2e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o2e=/\\(\\)?/g,a2e=n2e(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(i2e,function(r,n,c,h){t.push(c?h.replace(o2e,"$1"):n||r)}),t}),s2e=a2e;function l2e(e,t){for(var r=-1,n=e==null?0:e.length,c=Array(n);++r<n;)c[r]=t(e[r],r,e);return c}var uz=l2e,i8=i1,c2e=uz,u2e=Ks,h2e=lv,o8=i8?i8.prototype:void 0,a8=o8?o8.toString:void 0;function LJ(e){if(typeof e=="string")return e;if(u2e(e))return c2e(e,LJ)+"";if(h2e(e))return a8?a8.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var d2e=LJ,f2e=d2e;function p2e(e){return e==null?"":f2e(e)}var zJ=p2e,m2e=Ks,g2e=iz,y2e=s2e,_2e=zJ;function v2e(e,t){return m2e(e)?e:g2e(e,t)?[e]:y2e(_2e(e))}var NJ=v2e,x2e=lv;function b2e(e){if(typeof e=="string"||x2e(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var Rk=b2e,w2e=NJ,S2e=Rk;function T2e(e,t){t=w2e(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[S2e(t[r++])];return r&&r==n?e:void 0}var hz=T2e,E2e=hz;function A2e(e,t,r){var n=e==null?void 0:E2e(e,t);return n===void 0?r:n}var FJ=A2e;const fl=ki(FJ);function k2e(e){return e==null}var C2e=k2e;const ni=ki(C2e);var P2e=Fh,M2e=Ks,I2e=Bh,O2e="[object String]";function j2e(e){return typeof e=="string"||!M2e(e)&&I2e(e)&&P2e(e)==O2e}var R2e=j2e;const Sm=ki(R2e);var BJ={exports:{}},Ni={};/**
* @license React
* react-is.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var dz=Symbol.for("react.element"),fz=Symbol.for("react.portal"),Dk=Symbol.for("react.fragment"),Lk=Symbol.for("react.strict_mode"),zk=Symbol.for("react.profiler"),Nk=Symbol.for("react.provider"),Fk=Symbol.for("react.context"),D2e=Symbol.for("react.server_context"),Bk=Symbol.for("react.forward_ref"),Uk=Symbol.for("react.suspense"),Vk=Symbol.for("react.suspense_list"),$k=Symbol.for("react.memo"),Gk=Symbol.for("react.lazy"),L2e=Symbol.for("react.offscreen"),UJ;UJ=Symbol.for("react.module.reference");function Ul(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case dz:switch(e=e.type,e){case Dk:case zk:case Lk:case Uk:case Vk:return e;default:switch(e=e&&e.$$typeof,e){case D2e:case Fk:case Bk:case Gk:case $k:case Nk:return e;default:return t}}case fz:return t}}}Ni.ContextConsumer=Fk;Ni.ContextProvider=Nk;Ni.Element=dz;Ni.ForwardRef=Bk;Ni.Fragment=Dk;Ni.Lazy=Gk;Ni.Memo=$k;Ni.Portal=fz;Ni.Profiler=zk;Ni.StrictMode=Lk;Ni.Suspense=Uk;Ni.SuspenseList=Vk;Ni.isAsyncMode=function(){return!1};Ni.isConcurrentMode=function(){return!1};Ni.isContextConsumer=function(e){return Ul(e)===Fk};Ni.isContextProvider=function(e){return Ul(e)===Nk};Ni.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===dz};Ni.isForwardRef=function(e){return Ul(e)===Bk};Ni.isFragment=function(e){return Ul(e)===Dk};Ni.isLazy=function(e){return Ul(e)===Gk};Ni.isMemo=function(e){return Ul(e)===$k};Ni.isPortal=function(e){return Ul(e)===fz};Ni.isProfiler=function(e){return Ul(e)===zk};Ni.isStrictMode=function(e){return Ul(e)===Lk};Ni.isSuspense=function(e){return Ul(e)===Uk};Ni.isSuspenseList=function(e){return Ul(e)===Vk};Ni.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Dk||e===zk||e===Lk||e===Uk||e===Vk||e===L2e||typeof e=="object"&&e!==null&&(e.$$typeof===Gk||e.$$typeof===$k||e.$$typeof===Nk||e.$$typeof===Fk||e.$$typeof===Bk||e.$$typeof===UJ||e.getModuleId!==void 0)};Ni.typeOf=Ul;BJ.exports=Ni;var z2e=BJ.exports,N2e=Fh,F2e=Bh,B2e="[object Number]";function U2e(e){return typeof e=="number"||F2e(e)&&N2e(e)==B2e}var VJ=U2e;const V2e=ki(VJ);var $2e=VJ;function G2e(e){return $2e(e)&&e!=+e}var q2e=G2e;const o1=ki(q2e);var ys=function(e){return e===0?0:e>0?1:-1},tm=function(e){return Sm(e)&&e.indexOf("%")===e.length-1},fr=function(e){return V2e(e)&&!o1(e)},H2e=function(e){return ni(e)},oa=function(e){return fr(e)||Sm(e)},W2e=0,a1=function(e){var t=++W2e;return"".concat(e||"").concat(t)},_s=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!fr(e)&&!Sm(e))return r;var c;if(tm(e)){var h=e.indexOf("%");c=t*parseFloat(e.slice(0,h))/100}else c=+e;return o1(c)&&(c=r),n&&c>t&&(c=t),c},Yd=function(e){if(!e)return null;var t=Object.keys(e);return t&&t.length?e[t[0]]:null},Z2e=function(e){if(!Array.isArray(e))return!1;for(var t=e.length,r={},n=0;n<t;n++)if(!r[e[n]])r[e[n]]=!0;else return!0;return!1},Hd=function(e,t){return fr(e)&&fr(t)?function(r){return e+r*(t-e)}:function(){return t}};function oR(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):fl(n,t))===r})}var K2e=function(e,t){return fr(e)&&fr(t)?e-t:Sm(e)&&Sm(t)?e.localeCompare(t):e instanceof Date&&t instanceof Date?e.getTime()-t.getTime():String(e).localeCompare(String(t))};function o_(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function aR(e){"@babel/helpers - typeof";return aR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aR(e)}var X2e=["viewBox","children"],Y2e=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],s8=["points","pathLength"],J2e={svg:X2e,polygon:s8,polyline:s8},pz=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],AE=function(e,t){if(!e||typeof e=="function"||typeof e=="boolean")return null;var r=e;if(Z.isValidElement(e)&&(r=e.props),!cv(r))return null;var n={};return Object.keys(r).forEach(function(c){pz.includes(c)&&(n[c]=t||function(h){return r[c](r,h)})}),n},Q2e=function(e,t,r){return function(n){return e(t,r,n),null}},Tm=function(e,t,r){if(!cv(e)||aR(e)!=="object")return null;var n=null;return Object.keys(e).forEach(function(c){var h=e[c];pz.includes(c)&&typeof h=="function"&&(n||(n={}),n[c]=Q2e(h,t,r))}),n},eEe=["children"],tEe=["children"];function l8(e,t){if(e==null)return{};var r=rEe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function rEe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var c8={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},xh=function(e){return typeof e=="string"?e:e?e.displayName||e.name||"Component":""},u8=null,PI=null,mz=function e(t){if(t===u8&&Array.isArray(PI))return PI;var r=[];return Z.Children.forEach(t,function(n){ni(n)||(z2e.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),PI=r,u8=t,r};function Ll(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(c){return xh(c)}):n=[xh(t)],mz(e).forEach(function(c){var h=fl(c,"type.displayName")||fl(c,"type.name");n.indexOf(h)!==-1&&r.push(c)}),r}function al(e,t){var r=Ll(e,t);return r&&r[0]}var h8=function(e){if(!e||!e.props)return!1;var t=e.props,r=t.width,n=t.height;return!(!fr(r)||r<=0||!fr(n)||n<=0)},nEe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],iEe=function(e){return e&&e.type&&Sm(e.type)&&nEe.indexOf(e.type)>=0},oEe=function(e,t,r,n){var c,h=(c=J2e?.[n])!==null&&c!==void 0?c:[];return t.startsWith("data-")||!Pn(e)&&(n&&h.includes(t)||Y2e.includes(t))||r&&pz.includes(t)},Sn=function(e,t,r){if(!e||typeof e=="function"||typeof e=="boolean")return null;var n=e;if(Z.isValidElement(e)&&(n=e.props),!cv(n))return null;var c={};return Object.keys(n).forEach(function(h){var p;oEe((p=n)===null||p===void 0?void 0:p[h],h,t,r)&&(c[h]=n[h])}),c},sR=function e(t,r){if(t===r)return!0;var n=Z.Children.count(t);if(n!==Z.Children.count(r))return!1;if(n===0)return!0;if(n===1)return d8(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var c=0;c<n;c++){var h=t[c],p=r[c];if(Array.isArray(h)||Array.isArray(p)){if(!e(h,p))return!1}else if(!d8(h,p))return!1}return!0},d8=function(e,t){if(ni(e)&&ni(t))return!0;if(!ni(e)&&!ni(t)){var r=e.props||{},n=r.children,c=l8(r,eEe),h=t.props||{},p=h.children,o=l8(h,tEe);return n&&p?o_(c,o)&&sR(n,p):!n&&!p?o_(c,o):!1}return!1},f8=function(e,t){var r=[],n={};return mz(e).forEach(function(c,h){if(iEe(c))r.push(c);else if(c){var p=xh(c.type),o=t[p]||{},v=o.handler,w=o.once;if(v&&(!w||!n[p])){var T=v(c,p,h);r.push(T),n[p]=!0}}}),r},aEe=function(e){var t=e&&e.type;return t&&c8[t]?c8[t]:null},sEe=function(e,t){return mz(t).indexOf(e)},lEe=["children","width","height","viewBox","className","style","title","desc"];function lR(){return lR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lR.apply(this,arguments)}function cEe(e,t){if(e==null)return{};var r=uEe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function uEe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function cR(e){var t=e.children,r=e.width,n=e.height,c=e.viewBox,h=e.className,p=e.style,o=e.title,v=e.desc,w=cEe(e,lEe),T=c||{width:r,height:n,x:0,y:0},M=Hn("recharts-surface",h);return Ne.createElement("svg",lR({},Sn(w,!0,"svg"),{className:M,width:r,height:n,style:p,viewBox:"".concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height)}),Ne.createElement("title",null,o),Ne.createElement("desc",null,v),t)}var hEe=["children","className"];function uR(){return uR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uR.apply(this,arguments)}function dEe(e,t){if(e==null)return{};var r=fEe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function fEe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Li=Ne.forwardRef(function(e,t){var r=e.children,n=e.className,c=dEe(e,hEe),h=Hn("recharts-layer",n);return Ne.createElement("g",uR({className:h},Sn(c,!0),{ref:t}),r)}),_c=function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),c=2;c<r;c++)n[c-2]=arguments[c]};function pEe(e,t,r){var n=-1,c=e.length;t<0&&(t=-t>c?0:c+t),r=r>c?c:r,r<0&&(r+=c),c=t>r?0:r-t>>>0,t>>>=0;for(var h=Array(c);++n<c;)h[n]=e[n+t];return h}var mEe=pEe,gEe=mEe;function yEe(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:gEe(e,t,r)}var _Ee=yEe,vEe="\\ud800-\\udfff",xEe="\\u0300-\\u036f",bEe="\\ufe20-\\ufe2f",wEe="\\u20d0-\\u20ff",SEe=xEe+bEe+wEe,TEe="\\ufe0e\\ufe0f",EEe="\\u200d",AEe=RegExp("["+EEe+vEe+SEe+TEe+"]");function kEe(e){return AEe.test(e)}var $J=kEe;function CEe(e){return e.split("")}var PEe=CEe,GJ="\\ud800-\\udfff",MEe="\\u0300-\\u036f",IEe="\\ufe20-\\ufe2f",OEe="\\u20d0-\\u20ff",jEe=MEe+IEe+OEe,REe="\\ufe0e\\ufe0f",DEe="["+GJ+"]",hR="["+jEe+"]",dR="\\ud83c[\\udffb-\\udfff]",LEe="(?:"+hR+"|"+dR+")",qJ="[^"+GJ+"]",HJ="(?:\\ud83c[\\udde6-\\uddff]){2}",WJ="[\\ud800-\\udbff][\\udc00-\\udfff]",zEe="\\u200d",ZJ=LEe+"?",KJ="["+REe+"]?",NEe="(?:"+zEe+"(?:"+[qJ,HJ,WJ].join("|")+")"+KJ+ZJ+")*",FEe=KJ+ZJ+NEe,BEe="(?:"+[qJ+hR+"?",hR,HJ,WJ,DEe].join("|")+")",UEe=RegExp(dR+"(?="+dR+")|"+BEe+FEe,"g");function VEe(e){return e.match(UEe)||[]}var $Ee=VEe,GEe=PEe,qEe=$J,HEe=$Ee;function WEe(e){return qEe(e)?HEe(e):GEe(e)}var ZEe=WEe,KEe=_Ee,XEe=$J,YEe=ZEe,JEe=zJ;function QEe(e){return function(t){t=JEe(t);var r=XEe(t)?YEe(t):void 0,n=r?r[0]:t.charAt(0),c=r?KEe(r,1).join(""):t.slice(1);return n[e]()+c}}var eAe=QEe,tAe=eAe,rAe=tAe("toUpperCase"),nAe=rAe;const qk=ki(nAe);function ao(e){return function(){return e}}const XJ=Math.cos,kE=Math.sin,Ac=Math.sqrt,CE=Math.PI,Hk=2*CE,fR=Math.PI,pR=2*fR,$p=1e-6,iAe=pR-$p;function YJ(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function oAe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return YJ;const r=10**t;return function(n){this._+=n[0];for(let c=1,h=n.length;c<h;++c)this._+=Math.round(arguments[c]*r)/r+n[c]}}class aAe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?YJ:oAe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,c){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+c}`}bezierCurveTo(t,r,n,c,h,p){this._append`C${+t},${+r},${+n},${+c},${this._x1=+h},${this._y1=+p}`}arcTo(t,r,n,c,h){if(t=+t,r=+r,n=+n,c=+c,h=+h,h<0)throw new Error(`negative radius: ${h}`);let p=this._x1,o=this._y1,v=n-t,w=c-r,T=p-t,M=o-r,O=T*T+M*M;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(O>$p)if(!(Math.abs(M*v-w*T)>$p)||!h)this._append`L${this._x1=t},${this._y1=r}`;else{let D=n-p,B=c-o,N=v*v+w*w,G=D*D+B*B,V=Math.sqrt(N),U=Math.sqrt(O),X=h*Math.tan((fR-Math.acos((N+O-G)/(2*V*U)))/2),Y=X/U,ne=X/V;Math.abs(Y-1)>$p&&this._append`L${t+Y*T},${r+Y*M}`,this._append`A${h},${h},0,0,${+(M*D>T*B)},${this._x1=t+ne*v},${this._y1=r+ne*w}`}}arc(t,r,n,c,h,p){if(t=+t,r=+r,n=+n,p=!!p,n<0)throw new Error(`negative radius: ${n}`);let o=n*Math.cos(c),v=n*Math.sin(c),w=t+o,T=r+v,M=1^p,O=p?c-h:h-c;this._x1===null?this._append`M${w},${T}`:(Math.abs(this._x1-w)>$p||Math.abs(this._y1-T)>$p)&&this._append`L${w},${T}`,n&&(O<0&&(O=O%pR+pR),O>iAe?this._append`A${n},${n},0,1,${M},${t-o},${r-v}A${n},${n},0,1,${M},${this._x1=w},${this._y1=T}`:O>$p&&this._append`A${n},${n},0,${+(O>=fR)},${M},${this._x1=t+n*Math.cos(h)},${this._y1=r+n*Math.sin(h)}`)}rect(t,r,n,c){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+c}h${-n}Z`}toString(){return this._}}function gz(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new aAe(t)}function yz(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function JJ(e){this._context=e}JJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Wk(e){return new JJ(e)}function QJ(e){return e[0]}function eQ(e){return e[1]}function tQ(e,t){var r=ao(!0),n=null,c=Wk,h=null,p=gz(o);e=typeof e=="function"?e:e===void 0?QJ:ao(e),t=typeof t=="function"?t:t===void 0?eQ:ao(t);function o(v){var w,T=(v=yz(v)).length,M,O=!1,D;for(n==null&&(h=c(D=p())),w=0;w<=T;++w)!(w<T&&r(M=v[w],w,v))===O&&((O=!O)?h.lineStart():h.lineEnd()),O&&h.point(+e(M,w,v),+t(M,w,v));if(D)return h=null,D+""||null}return o.x=function(v){return arguments.length?(e=typeof v=="function"?v:ao(+v),o):e},o.y=function(v){return arguments.length?(t=typeof v=="function"?v:ao(+v),o):t},o.defined=function(v){return arguments.length?(r=typeof v=="function"?v:ao(!!v),o):r},o.curve=function(v){return arguments.length?(c=v,n!=null&&(h=c(n)),o):c},o.context=function(v){return arguments.length?(v==null?n=h=null:h=c(n=v),o):n},o}function KT(e,t,r){var n=null,c=ao(!0),h=null,p=Wk,o=null,v=gz(w);e=typeof e=="function"?e:e===void 0?QJ:ao(+e),t=typeof t=="function"?t:ao(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?eQ:ao(+r);function w(M){var O,D,B,N=(M=yz(M)).length,G,V=!1,U,X=new Array(N),Y=new Array(N);for(h==null&&(o=p(U=v())),O=0;O<=N;++O){if(!(O<N&&c(G=M[O],O,M))===V)if(V=!V)D=O,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),B=O-1;B>=D;--B)o.point(X[B],Y[B]);o.lineEnd(),o.areaEnd()}V&&(X[O]=+e(G,O,M),Y[O]=+t(G,O,M),o.point(n?+n(G,O,M):X[O],r?+r(G,O,M):Y[O]))}if(U)return o=null,U+""||null}function T(){return tQ().defined(c).curve(p).context(h)}return w.x=function(M){return arguments.length?(e=typeof M=="function"?M:ao(+M),n=null,w):e},w.x0=function(M){return arguments.length?(e=typeof M=="function"?M:ao(+M),w):e},w.x1=function(M){return arguments.length?(n=M==null?null:typeof M=="function"?M:ao(+M),w):n},w.y=function(M){return arguments.length?(t=typeof M=="function"?M:ao(+M),r=null,w):t},w.y0=function(M){return arguments.length?(t=typeof M=="function"?M:ao(+M),w):t},w.y1=function(M){return arguments.length?(r=M==null?null:typeof M=="function"?M:ao(+M),w):r},w.lineX0=w.lineY0=function(){return T().x(e).y(t)},w.lineY1=function(){return T().x(e).y(r)},w.lineX1=function(){return T().x(n).y(t)},w.defined=function(M){return arguments.length?(c=typeof M=="function"?M:ao(!!M),w):c},w.curve=function(M){return arguments.length?(p=M,h!=null&&(o=p(h)),w):p},w.context=function(M){return arguments.length?(M==null?h=o=null:o=p(h=M),w):h},w}class rQ{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function sAe(e){return new rQ(e,!0)}function lAe(e){return new rQ(e,!1)}const _z={draw(e,t){const r=Ac(t/CE);e.moveTo(r,0),e.arc(0,0,r,0,Hk)}},cAe={draw(e,t){const r=Ac(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},nQ=Ac(1/3),uAe=nQ*2,hAe={draw(e,t){const r=Ac(t/uAe),n=r*nQ;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},dAe={draw(e,t){const r=Ac(t),n=-r/2;e.rect(n,n,r,r)}},fAe=.8908130915292852,iQ=kE(CE/10)/kE(7*CE/10),pAe=kE(Hk/10)*iQ,mAe=-XJ(Hk/10)*iQ,gAe={draw(e,t){const r=Ac(t*fAe),n=pAe*r,c=mAe*r;e.moveTo(0,-r),e.lineTo(n,c);for(let h=1;h<5;++h){const p=Hk*h/5,o=XJ(p),v=kE(p);e.lineTo(v*r,-o*r),e.lineTo(o*n-v*c,v*n+o*c)}e.closePath()}},MI=Ac(3),yAe={draw(e,t){const r=-Ac(t/(MI*3));e.moveTo(0,r*2),e.lineTo(-MI*r,-r),e.lineTo(MI*r,-r),e.closePath()}},Tl=-.5,El=Ac(3)/2,mR=1/Ac(12),_Ae=(mR/2+1)*3,vAe={draw(e,t){const r=Ac(t/_Ae),n=r/2,c=r*mR,h=n,p=r*mR+r,o=-h,v=p;e.moveTo(n,c),e.lineTo(h,p),e.lineTo(o,v),e.lineTo(Tl*n-El*c,El*n+Tl*c),e.lineTo(Tl*h-El*p,El*h+Tl*p),e.lineTo(Tl*o-El*v,El*o+Tl*v),e.lineTo(Tl*n+El*c,Tl*c-El*n),e.lineTo(Tl*h+El*p,Tl*p-El*h),e.lineTo(Tl*o+El*v,Tl*v-El*o),e.closePath()}};function xAe(e,t){let r=null,n=gz(c);e=typeof e=="function"?e:ao(e||_z),t=typeof t=="function"?t:ao(t===void 0?64:+t);function c(){let h;if(r||(r=h=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),h)return r=null,h+""||null}return c.type=function(h){return arguments.length?(e=typeof h=="function"?h:ao(h),c):e},c.size=function(h){return arguments.length?(t=typeof h=="function"?h:ao(+h),c):t},c.context=function(h){return arguments.length?(r=h??null,c):r},c}function PE(){}function ME(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function oQ(e){this._context=e}oQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:ME(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:ME(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function bAe(e){return new oQ(e)}function aQ(e){this._context=e}aQ.prototype={areaStart:PE,areaEnd:PE,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:ME(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function wAe(e){return new aQ(e)}function sQ(e){this._context=e}sQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:ME(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function SAe(e){return new sQ(e)}function lQ(e){this._context=e}lQ.prototype={areaStart:PE,areaEnd:PE,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function TAe(e){return new lQ(e)}function p8(e){return e<0?-1:1}function m8(e,t,r){var n=e._x1-e._x0,c=t-e._x1,h=(e._y1-e._y0)/(n||c<0&&-0),p=(r-e._y1)/(c||n<0&&-0),o=(h*c+p*n)/(n+c);return(p8(h)+p8(p))*Math.min(Math.abs(h),Math.abs(p),.5*Math.abs(o))||0}function g8(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function II(e,t,r){var n=e._x0,c=e._y0,h=e._x1,p=e._y1,o=(h-n)/3;e._context.bezierCurveTo(n+o,c+o*t,h-o,p-o*r,h,p)}function IE(e){this._context=e}IE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:II(this,this._t0,g8(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,II(this,g8(this,r=m8(this,e,t)),r);break;default:II(this,this._t0,r=m8(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function cQ(e){this._context=new uQ(e)}(cQ.prototype=Object.create(IE.prototype)).point=function(e,t){IE.prototype.point.call(this,t,e)};function uQ(e){this._context=e}uQ.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,c,h){this._context.bezierCurveTo(t,e,n,r,h,c)}};function EAe(e){return new IE(e)}function AAe(e){return new cQ(e)}function hQ(e){this._context=e}hQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=y8(e),c=y8(t),h=0,p=1;p<r;++h,++p)this._context.bezierCurveTo(n[0][h],c[0][h],n[1][h],c[1][h],e[p],t[p]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function y8(e){var t,r=e.length-1,n,c=new Array(r),h=new Array(r),p=new Array(r);for(c[0]=0,h[0]=2,p[0]=e[0]+2*e[1],t=1;t<r-1;++t)c[t]=1,h[t]=4,p[t]=4*e[t]+2*e[t+1];for(c[r-1]=2,h[r-1]=7,p[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=c[t]/h[t-1],h[t]-=n,p[t]-=n*p[t-1];for(c[r-1]=p[r-1]/h[r-1],t=r-2;t>=0;--t)c[t]=(p[t]-c[t+1])/h[t];for(h[r-1]=(e[r]+c[r-1])/2,t=0;t<r-1;++t)h[t]=2*e[t+1]-c[t+1];return[c,h]}function kAe(e){return new hQ(e)}function Zk(e,t){this._context=e,this._t=t}Zk.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function CAe(e){return new Zk(e,.5)}function PAe(e){return new Zk(e,0)}function MAe(e){return new Zk(e,1)}function w_(e,t){if((p=e.length)>1)for(var r=1,n,c,h=e[t[0]],p,o=h.length;r<p;++r)for(c=h,h=e[t[r]],n=0;n<o;++n)h[n][1]+=h[n][0]=isNaN(c[n][1])?c[n][0]:c[n][1]}function gR(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function IAe(e,t){return e[t]}function OAe(e){const t=[];return t.key=e,t}function jAe(){var e=ao([]),t=gR,r=w_,n=IAe;function c(h){var p=Array.from(e.apply(this,arguments),OAe),o,v=p.length,w=-1,T;for(const M of h)for(o=0,++w;o<v;++o)(p[o][w]=[0,+n(M,p[o].key,w,h)]).data=M;for(o=0,T=yz(t(p));o<v;++o)p[T[o]].index=o;return r(p,T),p}return c.keys=function(h){return arguments.length?(e=typeof h=="function"?h:ao(Array.from(h)),c):e},c.value=function(h){return arguments.length?(n=typeof h=="function"?h:ao(+h),c):n},c.order=function(h){return arguments.length?(t=h==null?gR:typeof h=="function"?h:ao(Array.from(h)),c):t},c.offset=function(h){return arguments.length?(r=h??w_,c):r},c}function RAe(e,t){if((n=e.length)>0){for(var r,n,c=0,h=e[0].length,p;c<h;++c){for(p=r=0;r<n;++r)p+=e[r][c][1]||0;if(p)for(r=0;r<n;++r)e[r][c][1]/=p}w_(e,t)}}function DAe(e,t){if((c=e.length)>0){for(var r=0,n=e[t[0]],c,h=n.length;r<h;++r){for(var p=0,o=0;p<c;++p)o+=e[p][r][1]||0;n[r][1]+=n[r][0]=-o/2}w_(e,t)}}function LAe(e,t){if(!(!((p=e.length)>0)||!((h=(c=e[t[0]]).length)>0))){for(var r=0,n=1,c,h,p;n<h;++n){for(var o=0,v=0,w=0;o<p;++o){for(var T=e[t[o]],M=T[n][1]||0,O=T[n-1][1]||0,D=(M-O)/2,B=0;B<o;++B){var N=e[t[B]],G=N[n][1]||0,V=N[n-1][1]||0;D+=G-V}v+=M,w+=D*M}c[n-1][1]+=c[n-1][0]=r,v&&(r-=w/v)}c[n-1][1]+=c[n-1][0]=r,w_(e,t)}}function aw(e){"@babel/helpers - typeof";return aw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aw(e)}var zAe=["type","size","sizeType"];function yR(){return yR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yR.apply(this,arguments)}function _8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function v8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_8(Object(r),!0).forEach(function(n){NAe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NAe(e,t,r){return t=FAe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FAe(e){var t=BAe(e,"string");return aw(t)=="symbol"?t:t+""}function BAe(e,t){if(aw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(aw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function UAe(e,t){if(e==null)return{};var r=VAe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function VAe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var dQ={symbolCircle:_z,symbolCross:cAe,symbolDiamond:hAe,symbolSquare:dAe,symbolStar:gAe,symbolTriangle:yAe,symbolWye:vAe},$Ae=Math.PI/180,GAe=function(e){var t="symbol".concat(qk(e));return dQ[t]||_z},qAe=function(e,t,r){if(t==="area")return e;switch(r){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var n=18*$Ae;return 1.25*e*e*(Math.tan(n)-Math.tan(n*2)*Math.pow(Math.tan(n),2))}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},HAe=function(e,t){dQ["symbol".concat(qk(e))]=t},vz=function(e){var t=e.type,r=t===void 0?"circle":t,n=e.size,c=n===void 0?64:n,h=e.sizeType,p=h===void 0?"area":h,o=UAe(e,zAe),v=v8(v8({},o),{},{type:r,size:c,sizeType:p}),w=function(){var B=GAe(r),N=xAe().type(B).size(qAe(c,p,r));return N()},T=v.className,M=v.cx,O=v.cy,D=Sn(v,!0);return M===+M&&O===+O&&c===+c?Ne.createElement("path",yR({},D,{className:Hn("recharts-symbols",T),transform:"translate(".concat(M,", ").concat(O,")"),d:w()})):null};vz.registerSymbol=HAe;function S_(e){"@babel/helpers - typeof";return S_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S_(e)}function _R(){return _R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_R.apply(this,arguments)}function x8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function WAe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x8(Object(r),!0).forEach(function(n){sw(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZAe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KAe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pQ(n.key),n)}}function XAe(e,t,r){return t&&KAe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function YAe(e,t,r){return t=OE(t),JAe(e,fQ()?Reflect.construct(t,r||[],OE(e).constructor):t.apply(e,r))}function JAe(e,t){if(t&&(S_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QAe(e)}function QAe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fQ=function(){return!!e})()}function OE(e){return OE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},OE(e)}function eke(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vR(e,t)}function vR(e,t){return vR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},vR(e,t)}function sw(e,t,r){return t=pQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pQ(e){var t=tke(e,"string");return S_(t)=="symbol"?t:t+""}function tke(e,t){if(S_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(S_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Al=32,xz=function(e){function t(){return ZAe(this,t),YAe(this,t,arguments)}return eke(t,e),XAe(t,[{key:"renderIcon",value:function(r){var n=this.props.inactiveColor,c=Al/2,h=Al/6,p=Al/3,o=r.inactive?n:r.color;if(r.type==="plainline")return Ne.createElement("line",{strokeWidth:4,fill:"none",stroke:o,strokeDasharray:r.payload.strokeDasharray,x1:0,y1:c,x2:Al,y2:c,className:"recharts-legend-icon"});if(r.type==="line")return Ne.createElement("path",{strokeWidth:4,fill:"none",stroke:o,d:"M0,".concat(c,"h").concat(p,`
            A`).concat(h,",").concat(h,",0,1,1,").concat(2*p,",").concat(c,`
            H`).concat(Al,"M").concat(2*p,",").concat(c,`
            A`).concat(h,",").concat(h,",0,1,1,").concat(p,",").concat(c),className:"recharts-legend-icon"});if(r.type==="rect")return Ne.createElement("path",{stroke:"none",fill:o,d:"M0,".concat(Al/8,"h").concat(Al,"v").concat(Al*3/4,"h").concat(-Al,"z"),className:"recharts-legend-icon"});if(Ne.isValidElement(r.legendIcon)){var v=WAe({},r);return delete v.legendIcon,Ne.cloneElement(r.legendIcon,v)}return Ne.createElement(vz,{fill:o,cx:c,cy:c,size:Al,sizeType:"diameter",type:r.type})}},{key:"renderItems",value:function(){var r=this,n=this.props,c=n.payload,h=n.iconSize,p=n.layout,o=n.formatter,v=n.inactiveColor,w={x:0,y:0,width:Al,height:Al},T={display:p==="horizontal"?"inline-block":"block",marginRight:10},M={display:"inline-block",verticalAlign:"middle",marginRight:4};return c.map(function(O,D){var B=O.formatter||o,N=Hn(sw(sw({"recharts-legend-item":!0},"legend-item-".concat(D),!0),"inactive",O.inactive));if(O.type==="none")return null;var G=Pn(O.value)?null:O.value;_c(!Pn(O.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var V=O.inactive?v:O.color;return Ne.createElement("li",_R({className:N,style:T,key:"legend-item-".concat(D)},Tm(r.props,O,D)),Ne.createElement(cR,{width:h,height:h,viewBox:w,style:M},r.renderIcon(O)),Ne.createElement("span",{className:"recharts-legend-item-text",style:{color:V}},B?B(G,O,D):G))})}},{key:"render",value:function(){var r=this.props,n=r.payload,c=r.layout,h=r.align;if(!n||!n.length)return null;var p={padding:0,margin:0,textAlign:c==="horizontal"?h:"left"};return Ne.createElement("ul",{className:"recharts-default-legend",style:p},this.renderItems())}}])}(Z.PureComponent);sw(xz,"displayName","Legend");sw(xz,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var rke=Ok;function nke(){this.__data__=new rke,this.size=0}var ike=nke;function oke(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var ake=oke;function ske(e){return this.__data__.get(e)}var lke=ske;function cke(e){return this.__data__.has(e)}var uke=cke,hke=Ok,dke=sz,fke=lz,pke=200;function mke(e,t){var r=this.__data__;if(r instanceof hke){var n=r.__data__;if(!dke||n.length<pke-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new fke(n)}return r.set(e,t),this.size=r.size,this}var gke=mke,yke=Ok,_ke=ike,vke=ake,xke=lke,bke=uke,wke=gke;function fv(e){var t=this.__data__=new yke(e);this.size=t.size}fv.prototype.clear=_ke;fv.prototype.delete=vke;fv.prototype.get=xke;fv.prototype.has=bke;fv.prototype.set=wke;var mQ=fv,Ske="__lodash_hash_undefined__";function Tke(e){return this.__data__.set(e,Ske),this}var Eke=Tke;function Ake(e){return this.__data__.has(e)}var kke=Ake,Cke=lz,Pke=Eke,Mke=kke;function jE(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Cke;++t<r;)this.add(e[t])}jE.prototype.add=jE.prototype.push=Pke;jE.prototype.has=Mke;var gQ=jE;function Ike(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var yQ=Ike;function Oke(e,t){return e.has(t)}var _Q=Oke,jke=gQ,Rke=yQ,Dke=_Q,Lke=1,zke=2;function Nke(e,t,r,n,c,h){var p=r&Lke,o=e.length,v=t.length;if(o!=v&&!(p&&v>o))return!1;var w=h.get(e),T=h.get(t);if(w&&T)return w==t&&T==e;var M=-1,O=!0,D=r&zke?new jke:void 0;for(h.set(e,t),h.set(t,e);++M<o;){var B=e[M],N=t[M];if(n)var G=p?n(N,B,M,t,e,h):n(B,N,M,e,t,h);if(G!==void 0){if(G)continue;O=!1;break}if(D){if(!Rke(t,function(V,U){if(!Dke(D,U)&&(B===V||c(B,V,r,n,h)))return D.push(U)})){O=!1;break}}else if(!(B===N||c(B,N,r,n,h))){O=!1;break}}return h.delete(e),h.delete(t),O}var vQ=Nke,Fke=Iu,Bke=Fke.Uint8Array,Uke=Bke;function Vke(e){var t=-1,r=Array(e.size);return e.forEach(function(n,c){r[++t]=[c,n]}),r}var $ke=Vke;function Gke(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var bz=Gke,b8=i1,w8=Uke,qke=az,Hke=vQ,Wke=$ke,Zke=bz,Kke=1,Xke=2,Yke="[object Boolean]",Jke="[object Date]",Qke="[object Error]",eCe="[object Map]",tCe="[object Number]",rCe="[object RegExp]",nCe="[object Set]",iCe="[object String]",oCe="[object Symbol]",aCe="[object ArrayBuffer]",sCe="[object DataView]",S8=b8?b8.prototype:void 0,OI=S8?S8.valueOf:void 0;function lCe(e,t,r,n,c,h,p){switch(r){case sCe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case aCe:return!(e.byteLength!=t.byteLength||!h(new w8(e),new w8(t)));case Yke:case Jke:case tCe:return qke(+e,+t);case Qke:return e.name==t.name&&e.message==t.message;case rCe:case iCe:return e==t+"";case eCe:var o=Wke;case nCe:var v=n&Kke;if(o||(o=Zke),e.size!=t.size&&!v)return!1;var w=p.get(e);if(w)return w==t;n|=Xke,p.set(e,t);var T=Hke(o(e),o(t),n,c,h,p);return p.delete(e),T;case oCe:if(OI)return OI.call(e)==OI.call(t)}return!1}var cCe=lCe;function uCe(e,t){for(var r=-1,n=t.length,c=e.length;++r<n;)e[c+r]=t[r];return e}var xQ=uCe,hCe=xQ,dCe=Ks;function fCe(e,t,r){var n=t(e);return dCe(e)?n:hCe(n,r(e))}var pCe=fCe;function mCe(e,t){for(var r=-1,n=e==null?0:e.length,c=0,h=[];++r<n;){var p=e[r];t(p,r,e)&&(h[c++]=p)}return h}var gCe=mCe;function yCe(){return[]}var _Ce=yCe,vCe=gCe,xCe=_Ce,bCe=Object.prototype,wCe=bCe.propertyIsEnumerable,T8=Object.getOwnPropertySymbols,SCe=T8?function(e){return e==null?[]:(e=Object(e),vCe(T8(e),function(t){return wCe.call(e,t)}))}:xCe,TCe=SCe;function ECe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var ACe=ECe,kCe=Fh,CCe=Bh,PCe="[object Arguments]";function MCe(e){return CCe(e)&&kCe(e)==PCe}var ICe=MCe,E8=ICe,OCe=Bh,bQ=Object.prototype,jCe=bQ.hasOwnProperty,RCe=bQ.propertyIsEnumerable,DCe=E8(function(){return arguments}())?E8:function(e){return OCe(e)&&jCe.call(e,"callee")&&!RCe.call(e,"callee")},wz=DCe,RE={exports:{}};function LCe(){return!1}var zCe=LCe;RE.exports;(function(e,t){var r=Iu,n=zCe,c=t&&!t.nodeType&&t,h=c&&!0&&e&&!e.nodeType&&e,p=h&&h.exports===c,o=p?r.Buffer:void 0,v=o?o.isBuffer:void 0,w=v||n;e.exports=w})(RE,RE.exports);var wQ=RE.exports,NCe=9007199254740991,FCe=/^(?:0|[1-9]\d*)$/;function BCe(e,t){var r=typeof e;return t=t??NCe,!!t&&(r=="number"||r!="symbol"&&FCe.test(e))&&e>-1&&e%1==0&&e<t}var Sz=BCe,UCe=9007199254740991;function VCe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=UCe}var Tz=VCe,$Ce=Fh,GCe=Tz,qCe=Bh,HCe="[object Arguments]",WCe="[object Array]",ZCe="[object Boolean]",KCe="[object Date]",XCe="[object Error]",YCe="[object Function]",JCe="[object Map]",QCe="[object Number]",ePe="[object Object]",tPe="[object RegExp]",rPe="[object Set]",nPe="[object String]",iPe="[object WeakMap]",oPe="[object ArrayBuffer]",aPe="[object DataView]",sPe="[object Float32Array]",lPe="[object Float64Array]",cPe="[object Int8Array]",uPe="[object Int16Array]",hPe="[object Int32Array]",dPe="[object Uint8Array]",fPe="[object Uint8ClampedArray]",pPe="[object Uint16Array]",mPe="[object Uint32Array]",oo={};oo[sPe]=oo[lPe]=oo[cPe]=oo[uPe]=oo[hPe]=oo[dPe]=oo[fPe]=oo[pPe]=oo[mPe]=!0;oo[HCe]=oo[WCe]=oo[oPe]=oo[ZCe]=oo[aPe]=oo[KCe]=oo[XCe]=oo[YCe]=oo[JCe]=oo[QCe]=oo[ePe]=oo[tPe]=oo[rPe]=oo[nPe]=oo[iPe]=!1;function gPe(e){return qCe(e)&&GCe(e.length)&&!!oo[$Ce(e)]}var yPe=gPe;function _Pe(e){return function(t){return e(t)}}var SQ=_Pe,DE={exports:{}};DE.exports;(function(e,t){var r=IJ,n=t&&!t.nodeType&&t,c=n&&!0&&e&&!e.nodeType&&e,h=c&&c.exports===n,p=h&&r.process,o=function(){try{var v=c&&c.require&&c.require("util").types;return v||p&&p.binding&&p.binding("util")}catch{}}();e.exports=o})(DE,DE.exports);var vPe=DE.exports,xPe=yPe,bPe=SQ,A8=vPe,k8=A8&&A8.isTypedArray,wPe=k8?bPe(k8):xPe,TQ=wPe,SPe=ACe,TPe=wz,EPe=Ks,APe=wQ,kPe=Sz,CPe=TQ,PPe=Object.prototype,MPe=PPe.hasOwnProperty;function IPe(e,t){var r=EPe(e),n=!r&&TPe(e),c=!r&&!n&&APe(e),h=!r&&!n&&!c&&CPe(e),p=r||n||c||h,o=p?SPe(e.length,String):[],v=o.length;for(var w in e)(t||MPe.call(e,w))&&!(p&&(w=="length"||c&&(w=="offset"||w=="parent")||h&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||kPe(w,v)))&&o.push(w);return o}var OPe=IPe,jPe=Object.prototype;function RPe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||jPe;return e===r}var DPe=RPe;function LPe(e,t){return function(r){return e(t(r))}}var EQ=LPe,zPe=EQ,NPe=zPe(Object.keys,Object),FPe=NPe,BPe=DPe,UPe=FPe,VPe=Object.prototype,$Pe=VPe.hasOwnProperty;function GPe(e){if(!BPe(e))return UPe(e);var t=[];for(var r in Object(e))$Pe.call(e,r)&&r!="constructor"&&t.push(r);return t}var qPe=GPe,HPe=oz,WPe=Tz;function ZPe(e){return e!=null&&WPe(e.length)&&!HPe(e)}var s1=ZPe,KPe=OPe,XPe=qPe,YPe=s1;function JPe(e){return YPe(e)?KPe(e):XPe(e)}var Kk=JPe,QPe=pCe,eMe=TCe,tMe=Kk;function rMe(e){return QPe(e,tMe,eMe)}var nMe=rMe,C8=nMe,iMe=1,oMe=Object.prototype,aMe=oMe.hasOwnProperty;function sMe(e,t,r,n,c,h){var p=r&iMe,o=C8(e),v=o.length,w=C8(t),T=w.length;if(v!=T&&!p)return!1;for(var M=v;M--;){var O=o[M];if(!(p?O in t:aMe.call(t,O)))return!1}var D=h.get(e),B=h.get(t);if(D&&B)return D==t&&B==e;var N=!0;h.set(e,t),h.set(t,e);for(var G=p;++M<v;){O=o[M];var V=e[O],U=t[O];if(n)var X=p?n(U,V,O,t,e,h):n(V,U,O,e,t,h);if(!(X===void 0?V===U||c(V,U,r,n,h):X)){N=!1;break}G||(G=O=="constructor")}if(N&&!G){var Y=e.constructor,ne=t.constructor;Y!=ne&&"constructor"in e&&"constructor"in t&&!(typeof Y=="function"&&Y instanceof Y&&typeof ne=="function"&&ne instanceof ne)&&(N=!1)}return h.delete(e),h.delete(t),N}var lMe=sMe,cMe=Lm,uMe=Iu,hMe=cMe(uMe,"DataView"),dMe=hMe,fMe=Lm,pMe=Iu,mMe=fMe(pMe,"Promise"),gMe=mMe,yMe=Lm,_Me=Iu,vMe=yMe(_Me,"Set"),AQ=vMe,xMe=Lm,bMe=Iu,wMe=xMe(bMe,"WeakMap"),SMe=wMe,xR=dMe,bR=sz,wR=gMe,SR=AQ,TR=SMe,kQ=Fh,pv=jJ,P8="[object Map]",TMe="[object Object]",M8="[object Promise]",I8="[object Set]",O8="[object WeakMap]",j8="[object DataView]",EMe=pv(xR),AMe=pv(bR),kMe=pv(wR),CMe=pv(SR),PMe=pv(TR),Gp=kQ;(xR&&Gp(new xR(new ArrayBuffer(1)))!=j8||bR&&Gp(new bR)!=P8||wR&&Gp(wR.resolve())!=M8||SR&&Gp(new SR)!=I8||TR&&Gp(new TR)!=O8)&&(Gp=function(e){var t=kQ(e),r=t==TMe?e.constructor:void 0,n=r?pv(r):"";if(n)switch(n){case EMe:return j8;case AMe:return P8;case kMe:return M8;case CMe:return I8;case PMe:return O8}return t});var MMe=Gp,jI=mQ,IMe=vQ,OMe=cCe,jMe=lMe,R8=MMe,D8=Ks,L8=wQ,RMe=TQ,DMe=1,z8="[object Arguments]",N8="[object Array]",XT="[object Object]",LMe=Object.prototype,F8=LMe.hasOwnProperty;function zMe(e,t,r,n,c,h){var p=D8(e),o=D8(t),v=p?N8:R8(e),w=o?N8:R8(t);v=v==z8?XT:v,w=w==z8?XT:w;var T=v==XT,M=w==XT,O=v==w;if(O&&L8(e)){if(!L8(t))return!1;p=!0,T=!1}if(O&&!T)return h||(h=new jI),p||RMe(e)?IMe(e,t,r,n,c,h):OMe(e,t,v,r,n,c,h);if(!(r&DMe)){var D=T&&F8.call(e,"__wrapped__"),B=M&&F8.call(t,"__wrapped__");if(D||B){var N=D?e.value():e,G=B?t.value():t;return h||(h=new jI),c(N,G,r,n,h)}}return O?(h||(h=new jI),jMe(e,t,r,n,c,h)):!1}var NMe=zMe,FMe=NMe,B8=Bh;function CQ(e,t,r,n,c){return e===t?!0:e==null||t==null||!B8(e)&&!B8(t)?e!==e&&t!==t:FMe(e,t,r,n,CQ,c)}var Ez=CQ,BMe=mQ,UMe=Ez,VMe=1,$Me=2;function GMe(e,t,r,n){var c=r.length,h=c,p=!n;if(e==null)return!h;for(e=Object(e);c--;){var o=r[c];if(p&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++c<h;){o=r[c];var v=o[0],w=e[v],T=o[1];if(p&&o[2]){if(w===void 0&&!(v in e))return!1}else{var M=new BMe;if(n)var O=n(w,T,v,e,t,M);if(!(O===void 0?UMe(T,w,VMe|$Me,n,M):O))return!1}}return!0}var qMe=GMe,HMe=Af;function WMe(e){return e===e&&!HMe(e)}var PQ=WMe,ZMe=PQ,KMe=Kk;function XMe(e){for(var t=KMe(e),r=t.length;r--;){var n=t[r],c=e[n];t[r]=[n,c,ZMe(c)]}return t}var YMe=XMe;function JMe(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var MQ=JMe,QMe=qMe,eIe=YMe,tIe=MQ;function rIe(e){var t=eIe(e);return t.length==1&&t[0][2]?tIe(t[0][0],t[0][1]):function(r){return r===e||QMe(r,e,t)}}var nIe=rIe;function iIe(e,t){return e!=null&&t in Object(e)}var oIe=iIe,aIe=NJ,sIe=wz,lIe=Ks,cIe=Sz,uIe=Tz,hIe=Rk;function dIe(e,t,r){t=aIe(t,e);for(var n=-1,c=t.length,h=!1;++n<c;){var p=hIe(t[n]);if(!(h=e!=null&&r(e,p)))break;e=e[p]}return h||++n!=c?h:(c=e==null?0:e.length,!!c&&uIe(c)&&cIe(p,c)&&(lIe(e)||sIe(e)))}var fIe=dIe,pIe=oIe,mIe=fIe;function gIe(e,t){return e!=null&&mIe(e,t,pIe)}var yIe=gIe,_Ie=Ez,vIe=FJ,xIe=yIe,bIe=iz,wIe=PQ,SIe=MQ,TIe=Rk,EIe=1,AIe=2;function kIe(e,t){return bIe(e)&&wIe(t)?SIe(TIe(e),t):function(r){var n=vIe(r,e);return n===void 0&&n===t?xIe(r,e):_Ie(t,n,EIe|AIe)}}var CIe=kIe;function PIe(e){return e}var mv=PIe;function MIe(e){return function(t){return t?.[e]}}var IIe=MIe,OIe=hz;function jIe(e){return function(t){return OIe(t,e)}}var RIe=jIe,DIe=IIe,LIe=RIe,zIe=iz,NIe=Rk;function FIe(e){return zIe(e)?DIe(NIe(e)):LIe(e)}var BIe=FIe,UIe=nIe,VIe=CIe,$Ie=mv,GIe=Ks,qIe=BIe;function HIe(e){return typeof e=="function"?e:e==null?$Ie:typeof e=="object"?GIe(e)?VIe(e[0],e[1]):UIe(e):qIe(e)}var Ou=HIe;function WIe(e,t,r,n){for(var c=e.length,h=r+(n?1:-1);n?h--:++h<c;)if(t(e[h],h,e))return h;return-1}var IQ=WIe;function ZIe(e){return e!==e}var KIe=ZIe;function XIe(e,t,r){for(var n=r-1,c=e.length;++n<c;)if(e[n]===t)return n;return-1}var YIe=XIe,JIe=IQ,QIe=KIe,eOe=YIe;function tOe(e,t,r){return t===t?eOe(e,t,r):JIe(e,QIe,r)}var rOe=tOe,nOe=rOe;function iOe(e,t){var r=e==null?0:e.length;return!!r&&nOe(e,t,0)>-1}var oOe=iOe;function aOe(e,t,r){for(var n=-1,c=e==null?0:e.length;++n<c;)if(r(t,e[n]))return!0;return!1}var sOe=aOe;function lOe(){}var cOe=lOe,RI=AQ,uOe=cOe,hOe=bz,dOe=1/0,fOe=RI&&1/hOe(new RI([,-0]))[1]==dOe?function(e){return new RI(e)}:uOe,pOe=fOe,mOe=gQ,gOe=oOe,yOe=sOe,_Oe=_Q,vOe=pOe,xOe=bz,bOe=200;function wOe(e,t,r){var n=-1,c=gOe,h=e.length,p=!0,o=[],v=o;if(r)p=!1,c=yOe;else if(h>=bOe){var w=t?null:vOe(e);if(w)return xOe(w);p=!1,c=_Oe,v=new mOe}else v=t?[]:o;e:for(;++n<h;){var T=e[n],M=t?t(T):T;if(T=r||T!==0?T:0,p&&M===M){for(var O=v.length;O--;)if(v[O]===M)continue e;t&&v.push(M),o.push(T)}else c(v,M,r)||(v!==o&&v.push(M),o.push(T))}return o}var SOe=wOe,TOe=Ou,EOe=SOe;function AOe(e,t){return e&&e.length?EOe(e,TOe(t)):[]}var kOe=AOe;const U8=ki(kOe);function OQ(e,t,r){return t===!0?U8(e,r):Pn(t)?U8(e,t):e}function T_(e){"@babel/helpers - typeof";return T_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T_(e)}var COe=["ref"];function V8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function sh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V8(Object(r),!0).forEach(function(n){Xk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function POe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $8(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,RQ(n.key),n)}}function MOe(e,t,r){return t&&$8(e.prototype,t),r&&$8(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function IOe(e,t,r){return t=LE(t),OOe(e,jQ()?Reflect.construct(t,r||[],LE(e).constructor):t.apply(e,r))}function OOe(e,t){if(t&&(T_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jOe(e)}function jOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jQ=function(){return!!e})()}function LE(e){return LE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},LE(e)}function ROe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ER(e,t)}function ER(e,t){return ER=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},ER(e,t)}function Xk(e,t,r){return t=RQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RQ(e){var t=DOe(e,"string");return T_(t)=="symbol"?t:t+""}function DOe(e,t){if(T_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(T_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function LOe(e,t){if(e==null)return{};var r=zOe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function zOe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function NOe(e){return e.value}function FOe(e,t){if(Ne.isValidElement(e))return Ne.cloneElement(e,t);if(typeof e=="function")return Ne.createElement(e,t);t.ref;var r=LOe(t,COe);return Ne.createElement(xz,r)}var G8=1,a_=function(e){function t(){var r;POe(this,t);for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];return r=IOe(this,t,[].concat(c)),Xk(r,"lastBoundingBox",{width:-1,height:-1}),r}return ROe(t,e),MOe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var r=this.wrapperNode.getBoundingClientRect();return r.height=this.wrapperNode.offsetHeight,r.width=this.wrapperNode.offsetWidth,r}return null}},{key:"updateBBox",value:function(){var r=this.props.onBBoxUpdate,n=this.getBBox();n?(Math.abs(n.width-this.lastBoundingBox.width)>G8||Math.abs(n.height-this.lastBoundingBox.height)>G8)&&(this.lastBoundingBox.width=n.width,this.lastBoundingBox.height=n.height,r&&r(n)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,r&&r(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?sh({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(r){var n=this.props,c=n.layout,h=n.align,p=n.verticalAlign,o=n.margin,v=n.chartWidth,w=n.chartHeight,T,M;if(!r||(r.left===void 0||r.left===null)&&(r.right===void 0||r.right===null))if(h==="center"&&c==="vertical"){var O=this.getBBoxSnapshot();T={left:((v||0)-O.width)/2}}else T=h==="right"?{right:o&&o.right||0}:{left:o&&o.left||0};if(!r||(r.top===void 0||r.top===null)&&(r.bottom===void 0||r.bottom===null))if(p==="middle"){var D=this.getBBoxSnapshot();M={top:((w||0)-D.height)/2}}else M=p==="bottom"?{bottom:o&&o.bottom||0}:{top:o&&o.top||0};return sh(sh({},T),M)}},{key:"render",value:function(){var r=this,n=this.props,c=n.content,h=n.width,p=n.height,o=n.wrapperStyle,v=n.payloadUniqBy,w=n.payload,T=sh(sh({position:"absolute",width:h||"auto",height:p||"auto"},this.getDefaultPosition(o)),o);return Ne.createElement("div",{className:"recharts-legend-wrapper",style:T,ref:function(M){r.wrapperNode=M}},FOe(c,sh(sh({},this.props),{},{payload:OQ(w,v,NOe)})))}}],[{key:"getWithHeight",value:function(r,n){var c=sh(sh({},this.defaultProps),r.props),h=c.layout;return h==="vertical"&&fr(r.props.height)?{height:r.props.height}:h==="horizontal"?{width:r.props.width||n}:null}}])}(Z.PureComponent);Xk(a_,"displayName","Legend");Xk(a_,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var q8=i1,BOe=wz,UOe=Ks,H8=q8?q8.isConcatSpreadable:void 0;function VOe(e){return UOe(e)||BOe(e)||!!(H8&&e&&e[H8])}var $Oe=VOe,GOe=xQ,qOe=$Oe;function DQ(e,t,r,n,c){var h=-1,p=e.length;for(r||(r=qOe),c||(c=[]);++h<p;){var o=e[h];t>0&&r(o)?t>1?DQ(o,t-1,r,n,c):GOe(c,o):n||(c[c.length]=o)}return c}var LQ=DQ;function HOe(e){return function(t,r,n){for(var c=-1,h=Object(t),p=n(t),o=p.length;o--;){var v=p[e?o:++c];if(r(h[v],v,h)===!1)break}return t}}var WOe=HOe,ZOe=WOe,KOe=ZOe(),XOe=KOe,YOe=XOe,JOe=Kk;function QOe(e,t){return e&&YOe(e,t,JOe)}var zQ=QOe,eje=s1;function tje(e,t){return function(r,n){if(r==null)return r;if(!eje(r))return e(r,n);for(var c=r.length,h=t?c:-1,p=Object(r);(t?h--:++h<c)&&n(p[h],h,p)!==!1;);return r}}var rje=tje,nje=zQ,ije=rje,oje=ije(nje),Az=oje,aje=Az,sje=s1;function lje(e,t){var r=-1,n=sje(e)?Array(e.length):[];return aje(e,function(c,h,p){n[++r]=t(c,h,p)}),n}var NQ=lje;function cje(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var uje=cje,W8=lv;function hje(e,t){if(e!==t){var r=e!==void 0,n=e===null,c=e===e,h=W8(e),p=t!==void 0,o=t===null,v=t===t,w=W8(t);if(!o&&!w&&!h&&e>t||h&&p&&v&&!o&&!w||n&&p&&v||!r&&v||!c)return 1;if(!n&&!h&&!w&&e<t||w&&r&&c&&!n&&!h||o&&r&&c||!p&&c||!v)return-1}return 0}var dje=hje,fje=dje;function pje(e,t,r){for(var n=-1,c=e.criteria,h=t.criteria,p=c.length,o=r.length;++n<p;){var v=fje(c[n],h[n]);if(v){if(n>=o)return v;var w=r[n];return v*(w=="desc"?-1:1)}}return e.index-t.index}var mje=pje,DI=uz,gje=hz,yje=Ou,_je=NQ,vje=uje,xje=SQ,bje=mje,wje=mv,Sje=Ks;function Tje(e,t,r){t.length?t=DI(t,function(h){return Sje(h)?function(p){return gje(p,h.length===1?h[0]:h)}:h}):t=[wje];var n=-1;t=DI(t,xje(yje));var c=_je(e,function(h,p,o){var v=DI(t,function(w){return w(h)});return{criteria:v,index:++n,value:h}});return vje(c,function(h,p){return bje(h,p,r)})}var Eje=Tje;function Aje(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var kje=Aje,Cje=kje,Z8=Math.max;function Pje(e,t,r){return t=Z8(t===void 0?e.length-1:t,0),function(){for(var n=arguments,c=-1,h=Z8(n.length-t,0),p=Array(h);++c<h;)p[c]=n[t+c];c=-1;for(var o=Array(t+1);++c<t;)o[c]=n[c];return o[t]=r(p),Cje(e,this,o)}}var Mje=Pje;function Ije(e){return function(){return e}}var Oje=Ije,jje=Lm,Rje=function(){try{var e=jje(Object,"defineProperty");return e({},"",{}),e}catch{}}(),FQ=Rje,Dje=Oje,K8=FQ,Lje=mv,zje=K8?function(e,t){return K8(e,"toString",{configurable:!0,enumerable:!1,value:Dje(t),writable:!0})}:Lje,Nje=zje,Fje=800,Bje=16,Uje=Date.now;function Vje(e){var t=0,r=0;return function(){var n=Uje(),c=Bje-(n-r);if(r=n,c>0){if(++t>=Fje)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var $je=Vje,Gje=Nje,qje=$je,Hje=qje(Gje),Wje=Hje,Zje=mv,Kje=Mje,Xje=Wje;function Yje(e,t){return Xje(Kje(e,t,Zje),e+"")}var Jje=Yje,Qje=az,eRe=s1,tRe=Sz,rRe=Af;function nRe(e,t,r){if(!rRe(r))return!1;var n=typeof t;return(n=="number"?eRe(r)&&tRe(t,r.length):n=="string"&&t in r)?Qje(r[t],e):!1}var Yk=nRe,iRe=LQ,oRe=Eje,aRe=Jje,X8=Yk,sRe=aRe(function(e,t){if(e==null)return[];var r=t.length;return r>1&&X8(e,t[0],t[1])?t=[]:r>2&&X8(t[0],t[1],t[2])&&(t=[t[0]]),oRe(e,iRe(t,1),[])}),lRe=sRe;const kz=ki(lRe);function lw(e){"@babel/helpers - typeof";return lw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lw(e)}function AR(){return AR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AR.apply(this,arguments)}function cRe(e,t){return fRe(e)||dRe(e,t)||hRe(e,t)||uRe()}function uRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hRe(e,t){if(e){if(typeof e=="string")return Y8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Y8(e,t)}}function Y8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function dRe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function fRe(e){if(Array.isArray(e))return e}function J8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function LI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?J8(Object(r),!0).forEach(function(n){pRe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pRe(e,t,r){return t=mRe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mRe(e){var t=gRe(e,"string");return lw(t)=="symbol"?t:t+""}function gRe(e,t){if(lw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(lw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yRe(e){return Array.isArray(e)&&oa(e[0])&&oa(e[1])?e.join(" ~ "):e}var _Re=function(e){var t=e.separator,r=t===void 0?" : ":t,n=e.contentStyle,c=n===void 0?{}:n,h=e.itemStyle,p=h===void 0?{}:h,o=e.labelStyle,v=o===void 0?{}:o,w=e.payload,T=e.formatter,M=e.itemSorter,O=e.wrapperClassName,D=e.labelClassName,B=e.label,N=e.labelFormatter,G=e.accessibilityLayer,V=G===void 0?!1:G,U=function(){if(w&&w.length){var ze={padding:0,margin:0},Ce=(M?kz(w,M):w).map(function(Ke,Ye){if(Ke.type==="none")return null;var Oe=LI({display:"block",paddingTop:4,paddingBottom:4,color:Ke.color||"#000"},p),tt=Ke.formatter||T||yRe,He=Ke.value,lt=Ke.name,rt=He,ht=lt;if(tt&&rt!=null&&ht!=null){var vt=tt(He,lt,Ke,Ye,w);if(Array.isArray(vt)){var mt=cRe(vt,2);rt=mt[0],ht=mt[1]}else rt=vt}return Ne.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(Ye),style:Oe},oa(ht)?Ne.createElement("span",{className:"recharts-tooltip-item-name"},ht):null,oa(ht)?Ne.createElement("span",{className:"recharts-tooltip-item-separator"},r):null,Ne.createElement("span",{className:"recharts-tooltip-item-value"},rt),Ne.createElement("span",{className:"recharts-tooltip-item-unit"},Ke.unit||""))});return Ne.createElement("ul",{className:"recharts-tooltip-item-list",style:ze},Ce)}return null},X=LI({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},c),Y=LI({margin:0},v),ne=!ni(B),se=ne?B:"",le=Hn("recharts-default-tooltip",O),ge=Hn("recharts-tooltip-label",D);ne&&N&&w!==void 0&&w!==null&&(se=N(B,w));var je=V?{role:"status","aria-live":"assertive"}:{};return Ne.createElement("div",AR({className:le,style:X},je),Ne.createElement("p",{className:ge,style:Y},Ne.isValidElement(se)?se:"".concat(se)),U())};function cw(e){"@babel/helpers - typeof";return cw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cw(e)}function YT(e,t,r){return t=vRe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vRe(e){var t=xRe(e,"string");return cw(t)=="symbol"?t:t+""}function xRe(e,t){if(cw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Vx="recharts-tooltip-wrapper",bRe={visibility:"hidden"};function wRe(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Hn(Vx,YT(YT(YT(YT({},"".concat(Vx,"-right"),fr(r)&&t&&fr(t.x)&&r>=t.x),"".concat(Vx,"-left"),fr(r)&&t&&fr(t.x)&&r<t.x),"".concat(Vx,"-bottom"),fr(n)&&t&&fr(t.y)&&n>=t.y),"".concat(Vx,"-top"),fr(n)&&t&&fr(t.y)&&n<t.y))}function Q8(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,c=e.offsetTopLeft,h=e.position,p=e.reverseDirection,o=e.tooltipDimension,v=e.viewBox,w=e.viewBoxDimension;if(h&&fr(h[n]))return h[n];var T=r[n]-o-c,M=r[n]+c;if(t[n])return p[n]?T:M;if(p[n]){var O=T,D=v[n];return O<D?Math.max(M,v[n]):Math.max(T,v[n])}var B=M+o,N=v[n]+w;return B>N?Math.max(T,v[n]):Math.max(M,v[n])}function SRe(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function TRe(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,c=e.position,h=e.reverseDirection,p=e.tooltipBox,o=e.useTranslate3d,v=e.viewBox,w,T,M;return p.height>0&&p.width>0&&r?(T=Q8({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:c,reverseDirection:h,tooltipDimension:p.width,viewBox:v,viewBoxDimension:v.width}),M=Q8({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:c,reverseDirection:h,tooltipDimension:p.height,viewBox:v,viewBoxDimension:v.height}),w=SRe({translateX:T,translateY:M,useTranslate3d:o})):w=bRe,{cssProperties:w,cssClasses:wRe({translateX:T,translateY:M,coordinate:r})}}function E_(e){"@babel/helpers - typeof";return E_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E_(e)}function e$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function t$(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e$(Object(r),!0).forEach(function(n){CR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ERe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ARe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,UQ(n.key),n)}}function kRe(e,t,r){return t&&ARe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function CRe(e,t,r){return t=zE(t),PRe(e,BQ()?Reflect.construct(t,r||[],zE(e).constructor):t.apply(e,r))}function PRe(e,t){if(t&&(E_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return MRe(e)}function MRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function BQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(BQ=function(){return!!e})()}function zE(e){return zE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zE(e)}function IRe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kR(e,t)}function kR(e,t){return kR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},kR(e,t)}function CR(e,t,r){return t=UQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UQ(e){var t=ORe(e,"string");return E_(t)=="symbol"?t:t+""}function ORe(e,t){if(E_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(E_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var r$=1,jRe=function(e){function t(){var r;ERe(this,t);for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];return r=CRe(this,t,[].concat(c)),CR(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),CR(r,"handleKeyDown",function(p){if(p.key==="Escape"){var o,v,w,T;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(o=(v=r.props.coordinate)===null||v===void 0?void 0:v.x)!==null&&o!==void 0?o:0,y:(w=(T=r.props.coordinate)===null||T===void 0?void 0:T.y)!==null&&w!==void 0?w:0}})}}),r}return IRe(t,e),kRe(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var r=this.wrapperNode.getBoundingClientRect();(Math.abs(r.width-this.state.lastBoundingBox.width)>r$||Math.abs(r.height-this.state.lastBoundingBox.height)>r$)&&this.setState({lastBoundingBox:{width:r.width,height:r.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var r,n;this.props.active&&this.updateBBox(),this.state.dismissed&&(((r=this.props.coordinate)===null||r===void 0?void 0:r.x)!==this.state.dismissedAtCoordinate.x||((n=this.props.coordinate)===null||n===void 0?void 0:n.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var r=this,n=this.props,c=n.active,h=n.allowEscapeViewBox,p=n.animationDuration,o=n.animationEasing,v=n.children,w=n.coordinate,T=n.hasPayload,M=n.isAnimationActive,O=n.offset,D=n.position,B=n.reverseDirection,N=n.useTranslate3d,G=n.viewBox,V=n.wrapperStyle,U=TRe({allowEscapeViewBox:h,coordinate:w,offsetTopLeft:O,position:D,reverseDirection:B,tooltipBox:this.state.lastBoundingBox,useTranslate3d:N,viewBox:G}),X=U.cssClasses,Y=U.cssProperties,ne=t$(t$({transition:M&&c?"transform ".concat(p,"ms ").concat(o):void 0},Y),{},{pointerEvents:"none",visibility:!this.state.dismissed&&c&&T?"visible":"hidden",position:"absolute",top:0,left:0},V);return Ne.createElement("div",{tabIndex:-1,className:X,style:ne,ref:function(se){r.wrapperNode=se}},v)}}])}(Z.PureComponent),RRe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},gv={isSsr:RRe()};function A_(e){"@babel/helpers - typeof";return A_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A_(e)}function n$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function i$(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?n$(Object(r),!0).forEach(function(n){Cz(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function DRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LRe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$Q(n.key),n)}}function zRe(e,t,r){return t&&LRe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function NRe(e,t,r){return t=NE(t),FRe(e,VQ()?Reflect.construct(t,r||[],NE(e).constructor):t.apply(e,r))}function FRe(e,t){if(t&&(A_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BRe(e)}function BRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function VQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(VQ=function(){return!!e})()}function NE(e){return NE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},NE(e)}function URe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PR(e,t)}function PR(e,t){return PR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},PR(e,t)}function Cz(e,t,r){return t=$Q(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $Q(e){var t=VRe(e,"string");return A_(t)=="symbol"?t:t+""}function VRe(e,t){if(A_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(A_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function $Re(e){return e.dataKey}function GRe(e,t){return Ne.isValidElement(e)?Ne.cloneElement(e,t):typeof e=="function"?Ne.createElement(e,t):Ne.createElement(_Re,t)}var Ns=function(e){function t(){return DRe(this,t),NRe(this,t,arguments)}return URe(t,e),zRe(t,[{key:"render",value:function(){var r=this,n=this.props,c=n.active,h=n.allowEscapeViewBox,p=n.animationDuration,o=n.animationEasing,v=n.content,w=n.coordinate,T=n.filterNull,M=n.isAnimationActive,O=n.offset,D=n.payload,B=n.payloadUniqBy,N=n.position,G=n.reverseDirection,V=n.useTranslate3d,U=n.viewBox,X=n.wrapperStyle,Y=D??[];T&&Y.length&&(Y=OQ(D.filter(function(se){return se.value!=null&&(se.hide!==!0||r.props.includeHidden)}),B,$Re));var ne=Y.length>0;return Ne.createElement(jRe,{allowEscapeViewBox:h,animationDuration:p,animationEasing:o,isAnimationActive:M,active:c,coordinate:w,hasPayload:ne,offset:O,position:N,reverseDirection:G,useTranslate3d:V,viewBox:U,wrapperStyle:X},GRe(v,i$(i$({},this.props),{},{payload:Y})))}}])}(Z.PureComponent);Cz(Ns,"displayName","Tooltip");Cz(Ns,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!gv.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var qRe=Iu,HRe=function(){return qRe.Date.now()},WRe=HRe,ZRe=/\s/;function KRe(e){for(var t=e.length;t--&&ZRe.test(e.charAt(t)););return t}var XRe=KRe,YRe=XRe,JRe=/^\s+/;function QRe(e){return e&&e.slice(0,YRe(e)+1).replace(JRe,"")}var eDe=QRe,tDe=eDe,o$=Af,rDe=lv,a$=NaN,nDe=/^[-+]0x[0-9a-f]+$/i,iDe=/^0b[01]+$/i,oDe=/^0o[0-7]+$/i,aDe=parseInt;function sDe(e){if(typeof e=="number")return e;if(rDe(e))return a$;if(o$(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=o$(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=tDe(e);var r=iDe.test(e);return r||oDe.test(e)?aDe(e.slice(2),r?2:8):nDe.test(e)?a$:+e}var GQ=sDe,lDe=Af,zI=WRe,s$=GQ,cDe="Expected a function",uDe=Math.max,hDe=Math.min;function dDe(e,t,r){var n,c,h,p,o,v,w=0,T=!1,M=!1,O=!0;if(typeof e!="function")throw new TypeError(cDe);t=s$(t)||0,lDe(r)&&(T=!!r.leading,M="maxWait"in r,h=M?uDe(s$(r.maxWait)||0,t):h,O="trailing"in r?!!r.trailing:O);function D(se){var le=n,ge=c;return n=c=void 0,w=se,p=e.apply(ge,le),p}function B(se){return w=se,o=setTimeout(V,t),T?D(se):p}function N(se){var le=se-v,ge=se-w,je=t-le;return M?hDe(je,h-ge):je}function G(se){var le=se-v,ge=se-w;return v===void 0||le>=t||le<0||M&&ge>=h}function V(){var se=zI();if(G(se))return U(se);o=setTimeout(V,N(se))}function U(se){return o=void 0,O&&n?D(se):(n=c=void 0,p)}function X(){o!==void 0&&clearTimeout(o),w=0,n=v=c=o=void 0}function Y(){return o===void 0?p:U(zI())}function ne(){var se=zI(),le=G(se);if(n=arguments,c=this,v=se,le){if(o===void 0)return B(v);if(M)return clearTimeout(o),o=setTimeout(V,t),D(v)}return o===void 0&&(o=setTimeout(V,t)),p}return ne.cancel=X,ne.flush=Y,ne}var fDe=dDe,pDe=fDe,mDe=Af,gDe="Expected a function";function yDe(e,t,r){var n=!0,c=!0;if(typeof e!="function")throw new TypeError(gDe);return mDe(r)&&(n="leading"in r?!!r.leading:n,c="trailing"in r?!!r.trailing:c),pDe(e,t,{leading:n,maxWait:t,trailing:c})}var _De=yDe;const qQ=ki(_De);function uw(e){"@babel/helpers - typeof";return uw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uw(e)}function l$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function JT(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?l$(Object(r),!0).forEach(function(n){vDe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vDe(e,t,r){return t=xDe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xDe(e){var t=bDe(e,"string");return uw(t)=="symbol"?t:t+""}function bDe(e,t){if(uw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(uw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wDe(e,t){return ADe(e)||EDe(e,t)||TDe(e,t)||SDe()}function SDe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TDe(e,t){if(e){if(typeof e=="string")return c$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c$(e,t)}}function c$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function EDe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function ADe(e){if(Array.isArray(e))return e}var Ab=Z.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,c=n===void 0?{width:-1,height:-1}:n,h=e.width,p=h===void 0?"100%":h,o=e.height,v=o===void 0?"100%":o,w=e.minWidth,T=w===void 0?0:w,M=e.minHeight,O=e.maxHeight,D=e.children,B=e.debounce,N=B===void 0?0:B,G=e.id,V=e.className,U=e.onResize,X=e.style,Y=X===void 0?{}:X,ne=Z.useRef(null),se=Z.useRef();se.current=U,Z.useImperativeHandle(t,function(){return Object.defineProperty(ne.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),ne.current},configurable:!0})});var le=Z.useState({containerWidth:c.width,containerHeight:c.height}),ge=wDe(le,2),je=ge[0],ze=ge[1],Ce=Z.useCallback(function(Ye,Oe){ze(function(tt){var He=Math.round(Ye),lt=Math.round(Oe);return tt.containerWidth===He&&tt.containerHeight===lt?tt:{containerWidth:He,containerHeight:lt}})},[]);Z.useEffect(function(){var Ye=function(rt){var ht,vt=rt[0].contentRect,mt=vt.width,ct=vt.height;Ce(mt,ct),(ht=se.current)===null||ht===void 0||ht.call(se,mt,ct)};N>0&&(Ye=qQ(Ye,N,{trailing:!0,leading:!1}));var Oe=new ResizeObserver(Ye),tt=ne.current.getBoundingClientRect(),He=tt.width,lt=tt.height;return Ce(He,lt),Oe.observe(ne.current),function(){Oe.disconnect()}},[Ce,N]);var Ke=Z.useMemo(function(){var Ye=je.containerWidth,Oe=je.containerHeight;if(Ye<0||Oe<0)return null;_c(tm(p)||tm(v),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,p,v),_c(!r||r>0,"The aspect(%s) must be greater than zero.",r);var tt=tm(p)?Ye:p,He=tm(v)?Oe:v;r&&r>0&&(tt?He=tt/r:He&&(tt=He*r),O&&He>O&&(He=O)),_c(tt>0||He>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,tt,He,p,v,T,M,r);var lt=!Array.isArray(D)&&xh(D.type).endsWith("Chart");return Ne.Children.map(D,function(rt){return Ne.isValidElement(rt)?Z.cloneElement(rt,JT({width:tt,height:He},lt?{style:JT({height:"100%",width:"100%",maxHeight:He,maxWidth:tt},rt.props.style)}:{})):rt})},[r,D,v,O,M,T,je,p]);return Ne.createElement("div",{id:G?"".concat(G):void 0,className:Hn("recharts-responsive-container",V),style:JT(JT({},Y),{},{width:p,height:v,minWidth:T,minHeight:M,maxHeight:O}),ref:ne},Ke)}),l1=function(e){return null};l1.displayName="Cell";function hw(e){"@babel/helpers - typeof";return hw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hw(e)}function u$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function MR(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?u$(Object(r),!0).forEach(function(n){kDe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kDe(e,t,r){return t=CDe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function CDe(e){var t=PDe(e,"string");return hw(t)=="symbol"?t:t+""}function PDe(e,t){if(hw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var vy={widthCache:{},cacheCount:0},MDe=2e3,IDe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},h$="recharts_measurement_span";function ODe(e){var t=MR({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var kb=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||gv.isSsr)return{width:0,height:0};var r=ODe(t),n=JSON.stringify({text:e,copyStyle:r});if(vy.widthCache[n])return vy.widthCache[n];try{var c=document.getElementById(h$);c||(c=document.createElement("span"),c.setAttribute("id",h$),c.setAttribute("aria-hidden","true"),document.body.appendChild(c));var h=MR(MR({},IDe),r);Object.assign(c.style,h),c.textContent="".concat(e);var p=c.getBoundingClientRect(),o={width:p.width,height:p.height};return vy.widthCache[n]=o,++vy.cacheCount>MDe&&(vy.cacheCount=0,vy.widthCache={}),o}catch{return{width:0,height:0}}},jDe=function(e){return{top:e.top+window.scrollY-document.documentElement.clientTop,left:e.left+window.scrollX-document.documentElement.clientLeft}};function dw(e){"@babel/helpers - typeof";return dw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dw(e)}function FE(e,t){return zDe(e)||LDe(e,t)||DDe(e,t)||RDe()}function RDe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DDe(e,t){if(e){if(typeof e=="string")return d$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d$(e,t)}}function d$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function LDe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;v=!1}else for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function zDe(e){if(Array.isArray(e))return e}function NDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f$(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,BDe(n.key),n)}}function FDe(e,t,r){return t&&f$(e.prototype,t),r&&f$(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function BDe(e){var t=UDe(e,"string");return dw(t)=="symbol"?t:t+""}function UDe(e,t){if(dw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(dw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var p$=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,m$=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,VDe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,$De=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,HQ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},GDe=Object.keys(HQ),Uy="NaN";function qDe(e,t){return e*HQ[t]}var QT=function(){function e(t,r){NDe(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!VDe.test(r)&&(this.num=NaN,this.unit=""),GDe.includes(r)&&(this.num=qDe(t,r),this.unit="px")}return FDe(e,[{key:"add",value:function(t){return this.unit!==t.unit?new e(NaN,""):new e(this.num+t.num,this.unit)}},{key:"subtract",value:function(t){return this.unit!==t.unit?new e(NaN,""):new e(this.num-t.num,this.unit)}},{key:"multiply",value:function(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new e(NaN,""):new e(this.num*t.num,this.unit||t.unit)}},{key:"divide",value:function(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new e(NaN,""):new e(this.num/t.num,this.unit||t.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(t){var r,n=(r=$De.exec(t))!==null&&r!==void 0?r:[],c=FE(n,3),h=c[1],p=c[2];return new e(parseFloat(h),p??"")}}])}();function WQ(e){if(e.includes(Uy))return Uy;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=p$.exec(t))!==null&&r!==void 0?r:[],c=FE(n,4),h=c[1],p=c[2],o=c[3],v=QT.parse(h??""),w=QT.parse(o??""),T=p==="*"?v.multiply(w):v.divide(w);if(T.isNaN())return Uy;t=t.replace(p$,T.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var M,O=(M=m$.exec(t))!==null&&M!==void 0?M:[],D=FE(O,4),B=D[1],N=D[2],G=D[3],V=QT.parse(B??""),U=QT.parse(G??""),X=N==="+"?V.add(U):V.subtract(U);if(X.isNaN())return Uy;t=t.replace(m$,X.toString())}return t}var g$=/\(([^()]*)\)/;function HDe(e){for(var t=e;t.includes("(");){var r=g$.exec(t),n=FE(r,2),c=n[1];t=t.replace(g$,WQ(c))}return t}function WDe(e){var t=e.replace(/\s+/g,"");return t=HDe(t),t=WQ(t),t}function ZDe(e){try{return WDe(e)}catch{return Uy}}function NI(e){var t=ZDe(e.slice(5,-1));return t===Uy?"":t}var KDe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],XDe=["dx","dy","angle","className","breakAll"];function IR(){return IR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},IR.apply(this,arguments)}function y$(e,t){if(e==null)return{};var r=YDe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function YDe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function _$(e,t){return tLe(e)||eLe(e,t)||QDe(e,t)||JDe()}function JDe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QDe(e,t){if(e){if(typeof e=="string")return v$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v$(e,t)}}function v$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function eLe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;v=!1}else for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function tLe(e){if(Array.isArray(e))return e}var ZQ=/[ \f\n\r\t\v\u2028\u2029]+/,KQ=function(e){var t=e.children,r=e.breakAll,n=e.style;try{var c=[];ni(t)||(r?c=t.toString().split(""):c=t.toString().split(ZQ));var h=c.map(function(o){return{word:o,width:kb(o,n).width}}),p=r?0:kb(" ",n).width;return{wordsWithComputedWidth:h,spaceWidth:p}}catch{return null}},rLe=function(e,t,r,n,c){var h=e.maxLines,p=e.children,o=e.style,v=e.breakAll,w=fr(h),T=p,M=function(){var Ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ye.reduce(function(Oe,tt){var He=tt.word,lt=tt.width,rt=Oe[Oe.length-1];if(rt&&(n==null||c||rt.width+lt+r<Number(n)))rt.words.push(He),rt.width+=lt+r;else{var ht={words:[He],width:lt};Oe.push(ht)}return Oe},[])},O=M(t),D=function(Ye){return Ye.reduce(function(Oe,tt){return Oe.width>tt.width?Oe:tt})};if(!w)return O;for(var B="…",N=function(Ye){var Oe=T.slice(0,Ye),tt=KQ({breakAll:v,style:o,children:Oe+B}).wordsWithComputedWidth,He=M(tt),lt=He.length>h||D(He).width>Number(n);return[lt,He]},G=0,V=T.length-1,U=0,X;G<=V&&U<=T.length-1;){var Y=Math.floor((G+V)/2),ne=Y-1,se=N(ne),le=_$(se,2),ge=le[0],je=le[1],ze=N(Y),Ce=_$(ze,1),Ke=Ce[0];if(!ge&&!Ke&&(G=Y+1),ge&&Ke&&(V=Y-1),!ge&&Ke){X=je;break}U++}return X||O},x$=function(e){var t=ni(e)?[]:e.toString().split(ZQ);return[{words:t}]},nLe=function(e){var t=e.width,r=e.scaleToFit,n=e.children,c=e.style,h=e.breakAll,p=e.maxLines;if((t||r)&&!gv.isSsr){var o,v,w=KQ({breakAll:h,children:n,style:c});if(w){var T=w.wordsWithComputedWidth,M=w.spaceWidth;o=T,v=M}else return x$(n);return rLe({breakAll:h,children:n,maxLines:p,style:c},o,v,t,r)}return x$(n)},b$="#808080",Em=function(e){var t=e.x,r=t===void 0?0:t,n=e.y,c=n===void 0?0:n,h=e.lineHeight,p=h===void 0?"1em":h,o=e.capHeight,v=o===void 0?"0.71em":o,w=e.scaleToFit,T=w===void 0?!1:w,M=e.textAnchor,O=M===void 0?"start":M,D=e.verticalAnchor,B=D===void 0?"end":D,N=e.fill,G=N===void 0?b$:N,V=y$(e,KDe),U=Z.useMemo(function(){return nLe({breakAll:V.breakAll,children:V.children,maxLines:V.maxLines,scaleToFit:T,style:V.style,width:V.width})},[V.breakAll,V.children,V.maxLines,T,V.style,V.width]),X=V.dx,Y=V.dy,ne=V.angle,se=V.className,le=V.breakAll,ge=y$(V,XDe);if(!oa(r)||!oa(c))return null;var je=r+(fr(X)?X:0),ze=c+(fr(Y)?Y:0),Ce;switch(B){case"start":Ce=NI("calc(".concat(v,")"));break;case"middle":Ce=NI("calc(".concat((U.length-1)/2," * -").concat(p," + (").concat(v," / 2))"));break;default:Ce=NI("calc(".concat(U.length-1," * -").concat(p,")"));break}var Ke=[];if(T){var Ye=U[0].width,Oe=V.width;Ke.push("scale(".concat((fr(Oe)?Oe/Ye:1)/Ye,")"))}return ne&&Ke.push("rotate(".concat(ne,", ").concat(je,", ").concat(ze,")")),Ke.length&&(ge.transform=Ke.join(" ")),Ne.createElement("text",IR({},Sn(ge,!0),{x:je,y:ze,className:Hn("recharts-text",se),textAnchor:O,fill:G.includes("url")?b$:G}),U.map(function(tt,He){var lt=tt.words.join(le?"":" ");return Ne.createElement("tspan",{x:je,dy:He===0?Ce:p,key:"".concat(lt,"-").concat(He)},lt)}))};function df(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function iLe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function XQ(e){let t,r,n;e.length!==2?(t=df,r=(o,v)=>df(e(o),v),n=(o,v)=>e(o)-v):(t=e===df||e===iLe?e:oLe,r=e,n=e);function c(o,v,w=0,T=o.length){if(w<T){if(t(v,v)!==0)return T;do{const M=w+T>>>1;r(o[M],v)<0?w=M+1:T=M}while(w<T)}return w}function h(o,v,w=0,T=o.length){if(w<T){if(t(v,v)!==0)return T;do{const M=w+T>>>1;r(o[M],v)<=0?w=M+1:T=M}while(w<T)}return w}function p(o,v,w=0,T=o.length){const M=c(o,v,w,T-1);return M>w&&n(o[M-1],v)>-n(o[M],v)?M-1:M}return{left:c,center:p,right:h}}function oLe(){return 0}function YQ(e){return e===null?NaN:+e}function*aLe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const sLe=XQ(df),c1=sLe.right;XQ(YQ).center;class w$ extends Map{constructor(t,r=uLe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,c]of t)this.set(n,c)}get(t){return super.get(S$(this,t))}has(t){return super.has(S$(this,t))}set(t,r){return super.set(lLe(this,t),r)}delete(t){return super.delete(cLe(this,t))}}function S$({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function lLe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function cLe({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function uLe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function hLe(e=df){if(e===df)return JQ;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function JQ(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const dLe=Math.sqrt(50),fLe=Math.sqrt(10),pLe=Math.sqrt(2);function BE(e,t,r){const n=(t-e)/Math.max(0,r),c=Math.floor(Math.log10(n)),h=n/Math.pow(10,c),p=h>=dLe?10:h>=fLe?5:h>=pLe?2:1;let o,v,w;return c<0?(w=Math.pow(10,-c)/p,o=Math.round(e*w),v=Math.round(t*w),o/w<e&&++o,v/w>t&&--v,w=-w):(w=Math.pow(10,c)*p,o=Math.round(e/w),v=Math.round(t/w),o*w<e&&++o,v*w>t&&--v),v<o&&.5<=r&&r<2?BE(e,t,r*2):[o,v,w]}function OR(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[c,h,p]=n?BE(t,e,r):BE(e,t,r);if(!(h>=c))return[];const o=h-c+1,v=new Array(o);if(n)if(p<0)for(let w=0;w<o;++w)v[w]=(h-w)/-p;else for(let w=0;w<o;++w)v[w]=(h-w)*p;else if(p<0)for(let w=0;w<o;++w)v[w]=(c+w)/-p;else for(let w=0;w<o;++w)v[w]=(c+w)*p;return v}function jR(e,t,r){return t=+t,e=+e,r=+r,BE(e,t,r)[2]}function mLe(e,t,r){t=+t,e=+e,r=+r;const n=t<e,c=n?jR(t,e,r):jR(e,t,r);return(n?-1:1)*(c<0?1/-c:c)}function T$(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function E$(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function QQ(e,t,r=0,n=1/0,c){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(c=c===void 0?JQ:hLe(c);n>r;){if(n-r>600){const v=n-r+1,w=t-r+1,T=Math.log(v),M=.5*Math.exp(2*T/3),O=.5*Math.sqrt(T*M*(v-M)/v)*(w-v/2<0?-1:1),D=Math.max(r,Math.floor(t-w*M/v+O)),B=Math.min(n,Math.floor(t+(v-w)*M/v+O));QQ(e,t,D,B,c)}const h=e[t];let p=r,o=n;for($x(e,r,t),c(e[n],h)>0&&$x(e,r,n);p<o;){for($x(e,p,o),++p,--o;c(e[p],h)<0;)++p;for(;c(e[o],h)>0;)--o}c(e[r],h)===0?$x(e,r,o):(++o,$x(e,o,n)),o<=t&&(r=o+1),t<=o&&(n=o-1)}return e}function $x(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function gLe(e,t,r){if(e=Float64Array.from(aLe(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return E$(e);if(t>=1)return T$(e);var n,c=(n-1)*t,h=Math.floor(c),p=T$(QQ(e,h).subarray(0,h+1)),o=E$(e.subarray(h+1));return p+(o-p)*(c-h)}}function yLe(e,t,r=YQ){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,c=(n-1)*t,h=Math.floor(c),p=+r(e[h],h,e),o=+r(e[h+1],h+1,e);return p+(o-p)*(c-h)}}function _Le(e,t,r){e=+e,t=+t,r=(c=arguments.length)<2?(t=e,e=0,1):c<3?1:+r;for(var n=-1,c=Math.max(0,Math.ceil((t-e)/r))|0,h=new Array(c);++n<c;)h[n]=e+n*r;return h}function Vl(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Uh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const RR=Symbol("implicit");function Pz(){var e=new w$,t=[],r=[],n=RR;function c(h){let p=e.get(h);if(p===void 0){if(n!==RR)return n;e.set(h,p=t.push(h)-1)}return r[p%r.length]}return c.domain=function(h){if(!arguments.length)return t.slice();t=[],e=new w$;for(const p of h)e.has(p)||e.set(p,t.push(p)-1);return c},c.range=function(h){return arguments.length?(r=Array.from(h),c):r.slice()},c.unknown=function(h){return arguments.length?(n=h,c):n},c.copy=function(){return Pz(t,r).unknown(n)},Vl.apply(c,arguments),c}function fw(){var e=Pz().unknown(void 0),t=e.domain,r=e.range,n=0,c=1,h,p,o=!1,v=0,w=0,T=.5;delete e.unknown;function M(){var O=t().length,D=c<n,B=D?c:n,N=D?n:c;h=(N-B)/Math.max(1,O-v+w*2),o&&(h=Math.floor(h)),B+=(N-B-h*(O-v))*T,p=h*(1-v),o&&(B=Math.round(B),p=Math.round(p));var G=_Le(O).map(function(V){return B+h*V});return r(D?G.reverse():G)}return e.domain=function(O){return arguments.length?(t(O),M()):t()},e.range=function(O){return arguments.length?([n,c]=O,n=+n,c=+c,M()):[n,c]},e.rangeRound=function(O){return[n,c]=O,n=+n,c=+c,o=!0,M()},e.bandwidth=function(){return p},e.step=function(){return h},e.round=function(O){return arguments.length?(o=!!O,M()):o},e.padding=function(O){return arguments.length?(v=Math.min(1,w=+O),M()):v},e.paddingInner=function(O){return arguments.length?(v=Math.min(1,O),M()):v},e.paddingOuter=function(O){return arguments.length?(w=+O,M()):w},e.align=function(O){return arguments.length?(T=Math.max(0,Math.min(1,O)),M()):T},e.copy=function(){return fw(t(),[n,c]).round(o).paddingInner(v).paddingOuter(w).align(T)},Vl.apply(M(),arguments)}function eee(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return eee(t())},e}function Cb(){return eee(fw.apply(null,arguments).paddingInner(1))}function Mz(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function tee(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function u1(){}var pw=.7,UE=1/pw,s_="\\s*([+-]?\\d+)\\s*",mw="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Eu="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vLe=/^#([0-9a-f]{3,8})$/,xLe=new RegExp(`^rgb\\(${s_},${s_},${s_}\\)$`),bLe=new RegExp(`^rgb\\(${Eu},${Eu},${Eu}\\)$`),wLe=new RegExp(`^rgba\\(${s_},${s_},${s_},${mw}\\)$`),SLe=new RegExp(`^rgba\\(${Eu},${Eu},${Eu},${mw}\\)$`),TLe=new RegExp(`^hsl\\(${mw},${Eu},${Eu}\\)$`),ELe=new RegExp(`^hsla\\(${mw},${Eu},${Eu},${mw}\\)$`),A$={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Mz(u1,gw,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:k$,formatHex:k$,formatHex8:ALe,formatHsl:kLe,formatRgb:C$,toString:C$});function k$(){return this.rgb().formatHex()}function ALe(){return this.rgb().formatHex8()}function kLe(){return ree(this).formatHsl()}function C$(){return this.rgb().formatRgb()}function gw(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=vLe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?P$(t):r===3?new $s(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?e2(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?e2(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=xLe.exec(e))?new $s(t[1],t[2],t[3],1):(t=bLe.exec(e))?new $s(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=wLe.exec(e))?e2(t[1],t[2],t[3],t[4]):(t=SLe.exec(e))?e2(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=TLe.exec(e))?O$(t[1],t[2]/100,t[3]/100,1):(t=ELe.exec(e))?O$(t[1],t[2]/100,t[3]/100,t[4]):A$.hasOwnProperty(e)?P$(A$[e]):e==="transparent"?new $s(NaN,NaN,NaN,0):null}function P$(e){return new $s(e>>16&255,e>>8&255,e&255,1)}function e2(e,t,r,n){return n<=0&&(e=t=r=NaN),new $s(e,t,r,n)}function CLe(e){return e instanceof u1||(e=gw(e)),e?(e=e.rgb(),new $s(e.r,e.g,e.b,e.opacity)):new $s}function DR(e,t,r,n){return arguments.length===1?CLe(e):new $s(e,t,r,n??1)}function $s(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}Mz($s,DR,tee(u1,{brighter(e){return e=e==null?UE:Math.pow(UE,e),new $s(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?pw:Math.pow(pw,e),new $s(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new $s(um(this.r),um(this.g),um(this.b),VE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:M$,formatHex:M$,formatHex8:PLe,formatRgb:I$,toString:I$}));function M$(){return`#${rm(this.r)}${rm(this.g)}${rm(this.b)}`}function PLe(){return`#${rm(this.r)}${rm(this.g)}${rm(this.b)}${rm((isNaN(this.opacity)?1:this.opacity)*255)}`}function I$(){const e=VE(this.opacity);return`${e===1?"rgb(":"rgba("}${um(this.r)}, ${um(this.g)}, ${um(this.b)}${e===1?")":`, ${e})`}`}function VE(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function um(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function rm(e){return e=um(e),(e<16?"0":"")+e.toString(16)}function O$(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new mc(e,t,r,n)}function ree(e){if(e instanceof mc)return new mc(e.h,e.s,e.l,e.opacity);if(e instanceof u1||(e=gw(e)),!e)return new mc;if(e instanceof mc)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,c=Math.min(t,r,n),h=Math.max(t,r,n),p=NaN,o=h-c,v=(h+c)/2;return o?(t===h?p=(r-n)/o+(r<n)*6:r===h?p=(n-t)/o+2:p=(t-r)/o+4,o/=v<.5?h+c:2-h-c,p*=60):o=v>0&&v<1?0:p,new mc(p,o,v,e.opacity)}function MLe(e,t,r,n){return arguments.length===1?ree(e):new mc(e,t,r,n??1)}function mc(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}Mz(mc,MLe,tee(u1,{brighter(e){return e=e==null?UE:Math.pow(UE,e),new mc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?pw:Math.pow(pw,e),new mc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,c=2*r-n;return new $s(FI(e>=240?e-240:e+120,c,n),FI(e,c,n),FI(e<120?e+240:e-120,c,n),this.opacity)},clamp(){return new mc(j$(this.h),t2(this.s),t2(this.l),VE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=VE(this.opacity);return`${e===1?"hsl(":"hsla("}${j$(this.h)}, ${t2(this.s)*100}%, ${t2(this.l)*100}%${e===1?")":`, ${e})`}`}}));function j$(e){return e=(e||0)%360,e<0?e+360:e}function t2(e){return Math.max(0,Math.min(1,e||0))}function FI(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const Iz=e=>()=>e;function ILe(e,t){return function(r){return e+r*t}}function OLe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function jLe(e){return(e=+e)==1?nee:function(t,r){return r-t?OLe(t,r,e):Iz(isNaN(t)?r:t)}}function nee(e,t){var r=t-e;return r?ILe(e,r):Iz(isNaN(e)?t:e)}const R$=function e(t){var r=jLe(t);function n(c,h){var p=r((c=DR(c)).r,(h=DR(h)).r),o=r(c.g,h.g),v=r(c.b,h.b),w=nee(c.opacity,h.opacity);return function(T){return c.r=p(T),c.g=o(T),c.b=v(T),c.opacity=w(T),c+""}}return n.gamma=e,n}(1);function RLe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),c;return function(h){for(c=0;c<r;++c)n[c]=e[c]*(1-h)+t[c]*h;return n}}function DLe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function LLe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,c=new Array(n),h=new Array(r),p;for(p=0;p<n;++p)c[p]=yv(e[p],t[p]);for(;p<r;++p)h[p]=t[p];return function(o){for(p=0;p<n;++p)h[p]=c[p](o);return h}}function zLe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function $E(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function NLe(e,t){var r={},n={},c;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(c in t)c in e?r[c]=yv(e[c],t[c]):n[c]=t[c];return function(h){for(c in r)n[c]=r[c](h);return n}}var LR=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,BI=new RegExp(LR.source,"g");function FLe(e){return function(){return e}}function BLe(e){return function(t){return e(t)+""}}function ULe(e,t){var r=LR.lastIndex=BI.lastIndex=0,n,c,h,p=-1,o=[],v=[];for(e=e+"",t=t+"";(n=LR.exec(e))&&(c=BI.exec(t));)(h=c.index)>r&&(h=t.slice(r,h),o[p]?o[p]+=h:o[++p]=h),(n=n[0])===(c=c[0])?o[p]?o[p]+=c:o[++p]=c:(o[++p]=null,v.push({i:p,x:$E(n,c)})),r=BI.lastIndex;return r<t.length&&(h=t.slice(r),o[p]?o[p]+=h:o[++p]=h),o.length<2?v[0]?BLe(v[0].x):FLe(t):(t=v.length,function(w){for(var T=0,M;T<t;++T)o[(M=v[T]).i]=M.x(w);return o.join("")})}function yv(e,t){var r=typeof t,n;return t==null||r==="boolean"?Iz(t):(r==="number"?$E:r==="string"?(n=gw(t))?(t=n,R$):ULe:t instanceof gw?R$:t instanceof Date?zLe:DLe(t)?RLe:Array.isArray(t)?LLe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?NLe:$E)(e,t)}function Oz(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function VLe(e,t){t===void 0&&(t=e,e=yv);for(var r=0,n=t.length-1,c=t[0],h=new Array(n<0?0:n);r<n;)h[r]=e(c,c=t[++r]);return function(p){var o=Math.max(0,Math.min(n-1,Math.floor(p*=n)));return h[o](p-o)}}function $Le(e){return function(){return e}}function GE(e){return+e}var D$=[0,1];function vs(e){return e}function zR(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:$Le(isNaN(t)?NaN:.5)}function GLe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function qLe(e,t,r){var n=e[0],c=e[1],h=t[0],p=t[1];return c<n?(n=zR(c,n),h=r(p,h)):(n=zR(n,c),h=r(h,p)),function(o){return h(n(o))}}function HLe(e,t,r){var n=Math.min(e.length,t.length)-1,c=new Array(n),h=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++p<n;)c[p]=zR(e[p],e[p+1]),h[p]=r(t[p],t[p+1]);return function(o){var v=c1(e,o,1,n)-1;return h[v](c[v](o))}}function h1(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Jk(){var e=D$,t=D$,r=yv,n,c,h,p=vs,o,v,w;function T(){var O=Math.min(e.length,t.length);return p!==vs&&(p=GLe(e[0],e[O-1])),o=O>2?HLe:qLe,v=w=null,M}function M(O){return O==null||isNaN(O=+O)?h:(v||(v=o(e.map(n),t,r)))(n(p(O)))}return M.invert=function(O){return p(c((w||(w=o(t,e.map(n),$E)))(O)))},M.domain=function(O){return arguments.length?(e=Array.from(O,GE),T()):e.slice()},M.range=function(O){return arguments.length?(t=Array.from(O),T()):t.slice()},M.rangeRound=function(O){return t=Array.from(O),r=Oz,T()},M.clamp=function(O){return arguments.length?(p=O?!0:vs,T()):p!==vs},M.interpolate=function(O){return arguments.length?(r=O,T()):r},M.unknown=function(O){return arguments.length?(h=O,M):h},function(O,D){return n=O,c=D,T()}}function jz(){return Jk()(vs,vs)}function WLe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function qE(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function k_(e){return e=qE(Math.abs(e)),e?e[1]:NaN}function ZLe(e,t){return function(r,n){for(var c=r.length,h=[],p=0,o=e[0],v=0;c>0&&o>0&&(v+o+1>n&&(o=Math.max(1,n-v)),h.push(r.substring(c-=o,c+o)),!((v+=o+1)>n));)o=e[p=(p+1)%e.length];return h.reverse().join(t)}}function KLe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var XLe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function yw(e){if(!(t=XLe.exec(e)))throw new Error("invalid format: "+e);var t;return new Rz({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}yw.prototype=Rz.prototype;function Rz(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Rz.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function YLe(e){e:for(var t=e.length,r=1,n=-1,c;r<t;++r)switch(e[r]){case".":n=c=r;break;case"0":n===0&&(n=r),c=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(c+1):e}var iee;function JLe(e,t){var r=qE(e,t);if(!r)return e+"";var n=r[0],c=r[1],h=c-(iee=Math.max(-8,Math.min(8,Math.floor(c/3)))*3)+1,p=n.length;return h===p?n:h>p?n+new Array(h-p+1).join("0"):h>0?n.slice(0,h)+"."+n.slice(h):"0."+new Array(1-h).join("0")+qE(e,Math.max(0,t+h-1))[0]}function L$(e,t){var r=qE(e,t);if(!r)return e+"";var n=r[0],c=r[1];return c<0?"0."+new Array(-c).join("0")+n:n.length>c+1?n.slice(0,c+1)+"."+n.slice(c+1):n+new Array(c-n.length+2).join("0")}const z$={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:WLe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>L$(e*100,t),r:L$,s:JLe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function N$(e){return e}var F$=Array.prototype.map,B$=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function QLe(e){var t=e.grouping===void 0||e.thousands===void 0?N$:ZLe(F$.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",c=e.decimal===void 0?".":e.decimal+"",h=e.numerals===void 0?N$:KLe(F$.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",o=e.minus===void 0?"−":e.minus+"",v=e.nan===void 0?"NaN":e.nan+"";function w(M){M=yw(M);var O=M.fill,D=M.align,B=M.sign,N=M.symbol,G=M.zero,V=M.width,U=M.comma,X=M.precision,Y=M.trim,ne=M.type;ne==="n"?(U=!0,ne="g"):z$[ne]||(X===void 0&&(X=12),Y=!0,ne="g"),(G||O==="0"&&D==="=")&&(G=!0,O="0",D="=");var se=N==="$"?r:N==="#"&&/[boxX]/.test(ne)?"0"+ne.toLowerCase():"",le=N==="$"?n:/[%p]/.test(ne)?p:"",ge=z$[ne],je=/[defgprs%]/.test(ne);X=X===void 0?6:/[gprs]/.test(ne)?Math.max(1,Math.min(21,X)):Math.max(0,Math.min(20,X));function ze(Ce){var Ke=se,Ye=le,Oe,tt,He;if(ne==="c")Ye=ge(Ce)+Ye,Ce="";else{Ce=+Ce;var lt=Ce<0||1/Ce<0;if(Ce=isNaN(Ce)?v:ge(Math.abs(Ce),X),Y&&(Ce=YLe(Ce)),lt&&+Ce==0&&B!=="+"&&(lt=!1),Ke=(lt?B==="("?B:o:B==="-"||B==="("?"":B)+Ke,Ye=(ne==="s"?B$[8+iee/3]:"")+Ye+(lt&&B==="("?")":""),je){for(Oe=-1,tt=Ce.length;++Oe<tt;)if(He=Ce.charCodeAt(Oe),48>He||He>57){Ye=(He===46?c+Ce.slice(Oe+1):Ce.slice(Oe))+Ye,Ce=Ce.slice(0,Oe);break}}}U&&!G&&(Ce=t(Ce,1/0));var rt=Ke.length+Ce.length+Ye.length,ht=rt<V?new Array(V-rt+1).join(O):"";switch(U&&G&&(Ce=t(ht+Ce,ht.length?V-Ye.length:1/0),ht=""),D){case"<":Ce=Ke+Ce+Ye+ht;break;case"=":Ce=Ke+ht+Ce+Ye;break;case"^":Ce=ht.slice(0,rt=ht.length>>1)+Ke+Ce+Ye+ht.slice(rt);break;default:Ce=ht+Ke+Ce+Ye;break}return h(Ce)}return ze.toString=function(){return M+""},ze}function T(M,O){var D=w((M=yw(M),M.type="f",M)),B=Math.max(-8,Math.min(8,Math.floor(k_(O)/3)))*3,N=Math.pow(10,-B),G=B$[8+B/3];return function(V){return D(N*V)+G}}return{format:w,formatPrefix:T}}var r2,Dz,oee;e3e({thousands:",",grouping:[3],currency:["$",""]});function e3e(e){return r2=QLe(e),Dz=r2.format,oee=r2.formatPrefix,r2}function t3e(e){return Math.max(0,-k_(Math.abs(e)))}function r3e(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(k_(t)/3)))*3-k_(Math.abs(e)))}function n3e(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,k_(t)-k_(e))+1}function aee(e,t,r,n){var c=mLe(e,t,r),h;switch(n=yw(n??",f"),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(h=r3e(c,p))&&(n.precision=h),oee(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(h=n3e(c,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=h-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(h=t3e(c))&&(n.precision=h-(n.type==="%")*2);break}}return Dz(n)}function kf(e){var t=e.domain;return e.ticks=function(r){var n=t();return OR(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var c=t();return aee(c[0],c[c.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),c=0,h=n.length-1,p=n[c],o=n[h],v,w,T=10;for(o<p&&(w=p,p=o,o=w,w=c,c=h,h=w);T-- >0;){if(w=jR(p,o,r),w===v)return n[c]=p,n[h]=o,t(n);if(w>0)p=Math.floor(p/w)*w,o=Math.ceil(o/w)*w;else if(w<0)p=Math.ceil(p*w)/w,o=Math.floor(o*w)/w;else break;v=w}return e},e}function HE(){var e=jz();return e.copy=function(){return h1(e,HE())},Vl.apply(e,arguments),kf(e)}function see(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,GE),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return see(e).unknown(t)},e=arguments.length?Array.from(e,GE):[0,1],kf(r)}function lee(e,t){e=e.slice();var r=0,n=e.length-1,c=e[r],h=e[n],p;return h<c&&(p=r,r=n,n=p,p=c,c=h,h=p),e[r]=t.floor(c),e[n]=t.ceil(h),e}function U$(e){return Math.log(e)}function V$(e){return Math.exp(e)}function i3e(e){return-Math.log(-e)}function o3e(e){return-Math.exp(-e)}function a3e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function s3e(e){return e===10?a3e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function l3e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function $$(e){return(t,r)=>-e(-t,r)}function Lz(e){const t=e(U$,V$),r=t.domain;let n=10,c,h;function p(){return c=l3e(n),h=s3e(n),r()[0]<0?(c=$$(c),h=$$(h),e(i3e,o3e)):e(U$,V$),t}return t.base=function(o){return arguments.length?(n=+o,p()):n},t.domain=function(o){return arguments.length?(r(o),p()):r()},t.ticks=o=>{const v=r();let w=v[0],T=v[v.length-1];const M=T<w;M&&([w,T]=[T,w]);let O=c(w),D=c(T),B,N;const G=o==null?10:+o;let V=[];if(!(n%1)&&D-O<G){if(O=Math.floor(O),D=Math.ceil(D),w>0){for(;O<=D;++O)for(B=1;B<n;++B)if(N=O<0?B/h(-O):B*h(O),!(N<w)){if(N>T)break;V.push(N)}}else for(;O<=D;++O)for(B=n-1;B>=1;--B)if(N=O>0?B/h(-O):B*h(O),!(N<w)){if(N>T)break;V.push(N)}V.length*2<G&&(V=OR(w,T,G))}else V=OR(O,D,Math.min(D-O,G)).map(h);return M?V.reverse():V},t.tickFormat=(o,v)=>{if(o==null&&(o=10),v==null&&(v=n===10?"s":","),typeof v!="function"&&(!(n%1)&&(v=yw(v)).precision==null&&(v.trim=!0),v=Dz(v)),o===1/0)return v;const w=Math.max(1,n*o/t.ticks().length);return T=>{let M=T/h(Math.round(c(T)));return M*n<n-.5&&(M*=n),M<=w?v(T):""}},t.nice=()=>r(lee(r(),{floor:o=>h(Math.floor(c(o))),ceil:o=>h(Math.ceil(c(o)))})),t}function cee(){const e=Lz(Jk()).domain([1,10]);return e.copy=()=>h1(e,cee()).base(e.base()),Vl.apply(e,arguments),e}function G$(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function q$(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function zz(e){var t=1,r=e(G$(t),q$(t));return r.constant=function(n){return arguments.length?e(G$(t=+n),q$(t)):t},kf(r)}function uee(){var e=zz(Jk());return e.copy=function(){return h1(e,uee()).constant(e.constant())},Vl.apply(e,arguments)}function H$(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function c3e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function u3e(e){return e<0?-e*e:e*e}function Nz(e){var t=e(vs,vs),r=1;function n(){return r===1?e(vs,vs):r===.5?e(c3e,u3e):e(H$(r),H$(1/r))}return t.exponent=function(c){return arguments.length?(r=+c,n()):r},kf(t)}function Fz(){var e=Nz(Jk());return e.copy=function(){return h1(e,Fz()).exponent(e.exponent())},Vl.apply(e,arguments),e}function h3e(){return Fz.apply(null,arguments).exponent(.5)}function W$(e){return Math.sign(e)*e*e}function d3e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function hee(){var e=jz(),t=[0,1],r=!1,n;function c(h){var p=d3e(e(h));return isNaN(p)?n:r?Math.round(p):p}return c.invert=function(h){return e.invert(W$(h))},c.domain=function(h){return arguments.length?(e.domain(h),c):e.domain()},c.range=function(h){return arguments.length?(e.range((t=Array.from(h,GE)).map(W$)),c):t.slice()},c.rangeRound=function(h){return c.range(h).round(!0)},c.round=function(h){return arguments.length?(r=!!h,c):r},c.clamp=function(h){return arguments.length?(e.clamp(h),c):e.clamp()},c.unknown=function(h){return arguments.length?(n=h,c):n},c.copy=function(){return hee(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Vl.apply(c,arguments),kf(c)}function dee(){var e=[],t=[],r=[],n;function c(){var p=0,o=Math.max(1,t.length);for(r=new Array(o-1);++p<o;)r[p-1]=yLe(e,p/o);return h}function h(p){return p==null||isNaN(p=+p)?n:t[c1(r,p)]}return h.invertExtent=function(p){var o=t.indexOf(p);return o<0?[NaN,NaN]:[o>0?r[o-1]:e[0],o<r.length?r[o]:e[e.length-1]]},h.domain=function(p){if(!arguments.length)return e.slice();e=[];for(let o of p)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(df),c()},h.range=function(p){return arguments.length?(t=Array.from(p),c()):t.slice()},h.unknown=function(p){return arguments.length?(n=p,h):n},h.quantiles=function(){return r.slice()},h.copy=function(){return dee().domain(e).range(t).unknown(n)},Vl.apply(h,arguments)}function fee(){var e=0,t=1,r=1,n=[.5],c=[0,1],h;function p(v){return v!=null&&v<=v?c[c1(n,v,0,r)]:h}function o(){var v=-1;for(n=new Array(r);++v<r;)n[v]=((v+1)*t-(v-r)*e)/(r+1);return p}return p.domain=function(v){return arguments.length?([e,t]=v,e=+e,t=+t,o()):[e,t]},p.range=function(v){return arguments.length?(r=(c=Array.from(v)).length-1,o()):c.slice()},p.invertExtent=function(v){var w=c.indexOf(v);return w<0?[NaN,NaN]:w<1?[e,n[0]]:w>=r?[n[r-1],t]:[n[w-1],n[w]]},p.unknown=function(v){return arguments.length&&(h=v),p},p.thresholds=function(){return n.slice()},p.copy=function(){return fee().domain([e,t]).range(c).unknown(h)},Vl.apply(kf(p),arguments)}function pee(){var e=[.5],t=[0,1],r,n=1;function c(h){return h!=null&&h<=h?t[c1(e,h,0,n)]:r}return c.domain=function(h){return arguments.length?(e=Array.from(h),n=Math.min(e.length,t.length-1),c):e.slice()},c.range=function(h){return arguments.length?(t=Array.from(h),n=Math.min(e.length,t.length-1),c):t.slice()},c.invertExtent=function(h){var p=t.indexOf(h);return[e[p-1],e[p]]},c.unknown=function(h){return arguments.length?(r=h,c):r},c.copy=function(){return pee().domain(e).range(t).unknown(r)},Vl.apply(c,arguments)}const UI=new Date,VI=new Date;function aa(e,t,r,n){function c(h){return e(h=arguments.length===0?new Date:new Date(+h)),h}return c.floor=h=>(e(h=new Date(+h)),h),c.ceil=h=>(e(h=new Date(h-1)),t(h,1),e(h),h),c.round=h=>{const p=c(h),o=c.ceil(h);return h-p<o-h?p:o},c.offset=(h,p)=>(t(h=new Date(+h),p==null?1:Math.floor(p)),h),c.range=(h,p,o)=>{const v=[];if(h=c.ceil(h),o=o==null?1:Math.floor(o),!(h<p)||!(o>0))return v;let w;do v.push(w=new Date(+h)),t(h,o),e(h);while(w<h&&h<p);return v},c.filter=h=>aa(p=>{if(p>=p)for(;e(p),!h(p);)p.setTime(p-1)},(p,o)=>{if(p>=p)if(o<0)for(;++o<=0;)for(;t(p,-1),!h(p););else for(;--o>=0;)for(;t(p,1),!h(p););}),r&&(c.count=(h,p)=>(UI.setTime(+h),VI.setTime(+p),e(UI),e(VI),Math.floor(r(UI,VI))),c.every=h=>(h=Math.floor(h),!isFinite(h)||!(h>0)?null:h>1?c.filter(n?p=>n(p)%h===0:p=>c.count(0,p)%h===0):c)),c}const WE=aa(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);WE.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?aa(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):WE);WE.range;const gh=1e3,jl=gh*60,yh=jl*60,Oh=yh*24,Bz=Oh*7,Z$=Oh*30,$I=Oh*365,nm=aa(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*gh)},(e,t)=>(t-e)/gh,e=>e.getUTCSeconds());nm.range;const Uz=aa(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*gh)},(e,t)=>{e.setTime(+e+t*jl)},(e,t)=>(t-e)/jl,e=>e.getMinutes());Uz.range;const Vz=aa(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*jl)},(e,t)=>(t-e)/jl,e=>e.getUTCMinutes());Vz.range;const $z=aa(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*gh-e.getMinutes()*jl)},(e,t)=>{e.setTime(+e+t*yh)},(e,t)=>(t-e)/yh,e=>e.getHours());$z.range;const Gz=aa(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*yh)},(e,t)=>(t-e)/yh,e=>e.getUTCHours());Gz.range;const d1=aa(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*jl)/Oh,e=>e.getDate()-1);d1.range;const Qk=aa(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Oh,e=>e.getUTCDate()-1);Qk.range;const mee=aa(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Oh,e=>Math.floor(e/Oh));mee.range;function zm(e){return aa(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*jl)/Bz)}const eC=zm(0),ZE=zm(1),f3e=zm(2),p3e=zm(3),C_=zm(4),m3e=zm(5),g3e=zm(6);eC.range;ZE.range;f3e.range;p3e.range;C_.range;m3e.range;g3e.range;function Nm(e){return aa(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/Bz)}const tC=Nm(0),KE=Nm(1),y3e=Nm(2),_3e=Nm(3),P_=Nm(4),v3e=Nm(5),x3e=Nm(6);tC.range;KE.range;y3e.range;_3e.range;P_.range;v3e.range;x3e.range;const qz=aa(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());qz.range;const Hz=aa(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Hz.range;const jh=aa(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());jh.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:aa(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});jh.range;const Rh=aa(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Rh.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:aa(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Rh.range;function GI(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function b3e(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function w3e(e){let t,r,n;e.length!==2?(t=GI,r=(o,v)=>GI(e(o),v),n=(o,v)=>e(o)-v):(t=e===GI||e===b3e?e:S3e,r=e,n=e);function c(o,v,w=0,T=o.length){if(w<T){if(t(v,v)!==0)return T;do{const M=w+T>>>1;r(o[M],v)<0?w=M+1:T=M}while(w<T)}return w}function h(o,v,w=0,T=o.length){if(w<T){if(t(v,v)!==0)return T;do{const M=w+T>>>1;r(o[M],v)<=0?w=M+1:T=M}while(w<T)}return w}function p(o,v,w=0,T=o.length){const M=c(o,v,w,T-1);return M>w&&n(o[M-1],v)>-n(o[M],v)?M-1:M}return{left:c,center:p,right:h}}function S3e(){return 0}const T3e=Math.sqrt(50),E3e=Math.sqrt(10),A3e=Math.sqrt(2);function gee(e,t,r){const n=(t-e)/Math.max(0,r),c=Math.floor(Math.log10(n)),h=n/Math.pow(10,c),p=h>=T3e?10:h>=E3e?5:h>=A3e?2:1;let o,v,w;return c<0?(w=Math.pow(10,-c)/p,o=Math.round(e*w),v=Math.round(t*w),o/w<e&&++o,v/w>t&&--v,w=-w):(w=Math.pow(10,c)*p,o=Math.round(e/w),v=Math.round(t/w),o*w<e&&++o,v*w>t&&--v),v<o&&.5<=r&&r<2?gee(e,t,r*2):[o,v,w]}function K$(e,t,r){return t=+t,e=+e,r=+r,gee(e,t,r)[2]}function X$(e,t,r){t=+t,e=+e,r=+r;const n=t<e,c=n?K$(t,e,r):K$(e,t,r);return(n?-1:1)*(c<0?1/-c:c)}function yee(e,t,r,n,c,h){const p=[[nm,1,gh],[nm,5,5*gh],[nm,15,15*gh],[nm,30,30*gh],[h,1,jl],[h,5,5*jl],[h,15,15*jl],[h,30,30*jl],[c,1,yh],[c,3,3*yh],[c,6,6*yh],[c,12,12*yh],[n,1,Oh],[n,2,2*Oh],[r,1,Bz],[t,1,Z$],[t,3,3*Z$],[e,1,$I]];function o(w,T,M){const O=T<w;O&&([w,T]=[T,w]);const D=M&&typeof M.range=="function"?M:v(w,T,M),B=D?D.range(w,+T+1):[];return O?B.reverse():B}function v(w,T,M){const O=Math.abs(T-w)/M,D=w3e(([,,G])=>G).right(p,O);if(D===p.length)return e.every(X$(w/$I,T/$I,M));if(D===0)return WE.every(Math.max(X$(w,T,M),1));const[B,N]=p[O/p[D-1][2]<p[D][2]/O?D-1:D];return B.every(N)}return[o,v]}const[k3e,C3e]=yee(Rh,Hz,tC,mee,Gz,Vz),[P3e,M3e]=yee(jh,qz,eC,d1,$z,Uz);function qI(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function HI(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Gx(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function I3e(e){var t=e.dateTime,r=e.date,n=e.time,c=e.periods,h=e.days,p=e.shortDays,o=e.months,v=e.shortMonths,w=qx(c),T=Hx(c),M=qx(h),O=Hx(h),D=qx(p),B=Hx(p),N=qx(o),G=Hx(o),V=qx(v),U=Hx(v),X={a:lt,A:rt,b:ht,B:vt,c:null,d:rG,e:rG,f:eze,g:uze,G:dze,H:Y3e,I:J3e,j:Q3e,L:_ee,m:tze,M:rze,p:mt,q:ct,Q:oG,s:aG,S:nze,u:ize,U:oze,V:aze,w:sze,W:lze,x:null,X:null,y:cze,Y:hze,Z:fze,"%":iG},Y={a:Vt,A:xr,b:tn,B:Er,c:null,d:nG,e:nG,f:yze,g:kze,G:Pze,H:pze,I:mze,j:gze,L:xee,m:_ze,M:vze,p:Ft,q:br,Q:oG,s:aG,S:xze,u:bze,U:wze,V:Sze,w:Tze,W:Eze,x:null,X:null,y:Aze,Y:Cze,Z:Mze,"%":iG},ne={a:ze,A:Ce,b:Ke,B:Ye,c:Oe,d:eG,e:eG,f:W3e,g:Q$,G:J$,H:tG,I:tG,j:$3e,L:H3e,m:V3e,M:G3e,p:je,q:U3e,Q:K3e,s:X3e,S:q3e,u:L3e,U:z3e,V:N3e,w:D3e,W:F3e,x:tt,X:He,y:Q$,Y:J$,Z:B3e,"%":Z3e};X.x=se(r,X),X.X=se(n,X),X.c=se(t,X),Y.x=se(r,Y),Y.X=se(n,Y),Y.c=se(t,Y);function se(Yt,Qt){return function(Sr){var Ut=[],Nn=-1,Jr=0,Kr=Yt.length,In,Fi,$o;for(Sr instanceof Date||(Sr=new Date(+Sr));++Nn<Kr;)Yt.charCodeAt(Nn)===37&&(Ut.push(Yt.slice(Jr,Nn)),(Fi=Y$[In=Yt.charAt(++Nn)])!=null?In=Yt.charAt(++Nn):Fi=In==="e"?" ":"0",($o=Qt[In])&&(In=$o(Sr,Fi)),Ut.push(In),Jr=Nn+1);return Ut.push(Yt.slice(Jr,Nn)),Ut.join("")}}function le(Yt,Qt){return function(Sr){var Ut=Gx(1900,void 0,1),Nn=ge(Ut,Yt,Sr+="",0),Jr,Kr;if(Nn!=Sr.length)return null;if("Q"in Ut)return new Date(Ut.Q);if("s"in Ut)return new Date(Ut.s*1e3+("L"in Ut?Ut.L:0));if(Qt&&!("Z"in Ut)&&(Ut.Z=0),"p"in Ut&&(Ut.H=Ut.H%12+Ut.p*12),Ut.m===void 0&&(Ut.m="q"in Ut?Ut.q:0),"V"in Ut){if(Ut.V<1||Ut.V>53)return null;"w"in Ut||(Ut.w=1),"Z"in Ut?(Jr=HI(Gx(Ut.y,0,1)),Kr=Jr.getUTCDay(),Jr=Kr>4||Kr===0?KE.ceil(Jr):KE(Jr),Jr=Qk.offset(Jr,(Ut.V-1)*7),Ut.y=Jr.getUTCFullYear(),Ut.m=Jr.getUTCMonth(),Ut.d=Jr.getUTCDate()+(Ut.w+6)%7):(Jr=qI(Gx(Ut.y,0,1)),Kr=Jr.getDay(),Jr=Kr>4||Kr===0?ZE.ceil(Jr):ZE(Jr),Jr=d1.offset(Jr,(Ut.V-1)*7),Ut.y=Jr.getFullYear(),Ut.m=Jr.getMonth(),Ut.d=Jr.getDate()+(Ut.w+6)%7)}else("W"in Ut||"U"in Ut)&&("w"in Ut||(Ut.w="u"in Ut?Ut.u%7:"W"in Ut?1:0),Kr="Z"in Ut?HI(Gx(Ut.y,0,1)).getUTCDay():qI(Gx(Ut.y,0,1)).getDay(),Ut.m=0,Ut.d="W"in Ut?(Ut.w+6)%7+Ut.W*7-(Kr+5)%7:Ut.w+Ut.U*7-(Kr+6)%7);return"Z"in Ut?(Ut.H+=Ut.Z/100|0,Ut.M+=Ut.Z%100,HI(Ut)):qI(Ut)}}function ge(Yt,Qt,Sr,Ut){for(var Nn=0,Jr=Qt.length,Kr=Sr.length,In,Fi;Nn<Jr;){if(Ut>=Kr)return-1;if(In=Qt.charCodeAt(Nn++),In===37){if(In=Qt.charAt(Nn++),Fi=ne[In in Y$?Qt.charAt(Nn++):In],!Fi||(Ut=Fi(Yt,Sr,Ut))<0)return-1}else if(In!=Sr.charCodeAt(Ut++))return-1}return Ut}function je(Yt,Qt,Sr){var Ut=w.exec(Qt.slice(Sr));return Ut?(Yt.p=T.get(Ut[0].toLowerCase()),Sr+Ut[0].length):-1}function ze(Yt,Qt,Sr){var Ut=D.exec(Qt.slice(Sr));return Ut?(Yt.w=B.get(Ut[0].toLowerCase()),Sr+Ut[0].length):-1}function Ce(Yt,Qt,Sr){var Ut=M.exec(Qt.slice(Sr));return Ut?(Yt.w=O.get(Ut[0].toLowerCase()),Sr+Ut[0].length):-1}function Ke(Yt,Qt,Sr){var Ut=V.exec(Qt.slice(Sr));return Ut?(Yt.m=U.get(Ut[0].toLowerCase()),Sr+Ut[0].length):-1}function Ye(Yt,Qt,Sr){var Ut=N.exec(Qt.slice(Sr));return Ut?(Yt.m=G.get(Ut[0].toLowerCase()),Sr+Ut[0].length):-1}function Oe(Yt,Qt,Sr){return ge(Yt,t,Qt,Sr)}function tt(Yt,Qt,Sr){return ge(Yt,r,Qt,Sr)}function He(Yt,Qt,Sr){return ge(Yt,n,Qt,Sr)}function lt(Yt){return p[Yt.getDay()]}function rt(Yt){return h[Yt.getDay()]}function ht(Yt){return v[Yt.getMonth()]}function vt(Yt){return o[Yt.getMonth()]}function mt(Yt){return c[+(Yt.getHours()>=12)]}function ct(Yt){return 1+~~(Yt.getMonth()/3)}function Vt(Yt){return p[Yt.getUTCDay()]}function xr(Yt){return h[Yt.getUTCDay()]}function tn(Yt){return v[Yt.getUTCMonth()]}function Er(Yt){return o[Yt.getUTCMonth()]}function Ft(Yt){return c[+(Yt.getUTCHours()>=12)]}function br(Yt){return 1+~~(Yt.getUTCMonth()/3)}return{format:function(Yt){var Qt=se(Yt+="",X);return Qt.toString=function(){return Yt},Qt},parse:function(Yt){var Qt=le(Yt+="",!1);return Qt.toString=function(){return Yt},Qt},utcFormat:function(Yt){var Qt=se(Yt+="",Y);return Qt.toString=function(){return Yt},Qt},utcParse:function(Yt){var Qt=le(Yt+="",!0);return Qt.toString=function(){return Yt},Qt}}}var Y$={"-":"",_:" ",0:"0"},ba=/^\s*\d+/,O3e=/^%/,j3e=/[\\^$*+?|[\]().{}]/g;function Si(e,t,r){var n=e<0?"-":"",c=(n?-e:e)+"",h=c.length;return n+(h<r?new Array(r-h+1).join(t)+c:c)}function R3e(e){return e.replace(j3e,"\\$&")}function qx(e){return new RegExp("^(?:"+e.map(R3e).join("|")+")","i")}function Hx(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function D3e(e,t,r){var n=ba.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function L3e(e,t,r){var n=ba.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function z3e(e,t,r){var n=ba.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function N3e(e,t,r){var n=ba.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function F3e(e,t,r){var n=ba.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function J$(e,t,r){var n=ba.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function Q$(e,t,r){var n=ba.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function B3e(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function U3e(e,t,r){var n=ba.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function V3e(e,t,r){var n=ba.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function eG(e,t,r){var n=ba.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function $3e(e,t,r){var n=ba.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function tG(e,t,r){var n=ba.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function G3e(e,t,r){var n=ba.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function q3e(e,t,r){var n=ba.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function H3e(e,t,r){var n=ba.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function W3e(e,t,r){var n=ba.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Z3e(e,t,r){var n=O3e.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function K3e(e,t,r){var n=ba.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function X3e(e,t,r){var n=ba.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function rG(e,t){return Si(e.getDate(),t,2)}function Y3e(e,t){return Si(e.getHours(),t,2)}function J3e(e,t){return Si(e.getHours()%12||12,t,2)}function Q3e(e,t){return Si(1+d1.count(jh(e),e),t,3)}function _ee(e,t){return Si(e.getMilliseconds(),t,3)}function eze(e,t){return _ee(e,t)+"000"}function tze(e,t){return Si(e.getMonth()+1,t,2)}function rze(e,t){return Si(e.getMinutes(),t,2)}function nze(e,t){return Si(e.getSeconds(),t,2)}function ize(e){var t=e.getDay();return t===0?7:t}function oze(e,t){return Si(eC.count(jh(e)-1,e),t,2)}function vee(e){var t=e.getDay();return t>=4||t===0?C_(e):C_.ceil(e)}function aze(e,t){return e=vee(e),Si(C_.count(jh(e),e)+(jh(e).getDay()===4),t,2)}function sze(e){return e.getDay()}function lze(e,t){return Si(ZE.count(jh(e)-1,e),t,2)}function cze(e,t){return Si(e.getFullYear()%100,t,2)}function uze(e,t){return e=vee(e),Si(e.getFullYear()%100,t,2)}function hze(e,t){return Si(e.getFullYear()%1e4,t,4)}function dze(e,t){var r=e.getDay();return e=r>=4||r===0?C_(e):C_.ceil(e),Si(e.getFullYear()%1e4,t,4)}function fze(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Si(t/60|0,"0",2)+Si(t%60,"0",2)}function nG(e,t){return Si(e.getUTCDate(),t,2)}function pze(e,t){return Si(e.getUTCHours(),t,2)}function mze(e,t){return Si(e.getUTCHours()%12||12,t,2)}function gze(e,t){return Si(1+Qk.count(Rh(e),e),t,3)}function xee(e,t){return Si(e.getUTCMilliseconds(),t,3)}function yze(e,t){return xee(e,t)+"000"}function _ze(e,t){return Si(e.getUTCMonth()+1,t,2)}function vze(e,t){return Si(e.getUTCMinutes(),t,2)}function xze(e,t){return Si(e.getUTCSeconds(),t,2)}function bze(e){var t=e.getUTCDay();return t===0?7:t}function wze(e,t){return Si(tC.count(Rh(e)-1,e),t,2)}function bee(e){var t=e.getUTCDay();return t>=4||t===0?P_(e):P_.ceil(e)}function Sze(e,t){return e=bee(e),Si(P_.count(Rh(e),e)+(Rh(e).getUTCDay()===4),t,2)}function Tze(e){return e.getUTCDay()}function Eze(e,t){return Si(KE.count(Rh(e)-1,e),t,2)}function Aze(e,t){return Si(e.getUTCFullYear()%100,t,2)}function kze(e,t){return e=bee(e),Si(e.getUTCFullYear()%100,t,2)}function Cze(e,t){return Si(e.getUTCFullYear()%1e4,t,4)}function Pze(e,t){var r=e.getUTCDay();return e=r>=4||r===0?P_(e):P_.ceil(e),Si(e.getUTCFullYear()%1e4,t,4)}function Mze(){return"+0000"}function iG(){return"%"}function oG(e){return+e}function aG(e){return Math.floor(+e/1e3)}var xy,wee,See;Ize({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ize(e){return xy=I3e(e),wee=xy.format,xy.parse,See=xy.utcFormat,xy.utcParse,xy}function Oze(e){return new Date(e)}function jze(e){return e instanceof Date?+e:+new Date(+e)}function Wz(e,t,r,n,c,h,p,o,v,w){var T=jz(),M=T.invert,O=T.domain,D=w(".%L"),B=w(":%S"),N=w("%I:%M"),G=w("%I %p"),V=w("%a %d"),U=w("%b %d"),X=w("%B"),Y=w("%Y");function ne(se){return(v(se)<se?D:o(se)<se?B:p(se)<se?N:h(se)<se?G:n(se)<se?c(se)<se?V:U:r(se)<se?X:Y)(se)}return T.invert=function(se){return new Date(M(se))},T.domain=function(se){return arguments.length?O(Array.from(se,jze)):O().map(Oze)},T.ticks=function(se){var le=O();return e(le[0],le[le.length-1],se??10)},T.tickFormat=function(se,le){return le==null?ne:w(le)},T.nice=function(se){var le=O();return(!se||typeof se.range!="function")&&(se=t(le[0],le[le.length-1],se??10)),se?O(lee(le,se)):T},T.copy=function(){return h1(T,Wz(e,t,r,n,c,h,p,o,v,w))},T}function Rze(){return Vl.apply(Wz(P3e,M3e,jh,qz,eC,d1,$z,Uz,nm,wee).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Dze(){return Vl.apply(Wz(k3e,C3e,Rh,Hz,tC,Qk,Gz,Vz,nm,See).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function rC(){var e=0,t=1,r,n,c,h,p=vs,o=!1,v;function w(M){return M==null||isNaN(M=+M)?v:p(c===0?.5:(M=(h(M)-r)*c,o?Math.max(0,Math.min(1,M)):M))}w.domain=function(M){return arguments.length?([e,t]=M,r=h(e=+e),n=h(t=+t),c=r===n?0:1/(n-r),w):[e,t]},w.clamp=function(M){return arguments.length?(o=!!M,w):o},w.interpolator=function(M){return arguments.length?(p=M,w):p};function T(M){return function(O){var D,B;return arguments.length?([D,B]=O,p=M(D,B),w):[p(0),p(1)]}}return w.range=T(yv),w.rangeRound=T(Oz),w.unknown=function(M){return arguments.length?(v=M,w):v},function(M){return h=M,r=M(e),n=M(t),c=r===n?0:1/(n-r),w}}function Cf(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Tee(){var e=kf(rC()(vs));return e.copy=function(){return Cf(e,Tee())},Uh.apply(e,arguments)}function Eee(){var e=Lz(rC()).domain([1,10]);return e.copy=function(){return Cf(e,Eee()).base(e.base())},Uh.apply(e,arguments)}function Aee(){var e=zz(rC());return e.copy=function(){return Cf(e,Aee()).constant(e.constant())},Uh.apply(e,arguments)}function Zz(){var e=Nz(rC());return e.copy=function(){return Cf(e,Zz()).exponent(e.exponent())},Uh.apply(e,arguments)}function Lze(){return Zz.apply(null,arguments).exponent(.5)}function kee(){var e=[],t=vs;function r(n){if(n!=null&&!isNaN(n=+n))return t((c1(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let c of n)c!=null&&!isNaN(c=+c)&&e.push(c);return e.sort(df),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,c)=>t(c/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(c,h)=>gLe(e,h/n))},r.copy=function(){return kee(t).domain(e)},Uh.apply(r,arguments)}function nC(){var e=0,t=.5,r=1,n=1,c,h,p,o,v,w=vs,T,M=!1,O;function D(N){return isNaN(N=+N)?O:(N=.5+((N=+T(N))-h)*(n*N<n*h?o:v),w(M?Math.max(0,Math.min(1,N)):N))}D.domain=function(N){return arguments.length?([e,t,r]=N,c=T(e=+e),h=T(t=+t),p=T(r=+r),o=c===h?0:.5/(h-c),v=h===p?0:.5/(p-h),n=h<c?-1:1,D):[e,t,r]},D.clamp=function(N){return arguments.length?(M=!!N,D):M},D.interpolator=function(N){return arguments.length?(w=N,D):w};function B(N){return function(G){var V,U,X;return arguments.length?([V,U,X]=G,w=VLe(N,[V,U,X]),D):[w(0),w(.5),w(1)]}}return D.range=B(yv),D.rangeRound=B(Oz),D.unknown=function(N){return arguments.length?(O=N,D):O},function(N){return T=N,c=N(e),h=N(t),p=N(r),o=c===h?0:.5/(h-c),v=h===p?0:.5/(p-h),n=h<c?-1:1,D}}function Cee(){var e=kf(nC()(vs));return e.copy=function(){return Cf(e,Cee())},Uh.apply(e,arguments)}function Pee(){var e=Lz(nC()).domain([.1,1,10]);return e.copy=function(){return Cf(e,Pee()).base(e.base())},Uh.apply(e,arguments)}function Mee(){var e=zz(nC());return e.copy=function(){return Cf(e,Mee()).constant(e.constant())},Uh.apply(e,arguments)}function Kz(){var e=Nz(nC());return e.copy=function(){return Cf(e,Kz()).exponent(e.exponent())},Uh.apply(e,arguments)}function zze(){return Kz.apply(null,arguments).exponent(.5)}const sG=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:fw,scaleDiverging:Cee,scaleDivergingLog:Pee,scaleDivergingPow:Kz,scaleDivergingSqrt:zze,scaleDivergingSymlog:Mee,scaleIdentity:see,scaleImplicit:RR,scaleLinear:HE,scaleLog:cee,scaleOrdinal:Pz,scalePoint:Cb,scalePow:Fz,scaleQuantile:dee,scaleQuantize:fee,scaleRadial:hee,scaleSequential:Tee,scaleSequentialLog:Eee,scaleSequentialPow:Zz,scaleSequentialQuantile:kee,scaleSequentialSqrt:Lze,scaleSequentialSymlog:Aee,scaleSqrt:h3e,scaleSymlog:uee,scaleThreshold:pee,scaleTime:Rze,scaleUtc:Dze,tickFormat:aee},Symbol.toStringTag,{value:"Module"}));var Nze=lv;function Fze(e,t,r){for(var n=-1,c=e.length;++n<c;){var h=e[n],p=t(h);if(p!=null&&(o===void 0?p===p&&!Nze(p):r(p,o)))var o=p,v=h}return v}var iC=Fze;function Bze(e,t){return e>t}var Iee=Bze,Uze=iC,Vze=Iee,$ze=mv;function Gze(e){return e&&e.length?Uze(e,$ze,Vze):void 0}var qze=Gze;const oC=ki(qze);function Hze(e,t){return e<t}var Oee=Hze,Wze=iC,Zze=Oee,Kze=mv;function Xze(e){return e&&e.length?Wze(e,Kze,Zze):void 0}var Yze=Xze;const aC=ki(Yze);var Jze=uz,Qze=Ou,eNe=NQ,tNe=Ks;function rNe(e,t){var r=tNe(e)?Jze:eNe;return r(e,Qze(t))}var nNe=rNe,iNe=LQ,oNe=nNe;function aNe(e,t){return iNe(oNe(e,t),1)}var sNe=aNe;const lNe=ki(sNe);var cNe=Ez;function uNe(e,t){return cNe(e,t)}var hNe=uNe;const sC=ki(hNe);var _v=1e9,dNe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Yz,fo=!0,Fl="[DecimalError] ",hm=Fl+"Invalid argument: ",Xz=Fl+"Exponent out of range: ",vv=Math.floor,qp=Math.pow,fNe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,cl,ga=1e7,so=7,jee=9007199254740991,XE=vv(jee/so),Lr={};Lr.absoluteValue=Lr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Lr.comparedTo=Lr.cmp=function(e){var t,r,n,c,h=this;if(e=new h.constructor(e),h.s!==e.s)return h.s||-e.s;if(h.e!==e.e)return h.e>e.e^h.s<0?1:-1;for(n=h.d.length,c=e.d.length,t=0,r=n<c?n:c;t<r;++t)if(h.d[t]!==e.d[t])return h.d[t]>e.d[t]^h.s<0?1:-1;return n===c?0:n>c^h.s<0?1:-1};Lr.decimalPlaces=Lr.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*so;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Lr.dividedBy=Lr.div=function(e){return bh(this,new this.constructor(e))};Lr.dividedToIntegerBy=Lr.idiv=function(e){var t=this,r=t.constructor;return qi(bh(t,new r(e),0,1),r.precision)};Lr.equals=Lr.eq=function(e){return!this.cmp(e)};Lr.exponent=function(){return Vo(this)};Lr.greaterThan=Lr.gt=function(e){return this.cmp(e)>0};Lr.greaterThanOrEqualTo=Lr.gte=function(e){return this.cmp(e)>=0};Lr.isInteger=Lr.isint=function(){return this.e>this.d.length-2};Lr.isNegative=Lr.isneg=function(){return this.s<0};Lr.isPositive=Lr.ispos=function(){return this.s>0};Lr.isZero=function(){return this.s===0};Lr.lessThan=Lr.lt=function(e){return this.cmp(e)<0};Lr.lessThanOrEqualTo=Lr.lte=function(e){return this.cmp(e)<1};Lr.logarithm=Lr.log=function(e){var t,r=this,n=r.constructor,c=n.precision,h=c+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(cl))throw Error(Fl+"NaN");if(r.s<1)throw Error(Fl+(r.s?"NaN":"-Infinity"));return r.eq(cl)?new n(0):(fo=!1,t=bh(_w(r,h),_w(e,h),h),fo=!0,qi(t,c))};Lr.minus=Lr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Lee(t,e):Ree(t,(e.s=-e.s,e))};Lr.modulo=Lr.mod=function(e){var t,r=this,n=r.constructor,c=n.precision;if(e=new n(e),!e.s)throw Error(Fl+"NaN");return r.s?(fo=!1,t=bh(r,e,0,1).times(e),fo=!0,r.minus(t)):qi(new n(r),c)};Lr.naturalExponential=Lr.exp=function(){return Dee(this)};Lr.naturalLogarithm=Lr.ln=function(){return _w(this)};Lr.negated=Lr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Lr.plus=Lr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Ree(t,e):Lee(t,(e.s=-e.s,e))};Lr.precision=Lr.sd=function(e){var t,r,n,c=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(hm+e);if(t=Vo(c)+1,n=c.d.length-1,r=n*so+1,n=c.d[n],n){for(;n%10==0;n/=10)r--;for(n=c.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Lr.squareRoot=Lr.sqrt=function(){var e,t,r,n,c,h,p,o=this,v=o.constructor;if(o.s<1){if(!o.s)return new v(0);throw Error(Fl+"NaN")}for(e=Vo(o),fo=!1,c=Math.sqrt(+o),c==0||c==1/0?(t=mu(o.d),(t.length+e)%2==0&&(t+="0"),c=Math.sqrt(t),e=vv((e+1)/2)-(e<0||e%2),c==1/0?t="5e"+e:(t=c.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new v(t)):n=new v(c.toString()),r=v.precision,c=p=r+3;;)if(h=n,n=h.plus(bh(o,h,p+2)).times(.5),mu(h.d).slice(0,p)===(t=mu(n.d)).slice(0,p)){if(t=t.slice(p-3,p+1),c==p&&t=="4999"){if(qi(h,r+1,0),h.times(h).eq(o)){n=h;break}}else if(t!="9999")break;p+=4}return fo=!0,qi(n,r)};Lr.times=Lr.mul=function(e){var t,r,n,c,h,p,o,v,w,T=this,M=T.constructor,O=T.d,D=(e=new M(e)).d;if(!T.s||!e.s)return new M(0);for(e.s*=T.s,r=T.e+e.e,v=O.length,w=D.length,v<w&&(h=O,O=D,D=h,p=v,v=w,w=p),h=[],p=v+w,n=p;n--;)h.push(0);for(n=w;--n>=0;){for(t=0,c=v+n;c>n;)o=h[c]+D[n]*O[c-n-1]+t,h[c--]=o%ga|0,t=o/ga|0;h[c]=(h[c]+t)%ga|0}for(;!h[--p];)h.pop();return t?++r:h.shift(),e.d=h,e.e=r,fo?qi(e,M.precision):e};Lr.toDecimalPlaces=Lr.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Cu(e,0,_v),t===void 0?t=n.rounding:Cu(t,0,8),qi(r,e+Vo(r)+1,t))};Lr.toExponential=function(e,t){var r,n=this,c=n.constructor;return e===void 0?r=Am(n,!0):(Cu(e,0,_v),t===void 0?t=c.rounding:Cu(t,0,8),n=qi(new c(n),e+1,t),r=Am(n,!0,e+1)),r};Lr.toFixed=function(e,t){var r,n,c=this,h=c.constructor;return e===void 0?Am(c):(Cu(e,0,_v),t===void 0?t=h.rounding:Cu(t,0,8),n=qi(new h(c),e+Vo(c)+1,t),r=Am(n.abs(),!1,e+Vo(n)+1),c.isneg()&&!c.isZero()?"-"+r:r)};Lr.toInteger=Lr.toint=function(){var e=this,t=e.constructor;return qi(new t(e),Vo(e)+1,t.rounding)};Lr.toNumber=function(){return+this};Lr.toPower=Lr.pow=function(e){var t,r,n,c,h,p,o=this,v=o.constructor,w=12,T=+(e=new v(e));if(!e.s)return new v(cl);if(o=new v(o),!o.s){if(e.s<1)throw Error(Fl+"Infinity");return o}if(o.eq(cl))return o;if(n=v.precision,e.eq(cl))return qi(o,n);if(t=e.e,r=e.d.length-1,p=t>=r,h=o.s,p){if((r=T<0?-T:T)<=jee){for(c=new v(cl),t=Math.ceil(n/so+4),fo=!1;r%2&&(c=c.times(o),cG(c.d,t)),r=vv(r/2),r!==0;)o=o.times(o),cG(o.d,t);return fo=!0,e.s<0?new v(cl).div(c):qi(c,n)}}else if(h<0)throw Error(Fl+"NaN");return h=h<0&&e.d[Math.max(t,r)]&1?-1:1,o.s=1,fo=!1,c=e.times(_w(o,n+w)),fo=!0,c=Dee(c),c.s=h,c};Lr.toPrecision=function(e,t){var r,n,c=this,h=c.constructor;return e===void 0?(r=Vo(c),n=Am(c,r<=h.toExpNeg||r>=h.toExpPos)):(Cu(e,1,_v),t===void 0?t=h.rounding:Cu(t,0,8),c=qi(new h(c),e,t),r=Vo(c),n=Am(c,e<=r||r<=h.toExpNeg,e)),n};Lr.toSignificantDigits=Lr.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Cu(e,1,_v),t===void 0?t=n.rounding:Cu(t,0,8)),qi(new n(r),e,t)};Lr.toString=Lr.valueOf=Lr.val=Lr.toJSON=Lr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Vo(e),r=e.constructor;return Am(e,t<=r.toExpNeg||t>=r.toExpPos)};function Ree(e,t){var r,n,c,h,p,o,v,w,T=e.constructor,M=T.precision;if(!e.s||!t.s)return t.s||(t=new T(e)),fo?qi(t,M):t;if(v=e.d,w=t.d,p=e.e,c=t.e,v=v.slice(),h=p-c,h){for(h<0?(n=v,h=-h,o=w.length):(n=w,c=p,o=v.length),p=Math.ceil(M/so),o=p>o?p+1:o+1,h>o&&(h=o,n.length=1),n.reverse();h--;)n.push(0);n.reverse()}for(o=v.length,h=w.length,o-h<0&&(h=o,n=w,w=v,v=n),r=0;h;)r=(v[--h]=v[h]+w[h]+r)/ga|0,v[h]%=ga;for(r&&(v.unshift(r),++c),o=v.length;v[--o]==0;)v.pop();return t.d=v,t.e=c,fo?qi(t,M):t}function Cu(e,t,r){if(e!==~~e||e<t||e>r)throw Error(hm+e)}function mu(e){var t,r,n,c=e.length-1,h="",p=e[0];if(c>0){for(h+=p,t=1;t<c;t++)n=e[t]+"",r=so-n.length,r&&(h+=Wd(r)),h+=n;p=e[t],n=p+"",r=so-n.length,r&&(h+=Wd(r))}else if(p===0)return"0";for(;p%10===0;)p/=10;return h+p}var bh=function(){function e(n,c){var h,p=0,o=n.length;for(n=n.slice();o--;)h=n[o]*c+p,n[o]=h%ga|0,p=h/ga|0;return p&&n.unshift(p),n}function t(n,c,h,p){var o,v;if(h!=p)v=h>p?1:-1;else for(o=v=0;o<h;o++)if(n[o]!=c[o]){v=n[o]>c[o]?1:-1;break}return v}function r(n,c,h){for(var p=0;h--;)n[h]-=p,p=n[h]<c[h]?1:0,n[h]=p*ga+n[h]-c[h];for(;!n[0]&&n.length>1;)n.shift()}return function(n,c,h,p){var o,v,w,T,M,O,D,B,N,G,V,U,X,Y,ne,se,le,ge,je=n.constructor,ze=n.s==c.s?1:-1,Ce=n.d,Ke=c.d;if(!n.s)return new je(n);if(!c.s)throw Error(Fl+"Division by zero");for(v=n.e-c.e,le=Ke.length,ne=Ce.length,D=new je(ze),B=D.d=[],w=0;Ke[w]==(Ce[w]||0);)++w;if(Ke[w]>(Ce[w]||0)&&--v,h==null?U=h=je.precision:p?U=h+(Vo(n)-Vo(c))+1:U=h,U<0)return new je(0);if(U=U/so+2|0,w=0,le==1)for(T=0,Ke=Ke[0],U++;(w<ne||T)&&U--;w++)X=T*ga+(Ce[w]||0),B[w]=X/Ke|0,T=X%Ke|0;else{for(T=ga/(Ke[0]+1)|0,T>1&&(Ke=e(Ke,T),Ce=e(Ce,T),le=Ke.length,ne=Ce.length),Y=le,N=Ce.slice(0,le),G=N.length;G<le;)N[G++]=0;ge=Ke.slice(),ge.unshift(0),se=Ke[0],Ke[1]>=ga/2&&++se;do T=0,o=t(Ke,N,le,G),o<0?(V=N[0],le!=G&&(V=V*ga+(N[1]||0)),T=V/se|0,T>1?(T>=ga&&(T=ga-1),M=e(Ke,T),O=M.length,G=N.length,o=t(M,N,O,G),o==1&&(T--,r(M,le<O?ge:Ke,O))):(T==0&&(o=T=1),M=Ke.slice()),O=M.length,O<G&&M.unshift(0),r(N,M,G),o==-1&&(G=N.length,o=t(Ke,N,le,G),o<1&&(T++,r(N,le<G?ge:Ke,G))),G=N.length):o===0&&(T++,N=[0]),B[w++]=T,o&&N[0]?N[G++]=Ce[Y]||0:(N=[Ce[Y]],G=1);while((Y++<ne||N[0]!==void 0)&&U--)}return B[0]||B.shift(),D.e=v,qi(D,p?h+Vo(D)+1:h)}}();function Dee(e,t){var r,n,c,h,p,o,v=0,w=0,T=e.constructor,M=T.precision;if(Vo(e)>16)throw Error(Xz+Vo(e));if(!e.s)return new T(cl);for(fo=!1,o=M,p=new T(.03125);e.abs().gte(.1);)e=e.times(p),w+=5;for(n=Math.log(qp(2,w))/Math.LN10*2+5|0,o+=n,r=c=h=new T(cl),T.precision=o;;){if(c=qi(c.times(e),o),r=r.times(++v),p=h.plus(bh(c,r,o)),mu(p.d).slice(0,o)===mu(h.d).slice(0,o)){for(;w--;)h=qi(h.times(h),o);return T.precision=M,t==null?(fo=!0,qi(h,M)):h}h=p}}function Vo(e){for(var t=e.e*so,r=e.d[0];r>=10;r/=10)t++;return t}function WI(e,t,r){if(t>e.LN10.sd())throw fo=!0,r&&(e.precision=r),Error(Fl+"LN10 precision limit exceeded");return qi(new e(e.LN10),t)}function Wd(e){for(var t="";e--;)t+="0";return t}function _w(e,t){var r,n,c,h,p,o,v,w,T,M=1,O=10,D=e,B=D.d,N=D.constructor,G=N.precision;if(D.s<1)throw Error(Fl+(D.s?"NaN":"-Infinity"));if(D.eq(cl))return new N(0);if(t==null?(fo=!1,w=G):w=t,D.eq(10))return t==null&&(fo=!0),WI(N,w);if(w+=O,N.precision=w,r=mu(B),n=r.charAt(0),h=Vo(D),Math.abs(h)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)D=D.times(e),r=mu(D.d),n=r.charAt(0),M++;h=Vo(D),n>1?(D=new N("0."+r),h++):D=new N(n+"."+r.slice(1))}else return v=WI(N,w+2,G).times(h+""),D=_w(new N(n+"."+r.slice(1)),w-O).plus(v),N.precision=G,t==null?(fo=!0,qi(D,G)):D;for(o=p=D=bh(D.minus(cl),D.plus(cl),w),T=qi(D.times(D),w),c=3;;){if(p=qi(p.times(T),w),v=o.plus(bh(p,new N(c),w)),mu(v.d).slice(0,w)===mu(o.d).slice(0,w))return o=o.times(2),h!==0&&(o=o.plus(WI(N,w+2,G).times(h+""))),o=bh(o,new N(M),w),N.precision=G,t==null?(fo=!0,qi(o,G)):o;o=v,c+=2}}function lG(e,t){var r,n,c;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(c=t.length;t.charCodeAt(c-1)===48;)--c;if(t=t.slice(n,c),t){if(c-=n,r=r-n-1,e.e=vv(r/so),e.d=[],n=(r+1)%so,r<0&&(n+=so),n<c){for(n&&e.d.push(+t.slice(0,n)),c-=so;n<c;)e.d.push(+t.slice(n,n+=so));t=t.slice(n),n=so-t.length}else n-=c;for(;n--;)t+="0";if(e.d.push(+t),fo&&(e.e>XE||e.e<-XE))throw Error(Xz+r)}else e.s=0,e.e=0,e.d=[0];return e}function qi(e,t,r){var n,c,h,p,o,v,w,T,M=e.d;for(p=1,h=M[0];h>=10;h/=10)p++;if(n=t-p,n<0)n+=so,c=t,w=M[T=0];else{if(T=Math.ceil((n+1)/so),h=M.length,T>=h)return e;for(w=h=M[T],p=1;h>=10;h/=10)p++;n%=so,c=n-so+p}if(r!==void 0&&(h=qp(10,p-c-1),o=w/h%10|0,v=t<0||M[T+1]!==void 0||w%h,v=r<4?(o||v)&&(r==0||r==(e.s<0?3:2)):o>5||o==5&&(r==4||v||r==6&&(n>0?c>0?w/qp(10,p-c):0:M[T-1])%10&1||r==(e.s<0?8:7))),t<1||!M[0])return v?(h=Vo(e),M.length=1,t=t-h-1,M[0]=qp(10,(so-t%so)%so),e.e=vv(-t/so)||0):(M.length=1,M[0]=e.e=e.s=0),e;if(n==0?(M.length=T,h=1,T--):(M.length=T+1,h=qp(10,so-n),M[T]=c>0?(w/qp(10,p-c)%qp(10,c)|0)*h:0),v)for(;;)if(T==0){(M[0]+=h)==ga&&(M[0]=1,++e.e);break}else{if(M[T]+=h,M[T]!=ga)break;M[T--]=0,h=1}for(n=M.length;M[--n]===0;)M.pop();if(fo&&(e.e>XE||e.e<-XE))throw Error(Xz+Vo(e));return e}function Lee(e,t){var r,n,c,h,p,o,v,w,T,M,O=e.constructor,D=O.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new O(e),fo?qi(t,D):t;if(v=e.d,M=t.d,n=t.e,w=e.e,v=v.slice(),p=w-n,p){for(T=p<0,T?(r=v,p=-p,o=M.length):(r=M,n=w,o=v.length),c=Math.max(Math.ceil(D/so),o)+2,p>c&&(p=c,r.length=1),r.reverse(),c=p;c--;)r.push(0);r.reverse()}else{for(c=v.length,o=M.length,T=c<o,T&&(o=c),c=0;c<o;c++)if(v[c]!=M[c]){T=v[c]<M[c];break}p=0}for(T&&(r=v,v=M,M=r,t.s=-t.s),o=v.length,c=M.length-o;c>0;--c)v[o++]=0;for(c=M.length;c>p;){if(v[--c]<M[c]){for(h=c;h&&v[--h]===0;)v[h]=ga-1;--v[h],v[c]+=ga}v[c]-=M[c]}for(;v[--o]===0;)v.pop();for(;v[0]===0;v.shift())--n;return v[0]?(t.d=v,t.e=n,fo?qi(t,D):t):new O(0)}function Am(e,t,r){var n,c=Vo(e),h=mu(e.d),p=h.length;return t?(r&&(n=r-p)>0?h=h.charAt(0)+"."+h.slice(1)+Wd(n):p>1&&(h=h.charAt(0)+"."+h.slice(1)),h=h+(c<0?"e":"e+")+c):c<0?(h="0."+Wd(-c-1)+h,r&&(n=r-p)>0&&(h+=Wd(n))):c>=p?(h+=Wd(c+1-p),r&&(n=r-c-1)>0&&(h=h+"."+Wd(n))):((n=c+1)<p&&(h=h.slice(0,n)+"."+h.slice(n)),r&&(n=r-p)>0&&(c+1===p&&(h+="."),h+=Wd(n))),e.s<0?"-"+h:h}function cG(e,t){if(e.length>t)return e.length=t,!0}function zee(e){var t,r,n;function c(h){var p=this;if(!(p instanceof c))return new c(h);if(p.constructor=c,h instanceof c){p.s=h.s,p.e=h.e,p.d=(h=h.d)?h.slice():h;return}if(typeof h=="number"){if(h*0!==0)throw Error(hm+h);if(h>0)p.s=1;else if(h<0)h=-h,p.s=-1;else{p.s=0,p.e=0,p.d=[0];return}if(h===~~h&&h<1e7){p.e=0,p.d=[h];return}return lG(p,h.toString())}else if(typeof h!="string")throw Error(hm+h);if(h.charCodeAt(0)===45?(h=h.slice(1),p.s=-1):p.s=1,fNe.test(h))lG(p,h);else throw Error(hm+h)}if(c.prototype=Lr,c.ROUND_UP=0,c.ROUND_DOWN=1,c.ROUND_CEIL=2,c.ROUND_FLOOR=3,c.ROUND_HALF_UP=4,c.ROUND_HALF_DOWN=5,c.ROUND_HALF_EVEN=6,c.ROUND_HALF_CEIL=7,c.ROUND_HALF_FLOOR=8,c.clone=zee,c.config=c.set=pNe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return c.config(e),c}function pNe(e){if(!e||typeof e!="object")throw Error(Fl+"Object expected");var t,r,n,c=["precision",1,_v,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<c.length;t+=3)if((n=e[r=c[t]])!==void 0)if(vv(n)===n&&n>=c[t+1]&&n<=c[t+2])this[r]=n;else throw Error(hm+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(hm+r+": "+n);return this}var Yz=zee(dNe);cl=new Yz(1);const Ui=Yz;function mNe(e){return vNe(e)||_Ne(e)||yNe(e)||gNe()}function gNe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yNe(e,t){if(e){if(typeof e=="string")return NR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return NR(e,t)}}function _Ne(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function vNe(e){if(Array.isArray(e))return NR(e)}function NR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var xNe=function(e){return e},Nee={},Fee=function(e){return e===Nee},uG=function(e){return function t(){return arguments.length===0||arguments.length===1&&Fee(arguments.length<=0?void 0:arguments[0])?t:e.apply(void 0,arguments)}},bNe=function e(t,r){return t===1?r:uG(function(){for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];var p=c.filter(function(o){return o!==Nee}).length;return p>=t?r.apply(void 0,c):e(t-p,uG(function(){for(var o=arguments.length,v=new Array(o),w=0;w<o;w++)v[w]=arguments[w];var T=c.map(function(M){return Fee(M)?v.shift():M});return r.apply(void 0,mNe(T).concat(v))}))})},lC=function(e){return bNe(e.length,e)},FR=function(e,t){for(var r=[],n=e;n<t;++n)r[n-e]=n;return r},wNe=lC(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),SNe=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!t.length)return xNe;var n=t.reverse(),c=n[0],h=n.slice(1);return function(){return h.reduce(function(p,o){return o(p)},c.apply(void 0,arguments))}},BR=function(e){return Array.isArray(e)?e.reverse():e.split("").reverse.join("")},Bee=function(e){var t=null,r=null;return function(){for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];return t&&c.every(function(p,o){return p===t[o]})||(t=c,r=e.apply(void 0,c)),r}};function TNe(e){var t;return e===0?t=1:t=Math.floor(new Ui(e).abs().log(10).toNumber())+1,t}function ENe(e,t,r){for(var n=new Ui(e),c=0,h=[];n.lt(t)&&c<1e5;)h.push(n.toNumber()),n=n.add(r),c++;return h}var ANe=lC(function(e,t,r){var n=+e,c=+t;return n+r*(c-n)}),kNe=lC(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),CNe=lC(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const cC={rangeStep:ENe,getDigitCount:TNe,interpolateNumber:ANe,uninterpolateNumber:kNe,uninterpolateTruncation:CNe};function UR(e){return INe(e)||MNe(e)||Uee(e)||PNe()}function PNe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MNe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function INe(e){if(Array.isArray(e))return VR(e)}function vw(e,t){return RNe(e)||jNe(e,t)||Uee(e,t)||ONe()}function ONe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Uee(e,t){if(e){if(typeof e=="string")return VR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return VR(e,t)}}function VR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function jNe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,c=!1,h=void 0;try{for(var p=e[Symbol.iterator](),o;!(n=(o=p.next()).done)&&(r.push(o.value),!(t&&r.length===t));n=!0);}catch(v){c=!0,h=v}finally{try{!n&&p.return!=null&&p.return()}finally{if(c)throw h}}return r}}function RNe(e){if(Array.isArray(e))return e}function Vee(e){var t=vw(e,2),r=t[0],n=t[1],c=r,h=n;return r>n&&(c=n,h=r),[c,h]}function $ee(e,t,r){if(e.lte(0))return new Ui(0);var n=cC.getDigitCount(e.toNumber()),c=new Ui(10).pow(n),h=e.div(c),p=n!==1?.05:.1,o=new Ui(Math.ceil(h.div(p).toNumber())).add(r).mul(p),v=o.mul(c);return t?v:new Ui(Math.ceil(v))}function DNe(e,t,r){var n=1,c=new Ui(e);if(!c.isint()&&r){var h=Math.abs(e);h<1?(n=new Ui(10).pow(cC.getDigitCount(e)-1),c=new Ui(Math.floor(c.div(n).toNumber())).mul(n)):h>1&&(c=new Ui(Math.floor(e)))}else e===0?c=new Ui(Math.floor((t-1)/2)):r||(c=new Ui(Math.floor(e)));var p=Math.floor((t-1)/2),o=SNe(wNe(function(v){return c.add(new Ui(v-p).mul(n)).toNumber()}),FR);return o(0,t)}function Gee(e,t,r,n){var c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Ui(0),tickMin:new Ui(0),tickMax:new Ui(0)};var h=$ee(new Ui(t).sub(e).div(r-1),n,c),p;e<=0&&t>=0?p=new Ui(0):(p=new Ui(e).add(t).div(2),p=p.sub(new Ui(p).mod(h)));var o=Math.ceil(p.sub(e).div(h).toNumber()),v=Math.ceil(new Ui(t).sub(p).div(h).toNumber()),w=o+v+1;return w>r?Gee(e,t,r,n,c+1):(w<r&&(v=t>0?v+(r-w):v,o=t>0?o:o+(r-w)),{step:h,tickMin:p.sub(new Ui(o).mul(h)),tickMax:p.add(new Ui(v).mul(h))})}function LNe(e){var t=vw(e,2),r=t[0],n=t[1],c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,p=Math.max(c,2),o=Vee([r,n]),v=vw(o,2),w=v[0],T=v[1];if(w===-1/0||T===1/0){var M=T===1/0?[w].concat(UR(FR(0,c-1).map(function(){return 1/0}))):[].concat(UR(FR(0,c-1).map(function(){return-1/0})),[T]);return r>n?BR(M):M}if(w===T)return DNe(w,c,h);var O=Gee(w,T,p,h),D=O.step,B=O.tickMin,N=O.tickMax,G=cC.rangeStep(B,N.add(new Ui(.1).mul(D)),D);return r>n?BR(G):G}function zNe(e,t){var r=vw(e,2),n=r[0],c=r[1],h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,p=Vee([n,c]),o=vw(p,2),v=o[0],w=o[1];if(v===-1/0||w===1/0)return[n,c];if(v===w)return[v];var T=Math.max(t,2),M=$ee(new Ui(w).sub(v).div(T-1),h,0),O=[].concat(UR(cC.rangeStep(new Ui(v),new Ui(w).sub(new Ui(.99).mul(M)),M)),[w]);return n>c?BR(O):O}var NNe=Bee(LNe),FNe=Bee(zNe),BNe="Invariant failed";function km(e,t){throw new Error(BNe)}var UNe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function M_(e){"@babel/helpers - typeof";return M_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M_(e)}function YE(){return YE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},YE.apply(this,arguments)}function VNe(e,t){return HNe(e)||qNe(e,t)||GNe(e,t)||$Ne()}function $Ne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GNe(e,t){if(e){if(typeof e=="string")return hG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hG(e,t)}}function hG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qNe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function HNe(e){if(Array.isArray(e))return e}function WNe(e,t){if(e==null)return{};var r=ZNe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ZNe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function KNe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XNe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Wee(n.key),n)}}function YNe(e,t,r){return t&&XNe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function JNe(e,t,r){return t=JE(t),QNe(e,qee()?Reflect.construct(t,r||[],JE(e).constructor):t.apply(e,r))}function QNe(e,t){if(t&&(M_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eFe(e)}function eFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qee=function(){return!!e})()}function JE(e){return JE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},JE(e)}function tFe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$R(e,t)}function $R(e,t){return $R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},$R(e,t)}function Hee(e,t,r){return t=Wee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wee(e){var t=rFe(e,"string");return M_(t)=="symbol"?t:t+""}function rFe(e,t){if(M_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(M_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var uC=function(e){function t(){return KNe(this,t),JNe(this,t,arguments)}return tFe(t,e),YNe(t,[{key:"render",value:function(){var r=this.props,n=r.offset,c=r.layout,h=r.width,p=r.dataKey,o=r.data,v=r.dataPointFormatter,w=r.xAxis,T=r.yAxis,M=WNe(r,UNe),O=Sn(M,!1);this.props.direction==="x"&&w.type!=="number"&&km();var D=o.map(function(B){var N=v(B,p),G=N.x,V=N.y,U=N.value,X=N.errorVal;if(!X)return null;var Y=[],ne,se;if(Array.isArray(X)){var le=VNe(X,2);ne=le[0],se=le[1]}else ne=se=X;if(c==="vertical"){var ge=w.scale,je=V+n,ze=je+h,Ce=je-h,Ke=ge(U-ne),Ye=ge(U+se);Y.push({x1:Ye,y1:ze,x2:Ye,y2:Ce}),Y.push({x1:Ke,y1:je,x2:Ye,y2:je}),Y.push({x1:Ke,y1:ze,x2:Ke,y2:Ce})}else if(c==="horizontal"){var Oe=T.scale,tt=G+n,He=tt-h,lt=tt+h,rt=Oe(U-ne),ht=Oe(U+se);Y.push({x1:He,y1:ht,x2:lt,y2:ht}),Y.push({x1:tt,y1:rt,x2:tt,y2:ht}),Y.push({x1:He,y1:rt,x2:lt,y2:rt})}return Ne.createElement(Li,YE({className:"recharts-errorBar",key:"bar-".concat(Y.map(function(vt){return"".concat(vt.x1,"-").concat(vt.x2,"-").concat(vt.y1,"-").concat(vt.y2)}))},O),Y.map(function(vt){return Ne.createElement("line",YE({},vt,{key:"line-".concat(vt.x1,"-").concat(vt.x2,"-").concat(vt.y1,"-").concat(vt.y2)}))}))});return Ne.createElement(Li,{className:"recharts-errorBars"},D)}}])}(Ne.Component);Hee(uC,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});Hee(uC,"displayName","ErrorBar");function xw(e){"@babel/helpers - typeof";return xw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xw(e)}function dG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Lp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dG(Object(r),!0).forEach(function(n){nFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nFe(e,t,r){return t=iFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function iFe(e){var t=oFe(e,"string");return xw(t)=="symbol"?t:t+""}function oFe(e,t){if(xw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Zee=function(e){var t=e.children,r=e.formattedGraphicalItems,n=e.legendWidth,c=e.legendContent,h=al(t,a_);if(!h)return null;var p=a_.defaultProps,o=p!==void 0?Lp(Lp({},p),h.props):{},v;return h.props&&h.props.payload?v=h.props&&h.props.payload:c==="children"?v=(r||[]).reduce(function(w,T){var M=T.item,O=T.props,D=O.sectors||O.data||[];return w.concat(D.map(function(B){return{type:h.props.iconType||M.props.legendType,value:B.name,color:B.fill,payload:B}}))},[]):v=(r||[]).map(function(w){var T=w.item,M=T.type.defaultProps,O=M!==void 0?Lp(Lp({},M),T.props):{},D=O.dataKey,B=O.name,N=O.legendType,G=O.hide;return{inactive:G,dataKey:D,type:o.iconType||N||"square",color:Jz(T),value:B||D,payload:O}}),Lp(Lp(Lp({},o),a_.getWithHeight(h,n)),{},{payload:v,item:h})};function bw(e){"@babel/helpers - typeof";return bw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bw(e)}function fG(e){return cFe(e)||lFe(e)||sFe(e)||aFe()}function aFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sFe(e,t){if(e){if(typeof e=="string")return GR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return GR(e,t)}}function lFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function cFe(e){if(Array.isArray(e))return GR(e)}function GR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function ko(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pG(Object(r),!0).forEach(function(n){l_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l_(e,t,r){return t=uFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uFe(e){var t=hFe(e,"string");return bw(t)=="symbol"?t:t+""}function hFe(e,t){if(bw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ja(e,t,r){return ni(e)||ni(t)?r:oa(t)?fl(e,t,r):Pn(t)?t(e):r}function O2(e,t,r,n){var c=lNe(e,function(o){return Ja(o,t)});if(r==="number"){var h=c.filter(function(o){return fr(o)||parseFloat(o)});return h.length?[aC(h),oC(h)]:[1/0,-1/0]}var p=n?c.filter(function(o){return!ni(o)}):c;return p.map(function(o){return oa(o)||o instanceof Date?o:""})}var dFe=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0,h=-1,p=(t=r?.length)!==null&&t!==void 0?t:0;if(p<=1)return 0;if(c&&c.axisType==="angleAxis"&&Math.abs(Math.abs(c.range[1]-c.range[0])-360)<=1e-6)for(var o=c.range,v=0;v<p;v++){var w=v>0?n[v-1].coordinate:n[p-1].coordinate,T=n[v].coordinate,M=v>=p-1?n[0].coordinate:n[v+1].coordinate,O=void 0;if(ys(T-w)!==ys(M-T)){var D=[];if(ys(M-T)===ys(o[1]-o[0])){O=M;var B=T+o[1]-o[0];D[0]=Math.min(B,(B+w)/2),D[1]=Math.max(B,(B+w)/2)}else{O=w;var N=M+o[1]-o[0];D[0]=Math.min(T,(N+T)/2),D[1]=Math.max(T,(N+T)/2)}var G=[Math.min(T,(O+T)/2),Math.max(T,(O+T)/2)];if(e>G[0]&&e<=G[1]||e>=D[0]&&e<=D[1]){h=n[v].index;break}}else{var V=Math.min(w,M),U=Math.max(w,M);if(e>(V+T)/2&&e<=(U+T)/2){h=n[v].index;break}}}else for(var X=0;X<p;X++)if(X===0&&e<=(r[X].coordinate+r[X+1].coordinate)/2||X>0&&X<p-1&&e>(r[X].coordinate+r[X-1].coordinate)/2&&e<=(r[X].coordinate+r[X+1].coordinate)/2||X===p-1&&e>(r[X].coordinate+r[X-1].coordinate)/2){h=r[X].index;break}return h},Jz=function(e){var t,r=e,n=r.type.displayName,c=(t=e.type)!==null&&t!==void 0&&t.defaultProps?ko(ko({},e.type.defaultProps),e.props):e.props,h=c.stroke,p=c.fill,o;switch(n){case"Line":o=h;break;case"Area":case"Radar":o=h&&h!=="none"?h:p;break;default:o=p;break}return o},fFe=function(e){var t=e.barSize,r=e.totalSize,n=e.stackGroups,c=n===void 0?{}:n;if(!c)return{};for(var h={},p=Object.keys(c),o=0,v=p.length;o<v;o++)for(var w=c[p[o]].stackGroups,T=Object.keys(w),M=0,O=T.length;M<O;M++){var D=w[T[M]],B=D.items,N=D.cateAxisId,G=B.filter(function(se){return xh(se.type).indexOf("Bar")>=0});if(G&&G.length){var V=G[0].type.defaultProps,U=V!==void 0?ko(ko({},V),G[0].props):G[0].props,X=U.barSize,Y=U[N];h[Y]||(h[Y]=[]);var ne=ni(X)?t:X;h[Y].push({item:G[0],stackList:G.slice(1),barSize:ni(ne)?void 0:_s(ne,r,0)})}}return h},pFe=function(e){var t=e.barGap,r=e.barCategoryGap,n=e.bandSize,c=e.sizeList,h=c===void 0?[]:c,p=e.maxBarSize,o=h.length;if(o<1)return null;var v=_s(t,n,0,!0),w,T=[];if(h[0].barSize===+h[0].barSize){var M=!1,O=n/o,D=h.reduce(function(X,Y){return X+Y.barSize||0},0);D+=(o-1)*v,D>=n&&(D-=(o-1)*v,v=0),D>=n&&O>0&&(M=!0,O*=.9,D=o*O);var B=(n-D)/2>>0,N={offset:B-v,size:0};w=h.reduce(function(X,Y){var ne={item:Y.item,position:{offset:N.offset+N.size+v,size:M?O:Y.barSize}},se=[].concat(fG(X),[ne]);return N=se[se.length-1].position,Y.stackList&&Y.stackList.length&&Y.stackList.forEach(function(le){se.push({item:le,position:N})}),se},T)}else{var G=_s(r,n,0,!0);n-2*G-(o-1)*v<=0&&(v=0);var V=(n-2*G-(o-1)*v)/o;V>1&&(V>>=0);var U=p===+p?Math.min(V,p):V;w=h.reduce(function(X,Y,ne){var se=[].concat(fG(X),[{item:Y.item,position:{offset:G+(V+v)*ne+(V-U)/2,size:U}}]);return Y.stackList&&Y.stackList.length&&Y.stackList.forEach(function(le){se.push({item:le,position:se[se.length-1].position})}),se},T)}return w},mFe=function(e,t,r,n){var c=r.children,h=r.width,p=r.margin,o=h-(p.left||0)-(p.right||0),v=Zee({children:c,legendWidth:o});if(v){var w=n||{},T=w.width,M=w.height,O=v.align,D=v.verticalAlign,B=v.layout;if((B==="vertical"||B==="horizontal"&&D==="middle")&&O!=="center"&&fr(e[O]))return ko(ko({},e),{},l_({},O,e[O]+(T||0)));if((B==="horizontal"||B==="vertical"&&O==="center")&&D!=="middle"&&fr(e[D]))return ko(ko({},e),{},l_({},D,e[D]+(M||0)))}return e},gFe=function(e,t,r){return ni(t)?!0:e==="horizontal"?t==="yAxis":e==="vertical"||r==="x"?t==="xAxis":r==="y"?t==="yAxis":!0},Kee=function(e,t,r,n,c){var h=t.props.children,p=Ll(h,uC).filter(function(v){return gFe(n,c,v.props.direction)});if(p&&p.length){var o=p.map(function(v){return v.props.dataKey});return e.reduce(function(v,w){var T=Ja(w,r);if(ni(T))return v;var M=Array.isArray(T)?[aC(T),oC(T)]:[T,T],O=o.reduce(function(D,B){var N=Ja(w,B,0),G=M[0]-Math.abs(Array.isArray(N)?N[0]:N),V=M[1]+Math.abs(Array.isArray(N)?N[1]:N);return[Math.min(G,D[0]),Math.max(V,D[1])]},[1/0,-1/0]);return[Math.min(O[0],v[0]),Math.max(O[1],v[1])]},[1/0,-1/0])}return null},yFe=function(e,t,r,n,c){var h=t.map(function(p){return Kee(e,p,r,c,n)}).filter(function(p){return!ni(p)});return h&&h.length?h.reduce(function(p,o){return[Math.min(p[0],o[0]),Math.max(p[1],o[1])]},[1/0,-1/0]):null},Xee=function(e,t,r,n,c){var h=t.map(function(o){var v=o.props.dataKey;return r==="number"&&v&&Kee(e,o,v,n)||O2(e,v,r,c)});if(r==="number")return h.reduce(function(o,v){return[Math.min(o[0],v[0]),Math.max(o[1],v[1])]},[1/0,-1/0]);var p={};return h.reduce(function(o,v){for(var w=0,T=v.length;w<T;w++)p[v[w]]||(p[v[w]]=!0,o.push(v[w]));return o},[])},Yee=function(e,t){return e==="horizontal"&&t==="xAxis"||e==="vertical"&&t==="yAxis"||e==="centric"&&t==="angleAxis"||e==="radial"&&t==="radiusAxis"},Jee=function(e,t,r,n){if(n)return e.map(function(o){return o.coordinate});var c,h,p=e.map(function(o){return o.coordinate===t&&(c=!0),o.coordinate===r&&(h=!0),o.coordinate});return c||p.push(t),h||p.push(r),p},_h=function(e,t,r){if(!e)return null;var n=e.scale,c=e.duplicateDomain,h=e.type,p=e.range,o=e.realScaleType==="scaleBand"?n.bandwidth()/2:2,v=(t||r)&&h==="category"&&n.bandwidth?n.bandwidth()/o:0;if(v=e.axisType==="angleAxis"&&p?.length>=2?ys(p[0]-p[1])*2*v:v,t&&(e.ticks||e.niceTicks)){var w=(e.ticks||e.niceTicks).map(function(T){var M=c?c.indexOf(T):T;return{coordinate:n(M)+v,value:T,offset:v}});return w.filter(function(T){return!o1(T.coordinate)})}return e.isCategorical&&e.categoricalDomain?e.categoricalDomain.map(function(T,M){return{coordinate:n(T)+v,value:T,index:M,offset:v}}):n.ticks&&!r?n.ticks(e.tickCount).map(function(T){return{coordinate:n(T)+v,value:T,offset:v}}):n.domain().map(function(T,M){return{coordinate:n(T)+v,value:c?c[T]:T,index:M,offset:v}})},ZI=new WeakMap,n2=function(e,t){if(typeof t!="function")return e;ZI.has(e)||ZI.set(e,new WeakMap);var r=ZI.get(e);if(r.has(t))return r.get(t);var n=function(){e.apply(void 0,arguments),t.apply(void 0,arguments)};return r.set(t,n),n},Qee=function(e,t,r){var n=e.scale,c=e.type,h=e.layout,p=e.axisType;if(n==="auto")return h==="radial"&&p==="radiusAxis"?{scale:fw(),realScaleType:"band"}:h==="radial"&&p==="angleAxis"?{scale:HE(),realScaleType:"linear"}:c==="category"&&t&&(t.indexOf("LineChart")>=0||t.indexOf("AreaChart")>=0||t.indexOf("ComposedChart")>=0&&!r)?{scale:Cb(),realScaleType:"point"}:c==="category"?{scale:fw(),realScaleType:"band"}:{scale:HE(),realScaleType:"linear"};if(Sm(n)){var o="scale".concat(qk(n));return{scale:(sG[o]||Cb)(),realScaleType:sG[o]?o:"point"}}return Pn(n)?{scale:n}:{scale:Cb(),realScaleType:"point"}},mG=1e-4,ete=function(e){var t=e.domain();if(!(!t||t.length<=2)){var r=t.length,n=e.range(),c=Math.min(n[0],n[1])-mG,h=Math.max(n[0],n[1])+mG,p=e(t[0]),o=e(t[r-1]);(p<c||p>h||o<c||o>h)&&e.domain([t[0],t[r-1]])}},_Fe=function(e,t){if(!e)return null;for(var r=0,n=e.length;r<n;r++)if(e[r].item===t)return e[r].position;return null},vFe=function(e,t){if(!t||t.length!==2||!fr(t[0])||!fr(t[1]))return e;var r=Math.min(t[0],t[1]),n=Math.max(t[0],t[1]),c=[e[0],e[1]];return(!fr(e[0])||e[0]<r)&&(c[0]=r),(!fr(e[1])||e[1]>n)&&(c[1]=n),c[0]>n&&(c[0]=n),c[1]<r&&(c[1]=r),c},xFe=function(e){var t=e.length;if(!(t<=0))for(var r=0,n=e[0].length;r<n;++r)for(var c=0,h=0,p=0;p<t;++p){var o=o1(e[p][r][1])?e[p][r][0]:e[p][r][1];o>=0?(e[p][r][0]=c,e[p][r][1]=c+o,c=e[p][r][1]):(e[p][r][0]=h,e[p][r][1]=h+o,h=e[p][r][1])}},bFe=function(e){var t=e.length;if(!(t<=0))for(var r=0,n=e[0].length;r<n;++r)for(var c=0,h=0;h<t;++h){var p=o1(e[h][r][1])?e[h][r][0]:e[h][r][1];p>=0?(e[h][r][0]=c,e[h][r][1]=c+p,c=e[h][r][1]):(e[h][r][0]=0,e[h][r][1]=0)}},wFe={sign:xFe,expand:RAe,none:w_,silhouette:DAe,wiggle:LAe,positive:bFe},SFe=function(e,t,r){var n=t.map(function(p){return p.props.dataKey}),c=wFe[r],h=jAe().keys(n).value(function(p,o){return+Ja(p,o,0)}).order(gR).offset(c);return h(e)},TFe=function(e,t,r,n,c,h){if(!e)return null;var p=h?t.reverse():t,o={},v=p.reduce(function(T,M){var O,D=(O=M.type)!==null&&O!==void 0&&O.defaultProps?ko(ko({},M.type.defaultProps),M.props):M.props,B=D.stackId,N=D.hide;if(N)return T;var G=D[r],V=T[G]||{hasStack:!1,stackGroups:{}};if(oa(B)){var U=V.stackGroups[B]||{numericAxisId:r,cateAxisId:n,items:[]};U.items.push(M),V.hasStack=!0,V.stackGroups[B]=U}else V.stackGroups[a1("_stackId_")]={numericAxisId:r,cateAxisId:n,items:[M]};return ko(ko({},T),{},l_({},G,V))},o),w={};return Object.keys(v).reduce(function(T,M){var O=v[M];if(O.hasStack){var D={};O.stackGroups=Object.keys(O.stackGroups).reduce(function(B,N){var G=O.stackGroups[N];return ko(ko({},B),{},l_({},N,{numericAxisId:r,cateAxisId:n,items:G.items,stackedData:SFe(e,G.items,c)}))},D)}return ko(ko({},T),{},l_({},M,O))},w)},tte=function(e,t){var r=t.realScaleType,n=t.type,c=t.tickCount,h=t.originalDomain,p=t.allowDecimals,o=r||t.scale;if(o!=="auto"&&o!=="linear")return null;if(c&&n==="number"&&h&&(h[0]==="auto"||h[1]==="auto")){var v=e.domain();if(!v.length)return null;var w=NNe(v,c,p);return e.domain([aC(w),oC(w)]),{niceTicks:w}}if(c&&n==="number"){var T=e.domain(),M=FNe(T,c,p);return{niceTicks:M}}return null},gG=function(e){var t=e.axis,r=e.ticks,n=e.offset,c=e.bandSize,h=e.entry,p=e.index;if(t.type==="category")return r[p]?r[p].coordinate+n:null;var o=Ja(h,t.dataKey,t.domain[p]);return ni(o)?null:t.scale(o)-c/2+n},EFe=function(e){var t=e.numericAxis,r=t.scale.domain();if(t.type==="number"){var n=Math.min(r[0],r[1]),c=Math.max(r[0],r[1]);return n<=0&&c>=0?0:c<0?c:n}return r[0]},AFe=function(e,t){var r,n=(r=e.type)!==null&&r!==void 0&&r.defaultProps?ko(ko({},e.type.defaultProps),e.props):e.props,c=n.stackId;if(oa(c)){var h=t[c];if(h){var p=h.items.indexOf(e);return p>=0?h.stackedData[p]:null}}return null},kFe=function(e){return e.reduce(function(t,r){return[aC(r.concat([t[0]]).filter(fr)),oC(r.concat([t[1]]).filter(fr))]},[1/0,-1/0])},rte=function(e,t,r){return Object.keys(e).reduce(function(n,c){var h=e[c],p=h.stackedData,o=p.reduce(function(v,w){var T=kFe(w.slice(t,r+1));return[Math.min(v[0],T[0]),Math.max(v[1],T[1])]},[1/0,-1/0]);return[Math.min(o[0],n[0]),Math.max(o[1],n[1])]},[1/0,-1/0]).map(function(n){return n===1/0||n===-1/0?0:n})},yG=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,_G=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,qR=function(e,t,r){if(Pn(e))return e(t,r);if(!Array.isArray(e))return t;var n=[];if(fr(e[0]))n[0]=r?e[0]:Math.min(e[0],t[0]);else if(yG.test(e[0])){var c=+yG.exec(e[0])[1];n[0]=t[0]-c}else Pn(e[0])?n[0]=e[0](t[0]):n[0]=t[0];if(fr(e[1]))n[1]=r?e[1]:Math.max(e[1],t[1]);else if(_G.test(e[1])){var h=+_G.exec(e[1])[1];n[1]=t[1]+h}else Pn(e[1])?n[1]=e[1](t[1]):n[1]=t[1];return n},QE=function(e,t,r){if(e&&e.scale&&e.scale.bandwidth){var n=e.scale.bandwidth();if(!r||n>0)return n}if(e&&t&&t.length>=2){for(var c=kz(t,function(T){return T.coordinate}),h=1/0,p=1,o=c.length;p<o;p++){var v=c[p],w=c[p-1];h=Math.min((v.coordinate||0)-(w.coordinate||0),h)}return h===1/0?0:h}return r?void 0:0},vG=function(e,t,r){return!e||!e.length||sC(e,fl(r,"type.defaultProps.domain"))?t:e},nte=function(e,t){var r=e.type.defaultProps?ko(ko({},e.type.defaultProps),e.props):e.props,n=r.dataKey,c=r.name,h=r.unit,p=r.formatter,o=r.tooltipType,v=r.chartType,w=r.hide;return ko(ko({},Sn(e,!1)),{},{dataKey:n,unit:h,formatter:p,name:c||n,color:Jz(e),value:Ja(t,n),type:o,payload:t,chartType:v,hide:w})};function ww(e){"@babel/helpers - typeof";return ww=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ww(e)}function xG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function hh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xG(Object(r),!0).forEach(function(n){ite(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ite(e,t,r){return t=CFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function CFe(e){var t=PFe(e,"string");return ww(t)=="symbol"?t:t+""}function PFe(e,t){if(ww(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ww(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function MFe(e,t){return RFe(e)||jFe(e,t)||OFe(e,t)||IFe()}function IFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OFe(e,t){if(e){if(typeof e=="string")return bG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bG(e,t)}}function bG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function jFe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function RFe(e){if(Array.isArray(e))return e}var eA=Math.PI/180,DFe=function(e){return e*180/Math.PI},eo=function(e,t,r,n){return{x:e+Math.cos(-eA*n)*r,y:t+Math.sin(-eA*n)*r}},ote=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(e-(r.left||0)-(r.right||0)),Math.abs(t-(r.top||0)-(r.bottom||0)))/2},LFe=function(e,t,r,n,c){var h=e.width,p=e.height,o=e.startAngle,v=e.endAngle,w=_s(e.cx,h,h/2),T=_s(e.cy,p,p/2),M=ote(h,p,r),O=_s(e.innerRadius,M,0),D=_s(e.outerRadius,M,M*.8),B=Object.keys(t);return B.reduce(function(N,G){var V=t[G],U=V.domain,X=V.reversed,Y;if(ni(V.range))n==="angleAxis"?Y=[o,v]:n==="radiusAxis"&&(Y=[O,D]),X&&(Y=[Y[1],Y[0]]);else{Y=V.range;var ne=Y,se=MFe(ne,2);o=se[0],v=se[1]}var le=Qee(V,c),ge=le.realScaleType,je=le.scale;je.domain(U).range(Y),ete(je);var ze=tte(je,hh(hh({},V),{},{realScaleType:ge})),Ce=hh(hh(hh({},V),ze),{},{range:Y,radius:D,realScaleType:ge,scale:je,cx:w,cy:T,innerRadius:O,outerRadius:D,startAngle:o,endAngle:v});return hh(hh({},N),{},ite({},G,Ce))},{})},zFe=function(e,t){var r=e.x,n=e.y,c=t.x,h=t.y;return Math.sqrt(Math.pow(r-c,2)+Math.pow(n-h,2))},NFe=function(e,t){var r=e.x,n=e.y,c=t.cx,h=t.cy,p=zFe({x:r,y:n},{x:c,y:h});if(p<=0)return{radius:p};var o=(r-c)/p,v=Math.acos(o);return n>h&&(v=2*Math.PI-v),{radius:p,angle:DFe(v),angleInRadian:v}},FFe=function(e){var t=e.startAngle,r=e.endAngle,n=Math.floor(t/360),c=Math.floor(r/360),h=Math.min(n,c);return{startAngle:t-h*360,endAngle:r-h*360}},BFe=function(e,t){var r=t.startAngle,n=t.endAngle,c=Math.floor(r/360),h=Math.floor(n/360),p=Math.min(c,h);return e+p*360},wG=function(e,t){var r=e.x,n=e.y,c=NFe({x:r,y:n},t),h=c.radius,p=c.angle,o=t.innerRadius,v=t.outerRadius;if(h<o||h>v)return!1;if(h===0)return!0;var w=FFe(t),T=w.startAngle,M=w.endAngle,O=p,D;if(T<=M){for(;O>M;)O-=360;for(;O<T;)O+=360;D=O>=T&&O<=M}else{for(;O>T;)O-=360;for(;O<M;)O+=360;D=O>=M&&O<=T}return D?hh(hh({},t),{},{radius:h,angle:BFe(O,t)}):null},ate=function(e){return!Z.isValidElement(e)&&!Pn(e)&&typeof e!="boolean"?e.className:""};function Sw(e){"@babel/helpers - typeof";return Sw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sw(e)}var UFe=["offset"];function VFe(e){return HFe(e)||qFe(e)||GFe(e)||$Fe()}function $Fe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GFe(e,t){if(e){if(typeof e=="string")return HR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return HR(e,t)}}function qFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function HFe(e){if(Array.isArray(e))return HR(e)}function HR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function WFe(e,t){if(e==null)return{};var r=ZFe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ZFe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function SG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Qo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SG(Object(r),!0).forEach(function(n){KFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KFe(e,t,r){return t=XFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XFe(e){var t=YFe(e,"string");return Sw(t)=="symbol"?t:t+""}function YFe(e,t){if(Sw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Tw(){return Tw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tw.apply(this,arguments)}var JFe=function(e){var t=e.value,r=e.formatter,n=ni(e.children)?t:e.children;return Pn(r)?r(n):n},QFe=function(e,t){var r=ys(t-e),n=Math.min(Math.abs(t-e),360);return r*n},e5e=function(e,t,r){var n=e.position,c=e.viewBox,h=e.offset,p=e.className,o=c,v=o.cx,w=o.cy,T=o.innerRadius,M=o.outerRadius,O=o.startAngle,D=o.endAngle,B=o.clockWise,N=(T+M)/2,G=QFe(O,D),V=G>=0?1:-1,U,X;n==="insideStart"?(U=O+V*h,X=B):n==="insideEnd"?(U=D-V*h,X=!B):n==="end"&&(U=D+V*h,X=B),X=G<=0?X:!X;var Y=eo(v,w,N,U),ne=eo(v,w,N,U+(X?1:-1)*359),se="M".concat(Y.x,",").concat(Y.y,`
    A`).concat(N,",").concat(N,",0,1,").concat(X?0:1,`,
    `).concat(ne.x,",").concat(ne.y),le=ni(e.id)?a1("recharts-radial-line-"):e.id;return Ne.createElement("text",Tw({},r,{dominantBaseline:"central",className:Hn("recharts-radial-bar-label",p)}),Ne.createElement("defs",null,Ne.createElement("path",{id:le,d:se})),Ne.createElement("textPath",{xlinkHref:"#".concat(le)},t))},t5e=function(e){var t=e.viewBox,r=e.offset,n=e.position,c=t,h=c.cx,p=c.cy,o=c.innerRadius,v=c.outerRadius,w=c.startAngle,T=c.endAngle,M=(w+T)/2;if(n==="outside"){var O=eo(h,p,v+r,M),D=O.x,B=O.y;return{x:D,y:B,textAnchor:D>=h?"start":"end",verticalAnchor:"middle"}}if(n==="center")return{x:h,y:p,textAnchor:"middle",verticalAnchor:"middle"};if(n==="centerTop")return{x:h,y:p,textAnchor:"middle",verticalAnchor:"start"};if(n==="centerBottom")return{x:h,y:p,textAnchor:"middle",verticalAnchor:"end"};var N=(o+v)/2,G=eo(h,p,N,M),V=G.x,U=G.y;return{x:V,y:U,textAnchor:"middle",verticalAnchor:"middle"}},r5e=function(e){var t=e.viewBox,r=e.parentViewBox,n=e.offset,c=e.position,h=t,p=h.x,o=h.y,v=h.width,w=h.height,T=w>=0?1:-1,M=T*n,O=T>0?"end":"start",D=T>0?"start":"end",B=v>=0?1:-1,N=B*n,G=B>0?"end":"start",V=B>0?"start":"end";if(c==="top"){var U={x:p+v/2,y:o-T*n,textAnchor:"middle",verticalAnchor:O};return Qo(Qo({},U),r?{height:Math.max(o-r.y,0),width:v}:{})}if(c==="bottom"){var X={x:p+v/2,y:o+w+M,textAnchor:"middle",verticalAnchor:D};return Qo(Qo({},X),r?{height:Math.max(r.y+r.height-(o+w),0),width:v}:{})}if(c==="left"){var Y={x:p-N,y:o+w/2,textAnchor:G,verticalAnchor:"middle"};return Qo(Qo({},Y),r?{width:Math.max(Y.x-r.x,0),height:w}:{})}if(c==="right"){var ne={x:p+v+N,y:o+w/2,textAnchor:V,verticalAnchor:"middle"};return Qo(Qo({},ne),r?{width:Math.max(r.x+r.width-ne.x,0),height:w}:{})}var se=r?{width:v,height:w}:{};return c==="insideLeft"?Qo({x:p+N,y:o+w/2,textAnchor:V,verticalAnchor:"middle"},se):c==="insideRight"?Qo({x:p+v-N,y:o+w/2,textAnchor:G,verticalAnchor:"middle"},se):c==="insideTop"?Qo({x:p+v/2,y:o+M,textAnchor:"middle",verticalAnchor:D},se):c==="insideBottom"?Qo({x:p+v/2,y:o+w-M,textAnchor:"middle",verticalAnchor:O},se):c==="insideTopLeft"?Qo({x:p+N,y:o+M,textAnchor:V,verticalAnchor:D},se):c==="insideTopRight"?Qo({x:p+v-N,y:o+M,textAnchor:G,verticalAnchor:D},se):c==="insideBottomLeft"?Qo({x:p+N,y:o+w-M,textAnchor:V,verticalAnchor:O},se):c==="insideBottomRight"?Qo({x:p+v-N,y:o+w-M,textAnchor:G,verticalAnchor:O},se):cv(c)&&(fr(c.x)||tm(c.x))&&(fr(c.y)||tm(c.y))?Qo({x:p+_s(c.x,v),y:o+_s(c.y,w),textAnchor:"end",verticalAnchor:"end"},se):Qo({x:p+v/2,y:o+w/2,textAnchor:"middle",verticalAnchor:"middle"},se)},n5e=function(e){return"cx"in e&&fr(e.cx)};function _a(e){var t=e.offset,r=t===void 0?5:t,n=WFe(e,UFe),c=Qo({offset:r},n),h=c.viewBox,p=c.position,o=c.value,v=c.children,w=c.content,T=c.className,M=T===void 0?"":T,O=c.textBreakAll;if(!h||ni(o)&&ni(v)&&!Z.isValidElement(w)&&!Pn(w))return null;if(Z.isValidElement(w))return Z.cloneElement(w,c);var D;if(Pn(w)){if(D=Z.createElement(w,c),Z.isValidElement(D))return D}else D=JFe(c);var B=n5e(h),N=Sn(c,!0);if(B&&(p==="insideStart"||p==="insideEnd"||p==="end"))return e5e(c,D,N);var G=B?t5e(c):r5e(c);return Ne.createElement(Em,Tw({className:Hn("recharts-label",M)},N,G,{breakAll:O}),D)}_a.displayName="Label";var ste=function(e){var t=e.cx,r=e.cy,n=e.angle,c=e.startAngle,h=e.endAngle,p=e.r,o=e.radius,v=e.innerRadius,w=e.outerRadius,T=e.x,M=e.y,O=e.top,D=e.left,B=e.width,N=e.height,G=e.clockWise,V=e.labelViewBox;if(V)return V;if(fr(B)&&fr(N)){if(fr(T)&&fr(M))return{x:T,y:M,width:B,height:N};if(fr(O)&&fr(D))return{x:O,y:D,width:B,height:N}}return fr(T)&&fr(M)?{x:T,y:M,width:0,height:0}:fr(t)&&fr(r)?{cx:t,cy:r,startAngle:c||n||0,endAngle:h||n||0,innerRadius:v||0,outerRadius:w||o||p||0,clockWise:G}:e.viewBox?e.viewBox:{}},i5e=function(e,t){return e?e===!0?Ne.createElement(_a,{key:"label-implicit",viewBox:t}):oa(e)?Ne.createElement(_a,{key:"label-implicit",viewBox:t,value:e}):Z.isValidElement(e)?e.type===_a?Z.cloneElement(e,{key:"label-implicit",viewBox:t}):Ne.createElement(_a,{key:"label-implicit",content:e,viewBox:t}):Pn(e)?Ne.createElement(_a,{key:"label-implicit",content:e,viewBox:t}):cv(e)?Ne.createElement(_a,Tw({viewBox:t},e,{key:"label-implicit"})):null:null},o5e=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,c=ste(e),h=Ll(n,_a).map(function(o,v){return Z.cloneElement(o,{viewBox:t||c,key:"label-".concat(v)})});if(!r)return h;var p=i5e(e.label,t||c);return[p].concat(VFe(h))};_a.parseViewBox=ste;_a.renderCallByParent=o5e;function a5e(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var s5e=a5e;const l5e=ki(s5e);function Ew(e){"@babel/helpers - typeof";return Ew=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ew(e)}var c5e=["valueAccessor"],u5e=["data","dataKey","clockWise","id","textBreakAll"];function h5e(e){return m5e(e)||p5e(e)||f5e(e)||d5e()}function d5e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f5e(e,t){if(e){if(typeof e=="string")return WR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WR(e,t)}}function p5e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function m5e(e){if(Array.isArray(e))return WR(e)}function WR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tA(){return tA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tA.apply(this,arguments)}function TG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function EG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TG(Object(r),!0).forEach(function(n){g5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function g5e(e,t,r){return t=y5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y5e(e){var t=_5e(e,"string");return Ew(t)=="symbol"?t:t+""}function _5e(e,t){if(Ew(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ew(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function AG(e,t){if(e==null)return{};var r=v5e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function v5e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var x5e=function(e){return Array.isArray(e.value)?l5e(e.value):e.value};function ff(e){var t=e.valueAccessor,r=t===void 0?x5e:t,n=AG(e,c5e),c=n.data,h=n.dataKey,p=n.clockWise,o=n.id,v=n.textBreakAll,w=AG(n,u5e);return!c||!c.length?null:Ne.createElement(Li,{className:"recharts-label-list"},c.map(function(T,M){var O=ni(h)?r(T,M):Ja(T&&T.payload,h),D=ni(o)?{}:{id:"".concat(o,"-").concat(M)};return Ne.createElement(_a,tA({},Sn(T,!0),w,D,{parentViewBox:T.parentViewBox,value:O,textBreakAll:v,viewBox:_a.parseViewBox(ni(p)?T:EG(EG({},T),{},{clockWise:p})),key:"label-".concat(M),index:M}))}))}ff.displayName="LabelList";function b5e(e,t){return e?e===!0?Ne.createElement(ff,{key:"labelList-implicit",data:t}):Ne.isValidElement(e)||Pn(e)?Ne.createElement(ff,{key:"labelList-implicit",data:t,content:e}):cv(e)?Ne.createElement(ff,tA({data:t},e,{key:"labelList-implicit"})):null:null}function w5e(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,c=Ll(n,ff).map(function(p,o){return Z.cloneElement(p,{data:t,key:"labelList-".concat(o)})});if(!r)return c;var h=b5e(e.label,t);return[h].concat(h5e(c))}ff.renderCallByParent=w5e;function Aw(e){"@babel/helpers - typeof";return Aw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Aw(e)}function ZR(){return ZR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ZR.apply(this,arguments)}function kG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function CG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kG(Object(r),!0).forEach(function(n){S5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function S5e(e,t,r){return t=T5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T5e(e){var t=E5e(e,"string");return Aw(t)=="symbol"?t:t+""}function E5e(e,t){if(Aw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Aw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var A5e=function(e,t){var r=ys(t-e),n=Math.min(Math.abs(t-e),359.999);return r*n},i2=function(e){var t=e.cx,r=e.cy,n=e.radius,c=e.angle,h=e.sign,p=e.isExternal,o=e.cornerRadius,v=e.cornerIsExternal,w=o*(p?1:-1)+n,T=Math.asin(o/w)/eA,M=v?c:c+h*T,O=eo(t,r,w,M),D=eo(t,r,n,M),B=v?c-h*T:c,N=eo(t,r,w*Math.cos(T*eA),B);return{center:O,circleTangency:D,lineTangency:N,theta:T}},lte=function(e){var t=e.cx,r=e.cy,n=e.innerRadius,c=e.outerRadius,h=e.startAngle,p=e.endAngle,o=A5e(h,p),v=h+o,w=eo(t,r,c,h),T=eo(t,r,c,v),M="M ".concat(w.x,",").concat(w.y,`
    A `).concat(c,",").concat(c,`,0,
    `).concat(+(Math.abs(o)>180),",").concat(+(h>v),`,
    `).concat(T.x,",").concat(T.y,`
  `);if(n>0){var O=eo(t,r,n,h),D=eo(t,r,n,v);M+="L ".concat(D.x,",").concat(D.y,`
            A `).concat(n,",").concat(n,`,0,
            `).concat(+(Math.abs(o)>180),",").concat(+(h<=v),`,
            `).concat(O.x,",").concat(O.y," Z")}else M+="L ".concat(t,",").concat(r," Z");return M},k5e=function(e){var t=e.cx,r=e.cy,n=e.innerRadius,c=e.outerRadius,h=e.cornerRadius,p=e.forceCornerRadius,o=e.cornerIsExternal,v=e.startAngle,w=e.endAngle,T=ys(w-v),M=i2({cx:t,cy:r,radius:c,angle:v,sign:T,cornerRadius:h,cornerIsExternal:o}),O=M.circleTangency,D=M.lineTangency,B=M.theta,N=i2({cx:t,cy:r,radius:c,angle:w,sign:-T,cornerRadius:h,cornerIsExternal:o}),G=N.circleTangency,V=N.lineTangency,U=N.theta,X=o?Math.abs(v-w):Math.abs(v-w)-B-U;if(X<0)return p?"M ".concat(D.x,",").concat(D.y,`
        a`).concat(h,",").concat(h,",0,0,1,").concat(h*2,`,0
        a`).concat(h,",").concat(h,",0,0,1,").concat(-h*2,`,0
      `):lte({cx:t,cy:r,innerRadius:n,outerRadius:c,startAngle:v,endAngle:w});var Y="M ".concat(D.x,",").concat(D.y,`
    A`).concat(h,",").concat(h,",0,0,").concat(+(T<0),",").concat(O.x,",").concat(O.y,`
    A`).concat(c,",").concat(c,",0,").concat(+(X>180),",").concat(+(T<0),",").concat(G.x,",").concat(G.y,`
    A`).concat(h,",").concat(h,",0,0,").concat(+(T<0),",").concat(V.x,",").concat(V.y,`
  `);if(n>0){var ne=i2({cx:t,cy:r,radius:n,angle:v,sign:T,isExternal:!0,cornerRadius:h,cornerIsExternal:o}),se=ne.circleTangency,le=ne.lineTangency,ge=ne.theta,je=i2({cx:t,cy:r,radius:n,angle:w,sign:-T,isExternal:!0,cornerRadius:h,cornerIsExternal:o}),ze=je.circleTangency,Ce=je.lineTangency,Ke=je.theta,Ye=o?Math.abs(v-w):Math.abs(v-w)-ge-Ke;if(Ye<0&&h===0)return"".concat(Y,"L").concat(t,",").concat(r,"Z");Y+="L".concat(Ce.x,",").concat(Ce.y,`
      A`).concat(h,",").concat(h,",0,0,").concat(+(T<0),",").concat(ze.x,",").concat(ze.y,`
      A`).concat(n,",").concat(n,",0,").concat(+(Ye>180),",").concat(+(T>0),",").concat(se.x,",").concat(se.y,`
      A`).concat(h,",").concat(h,",0,0,").concat(+(T<0),",").concat(le.x,",").concat(le.y,"Z")}else Y+="L".concat(t,",").concat(r,"Z");return Y},C5e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},cte=function(e){var t=CG(CG({},C5e),e),r=t.cx,n=t.cy,c=t.innerRadius,h=t.outerRadius,p=t.cornerRadius,o=t.forceCornerRadius,v=t.cornerIsExternal,w=t.startAngle,T=t.endAngle,M=t.className;if(h<c||w===T)return null;var O=Hn("recharts-sector",M),D=h-c,B=_s(p,D,0,!0),N;return B>0&&Math.abs(w-T)<360?N=k5e({cx:r,cy:n,innerRadius:c,outerRadius:h,cornerRadius:Math.min(B,D/2),forceCornerRadius:o,cornerIsExternal:v,startAngle:w,endAngle:T}):N=lte({cx:r,cy:n,innerRadius:c,outerRadius:h,startAngle:w,endAngle:T}),Ne.createElement("path",ZR({},Sn(t,!0),{className:O,d:N,role:"img"}))};function kw(e){"@babel/helpers - typeof";return kw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kw(e)}function KR(){return KR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KR.apply(this,arguments)}function PG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function MG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PG(Object(r),!0).forEach(function(n){P5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function P5e(e,t,r){return t=M5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M5e(e){var t=I5e(e,"string");return kw(t)=="symbol"?t:t+""}function I5e(e,t){if(kw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(kw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var IG={curveBasisClosed:wAe,curveBasisOpen:SAe,curveBasis:bAe,curveBumpX:sAe,curveBumpY:lAe,curveLinearClosed:TAe,curveLinear:Wk,curveMonotoneX:EAe,curveMonotoneY:AAe,curveNatural:kAe,curveStep:CAe,curveStepAfter:MAe,curveStepBefore:PAe},o2=function(e){return e.x===+e.x&&e.y===+e.y},Wx=function(e){return e.x},Zx=function(e){return e.y},O5e=function(e,t){if(Pn(e))return e;var r="curve".concat(qk(e));return(r==="curveMonotone"||r==="curveBump")&&t?IG["".concat(r).concat(t==="vertical"?"Y":"X")]:IG[r]||Wk},j5e=function(e){var t=e.type,r=t===void 0?"linear":t,n=e.points,c=n===void 0?[]:n,h=e.baseLine,p=e.layout,o=e.connectNulls,v=o===void 0?!1:o,w=O5e(r,p),T=v?c.filter(function(B){return o2(B)}):c,M;if(Array.isArray(h)){var O=v?h.filter(function(B){return o2(B)}):h,D=T.map(function(B,N){return MG(MG({},B),{},{base:O[N]})});return p==="vertical"?M=KT().y(Zx).x1(Wx).x0(function(B){return B.base.x}):M=KT().x(Wx).y1(Zx).y0(function(B){return B.base.y}),M.defined(o2).curve(w),M(D)}return p==="vertical"&&fr(h)?M=KT().y(Zx).x1(Wx).x0(h):fr(h)?M=KT().x(Wx).y1(Zx).y0(h):M=tQ().x(Wx).y(Zx),M.defined(o2).curve(w),M(T)},XR=function(e){var t=e.className,r=e.points,n=e.path,c=e.pathRef;if((!r||!r.length)&&!n)return null;var h=r&&r.length?j5e(e):n;return Z.createElement("path",KR({},Sn(e,!1),AE(e),{className:Hn("recharts-curve",t),d:h,ref:c}))},ute={exports:{}},R5e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",D5e=R5e,L5e=D5e;function hte(){}function dte(){}dte.resetWarningCache=hte;var z5e=function(){function e(n,c,h,p,o,v){if(v!==L5e){var w=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw w.name="Invariant Violation",w}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:dte,resetWarningCache:hte};return r.PropTypes=r,r};ute.exports=z5e();var N5e=ute.exports;const Mi=ki(N5e);var F5e=Object.getOwnPropertyNames,B5e=Object.getOwnPropertySymbols,U5e=Object.prototype.hasOwnProperty;function OG(e,t){return function(r,n,c){return e(r,n,c)&&t(r,n,c)}}function a2(e){return function(t,r,n){if(!t||!r||typeof t!="object"||typeof r!="object")return e(t,r,n);var c=n.cache,h=c.get(t),p=c.get(r);if(h&&p)return h===r&&p===t;c.set(t,r),c.set(r,t);var o=e(t,r,n);return c.delete(t),c.delete(r),o}}function jG(e){return F5e(e).concat(B5e(e))}var V5e=Object.hasOwn||function(e,t){return U5e.call(e,t)};function Fm(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var $5e="__v",G5e="__o",q5e="_owner",RG=Object.getOwnPropertyDescriptor,DG=Object.keys;function H5e(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function W5e(e,t){return Fm(e.getTime(),t.getTime())}function Z5e(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function K5e(e,t){return e===t}function LG(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var c=new Array(n),h=e.entries(),p,o,v=0;(p=h.next())&&!p.done;){for(var w=t.entries(),T=!1,M=0;(o=w.next())&&!o.done;){if(c[M]){M++;continue}var O=p.value,D=o.value;if(r.equals(O[0],D[0],v,M,e,t,r)&&r.equals(O[1],D[1],O[0],D[0],e,t,r)){T=c[M]=!0;break}M++}if(!T)return!1;v++}return!0}var X5e=Fm;function Y5e(e,t,r){var n=DG(e),c=n.length;if(DG(t).length!==c)return!1;for(;c-- >0;)if(!fte(e,t,r,n[c]))return!1;return!0}function Kx(e,t,r){var n=jG(e),c=n.length;if(jG(t).length!==c)return!1;for(var h,p,o;c-- >0;)if(h=n[c],!fte(e,t,r,h)||(p=RG(e,h),o=RG(t,h),(p||o)&&(!p||!o||p.configurable!==o.configurable||p.enumerable!==o.enumerable||p.writable!==o.writable)))return!1;return!0}function J5e(e,t){return Fm(e.valueOf(),t.valueOf())}function Q5e(e,t){return e.source===t.source&&e.flags===t.flags}function zG(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var c=new Array(n),h=e.values(),p,o;(p=h.next())&&!p.done;){for(var v=t.values(),w=!1,T=0;(o=v.next())&&!o.done;){if(!c[T]&&r.equals(p.value,o.value,p.value,o.value,e,t,r)){w=c[T]=!0;break}T++}if(!w)return!1}return!0}function eBe(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function tBe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function fte(e,t,r,n){return(n===q5e||n===G5e||n===$5e)&&(e.$$typeof||t.$$typeof)?!0:V5e(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var rBe="[object Arguments]",nBe="[object Boolean]",iBe="[object Date]",oBe="[object Error]",aBe="[object Map]",sBe="[object Number]",lBe="[object Object]",cBe="[object RegExp]",uBe="[object Set]",hBe="[object String]",dBe="[object URL]",fBe=Array.isArray,NG=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,FG=Object.assign,pBe=Object.prototype.toString.call.bind(Object.prototype.toString);function mBe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,c=e.areFunctionsEqual,h=e.areMapsEqual,p=e.areNumbersEqual,o=e.areObjectsEqual,v=e.arePrimitiveWrappersEqual,w=e.areRegExpsEqual,T=e.areSetsEqual,M=e.areTypedArraysEqual,O=e.areUrlsEqual;return function(D,B,N){if(D===B)return!0;if(D==null||B==null)return!1;var G=typeof D;if(G!==typeof B)return!1;if(G!=="object")return G==="number"?p(D,B,N):G==="function"?c(D,B,N):!1;var V=D.constructor;if(V!==B.constructor)return!1;if(V===Object)return o(D,B,N);if(fBe(D))return t(D,B,N);if(NG!=null&&NG(D))return M(D,B,N);if(V===Date)return r(D,B,N);if(V===RegExp)return w(D,B,N);if(V===Map)return h(D,B,N);if(V===Set)return T(D,B,N);var U=pBe(D);return U===iBe?r(D,B,N):U===cBe?w(D,B,N):U===aBe?h(D,B,N):U===uBe?T(D,B,N):U===lBe?typeof D.then!="function"&&typeof B.then!="function"&&o(D,B,N):U===dBe?O(D,B,N):U===oBe?n(D,B,N):U===rBe?o(D,B,N):U===nBe||U===sBe||U===hBe?v(D,B,N):!1}}function gBe(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,c={areArraysEqual:n?Kx:H5e,areDatesEqual:W5e,areErrorsEqual:Z5e,areFunctionsEqual:K5e,areMapsEqual:n?OG(LG,Kx):LG,areNumbersEqual:X5e,areObjectsEqual:n?Kx:Y5e,arePrimitiveWrappersEqual:J5e,areRegExpsEqual:Q5e,areSetsEqual:n?OG(zG,Kx):zG,areTypedArraysEqual:n?Kx:eBe,areUrlsEqual:tBe};if(r&&(c=FG({},c,r(c))),t){var h=a2(c.areArraysEqual),p=a2(c.areMapsEqual),o=a2(c.areObjectsEqual),v=a2(c.areSetsEqual);c=FG({},c,{areArraysEqual:h,areMapsEqual:p,areObjectsEqual:o,areSetsEqual:v})}return c}function yBe(e){return function(t,r,n,c,h,p,o){return e(t,r,o)}}function _Be(e){var t=e.circular,r=e.comparator,n=e.createState,c=e.equals,h=e.strict;if(n)return function(o,v){var w=n(),T=w.cache,M=T===void 0?t?new WeakMap:void 0:T,O=w.meta;return r(o,v,{cache:M,equals:c,meta:O,strict:h})};if(t)return function(o,v){return r(o,v,{cache:new WeakMap,equals:c,meta:void 0,strict:h})};var p={cache:void 0,equals:c,meta:void 0,strict:h};return function(o,v){return r(o,v,p)}}var vBe=Pf();Pf({strict:!0});Pf({circular:!0});Pf({circular:!0,strict:!0});Pf({createInternalComparator:function(){return Fm}});Pf({strict:!0,createInternalComparator:function(){return Fm}});Pf({circular:!0,createInternalComparator:function(){return Fm}});Pf({circular:!0,createInternalComparator:function(){return Fm},strict:!0});function Pf(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,c=e.createState,h=e.strict,p=h===void 0?!1:h,o=gBe(e),v=mBe(o),w=n?n(v):yBe(v);return _Be({circular:r,comparator:v,createState:c,equals:w,strict:p})}function xBe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function BG(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function c(h){r<0&&(r=h),h-r>t?(e(h),r=-1):xBe(c)};requestAnimationFrame(n)}function YR(e){"@babel/helpers - typeof";return YR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YR(e)}function bBe(e){return EBe(e)||TBe(e)||SBe(e)||wBe()}function wBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SBe(e,t){if(e){if(typeof e=="string")return UG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return UG(e,t)}}function UG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function TBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function EBe(e){if(Array.isArray(e))return e}function ABe(){var e={},t=function(){return null},r=!1,n=function c(h){if(!r){if(Array.isArray(h)){if(!h.length)return;var p=h,o=bBe(p),v=o[0],w=o.slice(1);if(typeof v=="number"){BG(c.bind(null,w),v);return}c(v),BG(c.bind(null,w));return}YR(h)==="object"&&(e=h,t(e)),typeof h=="function"&&h()}};return{stop:function(){r=!0},start:function(c){r=!1,n(c)},subscribe:function(c){return t=c,function(){t=function(){return null}}}}}function Cw(e){"@babel/helpers - typeof";return Cw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cw(e)}function VG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function $G(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VG(Object(r),!0).forEach(function(n){pte(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pte(e,t,r){return t=kBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kBe(e){var t=CBe(e,"string");return Cw(t)==="symbol"?t:String(t)}function CBe(e,t){if(Cw(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Cw(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var PBe=function(e,t){return[Object.keys(e),Object.keys(t)].reduce(function(r,n){return r.filter(function(c){return n.includes(c)})})},MBe=function(e){return e},IBe=function(e){return e.replace(/([A-Z])/g,function(t){return"-".concat(t.toLowerCase())})},Pb=function(e,t){return Object.keys(t).reduce(function(r,n){return $G($G({},r),{},pte({},n,e(n,t[n])))},{})},GG=function(e,t,r){return e.map(function(n){return"".concat(IBe(n)," ").concat(t,"ms ").concat(r)}).join(",")};function OBe(e,t){return DBe(e)||RBe(e,t)||mte(e,t)||jBe()}function jBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RBe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function DBe(e){if(Array.isArray(e))return e}function LBe(e){return FBe(e)||NBe(e)||mte(e)||zBe()}function zBe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mte(e,t){if(e){if(typeof e=="string")return JR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return JR(e,t)}}function NBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function FBe(e){if(Array.isArray(e))return JR(e)}function JR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var rA=1e-4,gte=function(e,t){return[0,3*e,3*t-6*e,3*e-3*t+1]},yte=function(e,t){return e.map(function(r,n){return r*Math.pow(t,n)}).reduce(function(r,n){return r+n})},qG=function(e,t){return function(r){var n=gte(e,t);return yte(n,r)}},BBe=function(e,t){return function(r){var n=gte(e,t),c=[].concat(LBe(n.map(function(h,p){return h*p}).slice(1)),[0]);return yte(c,r)}},HG=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0],c=t[1],h=t[2],p=t[3];if(t.length===1)switch(t[0]){case"linear":n=0,c=0,h=1,p=1;break;case"ease":n=.25,c=.1,h=.25,p=1;break;case"ease-in":n=.42,c=0,h=1,p=1;break;case"ease-out":n=.42,c=0,h=.58,p=1;break;case"ease-in-out":n=0,c=0,h=.58,p=1;break;default:{var o=t[0].split("(");if(o[0]==="cubic-bezier"&&o[1].split(")")[0].split(",").length===4){var v=o[1].split(")")[0].split(",").map(function(N){return parseFloat(N)}),w=OBe(v,4);n=w[0],c=w[1],h=w[2],p=w[3]}}}var T=qG(n,h),M=qG(c,p),O=BBe(n,h),D=function(N){return N>1?1:N<0?0:N},B=function(N){for(var G=N>1?1:N,V=G,U=0;U<8;++U){var X=T(V)-G,Y=O(V);if(Math.abs(X-G)<rA||Y<rA)return M(V);V=D(V-X/Y)}return M(V)};return B.isStepper=!1,B},UBe=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.stiff,r=t===void 0?100:t,n=e.damping,c=n===void 0?8:n,h=e.dt,p=h===void 0?17:h,o=function(v,w,T){var M=-(v-w)*r,O=T*c,D=T+(M-O)*p/1e3,B=T*p/1e3+v;return Math.abs(B-w)<rA&&Math.abs(D)<rA?[w,0]:[B,D]};return o.isStepper=!0,o.dt=p,o},VBe=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0];if(typeof n=="string")switch(n){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return HG(n);case"spring":return UBe();default:if(n.split("(")[0]==="cubic-bezier")return HG(n)}return typeof n=="function"?n:null};function Pw(e){"@babel/helpers - typeof";return Pw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pw(e)}function WG(e){return qBe(e)||GBe(e)||_te(e)||$Be()}function $Be(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function qBe(e){if(Array.isArray(e))return eD(e)}function ZG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Ra(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZG(Object(r),!0).forEach(function(n){QR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function QR(e,t,r){return t=HBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HBe(e){var t=WBe(e,"string");return Pw(t)==="symbol"?t:String(t)}function WBe(e,t){if(Pw(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Pw(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ZBe(e,t){return YBe(e)||XBe(e,t)||_te(e,t)||KBe()}function KBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _te(e,t){if(e){if(typeof e=="string")return eD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eD(e,t)}}function eD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function XBe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function YBe(e){if(Array.isArray(e))return e}var nA=function(e,t,r){return e+(t-e)*r},tD=function(e){var t=e.from,r=e.to;return t!==r},JBe=function e(t,r,n){var c=Pb(function(h,p){if(tD(p)){var o=t(p.from,p.to,p.velocity),v=ZBe(o,2),w=v[0],T=v[1];return Ra(Ra({},p),{},{from:w,velocity:T})}return p},r);return n<1?Pb(function(h,p){return tD(p)?Ra(Ra({},p),{},{velocity:nA(p.velocity,c[h].velocity,n),from:nA(p.from,c[h].from,n)}):p},r):e(t,c,n-1)};const QBe=function(e,t,r,n,c){var h=PBe(e,t),p=h.reduce(function(G,V){return Ra(Ra({},G),{},QR({},V,[e[V],t[V]]))},{}),o=h.reduce(function(G,V){return Ra(Ra({},G),{},QR({},V,{from:e[V],velocity:0,to:t[V]}))},{}),v=-1,w,T,M=function(){return null},O=function(){return Pb(function(G,V){return V.from},o)},D=function(){return!Object.values(o).filter(tD).length},B=function(G){w||(w=G);var V=G-w,U=V/r.dt;o=JBe(r,o,U),c(Ra(Ra(Ra({},e),t),O())),w=G,D()||(v=requestAnimationFrame(M))},N=function(G){T||(T=G);var V=(G-T)/n,U=Pb(function(Y,ne){return nA.apply(void 0,WG(ne).concat([r(V)]))},p);if(c(Ra(Ra(Ra({},e),t),U)),V<1)v=requestAnimationFrame(M);else{var X=Pb(function(Y,ne){return nA.apply(void 0,WG(ne).concat([r(1)]))},p);c(Ra(Ra(Ra({},e),t),X))}};return M=r.isStepper?B:N,function(){return requestAnimationFrame(M),function(){cancelAnimationFrame(v)}}};function I_(e){"@babel/helpers - typeof";return I_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I_(e)}var e4e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function t4e(e,t){if(e==null)return{};var r=r4e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function r4e(e,t){if(e==null)return{};var r={},n=Object.keys(e),c,h;for(h=0;h<n.length;h++)c=n[h],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function KI(e){return a4e(e)||o4e(e)||i4e(e)||n4e()}function n4e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i4e(e,t){if(e){if(typeof e=="string")return rD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rD(e,t)}}function o4e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function a4e(e){if(Array.isArray(e))return rD(e)}function rD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function KG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function oc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KG(Object(r),!0).forEach(function(n){ob(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ob(e,t,r){return t=vte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s4e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l4e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vte(n.key),n)}}function c4e(e,t,r){return t&&l4e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function vte(e){var t=u4e(e,"string");return I_(t)==="symbol"?t:String(t)}function u4e(e,t){if(I_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(I_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function h4e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nD(e,t)}function nD(e,t){return nD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},nD(e,t)}function d4e(e){var t=f4e();return function(){var r=iA(e),n;if(t){var c=iA(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return iD(this,n)}}function iD(e,t){if(t&&(I_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oD(e)}function oD(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f4e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function iA(e){return iA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},iA(e)}var Dh=function(e){h4e(r,e);var t=d4e(r);function r(n,c){var h;s4e(this,r),h=t.call(this,n,c);var p=h.props,o=p.isActive,v=p.attributeName,w=p.from,T=p.to,M=p.steps,O=p.children,D=p.duration;if(h.handleStyleChange=h.handleStyleChange.bind(oD(h)),h.changeStyle=h.changeStyle.bind(oD(h)),!o||D<=0)return h.state={style:{}},typeof O=="function"&&(h.state={style:T}),iD(h);if(M&&M.length)h.state={style:M[0].style};else if(w){if(typeof O=="function")return h.state={style:w},iD(h);h.state={style:v?ob({},v,w):w}}else h.state={style:{}};return h}return c4e(r,[{key:"componentDidMount",value:function(){var n=this.props,c=n.isActive,h=n.canBegin;this.mounted=!0,!(!c||!h)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(n){var c=this.props,h=c.isActive,p=c.canBegin,o=c.attributeName,v=c.shouldReAnimate,w=c.to,T=c.from,M=this.state.style;if(p){if(!h){var O={style:o?ob({},o,w):w};this.state&&M&&(o&&M[o]!==w||!o&&M!==w)&&this.setState(O);return}if(!(vBe(n.to,w)&&n.canBegin&&n.isActive)){var D=!n.canBegin||!n.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var B=D||v?T:n.to;if(this.state&&M){var N={style:o?ob({},o,B):B};(o&&M[o]!==B||!o&&M!==B)&&this.setState(N)}this.runAnimation(oc(oc({},this.props),{},{from:B,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var n=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),n&&n()}},{key:"handleStyleChange",value:function(n){this.changeStyle(n)}},{key:"changeStyle",value:function(n){this.mounted&&this.setState({style:n})}},{key:"runJSAnimation",value:function(n){var c=this,h=n.from,p=n.to,o=n.duration,v=n.easing,w=n.begin,T=n.onAnimationEnd,M=n.onAnimationStart,O=QBe(h,p,VBe(v),o,this.changeStyle),D=function(){c.stopJSAnimation=O()};this.manager.start([M,w,D,o,T])}},{key:"runStepAnimation",value:function(n){var c=this,h=n.steps,p=n.begin,o=n.onAnimationStart,v=h[0],w=v.style,T=v.duration,M=T===void 0?0:T,O=function(D,B,N){if(N===0)return D;var G=B.duration,V=B.easing,U=V===void 0?"ease":V,X=B.style,Y=B.properties,ne=B.onAnimationEnd,se=N>0?h[N-1]:B,le=Y||Object.keys(X);if(typeof U=="function"||U==="spring")return[].concat(KI(D),[c.runJSAnimation.bind(c,{from:se.style,to:X,duration:G,easing:U}),G]);var ge=GG(le,G,U),je=oc(oc(oc({},se.style),X),{},{transition:ge});return[].concat(KI(D),[je,G,ne]).filter(MBe)};return this.manager.start([o].concat(KI(h.reduce(O,[w,Math.max(M,p)])),[n.onAnimationEnd]))}},{key:"runAnimation",value:function(n){this.manager||(this.manager=ABe());var c=n.begin,h=n.duration,p=n.attributeName,o=n.to,v=n.easing,w=n.onAnimationStart,T=n.onAnimationEnd,M=n.steps,O=n.children,D=this.manager;if(this.unSubscribe=D.subscribe(this.handleStyleChange),typeof v=="function"||typeof O=="function"||v==="spring"){this.runJSAnimation(n);return}if(M.length>1){this.runStepAnimation(n);return}var B=p?ob({},p,o):o,N=GG(Object.keys(B),h,v);D.start([w,c,oc(oc({},B),{},{transition:N}),h,T])}},{key:"render",value:function(){var n=this.props,c=n.children;n.begin;var h=n.duration;n.attributeName,n.easing;var p=n.isActive;n.steps,n.from,n.to,n.canBegin,n.onAnimationEnd,n.shouldReAnimate,n.onAnimationReStart;var o=t4e(n,e4e),v=Z.Children.count(c),w=this.state.style;if(typeof c=="function")return c(w);if(!p||v===0||h<=0)return c;var T=function(M){var O=M.props,D=O.style,B=D===void 0?{}:D,N=O.className,G=Z.cloneElement(M,oc(oc({},o),{},{style:oc(oc({},B),w),className:N}));return G};return v===1?T(Z.Children.only(c)):Ne.createElement("div",null,Z.Children.map(c,function(M){return T(M)}))}}]),r}(Z.PureComponent);Dh.displayName="Animate";Dh.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Dh.propTypes={from:Mi.oneOfType([Mi.object,Mi.string]),to:Mi.oneOfType([Mi.object,Mi.string]),attributeName:Mi.string,duration:Mi.number,begin:Mi.number,easing:Mi.oneOfType([Mi.string,Mi.func]),steps:Mi.arrayOf(Mi.shape({duration:Mi.number.isRequired,style:Mi.object.isRequired,easing:Mi.oneOfType([Mi.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Mi.func]),properties:Mi.arrayOf("string"),onAnimationEnd:Mi.func})),children:Mi.oneOfType([Mi.node,Mi.func]),isActive:Mi.bool,canBegin:Mi.bool,onAnimationEnd:Mi.func,shouldReAnimate:Mi.bool,onAnimationStart:Mi.func,onAnimationReStart:Mi.func};function Mw(e){"@babel/helpers - typeof";return Mw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mw(e)}function oA(){return oA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oA.apply(this,arguments)}function p4e(e,t){return _4e(e)||y4e(e,t)||g4e(e,t)||m4e()}function m4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g4e(e,t){if(e){if(typeof e=="string")return XG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return XG(e,t)}}function XG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y4e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function _4e(e){if(Array.isArray(e))return e}function YG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function JG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YG(Object(r),!0).forEach(function(n){v4e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function v4e(e,t,r){return t=x4e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x4e(e){var t=b4e(e,"string");return Mw(t)=="symbol"?t:t+""}function b4e(e,t){if(Mw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Mw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var QG=function(e,t,r,n,c){var h=Math.min(Math.abs(r)/2,Math.abs(n)/2),p=n>=0?1:-1,o=r>=0?1:-1,v=n>=0&&r>=0||n<0&&r<0?1:0,w;if(h>0&&c instanceof Array){for(var T=[0,0,0,0],M=0,O=4;M<O;M++)T[M]=c[M]>h?h:c[M];w="M".concat(e,",").concat(t+p*T[0]),T[0]>0&&(w+="A ".concat(T[0],",").concat(T[0],",0,0,").concat(v,",").concat(e+o*T[0],",").concat(t)),w+="L ".concat(e+r-o*T[1],",").concat(t),T[1]>0&&(w+="A ".concat(T[1],",").concat(T[1],",0,0,").concat(v,`,
        `).concat(e+r,",").concat(t+p*T[1])),w+="L ".concat(e+r,",").concat(t+n-p*T[2]),T[2]>0&&(w+="A ".concat(T[2],",").concat(T[2],",0,0,").concat(v,`,
        `).concat(e+r-o*T[2],",").concat(t+n)),w+="L ".concat(e+o*T[3],",").concat(t+n),T[3]>0&&(w+="A ".concat(T[3],",").concat(T[3],",0,0,").concat(v,`,
        `).concat(e,",").concat(t+n-p*T[3])),w+="Z"}else if(h>0&&c===+c&&c>0){var D=Math.min(h,c);w="M ".concat(e,",").concat(t+p*D,`
            A `).concat(D,",").concat(D,",0,0,").concat(v,",").concat(e+o*D,",").concat(t,`
            L `).concat(e+r-o*D,",").concat(t,`
            A `).concat(D,",").concat(D,",0,0,").concat(v,",").concat(e+r,",").concat(t+p*D,`
            L `).concat(e+r,",").concat(t+n-p*D,`
            A `).concat(D,",").concat(D,",0,0,").concat(v,",").concat(e+r-o*D,",").concat(t+n,`
            L `).concat(e+o*D,",").concat(t+n,`
            A `).concat(D,",").concat(D,",0,0,").concat(v,",").concat(e,",").concat(t+n-p*D," Z")}else w="M ".concat(e,",").concat(t," h ").concat(r," v ").concat(n," h ").concat(-r," Z");return w},w4e=function(e,t){if(!e||!t)return!1;var r=e.x,n=e.y,c=t.x,h=t.y,p=t.width,o=t.height;if(Math.abs(p)>0&&Math.abs(o)>0){var v=Math.min(c,c+p),w=Math.max(c,c+p),T=Math.min(h,h+o),M=Math.max(h,h+o);return r>=v&&r<=w&&n>=T&&n<=M}return!1},S4e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Qz=function(e){var t=JG(JG({},S4e),e),r=Z.useRef(),n=Z.useState(-1),c=p4e(n,2),h=c[0],p=c[1];Z.useEffect(function(){if(r.current&&r.current.getTotalLength)try{var X=r.current.getTotalLength();X&&p(X)}catch{}},[]);var o=t.x,v=t.y,w=t.width,T=t.height,M=t.radius,O=t.className,D=t.animationEasing,B=t.animationDuration,N=t.animationBegin,G=t.isAnimationActive,V=t.isUpdateAnimationActive;if(o!==+o||v!==+v||w!==+w||T!==+T||w===0||T===0)return null;var U=Hn("recharts-rectangle",O);return V?Ne.createElement(Dh,{canBegin:h>0,from:{width:w,height:T,x:o,y:v},to:{width:w,height:T,x:o,y:v},duration:B,animationEasing:D,isActive:V},function(X){var Y=X.width,ne=X.height,se=X.x,le=X.y;return Ne.createElement(Dh,{canBegin:h>0,from:"0px ".concat(h===-1?1:h,"px"),to:"".concat(h,"px 0px"),attributeName:"strokeDasharray",begin:N,duration:B,isActive:G,easing:D},Ne.createElement("path",oA({},Sn(t,!0),{className:U,d:QG(se,le,Y,ne,M),ref:r})))}):Ne.createElement("path",oA({},Sn(t,!0),{className:U,d:QG(o,v,w,T,M)}))},T4e=["points","className","baseLinePoints","connectNulls"];function Vy(){return Vy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Vy.apply(this,arguments)}function E4e(e,t){if(e==null)return{};var r=A4e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function A4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function eq(e){return M4e(e)||P4e(e)||C4e(e)||k4e()}function k4e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function C4e(e,t){if(e){if(typeof e=="string")return aD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return aD(e,t)}}function P4e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function M4e(e){if(Array.isArray(e))return aD(e)}function aD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var tq=function(e){return e&&e.x===+e.x&&e.y===+e.y},I4e=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=[[]];return e.forEach(function(r){tq(r)?t[t.length-1].push(r):t[t.length-1].length>0&&t.push([])}),tq(e[0])&&t[t.length-1].push(e[0]),t[t.length-1].length<=0&&(t=t.slice(0,-1)),t},Mb=function(e,t){var r=I4e(e);t&&(r=[r.reduce(function(c,h){return[].concat(eq(c),eq(h))},[])]);var n=r.map(function(c){return c.reduce(function(h,p,o){return"".concat(h).concat(o===0?"M":"L").concat(p.x,",").concat(p.y)},"")}).join("");return r.length===1?"".concat(n,"Z"):n},O4e=function(e,t,r){var n=Mb(e,r);return"".concat(n.slice(-1)==="Z"?n.slice(0,-1):n,"L").concat(Mb(t.reverse(),r).slice(1))},j4e=function(e){var t=e.points,r=e.className,n=e.baseLinePoints,c=e.connectNulls,h=E4e(e,T4e);if(!t||!t.length)return null;var p=Hn("recharts-polygon",r);if(n&&n.length){var o=h.stroke&&h.stroke!=="none",v=O4e(t,n,c);return Ne.createElement("g",{className:p},Ne.createElement("path",Vy({},Sn(h,!0),{fill:v.slice(-1)==="Z"?h.fill:"none",stroke:"none",d:v})),o?Ne.createElement("path",Vy({},Sn(h,!0),{fill:"none",d:Mb(t,c)})):null,o?Ne.createElement("path",Vy({},Sn(h,!0),{fill:"none",d:Mb(n,c)})):null)}var w=Mb(t,c);return Ne.createElement("path",Vy({},Sn(h,!0),{fill:w.slice(-1)==="Z"?h.fill:"none",className:p,d:w}))};function sD(){return sD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},sD.apply(this,arguments)}var eN=function(e){var t=e.cx,r=e.cy,n=e.r,c=e.className,h=Hn("recharts-dot",c);return t===+t&&r===+r&&n===+n?Z.createElement("circle",sD({},Sn(e,!1),AE(e),{className:h,cx:t,cy:r,r:n})):null};function Iw(e){"@babel/helpers - typeof";return Iw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Iw(e)}var R4e=["x","y","top","left","width","height","className"];function lD(){return lD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lD.apply(this,arguments)}function rq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function D4e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rq(Object(r),!0).forEach(function(n){L4e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function L4e(e,t,r){return t=z4e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function z4e(e){var t=N4e(e,"string");return Iw(t)=="symbol"?t:t+""}function N4e(e,t){if(Iw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Iw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function F4e(e,t){if(e==null)return{};var r=B4e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function B4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var U4e=function(e,t,r,n,c,h){return"M".concat(e,",").concat(c,"v").concat(n,"M").concat(h,",").concat(t,"h").concat(r)},V4e=function(e){var t=e.x,r=t===void 0?0:t,n=e.y,c=n===void 0?0:n,h=e.top,p=h===void 0?0:h,o=e.left,v=o===void 0?0:o,w=e.width,T=w===void 0?0:w,M=e.height,O=M===void 0?0:M,D=e.className,B=F4e(e,R4e),N=D4e({x:r,y:c,top:p,left:v,width:T,height:O},B);return!fr(r)||!fr(c)||!fr(T)||!fr(O)||!fr(p)||!fr(v)?null:Ne.createElement("path",lD({},Sn(N,!0),{className:Hn("recharts-cross",D),d:U4e(r,c,T,O,p,v)}))},$4e=iC,G4e=Iee,q4e=Ou;function H4e(e,t){return e&&e.length?$4e(e,q4e(t),G4e):void 0}var W4e=H4e;const Z4e=ki(W4e);var K4e=iC,X4e=Ou,Y4e=Oee;function J4e(e,t){return e&&e.length?K4e(e,X4e(t),Y4e):void 0}var Q4e=J4e;const e6e=ki(Q4e);var t6e=["cx","cy","angle","ticks","axisLine"],r6e=["ticks","tick","angle","tickFormatter","stroke"];function O_(e){"@babel/helpers - typeof";return O_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O_(e)}function Ib(){return Ib=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ib.apply(this,arguments)}function nq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function zp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nq(Object(r),!0).forEach(function(n){hC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iq(e,t){if(e==null)return{};var r=n6e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function n6e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function i6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,bte(n.key),n)}}function o6e(e,t,r){return t&&oq(e.prototype,t),r&&oq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a6e(e,t,r){return t=aA(t),s6e(e,xte()?Reflect.construct(t,r||[],aA(e).constructor):t.apply(e,r))}function s6e(e,t){if(t&&(O_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return l6e(e)}function l6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xte=function(){return!!e})()}function aA(e){return aA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},aA(e)}function c6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cD(e,t)}function cD(e,t){return cD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},cD(e,t)}function hC(e,t,r){return t=bte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bte(e){var t=u6e(e,"string");return O_(t)=="symbol"?t:t+""}function u6e(e,t){if(O_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(O_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var dC=function(e){function t(){return i6e(this,t),a6e(this,t,arguments)}return c6e(t,e),o6e(t,[{key:"getTickValueCoord",value:function(r){var n=r.coordinate,c=this.props,h=c.angle,p=c.cx,o=c.cy;return eo(p,o,n,h)}},{key:"getTickTextAnchor",value:function(){var r=this.props.orientation,n;switch(r){case"left":n="end";break;case"right":n="start";break;default:n="middle";break}return n}},{key:"getViewBox",value:function(){var r=this.props,n=r.cx,c=r.cy,h=r.angle,p=r.ticks,o=Z4e(p,function(w){return w.coordinate||0}),v=e6e(p,function(w){return w.coordinate||0});return{cx:n,cy:c,startAngle:h,endAngle:h,innerRadius:v.coordinate||0,outerRadius:o.coordinate||0}}},{key:"renderAxisLine",value:function(){var r=this.props,n=r.cx,c=r.cy,h=r.angle,p=r.ticks,o=r.axisLine,v=iq(r,t6e),w=p.reduce(function(D,B){return[Math.min(D[0],B.coordinate),Math.max(D[1],B.coordinate)]},[1/0,-1/0]),T=eo(n,c,w[0],h),M=eo(n,c,w[1],h),O=zp(zp(zp({},Sn(v,!1)),{},{fill:"none"},Sn(o,!1)),{},{x1:T.x,y1:T.y,x2:M.x,y2:M.y});return Ne.createElement("line",Ib({className:"recharts-polar-radius-axis-line"},O))}},{key:"renderTicks",value:function(){var r=this,n=this.props,c=n.ticks,h=n.tick,p=n.angle,o=n.tickFormatter,v=n.stroke,w=iq(n,r6e),T=this.getTickTextAnchor(),M=Sn(w,!1),O=Sn(h,!1),D=c.map(function(B,N){var G=r.getTickValueCoord(B),V=zp(zp(zp(zp({textAnchor:T,transform:"rotate(".concat(90-p,", ").concat(G.x,", ").concat(G.y,")")},M),{},{stroke:"none",fill:v},O),{},{index:N},G),{},{payload:B});return Ne.createElement(Li,Ib({className:Hn("recharts-polar-radius-axis-tick",ate(h)),key:"tick-".concat(B.coordinate)},Tm(r.props,B,N)),t.renderTickItem(h,V,o?o(B.value,N):B.value))});return Ne.createElement(Li,{className:"recharts-polar-radius-axis-ticks"},D)}},{key:"render",value:function(){var r=this.props,n=r.ticks,c=r.axisLine,h=r.tick;return!n||!n.length?null:Ne.createElement(Li,{className:Hn("recharts-polar-radius-axis",this.props.className)},c&&this.renderAxisLine(),h&&this.renderTicks(),_a.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(r,n,c){var h;return Ne.isValidElement(r)?h=Ne.cloneElement(r,n):Pn(r)?h=r(n):h=Ne.createElement(Em,Ib({},n,{className:"recharts-polar-radius-axis-tick-value"}),c),h}}])}(Z.PureComponent);hC(dC,"displayName","PolarRadiusAxis");hC(dC,"axisType","radiusAxis");hC(dC,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function j_(e){"@babel/helpers - typeof";return j_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j_(e)}function Zp(){return Zp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Zp.apply(this,arguments)}function aq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Np(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?aq(Object(r),!0).forEach(function(n){fC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function h6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ste(n.key),n)}}function d6e(e,t,r){return t&&sq(e.prototype,t),r&&sq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function f6e(e,t,r){return t=sA(t),p6e(e,wte()?Reflect.construct(t,r||[],sA(e).constructor):t.apply(e,r))}function p6e(e,t){if(t&&(j_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m6e(e)}function m6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wte=function(){return!!e})()}function sA(e){return sA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sA(e)}function g6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uD(e,t)}function uD(e,t){return uD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},uD(e,t)}function fC(e,t,r){return t=Ste(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ste(e){var t=y6e(e,"string");return j_(t)=="symbol"?t:t+""}function y6e(e,t){if(j_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(j_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var _6e=Math.PI/180,lq=1e-5,pC=function(e){function t(){return h6e(this,t),f6e(this,t,arguments)}return g6e(t,e),d6e(t,[{key:"getTickLineCoord",value:function(r){var n=this.props,c=n.cx,h=n.cy,p=n.radius,o=n.orientation,v=n.tickSize,w=v||8,T=eo(c,h,p,r.coordinate),M=eo(c,h,p+(o==="inner"?-1:1)*w,r.coordinate);return{x1:T.x,y1:T.y,x2:M.x,y2:M.y}}},{key:"getTickTextAnchor",value:function(r){var n=this.props.orientation,c=Math.cos(-r.coordinate*_6e),h;return c>lq?h=n==="outer"?"start":"end":c<-lq?h=n==="outer"?"end":"start":h="middle",h}},{key:"renderAxisLine",value:function(){var r=this.props,n=r.cx,c=r.cy,h=r.radius,p=r.axisLine,o=r.axisLineType,v=Np(Np({},Sn(this.props,!1)),{},{fill:"none"},Sn(p,!1));if(o==="circle")return Ne.createElement(eN,Zp({className:"recharts-polar-angle-axis-line"},v,{cx:n,cy:c,r:h}));var w=this.props.ticks,T=w.map(function(M){return eo(n,c,h,M.coordinate)});return Ne.createElement(j4e,Zp({className:"recharts-polar-angle-axis-line"},v,{points:T}))}},{key:"renderTicks",value:function(){var r=this,n=this.props,c=n.ticks,h=n.tick,p=n.tickLine,o=n.tickFormatter,v=n.stroke,w=Sn(this.props,!1),T=Sn(h,!1),M=Np(Np({},w),{},{fill:"none"},Sn(p,!1)),O=c.map(function(D,B){var N=r.getTickLineCoord(D),G=r.getTickTextAnchor(D),V=Np(Np(Np({textAnchor:G},w),{},{stroke:"none",fill:v},T),{},{index:B,payload:D,x:N.x2,y:N.y2});return Ne.createElement(Li,Zp({className:Hn("recharts-polar-angle-axis-tick",ate(h)),key:"tick-".concat(D.coordinate)},Tm(r.props,D,B)),p&&Ne.createElement("line",Zp({className:"recharts-polar-angle-axis-tick-line"},M,N)),h&&t.renderTickItem(h,V,o?o(D.value,B):D.value))});return Ne.createElement(Li,{className:"recharts-polar-angle-axis-ticks"},O)}},{key:"render",value:function(){var r=this.props,n=r.ticks,c=r.radius,h=r.axisLine;return c<=0||!n||!n.length?null:Ne.createElement(Li,{className:Hn("recharts-polar-angle-axis",this.props.className)},h&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(r,n,c){var h;return Ne.isValidElement(r)?h=Ne.cloneElement(r,n):Pn(r)?h=r(n):h=Ne.createElement(Em,Zp({},n,{className:"recharts-polar-angle-axis-tick-value"}),c),h}}])}(Z.PureComponent);fC(pC,"displayName","PolarAngleAxis");fC(pC,"axisType","angleAxis");fC(pC,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var v6e=EQ,x6e=v6e(Object.getPrototypeOf,Object),b6e=x6e,w6e=Fh,S6e=b6e,T6e=Bh,E6e="[object Object]",A6e=Function.prototype,k6e=Object.prototype,Tte=A6e.toString,C6e=k6e.hasOwnProperty,P6e=Tte.call(Object);function M6e(e){if(!T6e(e)||w6e(e)!=E6e)return!1;var t=S6e(e);if(t===null)return!0;var r=C6e.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Tte.call(r)==P6e}var I6e=M6e;const O6e=ki(I6e);var j6e=Fh,R6e=Bh,D6e="[object Boolean]";function L6e(e){return e===!0||e===!1||R6e(e)&&j6e(e)==D6e}var z6e=L6e;const N6e=ki(z6e);function Ow(e){"@babel/helpers - typeof";return Ow=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ow(e)}function lA(){return lA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lA.apply(this,arguments)}function F6e(e,t){return $6e(e)||V6e(e,t)||U6e(e,t)||B6e()}function B6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function U6e(e,t){if(e){if(typeof e=="string")return cq(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cq(e,t)}}function cq(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function V6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function $6e(e){if(Array.isArray(e))return e}function uq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function hq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uq(Object(r),!0).forEach(function(n){G6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function G6e(e,t,r){return t=q6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q6e(e){var t=H6e(e,"string");return Ow(t)=="symbol"?t:t+""}function H6e(e,t){if(Ow(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ow(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var dq=function(e,t,r,n,c){var h=r-n,p;return p="M ".concat(e,",").concat(t),p+="L ".concat(e+r,",").concat(t),p+="L ".concat(e+r-h/2,",").concat(t+c),p+="L ".concat(e+r-h/2-n,",").concat(t+c),p+="L ".concat(e,",").concat(t," Z"),p},W6e={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Z6e=function(e){var t=hq(hq({},W6e),e),r=Z.useRef(),n=Z.useState(-1),c=F6e(n,2),h=c[0],p=c[1];Z.useEffect(function(){if(r.current&&r.current.getTotalLength)try{var U=r.current.getTotalLength();U&&p(U)}catch{}},[]);var o=t.x,v=t.y,w=t.upperWidth,T=t.lowerWidth,M=t.height,O=t.className,D=t.animationEasing,B=t.animationDuration,N=t.animationBegin,G=t.isUpdateAnimationActive;if(o!==+o||v!==+v||w!==+w||T!==+T||M!==+M||w===0&&T===0||M===0)return null;var V=Hn("recharts-trapezoid",O);return G?Ne.createElement(Dh,{canBegin:h>0,from:{upperWidth:0,lowerWidth:0,height:M,x:o,y:v},to:{upperWidth:w,lowerWidth:T,height:M,x:o,y:v},duration:B,animationEasing:D,isActive:G},function(U){var X=U.upperWidth,Y=U.lowerWidth,ne=U.height,se=U.x,le=U.y;return Ne.createElement(Dh,{canBegin:h>0,from:"0px ".concat(h===-1?1:h,"px"),to:"".concat(h,"px 0px"),attributeName:"strokeDasharray",begin:N,duration:B,easing:D},Ne.createElement("path",lA({},Sn(t,!0),{className:V,d:dq(se,le,X,Y,ne),ref:r})))}):Ne.createElement("g",null,Ne.createElement("path",lA({},Sn(t,!0),{className:V,d:dq(o,v,w,T,M)})))},K6e=["option","shapeType","propTransformer","activeClassName","isActive"];function jw(e){"@babel/helpers - typeof";return jw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jw(e)}function X6e(e,t){if(e==null)return{};var r=Y6e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Y6e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function fq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function cA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fq(Object(r),!0).forEach(function(n){J6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function J6e(e,t,r){return t=Q6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q6e(e){var t=eUe(e,"string");return jw(t)=="symbol"?t:t+""}function eUe(e,t){if(jw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function tUe(e,t){return cA(cA({},t),e)}function rUe(e,t){return e==="symbols"}function pq(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ne.createElement(Qz,r);case"trapezoid":return Ne.createElement(Z6e,r);case"sector":return Ne.createElement(cte,r);case"symbols":if(rUe(t))return Ne.createElement(vz,r);break;default:return null}}function nUe(e){return Z.isValidElement(e)?e.props:e}function Ete(e){var t=e.option,r=e.shapeType,n=e.propTransformer,c=n===void 0?tUe:n,h=e.activeClassName,p=h===void 0?"recharts-active-shape":h,o=e.isActive,v=X6e(e,K6e),w;if(Z.isValidElement(t))w=Z.cloneElement(t,cA(cA({},v),nUe(t)));else if(Pn(t))w=t(v);else if(O6e(t)&&!N6e(t)){var T=c(t,v);w=Ne.createElement(pq,{shapeType:r,elementProps:T})}else{var M=v;w=Ne.createElement(pq,{shapeType:r,elementProps:M})}return o?Ne.createElement(Li,{className:p},w):w}function mC(e,t){return t!=null&&"trapezoids"in e.props}function gC(e,t){return t!=null&&"sectors"in e.props}function Rw(e,t){return t!=null&&"points"in e.props}function iUe(e,t){var r,n,c=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,h=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return c&&h}function oUe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function aUe(e,t){var r=e.x===t.x,n=e.y===t.y,c=e.z===t.z;return r&&n&&c}function sUe(e,t){var r;return mC(e,t)?r=iUe:gC(e,t)?r=oUe:Rw(e,t)&&(r=aUe),r}function lUe(e,t){var r;return mC(e,t)?r="trapezoids":gC(e,t)?r="sectors":Rw(e,t)&&(r="points"),r}function cUe(e,t){if(mC(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(gC(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return Rw(e,t)?t.payload:{}}function uUe(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,c=lUe(r,t),h=cUe(r,t),p=n.filter(function(v,w){var T=sC(h,v),M=r.props[c].filter(function(B){var N=sUe(r,t);return N(B,t)}),O=r.props[c].indexOf(M[M.length-1]),D=w===O;return T&&D}),o=n.indexOf(p[p.length-1]);return o}var j2;function R_(e){"@babel/helpers - typeof";return R_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R_(e)}function $y(){return $y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$y.apply(this,arguments)}function mq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Ji(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mq(Object(r),!0).forEach(function(n){Il(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kte(n.key),n)}}function dUe(e,t,r){return t&&gq(e.prototype,t),r&&gq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function fUe(e,t,r){return t=uA(t),pUe(e,Ate()?Reflect.construct(t,r||[],uA(e).constructor):t.apply(e,r))}function pUe(e,t){if(t&&(R_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mUe(e)}function mUe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ate(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ate=function(){return!!e})()}function uA(e){return uA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uA(e)}function gUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hD(e,t)}function hD(e,t){return hD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},hD(e,t)}function Il(e,t,r){return t=kte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kte(e){var t=yUe(e,"string");return R_(t)=="symbol"?t:t+""}function yUe(e,t){if(R_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(R_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Vh=function(e){function t(r){var n;return hUe(this,t),n=fUe(this,t,[r]),Il(n,"pieRef",null),Il(n,"sectorRefs",[]),Il(n,"id",a1("recharts-pie-")),Il(n,"handleAnimationEnd",function(){var c=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Pn(c)&&c()}),Il(n,"handleAnimationStart",function(){var c=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Pn(c)&&c()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return gUe(t,e),dUe(t,[{key:"isActiveIndex",value:function(r){var n=this.props.activeIndex;return Array.isArray(n)?n.indexOf(r)!==-1:r===n}},{key:"hasActiveIndex",value:function(){var r=this.props.activeIndex;return Array.isArray(r)?r.length!==0:r||r===0}},{key:"renderLabels",value:function(r){var n=this.props.isAnimationActive;if(n&&!this.state.isAnimationFinished)return null;var c=this.props,h=c.label,p=c.labelLine,o=c.dataKey,v=c.valueKey,w=Sn(this.props,!1),T=Sn(h,!1),M=Sn(p,!1),O=h&&h.offsetRadius||20,D=r.map(function(B,N){var G=(B.startAngle+B.endAngle)/2,V=eo(B.cx,B.cy,B.outerRadius+O,G),U=Ji(Ji(Ji(Ji({},w),B),{},{stroke:"none"},T),{},{index:N,textAnchor:t.getTextAnchor(V.x,B.cx)},V),X=Ji(Ji(Ji(Ji({},w),B),{},{fill:"none",stroke:B.fill},M),{},{index:N,points:[eo(B.cx,B.cy,B.outerRadius,G),V]}),Y=o;return ni(o)&&ni(v)?Y="value":ni(o)&&(Y=v),Ne.createElement(Li,{key:"label-".concat(B.startAngle,"-").concat(B.endAngle,"-").concat(B.midAngle,"-").concat(N)},p&&t.renderLabelLineItem(p,X,"line"),t.renderLabelItem(h,U,Ja(B,Y)))});return Ne.createElement(Li,{className:"recharts-pie-labels"},D)}},{key:"renderSectorsStatically",value:function(r){var n=this,c=this.props,h=c.activeShape,p=c.blendStroke,o=c.inactiveShape;return r.map(function(v,w){if(v?.startAngle===0&&v?.endAngle===0&&r.length!==1)return null;var T=n.isActiveIndex(w),M=o&&n.hasActiveIndex()?o:null,O=T?h:M,D=Ji(Ji({},v),{},{stroke:p?v.fill:v.stroke,tabIndex:-1});return Ne.createElement(Li,$y({ref:function(B){B&&!n.sectorRefs.includes(B)&&n.sectorRefs.push(B)},tabIndex:-1,className:"recharts-pie-sector"},Tm(n.props,v,w),{key:"sector-".concat(v?.startAngle,"-").concat(v?.endAngle,"-").concat(v.midAngle,"-").concat(w)}),Ne.createElement(Ete,$y({option:O,isActive:T,shapeType:"sector"},D)))})}},{key:"renderSectorsWithAnimation",value:function(){var r=this,n=this.props,c=n.sectors,h=n.isAnimationActive,p=n.animationBegin,o=n.animationDuration,v=n.animationEasing,w=n.animationId,T=this.state,M=T.prevSectors,O=T.prevIsAnimationActive;return Ne.createElement(Dh,{begin:p,duration:o,isActive:h,easing:v,from:{t:0},to:{t:1},key:"pie-".concat(w,"-").concat(O),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(D){var B=D.t,N=[],G=c&&c[0],V=G.startAngle;return c.forEach(function(U,X){var Y=M&&M[X],ne=X>0?fl(U,"paddingAngle",0):0;if(Y){var se=Hd(Y.endAngle-Y.startAngle,U.endAngle-U.startAngle),le=Ji(Ji({},U),{},{startAngle:V+ne,endAngle:V+se(B)+ne});N.push(le),V=le.endAngle}else{var ge=U.endAngle,je=U.startAngle,ze=Hd(0,ge-je),Ce=ze(B),Ke=Ji(Ji({},U),{},{startAngle:V+ne,endAngle:V+Ce+ne});N.push(Ke),V=Ke.endAngle}}),Ne.createElement(Li,null,r.renderSectorsStatically(N))})}},{key:"attachKeyboardHandlers",value:function(r){var n=this;r.onkeydown=function(c){if(!c.altKey)switch(c.key){case"ArrowLeft":{var h=++n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[h].focus(),n.setState({sectorToFocus:h});break}case"ArrowRight":{var p=--n.state.sectorToFocus<0?n.sectorRefs.length-1:n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[p].focus(),n.setState({sectorToFocus:p});break}case"Escape":{n.sectorRefs[n.state.sectorToFocus].blur(),n.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var r=this.props,n=r.sectors,c=r.isAnimationActive,h=this.state.prevSectors;return c&&n&&n.length&&(!h||!sC(h,n))?this.renderSectorsWithAnimation():this.renderSectorsStatically(n)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var r=this,n=this.props,c=n.hide,h=n.sectors,p=n.className,o=n.label,v=n.cx,w=n.cy,T=n.innerRadius,M=n.outerRadius,O=n.isAnimationActive,D=this.state.isAnimationFinished;if(c||!h||!h.length||!fr(v)||!fr(w)||!fr(T)||!fr(M))return null;var B=Hn("recharts-pie",p);return Ne.createElement(Li,{tabIndex:this.props.rootTabIndex,className:B,ref:function(N){r.pieRef=N}},this.renderSectors(),o&&this.renderLabels(h),_a.renderCallByParent(this.props,null,!1),(!O||D)&&ff.renderCallByParent(this.props,h,!1))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return n.prevIsAnimationActive!==r.isAnimationActive?{prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,curSectors:r.sectors,prevSectors:[],isAnimationFinished:!0}:r.isAnimationActive&&r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curSectors:r.sectors,prevSectors:n.curSectors,isAnimationFinished:!0}:r.sectors!==n.curSectors?{curSectors:r.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(r,n){return r>n?"start":r<n?"end":"middle"}},{key:"renderLabelLineItem",value:function(r,n,c){if(Ne.isValidElement(r))return Ne.cloneElement(r,n);if(Pn(r))return r(n);var h=Hn("recharts-pie-label-line",typeof r!="boolean"?r.className:"");return Ne.createElement(XR,$y({},n,{key:c,type:"linear",className:h}))}},{key:"renderLabelItem",value:function(r,n,c){if(Ne.isValidElement(r))return Ne.cloneElement(r,n);var h=c;if(Pn(r)&&(h=r(n),Ne.isValidElement(h)))return h;var p=Hn("recharts-pie-label-text",typeof r!="boolean"&&!Pn(r)?r.className:"");return Ne.createElement(Em,$y({},n,{alignmentBaseline:"middle",className:p}),h)}}])}(Z.PureComponent);j2=Vh;Il(Vh,"displayName","Pie");Il(Vh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!gv.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Il(Vh,"parseDeltaAngle",function(e,t){var r=ys(t-e),n=Math.min(Math.abs(t-e),360);return r*n});Il(Vh,"getRealPieData",function(e){var t=e.data,r=e.children,n=Sn(e,!1),c=Ll(r,l1);return t&&t.length?t.map(function(h,p){return Ji(Ji(Ji({payload:h},n),h),c&&c[p]&&c[p].props)}):c&&c.length?c.map(function(h){return Ji(Ji({},n),h.props)}):[]});Il(Vh,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,c=t.width,h=t.height,p=ote(c,h),o=n+_s(e.cx,c,c/2),v=r+_s(e.cy,h,h/2),w=_s(e.innerRadius,p,0),T=_s(e.outerRadius,p,p*.8),M=e.maxRadius||Math.sqrt(c*c+h*h)/2;return{cx:o,cy:v,innerRadius:w,outerRadius:T,maxRadius:M}});Il(Vh,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Ji(Ji({},t.type.defaultProps),t.props):t.props,c=j2.getRealPieData(n);if(!c||!c.length)return null;var h=n.cornerRadius,p=n.startAngle,o=n.endAngle,v=n.paddingAngle,w=n.dataKey,T=n.nameKey,M=n.valueKey,O=n.tooltipType,D=Math.abs(n.minAngle),B=j2.parseCoordinateOfPie(n,r),N=j2.parseDeltaAngle(p,o),G=Math.abs(N),V=w;ni(w)&&ni(M)?(_c(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),V="value"):ni(w)&&(_c(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),V=M);var U=c.filter(function(ge){return Ja(ge,V,0)!==0}).length,X=(G>=360?U:U-1)*v,Y=G-U*D-X,ne=c.reduce(function(ge,je){var ze=Ja(je,V,0);return ge+(fr(ze)?ze:0)},0),se;if(ne>0){var le;se=c.map(function(ge,je){var ze=Ja(ge,V,0),Ce=Ja(ge,T,je),Ke=(fr(ze)?ze:0)/ne,Ye;je?Ye=le.endAngle+ys(N)*v*(ze!==0?1:0):Ye=p;var Oe=Ye+ys(N)*((ze!==0?D:0)+Ke*Y),tt=(Ye+Oe)/2,He=(B.innerRadius+B.outerRadius)/2,lt=[{name:Ce,value:ze,payload:ge,dataKey:V,type:O}],rt=eo(B.cx,B.cy,He,tt);return le=Ji(Ji(Ji({percent:Ke,cornerRadius:h,name:Ce,tooltipPayload:lt,midAngle:tt,middleRadius:He,tooltipPosition:rt},ge),B),{},{value:Ja(ge,V),startAngle:Ye,endAngle:Oe,payload:ge,paddingAngle:ys(N)*v}),le})}return Ji(Ji({},B),{},{sectors:se,data:c})});var _Ue=Math.ceil,vUe=Math.max;function xUe(e,t,r,n){for(var c=-1,h=vUe(_Ue((t-e)/(r||1)),0),p=Array(h);h--;)p[n?h:++c]=e,e+=r;return p}var bUe=xUe,wUe=GQ,yq=1/0,SUe=17976931348623157e292;function TUe(e){if(!e)return e===0?e:0;if(e=wUe(e),e===yq||e===-yq){var t=e<0?-1:1;return t*SUe}return e===e?e:0}var Cte=TUe,EUe=bUe,AUe=Yk,XI=Cte;function kUe(e){return function(t,r,n){return n&&typeof n!="number"&&AUe(t,r,n)&&(r=n=void 0),t=XI(t),r===void 0?(r=t,t=0):r=XI(r),n=n===void 0?t<r?1:-1:XI(n),EUe(t,r,n,e)}}var CUe=kUe,PUe=CUe,MUe=PUe(),IUe=MUe;const hA=ki(IUe);function Dw(e){"@babel/helpers - typeof";return Dw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dw(e)}function _q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function vq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_q(Object(r),!0).forEach(function(n){Pte(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_q(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pte(e,t,r){return t=OUe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OUe(e){var t=jUe(e,"string");return Dw(t)=="symbol"?t:t+""}function jUe(e,t){if(Dw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Dw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var RUe=["Webkit","Moz","O","ms"],DUe=function(e,t){var r=e.replace(/(\w)/,function(c){return c.toUpperCase()}),n=RUe.reduce(function(c,h){return vq(vq({},c),{},Pte({},h+r,t))},{});return n[e]=t,n};function D_(e){"@babel/helpers - typeof";return D_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D_(e)}function dA(){return dA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dA.apply(this,arguments)}function xq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function YI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xq(Object(r),!0).forEach(function(n){il(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ite(n.key),n)}}function zUe(e,t,r){return t&&bq(e.prototype,t),r&&bq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function NUe(e,t,r){return t=fA(t),FUe(e,Mte()?Reflect.construct(t,r||[],fA(e).constructor):t.apply(e,r))}function FUe(e,t){if(t&&(D_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BUe(e)}function BUe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Mte=function(){return!!e})()}function fA(e){return fA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fA(e)}function UUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dD(e,t)}function dD(e,t){return dD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},dD(e,t)}function il(e,t,r){return t=Ite(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ite(e){var t=VUe(e,"string");return D_(t)=="symbol"?t:t+""}function VUe(e,t){if(D_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(D_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var $Ue=function(e){var t=e.data,r=e.startIndex,n=e.endIndex,c=e.x,h=e.width,p=e.travellerWidth;if(!t||!t.length)return{};var o=t.length,v=Cb().domain(hA(0,o)).range([c,c+h-p]),w=v.domain().map(function(T){return v(T)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:v(r),endX:v(n),scale:v,scaleValues:w}},wq=function(e){return e.changedTouches&&!!e.changedTouches.length},L_=function(e){function t(r){var n;return LUe(this,t),n=NUe(this,t,[r]),il(n,"handleDrag",function(c){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(c):n.state.isSlideMoving&&n.handleSlideDrag(c)}),il(n,"handleTouchMove",function(c){c.changedTouches!=null&&c.changedTouches.length>0&&n.handleDrag(c.changedTouches[0])}),il(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var c=n.props,h=c.endIndex,p=c.onDragEnd,o=c.startIndex;p?.({endIndex:h,startIndex:o})}),n.detachDragEndListener()}),il(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),il(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),il(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),il(n,"handleSlideDragStart",function(c){var h=wq(c)?c.changedTouches[0]:c;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:h.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return UUe(t,e),zUe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(r){var n=r.startX,c=r.endX,h=this.state.scaleValues,p=this.props,o=p.gap,v=p.data,w=v.length-1,T=Math.min(n,c),M=Math.max(n,c),O=t.getIndexInRange(h,T),D=t.getIndexInRange(h,M);return{startIndex:O-O%o,endIndex:D===w?w:D-D%o}}},{key:"getTextOfTick",value:function(r){var n=this.props,c=n.data,h=n.tickFormatter,p=n.dataKey,o=Ja(c[r],p,r);return Pn(h)?h(o,r):o}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(r){var n=this.state,c=n.slideMoveStartX,h=n.startX,p=n.endX,o=this.props,v=o.x,w=o.width,T=o.travellerWidth,M=o.startIndex,O=o.endIndex,D=o.onChange,B=r.pageX-c;B>0?B=Math.min(B,v+w-T-p,v+w-T-h):B<0&&(B=Math.max(B,v-h,v-p));var N=this.getIndex({startX:h+B,endX:p+B});(N.startIndex!==M||N.endIndex!==O)&&D&&D(N),this.setState({startX:h+B,endX:p+B,slideMoveStartX:r.pageX})}},{key:"handleTravellerDragStart",value:function(r,n){var c=wq(n)?n.changedTouches[0]:n;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:r,brushMoveStartX:c.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(r){var n=this.state,c=n.brushMoveStartX,h=n.movingTravellerId,p=n.endX,o=n.startX,v=this.state[h],w=this.props,T=w.x,M=w.width,O=w.travellerWidth,D=w.onChange,B=w.gap,N=w.data,G={startX:this.state.startX,endX:this.state.endX},V=r.pageX-c;V>0?V=Math.min(V,T+M-O-v):V<0&&(V=Math.max(V,T-v)),G[h]=v+V;var U=this.getIndex(G),X=U.startIndex,Y=U.endIndex,ne=function(){var se=N.length-1;return h==="startX"&&(p>o?X%B===0:Y%B===0)||p<o&&Y===se||h==="endX"&&(p>o?Y%B===0:X%B===0)||p>o&&Y===se};this.setState(il(il({},h,v+V),"brushMoveStartX",r.pageX),function(){D&&ne()&&D(U)})}},{key:"handleTravellerMoveKeyboard",value:function(r,n){var c=this,h=this.state,p=h.scaleValues,o=h.startX,v=h.endX,w=this.state[n],T=p.indexOf(w);if(T!==-1){var M=T+r;if(!(M===-1||M>=p.length)){var O=p[M];n==="startX"&&O>=v||n==="endX"&&O<=o||this.setState(il({},n,O),function(){c.props.onChange(c.getIndex({startX:c.state.startX,endX:c.state.endX}))})}}}},{key:"renderBackground",value:function(){var r=this.props,n=r.x,c=r.y,h=r.width,p=r.height,o=r.fill,v=r.stroke;return Ne.createElement("rect",{stroke:v,fill:o,x:n,y:c,width:h,height:p})}},{key:"renderPanorama",value:function(){var r=this.props,n=r.x,c=r.y,h=r.width,p=r.height,o=r.data,v=r.children,w=r.padding,T=Z.Children.only(v);return T?Ne.cloneElement(T,{x:n,y:c,width:h,height:p,margin:w,compact:!0,data:o}):null}},{key:"renderTravellerLayer",value:function(r,n){var c,h,p=this,o=this.props,v=o.y,w=o.travellerWidth,T=o.height,M=o.traveller,O=o.ariaLabel,D=o.data,B=o.startIndex,N=o.endIndex,G=Math.max(r,this.props.x),V=YI(YI({},Sn(this.props,!1)),{},{x:G,y:v,width:w,height:T}),U=O||"Min value: ".concat((c=D[B])===null||c===void 0?void 0:c.name,", Max value: ").concat((h=D[N])===null||h===void 0?void 0:h.name);return Ne.createElement(Li,{tabIndex:0,role:"slider","aria-label":U,"aria-valuenow":r,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[n],onTouchStart:this.travellerDragStartHandlers[n],onKeyDown:function(X){["ArrowLeft","ArrowRight"].includes(X.key)&&(X.preventDefault(),X.stopPropagation(),p.handleTravellerMoveKeyboard(X.key==="ArrowRight"?1:-1,n))},onFocus:function(){p.setState({isTravellerFocused:!0})},onBlur:function(){p.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(M,V))}},{key:"renderSlide",value:function(r,n){var c=this.props,h=c.y,p=c.height,o=c.stroke,v=c.travellerWidth,w=Math.min(r,n)+v,T=Math.max(Math.abs(n-r)-v,0);return Ne.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:o,fillOpacity:.2,x:w,y:h,width:T,height:p})}},{key:"renderText",value:function(){var r=this.props,n=r.startIndex,c=r.endIndex,h=r.y,p=r.height,o=r.travellerWidth,v=r.stroke,w=this.state,T=w.startX,M=w.endX,O=5,D={pointerEvents:"none",fill:v};return Ne.createElement(Li,{className:"recharts-brush-texts"},Ne.createElement(Em,dA({textAnchor:"end",verticalAnchor:"middle",x:Math.min(T,M)-O,y:h+p/2},D),this.getTextOfTick(n)),Ne.createElement(Em,dA({textAnchor:"start",verticalAnchor:"middle",x:Math.max(T,M)+o+O,y:h+p/2},D),this.getTextOfTick(c)))}},{key:"render",value:function(){var r=this.props,n=r.data,c=r.className,h=r.children,p=r.x,o=r.y,v=r.width,w=r.height,T=r.alwaysShowText,M=this.state,O=M.startX,D=M.endX,B=M.isTextActive,N=M.isSlideMoving,G=M.isTravellerMoving,V=M.isTravellerFocused;if(!n||!n.length||!fr(p)||!fr(o)||!fr(v)||!fr(w)||v<=0||w<=0)return null;var U=Hn("recharts-brush",c),X=Ne.Children.count(h)===1,Y=DUe("userSelect","none");return Ne.createElement(Li,{className:U,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:Y},this.renderBackground(),X&&this.renderPanorama(),this.renderSlide(O,D),this.renderTravellerLayer(O,"startX"),this.renderTravellerLayer(D,"endX"),(B||N||G||V||T)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(r){var n=r.x,c=r.y,h=r.width,p=r.height,o=r.stroke,v=Math.floor(c+p/2)-1;return Ne.createElement(Ne.Fragment,null,Ne.createElement("rect",{x:n,y:c,width:h,height:p,fill:o,stroke:"none"}),Ne.createElement("line",{x1:n+1,y1:v,x2:n+h-1,y2:v,fill:"none",stroke:"#fff"}),Ne.createElement("line",{x1:n+1,y1:v+2,x2:n+h-1,y2:v+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(r,n){var c;return Ne.isValidElement(r)?c=Ne.cloneElement(r,n):Pn(r)?c=r(n):c=t.renderDefaultTraveller(n),c}},{key:"getDerivedStateFromProps",value:function(r,n){var c=r.data,h=r.width,p=r.x,o=r.travellerWidth,v=r.updateId,w=r.startIndex,T=r.endIndex;if(c!==n.prevData||v!==n.prevUpdateId)return YI({prevData:c,prevTravellerWidth:o,prevUpdateId:v,prevX:p,prevWidth:h},c&&c.length?$Ue({data:c,width:h,x:p,travellerWidth:o,startIndex:w,endIndex:T}):{scale:null,scaleValues:null});if(n.scale&&(h!==n.prevWidth||p!==n.prevX||o!==n.prevTravellerWidth)){n.scale.range([p,p+h-o]);var M=n.scale.domain().map(function(O){return n.scale(O)});return{prevData:c,prevTravellerWidth:o,prevUpdateId:v,prevX:p,prevWidth:h,startX:n.scale(r.startIndex),endX:n.scale(r.endIndex),scaleValues:M}}return null}},{key:"getIndexInRange",value:function(r,n){for(var c=r.length,h=0,p=c-1;p-h>1;){var o=Math.floor((h+p)/2);r[o]>n?p=o:h=o}return n>=r[p]?p:h}}])}(Z.PureComponent);il(L_,"displayName","Brush");il(L_,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var GUe=Az;function qUe(e,t){var r;return GUe(e,function(n,c,h){return r=t(n,c,h),!r}),!!r}var HUe=qUe,WUe=yQ,ZUe=Ou,KUe=HUe,XUe=Ks,YUe=Yk;function JUe(e,t,r){var n=XUe(e)?WUe:KUe;return r&&YUe(e,t,r)&&(t=void 0),n(e,ZUe(t))}var QUe=JUe;const eVe=ki(QUe);var Au=function(e,t){var r=e.alwaysShow,n=e.ifOverflow;return r&&(n="extendDomain"),n===t},Sq=FQ;function tVe(e,t,r){t=="__proto__"&&Sq?Sq(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var rVe=tVe,nVe=rVe,iVe=zQ,oVe=Ou;function aVe(e,t){var r={};return t=oVe(t),iVe(e,function(n,c,h){nVe(r,c,t(n,c,h))}),r}var sVe=aVe;const lVe=ki(sVe);function cVe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var uVe=cVe,hVe=Az;function dVe(e,t){var r=!0;return hVe(e,function(n,c,h){return r=!!t(n,c,h),r}),r}var fVe=dVe,pVe=uVe,mVe=fVe,gVe=Ou,yVe=Ks,_Ve=Yk;function vVe(e,t,r){var n=yVe(e)?pVe:mVe;return r&&_Ve(e,t,r)&&(t=void 0),n(e,gVe(t))}var xVe=vVe;const Ote=ki(xVe);var bVe=["x","y"];function Lw(e){"@babel/helpers - typeof";return Lw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lw(e)}function fD(){return fD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fD.apply(this,arguments)}function Tq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Xx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Tq(Object(r),!0).forEach(function(n){wVe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wVe(e,t,r){return t=SVe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SVe(e){var t=TVe(e,"string");return Lw(t)=="symbol"?t:t+""}function TVe(e,t){if(Lw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Lw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function EVe(e,t){if(e==null)return{};var r=AVe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function AVe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function kVe(e,t){var r=e.x,n=e.y,c=EVe(e,bVe),h="".concat(r),p=parseInt(h,10),o="".concat(n),v=parseInt(o,10),w="".concat(t.height||c.height),T=parseInt(w,10),M="".concat(t.width||c.width),O=parseInt(M,10);return Xx(Xx(Xx(Xx(Xx({},t),c),p?{x:p}:{}),v?{y:v}:{}),{},{height:T,width:O,name:t.name,radius:t.radius})}function Eq(e){return Ne.createElement(Ete,fD({shapeType:"rectangle",propTransformer:kVe,activeClassName:"recharts-active-bar"},e))}var CVe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(r,n){if(typeof e=="number")return e;var c=fr(r)||H2e(r);return c?e(r,n):(c||km(),t)}},PVe=["value","background"],jte;function z_(e){"@babel/helpers - typeof";return z_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z_(e)}function MVe(e,t){if(e==null)return{};var r=IVe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function IVe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function pA(){return pA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pA.apply(this,arguments)}function Aq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Fo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Aq(Object(r),!0).forEach(function(n){tf(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Aq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OVe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Dte(n.key),n)}}function jVe(e,t,r){return t&&kq(e.prototype,t),r&&kq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function RVe(e,t,r){return t=mA(t),DVe(e,Rte()?Reflect.construct(t,r||[],mA(e).constructor):t.apply(e,r))}function DVe(e,t){if(t&&(z_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LVe(e)}function LVe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Rte=function(){return!!e})()}function mA(e){return mA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mA(e)}function zVe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pD(e,t)}function pD(e,t){return pD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},pD(e,t)}function tf(e,t,r){return t=Dte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dte(e){var t=NVe(e,"string");return z_(t)=="symbol"?t:t+""}function NVe(e,t){if(z_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(z_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Lh=function(e){function t(){var r;OVe(this,t);for(var n=arguments.length,c=new Array(n),h=0;h<n;h++)c[h]=arguments[h];return r=RVe(this,t,[].concat(c)),tf(r,"state",{isAnimationFinished:!1}),tf(r,"id",a1("recharts-bar-")),tf(r,"handleAnimationEnd",function(){var p=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),p&&p()}),tf(r,"handleAnimationStart",function(){var p=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),p&&p()}),r}return zVe(t,e),jVe(t,[{key:"renderRectanglesStatically",value:function(r){var n=this,c=this.props,h=c.shape,p=c.dataKey,o=c.activeIndex,v=c.activeBar,w=Sn(this.props,!1);return r&&r.map(function(T,M){var O=M===o,D=O?v:h,B=Fo(Fo(Fo({},w),T),{},{isActive:O,option:D,index:M,dataKey:p,onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd});return Ne.createElement(Li,pA({className:"recharts-bar-rectangle"},Tm(n.props,T,M),{key:"rectangle-".concat(T?.x,"-").concat(T?.y,"-").concat(T?.value,"-").concat(M)}),Ne.createElement(Eq,B))})}},{key:"renderRectanglesWithAnimation",value:function(){var r=this,n=this.props,c=n.data,h=n.layout,p=n.isAnimationActive,o=n.animationBegin,v=n.animationDuration,w=n.animationEasing,T=n.animationId,M=this.state.prevData;return Ne.createElement(Dh,{begin:o,duration:v,isActive:p,easing:w,from:{t:0},to:{t:1},key:"bar-".concat(T),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(O){var D=O.t,B=c.map(function(N,G){var V=M&&M[G];if(V){var U=Hd(V.x,N.x),X=Hd(V.y,N.y),Y=Hd(V.width,N.width),ne=Hd(V.height,N.height);return Fo(Fo({},N),{},{x:U(D),y:X(D),width:Y(D),height:ne(D)})}if(h==="horizontal"){var se=Hd(0,N.height),le=se(D);return Fo(Fo({},N),{},{y:N.y+N.height-le,height:le})}var ge=Hd(0,N.width),je=ge(D);return Fo(Fo({},N),{},{width:je})});return Ne.createElement(Li,null,r.renderRectanglesStatically(B))})}},{key:"renderRectangles",value:function(){var r=this.props,n=r.data,c=r.isAnimationActive,h=this.state.prevData;return c&&n&&n.length&&(!h||!sC(h,n))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(n)}},{key:"renderBackground",value:function(){var r=this,n=this.props,c=n.data,h=n.dataKey,p=n.activeIndex,o=Sn(this.props.background,!1);return c.map(function(v,w){v.value;var T=v.background,M=MVe(v,PVe);if(!T)return null;var O=Fo(Fo(Fo(Fo(Fo({},M),{},{fill:"#eee"},T),o),Tm(r.props,v,w)),{},{onAnimationStart:r.handleAnimationStart,onAnimationEnd:r.handleAnimationEnd,dataKey:h,index:w,className:"recharts-bar-background-rectangle"});return Ne.createElement(Eq,pA({key:"background-bar-".concat(w),option:r.props.background,isActive:w===p},O))})}},{key:"renderErrorBar",value:function(r,n){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var c=this.props,h=c.data,p=c.xAxis,o=c.yAxis,v=c.layout,w=c.children,T=Ll(w,uC);if(!T)return null;var M=v==="vertical"?h[0].height/2:h[0].width/2,O=function(B,N){var G=Array.isArray(B.value)?B.value[1]:B.value;return{x:B.x,y:B.y,value:G,errorVal:Ja(B,N)}},D={clipPath:r?"url(#clipPath-".concat(n,")"):null};return Ne.createElement(Li,D,T.map(function(B){return Ne.cloneElement(B,{key:"error-bar-".concat(n,"-").concat(B.props.dataKey),data:h,xAxis:p,yAxis:o,layout:v,offset:M,dataPointFormatter:O})}))}},{key:"render",value:function(){var r=this.props,n=r.hide,c=r.data,h=r.className,p=r.xAxis,o=r.yAxis,v=r.left,w=r.top,T=r.width,M=r.height,O=r.isAnimationActive,D=r.background,B=r.id;if(n||!c||!c.length)return null;var N=this.state.isAnimationFinished,G=Hn("recharts-bar",h),V=p&&p.allowDataOverflow,U=o&&o.allowDataOverflow,X=V||U,Y=ni(B)?this.id:B;return Ne.createElement(Li,{className:G},V||U?Ne.createElement("defs",null,Ne.createElement("clipPath",{id:"clipPath-".concat(Y)},Ne.createElement("rect",{x:V?v:v-T/2,y:U?w:w-M/2,width:V?T:T*2,height:U?M:M*2}))):null,Ne.createElement(Li,{className:"recharts-bar-rectangles",clipPath:X?"url(#clipPath-".concat(Y,")"):null},D?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(X,Y),(!O||N)&&ff.renderCallByParent(this.props,c))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curData:r.data,prevData:n.curData}:r.data!==n.curData?{curData:r.data}:null}}])}(Z.PureComponent);jte=Lh;tf(Lh,"displayName","Bar");tf(Lh,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!gv.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});tf(Lh,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,c=e.bandSize,h=e.xAxis,p=e.yAxis,o=e.xAxisTicks,v=e.yAxisTicks,w=e.stackedData,T=e.dataStartIndex,M=e.displayedData,O=e.offset,D=_Fe(n,r);if(!D)return null;var B=t.layout,N=r.type.defaultProps,G=N!==void 0?Fo(Fo({},N),r.props):r.props,V=G.dataKey,U=G.children,X=G.minPointSize,Y=B==="horizontal"?p:h,ne=w?Y.scale.domain():null,se=EFe({numericAxis:Y}),le=Ll(U,l1),ge=M.map(function(je,ze){var Ce,Ke,Ye,Oe,tt,He;w?Ce=vFe(w[T+ze],ne):(Ce=Ja(je,V),Array.isArray(Ce)||(Ce=[se,Ce]));var lt=CVe(X,jte.defaultProps.minPointSize)(Ce[1],ze);if(B==="horizontal"){var rt,ht=[p.scale(Ce[0]),p.scale(Ce[1])],vt=ht[0],mt=ht[1];Ke=gG({axis:h,ticks:o,bandSize:c,offset:D.offset,entry:je,index:ze}),Ye=(rt=mt??vt)!==null&&rt!==void 0?rt:void 0,Oe=D.size;var ct=vt-mt;if(tt=Number.isNaN(ct)?0:ct,He={x:Ke,y:p.y,width:Oe,height:p.height},Math.abs(lt)>0&&Math.abs(tt)<Math.abs(lt)){var Vt=ys(tt||lt)*(Math.abs(lt)-Math.abs(tt));Ye-=Vt,tt+=Vt}}else{var xr=[h.scale(Ce[0]),h.scale(Ce[1])],tn=xr[0],Er=xr[1];if(Ke=tn,Ye=gG({axis:p,ticks:v,bandSize:c,offset:D.offset,entry:je,index:ze}),Oe=Er-tn,tt=D.size,He={x:h.x,y:Ye,width:h.width,height:tt},Math.abs(lt)>0&&Math.abs(Oe)<Math.abs(lt)){var Ft=ys(Oe||lt)*(Math.abs(lt)-Math.abs(Oe));Oe+=Ft}}return Fo(Fo(Fo({},je),{},{x:Ke,y:Ye,width:Oe,height:tt,value:w?Ce:Ce[1],payload:je,background:He},le&&le[ze]&&le[ze].props),{},{tooltipPayload:[nte(r,je)],tooltipPosition:{x:Ke+Oe/2,y:Ye+tt/2}})});return Fo({data:ge,layout:B},O)});function zw(e){"@babel/helpers - typeof";return zw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zw(e)}function FVe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Lte(n.key),n)}}function BVe(e,t,r){return t&&Cq(e.prototype,t),r&&Cq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function fc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Pq(Object(r),!0).forEach(function(n){yC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yC(e,t,r){return t=Lte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Lte(e){var t=UVe(e,"string");return zw(t)=="symbol"?t:t+""}function UVe(e,t){if(zw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(zw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var VVe=function(e,t,r,n,c){var h=e.width,p=e.height,o=e.layout,v=e.children,w=Object.keys(t),T={left:r.left,leftMirror:r.left,right:h-r.right,rightMirror:h-r.right,top:r.top,topMirror:r.top,bottom:p-r.bottom,bottomMirror:p-r.bottom},M=!!al(v,Lh);return w.reduce(function(O,D){var B=t[D],N=B.orientation,G=B.domain,V=B.padding,U=V===void 0?{}:V,X=B.mirror,Y=B.reversed,ne="".concat(N).concat(X?"Mirror":""),se,le,ge,je,ze;if(B.type==="number"&&(B.padding==="gap"||B.padding==="no-gap")){var Ce=G[1]-G[0],Ke=1/0,Ye=B.categoricalDomain.sort(K2e);if(Ye.forEach(function(Vt,xr){xr>0&&(Ke=Math.min((Vt||0)-(Ye[xr-1]||0),Ke))}),Number.isFinite(Ke)){var Oe=Ke/Ce,tt=B.layout==="vertical"?r.height:r.width;if(B.padding==="gap"&&(se=Oe*tt/2),B.padding==="no-gap"){var He=_s(e.barCategoryGap,Oe*tt),lt=Oe*tt/2;se=lt-He-(lt-He)/tt*He}}}n==="xAxis"?le=[r.left+(U.left||0)+(se||0),r.left+r.width-(U.right||0)-(se||0)]:n==="yAxis"?le=o==="horizontal"?[r.top+r.height-(U.bottom||0),r.top+(U.top||0)]:[r.top+(U.top||0)+(se||0),r.top+r.height-(U.bottom||0)-(se||0)]:le=B.range,Y&&(le=[le[1],le[0]]);var rt=Qee(B,c,M),ht=rt.scale,vt=rt.realScaleType;ht.domain(G).range(le),ete(ht);var mt=tte(ht,fc(fc({},B),{},{realScaleType:vt}));n==="xAxis"?(ze=N==="top"&&!X||N==="bottom"&&X,ge=r.left,je=T[ne]-ze*B.height):n==="yAxis"&&(ze=N==="left"&&!X||N==="right"&&X,ge=T[ne]-ze*B.width,je=r.top);var ct=fc(fc(fc({},B),mt),{},{realScaleType:vt,x:ge,y:je,scale:ht,width:n==="xAxis"?r.width:B.width,height:n==="yAxis"?r.height:B.height});return ct.bandSize=QE(ct,mt),!B.hide&&n==="xAxis"?T[ne]+=(ze?-1:1)*ct.height:B.hide||(T[ne]+=(ze?-1:1)*ct.width),fc(fc({},O),{},yC({},D,ct))},{})},zte=function(e,t){var r=e.x,n=e.y,c=t.x,h=t.y;return{x:Math.min(r,c),y:Math.min(n,h),width:Math.abs(c-r),height:Math.abs(h-n)}},$Ve=function(e){var t=e.x1,r=e.y1,n=e.x2,c=e.y2;return zte({x:t,y:r},{x:n,y:c})},Nte=function(){function e(t){FVe(this,e),this.scale=t}return BVe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.bandAware,c=r.position;if(t!==void 0){if(c)switch(c){case"start":return this.scale(t);case"middle":{var h=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+h}case"end":{var p=this.bandwidth?this.bandwidth():0;return this.scale(t)+p}default:return this.scale(t)}if(n){var o=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+o}return this.scale(t)}}},{key:"isInRange",value:function(t){var r=this.range(),n=r[0],c=r[r.length-1];return n<=c?t>=n&&t<=c:t>=c&&t<=n}}],[{key:"create",value:function(t){return new e(t)}}])}();yC(Nte,"EPS",1e-4);var tN=function(e){var t=Object.keys(e).reduce(function(r,n){return fc(fc({},r),{},yC({},n,Nte.create(e[n])))},{});return fc(fc({},t),{},{apply:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=n.bandAware,h=n.position;return lVe(r,function(p,o){return t[o].apply(p,{bandAware:c,position:h})})},isInRange:function(r){return Ote(r,function(n,c){return t[c].isInRange(n)})}})};function GVe(e){return(e%180+180)%180}var qVe=function(e){var t=e.width,r=e.height,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=GVe(n),h=c*Math.PI/180,p=Math.atan(r/t),o=h>p&&h<Math.PI-p?r/Math.sin(h):t/Math.cos(h);return Math.abs(o)},HVe=Ou,WVe=s1,ZVe=Kk;function KVe(e){return function(t,r,n){var c=Object(t);if(!WVe(t)){var h=HVe(r);t=ZVe(t),r=function(o){return h(c[o],o,c)}}var p=e(t,r,n);return p>-1?c[h?t[p]:p]:void 0}}var XVe=KVe,YVe=Cte;function JVe(e){var t=YVe(e),r=t%1;return t===t?r?t-r:t:0}var QVe=JVe,e8e=IQ,t8e=Ou,r8e=QVe,n8e=Math.max;function i8e(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var c=r==null?0:r8e(r);return c<0&&(c=n8e(n+c,0)),e8e(e,t8e(t),c)}var o8e=i8e,a8e=XVe,s8e=o8e,l8e=a8e(s8e),c8e=l8e;const u8e=ki(c8e);var h8e=JTe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),rN=Z.createContext(void 0),nN=Z.createContext(void 0),Fte=Z.createContext(void 0),Bte=Z.createContext({}),Ute=Z.createContext(void 0),Vte=Z.createContext(0),$te=Z.createContext(0),Mq=function(e){var t=e.state,r=t.xAxisMap,n=t.yAxisMap,c=t.offset,h=e.clipPathId,p=e.children,o=e.width,v=e.height,w=h8e(c);return Ne.createElement(rN.Provider,{value:r},Ne.createElement(nN.Provider,{value:n},Ne.createElement(Bte.Provider,{value:c},Ne.createElement(Fte.Provider,{value:w},Ne.createElement(Ute.Provider,{value:h},Ne.createElement(Vte.Provider,{value:v},Ne.createElement($te.Provider,{value:o},p)))))))},d8e=function(){return Z.useContext(Ute)},Gte=function(e){var t=Z.useContext(rN);t==null&&km();var r=t[e];return r==null&&km(),r},f8e=function(){var e=Z.useContext(rN);return Yd(e)},p8e=function(){var e=Z.useContext(nN),t=u8e(e,function(r){return Ote(r.domain,Number.isFinite)});return t||Yd(e)},qte=function(e){var t=Z.useContext(nN);t==null&&km();var r=t[e];return r==null&&km(),r},m8e=function(){var e=Z.useContext(Fte);return e},g8e=function(){return Z.useContext(Bte)},iN=function(){return Z.useContext($te)},oN=function(){return Z.useContext(Vte)};function N_(e){"@babel/helpers - typeof";return N_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N_(e)}function y8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Wte(n.key),n)}}function v8e(e,t,r){return t&&_8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function x8e(e,t,r){return t=gA(t),b8e(e,Hte()?Reflect.construct(t,r||[],gA(e).constructor):t.apply(e,r))}function b8e(e,t){if(t&&(N_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return w8e(e)}function w8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Hte=function(){return!!e})()}function gA(e){return gA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gA(e)}function S8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mD(e,t)}function mD(e,t){return mD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},mD(e,t)}function Iq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Oq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Iq(Object(r),!0).forEach(function(n){aN(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Iq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aN(e,t,r){return t=Wte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wte(e){var t=T8e(e,"string");return N_(t)=="symbol"?t:t+""}function T8e(e,t){if(N_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(N_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function E8e(e,t){return P8e(e)||C8e(e,t)||k8e(e,t)||A8e()}function A8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k8e(e,t){if(e){if(typeof e=="string")return jq(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jq(e,t)}}function jq(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function C8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function P8e(e){if(Array.isArray(e))return e}function gD(){return gD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gD.apply(this,arguments)}var M8e=function(e,t){var r;return Ne.isValidElement(e)?r=Ne.cloneElement(e,t):Pn(e)?r=e(t):r=Ne.createElement("line",gD({},t,{className:"recharts-reference-line-line"})),r},I8e=function(e,t,r,n,c,h,p,o,v){var w=c.x,T=c.y,M=c.width,O=c.height;if(r){var D=v.y,B=e.y.apply(D,{position:h});if(Au(v,"discard")&&!e.y.isInRange(B))return null;var N=[{x:w+M,y:B},{x:w,y:B}];return o==="left"?N.reverse():N}if(t){var G=v.x,V=e.x.apply(G,{position:h});if(Au(v,"discard")&&!e.x.isInRange(V))return null;var U=[{x:V,y:T+O},{x:V,y:T}];return p==="top"?U.reverse():U}if(n){var X=v.segment,Y=X.map(function(ne){return e.apply(ne,{position:h})});return Au(v,"discard")&&eVe(Y,function(ne){return!e.isInRange(ne)})?null:Y}return null};function O8e(e){var t=e.x,r=e.y,n=e.segment,c=e.xAxisId,h=e.yAxisId,p=e.shape,o=e.className,v=e.alwaysShow,w=d8e(),T=Gte(c),M=qte(h),O=m8e();if(!w||!O)return null;_c(v===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var D=tN({x:T.scale,y:M.scale}),B=oa(t),N=oa(r),G=n&&n.length===2,V=I8e(D,B,N,G,O,e.position,T.orientation,M.orientation,e);if(!V)return null;var U=E8e(V,2),X=U[0],Y=X.x,ne=X.y,se=U[1],le=se.x,ge=se.y,je=Au(e,"hidden")?"url(#".concat(w,")"):void 0,ze=Oq(Oq({clipPath:je},Sn(e,!0)),{},{x1:Y,y1:ne,x2:le,y2:ge});return Ne.createElement(Li,{className:Hn("recharts-reference-line",o)},M8e(p,ze),_a.renderCallByParent(e,$Ve({x1:Y,y1:ne,x2:le,y2:ge})))}var sN=function(e){function t(){return y8e(this,t),x8e(this,t,arguments)}return S8e(t,e),v8e(t,[{key:"render",value:function(){return Ne.createElement(O8e,this.props)}}])}(Ne.Component);aN(sN,"displayName","ReferenceLine");aN(sN,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function yD(){return yD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yD.apply(this,arguments)}function F_(e){"@babel/helpers - typeof";return F_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F_(e)}function Rq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Dq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Rq(Object(r),!0).forEach(function(n){_C(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function j8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Kte(n.key),n)}}function D8e(e,t,r){return t&&R8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function L8e(e,t,r){return t=yA(t),z8e(e,Zte()?Reflect.construct(t,r||[],yA(e).constructor):t.apply(e,r))}function z8e(e,t){if(t&&(F_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return N8e(e)}function N8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zte=function(){return!!e})()}function yA(e){return yA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yA(e)}function F8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_D(e,t)}function _D(e,t){return _D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},_D(e,t)}function _C(e,t,r){return t=Kte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kte(e){var t=B8e(e,"string");return F_(t)=="symbol"?t:t+""}function B8e(e,t){if(F_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(F_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var U8e=function(e){var t=e.x,r=e.y,n=e.xAxis,c=e.yAxis,h=tN({x:n.scale,y:c.scale}),p=h.apply({x:t,y:r},{bandAware:!0});return Au(e,"discard")&&!h.isInRange(p)?null:p},vC=function(e){function t(){return j8e(this,t),L8e(this,t,arguments)}return F8e(t,e),D8e(t,[{key:"render",value:function(){var r=this.props,n=r.x,c=r.y,h=r.r,p=r.alwaysShow,o=r.clipPathId,v=oa(n),w=oa(c);if(_c(p===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!v||!w)return null;var T=U8e(this.props);if(!T)return null;var M=T.x,O=T.y,D=this.props,B=D.shape,N=D.className,G=Au(this.props,"hidden")?"url(#".concat(o,")"):void 0,V=Dq(Dq({clipPath:G},Sn(this.props,!0)),{},{cx:M,cy:O});return Ne.createElement(Li,{className:Hn("recharts-reference-dot",N)},t.renderDot(B,V),_a.renderCallByParent(this.props,{x:M-h,y:O-h,width:2*h,height:2*h}))}}])}(Ne.Component);_C(vC,"displayName","ReferenceDot");_C(vC,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});_C(vC,"renderDot",function(e,t){var r;return Ne.isValidElement(e)?r=Ne.cloneElement(e,t):Pn(e)?r=e(t):r=Ne.createElement(eN,yD({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function vD(){return vD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},vD.apply(this,arguments)}function B_(e){"@babel/helpers - typeof";return B_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B_(e)}function Lq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function zq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Lq(Object(r),!0).forEach(function(n){xC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function V8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Yte(n.key),n)}}function G8e(e,t,r){return t&&$8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function q8e(e,t,r){return t=_A(t),H8e(e,Xte()?Reflect.construct(t,r||[],_A(e).constructor):t.apply(e,r))}function H8e(e,t){if(t&&(B_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return W8e(e)}function W8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xte=function(){return!!e})()}function _A(e){return _A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_A(e)}function Z8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xD(e,t)}function xD(e,t){return xD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},xD(e,t)}function xC(e,t,r){return t=Yte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Yte(e){var t=K8e(e,"string");return B_(t)=="symbol"?t:t+""}function K8e(e,t){if(B_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(B_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var X8e=function(e,t,r,n,c){var h=c.x1,p=c.x2,o=c.y1,v=c.y2,w=c.xAxis,T=c.yAxis;if(!w||!T)return null;var M=tN({x:w.scale,y:T.scale}),O={x:e?M.x.apply(h,{position:"start"}):M.x.rangeMin,y:r?M.y.apply(o,{position:"start"}):M.y.rangeMin},D={x:t?M.x.apply(p,{position:"end"}):M.x.rangeMax,y:n?M.y.apply(v,{position:"end"}):M.y.rangeMax};return Au(c,"discard")&&(!M.isInRange(O)||!M.isInRange(D))?null:zte(O,D)},bC=function(e){function t(){return V8e(this,t),q8e(this,t,arguments)}return Z8e(t,e),G8e(t,[{key:"render",value:function(){var r=this.props,n=r.x1,c=r.x2,h=r.y1,p=r.y2,o=r.className,v=r.alwaysShow,w=r.clipPathId;_c(v===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var T=oa(n),M=oa(c),O=oa(h),D=oa(p),B=this.props.shape;if(!T&&!M&&!O&&!D&&!B)return null;var N=X8e(T,M,O,D,this.props);if(!N&&!B)return null;var G=Au(this.props,"hidden")?"url(#".concat(w,")"):void 0;return Ne.createElement(Li,{className:Hn("recharts-reference-area",o)},t.renderRect(B,zq(zq({clipPath:G},Sn(this.props,!0)),N)),_a.renderCallByParent(this.props,N))}}])}(Ne.Component);xC(bC,"displayName","ReferenceArea");xC(bC,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});xC(bC,"renderRect",function(e,t){var r;return Ne.isValidElement(e)?r=Ne.cloneElement(e,t):Pn(e)?r=e(t):r=Ne.createElement(Qz,vD({},t,{className:"recharts-reference-area-rect"})),r});function Jte(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],c=0;c<e.length;c+=t)n.push(e[c]);return n}function Y8e(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return qVe(n,r)}function J8e(e,t,r){var n=r==="width",c=e.x,h=e.y,p=e.width,o=e.height;return t===1?{start:n?c:h,end:n?c+p:h+o}:{start:n?c+p:h+o,end:n?c:h}}function vA(e,t,r,n,c){if(e*t<e*n||e*t>e*c)return!1;var h=r();return e*(t-e*h/2-n)>=0&&e*(t+e*h/2-c)<=0}function Q8e(e,t){return Jte(e,t+1)}function e$e(e,t,r,n,c){for(var h=(n||[]).slice(),p=t.start,o=t.end,v=0,w=1,T=p,M=function(){var D=n?.[v];if(D===void 0)return{v:Jte(n,w)};var B=v,N,G=function(){return N===void 0&&(N=r(D,B)),N},V=D.coordinate,U=v===0||vA(e,V,G,T,o);U||(v=0,T=p,w+=1),U&&(T=V+e*(G()/2+c),v+=w)},O;w<=h.length;)if(O=M(),O)return O.v;return[]}function Nw(e){"@babel/helpers - typeof";return Nw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nw(e)}function Nq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Ka(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Nq(Object(r),!0).forEach(function(n){t$e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function t$e(e,t,r){return t=r$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function r$e(e){var t=n$e(e,"string");return Nw(t)=="symbol"?t:t+""}function n$e(e,t){if(Nw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Nw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function i$e(e,t,r,n,c){for(var h=(n||[]).slice(),p=h.length,o=t.start,v=t.end,w=function(M){var O=h[M],D,B=function(){return D===void 0&&(D=r(O,M)),D};if(M===p-1){var N=e*(O.coordinate+e*B()/2-v);h[M]=O=Ka(Ka({},O),{},{tickCoord:N>0?O.coordinate-N*e:O.coordinate})}else h[M]=O=Ka(Ka({},O),{},{tickCoord:O.coordinate});var G=vA(e,O.tickCoord,B,o,v);G&&(v=O.tickCoord-e*(B()/2+c),h[M]=Ka(Ka({},O),{},{isShow:!0}))},T=p-1;T>=0;T--)w(T);return h}function o$e(e,t,r,n,c,h){var p=(n||[]).slice(),o=p.length,v=t.start,w=t.end;if(h){var T=n[o-1],M=r(T,o-1),O=e*(T.coordinate+e*M/2-w);p[o-1]=T=Ka(Ka({},T),{},{tickCoord:O>0?T.coordinate-O*e:T.coordinate});var D=vA(e,T.tickCoord,function(){return M},v,w);D&&(w=T.tickCoord-e*(M/2+c),p[o-1]=Ka(Ka({},T),{},{isShow:!0}))}for(var B=h?o-1:o,N=function(V){var U=p[V],X,Y=function(){return X===void 0&&(X=r(U,V)),X};if(V===0){var ne=e*(U.coordinate-e*Y()/2-v);p[V]=U=Ka(Ka({},U),{},{tickCoord:ne<0?U.coordinate-ne*e:U.coordinate})}else p[V]=U=Ka(Ka({},U),{},{tickCoord:U.coordinate});var se=vA(e,U.tickCoord,Y,v,w);se&&(v=U.tickCoord+e*(Y()/2+c),p[V]=Ka(Ka({},U),{},{isShow:!0}))},G=0;G<B;G++)N(G);return p}function lN(e,t,r){var n=e.tick,c=e.ticks,h=e.viewBox,p=e.minTickGap,o=e.orientation,v=e.interval,w=e.tickFormatter,T=e.unit,M=e.angle;if(!c||!c.length||!n)return[];if(fr(v)||gv.isSsr)return Q8e(c,typeof v=="number"&&fr(v)?v:0);var O=[],D=o==="top"||o==="bottom"?"width":"height",B=T&&D==="width"?kb(T,{fontSize:t,letterSpacing:r}):{width:0,height:0},N=function(U,X){var Y=Pn(w)?w(U.value,X):U.value;return D==="width"?Y8e(kb(Y,{fontSize:t,letterSpacing:r}),B,M):kb(Y,{fontSize:t,letterSpacing:r})[D]},G=c.length>=2?ys(c[1].coordinate-c[0].coordinate):1,V=J8e(h,G,D);return v==="equidistantPreserveStart"?e$e(G,V,N,c,p):(v==="preserveStart"||v==="preserveStartEnd"?O=o$e(G,V,N,c,p,v==="preserveStartEnd"):O=i$e(G,V,N,c,p),O.filter(function(U){return U.isShow}))}var a$e=["viewBox"],s$e=["viewBox"],l$e=["ticks"];function U_(e){"@babel/helpers - typeof";return U_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U_(e)}function Gy(){return Gy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Gy.apply(this,arguments)}function Fq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Jo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fq(Object(r),!0).forEach(function(n){cN(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JI(e,t){if(e==null)return{};var r=c$e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function c$e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function u$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ere(n.key),n)}}function h$e(e,t,r){return t&&Bq(e.prototype,t),r&&Bq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d$e(e,t,r){return t=xA(t),f$e(e,Qte()?Reflect.construct(t,r||[],xA(e).constructor):t.apply(e,r))}function f$e(e,t){if(t&&(U_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return p$e(e)}function p$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Qte=function(){return!!e})()}function xA(e){return xA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xA(e)}function m$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bD(e,t)}function bD(e,t){return bD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},bD(e,t)}function cN(e,t,r){return t=ere(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ere(e){var t=g$e(e,"string");return U_(t)=="symbol"?t:t+""}function g$e(e,t){if(U_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(U_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var xv=function(e){function t(r){var n;return u$e(this,t),n=d$e(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return m$e(t,e),h$e(t,[{key:"shouldComponentUpdate",value:function(r,n){var c=r.viewBox,h=JI(r,a$e),p=this.props,o=p.viewBox,v=JI(p,s$e);return!o_(c,o)||!o_(h,v)||!o_(n,this.state)}},{key:"componentDidMount",value:function(){var r=this.layerReference;if(r){var n=r.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];n&&this.setState({fontSize:window.getComputedStyle(n).fontSize,letterSpacing:window.getComputedStyle(n).letterSpacing})}}},{key:"getTickLineCoord",value:function(r){var n=this.props,c=n.x,h=n.y,p=n.width,o=n.height,v=n.orientation,w=n.tickSize,T=n.mirror,M=n.tickMargin,O,D,B,N,G,V,U=T?-1:1,X=r.tickSize||w,Y=fr(r.tickCoord)?r.tickCoord:r.coordinate;switch(v){case"top":O=D=r.coordinate,N=h+ +!T*o,B=N-U*X,V=B-U*M,G=Y;break;case"left":B=N=r.coordinate,D=c+ +!T*p,O=D-U*X,G=O-U*M,V=Y;break;case"right":B=N=r.coordinate,D=c+ +T*p,O=D+U*X,G=O+U*M,V=Y;break;default:O=D=r.coordinate,N=h+ +T*o,B=N+U*X,V=B+U*M,G=Y;break}return{line:{x1:O,y1:B,x2:D,y2:N},tick:{x:G,y:V}}}},{key:"getTickTextAnchor",value:function(){var r=this.props,n=r.orientation,c=r.mirror,h;switch(n){case"left":h=c?"start":"end";break;case"right":h=c?"end":"start";break;default:h="middle";break}return h}},{key:"getTickVerticalAnchor",value:function(){var r=this.props,n=r.orientation,c=r.mirror,h="end";switch(n){case"left":case"right":h="middle";break;case"top":h=c?"start":"end";break;default:h=c?"end":"start";break}return h}},{key:"renderAxisLine",value:function(){var r=this.props,n=r.x,c=r.y,h=r.width,p=r.height,o=r.orientation,v=r.mirror,w=r.axisLine,T=Jo(Jo(Jo({},Sn(this.props,!1)),Sn(w,!1)),{},{fill:"none"});if(o==="top"||o==="bottom"){var M=+(o==="top"&&!v||o==="bottom"&&v);T=Jo(Jo({},T),{},{x1:n,y1:c+M*p,x2:n+h,y2:c+M*p})}else{var O=+(o==="left"&&!v||o==="right"&&v);T=Jo(Jo({},T),{},{x1:n+O*h,y1:c,x2:n+O*h,y2:c+p})}return Ne.createElement("line",Gy({},T,{className:Hn("recharts-cartesian-axis-line",fl(w,"className"))}))}},{key:"renderTicks",value:function(r,n,c){var h=this,p=this.props,o=p.tickLine,v=p.stroke,w=p.tick,T=p.tickFormatter,M=p.unit,O=lN(Jo(Jo({},this.props),{},{ticks:r}),n,c),D=this.getTickTextAnchor(),B=this.getTickVerticalAnchor(),N=Sn(this.props,!1),G=Sn(w,!1),V=Jo(Jo({},N),{},{fill:"none"},Sn(o,!1)),U=O.map(function(X,Y){var ne=h.getTickLineCoord(X),se=ne.line,le=ne.tick,ge=Jo(Jo(Jo(Jo({textAnchor:D,verticalAnchor:B},N),{},{stroke:"none",fill:v},G),le),{},{index:Y,payload:X,visibleTicksCount:O.length,tickFormatter:T});return Ne.createElement(Li,Gy({className:"recharts-cartesian-axis-tick",key:"tick-".concat(X.value,"-").concat(X.coordinate,"-").concat(X.tickCoord)},Tm(h.props,X,Y)),o&&Ne.createElement("line",Gy({},V,se,{className:Hn("recharts-cartesian-axis-tick-line",fl(o,"className"))})),w&&t.renderTickItem(w,ge,"".concat(Pn(T)?T(X.value,Y):X.value).concat(M||"")))});return Ne.createElement("g",{className:"recharts-cartesian-axis-ticks"},U)}},{key:"render",value:function(){var r=this,n=this.props,c=n.axisLine,h=n.width,p=n.height,o=n.ticksGenerator,v=n.className,w=n.hide;if(w)return null;var T=this.props,M=T.ticks,O=JI(T,l$e),D=M;return Pn(o)&&(D=M&&M.length>0?o(this.props):o(O)),h<=0||p<=0||!D||!D.length?null:Ne.createElement(Li,{className:Hn("recharts-cartesian-axis",v),ref:function(B){r.layerReference=B}},c&&this.renderAxisLine(),this.renderTicks(D,this.state.fontSize,this.state.letterSpacing),_a.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(r,n,c){var h,p=Hn(n.className,"recharts-cartesian-axis-tick-value");return Ne.isValidElement(r)?h=Ne.cloneElement(r,Jo(Jo({},n),{},{className:p})):Pn(r)?h=r(Jo(Jo({},n),{},{className:p})):h=Ne.createElement(Em,Gy({},n,{className:"recharts-cartesian-axis-tick-value"}),c),h}}])}(Z.Component);cN(xv,"displayName","CartesianAxis");cN(xv,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var y$e=["x1","y1","x2","y2","key"],_$e=["offset"];function Cm(e){"@babel/helpers - typeof";return Cm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cm(e)}function Uq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Ya(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Uq(Object(r),!0).forEach(function(n){v$e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function v$e(e,t,r){return t=x$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x$e(e){var t=b$e(e,"string");return Cm(t)=="symbol"?t:t+""}function b$e(e,t){if(Cm(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Cm(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function im(){return im=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},im.apply(this,arguments)}function Vq(e,t){if(e==null)return{};var r=w$e(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function w$e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var S$e=function(e){var t=e.fill;if(!t||t==="none")return null;var r=e.fillOpacity,n=e.x,c=e.y,h=e.width,p=e.height,o=e.ry;return Ne.createElement("rect",{x:n,y:c,ry:o,width:h,height:p,stroke:"none",fill:t,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function tre(e,t){var r;if(Ne.isValidElement(e))r=Ne.cloneElement(e,t);else if(Pn(e))r=e(t);else{var n=t.x1,c=t.y1,h=t.x2,p=t.y2,o=t.key,v=Vq(t,y$e),w=Sn(v,!1);w.offset;var T=Vq(w,_$e);r=Ne.createElement("line",im({},T,{x1:n,y1:c,x2:h,y2:p,fill:"none",key:o}))}return r}function T$e(e){var t=e.x,r=e.width,n=e.horizontal,c=n===void 0?!0:n,h=e.horizontalPoints;if(!c||!h||!h.length)return null;var p=h.map(function(o,v){var w=Ya(Ya({},e),{},{x1:t,y1:o,x2:t+r,y2:o,key:"line-".concat(v),index:v});return tre(c,w)});return Ne.createElement("g",{className:"recharts-cartesian-grid-horizontal"},p)}function E$e(e){var t=e.y,r=e.height,n=e.vertical,c=n===void 0?!0:n,h=e.verticalPoints;if(!c||!h||!h.length)return null;var p=h.map(function(o,v){var w=Ya(Ya({},e),{},{x1:o,y1:t,x2:o,y2:t+r,key:"line-".concat(v),index:v});return tre(c,w)});return Ne.createElement("g",{className:"recharts-cartesian-grid-vertical"},p)}function A$e(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,c=e.y,h=e.width,p=e.height,o=e.horizontalPoints,v=e.horizontal,w=v===void 0?!0:v;if(!w||!t||!t.length)return null;var T=o.map(function(O){return Math.round(O+c-c)}).sort(function(O,D){return O-D});c!==T[0]&&T.unshift(0);var M=T.map(function(O,D){var B=!T[D+1],N=B?c+p-O:T[D+1]-O;if(N<=0)return null;var G=D%t.length;return Ne.createElement("rect",{key:"react-".concat(D),y:O,x:n,height:N,width:h,stroke:"none",fill:t[G],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ne.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},M)}function k$e(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,c=e.fillOpacity,h=e.x,p=e.y,o=e.width,v=e.height,w=e.verticalPoints;if(!r||!n||!n.length)return null;var T=w.map(function(O){return Math.round(O+h-h)}).sort(function(O,D){return O-D});h!==T[0]&&T.unshift(0);var M=T.map(function(O,D){var B=!T[D+1],N=B?h+o-O:T[D+1]-O;if(N<=0)return null;var G=D%n.length;return Ne.createElement("rect",{key:"react-".concat(D),x:O,y:p,width:N,height:v,stroke:"none",fill:n[G],fillOpacity:c,className:"recharts-cartesian-grid-bg"})});return Ne.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},M)}var C$e=function(e,t){var r=e.xAxis,n=e.width,c=e.height,h=e.offset;return Jee(lN(Ya(Ya(Ya({},xv.defaultProps),r),{},{ticks:_h(r,!0),viewBox:{x:0,y:0,width:n,height:c}})),h.left,h.left+h.width,t)},P$e=function(e,t){var r=e.yAxis,n=e.width,c=e.height,h=e.offset;return Jee(lN(Ya(Ya(Ya({},xv.defaultProps),r),{},{ticks:_h(r,!0),viewBox:{x:0,y:0,width:n,height:c}})),h.top,h.top+h.height,t)},by={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function uN(e){var t,r,n,c,h,p,o=iN(),v=oN(),w=g8e(),T=Ya(Ya({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:by.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:by.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:by.horizontal,horizontalFill:(c=e.horizontalFill)!==null&&c!==void 0?c:by.horizontalFill,vertical:(h=e.vertical)!==null&&h!==void 0?h:by.vertical,verticalFill:(p=e.verticalFill)!==null&&p!==void 0?p:by.verticalFill,x:fr(e.x)?e.x:w.left,y:fr(e.y)?e.y:w.top,width:fr(e.width)?e.width:w.width,height:fr(e.height)?e.height:w.height}),M=T.x,O=T.y,D=T.width,B=T.height,N=T.syncWithTicks,G=T.horizontalValues,V=T.verticalValues,U=f8e(),X=p8e();if(!fr(D)||D<=0||!fr(B)||B<=0||!fr(M)||M!==+M||!fr(O)||O!==+O)return null;var Y=T.verticalCoordinatesGenerator||C$e,ne=T.horizontalCoordinatesGenerator||P$e,se=T.horizontalPoints,le=T.verticalPoints;if((!se||!se.length)&&Pn(ne)){var ge=G&&G.length,je=ne({yAxis:X?Ya(Ya({},X),{},{ticks:ge?G:X.ticks}):void 0,width:o,height:v,offset:w},ge?!0:N);_c(Array.isArray(je),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Cm(je),"]")),Array.isArray(je)&&(se=je)}if((!le||!le.length)&&Pn(Y)){var ze=V&&V.length,Ce=Y({xAxis:U?Ya(Ya({},U),{},{ticks:ze?V:U.ticks}):void 0,width:o,height:v,offset:w},ze?!0:N);_c(Array.isArray(Ce),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Cm(Ce),"]")),Array.isArray(Ce)&&(le=Ce)}return Ne.createElement("g",{className:"recharts-cartesian-grid"},Ne.createElement(S$e,{fill:T.fill,fillOpacity:T.fillOpacity,x:T.x,y:T.y,width:T.width,height:T.height,ry:T.ry}),Ne.createElement(T$e,im({},T,{offset:w,horizontalPoints:se,xAxis:U,yAxis:X})),Ne.createElement(E$e,im({},T,{offset:w,verticalPoints:le,xAxis:U,yAxis:X})),Ne.createElement(A$e,im({},T,{horizontalPoints:se})),Ne.createElement(k$e,im({},T,{verticalPoints:le})))}uN.displayName="CartesianGrid";function V_(e){"@babel/helpers - typeof";return V_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V_(e)}function M$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I$e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ire(n.key),n)}}function O$e(e,t,r){return t&&I$e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function j$e(e,t,r){return t=bA(t),R$e(e,rre()?Reflect.construct(t,r||[],bA(e).constructor):t.apply(e,r))}function R$e(e,t){if(t&&(V_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return D$e(e)}function D$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rre(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rre=function(){return!!e})()}function bA(e){return bA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bA(e)}function L$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wD(e,t)}function wD(e,t){return wD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},wD(e,t)}function nre(e,t,r){return t=ire(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ire(e){var t=z$e(e,"string");return V_(t)=="symbol"?t:t+""}function z$e(e,t){if(V_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(V_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function SD(){return SD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},SD.apply(this,arguments)}function N$e(e){var t=e.xAxisId,r=iN(),n=oN(),c=Gte(t);return c==null?null:Z.createElement(xv,SD({},c,{className:Hn("recharts-".concat(c.axisType," ").concat(c.axisType),c.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(h){return _h(h,!0)}}))}var $_=function(e){function t(){return M$e(this,t),j$e(this,t,arguments)}return L$e(t,e),O$e(t,[{key:"render",value:function(){return Z.createElement(N$e,this.props)}}])}(Z.Component);nre($_,"displayName","XAxis");nre($_,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function G_(e){"@babel/helpers - typeof";return G_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G_(e)}function F$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B$e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,sre(n.key),n)}}function U$e(e,t,r){return t&&B$e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function V$e(e,t,r){return t=wA(t),$$e(e,ore()?Reflect.construct(t,r||[],wA(e).constructor):t.apply(e,r))}function $$e(e,t){if(t&&(G_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return G$e(e)}function G$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ore(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ore=function(){return!!e})()}function wA(e){return wA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wA(e)}function q$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TD(e,t)}function TD(e,t){return TD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},TD(e,t)}function are(e,t,r){return t=sre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sre(e){var t=H$e(e,"string");return G_(t)=="symbol"?t:t+""}function H$e(e,t){if(G_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(G_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function ED(){return ED=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ED.apply(this,arguments)}var W$e=function(e){var t=e.yAxisId,r=iN(),n=oN(),c=qte(t);return c==null?null:Z.createElement(xv,ED({},c,{className:Hn("recharts-".concat(c.axisType," ").concat(c.axisType),c.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(h){return _h(h,!0)}}))},q_=function(e){function t(){return F$e(this,t),V$e(this,t,arguments)}return q$e(t,e),U$e(t,[{key:"render",value:function(){return Z.createElement(W$e,this.props)}}])}(Z.Component);are(q_,"displayName","YAxis");are(q_,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function $q(e){return Y$e(e)||X$e(e)||K$e(e)||Z$e()}function Z$e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K$e(e,t){if(e){if(typeof e=="string")return AD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return AD(e,t)}}function X$e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Y$e(e){if(Array.isArray(e))return AD(e)}function AD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var kD=function(e,t,r,n,c){var h=Ll(e,sN),p=Ll(e,vC),o=[].concat($q(h),$q(p)),v=Ll(e,bC),w="".concat(n,"Id"),T=n[0],M=t;if(o.length&&(M=o.reduce(function(B,N){if(N.props[w]===r&&Au(N.props,"extendDomain")&&fr(N.props[T])){var G=N.props[T];return[Math.min(B[0],G),Math.max(B[1],G)]}return B},M)),v.length){var O="".concat(T,"1"),D="".concat(T,"2");M=v.reduce(function(B,N){if(N.props[w]===r&&Au(N.props,"extendDomain")&&fr(N.props[O])&&fr(N.props[D])){var G=N.props[O],V=N.props[D];return[Math.min(B[0],G,V),Math.max(B[1],G,V)]}return B},M)}return c&&c.length&&(M=c.reduce(function(B,N){return fr(N)?[Math.min(B[0],N),Math.max(B[1],N)]:B},M)),M},lre={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function c(v,w,T){this.fn=v,this.context=w,this.once=T||!1}function h(v,w,T,M,O){if(typeof T!="function")throw new TypeError("The listener must be a function");var D=new c(T,M||v,O),B=r?r+w:w;return v._events[B]?v._events[B].fn?v._events[B]=[v._events[B],D]:v._events[B].push(D):(v._events[B]=D,v._eventsCount++),v}function p(v,w){--v._eventsCount===0?v._events=new n:delete v._events[w]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var v=[],w,T;if(this._eventsCount===0)return v;for(T in w=this._events)t.call(w,T)&&v.push(r?T.slice(1):T);return Object.getOwnPropertySymbols?v.concat(Object.getOwnPropertySymbols(w)):v},o.prototype.listeners=function(v){var w=r?r+v:v,T=this._events[w];if(!T)return[];if(T.fn)return[T.fn];for(var M=0,O=T.length,D=new Array(O);M<O;M++)D[M]=T[M].fn;return D},o.prototype.listenerCount=function(v){var w=r?r+v:v,T=this._events[w];return T?T.fn?1:T.length:0},o.prototype.emit=function(v,w,T,M,O,D){var B=r?r+v:v;if(!this._events[B])return!1;var N=this._events[B],G=arguments.length,V,U;if(N.fn){switch(N.once&&this.removeListener(v,N.fn,void 0,!0),G){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,w),!0;case 3:return N.fn.call(N.context,w,T),!0;case 4:return N.fn.call(N.context,w,T,M),!0;case 5:return N.fn.call(N.context,w,T,M,O),!0;case 6:return N.fn.call(N.context,w,T,M,O,D),!0}for(U=1,V=new Array(G-1);U<G;U++)V[U-1]=arguments[U];N.fn.apply(N.context,V)}else{var X=N.length,Y;for(U=0;U<X;U++)switch(N[U].once&&this.removeListener(v,N[U].fn,void 0,!0),G){case 1:N[U].fn.call(N[U].context);break;case 2:N[U].fn.call(N[U].context,w);break;case 3:N[U].fn.call(N[U].context,w,T);break;case 4:N[U].fn.call(N[U].context,w,T,M);break;default:if(!V)for(Y=1,V=new Array(G-1);Y<G;Y++)V[Y-1]=arguments[Y];N[U].fn.apply(N[U].context,V)}}return!0},o.prototype.on=function(v,w,T){return h(this,v,w,T,!1)},o.prototype.once=function(v,w,T){return h(this,v,w,T,!0)},o.prototype.removeListener=function(v,w,T,M){var O=r?r+v:v;if(!this._events[O])return this;if(!w)return p(this,O),this;var D=this._events[O];if(D.fn)D.fn===w&&(!M||D.once)&&(!T||D.context===T)&&p(this,O);else{for(var B=0,N=[],G=D.length;B<G;B++)(D[B].fn!==w||M&&!D[B].once||T&&D[B].context!==T)&&N.push(D[B]);N.length?this._events[O]=N.length===1?N[0]:N:p(this,O)}return this},o.prototype.removeAllListeners=function(v){var w;return v?(w=r?r+v:v,this._events[w]&&p(this,w)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o})(lre);var J$e=lre.exports;const Q$e=ki(J$e);var QI=new Q$e,eO="recharts.syncMouseEvents";function Fw(e){"@babel/helpers - typeof";return Fw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fw(e)}function eGe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tGe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cre(n.key),n)}}function rGe(e,t,r){return t&&tGe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function tO(e,t,r){return t=cre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cre(e){var t=nGe(e,"string");return Fw(t)=="symbol"?t:t+""}function nGe(e,t){if(Fw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Fw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var iGe=function(){function e(){eGe(this,e),tO(this,"activeIndex",0),tO(this,"coordinateList",[]),tO(this,"layout","horizontal")}return rGe(e,[{key:"setDetails",value:function(t){var r,n=t.coordinateList,c=n===void 0?null:n,h=t.container,p=h===void 0?null:h,o=t.layout,v=o===void 0?null:o,w=t.offset,T=w===void 0?null:w,M=t.mouseHandlerCallback,O=M===void 0?null:M;this.coordinateList=(r=c??this.coordinateList)!==null&&r!==void 0?r:[],this.container=p??this.container,this.layout=v??this.layout,this.offset=T??this.offset,this.mouseHandlerCallback=O??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(t){if(this.coordinateList.length!==0)switch(t.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(t){this.activeIndex=t}},{key:"spoofMouse",value:function(){var t,r;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var n=this.container.getBoundingClientRect(),c=n.x,h=n.y,p=n.height,o=this.coordinateList[this.activeIndex].coordinate,v=((t=window)===null||t===void 0?void 0:t.scrollX)||0,w=((r=window)===null||r===void 0?void 0:r.scrollY)||0,T=c+o+v,M=h+this.offset.top+p/2+w;this.mouseHandlerCallback({pageX:T,pageY:M})}}}])}();function oGe(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e?.[0],c=e?.[1];if(n&&c&&fr(n)&&fr(c))return!0}return!1}function aGe(e,t,r,n){var c=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-c:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-c,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function ure(e){var t=e.cx,r=e.cy,n=e.radius,c=e.startAngle,h=e.endAngle,p=eo(t,r,n,c),o=eo(t,r,n,h);return{points:[p,o],cx:t,cy:r,radius:n,startAngle:c,endAngle:h}}function sGe(e,t,r){var n,c,h,p;if(e==="horizontal")n=t.x,h=n,c=r.top,p=r.top+r.height;else if(e==="vertical")c=t.y,p=c,n=r.left,h=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var o=t.cx,v=t.cy,w=t.innerRadius,T=t.outerRadius,M=t.angle,O=eo(o,v,w,M),D=eo(o,v,T,M);n=O.x,c=O.y,h=D.x,p=D.y}else return ure(t);return[{x:n,y:c},{x:h,y:p}]}function Bw(e){"@babel/helpers - typeof";return Bw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bw(e)}function Gq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function s2(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Gq(Object(r),!0).forEach(function(n){lGe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lGe(e,t,r){return t=cGe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cGe(e){var t=uGe(e,"string");return Bw(t)=="symbol"?t:t+""}function uGe(e,t){if(Bw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Bw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hGe(e){var t,r,n=e.element,c=e.tooltipEventType,h=e.isActive,p=e.activeCoordinate,o=e.activePayload,v=e.offset,w=e.activeTooltipIndex,T=e.tooltipAxisBandSize,M=e.layout,O=e.chartName,D=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!D||!h||!p||O!=="ScatterChart"&&c!=="axis")return null;var B,N=XR;if(O==="ScatterChart")B=p,N=V4e;else if(O==="BarChart")B=aGe(M,p,v,T),N=Qz;else if(M==="radial"){var G=ure(p),V=G.cx,U=G.cy,X=G.radius,Y=G.startAngle,ne=G.endAngle;B={cx:V,cy:U,startAngle:Y,endAngle:ne,innerRadius:X,outerRadius:X},N=cte}else B={points:sGe(M,p,v)},N=XR;var se=s2(s2(s2(s2({stroke:"#ccc",pointerEvents:"none"},v),B),Sn(D,!1)),{},{payload:o,payloadIndex:w,className:Hn("recharts-tooltip-cursor",D.className)});return Z.isValidElement(D)?Z.cloneElement(D,se):Z.createElement(N,se)}var dGe=["item"],fGe=["children","className","width","height","style","compact","title","desc"];function H_(e){"@babel/helpers - typeof";return H_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H_(e)}function qy(){return qy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qy.apply(this,arguments)}function qq(e,t){return gGe(e)||mGe(e,t)||dre(e,t)||pGe()}function pGe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mGe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,c,h,p,o=[],v=!0,w=!1;try{if(h=(r=r.call(e)).next,t!==0)for(;!(v=(n=h.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(T){w=!0,c=T}finally{try{if(!v&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(w)throw c}}return o}}function gGe(e){if(Array.isArray(e))return e}function Hq(e,t){if(e==null)return{};var r=yGe(e,t),n,c;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(c=0;c<h.length;c++)n=h[c],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function yGe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function _Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vGe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fre(n.key),n)}}function xGe(e,t,r){return t&&vGe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function bGe(e,t,r){return t=SA(t),wGe(e,hre()?Reflect.construct(t,r||[],SA(e).constructor):t.apply(e,r))}function wGe(e,t){if(t&&(H_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return SGe(e)}function SGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hre(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hre=function(){return!!e})()}function SA(e){return SA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},SA(e)}function TGe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CD(e,t)}function CD(e,t){return CD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},CD(e,t)}function W_(e){return kGe(e)||AGe(e)||dre(e)||EGe()}function EGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dre(e,t){if(e){if(typeof e=="string")return PD(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PD(e,t)}}function AGe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function kGe(e){if(Array.isArray(e))return PD(e)}function PD(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Wq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,n)}return r}function Gt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wq(Object(r),!0).forEach(function(n){dn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dn(e,t,r){return t=fre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fre(e){var t=CGe(e,"string");return H_(t)=="symbol"?t:t+""}function CGe(e,t){if(H_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(H_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var PGe={xAxis:["bottom","top"],yAxis:["left","right"]},MGe={width:"100%",height:"100%"},pre={x:0,y:0};function l2(e){return e}var IGe=function(e,t){return t==="horizontal"?e.x:t==="vertical"?e.y:t==="centric"?e.angle:e.radius},OGe=function(e,t,r,n){var c=t.find(function(w){return w&&w.index===r});if(c){if(e==="horizontal")return{x:c.coordinate,y:n.y};if(e==="vertical")return{x:n.x,y:c.coordinate};if(e==="centric"){var h=c.coordinate,p=n.radius;return Gt(Gt(Gt({},n),eo(n.cx,n.cy,p,h)),{},{angle:h,radius:p})}var o=c.coordinate,v=n.angle;return Gt(Gt(Gt({},n),eo(n.cx,n.cy,o,v)),{},{angle:v,radius:o})}return pre},wC=function(e,t){var r=t.graphicalItems,n=t.dataStartIndex,c=t.dataEndIndex,h=(r??[]).reduce(function(p,o){var v=o.props.data;return v&&v.length?[].concat(W_(p),W_(v)):p},[]);return h.length>0?h:e&&e.length&&fr(n)&&fr(c)?e.slice(n,c+1):[]};function mre(e){return e==="number"?[0,"auto"]:void 0}var MD=function(e,t,r,n){var c=e.graphicalItems,h=e.tooltipAxis,p=wC(t,e);return r<0||!c||!c.length||r>=p.length?null:c.reduce(function(o,v){var w,T=(w=v.props.data)!==null&&w!==void 0?w:t;T&&e.dataStartIndex+e.dataEndIndex!==0&&e.dataEndIndex-e.dataStartIndex>=r&&(T=T.slice(e.dataStartIndex,e.dataEndIndex+1));var M;if(h.dataKey&&!h.allowDuplicatedCategory){var O=T===void 0?p:T;M=oR(O,h.dataKey,n)}else M=T&&T[r]||p[r];return M?[].concat(W_(o),[nte(v,M)]):o},[])},Zq=function(e,t,r,n){var c=n||{x:e.chartX,y:e.chartY},h=IGe(c,r),p=e.orderedTooltipTicks,o=e.tooltipAxis,v=e.tooltipTicks,w=dFe(h,p,v,o);if(w>=0&&v){var T=v[w]&&v[w].value,M=MD(e,t,w,T),O=OGe(r,p,w,c);return{activeTooltipIndex:w,activeLabel:T,activePayload:M,activeCoordinate:O}}return null},jGe=function(e,t){var r=t.axes,n=t.graphicalItems,c=t.axisType,h=t.axisIdKey,p=t.stackGroups,o=t.dataStartIndex,v=t.dataEndIndex,w=e.layout,T=e.children,M=e.stackOffset,O=Yee(w,c);return r.reduce(function(D,B){var N,G=B.type.defaultProps!==void 0?Gt(Gt({},B.type.defaultProps),B.props):B.props,V=G.type,U=G.dataKey,X=G.allowDataOverflow,Y=G.allowDuplicatedCategory,ne=G.scale,se=G.ticks,le=G.includeHidden,ge=G[h];if(D[ge])return D;var je=wC(e.data,{graphicalItems:n.filter(function(mt){var ct,Vt=h in mt.props?mt.props[h]:(ct=mt.type.defaultProps)===null||ct===void 0?void 0:ct[h];return Vt===ge}),dataStartIndex:o,dataEndIndex:v}),ze=je.length,Ce,Ke,Ye;oGe(G.domain,X,V)&&(Ce=qR(G.domain,null,X),O&&(V==="number"||ne!=="auto")&&(Ye=O2(je,U,"category")));var Oe=mre(V);if(!Ce||Ce.length===0){var tt,He=(tt=G.domain)!==null&&tt!==void 0?tt:Oe;if(U){if(Ce=O2(je,U,V),V==="category"&&O){var lt=Z2e(Ce);Y&&lt?(Ke=Ce,Ce=hA(0,ze)):Y||(Ce=vG(He,Ce,B).reduce(function(mt,ct){return mt.indexOf(ct)>=0?mt:[].concat(W_(mt),[ct])},[]))}else if(V==="category")Y?Ce=Ce.filter(function(mt){return mt!==""&&!ni(mt)}):Ce=vG(He,Ce,B).reduce(function(mt,ct){return mt.indexOf(ct)>=0||ct===""||ni(ct)?mt:[].concat(W_(mt),[ct])},[]);else if(V==="number"){var rt=yFe(je,n.filter(function(mt){var ct,Vt,xr=h in mt.props?mt.props[h]:(ct=mt.type.defaultProps)===null||ct===void 0?void 0:ct[h],tn="hide"in mt.props?mt.props.hide:(Vt=mt.type.defaultProps)===null||Vt===void 0?void 0:Vt.hide;return xr===ge&&(le||!tn)}),U,c,w);rt&&(Ce=rt)}O&&(V==="number"||ne!=="auto")&&(Ye=O2(je,U,"category"))}else O?Ce=hA(0,ze):p&&p[ge]&&p[ge].hasStack&&V==="number"?Ce=M==="expand"?[0,1]:rte(p[ge].stackGroups,o,v):Ce=Xee(je,n.filter(function(mt){var ct=h in mt.props?mt.props[h]:mt.type.defaultProps[h],Vt="hide"in mt.props?mt.props.hide:mt.type.defaultProps.hide;return ct===ge&&(le||!Vt)}),V,w,!0);if(V==="number")Ce=kD(T,Ce,ge,c,se),He&&(Ce=qR(He,Ce,X));else if(V==="category"&&He){var ht=He,vt=Ce.every(function(mt){return ht.indexOf(mt)>=0});vt&&(Ce=ht)}}return Gt(Gt({},D),{},dn({},ge,Gt(Gt({},G),{},{axisType:c,domain:Ce,categoricalDomain:Ye,duplicateDomain:Ke,originalDomain:(N=G.domain)!==null&&N!==void 0?N:Oe,isCategorical:O,layout:w})))},{})},RGe=function(e,t){var r=t.graphicalItems,n=t.Axis,c=t.axisType,h=t.axisIdKey,p=t.stackGroups,o=t.dataStartIndex,v=t.dataEndIndex,w=e.layout,T=e.children,M=wC(e.data,{graphicalItems:r,dataStartIndex:o,dataEndIndex:v}),O=M.length,D=Yee(w,c),B=-1;return r.reduce(function(N,G){var V=G.type.defaultProps!==void 0?Gt(Gt({},G.type.defaultProps),G.props):G.props,U=V[h],X=mre("number");if(!N[U]){B++;var Y;return D?Y=hA(0,O):p&&p[U]&&p[U].hasStack?(Y=rte(p[U].stackGroups,o,v),Y=kD(T,Y,U,c)):(Y=qR(X,Xee(M,r.filter(function(ne){var se,le,ge=h in ne.props?ne.props[h]:(se=ne.type.defaultProps)===null||se===void 0?void 0:se[h],je="hide"in ne.props?ne.props.hide:(le=ne.type.defaultProps)===null||le===void 0?void 0:le.hide;return ge===U&&!je}),"number",w),n.defaultProps.allowDataOverflow),Y=kD(T,Y,U,c)),Gt(Gt({},N),{},dn({},U,Gt(Gt({axisType:c},n.defaultProps),{},{hide:!0,orientation:fl(PGe,"".concat(c,".").concat(B%2),null),domain:Y,originalDomain:X,isCategorical:D,layout:w})))}return N},{})},DGe=function(e,t){var r=t.axisType,n=r===void 0?"xAxis":r,c=t.AxisComp,h=t.graphicalItems,p=t.stackGroups,o=t.dataStartIndex,v=t.dataEndIndex,w=e.children,T="".concat(n,"Id"),M=Ll(w,c),O={};return M&&M.length?O=jGe(e,{axes:M,graphicalItems:h,axisType:n,axisIdKey:T,stackGroups:p,dataStartIndex:o,dataEndIndex:v}):h&&h.length&&(O=RGe(e,{Axis:c,graphicalItems:h,axisType:n,axisIdKey:T,stackGroups:p,dataStartIndex:o,dataEndIndex:v})),O},LGe=function(e){var t=Yd(e),r=_h(t,!1,!0);return{tooltipTicks:r,orderedTooltipTicks:kz(r,function(n){return n.coordinate}),tooltipAxis:t,tooltipAxisBandSize:QE(t,r)}},Kq=function(e){var t=e.children,r=e.defaultShowTooltip,n=al(t,L_),c=0,h=0;return e.data&&e.data.length!==0&&(h=e.data.length-1),n&&n.props&&(n.props.startIndex>=0&&(c=n.props.startIndex),n.props.endIndex>=0&&(h=n.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:c,dataEndIndex:h,activeTooltipIndex:-1,isTooltipActive:!!r}},zGe=function(e){return!e||!e.length?!1:e.some(function(t){var r=xh(t&&t.type);return r&&r.indexOf("Bar")>=0})},Xq=function(e){return e==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:e==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:e==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},NGe=function(e,t){var r=e.props,n=e.graphicalItems,c=e.xAxisMap,h=c===void 0?{}:c,p=e.yAxisMap,o=p===void 0?{}:p,v=r.width,w=r.height,T=r.children,M=r.margin||{},O=al(T,L_),D=al(T,a_),B=Object.keys(o).reduce(function(Y,ne){var se=o[ne],le=se.orientation;return!se.mirror&&!se.hide?Gt(Gt({},Y),{},dn({},le,Y[le]+se.width)):Y},{left:M.left||0,right:M.right||0}),N=Object.keys(h).reduce(function(Y,ne){var se=h[ne],le=se.orientation;return!se.mirror&&!se.hide?Gt(Gt({},Y),{},dn({},le,fl(Y,"".concat(le))+se.height)):Y},{top:M.top||0,bottom:M.bottom||0}),G=Gt(Gt({},N),B),V=G.bottom;O&&(G.bottom+=O.props.height||L_.defaultProps.height),D&&t&&(G=mFe(G,n,r,t));var U=v-G.left-G.right,X=w-G.top-G.bottom;return Gt(Gt({brushBottom:V},G),{},{width:Math.max(U,0),height:Math.max(X,0)})},FGe=function(e,t){if(t==="xAxis")return e[t].width;if(t==="yAxis")return e[t].height},gre=function(e){var t=e.chartName,r=e.GraphicalChild,n=e.defaultTooltipEventType,c=n===void 0?"axis":n,h=e.validateTooltipEventTypes,p=h===void 0?["axis"]:h,o=e.axisComponents,v=e.legendContent,w=e.formatAxisMap,T=e.defaultProps,M=function(N,G){var V=G.graphicalItems,U=G.stackGroups,X=G.offset,Y=G.updateId,ne=G.dataStartIndex,se=G.dataEndIndex,le=N.barSize,ge=N.layout,je=N.barGap,ze=N.barCategoryGap,Ce=N.maxBarSize,Ke=Xq(ge),Ye=Ke.numericAxisName,Oe=Ke.cateAxisName,tt=zGe(V),He=[];return V.forEach(function(lt,rt){var ht=wC(N.data,{graphicalItems:[lt],dataStartIndex:ne,dataEndIndex:se}),vt=lt.type.defaultProps!==void 0?Gt(Gt({},lt.type.defaultProps),lt.props):lt.props,mt=vt.dataKey,ct=vt.maxBarSize,Vt=vt["".concat(Ye,"Id")],xr=vt["".concat(Oe,"Id")],tn={},Er=o.reduce(function(Co,Hi){var Bi=G["".concat(Hi.axisType,"Map")],wa=vt["".concat(Hi.axisType,"Id")];Bi&&Bi[wa]||Hi.axisType==="zAxis"||km();var xo=Bi[wa];return Gt(Gt({},Co),{},dn(dn({},Hi.axisType,xo),"".concat(Hi.axisType,"Ticks"),_h(xo)))},tn),Ft=Er[Oe],br=Er["".concat(Oe,"Ticks")],Yt=U&&U[Vt]&&U[Vt].hasStack&&AFe(lt,U[Vt].stackGroups),Qt=xh(lt.type).indexOf("Bar")>=0,Sr=QE(Ft,br),Ut=[],Nn=tt&&fFe({barSize:le,stackGroups:U,totalSize:FGe(Er,Oe)});if(Qt){var Jr,Kr,In=ni(ct)?Ce:ct,Fi=(Jr=(Kr=QE(Ft,br,!0))!==null&&Kr!==void 0?Kr:In)!==null&&Jr!==void 0?Jr:0;Ut=pFe({barGap:je,barCategoryGap:ze,bandSize:Fi!==Sr?Fi:Sr,sizeList:Nn[xr],maxBarSize:In}),Fi!==Sr&&(Ut=Ut.map(function(Co){return Gt(Gt({},Co),{},{position:Gt(Gt({},Co.position),{},{offset:Co.position.offset-Fi/2})})}))}var $o=lt&&lt.type&&lt.type.getComposedData;$o&&He.push({props:Gt(Gt({},$o(Gt(Gt({},Er),{},{displayedData:ht,props:N,dataKey:mt,item:lt,bandSize:Sr,barPosition:Ut,offset:X,stackedData:Yt,layout:ge,dataStartIndex:ne,dataEndIndex:se}))),{},dn(dn(dn({key:lt.key||"item-".concat(rt)},Ye,Er[Ye]),Oe,Er[Oe]),"animationId",Y)),childIndex:sEe(lt,N.children),item:lt})}),He},O=function(N,G){var V=N.props,U=N.dataStartIndex,X=N.dataEndIndex,Y=N.updateId;if(!h8({props:V}))return null;var ne=V.children,se=V.layout,le=V.stackOffset,ge=V.data,je=V.reverseStackOrder,ze=Xq(se),Ce=ze.numericAxisName,Ke=ze.cateAxisName,Ye=Ll(ne,r),Oe=TFe(ge,Ye,"".concat(Ce,"Id"),"".concat(Ke,"Id"),le,je),tt=o.reduce(function(vt,mt){var ct="".concat(mt.axisType,"Map");return Gt(Gt({},vt),{},dn({},ct,DGe(V,Gt(Gt({},mt),{},{graphicalItems:Ye,stackGroups:mt.axisType===Ce&&Oe,dataStartIndex:U,dataEndIndex:X}))))},{}),He=NGe(Gt(Gt({},tt),{},{props:V,graphicalItems:Ye}),G?.legendBBox);Object.keys(tt).forEach(function(vt){tt[vt]=w(V,tt[vt],He,vt.replace("Map",""),t)});var lt=tt["".concat(Ke,"Map")],rt=LGe(lt),ht=M(V,Gt(Gt({},tt),{},{dataStartIndex:U,dataEndIndex:X,updateId:Y,graphicalItems:Ye,stackGroups:Oe,offset:He}));return Gt(Gt({formattedGraphicalItems:ht,graphicalItems:Ye,offset:He,stackGroups:Oe},rt),tt)},D=function(N){function G(V){var U,X,Y;return _Ge(this,G),Y=bGe(this,G,[V]),dn(Y,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),dn(Y,"accessibilityManager",new iGe),dn(Y,"handleLegendBBoxUpdate",function(ne){if(ne){var se=Y.state,le=se.dataStartIndex,ge=se.dataEndIndex,je=se.updateId;Y.setState(Gt({legendBBox:ne},O({props:Y.props,dataStartIndex:le,dataEndIndex:ge,updateId:je},Gt(Gt({},Y.state),{},{legendBBox:ne}))))}}),dn(Y,"handleReceiveSyncEvent",function(ne,se,le){if(Y.props.syncId===ne){if(le===Y.eventEmitterSymbol&&typeof Y.props.syncMethod!="function")return;Y.applySyncEvent(se)}}),dn(Y,"handleBrushChange",function(ne){var se=ne.startIndex,le=ne.endIndex;if(se!==Y.state.dataStartIndex||le!==Y.state.dataEndIndex){var ge=Y.state.updateId;Y.setState(function(){return Gt({dataStartIndex:se,dataEndIndex:le},O({props:Y.props,dataStartIndex:se,dataEndIndex:le,updateId:ge},Y.state))}),Y.triggerSyncEvent({dataStartIndex:se,dataEndIndex:le})}}),dn(Y,"handleMouseEnter",function(ne){var se=Y.getMouseInfo(ne);if(se){var le=Gt(Gt({},se),{},{isTooltipActive:!0});Y.setState(le),Y.triggerSyncEvent(le);var ge=Y.props.onMouseEnter;Pn(ge)&&ge(le,ne)}}),dn(Y,"triggeredAfterMouseMove",function(ne){var se=Y.getMouseInfo(ne),le=se?Gt(Gt({},se),{},{isTooltipActive:!0}):{isTooltipActive:!1};Y.setState(le),Y.triggerSyncEvent(le);var ge=Y.props.onMouseMove;Pn(ge)&&ge(le,ne)}),dn(Y,"handleItemMouseEnter",function(ne){Y.setState(function(){return{isTooltipActive:!0,activeItem:ne,activePayload:ne.tooltipPayload,activeCoordinate:ne.tooltipPosition||{x:ne.cx,y:ne.cy}}})}),dn(Y,"handleItemMouseLeave",function(){Y.setState(function(){return{isTooltipActive:!1}})}),dn(Y,"handleMouseMove",function(ne){ne.persist(),Y.throttleTriggeredAfterMouseMove(ne)}),dn(Y,"handleMouseLeave",function(ne){Y.throttleTriggeredAfterMouseMove.cancel();var se={isTooltipActive:!1};Y.setState(se),Y.triggerSyncEvent(se);var le=Y.props.onMouseLeave;Pn(le)&&le(se,ne)}),dn(Y,"handleOuterEvent",function(ne){var se=aEe(ne),le=fl(Y.props,"".concat(se));if(se&&Pn(le)){var ge,je;/.*touch.*/i.test(se)?je=Y.getMouseInfo(ne.changedTouches[0]):je=Y.getMouseInfo(ne),le((ge=je)!==null&&ge!==void 0?ge:{},ne)}}),dn(Y,"handleClick",function(ne){var se=Y.getMouseInfo(ne);if(se){var le=Gt(Gt({},se),{},{isTooltipActive:!0});Y.setState(le),Y.triggerSyncEvent(le);var ge=Y.props.onClick;Pn(ge)&&ge(le,ne)}}),dn(Y,"handleMouseDown",function(ne){var se=Y.props.onMouseDown;if(Pn(se)){var le=Y.getMouseInfo(ne);se(le,ne)}}),dn(Y,"handleMouseUp",function(ne){var se=Y.props.onMouseUp;if(Pn(se)){var le=Y.getMouseInfo(ne);se(le,ne)}}),dn(Y,"handleTouchMove",function(ne){ne.changedTouches!=null&&ne.changedTouches.length>0&&Y.throttleTriggeredAfterMouseMove(ne.changedTouches[0])}),dn(Y,"handleTouchStart",function(ne){ne.changedTouches!=null&&ne.changedTouches.length>0&&Y.handleMouseDown(ne.changedTouches[0])}),dn(Y,"handleTouchEnd",function(ne){ne.changedTouches!=null&&ne.changedTouches.length>0&&Y.handleMouseUp(ne.changedTouches[0])}),dn(Y,"handleDoubleClick",function(ne){var se=Y.props.onDoubleClick;if(Pn(se)){var le=Y.getMouseInfo(ne);se(le,ne)}}),dn(Y,"handleContextMenu",function(ne){var se=Y.props.onContextMenu;if(Pn(se)){var le=Y.getMouseInfo(ne);se(le,ne)}}),dn(Y,"triggerSyncEvent",function(ne){Y.props.syncId!==void 0&&QI.emit(eO,Y.props.syncId,ne,Y.eventEmitterSymbol)}),dn(Y,"applySyncEvent",function(ne){var se=Y.props,le=se.layout,ge=se.syncMethod,je=Y.state.updateId,ze=ne.dataStartIndex,Ce=ne.dataEndIndex;if(ne.dataStartIndex!==void 0||ne.dataEndIndex!==void 0)Y.setState(Gt({dataStartIndex:ze,dataEndIndex:Ce},O({props:Y.props,dataStartIndex:ze,dataEndIndex:Ce,updateId:je},Y.state)));else if(ne.activeTooltipIndex!==void 0){var Ke=ne.chartX,Ye=ne.chartY,Oe=ne.activeTooltipIndex,tt=Y.state,He=tt.offset,lt=tt.tooltipTicks;if(!He)return;if(typeof ge=="function")Oe=ge(lt,ne);else if(ge==="value"){Oe=-1;for(var rt=0;rt<lt.length;rt++)if(lt[rt].value===ne.activeLabel){Oe=rt;break}}var ht=Gt(Gt({},He),{},{x:He.left,y:He.top}),vt=Math.min(Ke,ht.x+ht.width),mt=Math.min(Ye,ht.y+ht.height),ct=lt[Oe]&&lt[Oe].value,Vt=MD(Y.state,Y.props.data,Oe),xr=lt[Oe]?{x:le==="horizontal"?lt[Oe].coordinate:vt,y:le==="horizontal"?mt:lt[Oe].coordinate}:pre;Y.setState(Gt(Gt({},ne),{},{activeLabel:ct,activeCoordinate:xr,activePayload:Vt,activeTooltipIndex:Oe}))}else Y.setState(ne)}),dn(Y,"renderCursor",function(ne){var se,le=Y.state,ge=le.isTooltipActive,je=le.activeCoordinate,ze=le.activePayload,Ce=le.offset,Ke=le.activeTooltipIndex,Ye=le.tooltipAxisBandSize,Oe=Y.getTooltipEventType(),tt=(se=ne.props.active)!==null&&se!==void 0?se:ge,He=Y.props.layout,lt=ne.key||"_recharts-cursor";return Ne.createElement(hGe,{key:lt,activeCoordinate:je,activePayload:ze,activeTooltipIndex:Ke,chartName:t,element:ne,isActive:tt,layout:He,offset:Ce,tooltipAxisBandSize:Ye,tooltipEventType:Oe})}),dn(Y,"renderPolarAxis",function(ne,se,le){var ge=fl(ne,"type.axisType"),je=fl(Y.state,"".concat(ge,"Map")),ze=ne.type.defaultProps,Ce=ze!==void 0?Gt(Gt({},ze),ne.props):ne.props,Ke=je&&je[Ce["".concat(ge,"Id")]];return Z.cloneElement(ne,Gt(Gt({},Ke),{},{className:Hn(ge,Ke.className),key:ne.key||"".concat(se,"-").concat(le),ticks:_h(Ke,!0)}))}),dn(Y,"renderPolarGrid",function(ne){var se=ne.props,le=se.radialLines,ge=se.polarAngles,je=se.polarRadius,ze=Y.state,Ce=ze.radiusAxisMap,Ke=ze.angleAxisMap,Ye=Yd(Ce),Oe=Yd(Ke),tt=Oe.cx,He=Oe.cy,lt=Oe.innerRadius,rt=Oe.outerRadius;return Z.cloneElement(ne,{polarAngles:Array.isArray(ge)?ge:_h(Oe,!0).map(function(ht){return ht.coordinate}),polarRadius:Array.isArray(je)?je:_h(Ye,!0).map(function(ht){return ht.coordinate}),cx:tt,cy:He,innerRadius:lt,outerRadius:rt,key:ne.key||"polar-grid",radialLines:le})}),dn(Y,"renderLegend",function(){var ne=Y.state.formattedGraphicalItems,se=Y.props,le=se.children,ge=se.width,je=se.height,ze=Y.props.margin||{},Ce=ge-(ze.left||0)-(ze.right||0),Ke=Zee({children:le,formattedGraphicalItems:ne,legendWidth:Ce,legendContent:v});if(!Ke)return null;var Ye=Ke.item,Oe=Hq(Ke,dGe);return Z.cloneElement(Ye,Gt(Gt({},Oe),{},{chartWidth:ge,chartHeight:je,margin:ze,onBBoxUpdate:Y.handleLegendBBoxUpdate}))}),dn(Y,"renderTooltip",function(){var ne,se=Y.props,le=se.children,ge=se.accessibilityLayer,je=al(le,Ns);if(!je)return null;var ze=Y.state,Ce=ze.isTooltipActive,Ke=ze.activeCoordinate,Ye=ze.activePayload,Oe=ze.activeLabel,tt=ze.offset,He=(ne=je.props.active)!==null&&ne!==void 0?ne:Ce;return Z.cloneElement(je,{viewBox:Gt(Gt({},tt),{},{x:tt.left,y:tt.top}),active:He,label:Oe,payload:He?Ye:[],coordinate:Ke,accessibilityLayer:ge})}),dn(Y,"renderBrush",function(ne){var se=Y.props,le=se.margin,ge=se.data,je=Y.state,ze=je.offset,Ce=je.dataStartIndex,Ke=je.dataEndIndex,Ye=je.updateId;return Z.cloneElement(ne,{key:ne.key||"_recharts-brush",onChange:n2(Y.handleBrushChange,ne.props.onChange),data:ge,x:fr(ne.props.x)?ne.props.x:ze.left,y:fr(ne.props.y)?ne.props.y:ze.top+ze.height+ze.brushBottom-(le.bottom||0),width:fr(ne.props.width)?ne.props.width:ze.width,startIndex:Ce,endIndex:Ke,updateId:"brush-".concat(Ye)})}),dn(Y,"renderReferenceElement",function(ne,se,le){if(!ne)return null;var ge=Y,je=ge.clipPathId,ze=Y.state,Ce=ze.xAxisMap,Ke=ze.yAxisMap,Ye=ze.offset,Oe=ne.type.defaultProps||{},tt=ne.props,He=tt.xAxisId,lt=He===void 0?Oe.xAxisId:He,rt=tt.yAxisId,ht=rt===void 0?Oe.yAxisId:rt;return Z.cloneElement(ne,{key:ne.key||"".concat(se,"-").concat(le),xAxis:Ce[lt],yAxis:Ke[ht],viewBox:{x:Ye.left,y:Ye.top,width:Ye.width,height:Ye.height},clipPathId:je})}),dn(Y,"renderActivePoints",function(ne){var se=ne.item,le=ne.activePoint,ge=ne.basePoint,je=ne.childIndex,ze=ne.isRange,Ce=[],Ke=se.props.key,Ye=se.item.type.defaultProps!==void 0?Gt(Gt({},se.item.type.defaultProps),se.item.props):se.item.props,Oe=Ye.activeDot,tt=Ye.dataKey,He=Gt(Gt({index:je,dataKey:tt,cx:le.x,cy:le.y,r:4,fill:Jz(se.item),strokeWidth:2,stroke:"#fff",payload:le.payload,value:le.value},Sn(Oe,!1)),AE(Oe));return Ce.push(G.renderActiveDot(Oe,He,"".concat(Ke,"-activePoint-").concat(je))),ge?Ce.push(G.renderActiveDot(Oe,Gt(Gt({},He),{},{cx:ge.x,cy:ge.y}),"".concat(Ke,"-basePoint-").concat(je))):ze&&Ce.push(null),Ce}),dn(Y,"renderGraphicChild",function(ne,se,le){var ge=Y.filterFormatItem(ne,se,le);if(!ge)return null;var je=Y.getTooltipEventType(),ze=Y.state,Ce=ze.isTooltipActive,Ke=ze.tooltipAxis,Ye=ze.activeTooltipIndex,Oe=ze.activeLabel,tt=Y.props.children,He=al(tt,Ns),lt=ge.props,rt=lt.points,ht=lt.isRange,vt=lt.baseLine,mt=ge.item.type.defaultProps!==void 0?Gt(Gt({},ge.item.type.defaultProps),ge.item.props):ge.item.props,ct=mt.activeDot,Vt=mt.hide,xr=mt.activeBar,tn=mt.activeShape,Er=!!(!Vt&&Ce&&He&&(ct||xr||tn)),Ft={};je!=="axis"&&He&&He.props.trigger==="click"?Ft={onClick:n2(Y.handleItemMouseEnter,ne.props.onClick)}:je!=="axis"&&(Ft={onMouseLeave:n2(Y.handleItemMouseLeave,ne.props.onMouseLeave),onMouseEnter:n2(Y.handleItemMouseEnter,ne.props.onMouseEnter)});var br=Z.cloneElement(ne,Gt(Gt({},ge.props),Ft));function Yt(Bi){return typeof Ke.dataKey=="function"?Ke.dataKey(Bi.payload):null}if(Er)if(Ye>=0){var Qt,Sr;if(Ke.dataKey&&!Ke.allowDuplicatedCategory){var Ut=typeof Ke.dataKey=="function"?Yt:"payload.".concat(Ke.dataKey.toString());Qt=oR(rt,Ut,Oe),Sr=ht&&vt&&oR(vt,Ut,Oe)}else Qt=rt?.[Ye],Sr=ht&&vt&&vt[Ye];if(tn||xr){var Nn=ne.props.activeIndex!==void 0?ne.props.activeIndex:Ye;return[Z.cloneElement(ne,Gt(Gt(Gt({},ge.props),Ft),{},{activeIndex:Nn})),null,null]}if(!ni(Qt))return[br].concat(W_(Y.renderActivePoints({item:ge,activePoint:Qt,basePoint:Sr,childIndex:Ye,isRange:ht})))}else{var Jr,Kr=(Jr=Y.getItemByXY(Y.state.activeCoordinate))!==null&&Jr!==void 0?Jr:{graphicalItem:br},In=Kr.graphicalItem,Fi=In.item,$o=Fi===void 0?ne:Fi,Co=In.childIndex,Hi=Gt(Gt(Gt({},ge.props),Ft),{},{activeIndex:Co});return[Z.cloneElement($o,Hi),null,null]}return ht?[br,null,null]:[br,null]}),dn(Y,"renderCustomized",function(ne,se,le){return Z.cloneElement(ne,Gt(Gt({key:"recharts-customized-".concat(le)},Y.props),Y.state))}),dn(Y,"renderMap",{CartesianGrid:{handler:l2,once:!0},ReferenceArea:{handler:Y.renderReferenceElement},ReferenceLine:{handler:l2},ReferenceDot:{handler:Y.renderReferenceElement},XAxis:{handler:l2},YAxis:{handler:l2},Brush:{handler:Y.renderBrush,once:!0},Bar:{handler:Y.renderGraphicChild},Line:{handler:Y.renderGraphicChild},Area:{handler:Y.renderGraphicChild},Radar:{handler:Y.renderGraphicChild},RadialBar:{handler:Y.renderGraphicChild},Scatter:{handler:Y.renderGraphicChild},Pie:{handler:Y.renderGraphicChild},Funnel:{handler:Y.renderGraphicChild},Tooltip:{handler:Y.renderCursor,once:!0},PolarGrid:{handler:Y.renderPolarGrid,once:!0},PolarAngleAxis:{handler:Y.renderPolarAxis},PolarRadiusAxis:{handler:Y.renderPolarAxis},Customized:{handler:Y.renderCustomized}}),Y.clipPathId="".concat((U=V.id)!==null&&U!==void 0?U:a1("recharts"),"-clip"),Y.throttleTriggeredAfterMouseMove=qQ(Y.triggeredAfterMouseMove,(X=V.throttleDelay)!==null&&X!==void 0?X:1e3/60),Y.state={},Y}return TGe(G,N),xGe(G,[{key:"componentDidMount",value:function(){var V,U;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(V=this.props.margin.left)!==null&&V!==void 0?V:0,top:(U=this.props.margin.top)!==null&&U!==void 0?U:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var V=this.props,U=V.children,X=V.data,Y=V.height,ne=V.layout,se=al(U,Ns);if(se){var le=se.props.defaultIndex;if(!(typeof le!="number"||le<0||le>this.state.tooltipTicks.length-1)){var ge=this.state.tooltipTicks[le]&&this.state.tooltipTicks[le].value,je=MD(this.state,X,le,ge),ze=this.state.tooltipTicks[le].coordinate,Ce=(this.state.offset.top+Y)/2,Ke=ne==="horizontal",Ye=Ke?{x:ze,y:Ce}:{y:ze,x:Ce},Oe=this.state.formattedGraphicalItems.find(function(He){var lt=He.item;return lt.type.name==="Scatter"});Oe&&(Ye=Gt(Gt({},Ye),Oe.props.points[le].tooltipPosition),je=Oe.props.points[le].tooltipPayload);var tt={activeTooltipIndex:le,isTooltipActive:!0,activeLabel:ge,activePayload:je,activeCoordinate:Ye};this.setState(tt),this.renderCursor(se),this.accessibilityManager.setIndex(le)}}}},{key:"getSnapshotBeforeUpdate",value:function(V,U){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==U.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==V.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==V.margin){var X,Y;this.accessibilityManager.setDetails({offset:{left:(X=this.props.margin.left)!==null&&X!==void 0?X:0,top:(Y=this.props.margin.top)!==null&&Y!==void 0?Y:0}})}return null}},{key:"componentDidUpdate",value:function(V){sR([al(V.children,Ns)],[al(this.props.children,Ns)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var V=al(this.props.children,Ns);if(V&&typeof V.props.shared=="boolean"){var U=V.props.shared?"axis":"item";return p.indexOf(U)>=0?U:c}return c}},{key:"getMouseInfo",value:function(V){if(!this.container)return null;var U=this.container,X=U.getBoundingClientRect(),Y=jDe(X),ne={chartX:Math.round(V.pageX-Y.left),chartY:Math.round(V.pageY-Y.top)},se=X.width/U.offsetWidth||1,le=this.inRange(ne.chartX,ne.chartY,se);if(!le)return null;var ge=this.state,je=ge.xAxisMap,ze=ge.yAxisMap,Ce=this.getTooltipEventType(),Ke=Zq(this.state,this.props.data,this.props.layout,le);if(Ce!=="axis"&&je&&ze){var Ye=Yd(je).scale,Oe=Yd(ze).scale,tt=Ye&&Ye.invert?Ye.invert(ne.chartX):null,He=Oe&&Oe.invert?Oe.invert(ne.chartY):null;return Gt(Gt({},ne),{},{xValue:tt,yValue:He},Ke)}return Ke?Gt(Gt({},ne),Ke):null}},{key:"inRange",value:function(V,U){var X=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,Y=this.props.layout,ne=V/X,se=U/X;if(Y==="horizontal"||Y==="vertical"){var le=this.state.offset,ge=ne>=le.left&&ne<=le.left+le.width&&se>=le.top&&se<=le.top+le.height;return ge?{x:ne,y:se}:null}var je=this.state,ze=je.angleAxisMap,Ce=je.radiusAxisMap;if(ze&&Ce){var Ke=Yd(ze);return wG({x:ne,y:se},Ke)}return null}},{key:"parseEventsOfWrapper",value:function(){var V=this.props.children,U=this.getTooltipEventType(),X=al(V,Ns),Y={};X&&U==="axis"&&(X.props.trigger==="click"?Y={onClick:this.handleClick}:Y={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var ne=AE(this.props,this.handleOuterEvent);return Gt(Gt({},ne),Y)}},{key:"addListener",value:function(){QI.on(eO,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){QI.removeListener(eO,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(V,U,X){for(var Y=this.state.formattedGraphicalItems,ne=0,se=Y.length;ne<se;ne++){var le=Y[ne];if(le.item===V||le.props.key===V.key||U===xh(le.item.type)&&X===le.childIndex)return le}return null}},{key:"renderClipPath",value:function(){var V=this.clipPathId,U=this.state.offset,X=U.left,Y=U.top,ne=U.height,se=U.width;return Ne.createElement("defs",null,Ne.createElement("clipPath",{id:V},Ne.createElement("rect",{x:X,y:Y,height:ne,width:se})))}},{key:"getXScales",value:function(){var V=this.state.xAxisMap;return V?Object.entries(V).reduce(function(U,X){var Y=qq(X,2),ne=Y[0],se=Y[1];return Gt(Gt({},U),{},dn({},ne,se.scale))},{}):null}},{key:"getYScales",value:function(){var V=this.state.yAxisMap;return V?Object.entries(V).reduce(function(U,X){var Y=qq(X,2),ne=Y[0],se=Y[1];return Gt(Gt({},U),{},dn({},ne,se.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(V){var U;return(U=this.state.xAxisMap)===null||U===void 0||(U=U[V])===null||U===void 0?void 0:U.scale}},{key:"getYScaleByAxisId",value:function(V){var U;return(U=this.state.yAxisMap)===null||U===void 0||(U=U[V])===null||U===void 0?void 0:U.scale}},{key:"getItemByXY",value:function(V){var U=this.state,X=U.formattedGraphicalItems,Y=U.activeItem;if(X&&X.length)for(var ne=0,se=X.length;ne<se;ne++){var le=X[ne],ge=le.props,je=le.item,ze=je.type.defaultProps!==void 0?Gt(Gt({},je.type.defaultProps),je.props):je.props,Ce=xh(je.type);if(Ce==="Bar"){var Ke=(ge.data||[]).find(function(He){return w4e(V,He)});if(Ke)return{graphicalItem:le,payload:Ke}}else if(Ce==="RadialBar"){var Ye=(ge.data||[]).find(function(He){return wG(V,He)});if(Ye)return{graphicalItem:le,payload:Ye}}else if(mC(le,Y)||gC(le,Y)||Rw(le,Y)){var Oe=uUe({graphicalItem:le,activeTooltipItem:Y,itemData:ze.data}),tt=ze.activeIndex===void 0?Oe:ze.activeIndex;return{graphicalItem:Gt(Gt({},le),{},{childIndex:tt}),payload:Rw(le,Y)?ze.data[Oe]:le.props.data[Oe]}}}return null}},{key:"render",value:function(){var V=this;if(!h8(this))return null;var U=this.props,X=U.children,Y=U.className,ne=U.width,se=U.height,le=U.style,ge=U.compact,je=U.title,ze=U.desc,Ce=Hq(U,fGe),Ke=Sn(Ce,!1);if(ge)return Ne.createElement(Mq,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ne.createElement(cR,qy({},Ke,{width:ne,height:se,title:je,desc:ze}),this.renderClipPath(),f8(X,this.renderMap)));if(this.props.accessibilityLayer){var Ye,Oe;Ke.tabIndex=(Ye=this.props.tabIndex)!==null&&Ye!==void 0?Ye:0,Ke.role=(Oe=this.props.role)!==null&&Oe!==void 0?Oe:"application",Ke.onKeyDown=function(He){V.accessibilityManager.keyboardEvent(He)},Ke.onFocus=function(){V.accessibilityManager.focus()}}var tt=this.parseEventsOfWrapper();return Ne.createElement(Mq,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ne.createElement("div",qy({className:Hn("recharts-wrapper",Y),style:Gt({position:"relative",cursor:"default",width:ne,height:se},le)},tt,{ref:function(He){V.container=He}}),Ne.createElement(cR,qy({},Ke,{width:ne,height:se,title:je,desc:ze,style:MGe}),this.renderClipPath(),f8(X,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(Z.Component);dn(D,"displayName",t),dn(D,"defaultProps",Gt({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},T)),dn(D,"getDerivedStateFromProps",function(N,G){var V=N.dataKey,U=N.data,X=N.children,Y=N.width,ne=N.height,se=N.layout,le=N.stackOffset,ge=N.margin,je=G.dataStartIndex,ze=G.dataEndIndex;if(G.updateId===void 0){var Ce=Kq(N);return Gt(Gt(Gt({},Ce),{},{updateId:0},O(Gt(Gt({props:N},Ce),{},{updateId:0}),G)),{},{prevDataKey:V,prevData:U,prevWidth:Y,prevHeight:ne,prevLayout:se,prevStackOffset:le,prevMargin:ge,prevChildren:X})}if(V!==G.prevDataKey||U!==G.prevData||Y!==G.prevWidth||ne!==G.prevHeight||se!==G.prevLayout||le!==G.prevStackOffset||!o_(ge,G.prevMargin)){var Ke=Kq(N),Ye={chartX:G.chartX,chartY:G.chartY,isTooltipActive:G.isTooltipActive},Oe=Gt(Gt({},Zq(G,U,se)),{},{updateId:G.updateId+1}),tt=Gt(Gt(Gt({},Ke),Ye),Oe);return Gt(Gt(Gt({},tt),O(Gt({props:N},tt),G)),{},{prevDataKey:V,prevData:U,prevWidth:Y,prevHeight:ne,prevLayout:se,prevStackOffset:le,prevMargin:ge,prevChildren:X})}if(!sR(X,G.prevChildren)){var He,lt,rt,ht,vt=al(X,L_),mt=vt&&(He=(lt=vt.props)===null||lt===void 0?void 0:lt.startIndex)!==null&&He!==void 0?He:je,ct=vt&&(rt=(ht=vt.props)===null||ht===void 0?void 0:ht.endIndex)!==null&&rt!==void 0?rt:ze,Vt=mt!==je||ct!==ze,xr=!ni(U),tn=xr&&!Vt?G.updateId:G.updateId+1;return Gt(Gt({updateId:tn},O(Gt(Gt({props:N},G),{},{updateId:tn,dataStartIndex:mt,dataEndIndex:ct}),G)),{},{prevChildren:X,dataStartIndex:mt,dataEndIndex:ct})}return null}),dn(D,"renderActiveDot",function(N,G,V){var U;return Z.isValidElement(N)?U=Z.cloneElement(N,G):Pn(N)?U=N(G):U=Ne.createElement(eN,G),Ne.createElement(Li,{className:"recharts-active-dot",key:V},U)});var B=Z.forwardRef(function(N,G){return Ne.createElement(D,qy({},N,{ref:G}))});return B.displayName=D.displayName,B},ID=gre({chartName:"BarChart",GraphicalChild:Lh,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:$_},{axisType:"yAxis",AxisComp:q_}],formatAxisMap:VVe}),OD=gre({chartName:"PieChart",GraphicalChild:Vh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:pC},{axisType:"radiusAxis",AxisComp:dC}],formatAxisMap:LFe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const BGe=({className:e})=>{const{filteredPreschools:t,searchFilters:r}=vo(),[n,c]=Z.useState(!1),h=Z.useMemo(()=>{const w=t.filter(U=>U.latitud&&U.longitud),T=w.length,M=w.reduce((U,X)=>U+(X.antal_barn||0),0),O=w.filter(U=>U.huvudman==="Kommunal").length,D=w.filter(U=>U.huvudman==="Enskild").length,B=w.filter(U=>U.andel_med_förskollärarexamen).reduce((U,X)=>U+(X.andel_med_förskollärarexamen||0),0)/w.filter(U=>U.andel_med_förskollärarexamen).length||0,N=w.filter(U=>U.personaltäthet).reduce((U,X)=>U+(X.personaltäthet||0),0)/w.filter(U=>U.personaltäthet).length||0,G=w.filter(U=>U.google_rating).reduce((U,X)=>U+(X.google_rating||0),0)/w.filter(U=>U.google_rating).length||0,V=w.filter(U=>U.google_rating).length;return{totalPreschools:T,totalChildren:M,kommunalCount:O,enskildCount:D,avgTeacherEducation:B,avgStaffDensity:N,avgRating:G,ratedCount:V,preschools:w}},[t]),p=()=>r.kommuner&&r.kommuner.length>0?`Statistik för ${r.kommuner.length===1?r.kommuner[0]:`${r.kommuner.length} kommuner`}`:r.nearbyMode?"Statistik för närområdet":r.query?`Statistik för "${r.query}"`:"Statistik för alla förskolor",o=[{name:"Kommunal",value:h.kommunalCount,color:"hsl(210, 85%, 60%)"},{name:"Fristående",value:h.enskildCount,color:"hsl(25, 85%, 60%)"}],v=Z.useMemo(()=>{const w=[{name:"90-100%",min:90,max:100,count:0},{name:"80-89%",min:80,max:89,count:0},{name:"70-79%",min:70,max:79,count:0},{name:"60-69%",min:60,max:69,count:0},{name:"<60%",min:0,max:59,count:0}];return h.preschools.forEach(T=>{if(T.andel_med_förskollärarexamen){const M=w.find(O=>T.andel_med_förskollärarexamen>=O.min&&T.andel_med_förskollärarexamen<=O.max);M&&M.count++}}),w.filter(T=>T.count>0)},[h.preschools]);return n?C.jsx(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`absolute bottom-4 left-4 z-30 w-96 max-h-[calc(100vh-2rem)] ${e}`,children:C.jsxs(kn,{className:"glass-card border-0 shadow-lg h-full flex flex-col",children:[C.jsx(r_,{className:"pb-4",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx(n_,{className:"text-lg font-heading font-semibold text-foreground",children:p()}),C.jsx("p",{className:"text-sm text-muted-foreground",children:"Översikt och jämförelser"})]}),C.jsx(qr,{onClick:()=>c(!1),variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:C.jsx(Zw,{className:"h-3 w-3"})})]})}),C.jsx(Cl,{className:"flex-1 overflow-hidden",children:C.jsxs(Z3,{defaultValue:"overview",className:"h-full flex flex-col",children:[C.jsxs(_k,{className:"grid w-full grid-cols-3",children:[C.jsx(Su,{value:"overview",children:"Översikt"}),C.jsx(Su,{value:"quality",children:"Kvalitet"}),C.jsx(Su,{value:"distribution",children:"Fördelning"})]}),C.jsxs("div",{className:"flex-1 overflow-y-auto mt-4",children:[C.jsxs(Tu,{value:"overview",className:"space-y-4 mt-0",children:[C.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[C.jsx(kn,{className:"bg-gradient-to-br from-bubble-kommunal/10 to-bubble-kommunal/5 border-bubble-kommunal/20",children:C.jsx(Cl,{className:"p-3",children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(sm,{className:"h-4 w-4 text-bubble-kommunal"}),C.jsxs("div",{children:[C.jsx("p",{className:"text-xs text-muted-foreground",children:"Förskolor"}),C.jsx("p",{className:"text-lg font-bold text-bubble-kommunal",children:h.totalPreschools})]})]})})}),C.jsx(kn,{className:"bg-gradient-to-br from-bubble-enskild/10 to-bubble-enskild/5 border-bubble-enskild/20",children:C.jsx(Cl,{className:"p-3",children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(Rm,{className:"h-4 w-4 text-bubble-enskild"}),C.jsxs("div",{children:[C.jsx("p",{className:"text-xs text-muted-foreground",children:"Barn totalt"}),C.jsx("p",{className:"text-lg font-bold text-bubble-enskild",children:h.totalChildren})]})]})})}),h.avgRating>0&&C.jsx(kn,{className:"bg-gradient-to-br from-bubble-high-rating/10 to-bubble-high-rating/5 border-bubble-high-rating/20",children:C.jsx(Cl,{className:"p-3",children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(bs,{className:"h-4 w-4 text-bubble-high-rating"}),C.jsxs("div",{children:[C.jsx("p",{className:"text-xs text-muted-foreground",children:"Snittbetyg"}),C.jsx("p",{className:"text-lg font-bold text-bubble-high-rating",children:h.avgRating.toFixed(1)})]})]})})}),h.avgTeacherEducation>0&&C.jsx(kn,{className:"bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20",children:C.jsx(Cl,{className:"p-3",children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(K9,{className:"h-4 w-4 text-primary"}),C.jsxs("div",{children:[C.jsx("p",{className:"text-xs text-muted-foreground",children:"Förskollärare"}),C.jsxs("p",{className:"text-lg font-bold text-primary",children:[Math.round(h.avgTeacherEducation),"%"]})]})]})})})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("span",{className:"text-sm text-muted-foreground",children:"Kommunal vs Fristående"}),C.jsxs("div",{className:"flex gap-1",children:[C.jsxs(sn,{variant:"outline",className:"text-xs bg-bubble-kommunal/10 text-bubble-kommunal border-bubble-kommunal/20",children:[h.kommunalCount," kommunal"]}),C.jsxs(sn,{variant:"outline",className:"text-xs bg-bubble-enskild/10 text-bubble-enskild border-bubble-enskild/20",children:[h.enskildCount," fristående"]})]})]}),h.avgStaffDensity>0&&C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("span",{className:"text-sm text-muted-foreground",children:"Snitt personaltäthet"}),C.jsxs("span",{className:"text-sm font-medium",children:[h.avgStaffDensity.toFixed(1)," barn/personal"]})]}),h.ratedCount>0&&C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("span",{className:"text-sm text-muted-foreground",children:"Förskolor med betyg"}),C.jsxs("span",{className:"text-sm font-medium",children:[h.ratedCount," av ",h.totalPreschools]})]})]})]}),C.jsxs(Tu,{value:"quality",className:"space-y-4 mt-0",children:[v.length>0&&C.jsxs(kn,{children:[C.jsx(r_,{className:"pb-2",children:C.jsx(n_,{className:"text-sm",children:"Fördelning förskollärare med examen"})}),C.jsx(Cl,{children:C.jsx(Ab,{width:"100%",height:200,children:C.jsxs(ID,{data:v,children:[C.jsx(uN,{strokeDasharray:"3 3",opacity:.3}),C.jsx($_,{dataKey:"name",fontSize:10}),C.jsx(q_,{fontSize:10}),C.jsx(Ns,{}),C.jsx(Lh,{dataKey:"count",fill:"hsl(130, 70%, 60%)",radius:[2,2,0,0]})]})})})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsx("h4",{className:"font-medium text-sm",children:"Kvalitetsinsikter"}),h.avgTeacherEducation>=80&&C.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-bubble-high-rating/10 border border-bubble-high-rating/20",children:[C.jsx(jm,{className:"h-4 w-4 text-bubble-high-rating mt-0.5"}),C.jsxs("div",{children:[C.jsx("p",{className:"text-sm font-medium text-bubble-high-rating",children:"Hög kvalitet"}),C.jsxs("p",{className:"text-xs text-muted-foreground",children:["Området har en hög andel förskollärare med examen (",Math.round(h.avgTeacherEducation),"%)."]})]})]}),h.avgRating>=4.5&&C.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-yellow-50 border border-yellow-200",children:[C.jsx(bs,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),C.jsxs("div",{children:[C.jsx("p",{className:"text-sm font-medium text-yellow-700",children:"Högt betyg"}),C.jsxs("p",{className:"text-xs text-muted-foreground",children:["Förskolor i området har utmärkta betyg (",h.avgRating.toFixed(1),"/5)."]})]})]})]})]}),C.jsx(Tu,{value:"distribution",className:"space-y-4 mt-0",children:o.some(w=>w.value>0)&&C.jsxs(kn,{children:[C.jsx(r_,{className:"pb-2",children:C.jsx(n_,{className:"text-sm",children:"Kommunal vs Fristående"})}),C.jsxs(Cl,{children:[C.jsx(Ab,{width:"100%",height:200,children:C.jsxs(OD,{children:[C.jsx(OD,{data:o,dataKey:"value",cx:"50%",cy:"50%",outerRadius:80,children:o.map((w,T)=>C.jsx(l1,{fill:w.color},`cell-${T}`))}),C.jsx(Ns,{})]})}),C.jsx("div",{className:"flex justify-center gap-4 mt-2",children:o.map(w=>C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:w.color}}),C.jsxs("span",{className:"text-xs text-muted-foreground",children:[w.name," (",w.value,")"]})]},w.name))})]})]})})]})]})})]})}):C.jsx(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`absolute bottom-4 left-4 z-30 ${e}`,children:C.jsx(kn,{className:"glass-card border-0 shadow-lg hover-lift-subtle cursor-pointer",onClick:()=>c(!0),children:C.jsx(Cl,{className:"p-4",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx(Ah,{className:"h-5 w-5 text-primary"}),C.jsxs("div",{children:[C.jsx("h3",{className:"font-heading font-semibold text-sm text-foreground",children:p()}),C.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.totalPreschools," förskolor • ",h.totalChildren," barn"]})]}),C.jsx(qA,{className:"h-4 w-4 text-muted-foreground ml-auto"})]})})})})},hN=Z.forwardRef(({className:e,type:t,...r},n)=>C.jsx("input",{type:t,className:ln("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));hN.displayName="Input";var UGe="Separator",Yq="horizontal",VGe=["horizontal","vertical"],yre=Z.forwardRef((e,t)=>{const{decorative:r,orientation:n=Yq,...c}=e,h=$Ge(n)?n:Yq,p=r?{role:"none"}:{"aria-orientation":h==="vertical"?h:void 0,role:"separator"};return C.jsx(fn.div,{"data-orientation":h,...p,...c,ref:t})});yre.displayName=UGe;function $Ge(e){return VGe.includes(e)}var _re=yre;const Hp=Z.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},c)=>C.jsx(_re,{ref:c,decorative:r,orientation:t,className:ln("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));Hp.displayName=_re.displayName;const GGe=()=>{const e=Z.useRef(new Map),[t,r]=Z.useState(!1),n=30*60*1e3,c=Z.useCallback(async o=>{const v=Date.now(),w=e.current.get(o);if(w&&v<w.expiry)return w.data;r(!0);try{const{data:T,error:M}=await gn.from("preschool_images").select("image_url").eq("preschool_id",o).eq("image_type","google_places").order("created_at");if(M)return console.error("Error fetching images:",M),[];const O=T?.map(D=>D.image_url)||[];return e.current.set(o,{data:O,timestamp:v,expiry:v+n}),O}catch(T){return console.error("Error in image cache:",T),[]}finally{r(!1)}},[]),h=Z.useCallback(async o=>{const v=o.map(w=>c(w));await Promise.allSettled(v)},[c]),p=Z.useCallback(()=>{e.current.clear()},[]);return{getImages:c,preloadImages:h,clearCache:p,isLoading:t}},qGe=({preschoolId:e,preschoolName:t,streetViewPanoId:r,lat:n,lng:c})=>{const[h,p]=Z.useState([]),[o,v]=Z.useState(0),[w,T]=Z.useState(!1),[M,O]=Z.useState(!0),{getImages:D}=GGe();Z.useEffect(()=>{(async()=>{O(!0);try{const X=[...await D(e)];if(r&&n&&c){const Y=`https://maps.googleapis.com/maps/api/streetview?size=800x600&location=${n},${c}&fov=90&pitch=0&key=demo`;X.push(Y)}p(X)}catch(X){console.error("Error loading images:",X)}finally{O(!1)}})()},[e,r,n,c,D]);const B=()=>{v(X=>(X+1)%h.length)},N=()=>{v(X=>(X-1+h.length)%h.length)},G=()=>{T(!0)},V=()=>{T(!1)},U=()=>{if(n&&c){const X=`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${n},${c}`;window.open(X,"_blank")}};return M?C.jsxs("div",{className:"space-y-2",children:[C.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[C.jsx(Ws,{className:"h-4 w-4"}),"Bilder"]}),C.jsx("div",{className:"w-full h-48 bg-muted rounded-lg animate-pulse flex items-center justify-center",children:C.jsx("span",{className:"text-sm text-muted-foreground",children:"Laddar bilder..."})})]}):h.length===0?C.jsxs("div",{className:"space-y-2",children:[C.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[C.jsx(Ws,{className:"h-4 w-4"}),"Bilder"]}),C.jsx("div",{className:"w-full h-32 bg-muted/30 rounded-lg flex items-center justify-center",children:C.jsx("span",{className:"text-sm text-muted-foreground",children:"Inga bilder tillgängliga"})})]}):C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:"space-y-2",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[C.jsx(Ws,{className:"h-4 w-4"}),"Bilder"]}),h.length>1&&C.jsxs(sn,{variant:"secondary",className:"text-xs",children:[o+1," / ",h.length]})]}),C.jsxs("div",{className:"relative group",children:[C.jsx("div",{className:"w-full h-48 bg-muted rounded-lg overflow-hidden cursor-pointer",onClick:G,children:C.jsx("img",{src:h[o],alt:`${t} - Bild ${o+1}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",onError:X=>{console.error("Failed to load image:",h[o]),X.currentTarget.src="/placeholder.svg"}})}),h.length>1&&C.jsxs(C.Fragment,{children:[C.jsx(qr,{variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white hover:bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity",onClick:X=>{X.stopPropagation(),N()},children:C.jsx(tj,{className:"h-4 w-4"})}),C.jsx(qr,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white hover:bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity",onClick:X=>{X.stopPropagation(),B()},children:C.jsx(rj,{className:"h-4 w-4"})})]}),r&&o===h.length-1&&C.jsxs(qr,{variant:"ghost",size:"sm",className:"absolute bottom-2 right-2 bg-black/50 text-white hover:bg-black/70 text-xs",onClick:X=>{X.stopPropagation(),U()},children:[C.jsx($ce,{className:"h-3 w-3 mr-1"}),"Street View"]})]}),h.length>1&&C.jsx("div",{className:"flex gap-1 overflow-x-auto",children:h.map((X,Y)=>C.jsx("button",{className:`flex-shrink-0 w-12 h-12 rounded border-2 overflow-hidden transition-all ${Y===o?"border-primary":"border-transparent hover:border-muted-foreground/50"}`,onClick:()=>v(Y),children:C.jsx("img",{src:X,alt:`Thumbnail ${Y+1}`,className:"w-full h-full object-cover",onError:ne=>{ne.currentTarget.src="/placeholder.svg"}})},Y))})]}),C.jsx(Tc,{children:w&&C.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center",onClick:V,children:C.jsxs(Fr.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:"relative max-w-6xl max-h-[90vh] w-full h-full flex items-center justify-center",onClick:X=>X.stopPropagation(),children:[C.jsx("img",{src:h[o],alt:`${t} - Fullscreen`,className:"max-w-full max-h-full object-contain"}),C.jsx(qr,{variant:"ghost",size:"sm",className:"absolute top-4 right-4 text-white hover:bg-white/20",onClick:V,children:C.jsx(Qa,{className:"h-6 w-6"})}),h.length>1&&C.jsxs(C.Fragment,{children:[C.jsx(qr,{variant:"ghost",size:"sm",className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20",onClick:N,children:C.jsx(tj,{className:"h-8 w-8"})}),C.jsx(qr,{variant:"ghost",size:"sm",className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20",onClick:B,children:C.jsx(rj,{className:"h-8 w-8"})})]}),C.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white text-sm",children:[o+1," / ",h.length]})]})})})]})},HGe=({reviews:e,rating:t,reviewsCount:r})=>{const[n,c]=Z.useState(!1),[h,p]=Z.useState(null),o=Z.useMemo(()=>{if(!e)return[];try{return typeof e=="string"?JSON.parse(e):e}catch(B){return console.error("Error parsing reviews:",B),[]}},[e]),v=Z.useMemo(()=>{if(!o.length)return[];let B=o;return h!==null&&(B=B.filter(N=>N.rating===h)),B.sort((N,G)=>G.time-N.time)},[o,h]),w=n?v:v.slice(0,3),T=Z.useMemo(()=>{if(!o.length)return{};const B={};return o.forEach(N=>{B[N.rating]=(B[N.rating]||0)+1}),B},[o]),M=Z.useMemo(()=>o.length?o.reduce((B,N)=>B+N.rating,0)/o.length:t||0,[o,t]),O=B=>B.replace("a day ago","för en dag sedan").replace("days ago","dagar sedan").replace("a week ago","för en vecka sedan").replace("weeks ago","veckor sedan").replace("a month ago","för en månad sedan").replace("months ago","månader sedan").replace("a year ago","för ett år sedan").replace("years ago","år sedan"),D=(B,N="sm")=>{const G=N==="sm"?"h-3 w-3":"h-4 w-4";return C.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(V=>C.jsx(bs,{className:`${G} ${V<=B?"fill-yellow-400 text-yellow-400":"text-muted-foreground/30"}`},V))})};return!o.length&&!t?C.jsxs("div",{className:"space-y-2",children:[C.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[C.jsx(_6,{className:"h-4 w-4"}),"Recensioner"]}),C.jsx("div",{className:"bg-muted/30 rounded-lg p-3 text-center",children:C.jsx("p",{className:"text-sm text-muted-foreground",children:"Inga recensioner tillgängliga"})})]}):C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[C.jsx(_6,{className:"h-4 w-4"}),"Recensioner"]}),o.length>0&&C.jsxs(sn,{variant:"secondary",className:"text-xs",children:[v.length," av ",o.length]})]}),(t||M>0)&&C.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-3",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[D(M,"md"),C.jsx("span",{className:"font-semibold text-lg",children:M.toFixed(1)})]}),r&&C.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",r," recensioner)"]})]}),Object.keys(T).length>0&&C.jsx("div",{className:"space-y-1",children:[5,4,3,2,1].map(B=>{const N=T[B]||0,G=o.length>0?N/o.length*100:0;return C.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[C.jsx("span",{className:"w-3 text-muted-foreground",children:B}),C.jsx(bs,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),C.jsx("div",{className:"flex-1 bg-muted rounded-full h-1.5",children:C.jsx("div",{className:"bg-yellow-400 h-1.5 rounded-full transition-all duration-300",style:{width:`${G}%`}})}),C.jsx("span",{className:"w-6 text-muted-foreground",children:N})]},B)})})]}),o.length>0&&C.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[C.jsxs(qr,{variant:h===null?"default":"outline",size:"sm",onClick:()=>p(null),className:"flex-shrink-0",children:[C.jsx(Gce,{className:"h-3 w-3 mr-1"}),"Alla"]}),[5,4,3,2,1].map(B=>{const N=T[B]||0;return N===0?null:C.jsxs(qr,{variant:h===B?"default":"outline",size:"sm",onClick:()=>p(B),className:"flex-shrink-0",children:[B," ",C.jsx(bs,{className:"h-3 w-3 ml-1 fill-current"}),C.jsxs("span",{className:"ml-1 text-xs",children:["(",N,")"]})]},B)})]}),v.length>0&&C.jsxs("div",{className:"space-y-3",children:[C.jsx(Tc,{children:w.map((B,N)=>C.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:N*.1},className:"bg-muted/20 rounded-lg p-3 space-y-2",children:[C.jsxs("div",{className:"flex items-start justify-between",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[B.profile_photo_url&&C.jsx("img",{src:B.profile_photo_url,alt:B.author_name,className:"w-6 h-6 rounded-full",onError:G=>{G.currentTarget.style.display="none"}}),C.jsxs("div",{children:[C.jsx("p",{className:"font-medium text-sm",children:B.author_name}),C.jsx("p",{className:"text-xs text-muted-foreground",children:O(B.relative_time_description)})]})]}),D(B.rating)]}),C.jsx("p",{className:"text-sm leading-relaxed",children:B.text}),C.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[C.jsx(eue,{className:"h-3 w-3"}),C.jsx("span",{children:"Hjälpsam"})]})]},`${B.author_name}-${B.time}`))}),v.length>3&&C.jsxs(qr,{variant:"outline",size:"sm",onClick:()=>c(!n),className:"w-full",children:[n?"Visa färre":`Visa alla ${v.length} recensioner`,C.jsx(jm,{className:"h-3 w-3 ml-1"})]})]}),v.length===0&&h!==null&&C.jsx("div",{className:"bg-muted/30 rounded-lg p-3 text-center",children:C.jsxs("p",{className:"text-sm text-muted-foreground",children:["Inga recensioner med ",h," stjärnor"]})})]})},WGe=()=>{const[e,t]=Z.useState({totalPreschools:0,enrichedPreschools:0,coveragePercentage:0,recentlyUpdated:0,needingUpdate:0}),[r,n]=Z.useState(!0),[c,h]=Z.useState(new Map),p=Z.useCallback(async M=>{if(c.has(M))return c.get(M)||null;try{const{data:O,error:D}=await gn.from("preschool_google_data").select("*").eq("preschool_id",M).maybeSingle();return D?(console.error("Error fetching Google data:",D),null):(O&&(c.set(M,O),h(new Map(c))),O)}catch(O){return console.error("Error in getGoogleData:",O),null}},[c]),o=Z.useCallback(async M=>{try{const O=M.filter(G=>!c.has(G));if(O.length===0)return;const{data:D,error:B}=await gn.from("preschool_google_data").select("*").in("preschool_id",O);if(B){console.error("Error preloading Google data:",B);return}const N=new Map(c);D?.forEach(G=>{N.set(G.preschool_id,G)}),h(N)}catch(O){console.error("Error in preloadGoogleData:",O)}},[c]),v=Z.useCallback(async()=>{n(!0);try{const{count:M}=await gn.from("Förskolor").select("*",{count:"exact",head:!0}).not("Latitud","is",null),{count:O}=await gn.from("preschool_google_data").select("*",{count:"exact",head:!0}),D=new Date;D.setDate(D.getDate()-7);const{count:B}=await gn.from("preschool_google_data").select("*",{count:"exact",head:!0}).gte("last_updated",D.toISOString()),N=new Date;N.setDate(N.getDate()-30);const{count:G}=await gn.from("preschool_google_data").select("*",{count:"exact",head:!0}).lt("last_updated",N.toISOString()),V=M||0,U=O||0,X=V>0?Math.round(U/V*100):0;t({totalPreschools:V,enrichedPreschools:U,coveragePercentage:X,recentlyUpdated:B||0,needingUpdate:(G||0)+(V-U)})}catch(M){console.error("Error refreshing stats:",M)}finally{n(!1)}},[]),w=Z.useCallback(async M=>{try{if(M&&M.length>0)for(const O of M.slice(0,10)){const{data:D}=await gn.from("Förskolor").select('id, "Namn", "Adress", "Latitud", "Longitud"').eq("id",O).single();D&&await gn.functions.invoke("google-places-enricher",{body:{preschoolId:D.id,lat:D.Latitud,lng:D.Longitud,address:D.Adress,name:D.Namn}})}else await gn.functions.invoke("google-places-enricher",{body:{batch:!0}});h(new Map),await v()}catch(O){console.error("Error triggering enrichment:",O)}},[v]),T=Z.useCallback(()=>{h(new Map)},[]);return Z.useEffect(()=>{v()},[v]),{stats:e,isLoading:r,getGoogleData:p,preloadGoogleData:o,refreshStats:v,triggerEnrichment:w,clearCache:T}},vre=({preschool:e,onBack:t,nationalAverage:r})=>{const[n,c]=Z.useState(null),{getGoogleData:h}=WGe();Z.useEffect(()=>{(async()=>{const T=await h(e.id);c(T)})()},[e.id,h]);const p=T=>{switch(T){case"Kommunal":return{label:"Kommunal förskola",color:"bg-blue-500/10 text-blue-700 border-blue-200",icon:C.jsx(sm,{className:"h-3 w-3"})};case"Enskild":return{label:"Fristående förskola",color:"bg-green-500/10 text-green-700 border-green-200",icon:C.jsx(sm,{className:"h-3 w-3"})};default:return{label:T,color:"bg-gray-500/10 text-gray-700 border-gray-200",icon:C.jsx(sm,{className:"h-3 w-3"})}}},o=T=>T?T>=80?"Utmärkt":T>=65?"Bra":T>=50?"Medel":"Under medel":"Ingen data",v=T=>T?C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(M=>C.jsx(bs,{className:`h-4 w-4 ${M<=T?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},M))}),C.jsx("span",{className:"font-medium",children:T.toFixed(1)}),e.google_reviews_count&&C.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",e.google_reviews_count," recensioner)"]})]}):null,w=p(e.huvudman);return C.jsx(Fr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"absolute right-4 top-4 z-30 w-80 max-h-[calc(100vh-2rem)]",children:C.jsxs(kn,{className:"glass-card border-0 shadow-lg h-full flex flex-col",children:[C.jsx(r_,{className:"p-4 border-b border-border/20",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx(qr,{onClick:t,variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:C.jsx(Lce,{className:"h-4 w-4"})}),C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsx(n_,{className:"text-lg font-heading truncate",children:e.namn}),C.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[C.jsx(Ws,{className:"h-3 w-3"}),C.jsx("span",{children:e.kommun})]})]})]})}),C.jsxs(Cl,{className:"p-4 flex-1 overflow-y-auto space-y-4",children:[C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs(sn,{className:w.color,children:[w.icon,C.jsx("span",{className:"ml-1",children:w.label})]}),(n?.google_rating||e.google_rating)&&C.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[C.jsx(bs,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),C.jsx("span",{className:"font-medium",children:(n?.google_rating||e.google_rating)?.toFixed(1)})]})]}),e.adress&&C.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[C.jsx(Ws,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),C.jsx("span",{children:e.adress})]})]}),C.jsx(Hp,{}),(n?.google_rating||e.google_rating)&&C.jsxs("div",{className:"space-y-2",children:[C.jsx("h4",{className:"font-medium text-sm",children:"Betyg"}),v(n?.google_rating||e.google_rating),r&&(n?.google_rating||e.google_rating)>r.avgRating&&C.jsxs("p",{className:"text-xs text-green-600",children:["Över riksgenomsnittet (",r.avgRating.toFixed(1),")"]})]}),e.antal_barn&&C.jsxs("div",{className:"space-y-2",children:[C.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[C.jsx(eW,{className:"h-4 w-4"}),"Barn och personal"]}),C.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Antal barn:"}),C.jsx("span",{className:"font-medium",children:e.antal_barn})]}),e.antal_barngrupper&&C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Barngrupper:"}),C.jsx("span",{className:"font-medium",children:e.antal_barngrupper})]}),e.personaltäthet&&C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-muted-foreground",children:"Personaltäthet:"}),C.jsxs("span",{className:"font-medium",children:[e.personaltäthet.toFixed(1)," barn/tjänst"]})]})]})]}),e.andel_med_förskollärarexamen&&C.jsxs("div",{className:"space-y-2",children:[C.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[C.jsx(BL,{className:"h-4 w-4"}),"Kvalitet"]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs("div",{className:"flex justify-between text-sm",children:[C.jsx("span",{className:"text-muted-foreground",children:"Förskollärare:"}),C.jsxs("span",{className:"font-medium",children:[Math.round(e.andel_med_förskollärarexamen),"%"]})]}),C.jsx("div",{className:"flex-1 bg-muted rounded-full h-2",children:C.jsx("div",{className:"bg-gradient-primary h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,e.andel_med_förskollärarexamen)}%`}})}),C.jsxs("p",{className:"text-xs text-muted-foreground",children:["Kvalitetsnivå: ",o(e.andel_med_förskollärarexamen)]}),r&&e.andel_med_förskollärarexamen>r.avgTeacherExam&&C.jsxs("p",{className:"text-xs text-green-600",children:["Över riksgenomsnittet (",r.avgTeacherExam,"%)"]})]})]}),(n?.contact_phone||n?.website_url||e.contact_phone||e.website_url)&&C.jsxs(C.Fragment,{children:[C.jsx(Hp,{}),C.jsxs("div",{className:"space-y-2",children:[C.jsx("h4",{className:"font-medium text-sm",children:"Kontakt"}),C.jsxs("div",{className:"space-y-2",children:[(n?.contact_phone||e.contact_phone)&&C.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[C.jsx(Yce,{className:"h-4 w-4 text-muted-foreground"}),C.jsx("a",{href:`tel:${n?.contact_phone||e.contact_phone}`,className:"text-primary hover:underline",children:n?.contact_phone||e.contact_phone})]}),(n?.website_url||e.website_url)&&C.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[C.jsx(Z9,{className:"h-4 w-4 text-muted-foreground"}),C.jsx("a",{href:n?.website_url||e.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline truncate",children:"Webbsida"})]})]})]})]}),(n?.opening_hours||e.opening_hours)&&C.jsxs(C.Fragment,{children:[C.jsx(Hp,{}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[C.jsx(UL,{className:"h-4 w-4"}),"Öppettider"]}),C.jsx("div",{className:"text-sm",children:typeof(n?.opening_hours||e.opening_hours)=="object"?C.jsx("div",{className:"space-y-1",children:Object.entries(n?.opening_hours||e.opening_hours).map(([T,M])=>C.jsxs("div",{className:"flex justify-between",children:[C.jsxs("span",{className:"text-muted-foreground capitalize",children:[T,":"]}),C.jsx("span",{children:M})]},T))}):C.jsx("p",{className:"text-muted-foreground",children:n?.opening_hours||e.opening_hours})})]})]}),C.jsx(Hp,{}),C.jsx(qGe,{preschoolId:e.id,preschoolName:e.namn,streetViewPanoId:n?.street_view_pano_id,lat:e.latitud,lng:e.longitud}),C.jsx(Hp,{}),C.jsx(HGe,{reviews:n?.reviews,rating:n?.google_rating||e.google_rating,reviewsCount:n?.google_reviews_count||e.google_reviews_count}),C.jsx(Hp,{}),C.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2",children:[C.jsx("h4",{className:"font-medium text-sm",children:"Sammanfattning"}),C.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[C.jsxs("div",{className:"flex flex-col",children:[C.jsx("span",{className:"text-muted-foreground",children:"Typ"}),C.jsx("span",{className:"font-medium",children:e.huvudman})]}),C.jsxs("div",{className:"flex flex-col",children:[C.jsx("span",{className:"text-muted-foreground",children:"Barn"}),C.jsx("span",{className:"font-medium",children:e.antal_barn||"Ej angivet"})]}),C.jsxs("div",{className:"flex flex-col",children:[C.jsx("span",{className:"text-muted-foreground",children:"Betyg"}),C.jsx("span",{className:"font-medium",children:n?.google_rating||e.google_rating?`${(n?.google_rating||e.google_rating).toFixed(1)} ⭐`:"Inget betyg"})]}),C.jsxs("div",{className:"flex flex-col",children:[C.jsx("span",{className:"text-muted-foreground",children:"Kvalitet"}),C.jsx("span",{className:"font-medium",children:e.andel_med_förskollärarexamen?o(e.andel_med_förskollärarexamen):"Ingen data"})]})]})]})]})]})})},ZGe=Object.freeze(Object.defineProperty({__proto__:null,PreschoolDetailsPanel:vre},Symbol.toStringTag,{value:"Module"})),xre=Z.memo(({preschool:e,index:t,onPreschoolClick:r,onFavorite:n,onCompare:c,onShowDetails:h,isFavorite:p,isInComparison:o,comparisonFull:v})=>{const w=Z.useCallback(M=>{if(!M)return null;const O=M>=4.5?"text-green-600":M>=4?"text-yellow-600":"text-orange-600";return C.jsxs("div",{className:`flex items-center gap-1 ${O}`,children:[C.jsx(bs,{className:"h-3 w-3 fill-current"}),C.jsx("span",{className:"text-xs font-medium",children:M.toFixed(1)})]})},[]),T=Z.useCallback(M=>M==="Kommunal"?"bg-blue-500/10 text-blue-700 border-blue-200":"bg-green-500/10 text-green-700 border-green-200",[]);return C.jsx(Fr.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:Math.min(t*.01,.2)},layout:!0,children:C.jsx(kn,{className:"hover-lift-subtle cursor-pointer border border-border/30 bg-background/50 relative transition-all duration-200",children:C.jsx(Cl,{className:"p-3",children:C.jsxs("div",{className:"space-y-2",children:[C.jsxs("div",{className:"flex items-start justify-between gap-2",children:[C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsx("h4",{className:"font-medium text-sm text-foreground truncate hover:text-primary cursor-pointer transition-colors duration-200",onClick:()=>r(e),title:e.namn,children:e.namn}),C.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[C.jsx(Ws,{className:"h-3 w-3 text-muted-foreground"}),C.jsx("span",{className:"text-xs text-muted-foreground truncate",children:e.kommun})]})]}),w(e.google_rating)]}),C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(sn,{variant:"outline",className:`text-xs px-1.5 py-0.5 ${T(e.huvudman)}`,children:e.huvudman==="Enskild"?"Fristående":e.huvudman}),e.antal_barn&&C.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[C.jsx(eW,{className:"h-3 w-3"}),C.jsx("span",{className:"text-xs",children:e.antal_barn})]})]}),C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx(qr,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-primary/10 transition-colors duration-200",onClick:M=>n(e.id,M),children:C.jsx(X9,{className:`h-3 w-3 transition-colors duration-200 ${p?"fill-red-500 text-red-500":""}`})}),C.jsx(qr,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-primary/10 transition-colors duration-200",onClick:M=>c(e.id,M),disabled:v&&!o,children:C.jsx(Dce,{className:`h-3 w-3 transition-colors duration-200 ${o?"fill-blue-500 text-blue-500":""}`})}),C.jsx(qr,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-primary/10 transition-colors duration-200",onClick:()=>h(e),children:C.jsx($L,{className:"h-3 w-3"})})]})]}),e.andel_med_förskollärarexamen&&C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx("div",{className:"flex-1 bg-muted rounded-full h-1.5",children:C.jsx("div",{className:"bg-gradient-primary h-1.5 rounded-full transition-all duration-500",style:{width:`${Math.min(100,e.andel_med_förskollärarexamen)}%`}})}),C.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(e.andel_med_förskollärarexamen),"% förskollärare"]})]})]})})})})});xre.displayName="PreschoolListItem";const bre=Z.memo(({items:e,onPreschoolClick:t,onFavorite:r,onCompare:n,onShowDetails:c,favorites:h,comparison:p})=>{const o=Z.useRef(null),[v,w]=Z.useState({start:0,end:20}),T=120,M=5;Z.useEffect(()=>{const N=o.current;if(!N)return;const G=()=>{const V=N.scrollTop,U=N.clientHeight,X=Math.max(0,Math.floor(V/T)-M),Y=Math.min(e.length,Math.ceil((V+U)/T)+M);w({start:X,end:Y})};return N.addEventListener("scroll",G,{passive:!0}),G(),()=>N.removeEventListener("scroll",G)},[e.length]);const O=e.slice(v.start,v.end),D=v.start*T,B=e.length*T;return C.jsx("div",{ref:o,className:"overflow-y-auto max-h-[calc(100vh-16rem)] relative",children:C.jsx("div",{style:{height:B,position:"relative"},children:C.jsx("div",{style:{transform:`translateY(${D}px)`},children:C.jsx("div",{className:"space-y-2 p-2",children:O.map((N,G)=>C.jsx(xre,{preschool:N,index:v.start+G,onPreschoolClick:t,onFavorite:r,onCompare:n,onShowDetails:c,isFavorite:h.has(N.id),isInComparison:p.has(N.id),comparisonFull:p.size>=3},N.id))})})})})});bre.displayName="VirtualizedList";const KGe=({className:e})=>{const{filteredPreschools:t,visiblePreschools:r,searchFilters:n,setSelectedPreschool:c,setMapCenter:h,setMapZoom:p,preschools:o,listContext:v,setListContext:w}=vo(),[T,M]=Z.useState(!1),[O,D]=Z.useState(null),[B,N]=Z.useState(""),[G,V]=Z.useState("rating"),[U,X]=Z.useState(new Set),[Y,ne]=Z.useState(new Set),[se,le]=Z.useState(!0),ge=V3(B,300);Z.useEffect(()=>{console.log(`👁️ Viewport visibility changed - viewportOnly: ${se}, visible count: ${r.length}`)},[se,r.length]);const je=Z.useMemo(()=>(console.log(`📊 List data source update - viewportOnly: ${se}, visible: ${r.length}, filtered: ${t.length}`),se?r:t),[se,r,t]),ze=Z.useMemo(()=>{const lt=performance.now();let rt=[...je].filter(vt=>vt.latitud&&vt.longitud);if(ge){const vt=ge.toLowerCase();rt=rt.filter(mt=>mt.namn.toLowerCase().includes(vt)||mt.kommun.toLowerCase().includes(vt)||mt.adress?.toLowerCase().includes(vt))}rt.sort((vt,mt)=>{switch(G){case"rating":return(mt.google_rating||0)-(vt.google_rating||0);case"name":return vt.namn.localeCompare(mt.namn);case"children":return(mt.antal_barn||0)-(vt.antal_barn||0);case"quality":return(mt.andel_med_förskollärarexamen||0)-(vt.andel_med_förskollärarexamen||0);default:return 0}});const ht=performance.now();return console.log(`🔄 List processed: ${rt.length} items (from ${je.length} source) - viewport: ${se} - search: "${ge}" - sort: ${G}`),ht-lt>10&&console.log(`⚠️ List processing took ${ht-lt}ms for ${rt.length} items`),rt},[je,ge,G]),Ce=Z.useCallback(lt=>{lt.longitud&&lt.latitud&&(c(lt),h([lt.longitud,lt.latitud]),p(15))},[c,h,p]),Ke=Z.useCallback((lt,rt)=>{rt.stopPropagation(),X(ht=>{const vt=new Set(ht);return vt.has(lt)?vt.delete(lt):vt.add(lt),vt})},[]),Ye=Z.useCallback((lt,rt)=>{rt.stopPropagation(),ne(ht=>{const vt=new Set(ht);return vt.has(lt)?vt.delete(lt):vt.size<3&&vt.add(lt),vt})},[]),Oe=()=>se?"Synliga på kartan":n.kommuner&&n.kommuner.length>0?`Förskolor i ${n.kommuner.join(", ")}`:n.nearbyMode?"Närliggande förskolor":n.query?`Sökresultat för "${n.query}"`:"Alla förskolor",tt=()=>{const lt=ze.length,rt=je.length,ht=t.length;return B?se?`${lt} träffar på kartan (av ${rt} synliga)`:`${lt} sökträffar (av ${ht} filtrerade)`:se?`${lt} synliga på kartan (av ${ht} totalt)`:`${lt} förskolor`},He=Z.useMemo(()=>{if(o.length===0)return;const lt=o.filter(mt=>mt.antal_barn).map(mt=>mt.antal_barn),rt=o.filter(mt=>mt.personaltäthet).map(mt=>mt.personaltäthet),ht=o.filter(mt=>mt.andel_med_förskollärarexamen).map(mt=>mt.andel_med_förskollärarexamen),vt=o.filter(mt=>mt.google_rating).map(mt=>mt.google_rating);return{avgChildren:lt.length>0?Math.round(lt.reduce((mt,ct)=>mt+ct,0)/lt.length):0,avgStaff:rt.length>0?rt.reduce((mt,ct)=>mt+ct,0)/rt.length:0,avgTeacherExam:ht.length>0?Math.round(ht.reduce((mt,ct)=>mt+ct,0)/ht.length):0,avgRating:vt.length>0?vt.reduce((mt,ct)=>mt+ct,0)/vt.length:0}},[o]);return O?C.jsx(vre,{preschool:O,onBack:()=>D(null),nationalAverage:He}):C.jsx(Fr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:`absolute right-4 top-4 z-30 w-80 max-h-[calc(100vh-2rem)] ${e}`,children:C.jsxs(kn,{className:"glass-card border-0 shadow-lg h-full flex flex-col",children:[C.jsxs("div",{className:"p-4 border-b border-border/20",children:[C.jsxs("div",{className:"flex items-center justify-between mb-3",children:[C.jsxs("div",{children:[C.jsx("h3",{className:"font-heading font-semibold text-sm text-foreground",children:Oe()}),C.jsx("p",{className:"text-xs text-muted-foreground",children:tt()})]}),C.jsx(qr,{onClick:()=>M(!T),variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:T?C.jsx(Zw,{className:"h-3 w-3"}):C.jsx(qA,{className:"h-3 w-3"})})]}),!T&&C.jsxs("div",{className:"space-y-2",children:[C.jsx(hN,{placeholder:"Sök i listan...",value:B,onChange:lt=>N(lt.target.value),className:"h-8 text-xs"}),C.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[C.jsxs("select",{value:G,onChange:lt=>V(lt.target.value),className:"text-xs p-1 rounded border bg-background",children:[C.jsx("option",{value:"rating",children:"Betyg"}),C.jsx("option",{value:"name",children:"Namn"}),C.jsx("option",{value:"children",children:"Antal barn"}),C.jsx("option",{value:"quality",children:"Kvalitet"})]}),C.jsx(qr,{size:"sm",variant:se?"default":"outline",onClick:()=>le(!se),className:"text-xs h-6 px-2",children:se?"Endast karta":"Alla"}),Y.size>0&&C.jsxs(sn,{variant:"secondary",className:"text-xs",children:["Jämför (",Y.size,")"]})]})]})]}),C.jsx(Tc,{children:!T&&C.jsx(Fr.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"flex-1 overflow-hidden",children:ze.length>0?C.jsx(bre,{items:ze,onPreschoolClick:Ce,onFavorite:Ke,onCompare:Ye,onShowDetails:D,favorites:U,comparison:Y}):C.jsx("div",{className:"text-center py-8",children:C.jsx("p",{className:"text-muted-foreground text-sm",children:B?"Inga förskolor matchar sökningen.":se?"Inga förskolor synliga i kartvy.":"Inga förskolor hittades med de valda filtren."})})})})]})})},XGe=()=>{const{selectedPreschool:e}=vo();Z.useEffect(()=>{if(e){const r=`Förskola vald: ${e.namn} i ${e.kommun}`;t(r)}},[e]);const t=r=>{const n=document.createElement("div");n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","true"),n.className="sr-only",n.textContent=r,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},1e3)};return Z.useEffect(()=>{const r=document.createElement("div");r.className="skip-links",r.innerHTML=`
      <a href="#main-content" class="skip-link">Hoppa till huvudinnehåll</a>
      <a href="#search-filters" class="skip-link">Hoppa till sökfilter</a>
      <a href="#map" class="skip-link">Hoppa till karta</a>
    `;const n=document.createElement("style");return n.textContent=`
      .skip-links {
        position: fixed;
        top: -100px;
        left: 0;
        z-index: 9999;
      }
      
      .skip-link {
        position: absolute;
        left: -10000px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
        background: var(--primary);
        color: var(--primary-foreground);
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 4px;
        font-weight: 500;
      }
      
      .skip-link:focus {
        position: static;
        left: auto;
        width: auto;
        height: auto;
        overflow: visible;
        margin: 8px;
        outline: 2px solid var(--ring);
        outline-offset: 2px;
      }
      
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    `,document.head.appendChild(n),document.body.prepend(r),()=>{document.body.contains(r)&&document.body.removeChild(r),document.head.contains(n)&&document.head.removeChild(n)}},[]),Z.useEffect(()=>{const r=n=>{if(n.key==="Escape"){const c=new CustomEvent("closeAllPanels");document.dispatchEvent(c)}if(n.key==="f"&&n.ctrlKey){n.preventDefault();const c=document.querySelector('input[placeholder*="kommun"]');c&&c.focus()}};return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[]),null},YGe=({className:e})=>{const{searchFilters:t,clearSpecificFilter:r,clearFilters:n}=vo(),c=()=>{const o=[];return t.kommuner&&t.kommuner.length>0&&t.kommuner.forEach(v=>{o.push({key:`kommun-${v}`,label:v,value:v})}),t.huvudman&&t.huvudman!=="alla"&&o.push({key:"huvudman",label:t.huvudman==="Enskild"?"Fristående":t.huvudman,value:t.huvudman}),t.query&&o.push({key:"query",label:`Sökning: "${t.query}"`,value:t.query}),t.nearbyMode&&o.push({key:"nearby",label:`Närområde (${t.radius?Math.round(t.radius/1e3):2} km)`,value:"nearby"}),t.maxChildren&&t.maxChildren<200&&o.push({key:"maxChildren",label:`Max ${t.maxChildren} barn`,value:t.maxChildren}),t.minPersonaltäthet&&o.push({key:"minPersonaltäthet",label:`Personal ≥ ${t.minPersonaltäthet}`,value:t.minPersonaltäthet}),t.minExamen&&o.push({key:"minExamen",label:`Examen ≥ ${t.minExamen}%`,value:t.minExamen}),o},h=(o,v)=>{if(o.startsWith("kommun-")){const w=v,T=t.kommuner?.filter(M=>M!==w);T&&T.length>0?(r("kommuner"),setTimeout(()=>{vo.getState().setSearchFilters({kommuner:T})},0)):r("kommuner")}else r(o==="nearby"?"nearbyMode":o)},p=c();return p.length===0?null:C.jsxs("div",{className:`flex flex-wrap items-center gap-1 ${e}`,children:[p.map(o=>C.jsxs(sn,{variant:"secondary",className:"flex items-center gap-1 pr-1 pl-2 py-1",children:[C.jsx("span",{className:"text-xs",children:o.label}),C.jsx(qr,{size:"sm",variant:"ghost",onClick:()=>h(o.key,o.value),className:"h-3 w-3 p-0 hover:bg-destructive/20 ml-1",title:`Ta bort filter: ${o.label}`,children:C.jsx(Qa,{className:"h-2 w-2"})})]},o.key)),p.length>1&&C.jsx(qr,{size:"sm",variant:"ghost",onClick:n,className:"h-6 px-2 text-xs text-muted-foreground hover:text-destructive ml-1",children:"Rensa alla"})]})},Jq=["Ale","Alingsås","Alvesta","Aneby","Arboga","Arjeplog","Arvidsjaur","Arvika","Askersund","Avesta","Bengtsfors","Berg","Bjurholm","Bjuv","Boden","Bollebygd","Bollnäs","Borgholm","Borlänge","Borås","Botkyrka","Boxholm","Bromölla","Bräcke","Burlöv","Båstad","Dals-Ed","Danderyd","Degerfors","Dorotea","Eda","Ekerö","Eksjö","Emmaboda","Enköping","Eskilstuna","Eslöv","Essunga","Fagersta","Falkenberg","Falköping","Falun","Filipstad","Finspång","Flen","Forshaga","Färgelanda","Gagnef","Gislaved","Gnesta","Gnosjö","Gotland","Grums","Grästorp","Gullspång","Gällivare","Gävle","Göteborg","Götene","Habo","Hagfors","Hallsberg","Hallstahammar","Halmstad","Hammarö","Haninge","Haparanda","Heby","Hedemora","Helsingborg","Herrljunga","Hjo","Hofors","Huddinge","Hudiksvall","Hultsfred","Hylte","Håbo","Hällefors","Härjedalen","Härnösand","Härryda","Hässleholm","Höganäs","Högsby","Hörby","Höör","Jokkmokk","Järfälla","Jönköping","Kalix","Kalmar","Karlsborg","Karlshamn","Karlskoga","Karlskrona","Karlstad","Katrineholm","Kil","Kinda","Kiruna","Klippan","Knivsta","Kramfors","Kristianstad","Kristinehamn","Krokom","Kumla","Kungsbacka","Kungsör","Kungälv","Kävlinge","Köping","Laholm","Landskrona","Laxå","Lekeberg","Leksand","Lerum","Lessebo","Lidingö","Lidköping","Lilla Edet","Lindesberg","Linköping","Ljungby","Ljusdal","Ljusnarsberg","Lomma","Ludvika","Luleå","Lund","Lycksele","Lysekil","Malmö","Malung-Sälen","Malå","Mariefred","Markaryd","Mariestad","Mark","Mellerud","Mjölby","Mora","Motala","Mullsjö","Munkedal","Munkfors","Mölndal","Mönsterås","Mörbylånga","Nacka","Nora","Norberg","Nordanstig","Nordmaling","Norrköping","Norrtälje","Norsjö","Nybro","Nykvarn","Nyköping","Nynäshamn","Nässjö","Ockelbo","Olofström","Orsa","Orust","Osby","Oskarshamn","Ovanåker","Oxelösund","Pajala","Partille","Perstorp","Piteå","Ragunda","Robertsfors","Ronneby","Rättvik","Sala","Salem","Sandviken","Sigtuna","Simrishamn","Sjöbo","Skara","Skellefteå","Skinnskatteberg","Skurup","Skövde","Smedjebacken","Sollefteå","Sollentuna","Solna","Sorsele","Sotenäs","Staffanstorp","Stenungsund","Stockholm","Storfors","Storuman","Strängnäs","Strömstad","Strömsund","Sundbyberg","Sundsvall","Sunne","Surahammar","Svalöv","Svedala","Svenljunga","Säffle","Säter","Sävsjö","Söderhamn","Söderköping","Södertälje","Sölvesborg","Tanum","Tibro","Tidaholm","Tierp","Timrå","Tingsryd","Tjörn","Tomelilla","Torsby","Torsås","Tranemo","Tranås","Trelleborg","Trollhättan","Trosa","Tyresö","Täby","Töreboda","Uddevalla","Ulricehamn","Umeå","Upplands Väsby","Upplands-Bro","Uppsala","Uppvidinge","Vadstena","Vaggeryd","Valdemarsvik","Vallentuna","Vansbro","Vara","Varberg","Vaxholm","Vellinge","Vetlanda","Vilhelmina","Vimmerby","Vindeln","Vingåker","Vårgårda","Vänersborg","Vännäs","Värmdö","Värnamo","Västervik","Västerås","Växjö","Ydre","Ystad","Åmål","Ånge","Åre","Årjäng","Åsele","Åstorp","Åtvidaberg","Älmhult","Älvdalen","Älvkarleby","Älvsbyn","Ängelholm","Öckerö","Ödeshög","Örebro","Örkelljunga","Örnsköldsvik","Östersund","Österåker","Östhammar","Östra Göinge","Överkalix","Övertorneå"].sort();function zh(e){return Array.isArray?Array.isArray(e):Tre(e)==="[object Array]"}function JGe(e){if(typeof e=="string")return e;let t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function QGe(e){return e==null?"":JGe(e)}function gu(e){return typeof e=="string"}function wre(e){return typeof e=="number"}function eqe(e){return e===!0||e===!1||tqe(e)&&Tre(e)=="[object Boolean]"}function Sre(e){return typeof e=="object"}function tqe(e){return Sre(e)&&e!==null}function ll(e){return e!=null}function rO(e){return!e.trim().length}function Tre(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const rqe="Incorrect 'index' type",nqe=e=>`Invalid value for key ${e}`,iqe=e=>`Pattern length exceeds max of ${e}.`,oqe=e=>`Missing ${e} property in key`,aqe=e=>`Property 'weight' in key '${e}' must be a positive integer`,Qq=Object.prototype.hasOwnProperty;class sqe{constructor(t){this._keys=[],this._keyMap={};let r=0;t.forEach(n=>{let c=Ere(n);this._keys.push(c),this._keyMap[c.id]=c,r+=c.weight}),this._keys.forEach(n=>{n.weight/=r})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ere(e){let t=null,r=null,n=null,c=1,h=null;if(gu(e)||zh(e))n=e,t=eH(e),r=jD(e);else{if(!Qq.call(e,"name"))throw new Error(oqe("name"));const p=e.name;if(n=p,Qq.call(e,"weight")&&(c=e.weight,c<=0))throw new Error(aqe(p));t=eH(p),r=jD(p),h=e.getFn}return{path:t,id:r,weight:c,src:n,getFn:h}}function eH(e){return zh(e)?e:e.split(".")}function jD(e){return zh(e)?e.join("."):e}function lqe(e,t){let r=[],n=!1;const c=(h,p,o)=>{if(ll(h))if(!p[o])r.push(h);else{let v=p[o];const w=h[v];if(!ll(w))return;if(o===p.length-1&&(gu(w)||wre(w)||eqe(w)))r.push(QGe(w));else if(zh(w)){n=!0;for(let T=0,M=w.length;T<M;T+=1)c(w[T],p,o+1)}else p.length&&c(w,p,o+1)}};return c(e,gu(t)?t.split("."):t,0),n?r:r[0]}const cqe={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},uqe={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},hqe={location:0,threshold:.6,distance:100},dqe={useExtendedSearch:!1,getFn:lqe,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var wn={...uqe,...cqe,...hqe,...dqe};const fqe=/[^ ]+/g;function pqe(e=1,t=3){const r=new Map,n=Math.pow(10,t);return{get(c){const h=c.match(fqe).length;if(r.has(h))return r.get(h);const p=1/Math.pow(h,.5*e),o=parseFloat(Math.round(p*n)/n);return r.set(h,o),o},clear(){r.clear()}}}class dN{constructor({getFn:t=wn.getFn,fieldNormWeight:r=wn.fieldNormWeight}={}){this.norm=pqe(r,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((r,n)=>{this._keysMap[r.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,gu(this.docs[0])?this.docs.forEach((t,r)=>{this._addString(t,r)}):this.docs.forEach((t,r)=>{this._addObject(t,r)}),this.norm.clear())}add(t){const r=this.size();gu(t)?this._addString(t,r):this._addObject(t,r)}removeAt(t){this.records.splice(t,1);for(let r=t,n=this.size();r<n;r+=1)this.records[r].i-=1}getValueForItemAtKeyId(t,r){return t[this._keysMap[r]]}size(){return this.records.length}_addString(t,r){if(!ll(t)||rO(t))return;let n={v:t,i:r,n:this.norm.get(t)};this.records.push(n)}_addObject(t,r){let n={i:r,$:{}};this.keys.forEach((c,h)=>{let p=c.getFn?c.getFn(t):this.getFn(t,c.path);if(ll(p)){if(zh(p)){let o=[];const v=[{nestedArrIndex:-1,value:p}];for(;v.length;){const{nestedArrIndex:w,value:T}=v.pop();if(ll(T))if(gu(T)&&!rO(T)){let M={v:T,i:w,n:this.norm.get(T)};o.push(M)}else zh(T)&&T.forEach((M,O)=>{v.push({nestedArrIndex:O,value:M})})}n.$[h]=o}else if(gu(p)&&!rO(p)){let o={v:p,n:this.norm.get(p)};n.$[h]=o}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function Are(e,t,{getFn:r=wn.getFn,fieldNormWeight:n=wn.fieldNormWeight}={}){const c=new dN({getFn:r,fieldNormWeight:n});return c.setKeys(e.map(Ere)),c.setSources(t),c.create(),c}function mqe(e,{getFn:t=wn.getFn,fieldNormWeight:r=wn.fieldNormWeight}={}){const{keys:n,records:c}=e,h=new dN({getFn:t,fieldNormWeight:r});return h.setKeys(n),h.setIndexRecords(c),h}function c2(e,{errors:t=0,currentLocation:r=0,expectedLocation:n=0,distance:c=wn.distance,ignoreLocation:h=wn.ignoreLocation}={}){const p=t/e.length;if(h)return p;const o=Math.abs(n-r);return c?p+o/c:o?1:p}function gqe(e=[],t=wn.minMatchCharLength){let r=[],n=-1,c=-1,h=0;for(let p=e.length;h<p;h+=1){let o=e[h];o&&n===-1?n=h:!o&&n!==-1&&(c=h-1,c-n+1>=t&&r.push([n,c]),n=-1)}return e[h-1]&&h-n>=t&&r.push([n,h-1]),r}const Kp=32;function yqe(e,t,r,{location:n=wn.location,distance:c=wn.distance,threshold:h=wn.threshold,findAllMatches:p=wn.findAllMatches,minMatchCharLength:o=wn.minMatchCharLength,includeMatches:v=wn.includeMatches,ignoreLocation:w=wn.ignoreLocation}={}){if(t.length>Kp)throw new Error(iqe(Kp));const T=t.length,M=e.length,O=Math.max(0,Math.min(n,M));let D=h,B=O;const N=o>1||v,G=N?Array(M):[];let V;for(;(V=e.indexOf(t,B))>-1;){let le=c2(t,{currentLocation:V,expectedLocation:O,distance:c,ignoreLocation:w});if(D=Math.min(le,D),B=V+T,N){let ge=0;for(;ge<T;)G[V+ge]=1,ge+=1}}B=-1;let U=[],X=1,Y=T+M;const ne=1<<T-1;for(let le=0;le<T;le+=1){let ge=0,je=Y;for(;ge<je;)c2(t,{errors:le,currentLocation:O+je,expectedLocation:O,distance:c,ignoreLocation:w})<=D?ge=je:Y=je,je=Math.floor((Y-ge)/2+ge);Y=je;let ze=Math.max(1,O-je+1),Ce=p?M:Math.min(O+je,M)+T,Ke=Array(Ce+2);Ke[Ce+1]=(1<<le)-1;for(let Ye=Ce;Ye>=ze;Ye-=1){let Oe=Ye-1,tt=r[e.charAt(Oe)];if(N&&(G[Oe]=+!!tt),Ke[Ye]=(Ke[Ye+1]<<1|1)&tt,le&&(Ke[Ye]|=(U[Ye+1]|U[Ye])<<1|1|U[Ye+1]),Ke[Ye]&ne&&(X=c2(t,{errors:le,currentLocation:Oe,expectedLocation:O,distance:c,ignoreLocation:w}),X<=D)){if(D=X,B=Oe,B<=O)break;ze=Math.max(1,2*O-B)}}if(c2(t,{errors:le+1,currentLocation:O,expectedLocation:O,distance:c,ignoreLocation:w})>D)break;U=Ke}const se={isMatch:B>=0,score:Math.max(.001,X)};if(N){const le=gqe(G,o);le.length?v&&(se.indices=le):se.isMatch=!1}return se}function _qe(e){let t={};for(let r=0,n=e.length;r<n;r+=1){const c=e.charAt(r);t[c]=(t[c]||0)|1<<n-r-1}return t}const TA=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class kre{constructor(t,{location:r=wn.location,threshold:n=wn.threshold,distance:c=wn.distance,includeMatches:h=wn.includeMatches,findAllMatches:p=wn.findAllMatches,minMatchCharLength:o=wn.minMatchCharLength,isCaseSensitive:v=wn.isCaseSensitive,ignoreDiacritics:w=wn.ignoreDiacritics,ignoreLocation:T=wn.ignoreLocation}={}){if(this.options={location:r,threshold:n,distance:c,includeMatches:h,findAllMatches:p,minMatchCharLength:o,isCaseSensitive:v,ignoreDiacritics:w,ignoreLocation:T},t=v?t:t.toLowerCase(),t=w?TA(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;const M=(D,B)=>{this.chunks.push({pattern:D,alphabet:_qe(D),startIndex:B})},O=this.pattern.length;if(O>Kp){let D=0;const B=O%Kp,N=O-B;for(;D<N;)M(this.pattern.substr(D,Kp),D),D+=Kp;if(B){const G=O-Kp;M(this.pattern.substr(G),G)}}else M(this.pattern,0)}searchIn(t){const{isCaseSensitive:r,ignoreDiacritics:n,includeMatches:c}=this.options;if(t=r?t:t.toLowerCase(),t=n?TA(t):t,this.pattern===t){let N={isMatch:!0,score:0};return c&&(N.indices=[[0,t.length-1]]),N}const{location:h,distance:p,threshold:o,findAllMatches:v,minMatchCharLength:w,ignoreLocation:T}=this.options;let M=[],O=0,D=!1;this.chunks.forEach(({pattern:N,alphabet:G,startIndex:V})=>{const{isMatch:U,score:X,indices:Y}=yqe(t,N,G,{location:h+V,distance:p,threshold:o,findAllMatches:v,minMatchCharLength:w,includeMatches:c,ignoreLocation:T});U&&(D=!0),O+=X,U&&Y&&(M=[...M,...Y])});let B={isMatch:D,score:D?O/this.chunks.length:1};return D&&c&&(B.indices=M),B}}class Mf{constructor(t){this.pattern=t}static isMultiMatch(t){return tH(t,this.multiRegex)}static isSingleMatch(t){return tH(t,this.singleRegex)}search(){}}function tH(e,t){const r=e.match(t);return r?r[1]:null}class vqe extends Mf{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const r=t===this.pattern;return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class xqe extends Mf{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const r=t.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class bqe extends Mf{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const r=t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class wqe extends Mf{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const r=!t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class Sqe extends Mf{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const r=t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class Tqe extends Mf{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const r=!t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class Cre extends Mf{constructor(t,{location:r=wn.location,threshold:n=wn.threshold,distance:c=wn.distance,includeMatches:h=wn.includeMatches,findAllMatches:p=wn.findAllMatches,minMatchCharLength:o=wn.minMatchCharLength,isCaseSensitive:v=wn.isCaseSensitive,ignoreDiacritics:w=wn.ignoreDiacritics,ignoreLocation:T=wn.ignoreLocation}={}){super(t),this._bitapSearch=new kre(t,{location:r,threshold:n,distance:c,includeMatches:h,findAllMatches:p,minMatchCharLength:o,isCaseSensitive:v,ignoreDiacritics:w,ignoreLocation:T})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class Pre extends Mf{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let r=0,n;const c=[],h=this.pattern.length;for(;(n=t.indexOf(this.pattern,r))>-1;)r=n+h,c.push([n,r-1]);const p=!!c.length;return{isMatch:p,score:p?0:1,indices:c}}}const RD=[vqe,Pre,bqe,wqe,Tqe,Sqe,xqe,Cre],rH=RD.length,Eqe=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Aqe="|";function kqe(e,t={}){return e.split(Aqe).map(r=>{let n=r.trim().split(Eqe).filter(h=>h&&!!h.trim()),c=[];for(let h=0,p=n.length;h<p;h+=1){const o=n[h];let v=!1,w=-1;for(;!v&&++w<rH;){const T=RD[w];let M=T.isMultiMatch(o);M&&(c.push(new T(M,t)),v=!0)}if(!v)for(w=-1;++w<rH;){const T=RD[w];let M=T.isSingleMatch(o);if(M){c.push(new T(M,t));break}}}return c})}const Cqe=new Set([Cre.type,Pre.type]);class Pqe{constructor(t,{isCaseSensitive:r=wn.isCaseSensitive,ignoreDiacritics:n=wn.ignoreDiacritics,includeMatches:c=wn.includeMatches,minMatchCharLength:h=wn.minMatchCharLength,ignoreLocation:p=wn.ignoreLocation,findAllMatches:o=wn.findAllMatches,location:v=wn.location,threshold:w=wn.threshold,distance:T=wn.distance}={}){this.query=null,this.options={isCaseSensitive:r,ignoreDiacritics:n,includeMatches:c,minMatchCharLength:h,findAllMatches:o,ignoreLocation:p,location:v,threshold:w,distance:T},t=r?t:t.toLowerCase(),t=n?TA(t):t,this.pattern=t,this.query=kqe(this.pattern,this.options)}static condition(t,r){return r.useExtendedSearch}searchIn(t){const r=this.query;if(!r)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:c,ignoreDiacritics:h}=this.options;t=c?t:t.toLowerCase(),t=h?TA(t):t;let p=0,o=[],v=0;for(let w=0,T=r.length;w<T;w+=1){const M=r[w];o.length=0,p=0;for(let O=0,D=M.length;O<D;O+=1){const B=M[O],{isMatch:N,indices:G,score:V}=B.search(t);if(N){if(p+=1,v+=V,n){const U=B.constructor.type;Cqe.has(U)?o=[...o,...G]:o.push(G)}}else{v=0,p=0,o.length=0;break}}if(p){let O={isMatch:!0,score:v/p};return n&&(O.indices=o),O}}return{isMatch:!1,score:1}}}const DD=[];function Mqe(...e){DD.push(...e)}function LD(e,t){for(let r=0,n=DD.length;r<n;r+=1){let c=DD[r];if(c.condition(e,t))return new c(e,t)}return new kre(e,t)}const EA={AND:"$and",OR:"$or"},zD={PATH:"$path",PATTERN:"$val"},ND=e=>!!(e[EA.AND]||e[EA.OR]),Iqe=e=>!!e[zD.PATH],Oqe=e=>!zh(e)&&Sre(e)&&!ND(e),nH=e=>({[EA.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function Mre(e,t,{auto:r=!0}={}){const n=c=>{let h=Object.keys(c);const p=Iqe(c);if(!p&&h.length>1&&!ND(c))return n(nH(c));if(Oqe(c)){const v=p?c[zD.PATH]:h[0],w=p?c[zD.PATTERN]:c[v];if(!gu(w))throw new Error(nqe(v));const T={keyId:jD(v),pattern:w};return r&&(T.searcher=LD(w,t)),T}let o={children:[],operator:h[0]};return h.forEach(v=>{const w=c[v];zh(w)&&w.forEach(T=>{o.children.push(n(T))})}),o};return ND(e)||(e=nH(e)),n(e)}function jqe(e,{ignoreFieldNorm:t=wn.ignoreFieldNorm}){e.forEach(r=>{let n=1;r.matches.forEach(({key:c,norm:h,score:p})=>{const o=c?c.weight:null;n*=Math.pow(p===0&&o?Number.EPSILON:p,(o||1)*(t?1:h))}),r.score=n})}function Rqe(e,t){const r=e.matches;t.matches=[],ll(r)&&r.forEach(n=>{if(!ll(n.indices)||!n.indices.length)return;const{indices:c,value:h}=n;let p={indices:c,value:h};n.key&&(p.key=n.key.src),n.idx>-1&&(p.refIndex=n.idx),t.matches.push(p)})}function Dqe(e,t){t.score=e.score}function Lqe(e,t,{includeMatches:r=wn.includeMatches,includeScore:n=wn.includeScore}={}){const c=[];return r&&c.push(Rqe),n&&c.push(Dqe),e.map(h=>{const{idx:p}=h,o={item:t[p],refIndex:p};return c.length&&c.forEach(v=>{v(h,o)}),o})}class Pm{constructor(t,r={},n){this.options={...wn,...r},this.options.useExtendedSearch,this._keyStore=new sqe(this.options.keys),this.setCollection(t,n)}setCollection(t,r){if(this._docs=t,r&&!(r instanceof dN))throw new Error(rqe);this._myIndex=r||Are(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){ll(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const r=[];for(let n=0,c=this._docs.length;n<c;n+=1){const h=this._docs[n];t(h,n)&&(this.removeAt(n),n-=1,c-=1,r.push(h))}return r}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:r=-1}={}){const{includeMatches:n,includeScore:c,shouldSort:h,sortFn:p,ignoreFieldNorm:o}=this.options;let v=gu(t)?gu(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return jqe(v,{ignoreFieldNorm:o}),h&&v.sort(p),wre(r)&&r>-1&&(v=v.slice(0,r)),Lqe(v,this._docs,{includeMatches:n,includeScore:c})}_searchStringList(t){const r=LD(t,this.options),{records:n}=this._myIndex,c=[];return n.forEach(({v:h,i:p,n:o})=>{if(!ll(h))return;const{isMatch:v,score:w,indices:T}=r.searchIn(h);v&&c.push({item:h,idx:p,matches:[{score:w,value:h,norm:o,indices:T}]})}),c}_searchLogical(t){const r=Mre(t,this.options),n=(o,v,w)=>{if(!o.children){const{keyId:M,searcher:O}=o,D=this._findMatches({key:this._keyStore.get(M),value:this._myIndex.getValueForItemAtKeyId(v,M),searcher:O});return D&&D.length?[{idx:w,item:v,matches:D}]:[]}const T=[];for(let M=0,O=o.children.length;M<O;M+=1){const D=o.children[M],B=n(D,v,w);if(B.length)T.push(...B);else if(o.operator===EA.AND)return[]}return T},c=this._myIndex.records,h={},p=[];return c.forEach(({$:o,i:v})=>{if(ll(o)){let w=n(r,o,v);w.length&&(h[v]||(h[v]={idx:v,item:o,matches:[]},p.push(h[v])),w.forEach(({matches:T})=>{h[v].matches.push(...T)}))}}),p}_searchObjectList(t){const r=LD(t,this.options),{keys:n,records:c}=this._myIndex,h=[];return c.forEach(({$:p,i:o})=>{if(!ll(p))return;let v=[];n.forEach((w,T)=>{v.push(...this._findMatches({key:w,value:p[T],searcher:r}))}),v.length&&h.push({idx:o,item:p,matches:v})}),h}_findMatches({key:t,value:r,searcher:n}){if(!ll(r))return[];let c=[];if(zh(r))r.forEach(({v:h,i:p,n:o})=>{if(!ll(h))return;const{isMatch:v,score:w,indices:T}=n.searchIn(h);v&&c.push({score:w,key:t,value:h,idx:p,norm:o,indices:T})});else{const{v:h,n:p}=r,{isMatch:o,score:v,indices:w}=n.searchIn(h);o&&c.push({score:v,key:t,value:h,norm:p,indices:w})}return c}}Pm.version="7.1.0";Pm.createIndex=Are;Pm.parseIndex=mqe;Pm.config=wn;Pm.parseQuery=Mre;Mqe(Pqe);const zqe=({className:e})=>{const{preschools:t,searchFilters:r,setSearchFilters:n,clearFilters:c,setMapCenter:h,setMapZoom:p,filteredPreschools:o}=vo(),[v,w]=Z.useState(""),[T,M]=Z.useState(!1),[O,D]=Z.useState(!1),[B,N]=Z.useState(!1),[G,V]=Z.useState([]),[U,X]=Z.useState([]),[Y,ne]=Z.useState(-1),[se,le]=Z.useState(!1),[ge,je]=Z.useState(null),ze=Z.useRef(null),Ce=Z.useRef(null);V3(v,200),Z.useEffect(()=>{const ct=localStorage.getItem("preschool-recent-searches");if(ct)try{X(JSON.parse(ct))}catch(Vt){console.error("Error loading recent searches:",Vt)}},[]);const Ke=Z.useMemo(()=>new Pm(t,{keys:["namn","adress"],threshold:.3,includeScore:!0}),[t]),Ye=Z.useMemo(()=>new Pm(Jq.map(ct=>({name:ct})),{keys:["name"],threshold:.3,includeScore:!0}),[]),Oe=Z.useCallback(ct=>{if(!ct||ct.length<2){V(U.slice(0,5)),N(U.length>0);return}const Vt=[],xr=Ke.search(ct).slice(0,8).map(Ft=>({id:`preschool-${Ft.item.id}`,type:"preschool",title:Ft.item.namn,subtitle:`${Ft.item.kommun} • ${Ft.item.huvudman||"Okänd huvudman"}`,coordinates:Ft.item.longitud&&Ft.item.latitud?[Ft.item.longitud,Ft.item.latitud]:void 0,preschoolId:Ft.item.id}));Vt.push(...xr);const tn=Ye.search(ct).slice(0,5).map(Ft=>{const br=Ft.item.name,Yt=t.filter(Qt=>Qt.kommun===br).length;return{id:`kommun-${br}`,type:"kommun",title:br,subtitle:`${Yt} förskolor`,count:Yt,coordinates:Nqe(br)}});if(Vt.push(...tn),ct.length>3){const Ft=t.filter(br=>br.adress&&br.adress.toLowerCase().includes(ct.toLowerCase())&&br.latitud&&br.longitud).slice(0,3).map(br=>({id:`address-${br.id}`,type:"area",title:br.adress,subtitle:`${br.kommun} • ${br.namn}`,coordinates:[br.longitud,br.latitud],preschoolId:br.id}));Vt.push(...Ft)}const Er=Vt.slice(0,se?Vt.length:10);V(Er),N(Er.length>0)},[Ke,Ye,t,U,se]);Z.useEffect(()=>{Oe(v),v.trim()&&n({query:v})},[v,Oe,n]);const tt=Z.useCallback(ct=>{w(ct.title),N(!1),ne(-1);const Vt=[ct,...U.filter(xr=>xr.id!==ct.id)].slice(0,10);if(X(Vt),localStorage.setItem("preschool-recent-searches",JSON.stringify(Vt)),ct.type==="kommun"){const xr=r.kommuner||[];xr.includes(ct.title)||n({kommuner:[...xr,ct.title]})}else ct.type==="preschool"&&ct.preschoolId?(n({query:ct.title}),ct.coordinates&&(h(ct.coordinates),p(15))):ct.type==="area"&&(n({query:ct.title}),ct.coordinates&&(h(ct.coordinates),p(13)));window.innerWidth<768&&M(!1),ze.current?.blur()},[U,r.kommuner,n,h,p]),He=Z.useCallback(ct=>{if(!(!B||G.length===0))switch(ct.key){case"ArrowDown":ct.preventDefault(),ne(Vt=>Math.min(Vt+1,G.length-1));break;case"ArrowUp":ct.preventDefault(),ne(Vt=>Math.max(Vt-1,-1));break;case"Enter":ct.preventDefault(),Y>=0&&G[Y]&&tt(G[Y]);break;case"Escape":N(!1),ne(-1);break}},[B,G,Y,tt]),lt=Z.useCallback(()=>{D(!0),navigator.geolocation.getCurrentPosition(ct=>{const{latitude:Vt,longitude:xr}=ct.coords,tn=[xr,Vt];je({lat:Vt,lng:xr}),h(tn),p(12),n({radius:2e3,center:tn,nearbyMode:!0}),D(!1)},ct=>{console.error("Error getting location:",ct),D(!1),alert("Kunde inte hämta din position. Kontrollera att du tillåter platsåtkomst.")})},[h,p,n]),rt=Z.useCallback(()=>{w(""),N(!1),V([]),c(),je(null),ne(-1),le(!1)},[c]),ht=Z.useMemo(()=>Object.keys(r).some(ct=>{const Vt=r[ct];return Vt!=null&&(Array.isArray(Vt)||typeof Vt=="string"?Vt.length>0:typeof Vt=="boolean"?Vt:!0)}),[r]),vt=Z.useMemo(()=>Object.keys(r).filter(ct=>{const Vt=r[ct];return Array.isArray(Vt)?Vt.length>0:typeof Vt=="string"?Vt.trim().length>0:typeof Vt=="boolean"?Vt:typeof Vt=="number"||typeof Vt=="object"&&Vt!==null}).length,[r]);Z.useEffect(()=>{const ct=Vt=>{Ce.current&&!Ce.current.contains(Vt.target)&&ze.current&&!ze.current.contains(Vt.target)&&(N(!1),ne(-1))};return document.addEventListener("mousedown",ct),()=>document.removeEventListener("mousedown",ct)},[]);const mt=ct=>{switch(ct){case"preschool":return C.jsx(sm,{className:"w-4 h-4 text-blue-500"});case"kommun":return C.jsx(Ws,{className:"w-4 h-4 text-green-500"});case"area":return C.jsx(Ws,{className:"w-4 h-4 text-orange-500"});case"recent":return C.jsx(UL,{className:"w-4 h-4 text-gray-500"});default:return C.jsx(tb,{className:"w-4 h-4 text-gray-500"})}};return T?C.jsx(Fr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`absolute left-4 top-4 z-30 w-96 ${e}`,layout:!0,transition:{layout:{duration:.3,ease:"easeInOut"}},children:C.jsx(kn,{className:"glass-search border-0 shadow-xl backdrop-blur-lg bg-white/85 border-white/40",children:C.jsxs("div",{className:"p-5",children:[C.jsxs("div",{className:"flex items-center justify-between mb-4",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(tb,{className:"h-5 w-5 text-primary"}),C.jsx("h3",{className:"font-heading font-semibold text-base",children:"Sök förskolor"}),ht&&C.jsx(sn,{variant:"secondary",className:"h-5",children:vt})]}),C.jsx(qr,{onClick:()=>M(!1),variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:C.jsx(qA,{className:"h-3 w-3"})})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"relative",children:[C.jsx(tb,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),C.jsx(hN,{ref:ze,type:"text",placeholder:"Sök förskola, kommun eller adress...",value:v,onChange:ct=>w(ct.target.value),onFocus:()=>{N(!0),Oe(v)},onKeyDown:He,className:"pl-10 pr-10 border-0 focus:ring-2 focus:ring-primary/20 bg-white/90"}),v&&C.jsx(qr,{size:"sm",variant:"ghost",onClick:rt,className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-muted/50",children:C.jsx(Qa,{className:"h-3 w-3"})}),C.jsx(Tc,{children:B&&G.length>0&&C.jsxs(Fr.div,{ref:Ce,initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute top-full left-0 right-0 mt-1 bg-white/98 backdrop-blur-md border border-border/50 rounded-md shadow-lg z-50 max-h-80 overflow-y-auto",children:[!v.trim()&&U.length>0&&C.jsx("div",{className:"px-3 py-2 text-xs font-medium text-muted-foreground border-b border-border/30",children:"Senaste sökningar"}),G.map((ct,Vt)=>C.jsx(Fr.div,{onClick:()=>tt(ct),className:`p-3 cursor-pointer text-sm hover:bg-accent/50 transition-colors border-b border-border/50 last:border-b-0 ${Y===Vt?"bg-accent/70":""}`,initial:{opacity:0},animate:{opacity:1},transition:{delay:Vt*.02},whileHover:{scale:1.01},children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[mt(ct.type),C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsx("div",{className:"font-medium text-foreground truncate",children:ct.title}),ct.subtitle&&C.jsx("div",{className:"text-xs text-muted-foreground truncate",children:ct.subtitle})]})]}),ct.count&&C.jsx(sn,{variant:"secondary",className:"text-xs h-4 px-1 ml-2",children:ct.count})]})},ct.id)),!se&&G.length>=10&&C.jsx("div",{className:"p-2 text-center text-xs text-blue-600 cursor-pointer hover:bg-gray-100",onClick:()=>le(!0),children:"Visa fler resultat..."})]})})]}),C.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[C.jsxs("div",{children:[C.jsxs("label",{className:"text-xs text-muted-foreground mb-1 block",children:["Kommuner ",r.kommuner&&r.kommuner.length>0&&C.jsxs("span",{className:"text-primary",children:["(",r.kommuner.length,")"]})]}),C.jsxs("div",{className:"space-y-2",children:[r.kommuner&&r.kommuner.length>0&&C.jsx("div",{className:"flex flex-wrap gap-1",children:r.kommuner.map(ct=>C.jsxs(sn,{variant:"secondary",className:"flex items-center gap-1 pr-1 pl-2 py-1 text-xs",children:[C.jsx("span",{children:ct}),C.jsx(qr,{size:"sm",variant:"ghost",onClick:()=>{const Vt=r.kommuner?.filter(xr=>xr!==ct);n({...r,kommuner:Vt?.length?Vt:void 0})},className:"h-3 w-3 p-0 hover:bg-destructive/20",children:C.jsx(Qa,{className:"h-2 w-2"})})]},ct))}),C.jsxs(rR,{value:"add",onValueChange:ct=>{if(ct!=="add"&&ct!=="all"){const Vt=r.kommuner||[];Vt.includes(ct)||n({...r,kommuner:[...Vt,ct]})}else ct==="all"&&n({...r,kommuner:void 0})},children:[C.jsx(SE,{className:"h-8 text-xs",children:C.jsx(nR,{placeholder:"+ Lägg till kommun"})}),C.jsxs(TE,{className:"max-h-60 overflow-y-auto",children:[C.jsx(fu,{value:"all",children:"Rensa alla kommuner"}),Jq.map(ct=>C.jsxs(fu,{value:ct,className:"text-xs",disabled:r.kommuner?.includes(ct),children:[ct," (",t.filter(Vt=>Vt.kommun===ct).length,")"]},ct))]})]})]})]}),C.jsxs("div",{children:[C.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Huvudman"}),C.jsxs(rR,{value:r.huvudman||"all",onValueChange:ct=>{n({...r,huvudman:ct==="all"?void 0:ct})},children:[C.jsx(SE,{className:"h-8 text-xs",children:C.jsx(nR,{placeholder:"Välj typ"})}),C.jsxs(TE,{children:[C.jsx(fu,{value:"all",children:"Alla typer"}),C.jsx(fu,{value:"Kommunal",children:"Kommunal"}),C.jsx(fu,{value:"Enskild",children:"Fristående"})]})]})]})]}),C.jsxs(qr,{onClick:lt,variant:ge?"default":"outline",size:"sm",className:"w-full hover-scale transition-all duration-200 font-medium backdrop-blur-sm",disabled:O,children:[O?C.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-current border-t-transparent rounded-full mr-2"}):ge?C.jsx(Qce,{className:"w-4 h-4 mr-2"}):C.jsx(nj,{className:"w-4 h-4 mr-2"}),O?"Hämtar position...":ge?"Position aktiv":"🎯 Nära mig"]}),C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsx("div",{className:"text-xs text-muted-foreground",children:ht?`${o.length.toLocaleString()} av ${t.length.toLocaleString()} förskolor`:`${t.length.toLocaleString()} förskolor totalt`}),ht&&C.jsxs(qr,{size:"sm",variant:"ghost",onClick:rt,className:"h-6 px-2 text-xs text-muted-foreground hover:text-destructive",children:[C.jsx(Qa,{className:"h-3 w-3 mr-1"}),"Rensa allt"]})]})]})]})})}):C.jsx(Fr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`absolute left-4 top-4 z-30 ${e}`,children:C.jsx(kn,{className:"glass-search border-0 shadow-lg card-hover backdrop-blur-lg bg-white/80",children:C.jsxs("div",{className:"p-3",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsxs(qr,{onClick:()=>M(!0),variant:"ghost",size:"sm",className:"h-8 px-2 hover-scale transition-all duration-200 font-heading",children:[C.jsx(tb,{className:"h-4 w-4 mr-1 text-primary"}),C.jsx("span",{className:"font-medium text-base",children:"Sök förskolor"}),ht&&C.jsx(sn,{variant:"secondary",className:"h-4 px-1 text-xs ml-1",children:vt}),C.jsx(Zw,{className:"h-4 w-4 ml-1"})]}),ht&&C.jsx(qr,{onClick:rt,variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-destructive/10",title:"Rensa alla filter",children:C.jsx(Qa,{className:"h-3 w-3 text-muted-foreground hover:text-destructive"})})]}),ht&&C.jsx("div",{className:"pt-2 border-t border-border/50 mt-2",children:C.jsx(YGe,{})})]})})})};function Nqe(e){return{Stockholm:[18.0686,59.3293],Göteborg:[11.9746,57.7089],Malmö:[13.0034,55.605],Uppsala:[17.6389,59.8585],Västerås:[16.5554,59.6099],Örebro:[15.2066,59.2741],Linköping:[15.6214,58.4108],Helsingborg:[12.6945,56.0465],Jönköping:[14.1618,57.7826],Norrköping:[16.1926,58.5877],Lund:[13.191,55.7047],Umeå:[20.263,63.8258],Gävle:[17.1414,60.6749],Borås:[12.9401,57.721],Eskilstuna:[16.5077,59.3706],Södertälje:[17.6253,59.1955],Karlstad:[13.5034,59.3793],Växjö:[14.8059,56.8777],Halmstad:[12.858,56.6745],Sundsvall:[17.3063,62.3908],Luleå:[22.1567,65.5848],Trollhättan:[12.2886,58.2837],Östersund:[14.6357,63.1792],Borlänge:[15.4357,60.4858],Falun:[15.6356,60.6066],Skövde:[13.8454,58.3914],Karlskrona:[15.5866,56.1612],Kristianstad:[14.1591,56.0294],Kalmar:[16.3614,56.6634],Kungälv:[11.9746,57.8737],Partille:[11.9989,57.7396],Mölndal:[12.0134,57.6554],Lerum:[12.2691,57.7706]}[e]||null}const nO=768;function Ire(){const[e,t]=Z.useState(void 0);return Z.useEffect(()=>{const r=window.matchMedia(`(max-width: ${nO-1}px)`),n=()=>{t(window.innerWidth<nO)};return r.addEventListener("change",n),t(window.innerWidth<nO),()=>r.removeEventListener("change",n)},[]),!!e}const Fqe=()=>{const e=Ire(),{filteredPreschools:t,selectedPreschool:r,setSelectedPreschool:n}=vo(),[c,h]=Z.useState(0),[p,o]=Z.useState(!1),v=Z.useRef(null),w=VK(0);if(!e||(Z.useEffect(()=>{if(t.length>0&&!p){const G=setTimeout(()=>o(!0),2e3);return()=>clearTimeout(G)}},[t.length,p]),t.length===0))return null;const T=t[c],M=hI(w,[-300,0,300],[.8,1,.8]),O=hI(w,[-300,0,300],[.3,1,.3]),D=(G,V)=>{V.offset.x>100&&c>0?(h(c-1),n(t[c-1])):V.offset.x<-100&&c<t.length-1&&(h(c+1),n(t[c+1])),w.set(0)},B=()=>{c>0&&(h(c-1),n(t[c-1]))},N=()=>{c<t.length-1&&(h(c+1),n(t[c+1]))};return Z.useEffect(()=>{if(r){const G=t.findIndex(V=>V.id===r.id);G>=0&&G!==c&&h(G)}},[r,t,c]),!T||!p?null:C.jsxs(C.Fragment,{children:[C.jsx(Fr.button,{onClick:()=>o(!p),className:"fixed bottom-20 right-4 z-50 md:hidden bg-primary/90 text-primary-foreground p-3 rounded-full shadow-lg",whileHover:{scale:1.05},whileTap:{scale:.95},initial:{scale:0},animate:{scale:1},transition:{delay:1,duration:.3},children:C.jsx(nj,{className:"w-5 h-5"})}),C.jsxs(Fr.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},className:"fixed bottom-20 left-4 right-4 z-40 md:hidden",children:[C.jsx("div",{ref:v,className:"relative",children:C.jsx(Fr.div,{drag:"x",dragConstraints:v,dragElastic:.1,onDragEnd:D,style:{x:w,scale:M,opacity:O},className:"cursor-grab active:cursor-grabbing",children:C.jsxs(kn,{className:"bg-white/95 backdrop-blur-sm border border-border/50 shadow-lg p-4",children:[C.jsxs("div",{className:"flex items-center justify-between mb-3",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx(Fr.button,{onClick:B,disabled:c===0,className:"p-2 rounded-full bg-primary/10 disabled:opacity-30 disabled:cursor-not-allowed",whileTap:{scale:.9},children:C.jsx(tj,{className:"w-4 h-4"})}),C.jsxs("span",{className:"text-xs text-muted-foreground font-medium",children:[c+1," av ",t.length]}),C.jsx(Fr.button,{onClick:N,disabled:c===t.length-1,className:"p-2 rounded-full bg-primary/10 disabled:opacity-30 disabled:cursor-not-allowed",whileTap:{scale:.9},children:C.jsx(rj,{className:"w-4 h-4"})})]}),C.jsx("button",{onClick:()=>o(!1),className:"text-muted-foreground hover:text-foreground p-1",children:"✕"})]}),C.jsx("div",{className:"flex justify-center space-x-1 mb-4",children:Array.from({length:Math.min(5,t.length)},(G,V)=>{let U;return t.length<=5?U=V:U=Math.max(0,Math.min(t.length-5,c-2))+V,C.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-all duration-200 ${U===c?"bg-primary w-4":"bg-border"}`},U)})}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{children:[C.jsx("h3",{className:"font-semibold text-foreground line-clamp-2",children:T.namn}),C.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[C.jsx(Ws,{className:"w-3 h-3 text-muted-foreground"}),C.jsx("span",{className:"text-sm text-muted-foreground line-clamp-1",children:T.kommun}),T.huvudman&&C.jsx(sn,{variant:"outline",className:"text-xs",children:T.huvudman==="Kommunal"?"Kommunal":"Fristående"})]})]}),C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center space-x-4",children:[T.google_rating&&T.google_rating>0&&C.jsxs("div",{className:"flex items-center space-x-1",children:[C.jsx(bs,{className:"w-4 h-4 text-yellow-500 fill-current"}),C.jsx("span",{className:"text-sm font-medium",children:T.google_rating.toFixed(1)})]}),T.antal_barn&&T.antal_barn>0&&C.jsxs("div",{className:"flex items-center space-x-1",children:[C.jsx(Rm,{className:"w-4 h-4 text-blue-500"}),C.jsx("span",{className:"text-sm text-muted-foreground",children:T.antal_barn})]}),T.personal_andel_forskollararexamen&&C.jsxs(sn,{variant:"secondary",className:"text-xs",children:[Math.round(T.personal_andel_forskollararexamen*100),"% lärare"]})]}),C.jsx("div",{className:"text-xs text-muted-foreground",children:"👆 Swipa"})]})]}),C.jsx(Fr.div,{className:"absolute inset-0 pointer-events-none rounded-lg",style:{background:hI(w,[-300,-100,0,100,300],["linear-gradient(90deg, rgba(34,197,94,0.1) 0%, transparent 100%)","linear-gradient(90deg, rgba(34,197,94,0.05) 0%, transparent 100%)","transparent","linear-gradient(270deg, rgba(59,130,246,0.05) 0%, transparent 100%)","linear-gradient(270deg, rgba(59,130,246,0.1) 0%, transparent 100%)"])}})]})})}),C.jsxs(Fr.div,{initial:{opacity:1},animate:{opacity:0},transition:{delay:4,duration:2},className:"absolute -top-16 left-1/2 transform -translate-x-1/2 bg-black/80 text-white px-3 py-2 rounded-full text-xs whitespace-nowrap flex items-center space-x-2",children:[C.jsx(nj,{className:"w-3 h-3"}),C.jsx("span",{children:"Swipa för att bläddra mellan förskolor"})]})]})]})},Bqe=()=>{const{preschools:e,visiblePreschools:t,filteredPreschools:r}=vo(),[n,c]=Z.useState({renderTime:0,frameRate:0,memoryUsage:0,visibleElements:0,loadTime:0,cacheHitRate:0}),[h,p]=Z.useState(!1),[o,v]=Z.useState(!1);Z.useEffect(()=>{const T=M=>{M.ctrlKey&&M.shiftKey&&M.key==="P"&&(v(!o),console.log("🔧 Performance Dashboard toggled:",!o))};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[o]),Z.useEffect(()=>{const T=()=>{const O=performance.now(),D=performance.now();t.length*.1;const B=performance.now()-D,N=(e.length*.5+t.length*.8)/1024;c({renderTime:B,frameRate:Math.max(30,60-t.length*.01),memoryUsage:N,visibleElements:t.length,loadTime:O,cacheHitRate:Math.min(95,70+t.length/e.length*25)})};T();const M=setInterval(T,1e3);return()=>clearInterval(M)},[e.length,t.length,r.length]);const w=(()=>{let T=100;return n.renderTime>16&&(T-=20),n.frameRate<30&&(T-=30),n.memoryUsage>50&&(T-=15),n.visibleElements>1e3&&(T-=10),n.cacheHitRate<80&&(T-=15),T>=90?{grade:"A+",color:"text-green-600 bg-green-100",description:"Utmärkt prestanda"}:T>=80?{grade:"A",color:"text-green-600 bg-green-100",description:"Mycket bra prestanda"}:T>=70?{grade:"B",color:"text-blue-600 bg-blue-100",description:"Bra prestanda"}:T>=60?{grade:"C",color:"text-yellow-600 bg-yellow-100",description:"Godkänd prestanda"}:T>=50?{grade:"D",color:"text-orange-600 bg-orange-100",description:"Sämre prestanda"}:{grade:"F",color:"text-red-600 bg-red-100",description:"Dålig prestanda"}})();return o?C.jsxs("div",{className:"fixed top-4 right-4 z-50",children:[C.jsx(Fr.button,{onClick:()=>p(!h),className:"bg-black/80 text-white p-2 rounded-lg hover:bg-black/90 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},title:"Performance Dashboard (Ctrl+Shift+P to toggle in production)",children:C.jsx(iE,{className:"w-4 h-4"})}),C.jsx(Tc,{children:h&&C.jsx(Fr.div,{initial:{opacity:0,scale:.9,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-20},className:"absolute top-12 right-0 w-80",children:C.jsx(kn,{className:"p-4 bg-white/95 backdrop-blur-sm border border-border/50 shadow-xl",children:C.jsxs("div",{className:"space-y-4",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx(iE,{className:"w-5 h-5 text-primary"}),C.jsx("h3",{className:"font-semibold",children:"Prestanda"}),C.jsx(sn,{variant:"outline",className:"text-xs",children:"PROD"})]}),C.jsx(sn,{className:w.color,children:w.grade})]}),C.jsx("p",{className:"text-xs text-muted-foreground",children:w.description}),C.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[C.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[C.jsx(oue,{className:"w-3 h-3 text-yellow-500"}),C.jsx("span",{className:"text-xs font-medium",children:"Render"})]}),C.jsxs("div",{className:"text-sm font-bold",children:[n.renderTime.toFixed(1),"ms"]}),C.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.frameRate.toFixed(0)," FPS"]})]}),C.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[C.jsx(VL,{className:"w-3 h-3 text-blue-500"}),C.jsx("span",{className:"text-xs font-medium",children:"Minne"})]}),C.jsxs("div",{className:"text-sm font-bold",children:[n.memoryUsage.toFixed(1),"MB"]}),C.jsxs("div",{className:"text-xs text-muted-foreground",children:["~",Math.round(n.memoryUsage*1.2),"MB max"]})]}),C.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[C.jsx($L,{className:"w-3 h-3 text-green-500"}),C.jsx("span",{className:"text-xs font-medium",children:"Synliga"})]}),C.jsx("div",{className:"text-sm font-bold",children:n.visibleElements.toLocaleString()}),C.jsxs("div",{className:"text-xs text-muted-foreground",children:["av ",e.length.toLocaleString()]})]}),C.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[C.jsx(jm,{className:"w-3 h-3 text-purple-500"}),C.jsx("span",{className:"text-xs font-medium",children:"Cache"})]}),C.jsxs("div",{className:"text-sm font-bold",children:[n.cacheHitRate.toFixed(0),"%"]}),C.jsx("div",{className:"text-xs text-muted-foreground",children:"Träffar"})]})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx("h4",{className:"text-xs font-medium text-muted-foreground",children:"Optimeringar"}),C.jsxs("div",{className:"flex items-center justify-between text-xs",children:[C.jsx("span",{children:"Viewport Culling"}),C.jsx(sn,{variant:n.visibleElements<e.length?"default":"secondary",children:n.visibleElements<e.length?"Aktiv":"Inaktiv"})]}),C.jsxs("div",{className:"flex items-center justify-between text-xs",children:[C.jsx("span",{children:"LOD System"}),C.jsx(sn,{variant:"default",children:"Aktiv"})]}),C.jsxs("div",{className:"flex items-center justify-between text-xs",children:[C.jsx("span",{children:"Clustering"}),C.jsx(sn,{variant:n.visibleElements>100?"default":"secondary",children:n.visibleElements>100?"Aktiv":"Inaktiv"})]}),C.jsxs("div",{className:"flex items-center justify-between text-xs",children:[C.jsx("span",{children:"Progressive Loading"}),C.jsx(sn,{variant:"default",children:"Aktiv"})]})]}),n.frameRate<30&&C.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-2 rounded text-xs",children:[C.jsxs("div",{className:"flex items-center space-x-1 text-yellow-700",children:[C.jsx(UL,{className:"w-3 h-3"}),C.jsx("span",{className:"font-medium",children:"Prestandavarning"})]}),C.jsx("p",{className:"mt-1 text-yellow-600",children:"Zooma ut eller aktivera clustering för bättre prestanda"})]}),C.jsxs("div",{className:"border-t pt-3 space-y-1 text-xs text-muted-foreground",children:[C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{children:"Totalt förskolor:"}),C.jsx("span",{children:e.length.toLocaleString()})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{children:"Filtrerade:"}),C.jsx("span",{children:r.length.toLocaleString()})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{children:"I viewport:"}),C.jsx("span",{children:t.length.toLocaleString()})]})]}),C.jsx("div",{className:"bg-blue-50 border border-blue-200 p-2 rounded text-xs",children:C.jsxs("p",{className:"text-blue-600",children:["💡 Tryck ",C.jsx("kbd",{className:"bg-blue-100 px-1 rounded",children:"Ctrl+Shift+P"})," för att togglela denna dashboard"]})})]})})})})]}):null},Uqe=({isOpen:e,onClose:t})=>{const{filteredPreschools:r,searchTerm:n,selectedCommune:c}=vo(),[h,p]=Z.useState("overview"),o=Z.useMemo(()=>c?{type:"kommun",name:c,title:`Statistik för ${c}`}:n&&n.trim()?{type:"search",name:n.trim(),title:`Statistik för "${n.trim()}"`}:{type:"national",name:"Sverige",title:"Riksstatistik för förskolor"},[c,n]),v=Z.useMemo(()=>{if(r.length===0)return null;const G=r.length,V=r.filter(Ye=>Ye.antal_barn&&Ye.antal_barn>0),U=V.reduce((Ye,Oe)=>Ye+(Oe.antal_barn||0),0),X=r.filter(Ye=>Ye.antal_barngrupper&&Ye.antal_barngrupper>0),Y=X.reduce((Ye,Oe)=>Ye+(Oe.antal_barngrupper||0),0),ne=V.length>0?U/V.length:0,se=Y>0?U/Y:0,le=r.filter(Ye=>Ye.personaltäthet&&Ye.personaltäthet>0),ge=le.length>0?le.reduce((Ye,Oe)=>Ye+(Oe.personaltäthet||0),0)/le.length:0,je=r.filter(Ye=>Ye.andel_med_förskollärarexamen!=null&&Ye.andel_med_förskollärarexamen>=0),ze=je.length>0?je.reduce((Ye,Oe)=>Ye+(Oe.andel_med_förskollärarexamen||0),0)/je.length:0,Ce=r.filter(Ye=>Ye.google_rating&&Ye.google_rating>0),Ke=Ce.length>0?Ce.reduce((Ye,Oe)=>Ye+(Oe.google_rating||0),0)/Ce.length:0;return{totalPreschools:G,totalChildren:U,avgChildrenPerPreschool:Math.round(ne*10)/10,avgChildrenPerGroup:Math.round(se*10)/10,avgStaffDensity:Math.round(ge*10)/10,avgTeacherRatio:Math.round(ze*10)/10,avgRating:Math.round(Ke*10)/10,validRatings:Ce.length,validChildren:V.length,validGroups:X.length,validStaff:le.length,validTeachers:je.length}},[r]),w={avgChildrenPerPreschool:55.1,avgChildrenPerGroup:16.8,avgStaffDensity:5.1,avgTeacherRatio:40.8,avgRating:4.1},T=Z.useMemo(()=>v?[{label:"Barn per förskola",current:v.avgChildrenPerPreschool,national:w.avgChildrenPerPreschool,unit:"barn",trend:v.avgChildrenPerPreschool>w.avgChildrenPerPreschool?"up":v.avgChildrenPerPreschool<w.avgChildrenPerPreschool?"down":"stable",description:"Genomsnittligt antal barn per förskola"},{label:"Barn per grupp",current:v.avgChildrenPerGroup,national:w.avgChildrenPerGroup,unit:"barn",trend:v.avgChildrenPerGroup>w.avgChildrenPerGroup?"up":v.avgChildrenPerGroup<w.avgChildrenPerGroup?"down":"stable",description:"Genomsnittlig barngruppsstorlek"},{label:"Personaltäthet",current:v.avgStaffDensity,national:w.avgStaffDensity,unit:"barn/personal",trend:v.avgStaffDensity<w.avgStaffDensity?"up":v.avgStaffDensity>w.avgStaffDensity?"down":"stable",description:"Antal barn per personal (lägre är bättre)"},{label:"Förskollärare",current:v.avgTeacherRatio,national:w.avgTeacherRatio,unit:"%",trend:v.avgTeacherRatio>w.avgTeacherRatio?"up":v.avgTeacherRatio<w.avgTeacherRatio?"down":"stable",description:"Andel personal med förskollärarexamen"},{label:"Google Betyg",current:v.avgRating,national:w.avgRating,unit:"/5",trend:v.avgRating>w.avgRating?"up":v.avgRating<w.avgRating?"down":"stable",description:`Genomsnittligt Google-betyg (${v.validRatings} förskolor)`}]:[],[v,w]),M=Z.useMemo(()=>{if(!v)return[];const G=[{range:"Små (1-20)",min:1,max:20,count:0},{range:"Medel (21-50)",min:21,max:50,count:0},{range:"Stora (51-100)",min:51,max:100,count:0},{range:"Mycket stora (>100)",min:101,max:9999,count:0}];return r.forEach(V=>{V.antal_barn&&G.forEach(U=>{V.antal_barn>=U.min&&V.antal_barn<=U.max&&U.count++})}),G},[r]),O=Z.useMemo(()=>{const G={Kommunal:0,Privat:0,Kooperativ:0,Övrigt:0};return r.forEach(V=>{if(!V.huvudman||V.huvudman.trim()===""){G.Övrigt++;return}const U=V.huvudman.toLowerCase().trim();U.includes("kommun")||U.includes("kommun")?G.Kommunal++:U.includes("privat")||U.includes("aktiebolag")||U.includes("ab")||U.includes("enskild")||U.includes("stiftelse")||U.includes("företag")?G.Privat++:U.includes("kooperativ")||U.includes("ekonomisk förening")||U.includes("föräldra")||U.includes("kooperativ")?G.Kooperativ++:G.Övrigt++}),Object.entries(G).filter(([V,U])=>U>0).map(([V,U])=>({name:V,value:U}))},[r]),D=G=>{switch(G){case"up":return C.jsx(zce,{className:"w-4 h-4 text-green-500"});case"down":return C.jsx(Rce,{className:"w-4 h-4 text-red-500"});default:return C.jsx(Y9,{className:"w-4 h-4 text-gray-500"})}},B=(G,V,U)=>{if(!G||!V||G===0||V===0)return"Ingen data";const X=Math.abs(G-V),Y=V>0?X/V*100:0,ne=G>V;return Y<1?"≈ rikssnitt":`${ne?"+":"-"}${X.toFixed(1)}${U} (${Y.toFixed(0)}%)`},N=["hsl(142, 76%, 36%)","hsl(200, 85%, 45%)","hsl(35, 100%, 55%)","hsl(215, 20%, 65%)"];return!e||!v?null:C.jsx(Tc,{children:C.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",onClick:t,children:C.jsx(Fr.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.3},className:"fixed left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[95vw] max-w-6xl max-h-[95vh] overflow-hidden md:w-[90vw] md:max-h-[90vh]",onClick:G=>G.stopPropagation(),children:C.jsxs(kn,{className:"h-full bg-white/95 backdrop-blur-sm border border-border/50 shadow-xl",children:[C.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border/30",children:[C.jsxs("div",{className:"flex items-center space-x-3",children:[C.jsx(Ah,{className:"w-6 h-6 text-primary"}),C.jsxs("div",{children:[C.jsx("h2",{className:"text-2xl font-bold",children:o.title}),C.jsxs("p",{className:"text-sm text-muted-foreground",children:["Visar data för ",v.totalPreschools.toLocaleString()," förskolor"]})]})]}),C.jsx(qr,{variant:"ghost",size:"sm",onClick:t,children:C.jsx(Qa,{className:"w-5 h-5"})})]}),C.jsx("div",{className:"flex-1 overflow-auto",children:C.jsxs(Z3,{value:h,onValueChange:p,className:"w-full",children:[C.jsxs(_k,{className:"grid w-full grid-cols-3 mx-6 mt-6",children:[C.jsx(Su,{value:"overview",children:"📊 Översikt"}),C.jsx(Su,{value:"comparison",children:"📈 Jämförelse"}),C.jsx(Su,{value:"distribution",children:"📋 Fördelning"})]}),C.jsxs(Tu,{value:"overview",className:"p-6 space-y-6",children:[C.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[C.jsxs(kn,{className:"p-4",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[C.jsx(sm,{className:"w-4 h-4 text-blue-500"}),C.jsx("span",{className:"text-sm font-medium",children:"Förskolor"})]}),C.jsx("div",{className:"text-2xl font-bold",children:v.totalPreschools.toLocaleString()}),C.jsx("div",{className:"text-xs text-muted-foreground",children:"st"})]}),C.jsxs(kn,{className:"p-4",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[C.jsx(Rm,{className:"w-4 h-4 text-green-500"}),C.jsx("span",{className:"text-sm font-medium",children:"Totalt barn"})]}),C.jsx("div",{className:"text-2xl font-bold",children:v.totalChildren.toLocaleString()}),C.jsx("div",{className:"text-xs text-muted-foreground",children:"barn"})]}),C.jsxs(kn,{className:"p-4",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[C.jsx(jm,{className:"w-4 h-4 text-orange-500"}),C.jsx("span",{className:"text-sm font-medium",children:"⌀ Barn/förskola"})]}),C.jsx("div",{className:"text-2xl font-bold",children:v.avgChildrenPerPreschool.toFixed(1)}),C.jsx("div",{className:"text-xs text-muted-foreground",children:"barn"})]}),C.jsxs(kn,{className:"p-4",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[C.jsx(bs,{className:"w-4 h-4 text-yellow-500"}),C.jsx("span",{className:"text-sm font-medium",children:"⌀ Betyg"})]}),C.jsx("div",{className:"text-2xl font-bold",children:v.avgRating>0?v.avgRating.toFixed(1):"N/A"}),C.jsx("div",{className:"text-xs text-muted-foreground",children:"/5.0"})]})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsx("h3",{className:"text-lg font-semibold",children:"Nyckeltal vs Rikssnitt"}),T.slice(0,3).map((G,V)=>C.jsx(kn,{className:"p-4",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center space-x-3",children:[D(G.trend),C.jsxs("div",{children:[C.jsx("div",{className:"font-medium",children:G.label}),C.jsx("div",{className:"text-sm text-muted-foreground",children:G.description})]})]}),C.jsxs("div",{className:"text-right",children:[C.jsxs("div",{className:"text-2xl font-bold",children:[G.current.toFixed(1),G.unit]}),C.jsxs("div",{className:"text-sm text-muted-foreground",children:["Rikssnitt: ",G.national.toFixed(1),G.unit]}),C.jsx(sn,{variant:"outline",className:"text-xs mt-1",children:B(G.current,G.national,G.unit)})]})]})},V))]})]}),C.jsxs(Tu,{value:"comparison",className:"p-6 space-y-6",children:[C.jsx("h3",{className:"text-lg font-semibold",children:"Detaljerad Jämförelse med Rikssnitt"}),T.map((G,V)=>C.jsxs(kn,{className:"p-6",children:[C.jsxs("div",{className:"flex items-center justify-between mb-4",children:[C.jsxs("div",{className:"flex items-center space-x-3",children:[D(G.trend),C.jsxs("div",{children:[C.jsx("h4",{className:"text-lg font-semibold",children:G.label}),C.jsx("p",{className:"text-sm text-muted-foreground",children:G.description})]})]}),C.jsx(sn,{variant:G.trend==="up"?"default":G.trend==="down"?"destructive":"secondary",children:B(G.current,G.national,G.unit)})]}),C.jsx("div",{className:"h-16",children:C.jsx(Ab,{width:"100%",height:"100%",children:C.jsxs(ID,{data:[{name:o.name,value:G.current},{name:"Rikssnitt",value:G.national}],margin:{top:5,right:30,left:20,bottom:5},children:[C.jsx($_,{dataKey:"name"}),C.jsx(q_,{}),C.jsx(Ns,{formatter:U=>[`${Number(U).toFixed(1)}${G.unit}`,""]}),C.jsx(Lh,{dataKey:"value",fill:G.trend==="up"?"#22c55e":G.trend==="down"?"#ef4444":"#94a3b8",radius:4})]})})})]},V))]}),C.jsxs(Tu,{value:"distribution",className:"p-6 space-y-6",children:[C.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[C.jsxs(kn,{className:"p-6",children:[C.jsx("h3",{className:"text-lg font-semibold mb-4",children:"📏 Förskolor per Storlek"}),C.jsx("div",{className:"h-64",children:C.jsx(Ab,{width:"100%",height:"100%",children:C.jsxs(ID,{data:M,children:[C.jsx(uN,{strokeDasharray:"3 3"}),C.jsx($_,{dataKey:"range"}),C.jsx(q_,{}),C.jsx(Ns,{}),C.jsx(Lh,{dataKey:"count",fill:"hsl(142, 76%, 36%)",radius:4})]})})})]}),C.jsxs(kn,{className:"p-6",children:[C.jsx("h3",{className:"text-lg font-semibold mb-4",children:"🏢 Huvudmansfördelning"}),C.jsx("div",{className:"h-64",children:C.jsx(Ab,{width:"100%",height:"100%",children:C.jsxs(OD,{children:[C.jsx(Vh,{data:O,cx:"50%",cy:"50%",labelLine:!1,label:({name:G,percent:V})=>`${G} ${(V*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:O.map((G,V)=>C.jsx(l1,{fill:N[V%N.length]},`cell-${V}`))}),C.jsx(Ns,{})]})})}),C.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:O.map((G,V)=>C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:N[V%N.length]}}),C.jsxs("span",{className:"text-sm",children:[G.name,": ",G.value]})]},G.name))})]})]}),C.jsxs(kn,{className:"p-6",children:[C.jsx("h3",{className:"text-lg font-semibold mb-4",children:"📋 Sammanfattning av urval"}),C.jsx("div",{className:"overflow-x-auto",children:C.jsx("table",{className:"w-full text-sm",children:C.jsxs("tbody",{className:"space-y-2",children:[C.jsxs("tr",{children:[C.jsx("td",{className:"font-medium",children:"Sammanhang:"}),C.jsx("td",{children:o.title})]}),C.jsxs("tr",{children:[C.jsx("td",{className:"font-medium",children:"Antal förskolor:"}),C.jsxs("td",{children:[v.totalPreschools.toLocaleString()," st"]})]}),C.jsxs("tr",{children:[C.jsx("td",{className:"font-medium",children:"Totalt antal barn:"}),C.jsxs("td",{children:[v.totalChildren.toLocaleString()," barn"]})]}),C.jsxs("tr",{children:[C.jsx("td",{className:"font-medium",children:"Genomsnittlig förskolestorlek:"}),C.jsxs("td",{children:[v.avgChildrenPerPreschool.toFixed(1)," barn/förskola"]})]}),C.jsxs("tr",{children:[C.jsx("td",{className:"font-medium",children:"Förskolor med betyg:"}),C.jsxs("td",{children:[v.validRatings," st (",(v.validRatings/v.totalPreschools*100).toFixed(1),"%)"]})]})]})})})]})]})]})})]})})})})},Vqe=()=>{const{performanceMode:e,setPerformanceMode:t}=vo(),r=Z.useRef(null);Z.useEffect(()=>{const p=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),o="ontouchstart"in window,v=window.innerWidth<768;(p||o||v)&&(e==="high"&&t("medium"),n(),c(),h())},[]);const n=()=>{let p=document.querySelector('meta[name="viewport"]');p||(p=document.createElement("meta"),p.setAttribute("name","viewport"),document.head.appendChild(p)),p.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no");let o=document.querySelector('meta[name="theme-color"]');o||(o=document.createElement("meta"),o.setAttribute("name","theme-color"),o.setAttribute("content","#1f2937"),document.head.appendChild(o));let v=document.querySelector('meta[name="mobile-web-app-capable"]');v||(v=document.createElement("meta"),v.setAttribute("name","mobile-web-app-capable"),v.setAttribute("content","yes"),document.head.appendChild(v))},c=()=>{const p=document.createElement("style");p.textContent=`
      @media (max-width: 768px) {
        .mapboxgl-ctrl button {
          min-width: 44px !important;
          min-height: 44px !important;
        }
        
        .mapboxgl-popup-close-button {
          width: 30px !important;
          height: 30px !important;
          font-size: 16px !important;
        }
        
        /* Larger touch targets for UI elements */
        button, .clickable {
          min-height: 44px;
          min-width: 44px;
        }
        
        /* Improved scrolling on mobile */
        .overflow-y-auto {
          -webkit-overflow-scrolling: touch;
          overflow-scrolling: touch;
        }
        
        /* Prevent text selection on mobile */
        .map-container, .mapboxgl-map {
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: transparent;
        }
        
        /* Better mobile panels */
        .mobile-panel {
          position: fixed !important;
          bottom: 0 !important;
          left: 0 !important;
          right: 0 !important;
          top: auto !important;
          transform: none !important;
          border-radius: 16px 16px 0 0 !important;
          max-height: 70vh !important;
        }
      }
    `,document.head.appendChild(p)},h=()=>{let p=0;const o=v=>{const w=Date.now();w-p<=300&&v.preventDefault(),p=w};return document.addEventListener("touchend",o,{passive:!1}),()=>{document.removeEventListener("touchend",o)}};return Z.useEffect(()=>{const p=w=>{w.touches.length===1&&(r.current={x:w.touches[0].clientX,y:w.touches[0].clientY,time:Date.now()})},o=w=>{w.touches.length>1&&w.preventDefault()},v=w=>{if(r.current&&w.changedTouches.length===1){const T={x:w.changedTouches[0].clientX,y:w.changedTouches[0].clientY,time:Date.now()},M=T.x-r.current.x,O=T.y-r.current.y,D=T.time-r.current.time;if(Math.sqrt(M*M+O*O)>50&&D<300){const B=Math.atan2(O,M)*180/Math.PI;Math.abs(B)<45?document.dispatchEvent(new CustomEvent("swipeRight")):Math.abs(B)>135?document.dispatchEvent(new CustomEvent("swipeLeft")):B>45&&B<135?document.dispatchEvent(new CustomEvent("swipeDown")):B<-45&&B>-135&&document.dispatchEvent(new CustomEvent("swipeUp"))}}r.current=null};return document.addEventListener("touchstart",p,{passive:!0}),document.addEventListener("touchmove",o,{passive:!1}),document.addEventListener("touchend",v,{passive:!0}),()=>{document.removeEventListener("touchstart",p),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",v)}},[]),null},$qe=()=>{const{preschools:e,setPreschools:t,updatePreschool:r,setLoading:n}=vo(),c=Z.useCallback(o=>{const v={id:o.new.id,namn:o.new.Namn,kommun:o.new.Kommun,adress:o.new.Adress||"",latitud:o.new.Latitud||0,longitud:o.new.Longitud||0,antal_barn:o.new["Antal barn"],huvudman:o.new.Huvudman,personaltäthet:o.new.Personaltäthet,andel_med_förskollärarexamen:o.new["Andel med förskollärarexamen"],antal_barngrupper:o.new["Antal barngrupper"]};t([...e,v]),fh.success(`Ny förskola tillagd: ${v.namn}`)},[e,t]),h=Z.useCallback(o=>{const v={id:o.new.id,namn:o.new.Namn,kommun:o.new.Kommun,adress:o.new.Adress||"",latitud:o.new.Latitud||0,longitud:o.new.Longitud||0,antal_barn:o.new["Antal barn"],huvudman:o.new.Huvudman,personaltäthet:o.new.Personaltäthet,andel_med_förskollärarexamen:o.new["Andel med förskollärarexamen"],antal_barngrupper:o.new["Antal barngrupper"]},w={lat:o.old?.Latitud,lng:o.old?.Longitud},T={lat:o.new.Latitud,lng:o.new.Longitud};(w.lat===null||w.lat===0)&&T.lat!==null&&T.lat!==0?fh.success(`Koordinater tillagda för ${v.namn}!`):w.lat!==T.lat||w.lng!==T.lng?fh.info(`Koordinater uppdaterade för ${v.namn}`):fh.info(`Förskola uppdaterad: ${v.namn}`),r(v)},[r]),p=Z.useCallback(o=>{const v=o.old.id,w=e.filter(T=>T.id!==v);t(w),fh.error(`Förskola borttagen: ${o.old.Namn}`)},[e,t]);return Z.useEffect(()=>{const o=gn.channel("preschool_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"Förskolor"},c).on("postgres_changes",{event:"UPDATE",schema:"public",table:"Förskolor"},h).on("postgres_changes",{event:"DELETE",schema:"public",table:"Förskolor"},p).subscribe(),v=gn.channel("google_data_changes").on("postgres_changes",{event:"*",schema:"public",table:"preschool_google_data"},T=>{if(console.log("Google data update received:",T),T.eventType==="INSERT"||T.eventType==="UPDATE"){const M=T.new?.preschool_id;if(M){const O=vo.getState().preschools.map(D=>D.id===M?{...D,google_rating:T.new?.google_rating,google_reviews_count:T.new?.google_reviews_count,google_reviews:T.new?.reviews,contact_phone:T.new?.contact_phone,website_url:T.new?.website_url,opening_hours:T.new?.opening_hours}:D);t(O)}}}).subscribe(),w=gn.channel("image_changes").on("postgres_changes",{event:"*",schema:"public",table:"preschool_images"},T=>{console.log("Image update received:",T),fh.info("Nya bilder tillgängliga")}).subscribe();return()=>{gn.removeChannel(o),gn.removeChannel(v),gn.removeChannel(w)}},[c,h,p]),{}},Gqe=()=>{const e=Z.useRef(!1),t=Z.useRef(),r=Z.useCallback(async()=>{if(!e.current){e.current=!0;try{const{data:h}=await gn.from("preschool_google_data").select("preschool_id"),p=h?.map(v=>v.preschool_id)||[],{data:o}=await gn.from("Förskolor").select('id, "Namn", "Adress", "Latitud", "Longitud"').not("Latitud","is",null).not("Longitud","is",null).not("id","in",p.length>0?p:["00000000-0000-0000-0000-000000000000"]).limit(8);if(o&&o.length>0)for(const v of o)try{await gn.functions.invoke("google-places-enricher",{body:{preschoolId:v.id,lat:v.Latitud,lng:v.Longitud,address:v.Adress,name:v.Namn}}),await new Promise(w=>setTimeout(w,3e3))}catch(w){console.error(`Silent enrichment error for ${v.id}:`,w)}}catch(h){console.error("Background enrichment error:",h)}finally{e.current=!1,t.current=setTimeout(()=>{r()},10*60*1e3)}}},[]),n=Z.useCallback(()=>{t.current=setTimeout(()=>{r()},3e4)},[r]),c=Z.useCallback(()=>{t.current&&clearTimeout(t.current),e.current=!1},[]);return Z.useEffect(()=>()=>{c()},[c]),{startBackgroundEnrichment:n,stopBackgroundEnrichment:c,isRunning:e.current}},qqe=()=>{const[e,t]=Z.useState(!0),[r,n]=Z.useState(null),{setPreschools:c,setLoading:h}=vo(),{startBackgroundEnrichment:p}=Gqe();$qe();const o=async()=>{try{t(!0),h(!0),n(null);const{data:v,error:w}=await gn.from("Förskolor").select(`
          id,
          "Namn",
          "Kommun", 
          "Adress",
          "Latitud",
          "Longitud",
          "Antal barn",
          "Huvudman",
          "Personaltäthet",
          "Andel med förskollärarexamen",
          "Antal barngrupper",
          preschool_google_data (
            google_rating,
            google_reviews_count,
            reviews,
            contact_phone,
            website_url,
            opening_hours
          )
        `);if(w)throw w;const T=(v||[]).map(O=>({id:O.id,namn:O.Namn,kommun:O.Kommun,adress:O.Adress||"",latitud:O.Latitud!==null?O.Latitud:null,longitud:O.Longitud!==null?O.Longitud:null,antal_barn:O["Antal barn"],huvudman:O.Huvudman,personaltäthet:O.Personaltäthet,andel_med_förskollärarexamen:O["Andel med förskollärarexamen"],antal_barngrupper:O["Antal barngrupper"],google_rating:O.preschool_google_data?.[0]?.google_rating,google_reviews_count:O.preschool_google_data?.[0]?.google_reviews_count,google_reviews:O.preschool_google_data?.[0]?.reviews,contact_phone:O.preschool_google_data?.[0]?.contact_phone,website_url:O.preschool_google_data?.[0]?.website_url,opening_hours:O.preschool_google_data?.[0]?.opening_hours})),M=T.filter(O=>O.latitud===null||O.longitud===null||O.latitud===0||O.longitud===0);if(M.length>0){console.log(`Found ${M.length} preschools needing geocoding. Triggering background processing...`);const O=M.map(D=>({id:D.id,Namn:D.namn,Adress:D.adress,Kommun:D.kommun,Latitud:D.latitud,Longitud:D.longitud}));gn.functions.invoke("geocoding-service",{body:{preschools:O.slice(0,25)}}).then(D=>{console.log("Geocoding service response:",D)}).catch(D=>{console.error("Geocoding service error:",D)})}console.log(`🗺️ Setting ${T.length} preschools in store for map display`),c(T),console.log(`✅ Successfully loaded and displayed ${T.length} preschools on map`),p()}catch(v){console.error("Error fetching preschools:",v),n(v instanceof Error?v.message:"An error occurred")}finally{t(!1),h(!1)}};return Z.useEffect(()=>{console.log("🚀 Starting immediate preschool data fetch during loading animation..."),o()},[]),{isLoading:e,error:r,refetch:o}},Hqe="/assets/preschool-icon-DeZlZPNS.jpg";Z.lazy(()=>tv(()=>Promise.resolve().then(()=>ZGe)).then(e=>({default:e.PreschoolDetailsPanel})));const Wqe=()=>{const{isLoading:e,error:t}=qqe(),{searchBoxCollapsed:r,setSearchBoxCollapsed:n}=vo(),{selectedPreschools:c,setIsOpen:h}=Tk(),p=Ire(),[o,v]=Z.useState(!0),[w,T]=Z.useState(!1),[M,O]=Z.useState(!1),[D,B]=Z.useState(!1),N=()=>{v(!1),T(!0)};Z.useEffect(()=>{const V=setTimeout(()=>{o&&(console.warn("Loading animation timeout - showing main content as fallback"),N())},5e3);return()=>clearTimeout(V)},[o]);const G=r;return t?C.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-secondary/20",children:C.jsxs("div",{className:"text-center",children:[C.jsx("h1",{className:"text-2xl font-bold text-destructive mb-2",children:"Ett fel uppstod"}),C.jsx("p",{className:"text-muted-foreground",children:t})]})}):C.jsx(Sxe,{children:C.jsxs(mX,{children:[C.jsx(XGe,{}),C.jsx(Vqe,{}),o&&C.jsx(vI,{fallback:C.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background",children:C.jsxs("div",{className:"text-center",children:[C.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Laddar Sveriges Förskolor..."}),C.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto"})]})}),children:C.jsx(qwe,{onComplete:N})}),C.jsxs(Fr.div,{className:"min-h-screen bg-gradient-to-br from-background via-background to-secondary/10",id:"main-content",initial:{opacity:0},animate:{opacity:o?0:1},transition:{delay:0,duration:.6,ease:"easeOut"},children:[C.jsx(Fr.header,{initial:{opacity:0,y:-15},animate:{opacity:o?0:1,y:0},transition:{delay:0,duration:.4,ease:"easeOut"},className:"relative z-40 bg-white border-b border-border/10",children:C.jsx("div",{className:"container mx-auto px-6 md:px-8 py-4 md:py-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center space-x-3 md:space-x-5",children:[C.jsx(Fr.img,{src:Hqe,alt:"Sveriges Förskolor",className:"w-10 h-10 md:w-14 md:h-14 rounded-2xl shadow-lg hover-lift",whileHover:{scale:1.05},transition:{duration:.2}}),C.jsxs("div",{children:[C.jsx("h1",{className:"text-xl md:text-4xl font-bold text-gradient font-heading leading-tight",children:"Förskolor i Sverige"}),C.jsx("p",{className:"text-sm md:text-base text-muted-foreground font-medium mt-1 md:mt-2 hidden sm:block",children:"Hitta och jämför förskolor – i hela landet"})]})]}),C.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[C.jsxs(qr,{variant:"outline",size:"lg",className:"items-center gap-3 glass-effect hover-glow-subtle relative border-0 font-semibold",onClick:()=>B(!0),children:[C.jsx(Ah,{className:"w-5 h-5"}),"Statistik"]}),C.jsxs(qr,{variant:"outline",size:"lg",className:"items-center gap-3 glass-effect hover-glow-subtle relative border-0 font-semibold",onClick:()=>h(!0),children:[C.jsx(qce,{className:"w-5 h-5"}),"Jämför",c.length>0&&C.jsx(sn,{variant:"secondary",className:"absolute -top-2 -right-2 h-6 w-6 p-0 text-sm flex items-center justify-center bg-primary text-primary-foreground",children:c.length})]})]})]})})}),C.jsxs("div",{className:`relative ${p?"pb-16":""}`,children:[!p&&C.jsx(Fr.div,{initial:{opacity:0,x:-20,scale:.95},animate:{opacity:o?0:1,x:0,scale:1},transition:{delay:0,duration:.3,ease:"easeOut"},className:"absolute left-6 top-6 z-30",children:C.jsx(vI,{children:C.jsx(zV,{children:C.jsx(zqe,{})})})}),C.jsx(Fr.div,{initial:{opacity:0,x:20,scale:.95},animate:{opacity:o?0:1,x:0,scale:1},transition:{delay:.1,duration:.3,ease:"easeOut"},children:C.jsx(vI,{children:C.jsx(zV,{children:C.jsx(KGe,{})})})}),C.jsx(Fr.div,{className:`${p?"h-[calc(100vh-64px)]":"h-screen"}`,initial:{opacity:0},animate:{opacity:o?0:1},transition:{delay:.2,duration:.4,ease:"easeOut"},children:C.jsxs(Hwe,{isMapVisible:w,children:[C.jsx(bxe,{className:"w-full h-full"}),C.jsx(Uwe,{}),C.jsx(Vwe,{})]})}),G&&C.jsx("button",{onClick:()=>n(!1),className:"absolute top-4 left-4 z-50 bg-card/95 backdrop-blur-lg shadow-nordic border-border/50 rounded-lg px-3 py-2 text-sm font-medium hover:bg-accent transition-colors",children:"🔍 Sök förskolor"}),C.jsx(Bwe,{isOpen:M,onClose:()=>O(!1)}),C.jsx(Zwe,{}),C.jsx(l1e,{}),C.jsx(Uqe,{isOpen:D,onClose:()=>B(!1)}),C.jsx(BGe,{}),C.jsx(Bqe,{}),p&&C.jsx(m1e,{}),p&&C.jsx(Fr.div,{initial:{opacity:0,y:15},animate:{opacity:o?0:1,y:0},transition:{delay:.3,duration:.3},className:"fixed bottom-20 left-4 z-40 md:hidden",children:C.jsx(qr,{variant:"outline",size:"sm",className:"glass-effect hover-glow-subtle border-0 p-3 rounded-full shadow-lg",onClick:()=>B(!0),children:C.jsx(Ah,{className:"w-5 h-5"})})}),C.jsx(Fqe,{}),C.jsx(Fr.div,{initial:{opacity:0,y:15,scale:.9},animate:{opacity:o?0:1,y:0,scale:1},transition:{delay:.4,duration:.3,ease:"easeOut"},className:"fixed bottom-6 right-6 z-40",children:C.jsx(Wwe,{onClick:()=>O(!0),variant:"outline",size:"lg",className:"glass-effect hover-glow-subtle border-0 p-4 rounded-2xl shadow-nordic",children:C.jsx(GL,{className:"w-6 h-6"})})}),e&&!o&&C.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-background/80 backdrop-blur-lg flex items-center justify-center z-50",children:C.jsxs("div",{className:"text-center",children:[C.jsx(Fr.div,{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4",animate:{rotate:360},transition:{duration:.8,repeat:1/0,ease:"linear"}}),C.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Laddar Sveriges förskolor..."}),C.jsx("p",{className:"text-muted-foreground",children:"Hämtar data från Supabase-databasen"})]})})]})]})]})})},Zqe=()=>{const e=oZ();return Z.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),C.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:C.jsxs("div",{className:"text-center",children:[C.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),C.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),C.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},Kqe=new Tfe,Xqe=()=>C.jsx(Afe,{client:Kqe,children:C.jsxs(efe,{children:[C.jsx(Uue,{}),C.jsx(mhe,{}),C.jsx(fpe,{basename:"/sweden-preschool-spotlight",children:C.jsxs(upe,{children:[C.jsx(fj,{path:"/",element:C.jsx(Wqe,{})}),C.jsx(fj,{path:"*",element:C.jsx(Zqe,{})})]})})]})});v9(document.getElementById("root")).render(C.jsx(Xqe,{}));
